<!doctype html>
<html lang="zh-CN" dir="ltr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="./favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<style>	
			html {height: 100%;padding: 0;display: flex;flex-direction: column;}
			body{min-height: 100vh;flex: 1; display: flex;flex-direction: column;}
		</style>
		<script>
			// Load theme early to prevent blinking
			(function() {
				try {
					const savedChart = localStorage.getItem('chart');
					if (savedChart) {
						const chartData = JSON.parse(savedChart);
						if (chartData.theme) {
							document.documentElement.setAttribute('data-theme', chartData.theme);
							
							// Set CSS variables immediately based on theme
							const root = document.documentElement;
							if (chartData.theme === 'dark') {
								root.style.setProperty('--border-color', '#292929');
								root.style.setProperty('--background-color', '#0f0f0f');
								root.style.setProperty('--text-color', '#cccccc');
							} else {
								root.style.setProperty('--border-color', '#ebedf1');
								root.style.setProperty('--background-color', '#ffffff');
								root.style.setProperty('--text-color', '#051441');
							}
						}
					}
				} catch (e) {
					// Fallback to default theme if error
					console.log('Theme loading error:', e);
				}
			})();

			// Early sidebar state restoration to prevent flashing
			(function() {
				try {
					// Constants
					const MIN_WIDTH = 180;
					const MAX_WIDTH = 480;
					const DEFAULT_WIDTH = 280;
					const PRICE_SCALE_WIDTH = 80;

					// Helper functions
					function parseBool(value, fallback) {
						if (value === null) return fallback;
						return value === 'true';
					}

					function clampWidth(value, min, max, fallback) {
						if (isNaN(value) || value < min || value > max) {
							return fallback;
						}
						return value;
					}

					function checkContainerSize() {
						const containerWidth = window.innerWidth;
						const minChartWidth = 300;
						const minRequiredWidth = MIN_WIDTH + PRICE_SCALE_WIDTH + minChartWidth;
						return containerWidth >= minRequiredWidth;
					}

					// Read persisted state
					const persistedVisible = localStorage.getItem('dutyai.chart.sidebar.visible');
					const persistedWidth = localStorage.getItem('dutyai.chart.sidebar.widthPx');
					
					let visible = parseBool(persistedVisible, false);
					let widthPx = clampWidth(parseInt(persistedWidth || '', 10), MIN_WIDTH, MAX_WIDTH, DEFAULT_WIDTH);

					// Auto-collapse if container is too narrow
					if (visible && !checkContainerSize()) {
						visible = false;
						widthPx = 0;
					}

					// Store bootstrap state globally for components to use
					window.__sidebarBootstrap = {
						visible: visible,
						widthPx: visible ? widthPx : 0,
						transitionsEnabled: false
					};

					// Set initial CSS variables to prevent layout shift
					const root = document.documentElement;
					root.style.setProperty('--sidebar-width', visible ? widthPx + 'px' : '0px');
					root.style.setProperty('--sidebar-visible', visible ? '1' : '0');
					root.style.setProperty('--chart-sidebar-width', visible ? widthPx + 'px' : '0px');
					root.style.setProperty('--chart-sidebar-visible', visible ? '1' : '0');
					
				} catch (e) {
					console.warn('Sidebar bootstrap error:', e);
					// Fallback state
					window.__sidebarBootstrap = {
						visible: false,
						widthPx: 0,
						transitionsEnabled: false
					};
					// Set fallback CSS variables
					const root = document.documentElement;
					root.style.setProperty('--sidebar-width', '0px');
					root.style.setProperty('--sidebar-visible', '0');
					root.style.setProperty('--chart-sidebar-width', '0px');
					root.style.setProperty('--chart-sidebar-visible', '0');
				}
			})();
		</script>

		<!-- No-flash CSS rules to prevent sidebar visibility during initial paint -->
		<style>
			/* Prevent sidebar from being visible during initial paint if not supposed to be visible */
			.sidebar-container {
				width: var(--sidebar-width, 0px) !important;
				transition: none !important;
				overflow: hidden;
			}
			
			/* Ensure chart content takes up correct space from the start */
			.chart-container {
				--chart-content-width: calc(100% - var(--chart-sidebar-width, 0px));
			}
			
			.kline-content {
				width: var(--chart-content-width, 100%) !important;
			}
			
			/* Hide sidebar completely if not visible */
			.sidebar-container[data-visible="false"] {
				display: none !important;
			}
			
			/* Disable all transitions during initial load */
			.sidebar-container,
			.sidebar-container *,
			.chart-container,
			.chart-container *,
			.kline-content,
			.kline-content * {
				transition: none !important;
			}
		</style>
		
		<link href="./_app/immutable/assets/0.CD2G4m0C.css" rel="stylesheet">
		<link href="./_app/immutable/assets/alert.B3IZgsFc.css" rel="stylesheet">
		<link href="./_app/immutable/assets/2.B1ITqWrH.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.BcVsQkMf.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/entry.iWF9Yzp0.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.BSrB-apI.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/i18n.D5ccR3lD.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/stores.6U79TEpb.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/runtime.B6MoU35X.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/index-client.DoBg62uv.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.CQu4ah_f.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/alert.K-EoAu6c.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/lifecycle.DaGHNOzj.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/2.7xQ0U2UY.js"><!--[--><!--[--><!--[--><!--[--><link rel="alternate" hreflang="en" href="http://sveltekit-prerender/"><link rel="alternate" hreflang="zh-CN" href="http://sveltekit-prerender/zh-CN/"><!--]--><!--]--><!--]--><!--]-->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents;"><!--[--><!--[--><!----><!----><!----><div class="alerts-container svelte-1ykjk67"><!--[--><!--]--></div> <!----><!--[!--><!--]--><!----><!----><!----><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_225j5f = {
						base: new URL(".", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("./_app/immutable/entry/start.BcVsQkMf.js"),
						import("./_app/immutable/entry/app.BSrB-apI.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
