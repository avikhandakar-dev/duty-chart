(function(){"use strict";const Wa=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="boolean")return e?1:0;if(e==null)return NaN;const t=Number(e);return Number.isFinite(t)?t:NaN},ni=(e,t,i)=>{const n=(a=0)=>{if(typeof a!="number"||!Number.isFinite(a)||!Number.isInteger(a)||a<0)throw new Error("ctx.hist offset must be a non-negative integer");const r=i.value-a;if(r<0||r>=t.length)return NaN;const s=t[r];return Wa(s)};return{name:e,data:t,get:n,valueOf:()=>n(0),toString:()=>String(n(0))}},Yn=e=>{const t=e.params&&typeof e.params=="object"?e.params:{},i=(a,r)=>{const s=String(a||"").trim();return s&&Object.prototype.hasOwnProperty.call(t,s)?t[s]:r};return{open:ni("open",e.open,e.indexRef),high:ni("high",e.high,e.indexRef),low:ni("low",e.low,e.indexRef),close:ni("close",e.close,e.indexRef),volume:ni("volume",e.volume,e.indexRef),time:ni("time",e.time,e.indexRef),bar_index:ni("bar_index",e.barIndex,e.indexRef),params:t,input:i,hist:(a,r=0)=>a.get(r)}},Qa=["line","histogram","area","cross","dots","stepped","step","bar","candles","ohlc","neon_line","bezier_line","glow_points","heatmap","distortion","cloud","aura","candleshadow","supertrend_cloud","fractal_boxes","liquidity_tiles"],Ki={maxLoopIters:5e4,maxBarMs:100,maxTotalMs:2e3,maxCallDepth:2e3,maxSeriesPoints:25e3,maxDrawOps:2e3,maxSecurityCalls:20,maxHeatmapPoints:2e5,maxOverlays:120,maxOverlayPoints:2e3},bn=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();function Ga(e=Ki){let t=0,i=0,n=bn(),a=bn();return{resetBar:()=>{t=0,i=0,n=bn()},resetRun:()=>{a=bn()},guard:()=>{if(t+=1,t>e.maxLoopIters)throw new Error("JS guardrail: loop iteration limit exceeded")},checkTime:()=>{if(bn()-n>e.maxBarMs)throw new Error("JS guardrail: time budget exceeded")},checkTotal:()=>{if(bn()-a>e.maxTotalMs)throw new Error(`JS guardrail: total runtime exceeded (max ${e.maxTotalMs}ms)`)},enterCall:()=>{if(i+=1,i>e.maxCallDepth)throw new Error("JS guardrail: call depth exceeded")},exitCall:()=>{i=Math.max(0,i-1)}}}function Ka(e){return Object.freeze({...e})}const Fr="script_studio_js",gs=`"use strict";
const window = undefined;
const document = undefined;
const globalThis = undefined;
const self = undefined;
const navigator = undefined;
const location = undefined;
const crypto = undefined;
const fetch = undefined;
const WebSocket = undefined;
const setTimeout = undefined;
const setInterval = undefined;
const XMLHttpRequest = undefined;
const Date = Object.assign(function () {
  throw new Error("JS guardrail: Date is not allowed");
}, {
  now() {
    throw new Error("JS guardrail: Date.now is not allowed");
  },
  parse() {
    throw new Error("JS guardrail: Date.parse is not allowed");
  },
  UTC() {
    throw new Error("JS guardrail: Date.UTC is not allowed");
  }
});
const performance = {
  now() {
    throw new Error("JS guardrail: performance.now is not allowed");
  }
};
const __blockedMathRandom = () => {
  throw new Error("JS guardrail: Math.random is not allowed");
};
try {
  Math.random = __blockedMathRandom;
} catch (error) {
  // Ignore if Math.random is not writable in this environment.
}
const { ctx, ta, math, color, str, request, plot, plotshape, plotchar, plotcandle, plotbar, plotohlc, hline, fill, label, line, box, polyline, polygon, overlay, heatmap, table, alert, alertcondition, strategy, __guard, __guardCall, __guardExit } = sandbox;
let exports = {};
let module = { exports };
`,Ha=`
const exp = (module && module.exports) ? module.exports : exports;
return {
  onInit: (typeof onInit === "function" ? onInit : exp.onInit),
  onBar: (typeof onBar === "function" ? onBar : exp.onBar),
};
//# sourceURL=${Fr}
`,ys=gs.split(`
`).length-1;function Ja(e,t){const i=String(e||""),n=t.__instrument,a=n?n(i):i,r=`${gs}${a}${Ha}`;return new Function("sandbox",r)(t)}const Ir=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="boolean")return e?1:0;if(e==null)return NaN;const t=Number(e);return Number.isFinite(t)?t:NaN},En=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),Ya=()=>{const e=new Error().stack;if(!e)return;const t=e.match(new RegExp(`${Fr}:(\\d+):(\\d+)`));if(!t)return;const i=Number(t[1]),n=Number(t[2]),a=Number.isFinite(i)?Math.max(1,i-ys):void 0,r=Number.isFinite(n)?Math.max(1,n):void 0;if(!(!a&&!r))return{line:a,col:r}},St=(e,t,i,n,a)=>{if(e.diagSet.has(t))return;e.diagSet.add(t);const r=Ya();e.diagnostics.push({level:i,message:n,hint:a,code:t,line:r==null?void 0:r.line,col:r==null?void 0:r.col})},nt=e=>e&&typeof e=="object"&&e.get?Ir(e.get(0)):Ir(e),di=(e,t)=>{if(En(e))return di(e.get(0),t);if(typeof e=="boolean")return e?1:0;if(typeof e=="number")return Number.isFinite(e)&&e!==0?1:0;if(typeof e=="string")return e.length?1:0;throw new Error(`JS guardrail: ${t} condition must be a number, boolean, or string`)},Ar=e=>{if(!e)return 0;let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);const i=t>>>0;return i===0?1:i},Xa=e=>{const t=String(e||"line").trim().toLowerCase().replace(/^plot\./,"");return t?Qa.includes(t)?t:t.includes("hist")||t.includes("column")?"histogram":t.includes("bar")&&!t.includes("ohlc")&&!t.includes("candle")?"bar":t.includes("candle")?"candles":t.includes("ohlc")?"ohlc":t.includes("area")?"area":t.includes("step")?"stepped":t.includes("cross")?"cross":t.includes("dot")?"dots":t.includes("neon")?"neon_line":t.includes("bezier")?"bezier_line":t.includes("glow")?"glow_points":t.includes("heat")?"heatmap":t.includes("distort")?"distortion":t.includes("cloud")?"cloud":t.includes("aura")?"aura":t:"line"},Er=(e,t=12)=>{if(e==null)return;const i=typeof e=="number"?e:Number(e);if(Number.isFinite(i))return Math.max(6,Math.min(48,i));const n=String(e).trim().toLowerCase();return n?n.includes("tiny")?10:n.includes("small")?12:n.includes("normal")?14:n.includes("large")?16:n.includes("huge")?18:t:t},Mn=e=>{if(e==null)return;const t=String(e).trim().toLowerCase();if(t.startsWith("l"))return"left";if(t.startsWith("c")||t.includes("middle"))return"center";if(t.startsWith("r"))return"right"},Xn=e=>{if(e==null)return;const t=String(e).trim().toLowerCase();if(t.startsWith("t"))return"top";if(t.startsWith("m")||t.includes("center"))return"middle";if(t.startsWith("b"))return"bottom"},Za=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(!e||typeof e!="object"||Array.isArray(e))return;const t=e,i=a=>{const r=typeof a=="number"?a:Number(a);return Number.isFinite(r)?r:void 0},n={};if(n.left=i(t.left),n.right=i(t.right),n.top=i(t.top),n.bottom=i(t.bottom),!(n.left==null&&n.right==null&&n.top==null&&n.bottom==null))return n},eo=e=>{const t=typeof e=="number"?e:Number(e);if(Number.isFinite(t))return Math.trunc(t)},ri=e=>String(e||"").toLowerCase()==="sub"?"sub":"main",bi=e=>!!e&&typeof e=="object"&&!Array.isArray(e)&&!En(e),_n=e=>{if(e==null)return;const t=String(e).trim().toLowerCase().replace(/^xloc\./,"");if(t){if(t.includes("time"))return"time";if(t.includes("bar"))return"bar_index"}},xs=e=>{if(e==null)return;const t=String(e).trim().toLowerCase().replace(/^yloc\./,"");if(t){if(t.includes("pixel"))return"pixel";if(t.includes("price"))return"price"}},bs=e=>{if(e==null)return;const t=String(e).trim().toLowerCase().replace(/^yloc\./,"");if(t){if(t.includes("above"))return"abovebar";if(t.includes("below"))return"belowbar";if(t.includes("price")||t.includes("absolute"))return"price"}},_s=e=>{if(Array.isArray(e)){const t=e.map(i=>String(i||"").trim().toLowerCase()).filter(Boolean);return t.length?t:void 0}if(typeof e=="string"){const t=e.split(",").map(i=>i.trim().toLowerCase()).filter(Boolean);return t.length?t:void 0}},ui=e=>{if(!e||typeof e!="object")return;const t=e,i=t.from??t.start??t.color1??t.colorA,n=t.to??t.end??t.color2??t.colorB,a=i!=null?String(i):void 0,r=n!=null?String(n):void 0;if(!a&&!r)return;const s=String(t.mode??t.direction??t.type??"").toLowerCase();let f;return s.includes("rad")?f="radial":s.includes("h")?f="horizontal":s.includes("v")&&(f="vertical"),{from:a,to:r,mode:f}},vn=e=>{if(!e)return{};const t=e.glow??e.glowSize??e.glow_size??e.glowWidth??e.glow_width,i=typeof t=="number"?t:Number(t);if(!Number.isFinite(i)||i<=0)return{};const n=e.glowOpacity??e.glow_opacity,a=typeof n=="number"?n:Number(n),r=Number.isFinite(a)?Math.max(0,Math.min(1,a)):void 0,s=typeof e.glowColor=="string"?e.glowColor:typeof e.glow_color=="string"?e.glow_color:void 0;return{glow:Math.min(64,i),glowColor:s,glowOpacity:r}},Li=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=Number(e);if(Number.isFinite(t))return t!==0;const i=String(e).trim().toLowerCase();if(i==="true")return!0;if(i==="false")return!1},Zn=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=Number(e);if(Number.isFinite(t))return t!==0;const i=String(e).trim().toLowerCase();if(i==="true")return!0;if(i==="false")return!1},Et=(e,t)=>(e.panes[t]||(e.panes[t]={pane:t,plots:[],overlays:[],levels:[],fills:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],runtimeDrawOps:[]}),e.panes[t]),ht=(e,t,i=NaN)=>{const n=t.toLowerCase();if(!e.seriesMap[n]){const a=new Array(e.len);for(let r=0;r<e.len;r++)a[r]=i;e.seriesMap[n]=a}return e.seriesMap[n]},mt=(e,t,i)=>`${e}_${t}${i?`_${i}`:""}`.toLowerCase(),to=e=>e.startsWith("__js_draw_stub__")||e.startsWith("__js_strategy_stub__"),vs=e=>{const t=String(e||"").toLowerCase().replace(/^shape\./,"").replace(/^label\./,"");if(t){if(t.includes("xcross"))return"xcross";if(t.includes("cross"))return"cross";if(t.includes("diamond"))return"diamond";if(t.includes("star"))return"star";if(t.includes("flag"))return"flag";if(t.includes("tag"))return"tag";if(t.includes("pill"))return"pill";if(t.includes("callout"))return"callout";if(t.includes("bubble"))return"bubble";if(t.includes("spark"))return"spark";if(t.includes("box_gradient"))return"box_gradient";if(t.includes("box"))return"box";if(t.includes("square"))return"square";if(t.includes("circle_pulse"))return"circle_pulse";if(t.includes("circle"))return"circle";if(t.includes("arrow_up_glow"))return"arrow_up_glow";if(t.includes("arrow_down_glow"))return"arrow_down_glow";if(t.includes("arrowup")||t.includes("arrow_up"))return"arrowUp";if(t.includes("arrowdown")||t.includes("arrow_down"))return"arrowDown";if(t.includes("triangle_up_gradient"))return"triangle_up_gradient";if(t.includes("triangle_down_gradient"))return"triangle_down_gradient";if(t.includes("triangle")&&t.includes("down"))return"triangle_down_filled";if(t.includes("triangle")&&t.includes("up"))return"triangle_up_filled";if(t.includes("down"))return"triangle_down_filled";if(t.includes("up"))return"triangle_up_filled";if(t.includes("label"))return"label";if(t.includes("text"))return"text"}},io=(e,t)=>({len:e,indexRef:t,seriesMap:{},panes:{main:{pane:"main",plots:[],overlays:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],runtimeDrawOps:[]},sub:{pane:"sub",plots:[],overlays:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],runtimeDrawOps:[]}},plots:[],labels:[],lines:[],boxes:[],tables:[],polylines:[],polylineMap:new Map,polygons:[],polygonMap:new Map,heatmaps:new Map,heatmapOrder:[],heatmapPointCount:0,overlays:new Map,overlayPointCount:0,signalCounter:0,signalMap:new Map,signals:[],strategyConfig:null,drawOpsThisBar:0,maxDrawOps:Ki.maxDrawOps,maxHeatmapPoints:Ki.maxHeatmapPoints,maxOverlays:Ki.maxOverlays,maxOverlayPoints:Ki.maxOverlayPoints,diagnostics:[],diagSet:new Set,strategyAccessorsUsed:!1,constSeriesCounter:0,cursors:{plot:0,label:0,line:0,box:0,polyline:0,polygon:0,overlay:0}}),no=e=>{e.cursors.plot=0,e.cursors.label=0,e.cursors.line=0,e.cursors.box=0,e.cursors.polyline=0,e.cursors.polygon=0,e.cursors.overlay=0,e.drawOpsThisBar=0},ro=(e,t)=>{const i=()=>(e.drawOpsThisBar+=1,e.drawOpsThisBar<=e.maxDrawOps?!0:(St(e,"js_draw_ops_cap","warning",`JS guardrail: draw op limit exceeded (max ${e.maxDrawOps} per bar)`,"Reduce draw calls or gate them with a condition."),!1)),n=y=>{const c=eo(y==null?void 0:y.offset)??0,M=_n(y==null?void 0:y.xloc),o=(y==null?void 0:y.location)??(y==null?void 0:y.yloc),u=bs(o),P=nt(t.bar_index)+c,F=u==="abovebar"?nt(t.high):u==="belowbar"?nt(t.low):(y==null?void 0:y.price)!=null?nt(y.price):(y==null?void 0:y.y)!=null?nt(y.y):nt(t.close);return{x:P,y:F,xloc:M,yloc:u}},a=(y,c)=>{if(En(y)){const M=y.name.toLowerCase();return e.seriesMap[M]||(e.seriesMap[M]=y.data),M}if(typeof y=="string"){const M=y.replace(/\s+/g,"_").toLowerCase();if(e.seriesMap[M])return M;if(t[M]&&En(t[M])){const u=t[M];return e.seriesMap[M]=u.data,M}const o=Number(y);if(Number.isFinite(o)){const u=mt("__js_const",e.constSeriesCounter++);return ht(e,u,o),u}throw new Error(`fill: unknown series "${y}"`)}if(typeof y=="number"||typeof y=="boolean"){const M=Ir(y),o=mt("__js_const",e.constSeriesCounter++);return ht(e,o,Number.isFinite(M)?M:NaN),o}throw new Error(`fill: ${c} must be a series or number`)},r=(y,c)=>{var P;if(!i())return null;const M=e.cursors.plot++;let o=e.plots[M];if(!o){const F=ri(c==null?void 0:c.pane),Y=mt("__js_plot",M),X=ht(e,Y),B=Xa((c==null?void 0:c.type)??(c==null?void 0:c.style)??"line"),te=ui(c==null?void 0:c.gradient),ie=ui((c==null?void 0:c.upGradient)??(c==null?void 0:c.up_gradient)),ae=ui((c==null?void 0:c.downGradient)??(c==null?void 0:c.down_gradient)),fe={name:String((c==null?void 0:c.title)||(c==null?void 0:c.name)||Y),source:Y,type:B,color:c==null?void 0:c.color,width:(c==null?void 0:c.width)??(c==null?void 0:c.linewidth)??(c==null?void 0:c.lineWidth),style:c==null?void 0:c.style,gradient:te,upGradient:ie,downGradient:ae,layer:c==null?void 0:c.layer,offset:c==null?void 0:c.offset,showLast:c==null?void 0:c.showLast,display:c==null?void 0:c.display,legend:(c==null?void 0:c.legend)??(c==null?void 0:c.showLegend),legendPosition:(c==null?void 0:c.legendPosition)??(c==null?void 0:c.legend_position),legendOffsetX:(c==null?void 0:c.legendOffsetX)??(c==null?void 0:c.legend_offset_x),legendOffsetY:(c==null?void 0:c.legendOffsetY)??(c==null?void 0:c.legend_offset_y),trackPrice:c==null?void 0:c.trackPrice,precision:c==null?void 0:c.precision,baseline:c==null?void 0:c.baseline,downColor:(c==null?void 0:c.downColor)??(c==null?void 0:c.down_color),wickColor:(c==null?void 0:c.wickColor)??(c==null?void 0:c.wick_color),borderColor:(c==null?void 0:c.borderColor)??(c==null?void 0:c.border_color)};o={seriesName:Y,series:X,def:fe,pane:F},e.plots[M]=o,(P=Et(e,F).plots)==null||P.push(fe)}const u=nt(y);return Number.isFinite(u)?(o.series[e.indexRef.value]=u,o.hasFinite=!0):o.series[e.indexRef.value]=void 0,o.ref||(o.ref=ni(o.seriesName,o.series,e.indexRef)),o.ref},s=(y,c)=>{const M=di(y,"plotshape")===1,o=ri(c==null?void 0:c.pane),{x:u,y:P,xloc:F,yloc:Y}=n(c),X=c==null?void 0:c.text,B=X==null?void 0:String(X),te=(c==null?void 0:c.style)??(c==null?void 0:c.shape),ie=vs(te),ae=B!=null&&B.length>0,fe=ie??(ae?"callout":"triangle_up_filled"),ee=(c==null?void 0:c.textcolor)??(c==null?void 0:c.textColor)??(ae?"#f8fafc":c==null?void 0:c.color),ue=(c==null?void 0:c.offsetY)??(c==null?void 0:c.offset_y),De=typeof ue=="number"?ue:Number.isFinite(Number(ue))?Number(ue):Y==="abovebar"||Y==="belowbar"?12:void 0;v.new(u,P,B,{pane:o,when:M?1:0,style:te,shape:fe,color:c==null?void 0:c.color,bgcolor:(c==null?void 0:c.bgcolor)??(c==null?void 0:c.bgColor),bgGradient:(c==null?void 0:c.bgGradient)??(c==null?void 0:c.bg_gradient)??(c==null?void 0:c.gradient),textcolor:ee,size:Er(c==null?void 0:c.size),offsetY:De,xloc:F,yloc:Y,textalign:c==null?void 0:c.textalign,tooltip:c==null?void 0:c.tooltip,avoidOverlap:(c==null?void 0:c.avoidOverlap)??(c==null?void 0:c.avoid_overlap),collision:c==null?void 0:c.collision,layer:c==null?void 0:c.layer,zIndex:(c==null?void 0:c.zIndex)??(c==null?void 0:c.zindex),callout:fe==="callout",includeInAutoscale:Li((c==null?void 0:c.includeInAutoscale)??(c==null?void 0:c.include_in_autoscale)??(c==null?void 0:c.autoscale))})},f=(y,c)=>{const M=di(y,"plotchar")===1,o=ri(c==null?void 0:c.pane),u=(c==null?void 0:c.char)!=null?String(c.char):"",{x:P,y:F,xloc:Y,yloc:X}=n(c);v.new(P,F,u,{pane:o,when:M?1:0,style:"text",color:(c==null?void 0:c.color)??(c==null?void 0:c.textcolor)??(c==null?void 0:c.textColor),textcolor:(c==null?void 0:c.textcolor)??(c==null?void 0:c.textColor)??(c==null?void 0:c.color),size:Er(c==null?void 0:c.size),xloc:Y,yloc:X,textalign:c==null?void 0:c.textalign,tooltip:c==null?void 0:c.tooltip,avoidOverlap:(c==null?void 0:c.avoidOverlap)??(c==null?void 0:c.avoid_overlap),collision:c==null?void 0:c.collision,layer:c==null?void 0:c.layer,zIndex:(c==null?void 0:c.zIndex)??(c==null?void 0:c.zindex),includeInAutoscale:Li((c==null?void 0:c.includeInAutoscale)??(c==null?void 0:c.include_in_autoscale)??(c==null?void 0:c.autoscale))})},h=(y,c,M,o,u,P)=>{var Ye;if(!i())return null;let F;bi(P)&&(F=P),bi(c)&&M==null&&o==null&&u==null&&(F=c,c=t.open,M=t.high,o=t.low,u=t.close);const Y=c??t.open,X=M??t.high,B=o??t.low,te=u??t.close,ie=e.cursors.plot++;let ae=e.plots[ie];if(!ae){const Ae=ri(F==null?void 0:F.pane),ft=mt("__js_plot",ie),pt=ht(e,ft),qt=mt("__js_plot",ie,"open"),Ut=mt("__js_plot",ie,"high"),qe=mt("__js_plot",ie,"low"),Lt=ht(e,qt),wt=ht(e,Ut),at=ht(e,qe),Pe=ui(F==null?void 0:F.gradient),jt=ui((F==null?void 0:F.upGradient)??(F==null?void 0:F.up_gradient))??Pe,Ke=ui((F==null?void 0:F.downGradient)??(F==null?void 0:F.down_gradient))??Pe,je={name:String((F==null?void 0:F.title)||(F==null?void 0:F.name)||ft),source:ft,type:y,color:F==null?void 0:F.color,downColor:(F==null?void 0:F.downColor)??(F==null?void 0:F.down_color),wickColor:(F==null?void 0:F.wickColor)??(F==null?void 0:F.wick_color),borderColor:(F==null?void 0:F.borderColor)??(F==null?void 0:F.border_color),gradient:Pe,upGradient:jt,downGradient:Ke,open:qt,high:Ut,low:qe,close:ft,offset:F==null?void 0:F.offset,showLast:F==null?void 0:F.showLast,display:F==null?void 0:F.display,legend:(F==null?void 0:F.legend)??(F==null?void 0:F.showLegend),legendPosition:(F==null?void 0:F.legendPosition)??(F==null?void 0:F.legend_position),legendOffsetX:(F==null?void 0:F.legendOffsetX)??(F==null?void 0:F.legend_offset_x),legendOffsetY:(F==null?void 0:F.legendOffsetY)??(F==null?void 0:F.legend_offset_y),layer:F==null?void 0:F.layer};ae={seriesName:ft,series:pt,def:je,pane:Ae,ohlc:{openName:qt,openSeries:Lt,highName:Ut,highSeries:wt,lowName:qe,lowSeries:at,closeName:ft,closeSeries:pt}},e.plots[ie]=ae,(Ye=Et(e,Ae).plots)==null||Ye.push(je)}const fe=e.indexRef.value,ee=nt(Y),ue=nt(X),De=nt(B),Ge=nt(te);return ae.series[fe]=Ge,Number.isFinite(Ge)&&(ae.hasFinite=!0),(Number.isFinite(ee)||Number.isFinite(ue)||Number.isFinite(De)||Number.isFinite(Ge))&&(ae.hasOhlcFinite=!0),ae.ohlc&&(ae.ohlc.openSeries[fe]=ee,ae.ohlc.highSeries[fe]=ue,ae.ohlc.lowSeries[fe]=De,ae.ohlc.closeSeries[fe]=Ge),ae.ref||(ae.ref=ni(ae.seriesName,ae.series,e.indexRef)),ae.ref},p=(y,c,M,o,u)=>h("candles",y,c,M,o,u),_=(y,c,M,o,u)=>h("ohlc",y,c,M,o,u),E=(y,c,M,o,u)=>h("ohlc",y,c,M,o,u),z=(y,c)=>{var P;const M=ri(c==null?void 0:c.pane),o=nt(y);if(!Number.isFinite(o))return;const u={name:String((c==null?void 0:c.title)||(c==null?void 0:c.name)||""),value:o,color:c==null?void 0:c.color,width:(c==null?void 0:c.width)??(c==null?void 0:c.linewidth)??(c==null?void 0:c.lineWidth),style:c==null?void 0:c.style};Et(e,M).levels=Et(e,M).levels||[],(P=Et(e,M).levels)==null||P.push(u)},C=(y,c,M)=>{var X;const o=ri(M==null?void 0:M.pane),u=a(y,"a"),P=a(c,"b"),F=ui((M==null?void 0:M.fillGradient)??(M==null?void 0:M.fill_gradient)??(M==null?void 0:M.gradient)),Y={between:[u,P],color:(M==null?void 0:M.color)??(M==null?void 0:M.bgcolor)??(M==null?void 0:M.fillColor)??(M==null?void 0:M.fill_color),fillGradient:F};Et(e,o).fills=Et(e,o).fills||[],(X=Et(e,o).fills)==null||X.push(Y)},v={new:(y,c,M,o)=>{var Y;if(!i())return;const u=e.cursors.label++;let P=e.labels[u];if(!P){const X=ri(o==null?void 0:o.pane),B=mt("__js_label",u,"when"),te=mt("__js_label",u,"x"),ie=mt("__js_label",u,"y"),ae=ht(e,B,0),fe=ht(e,te),ee=ht(e,ie),ue=M!=null&&typeof M!="string"?mt("__js_label",u,"text"):void 0,De=ue?ht(e,ue):void 0,Ge={x:te,y:ie,whenExpr:B,text:typeof M=="string"?M:void 0,textExpr:ue,color:o==null?void 0:o.color,textColor:(o==null?void 0:o.textcolor)??(o==null?void 0:o.textColor),shape:vs((o==null?void 0:o.style)||(o==null?void 0:o.shape)),callout:o==null?void 0:o.callout,size:Er(o==null?void 0:o.size),offsetY:typeof(o==null?void 0:o.offsetY)=="number"?o.offsetY:Number.isFinite(Number((o==null?void 0:o.offsetY)??(o==null?void 0:o.offset_y)))?Number((o==null?void 0:o.offsetY)??(o==null?void 0:o.offset_y)):void 0,wrap:o==null?void 0:o.wrap,maxWidth:(o==null?void 0:o.maxWidth)??(o==null?void 0:o.max_width),padding:Za(o==null?void 0:o.padding),bgColor:(o==null?void 0:o.bgcolor)??(o==null?void 0:o.bgColor),bgGradient:ui((o==null?void 0:o.bgGradient)??(o==null?void 0:o.bg_gradient)??(o==null?void 0:o.gradient)),bgOpacity:(o==null?void 0:o.bgOpacity)??(o==null?void 0:o.bg_opacity)??(o==null?void 0:o.opacity),borderColor:(o==null?void 0:o.bordercolor)??(o==null?void 0:o.borderColor),borderWidth:(o==null?void 0:o.borderwidth)??(o==null?void 0:o.borderWidth),radius:o==null?void 0:o.radius,align:Mn(o==null?void 0:o.align),valign:Xn(o==null?void 0:o.valign),lineHeight:(o==null?void 0:o.lineHeight)??(o==null?void 0:o.line_height),fontFamily:(o==null?void 0:o.fontFamily)??(o==null?void 0:o.font_family),fontSize:(o==null?void 0:o.fontSize)??(o==null?void 0:o.font_size),fontWeight:(o==null?void 0:o.fontWeight)??(o==null?void 0:o.font_weight),monospace:o==null?void 0:o.monospace,avoidOverlap:(o==null?void 0:o.avoidOverlap)??(o==null?void 0:o.avoid_overlap),collision:o==null?void 0:o.collision,xloc:_n(o==null?void 0:o.xloc),yloc:bs(o==null?void 0:o.yloc),textAlign:Mn((o==null?void 0:o.textalign)??(o==null?void 0:o.textAlign)),tooltip:o==null?void 0:o.tooltip,layer:o==null?void 0:o.layer,zIndex:(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),includeInAutoscale:Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale))};P={whenName:B,whenSeries:ae,xName:te,xSeries:fe,yName:ie,ySeries:ee,textName:ue,textSeries:De,def:Ge,pane:X},e.labels[u]=P,(Y=Et(e,X).runtimeLabels)==null||Y.push(Ge)}const F=e.indexRef.value;P.whenSeries[F]=(o==null?void 0:o.when)!=null?di(o.when,"label"):1,P.xSeries[F]=nt(y),P.ySeries[F]=nt(c),P.textSeries&&M!=null&&(P.textSeries[F]=nt(M))}},S={new:(y,c,M,o,u)=>{var X;if(!i())return;const P=e.cursors.line++;let F=e.lines[P];if(!F){const B=ri(u==null?void 0:u.pane),te=mt("__js_line",P,"when"),ie=mt("__js_line",P,"x1"),ae=mt("__js_line",P,"y1"),fe=mt("__js_line",P,"x2"),ee=mt("__js_line",P,"y2"),ue=ht(e,te,0),De=ht(e,ie),Ge=ht(e,ae),Ye=ht(e,fe),Ae=ht(e,ee),{glow:ft,glowColor:pt,glowOpacity:qt}=vn(u),Ut=ui((u==null?void 0:u.gradient)??(u==null?void 0:u.strokeGradient)??(u==null?void 0:u.stroke_gradient)),qe={x1:ie,y1:ae,x2:fe,y2:ee,whenExpr:te,color:u==null?void 0:u.color,gradient:Ut,width:(u==null?void 0:u.width)??(u==null?void 0:u.linewidth)??(u==null?void 0:u.lineWidth),glow:ft,glowColor:pt,glowOpacity:qt,style:u==null?void 0:u.style,extend:u==null?void 0:u.extend,xloc:_n(u==null?void 0:u.xloc),layer:u==null?void 0:u.layer,zIndex:(u==null?void 0:u.zIndex)??(u==null?void 0:u.zindex),includeInAutoscale:Li((u==null?void 0:u.includeInAutoscale)??(u==null?void 0:u.include_in_autoscale)??(u==null?void 0:u.autoscale))};F={whenName:te,whenSeries:ue,x1Name:ie,x1Series:De,y1Name:ae,y1Series:Ge,x2Name:fe,x2Series:Ye,y2Name:ee,y2Series:Ae,def:qe,pane:B},e.lines[P]=F,(X=Et(e,B).runtimeLines)==null||X.push(qe)}const Y=e.indexRef.value;F.whenSeries[Y]=(u==null?void 0:u.when)!=null?di(u.when,"line"):1,F.x1Series[Y]=nt(y),F.y1Series[Y]=nt(c),F.x2Series[Y]=nt(M),F.y2Series[Y]=nt(o)}},U={new:(y,c,M,o,u)=>{var X;if(!i())return;const P=e.cursors.box++;let F=e.boxes[P];if(!F){const B=ri(u==null?void 0:u.pane),te=mt("__js_box",P,"when"),ie=mt("__js_box",P,"left"),ae=mt("__js_box",P,"right"),fe=mt("__js_box",P,"top"),ee=mt("__js_box",P,"bottom"),ue=ht(e,te,0),De=ht(e,ie),Ge=ht(e,ae),Ye=ht(e,fe),Ae=ht(e,ee),ft={left:ie,right:ae,top:fe,bottom:ee,whenExpr:te,borderColor:(u==null?void 0:u.border_color)??(u==null?void 0:u.borderColor),bgColor:(u==null?void 0:u.bgcolor)??(u==null?void 0:u.bgColor),bgGradient:ui((u==null?void 0:u.bgGradient)??(u==null?void 0:u.bg_gradient)??(u==null?void 0:u.gradient)),borderWidth:(u==null?void 0:u.border_width)??(u==null?void 0:u.borderWidth),borderStyle:(u==null?void 0:u.border_style)??(u==null?void 0:u.borderStyle),text:u==null?void 0:u.text,textColor:(u==null?void 0:u.text_color)??(u==null?void 0:u.textColor),textSize:(u==null?void 0:u.text_size)??(u==null?void 0:u.textSize),textHalign:Mn((u==null?void 0:u.text_halign)??(u==null?void 0:u.textHalign)),textValign:Xn((u==null?void 0:u.text_valign)??(u==null?void 0:u.textValign)),textWrap:(u==null?void 0:u.text_wrap)??(u==null?void 0:u.textWrap),tooltip:u==null?void 0:u.tooltip,extend:u==null?void 0:u.extend,xloc:_n(u==null?void 0:u.xloc),layer:u==null?void 0:u.layer,zIndex:(u==null?void 0:u.zIndex)??(u==null?void 0:u.zindex),includeInAutoscale:Li((u==null?void 0:u.includeInAutoscale)??(u==null?void 0:u.include_in_autoscale)??(u==null?void 0:u.autoscale))};F={whenName:te,whenSeries:ue,leftName:ie,leftSeries:De,rightName:ae,rightSeries:Ge,topName:fe,topSeries:Ye,bottomName:ee,bottomSeries:Ae,def:ft,pane:B},e.boxes[P]=F,(X=Et(e,B).runtimeBoxes)==null||X.push(ft)}const Y=e.indexRef.value;F.whenSeries[Y]=(u==null?void 0:u.when)!=null?di(u.when,"box"):1,F.leftSeries[Y]=nt(y),F.rightSeries[Y]=nt(M),F.topSeries[Y]=nt(c),F.bottomSeries[Y]=nt(o)}},V={new:(...y)=>{if(!i())return null;const c=e.cursors.polygon++,M=y.length&&bi(y[y.length-1]),o=M?y[y.length-1]:{},u=M?y.slice(0,-1):y;let P=[];if(u.length===1&&Array.isArray(u[0]))P=u[0].map(B=>Array.isArray(B)&&B.length>=2?{x:B[0],y:B[1]}:B&&typeof B=="object"&&"x"in B&&"y"in B?{x:B.x,y:B.y}:null).filter(Boolean);else for(let X=0;X+1<u.length;X+=2)P.push({x:u[X],y:u[X+1]});if(P.length<3)return St(e,"js_polygon_points_min","error","polygon.new requires at least 3 points (x,y pairs)","Provide at least 3 point pairs: x1,y1,x2,y2,x3,y3."),null;let F=e.polygons[c];if(!F){const X=ri(o==null?void 0:o.pane),B=mt("__js_polygon",c,"when"),te=ht(e,B,0),ie=mt("__js_polygon",c,"delete"),ae=ht(e,ie,0),fe=P.map((Tt,gt)=>{const Ze=mt(`__js_polygon_${c}_p${gt}`,0,"x"),Rt=mt(`__js_polygon_${c}_p${gt}`,0,"y");return{xName:Ze,xSeries:ht(e,Ze),yName:Rt,ySeries:ht(e,Rt)}}),ee=`js_polygon_${c}`,ue=_n(o==null?void 0:o.xloc),De=xs(o==null?void 0:o.yloc),Ge=fe.map(Tt=>({x:Tt.xName,y:Tt.yName,xloc:ue,yloc:De})),Ye=(o==null?void 0:o.fillColor)??(o==null?void 0:o.fill_color)??(o==null?void 0:o.bgcolor)??(o==null?void 0:o.bgColor)??(o==null?void 0:o.color),Ae=ui((o==null?void 0:o.fillGradient)??(o==null?void 0:o.fill_gradient)??(o==null?void 0:o.gradient))??void 0,ft=(o==null?void 0:o.strokeColor)??(o==null?void 0:o.stroke_color)??(o==null?void 0:o.borderColor)??(o==null?void 0:o.border_color),pt=(o==null?void 0:o.strokeWidth)??(o==null?void 0:o.stroke_width)??(o==null?void 0:o.borderWidth)??(o==null?void 0:o.border_width),qt=(o==null?void 0:o.strokeStyle)??(o==null?void 0:o.stroke_style)??(o==null?void 0:o.borderStyle)??(o==null?void 0:o.border_style),{glow:Ut,glowColor:qe,glowOpacity:Lt}=vn(o),wt=Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale)),at=(o==null?void 0:o.groupId)??(o==null?void 0:o.group_id)??(o==null?void 0:o.group),Pe=_s((o==null?void 0:o.tags)??(o==null?void 0:o.tag)),jt=o==null?void 0:o.layer,Ke=(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),je={whenExpr:B,points:Ge,fillColor:Ye,fillGradient:Ae,strokeColor:ft,strokeWidth:pt,strokeStyle:qt,opacity:o==null?void 0:o.opacity,glow:Ut,glowColor:qe,glowOpacity:Lt,xloc:ue,yloc:De,layer:jt,zIndex:Ke,includeInAutoscale:wt,groupId:at,tags:Pe,pane:X},ot={kind:"polygon_new",assign:ee,once:!0,...je},Vt={kind:"polygon_set",target:ee,...je},$t={kind:"polygon_delete",target:ee,whenExpr:ie,pane:X};F={id:ee,whenName:B,whenSeries:te,deleteWhenName:ie,deleteWhenSeries:ae,points:fe,newOp:ot,setOp:Vt,deleteOp:$t,pane:X},e.polygons[c]=F,e.polygonMap.set(ee,F);const Nt=Et(e,X);Nt.runtimeDrawOps=Nt.runtimeDrawOps||[],Nt.runtimeDrawOps.push(ot,Vt,$t)}if(F.points.length!==P.length)return St(e,"js_polygon_points_len","error","polygon.new point count must stay consistent for a handle","Reuse the same number of points for the same polygon handle."),{id:F.id,kind:"polygon"};const Y=e.indexRef.value;if(F.whenSeries[Y]=(o==null?void 0:o.when)!=null?di(o.when,"polygon"):1,P.forEach((X,B)=>{const te=F.points[B];te.xSeries[Y]=nt(X.x),te.ySeries[Y]=nt(X.y)}),o){const X=o.fillColor??o.fill_color??o.bgcolor??o.bgColor??o.color,B=ui(o.fillGradient??o.fill_gradient??o.gradient)??void 0,te=o.strokeColor??o.stroke_color??o.borderColor??o.border_color,ie=o.strokeWidth??o.stroke_width??o.borderWidth??o.border_width,ae=o.strokeStyle??o.stroke_style??o.borderStyle??o.border_style;X!=null&&(F.setOp.fillColor=X),B&&(F.setOp.fillGradient=B),te!=null&&(F.setOp.strokeColor=te),ie!=null&&(F.setOp.strokeWidth=ie),ae!=null&&(F.setOp.strokeStyle=ae),o.opacity!=null&&(F.setOp.opacity=o.opacity);const{glow:fe,glowColor:ee,glowOpacity:ue}=vn(o);fe!=null&&(F.setOp.glow=fe),ee&&(F.setOp.glowColor=ee),ue!=null&&(F.setOp.glowOpacity=ue)}return{id:F.id,kind:"polygon"}},set_points:(y,...c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polygonMap.get(M):void 0;if(!o){St(e,"js_polygon_handle","error","polygon.set_points requires a valid handle returned by polygon.new","Store the handle returned by polygon.new and pass it to set_points.");return}const u=c.length&&bi(c[c.length-1]),P=u?c[c.length-1]:{},F=u?c.slice(0,-1):c,Y=[];if(F.length===1&&Array.isArray(F[0]))F[0].forEach(te=>{Array.isArray(te)&&te.length>=2?Y.push({x:te[0],y:te[1]}):te&&typeof te=="object"&&"x"in te&&"y"in te&&Y.push({x:te.x,y:te.y})});else for(let B=0;B+1<F.length;B+=2)Y.push({x:F[B],y:F[B+1]});if(Y.length!==o.points.length){St(e,"js_polygon_points_len_set","error","polygon.set_points must use the same number of points as polygon.new","Match the original point count used by polygon.new.");return}const X=e.indexRef.value;if(o.whenSeries[X]=(P==null?void 0:P.when)!=null?di(P.when,"polygon"):1,Y.forEach((B,te)=>{const ie=o.points[te];ie.xSeries[X]=nt(B.x),ie.ySeries[X]=nt(B.y)}),P){const B=P.fillColor??P.fill_color??P.bgcolor??P.bgColor??P.color,te=ui(P.fillGradient??P.fill_gradient??P.gradient)??void 0,ie=P.strokeColor??P.stroke_color??P.borderColor??P.border_color,ae=P.strokeWidth??P.stroke_width??P.borderWidth??P.border_width,fe=P.strokeStyle??P.stroke_style??P.borderStyle??P.border_style;B!=null&&(o.setOp.fillColor=B),te&&(o.setOp.fillGradient=te),ie!=null&&(o.setOp.strokeColor=ie),ae!=null&&(o.setOp.strokeWidth=ae),fe!=null&&(o.setOp.strokeStyle=fe),P.opacity!=null&&(o.setOp.opacity=P.opacity);const{glow:ee,glowColor:ue,glowOpacity:De}=vn(P);ee!=null&&(o.setOp.glow=ee),ue&&(o.setOp.glowColor=ue),De!=null&&(o.setOp.glowOpacity=De)}},delete:(y,c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polygonMap.get(M):void 0;if(!o){St(e,"js_polygon_handle_delete","error","polygon.delete requires a valid handle returned by polygon.new","Store the handle returned by polygon.new and pass it to delete.");return}const u=e.indexRef.value,P=(c==null?void 0:c.when)!=null?di(c.when,"polygon.delete"):1;o.deleteWhenSeries[u]=P}},ne={new:(...y)=>{if(!i())return null;const c=e.cursors.polyline++,M=y.length&&bi(y[y.length-1]),o=M?y[y.length-1]:{},u=M?y.slice(0,-1):y;let P=[];if(u.length===1&&Array.isArray(u[0]))P=u[0].map(B=>Array.isArray(B)&&B.length>=2?{x:B[0],y:B[1]}:B&&typeof B=="object"&&"x"in B&&"y"in B?{x:B.x,y:B.y}:null).filter(Boolean);else for(let X=0;X+1<u.length;X+=2)P.push({x:u[X],y:u[X+1]});if(P.length<2)return St(e,"js_polyline_points_min","error","polyline.new requires at least 2 points (x,y pairs)","Provide at least 2 point pairs: x1,y1,x2,y2."),null;let F=e.polylines[c];if(!F){const X=ri(o==null?void 0:o.pane),B=mt("__js_polyline",c,"when"),te=ht(e,B,0),ie=mt("__js_polyline",c,"delete"),ae=ht(e,ie,0),fe=P.map((Nt,Tt)=>{const gt=mt(`__js_polyline_${c}_p${Tt}`,0,"x"),Ze=mt(`__js_polyline_${c}_p${Tt}`,0,"y");return{xName:gt,xSeries:ht(e,gt),yName:Ze,ySeries:ht(e,Ze)}}),ee=`js_polyline_${c}`,ue=_n(o==null?void 0:o.xloc),De=xs(o==null?void 0:o.yloc),Ge=fe.map(Nt=>({x:Nt.xName,y:Nt.yName,xloc:ue,yloc:De})),Ye=(o==null?void 0:o.color)??(o==null?void 0:o.strokeColor)??(o==null?void 0:o.stroke_color),Ae=ui((o==null?void 0:o.gradient)??(o==null?void 0:o.strokeGradient)??(o==null?void 0:o.stroke_gradient)),ft=(o==null?void 0:o.width)??(o==null?void 0:o.linewidth)??(o==null?void 0:o.lineWidth),pt=(o==null?void 0:o.style)??(o==null?void 0:o.lineStyle)??(o==null?void 0:o.line_style),{glow:qt,glowColor:Ut,glowOpacity:qe}=vn(o),Lt=Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale)),wt=(o==null?void 0:o.groupId)??(o==null?void 0:o.group_id)??(o==null?void 0:o.group),at=_s((o==null?void 0:o.tags)??(o==null?void 0:o.tag)),Pe=o==null?void 0:o.layer,jt=(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),Ke={whenExpr:B,points:Ge,color:Ye,gradient:Ae,width:ft,style:pt,opacity:o==null?void 0:o.opacity,glow:qt,glowColor:Ut,glowOpacity:qe,xloc:ue,yloc:De,layer:Pe,zIndex:jt,includeInAutoscale:Lt,groupId:wt,tags:at,pane:X},je={kind:"polyline_new",assign:ee,once:!0,...Ke},ot={kind:"polyline_set",target:ee,...Ke},Vt={kind:"polyline_delete",target:ee,whenExpr:ie,pane:X};F={id:ee,whenName:B,whenSeries:te,deleteWhenName:ie,deleteWhenSeries:ae,points:fe,newOp:je,setOp:ot,deleteOp:Vt,pane:X},e.polylines[c]=F,e.polylineMap.set(ee,F);const $t=Et(e,X);$t.runtimeDrawOps=$t.runtimeDrawOps||[],$t.runtimeDrawOps.push(je,ot,Vt)}if(F.points.length!==P.length)return St(e,"js_polyline_points_len","error","polyline.new point count must stay consistent for a handle","Reuse the same number of points for the same polyline handle."),{id:F.id,kind:"polyline"};const Y=e.indexRef.value;return F.whenSeries[Y]=(o==null?void 0:o.when)!=null?di(o.when,"polyline"):1,P.forEach((X,B)=>{const te=F.points[B];te.xSeries[Y]=nt(X.x),te.ySeries[Y]=nt(X.y)}),{id:F.id,kind:"polyline"}},set_points:(y,...c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polylineMap.get(M):void 0;if(!o){St(e,"js_polyline_handle","error","polyline.set_points requires a valid handle returned by polyline.new","Store the handle returned by polyline.new and pass it to set_points.");return}const u=c.length&&bi(c[c.length-1]),P=u?c[c.length-1]:{},F=u?c.slice(0,-1):c,Y=[];if(F.length===1&&Array.isArray(F[0]))F[0].forEach(te=>{Array.isArray(te)&&te.length>=2?Y.push({x:te[0],y:te[1]}):te&&typeof te=="object"&&"x"in te&&"y"in te&&Y.push({x:te.x,y:te.y})});else for(let B=0;B+1<F.length;B+=2)Y.push({x:F[B],y:F[B+1]});if(Y.length!==o.points.length){St(e,"js_polyline_points_len_set","error","polyline.set_points must use the same number of points as polyline.new","Match the original point count used by polyline.new.");return}const X=e.indexRef.value;if(o.whenSeries[X]=(P==null?void 0:P.when)!=null?di(P.when,"polyline"):1,Y.forEach((B,te)=>{const ie=o.points[te];ie.xSeries[X]=nt(B.x),ie.ySeries[X]=nt(B.y)}),P){const B=(P==null?void 0:P.color)??(P==null?void 0:P.strokeColor)??(P==null?void 0:P.stroke_color),te=ui((P==null?void 0:P.gradient)??(P==null?void 0:P.strokeGradient)??(P==null?void 0:P.stroke_gradient)),ie=(P==null?void 0:P.width)??(P==null?void 0:P.linewidth)??(P==null?void 0:P.lineWidth),ae=(P==null?void 0:P.style)??(P==null?void 0:P.lineStyle)??(P==null?void 0:P.line_style);B!=null&&(o.setOp.color=B),te&&(o.setOp.gradient=te),ie!=null&&(o.setOp.width=ie),ae!=null&&(o.setOp.style=ae),P.opacity!=null&&(o.setOp.opacity=P.opacity);const{glow:fe,glowColor:ee,glowOpacity:ue}=vn(P);fe!=null&&(o.setOp.glow=fe),ee&&(o.setOp.glowColor=ee),ue!=null&&(o.setOp.glowOpacity=ue)}},delete:(y,c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polylineMap.get(M):void 0;if(!o){St(e,"js_polyline_handle_delete","error","polyline.delete requires a valid handle returned by polyline.new","Store the handle returned by polyline.new and pass it to delete.");return}const u=e.indexRef.value,P=(c==null?void 0:c.when)!=null?di(c.when,"polyline.delete"):1;o.deleteWhenSeries[u]=P}},he=(y,c)=>{const M=String(y??"").trim();return M?M.replace(/\s+/g,"_").toLowerCase():c},me=y=>{if(!y)return null;const c=ie=>{const ae=typeof ie=="number"?ie:Number(ie);return Number.isFinite(ae)?ae:void 0};if(Array.isArray(y)&&y.length>=2){const ie=c(y[0]),ae=c(y[1]),fe={};return ie!=null&&(fe.index=ie),ae!=null&&(fe.value=ae),Object.keys(fe).length?fe:null}if(!bi(y))return null;const M=y,o={};if("x"in M||"y"in M){const ie=c(M.x),ae=c(M.y);return ie!=null&&(o.index=ie),ae!=null&&(o.value=ae),Object.keys(o).length?o:null}const u=c(M.index),P=c(M.timestamp),F=c(M.value);u!=null&&(o.index=u),P!=null&&(o.timestamp=P),F!=null&&(o.value=F),M.source!=null&&(o.source=String(M.source)),M.pivot!=null&&(o.pivot=String(M.pivot)),M.extreme!=null&&(o.extreme=String(M.extreme));const Y=c(M.left),X=c(M.right),B=c(M.lookback),te=c(M.which);return Y!=null&&(o.left=Y),X!=null&&(o.right=X),B!=null&&(o.lookback=B),te!=null&&(o.which=te),Object.keys(o).length?o:null},be=y=>{if(!y)return[];if(Array.isArray(y)&&y.length&&typeof y[0]=="number"){const o=[];for(let u=0;u+1<y.length;u+=2){const P=me([y[u],y[u+1]]);P&&o.push(P)}return o}const c=Array.isArray(y)?y:[y],M=[];return c.forEach(o=>{const u=me(o);u&&M.push(u)}),M},ve=y=>{if(!y)return null;if(typeof y=="object"&&y.__overlay){const M=String(y.id||"").trim().toLowerCase();return M?e.overlays.get(M)??null:null}const c=String(y||"").trim().toLowerCase();return c?e.overlays.get(c)??null:null},Te={new:(y,c,M)=>{if(!i())return null;const o=e.cursors.overlay++,u=bi(y)?y:{...bi(M)?M:{},name:y,points:c},P=String((u==null?void 0:u.name)||"").trim();if(!P)return St(e,"js_overlay_name","error","overlay.new requires a valid overlay name","Provide a registered overlay name like 'rect' or 'triangle'."),null;const F=he(u==null?void 0:u.id,`js_overlay_${o}`),Y=ri(u==null?void 0:u.pane);let X=be(u==null?void 0:u.points);if(!X.length)return St(e,"js_overlay_points_min","error","overlay.new requires at least 1 point","Provide points as { index, value } or [index, value] pairs."),null;let B=e.overlays.get(F);if(!B&&e.maxOverlays>0&&e.overlays.size>=e.maxOverlays)return St(e,"js_overlay_limit","warning",`JS guardrail: overlay limit exceeded (max ${e.maxOverlays})`,"Reuse overlay handles or reduce overlay count."),{__overlay:!0,id:F};const ie=(B==null?void 0:B.pointCount)??0,ae=e.maxOverlayPoints>0?e.maxOverlayPoints-(e.overlayPointCount-ie):X.length;e.maxOverlayPoints>0&&X.length>ae&&(St(e,"js_overlay_points_cap","warning",`JS guardrail: overlay points capped (max ${e.maxOverlayPoints})`,"Reduce overlay point count or split overlays."),X=X.slice(0,Math.max(0,ae)));const fe=bi(u==null?void 0:u.styles)?u.styles:void 0,ee=bi(u==null?void 0:u.extendData)?u.extendData:void 0,ue=Zn(u==null?void 0:u.lock),De=Zn(u==null?void 0:u.visible);if(B){if(B.pane!==Y){const Ye=Et(e,B.pane).overlays||[],Ae=Ye.findIndex(pt=>(pt==null?void 0:pt.id)===F);Ae>=0&&Ye.splice(Ae,1);const ft=Et(e,Y);ft.overlays=ft.overlays||[],ft.overlays.push(B.spec),B.pane=Y,B.spec.pane=Y}B.spec.name=P,B.spec.points=X,fe!=null&&(B.spec.styles=fe),ee!=null&&(B.spec.extendData=ee),ue!=null&&(B.spec.lock=ue),De!=null&&(B.spec.visible=De),e.overlayPointCount=e.overlayPointCount-ie+X.length,B.pointCount=X.length}else{const Ge=Et(e,Y);Ge.overlays=Ge.overlays||[];const Ye={id:F,name:P,pane:Y,points:X,styles:fe,extendData:ee,lock:ue,visible:De};Ge.overlays.push(Ye),B={id:F,pane:Y,spec:Ye,pointCount:X.length},e.overlays.set(F,B),e.overlayPointCount+=X.length}return{__overlay:!0,id:F}},set:(y,c)=>{if(!y||!c)return;const M=ve(y);if(!M){St(e,"js_overlay_handle","error","overlay.set requires a valid handle returned by overlay.new","Store the handle returned by overlay.new and pass it to set.");return}if(!i())return;if(c.name!=null&&(M.spec.name=String(c.name)),c.pane!=null){const P=ri(c.pane);if(P!==M.pane){const Y=Et(e,M.pane).overlays||[],X=Y.findIndex(te=>(te==null?void 0:te.id)===M.id);X>=0&&Y.splice(X,1);const B=Et(e,P);B.overlays=B.overlays||[],B.overlays.push(M.spec),M.pane=P,M.spec.pane=P}}if(c.points!=null){let P=be(c.points);const F=M.pointCount,Y=e.maxOverlayPoints>0?e.maxOverlayPoints-(e.overlayPointCount-F):P.length;e.maxOverlayPoints>0&&P.length>Y&&(St(e,"js_overlay_points_cap","warning",`JS guardrail: overlay points capped (max ${e.maxOverlayPoints})`,"Reduce overlay point count or split overlays."),P=P.slice(0,Math.max(0,Y))),M.spec.points=P,e.overlayPointCount=e.overlayPointCount-F+P.length,M.pointCount=P.length}c.styles!=null&&bi(c.styles)&&(M.spec.styles=c.styles),c.extendData!=null&&bi(c.extendData)&&(M.spec.extendData=c.extendData);const o=Zn(c.lock),u=Zn(c.visible);o!=null&&(M.spec.lock=o),u!=null&&(M.spec.visible=u)},set_points:(y,c)=>{Te.set(y,{points:c})},delete:y=>{const c=ve(y);if(!c){St(e,"js_overlay_handle_delete","error","overlay.delete requires a valid handle returned by overlay.new","Store the handle returned by overlay.new and pass it to delete.");return}const o=Et(e,c.pane).overlays||[],u=o.findIndex(P=>(P==null?void 0:P.id)===c.id);u>=0&&o.splice(u,1),e.overlays.delete(c.id),e.overlayPointCount=Math.max(0,e.overlayPointCount-c.pointCount)}},Ie=(y,c)=>{const M=String(y??"").trim();return M?M.replace(/\s+/g,"_").toLowerCase():c},we=y=>{if(!y)return null;if(typeof y=="object"&&y.__heatmap){const M=String(y.id||"").trim().toLowerCase();return M?e.heatmaps.get(M)??null:null}const c=String(y||"").trim().toLowerCase();return c?e.heatmaps.get(c)??null:null},ze=()=>i()?e.heatmapPointCount<e.maxHeatmapPoints?!0:(St(e,"js_heatmap_points_cap","warning",`JS guardrail: heatmap point limit exceeded (max ${e.maxHeatmapPoints})`,"Reduce heatmap points or bin inside the script."),!1):!1,Ce={new:y=>{var Y;if(!i())return null;const c=ri(y==null?void 0:y.pane),M=`heatmap_${e.heatmaps.size+1}`,o=Ie((y==null?void 0:y.id)??(y==null?void 0:y.name),M),u=e.heatmaps.get(o);if(u)return{__heatmap:!0,id:u.id};const P={id:o,points:[],xloc:(y==null?void 0:y.xloc)??"bar_index",yloc:(y==null?void 0:y.yloc)??"price",opacity:y==null?void 0:y.opacity,colormap:(y==null?void 0:y.colormap)??(y==null?void 0:y.colors),blend:y==null?void 0:y.blend,xBinPx:(y==null?void 0:y.xBinPx)??(y==null?void 0:y.xBin),yBinPx:(y==null?void 0:y.yBinPx)??(y==null?void 0:y.yBin),minValue:y==null?void 0:y.minValue,maxValue:y==null?void 0:y.maxValue,agg:(y==null?void 0:y.agg)??(y==null?void 0:y.aggregate),layer:y==null?void 0:y.layer,zIndex:(y==null?void 0:y.zIndex)??(y==null?void 0:y.zindex),includeInAutoscale:Li((y==null?void 0:y.includeInAutoscale)??(y==null?void 0:y.include_in_autoscale)??(y==null?void 0:y.autoscale)??c==="sub"),version:0},F={id:o,pane:c,points:[],def:P,version:0};return F.def.points=F.points,e.heatmaps.set(o,F),e.heatmapOrder.push(o),(Y=Et(e,c).runtimeHeatmaps)==null||Y.push(P),{__heatmap:!0,id:o}},set:(y,c)=>{var P;const M=we(y);if(!M||!c||!i())return;const o=ri((c==null?void 0:c.pane)??M.pane);if(o!==M.pane){const Y=Et(e,M.pane).runtimeHeatmaps||[],X=Y.findIndex(B=>(B==null?void 0:B.id)===M.id);X>=0&&Y.splice(X,1),(P=Et(e,o).runtimeHeatmaps)==null||P.push(M.def),M.pane=o}c.xloc!=null&&(M.def.xloc=c.xloc),c.yloc!=null&&(M.def.yloc=c.yloc),c.opacity!=null&&(M.def.opacity=c.opacity),(c.colormap!=null||c.colors!=null)&&(M.def.colormap=c.colormap??c.colors),c.blend!=null&&(M.def.blend=c.blend),(c.xBinPx!=null||c.xBin!=null)&&(M.def.xBinPx=c.xBinPx??c.xBin),(c.yBinPx!=null||c.yBin!=null)&&(M.def.yBinPx=c.yBinPx??c.yBin),c.minValue!=null&&(M.def.minValue=c.minValue),c.maxValue!=null&&(M.def.maxValue=c.maxValue),(c.agg!=null||c.aggregate!=null)&&(M.def.agg=c.agg??c.aggregate),c.layer!=null&&(M.def.layer=c.layer),(c.zIndex!=null||c.zindex!=null)&&(M.def.zIndex=c.zIndex??c.zindex);const u=Li((c==null?void 0:c.includeInAutoscale)??(c==null?void 0:c.include_in_autoscale)??(c==null?void 0:c.autoscale));u!=null&&(M.def.includeInAutoscale=u),M.version+=1,M.def.version=M.version},set_grid:(y,c)=>{Ce.set(y,c)},setGrid:(y,c)=>{Ce.set(y,c)},push:(y,c,M,o)=>{if(!ze())return;const u=we(y);if(!u){St(e,"js_heatmap_missing_handle","error","heatmap.push requires a valid handle (call heatmap.new first)");return}const P=nt(c),F=nt(M),Y=nt(o);!Number.isFinite(P)||!Number.isFinite(F)||!Number.isFinite(Y)||(u.points.push({x:P,y:F,value:Y}),u.version+=1,u.def.version=u.version,e.heatmapPointCount+=1)},clear:y=>{const c=we(y);c&&(e.heatmapPointCount=Math.max(0,e.heatmapPointCount-c.points.length),c.points=[],c.def.points=c.points,c.version+=1,c.def.version=c.version)}};return{plot:r,plotshape:s,plotchar:f,plotcandle:p,plotbar:E,plotohlc:_,hline:z,fill:C,label:v,line:S,box:U,polyline:ne,polygon:V,overlay:Te,heatmap:Ce,table:{new:(y,c,M,o)=>{var Y;if(!i())return null;const u=`js_table_${e.tables.length+1}`,P={id:u,position:y,columns:c,rows:M,bgcolor:(o==null?void 0:o.bgcolor)??(o==null?void 0:o.bgColor),borderColor:(o==null?void 0:o.border_color)??(o==null?void 0:o.borderColor),borderWidth:(o==null?void 0:o.border_width)??(o==null?void 0:o.borderWidth),frameColor:(o==null?void 0:o.frame_color)??(o==null?void 0:o.frameColor),frameWidth:(o==null?void 0:o.frame_width)??(o==null?void 0:o.frameWidth),textColor:(o==null?void 0:o.text_color)??(o==null?void 0:o.textColor),textSize:(o==null?void 0:o.text_size)??(o==null?void 0:o.textSize),textHalign:Mn((o==null?void 0:o.text_halign)??(o==null?void 0:o.textHalign)),textValign:Xn((o==null?void 0:o.text_valign)??(o==null?void 0:o.textValign)),layer:o==null?void 0:o.layer,zIndex:(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),includeInAutoscale:Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale))},F={id:u,def:P,cells:[]};return e.tables.push(F),(Y=Et(e,ri(o==null?void 0:o.pane)).runtimeTables)==null||Y.push(P),F},cell:(y,c,M,o,u)=>{y&&i()&&((u==null?void 0:u.when)!=null&&di(u.when,"table.cell")!==1||(y.cells.push({column:c,row:M,text:o!=null?String(o):"",textColor:(u==null?void 0:u.text_color)??(u==null?void 0:u.textColor),bgcolor:(u==null?void 0:u.bgcolor)??(u==null?void 0:u.bgColor),textSize:(u==null?void 0:u.text_size)??(u==null?void 0:u.textSize),textHalign:Mn((u==null?void 0:u.text_halign)??(u==null?void 0:u.textHalign)),textValign:Xn((u==null?void 0:u.text_valign)??(u==null?void 0:u.textValign)),width:u==null?void 0:u.width,height:u==null?void 0:u.height,tooltip:u==null?void 0:u.tooltip}),y.def.cells=y.cells))}}}},so=(e,t,i)=>{const n=(i==null?void 0:i.emitSignals)!==!1,a=i==null?void 0:i.accessors,r=new Set(["position_size","position_avg_price","open_trades","closed_trades","open_profit","closed_profit","gross_profit","gross_loss","win_trades","loss_trades","win_rate","max_drawdown","max_drawdown_value","max_drawdown_pct","max_runup","max_runup_value","max_runup_pct","avg_trade","avg_win","avg_loss","avg_bars_in_trade","equity","net_profit","net_profit_pct","final_equity","gross_profit","gross_loss","profit_factor","expectancy","payoff_ratio","max_consec_wins","max_consec_losses","exposure_pct","fees_paid","volatility_pct","sharpe","sortino","calmar","trades","wins","losses","round_trips","initial_capital"]),s={net_pnl:"net_profit",net_pnl_pct:"net_profit_pct"};for(const N of r){const g=N.replace(/_/g,"");g!==N&&(s[g]=N)}const f=N=>{const g=String(N||"").trim().replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/\s+/g,"_").toLowerCase();return s[g]??g},h=N=>{const g={};return Object.entries(N).forEach(([D,K])=>{const $=f(D);g[$]=K}),g},p=h((a==null?void 0:a.series)??{}),_=h((a==null?void 0:a.constants)??{}),E=N=>String(N??"").trim(),z=()=>((!e.strategyConfig||typeof e.strategyConfig!="object")&&(e.strategyConfig={enabled:!0}),e.strategyConfig),C=N=>{if(N===1||N==="1")return"long";if(N===-1||N==="-1")return"short";const g=String(N??"").trim().toLowerCase();return g==="long"?"long":g==="short"?"short":null},v=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();if(!g)return null;const D=g.replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop|trailingstop|trailstop/g,"trailing_stop");return D==="market"||D==="limit"||D==="stop"||D==="stop_limit"||D==="mit"||D==="lit"||D==="trailing_stop"?D:null},S=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();return g?g==="gtc"||g==="good_till_cancel"?"gtc":g==="ioc"||g==="immediate_or_cancel"?"ioc":g==="fok"||g==="fill_or_kill"?"fok":null:null},U=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();return g?g==="percent"||g==="pct"||g==="%"?"percent":g==="cash"||g==="fixed"?"cash":g==="per_unit"||g==="perunit"||g==="unit"?"per_unit":null:null},V=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();return g?g==="percent"||g==="pct"||g==="%"?"percent":g==="abs"||g==="absolute"?"abs":g==="ticks"||g==="tick"?"ticks":null:null},ne=N=>!!N&&typeof N=="object"&&!Array.isArray(N)&&!En(N),he=N=>ne(N)?N:{},me=N=>{const g=nt(N);return Number.isFinite(g)?g:NaN},be=(N,g,D)=>`${N}:${g}${D?`:${D}`:""}`,ve=(N,g,D,K)=>{const $=K||be(N,g);let _e=e.signalMap.get($);if(_e)_e.spec.type=N,g&&(_e.spec.id=g),D&&(_e.spec.orderId=D);else{const se=e.signalCounter++,ge=mt("__js_signal",se,"when"),$e=ht(e,ge,0);_e={key:$,index:se,spec:{type:N,when:ge,id:g||void 0,orderId:D||void 0},when:{name:ge,series:$e},series:{}},e.signalMap.set($,_e),e.signals.push(_e)}return _e},Te=(N,g,D=NaN)=>{if(!N.series[g]){const K=mt("__js_signal",N.index,g);N.series[g]={name:K,series:ht(e,K,D)}}return N.series[g]},Ie=(N,g,D,K=NaN)=>{const $=Te(N,g,K);return $.series[e.indexRef.value]=me(D),$.name},we=N=>{if(N==null)return null;const g=typeof N=="number"?N:Number(N);return Number.isFinite(g)?g:null},ze=N=>{const g=we(N);if(g!=null)return Math.max(0,Math.min(100,g))},Ce=N=>{const g=we(N);if(!(g==null||g<=0))return Math.floor(g)},Ct=N=>{const g=E(N);return g||void 0},y=N=>{const g=ne(N.bracket)&&N.bracket?{...N.bracket}:{},D=we(N.stopLossPct??N.stop_loss_pct??N.stopLoss??N.stop_loss??N.slPct??N.sl)??we(g.stopLossPct),K=we(N.takeProfitPct??N.take_profit_pct??N.takeProfit??N.take_profit??N.tpPct??N.tp)??we(g.takeProfitPct),$=we(N.trailingStopPct??N.trailing_stop_pct??N.trailingPct??N.trailPct??N.trail_pct??N.trailing)??we(g.trailingStopPct),_e=N.takeProfits??N.take_profits??N.takeProfitLevels??g.takeProfits,se=[];if(Array.isArray(_e))for(const $e of _e){if(!$e||typeof $e!="object")continue;const Je=we($e.takeProfitPct),k=we($e.qtyPct);Je==null||Je<=0||k==null||k<=0||se.push({takeProfitPct:Math.max(0,Je),qtyPct:Math.max(0,Math.min(100,k))})}const ge={...g};if(D!=null&&(ge.stopLossPct=D),K!=null&&(ge.takeProfitPct=K),$!=null&&(ge.trailingStopPct=$),se.length&&(ge.takeProfits=se),!(ge.stopLossPct==null&&ge.takeProfitPct==null&&ge.trailingStopPct==null&&!Array.isArray(ge.takeProfits)))return ge},c=(N,g)=>{g!=null&&(N.spec.scoreExpr=Ie(N,"score",g))},M=(N,g)=>{g!=null&&(N.spec.cooldownExpr=Ie(N,"cooldown",g))},o=(N,g)=>{g.title!=null&&(N.spec.title=String(g.title)),g.message!=null&&(N.spec.message=String(g.message)),g.frequency!=null&&(N.spec.frequency=String(g.frequency));const D=g.score??g.signal_score??g.signalScore,K=g.cooldownBars??g.cooldown_bars??g.cooldown??g.signal_cooldown;c(N,D),M(N,K)},u=(N,g,D,K)=>{const $={},_e=ze(g.qtyPct??g.qty_percent??g.qtyPercent??g.qty_pct);_e!=null&&($.qtyPct=_e);const se=g.qty??g.quantity??D,ge=g.cash??g.cashQty??g.cash_qty,$e=g.commission??g.commissionPct??g.commission_pct,Je=g.commissionType??g.commission_type??g.commissionMode??g.commission_mode,k=g.commissionValue??g.commission_value??g.commissionVal??g.commission_val,R=g.commissionCash??g.commission_cash??g.commissionFixed??g.commission_fixed,w=g.commissionPerUnit??g.commission_per_unit??g.commissionPerShare??g.commission_per_share,O=g.slippage??g.slippagePct??g.slippage_pct,H=g.slippageType??g.slippage_type??g.slippageMode??g.slippage_mode,G=g.slippageValue??g.slippage_value??g.slippageVal??g.slippage_val,W=g.slippageAbs??g.slippage_abs??g.slippagePoints??g.slippage_points,re=g.slippageTicks??g.slippage_ticks??g.slippageTick??g.slippage_tick,oe=K??g.oco??g.oca_name??g.ocaName??g.oca,ce=g.expiresBars??g.expires_bars,J=g.tif??g.timeInForce??g.time_in_force,Fe=g.price,Ue=g.stop??g.stopPrice,et=g.limit??g.limitPrice,Bt=g.trailPct??g.trail_percent??g.trailPercent??g.trailingStopPct??g.trailing_stop_pct,Wt=g.trailOffset??g.trail_offset??g.trailPoints??g.trail_points,oi=g.trailPrice??g.trail_price,hi=g.kind??g.orderType??g.type,pi=se!=null?Ie(N,"qty",se):null,kt=ge!=null?Ie(N,"cash",ge):null,Jt=$e!=null?Ie(N,"commission",$e):null,It=k!=null?Ie(N,"commission_value",k):null,Qt=R!=null?Ie(N,"commission_cash",R):null,gi=w!=null?Ie(N,"commission_per_unit",w):null,Fi=O!=null?Ie(N,"slippage",O):null,Zt=G!=null?Ie(N,"slippage_value",G):null,Ii=W!=null?Ie(N,"slippage_abs",W):null,Ai=re!=null?Ie(N,"slippage_ticks",re):null,nn=Fe!=null?Ie(N,"price",Fe):null,zt=Ue!=null?Ie(N,"stop",Ue):null,ei=et!=null?Ie(N,"limit",et):null,ji=Bt!=null?Ie(N,"trail_pct",Bt):null,Ei=Wt!=null?Ie(N,"trail_offset",Wt):null,hn=oi!=null?Ie(N,"trail_price",oi):null,ti=v(hi),Mi=S(J),dn=U(Je),mn=V(H),zi=y(g);pi&&($.qty=pi),kt&&($.cash=kt),Jt&&($.commissionPct=Jt),dn&&($.commissionType=dn),It&&($.commissionValue=It),Qt&&($.commissionCash=Qt),gi&&($.commissionPerUnit=gi),Fi&&($.slippagePct=Fi),mn&&($.slippageType=mn),Zt&&($.slippageValue=Zt),Ii&&($.slippageAbs=Ii),Ai&&($.slippageTicks=Ai),ji&&($.trailPct=ji),Ei&&($.trailOffset=Ei),hn&&($.trailPrice=hn),Mi&&($.tif=Mi);const pn=Ct(oe);pn&&($.oco=pn);const vr=Ce(ce);if(vr!=null&&($.expiresBars=vr),zi&&($.bracket=zi),ti){if(ti==="stop_limit"){if(!zt||!ei)throw new Error("strategy order kind stop_limit requires stop + limit");return $.kind="stop_limit",$.stopPrice=zt,$.limitPrice=ei,$}if(ti==="limit"||ti==="lit"){const gn=ei??nn??zt;if(!gn)throw new Error(`strategy order kind ${ti} requires limit/price`);return $.kind=ti,$.price=gn,ei&&($.limitPrice=ei),$}if(ti==="stop"||ti==="mit"){const gn=zt??nn??ei;if(!gn)throw new Error(`strategy order kind ${ti} requires stop/price`);return $.kind=ti,$.price=gn,$}if(ti==="trailing_stop"){if(!ji&&!Ei)throw new Error("strategy order kind trailing_stop requires trailPct or trailOffset");return nn&&($.price=nn),$.kind="trailing_stop",$}return $.kind="market",$}return zt&&ei?($.kind="stop_limit",$.stopPrice=zt,$.limitPrice=ei,$):ei?($.kind="limit",$.price=ei,$):zt?($.kind="stop",$.price=zt,$):nn?($.kind="market",$):Object.keys($).length?{kind:"market",...$}:null},P=(N,g)=>{N.when.series[e.indexRef.value]=di(g,"strategy.when")},F=(N,g,D,K)=>{const $=me(g),_e=me(D),se=me(K);if(!Number.isFinite($)||!Number.isFinite(_e)||!Number.isFinite(se)){N.when.series[e.indexRef.value]=0;return}const ge=Math.min(_e,se),$e=Math.max(_e,se);N.when.series[e.indexRef.value]=$>=ge&&$<=$e?1:0},Y=N=>{const g=String(N??"").toLowerCase().replace(/\s+/g,"");if(g){if(g.includes("onceperbarclose")||g.includes("perbarclose")||g.includes("barclose"))return"once_per_bar_close";if(g.includes("onceperbar")||g.includes("perbar")||g.includes("all"))return"once_per_bar";if(g.includes("once"))return"once"}},X=N=>String(N??"").trim(),B=(N,g,D)=>{const K=N.id??N.alert_id??N.alertId??N.key??N.name,$=X(K)||X(N.title??g)||X(N.message??D);return $||(St(e,"js_alert_missing_id","warning","alertcondition() is missing id/title; defaulting to 'alert'","Provide opts.id or a title to avoid alert rule collisions."),"alert")},te=(N,g)=>{if(g==null)return;const D=Y(g);if(!D){St(e,`js_alert_freq_invalid:${String(g)}`,"warning",`alert frequency "${g}" is not supported`,"Use once, once_per_bar, or once_per_bar_close.");return}N.spec.frequency=D},ie=(N,g,D,K)=>{if(!n)return;const $=he(K),_e=B($,g,D),se=ve("alert",_e),ge=N!==void 0?N:$.when??1;P(se,ge);const $e=$.title??g,Je=$.message??D;$e!=null&&(se.spec.title=String($e)),Je!=null&&(se.spec.message=String(Je));const k=$.frequency??$.freq??$.alert_freq??$.alertFreq??$.alertFrequency;te(se,k),c(se,$.score??$.signal_score??$.signalScore),M(se,$.cooldownBars??$.cooldown_bars??$.cooldown??$.signal_cooldown)},ae=(N,g,D,K)=>{if(N===void 0)throw new Error("alertcondition requires a condition");ie(N,g,D,K)},fe=(N,g,D)=>{if(ne(N)){const K=he(N);ie(K.when??1,K.title,K.message,K);return}if(typeof N=="string"){const K=he(g);ie(K.when??1,K.title,N,K);return}if(typeof g=="string"){ie(N,void 0,g,D);return}ie(N??1,void 0,void 0,g)},ee=a==null?void 0:a.accessors,ue={profit_pct:"profit_percent",pnl:"profit",net_pnl:"net_profit",net_pnl_pct:"net_profit_percent",net_pnl_percent:"net_profit_percent",fee:"fees",max_profit:"max_runup",max_profit_pct:"max_runup_percent",max_profit_percent:"max_runup_percent",max_runup_pct:"max_runup_percent",max_drawdown_pct:"max_drawdown_percent",max_loss:"max_drawdown",max_loss_pct:"max_drawdown_percent",max_loss_percent:"max_drawdown_percent"},De=N=>{const g=f(N);return ue[g]??g},Ge=(N,g)=>{if(N==null)return 0;const D=typeof N=="number"?N:Number(N);if(!Number.isFinite(D)||!Number.isInteger(D)||D<0)throw new Error(`${g} offset must be a non-negative integer`);return D},Ye=N=>{const g=(ee==null?void 0:ee.closedTrades)||[];if(!g.length)return null;const D=p.closed_trades,$=(D&&Number.isFinite(D[e.indexRef.value])?Math.floor(D[e.indexRef.value]):g.length)-1-N;return $<0||$>=g.length?null:g[$]??null},Ae=N=>{const D=((ee==null?void 0:ee.openTradesByBar)||[])[e.indexRef.value]||[];return N<0||N>=D.length?null:D[N]??null},ft=(N,g,D)=>{const K=De(g);if(N==="closedtrades"){const J=Ye(D);if(!J)return 0;const Fe=Number.isFinite(J.entryPrice)&&Number.isFinite(J.qty)&&J.entryPrice>0&&J.qty>0?J.entryPrice*J.qty:NaN,Ue=Number.isFinite(J.netPnl)?J.netPnl:Number.isFinite(J.pnl)?J.pnl-(J.fees??0):NaN,et=Number.isFinite(Fe)&&Fe!==0?Ue/Fe*100:NaN;switch(K){case"entry_price":return J.entryPrice;case"entry_time":return J.entryTimestamp;case"entry_bar_index":return J.entryIndex;case"exit_price":return J.exitPrice;case"exit_time":return J.exitTimestamp;case"exit_bar_index":return J.exitIndex;case"size":return J.qty;case"profit":return Number.isFinite(J.pnl)?J.pnl:0;case"profit_percent":return Number.isFinite(J.pnlPct)?J.pnlPct:0;case"net_profit":return Number.isFinite(Ue)?Ue:0;case"net_profit_percent":return Number.isFinite(et)?et:0;case"fees":return Number.isFinite(J.fees)?J.fees:0;case"entry_fee":return Number.isFinite(J.entryFee)?J.entryFee:0;case"exit_fee":return Number.isFinite(J.exitFee)?J.exitFee:0;case"max_runup":return typeof J.mfePct=="number"&&Number.isFinite(J.mfePct)?J.mfePct/100*J.entryPrice*J.qty:0;case"max_runup_percent":return typeof J.mfePct=="number"&&Number.isFinite(J.mfePct)?J.mfePct:0;case"max_drawdown":return typeof J.maePct=="number"&&Number.isFinite(J.maePct)?J.maePct/100*J.entryPrice*J.qty:0;case"max_drawdown_percent":return typeof J.maePct=="number"&&Number.isFinite(J.maePct)?J.maePct:0;case"is_long":return J.side==="long"?1:0;case"is_short":return J.side==="short"?1:0;case"entry_id":return Ar(String(J.entryOrderId??J.entrySignalId??""));case"exit_id":return Ar(String(J.exitOrderId??J.exitSignalId??""));default:return 0}}const $=Ae(D);if(!$)return 0;const _e=nt(t.close),se=$.entryPrice,ge=$.qty,$e=Number.isFinite(se)&&Number.isFinite(ge)&&se>0&&ge>0?se*ge:NaN,Je=typeof $.entryFee=="number"&&Number.isFinite($.entryFee)?$.entryFee:0,k=Number.isFinite(_e)&&Number.isFinite(se)&&Number.isFinite(ge)?$.side==="long"?(_e-se)*ge:(se-_e)*ge:NaN,R=Number.isFinite($e)&&$e!==0?k/$e*100:NaN,w=Number.isFinite(k)&&Number.isFinite(Je)?k-Je:NaN,O=Number.isFinite($e)&&$e!==0?w/$e*100:NaN,H=$.maxFav,G=$.maxAdv,W=Number.isFinite(se)&&Number.isFinite(ge)&&Number.isFinite(H)?$.side==="long"?(H-se)*ge:(se-H)*ge:NaN,re=Number.isFinite(se)&&se>0&&Number.isFinite(H)?$.side==="long"?(H-se)/se*100:(se-H)/se*100:NaN,oe=Number.isFinite(se)&&Number.isFinite(ge)&&Number.isFinite(G)?$.side==="long"?(G-se)*ge:(se-G)*ge:NaN,ce=Number.isFinite(se)&&se>0&&Number.isFinite(G)?$.side==="long"?(G-se)/se*100:(se-G)/se*100:NaN;switch(K){case"entry_price":return se;case"entry_time":return $.entryTimestamp;case"entry_bar_index":return $.entryIndex;case"size":return ge;case"profit":return Number.isFinite(k)?k:0;case"profit_percent":return Number.isFinite(R)?R:0;case"net_profit":return Number.isFinite(w)?w:0;case"net_profit_percent":return Number.isFinite(O)?O:0;case"fees":return Number.isFinite(Je)?Je:0;case"entry_fee":return Number.isFinite(Je)?Je:0;case"max_runup":return Number.isFinite(W)?W:0;case"max_runup_percent":return Number.isFinite(re)?re:0;case"max_drawdown":return Number.isFinite(oe)?oe:0;case"max_drawdown_percent":return Number.isFinite(ce)?ce:0;case"is_long":return $.side==="long"?1:0;case"is_short":return $.side==="short"?1:0;case"entry_id":return Ar(String($.entryOrderId??$.entrySignalId??""));default:return 0}},pt=N=>new Proxy({},{get:(g,D)=>{var K,$;if(D==="length")return N==="closedtrades"?((K=ee==null?void 0:ee.closedTrades)==null?void 0:K.length)??0:((($=ee==null?void 0:ee.openTradesByBar)==null?void 0:$[e.indexRef.value])??[]).length??0;if(D==="count"||D==="size")return()=>{var se,ge;return N==="closedtrades"?((se=ee==null?void 0:ee.closedTrades)==null?void 0:se.length)??0:(((ge=ee==null?void 0:ee.openTradesByBar)==null?void 0:ge[e.indexRef.value])??[]).length??0};if(D!=="then"&&typeof D=="string")return _e=>{const se=Ge(_e,`strategy.${N}.${D}`);return ft(N,D,se)}}}),qt=pt("closedtrades"),Ut=pt("opentrades"),qe=(N,g)=>new Proxy(g,{get:(D,K)=>K in D?D[K]:N==="closedtrades"?qt[K]:Ut[K]});let Lt=null,wt=null;const at=()=>(Lt||(Lt=qe("closedtrades",jt("closed_trades"))),Lt),Pe=()=>(wt||(wt=qe("opentrades",jt("open_trades"))),wt),jt=N=>{const g=f(N),D=`strategy_${g}`;let K=e.seriesMap[D];K||(K=ht(e,D,NaN));const $=p[g];if($&&$.length===e.len)for(let _e=0;_e<e.len;_e++)K[_e]=$[_e];else if(_[g]!=null){const _e=_[g];for(let se=0;se<e.len;se++)K[se]=_e}return ni(D,K,e.indexRef)},Ke=(N,g,D,K)=>{if(!n)return;const $=E(N);if(!$)throw new Error("strategy.entry requires id");const _e=C(g);if(!_e)throw new Error("strategy.entry requires strategy.long/strategy.short");const se=he(ne(K)?K:D),ge=ne(D)?void 0:D;z();const Je=ve(_e==="long"?"entry_long":"entry_short",$);P(Je,se.when??1);const k=u(Je,se,ge);k&&(Je.spec.order=k),o(Je,se)},je=(N,g,D,K)=>{if(!n)return;const $=E(N);if(!$)throw new Error("strategy.order requires id");const _e=C(g);if(!_e)throw new Error("strategy.order requires strategy.long/strategy.short");const se=he(ne(K)?K:D),ge=ne(D)?void 0:D;z();const Je=ve(_e==="long"?"entry_long":"entry_short",$,$);P(Je,se.when??1);const k=u(Je,se,ge);k&&(Je.spec.order=k),o(Je,se)},ot=(N,g)=>{if(!n)return;const D=E(N);if(!D)throw new Error("strategy.close requires id");const K=he(g);z();const $=K.side??K.direction??K.dir,se=(C($)??"long")==="long"?"exit_long":"exit_short",ge=ve(se,D);P(ge,K.when??1);const $e=u(ge,K);$e&&(ge.spec.order=$e),o(ge,K)},Vt=(N,g)=>{if(!n)return;const D=E(N);if(!D)throw new Error("strategy.exit requires id");const K=he(g);z();const $=K.side??K.direction??K.dir,se=(C($)??"long")==="long"?"exit_long":"exit_short",ge=K.stop??K.stopPrice,$e=K.limit??K.limitPrice,Je=ze(K.qtyPct??K.qty_percent??K.qtyPercent??K.qty_pct),k=D?`${D}__bracket`:void 0;let R=!1;if(ge!=null){const w=ve(se,`${D}_STOP`,void 0,be(se,D,"stop")),O=u(w,{...K,stop:ge,stopPrice:ge,limit:void 0,limitPrice:void 0},void 0,k);O&&(O.kind="stop",O.price==null&&(O.price=Ie(w,"stop",ge)),Je!=null&&(O.qtyPct=Je),k&&(O.oco=k),w.spec.order=O),F(w,ge,t.low,t.high),o(w,K),R=!0}if($e!=null){const w=ve(se,`${D}_LIMIT`,void 0,be(se,D,"limit")),O=u(w,{...K,limit:$e,limitPrice:$e,stop:void 0,stopPrice:void 0},void 0,k);O&&(O.kind="limit",O.price==null&&(O.price=Ie(w,"limit",$e)),Je!=null&&(O.qtyPct=Je),k&&(O.oco=k),w.spec.order=O),F(w,$e,t.low,t.high),o(w,K),R=!0}if(K.when!=null||!ge&&!$e){const w=ve(se,D);P(w,K.when??1);const O=u(w,K);O&&((ge!=null||$e!=null)&&Je!=null&&(O.kind="market",O.qtyPct=Je),w.spec.order=O),o(w,K),R=!0}if(!R)throw new Error("strategy.exit requires when or stop/limit options")},$t=(N,g)=>{if(!n)return;const D=E(N);if(!D)throw new Error("strategy.cancel requires id");const K=he(g);z();const $=ve("cancel",`cancel_${D}`,D,be("cancel",D));P($,K.when??1),o($,K)},Nt=N=>{if(!n)return;const g=he(N);z();const D=ve("cancel_all","cancel_all");P(D,g.when??1),o(D,g)},Tt=N=>{if(!n)return;const g=he(N);z();const D=g.when??1,K=ve("exit_long","close_all_long");P(K,D),K.spec.order={kind:"market",qtyPct:100},o(K,g);const $=ve("exit_short","close_all_short");P($,D),$.spec.order={kind:"market",qtyPct:100},o($,g)},gt=(N,g,D)=>{const K=we(g);if(K==null)throw new Error(`strategy.risk.${N} requires numeric value`);const $=String(D??"").toLowerCase(),_e=$.includes("cash")||$.includes("currency")||$.includes("fixed")?"cash":$.includes("qty")||$.includes("contract")?"qty":"percent",se=z();if(N==="max_drawdown"||N==="max_drawdown_percent"){_e==="cash"?se.maxDrawdownCash=K:se.maxDrawdownPct=K;return}if(N==="max_position_size"||N==="max_position"||N==="max_position_size_contracts"){_e==="cash"?se.maxPositionCash=K:_e==="qty"?se.maxPositionQty=K:se.maxPositionPct=K;return}if(N==="max_intraday_filled_orders"||N==="max_intraday_orders"){se.maxIntradayFilledOrders=Math.max(0,Math.floor(K));return}if(N==="max_intraday_loss"||N==="max_daily_loss"){_e==="cash"?se.maxIntradayLossCash=K:se.maxIntradayLossPct=K;return}throw new Error(`strategy.risk.${N} is not supported`)},Ze=N=>{if(N===void 0)return e.strategyConfig;if(N===!1)return e.strategyConfig={enabled:!1},e.strategyConfig;if(N===!0)return e.strategyConfig={enabled:!0},e.strategyConfig;if(N&&typeof N=="object"){const g=z();return Object.assign(g,N),g}throw new Error("strategy.config expects an object, true, or false")},Rt=Object.assign(N=>Ze(N),{entry:Ke,order:je,exit:Vt,close:ot,cancel:$t,alert:fe,alertcondition:ae,cancel_all:Nt,close_all:Tt,risk:{max_drawdown:(N,g)=>gt("max_drawdown",N,g),max_drawdown_percent:(N,g)=>gt("max_drawdown_percent",N,g),max_position_size:(N,g)=>gt("max_position_size",N,g),max_position:(N,g)=>gt("max_position",N,g),max_position_size_contracts:(N,g)=>gt("max_position_size_contracts",N,g),max_intraday_filled_orders:N=>gt("max_intraday_filled_orders",N),max_intraday_orders:N=>gt("max_intraday_orders",N),max_intraday_loss:(N,g)=>gt("max_intraday_loss",N,g),max_daily_loss:(N,g)=>gt("max_daily_loss",N,g)},long:"long",short:"short",config:Ze});return new Proxy(Rt,{get:(N,g)=>{if(g!=="then"){if(typeof g=="string"){const D=f(g);if(D==="closed_trades")return e.strategyAccessorsUsed=!0,n&&St(e,"js_strategy_accessor_after_backtest","warning","JS strategy accessors are computed after backtest; use them for plots only.","Move accessors to plot/visuals, not entry/exit logic."),at();if(D==="open_trades")return e.strategyAccessorsUsed=!0,n&&St(e,"js_strategy_accessor_after_backtest","warning","JS strategy accessors are computed after backtest; use them for plots only.","Move accessors to plot/visuals, not entry/exit logic."),Pe();if(r.has(D))return e.strategyAccessorsUsed=!0,n&&St(e,"js_strategy_accessor_after_backtest","warning","JS strategy accessors are computed after backtest; use them for plots only.","Move accessors to plot/visuals, not entry/exit logic."),jt(D)}if(g in N)return N[g];if(typeof g=="string")throw new Error(`strategy.${g} is not available in JS`);return N[g]}}})},ao=e=>{e.plots.forEach(s=>{var p;if(!s||to(s.seriesName))return;const f=String(((p=s.def)==null?void 0:p.name)||s.seriesName);(s.ohlc?!!s.hasOhlcFinite:!!s.hasFinite)||St(e,`js_plot_all_nan:${s.seriesName}`,"warning",`plot "${f}" produced only NaN/undefined values`,"Check inputs, lookback length, or warmup bars.")});const t=Object.values(e.panes).filter(s=>s.plots&&s.plots.length||s.overlays&&s.overlays.length||s.levels&&s.levels.length||s.fills&&s.fills.length||s.runtimeLabels&&s.runtimeLabels.length||s.runtimeLines&&s.runtimeLines.length||s.runtimeBoxes&&s.runtimeBoxes.length||s.runtimeTables&&s.runtimeTables.length||s.runtimeHeatmaps&&s.runtimeHeatmaps.length||s.runtimeDrawOps&&s.runtimeDrawOps.length);let i=e.strategyConfig;const n=e.signals.map(s=>s.spec);if(!i&&n.length&&(i={enabled:!0}),(t.some(s=>(s.runtimeDrawOps||[]).length>0||(s.runtimeHeatmaps||[]).length>0||(s.overlays||[]).length>0)||t.some(s=>s.levels&&s.levels.length||s.fills&&s.fills.length))&&t.forEach(s=>{s.plots&&s.plots.length||(s.plots=s.plots||[],s.plots.push({name:"__js_draw_stub__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:0}))}),!t.length&&n.length){const s=Et(e,"main");s.plots=s.plots||[],s.plots.push({name:"__js_strategy_stub__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:0}),t.push(s)}return{panes:t,seriesMap:e.seriesMap,signals:n.length?n:void 0,strategy:i||void 0}};var oo=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],ws=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],lo="-----------------------------------------------------------------------------------------------------------------------------------------------------",Ns="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Mr={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},Tr="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",co={5:Tr,"5module":Tr+" export import",6:Tr+" const class extends export import super"},uo=/^in(stanceof)?$/,fo=new RegExp("["+Ns+"]"),ho=new RegExp("["+Ns+lo+"]");function Rr(e,t){for(var i=65536,n=0;n<t.length;n+=2){if(i+=t[n],i>e)return!1;if(i+=t[n+1],i>=e)return!0}return!1}function Hi(e,t){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&fo.test(String.fromCharCode(e)):t===!1?!1:Rr(e,ws)}function wn(e,t){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&ho.test(String.fromCharCode(e)):t===!1?!1:Rr(e,ws)||Rr(e,oo)}var ut=function(t,i){i===void 0&&(i={}),this.label=t,this.keyword=i.keyword,this.beforeExpr=!!i.beforeExpr,this.startsExpr=!!i.startsExpr,this.isLoop=!!i.isLoop,this.isAssign=!!i.isAssign,this.prefix=!!i.prefix,this.postfix=!!i.postfix,this.binop=i.binop||null,this.updateContext=null};function wi(e,t){return new ut(e,{beforeExpr:!0,binop:t})}var Ni={beforeExpr:!0},mi={startsExpr:!0},Or={};function st(e,t){return t===void 0&&(t={}),t.keyword=e,Or[e]=new ut(e,t)}var d={num:new ut("num",mi),regexp:new ut("regexp",mi),string:new ut("string",mi),name:new ut("name",mi),privateId:new ut("privateId",mi),eof:new ut("eof"),bracketL:new ut("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new ut("]"),braceL:new ut("{",{beforeExpr:!0,startsExpr:!0}),braceR:new ut("}"),parenL:new ut("(",{beforeExpr:!0,startsExpr:!0}),parenR:new ut(")"),comma:new ut(",",Ni),semi:new ut(";",Ni),colon:new ut(":",Ni),dot:new ut("."),question:new ut("?",Ni),questionDot:new ut("?."),arrow:new ut("=>",Ni),template:new ut("template"),invalidTemplate:new ut("invalidTemplate"),ellipsis:new ut("...",Ni),backQuote:new ut("`",mi),dollarBraceL:new ut("${",{beforeExpr:!0,startsExpr:!0}),eq:new ut("=",{beforeExpr:!0,isAssign:!0}),assign:new ut("_=",{beforeExpr:!0,isAssign:!0}),incDec:new ut("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new ut("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:wi("||",1),logicalAND:wi("&&",2),bitwiseOR:wi("|",3),bitwiseXOR:wi("^",4),bitwiseAND:wi("&",5),equality:wi("==/!=/===/!==",6),relational:wi("</>/<=/>=",7),bitShift:wi("<</>>/>>>",8),plusMin:new ut("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:wi("%",10),star:wi("*",10),slash:wi("/",10),starstar:new ut("**",{beforeExpr:!0}),coalesce:wi("??",1),_break:st("break"),_case:st("case",Ni),_catch:st("catch"),_continue:st("continue"),_debugger:st("debugger"),_default:st("default",Ni),_do:st("do",{isLoop:!0,beforeExpr:!0}),_else:st("else",Ni),_finally:st("finally"),_for:st("for",{isLoop:!0}),_function:st("function",mi),_if:st("if"),_return:st("return",Ni),_switch:st("switch"),_throw:st("throw",Ni),_try:st("try"),_var:st("var"),_const:st("const"),_while:st("while",{isLoop:!0}),_with:st("with"),_new:st("new",{beforeExpr:!0,startsExpr:!0}),_this:st("this",mi),_super:st("super",mi),_class:st("class",mi),_extends:st("extends",Ni),_export:st("export"),_import:st("import",mi),_null:st("null",mi),_true:st("true",mi),_false:st("false",mi),_in:st("in",{beforeExpr:!0,binop:7}),_instanceof:st("instanceof",{beforeExpr:!0,binop:7}),_typeof:st("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:st("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:st("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},ki=/\r\n?|\n|\u2028|\u2029/,mo=new RegExp(ki.source,"g");function Nn(e){return e===10||e===13||e===8232||e===8233}function ks(e,t,i){i===void 0&&(i=e.length);for(var n=t;n<i;n++){var a=e.charCodeAt(n);if(Nn(a))return n<i-1&&a===13&&e.charCodeAt(n+1)===10?n+2:n+1}return-1}var Ps=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Pi=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ss=Object.prototype,po=Ss.hasOwnProperty,go=Ss.toString,kn=Object.hasOwn||function(e,t){return po.call(e,t)},Cs=Array.isArray||function(e){return go.call(e)==="[object Array]"},Fs=Object.create(null);function rn(e){return Fs[e]||(Fs[e]=new RegExp("^(?:"+e.replace(/ /g,"|")+")$"))}function Ji(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}var yo=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Tn=function(t,i){this.line=t,this.column=i};Tn.prototype.offset=function(t){return new Tn(this.line,this.column+t)};var er=function(t,i,n){this.start=i,this.end=n,t.sourceFile!==null&&(this.source=t.sourceFile)};function Is(e,t){for(var i=1,n=0;;){var a=ks(e,n,t);if(a<0)return new Tn(i,t-n);++i,n=a}}var qr={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},As=!1;function xo(e){var t={};for(var i in qr)t[i]=e&&kn(e,i)?e[i]:qr[i];if(t.ecmaVersion==="latest"?t.ecmaVersion=1e8:t.ecmaVersion==null?(!As&&typeof console=="object"&&console.warn&&(As=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),t.ecmaVersion=11):t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),t.allowReserved==null&&(t.allowReserved=t.ecmaVersion<5),(!e||e.allowHashBang==null)&&(t.allowHashBang=t.ecmaVersion>=14),Cs(t.onToken)){var n=t.onToken;t.onToken=function(a){return n.push(a)}}return Cs(t.onComment)&&(t.onComment=bo(t,t.onComment)),t}function bo(e,t){return function(i,n,a,r,s,f){var h={type:i?"Block":"Line",value:n,start:a,end:r};e.locations&&(h.loc=new er(this,s,f)),e.ranges&&(h.range=[a,r]),t.push(h)}}var Rn=1,Pn=2,Lr=4,Es=8,Ms=16,Ts=32,Vr=64,Rs=128,On=256,$r=Rn|Pn|On;function Br(e,t){return Pn|(e?Lr:0)|(t?Es:0)}var tr=0,Dr=1,Yi=2,Os=3,qs=4,Ls=5,Ht=function(t,i,n){this.options=t=xo(t),this.sourceFile=t.sourceFile,this.keywords=rn(co[t.ecmaVersion>=6?6:t.sourceType==="module"?"5module":5]);var a="";t.allowReserved!==!0&&(a=Mr[t.ecmaVersion>=6?6:t.ecmaVersion===5?5:3],t.sourceType==="module"&&(a+=" await")),this.reservedWords=rn(a);var r=(a?a+" ":"")+Mr.strict;this.reservedWordsStrict=rn(r),this.reservedWordsStrictBind=rn(r+" "+Mr.strictBind),this.input=String(i),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf(`
`,n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(ki).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=d.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=t.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&t.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Rn),this.regexpState=null,this.privateNameStack=[]},Vi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};Ht.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},Vi.inFunction.get=function(){return(this.currentVarScope().flags&Pn)>0},Vi.inGenerator.get=function(){return(this.currentVarScope().flags&Es)>0&&!this.currentVarScope().inClassFieldInit},Vi.inAsync.get=function(){return(this.currentVarScope().flags&Lr)>0&&!this.currentVarScope().inClassFieldInit},Vi.canAwait.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e];if(t.inClassFieldInit||t.flags&On)return!1;if(t.flags&Pn)return(t.flags&Lr)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},Vi.allowSuper.get=function(){var e=this.currentThisScope(),t=e.flags,i=e.inClassFieldInit;return(t&Vr)>0||i||this.options.allowSuperOutsideMethod},Vi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Rs)>0},Vi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Vi.allowNewDotTarget.get=function(){var e=this.currentThisScope(),t=e.flags,i=e.inClassFieldInit;return(t&(Pn|On))>0||i},Vi.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&On)>0},Ht.extend=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];for(var n=this,a=0;a<t.length;a++)n=t[a](n);return n},Ht.parse=function(t,i){return new this(i,t).parse()},Ht.parseExpressionAt=function(t,i,n){var a=new this(n,t,i);return a.nextToken(),a.parseExpression()},Ht.tokenizer=function(t,i){return new this(i,t)},Object.defineProperties(Ht.prototype,Vi);var fi=Ht.prototype,_o=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;fi.strictDirective=function(e){if(this.options.ecmaVersion<5)return!1;for(;;){Pi.lastIndex=e,e+=Pi.exec(this.input)[0].length;var t=_o.exec(this.input.slice(e));if(!t)return!1;if((t[1]||t[2])==="use strict"){Pi.lastIndex=e+t[0].length;var i=Pi.exec(this.input),n=i.index+i[0].length,a=this.input.charAt(n);return a===";"||a==="}"||ki.test(i[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(a)||a==="!"&&this.input.charAt(n+1)==="=")}e+=t[0].length,Pi.lastIndex=e,e+=Pi.exec(this.input)[0].length,this.input[e]===";"&&e++}},fi.eat=function(e){return this.type===e?(this.next(),!0):!1},fi.isContextual=function(e){return this.type===d.name&&this.value===e&&!this.containsEsc},fi.eatContextual=function(e){return this.isContextual(e)?(this.next(),!0):!1},fi.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},fi.canInsertSemicolon=function(){return this.type===d.eof||this.type===d.braceR||ki.test(this.input.slice(this.lastTokEnd,this.start))},fi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},fi.semicolon=function(){!this.eat(d.semi)&&!this.insertSemicolon()&&this.unexpected()},fi.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},fi.expect=function(e){this.eat(e)||this.unexpected()},fi.unexpected=function(e){this.raise(e??this.start,"Unexpected token")};var ir=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};fi.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var i=t?e.parenthesizedAssign:e.parenthesizedBind;i>-1&&this.raiseRecoverable(i,t?"Assigning to rvalue":"Parenthesized pattern")}},fi.checkExpressionErrors=function(e,t){if(!e)return!1;var i=e.shorthandAssign,n=e.doubleProto;if(!t)return i>=0||n>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},fi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},fi.isSimpleAssignTarget=function(e){return e.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(e.expression):e.type==="Identifier"||e.type==="MemberExpression"};var ke=Ht.prototype;ke.parseTopLevel=function(e){var t=Object.create(null);for(e.body||(e.body=[]);this.type!==d.eof;){var i=this.parseStatement(null,!0,t);e.body.push(i)}if(this.inModule)for(var n=0,a=Object.keys(this.undefinedExports);n<a.length;n+=1){var r=a[n];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var jr={kind:"loop"},vo={kind:"switch"};ke.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Pi.lastIndex=this.pos;var t=Pi.exec(this.input),i=this.pos+t[0].length,n=this.input.charCodeAt(i);if(n===91||n===92)return!0;if(e)return!1;if(n===123||n>55295&&n<56320)return!0;if(Hi(n,!0)){for(var a=i+1;wn(n=this.input.charCodeAt(a),!0);)++a;if(n===92||n>55295&&n<56320)return!0;var r=this.input.slice(i,a);if(!uo.test(r))return!0}return!1},ke.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Pi.lastIndex=this.pos;var e=Pi.exec(this.input),t=this.pos+e[0].length,i;return!ki.test(this.input.slice(this.pos,t))&&this.input.slice(t,t+8)==="function"&&(t+8===this.input.length||!(wn(i=this.input.charCodeAt(t+8))||i>55295&&i<56320))},ke.parseStatement=function(e,t,i){var n=this.type,a=this.startNode(),r;switch(this.isLet(e)&&(n=d._var,r="let"),n){case d._break:case d._continue:return this.parseBreakContinueStatement(a,n.keyword);case d._debugger:return this.parseDebuggerStatement(a);case d._do:return this.parseDoStatement(a);case d._for:return this.parseForStatement(a);case d._function:return e&&(this.strict||e!=="if"&&e!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1,!e);case d._class:return e&&this.unexpected(),this.parseClass(a,!0);case d._if:return this.parseIfStatement(a);case d._return:return this.parseReturnStatement(a);case d._switch:return this.parseSwitchStatement(a);case d._throw:return this.parseThrowStatement(a);case d._try:return this.parseTryStatement(a);case d._const:case d._var:return r=r||this.value,e&&r!=="var"&&this.unexpected(),this.parseVarStatement(a,r);case d._while:return this.parseWhileStatement(a);case d._with:return this.parseWithStatement(a);case d.braceL:return this.parseBlock(!0,a);case d.semi:return this.parseEmptyStatement(a);case d._export:case d._import:if(this.options.ecmaVersion>10&&n===d._import){Pi.lastIndex=this.pos;var s=Pi.exec(this.input),f=this.pos+s[0].length,h=this.input.charCodeAt(f);if(h===40||h===46)return this.parseExpressionStatement(a,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),n===d._import?this.parseImport(a):this.parseExport(a,i);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(a,!0,!e);var p=this.value,_=this.parseExpression();return n===d.name&&_.type==="Identifier"&&this.eat(d.colon)?this.parseLabeledStatement(a,p,_,e):this.parseExpressionStatement(a,_)}},ke.parseBreakContinueStatement=function(e,t){var i=t==="break";this.next(),this.eat(d.semi)||this.insertSemicolon()?e.label=null:this.type!==d.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var a=this.labels[n];if((e.label==null||a.name===e.label.name)&&(a.kind!=null&&(i||a.kind==="loop")||e.label&&i))break}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,i?"BreakStatement":"ContinueStatement")},ke.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},ke.parseDoStatement=function(e){return this.next(),this.labels.push(jr),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(d._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(d.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},ke.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(jr),this.enterScope(0),this.expect(d.parenL),this.type===d.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var i=this.isLet();if(this.type===d._var||this.type===d._const||i){var n=this.startNode(),a=i?"let":this.value;return this.next(),this.parseVar(n,!0,a),this.finishNode(n,"VariableDeclaration"),(this.type===d._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&n.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===d._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,n)):(t>-1&&this.unexpected(t),this.parseFor(e,n))}var r=this.isContextual("let"),s=!1,f=this.containsEsc,h=new ir,p=this.start,_=t>-1?this.parseExprSubscripts(h,"await"):this.parseExpression(!0,h);return this.type===d._in||(s=this.options.ecmaVersion>=6&&this.isContextual("of"))?(t>-1?(this.type===d._in&&this.unexpected(t),e.await=!0):s&&this.options.ecmaVersion>=8&&(_.start===p&&!f&&_.type==="Identifier"&&_.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(e.await=!1)),r&&s&&this.raise(_.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(_,!1,h),this.checkLValPattern(_),this.parseForIn(e,_)):(this.checkExpressionErrors(h,!0),t>-1&&this.unexpected(t),this.parseFor(e,_))},ke.parseFunctionStatement=function(e,t,i){return this.next(),this.parseFunction(e,qn|(i?0:zr),!1,t)},ke.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(d._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},ke.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(d.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},ke.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(d.braceL),this.labels.push(vo),this.enterScope(0);for(var t,i=!1;this.type!==d.braceR;)if(this.type===d._case||this.type===d._default){var n=this.type===d._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,t.test=null),this.expect(d.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},ke.parseThrowStatement=function(e){return this.next(),ki.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var wo=[];ke.parseCatchClauseParam=function(){var e=this.parseBindingAtom(),t=e.type==="Identifier";return this.enterScope(t?Ts:0),this.checkLValPattern(e,t?qs:Yi),this.expect(d.parenR),e},ke.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===d._catch){var t=this.startNode();this.next(),this.eat(d.parenL)?t.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0)),t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(d._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},ke.parseVarStatement=function(e,t,i){return this.next(),this.parseVar(e,!1,t,i),this.semicolon(),this.finishNode(e,"VariableDeclaration")},ke.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(jr),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},ke.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},ke.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},ke.parseLabeledStatement=function(e,t,i,n){for(var a=0,r=this.labels;a<r.length;a+=1){var s=r[a];s.name===t&&this.raise(i.start,"Label '"+t+"' is already declared")}for(var f=this.type.isLoop?"loop":this.type===d._switch?"switch":null,h=this.labels.length-1;h>=0;h--){var p=this.labels[h];if(p.statementStart===e.start)p.statementStart=this.start,p.kind=f;else break}return this.labels.push({name:t,kind:f,statementStart:this.start}),e.body=this.parseStatement(n?n.indexOf("label")===-1?n+"label":n:"label"),this.labels.pop(),e.label=i,this.finishNode(e,"LabeledStatement")},ke.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},ke.parseBlock=function(e,t,i){for(e===void 0&&(e=!0),t===void 0&&(t=this.startNode()),t.body=[],this.expect(d.braceL),e&&this.enterScope(0);this.type!==d.braceR;){var n=this.parseStatement(null);t.body.push(n)}return i&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},ke.parseFor=function(e,t){return e.init=t,this.expect(d.semi),e.test=this.type===d.semi?null:this.parseExpression(),this.expect(d.semi),e.update=this.type===d.parenR?null:this.parseExpression(),this.expect(d.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},ke.parseForIn=function(e,t){var i=this.type===d._in;return this.next(),t.type==="VariableDeclaration"&&t.declarations[0].init!=null&&(!i||this.options.ecmaVersion<8||this.strict||t.kind!=="var"||t.declarations[0].id.type!=="Identifier")&&this.raise(t.start,(i?"for-in":"for-of")+" loop variable declaration may not have an initializer"),e.left=t,e.right=i?this.parseExpression():this.parseMaybeAssign(),this.expect(d.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,i?"ForInStatement":"ForOfStatement")},ke.parseVar=function(e,t,i,n){for(e.declarations=[],e.kind=i;;){var a=this.startNode();if(this.parseVarId(a,i),this.eat(d.eq)?a.init=this.parseMaybeAssign(t):!n&&i==="const"&&!(this.type===d._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!n&&a.id.type!=="Identifier"&&!(t&&(this.type===d._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):a.init=null,e.declarations.push(this.finishNode(a,"VariableDeclarator")),!this.eat(d.comma))break}return e},ke.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLValPattern(e.id,t==="var"?Dr:Yi,!1)};var qn=1,zr=2,Vs=4;ke.parseFunction=function(e,t,i,n,a){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===d.star&&t&zr&&this.unexpected(),e.generator=this.eat(d.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&qn&&(e.id=t&Vs&&this.type!==d.name?null:this.parseIdent(),e.id&&!(t&zr)&&this.checkLValSimple(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?Dr:Yi:Os));var r=this.yieldPos,s=this.awaitPos,f=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Br(e.async,e.generator)),t&qn||(e.id=this.type===d.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,i,!1,a),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=f,this.finishNode(e,t&qn?"FunctionDeclaration":"FunctionExpression")},ke.parseFunctionParams=function(e){this.expect(d.parenL),e.params=this.parseBindingList(d.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ke.parseClass=function(e,t){this.next();var i=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var n=this.enterClassBody(),a=this.startNode(),r=!1;for(a.body=[],this.expect(d.braceL);this.type!==d.braceR;){var s=this.parseClassElement(e.superClass!==null);s&&(a.body.push(s),s.type==="MethodDefinition"&&s.kind==="constructor"?(r&&this.raiseRecoverable(s.start,"Duplicate constructor in the same class"),r=!0):s.key&&s.key.type==="PrivateIdentifier"&&No(n,s)&&this.raiseRecoverable(s.key.start,"Identifier '#"+s.key.name+"' has already been declared"))}return this.strict=i,this.next(),e.body=this.finishNode(a,"ClassBody"),this.exitClassBody(),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},ke.parseClassElement=function(e){if(this.eat(d.semi))return null;var t=this.options.ecmaVersion,i=this.startNode(),n="",a=!1,r=!1,s="method",f=!1;if(this.eatContextual("static")){if(t>=13&&this.eat(d.braceL))return this.parseClassStaticBlock(i),i;this.isClassElementNameStart()||this.type===d.star?f=!0:n="static"}if(i.static=f,!n&&t>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===d.star)&&!this.canInsertSemicolon()?r=!0:n="async"),!n&&(t>=9||!r)&&this.eat(d.star)&&(a=!0),!n&&!r&&!a){var h=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?s=h:n=h)}if(n?(i.computed=!1,i.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),i.key.name=n,this.finishNode(i.key,"Identifier")):this.parseClassElementName(i),t<13||this.type===d.parenL||s!=="method"||a||r){var p=!i.static&&nr(i,"constructor"),_=p&&e;p&&s!=="method"&&this.raise(i.key.start,"Constructor can't have get/set modifier"),i.kind=p?"constructor":s,this.parseClassMethod(i,a,r,_)}else this.parseClassField(i);return i},ke.isClassElementNameStart=function(){return this.type===d.name||this.type===d.privateId||this.type===d.num||this.type===d.string||this.type===d.bracketL||this.type.keyword},ke.parseClassElementName=function(e){this.type===d.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),e.computed=!1,e.key=this.parsePrivateIdent()):this.parsePropertyName(e)},ke.parseClassMethod=function(e,t,i,n){var a=e.key;e.kind==="constructor"?(t&&this.raise(a.start,"Constructor can't be a generator"),i&&this.raise(a.start,"Constructor can't be an async method")):e.static&&nr(e,"prototype")&&this.raise(a.start,"Classes may not have a static property named prototype");var r=e.value=this.parseMethod(t,i,n);return e.kind==="get"&&r.params.length!==0&&this.raiseRecoverable(r.start,"getter should have no params"),e.kind==="set"&&r.params.length!==1&&this.raiseRecoverable(r.start,"setter should have exactly one param"),e.kind==="set"&&r.params[0].type==="RestElement"&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(e,"MethodDefinition")},ke.parseClassField=function(e){if(nr(e,"constructor")?this.raise(e.key.start,"Classes can't have a field named 'constructor'"):e.static&&nr(e,"prototype")&&this.raise(e.key.start,"Classes can't have a static field named 'prototype'"),this.eat(d.eq)){var t=this.currentThisScope(),i=t.inClassFieldInit;t.inClassFieldInit=!0,e.value=this.parseMaybeAssign(),t.inClassFieldInit=i}else e.value=null;return this.semicolon(),this.finishNode(e,"PropertyDefinition")},ke.parseClassStaticBlock=function(e){e.body=[];var t=this.labels;for(this.labels=[],this.enterScope(On|Vr);this.type!==d.braceR;){var i=this.parseStatement(null);e.body.push(i)}return this.next(),this.exitScope(),this.labels=t,this.finishNode(e,"StaticBlock")},ke.parseClassId=function(e,t){this.type===d.name?(e.id=this.parseIdent(),t&&this.checkLValSimple(e.id,Yi,!1)):(t===!0&&this.unexpected(),e.id=null)},ke.parseClassSuper=function(e){e.superClass=this.eat(d._extends)?this.parseExprSubscripts(null,!1):null},ke.enterClassBody=function(){var e={declared:Object.create(null),used:[]};return this.privateNameStack.push(e),e.declared},ke.exitClassBody=function(){var e=this.privateNameStack.pop(),t=e.declared,i=e.used;if(this.options.checkPrivateFields)for(var n=this.privateNameStack.length,a=n===0?null:this.privateNameStack[n-1],r=0;r<i.length;++r){var s=i[r];kn(t,s.name)||(a?a.used.push(s):this.raiseRecoverable(s.start,"Private field '#"+s.name+"' must be declared in an enclosing class"))}};function No(e,t){var i=t.key.name,n=e[i],a="true";return t.type==="MethodDefinition"&&(t.kind==="get"||t.kind==="set")&&(a=(t.static?"s":"i")+t.kind),n==="iget"&&a==="iset"||n==="iset"&&a==="iget"||n==="sget"&&a==="sset"||n==="sset"&&a==="sget"?(e[i]="true",!1):n?!0:(e[i]=a,!1)}function nr(e,t){var i=e.computed,n=e.key;return!i&&(n.type==="Identifier"&&n.name===t||n.type==="Literal"&&n.value===t)}ke.parseExportAllDeclaration=function(e,t){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseModuleExportName(),this.checkExport(t,e.exported,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==d.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ExportAllDeclaration")},ke.parseExport=function(e,t){if(this.next(),this.eat(d.star))return this.parseExportAllDeclaration(e,t);if(this.eat(d._default))return this.checkExport(t,"default",this.lastTokStart),e.declaration=this.parseExportDefaultDeclaration(),this.finishNode(e,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())e.declaration=this.parseExportDeclaration(e),e.declaration.type==="VariableDeclaration"?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==d.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause());else{for(var i=0,n=e.specifiers;i<n.length;i+=1){var a=n[i];this.checkUnreserved(a.local),this.checkLocalExport(a.local),a.local.type==="Literal"&&this.raise(a.local.start,"A string literal cannot be used as an exported binding without `from`.")}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},ke.parseExportDeclaration=function(e){return this.parseStatement(null)},ke.parseExportDefaultDeclaration=function(){var e;if(this.type===d._function||(e=this.isAsyncFunction())){var t=this.startNode();return this.next(),e&&this.next(),this.parseFunction(t,qn|Vs,!1,e)}else if(this.type===d._class){var i=this.startNode();return this.parseClass(i,"nullableID")}else{var n=this.parseMaybeAssign();return this.semicolon(),n}},ke.checkExport=function(e,t,i){e&&(typeof t!="string"&&(t=t.type==="Identifier"?t.name:t.value),kn(e,t)&&this.raiseRecoverable(i,"Duplicate export '"+t+"'"),e[t]=!0)},ke.checkPatternExport=function(e,t){var i=t.type;if(i==="Identifier")this.checkExport(e,t,t.start);else if(i==="ObjectPattern")for(var n=0,a=t.properties;n<a.length;n+=1){var r=a[n];this.checkPatternExport(e,r)}else if(i==="ArrayPattern")for(var s=0,f=t.elements;s<f.length;s+=1){var h=f[s];h&&this.checkPatternExport(e,h)}else i==="Property"?this.checkPatternExport(e,t.value):i==="AssignmentPattern"?this.checkPatternExport(e,t.left):i==="RestElement"&&this.checkPatternExport(e,t.argument)},ke.checkVariableExport=function(e,t){if(e)for(var i=0,n=t;i<n.length;i+=1){var a=n[i];this.checkPatternExport(e,a.id)}},ke.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ke.parseExportSpecifier=function(e){var t=this.startNode();return t.local=this.parseModuleExportName(),t.exported=this.eatContextual("as")?this.parseModuleExportName():t.local,this.checkExport(e,t.exported,t.exported.start),this.finishNode(t,"ExportSpecifier")},ke.parseExportSpecifiers=function(e){var t=[],i=!0;for(this.expect(d.braceL);!this.eat(d.braceR);){if(i)i=!1;else if(this.expect(d.comma),this.afterTrailingComma(d.braceR))break;t.push(this.parseExportSpecifier(e))}return t},ke.parseImport=function(e){return this.next(),this.type===d.string?(e.specifiers=wo,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===d.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},ke.parseImportSpecifier=function(){var e=this.startNode();return e.imported=this.parseModuleExportName(),this.eatContextual("as")?e.local=this.parseIdent():(this.checkUnreserved(e.imported),e.local=e.imported),this.checkLValSimple(e.local,Yi),this.finishNode(e,"ImportSpecifier")},ke.parseImportDefaultSpecifier=function(){var e=this.startNode();return e.local=this.parseIdent(),this.checkLValSimple(e.local,Yi),this.finishNode(e,"ImportDefaultSpecifier")},ke.parseImportNamespaceSpecifier=function(){var e=this.startNode();return this.next(),this.expectContextual("as"),e.local=this.parseIdent(),this.checkLValSimple(e.local,Yi),this.finishNode(e,"ImportNamespaceSpecifier")},ke.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===d.name&&(e.push(this.parseImportDefaultSpecifier()),!this.eat(d.comma)))return e;if(this.type===d.star)return e.push(this.parseImportNamespaceSpecifier()),e;for(this.expect(d.braceL);!this.eat(d.braceR);){if(t)t=!1;else if(this.expect(d.comma),this.afterTrailingComma(d.braceR))break;e.push(this.parseImportSpecifier())}return e},ke.parseWithClause=function(){var e=[];if(!this.eat(d._with))return e;this.expect(d.braceL);for(var t={},i=!0;!this.eat(d.braceR);){if(i)i=!1;else if(this.expect(d.comma),this.afterTrailingComma(d.braceR))break;var n=this.parseImportAttribute(),a=n.key.type==="Identifier"?n.key.name:n.key.value;kn(t,a)&&this.raiseRecoverable(n.key.start,"Duplicate attribute key '"+a+"'"),t[a]=!0,e.push(n)}return e},ke.parseImportAttribute=function(){var e=this.startNode();return e.key=this.type===d.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(d.colon),this.type!==d.string&&this.unexpected(),e.value=this.parseExprAtom(),this.finishNode(e,"ImportAttribute")},ke.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===d.string){var e=this.parseLiteral(this.value);return yo.test(e.value)&&this.raise(e.start,"An export name cannot include a lone surrogate."),e}return this.parseIdent(!0)},ke.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},ke.isDirectiveCandidate=function(e){return this.options.ecmaVersion>=5&&e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&typeof e.expression.value=="string"&&(this.input[e.start]==='"'||this.input[e.start]==="'")};var Si=Ht.prototype;Si.toAssignable=function(e,t,i){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&e.name==="await"&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var n=0,a=e.properties;n<a.length;n+=1){var r=a[n];this.toAssignable(r,t),r.type==="RestElement"&&(r.argument.type==="ArrayPattern"||r.argument.type==="ObjectPattern")&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":e.kind!=="init"&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),e.argument.type==="AssignmentPattern"&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":e.operator!=="="&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,i);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return e},Si.toAssignableList=function(e,t){for(var i=e.length,n=0;n<i;n++){var a=e[n];a&&this.toAssignable(a,t)}if(i){var r=e[i-1];this.options.ecmaVersion===6&&t&&r&&r.type==="RestElement"&&r.argument.type!=="Identifier"&&this.unexpected(r.argument.start)}return e},Si.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},Si.parseRestBinding=function(){var e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==d.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},Si.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case d.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(d.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case d.braceL:return this.parseObj(!0)}return this.parseIdent()},Si.parseBindingList=function(e,t,i,n){for(var a=[],r=!0;!this.eat(e);)if(r?r=!1:this.expect(d.comma),t&&this.type===d.comma)a.push(null);else{if(i&&this.afterTrailingComma(e))break;if(this.type===d.ellipsis){var s=this.parseRestBinding();this.parseBindingListItem(s),a.push(s),this.type===d.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}else a.push(this.parseAssignableListItem(n))}return a},Si.parseAssignableListItem=function(e){var t=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(t),t},Si.parseBindingListItem=function(e){return e},Si.parseMaybeDefault=function(e,t,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(d.eq))return i;var n=this.startNodeAt(e,t);return n.left=i,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},Si.checkLValSimple=function(e,t,i){t===void 0&&(t=tr);var n=t!==tr;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(n?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(t===Yi&&e.name==="let"&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),i&&(kn(i,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),i[e.name]=!0),t!==Ls&&this.declareName(e.name,t,e.start));break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":n&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ParenthesizedExpression":return n&&this.raiseRecoverable(e.start,"Binding parenthesized expression"),this.checkLValSimple(e.expression,t,i);default:this.raise(e.start,(n?"Binding":"Assigning to")+" rvalue")}},Si.checkLValPattern=function(e,t,i){switch(t===void 0&&(t=tr),e.type){case"ObjectPattern":for(var n=0,a=e.properties;n<a.length;n+=1){var r=a[n];this.checkLValInnerPattern(r,t,i)}break;case"ArrayPattern":for(var s=0,f=e.elements;s<f.length;s+=1){var h=f[s];h&&this.checkLValInnerPattern(h,t,i)}break;default:this.checkLValSimple(e,t,i)}},Si.checkLValInnerPattern=function(e,t,i){switch(t===void 0&&(t=tr),e.type){case"Property":this.checkLValInnerPattern(e.value,t,i);break;case"AssignmentPattern":this.checkLValPattern(e.left,t,i);break;case"RestElement":this.checkLValPattern(e.argument,t,i);break;default:this.checkLValPattern(e,t,i)}};var Ti=function(t,i,n,a,r){this.token=t,this.isExpr=!!i,this.preserveSpace=!!n,this.override=a,this.generator=!!r},Mt={b_stat:new Ti("{",!1),b_expr:new Ti("{",!0),b_tmpl:new Ti("${",!1),p_stat:new Ti("(",!1),p_expr:new Ti("(",!0),q_tmpl:new Ti("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new Ti("function",!1),f_expr:new Ti("function",!0),f_expr_gen:new Ti("function",!0,!1,null,!0),f_gen:new Ti("function",!1,!1,null,!0)},Sn=Ht.prototype;Sn.initialContext=function(){return[Mt.b_stat]},Sn.curContext=function(){return this.context[this.context.length-1]},Sn.braceIsBlock=function(e){var t=this.curContext();return t===Mt.f_expr||t===Mt.f_stat?!0:e===d.colon&&(t===Mt.b_stat||t===Mt.b_expr)?!t.isExpr:e===d._return||e===d.name&&this.exprAllowed?ki.test(this.input.slice(this.lastTokEnd,this.start)):e===d._else||e===d.semi||e===d.eof||e===d.parenR||e===d.arrow?!0:e===d.braceL?t===Mt.b_stat:e===d._var||e===d._const||e===d.name?!1:!this.exprAllowed},Sn.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if(t.token==="function")return t.generator}return!1},Sn.updateContext=function(e){var t,i=this.type;i.keyword&&e===d.dot?this.exprAllowed=!1:(t=i.updateContext)?t.call(this,e):this.exprAllowed=i.beforeExpr},Sn.overrideContext=function(e){this.curContext()!==e&&(this.context[this.context.length-1]=e)},d.parenR.updateContext=d.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var e=this.context.pop();e===Mt.b_stat&&this.curContext().token==="function"&&(e=this.context.pop()),this.exprAllowed=!e.isExpr},d.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?Mt.b_stat:Mt.b_expr),this.exprAllowed=!0},d.dollarBraceL.updateContext=function(){this.context.push(Mt.b_tmpl),this.exprAllowed=!0},d.parenL.updateContext=function(e){var t=e===d._if||e===d._for||e===d._with||e===d._while;this.context.push(t?Mt.p_stat:Mt.p_expr),this.exprAllowed=!0},d.incDec.updateContext=function(){},d._function.updateContext=d._class.updateContext=function(e){e.beforeExpr&&e!==d._else&&!(e===d.semi&&this.curContext()!==Mt.p_stat)&&!(e===d._return&&ki.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===d.colon||e===d.braceL)&&this.curContext()===Mt.b_stat)?this.context.push(Mt.f_expr):this.context.push(Mt.f_stat),this.exprAllowed=!1},d.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0},d.backQuote.updateContext=function(){this.curContext()===Mt.q_tmpl?this.context.pop():this.context.push(Mt.q_tmpl),this.exprAllowed=!1},d.star.updateContext=function(e){if(e===d._function){var t=this.context.length-1;this.context[t]===Mt.f_expr?this.context[t]=Mt.f_expr_gen:this.context[t]=Mt.f_gen}this.exprAllowed=!0},d.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==d.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var Le=Ht.prototype;Le.checkPropClash=function(e,t,i){if(!(this.options.ecmaVersion>=9&&e.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n=e.key,a;switch(n.type){case"Identifier":a=n.name;break;case"Literal":a=String(n.value);break;default:return}var r=e.kind;if(this.options.ecmaVersion>=6){a==="__proto__"&&r==="init"&&(t.proto&&(i?i.doubleProto<0&&(i.doubleProto=n.start):this.raiseRecoverable(n.start,"Redefinition of __proto__ property")),t.proto=!0);return}a="$"+a;var s=t[a];if(s){var f;r==="init"?f=this.strict&&s.init||s.get||s.set:f=s.init||s[r],f&&this.raiseRecoverable(n.start,"Redefinition of property")}else s=t[a]={init:!1,get:!1,set:!1};s[r]=!0}},Le.parseExpression=function(e,t){var i=this.start,n=this.startLoc,a=this.parseMaybeAssign(e,t);if(this.type===d.comma){var r=this.startNodeAt(i,n);for(r.expressions=[a];this.eat(d.comma);)r.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(r,"SequenceExpression")}return a},Le.parseMaybeAssign=function(e,t,i){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var n=!1,a=-1,r=-1,s=-1;t?(a=t.parenthesizedAssign,r=t.trailingComma,s=t.doubleProto,t.parenthesizedAssign=t.trailingComma=-1):(t=new ir,n=!0);var f=this.start,h=this.startLoc;(this.type===d.parenL||this.type===d.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=e==="await");var p=this.parseMaybeConditional(e,t);if(i&&(p=i.call(this,p,f,h)),this.type.isAssign){var _=this.startNodeAt(f,h);return _.operator=this.value,this.type===d.eq&&(p=this.toAssignable(p,!1,t)),n||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=p.start&&(t.shorthandAssign=-1),this.type===d.eq?this.checkLValPattern(p):this.checkLValSimple(p),_.left=p,this.next(),_.right=this.parseMaybeAssign(e),s>-1&&(t.doubleProto=s),this.finishNode(_,"AssignmentExpression")}else n&&this.checkExpressionErrors(t,!0);return a>-1&&(t.parenthesizedAssign=a),r>-1&&(t.trailingComma=r),p},Le.parseMaybeConditional=function(e,t){var i=this.start,n=this.startLoc,a=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return a;if(this.eat(d.question)){var r=this.startNodeAt(i,n);return r.test=a,r.consequent=this.parseMaybeAssign(),this.expect(d.colon),r.alternate=this.parseMaybeAssign(e),this.finishNode(r,"ConditionalExpression")}return a},Le.parseExprOps=function(e,t){var i=this.start,n=this.startLoc,a=this.parseMaybeUnary(t,!1,!1,e);return this.checkExpressionErrors(t)||a.start===i&&a.type==="ArrowFunctionExpression"?a:this.parseExprOp(a,i,n,-1,e)},Le.parseExprOp=function(e,t,i,n,a){var r=this.type.binop;if(r!=null&&(!a||this.type!==d._in)&&r>n){var s=this.type===d.logicalOR||this.type===d.logicalAND,f=this.type===d.coalesce;f&&(r=d.logicalAND.binop);var h=this.value;this.next();var p=this.start,_=this.startLoc,E=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,a),p,_,r,a),z=this.buildBinary(t,i,e,E,h,s||f);return(s&&this.type===d.coalesce||f&&(this.type===d.logicalOR||this.type===d.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(z,t,i,n,a)}return e},Le.buildBinary=function(e,t,i,n,a,r){n.type==="PrivateIdentifier"&&this.raise(n.start,"Private identifier can only be left side of binary expression");var s=this.startNodeAt(e,t);return s.left=i,s.operator=a,s.right=n,this.finishNode(s,r?"LogicalExpression":"BinaryExpression")},Le.parseMaybeUnary=function(e,t,i,n){var a=this.start,r=this.startLoc,s;if(this.isContextual("await")&&this.canAwait)s=this.parseAwait(n),t=!0;else if(this.type.prefix){var f=this.startNode(),h=this.type===d.incDec;f.operator=this.value,f.prefix=!0,this.next(),f.argument=this.parseMaybeUnary(null,!0,h,n),this.checkExpressionErrors(e,!0),h?this.checkLValSimple(f.argument):this.strict&&f.operator==="delete"&&$s(f.argument)?this.raiseRecoverable(f.start,"Deleting local variable in strict mode"):f.operator==="delete"&&Ur(f.argument)?this.raiseRecoverable(f.start,"Private fields can not be deleted"):t=!0,s=this.finishNode(f,h?"UpdateExpression":"UnaryExpression")}else if(!t&&this.type===d.privateId)(n||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),s=this.parsePrivateIdent(),this.type!==d._in&&this.unexpected();else{if(s=this.parseExprSubscripts(e,n),this.checkExpressionErrors(e))return s;for(;this.type.postfix&&!this.canInsertSemicolon();){var p=this.startNodeAt(a,r);p.operator=this.value,p.prefix=!1,p.argument=s,this.checkLValSimple(s),this.next(),s=this.finishNode(p,"UpdateExpression")}}if(!i&&this.eat(d.starstar))if(t)this.unexpected(this.lastTokStart);else return this.buildBinary(a,r,s,this.parseMaybeUnary(null,!1,!1,n),"**",!1);else return s};function $s(e){return e.type==="Identifier"||e.type==="ParenthesizedExpression"&&$s(e.expression)}function Ur(e){return e.type==="MemberExpression"&&e.property.type==="PrivateIdentifier"||e.type==="ChainExpression"&&Ur(e.expression)||e.type==="ParenthesizedExpression"&&Ur(e.expression)}Le.parseExprSubscripts=function(e,t){var i=this.start,n=this.startLoc,a=this.parseExprAtom(e,t);if(a.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return a;var r=this.parseSubscripts(a,i,n,!1,t);return e&&r.type==="MemberExpression"&&(e.parenthesizedAssign>=r.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=r.start&&(e.parenthesizedBind=-1),e.trailingComma>=r.start&&(e.trailingComma=-1)),r},Le.parseSubscripts=function(e,t,i,n,a){for(var r=this.options.ecmaVersion>=8&&e.type==="Identifier"&&e.name==="async"&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,s=!1;;){var f=this.parseSubscript(e,t,i,n,r,s,a);if(f.optional&&(s=!0),f===e||f.type==="ArrowFunctionExpression"){if(s){var h=this.startNodeAt(t,i);h.expression=f,f=this.finishNode(h,"ChainExpression")}return f}e=f}},Le.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(d.arrow)},Le.parseSubscriptAsyncArrow=function(e,t,i,n){return this.parseArrowExpression(this.startNodeAt(e,t),i,!0,n)},Le.parseSubscript=function(e,t,i,n,a,r,s){var f=this.options.ecmaVersion>=11,h=f&&this.eat(d.questionDot);n&&h&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var p=this.eat(d.bracketL);if(p||h&&this.type!==d.parenL&&this.type!==d.backQuote||this.eat(d.dot)){var _=this.startNodeAt(t,i);_.object=e,p?(_.property=this.parseExpression(),this.expect(d.bracketR)):this.type===d.privateId&&e.type!=="Super"?_.property=this.parsePrivateIdent():_.property=this.parseIdent(this.options.allowReserved!=="never"),_.computed=!!p,f&&(_.optional=h),e=this.finishNode(_,"MemberExpression")}else if(!n&&this.eat(d.parenL)){var E=new ir,z=this.yieldPos,C=this.awaitPos,v=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var S=this.parseExprList(d.parenR,this.options.ecmaVersion>=8,!1,E);if(a&&!h&&this.shouldParseAsyncArrow())return this.checkPatternErrors(E,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=z,this.awaitPos=C,this.awaitIdentPos=v,this.parseSubscriptAsyncArrow(t,i,S,s);this.checkExpressionErrors(E,!0),this.yieldPos=z||this.yieldPos,this.awaitPos=C||this.awaitPos,this.awaitIdentPos=v||this.awaitIdentPos;var U=this.startNodeAt(t,i);U.callee=e,U.arguments=S,f&&(U.optional=h),e=this.finishNode(U,"CallExpression")}else if(this.type===d.backQuote){(h||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var V=this.startNodeAt(t,i);V.tag=e,V.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(V,"TaggedTemplateExpression")}return e},Le.parseExprAtom=function(e,t,i){this.type===d.slash&&this.readRegexp();var n,a=this.potentialArrowAt===this.start;switch(this.type){case d._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),n=this.startNode(),this.next(),this.type===d.parenL&&!this.allowDirectSuper&&this.raise(n.start,"super() call outside constructor of a subclass"),this.type!==d.dot&&this.type!==d.bracketL&&this.type!==d.parenL&&this.unexpected(),this.finishNode(n,"Super");case d._this:return n=this.startNode(),this.next(),this.finishNode(n,"ThisExpression");case d.name:var r=this.start,s=this.startLoc,f=this.containsEsc,h=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!f&&h.name==="async"&&!this.canInsertSemicolon()&&this.eat(d._function))return this.overrideContext(Mt.f_expr),this.parseFunction(this.startNodeAt(r,s),0,!1,!0,t);if(a&&!this.canInsertSemicolon()){if(this.eat(d.arrow))return this.parseArrowExpression(this.startNodeAt(r,s),[h],!1,t);if(this.options.ecmaVersion>=8&&h.name==="async"&&this.type===d.name&&!f&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return h=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(d.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,s),[h],!0,t)}return h;case d.regexp:var p=this.value;return n=this.parseLiteral(p.value),n.regex={pattern:p.pattern,flags:p.flags},n;case d.num:case d.string:return this.parseLiteral(this.value);case d._null:case d._true:case d._false:return n=this.startNode(),n.value=this.type===d._null?null:this.type===d._true,n.raw=this.type.keyword,this.next(),this.finishNode(n,"Literal");case d.parenL:var _=this.start,E=this.parseParenAndDistinguishExpression(a,t);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(E)&&(e.parenthesizedAssign=_),e.parenthesizedBind<0&&(e.parenthesizedBind=_)),E;case d.bracketL:return n=this.startNode(),this.next(),n.elements=this.parseExprList(d.bracketR,!0,!0,e),this.finishNode(n,"ArrayExpression");case d.braceL:return this.overrideContext(Mt.b_expr),this.parseObj(!1,e);case d._function:return n=this.startNode(),this.next(),this.parseFunction(n,0);case d._class:return this.parseClass(this.startNode(),!1);case d._new:return this.parseNew();case d.backQuote:return this.parseTemplate();case d._import:return this.options.ecmaVersion>=11?this.parseExprImport(i):this.unexpected();default:return this.parseExprAtomDefault()}},Le.parseExprAtomDefault=function(){this.unexpected()},Le.parseExprImport=function(e){var t=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===d.parenL&&!e)return this.parseDynamicImport(t);if(this.type===d.dot){var i=this.startNodeAt(t.start,t.loc&&t.loc.start);return i.name="import",t.meta=this.finishNode(i,"Identifier"),this.parseImportMeta(t)}else this.unexpected()},Le.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(d.parenR)?e.options=null:(this.expect(d.comma),this.afterTrailingComma(d.parenR)?e.options=null:(e.options=this.parseMaybeAssign(),this.eat(d.parenR)||(this.expect(d.comma),this.afterTrailingComma(d.parenR)||this.unexpected())));else if(!this.eat(d.parenR)){var t=this.start;this.eat(d.comma)&&this.eat(d.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},Le.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="meta"&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},Le.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),t.raw.charCodeAt(t.raw.length-1)===110&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},Le.parseParenExpression=function(){this.expect(d.parenL);var e=this.parseExpression();return this.expect(d.parenR),e},Le.shouldParseArrow=function(e){return!this.canInsertSemicolon()},Le.parseParenAndDistinguishExpression=function(e,t){var i=this.start,n=this.startLoc,a,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var s=this.start,f=this.startLoc,h=[],p=!0,_=!1,E=new ir,z=this.yieldPos,C=this.awaitPos,v;for(this.yieldPos=0,this.awaitPos=0;this.type!==d.parenR;)if(p?p=!1:this.expect(d.comma),r&&this.afterTrailingComma(d.parenR,!0)){_=!0;break}else if(this.type===d.ellipsis){v=this.start,h.push(this.parseParenItem(this.parseRestBinding())),this.type===d.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else h.push(this.parseMaybeAssign(!1,E,this.parseParenItem));var S=this.lastTokEnd,U=this.lastTokEndLoc;if(this.expect(d.parenR),e&&this.shouldParseArrow(h)&&this.eat(d.arrow))return this.checkPatternErrors(E,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=z,this.awaitPos=C,this.parseParenArrowList(i,n,h,t);(!h.length||_)&&this.unexpected(this.lastTokStart),v&&this.unexpected(v),this.checkExpressionErrors(E,!0),this.yieldPos=z||this.yieldPos,this.awaitPos=C||this.awaitPos,h.length>1?(a=this.startNodeAt(s,f),a.expressions=h,this.finishNodeAt(a,"SequenceExpression",S,U)):a=h[0]}else a=this.parseParenExpression();if(this.options.preserveParens){var V=this.startNodeAt(i,n);return V.expression=a,this.finishNode(V,"ParenthesizedExpression")}else return a},Le.parseParenItem=function(e){return e},Le.parseParenArrowList=function(e,t,i,n){return this.parseArrowExpression(this.startNodeAt(e,t),i,!1,n)};var ko=[];Le.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===d.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);t.name="new",e.meta=this.finishNode(t,"Identifier"),this.next();var i=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="target"&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),i&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(e.start,"'new.target' can only be used in functions and class static block"),this.finishNode(e,"MetaProperty")}var n=this.start,a=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),n,a,!0,!1),this.eat(d.parenL)?e.arguments=this.parseExprList(d.parenR,this.options.ecmaVersion>=8,!1):e.arguments=ko,this.finishNode(e,"NewExpression")},Le.parseTemplateElement=function(e){var t=e.isTagged,i=this.startNode();return this.type===d.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),i.tail=this.type===d.backQuote,this.finishNode(i,"TemplateElement")},Le.parseTemplate=function(e){e===void 0&&(e={});var t=e.isTagged;t===void 0&&(t=!1);var i=this.startNode();this.next(),i.expressions=[];var n=this.parseTemplateElement({isTagged:t});for(i.quasis=[n];!n.tail;)this.type===d.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(d.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(d.braceR),i.quasis.push(n=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(i,"TemplateLiteral")},Le.isAsyncProp=function(e){return!e.computed&&e.key.type==="Identifier"&&e.key.name==="async"&&(this.type===d.name||this.type===d.num||this.type===d.string||this.type===d.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===d.star)&&!ki.test(this.input.slice(this.lastTokEnd,this.start))},Le.parseObj=function(e,t){var i=this.startNode(),n=!0,a={};for(i.properties=[],this.next();!this.eat(d.braceR);){if(n)n=!1;else if(this.expect(d.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(d.braceR))break;var r=this.parseProperty(e,t);e||this.checkPropClash(r,a,t),i.properties.push(r)}return this.finishNode(i,e?"ObjectPattern":"ObjectExpression")},Le.parseProperty=function(e,t){var i=this.startNode(),n,a,r,s;if(this.options.ecmaVersion>=9&&this.eat(d.ellipsis))return e?(i.argument=this.parseIdent(!1),this.type===d.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(i,"RestElement")):(i.argument=this.parseMaybeAssign(!1,t),this.type===d.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(i,"SpreadElement"));this.options.ecmaVersion>=6&&(i.method=!1,i.shorthand=!1,(e||t)&&(r=this.start,s=this.startLoc),e||(n=this.eat(d.star)));var f=this.containsEsc;return this.parsePropertyName(i),!e&&!f&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(i)?(a=!0,n=this.options.ecmaVersion>=9&&this.eat(d.star),this.parsePropertyName(i)):a=!1,this.parsePropertyValue(i,e,n,a,r,s,t,f),this.finishNode(i,"Property")},Le.parseGetterSetter=function(e){e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var t=e.kind==="get"?0:1;if(e.value.params.length!==t){var i=e.value.start;e.kind==="get"?this.raiseRecoverable(i,"getter should have no params"):this.raiseRecoverable(i,"setter should have exactly one param")}else e.kind==="set"&&e.value.params[0].type==="RestElement"&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")},Le.parsePropertyValue=function(e,t,i,n,a,r,s,f){(i||n)&&this.type===d.colon&&this.unexpected(),this.eat(d.colon)?(e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,s),e.kind="init"):this.options.ecmaVersion>=6&&this.type===d.parenL?(t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(i,n)):!t&&!f&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==="Identifier"&&(e.key.name==="get"||e.key.name==="set")&&this.type!==d.comma&&this.type!==d.braceR&&this.type!==d.eq?((i||n)&&this.unexpected(),this.parseGetterSetter(e)):this.options.ecmaVersion>=6&&!e.computed&&e.key.type==="Identifier"?((i||n)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=a),e.kind="init",t?e.value=this.parseMaybeDefault(a,r,this.copyNode(e.key)):this.type===d.eq&&s?(s.shorthandAssign<0&&(s.shorthandAssign=this.start),e.value=this.parseMaybeDefault(a,r,this.copyNode(e.key))):e.value=this.copyNode(e.key),e.shorthand=!0):this.unexpected()},Le.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(d.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(d.bracketR),e.key;e.computed=!1}return e.key=this.type===d.num||this.type===d.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Le.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},Le.parseMethod=function(e,t,i){var n=this.startNode(),a=this.yieldPos,r=this.awaitPos,s=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Br(t,n.generator)|Vr|(i?Rs:0)),this.expect(d.parenL),n.params=this.parseBindingList(d.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0,!1),this.yieldPos=a,this.awaitPos=r,this.awaitIdentPos=s,this.finishNode(n,"FunctionExpression")},Le.parseArrowExpression=function(e,t,i,n){var a=this.yieldPos,r=this.awaitPos,s=this.awaitIdentPos;return this.enterScope(Br(i,!1)|Ms),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!i),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1,n),this.yieldPos=a,this.awaitPos=r,this.awaitIdentPos=s,this.finishNode(e,"ArrowFunctionExpression")},Le.parseFunctionBody=function(e,t,i,n){var a=t&&this.type!==d.braceL,r=this.strict,s=!1;if(a)e.body=this.parseMaybeAssign(n),e.expression=!0,this.checkParams(e,!1);else{var f=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!r||f)&&(s=this.strictDirective(this.end),s&&f&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var h=this.labels;this.labels=[],s&&(this.strict=!0),this.checkParams(e,!r&&!s&&!t&&!i&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLValSimple(e.id,Ls),e.body=this.parseBlock(!1,void 0,s&&!r),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=h}this.exitScope()},Le.isSimpleParamList=function(e){for(var t=0,i=e;t<i.length;t+=1){var n=i[t];if(n.type!=="Identifier")return!1}return!0},Le.checkParams=function(e,t){for(var i=Object.create(null),n=0,a=e.params;n<a.length;n+=1){var r=a[n];this.checkLValInnerPattern(r,Dr,t?null:i)}},Le.parseExprList=function(e,t,i,n){for(var a=[],r=!0;!this.eat(e);){if(r)r=!1;else if(this.expect(d.comma),t&&this.afterTrailingComma(e))break;var s=void 0;i&&this.type===d.comma?s=null:this.type===d.ellipsis?(s=this.parseSpread(n),n&&this.type===d.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):s=this.parseMaybeAssign(!1,n),a.push(s)}return a},Le.checkUnreserved=function(e){var t=e.start,i=e.end,n=e.name;if(this.inGenerator&&n==="yield"&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&n==="await"&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&n==="arguments"&&this.raiseRecoverable(t,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(n==="arguments"||n==="await")&&this.raise(t,"Cannot use "+n+" in class static initialization block"),this.keywords.test(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),!(this.options.ecmaVersion<6&&this.input.slice(t,i).indexOf("\\")!==-1)){var a=this.strict?this.reservedWordsStrict:this.reservedWords;a.test(n)&&(!this.inAsync&&n==="await"&&this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+n+"' is reserved"))}},Le.parseIdent=function(e){var t=this.parseIdentNode();return this.next(!!e),this.finishNode(t,"Identifier"),e||(this.checkUnreserved(t),t.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t},Le.parseIdentNode=function(){var e=this.startNode();return this.type===d.name?e.name=this.value:this.type.keyword?(e.name=this.type.keyword,(e.name==="class"||e.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=d.name):this.unexpected(),e},Le.parsePrivateIdent=function(){var e=this.startNode();return this.type===d.privateId?e.name=this.value:this.unexpected(),this.next(),this.finishNode(e,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(e.start,"Private field '#"+e.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(e)),e},Le.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===d.semi||this.canInsertSemicolon()||this.type!==d.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(d.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},Le.parseAwait=function(e){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0,!1,e),this.finishNode(t,"AwaitExpression")};var rr=Ht.prototype;rr.raise=function(e,t){var i=Is(this.input,e);t+=" ("+i.line+":"+i.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=i,n.raisedAt=this.pos,n},rr.raiseRecoverable=rr.raise,rr.curPosition=function(){if(this.options.locations)return new Tn(this.curLine,this.pos-this.lineStart)};var sn=Ht.prototype,Po=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};sn.enterScope=function(e){this.scopeStack.push(new Po(e))},sn.exitScope=function(){this.scopeStack.pop()},sn.treatFunctionsAsVarInScope=function(e){return e.flags&Pn||!this.inModule&&e.flags&Rn},sn.declareName=function(e,t,i){var n=!1;if(t===Yi){var a=this.currentScope();n=a.lexical.indexOf(e)>-1||a.functions.indexOf(e)>-1||a.var.indexOf(e)>-1,a.lexical.push(e),this.inModule&&a.flags&Rn&&delete this.undefinedExports[e]}else if(t===qs){var r=this.currentScope();r.lexical.push(e)}else if(t===Os){var s=this.currentScope();this.treatFunctionsAsVar?n=s.lexical.indexOf(e)>-1:n=s.lexical.indexOf(e)>-1||s.var.indexOf(e)>-1,s.functions.push(e)}else for(var f=this.scopeStack.length-1;f>=0;--f){var h=this.scopeStack[f];if(h.lexical.indexOf(e)>-1&&!(h.flags&Ts&&h.lexical[0]===e)||!this.treatFunctionsAsVarInScope(h)&&h.functions.indexOf(e)>-1){n=!0;break}if(h.var.push(e),this.inModule&&h.flags&Rn&&delete this.undefinedExports[e],h.flags&$r)break}n&&this.raiseRecoverable(i,"Identifier '"+e+"' has already been declared")},sn.checkLocalExport=function(e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)},sn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},sn.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&$r)return t}},sn.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&$r&&!(t.flags&Ms))return t}};var sr=function(t,i,n){this.type="",this.start=i,this.end=0,t.options.locations&&(this.loc=new er(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[i,0])},Ln=Ht.prototype;Ln.startNode=function(){return new sr(this,this.start,this.startLoc)},Ln.startNodeAt=function(e,t){return new sr(this,e,t)};function Bs(e,t,i,n){return e.type=t,e.end=i,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=i),e}Ln.finishNode=function(e,t){return Bs.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Ln.finishNodeAt=function(e,t,i,n){return Bs.call(this,e,t,i,n)},Ln.copyNode=function(e){var t=new sr(this,e.start,this.startLoc);for(var i in e)t[i]=e[i];return t};var So="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",Ds="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",js=Ds+" Extended_Pictographic",zs=js,Us=zs+" EBase EComp EMod EPres ExtPict",Ws=Us,Co=Ws,Fo={9:Ds,10:js,11:zs,12:Us,13:Ws,14:Co},Io="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",Ao={9:"",10:"",11:"",12:"",13:"",14:Io},Qs="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Gs="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ks=Gs+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Hs=Ks+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Js=Hs+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Ys=Js+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",Eo=Ys+" "+So,Mo={9:Gs,10:Ks,11:Hs,12:Js,13:Ys,14:Eo},Xs={};function To(e){var t=Xs[e]={binary:rn(Fo[e]+" "+Qs),binaryOfStrings:rn(Ao[e]),nonBinary:{General_Category:rn(Qs),Script:rn(Mo[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}for(var Wr=0,Zs=[9,10,11,12,13,14];Wr<Zs.length;Wr+=1){var Ro=Zs[Wr];To(Ro)}var ye=Ht.prototype,ar=function(t,i){this.parent=t,this.base=i||this};ar.prototype.separatedFrom=function(t){for(var i=this;i;i=i.parent)for(var n=t;n;n=n.parent)if(i.base===n.base&&i!==n)return!0;return!1},ar.prototype.sibling=function(){return new ar(this.parent,this.base)};var $i=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":"")+(t.options.ecmaVersion>=13?"d":"")+(t.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Xs[t.options.ecmaVersion>=14?14:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};$i.prototype.reset=function(t,i,n){var a=n.indexOf("v")!==-1,r=n.indexOf("u")!==-1;this.start=t|0,this.source=i+"",this.flags=n,a&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=r&&this.parser.options.ecmaVersion>=9)},$i.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},$i.prototype.at=function(t,i){i===void 0&&(i=!1);var n=this.source,a=n.length;if(t>=a)return-1;var r=n.charCodeAt(t);if(!(i||this.switchU)||r<=55295||r>=57344||t+1>=a)return r;var s=n.charCodeAt(t+1);return s>=56320&&s<=57343?(r<<10)+s-56613888:r},$i.prototype.nextIndex=function(t,i){i===void 0&&(i=!1);var n=this.source,a=n.length;if(t>=a)return a;var r=n.charCodeAt(t),s;return!(i||this.switchU)||r<=55295||r>=57344||t+1>=a||(s=n.charCodeAt(t+1))<56320||s>57343?t+1:t+2},$i.prototype.current=function(t){return t===void 0&&(t=!1),this.at(this.pos,t)},$i.prototype.lookahead=function(t){return t===void 0&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},$i.prototype.advance=function(t){t===void 0&&(t=!1),this.pos=this.nextIndex(this.pos,t)},$i.prototype.eat=function(t,i){return i===void 0&&(i=!1),this.current(i)===t?(this.advance(i),!0):!1},$i.prototype.eatChars=function(t,i){i===void 0&&(i=!1);for(var n=this.pos,a=0,r=t;a<r.length;a+=1){var s=r[a],f=this.at(n,i);if(f===-1||f!==s)return!1;n=this.nextIndex(n,i)}return this.pos=n,!0},ye.validateRegExpFlags=function(e){for(var t=e.validFlags,i=e.flags,n=!1,a=!1,r=0;r<i.length;r++){var s=i.charAt(r);t.indexOf(s)===-1&&this.raise(e.start,"Invalid regular expression flag"),i.indexOf(s,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag"),s==="u"&&(n=!0),s==="v"&&(a=!0)}this.options.ecmaVersion>=15&&n&&a&&this.raise(e.start,"Invalid regular expression flag")};function Oo(e){for(var t in e)return!0;return!1}ye.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&Oo(e.groupNames)&&(e.switchN=!0,this.regexp_pattern(e))},ye.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames=Object.create(null),e.backReferenceNames.length=0,e.branchID=null,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,i=e.backReferenceNames;t<i.length;t+=1){var n=i[t];e.groupNames[n]||e.raise("Invalid named capture referenced")}},ye.regexp_disjunction=function(e){var t=this.options.ecmaVersion>=16;for(t&&(e.branchID=new ar(e.branchID,null)),this.regexp_alternative(e);e.eat(124);)t&&(e.branchID=e.branchID.sibling()),this.regexp_alternative(e);t&&(e.branchID=e.branchID.parent),this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},ye.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},ye.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1},ye.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!i,!0}return e.pos=t,!1},ye.regexp_eatQuantifier=function(e,t){return t===void 0&&(t=!1),this.regexp_eatQuantifierPrefix(e,t)?(e.eat(63),!0):!1},ye.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},ye.regexp_eatBracedQuantifier=function(e,t){var i=e.pos;if(e.eat(123)){var n=0,a=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(a=e.lastIntValue),e.eat(125)))return a!==-1&&a<n&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=i}return!1},ye.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},ye.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},ye.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)){if(this.options.ecmaVersion>=16){var i=this.regexp_eatModifiers(e),n=e.eat(45);if(i||n){for(var a=0;a<i.length;a++){var r=i.charAt(a);i.indexOf(r,a+1)>-1&&e.raise("Duplicate regular expression modifiers")}if(n){var s=this.regexp_eatModifiers(e);!i&&!s&&e.current()===58&&e.raise("Invalid regular expression modifiers");for(var f=0;f<s.length;f++){var h=s.charAt(f);(s.indexOf(h,f+1)>-1||i.indexOf(h)>-1)&&e.raise("Duplicate regular expression modifiers")}}}}if(e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}}e.pos=t}return!1},ye.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},ye.regexp_eatModifiers=function(e){for(var t="",i=0;(i=e.current())!==-1&&qo(i);)t+=Ji(i),e.advance();return t};function qo(e){return e===105||e===109||e===115}ye.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},ye.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},ye.regexp_eatSyntaxCharacter=function(e){var t=e.current();return ea(t)?(e.lastIntValue=t,e.advance(),!0):!1};function ea(e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}ye.regexp_eatPatternCharacters=function(e){for(var t=e.pos,i=0;(i=e.current())!==-1&&!ea(i);)e.advance();return e.pos!==t},ye.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return t!==-1&&t!==36&&!(t>=40&&t<=43)&&t!==46&&t!==63&&t!==91&&t!==94&&t!==124?(e.advance(),!0):!1},ye.regexp_groupSpecifier=function(e){if(e.eat(63)){this.regexp_eatGroupName(e)||e.raise("Invalid group");var t=this.options.ecmaVersion>=16,i=e.groupNames[e.lastStringValue];if(i)if(t)for(var n=0,a=i;n<a.length;n+=1){var r=a[n];r.separatedFrom(e.branchID)||e.raise("Duplicate capture group name")}else e.raise("Duplicate capture group name");t?(i||(e.groupNames[e.lastStringValue]=[])).push(e.branchID):e.groupNames[e.lastStringValue]=!0}},ye.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},ye.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Ji(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Ji(e.lastIntValue);return!0}return!1},ye.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,i=this.options.ecmaVersion>=11,n=e.current(i);return e.advance(i),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,i)&&(n=e.lastIntValue),Lo(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)};function Lo(e){return Hi(e,!0)||e===36||e===95}ye.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,i=this.options.ecmaVersion>=11,n=e.current(i);return e.advance(i),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,i)&&(n=e.lastIntValue),Vo(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)};function Vo(e){return wn(e,!0)||e===36||e===95||e===8204||e===8205}ye.regexp_eatAtomEscape=function(e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},ye.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var i=e.lastIntValue;if(e.switchU)return i>e.maxBackReference&&(e.maxBackReference=i),!0;if(i<=e.numCapturingParens)return!0;e.pos=t}return!1},ye.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},ye.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},ye.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},ye.regexp_eatZero=function(e){return e.current()===48&&!or(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1},ye.regexp_eatControlEscape=function(e){var t=e.current();return t===116?(e.lastIntValue=9,e.advance(),!0):t===110?(e.lastIntValue=10,e.advance(),!0):t===118?(e.lastIntValue=11,e.advance(),!0):t===102?(e.lastIntValue=12,e.advance(),!0):t===114?(e.lastIntValue=13,e.advance(),!0):!1},ye.regexp_eatControlLetter=function(e){var t=e.current();return ta(t)?(e.lastIntValue=t%32,e.advance(),!0):!1};function ta(e){return e>=65&&e<=90||e>=97&&e<=122}ye.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){t===void 0&&(t=!1);var i=e.pos,n=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(n&&a>=55296&&a<=56319){var r=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=(a-55296)*1024+(s-56320)+65536,!0}e.pos=r,e.lastIntValue=a}return!0}if(n&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&$o(e.lastIntValue))return!0;n&&e.raise("Invalid unicode escape"),e.pos=i}return!1};function $o(e){return e>=0&&e<=1114111}ye.regexp_eatIdentityEscape=function(e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;var t=e.current();return t!==99&&(!e.switchN||t!==107)?(e.lastIntValue=t,e.advance(),!0):!1},ye.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();while((t=e.current())>=48&&t<=57);return!0}return!1};var ia=0,Xi=1,Ci=2;ye.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(Bo(t))return e.lastIntValue=-1,e.advance(),Xi;var i=!1;if(e.switchU&&this.options.ecmaVersion>=9&&((i=t===80)||t===112)){e.lastIntValue=-1,e.advance();var n;if(e.eat(123)&&(n=this.regexp_eatUnicodePropertyValueExpression(e))&&e.eat(125))return i&&n===Ci&&e.raise("Invalid property name"),n;e.raise("Invalid property name")}return ia};function Bo(e){return e===100||e===68||e===115||e===83||e===119||e===87}ye.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var i=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,i,n),Xi}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var a=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,a)}return ia},ye.regexp_validateUnicodePropertyNameAndValue=function(e,t,i){kn(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(i)||e.raise("Invalid property value")},ye.regexp_validateUnicodePropertyNameOrValue=function(e,t){if(e.unicodeProperties.binary.test(t))return Xi;if(e.switchV&&e.unicodeProperties.binaryOfStrings.test(t))return Ci;e.raise("Invalid property name")},ye.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";na(t=e.current());)e.lastStringValue+=Ji(t),e.advance();return e.lastStringValue!==""};function na(e){return ta(e)||e===95}ye.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";Do(t=e.current());)e.lastStringValue+=Ji(t),e.advance();return e.lastStringValue!==""};function Do(e){return na(e)||or(e)}ye.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},ye.regexp_eatCharacterClass=function(e){if(e.eat(91)){var t=e.eat(94),i=this.regexp_classContents(e);return e.eat(93)||e.raise("Unterminated character class"),t&&i===Ci&&e.raise("Negated character class may contain strings"),!0}return!1},ye.regexp_classContents=function(e){return e.current()===93?Xi:e.switchV?this.regexp_classSetExpression(e):(this.regexp_nonEmptyClassRanges(e),Xi)},ye.regexp_nonEmptyClassRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var i=e.lastIntValue;e.switchU&&(t===-1||i===-1)&&e.raise("Invalid character class"),t!==-1&&i!==-1&&t>i&&e.raise("Range out of order in character class")}}},ye.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var i=e.current();(i===99||aa(i))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var n=e.current();return n!==93?(e.lastIntValue=n,e.advance(),!0):!1},ye.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},ye.regexp_classSetExpression=function(e){var t=Xi,i;if(!this.regexp_eatClassSetRange(e))if(i=this.regexp_eatClassSetOperand(e)){i===Ci&&(t=Ci);for(var n=e.pos;e.eatChars([38,38]);){if(e.current()!==38&&(i=this.regexp_eatClassSetOperand(e))){i!==Ci&&(t=Xi);continue}e.raise("Invalid character in character class")}if(n!==e.pos)return t;for(;e.eatChars([45,45]);)this.regexp_eatClassSetOperand(e)||e.raise("Invalid character in character class");if(n!==e.pos)return t}else e.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(e)){if(i=this.regexp_eatClassSetOperand(e),!i)return t;i===Ci&&(t=Ci)}},ye.regexp_eatClassSetRange=function(e){var t=e.pos;if(this.regexp_eatClassSetCharacter(e)){var i=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassSetCharacter(e)){var n=e.lastIntValue;return i!==-1&&n!==-1&&i>n&&e.raise("Range out of order in character class"),!0}e.pos=t}return!1},ye.regexp_eatClassSetOperand=function(e){return this.regexp_eatClassSetCharacter(e)?Xi:this.regexp_eatClassStringDisjunction(e)||this.regexp_eatNestedClass(e)},ye.regexp_eatNestedClass=function(e){var t=e.pos;if(e.eat(91)){var i=e.eat(94),n=this.regexp_classContents(e);if(e.eat(93))return i&&n===Ci&&e.raise("Negated character class may contain strings"),n;e.pos=t}if(e.eat(92)){var a=this.regexp_eatCharacterClassEscape(e);if(a)return a;e.pos=t}return null},ye.regexp_eatClassStringDisjunction=function(e){var t=e.pos;if(e.eatChars([92,113])){if(e.eat(123)){var i=this.regexp_classStringDisjunctionContents(e);if(e.eat(125))return i}else e.raise("Invalid escape");e.pos=t}return null},ye.regexp_classStringDisjunctionContents=function(e){for(var t=this.regexp_classString(e);e.eat(124);)this.regexp_classString(e)===Ci&&(t=Ci);return t},ye.regexp_classString=function(e){for(var t=0;this.regexp_eatClassSetCharacter(e);)t++;return t===1?Xi:Ci},ye.regexp_eatClassSetCharacter=function(e){var t=e.pos;if(e.eat(92))return this.regexp_eatCharacterEscape(e)||this.regexp_eatClassSetReservedPunctuator(e)?!0:e.eat(98)?(e.lastIntValue=8,!0):(e.pos=t,!1);var i=e.current();return i<0||i===e.lookahead()&&jo(i)||zo(i)?!1:(e.advance(),e.lastIntValue=i,!0)};function jo(e){return e===33||e>=35&&e<=38||e>=42&&e<=44||e===46||e>=58&&e<=64||e===94||e===96||e===126}function zo(e){return e===40||e===41||e===45||e===47||e>=91&&e<=93||e>=123&&e<=125}ye.regexp_eatClassSetReservedPunctuator=function(e){var t=e.current();return Uo(t)?(e.lastIntValue=t,e.advance(),!0):!1};function Uo(e){return e===33||e===35||e===37||e===38||e===44||e===45||e>=58&&e<=62||e===64||e===96||e===126}ye.regexp_eatClassControlLetter=function(e){var t=e.current();return or(t)||t===95?(e.lastIntValue=t%32,e.advance(),!0):!1},ye.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},ye.regexp_eatDecimalDigits=function(e){var t=e.pos,i=0;for(e.lastIntValue=0;or(i=e.current());)e.lastIntValue=10*e.lastIntValue+(i-48),e.advance();return e.pos!==t};function or(e){return e>=48&&e<=57}ye.regexp_eatHexDigits=function(e){var t=e.pos,i=0;for(e.lastIntValue=0;ra(i=e.current());)e.lastIntValue=16*e.lastIntValue+sa(i),e.advance();return e.pos!==t};function ra(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function sa(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}ye.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var i=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=t*64+i*8+e.lastIntValue:e.lastIntValue=t*8+i}else e.lastIntValue=t;return!0}return!1},ye.regexp_eatOctalDigit=function(e){var t=e.current();return aa(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)};function aa(e){return e>=48&&e<=55}ye.regexp_eatFixedHexDigits=function(e,t){var i=e.pos;e.lastIntValue=0;for(var n=0;n<t;++n){var a=e.current();if(!ra(a))return e.pos=i,!1;e.lastIntValue=16*e.lastIntValue+sa(a),e.advance()}return!0};var Qr=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new er(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},rt=Ht.prototype;rt.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Qr(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},rt.getToken=function(){return this.next(),new Qr(this)},typeof Symbol<"u"&&(rt[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===d.eof,value:t}}}}),rt.nextToken=function(){var e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(d.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())},rt.readToken=function(e){return Hi(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)},rt.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=56320)return e;var t=this.input.charCodeAt(this.pos+1);return t<=56319||t>=57344?e:(e<<10)+t-56613888},rt.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,i=this.input.indexOf("*/",this.pos+=2);if(i===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=i+2,this.options.locations)for(var n=void 0,a=t;(n=ks(this.input,a,this.pos))>-1;)++this.curLine,a=this.lineStart=n;this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,i),t,this.pos,e,this.curPosition())},rt.skipLineComment=function(e){for(var t=this.pos,i=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!Nn(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,i,this.curPosition())},rt.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&Ps.test(String.fromCharCode(e)))++this.pos;else break e}}},rt.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=e,this.value=t,this.updateContext(i)},rt.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&t===46?(this.pos+=3,this.finishToken(d.ellipsis)):(++this.pos,this.finishToken(d.dot))},rt.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(d.assign,2):this.finishOp(d.slash,1)},rt.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),i=1,n=e===42?d.star:d.modulo;return this.options.ecmaVersion>=7&&e===42&&t===42&&(++i,n=d.starstar,t=this.input.charCodeAt(this.pos+2)),t===61?this.finishOp(d.assign,i+1):this.finishOp(n,i)},rt.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(d.assign,3)}return this.finishOp(e===124?d.logicalOR:d.logicalAND,2)}return t===61?this.finishOp(d.assign,2):this.finishOp(e===124?d.bitwiseOR:d.bitwiseAND,1)},rt.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(d.assign,2):this.finishOp(d.bitwiseXOR,1)},rt.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?t===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||ki.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(d.incDec,2):t===61?this.finishOp(d.assign,2):this.finishOp(d.plusMin,1)},rt.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),i=1;return t===e?(i=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+i)===61?this.finishOp(d.assign,i+1):this.finishOp(d.bitShift,i)):t===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(t===61&&(i=2),this.finishOp(d.relational,i))},rt.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(d.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&t===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(d.arrow)):this.finishOp(e===61?d.eq:d.prefix,1)},rt.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(t===46){var i=this.input.charCodeAt(this.pos+2);if(i<48||i>57)return this.finishOp(d.questionDot,2)}if(t===63){if(e>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(d.assign,3)}return this.finishOp(d.coalesce,2)}}return this.finishOp(d.question,1)},rt.readToken_numberSign=function(){var e=this.options.ecmaVersion,t=35;if(e>=13&&(++this.pos,t=this.fullCharCodeAtPos(),Hi(t,!0)||t===92))return this.finishToken(d.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+Ji(t)+"'")},rt.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(d.parenL);case 41:return++this.pos,this.finishToken(d.parenR);case 59:return++this.pos,this.finishToken(d.semi);case 44:return++this.pos,this.finishToken(d.comma);case 91:return++this.pos,this.finishToken(d.bracketL);case 93:return++this.pos,this.finishToken(d.bracketR);case 123:return++this.pos,this.finishToken(d.braceL);case 125:return++this.pos,this.finishToken(d.braceR);case 58:return++this.pos,this.finishToken(d.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(d.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(t===120||t===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(t===111||t===79)return this.readRadixNumber(8);if(t===98||t===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(d.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+Ji(e)+"'")},rt.finishOp=function(e,t){var i=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,i)},rt.readRegexp=function(){for(var e,t,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(ki.test(n)&&this.raise(i,"Unterminated regular expression"),e)e=!1;else{if(n==="[")t=!0;else if(n==="]"&&t)t=!1;else if(n==="/"&&!t)break;e=n==="\\"}++this.pos}var a=this.input.slice(i,this.pos);++this.pos;var r=this.pos,s=this.readWord1();this.containsEsc&&this.unexpected(r);var f=this.regexpState||(this.regexpState=new $i(this));f.reset(i,a,s),this.validateRegExpFlags(f),this.validateRegExpPattern(f);var h=null;try{h=new RegExp(a,s)}catch{}return this.finishToken(d.regexp,{pattern:a,flags:s,value:h})},rt.readInt=function(e,t,i){for(var n=this.options.ecmaVersion>=12&&t===void 0,a=i&&this.input.charCodeAt(this.pos)===48,r=this.pos,s=0,f=0,h=0,p=t??1/0;h<p;++h,++this.pos){var _=this.input.charCodeAt(this.pos),E=void 0;if(n&&_===95){a&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),f===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),h===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),f=_;continue}if(_>=97?E=_-97+10:_>=65?E=_-65+10:_>=48&&_<=57?E=_-48:E=1/0,E>=e)break;f=_,s=s*e+E}return n&&f===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||t!=null&&this.pos-r!==t?null:s};function Wo(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function oa(e){return typeof BigInt!="function"?null:BigInt(e.replace(/_/g,""))}rt.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var i=this.readInt(e);return i==null&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(i=oa(this.input.slice(t,this.pos)),++this.pos):Hi(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(d.num,i)},rt.readNumber=function(e){var t=this.pos;!e&&this.readInt(10,void 0,!0)===null&&this.raise(t,"Invalid number");var i=this.pos-t>=2&&this.input.charCodeAt(t)===48;i&&this.strict&&this.raise(t,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!i&&!e&&this.options.ecmaVersion>=11&&n===110){var a=oa(this.input.slice(t,this.pos));return++this.pos,Hi(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(d.num,a)}i&&/[89]/.test(this.input.slice(t,this.pos))&&(i=!1),n===46&&!i&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(n===69||n===101)&&!i&&(n=this.input.charCodeAt(++this.pos),(n===43||n===45)&&++this.pos,this.readInt(10)===null&&this.raise(t,"Invalid number")),Hi(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=Wo(this.input.slice(t,this.pos),i);return this.finishToken(d.num,r)},rt.readCodePoint=function(){var e=this.input.charCodeAt(this.pos),t;if(e===123){this.options.ecmaVersion<6&&this.unexpected();var i=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(i,"Code point out of bounds")}else t=this.readHexChar(4);return t},rt.readString=function(e){for(var t="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;n===92?(t+=this.input.slice(i,this.pos),t+=this.readEscapedChar(!1),i=this.pos):n===8232||n===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(Nn(n)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(i,this.pos++),this.finishToken(d.string,t)};var la={};rt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===la)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1},rt.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw la;this.raise(e,t)},rt.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(i===96||i===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===d.template||this.type===d.invalidTemplate)?i===36?(this.pos+=2,this.finishToken(d.dollarBraceL)):(++this.pos,this.finishToken(d.backQuote)):(e+=this.input.slice(t,this.pos),this.finishToken(d.template,e));if(i===92)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(Nn(i)){switch(e+=this.input.slice(t,this.pos),++this.pos,i){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`
`;break;default:e+=String.fromCharCode(i);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},rt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(d.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")},rt.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ji(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),e){var i=this.pos-1;this.invalidStringToken(i,"Invalid escape sequence in template string")}default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],a=parseInt(n,8);return a>255&&(n=n.slice(0,-1),a=parseInt(n,8)),this.pos+=n.length-1,t=this.input.charCodeAt(this.pos),(n!=="0"||t===56||t===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-n.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(a)}return Nn(t)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(t)}},rt.readHexChar=function(e){var t=this.pos,i=this.readInt(16,e);return i===null&&this.invalidStringToken(t,"Bad character escape sequence"),i},rt.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,i=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var a=this.fullCharCodeAtPos();if(wn(a,n))this.pos+=a<=65535?1:2;else if(a===92){this.containsEsc=!0,e+=this.input.slice(i,this.pos);var r=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var s=this.readCodePoint();(t?Hi:wn)(s,n)||this.invalidStringToken(r,"Invalid Unicode escape"),e+=Ji(s),i=this.pos}else break;t=!1}return e+this.input.slice(i,this.pos)},rt.readWord=function(){var e=this.readWord1(),t=d.name;return this.keywords.test(e)&&(t=Or[e]),this.finishToken(t,e)};var Qo="8.14.0";Ht.acorn={Parser:Ht,version:Qo,defaultOptions:qr,Position:Tn,SourceLocation:er,getLineInfo:Is,Node:sr,TokenType:ut,tokTypes:d,keywordTypes:Or,TokContext:Ti,tokContexts:Mt,isIdentifierChar:wn,isIdentifierStart:Hi,Token:Qr,isNewLine:Nn,lineBreak:ki,lineBreakG:mo,nonASCIIwhitespace:Ps};function Go(e,t){return Ht.parse(e,t)}const ca=e=>e?` (line ${e.line}, col ${e.column+1})`:"",Zi=(e,t)=>{var n;const i=(n=t==null?void 0:t.loc)==null?void 0:n.start;throw new Error(`${e}${ca(i)}`)},Ko=e=>e.replace(/^\s*export\s+(function|const|let|var)\s+/gm,"$1 "),Gr=(e,t)=>{if(!(!e||typeof e.type!="string")){t(e);for(const i of Object.keys(e)){if(i==="loc"||i==="start"||i==="end")continue;const n=e[i];Array.isArray(n)?n.forEach(a=>{a&&typeof a.type=="string"&&Gr(a,t)}):n&&typeof n.type=="string"&&Gr(n,t)}}},Vn=(e,t)=>!!e&&e.type==="Identifier"&&e.name===t,Ho=(e,t,i)=>!!e&&e.type==="MemberExpression"&&!e.computed&&Vn(e.object,t)&&Vn(e.property,i),Jo=(e,t,i)=>{if(t.type==="BlockStatement"){i.push({kind:"insert",pos:t.start+1,text:"__guard();"});return}const n=e.slice(t.start,t.end);i.push({kind:"replace",start:t.start,end:t.end,text:`{__guard();${n}}`})},Yo=(e,t,i)=>{const n=t.body;if(!n)return;if(n.type==="BlockStatement"){i.push({kind:"insert",pos:n.start+1,text:"__guardCall();try{"}),i.push({kind:"insert",pos:n.end-1,text:"}finally{__guardExit();}"});return}const a=e.slice(n.start,n.end);i.push({kind:"replace",start:n.start,end:n.end,text:`{__guardCall();try{return ${a};}finally{__guardExit();}}`})},Xo=(e,t)=>{const i=[...t].sort((a,r)=>{const s=a.kind==="insert"?a.pos:a.start;return(r.kind==="insert"?r.pos:r.start)-s});let n=e;return i.forEach(a=>{a.kind==="insert"?n=n.slice(0,a.pos)+a.text+n.slice(a.pos):n=n.slice(0,a.start)+a.text+n.slice(a.end)}),n},Zo=e=>{const t=String(e||"");let i;try{i=Go(t,{ecmaVersion:"latest",sourceType:"module",allowAwaitOutsideFunction:!0,locations:!0,ranges:!0})}catch(r){const s=r,f=s==null?void 0:s.loc,h=s!=null&&s.message?String(s.message):"JS parse error";throw new Error(`${h}${ca(f)}`)}const n=[];Gr(i,r=>{if((r.type==="ImportDeclaration"||r.type==="ImportExpression")&&Zi("JS sandbox: imports are not supported",r),r.type==="ExportAllDeclaration"&&Zi("JS sandbox: export * is not supported",r),r.type==="ExportDefaultDeclaration"&&Zi("JS sandbox: export default is not supported",r),r.type==="ExportNamedDeclaration"&&(r.source&&Zi("JS sandbox: re-exports are not supported",r),r.declaration||Zi("JS sandbox: export lists are not supported",r)),r.type==="CallExpression"){const s=r.callee;Vn(s,"eval")&&Zi("JS guardrails: eval() is not allowed",r),Vn(s,"require")&&Zi("JS sandbox: require() is not supported",r),Ho(s,"Date","now")&&Zi("JS guardrails: Date.now() is not allowed",r)}if(r.type==="NewExpression"){const s=r.callee;Vn(s,"Function")&&Zi("JS guardrails: Function constructor is not allowed",r)}(r.type==="ForStatement"||r.type==="WhileStatement"||r.type==="DoWhileStatement"||r.type==="ForInStatement"||r.type==="ForOfStatement")&&Jo(t,r.body,n),(r.type==="FunctionDeclaration"||r.type==="FunctionExpression"||r.type==="ArrowFunctionExpression")&&Yo(t,r,n)});const a=Xo(t,n);return Ko(a)};function si(e,t){const i=[];let n=0;for(let a=0;a<e.length;a++){const r=e[a];n+=r??0,a>=t&&(n-=e[a-t]??0),i.push(a>=t-1?n/t:void 0)}return i}function lr(e,t){const i=[],n=t*(t+1)/2;for(let a=0;a<e.length;a++){if(a<t-1){i.push(void 0);continue}let r=0;for(let s=0;s<t;s++)r+=(e[a-s]??0)*(t-s);i.push(r/n)}return i}function $n(e,t){const i=[];let n,a=0;for(let r=0;r<e.length;r++){const s=e[r];if(s==null){i.push(void 0);continue}if(n===void 0){if(a+=s,r<t-1){i.push(void 0);continue}n=a/t,i.push(n);continue}n=(n*(t-1)+s)/t,i.push(n)}return i}function Ft(e,t){const i=[],n=2/(t+1);let a;for(let r=0;r<e.length;r++){const s=e[r];if(s==null){i.push(void 0);continue}a=a===void 0?s:s*n+a*(1-n),i.push(a)}return i}function ua(e,t){const i=[];let n,a=0,r=0,s=!1;const f=[],h=[];for(let p=0;p<e.length;p++){const _=e[p];if(_==null){i.push(void 0);continue}if(n===void 0){n=_,i.push(void 0);continue}const E=_-n;n=_;const z=E>0?E:0,C=E<0?-E:0;if(s)a=(a*(t-1)+z)/t,r=(r*(t-1)+C)/t;else{if(f.push(z),h.push(C),f.length<t){i.push(void 0);continue}a=f.reduce((v,S)=>v+S,0)/t,r=h.reduce((v,S)=>v+S,0)/t,s=!0}if(r===0)i.push(100);else{const v=a/r;i.push(100-100/(1+v))}}return i}function Bn(e,t,i,n){const a=i.length,r=new Array(a).fill(0);let s;for(let p=0;p<a;p++){const _=e[p]??i[p]??NaN,E=t[p]??i[p]??NaN,z=i[p]??NaN;let C=Math.max(0,_-E);s!==void 0&&(C=Math.max(C,Math.abs(_-s),Math.abs(E-s))),r[p]=C,s=z}const f=new Array(a);let h=0;for(let p=0;p<a;p++)h+=r[p],p===n-1?f[p]=h/n:p>=n?f[p]=(f[p-1]*(n-1)+r[p])/n:f[p]=void 0;return f}function el(e,t){const i=new Array(e.length);let n=0,a;for(let r=0;r<e.length;r++){const s=e[r],f=t[r]??0;if(a===void 0||s===void 0){i[r]=void 0,a=s;continue}s>a?n+=f:s<a&&(n-=f),i[r]=n,a=s}return i}function tl(e,t,i,n){const a=i.length,r=new Array(a);for(let h=0;h<a;h++)r[h]=((e[h]??i[h]??0)+(t[h]??i[h]??0)+(i[h]??0))/3;const s=si(r.map(h=>h),n).map(h=>h),f=new Array(a);for(let h=0;h<a;h++){if(h<n-1){f[h]=void 0;continue}let p=0;for(let E=h-n+1;E<=h;E++)p+=Math.abs(r[E]-s[h]);p=p/n;const _=.015*p;f[h]=_===0?void 0:(r[h]-s[h])/_}return f}function il(e,t,i,n,a){const r=i.length,s=new Array(r),f=new Array(r);for(let p=0;p<r;p++)f[p]=((e[p]??i[p]??0)+(t[p]??i[p]??0)+(i[p]??0))/3;const h=new Array(r);for(let p=0;p<r;p++)h[p]=f[p]*(n[p]??0);for(let p=0;p<r;p++){if(p<a){s[p]=void 0;continue}let _=0,E=0;for(let C=p-a+1;C<=p;C++)f[C]>=f[C-1]?_+=h[C]:E+=h[C];const z=E===0?1/0:_/E;s[p]=100-100/(1+z)}return s}function nl(e,t){const i=e.map((s,f)=>((s??0)+(t[f]??0))/2),n=si(i,5),a=si(i,34),r=new Array(i.length);for(let s=0;s<i.length;s++){const f=n[s],h=a[s];r[s]=f===void 0||h===void 0?void 0:f-h}return r}function rl(e,t){const i=Ft(e,t).map(s=>s??NaN),n=Ft(i,t).map(s=>s??NaN),a=Ft(n,t).map(s=>s??NaN),r=new Array(e.length);for(let s=1;s<e.length;s++){const f=a[s-1],h=a[s];r[s]=f===void 0||h===void 0||f===0?void 0:(h/f-1)*100}return r[0]=void 0,r}function sl(e,t){const i=new Array(e.length);let n=0,a=0;for(let r=0;r<e.length;r++){const s=e[r],f=t[r]??0;if(s===void 0){i[r]=void 0;continue}n+=s*f,a+=f,i[r]=a===0?void 0:n/a}return i}function al(e,t,i){const n=new Array(e.length);let a=0,r=0;for(let s=0;s<e.length;s++){const f=e[s],h=t[s]??0;if(f!==void 0&&(a+=f*h,r+=h),s>=i){const p=e[s-i],_=t[s-i]??0;p!==void 0&&(a-=p*_,r-=_)}n[s]=s>=i-1&&r!==0?a/r:void 0}return n}function fa(e,t,i){const n=e.map(h=>h??NaN),a=si(n,t),r=[];for(let h=0;h<n.length;h++){if(h<t-1){r.push(void 0);continue}let p=0;for(let z=h-t+1;z<=h;z++)p+=n[z];const _=p/t;let E=0;for(let z=h-t+1;z<=h;z++){const C=n[z]-_;E+=C*C}r.push(Math.sqrt(E/t))}const s=new Array(n.length),f=new Array(n.length);for(let h=0;h<n.length;h++){const p=a[h],_=r[h];s[h]=p===void 0||_===void 0?void 0:p+i*_,f[h]=p===void 0||_===void 0?void 0:p-i*_}return{mid:a,upper:s,lower:f}}function ol(e,t,i,n,a){const r=i.length,s=Bn(e,t,i,n).map(C=>C??NaN),f=new Array(r),h=new Array(r);for(let C=0;C<r;C++){const v=((e[C]??i[C]??0)+(t[C]??i[C]??0))/2,S=s[C];f[C]=v+a*S,h[C]=v-a*S}const p=new Array(r);let _=NaN,E=NaN,z=!0;for(let C=0;C<r;C++){_=Number.isFinite(_)?Math.min(f[C],_):f[C],E=Number.isFinite(E)?Math.max(h[C],E):h[C];const v=i[C]??NaN;if(!Number.isFinite(v)){p[C]=void 0;continue}z?(v<E&&(z=!1,_=f[C]),p[C]=E):(v>_&&(z=!0,E=h[C]),p[C]=_)}return p}function ll(e,t,i,n,a){const r=Ft(i,n).map(_=>_??NaN),s=Bn(e,t,i,n).map(_=>_??NaN),f=i.length,h=new Array(f),p=new Array(f);for(let _=0;_<f;_++){const E=r[_],z=s[_];h[_]=Number.isFinite(E)&&Number.isFinite(z)?E+a*z:void 0,p[_]=Number.isFinite(E)&&Number.isFinite(z)?E-a*z:void 0}return{mid:r,upper:h,lower:p}}function cl(e,t){const i=e.length,n=new Array(i);for(let a=0;a<i;a++){if(a<t-1){n[a]=void 0;continue}let r=0;for(let _=a-t+1;_<=a;_++)r+=e[_]??0;const s=r/t;let f=0;for(let _=a-t+1;_<=a;_++){const E=(e[_]??0)-s;f+=E*E}const h=Math.sqrt(f/t),p=e[a]??NaN;n[a]=Number.isFinite(h)&&h!==0?(p-s)/h:void 0}return n}function ul(e,t,i){const n=e.length,a=new Array(n);let r=0;for(let s=0;s<n;s++){const f=e[s],h=t[s]??0;if(f==null){a[s]=void 0;continue}const p=h/Math.max(1,t[s-1]??h);r=(r*(i-1)+f*p)/i,a[s]=r}return a}const cr=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),ha=e=>e.trim().replace(/[^a-zA-Z0-9_]+/g,"_").toLowerCase(),pe=e=>cr(e)?ha(e.name):`const_${ha(String(e))}`,le=(e,t)=>{const i=typeof e=="number"?e:Number(e);return Number.isFinite(i)?Math.max(1,Math.floor(i)):t},Q=(e,t)=>{const i=new Array(t);if(cr(e)){const r=e.data;for(let s=0;s<t;s++){const f=r[s];i[s]=Number.isFinite(f)?f:void 0}return i}const n=typeof e=="number"?e:Number(e),a=Number.isFinite(n)?n:NaN;for(let r=0;r<t;r++)i[r]=Number.isFinite(a)?a:void 0;return i},an=(e,t)=>{const i=new Array(e.length);let n=0;for(let a=0;a<e.length;a++)n+=e[a]??0,a>=t&&(n-=e[a-t]??0),i[a]=a>=t-1?n:void 0;return i},fl=(e,t)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t-1){i[n]=void 0;continue}let a=-1/0;for(let r=n-t+1;r<=n;r++){const s=e[r];Number.isFinite(s)&&s>a&&(a=s)}i[n]=Number.isFinite(a)?a:void 0}return i},hl=(e,t)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t-1){i[n]=void 0;continue}let a=1/0;for(let r=n-t+1;r<=n;r++){const s=e[r];Number.isFinite(s)&&s<a&&(a=s)}i[n]=Number.isFinite(a)?a:void 0}return i},dl=(e,t,i)=>{const n=i.length,a=new Array(n);let r;for(let s=0;s<n;s++){const f=e[s]??i[s],h=t[s]??i[s],p=i[s];if(!Number.isFinite(f)||!Number.isFinite(h)||!Number.isFinite(p)){a[s]=void 0,Number.isFinite(p)&&(r=p);continue}let _=Math.max(f-h,0);r!==void 0&&Number.isFinite(r)&&(_=Math.max(_,Math.abs(f-r),Math.abs(h-r))),a[s]=_,r=p}return a},da=(e,t,i,n)=>{const a=e.length,r=new Array(a);for(let s=0;s<a;s++){const f=s-i;if(f-t<0){r[s]=void 0;continue}const h=e[f];if(!Number.isFinite(h)){r[s]=void 0;continue}const p=f-t,_=f+i;let E=!0;for(let z=p;z<=_;z++){const C=e[z];if(!Number.isFinite(C)){E=!1;break}if(n==="high"){if(C>h){E=!1;break}}else if(C<h){E=!1;break}}r[s]=E?h:void 0}return r},ml=(e,t,i,n,a)=>{const r=i.length,s=new Array(r),f=new Array(r),h=new Array(r),p=new Array(r),_=new Array(r),E=new Array(r),z=new Array(r),C=new Array(r),v=new Array(r);for(let S=0;S<r;S++){if(S<n){s[S]=void 0,f[S]=void 0,h[S]=void 0,p[S]=void 0,_[S]=void 0,E[S]=void 0,z[S]=void 0,C[S]=void 0,v[S]=void 0;continue}let U=-1/0,V=1/0,ne=!0;for(let Te=S-n;Te<S;Te++){const Ie=e[Te],we=t[Te];if(!Number.isFinite(Ie)||!Number.isFinite(we)){ne=!1;break}Ie>U&&(U=Ie),we<V&&(V=we)}const he=i[S-1];if(!Number.isFinite(he)||!ne){s[S]=void 0,f[S]=void 0,h[S]=void 0,p[S]=void 0,_[S]=void 0,E[S]=void 0,z[S]=void 0,C[S]=void 0,v[S]=void 0;continue}const me=U-V,be=he;if(a==="woodie"){const Te=(U+V+2*be)/4;s[S]=Te,f[S]=2*Te-V,h[S]=2*Te-U,p[S]=Te+me,_[S]=Te-me,E[S]=U+2*(Te-V),z[S]=V-2*(U-Te),C[S]=void 0,v[S]=void 0;continue}if(a==="fibonacci"){const Te=(U+V+be)/3;s[S]=Te,f[S]=Te+.382*me,h[S]=Te-.382*me,p[S]=Te+.618*me,_[S]=Te-.618*me,E[S]=Te+me,z[S]=Te-me,C[S]=void 0,v[S]=void 0;continue}if(a==="camarilla"){const Te=(U+V+be)/3,Ie=me*1.1;s[S]=Te,f[S]=be+Ie/12,h[S]=be-Ie/12,p[S]=be+Ie/6,_[S]=be-Ie/6,E[S]=be+Ie/4,z[S]=be-Ie/4,C[S]=be+Ie/2,v[S]=be-Ie/2;continue}const ve=(U+V+be)/3;s[S]=ve,f[S]=2*ve-V,h[S]=2*ve-U,p[S]=ve+me,_[S]=ve-me,E[S]=U+2*(ve-V),z[S]=V-2*(U-ve),C[S]=void 0,v[S]=void 0}return{pp:s,r1:f,s1:h,r2:p,s2:_,r3:E,s3:z,r4:C,s4:v}},pl=(e,t=1)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t){i[n]=void 0;continue}const a=e[n],r=e[n-t];i[n]=Number.isFinite(a)&&Number.isFinite(r)?a-r:void 0}return i},Dn=(e,t)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t){i[n]=void 0;continue}const a=e[n],r=e[n-t];!Number.isFinite(a)||!Number.isFinite(r)||r===0?i[n]=void 0:i[n]=(a-r)/r*100}return i},gl=(e,t)=>{const i=new Array(e.length),n=new Array(e.length).fill(0),a=new Array(e.length).fill(0);for(let f=1;f<e.length;f++){const h=e[f-1],p=e[f];if(!Number.isFinite(h)||!Number.isFinite(p))continue;const _=p-h;n[f]=_>0?_:0,a[f]=_<0?-_:0}let r=0,s=0;for(let f=0;f<e.length;f++){if(r+=n[f],s+=a[f],f>=t&&(r-=n[f-t],s-=a[f-t]),f<t){i[f]=void 0;continue}const h=r+s;i[f]=h===0?0:(r-s)/h*100}return i},yl=(e,t,i)=>{const n=e.length,a=new Array(n),r=new Array(n);for(let E=0;E<n;E++){if(E===0){a[E]=void 0,r[E]=void 0;continue}const z=e[E],C=e[E-1];if(!Number.isFinite(z)||!Number.isFinite(C)){a[E]=void 0,r[E]=void 0;continue}const v=z-C;a[E]=v,r[E]=Math.abs(v)}const s=Ft(a,t),f=Ft(s,i),h=Ft(r,t),p=Ft(h,i),_=new Array(n);for(let E=0;E<n;E++){const z=f[E],C=p[E];_[E]=Number.isFinite(z)&&Number.isFinite(C)&&C!==0?z/C*100:void 0}return _},xl=(e,t,i,n)=>{const a=new Array(e.length),r=i*(t-1),s=t/n,f=new Array(t);let h=0;for(let p=0;p<t;p++){const _=Math.exp(-((p-r)*(p-r))/(2*s*s));f[p]=_,h+=_}for(let p=0;p<e.length;p++){if(p<t-1){a[p]=void 0;continue}let _=0,E=!0;for(let z=0;z<t;z++){const C=e[p-t+1+z];if(!Number.isFinite(C)){E=!1;break}_+=C*f[z]}a[p]=E&&h!==0?_/h:void 0}return a},bl=(e,t)=>{const i=new Array(e.length),n=new Array(t);let a=0;for(let r=0;r<t;r++){const s=Math.sin((r+1)*Math.PI/(t+1));n[r]=s,a+=s}for(let r=0;r<e.length;r++){if(r<t-1){i[r]=void 0;continue}let s=0,f=!0;for(let h=0;h<t;h++){const p=e[r-t+1+h];if(!Number.isFinite(p)){f=!1;break}s+=p*n[h]}i[r]=f&&a!==0?s/a:void 0}return i},_l=(e,t)=>{const i=Math.ceil((t+1)/2),n=Math.floor((t+1)/2),a=si(e,i);return si(a,n)},vl=(e,t,i,n)=>{const a=e.length,r=new Array(a),s=2/(i+1),f=2/(n+1);let h;for(let p=0;p<a;p++){if(p<t){r[p]=void 0;continue}const _=e[p],E=e[p-t];if(!Number.isFinite(_)||!Number.isFinite(E)){r[p]=void 0;continue}let z=0;for(let U=p-t+1;U<=p;U++){const V=e[U],ne=e[U-1];!Number.isFinite(V)||!Number.isFinite(ne)||(z+=Math.abs(V-ne))}const C=Math.abs(_-E),v=z===0?0:C/z,S=Math.pow(v*(s-f)+f,2);h=h==null?_:h+S*(_-h),r[p]=h}return r},wl=(e,t)=>{const i=Math.max(1,Math.floor(t/2)),n=Math.max(1,Math.floor(Math.sqrt(t))),a=lr(e,i),r=lr(e,t),s=new Array(e.length);for(let f=0;f<e.length;f++){const h=a[f],p=r[f];s[f]=Number.isFinite(h)&&Number.isFinite(p)?2*h-p:void 0}return lr(s,n)},Nl=(e,t,i)=>{const n=Ft(e,t),a=Ft(n,t),r=Ft(a,t),s=Ft(r,t),f=Ft(s,t),h=Ft(f,t),p=i,_=-p*p*p,E=3*p*p+3*p*p*p,z=-6*p*p-3*p-3*p*p*p,C=1+3*p+p*p*p+3*p*p,v=new Array(e.length);for(let S=0;S<e.length;S++){const U=r[S],V=s[S],ne=f[S],he=h[S];v[S]=Number.isFinite(U)&&Number.isFinite(V)&&Number.isFinite(ne)&&Number.isFinite(he)?_*he+E*ne+z*V+C*U:void 0}return v},ur=(e,t)=>{const i=e.length,n=new Array(i),a=new Array(i),r=new Array(i),s=new Array(i),f=t,h=(f-1)*f/2,p=f*(f-1)*(2*f-1)/6,_=f*p-h*h;for(let E=0;E<i;E++){if(E<t-1||_===0){n[E]=void 0,a[E]=void 0,r[E]=void 0,s[E]=void 0;continue}let z=0,C=0,v=!0;for(let ne=0;ne<t;ne++){const he=e[E-t+1+ne];if(!Number.isFinite(he)){v=!1;break}z+=he,C+=ne*he}if(!v){n[E]=void 0,a[E]=void 0,r[E]=void 0,s[E]=void 0;continue}const S=(f*C-h*z)/_,U=(z-S*h)/f,V=S*(t-1)+U;n[E]=V,a[E]=S,r[E]=U,s[E]=Math.atan(S)*180/Math.PI}return{line:n,slope:a,intercept:r,angle:s}},Kr=(e,t,i,n)=>{const a=i.length,r=new Array(a);for(let s=0;s<a;s++){if(s<n-1){r[s]=void 0;continue}let f=-1/0,h=1/0;for(let E=s-n+1;E<=s;E++){const z=e[E],C=t[E];Number.isFinite(z)&&z>f&&(f=z),Number.isFinite(C)&&C<h&&(h=C)}const p=i[s],_=f-h;r[s]=Number.isFinite(p)&&Number.isFinite(_)&&_!==0?(p-h)/_*100:void 0}return r},kl=(e,t,i,n)=>{const a=ua(e,t),r=Kr(a,a,a,i),s=si(r,i),f=si(s,n),h=new Array(e.length);for(let p=0;p<e.length;p++)h[p]=f[p];return h},ma=(e,t,i)=>{const n=e.length,a=new Array(n),r=new Array(n);for(let s=0;s<n;s++){if(s<i-1){a[s]=void 0,r[s]=void 0;continue}let f=-1/0,h=1/0,p=s,_=s;for(let C=s-i+1;C<=s;C++){const v=e[C],S=t[C];Number.isFinite(v)&&v>=f&&(f=v,p=C),Number.isFinite(S)&&S<=h&&(h=S,_=C)}const E=s-p,z=s-_;a[s]=(i-E)/i*100,r[s]=(i-z)/i*100}return{up:a,down:r}},fr=(e,t,i,n)=>{const a=i.length,r=new Array(a).fill(0),s=new Array(a).fill(0),f=new Array(a).fill(0);for(let S=1;S<a;S++){const U=e[S],V=t[S],ne=e[S-1],he=t[S-1],me=i[S-1];if(!Number.isFinite(U)||!Number.isFinite(V))continue;const be=U-ne,ve=he-V;r[S]=be>ve&&be>0?be:0,s[S]=ve>be&&ve>0?ve:0;const Te=Math.max(U-V,Math.abs(U-me),Math.abs(V-me));f[S]=Number.isFinite(Te)?Te:0}const h=$n(r,n),p=$n(s,n),_=$n(f,n),E=new Array(a),z=new Array(a),C=new Array(a);for(let S=0;S<a;S++){const U=h[S],V=p[S],ne=_[S];if(!Number.isFinite(U)||!Number.isFinite(V)||!Number.isFinite(ne)||ne===0){E[S]=void 0,z[S]=void 0,C[S]=void 0;continue}const he=U/ne*100,me=V/ne*100;E[S]=he,z[S]=me;const be=he+me;C[S]=be===0?0:Math.abs(he-me)/be*100}const v=$n(C,n);return{plus:E,minus:z,adx:v}},pa=(e,t,i)=>{const n=new Array(e.length);let a=1e3;n[0]=a;for(let r=1;r<e.length;r++){const s=e[r],f=e[r-1],h=t[r]??0,p=t[r-1]??0;if(!Number.isFinite(s)||!Number.isFinite(f)){n[r]=a;continue}(i?h>p:h<p)&&f!==0&&(a=a+(s-f)/f*a),n[r]=a}return n},Pl=(e,t,i,n)=>{const a=i.length,r=new Array(a).fill(0),s=new Array(a).fill(0),f=new Array(a).fill(0);for(let C=1;C<a;C++){const v=e[C],S=t[C],U=e[C-1],V=t[C-1],ne=i[C-1];if(!Number.isFinite(v)||!Number.isFinite(S))continue;r[C]=Math.abs(v-V),s[C]=Math.abs(S-U);const he=Math.max(v-S,Math.abs(v-ne),Math.abs(S-ne));f[C]=Number.isFinite(he)?he:0}const h=an(r,n),p=an(s,n),_=an(f,n),E=new Array(a),z=new Array(a);for(let C=0;C<a;C++){const v=h[C],S=p[C],U=_[C];if(!Number.isFinite(v)||!Number.isFinite(S)||!Number.isFinite(U)||U===0){E[C]=void 0,z[C]=void 0;continue}E[C]=v/U,z[C]=S/U}return{plus:E,minus:z}},Sl=(e,t,i,n,a,r)=>{const s=i.length,f=new Array(s).fill(0),h=new Array(s).fill(0);for(let v=0;v<s;v++){const S=e[v],U=t[v],V=i[v],ne=v>0?i[v-1]:V;if(!Number.isFinite(S)||!Number.isFinite(U)||!Number.isFinite(V))continue;const he=Math.min(U,ne??U),me=Math.max(S,ne??S);f[v]=V-he,h[v]=me-he}const p=v=>{const S=an(f,v),U=an(h,v),V=new Array(s);for(let ne=0;ne<s;ne++){const he=S[ne],me=U[ne];V[ne]=Number.isFinite(he)&&Number.isFinite(me)&&me!==0?he/me:void 0}return V},_=p(n),E=p(a),z=p(r),C=new Array(s);for(let v=0;v<s;v++){if(!Number.isFinite(_[v])||!Number.isFinite(E[v])||!Number.isFinite(z[v])){C[v]=void 0;continue}C[v]=(4*_[v]+2*E[v]+z[v])/7*100}return C},Cl=(e,t)=>{const i=e.length,n=new Array(i);for(let a=0;a<i;a++){if(a<t-1){n[a]=void 0;continue}let r=0,s=0,f=!0;for(let h=0;h<t;h++){const p=e[a-t+1+h];if(!Number.isFinite(p)){f=!1;break}r+=(h+1)*p,s+=p}n[a]=f&&s!==0?-(r/s)+(t+1)/2:void 0}return n},Fl=(e,t,i,n)=>{const a=i.length,r=new Array(a);let s=0;for(let f=0;f<a;f++){const h=e[f],p=t[f],_=i[f],E=n[f]??0;if(!Number.isFinite(h)||!Number.isFinite(p)||!Number.isFinite(_)){r[f]=void 0;continue}const z=h-p,v=(z===0?0:(_-p-(h-_))/z)*E;s+=v,r[f]=s}return r},Il=(e,t,i,n,a)=>{const r=i.length,s=new Array(r).fill(0);for(let _=0;_<r;_++){const E=e[_],z=t[_],C=i[_],v=n[_]??0;if(!Number.isFinite(E)||!Number.isFinite(z)||!Number.isFinite(C))continue;const S=E-z,U=S===0?0:(C-z-(E-C))/S;s[_]=U*v}const f=an(s,a),h=an(n,a),p=new Array(r);for(let _=0;_<r;_++){const E=f[_],z=h[_];p[_]=Number.isFinite(E)&&Number.isFinite(z)&&z!==0?E/z:void 0}return p},hr=(e,t)=>{const i=new Map,n=new Map,a=new Map,r=e.close.data.length,s=(k,R)=>{const w=i.get(k);if(w)return w;const O=ni(k,R,t);return i.set(k,O),O},f=(k,R=14)=>{const w=le(R,14),O=`ta_sma_${pe(k)}_${w}`;return s(O,si(Q(k,r),w))},h=(k,R=14)=>{const w=le(R,14),O=`ta_ema_${pe(k)}_${w}`;return s(O,Ft(Q(k,r),w))},p=(k,R=14)=>{const w=le(R,14),O=`ta_rma_${pe(k)}_${w}`;return s(O,$n(Q(k,r),w))},_=(k,R=14)=>{const w=le(R,14),O=`ta_wma_${pe(k)}_${w}`;return s(O,lr(Q(k,r),w))},E=(k,R=14)=>{const w=le(R,14),O=`ta_dema_${pe(k)}_${w}`,H=Q(k,r),G=Ft(H,w),W=Ft(G,w),re=new Array(r);for(let oe=0;oe<r;oe++){const ce=G[oe],J=W[oe];re[oe]=Number.isFinite(ce)&&Number.isFinite(J)?2*ce-J:void 0}return s(O,re)},z=(k,R=14)=>{const w=le(R,14),O=`ta_tema_${pe(k)}_${w}`,H=Q(k,r),G=Ft(H,w),W=Ft(G,w),re=Ft(W,w),oe=new Array(r);for(let ce=0;ce<r;ce++){const J=G[ce],Fe=W[ce],Ue=re[ce];oe[ce]=Number.isFinite(J)&&Number.isFinite(Fe)&&Number.isFinite(Ue)?3*J-3*Fe+Ue:void 0}return s(O,oe)},C=(k,R=20)=>{const w=le(R,20),O=`ta_hma_${pe(k)}_${w}`;return s(O,wl(Q(k,r),w))},v=(k,R=10,w=2,O=30)=>{const H=le(R,10),G=le(w,2),W=le(O,30),re=`ta_kama_${pe(k)}_${H}_${G}_${W}`;return s(re,vl(Q(k,r),H,G,W))},S=(k,R=20,w=.85,O=6)=>{const H=le(R,20),G=Number.isFinite(Number(w))?Number(w):.85,W=Number.isFinite(Number(O))?Number(O):6,re=`ta_alma_${pe(k)}_${H}_${G}_${W}`;return s(re,xl(Q(k,r),H,G,W))},U=(k,R=10,w=.7)=>{const O=le(R,10),H=Number.isFinite(Number(w))?Number(w):.7,G=`ta_t3_${pe(k)}_${O}_${H}`;return s(G,Nl(Q(k,r),O,H))},V=(k,R=20)=>{const w=le(R,20),O=`ta_trima_${pe(k)}_${w}`;return s(O,_l(Q(k,r),w))},ne=(k,R=20)=>{const w=le(R,20),O=`ta_swma_${pe(k)}_${w}`;return s(O,bl(Q(k,r),w))},he=(k=e.close,R=e.volume,w=20)=>{const O=le(w,20),H=`ta_evwma_${pe(k)}_${pe(R)}_${O}`;return s(H,ul(Q(k,r),Q(R,r),O))},me=(k,R=14)=>{const w=le(R,14),O=`ta_rsi_${pe(k)}_${w}`;return s(O,ua(Q(k,r),w))},be=(k,R=14)=>{const w=le(R,14),O=`ta_cmo_${pe(k)}_${w}`;return s(O,gl(Q(k,r),w))},ve=(k,R=25,w=13)=>{const O=le(R,25),H=le(w,13),G=`ta_tsi_${pe(k)}_${O}_${H}`;return s(G,yl(Q(k,r),O,H))},Te=(k,R=14)=>{const w=le(R,14),O=`ta_roc_${pe(k)}_${w}`;return s(O,Dn(Q(k,r),w))},Ie=(k,R=10)=>{const w=le(R,10),O=`ta_mom_${pe(k)}_${w}`;return s(O,pl(Q(k,r),w))},we=(k=e.close,R=9)=>{const w=le(R,9),O=`ta_trix_${pe(k)}_${w}`;return s(O,rl(Q(k,r),w))},ze=()=>s("ta_ao",nl(Q(e.high,r),Q(e.low,r))),Ce=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_zscore_${pe(k)}_${w}`;return s(O,cl(Q(k,r),w))},Ct=(k=14)=>{const R=le(k,14),w=`ta_atr_${R}`;return s(w,Bn(Q(e.high,r),Q(e.low,r),Q(e.close,r),R))},y=(k=e.high,R=e.low,w=e.close)=>{const O=`ta_tr_${pe(k)}_${pe(R)}_${pe(w)}`;return s(O,dl(Q(k,r),Q(R,r),Q(w,r)))},c=(k=14)=>{const R=le(k,14),w=`ta_atrp_${R}`,O=Bn(Q(e.high,r),Q(e.low,r),Q(e.close,r),R),H=new Array(r);for(let G=0;G<r;G++){const W=O[G],re=e.close.data[G];H[G]=Number.isFinite(W)&&Number.isFinite(re)&&re!==0?W/re*100:void 0}return s(w,H)},M=(k=14)=>{const R=le(k,14),w=`ta_natr_${R}`,O=Bn(Q(e.high,r),Q(e.low,r),Q(e.close,r),R),H=new Array(r);for(let G=0;G<r;G++){const W=O[G],re=e.close.data[G];H[G]=Number.isFinite(W)&&Number.isFinite(re)&&re!==0?W/re*100:void 0}return s(w,H)},o=()=>s("ta_obv",el(Q(e.close,r),Q(e.volume,r))),u=(k=20)=>{const R=le(k,20),w=`ta_cci_${R}`;return s(w,tl(Q(e.high,r),Q(e.low,r),Q(e.close,r),R))},P=(k=14)=>{const R=le(k,14),w=`ta_mfi_${R}`;return s(w,il(Q(e.high,r),Q(e.low,r),Q(e.close,r),Q(e.volume,r),R))},F=()=>s("ta_vwap",sl(Q(e.close,r),Q(e.volume,r))),Y=(k=20)=>{const R=le(k,20),w=`ta_vwma_${R}`;return s(w,al(Q(e.close,r),Q(e.volume,r),R))},X=(k=e.close,R=20,w=2)=>{const O=le(R,20),H=Number.isFinite(Number(w))?Number(w):2,G=`ta_bbands_${pe(k)}_${O}_${H}`,W=n.get(G);if(W)return W;const re=fa(Q(k,r),O,H),oe=s(`${G}_basis`,re.mid),ce=s(`${G}_upper`,re.upper),J=s(`${G}_lower`,re.lower),Fe=[oe,ce,J];return n.set(G,Fe),Fe},B=(k=e.close,R=20,w=2)=>{const O=le(R,20),H=Number.isFinite(Number(w))?Number(w):2,G=`ta_bbw_${pe(k)}_${O}_${H}`,W=fa(Q(k,r),O,H),re=new Array(r);for(let oe=0;oe<r;oe++){const ce=W.mid[oe],J=W.upper[oe],Fe=W.lower[oe];re[oe]=Number.isFinite(ce)&&Number.isFinite(J)&&Number.isFinite(Fe)&&ce!==0?(J-Fe)/ce*100:void 0}return s(G,re)},te=(k=e.close,R=12,w=26,O=9)=>{const H=le(R,12),G=le(w,26),W=le(O,9),re=`ta_macd_${pe(k)}_${H}_${G}_${W}`,oe=n.get(re);if(oe)return oe;const ce=Q(k,r),J=Ft(ce,H),Fe=Ft(ce,G),Ue=new Array(r);for(let kt=0;kt<r;kt++){const Jt=J[kt],It=Fe[kt];Ue[kt]=Jt===void 0||It===void 0?void 0:Jt-It}const et=Ft(Ue,W),Bt=new Array(r);for(let kt=0;kt<r;kt++){const Jt=Ue[kt],It=et[kt];Bt[kt]=Jt===void 0||It===void 0?void 0:Jt-It}const Wt=s(`${re}_line`,Ue),oi=s(`${re}_signal`,et),hi=s(`${re}_hist`,Bt),pi=[Wt,oi,hi];return n.set(re,pi),pi},ie=(k=e.close,R=12,w=26)=>{const O=le(R,12),H=le(w,26),G=`ta_ppo_${pe(k)}_${O}_${H}`,W=Q(k,r),re=Ft(W,O),oe=Ft(W,H),ce=new Array(r);for(let J=0;J<r;J++){const Fe=re[J],Ue=oe[J];ce[J]=Number.isFinite(Fe)&&Number.isFinite(Ue)&&Ue!==0?(Fe-Ue)/Ue*100:void 0}return s(G,ce)},ae=(k=e.close,R=e.high,w=e.low,O=14)=>{const H=le(O,14),G=`ta_stoch_${pe(k)}_${pe(R)}_${pe(w)}_${H}`;return s(G,Kr(Q(R,r),Q(w,r),Q(k,r),H))},fe=(k=e.close,R=14,w=3,O=3)=>{const H=le(R,14),G=le(w,3),W=le(O,3),re=`ta_stochrsi_${pe(k)}_${H}_${G}_${W}`;return s(re,kl(Q(k,r),H,G,W))},ee=(k=14)=>{const R=le(k,14),w=`ta_aroon_${R}`,O=n.get(w);if(O)return O;const H=ma(Q(e.high,r),Q(e.low,r),R),G=s(`${w}_up`,H.up),W=s(`${w}_down`,H.down),re=[G,W];return n.set(w,re),re},ue=(k=14)=>{const R=le(k,14),w=`ta_aroonosc_${R}`,O=ma(Q(e.high,r),Q(e.low,r),R),H=new Array(r);for(let G=0;G<r;G++){const W=O.up[G],re=O.down[G];H[G]=Number.isFinite(W)&&Number.isFinite(re)?W-re:void 0}return s(w,H)},De=(k=14)=>{const R=le(k,14),w=`ta_dmi_${R}`,O=n.get(w);if(O)return O;const H=fr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R),G=s(`${w}_plus`,H.plus),W=s(`${w}_minus`,H.minus),re=s(`${w}_adx`,H.adx),oe=[G,W,re];return n.set(w,oe),oe},Ge=(k=14)=>{const R=le(k,14),w=`ta_plus_di_${R}`;return s(w,fr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R).plus)},Ye=(k=14)=>{const R=le(k,14),w=`ta_minus_di_${R}`;return s(w,fr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R).minus)},Ae=(k=14)=>{const R=le(k,14),w=`ta_adx_${R}`;return s(w,fr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R).adx)},ft=(k=e.high,R=e.low,w=e.close,O=14)=>{const H=le(O,14),G=`ta_vortex_${pe(k)}_${pe(R)}_${pe(w)}_${H}`,W=n.get(G);if(W)return W;const re=Pl(Q(k,r),Q(R,r),Q(w,r),H),oe=s(`${G}_plus`,re.plus),ce=s(`${G}_minus`,re.minus),J=[oe,ce];return n.set(G,J),J},pt=(k=7,R=14,w=28)=>{const O=le(k,7),H=le(R,14),G=le(w,28),W=`ta_uo_${O}_${H}_${G}`;return s(W,Sl(Q(e.high,r),Q(e.low,r),Q(e.close,r),O,H,G))},qt=(k=e.close,R=10)=>{const w=le(R,10),O=`ta_cog_${pe(k)}_${w}`;return s(O,Cl(Q(k,r),w))},Ut=(k=e.high,R=e.low,w=e.close,O=9,H=3,G=3)=>{const W=le(O,9),re=le(H,3),oe=le(G,3),ce=`ta_kdj_${pe(k)}_${pe(R)}_${pe(w)}_${W}_${re}_${oe}`,J=n.get(ce);if(J)return J;const Fe=Kr(Q(k,r),Q(R,r),Q(w,r),W),Ue=si(Fe,re),et=si(Ue,oe),Bt=new Array(r);for(let kt=0;kt<r;kt++){const Jt=Ue[kt],It=et[kt];Bt[kt]=Number.isFinite(Jt)&&Number.isFinite(It)?3*Jt-2*It:void 0}const Wt=s(`${ce}_k`,Ue),oi=s(`${ce}_d`,et),hi=s(`${ce}_j`,Bt),pi=[Wt,oi,hi];return n.set(ce,pi),pi},qe=(k=e.close,R=10,w=15,O=20,H=30,G=10,W=10,re=10,oe=15,ce=9)=>{const J=le(R,10),Fe=le(w,15),Ue=le(O,20),et=le(H,30),Bt=le(G,10),Wt=le(W,10),oi=le(re,10),hi=le(oe,15),pi=le(ce,9),kt=`ta_kst_${pe(k)}_${J}_${Fe}_${Ue}_${et}_${Bt}_${Wt}_${oi}_${hi}_${pi}`,Jt=n.get(kt);if(Jt)return Jt;const It=Q(k,r),Qt=Dn(It,J),gi=Dn(It,Fe),Fi=Dn(It,Ue),Zt=Dn(It,et),Ii=si(Qt,Bt),Ai=si(gi,Wt),nn=si(Fi,oi),zt=si(Zt,hi),ei=new Array(r);for(let Mi=0;Mi<r;Mi++){const dn=Ii[Mi],mn=Ai[Mi],zi=nn[Mi],pn=zt[Mi];ei[Mi]=Number.isFinite(dn)&&Number.isFinite(mn)&&Number.isFinite(zi)&&Number.isFinite(pn)?dn+2*mn+3*zi+4*pn:void 0}const ji=si(ei,pi),Ei=s(`${kt}_kst`,ei),hn=s(`${kt}_signal`,ji),ti=[Ei,hn];return n.set(kt,ti),ti},Lt=(k=e.close,R=e.volume)=>{const w=`ta_pvi_${pe(k)}_${pe(R)}`;return s(w,pa(Q(k,r),Q(R,r),!0))},wt=(k=e.close,R=e.volume)=>{const w=`ta_nvi_${pe(k)}_${pe(R)}`;return s(w,pa(Q(k,r),Q(R,r),!1))},at=()=>s("ta_ad",Fl(Q(e.high,r),Q(e.low,r),Q(e.close,r),Q(e.volume,r))),Pe=(k=20)=>{const R=le(k,20),w=`ta_cmf_${R}`;return s(w,Il(Q(e.high,r),Q(e.low,r),Q(e.close,r),Q(e.volume,r),R))},jt=(k=3,R=10)=>{const w=le(R,10),O=Number.isFinite(Number(k))?Number(k):3,H=`ta_supertrend_${w}_${O}`,G=n.get(H);if(G)return G;const W=ol(Q(e.high,r),Q(e.low,r),Q(e.close,r),w,O),re=new Array(r);for(let Fe=0;Fe<r;Fe++){const Ue=e.close.data[Fe],et=W[Fe];re[Fe]=Number.isFinite(Ue)&&Number.isFinite(et)?Ue>=et?1:-1:void 0}const oe=s(`${H}_line`,W),ce=s(`${H}_dir`,re),J=[oe,ce];return n.set(H,J),J},Ke=(k=20,R=1.5)=>{const w=le(k,20),O=Number.isFinite(Number(R))?Number(R):1.5,H=`ta_keltner_${w}_${O}`,G=n.get(H);if(G)return G;const W=ll(Q(e.high,r),Q(e.low,r),Q(e.close,r),w,O),re=s(`${H}_mid`,W.mid),oe=s(`${H}_upper`,W.upper),ce=s(`${H}_lower`,W.lower),J=[re,oe,ce];return n.set(H,J),J},je=(k=20)=>{const R=le(k,20),w=`ta_donchian_${R}`,O=n.get(w);if(O)return O;const H=computeDonchian(Q(e.high,r),Q(e.low,r),R),G=s(`${w}_upper`,H.upper),W=s(`${w}_lower`,H.lower),re=s(`${w}_mid`,H.mid),oe=[G,W,re];return n.set(w,oe),oe},ot=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_${pe(k)}_${w}`;return s(O,ur(Q(k,r),w).line)},Vt=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_slope_${pe(k)}_${w}`;return s(O,ur(Q(k,r),w).slope)},$t=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_intercept_${pe(k)}_${w}`;return s(O,ur(Q(k,r),w).intercept)},Nt=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_angle_${pe(k)}_${w}`;return s(O,ur(Q(k,r),w).angle)},Tt=(k=e.high,R=3,w=3)=>{const O=le(R,3),H=le(w,3),G=`ta_pivothigh_${pe(k)}_${O}_${H}`;return s(G,da(Q(k,r),O,H,"high"))},gt=(k=e.low,R=3,w=3)=>{const O=le(R,3),H=le(w,3),G=`ta_pivotlow_${pe(k)}_${O}_${H}`;return s(G,da(Q(k,r),O,H,"low"))},Ze=(k,R,w,O,H)=>{let G=e.high,W=e.low,re=e.close,oe=20,ce="classic";if(w!==void 0)G=k,W=R,re=w,oe=le(O??20,20),ce=String(H??"classic").toLowerCase();else{if(cr(k)||cr(R))throw new Error("ta.pivot_points expects (high, low, close, length, type) or (length, type)");k!==void 0&&(oe=le(k,20)),R!==void 0&&(ce=String(R).toLowerCase())}const J=ce==="fib"?"fibonacci":ce,Fe=`ta_pivot_points_${pe(G)}_${pe(W)}_${pe(re)}_${oe}_${J}`,Ue=a.get(Fe);if(Ue)return Ue;const et=ml(Q(G,r),Q(W,r),Q(re,r),oe,J==="woodie"||J==="fibonacci"||J==="camarilla"?J:"classic"),Bt={pp:s(`${Fe}_pp`,et.pp),r1:s(`${Fe}_r1`,et.r1),s1:s(`${Fe}_s1`,et.s1),r2:s(`${Fe}_r2`,et.r2),s2:s(`${Fe}_s2`,et.s2),r3:s(`${Fe}_r3`,et.r3),s3:s(`${Fe}_s3`,et.s3),r4:s(`${Fe}_r4`,et.r4),s4:s(`${Fe}_s4`,et.s4)};return a.set(Fe,Bt),Bt};return{sma:f,ema:h,rma:p,wma:_,dema:E,tema:z,hma:C,kama:v,alma:S,t3:U,trima:V,swma:ne,evwma:he,rsi:me,cmo:be,tsi:ve,roc:Te,mom:Ie,trix:we,ao:ze,zscore:Ce,atr:Ct,tr:y,atrp:c,natr:M,obv:o,cci:u,mfi:P,vwap:F,vwma:Y,bbands:X,bb:X,bbw:B,macd:te,ppo:ie,stoch:ae,stochrsi:fe,aroon:ee,aroonosc:ue,dmi:De,plus_di:Ge,minus_di:Ye,adx:Ae,vortex:ft,uo:pt,cog:qt,kdj:Ut,kst:qe,pvi:Lt,nvi:wt,ad:at,cmf:Pe,supertrend:jt,keltner:Ke,kc:Ke,donchian:je,linreg:ot,linreg_slope:Vt,linreg_intercept:$t,linreg_angle:Nt,pivothigh:Tt,pivotlow:gt,pivot_points:Ze,pivot:Ze,sar:(k=.02,R=.2)=>{const w=Number.isFinite(Number(k))?Number(k):.02,O=Number.isFinite(Number(R))?Number(R):.2,H=`ta_sar_${w}_${O}`,G=Q(e.high,r),W=Q(e.low,r),re=new Array(r);let oe=w,ce=G[0],J=W[0],Fe=!0;for(let Ue=1;Ue<r;Ue++){const et=G[Ue]??NaN,Bt=W[Ue]??NaN;if(!Number.isFinite(et)||!Number.isFinite(Bt)){re[Ue]=void 0;continue}let Wt=J;Fe?(Wt=J+oe*(ce-J),et>ce&&(ce=et,oe=Math.min(O,oe+w)),Wt>Bt&&(Fe=!1,Wt=ce,ce=Bt,oe=w)):(Wt=J-oe*(J-ce),Bt<ce&&(ce=Bt,oe=Math.min(O,oe+w)),Wt<et&&(Fe=!0,Wt=ce,ce=et,oe=w)),re[Ue]=Wt,J=Wt}return re[0]=J,s(H,re)},sum:(k,R=10)=>{const w=le(R,10),O=`ta_sum_${pe(k)}_${w}`;return s(O,an(Q(k,r),w))},highest:(k,R=10)=>{const w=le(R,10),O=`ta_highest_${pe(k)}_${w}`;return s(O,fl(Q(k,r),w))},lowest:(k,R=10)=>{const w=le(R,10),O=`ta_lowest_${pe(k)}_${w}`;return s(O,hl(Q(k,r),w))},rising:(k,R=5)=>{const w=le(R,5),O=`ta_rising_${pe(k)}_${w}`,H=Q(k,r),G=new Array(r);for(let W=0;W<r;W++){if(W<w){G[W]=void 0;continue}let re=!0;for(let oe=W-w+1;oe<=W;oe++){const ce=H[oe-1],J=H[oe];if(!Number.isFinite(ce)||!Number.isFinite(J)||J<=ce){re=!1;break}}G[W]=re?1:0}return s(O,G)},falling:(k,R=5)=>{const w=le(R,5),O=`ta_falling_${pe(k)}_${w}`,H=Q(k,r),G=new Array(r);for(let W=0;W<r;W++){if(W<w){G[W]=void 0;continue}let re=!0;for(let oe=W-w+1;oe<=W;oe++){const ce=H[oe-1],J=H[oe];if(!Number.isFinite(ce)||!Number.isFinite(J)||J>=ce){re=!1;break}}G[W]=re?1:0}return s(O,G)},cross:(k,R)=>{const w=`ta_cross_${pe(k)}_${pe(R)}`,O=Q(k,r),H=Q(R,r),G=new Array(r);for(let W=0;W<r;W++){if(W===0){G[W]=void 0;continue}const re=O[W-1],oe=H[W-1],ce=O[W],J=H[W];if(!Number.isFinite(re)||!Number.isFinite(oe)||!Number.isFinite(ce)||!Number.isFinite(J)){G[W]=void 0;continue}const Fe=re<=oe&&ce>J||re>=oe&&ce<J;G[W]=Fe?1:0}return s(w,G)},crossover:(k,R)=>{const w=`ta_crossover_${pe(k)}_${pe(R)}`,O=Q(k,r),H=Q(R,r),G=new Array(r);for(let W=0;W<r;W++){if(W===0){G[W]=void 0;continue}const re=O[W-1],oe=H[W-1],ce=O[W],J=H[W];if(!Number.isFinite(re)||!Number.isFinite(oe)||!Number.isFinite(ce)||!Number.isFinite(J)){G[W]=void 0;continue}G[W]=re<=oe&&ce>J?1:0}return s(w,G)},crossunder:(k,R)=>{const w=`ta_crossunder_${pe(k)}_${pe(R)}`,O=Q(k,r),H=Q(R,r),G=new Array(r);for(let W=0;W<r;W++){if(W===0){G[W]=void 0;continue}const re=O[W-1],oe=H[W-1],ce=O[W],J=H[W];if(!Number.isFinite(re)||!Number.isFinite(oe)||!Number.isFinite(ce)||!Number.isFinite(J)){G[W]=void 0;continue}G[W]=re>=oe&&ce<J?1:0}return s(w,G)},valuewhen:(k,R,w=0)=>{const O=Math.max(0,Math.floor(Number(w)||0)),H=`ta_valuewhen_${pe(k)}_${pe(R)}_${O}`,G=Q(k,r),W=Q(R,r),re=new Array(r),oe=[];for(let ce=0;ce<r;ce++){const J=G[ce];if(Number.isFinite(J)&&J!==0){const Fe=W[ce];oe.unshift(Number.isFinite(Fe)?Fe:NaN)}re[ce]=oe.length>O?oe[O]:void 0}return s(H,re)}}},Bi=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),Al=e=>e.trim().replace(/\s+/g,"_").toLowerCase(),on=e=>Bi(e)?Al(e.name):`const_${String(e)}`,en=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?t:NaN},El=e=>Number.isFinite(e)?e:void 0,Ml=e=>{for(const t of e)if(Bi(t))return t.data.length;return 0},cn=(e,t)=>Bi(e)?en(e.data[t]):en(e),dr=e=>{const t=new Map,i=(v,S,U)=>{const V=`${v}:${S.map(on).join("|")}`,ne=t.get(V);if(ne)return ne;const he=Ml(S),me=new Array(he);for(let ve=0;ve<he;ve++)me[ve]=El(U(ve));const be=ni(v,me,e);return t.set(V,be),be},n=(v,S)=>U=>Bi(U)?i(`math_${v}_${on(U)}`,[U],V=>S(cn(U,V))):S(en(U)),a=(v,S)=>(U,V)=>Bi(U)||Bi(V)?i(`math_${v}_${on(U)}_${on(V)}`,[U,V],ne=>S(cn(U,ne),cn(V,ne))):S(en(U),en(V)),r=(v,S)=>(...U)=>U.some(V=>Bi(V))?i(`math_${v}_${U.map(on).join("_")}`,U,V=>S(U.map(ne=>cn(ne,V)))):S(U.map(V=>en(V))),s=(v,S)=>!Number.isFinite(v)||!Number.isFinite(S)||S===0?NaN:(v%S+S)%S,f=(v,S)=>!Number.isFinite(v)||!Number.isFinite(S)||S===0?NaN:v%S,h=v=>{if(!v.length)return NaN;let S=-1/0;for(const U of v){if(!Number.isFinite(U))return NaN;U>S&&(S=U)}return S},p=v=>{if(!v.length)return NaN;let S=1/0;for(const U of v){if(!Number.isFinite(U))return NaN;U<S&&(S=U)}return S},_=v=>{if(!v.length)return NaN;let S=0;for(const U of v){if(!Number.isFinite(U))return NaN;S+=U}return S},E=v=>{if(!v.length)return NaN;const S=_(v);return Number.isFinite(S)?S/v.length:NaN},z=(v,S,U)=>!Number.isFinite(v)||!Number.isFinite(S)||!Number.isFinite(U)?NaN:Math.min(Math.max(v,S),U),C=v=>Number.isFinite(v)?Math.round(v):NaN;return{pi:Math.PI,e:Math.E,abs:n("abs",v=>Number.isFinite(v)?Math.abs(v):NaN),acos:n("acos",v=>v>=-1&&v<=1?Math.acos(v):NaN),asin:n("asin",v=>v>=-1&&v<=1?Math.asin(v):NaN),atan:n("atan",v=>Number.isFinite(v)?Math.atan(v):NaN),atan2:a("atan2",(v,S)=>Number.isFinite(v)&&Number.isFinite(S)?Math.atan2(v,S):NaN),ceil:n("ceil",v=>Number.isFinite(v)?Math.ceil(v):NaN),cos:n("cos",v=>Number.isFinite(v)?Math.cos(v):NaN),exp:n("exp",v=>Number.isFinite(v)?Math.exp(v):NaN),floor:n("floor",v=>Number.isFinite(v)?Math.floor(v):NaN),log:n("log",v=>v>0?Math.log(v):NaN),log10:n("log10",v=>v>0?Math.log10(v):NaN),max:r("max",h),min:r("min",p),sum:r("sum",_),avg:r("avg",E),pow:a("pow",(v,S)=>Number.isFinite(v)&&Number.isFinite(S)?Math.pow(v,S):NaN),round:n("round",C),sign:n("sign",v=>Number.isFinite(v)?Math.sign(v):NaN),sin:n("sin",v=>Number.isFinite(v)?Math.sin(v):NaN),sqrt:n("sqrt",v=>v>=0?Math.sqrt(v):NaN),tan:n("tan",v=>Number.isFinite(v)?Math.tan(v):NaN),trunc:n("trunc",v=>Number.isFinite(v)?Math.trunc(v):NaN),hypot:r("hypot",v=>v.every(S=>Number.isFinite(S))?Math.hypot(...v):NaN),mod:a("mod",s),fmod:a("fmod",f),clamp:(v,S,U)=>Bi(v)||Bi(S)||Bi(U)?i(`math_clamp_${on(v)}_${on(S)}_${on(U)}`,[v,S,U],V=>z(cn(v,V),cn(S,V),cn(U,V))):z(en(v),en(S),en(U)),isfinite:n("isfinite",v=>Number.isFinite(v)?1:0),isnan:n("isnan",v=>Number.isNaN(v)?1:0),todegrees:n("todegrees",v=>Number.isFinite(v)?v*180/Math.PI:NaN),toradians:n("toradians",v=>Number.isFinite(v)?v*Math.PI/180:NaN)}},Xt=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?Math.min(255,Math.max(0,Math.round(t))):0},_i=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?Math.min(1,Math.max(0,t)):1},un=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?Math.min(1,Math.max(0,t)):0},Hr=e=>{const t=e.trim().replace(/^#/,"");if(/^[0-9a-fA-F]{6}$/.test(t))return`#${t.toLowerCase()}`;if(/^[0-9a-fA-F]{3}$/.test(t)){const i=t[0],n=t[1],a=t[2];return`#${i}${i}${n}${n}${a}${a}`.toLowerCase()}if(/^[0-9a-fA-F]{8}$/.test(t))return`#${t.toLowerCase()}`;if(/^[0-9a-fA-F]{4}$/.test(t)){const i=t[0],n=t[1],a=t[2],r=t[3];return`#${i}${i}${n}${n}${a}${a}${r}${r}`.toLowerCase()}return null},Tl=e=>{const t=Hr(e);if(!t)return null;const i=t.replace("#","");if(i.length===6){const n=parseInt(i.slice(0,2),16),a=parseInt(i.slice(2,4),16),r=parseInt(i.slice(4,6),16);return{r:n,g:a,b:r}}if(i.length===8){const n=parseInt(i.slice(0,2),16),a=parseInt(i.slice(2,4),16),r=parseInt(i.slice(4,6),16),s=parseInt(i.slice(6,8),16)/255;return{r:n,g:a,b:r,a:s}}return null},Rl=e=>{const t=e.trim().match(/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*(?:,\s*([0-9.]+%?)\s*)?\)$/i);if(!t)return null;const i=h=>h.endsWith("%")?Xt(Number(h.slice(0,-1))/100*255):Xt(h),n=h=>h.endsWith("%")?_i(Number(h.slice(0,-1))/100):_i(h),a=i(t[1]),r=i(t[2]),s=i(t[3]),f=t[4]!=null?n(t[4]):void 0;return{r:a,g:r,b:s,a:f}},Ol=e=>{const t=e.trim().match(/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+)%\s*,\s*([0-9.]+)%\s*(?:,\s*([0-9.]+%?)\s*)?\)$/i);if(!t)return null;const i=Number(t[1]),n=un(Number(t[2])/100),a=un(Number(t[3])/100),r=t[4]?t[4].endsWith("%")?_i(Number(t[4].slice(0,-1))/100):_i(t[4]):void 0;return{...ga(i,n,a),a:r}},Di=e=>{const t=e.trim().toLowerCase(),n=ya[t]||e;return Tl(n)||Rl(n)||Ol(n)},mr=(e,t)=>{const i=Di(e);if(!i)return e;const n=t!=null?_i(t):_i(i.a??1);return`rgba(${i.r},${i.g},${i.b},${n})`},ga=(e,t,i)=>{const n=(e%360+360)%360,a=un(t),r=un(i),s=(1-Math.abs(2*r-1))*a,f=s*(1-Math.abs(n/60%2-1)),h=r-s/2;let p=0,_=0,E=0;return n<60?[p,_,E]=[s,f,0]:n<120?[p,_,E]=[f,s,0]:n<180?[p,_,E]=[0,s,f]:n<240?[p,_,E]=[0,f,s]:n<300?[p,_,E]=[f,0,s]:[p,_,E]=[s,0,f],{r:Xt((p+h)*255),g:Xt((_+h)*255),b:Xt((E+h)*255)}},ql=(e,t,i)=>{const n=(e%360+360)%360,a=un(t),r=un(i),s=r*a,f=s*(1-Math.abs(n/60%2-1)),h=r-s;let p=0,_=0,E=0;return n<60?[p,_,E]=[s,f,0]:n<120?[p,_,E]=[f,s,0]:n<180?[p,_,E]=[0,s,f]:n<240?[p,_,E]=[0,f,s]:n<300?[p,_,E]=[f,0,s]:[p,_,E]=[s,0,f],{r:Xt((p+h)*255),g:Xt((_+h)*255),b:Xt((E+h)*255)}},fn=(e,t,i)=>{const n=Di(e),a=Di(t);if(!n||!a)return mr(e);const r=un(i),s=Xt(n.r+(a.r-n.r)*r),f=Xt(n.g+(a.g-n.g)*r),h=Xt(n.b+(a.b-n.b)*r),p=n.a??1,_=a.a??1,E=_i(p+(_-p)*r);return`rgba(${s},${f},${h},${E})`},ya={red:"#ef4444",green:"#16a34a",orange:"#f59e0b",blue:"#3b82f6",gray:"#64748b",grey:"#64748b",white:"#e2e8f0",black:"#0b1220",yellow:"#facc15",purple:"#a855f7",teal:"#14b8a6",cyan:"#22d3ee",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",pink:"#ec4899",rose:"#f43f5e",slate:"#94a3b8",zinc:"#a1a1aa",stone:"#a8a29e",emerald:"#10b981",sky:"#38bdf8",violet:"#8b5cf6",fuchsia:"#d946ef"},pr=()=>({...ya,rgb:(e,t,i)=>`rgb(${Xt(e)},${Xt(t)},${Xt(i)})`,rgba:(e,t,i,n)=>`rgba(${Xt(e)},${Xt(t)},${Xt(i)},${_i(n)})`,hsl:(e,t,i,n)=>{const a=t>1?t/100:t,r=i>1?i/100:i,s=ga(e,a,r),f=n==null?1:_i(n>1?n/100:n);return`rgba(${s.r},${s.g},${s.b},${f})`},hsv:(e,t,i,n)=>{const a=t>1?t/100:t,r=i>1?i/100:i,s=ql(e,a,r),f=n==null?1:_i(n>1?n/100:n);return`rgba(${s.r},${s.g},${s.b},${f})`},from_hex:e=>Hr(e)??e,fromHex:e=>Hr(e)??e,new:(e,t=0)=>{const i=typeof t=="number"?t:Number(t),n=Number.isFinite(i)?1-Math.min(100,Math.max(0,i))/100:1;return mr(e,n)},tostring:e=>String(e??""),alpha:e=>{const t=Di(e);return _i((t==null?void 0:t.a)??1)},set_alpha:(e,t)=>mr(e,t),setAlpha:(e,t)=>mr(e,t),r:e=>{const t=Di(e);return t?t.r:0},g:e=>{const t=Di(e);return t?t.g:0},b:e=>{const t=Di(e);return t?t.b:0},a:e=>{const t=Di(e);return _i((t==null?void 0:t.a)??1)},from_gradient:(e,t,i)=>fn(e,t,i),fromGradient:(e,t,i)=>fn(e,t,i),blend:(e,t,i)=>fn(e,t,i),mix:(e,t,i)=>fn(e,t,i),lerp:(e,t,i)=>fn(e,t,i),invert:e=>{const t=Di(e);return t?`rgba(${255-t.r},${255-t.g},${255-t.b},${_i(t.a??1)})`:e},lighten:(e,t)=>fn(e,"#ffffff",t),darken:(e,t)=>fn(e,"#000000",t),is_valid:e=>!!Di(e)}),Ll=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),Jr=e=>Ll(e)||e&&typeof e=="object"&&typeof e.valueOf=="function"?e.valueOf():e,Me=e=>{const t=Jr(e);return t==null?"":String(t)},ai=e=>{const t=Jr(e);if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="boolean")return t?1:0;if(t==null)return NaN;const i=Number(t);return Number.isFinite(i)?i:NaN},jn=(e,t,i)=>{const n=Math.trunc(ai(e));return Number.isFinite(n)?n<0?Math.max(0,t+n):Math.min(t,Math.max(0,n)):i},Vl=(e,t)=>{if(!Number.isFinite(e)||t==null)return String(e);const i=String(t);if(!i.trim())return String(e);const n=i.includes("%"),a=i.match(/0\.(0+)/),r=a?a[1].length:0,s=n?e*100:e,f=r>0?s.toFixed(r):String(Math.round(s));return n?`${f}%`:f},$l=e=>e.flags.includes("g")?e:new RegExp(e.source,`${e.flags}g`),gr=()=>{const e=(r,s)=>Me(r).startsWith(Me(s)),t=(r,s)=>Me(r).endsWith(Me(s)),i=(r,s,f)=>{const h=Me(r);if(s instanceof RegExp)return h.replace($l(s),Me(f));const p=Me(s);return p?h.split(p).join(Me(f)):h},n=(r,s,f)=>{const h=Me(r),p=Number.isFinite(ai(f))?Math.trunc(ai(f)):0;return h.indexOf(Me(s),p)},a=(r,s,f)=>{const h=Me(r),p=Number.isFinite(ai(f))?Math.trunc(ai(f)):h.length;return h.lastIndexOf(Me(s),p)};return{length:r=>Me(r).length,upper:r=>Me(r).toUpperCase(),lower:r=>Me(r).toLowerCase(),trim:r=>Me(r).trim(),trim_left:r=>Me(r).trimStart(),trim_right:r=>Me(r).trimEnd(),trimLeft:r=>Me(r).trimStart(),trimRight:r=>Me(r).trimEnd(),startswith:e,starts_with:e,startsWith:e,endswith:t,ends_with:t,endsWith:t,contains:(r,s)=>Me(r).includes(Me(s)),indexof:n,indexOf:n,last_indexof:a,lastIndexOf:a,pos:n,last_pos:a,count:(r,s)=>{const f=Me(r),h=Me(s);if(!h)return 0;let p=0,_=0;for(;;){const E=f.indexOf(h,p);if(E===-1)break;_+=1,p=E+h.length}return _},char:(r,s)=>{const f=Me(r),h=jn(s,f.length,0);return f.charAt(h)},substring:(r,s,f)=>{const h=Me(r),p=jn(s,h.length,0),_=f==null?h.length:jn(f,h.length,h.length);return h.substring(p,_)},slice:(r,s,f)=>{const h=Me(r),p=jn(s,h.length,0),_=f==null?h.length:jn(f,h.length,h.length);return h.slice(p,_)},repeat:(r,s)=>{const f=Me(r),h=Math.max(0,Math.trunc(ai(s)));return Number.isFinite(h)?f.repeat(h):""},reverse:r=>Me(r).split("").reverse().join(""),replace:(r,s,f)=>{const h=Me(r);return s instanceof RegExp?h.replace(s,Me(f)):h.replace(Me(s),Me(f))},replace_all:i,replaceAll:i,split:(r,s,f)=>{const h=Me(r),p=Number.isFinite(ai(f))?Math.max(0,Math.trunc(ai(f))):void 0;return s==null?p==null?[h]:[h].slice(0,p):s instanceof RegExp?h.split(s,p):h.split(Me(s),p)},join:(r,s)=>Array.isArray(r)?r.map(f=>Me(f)).join(s==null?",":Me(s)):Me(r),pad_left:(r,s,f)=>{const h=Me(r),p=Math.max(0,Math.trunc(ai(s))),_=f==null?" ":Me(f);return h.padStart(p,_)},pad_right:(r,s,f)=>{const h=Me(r),p=Math.max(0,Math.trunc(ai(s))),_=f==null?" ":Me(f);return h.padEnd(p,_)},padLeft:(r,s,f)=>Me(r).padStart(Math.max(0,Math.trunc(ai(s))),f==null?" ":Me(f)),padRight:(r,s,f)=>Me(r).padEnd(Math.max(0,Math.trunc(ai(s))),f==null?" ":Me(f)),format:(r,...s)=>{let h=Me(r).replace(/\{(\d+)\}/g,(_,E)=>{const z=s[Number(E)];return Me(z)}),p=0;return h=h.replace(/\{\}/g,()=>Me(s[p++])),h},tostring:(r,s)=>{const f=Jr(r);return typeof f=="number"?Vl(f,s):Me(f)},tonumber:(r,s,f)=>{const h=Me(r).trim(),p=Number.isFinite(ai(f))&&Math.trunc(ai(f))>=2?Math.trunc(ai(f)):void 0,_=p!=null?Number.parseInt(h,p):Number(h);if(Number.isFinite(_))return _;const E=ai(s);return Number.isFinite(E)?E:NaN}}};function tn(e){return!Number.isFinite(e)||e<=0?0:e<1e11?e*1e3:e}function Bl(e){const t=new Date(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0)}function Dl(e){const t=new Date(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1,0,0,0,0)}function jl(e){const t=String(e||"").trim(),i=t.toUpperCase();if(!i)return null;if(i==="D"||i==="1D")return{kind:"calendar",unit:"D"};if(i==="W"||i==="1W")return{kind:"calendar",unit:"W"};if(t==="M"||t==="1M")return{kind:"calendar",unit:"M"};if(/^\d+$/.test(i))return{kind:"fixed",ms:Math.max(1,Number(i))*60*1e3};const n=i.match(/^(\d+)\s*([A-Z]+)$/);if(n){const a=Math.max(1,Number(n[1])),r=n[2];if(r==="S"||r==="SEC"||r==="SECS"||r==="SECOND"||r==="SECONDS")return{kind:"fixed",ms:a*1e3};if(r==="H"||r==="HR"||r==="HRS")return{kind:"fixed",ms:a*60*60*1e3};if(r==="MIN"||r==="MINS")return{kind:"fixed",ms:a*60*1e3};if(r==="M"&&t.toLowerCase().endsWith("m"))return{kind:"fixed",ms:a*60*1e3};if(r==="D"||r==="DAY"||r==="DAYS")return{kind:"fixed",ms:a*24*60*60*1e3};if(r==="W"||r==="WK"||r==="WEEK"||r==="WEEKS")return{kind:"fixed",ms:a*7*24*60*60*1e3}}return null}const xa=new Map,ba=new Map;function zl(e){const t=e||"UTC",i=xa.get(t);if(i)return i;const n=new Intl.DateTimeFormat("en-GB",{timeZone:t,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return xa.set(t,n),n}function Ul(e){const t=e||"UTC",i=ba.get(t);if(i)return i;const n=new Intl.DateTimeFormat("en-GB",{timeZone:t,weekday:"short"});return ba.set(t,n),n}function yr(e,t){if(!Number.isFinite(e))return null;const n=zl(t).formatToParts(new Date(e)),a={};for(const E of n)(E.type==="year"||E.type==="month"||E.type==="day"||E.type==="hour"||E.type==="minute"||E.type==="second")&&(a[E.type]=E.value);const r=Number(a.year),s=Number(a.month),f=Number(a.day),h=Number(a.hour),p=Number(a.minute),_=Number(a.second);return[r,s,f,h,p,_].every(E=>Number.isFinite(E))?{y:r,m:s,d:f,h,min:p,s:_}:null}function Wl(e,t){const n=Ul(t).format(new Date(e));return{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}[n]??null}function xr(e,t){const i=yr(e,t);return i?Date.UTC(i.y,i.m-1,i.d,i.h,i.min,i.s,0)-e:0}function _a(e,t){const i=yr(e,t);if(!i)return Bl(e);let n=Date.UTC(i.y,i.m-1,i.d,0,0,0,0);const a=xr(n,t);n=n-a;const r=xr(n,t);return n-r}function Ql(e,t){const i=_a(e,t),n=Wl(e,t);return i-(typeof n=="number"?n:0)*24*60*60*1e3}function Gl(e,t){const i=yr(e,t);if(!i)return Dl(e);let n=Date.UTC(i.y,i.m-1,1,0,0,0,0);const a=xr(n,t);n=n-a;const r=xr(n,t);return n-r}function zn(e,t,i){if(!t)return e;if(t.kind==="fixed")return Math.floor(e/t.ms)*t.ms;const n=i||"UTC";return t.unit==="D"?_a(e,n):t.unit==="W"?Ql(e,n):Gl(e,n)}function Kl(e){const t=String(e||"").trim();if(!t)return[];if(t.toLowerCase()==="24x7"||t==="0000-2359")return[];const i=t.split(/[;,]/).map(a=>a.trim()).filter(Boolean),n=[];for(const a of i){const r=a.match(/(\d{1,2}):?(\d{2})\s*-\s*(\d{1,2}):?(\d{2})/);if(!r)continue;const s=Number(r[1]),f=Number(r[2]),h=Number(r[3]),p=Number(r[4]);if([s,f,h,p].some(z=>!Number.isFinite(z)))continue;const _=s*60+f,E=h*60+p;n.push({start:_,end:E})}return n}function Yr(e,t,i){const n=Kl(t);if(!n.length)return!0;const r=yr(e,i||"UTC");if(!r)return!0;const s=r.h*60+r.min;for(const f of n)if(f.start<=f.end){if(s>=f.start&&s<=f.end)return!0}else if(s>=f.start||s<=f.end)return!0;return!1}function Hl(e){const t=[];let i=null;for(let n=0;n<e.length;n++){const a=tn(e[n]??0);if(a){if(i!=null){const r=a-i;r>0&&Number.isFinite(r)&&t.push(r)}if(i=a,t.length>=200)break}}return t.length<3?null:(t.sort((n,a)=>n-a),t[Math.floor(t.length/2)]??null)}const Un=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),Xr=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="boolean")return e?1:0;if(e==null)return NaN;const t=Number(e);return Number.isFinite(t)?t:NaN},Jl=e=>{let t=2166136261;for(let i=0;i<e.length;i++)t^=e.charCodeAt(i),t=Math.imul(t,16777619);return(t>>>0).toString(36)},br=e=>String(e||"").trim().toLowerCase().replace(/\s+/g,""),va=e=>{const t=String(e||"").trim();if(!t)return"__CURRENT__";const i=t.toUpperCase();if(i==="CURRENT"||i==="__CURRENT__"||i==="TIMEFRAME.PERIOD")return"__CURRENT__";if(i==="D"||i==="1D")return"1d";if(i==="W"||i==="1W")return"1w";if(i==="M"||i==="1M")return"1M";if(/^\d+$/.test(t))return`${t}m`;const n=i.match(/^(\d+)\s*H$/);if(n)return`${n[1]}h`;const a=i.match(/^(\d+)\s*S$/);if(a)return`${a[1]}s`;const r=t.match(/^(\d+)\s*([A-Za-z]+)$/);if(r){const s=r[1]||"1",f=(r[2]||"").toLowerCase();if(f.startsWith("min"))return`${s}m`;if(f.startsWith("sec"))return`${s}s`;if(f==="h"||f.startsWith("hr"))return`${s}h`;if(f==="d"||f.startsWith("day"))return`${s}d`;if(f==="w"||f.startsWith("wk"))return`${s}w`;if(f==="m"&&t.toLowerCase().endsWith("m"))return`${s}m`}return t},Yl=(e,t)=>`${e}|${va(t)}`,Xl=e=>{const t=e.length,i=new Array(t),n=new Array(t),a=new Array(t),r=new Array(t),s=new Array(t),f=new Array(t),h=new Array(t);for(let p=0;p<t;p++){const _=e[p],E=Number(_==null?void 0:_.close),z=Number(_==null?void 0:_.open),C=Number(_==null?void 0:_.high),v=Number(_==null?void 0:_.low),S=tn((_==null?void 0:_.timestamp)??(_==null?void 0:_.time)??(_==null?void 0:_.t)??0);r[p]=Number.isFinite(E)?E:void 0,i[p]=Number.isFinite(z)?z:r[p],n[p]=Number.isFinite(C)?C:r[p]??i[p],a[p]=Number.isFinite(v)?v:r[p]??i[p];const U=Number(_==null?void 0:_.volume);s[p]=Number.isFinite(U)?U:0,f[p]=S||0,h[p]=p}return{open:i,high:n,low:a,close:r,volume:s,time:f,bar_index:h}},Zl=(e,t)=>{let i=0,n=e.length;for(;i<n;){const a=i+n>>>1;(e[a]??0)>t?n=a:i=a+1}return i},ec=(e,t)=>{if(Un(e)){if(e.data.length!==t)throw new Error("request.security: expression returned a series from a different timeframe");return Xr(e.get(0))}if(e&&typeof e=="object")throw new Error("request.security: expression must return a number or series");return Xr(e)},tc=e=>{if(e==null)return"off";if(typeof e=="boolean")return e?"on":"off";const t=String(e).trim().toLowerCase();return t==="on"||t==="true"||t==="yes"?"on":"off"},ic=e=>{if(e==null)return"off";if(typeof e=="boolean")return e?"on":"off";const t=String(e).trim().toLowerCase();return t==="on"||t==="true"||t==="yes"?"on":"off"},nc=e=>{const t=(e==null?void 0:e.timezone)??(e==null?void 0:e.tz);if(t==null)return;const i=String(t).trim();return i||void 0},rc=e=>{if((e==null?void 0:e.session)==null)return;const t=String(e.session).trim();return t||void 0},sc=e=>{const t=e.trim().toLowerCase();return t==="open"||t==="high"||t==="low"||t==="close"||t==="volume"||t==="time"||t==="bar_index"},ac=(e,t,i)=>{const n=e.close.length,a=new Array(n),r=new Array(n).fill(!1),s=[],f=[],h=[],p=[],_=[],E=[];let z=NaN,C=-1;for(let V=0;V<n;V++){const ne=tn(e.time[V]??0);if(!ne){a[V]=-1;continue}const he=zn(ne,t,i);if(!Number.isFinite(z)||he!==z){z=he,C+=1,E[C]=he;const me=e.close[V]??NaN;s[C]=e.open[V]??me,f[C]=e.high[V]??me,h[C]=e.low[V]??me,p[C]=me,_[C]=e.volume[V]??0}else{const me=e.high[V],be=e.low[V],ve=e.close[V];me!=null&&Number.isFinite(me)&&(f[C]=Math.max(f[C],me)),be!=null&&Number.isFinite(be)&&(h[C]=Math.min(h[C],be)),ve!=null&&Number.isFinite(ve)&&(p[C]=ve);const Te=e.volume[V];Te!=null&&Number.isFinite(Te)&&(_[C]+=Te)}a[V]=C}for(let V=0;V<n;V++){const ne=a[V],he=V+1<n?a[V+1]:ne;r[V]=ne>=0&&V+1<n&&ne!==he}const v=C+1,S=new Array(v);for(let V=0;V<v;V++)S[V]=V;return{map:a,isEnd:r,htf:{open:s,high:f,low:h,close:p,volume:_,time:E,bar_index:S}}},Zr=(e,t,i,n)=>{const a=t.close.data.length;if(Un(e)){if(e.data.length!==a){if(sc(e.name)){const s=t[e.name];if(s&&s.data.length===a)return s.data.map(f=>Number.isFinite(f)?f:void 0)}throw new Error("request.security: series input must match the requested timeframe")}return e.data.map(s=>Number.isFinite(s)?s:void 0)}if(typeof e=="number"||typeof e=="boolean"||e==null){const s=Xr(e);return new Array(a).fill(Number.isFinite(s)?s:void 0)}if(typeof e!="function")throw new Error("request.security: expression must be a function or series");const r=new Array(a);for(let s=0;s<a;s++){n.value=s;const f=e(t,i),h=ec(f,a);r[s]=Number.isFinite(h)?h:void 0}return r},oc=e=>{var Ct,y,c,M;const t=e.base,i=t.close.length,n=Hl(t.time),a=t.time.some(o=>tn(o??0)>0),r=((Ct=e.mtf)==null?void 0:Ct.sources)??{},s=String(((y=e.mtf)==null?void 0:y.baseSymbol)||"__CURRENT__").trim(),f=br(s||"__CURRENT__"),h=((c=e.mtf)==null?void 0:c.collectOnly)===!0,p=new Map;if((M=e.mtf)!=null&&M.symbolAliases)for(const[o,u]of Object.entries(e.mtf.symbolAliases))!o||!u||p.set(br(o),String(u));const _=new Map,E=new WeakMap;let z=0,C=0,v=0;const S=6,U=[],V=[],ne=new Map,he=Yn({open:t.open,high:t.high,low:t.low,close:t.close,volume:t.volume,time:t.time,barIndex:t.bar_index,indexRef:e.baseIndexRef,params:e.params}),me={ta:hr(he,e.baseIndexRef),math:dr(e.baseIndexRef),color:pr(),str:gr()},be=o=>{const u=String(o??"").trim();if(!u)return{key:f,label:s};const P=u.toLowerCase();if(P==="syminfo.tickerid"||P==="syminfo.ticker"||P==="syminfo.root"||P==="__current__"||P==="__current_symbol__")return{key:f,label:s};const Y=p.get(br(u))||u;return{key:br(Y),label:Y}},ve=o=>{const u=E.get(o);if(u)return u;const P=++z;return E.set(o,P),P},Te=o=>{const P=String(o||"").replace(/\s+/g," ").trim();return!P||P.includes("[native code]")?`fn_${ve(o)}`:`fn_${Jl(P)}`},Ie=(o,u,P,F,Y,X,B,te)=>{let ie="expr";return typeof B=="function"?ie=Te(B):Un(B)?ie=`series_${B.name}`:ie=`const_${String(B)}`,[o,u||"__CURRENT__",P,F,Y||"",X||"",ie,te?"ltf":"htf"].join("|")},we=(o,u,P,F,Y,X=!1)=>{if(C>=S)throw new Error("request.security: nesting limit exceeded");C+=1;try{const B=String(P||"").trim(),te=tc(Y==null?void 0:Y.lookahead),ie=ic(Y==null?void 0:Y.gaps),ae=nc(Y),fe=rc(Y),ee=Yl(o,B),ue=Ie(o,B,te,ie,ae,fe,F,X),De=_.get(ue);if(De)return De.ref;if(v+=1,v>Ki.maxSecurityCalls)throw new Error(`JS guardrail: request.security call limit exceeded (max ${Ki.maxSecurityCalls})`);const Ge=()=>{const je=new Array(i).fill(void 0),ot=ni(`__js_sec_${_.size+1}`,je,e.baseIndexRef);return _.set(ue,{ref:ot}),ot};if(!B||B.toLowerCase()==="current"||B==="__CURRENT__"){let je=Zr(F,he,me,e.baseIndexRef);ie==="on"&&(je=je.map((Vt,$t)=>{const Nt=tn(t.time[$t]??0);return Yr(Nt,fe,ae)?Vt:void 0}));const ot=ni(`__js_sec_${_.size+1}`,je,e.baseIndexRef);return _.set(ue,{ref:ot}),ot}const Ye=jl(B);if(!Ye)throw new Error(`request.security: invalid timeframe "${B}"`);if(!a)throw new Error("request.security: base time series is missing");const Ae=n,ft=Ye.kind==="fixed"?Ye.ms:Ye.unit==="D"?24*60*60*1e3:Ye.unit==="W"?7*24*60*60*1e3:30*24*60*60*1e3;if(X&&Ae!=null&&ft>=Ae)throw new Error(`request.security_lower_tf: "${B}" must be lower than chart timeframe`);const pt=r[ee];if(!pt&&h){if(typeof F=="function")try{F(he,me)}catch{}return V.push(ee),Ge()}if(pt&&Array.isArray(pt.candles)){const je=ne.get(ee)||Xl(pt.candles);if(ne.set(ee,je),!je.close.length){if(h)return V.push(ee),Ge();throw new Error(`request.security: no data for ${u} (${va(B)})`)}const ot={value:0},Vt=Yn({open:je.open,high:je.high,low:je.low,close:je.close,volume:je.volume,time:je.time,barIndex:je.bar_index,indexRef:ot,params:e.params}),$t={ta:hr(Vt,ot),math:dr(ot),color:pr(),str:gr()},Nt=Zr(F,Vt,$t,ot),Tt=new Array(i),gt=je.time,Ze=Ae??0,Rt=new Array(i),N=new Array(i);for(let D=0;D<i;D++){const K=tn(t.time[D]??0);if(!K){Rt[D]=-1;continue}let $=K;if(D+1<i){const se=tn(t.time[D+1]??0);se&&se>K&&($=se-1)}else Ze>0&&($=K+Ze-1);const _e=Zl(gt,$);Rt[D]=_e-1}for(let D=0;D<i;D++){const K=Rt[D],$=D+1<i?Rt[D+1]:K;N[D]=K>=0&&D+1<i&&K!==$}for(let D=0;D<i;D++){const K=Rt[D];if(K<0||K>=Nt.length){Tt[D]=void 0;continue}const $=tn(t.time[D]??0);if(ie==="on"&&!Yr($,fe,ae)){Tt[D]=void 0;continue}const _e=te==="on"||N[D]?Nt[K]:K>0?Nt[K-1]:NaN;let se=Number.isFinite(_e)?_e:void 0;if(ie==="on"){const ge=zn($,Ye,ae),$e=zn(gt[K]??0,Ye,ae);ge!==$e&&(se=void 0)}Tt[D]=se}const g=ni(`__js_sec_${_.size+1}`,Tt,e.baseIndexRef);return _.set(ue,{ref:g}),g}if(Ye.kind==="fixed"&&n!=null&&Ye.ms<n){if(h)return V.push(ee),Ge();throw X?new Error(`request.security_lower_tf: lower timeframe "${B}" is not available from current chart data (base ~${Math.round(n/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`):new Error(`request.security: lower timeframe "${B}" is not available from current chart data (base ~${Math.round(n/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`)}const{map:qt,isEnd:Ut,htf:qe}=ac(t,Ye,ae);if(!qe.close.length)return h&&V.push(ee),Ge();const Lt={value:0},wt=Yn({open:qe.open,high:qe.high,low:qe.low,close:qe.close,volume:qe.volume,time:qe.time,barIndex:qe.bar_index,indexRef:Lt,params:e.params}),at={ta:hr(wt,Lt),math:dr(Lt),color:pr(),str:gr()},Pe=Zr(F,wt,at,Lt),jt=new Array(i);for(let je=0;je<i;je++){const ot=qt[je];if(ot<0||ot>=Pe.length){jt[je]=void 0;continue}const Vt=tn(t.time[je]??0);if(ie==="on"&&!Yr(Vt,fe,ae)){jt[je]=void 0;continue}const $t=te==="on"||Ut[je]?Pe[ot]:ot>0?Pe[ot-1]:NaN;let Nt=Number.isFinite($t)?$t:void 0;if(ie==="on"){const Tt=zn(Vt,Ye,ae),gt=zn(qe.time[ot]??0,Ye,ae);Tt!==gt&&(Nt=void 0)}jt[je]=Nt}const Ke=ni(`__js_sec_${_.size+1}`,jt,e.baseIndexRef);return _.set(ue,{ref:Ke}),Ke}finally{C=Math.max(0,C-1)}};return{request:{security:(...o)=>{const u=o;if(!u.length)throw new Error("request.security requires a timeframe");const P=u[0],F=u[1],Y=u[2],X=u[3],B=ue=>typeof ue=="function"||typeof ue=="number"||Un(ue)||ue==null;let te=null,ie=P,ae=F,fe;if(u.length>=3&&typeof P=="string"&&B(Y)?(te=String(P||"").trim(),ie=F,ae=Y,fe=X&&typeof X=="object"?X:void 0):(ie=P,ae=F,fe=Y&&typeof Y=="object"?Y:void 0),ae==null)throw new Error("request.security requires an expression or series");const ee=be(te);return U.push({symbol:te?String(te):void 0,timeframe:String(ie??""),options:fe?{...fe}:void 0,lower:!1}),we(ee.key,ee.label,String(ie??""),ae,fe,!1)},security_lower_tf:(...o)=>{const u=o;if(!u.length)throw new Error("request.security_lower_tf requires a timeframe");const P=u[0],F=u[1],Y=u[2],X=u[3],B=ue=>typeof ue=="function"||typeof ue=="number"||Un(ue)||ue==null;let te=null,ie=P,ae=F,fe;if(u.length>=3&&typeof P=="string"&&B(Y)?(te=String(P||"").trim(),ie=F,ae=Y,fe=X&&typeof X=="object"?X:void 0):(ie=P,ae=F,fe=Y&&typeof Y=="object"?Y:void 0),ae==null)throw new Error("request.security_lower_tf requires an expression or series");const ee=be(te);return U.push({symbol:te?String(te):void 0,timeframe:String(ie??""),options:fe?{...fe}:void 0,lower:!0}),we(ee.key,ee.label,String(ie??""),ae,fe,!0)}},mtfRequests:U,mtfMissing:V}};function vt(e,t){const i=typeof e=="number"?e:Number(e);return Number.isFinite(i)?i:t}function wa(e,t="start"){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e))return e>1e11?Math.floor(e):Math.floor(e*1e3);const i=String(e).trim();if(!i)return null;if(/^\d+$/.test(i)){const r=Number(i);if(Number.isFinite(r))return r>1e11?Math.floor(r):Math.floor(r*1e3)}const n=i.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n){const r=Number(n[1]),s=Number(n[2])-1,f=Number(n[3]);if([r,s,f].every(h=>Number.isFinite(h))){const h=Date.UTC(r,s,f);return Number.isFinite(h)?t==="end"?h+86399999:h:null}}const a=Date.parse(i);return Number.isFinite(a)?a:null}function lc(e){if(!e)return null;const t=String(e).trim();if(!t)return null;const i=t.match(/^(\d{2})(?::?(\d{2}))?\s*-\s*(\d{2})(?::?(\d{2}))?$/);if(!i)return null;const n=Number(i[1]),a=Number(i[2]||"0"),r=Number(i[3]),s=Number(i[4]||"0");return![n,a,r,s].every(f=>Number.isFinite(f))||n<0||n>23||r<0||r>23||a<0||a>59||s<0||s>59?null:{startMin:n*60+a,endMin:r*60+s}}function cc(e){if(e===!0)return{enabled:!0,execution:"intrabar_ohlc",intrabarTieBreak:"worst_case",ohlcPath:"open_high_low_close",intrabarTicks:6,initialCapital:1e4,fromTs:null,toTs:null,session:null,orderSize:{type:"percent_of_equity",value:100},commissionPct:0,commissionCash:null,commissionPerUnit:null,commissionType:"percent",slippagePct:0,slippageAbs:null,slippageTicks:null,slippageType:"percent",priceTick:null,qtyStep:null,minQty:null,spreadPct:null,leverage:1,maintenanceMarginPct:null,liquidationFeePct:null,borrowPctPerYear:null,fundingPctPerDay:null,positionMode:"netting",closeMethod:"fifo",pyramiding:1,timeInForce:"gtc",fillMode:"full",volumeFillPct:100,stopLossPct:null,takeProfitPct:null,takeProfits:[],trailingStopPct:null,maxDrawdownPct:null,maxDrawdownCash:null,maxPositionPct:null,maxPositionCash:null,maxPositionQty:null,maxIntradayFilledOrders:null,maxIntradayLossPct:null,maxIntradayLossCash:null,allowLong:!0,allowShort:!0,closeOnEnd:!0};if(!e||typeof e!="object")return null;const t=e;if(t.enabled===!1)return null;const i=String(t.execution||t.exec||t.mode||"").trim().toLowerCase()||"intrabar_ohlc",n=i==="bar_close"||i==="barclose"||i==="close"?"bar_close":i==="intrabar_ticks"||i==="intrabarticks"||i==="ticks"?"intrabar_ticks":"intrabar_ohlc",a=String(t.intrabarTieBreak||t.tieBreak||"").trim().toLowerCase(),r=a==="best_case"||a==="best"||a==="tp"?"best_case":a==="ohlc"||a==="path"?"ohlc":"worst_case",s=String(t.ohlcPath||t.path||"").trim().toLowerCase(),f=s==="open_low_high_close"||s==="olhc"?"open_low_high_close":"open_high_low_close",h=t.intrabarTicks??t.ticks??t.tickCount??t.intrabarTickCount??null,p=Math.max(2,Math.min(100,Math.floor(vt(h,6)))),_=Math.max(0,vt(t.initialCapital,1e4)),E=Math.max(0,vt(t.commissionPct,0)),z=t.commissionCash??t.commission_cash??t.commissionFixed??t.commission_fixed??null,C=t.commissionPerUnit??t.commission_per_unit??t.commissionPerShare??t.commission_per_share??null,v=z==null?null:Math.max(0,vt(z,0)),S=C==null?null:Math.max(0,vt(C,0)),U=String(t.commissionType??t.commission_mode??t.commissionMode??"").trim().toLowerCase(),V=S!=null||U==="per_unit"?"per_unit":v!=null||U==="cash"?"cash":"percent",ne=Math.max(0,vt(t.slippagePct??t.slippage??t.slippage_percent,0)),he=t.slippageAbs??t.slippage_abs??null,me=t.slippageTicks??t.slippage_ticks??t.slippageTick??null,be=he==null?null:Math.max(0,vt(he,0)),ve=me==null?null:Math.max(0,vt(me,0)),Te=String(t.slippageType??t.slippage_mode??t.slippageMode??"").trim().toLowerCase(),Ie=ve!=null||Te==="ticks"?"ticks":be!=null||Te==="abs"?"abs":"percent",we=t.priceTick??t.price_tick??t.tickSize??t.tick_size??t.tick??t.minTick??t.min_tick??null,ze=t.qtyStep??t.qty_step??t.quantityStep??t.quantity_step??t.lotStep??t.lot_step??null,Ce=t.minQty??t.min_qty??t.minimumQty??t.minimum_qty??null,Ct=we==null?null:Math.max(0,vt(we,0)),y=ze==null?null:Math.max(0,vt(ze,0)),c=Ce==null?null:Math.max(0,vt(Ce,0)),M=t.spreadPct??t.spread_pct??t.spread??t.spreadBps??t.spread_bps??null,o=(()=>{if(M==null)return null;const w=vt(M,0);return!Number.isFinite(w)||w<=0?null:"spreadBps"in t||"spread_bps"in t?w/100:w})(),u=t.leverage??t.lev??t.marginLeverage??t.margin_leverage??1,P=Math.max(1,vt(u,1)),F=t.maintenanceMarginPct??t.maintenance_margin_pct??t.maintMarginPct??null,Y=t.liquidationFeePct??t.liquidation_fee_pct??t.liqFeePct??null,X=t.borrowPctPerYear??t.borrow_pct_per_year??t.shortBorrowPctPerYear??null,B=t.fundingPctPerDay??t.funding_pct_per_day??t.funding??null,te=F==null?null:Math.max(0,vt(F,0)),ie=Y==null?null:Math.max(0,vt(Y,0)),ae=X==null?null:Math.max(0,vt(X,0)),fe=B==null?null:Math.max(0,vt(B,0)),ee=String(t.positionMode??t.position_mode??"").trim().toLowerCase(),ue=ee==="hedge"||ee==="hedging"?"hedging":"netting",De=String(t.closeMethod??t.close_method??t.costBasis??t.cost_basis??"").trim().toLowerCase(),Ge=De==="lifo"?"lifo":De==="avg"||De==="average"?"avg":"fifo",Ye=Math.max(1,Math.min(50,Math.floor(vt(t.pyramiding??t.maxEntries??t.max_positions??t.maxPositions??1,1)))),Ae=String(t.timeInForce??t.tif??t.orderTif??t.order_tif??"").trim().toLowerCase(),ft=Ae==="ioc"||Ae==="immediate_or_cancel"?"ioc":Ae==="fok"||Ae==="fill_or_kill"?"fok":"gtc",pt=String(t.fillMode??t.fill_mode??"").trim().toLowerCase(),qt=pt==="volume"||pt==="partial"||t.partialFills?"volume":"full",Ut=Math.max(0,Math.min(100,vt(t.volumeFillPct??t.volume_fill_pct??t.fillPct??100,100))),qe=t.stopLossPct??t.slPct??t.sl??t.stopLoss??t.stop_loss??null,Lt=t.takeProfitPct??t.tpPct??t.tp??t.takeProfit??t.take_profit??null,wt=t.trailingStopPct??t.trailPct??t.trailing??t.trailingStop??null,at=qe==null?null:Math.max(0,vt(qe,0)),Pe=Lt==null?null:Math.max(0,vt(Lt,0)),jt=wt==null?null:Math.max(0,vt(wt,0)),Ke=typeof t.allowLong=="boolean"?t.allowLong:t.allowLong!==!1,je=typeof t.allowShort=="boolean"?t.allowShort:t.allowShort!==!1,ot=typeof t.closeOnEnd=="boolean"?t.closeOnEnd:t.closeOnEnd!==!1,Vt=wa(t.from??t.start??t.startDate??t.dateFrom??t.fromDate??t.rangeStart,"start")??null,$t=wa(t.to??t.end??t.endDate??t.dateTo??t.toDate??t.rangeEnd,"end")??null,Nt=lc(t.session??t.tradingSession??t.sessionTime),Tt=t.takeProfits??t.tpLevels??t.takeProfitLevels??[],gt=[];if(Array.isArray(Tt))for(const w of Tt){if(!w||typeof w!="object")continue;const O=vt(w.takeProfitPct??w.tpPct??w.pct,NaN),H=vt(w.qtyPct??w.qty??w.percent,NaN);!Number.isFinite(O)||O<=0||!Number.isFinite(H)||H<=0||gt.push({takeProfitPct:O,qtyPct:Math.max(0,Math.min(100,H))})}gt.sort((w,O)=>w.takeProfitPct-O.takeProfitPct);const Ze=t.risk&&typeof t.risk=="object"?t.risk:{},Rt=w=>{if(w==null)return null;const O=vt(w,NaN);return Number.isFinite(O)?O:null},N=Rt(t.maxDrawdownPct??t.max_drawdown_pct??Ze.maxDrawdownPct??Ze.max_drawdown_pct??Ze.max_drawdown)??null,g=Rt(t.maxDrawdownCash??t.max_drawdown_cash??Ze.maxDrawdownCash??Ze.max_drawdown_cash)??null,D=Rt(t.maxPositionPct??t.max_position_pct??Ze.maxPositionPct??Ze.max_position_pct??Ze.max_position_size)??null,K=Rt(t.maxPositionCash??t.max_position_cash??Ze.maxPositionCash??Ze.max_position_cash)??null,$=Rt(t.maxPositionQty??t.max_position_qty??Ze.maxPositionQty??Ze.max_position_qty??Ze.max_contracts)??null,_e=Rt(t.maxIntradayFilledOrders??t.max_intraday_filled_orders??Ze.maxIntradayFilledOrders??Ze.max_intraday_filled_orders)??null,se=Rt(t.maxIntradayLossPct??t.max_intraday_loss_pct??Ze.maxIntradayLossPct??Ze.max_intraday_loss_pct??Ze.max_intraday_loss)??null,ge=Rt(t.maxIntradayLossCash??t.max_intraday_loss_cash??Ze.maxIntradayLossCash??Ze.max_intraday_loss_cash)??null;let $e=0;const Je=[];for(const w of gt){if($e>=100)break;const O=100-$e,H=Math.min(O,w.qtyPct);H<=0||(Je.push({takeProfitPct:w.takeProfitPct,qtyPct:H}),$e+=H)}const k=t.orderSize??t.positionSize??t.order??null;let R={type:"percent_of_equity",value:100};if(k&&typeof k=="object"){const w=String(k.type||"").trim().toLowerCase(),O=vt(k.value,100);w==="cash"?R={type:"cash",value:Math.max(0,O)}:w==="qty"?R={type:"qty",value:Math.max(0,O)}:w?R={type:"percent_of_equity",value:Math.max(0,Math.min(100,O))}:R={type:"percent_of_equity",value:Math.max(0,Math.min(100,O))}}else if(k!=null){const w=vt(k,100);R={type:"percent_of_equity",value:Math.max(0,Math.min(100,w))}}return{enabled:!0,execution:n,intrabarTieBreak:r,ohlcPath:f,intrabarTicks:p,initialCapital:_,fromTs:Vt,toTs:$t,session:Nt,orderSize:R,commissionPct:E,commissionCash:v,commissionPerUnit:S,commissionType:V,slippagePct:ne,slippageAbs:be,slippageTicks:ve,slippageType:Ie,priceTick:Ct&&Ct>0?Ct:null,qtyStep:y&&y>0?y:null,minQty:c&&c>0?c:null,spreadPct:o&&o>0?o:null,leverage:P,maintenanceMarginPct:te&&te>0?te:null,liquidationFeePct:ie&&ie>0?ie:null,borrowPctPerYear:ae&&ae>0?ae:null,fundingPctPerDay:fe&&fe>0?fe:null,positionMode:ue,closeMethod:Ge,pyramiding:Ye,timeInForce:ft,fillMode:qt,volumeFillPct:Ut,stopLossPct:at!=null&&at>0?at:null,takeProfitPct:Pe!=null&&Pe>0?Pe:null,takeProfits:Je,trailingStopPct:jt!=null&&jt>0?jt:null,maxDrawdownPct:N!=null&&N>0?N:null,maxDrawdownCash:g!=null&&g>0?g:null,maxPositionPct:D!=null&&D>0?D:null,maxPositionCash:K!=null&&K>0?K:null,maxPositionQty:$!=null&&$>0?$:null,maxIntradayFilledOrders:_e!=null&&_e>0?Math.floor(_e):null,maxIntradayLossPct:se!=null&&se>0?se:null,maxIntradayLossCash:ge!=null&&ge>0?ge:null,allowLong:Ke,allowShort:je,closeOnEnd:ot}}function Na(e){return e==="cancel"||e==="cancel_all"?0:e==="exit_long"?1:e==="exit_short"?2:e==="entry_long"?3:e==="entry_short"?4:9}function _r(e){const t=e==null?void 0:e.close;return typeof t=="number"&&Number.isFinite(t)?t:null}function es(e){return typeof e=="number"&&Number.isFinite(e)?e:null}function uc(e){const t=_r(e);if(t==null)return null;const i=es(e==null?void 0:e.open)??t,n=es(e==null?void 0:e.high)??Math.max(i,t),a=es(e==null?void 0:e.low)??Math.min(i,t);return{o:i,h:n,l:a,c:t}}function fc(e,t,i){var Ba,Da,ja,za,Ua;const n=i.initialCapital,a=i.commissionPct/100,r=i.commissionCash,s=i.commissionPerUnit,f=i.commissionType,h=i.slippagePct/100,p=i.slippageAbs,_=i.slippageTicks,E=i.slippageType,z=i.priceTick&&i.priceTick>0?i.priceTick:null,C=i.qtyStep&&i.qtyStep>0?i.qtyStep:null,v=i.minQty&&i.minQty>0?i.minQty:null,S=i.spreadPct&&i.spreadPct>0?i.spreadPct/100:0,U=S>0?S/2:0,V=Math.max(1,Number(i.leverage)||1),ne=i.maintenanceMarginPct&&i.maintenanceMarginPct>0?i.maintenanceMarginPct/100:null,he=i.liquidationFeePct&&i.liquidationFeePct>0?i.liquidationFeePct/100:null,me=i.borrowPctPerYear&&i.borrowPctPerYear>0?i.borrowPctPerYear/100:null,be=i.fundingPctPerDay&&i.fundingPctPerDay>0?i.fundingPctPerDay/100:null,ve=i.maxDrawdownPct&&i.maxDrawdownPct>0?i.maxDrawdownPct/100:null,Te=i.maxDrawdownCash&&i.maxDrawdownCash>0?i.maxDrawdownCash:null,Ie=i.maxPositionPct&&i.maxPositionPct>0?i.maxPositionPct/100:null,we=i.maxPositionCash&&i.maxPositionCash>0?i.maxPositionCash:null,ze=i.maxPositionQty&&i.maxPositionQty>0?i.maxPositionQty:null,Ce=i.maxIntradayFilledOrders&&i.maxIntradayFilledOrders>0?Math.floor(i.maxIntradayFilledOrders):null,Ct=i.maxIntradayLossPct&&i.maxIntradayLossPct>0?i.maxIntradayLossPct/100:null,y=i.maxIntradayLossCash&&i.maxIntradayLossCash>0?i.maxIntradayLossCash:null,c=(l,m,b)=>{const L=(b==null?void 0:b.commissionMode)??f,q=(b==null?void 0:b.commissionValue)??(L==="per_unit"?s:L==="cash"?r:a);return Number.isFinite(q)?L==="cash"?Math.max(0,q):L==="per_unit"?Math.max(0,q*Math.max(0,l)):Math.max(0,m*Math.max(0,q)):0},M=(l,m)=>{const b=(m==null?void 0:m.slippageMode)??E,L=(m==null?void 0:m.slippageValue)??(b==="ticks"?_:b==="abs"?p:h);return Number.isFinite(L)?b==="ticks"?z?Math.max(0,L*z):0:b==="abs"?Math.max(0,L):Math.max(0,l*Math.max(0,L)):0},o=l=>{if(!Number.isFinite(l)||l<=0)return 0;const m=String(l),b=m.match(/e-(\d+)$/i);if(b)return Math.max(0,Math.min(12,Number(b[1])||0));const L=m.indexOf(".");return L>=0?Math.max(0,Math.min(12,m.length-L-1)):0},u=(l,m,b)=>{if(!Number.isFinite(l))return NaN;if(!Number.isFinite(m)||m<=0)return l;const L=o(m),q=Math.pow(10,L),j=Math.round(m*q);if(!Number.isFinite(j)||j<=0)return l;const A=l*q;return(b==="ceil"?Math.ceil(A/j-1e-12):b==="round"?Math.round(A/j):Math.floor(A/j+1e-12))*j/q},P=(l,m)=>C?u(l,C,m):l,F=(l,m)=>l==="entry"?m==="long":m==="short",Y=(l,m)=>U?F(l,m)?1+U:1-U:1,X=(l,m,b)=>{const L=Y(m,b);return L===1?l:{o:l.o*L,h:l.h*L,l:l.l*L,c:l.c*L}},B=(l,m,b,L)=>{if(!z)return L;const q=F(l,m);return u(L,z,b==="limit"?q?"floor":"ceil":q?"ceil":"floor")},te=(l,m,b)=>{if(!z)return b;const q=F(l,m)?"ceil":"floor";return u(b,z,q)};let ie=0,ae=0;const fe={long:[],short:[]},ee=l=>fe[l],ue=l=>ee(l).some(m=>m.qty>1e-12),De=()=>ue("long")||ue("short"),Ge=l=>ee(l).filter(m=>m.qty>1e-12).length,Ye=l=>l==="long"?"short":"long",Ae=[],ft=[],pt=[],qt=new Map;let Ut=1;const qe=[],Lt=()=>`o${Ut++}`,wt=l=>{var b;const m=Number((b=e[l])==null?void 0:b.timestamp);return Number.isFinite(m)&&m>0?m:Date.now()},at=l=>{const m=Lt(),b={id:m,...l};return pt.push(b),qt.set(m,b),b},Pe=(l,m)=>{if(!l)return;const b=qt.get(l);b&&Object.assign(b,m)},jt=l=>{const m=l.id?qt.get(l.id):null;if(!m)return;const b=Number.isFinite(m.fillQty)?m.fillQty:0,L=Number.isFinite(m.fillPrice)?m.fillPrice:0,q=Number.isFinite(l.qty)?l.qty:0,j=b+q,A=j>0?(L*b+l.price*q)/j:l.price,x=(Number.isFinite(m.fees)?m.fees:0)+(Number.isFinite(l.fees)?l.fees:0);m.fillQty=j,m.fillPrice=A,m.fees=x,m.filledIndex=l.index,m.filledTimestamp=l.timestamp,l.targetQty!=null&&(m.targetQty=l.targetQty),l.remainingQty!=null&&(m.remainingQty=l.remainingQty),l.status&&(m.status=l.status),l.note&&(m.note=l.note)},Ke=e.length,je={initialCapital:n,finalEquity:n,netPnl:0,netPnlPct:0,grossProfit:0,grossLoss:0,profitFactor:0,trades:0,roundTrips:0,wins:0,losses:0,winRate:0,maxDrawdownPct:0,maxDrawdownValue:0,feesPaid:0,avgTrade:0,avgWin:0,avgLoss:0,payoffRatio:0,expectancy:0,maxConsecWins:0,maxConsecLosses:0,exposurePct:0,maxRunupPct:0,maxRunupValue:0,avgBarsInTrade:0,volatilityPct:0,sharpe:0,sortino:0,calmar:0};if(!Ke)return{summary:je,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]};const ot=new Array(Ke).fill(0),Vt=new Array(Ke).fill(0),$t=new Array(Ke).fill(0),Nt=new Array(Ke).fill(0),Tt=new Array(Ke).fill(0),gt=new Array(Ke).fill(0),Ze=new Array(Ke).fill(0),Rt=new Array(Ke).fill(0),N=new Array(Ke).fill(0),g=new Array(Ke).fill(0),D=new Array(Ke).fill(0),K=new Array(Ke).fill(0),$=new Array(Ke).fill(0),_e=new Array(Ke).fill(0),se=new Array(Ke).fill(0),ge=new Array(Ke).fill(0),$e=new Array(Ke).fill(0),Je=new Array(Ke).fill(0),k=new Array(Ke).fill(0),R=new Array(Ke).fill(n),w=new Array(Ke).fill(0),O=Array.from({length:Ke},()=>[]);let H=0,G=0,W=0,re=0,oe=0,ce=0,J=0,Fe="",Ue=n,et=!1;const Bt=i.fromTs!=null&&Number.isFinite(i.fromTs)?i.fromTs:null,Wt=i.toTs!=null&&Number.isFinite(i.toTs)?i.toTs:null;let oi=0,hi=Ke-1;if(Bt!=null){const l=e.findIndex(m=>Number(m==null?void 0:m.timestamp)>=Bt);if(l>=0)oi=l;else return{summary:je,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}if(Wt!=null){for(let l=Ke-1;l>=0;l--){const m=Number((Ba=e[l])==null?void 0:Ba.timestamp);if(Number.isFinite(m)&&m<=Wt){hi=l;break}}if(hi<oi)return{summary:je,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}const pi=i.session,kt=l=>{var A;if(!pi)return!0;const m=Number((A=e[l])==null?void 0:A.timestamp);if(!Number.isFinite(m)||m<=0)return!0;const b=new Date(m),L=b.getUTCHours()*60+b.getUTCMinutes(),{startMin:q,endMin:j}=pi;return q<=j?L>=q&&L<=j:L>=q||L<=j},Jt=(Array.isArray(t)?t:[]).filter(l=>typeof(l==null?void 0:l.index)=="number"&&l.index>=0).filter(l=>l.index>=oi&&l.index<=hi).filter(l=>kt(l.index)).slice().sort((l,m)=>l.index-m.index||Na(l.type)-Na(m.type));let It=0,Qt=n,gi=0,Fi=0,Zt=n,Ii=0,Ai=0,nn=1;const zt={long:null,short:null},ei=(l,m)=>{const b=zt[l];if(b)return b;const L={id:`t${nn++}`,side:l,entryIndex:m,entryTimestamp:wt(m),exitIndex:m,exitTimestamp:wt(m),qtyEntered:0,entryNotional:0,qtyExited:0,exitNotional:0,grossPnl:0,fees:0,entries:0,exits:0};return zt[l]=L,L},ji=(l,m)=>{if(ue(l))return;const b=zt[l];if(!b)return;const L=b.qtyEntered,q=L>0?b.entryNotional/L:0,j=b.qtyExited>0?b.exitNotional/b.qtyExited:0,A=b.entryNotional>0?b.grossPnl/b.entryNotional*100:0;ft.push({id:b.id,side:b.side,entryIndex:b.entryIndex,entryTimestamp:b.entryTimestamp,exitIndex:b.exitIndex,exitTimestamp:b.exitTimestamp,qty:L,avgEntryPrice:q,avgExitPrice:j,grossPnl:b.grossPnl,fees:b.fees,netPnl:b.grossPnl-b.fees,pnlPct:A,entries:b.entries,exits:b.exits,maePct:typeof b.maeMin=="number"&&Number.isFinite(b.maeMin)?b.maeMin:void 0,mfePct:typeof b.mfeMax=="number"&&Number.isFinite(b.mfeMax)?b.mfeMax:void 0}),zt[l]=null},Ei=(l,m)=>{let b=0;for(const L of ee("long"))L.qty<=0||(b+=(m-L.entryPrice)*L.qty);for(const L of ee("short"))L.qty<=0||(b+=(L.entryPrice-m)*L.qty);return n+ie+b-ae},hn=l=>{let m=0;for(const b of ee("long"))b.qty<=0||(m+=(l-b.entryPrice)*b.qty);for(const b of ee("short"))b.qty<=0||(m+=(b.entryPrice-l)*b.qty);return Number.isFinite(m)?m:0},ti=()=>{let l=0,m=0,b=0,L=0;for(const j of ee("long"))j.qty<=0||(l+=j.qty,m+=j.entryPrice*j.qty);for(const j of ee("short"))j.qty<=0||(b+=j.qty,L+=j.entryPrice*j.qty);const q=l-b;return q>0&&l>0?m/l:q<0&&b>0?L/b:NaN},Mi=(l,m)=>{if(i.orderSize.type==="cash")return Math.max(0,i.orderSize.value)*V;if(i.orderSize.type==="qty")return Math.max(0,i.orderSize.value*m);const b=Math.max(0,Math.min(100,i.orderSize.value));return l*b/100*V},dn=()=>{let l=0;for(const m of ee("long"))l+=m.qty>0?m.entryNotional:0;for(const m of ee("short"))l+=m.qty>0?m.entryNotional:0;return l},mn=()=>V>0?dn()/V:0,zi=l=>{const m=Number(l);if(!Number.isFinite(m)||m<=0)return{long:0,short:0,total:0};let b=0,L=0;for(const q of ee("long"))b+=q.qty>0?q.qty*m:0;for(const q of ee("short"))L+=q.qty>0?q.qty*m:0;return{long:b,short:L,total:b+L}},pn=(l,m,b)=>{var Ne,xe;if(!De()||!me&&!be||l<=b)return;const L=Number((Ne=e[l-1])==null?void 0:Ne.timestamp),q=Number((xe=e[l])==null?void 0:xe.timestamp);if(!Number.isFinite(L)||!Number.isFinite(q)||q<=L)return;const j=q-L,A=j/864e5,x=j/(365*864e5);if(!Number.isFinite(A)||A<=0)return;const T=zi(m);let I=0,Z=0;be&&(I=Math.max(0,T.total*be*A)),me&&(Z=Math.max(0,T.short*me*x));const de=I+Z;if(!(!Number.isFinite(de)||de<=0)){if(ae+=de,I>0&&T.total>0){const Ve=I*T.long/T.total,Re=I-Ve;zt.long&&(zt.long.fees+=Ve),zt.short&&(zt.short.fees+=Re)}Z>0&&zt.short&&(zt.short.fees+=Z)}},vr=(l,m,b)=>{if(!De())return!1;const L=wt(l);let q=!1;for(const j of["long","short"]){if(!ue(j))continue;const A=at({action:"exit",side:j,kind:"market",originalKind:"market",status:"pending",createdIndex:l,createdTimestamp:L,activeFromIndex:l,qtyPct:100,price:m,note:b}),x=Ri(j,l,m,"liquidation","market",{orderId:A.id},he??void 0);x?(Pe(A.id,{status:"filled",filledIndex:l,filledTimestamp:L,fillPrice:x.execPrice,fillQty:x.qtyClosed,fees:x.exitFees}),q=!0):Pe(A.id,{status:"rejected",note:`${b} (no fill)`})}if(q&&lt.length){for(const j of lt)Pe(j.orderId,{status:"canceled",note:"Canceled on liquidation"});lt.length=0}return q},gn=(l,m)=>{if(!ne||!De())return!1;const b=T=>{const I=Ei(l,T),de=zi(T).total*ne;return{px:T,equityNow:I,req:de,gap:I-de}},L=b(m.l),q=b(m.h),j=Number.isFinite(L.gap)&&L.gap<=1e-9,A=Number.isFinite(q.gap)&&q.gap<=1e-9;if(!j&&!A)return!1;const x=j&&A?L.gap<=q.gap?L:q:j?L:q;return vr(l,x.px,"AUTO liquidation")},Pa=(l,m,b,L)=>{const q=M(b,L);return!Number.isFinite(q)||q<=0?b:F(l,m)?b+q:b-q},mc=(l,m,b,L)=>{if(b==="limit")return te("entry",l,m);const q=m*Y("entry",l),j=Pa("entry",l,q,L);return te("entry",l,j)},Wn=(l,m,b,L)=>{if(b==="limit")return te("exit",l,m);const q=m*Y("exit",l),j=Pa("exit",l,q,L);return te("exit",l,j)},Sa=l=>{if(!l||typeof l!="object")return;const m=I=>{const Z=typeof I=="number"?I:Number(I);return Number.isFinite(Z)?Z:void 0},b=m(l.stopLossPct),L=m(l.takeProfitPct),q=m(l.trailingStopPct),j=l.takeProfits,A=[];if(Array.isArray(j))for(const I of j){if(!I||typeof I!="object")continue;const Z=m(I.takeProfitPct),de=m(I.qtyPct);Z==null||Z<=0||de==null||de<=0||A.push({takeProfitPct:Math.max(0,Z),qtyPct:Math.max(0,Math.min(100,de))})}A.sort((I,Z)=>I.takeProfitPct-Z.takeProfitPct);let x=0;const T=[];for(const I of A){if(x>=100)break;const Z=100-x,de=Math.min(Z,I.qtyPct);de<=0||(T.push({takeProfitPct:I.takeProfitPct,qtyPct:de}),x+=de)}if(!(b==null&&L==null&&q==null&&T.length===0))return{stopLossPct:b,takeProfitPct:L,trailingStopPct:q,takeProfits:T.length?T:void 0}},Ca=(l,m,b,L,q)=>{if(!Number.isFinite(b)||b<=0)return{ok:!1,reject:"Invalid fill price"};const j=Ei(m,b),A=q&&typeof q.qty=="number"&&Number.isFinite(q.qty)?Math.abs(q.qty):null,x=q&&typeof q.cash=="number"&&Number.isFinite(q.cash)?Math.abs(q.cash):null;let T=0;if(A!=null)T=A;else if(x!=null)T=x*V/b;else{const xe=Number.isFinite(L)?Math.max(0,Math.min(100,L)):100;if(xe<=0)return{ok:!1,reject:"qtyPct <= 0"};const Ve=Mi(j,b)*xe/100;if(!Number.isFinite(Ve)||Ve<=0)return{ok:!1,reject:"Notional <= 0"};T=Ve/b}if(!Number.isFinite(T)||T<=0)return{ok:!1,reject:"Qty <= 0"};const I=P(T,"floor");if(!Number.isFinite(I)||I<=0)return C?{ok:!1,reject:`Qty rounded to 0 (qtyStep=${C})`}:{ok:!1,reject:"Qty <= 0"};if(v!=null&&I<v)return{ok:!1,reject:`Qty ${I} < minQty ${v}`};if(ze!=null&&Ui(l)+I>ze)return{ok:!1,reject:"Max position qty exceeded"};if(we!=null&&zi(b)[l]+I*b>we)return{ok:!1,reject:"Max position cash exceeded"};if(Ie!=null&&Ie>0){const Ve=zi(b)[l]+I*b,Re=j*Ie;if(Re>0&&Ve>Re)return{ok:!1,reject:"Max position percent exceeded"}}const Z=b*I,de=V>0?Z/V:Z,Ne=mn();return de>0&&Ne+de>j+1e-9?{ok:!1,reject:"Insufficient margin"}:{ok:!0,qty:I,equityNow:j}},ts=(l,m,b,L=100,q="market",j,A,x)=>{var yi,Oi,xt;if(i.positionMode==="netting"&&ue(Ye(l)))return{ok:!1,reject:"Netting mode: opposite position open"};if(et)return{ok:!1,reject:"Risk limit reached"};if(Ce!=null&&J>=Ce)return{ok:!1,reject:"Max intraday filled orders reached"};if(Ge(l)>=i.pyramiding)return{ok:!1,reject:`Pyramiding limit reached (${i.pyramiding})`};const T=mc(l,b,q,x),I=Ca(l,m,T,L,x);if(!I.ok)return{ok:!1,reject:I.reject};const Z=I.qty,de=T*Z,Ne=c(Z,de,x);ae+=Ne;{const He=ei(l,m);He.qtyEntered+=Z,He.entryNotional+=de,He.fees+=Ne,He.entries+=1}const xe=i.closeMethod==="avg"?void 0:Sa(j),Ve=(xe==null?void 0:xe.stopLossPct)!=null?xe.stopLossPct:i.stopLossPct,Re=(xe==null?void 0:xe.takeProfitPct)!=null?xe.takeProfitPct:i.takeProfitPct,Oe=(xe==null?void 0:xe.trailingStopPct)!=null?xe.trailingStopPct:i.trailingStopPct,yt=Ve&&Ve>0?l==="long"?T*(1-Ve/100):T*(1+Ve/100):null,ct=Re&&Re>0?l==="long"?T*(1+Re/100):T*(1-Re/100):null,We=yt!=null&&Number.isFinite(yt)?B("exit",l,"stop",yt):null,Be=ct!=null&&Number.isFinite(ct)?B("exit",l,"limit",ct):null,tt={side:l,qty:Z,entryIndex:m,entryTimestamp:((yi=e[m])==null?void 0:yi.timestamp)??Date.now(),entryPrice:T,entrySignalId:A==null?void 0:A.signalId,entryOrderId:A==null?void 0:A.orderId,entrySignalScore:(A==null?void 0:A.score)??null,entryNotional:de,entryFee:Ne,entryFeeRemaining:Ne,stopPrice:We&&Number.isFinite(We)?We:null,takePrice:Be&&Number.isFinite(Be)?Be:null,trailingPct:Oe,trailingStop:Oe&&Oe>0?l==="long"?B("exit",l,"stop",T*(1-Oe/100)):B("exit",l,"stop",T*(1+Oe/100)):null,takeProfitOrders:[],maxFav:T,maxAdv:T},dt=(Oi=xe==null?void 0:xe.takeProfits)!=null&&Oi.length?xe.takeProfits:i.takeProfits;if(dt!=null&&dt.length){const He=[];let vi=0;for(const xi of dt){if(vi>=Z)break;const Gt=Math.max(0,Math.min(Z-vi,Z*xi.qtyPct/100)),bt=P(Gt,"floor");if(!Number.isFinite(bt)||bt<=0||v!=null&&bt<v&&bt<Z-vi-1e-12)continue;const Ot=l==="long"?T*(1+xi.takeProfitPct/100):T*(1-xi.takeProfitPct/100),Pt=B("exit",l,"limit",Ot);!Number.isFinite(Pt)||Pt<=0||(He.push({price:Pt,qty:bt,pct:xi.takeProfitPct}),vi+=bt)}tt.takeProfitOrders=He.sort((xi,Gt)=>l==="long"?xi.price-Gt.price:Gt.price-xi.price)}J+=1;const Xe=ee(l);if(i.closeMethod==="avg"&&Xe.length){const He=Xe[0],vi=He.qty+tt.qty,xi=He.entryNotional+tt.entryNotional,Gt=vi>0?xi/vi:He.entryPrice;He.qty=vi,He.entryNotional=xi,He.entryPrice=Gt,He.entryFee+=tt.entryFee,He.entryFeeRemaining+=tt.entryFeeRemaining;const bt=i.stopLossPct,Ot=i.takeProfitPct,Pt=i.trailingStopPct,ci=bt&&bt>0?l==="long"?Gt*(1-bt/100):Gt*(1+bt/100):null,Jn=Ot&&Ot>0?l==="long"?Gt*(1+Ot/100):Gt*(1-Ot/100):null;if(He.stopPrice=ci!=null&&Number.isFinite(ci)?B("exit",l,"stop",ci):null,He.takePrice=Jn!=null&&Number.isFinite(Jn)?B("exit",l,"limit",Jn):null,He.trailingPct=Pt,He.trailingStop=Pt&&Pt>0?l==="long"?B("exit",l,"stop",Gt*(1-Pt/100)):B("exit",l,"stop",Gt*(1+Pt/100)):null,He.takeProfitOrders=[],(xt=i.takeProfits)!=null&&xt.length){const qi=[];let An=0;for(const Gi of i.takeProfits){if(An>=He.qty)break;const xn=Math.max(0,Math.min(He.qty-An,He.qty*Gi.qtyPct/100)),ii=P(xn,"floor");if(!Number.isFinite(ii)||ii<=0)continue;const Yt=l==="long"?Gt*(1+Gi.takeProfitPct/100):Gt*(1-Gi.takeProfitPct/100),_t=B("exit",l,"limit",Yt);!Number.isFinite(_t)||_t<=0||(qi.push({price:_t,qty:ii,pct:Gi.takeProfitPct}),An+=ii)}He.takeProfitOrders=qi.sort((Gi,xn)=>l==="long"?Gi.price-xn.price:xn.price-Gi.price)}return He.maxFav=He.maxFav==null?Gt:He.maxFav,He.maxAdv=He.maxAdv==null?Gt:He.maxAdv,{ok:!0,lot:He}}return Xe.push(tt),{ok:!0,lot:tt}},is=(l,m,b,L,q)=>{const j=Ui(l);if(!Number.isFinite(j)||j<=0)return 0;if(L!=null&&Number.isFinite(L)){const x=Math.abs(L);return x>0?Math.min(j,x):0}if(q!=null&&Number.isFinite(q)){const x=Math.abs(q);if(x<=0||!Number.isFinite(m)||m<=0)return 0;const I=(V>0?x*V:x)/m;return Number.isFinite(I)&&I>0?Math.min(j,I):0}const A=Number.isFinite(b)?Math.max(0,Math.min(100,b)):100;return A<=0?0:j*A/100},ns=(l,m,b,L="signal",q,j="market",A,x,T)=>{var dt;const I=l.side;C&&(l.qty=P(l.qty,"round"));const Z=Wn(I,b,j,T);if(!Number.isFinite(Z)||Z<=0)return null;const de=l.qty,Ne=q==null?de:Math.max(0,Math.min(de,q)),xe=q==null?C?P(Ne,"round"):Ne:C?P(Ne,"floor"):Ne;if(!Number.isFinite(xe)||xe<=0||v!=null&&q!=null&&xe<v&&xe<de-1e-12)return null;const Ve=de>0&&Number.isFinite(l.entryFeeRemaining)?l.entryFeeRemaining*xe/de:0,Re=Z*xe,Oe=c(xe,Re,T),yt=x&&x>0?Re*x:0;ae+=Oe,ae+=yt;const ct=I==="long"?(Z-l.entryPrice)*xe:(l.entryPrice-Z)*xe;ie+=ct;{const Xe=ei(I,l.entryIndex);Xe.qtyExited+=xe,Xe.exitNotional+=Re,Xe.grossPnl+=ct,Xe.fees+=Ve+Oe+yt,Xe.exits+=1,Xe.exitIndex=m,Xe.exitTimestamp=wt(m)}const We=Number.isFinite(l.entryPrice)&&l.entryPrice>0?l.entryPrice*xe:NaN,Be=(()=>{if(!(l.entryPrice<=0)&&!(l.maxAdv==null||!Number.isFinite(l.maxAdv)))return l.side==="long"?(l.maxAdv-l.entryPrice)/l.entryPrice*100:(l.entryPrice-l.maxAdv)/l.entryPrice*100})(),tt=(()=>{if(!(l.entryPrice<=0)&&!(l.maxFav==null||!Number.isFinite(l.maxFav)))return l.side==="long"?(l.maxFav-l.entryPrice)/l.entryPrice*100:(l.entryPrice-l.maxFav)/l.entryPrice*100})();Ae.push({side:I,qty:xe,entryIndex:l.entryIndex,entryTimestamp:l.entryTimestamp,entryPrice:l.entryPrice,entrySignalId:l.entrySignalId,entryOrderId:l.entryOrderId,entrySignalScore:l.entrySignalScore??null,exitIndex:m,exitTimestamp:((dt=e[m])==null?void 0:dt.timestamp)??Date.now(),exitPrice:Z,exitSignalId:A==null?void 0:A.signalId,exitOrderId:A==null?void 0:A.orderId,exitSignalScore:(A==null?void 0:A.score)??null,exitReason:L,pnl:ct,pnlPct:Number.isFinite(We)&&We>0?ct/We*100:0,fees:Ve+Oe+yt,entryFee:Ve,exitFee:Oe+yt,netPnl:ct-(Ve+Oe+yt),maePct:typeof Be=="number"&&Number.isFinite(Be)?Be:void 0,mfePct:typeof tt=="number"&&Number.isFinite(tt)?tt:void 0}),ce+=Math.max(0,m-l.entryIndex+1),H+=Ve+Oe+yt,ct>0?(G+=ct,re+=1):ct<0&&(W+=Math.abs(ct),oe+=1);try{const Xe=zt[I];typeof Be=="number"&&Number.isFinite(Be)&&Xe&&(Xe.maeMin=Xe.maeMin==null?Be:Math.min(Xe.maeMin,Be)),typeof tt=="number"&&Number.isFinite(tt)&&Xe&&(Xe.mfeMax=Xe.mfeMax==null?tt:Math.max(Xe.mfeMax,tt))}catch{}return l.qty-=xe,C&&(l.qty=P(l.qty,"round")),l.entryFeeRemaining=Math.max(0,l.entryFeeRemaining-Ve),l.qty<=1e-12&&(l.entryFeeRemaining=0),{qtyClosed:xe,fees:Ve+Oe+yt,exitFee:Oe+yt,execPrice:Z}},Ri=(l,m,b,L="signal",q="market",j,A,x)=>{const T=ee(l);if(!T.length)return null;const I=T.slice();let Z=0,de=0,Ne=0,xe=0;for(const Ve of I)if(Ve.qty>0){const Re=ns(Ve,m,b,L,Ve.qty,q,j,A,x);Re&&(Z+=Re.qtyClosed,de+=Re.fees,Ne+=Re.exitFee,xe+=Re.execPrice*Re.qtyClosed)}return fe[l]=ee(l).filter(Ve=>Ve.qty>1e-12),ji(l),Z<=0?null:{qtyClosed:Z,fees:de,exitFees:Ne,execPrice:xe/Z}},Ui=l=>{const m=ee(l);return m.length?m.reduce((b,L)=>b+(L.qty>0?L.qty:0),0):0},rs=(l,m,b,L,q="signal",j="market",A,x,T)=>{const I=ee(l);if(!I.length)return null;let Z=Math.max(0,L),de=0,Ne=0,xe=0,Ve=0;const Re=i.closeMethod==="lifo"?I.slice().reverse():I;for(const Oe of Re){if(Z<=0)break;if(Oe.qty<=0)continue;const yt=Math.min(Oe.qty,Z),ct=ns(Oe,m,b,q,yt,j,A,x,T);ct&&(de+=ct.qtyClosed,Ne+=ct.fees,xe+=ct.exitFee,Ve+=ct.execPrice*ct.qtyClosed),Z-=yt}return fe[l]=ee(l).filter(Oe=>Oe.qty>1e-12),ji(l),de<=0?null:{qtyClosed:de,fees:Ne,exitFees:xe,execPrice:Ve/de}},lt=[],ss=(l,m)=>{for(let b=lt.length-1;b>=0;b--){const L=lt[b];l(L)&&(Pe(L.orderId,{status:"canceled",note:m}),lt.splice(b,1))}},pc=(l,m)=>{if(!l)return;const b=String(l).trim();b&&ss(L=>String(L.signalId||"")===b||String(L.orderId||"")===b,m)},as=l=>{ss(()=>!0,l)},gc=l=>(l==null?void 0:l.order)||{},yc=l=>{const m=typeof l=="number"?l:Number(l);return!Number.isFinite(m)||m<=0?100:Math.max(0,Math.min(100,m))},yn=l=>{const m=typeof l=="number"?l:Number(l);return Number.isFinite(m)?Math.max(0,m):null},Wi=l=>{const m=typeof l=="number"?l:Number(l);return Number.isFinite(m)?m:null},xc=l=>{if(!l||typeof l!="object")return null;const m=String(l.commissionType??l.commission_mode??l.commissionMode??"").trim().toLowerCase(),b=l.commissionCash??l.commission_cash??l.commissionFixed??l.commission_fixed??null,L=l.commissionPerUnit??l.commission_per_unit??l.commissionPerShare??l.commission_per_share??null,q=l.commissionValue??l.commission_value??null,j=l.commissionPct??l.commission??null;let A=null,x=null;return m==="cash"?(A="cash",x=Wi(q??b)):m==="per_unit"||m==="perunit"?(A="per_unit",x=Wi(q??L)):m==="percent"||m==="pct"?(A="percent",x=yn(j),x!=null&&(x/=100)):L!=null?(A="per_unit",x=Wi(L)):b!=null?(A="cash",x=Wi(b)):q!=null?(A="percent",x=yn(q),x!=null&&(x/=100)):j!=null&&(A="percent",x=yn(j),x!=null&&(x/=100)),!A||x==null||!Number.isFinite(x)?null:{commissionMode:A,commissionValue:Math.max(0,x)}},bc=l=>{if(!l||typeof l!="object")return null;const m=String(l.slippageType??l.slippage_mode??l.slippageMode??"").trim().toLowerCase(),b=l.slippageAbs??l.slippage_abs??null,L=l.slippageTicks??l.slippage_ticks??null,q=l.slippageValue??l.slippage_value??null,j=l.slippagePct??l.slippage??null;let A=null,x=null;return m==="abs"?(A="abs",x=Wi(q??b)):m==="ticks"?(A="ticks",x=Wi(q??L)):m==="percent"||m==="pct"?(A="percent",x=yn(j),x!=null&&(x/=100)):b!=null?(A="abs",x=Wi(b)):L!=null?(A="ticks",x=Wi(L)):q!=null?(A="percent",x=yn(q),x!=null&&(x/=100)):j!=null&&(A="percent",x=yn(j),x!=null&&(x/=100)),!A||x==null||!Number.isFinite(x)?null:{slippageMode:A,slippageValue:Math.max(0,x)}},_c=l=>{const m=String(l||"market").trim().toLowerCase();return m==="limit"||m==="lit"?"limit":m==="stop"||m==="trailing_stop"?"stop":"market"},Cn=(l,m,b,L,q)=>Number.isFinite(q)?l==="entry"?m==="long"?b==="limit"?L.l<=q:L.h>=q:b==="limit"?L.h>=q:L.l<=q:m==="long"?b==="limit"?L.h>=q:L.l<=q:b==="limit"?L.l<=q:L.h>=q:!1,vc=(l,m,b)=>{for(const L of b)l.side==="long"?L==="high"?l.maxFav=l.maxFav==null?m.h:Math.max(l.maxFav,m.h):l.maxAdv=l.maxAdv==null?m.l:Math.min(l.maxAdv,m.l):L==="low"?l.maxFav=l.maxFav==null?m.l:Math.min(l.maxFav,m.l):l.maxAdv=l.maxAdv==null?m.h:Math.max(l.maxAdv,m.h)},Qn=l=>i.intrabarTieBreak==="ohlc"?i.ohlcPath==="open_high_low_close"?["high","low"]:["low","high"]:i.intrabarTieBreak==="best_case"?l==="long"?["high","low"]:["low","high"]:l==="long"?["low","high"]:["high","low"],li=l=>{const{lot:m,i:b,triggerPx:L,reason:q,qty:j,fillKind:A,note:x}=l;if(!Number.isFinite(L)||L<=0||!Number.isFinite(j)||j<=0)return!1;const T=A==="limit"?"limit":"stop",I=wt(b),Z=at({action:"exit",side:m.side,kind:T,originalKind:T,status:"pending",createdIndex:b,createdTimestamp:I,activeFromIndex:b,qtyPct:100,price:L,note:x}),de=ns(m,b,L,q,j,A,{orderId:Z.id});return de?(Pe(Z.id,{status:"filled",filledIndex:b,filledTimestamp:I,fillPrice:de.execPrice,fillQty:de.qtyClosed,fees:de.exitFee,note:x}),!0):(Pe(Z.id,{status:"rejected",note:`${x} (no fill)`}),!1)},wc=l=>{var L;if(i.fillMode!=="volume")return Number.POSITIVE_INFINITY;const m=Number((L=e[l])==null?void 0:L.volume);if(!Number.isFinite(m)||m<=0)return Number.POSITIVE_INFINITY;const b=m*i.volumeFillPct/100;return Number.isFinite(b)&&b>0?b:Number.POSITIVE_INFINITY},Nc=(l,m,b)=>{if(l.targetQty!=null&&l.remainingQty!=null)return{ok:!0,target:l.targetQty,remaining:l.remainingQty};if(l.action==="entry"){const A=Ca(l.side,m,b,l.qtyPct,{qty:l.qty,cash:l.cash});return A.ok?(l.targetQty=A.qty,l.remainingQty=A.qty,{ok:!0,target:A.qty,remaining:A.qty}):{ok:!1,reject:A.reject}}const L=is(l.side,b,l.qtyPct,l.qty,l.cash),q=P(L,"floor");if(!Number.isFinite(q)||q<=0)return{ok:!1,reject:"Qty <= 0"};const j=Ui(l.side);return v!=null&&q>0&&q<v&&q<j-1e-12?{ok:!1,reject:`Qty ${q} < minQty ${v}`}:(l.targetQty=q,l.remainingQty=q,{ok:!0,target:q,remaining:q})},kc=l=>l.tif??i.timeInForce,Fa=(l,m,b,L,q,j)=>{const A=Nc(l,m,b);if(!A.ok)return Pe(l.orderId,{status:"rejected",note:A.reject}),{remove:!0,filled:!1};const x=kc(l),T=A.remaining,I=wc(m),Z=Math.min(T,I);if(x==="fok"&&Z+1e-12<T)return Pe(l.orderId,{status:"rejected",note:"FOK not fully filled"}),{remove:!0,filled:!1};if(x==="ioc"&&Z<=0)return Pe(l.orderId,{status:"canceled",note:"IOC not filled"}),{remove:!0,filled:!1};if(Z<=0)return{remove:!1,filled:!1};const de=l.slippageMode!=null||l.slippageValue!=null||l.commissionMode!=null||l.commissionValue!=null?{slippageMode:l.slippageMode,slippageValue:l.slippageValue,commissionMode:l.commissionMode,commissionValue:l.commissionValue}:void 0,Ne=wt(m);let xe=0,Ve=b,Re=0,Oe=!1;if(l.action==="entry"){if(i.positionMode==="netting"){const Be=Ye(l.side);if(ue(Be)){const tt=at({action:"exit",side:Be,kind:L==="limit"?"limit":"market",originalKind:"market",status:"pending",createdIndex:m,createdTimestamp:Ne,activeFromIndex:m,qtyPct:100,price:b,note:"AUTO netting close (reverse)"}),dt=Ri(Be,m,b,"signal",L,{orderId:tt.id,signalId:l.signalId,score:l.score??null});Pe(tt.id,{status:dt?"filled":"rejected",filledIndex:dt?m:void 0,filledTimestamp:dt?Ne:void 0,fillPrice:dt==null?void 0:dt.execPrice,fillQty:(dt==null?void 0:dt.qtyClosed)??0,fees:(dt==null?void 0:dt.exitFees)??0,note:dt?"AUTO netting close (reverse)":"AUTO netting close failed"})}}const We=ts(l.side,m,b,l.qtyPct,L,l.bracket,{orderId:l.orderId,signalId:l.signalId,score:l.score??null},{qty:Z,...de});if(We.ok){const Be=We.lot;if(xe=Be.qty,Ve=Be.entryPrice,Re=Be.entryFee,Oe=!0,i.execution!=="bar_close"){const tt=Qn(l.side),dt=tt.indexOf(q),Xe=dt>=0?tt.slice(dt+1):tt;vc(Be,j,Xe),os(l.side,m,j,Xe)}}}else{const We=Z>=Ui(l.side)-1e-12?Ri(l.side,m,b,"signal",L,{orderId:l.orderId,signalId:l.signalId,score:l.score??null},void 0,de):rs(l.side,m,b,Z,"signal",L,{orderId:l.orderId,signalId:l.signalId,score:l.score??null},void 0,de);We&&(xe=We.qtyClosed,Ve=We.execPrice,Re=We.exitFees,Oe=!0)}if(!Oe||xe<=0)return Pe(l.orderId,{status:"rejected",note:"Order not filled"}),{remove:!0,filled:!1};const yt=Math.max(0,T-xe),ct=yt<=1e-12?"filled":"partial";return jt({id:l.orderId,index:m,timestamp:Ne,qty:xe,price:Ve,fees:Re,targetQty:A.target,remainingQty:yt,status:ct,note:ct==="partial"?"Partial fill":void 0}),l.remainingQty=yt,l.targetQty=A.target,x==="ioc"?(yt>1e-12&&Pe(l.orderId,{status:"canceled",note:"IOC remainder canceled"}),{remove:!0,filled:!0}):{remove:yt<=1e-12,filled:!0}},os=(l,m,b,L)=>{if(!ue(l)||i.execution==="bar_close")return!1;let q=!1;const j=A=>{var x,T;for(const I of ee(l)){if(I.qty<=0)continue;const Z=X(b,"exit",I.side);if(I.trailingPct&&I.trailingPct>0){const de=I.trailingPct/100;if(I.side==="long"&&A==="high"){const Ne=b.h*(1-de);I.trailingStop=I.trailingStop==null?Ne:Math.max(I.trailingStop,Ne)}if(I.side==="short"&&A==="low"){const Ne=b.l*(1+de);I.trailingStop=I.trailingStop==null?Ne:Math.min(I.trailingStop,Ne)}}if(I.side==="long"&&A==="high"){if((x=I.takeProfitOrders)!=null&&x.length){const de=[];for(const Ne of I.takeProfitOrders){if(I.qty<=0)break;Z.h>=Ne.price?q=li({lot:I,i:m,triggerPx:Ne.price,reason:"take_profit",qty:Ne.qty,fillKind:"limit",note:`AUTO take_profit (${Ne.pct}%)`})||q:de.push(Ne)}I.takeProfitOrders=de}I.takePrice!=null&&Z.h>=I.takePrice&&I.qty>0&&(q=li({lot:I,i:m,triggerPx:I.takePrice,reason:"take_profit",qty:I.qty,fillKind:"limit",note:"AUTO take_profit"})||q)}if(I.side==="short"&&A==="low"){if((T=I.takeProfitOrders)!=null&&T.length){const de=[];for(const Ne of I.takeProfitOrders){if(I.qty<=0)break;Z.l<=Ne.price?q=li({lot:I,i:m,triggerPx:Ne.price,reason:"take_profit",qty:Ne.qty,fillKind:"limit",note:`AUTO take_profit (${Ne.pct}%)`})||q:de.push(Ne)}I.takeProfitOrders=de}I.takePrice!=null&&Z.l<=I.takePrice&&I.qty>0&&(q=li({lot:I,i:m,triggerPx:I.takePrice,reason:"take_profit",qty:I.qty,fillKind:"limit",note:"AUTO take_profit"})||q)}if(I.side==="long"&&A==="low"){if(I.stopPrice!=null&&Z.l<=I.stopPrice){q=li({lot:I,i:m,triggerPx:I.stopPrice,reason:"stop_loss",qty:I.qty,fillKind:"stop",note:"AUTO stop_loss"})||q;continue}I.trailingStop!=null&&Z.l<=I.trailingStop&&(q=li({lot:I,i:m,triggerPx:I.trailingStop,reason:"trailing_stop",qty:I.qty,fillKind:"stop",note:"AUTO trailing_stop"})||q)}if(I.side==="short"&&A==="high"){if(I.stopPrice!=null&&Z.h>=I.stopPrice){q=li({lot:I,i:m,triggerPx:I.stopPrice,reason:"stop_loss",qty:I.qty,fillKind:"stop",note:"AUTO stop_loss"})||q;continue}I.trailingStop!=null&&Z.h>=I.trailingStop&&(q=li({lot:I,i:m,triggerPx:I.trailingStop,reason:"trailing_stop",qty:I.qty,fillKind:"stop",note:"AUTO trailing_stop"})||q)}}fe[l]=ee(l).filter(I=>I.qty>1e-12),ji(l)};for(const A of L){if(!ue(l))break;j(A)}return q},Ia=(l,m)=>{if(l)for(let b=lt.length-1;b>=0;b--){const L=lt[b];(L==null?void 0:L.ocoGroup)===l&&(m&&L.orderId===m||(Pe(L.orderId,{status:"canceled",note:"OCO canceled"}),lt.splice(b,1)))}},Gn=(l,m,b)=>l==="entry"?m==="long"?b==="limit"?"low":"high":b==="limit"?"high":"low":m==="long"?b==="limit"?"high":"low":b==="limit"?"low":"high",Fn=(l,m,b,L,q)=>{const j=q.o;if(!Number.isFinite(j)||!Number.isFinite(L))return{px:L,fillsAtOpen:!1};const A=j*Y(l,m);return b==="limit"?l==="entry"&&m==="long"&&j<=L||l==="entry"&&m==="short"&&j>=L||l==="exit"&&m==="long"&&j>=L||l==="exit"&&m==="short"&&j<=L?{px:A,fillsAtOpen:!0}:{px:L,fillsAtOpen:!1}:l==="entry"&&m==="long"&&j>=L||l==="entry"&&m==="short"&&j<=L||l==="exit"&&m==="long"&&j<=L||l==="exit"&&m==="short"&&j>=L?{px:j,fillsAtOpen:!0}:{px:L,fillsAtOpen:!1}},Aa=(l,m,b)=>{var A,x;if(!ue(l)||i.execution==="bar_close")return!1;const L=b.o;if(!Number.isFinite(L)||L<=0)return!1;const q=L*Y("exit",l);let j=!1;for(const T of ee(l).slice())if(!(T.qty<=0))if(T.side==="long"){if(T.stopPrice!=null&&q<=T.stopPrice){j=li({lot:T,i:m,triggerPx:L,reason:"stop_loss",qty:T.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||j;continue}if(T.trailingStop!=null&&q<=T.trailingStop){j=li({lot:T,i:m,triggerPx:L,reason:"trailing_stop",qty:T.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||j;continue}if((A=T.takeProfitOrders)!=null&&A.length){const I=[];for(const Z of T.takeProfitOrders){if(T.qty<=0)break;q>=Z.price?j=li({lot:T,i:m,triggerPx:q,reason:"take_profit",qty:Z.qty,fillKind:"limit",note:`AUTO take_profit (${Z.pct}%) (gap)`})||j:I.push(Z)}T.takeProfitOrders=I}T.takePrice!=null&&q>=T.takePrice&&T.qty>0&&(j=li({lot:T,i:m,triggerPx:q,reason:"take_profit",qty:T.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||j)}else{if(T.stopPrice!=null&&q>=T.stopPrice){j=li({lot:T,i:m,triggerPx:L,reason:"stop_loss",qty:T.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||j;continue}if(T.trailingStop!=null&&q>=T.trailingStop){j=li({lot:T,i:m,triggerPx:L,reason:"trailing_stop",qty:T.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||j;continue}if((x=T.takeProfitOrders)!=null&&x.length){const I=[];for(const Z of T.takeProfitOrders){if(T.qty<=0)break;q<=Z.price?j=li({lot:T,i:m,triggerPx:q,reason:"take_profit",qty:Z.qty,fillKind:"limit",note:`AUTO take_profit (${Z.pct}%) (gap)`})||j:I.push(Z)}T.takeProfitOrders=I}T.takePrice!=null&&q<=T.takePrice&&T.qty>0&&(j=li({lot:T,i:m,triggerPx:q,reason:"take_profit",qty:T.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||j)}return fe[l]=ee(l).filter(T=>T.qty>1e-12),ji(l),j},Pc=(l,m)=>{if(!lt.length)return;if(et){as("Canceled by risk limit");return}Ce!=null&&J>=Ce&&ss(x=>x.action==="entry","Max intraday filled orders reached");for(let x=lt.length-1;x>=0;x--){const T=lt[x];if(!(l<T.activeFromIndex)){if(T.expiresAtIndex!=null&&l>T.expiresAtIndex){Pe(T.orderId,{status:"expired",note:"Expired"}),lt.splice(x,1);continue}if(T.action==="exit"&&!ue(T.side)){Pe(T.orderId,{status:"canceled",note:"No position"}),lt.splice(x,1);continue}}}for(const x of lt){if(x.kind!=="trailing_stop"||l<x.activeFromIndex||x.action!=="exit"||!ue(x.side))continue;const T=typeof x.trailPct=="number"&&Number.isFinite(x.trailPct)?x.trailPct:null,I=typeof x.trailOffset=="number"&&Number.isFinite(x.trailOffset)?x.trailOffset:null,Z=typeof x.trailPrice=="number"&&Number.isFinite(x.trailPrice)?x.trailPrice:x.side==="long"?m.h:m.l,de=I??(T!=null&&T>0?Z*T/100:null);if(!(!de||!Number.isFinite(de)||de<=0))if(x.side==="long"){const Ne=Z-de;x.price=x.price==null?Ne:Math.max(x.price,Ne)}else{const Ne=Z+de;x.price=x.price==null?Ne:Math.min(x.price,Ne)}}const b=[];for(let x=0;x<lt.length;x++){const T=lt[x];if(l<T.activeFromIndex||T.expiresAtIndex!=null&&l>T.expiresAtIndex)continue;const I=X(m,T.action,T.side);if(T.action==="exit"){if(!ue(T.side))continue}else if(Ge(T.side)>=i.pyramiding)continue;const Z=T.ocoGroup||`__solo__${T.orderId||x}`,de=T.action==="exit"?0:1,Ne=Qn(T.side);if(T.kind==="stop_limit"){const tt=T.stopPrice??T.price,dt=T.limitPrice??T.price;if(!Number.isFinite(tt)||!Number.isFinite(dt)||!Cn(T.action,T.side,"stop",I,tt))continue;const yi=Gn(T.action,T.side,"stop"),Oi=Ne.indexOf(yi),xt=Fn(T.action,T.side,"stop",tt,m),He=xt.fillsAtOpen?0:Oi>=0?Oi+1:99,vi=yi==="high"?tt:-tt;b.push({groupKey:Z,orderId:T.orderId,pi:x,action:T.action,side:T.side,kind:"stop_limit",triggerExt:yi,phase:He,actionRank:de,priceRank:vi,sp:tt,lp:dt,stopAtOpen:xt.fillsAtOpen,limitAtOpen:Fn(T.action,T.side,"limit",dt,m).fillsAtOpen});continue}const xe=T.price;if(xe==null||!Number.isFinite(xe))continue;const Ve=T.kind==="stop"||T.kind==="trailing_stop"?"stop":"limit";if(!Cn(T.action,T.side,Ve,I,xe))continue;const Oe=Gn(T.action,T.side,Ve),yt=Ne.indexOf(Oe),We=Fn(T.action,T.side,Ve,xe,m).fillsAtOpen?0:yt>=0?yt+1:99,Be=Oe==="high"?xe:-xe;b.push({groupKey:Z,orderId:T.orderId,pi:x,action:T.action,side:T.side,kind:T.kind,triggerKind:Ve,triggerExt:Oe,phase:We,actionRank:de,priceRank:Be,px:xe})}if(!b.length)return;const L=new Map,q=(x,T)=>x.phase!==T.phase?x.phase<T.phase?x:T:x.actionRank!==T.actionRank?x.actionRank<T.actionRank?x:T:x.priceRank!==T.priceRank?x.priceRank<T.priceRank?x:T:x.pi<T.pi?x:T;for(const x of b){const T=L.get(x.groupKey);L.set(x.groupKey,T?q(T,x):x)}const j=Array.from(L.values()).sort((x,T)=>x.phase!==T.phase?x.phase-T.phase:x.actionRank!==T.actionRank?x.actionRank-T.actionRank:x.priceRank!==T.priceRank?x.priceRank-T.priceRank:x.pi-T.pi),A=(x,T)=>{if(x){const I=lt.findIndex(Z=>Z.orderId===x);if(I>=0)return I}return typeof T=="number"?T:-1};for(const x of j){const T=A(x.orderId,x.pi);if(T<0||T>=lt.length)continue;const I=lt[T];if(l<I.activeFromIndex||I.expiresAtIndex!=null&&l>I.expiresAtIndex)continue;const Z=X(m,I.action,I.side);if(I.action==="exit"){if(!ue(I.side)){Pe(I.orderId,{status:"canceled",note:"No position"}),lt.splice(T,1);continue}}else if(Ge(I.side)>=i.pyramiding)continue;if(I.kind==="stop_limit"){const ct=I.stopPrice??I.price,We=I.limitPrice??I.price;if(!Number.isFinite(ct)||!Number.isFinite(We)||!Cn(I.action,I.side,"stop",Z,ct))continue;const tt=Cn(I.action,I.side,"limit",Z,We),dt=Gn(I.action,I.side,"stop"),Xe=Gn(I.action,I.side,"limit"),yi=Qn(I.side),Oi=yi.indexOf(dt),xt=yi.indexOf(Xe);if(tt&&Oi>=0&&xt>=0&&Oi<xt){const xi=Fn(I.action,I.side,"limit",We,m).px,Gt=Fa(I,l,xi,"limit",dt,m);Gt.filled&&Ia(I.ocoGroup,I.orderId),Gt.remove?lt.splice(T,1):I.remainingQty!=null&&I.remainingQty>1e-12&&(I.kind="limit",I.price=We,I.activeFromIndex=l+1);continue}Pe(I.orderId,{kind:"limit",note:"Stop triggered  limit active next bar"}),I.kind="limit",I.price=We,I.activeFromIndex=l+1;continue}const de=I.price;if(de==null||!Number.isFinite(de))continue;const Ne=I.kind==="stop"||I.kind==="trailing_stop"?"stop":"limit";if(!Cn(I.action,I.side,Ne,Z,de))continue;let Ve=_c(I.kind),Re=Fn(I.action,I.side,Ne,de,m).px;const Oe=Gn(I.action,I.side,Ne);if(I.kind==="lit"){const ct=typeof I.limitPrice=="number"&&Number.isFinite(I.limitPrice)?I.limitPrice:de;if(!Cn(I.action,I.side,"limit",Z,ct)){Pe(I.orderId,{kind:"limit",note:"LIT triggered  limit active next bar"}),I.kind="limit",I.price=ct,I.activeFromIndex=l+1;continue}Re=Fn(I.action,I.side,"limit",ct,m).px,Ve="limit"}const yt=Fa(I,l,Re,Ve,Oe,m);yt.filled&&Ia(I.ocoGroup,I.orderId),yt.remove&&lt.splice(T,1)}},Sc=(l,m)=>{if(!De()||i.execution==="bar_close")return!1;const b=Aa("long",l,m),L=Aa("short",l,m),q=os("long",l,m,Qn("long")),j=os("short",l,m,Qn("short"));return b||L||q||j};let ls=0,Ea=0;for(let l=oi;l<=hi;l++){const m=uc(e[l]);if(!m)continue;const b=m.c;pn(l,b,oi);const L=Number((Da=e[l])==null?void 0:Da.timestamp);if(Number.isFinite(L)&&L>0){const A=new Date(L).toISOString().slice(0,10);A&&A!==Fe&&(Fe=A,Ue=Ei(l,b),J=0)}for(const A of ee("long"))A.qty<=0||(A.maxFav=A.maxFav==null?m.h:Math.max(A.maxFav,m.h),A.maxAdv=A.maxAdv==null?m.l:Math.min(A.maxAdv,m.l));for(const A of ee("short"))A.qty<=0||(A.maxFav=A.maxFav==null?m.l:Math.min(A.maxFav,m.l),A.maxAdv=A.maxAdv==null?m.h:Math.max(A.maxAdv,m.h));for(De()&&Sc(l,m),Pc(l,m),gn(l,m);It<Jt.length&&Jt[It].index===l;){const A=Jt[It];if(A.type==="cancel"){pc(A.orderId??A.signalId,"Canceled by strategy.cancel"),It+=1;continue}if(A.type==="cancel_all"){as("Canceled by strategy.cancel_all"),It+=1;continue}const x=gc(A),I=String((x==null?void 0:x.kind)||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop/g,"trailing_stop"),Z=yc(x==null?void 0:x.qtyPct),de=x==null?void 0:x.qty,Ne=x==null?void 0:x.cash,xe=typeof de=="number"&&Number.isFinite(de)?de:Number(de),Ve=typeof Ne=="number"&&Number.isFinite(Ne)?Ne:Number(Ne),Re=Number.isFinite(xe)?xe:void 0,Oe=Number.isFinite(Ve)?Ve:void 0,yt=xc(x),ct=bc(x),We=yt||ct?{...yt,...ct}:void 0,Be=typeof(x==null?void 0:x.oco)=="string"&&String(x.oco).trim()?String(x.oco).trim():void 0,tt=String((x==null?void 0:x.tif)??(x==null?void 0:x.timeInForce)??"").trim().toLowerCase(),Xe=tt?tt==="ioc"||tt==="immediate_or_cancel"?"ioc":tt==="fok"||tt==="fill_or_kill"?"fok":"gtc":i.timeInForce,yi=x==null?void 0:x.expiresBars,Oi=typeof yi=="number"&&Number.isFinite(yi)&&yi>0?Math.floor(yi):tt==="day"?1:null,xt=Oi?l+Oi:void 0,He=Sa(x==null?void 0:x.bracket),vi=(x==null?void 0:x.trailPct)??(x==null?void 0:x.trail_percent)??(x==null?void 0:x.trailPercent)??(x==null?void 0:x.trailingStopPct)??(x==null?void 0:x.trailing_stop_pct)??null,xi=(x==null?void 0:x.trailOffset)??(x==null?void 0:x.trailPoints)??(x==null?void 0:x.trail_points)??(x==null?void 0:x.trail_offset)??null,Gt=(x==null?void 0:x.trailPrice)??(x==null?void 0:x.trail_price)??null,bt=yn(vi),Ot=Wi(xi),Pt=Wi(Gt),ci=et?"Risk limit reached":Ce!=null&&J>=Ce?"Max intraday filled orders reached":null,Jn={commissionMode:We==null?void 0:We.commissionMode,commissionValue:We==null?void 0:We.commissionValue,slippageMode:We==null?void 0:We.slippageMode,slippageValue:We==null?void 0:We.slippageValue},qi={qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,...Jn},An=(I==="limit"||I==="stop"||I==="mit"||I==="lit")&&typeof(x==null?void 0:x.price)=="number"?x.price:b,Gi=typeof(x==null?void 0:x.stopPrice)=="number"?x.stopPrice:typeof(x==null?void 0:x.price)=="number"?x.price:b,xn=typeof(x==null?void 0:x.limitPrice)=="number"?x.limitPrice:typeof(x==null?void 0:x.price)=="number"?x.price:b,ii=I==="limit"||I==="stop"||I==="mit"||I==="lit"?B(A.type.startsWith("entry")?"entry":"exit",A.type.endsWith("long")?"long":"short",I==="stop"?"stop":"limit",An):An,Yt=I==="stop_limit"?B(A.type.startsWith("entry")?"entry":"exit",A.type.endsWith("long")?"long":"short","stop",Gi):Gi,_t=I==="stop_limit"||I==="lit"?B(A.type.startsWith("entry")?"entry":"exit",A.type.endsWith("long")?"long":"short","limit",xn):xn,Kt=wt(l),Se=I==="limit"||I==="stop"||I==="stop_limit"||I==="mit"||I==="lit"||I==="trailing_stop"?I:"market";if(A.type==="exit_long"&&ue("long"))if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"exit",side:"long",kind:"stop_limit",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});lt.push({action:"exit",side:"long",kind:"stop_limit",signalId:A.signalId,score:A.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("exit","long","stop",it-Dt):ii,At=at({action:"exit",side:"long",kind:Se,originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});lt.push({action:"exit",side:"long",kind:Se,signalId:A.signalId,score:A.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:At.id})}}else{const it=Ui("long"),Dt=is("long",b,Z,Re,Oe),Qe=P(Dt,"floor"),At=at({action:"exit",side:"long",kind:"market",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(v!=null&&Qe>0&&Qe<v&&Qe<it-1e-12)Pe(At.id,{status:"rejected",note:`Qty ${Qe} < minQty ${v}`});else{const Ee=Qe>=it-1e-12?Ri("long",l,b,"signal","market",{signalId:A.signalId,orderId:At.id,score:A.score??null},void 0,We):rs("long",l,b,Qe,"signal","market",{signalId:A.signalId,orderId:At.id,score:A.score??null},void 0,We);Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Wn("long",b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0,note:Ee?void 0:"Exit not filled"})}}else if(A.type==="exit_short"&&ue("short"))if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"exit",side:"short",kind:"stop_limit",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});lt.push({action:"exit",side:"short",kind:"stop_limit",signalId:A.signalId,score:A.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("exit","short","stop",it+Dt):ii,At=at({action:"exit",side:"short",kind:Se,originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});lt.push({action:"exit",side:"short",kind:Se,signalId:A.signalId,score:A.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:At.id})}}else{const it=Ui("short"),Dt=is("short",b,Z,Re,Oe),Qe=P(Dt,"floor"),At=at({action:"exit",side:"short",kind:"market",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(v!=null&&Qe>0&&Qe<v&&Qe<it-1e-12)Pe(At.id,{status:"rejected",note:`Qty ${Qe} < minQty ${v}`});else{const Ee=Qe>=it-1e-12?Ri("short",l,b,"signal","market",{signalId:A.signalId,orderId:At.id,score:A.score??null},void 0,We):rs("short",l,b,Qe,"signal","market",{signalId:A.signalId,orderId:At.id,score:A.score??null},void 0,We);Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Wn("short",b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0,note:Ee?void 0:"Exit not filled"})}}else if(A.type==="entry_long"&&i.allowLong)if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"entry",side:"long",kind:"stop_limit",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});ci?Pe(it.id,{status:"rejected",note:ci}):lt.push({action:"entry",side:"long",kind:"stop_limit",signalId:A.signalId,score:A.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("entry","long","stop",it+Dt):ii,At=at({action:"entry",side:"long",kind:Se,originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});ci?Pe(At.id,{status:"rejected",note:ci}):lt.push({action:"entry",side:"long",kind:Se,signalId:A.signalId,score:A.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:At.id})}}else{const it=at({action:"entry",side:"long",kind:"market",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(ci){Pe(it.id,{status:"rejected",note:ci}),It+=1;continue}if(i.positionMode==="netting"){const Qe="short";if(ue(Qe)){const At=at({action:"exit",side:Qe,kind:"market",originalKind:"market",status:"pending",createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,qtyPct:100,price:b,note:"AUTO netting close (reverse)"}),Ee=Ri(Qe,l,b,"signal","market",{signalId:A.signalId,orderId:At.id,score:A.score??null});Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Wn(Qe,b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0})}}const Dt=ts("long",l,b,Z,"market",He,{signalId:A.signalId,orderId:it.id,score:A.score??null},{qty:Re,cash:Oe,...We});if(Dt.ok){const Qe=Dt.lot;Pe(it.id,{status:"filled",filledIndex:l,filledTimestamp:Kt,fillPrice:Qe.entryPrice,fillQty:Qe.qty,fees:Qe.entryFee})}else Pe(it.id,{status:"rejected",note:Dt.reject||"Entry blocked"})}else if(A.type==="entry_short"&&i.allowShort)if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"entry",side:"short",kind:"stop_limit",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});ci?Pe(it.id,{status:"rejected",note:ci}):lt.push({action:"entry",side:"short",kind:"stop_limit",signalId:A.signalId,score:A.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("entry","short","stop",it-Dt):ii,At=at({action:"entry",side:"short",kind:Se,originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});ci?Pe(At.id,{status:"rejected",note:ci}):lt.push({action:"entry",side:"short",kind:Se,signalId:A.signalId,score:A.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:At.id})}}else{const it=at({action:"entry",side:"short",kind:"market",originalKind:Se,status:"pending",signalId:A.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(ci){Pe(it.id,{status:"rejected",note:ci}),It+=1;continue}if(i.positionMode==="netting"){const Qe="long";if(ue(Qe)){const At=at({action:"exit",side:Qe,kind:"market",originalKind:"market",status:"pending",createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,qtyPct:100,price:b,note:"AUTO netting close (reverse)"}),Ee=Ri(Qe,l,b,"signal","market",{signalId:A.signalId,orderId:At.id,score:A.score??null});Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Wn(Qe,b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0})}}const Dt=ts("short",l,b,Z,"market",He,{signalId:A.signalId,orderId:it.id,score:A.score??null},{qty:Re,cash:Oe,...We});if(Dt.ok){const Qe=Dt.lot;Pe(it.id,{status:"filled",filledIndex:l,filledTimestamp:Kt,fillPrice:Qe.entryPrice,fillQty:Qe.qty,fees:Qe.entryFee})}else Pe(it.id,{status:"rejected",note:Dt.reject||"Entry blocked"})}It+=1}let q=Ei(l,b);if(!et){const A=Ue-q,x=y??(Ct!=null?Ue*Ct:null),T=Qt>0?(Qt-q)/Qt:0,I=Qt-q,Z=ve!=null&&T>=ve||Te!=null&&I>=Te,de=x!=null&&Number.isFinite(A)&&A>=x;(Z||de)&&(et=!0,as("Canceled by risk limit"),ue("long")&&Ri("long",l,b,"signal","market"),ue("short")&&Ri("short",l,b,"signal","market"),q=Ei(l,b))}{const A=(ja=e==null?void 0:e[l])==null?void 0:ja.timestamp,x=Number(A);qe.push({index:l,timestamp:Number.isFinite(x)&&x>0?x:Date.now(),equity:q})}if(q>Qt&&(Qt=q),Qt>0){const A=(Qt-q)/Qt;A>gi&&(gi=A);const x=Qt-q;x>Fi&&(Fi=x)}if(Number.isFinite(q)){if(!Number.isFinite(Zt)||q<Zt)Zt=q;else if(Zt>0){const A=q-Zt;A>Ai&&(Ai=A);const x=A/Zt;x>Ii&&(Ii=x)}}ls+=1,De()&&(Ea+=1);const j=Ui("long")-Ui("short");ot[l]=j,Vt[l]=ti(),$t[l]=Ge("long")+Ge("short"),Nt[l]=Ae.length,Tt[l]=hn(b),gt[l]=ie-H,Ze[l]=G,Rt[l]=W,N[l]=re,g[l]=oe,D[l]=Ae.length>0?re/Ae.length*100:0,K[l]=gi*100,$[l]=Fi,_e[l]=Ii*100,se[l]=Ai,R[l]=q,w[l]=q-n,ge[l]=Ae.length>0?(ie-H)/Ae.length:0,$e[l]=re>0?G/re:0,Je[l]=oe>0?-(W/oe):0,k[l]=Ae.length>0?ce/Ae.length:0;{const A=[];for(const x of ee("long"))x.qty<=1e-12||A.push({side:"long",qty:x.qty,entryIndex:x.entryIndex,entryTimestamp:x.entryTimestamp,entryPrice:x.entryPrice,entryFee:x.entryFee,entrySignalId:x.entrySignalId,entryOrderId:x.entryOrderId,entrySignalScore:x.entrySignalScore??null,maxFav:x.maxFav,maxAdv:x.maxAdv});for(const x of ee("short"))x.qty<=1e-12||A.push({side:"short",qty:x.qty,entryIndex:x.entryIndex,entryTimestamp:x.entryTimestamp,entryPrice:x.entryPrice,entryFee:x.entryFee,entrySignalId:x.entrySignalId,entryOrderId:x.entryOrderId,entrySignalScore:x.entrySignalScore??null,maxFav:x.maxFav,maxAdv:x.maxAdv});A.sort((x,T)=>T.entryIndex-x.entryIndex),O[l]=A}}if(i.closeOnEnd&&De()&&e.length){const l=hi,m=_r(e[l]);if(m!=null){ue("long")&&Ri("long",l,m,"end","market"),ue("short")&&Ri("short",l,m,"end","market");const b=Ei(l,m);{const q=(za=e==null?void 0:e[l])==null?void 0:za.timestamp,j=Number(q);qe.push({index:l,timestamp:Number.isFinite(j)&&j>0?j:Date.now(),equity:b})}if(b>Qt&&(Qt=b),Qt>0){const q=(Qt-b)/Qt;q>gi&&(gi=q);const j=Qt-b;j>Fi&&(Fi=j)}if(Number.isFinite(b)){if(!Number.isFinite(Zt)||b<Zt)Zt=b;else if(Zt>0){const q=b-Zt;q>Ai&&(Ai=q);const j=q/Zt;j>Ii&&(Ii=j)}}const L=Ui("long")-Ui("short");ot[l]=L,Vt[l]=ti(),$t[l]=Ge("long")+Ge("short"),Nt[l]=Ae.length,Tt[l]=hn(m),gt[l]=ie-H,Ze[l]=G,Rt[l]=W,N[l]=re,g[l]=oe,D[l]=Ae.length>0?re/Ae.length*100:0,K[l]=gi*100,$[l]=Fi,_e[l]=Ii*100,se[l]=Ai,R[l]=b,w[l]=b-n,ge[l]=Ae.length>0?(ie-H)/Ae.length:0,$e[l]=re>0?G/re:0,Je[l]=oe>0?-(W/oe):0,k[l]=Ae.length>0?ce/Ae.length:0,O[l]=[]}if(lt.length){for(const b of lt)Pe(b.orderId,{status:"canceled",note:"Canceled on end"});lt.length=0}}const cs=qe.length?qe[qe.length-1].equity:n,us=cs-n,wr=Ae.reduce((l,m)=>l+(m.pnl>0?m.pnl:0),0),Nr=Ae.reduce((l,m)=>l+(m.pnl<0?Math.abs(m.pnl):0),0),Kn=Ae.filter(l=>l.pnl>0).length,kr=Ae.filter(l=>l.pnl<0).length,Qi=Ae.length,Cc=Qi?Kn/Qi*100:0,Fc=Qi?us/Qi:0,Pr=Kn?wr/Kn:0,Sr=kr?-(Nr/kr):0,Ic=Sr!==0?Math.abs(Pr/Sr):Pr>0?1/0:0,Ac=Qi>0?Ae.reduce((l,m)=>l+Math.max(0,m.exitIndex-m.entryIndex+1),0)/Qi:0,Ec=ls>0?Ea/ls*100:0,Hn=[];{let l="",m=NaN,b=0;for(const L of qe){const q=Number(L.timestamp);if(!Number.isFinite(q)||q<=0)continue;const j=new Date(q).toISOString().slice(0,10);l&&j!==l&&Number.isFinite(m)&&Hn.push({ts:b,eq:m}),l=j,m=L.equity,b=q}l&&Number.isFinite(m)&&Hn.push({ts:b,eq:m})}const ln=[];for(let l=1;l<Hn.length;l++){const m=Hn[l-1].eq,b=Hn[l].eq;Number.isFinite(m)&&m!==0&&Number.isFinite(b)&&ln.push((b-m)/m)}const fs=ln.length?ln.reduce((l,m)=>l+m,0)/ln.length:0,Ma=ln.length>1?ln.reduce((l,m)=>l+(m-fs)**2,0)/(ln.length-1):0,Cr=Ma>0?Math.sqrt(Ma):0,In=ln.filter(l=>l<0),Mc=In.length?In.reduce((l,m)=>l+m,0)/In.length:0,Ta=In.length>1?In.reduce((l,m)=>l+(m-Mc)**2,0)/(In.length-1):0,Ra=Ta>0?Math.sqrt(Ta):0,Tc=Cr>0?fs/Cr*Math.sqrt(252):0,Rc=Ra>0?fs/Ra*Math.sqrt(252):0,Oc=Cr>0?Cr*Math.sqrt(252)*100:0,Oa=qe.length?qe[0].equity:n,hs=qe.length?Number(qe[0].timestamp):NaN,ds=qe.length?Number(qe[qe.length-1].timestamp):NaN,qa=Number.isFinite(hs)&&Number.isFinite(ds)&&ds>hs?(ds-hs)/(365*864e5):0,La=Oa>0?cs/Oa:1,Va=qa>0?Math.pow(La,1/qa)-1:La-1,qc=gi>0?Va/gi:Va>0?1/0:0,$a=[];if(qe.length){const l=qe[0].index,m=_r(e[l])??NaN;if(Number.isFinite(m)&&m>0){const b=n/m;for(let L=oi;L<=hi;L++){const q=_r(e[L]);if(q==null||!Number.isFinite(q))continue;const j=(Ua=e==null?void 0:e[L])==null?void 0:Ua.timestamp,A=Number(j);$a.push({index:L,timestamp:Number.isFinite(A)&&A>0?A:Date.now(),equity:b*q})}}}const Lc=Qi?Kn/Qi*Pr+kr/Qi*Sr:0;let ms=0,ps=0;{let l=0,m=0;for(const b of Ae)b.pnl>0?(l+=1,m=0,l>ms&&(ms=l)):b.pnl<0&&(m+=1,l=0,m>ps&&(ps=m))}return{summary:{initialCapital:n,finalEquity:cs,netPnl:us,netPnlPct:n>0?us/n*100:0,grossProfit:wr,grossLoss:Nr,profitFactor:Nr>0?wr/Nr:wr>0?1/0:0,trades:Qi,roundTrips:ft.length,wins:Kn,losses:kr,winRate:Cc,maxDrawdownPct:gi*100,maxDrawdownValue:Fi,feesPaid:ae,avgTrade:Fc,avgWin:Pr,avgLoss:Sr,payoffRatio:Ic,expectancy:Lc,maxConsecWins:ms,maxConsecLosses:ps,exposurePct:Ec,maxRunupPct:Ii*100,maxRunupValue:Ai,avgBarsInTrade:Ac,volatilityPct:Oc,sharpe:Tc,sortino:Rc,calmar:qc},trades:Ae,roundTrips:ft,orders:pt,equity:qe,benchmark:$a,series:{positionSize:ot,positionAvgPrice:Vt,openTrades:$t,closedTrades:Nt,openProfit:Tt,closedProfit:gt,grossProfit:Ze,grossLoss:Rt,winTrades:N,lossTrades:g,winRate:D,maxDrawdownPct:K,maxDrawdownValue:$,maxRunupPct:_e,maxRunupValue:se,avgTrade:ge,avgWin:$e,avgLoss:Je,avgBarsInTrade:k,equity:R,netProfit:w},accessors:{openTradesByBar:O,closedTrades:Ae}}}const hc=e=>{const t=e instanceof Error?e.message:"JS engine failed",i=e instanceof Error?e.stack:void 0;if(typeof i=="string"){const n=i.match(new RegExp(`${Fr}:(\\d+):(\\d+)`));if(n){const a=Number(n[1]),r=Number(n[2]),s=Number.isFinite(a)?Math.max(1,a-ys):NaN,f=Number.isFinite(r)?Math.max(1,r):NaN;if(Number.isFinite(s)&&Number.isFinite(f))return`${t} (line ${s}, col ${f})`}}return t};function dc(e){var E,z;const t=((z=(E=e.base)==null?void 0:E.close)==null?void 0:z.length)??0;if(!t)return{id:e.id,error:"JS engine: no bars available"};if(t>Ki.maxSeriesPoints)return{id:e.id,error:`JS guardrail: max series points exceeded (${t} > ${Ki.maxSeriesPoints})`};const i=e.base.volume??new Array(t).fill(void 0),n=e.base.time??new Array(t).fill(void 0),a=new Array(t).fill(0).map((C,v)=>v),r=C=>{const v={value:0},S=io(t,v),U=Yn({open:e.base.open,high:e.base.high,low:e.base.low,close:e.base.close,volume:i,time:n,barIndex:a,indexRef:v,params:e.params}),V=Ga();V.resetRun();const ne=ro(S,U),he=hr(U,v),me=dr(v),be=pr(),ve=gr(),{request:Te,mtfRequests:Ie,mtfMissing:we}=oc({base:{open:e.base.open,high:e.base.high,low:e.base.low,close:e.base.close,volume:i,time:n,bar_index:a},baseIndexRef:v,params:e.params,mtf:e.mtf}),ze=so(S,U,C),Ce=ze.alert,Ct=ze.alertcondition,y=Ka({ctx:U,ta:he,math:me,color:be,str:ve,request:Te,plot:ne.plot,plotshape:ne.plotshape,plotchar:ne.plotchar,plotcandle:ne.plotcandle,plotbar:ne.plotbar,plotohlc:ne.plotohlc,hline:ne.hline,fill:ne.fill,label:ne.label,line:ne.line,box:ne.box,polyline:ne.polyline,polygon:ne.polygon,overlay:ne.overlay,heatmap:ne.heatmap,table:ne.table,alert:Ce,alertcondition:Ct,strategy:ze,__guard:V.guard,__guardCall:V.enterCall,__guardExit:V.exitCall,__instrument:Zo}),c=Ja(e.code,y);typeof c.onInit=="function"&&(V.resetBar(),c.onInit(U),V.checkTime(),V.checkTotal());for(let o=0;o<t;o++)v.value=o,V.resetBar(),no(S),typeof c.onBar=="function"&&(c.onBar(U),V.checkTime(),V.checkTotal());const M=ao(S);return{state:S,output:M,mtfRequests:Ie,mtfMissing:we}},s=C=>String(C||"").replace(/\s+/g,"_").toLowerCase(),f=(C,v,S,U)=>{if(typeof v=="number"&&Number.isFinite(v))return v;if(typeof v=="string"){const V=s(v),ne=C[V];if(ne){const me=ne[S];if(Number.isFinite(me))return me}const he=Number(v);if(Number.isFinite(he))return he}return U},h=(C,v,S)=>{if(typeof v=="number"&&Number.isFinite(v))return v;if(typeof v=="string"){const U=s(v),V=C[U];if(V){const he=V[S];if(Number.isFinite(he))return he}const ne=Number(v);if(Number.isFinite(ne))return ne}},p=(C,v)=>{const S=[];C.close;const U=n;return v.forEach((V,ne)=>{const he=s((V==null?void 0:V.when)??"");if(!he)return;const me=C[he];if(!me)return;const be=V!=null&&V.cooldownExpr?s(V.cooldownExpr):"",ve=be?C[be]:null,Te=V!=null&&V.scoreExpr?s(V.scoreExpr):"",Ie=Te?C[Te]:null,we=typeof(V==null?void 0:V.cooldownBars)=="number"&&Number.isFinite(V.cooldownBars)?Math.max(0,Math.floor(V.cooldownBars)):0,ze=String((V==null?void 0:V.id)??ne),Ce=(V==null?void 0:V.orderId)!=null&&String(V.orderId).trim()?String(V.orderId).trim():void 0;let Ct=0;for(let y=0;y<t;y++){const c=me[y];if(!Number.isFinite(c)||c===0)continue;const M=ve&&Number.isFinite(ve[y])?Math.max(0,Math.floor(ve[y])):we;if(M>0&&y<Ct)continue;Ct=y+M;const o=f(C,"close",y,0),u=V==null?void 0:V.order;let P;if(u&&typeof u=="object"){const X=String(u.kind||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop|trailingstop|trailstop/g,"trailing_stop"),B=X==="limit"||X==="stop"||X==="mit"||X==="lit"?f(C,u.price??u.limitPrice??u.stopPrice,y,o):void 0,te=X==="stop_limit"?h(C,u.stopPrice??u.price,y):void 0,ie=X==="stop_limit"||X==="lit"?h(C,u.limitPrice??u.price,y):void 0,ae=h(C,u.qty,y),fe=h(C,u.cash,y),ee=h(C,u.commissionPct,y),ue=typeof u.commissionType=="string"?u.commissionType:void 0,De=h(C,u.commissionValue,y),Ge=h(C,u.commissionCash,y),Ye=h(C,u.commissionPerUnit,y),Ae=h(C,u.slippagePct,y),ft=typeof u.slippageType=="string"?u.slippageType:void 0,pt=h(C,u.slippageValue,y),qt=h(C,u.slippageAbs,y),Ut=h(C,u.slippageTicks,y),qe=h(C,u.trailPct,y),Lt=h(C,u.trailOffset,y),wt=h(C,u.trailPrice,y),at=typeof u.tif=="string"?u.tif.toLowerCase():void 0,Pe=u.qtyPct==null?void 0:Math.max(0,Math.min(100,Number(u.qtyPct)||0));P={kind:X,price:B,stopPrice:te,limitPrice:ie,qty:ae,cash:fe,commissionPct:ee,commissionType:ue,commissionValue:De,commissionCash:Ge,commissionPerUnit:Ye,slippagePct:Ae,slippageType:ft,slippageValue:pt,slippageAbs:qt,slippageTicks:Ut,trailPct:qe,trailOffset:Lt,trailPrice:wt,qtyPct:Pe,oco:u.oco,expiresBars:u.expiresBars,tif:at,bracket:u.bracket}}const F=Ie&&Number.isFinite(Ie[y])?Ie[y]:typeof(V==null?void 0:V.score)=="number"?V.score:null;S.push({type:V.type,index:y,timestamp:Number.isFinite(U[y])?U[y]:Date.now(),signalId:ze,orderId:Ce,order:P,score:F,frequency:V==null?void 0:V.frequency})}}),S},_=(C,v)=>{const S=new Set,U=[],V=ne=>{const he=String(ne.code||ne.message||"").trim();!he||S.has(he)||(S.add(he),U.push(ne))};return C.forEach(V),v.forEach(V),U};try{const C=r();if(!C.state.strategyAccessorsUsed)return{id:e.id,output:C.output,diagnostics:C.state.diagnostics.length?C.state.diagnostics:void 0,mtfRequests:C.mtfRequests,mtfMissing:C.mtfMissing};let v={},S={},U=null;try{const be=C.output.signals||[],ve=cc(C.output.strategy??!0);if(ve){const Te=p(C.output.seriesMap,be),Ie=e.base.close.map((ze,Ce)=>{var Ct;return{index:Ce,timestamp:Number.isFinite(n[Ce])?n[Ce]:0,open:e.base.open[Ce],high:e.base.high[Ce],low:e.base.low[Ce],close:ze??NaN,volume:(Ct=e.base.volume)==null?void 0:Ct[Ce]}}),we=fc(Ie,Te,ve);if(we&&we.series){const ze=(Ct,y=NaN)=>!Ct||Ct.length!==t?new Array(t).fill(Number.isFinite(y)?y:void 0):Ct.map(c=>Number.isFinite(c)?c:void 0);v={position_size:ze(we.series.positionSize,0),position_avg_price:ze(we.series.positionAvgPrice,NaN),opentrades:ze(we.series.openTrades,0),closedtrades:ze(we.series.closedTrades,0),openprofit:ze(we.series.openProfit,0),closedprofit:ze(we.series.closedProfit,0),grossprofit:ze(we.series.grossProfit,0),grossloss:ze(we.series.grossLoss,0),wintrades:ze(we.series.winTrades,0),losstrades:ze(we.series.lossTrades,0),winrate:ze(we.series.winRate,0),max_drawdown:ze(we.series.maxDrawdownPct,0),max_drawdown_value:ze(we.series.maxDrawdownValue,0),max_runup:ze(we.series.maxRunupPct,0),max_runup_value:ze(we.series.maxRunupValue,0),avg_trade:ze(we.series.avgTrade,0),avg_win:ze(we.series.avgWin,0),avg_loss:ze(we.series.avgLoss,0),avg_bars_in_trade:ze(we.series.avgBarsInTrade,0),equity:ze(we.series.equity,0),net_profit:ze(we.series.netProfit,0)};const Ce=we.summary;S={initial_capital:ve.initialCapital,final_equity:Ce.finalEquity,net_profit_pct:Ce.netPnlPct,gross_profit:Ce.grossProfit,gross_loss:Ce.grossLoss,profit_factor:Ce.profitFactor,trades:Ce.trades,wins:Ce.wins,losses:Ce.losses,round_trips:Ce.roundTrips,fees_paid:Ce.feesPaid,expectancy:Ce.expectancy,payoff_ratio:Ce.payoffRatio,max_consec_wins:Ce.maxConsecWins,max_consec_losses:Ce.maxConsecLosses,exposure_pct:Ce.exposurePct,max_runup_pct:Ce.maxRunupPct,max_runup_value:Ce.maxRunupValue,max_drawdown_pct:Ce.maxDrawdownPct,max_drawdown_value:Ce.maxDrawdownValue,avg_bars_in_trade:Ce.avgBarsInTrade,volatility_pct:Ce.volatilityPct,sharpe:Ce.sharpe,sortino:Ce.sortino,calmar:Ce.calmar},U=we.accessors??null}}}catch{}const V=r({emitSignals:!1,accessors:{series:v,constants:S,accessors:U||void 0}}),ne=new Set;C.state.signals.forEach(be=>{ne.add(be.when.name),Object.values(be.series).forEach(ve=>ne.add(ve.name))});const he={...V.output.seriesMap||{}};Object.entries(C.output.seriesMap||{}).forEach(([be,ve])=>{ne.has(be)?he[be]=ve:be in he||(he[be]=ve)});const me=_(C.state.diagnostics,V.state.diagnostics);return{id:e.id,output:{...V.output,seriesMap:he,signals:C.output.signals,strategy:C.output.strategy},diagnostics:me.length?me:void 0,mtfRequests:C.mtfRequests,mtfMissing:C.mtfMissing}}catch(C){return{id:e.id,error:hc(C)}}}const ka=self;ka.onmessage=e=>{const t=e.data;let i;try{i=dc(t)}catch(n){const a=n instanceof Error?n.message:"JS worker failed";i={id:(t==null?void 0:t.id)||"unknown",error:a}}ka.postMessage(i)}})();
