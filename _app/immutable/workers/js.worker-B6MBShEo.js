(function(){"use strict";const Qa=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="boolean")return e?1:0;if(e==null)return NaN;const t=Number(e);return Number.isFinite(t)?t:NaN},ni=(e,t,i)=>{const n=(a=0)=>{if(typeof a!="number"||!Number.isFinite(a)||!Number.isInteger(a)||a<0)throw new Error("ctx.hist offset must be a non-negative integer");const r=i.value-a;if(r<0||r>=t.length)return NaN;const s=t[r];return Qa(s)};return{name:e,data:t,get:n,valueOf:()=>n(0),toString:()=>String(n(0))}},Xn=e=>{const t=e.params&&typeof e.params=="object"?e.params:{},i=(a,r)=>{const s=String(a||"").trim();return s&&Object.prototype.hasOwnProperty.call(t,s)?t[s]:r};return{open:ni("open",e.open,e.indexRef),high:ni("high",e.high,e.indexRef),low:ni("low",e.low,e.indexRef),close:ni("close",e.close,e.indexRef),volume:ni("volume",e.volume,e.indexRef),time:ni("time",e.time,e.indexRef),bar_index:ni("bar_index",e.barIndex,e.indexRef),params:t,input:i,hist:(a,r=0)=>a.get(r)}},Ga=["line","histogram","area","cross","dots","stepped","step","bar","candles","ohlc","neon_line","bezier_line","glow_points","heatmap","distortion","cloud","aura","candleshadow","supertrend_cloud","fractal_boxes","liquidity_tiles"],Hi={maxLoopIters:5e4,maxBarMs:100,maxTotalMs:2e3,maxCallDepth:2e3,maxSeriesPoints:25e3,maxDrawOps:2e3,maxSecurityCalls:20,maxHeatmapPoints:2e5,maxOverlays:120,maxOverlayPoints:2e3},vn=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();function Ka(e=Hi){let t=0,i=0,n=vn(),a=vn();return{resetBar:()=>{t=0,i=0,n=vn()},resetRun:()=>{a=vn()},guard:()=>{if(t+=1,t>e.maxLoopIters)throw new Error("JS guardrail: loop iteration limit exceeded")},checkTime:()=>{if(vn()-n>e.maxBarMs)throw new Error("JS guardrail: time budget exceeded")},checkTotal:()=>{if(vn()-a>e.maxTotalMs)throw new Error(`JS guardrail: total runtime exceeded (max ${e.maxTotalMs}ms)`)},enterCall:()=>{if(i+=1,i>e.maxCallDepth)throw new Error("JS guardrail: call depth exceeded")},exitCall:()=>{i=Math.max(0,i-1)}}}function Ha(e){return Object.freeze({...e})}const Er="script_studio_js",xs=`"use strict";
const window = undefined;
const document = undefined;
const globalThis = undefined;
const self = undefined;
const navigator = undefined;
const location = undefined;
const crypto = undefined;
const fetch = undefined;
const WebSocket = undefined;
const setTimeout = undefined;
const setInterval = undefined;
const XMLHttpRequest = undefined;
const Date = Object.assign(function () {
  throw new Error("JS guardrail: Date is not allowed");
}, {
  now() {
    throw new Error("JS guardrail: Date.now is not allowed");
  },
  parse() {
    throw new Error("JS guardrail: Date.parse is not allowed");
  },
  UTC() {
    throw new Error("JS guardrail: Date.UTC is not allowed");
  }
});
const performance = {
  now() {
    throw new Error("JS guardrail: performance.now is not allowed");
  }
};
const __blockedMathRandom = () => {
  throw new Error("JS guardrail: Math.random is not allowed");
};
try {
  Math.random = __blockedMathRandom;
} catch (error) {
  // Ignore if Math.random is not writable in this environment.
}
const { ctx, ta, math, color, str, request, plot, plotshape, plotchar, plotcandle, plotbar, plotohlc, hline, fill, label, line, box, polyline, polygon, overlay, heatmap, table, alert, alertcondition, strategy, __guard, __guardCall, __guardExit } = sandbox;
let exports = {};
let module = { exports };
`,Ja=`
const exp = (module && module.exports) ? module.exports : exports;
return {
  onInit: (typeof onInit === "function" ? onInit : exp.onInit),
  onBar: (typeof onBar === "function" ? onBar : exp.onBar),
};
//# sourceURL=${Er}
`,bs=xs.split(`
`).length-1;function Ya(e,t){const i=String(e||""),n=t.__instrument,a=n?n(i):i,r=`${xs}${a}${Ja}`;return new Function("sandbox",r)(t)}const Mr=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="boolean")return e?1:0;if(e==null)return NaN;const t=Number(e);return Number.isFinite(t)?t:NaN},Mn=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),Xa=()=>{const e=new Error().stack;if(!e)return;const t=e.match(new RegExp(`${Er}:(\\d+):(\\d+)`));if(!t)return;const i=Number(t[1]),n=Number(t[2]),a=Number.isFinite(i)?Math.max(1,i-bs):void 0,r=Number.isFinite(n)?Math.max(1,n):void 0;if(!(!a&&!r))return{line:a,col:r}},St=(e,t,i,n,a)=>{if(e.diagSet.has(t))return;e.diagSet.add(t);const r=Xa();e.diagnostics.push({level:i,message:n,hint:a,code:t,line:r==null?void 0:r.line,col:r==null?void 0:r.col})},nt=e=>e&&typeof e=="object"&&e.get?Mr(e.get(0)):Mr(e),mi=(e,t)=>{if(Mn(e))return mi(e.get(0),t);if(typeof e=="boolean")return e?1:0;if(typeof e=="number")return Number.isFinite(e)&&e!==0?1:0;if(typeof e=="string")return e.length?1:0;throw new Error(`JS guardrail: ${t} condition must be a number, boolean, or string`)},Tr=e=>{if(!e)return 0;let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);const i=t>>>0;return i===0?1:i},Za=e=>{const t=String(e||"line").trim().toLowerCase().replace(/^plot\./,"");return t?Ga.includes(t)?t:t.includes("hist")||t.includes("column")?"histogram":t.includes("bar")&&!t.includes("ohlc")&&!t.includes("candle")?"bar":t.includes("candle")?"candles":t.includes("ohlc")?"ohlc":t.includes("area")?"area":t.includes("step")?"stepped":t.includes("cross")?"cross":t.includes("dot")?"dots":t.includes("neon")?"neon_line":t.includes("bezier")?"bezier_line":t.includes("glow")?"glow_points":t.includes("heat")?"heatmap":t.includes("distort")?"distortion":t.includes("cloud")?"cloud":t.includes("aura")?"aura":t:"line"},Rr=(e,t=12)=>{if(e==null)return;const i=typeof e=="number"?e:Number(e);if(Number.isFinite(i))return Math.max(6,Math.min(48,i));const n=String(e).trim().toLowerCase();return n?n.includes("tiny")?10:n.includes("small")?12:n.includes("normal")?14:n.includes("large")?16:n.includes("huge")?18:t:t},Tn=e=>{if(e==null)return;const t=String(e).trim().toLowerCase();if(t.startsWith("l"))return"left";if(t.startsWith("c")||t.includes("middle"))return"center";if(t.startsWith("r"))return"right"},Zn=e=>{if(e==null)return;const t=String(e).trim().toLowerCase();if(t.startsWith("t"))return"top";if(t.startsWith("m")||t.includes("center"))return"middle";if(t.startsWith("b"))return"bottom"},eo=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(!e||typeof e!="object"||Array.isArray(e))return;const t=e,i=a=>{const r=typeof a=="number"?a:Number(a);return Number.isFinite(r)?r:void 0},n={};if(n.left=i(t.left),n.right=i(t.right),n.top=i(t.top),n.bottom=i(t.bottom),!(n.left==null&&n.right==null&&n.top==null&&n.bottom==null))return n},to=e=>{const t=typeof e=="number"?e:Number(e);if(Number.isFinite(t))return Math.trunc(t)},ri=e=>String(e||"").toLowerCase()==="sub"?"sub":"main",vi=e=>!!e&&typeof e=="object"&&!Array.isArray(e)&&!Mn(e),wn=e=>{if(e==null)return;const t=String(e).trim().toLowerCase().replace(/^xloc\./,"");if(t){if(t.includes("time"))return"time";if(t.includes("bar"))return"bar_index"}},_s=e=>{if(e==null)return;const t=String(e).trim().toLowerCase().replace(/^yloc\./,"");if(t){if(t.includes("pixel"))return"pixel";if(t.includes("price"))return"price"}},vs=e=>{if(e==null)return;const t=String(e).trim().toLowerCase().replace(/^yloc\./,"");if(t){if(t.includes("above"))return"abovebar";if(t.includes("below"))return"belowbar";if(t.includes("price")||t.includes("absolute"))return"price"}},ws=e=>{if(Array.isArray(e)){const t=e.map(i=>String(i||"").trim().toLowerCase()).filter(Boolean);return t.length?t:void 0}if(typeof e=="string"){const t=e.split(",").map(i=>i.trim().toLowerCase()).filter(Boolean);return t.length?t:void 0}},fi=e=>{if(!e||typeof e!="object")return;const t=e,i=t.from??t.start??t.color1??t.colorA,n=t.to??t.end??t.color2??t.colorB,a=i!=null?String(i):void 0,r=n!=null?String(n):void 0;if(!a&&!r)return;const s=String(t.mode??t.direction??t.type??"").toLowerCase();let u;return s.includes("rad")?u="radial":s.includes("h")?u="horizontal":s.includes("v")&&(u="vertical"),{from:a,to:r,mode:u}},Nn=e=>{if(!e)return{};const t=e.glow??e.glowSize??e.glow_size??e.glowWidth??e.glow_width,i=typeof t=="number"?t:Number(t);if(!Number.isFinite(i)||i<=0)return{};const n=e.glowOpacity??e.glow_opacity,a=typeof n=="number"?n:Number(n),r=Number.isFinite(a)?Math.max(0,Math.min(1,a)):void 0,s=typeof e.glowColor=="string"?e.glowColor:typeof e.glow_color=="string"?e.glow_color:void 0;return{glow:Math.min(64,i),glowColor:s,glowOpacity:r}},Li=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=Number(e);if(Number.isFinite(t))return t!==0;const i=String(e).trim().toLowerCase();if(i==="true")return!0;if(i==="false")return!1},er=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=Number(e);if(Number.isFinite(t))return t!==0;const i=String(e).trim().toLowerCase();if(i==="true")return!0;if(i==="false")return!1},Et=(e,t)=>(e.panes[t]||(e.panes[t]={pane:t,plots:[],overlays:[],levels:[],fills:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],runtimeDrawOps:[]}),e.panes[t]),ht=(e,t,i=NaN)=>{const n=t.toLowerCase();if(!e.seriesMap[n]){const a=new Array(e.len);for(let r=0;r<e.len;r++)a[r]=i;e.seriesMap[n]=a}return e.seriesMap[n]},mt=(e,t,i)=>`${e}_${t}${i?`_${i}`:""}`.toLowerCase(),io=e=>e.startsWith("__js_draw_stub__")||e.startsWith("__js_strategy_stub__"),Ns=e=>{const t=String(e||"").toLowerCase().replace(/^shape\./,"").replace(/^label\./,"");if(t){if(t.includes("xcross"))return"xcross";if(t.includes("cross"))return"cross";if(t.includes("diamond"))return"diamond";if(t.includes("star"))return"star";if(t.includes("flag"))return"flag";if(t.includes("tag"))return"tag";if(t.includes("pill"))return"pill";if(t.includes("callout"))return"callout";if(t.includes("bubble"))return"bubble";if(t.includes("spark"))return"spark";if(t.includes("box_gradient"))return"box_gradient";if(t.includes("box"))return"box";if(t.includes("square"))return"square";if(t.includes("circle_pulse"))return"circle_pulse";if(t.includes("circle"))return"circle";if(t.includes("arrow_up_glow"))return"arrow_up_glow";if(t.includes("arrow_down_glow"))return"arrow_down_glow";if(t.includes("arrowup")||t.includes("arrow_up"))return"arrowUp";if(t.includes("arrowdown")||t.includes("arrow_down"))return"arrowDown";if(t.includes("triangle_up_gradient"))return"triangle_up_gradient";if(t.includes("triangle_down_gradient"))return"triangle_down_gradient";if(t.includes("triangle")&&t.includes("down"))return"triangle_down_filled";if(t.includes("triangle")&&t.includes("up"))return"triangle_up_filled";if(t.includes("down"))return"triangle_down_filled";if(t.includes("up"))return"triangle_up_filled";if(t.includes("label"))return"label";if(t.includes("text"))return"text"}},no=(e,t)=>({len:e,indexRef:t,seriesMap:{},panes:{main:{pane:"main",plots:[],overlays:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],runtimeDrawOps:[]},sub:{pane:"sub",plots:[],overlays:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],runtimeDrawOps:[]}},plots:[],labels:[],lines:[],boxes:[],tables:[],polylines:[],polylineMap:new Map,polygons:[],polygonMap:new Map,heatmaps:new Map,heatmapOrder:[],heatmapPointCount:0,overlays:new Map,overlayPointCount:0,signalCounter:0,signalMap:new Map,signals:[],strategyConfig:null,drawOpsThisBar:0,maxDrawOps:Hi.maxDrawOps,maxHeatmapPoints:Hi.maxHeatmapPoints,maxOverlays:Hi.maxOverlays,maxOverlayPoints:Hi.maxOverlayPoints,diagnostics:[],diagSet:new Set,strategyAccessorsUsed:!1,constSeriesCounter:0,cursors:{plot:0,label:0,line:0,box:0,polyline:0,polygon:0,overlay:0}}),ro=e=>{e.cursors.plot=0,e.cursors.label=0,e.cursors.line=0,e.cursors.box=0,e.cursors.polyline=0,e.cursors.polygon=0,e.cursors.overlay=0,e.drawOpsThisBar=0},so=(e,t)=>{const i=()=>(e.drawOpsThisBar+=1,e.drawOpsThisBar<=e.maxDrawOps?!0:(St(e,"js_draw_ops_cap","warning",`JS guardrail: draw op limit exceeded (max ${e.maxDrawOps} per bar)`,"Reduce draw calls or gate them with a condition."),!1)),n=y=>{const c=to(y==null?void 0:y.offset)??0,M=wn(y==null?void 0:y.xloc),o=(y==null?void 0:y.location)??(y==null?void 0:y.yloc),f=vs(o),P=nt(t.bar_index)+c,I=f==="abovebar"?nt(t.high):f==="belowbar"?nt(t.low):(y==null?void 0:y.price)!=null?nt(y.price):(y==null?void 0:y.y)!=null?nt(y.y):nt(t.close);return{x:P,y:I,xloc:M,yloc:f}},a=(y,c)=>{if(Mn(y)){const M=y.name.toLowerCase();return e.seriesMap[M]||(e.seriesMap[M]=y.data),M}if(typeof y=="string"){const M=y.replace(/\s+/g,"_").toLowerCase();if(e.seriesMap[M])return M;if(t[M]&&Mn(t[M])){const f=t[M];return e.seriesMap[M]=f.data,M}const o=Number(y);if(Number.isFinite(o)){const f=mt("__js_const",e.constSeriesCounter++);return ht(e,f,o),f}throw new Error(`fill: unknown series "${y}"`)}if(typeof y=="number"||typeof y=="boolean"){const M=Mr(y),o=mt("__js_const",e.constSeriesCounter++);return ht(e,o,Number.isFinite(M)?M:NaN),o}throw new Error(`fill: ${c} must be a series or number`)},r=(y,c)=>{var P;if(!i())return null;const M=e.cursors.plot++;let o=e.plots[M];if(!o){const I=ri(c==null?void 0:c.pane),Y=mt("__js_plot",M),X=ht(e,Y),B=Za((c==null?void 0:c.type)??(c==null?void 0:c.style)??"line"),te=fi(c==null?void 0:c.gradient),ie=fi((c==null?void 0:c.upGradient)??(c==null?void 0:c.up_gradient)),ae=fi((c==null?void 0:c.downGradient)??(c==null?void 0:c.down_gradient)),fe={name:String((c==null?void 0:c.title)||(c==null?void 0:c.name)||Y),source:Y,type:B,color:c==null?void 0:c.color,width:(c==null?void 0:c.width)??(c==null?void 0:c.linewidth)??(c==null?void 0:c.lineWidth),style:c==null?void 0:c.style,gradient:te,upGradient:ie,downGradient:ae,layer:c==null?void 0:c.layer,offset:c==null?void 0:c.offset,showLast:c==null?void 0:c.showLast,display:c==null?void 0:c.display,legend:(c==null?void 0:c.legend)??(c==null?void 0:c.showLegend),legendPosition:(c==null?void 0:c.legendPosition)??(c==null?void 0:c.legend_position),legendOffsetX:(c==null?void 0:c.legendOffsetX)??(c==null?void 0:c.legend_offset_x),legendOffsetY:(c==null?void 0:c.legendOffsetY)??(c==null?void 0:c.legend_offset_y),trackPrice:c==null?void 0:c.trackPrice,precision:c==null?void 0:c.precision,baseline:c==null?void 0:c.baseline,downColor:(c==null?void 0:c.downColor)??(c==null?void 0:c.down_color),wickColor:(c==null?void 0:c.wickColor)??(c==null?void 0:c.wick_color),borderColor:(c==null?void 0:c.borderColor)??(c==null?void 0:c.border_color)};o={seriesName:Y,series:X,def:fe,pane:I},e.plots[M]=o,(P=Et(e,I).plots)==null||P.push(fe)}const f=nt(y);return Number.isFinite(f)?(o.series[e.indexRef.value]=f,o.hasFinite=!0):o.series[e.indexRef.value]=void 0,o.ref||(o.ref=ni(o.seriesName,o.series,e.indexRef)),o.ref},s=(y,c)=>{const M=mi(y,"plotshape")===1,o=ri(c==null?void 0:c.pane),{x:f,y:P,xloc:I,yloc:Y}=n(c),X=c==null?void 0:c.text,B=X==null?void 0:String(X),te=(c==null?void 0:c.style)??(c==null?void 0:c.shape),ie=Ns(te),ae=B!=null&&B.length>0,fe=ie??(ae?"callout":"triangle_up_filled"),ee=(c==null?void 0:c.textcolor)??(c==null?void 0:c.textColor)??(ae?"#f8fafc":c==null?void 0:c.color),ue=(c==null?void 0:c.offsetY)??(c==null?void 0:c.offset_y),De=typeof ue=="number"?ue:Number.isFinite(Number(ue))?Number(ue):Y==="abovebar"||Y==="belowbar"?12:void 0;v.new(f,P,B,{pane:o,when:M?1:0,style:te,shape:fe,color:c==null?void 0:c.color,bgcolor:(c==null?void 0:c.bgcolor)??(c==null?void 0:c.bgColor),bgGradient:(c==null?void 0:c.bgGradient)??(c==null?void 0:c.bg_gradient)??(c==null?void 0:c.gradient),textcolor:ee,size:Rr(c==null?void 0:c.size),offsetY:De,xloc:I,yloc:Y,textalign:c==null?void 0:c.textalign,tooltip:c==null?void 0:c.tooltip,avoidOverlap:(c==null?void 0:c.avoidOverlap)??(c==null?void 0:c.avoid_overlap),collision:c==null?void 0:c.collision,layer:c==null?void 0:c.layer,zIndex:(c==null?void 0:c.zIndex)??(c==null?void 0:c.zindex),callout:fe==="callout",includeInAutoscale:Li((c==null?void 0:c.includeInAutoscale)??(c==null?void 0:c.include_in_autoscale)??(c==null?void 0:c.autoscale))})},u=(y,c)=>{const M=mi(y,"plotchar")===1,o=ri(c==null?void 0:c.pane),f=(c==null?void 0:c.char)!=null?String(c.char):"",{x:P,y:I,xloc:Y,yloc:X}=n(c);v.new(P,I,f,{pane:o,when:M?1:0,style:"text",color:(c==null?void 0:c.color)??(c==null?void 0:c.textcolor)??(c==null?void 0:c.textColor),textcolor:(c==null?void 0:c.textcolor)??(c==null?void 0:c.textColor)??(c==null?void 0:c.color),size:Rr(c==null?void 0:c.size),xloc:Y,yloc:X,textalign:c==null?void 0:c.textalign,tooltip:c==null?void 0:c.tooltip,avoidOverlap:(c==null?void 0:c.avoidOverlap)??(c==null?void 0:c.avoid_overlap),collision:c==null?void 0:c.collision,layer:c==null?void 0:c.layer,zIndex:(c==null?void 0:c.zIndex)??(c==null?void 0:c.zindex),includeInAutoscale:Li((c==null?void 0:c.includeInAutoscale)??(c==null?void 0:c.include_in_autoscale)??(c==null?void 0:c.autoscale))})},h=(y,c,M,o,f,P)=>{var Ye;if(!i())return null;let I;vi(P)&&(I=P),vi(c)&&M==null&&o==null&&f==null&&(I=c,c=t.open,M=t.high,o=t.low,f=t.close);const Y=c??t.open,X=M??t.high,B=o??t.low,te=f??t.close,ie=e.cursors.plot++;let ae=e.plots[ie];if(!ae){const Ae=ri(I==null?void 0:I.pane),ft=mt("__js_plot",ie),pt=ht(e,ft),qt=mt("__js_plot",ie,"open"),Ut=mt("__js_plot",ie,"high"),qe=mt("__js_plot",ie,"low"),Lt=ht(e,qt),wt=ht(e,Ut),at=ht(e,qe),Pe=fi(I==null?void 0:I.gradient),jt=fi((I==null?void 0:I.upGradient)??(I==null?void 0:I.up_gradient))??Pe,Ke=fi((I==null?void 0:I.downGradient)??(I==null?void 0:I.down_gradient))??Pe,je={name:String((I==null?void 0:I.title)||(I==null?void 0:I.name)||ft),source:ft,type:y,color:I==null?void 0:I.color,downColor:(I==null?void 0:I.downColor)??(I==null?void 0:I.down_color),wickColor:(I==null?void 0:I.wickColor)??(I==null?void 0:I.wick_color),borderColor:(I==null?void 0:I.borderColor)??(I==null?void 0:I.border_color),gradient:Pe,upGradient:jt,downGradient:Ke,open:qt,high:Ut,low:qe,close:ft,offset:I==null?void 0:I.offset,showLast:I==null?void 0:I.showLast,display:I==null?void 0:I.display,legend:(I==null?void 0:I.legend)??(I==null?void 0:I.showLegend),legendPosition:(I==null?void 0:I.legendPosition)??(I==null?void 0:I.legend_position),legendOffsetX:(I==null?void 0:I.legendOffsetX)??(I==null?void 0:I.legend_offset_x),legendOffsetY:(I==null?void 0:I.legendOffsetY)??(I==null?void 0:I.legend_offset_y),layer:I==null?void 0:I.layer};ae={seriesName:ft,series:pt,def:je,pane:Ae,ohlc:{openName:qt,openSeries:Lt,highName:Ut,highSeries:wt,lowName:qe,lowSeries:at,closeName:ft,closeSeries:pt}},e.plots[ie]=ae,(Ye=Et(e,Ae).plots)==null||Ye.push(je)}const fe=e.indexRef.value,ee=nt(Y),ue=nt(X),De=nt(B),Ge=nt(te);return ae.series[fe]=Ge,Number.isFinite(Ge)&&(ae.hasFinite=!0),(Number.isFinite(ee)||Number.isFinite(ue)||Number.isFinite(De)||Number.isFinite(Ge))&&(ae.hasOhlcFinite=!0),ae.ohlc&&(ae.ohlc.openSeries[fe]=ee,ae.ohlc.highSeries[fe]=ue,ae.ohlc.lowSeries[fe]=De,ae.ohlc.closeSeries[fe]=Ge),ae.ref||(ae.ref=ni(ae.seriesName,ae.series,e.indexRef)),ae.ref},m=(y,c,M,o,f)=>h("candles",y,c,M,o,f),_=(y,c,M,o,f)=>h("ohlc",y,c,M,o,f),A=(y,c,M,o,f)=>h("ohlc",y,c,M,o,f),D=(y,c)=>{var P;const M=ri(c==null?void 0:c.pane),o=nt(y);if(!Number.isFinite(o))return;const f={name:String((c==null?void 0:c.title)||(c==null?void 0:c.name)||""),value:o,color:c==null?void 0:c.color,width:(c==null?void 0:c.width)??(c==null?void 0:c.linewidth)??(c==null?void 0:c.lineWidth),style:c==null?void 0:c.style};Et(e,M).levels=Et(e,M).levels||[],(P=Et(e,M).levels)==null||P.push(f)},C=(y,c,M)=>{var X;const o=ri(M==null?void 0:M.pane),f=a(y,"a"),P=a(c,"b"),I=fi((M==null?void 0:M.fillGradient)??(M==null?void 0:M.fill_gradient)??(M==null?void 0:M.gradient)),Y={between:[f,P],color:(M==null?void 0:M.color)??(M==null?void 0:M.bgcolor)??(M==null?void 0:M.fillColor)??(M==null?void 0:M.fill_color),fillGradient:I};Et(e,o).fills=Et(e,o).fills||[],(X=Et(e,o).fills)==null||X.push(Y)},v={new:(y,c,M,o)=>{var Y;if(!i())return;const f=e.cursors.label++;let P=e.labels[f];if(!P){const X=ri(o==null?void 0:o.pane),B=mt("__js_label",f,"when"),te=mt("__js_label",f,"x"),ie=mt("__js_label",f,"y"),ae=ht(e,B,0),fe=ht(e,te),ee=ht(e,ie),ue=M!=null&&typeof M!="string"?mt("__js_label",f,"text"):void 0,De=ue?ht(e,ue):void 0,Ge={x:te,y:ie,whenExpr:B,text:typeof M=="string"?M:void 0,textExpr:ue,color:o==null?void 0:o.color,textColor:(o==null?void 0:o.textcolor)??(o==null?void 0:o.textColor),shape:Ns((o==null?void 0:o.style)||(o==null?void 0:o.shape)),callout:o==null?void 0:o.callout,size:Rr(o==null?void 0:o.size),offsetY:typeof(o==null?void 0:o.offsetY)=="number"?o.offsetY:Number.isFinite(Number((o==null?void 0:o.offsetY)??(o==null?void 0:o.offset_y)))?Number((o==null?void 0:o.offsetY)??(o==null?void 0:o.offset_y)):void 0,wrap:o==null?void 0:o.wrap,maxWidth:(o==null?void 0:o.maxWidth)??(o==null?void 0:o.max_width),padding:eo(o==null?void 0:o.padding),bgColor:(o==null?void 0:o.bgcolor)??(o==null?void 0:o.bgColor),bgGradient:fi((o==null?void 0:o.bgGradient)??(o==null?void 0:o.bg_gradient)??(o==null?void 0:o.gradient)),bgOpacity:(o==null?void 0:o.bgOpacity)??(o==null?void 0:o.bg_opacity)??(o==null?void 0:o.opacity),borderColor:(o==null?void 0:o.bordercolor)??(o==null?void 0:o.borderColor),borderWidth:(o==null?void 0:o.borderwidth)??(o==null?void 0:o.borderWidth),radius:o==null?void 0:o.radius,align:Tn(o==null?void 0:o.align),valign:Zn(o==null?void 0:o.valign),lineHeight:(o==null?void 0:o.lineHeight)??(o==null?void 0:o.line_height),fontFamily:(o==null?void 0:o.fontFamily)??(o==null?void 0:o.font_family),fontSize:(o==null?void 0:o.fontSize)??(o==null?void 0:o.font_size),fontWeight:(o==null?void 0:o.fontWeight)??(o==null?void 0:o.font_weight),monospace:o==null?void 0:o.monospace,avoidOverlap:(o==null?void 0:o.avoidOverlap)??(o==null?void 0:o.avoid_overlap),collision:o==null?void 0:o.collision,xloc:wn(o==null?void 0:o.xloc),yloc:vs(o==null?void 0:o.yloc),textAlign:Tn((o==null?void 0:o.textalign)??(o==null?void 0:o.textAlign)),tooltip:o==null?void 0:o.tooltip,layer:o==null?void 0:o.layer,zIndex:(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),includeInAutoscale:Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale))};P={whenName:B,whenSeries:ae,xName:te,xSeries:fe,yName:ie,ySeries:ee,textName:ue,textSeries:De,def:Ge,pane:X},e.labels[f]=P,(Y=Et(e,X).runtimeLabels)==null||Y.push(Ge)}const I=e.indexRef.value;P.whenSeries[I]=(o==null?void 0:o.when)!=null?mi(o.when,"label"):1,P.xSeries[I]=nt(y),P.ySeries[I]=nt(c),P.textSeries&&M!=null&&(P.textSeries[I]=nt(M))}},S={new:(y,c,M,o,f)=>{var X;if(!i())return;const P=e.cursors.line++;let I=e.lines[P];if(!I){const B=ri(f==null?void 0:f.pane),te=mt("__js_line",P,"when"),ie=mt("__js_line",P,"x1"),ae=mt("__js_line",P,"y1"),fe=mt("__js_line",P,"x2"),ee=mt("__js_line",P,"y2"),ue=ht(e,te,0),De=ht(e,ie),Ge=ht(e,ae),Ye=ht(e,fe),Ae=ht(e,ee),{glow:ft,glowColor:pt,glowOpacity:qt}=Nn(f),Ut=fi((f==null?void 0:f.gradient)??(f==null?void 0:f.strokeGradient)??(f==null?void 0:f.stroke_gradient)),qe={x1:ie,y1:ae,x2:fe,y2:ee,whenExpr:te,color:f==null?void 0:f.color,gradient:Ut,width:(f==null?void 0:f.width)??(f==null?void 0:f.linewidth)??(f==null?void 0:f.lineWidth),glow:ft,glowColor:pt,glowOpacity:qt,style:f==null?void 0:f.style,extend:f==null?void 0:f.extend,xloc:wn(f==null?void 0:f.xloc),layer:f==null?void 0:f.layer,zIndex:(f==null?void 0:f.zIndex)??(f==null?void 0:f.zindex),includeInAutoscale:Li((f==null?void 0:f.includeInAutoscale)??(f==null?void 0:f.include_in_autoscale)??(f==null?void 0:f.autoscale))};I={whenName:te,whenSeries:ue,x1Name:ie,x1Series:De,y1Name:ae,y1Series:Ge,x2Name:fe,x2Series:Ye,y2Name:ee,y2Series:Ae,def:qe,pane:B},e.lines[P]=I,(X=Et(e,B).runtimeLines)==null||X.push(qe)}const Y=e.indexRef.value;I.whenSeries[Y]=(f==null?void 0:f.when)!=null?mi(f.when,"line"):1,I.x1Series[Y]=nt(y),I.y1Series[Y]=nt(c),I.x2Series[Y]=nt(M),I.y2Series[Y]=nt(o)}},U={new:(y,c,M,o,f)=>{var X;if(!i())return;const P=e.cursors.box++;let I=e.boxes[P];if(!I){const B=ri(f==null?void 0:f.pane),te=mt("__js_box",P,"when"),ie=mt("__js_box",P,"left"),ae=mt("__js_box",P,"right"),fe=mt("__js_box",P,"top"),ee=mt("__js_box",P,"bottom"),ue=ht(e,te,0),De=ht(e,ie),Ge=ht(e,ae),Ye=ht(e,fe),Ae=ht(e,ee),ft={left:ie,right:ae,top:fe,bottom:ee,whenExpr:te,borderColor:(f==null?void 0:f.border_color)??(f==null?void 0:f.borderColor),bgColor:(f==null?void 0:f.bgcolor)??(f==null?void 0:f.bgColor),bgGradient:fi((f==null?void 0:f.bgGradient)??(f==null?void 0:f.bg_gradient)??(f==null?void 0:f.gradient)),borderWidth:(f==null?void 0:f.border_width)??(f==null?void 0:f.borderWidth),borderStyle:(f==null?void 0:f.border_style)??(f==null?void 0:f.borderStyle),text:f==null?void 0:f.text,textColor:(f==null?void 0:f.text_color)??(f==null?void 0:f.textColor),textSize:(f==null?void 0:f.text_size)??(f==null?void 0:f.textSize),textHalign:Tn((f==null?void 0:f.text_halign)??(f==null?void 0:f.textHalign)),textValign:Zn((f==null?void 0:f.text_valign)??(f==null?void 0:f.textValign)),textWrap:(f==null?void 0:f.text_wrap)??(f==null?void 0:f.textWrap),tooltip:f==null?void 0:f.tooltip,extend:f==null?void 0:f.extend,xloc:wn(f==null?void 0:f.xloc),layer:f==null?void 0:f.layer,zIndex:(f==null?void 0:f.zIndex)??(f==null?void 0:f.zindex),includeInAutoscale:Li((f==null?void 0:f.includeInAutoscale)??(f==null?void 0:f.include_in_autoscale)??(f==null?void 0:f.autoscale))};I={whenName:te,whenSeries:ue,leftName:ie,leftSeries:De,rightName:ae,rightSeries:Ge,topName:fe,topSeries:Ye,bottomName:ee,bottomSeries:Ae,def:ft,pane:B},e.boxes[P]=I,(X=Et(e,B).runtimeBoxes)==null||X.push(ft)}const Y=e.indexRef.value;I.whenSeries[Y]=(f==null?void 0:f.when)!=null?mi(f.when,"box"):1,I.leftSeries[Y]=nt(y),I.rightSeries[Y]=nt(M),I.topSeries[Y]=nt(c),I.bottomSeries[Y]=nt(o)}},V={new:(...y)=>{if(!i())return null;const c=e.cursors.polygon++,M=y.length&&vi(y[y.length-1]),o=M?y[y.length-1]:{},f=M?y.slice(0,-1):y;let P=[];if(f.length===1&&Array.isArray(f[0]))P=f[0].map(B=>Array.isArray(B)&&B.length>=2?{x:B[0],y:B[1]}:B&&typeof B=="object"&&"x"in B&&"y"in B?{x:B.x,y:B.y}:null).filter(Boolean);else for(let X=0;X+1<f.length;X+=2)P.push({x:f[X],y:f[X+1]});if(P.length<3)return St(e,"js_polygon_points_min","error","polygon.new requires at least 3 points (x,y pairs)","Provide at least 3 point pairs: x1,y1,x2,y2,x3,y3."),null;let I=e.polygons[c];if(!I){const X=ri(o==null?void 0:o.pane),B=mt("__js_polygon",c,"when"),te=ht(e,B,0),ie=mt("__js_polygon",c,"delete"),ae=ht(e,ie,0),fe=P.map((Tt,gt)=>{const Ze=mt(`__js_polygon_${c}_p${gt}`,0,"x"),Rt=mt(`__js_polygon_${c}_p${gt}`,0,"y");return{xName:Ze,xSeries:ht(e,Ze),yName:Rt,ySeries:ht(e,Rt)}}),ee=`js_polygon_${c}`,ue=wn(o==null?void 0:o.xloc),De=_s(o==null?void 0:o.yloc),Ge=fe.map(Tt=>({x:Tt.xName,y:Tt.yName,xloc:ue,yloc:De})),Ye=(o==null?void 0:o.fillColor)??(o==null?void 0:o.fill_color)??(o==null?void 0:o.bgcolor)??(o==null?void 0:o.bgColor)??(o==null?void 0:o.color),Ae=fi((o==null?void 0:o.fillGradient)??(o==null?void 0:o.fill_gradient)??(o==null?void 0:o.gradient))??void 0,ft=(o==null?void 0:o.strokeColor)??(o==null?void 0:o.stroke_color)??(o==null?void 0:o.borderColor)??(o==null?void 0:o.border_color),pt=(o==null?void 0:o.strokeWidth)??(o==null?void 0:o.stroke_width)??(o==null?void 0:o.borderWidth)??(o==null?void 0:o.border_width),qt=(o==null?void 0:o.strokeStyle)??(o==null?void 0:o.stroke_style)??(o==null?void 0:o.borderStyle)??(o==null?void 0:o.border_style),{glow:Ut,glowColor:qe,glowOpacity:Lt}=Nn(o),wt=Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale)),at=(o==null?void 0:o.groupId)??(o==null?void 0:o.group_id)??(o==null?void 0:o.group),Pe=ws((o==null?void 0:o.tags)??(o==null?void 0:o.tag)),jt=o==null?void 0:o.layer,Ke=(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),je={whenExpr:B,points:Ge,fillColor:Ye,fillGradient:Ae,strokeColor:ft,strokeWidth:pt,strokeStyle:qt,opacity:o==null?void 0:o.opacity,glow:Ut,glowColor:qe,glowOpacity:Lt,xloc:ue,yloc:De,layer:jt,zIndex:Ke,includeInAutoscale:wt,groupId:at,tags:Pe,pane:X},ot={kind:"polygon_new",assign:ee,once:!0,...je},Vt={kind:"polygon_set",target:ee,...je},$t={kind:"polygon_delete",target:ee,whenExpr:ie,pane:X};I={id:ee,whenName:B,whenSeries:te,deleteWhenName:ie,deleteWhenSeries:ae,points:fe,newOp:ot,setOp:Vt,deleteOp:$t,pane:X},e.polygons[c]=I,e.polygonMap.set(ee,I);const Nt=Et(e,X);Nt.runtimeDrawOps=Nt.runtimeDrawOps||[],Nt.runtimeDrawOps.push(ot,Vt,$t)}if(I.points.length!==P.length)return St(e,"js_polygon_points_len","error","polygon.new point count must stay consistent for a handle","Reuse the same number of points for the same polygon handle."),{id:I.id,kind:"polygon"};const Y=e.indexRef.value;if(I.whenSeries[Y]=(o==null?void 0:o.when)!=null?mi(o.when,"polygon"):1,P.forEach((X,B)=>{const te=I.points[B];te.xSeries[Y]=nt(X.x),te.ySeries[Y]=nt(X.y)}),o){const X=o.fillColor??o.fill_color??o.bgcolor??o.bgColor??o.color,B=fi(o.fillGradient??o.fill_gradient??o.gradient)??void 0,te=o.strokeColor??o.stroke_color??o.borderColor??o.border_color,ie=o.strokeWidth??o.stroke_width??o.borderWidth??o.border_width,ae=o.strokeStyle??o.stroke_style??o.borderStyle??o.border_style;X!=null&&(I.setOp.fillColor=X),B&&(I.setOp.fillGradient=B),te!=null&&(I.setOp.strokeColor=te),ie!=null&&(I.setOp.strokeWidth=ie),ae!=null&&(I.setOp.strokeStyle=ae),o.opacity!=null&&(I.setOp.opacity=o.opacity);const{glow:fe,glowColor:ee,glowOpacity:ue}=Nn(o);fe!=null&&(I.setOp.glow=fe),ee&&(I.setOp.glowColor=ee),ue!=null&&(I.setOp.glowOpacity=ue)}return{id:I.id,kind:"polygon"}},set_points:(y,...c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polygonMap.get(M):void 0;if(!o){St(e,"js_polygon_handle","error","polygon.set_points requires a valid handle returned by polygon.new","Store the handle returned by polygon.new and pass it to set_points.");return}const f=c.length&&vi(c[c.length-1]),P=f?c[c.length-1]:{},I=f?c.slice(0,-1):c,Y=[];if(I.length===1&&Array.isArray(I[0]))I[0].forEach(te=>{Array.isArray(te)&&te.length>=2?Y.push({x:te[0],y:te[1]}):te&&typeof te=="object"&&"x"in te&&"y"in te&&Y.push({x:te.x,y:te.y})});else for(let B=0;B+1<I.length;B+=2)Y.push({x:I[B],y:I[B+1]});if(Y.length!==o.points.length){St(e,"js_polygon_points_len_set","error","polygon.set_points must use the same number of points as polygon.new","Match the original point count used by polygon.new.");return}const X=e.indexRef.value;if(o.whenSeries[X]=(P==null?void 0:P.when)!=null?mi(P.when,"polygon"):1,Y.forEach((B,te)=>{const ie=o.points[te];ie.xSeries[X]=nt(B.x),ie.ySeries[X]=nt(B.y)}),P){const B=P.fillColor??P.fill_color??P.bgcolor??P.bgColor??P.color,te=fi(P.fillGradient??P.fill_gradient??P.gradient)??void 0,ie=P.strokeColor??P.stroke_color??P.borderColor??P.border_color,ae=P.strokeWidth??P.stroke_width??P.borderWidth??P.border_width,fe=P.strokeStyle??P.stroke_style??P.borderStyle??P.border_style;B!=null&&(o.setOp.fillColor=B),te&&(o.setOp.fillGradient=te),ie!=null&&(o.setOp.strokeColor=ie),ae!=null&&(o.setOp.strokeWidth=ae),fe!=null&&(o.setOp.strokeStyle=fe),P.opacity!=null&&(o.setOp.opacity=P.opacity);const{glow:ee,glowColor:ue,glowOpacity:De}=Nn(P);ee!=null&&(o.setOp.glow=ee),ue&&(o.setOp.glowColor=ue),De!=null&&(o.setOp.glowOpacity=De)}},delete:(y,c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polygonMap.get(M):void 0;if(!o){St(e,"js_polygon_handle_delete","error","polygon.delete requires a valid handle returned by polygon.new","Store the handle returned by polygon.new and pass it to delete.");return}const f=e.indexRef.value,P=(c==null?void 0:c.when)!=null?mi(c.when,"polygon.delete"):1;o.deleteWhenSeries[f]=P}},ne={new:(...y)=>{if(!i())return null;const c=e.cursors.polyline++,M=y.length&&vi(y[y.length-1]),o=M?y[y.length-1]:{},f=M?y.slice(0,-1):y;let P=[];if(f.length===1&&Array.isArray(f[0]))P=f[0].map(B=>Array.isArray(B)&&B.length>=2?{x:B[0],y:B[1]}:B&&typeof B=="object"&&"x"in B&&"y"in B?{x:B.x,y:B.y}:null).filter(Boolean);else for(let X=0;X+1<f.length;X+=2)P.push({x:f[X],y:f[X+1]});if(P.length<2)return St(e,"js_polyline_points_min","error","polyline.new requires at least 2 points (x,y pairs)","Provide at least 2 point pairs: x1,y1,x2,y2."),null;let I=e.polylines[c];if(!I){const X=ri(o==null?void 0:o.pane),B=mt("__js_polyline",c,"when"),te=ht(e,B,0),ie=mt("__js_polyline",c,"delete"),ae=ht(e,ie,0),fe=P.map((Nt,Tt)=>{const gt=mt(`__js_polyline_${c}_p${Tt}`,0,"x"),Ze=mt(`__js_polyline_${c}_p${Tt}`,0,"y");return{xName:gt,xSeries:ht(e,gt),yName:Ze,ySeries:ht(e,Ze)}}),ee=`js_polyline_${c}`,ue=wn(o==null?void 0:o.xloc),De=_s(o==null?void 0:o.yloc),Ge=fe.map(Nt=>({x:Nt.xName,y:Nt.yName,xloc:ue,yloc:De})),Ye=(o==null?void 0:o.color)??(o==null?void 0:o.strokeColor)??(o==null?void 0:o.stroke_color),Ae=fi((o==null?void 0:o.gradient)??(o==null?void 0:o.strokeGradient)??(o==null?void 0:o.stroke_gradient)),ft=(o==null?void 0:o.width)??(o==null?void 0:o.linewidth)??(o==null?void 0:o.lineWidth),pt=(o==null?void 0:o.style)??(o==null?void 0:o.lineStyle)??(o==null?void 0:o.line_style),{glow:qt,glowColor:Ut,glowOpacity:qe}=Nn(o),Lt=Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale)),wt=(o==null?void 0:o.groupId)??(o==null?void 0:o.group_id)??(o==null?void 0:o.group),at=ws((o==null?void 0:o.tags)??(o==null?void 0:o.tag)),Pe=o==null?void 0:o.layer,jt=(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),Ke={whenExpr:B,points:Ge,color:Ye,gradient:Ae,width:ft,style:pt,opacity:o==null?void 0:o.opacity,glow:qt,glowColor:Ut,glowOpacity:qe,xloc:ue,yloc:De,layer:Pe,zIndex:jt,includeInAutoscale:Lt,groupId:wt,tags:at,pane:X},je={kind:"polyline_new",assign:ee,once:!0,...Ke},ot={kind:"polyline_set",target:ee,...Ke},Vt={kind:"polyline_delete",target:ee,whenExpr:ie,pane:X};I={id:ee,whenName:B,whenSeries:te,deleteWhenName:ie,deleteWhenSeries:ae,points:fe,newOp:je,setOp:ot,deleteOp:Vt,pane:X},e.polylines[c]=I,e.polylineMap.set(ee,I);const $t=Et(e,X);$t.runtimeDrawOps=$t.runtimeDrawOps||[],$t.runtimeDrawOps.push(je,ot,Vt)}if(I.points.length!==P.length)return St(e,"js_polyline_points_len","error","polyline.new point count must stay consistent for a handle","Reuse the same number of points for the same polyline handle."),{id:I.id,kind:"polyline"};const Y=e.indexRef.value;return I.whenSeries[Y]=(o==null?void 0:o.when)!=null?mi(o.when,"polyline"):1,P.forEach((X,B)=>{const te=I.points[B];te.xSeries[Y]=nt(X.x),te.ySeries[Y]=nt(X.y)}),{id:I.id,kind:"polyline"}},set_points:(y,...c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polylineMap.get(M):void 0;if(!o){St(e,"js_polyline_handle","error","polyline.set_points requires a valid handle returned by polyline.new","Store the handle returned by polyline.new and pass it to set_points.");return}const f=c.length&&vi(c[c.length-1]),P=f?c[c.length-1]:{},I=f?c.slice(0,-1):c,Y=[];if(I.length===1&&Array.isArray(I[0]))I[0].forEach(te=>{Array.isArray(te)&&te.length>=2?Y.push({x:te[0],y:te[1]}):te&&typeof te=="object"&&"x"in te&&"y"in te&&Y.push({x:te.x,y:te.y})});else for(let B=0;B+1<I.length;B+=2)Y.push({x:I[B],y:I[B+1]});if(Y.length!==o.points.length){St(e,"js_polyline_points_len_set","error","polyline.set_points must use the same number of points as polyline.new","Match the original point count used by polyline.new.");return}const X=e.indexRef.value;if(o.whenSeries[X]=(P==null?void 0:P.when)!=null?mi(P.when,"polyline"):1,Y.forEach((B,te)=>{const ie=o.points[te];ie.xSeries[X]=nt(B.x),ie.ySeries[X]=nt(B.y)}),P){const B=(P==null?void 0:P.color)??(P==null?void 0:P.strokeColor)??(P==null?void 0:P.stroke_color),te=fi((P==null?void 0:P.gradient)??(P==null?void 0:P.strokeGradient)??(P==null?void 0:P.stroke_gradient)),ie=(P==null?void 0:P.width)??(P==null?void 0:P.linewidth)??(P==null?void 0:P.lineWidth),ae=(P==null?void 0:P.style)??(P==null?void 0:P.lineStyle)??(P==null?void 0:P.line_style);B!=null&&(o.setOp.color=B),te&&(o.setOp.gradient=te),ie!=null&&(o.setOp.width=ie),ae!=null&&(o.setOp.style=ae),P.opacity!=null&&(o.setOp.opacity=P.opacity);const{glow:fe,glowColor:ee,glowOpacity:ue}=Nn(P);fe!=null&&(o.setOp.glow=fe),ee&&(o.setOp.glowColor=ee),ue!=null&&(o.setOp.glowOpacity=ue)}},delete:(y,c)=>{if(!i())return;const M=typeof y=="string"?y:y&&typeof y=="object"&&"id"in y?String(y.id):"",o=M?e.polylineMap.get(M):void 0;if(!o){St(e,"js_polyline_handle_delete","error","polyline.delete requires a valid handle returned by polyline.new","Store the handle returned by polyline.new and pass it to delete.");return}const f=e.indexRef.value,P=(c==null?void 0:c.when)!=null?mi(c.when,"polyline.delete"):1;o.deleteWhenSeries[f]=P}},he=(y,c)=>{const M=String(y??"").trim();return M?M.replace(/\s+/g,"_").toLowerCase():c},me=y=>{if(!y)return null;const c=ie=>{const ae=typeof ie=="number"?ie:Number(ie);return Number.isFinite(ae)?ae:void 0};if(Array.isArray(y)&&y.length>=2){const ie=c(y[0]),ae=c(y[1]),fe={};return ie!=null&&(fe.index=ie),ae!=null&&(fe.value=ae),Object.keys(fe).length?fe:null}if(!vi(y))return null;const M=y,o={};if("x"in M||"y"in M){const ie=c(M.x),ae=c(M.y);return ie!=null&&(o.index=ie),ae!=null&&(o.value=ae),Object.keys(o).length?o:null}const f=c(M.index),P=c(M.timestamp),I=c(M.value);f!=null&&(o.index=f),P!=null&&(o.timestamp=P),I!=null&&(o.value=I),M.source!=null&&(o.source=String(M.source)),M.pivot!=null&&(o.pivot=String(M.pivot)),M.extreme!=null&&(o.extreme=String(M.extreme));const Y=c(M.left),X=c(M.right),B=c(M.lookback),te=c(M.which);return Y!=null&&(o.left=Y),X!=null&&(o.right=X),B!=null&&(o.lookback=B),te!=null&&(o.which=te),Object.keys(o).length?o:null},_e=y=>{if(!y)return[];if(Array.isArray(y)&&y.length&&typeof y[0]=="number"){const o=[];for(let f=0;f+1<y.length;f+=2){const P=me([y[f],y[f+1]]);P&&o.push(P)}return o}const c=Array.isArray(y)?y:[y],M=[];return c.forEach(o=>{const f=me(o);f&&M.push(f)}),M},we=y=>{if(!y)return null;if(typeof y=="object"&&y.__overlay){const M=String(y.id||"").trim().toLowerCase();return M?e.overlays.get(M)??null:null}const c=String(y||"").trim().toLowerCase();return c?e.overlays.get(c)??null:null},Te={new:(y,c,M)=>{if(!i())return null;const o=e.cursors.overlay++,f=vi(y)?y:{...vi(M)?M:{},name:y,points:c},P=String((f==null?void 0:f.name)||"").trim();if(!P)return St(e,"js_overlay_name","error","overlay.new requires a valid overlay name","Provide a registered overlay name like 'rect' or 'triangle'."),null;const I=he(f==null?void 0:f.id,`js_overlay_${o}`),Y=ri(f==null?void 0:f.pane);let X=_e(f==null?void 0:f.points);if(!X.length)return St(e,"js_overlay_points_min","error","overlay.new requires at least 1 point","Provide points as { index, value } or [index, value] pairs."),null;let B=e.overlays.get(I);if(!B&&e.maxOverlays>0&&e.overlays.size>=e.maxOverlays)return St(e,"js_overlay_limit","warning",`JS guardrail: overlay limit exceeded (max ${e.maxOverlays})`,"Reuse overlay handles or reduce overlay count."),{__overlay:!0,id:I};const ie=(B==null?void 0:B.pointCount)??0,ae=e.maxOverlayPoints>0?e.maxOverlayPoints-(e.overlayPointCount-ie):X.length;e.maxOverlayPoints>0&&X.length>ae&&(St(e,"js_overlay_points_cap","warning",`JS guardrail: overlay points capped (max ${e.maxOverlayPoints})`,"Reduce overlay point count or split overlays."),X=X.slice(0,Math.max(0,ae)));const fe=vi(f==null?void 0:f.styles)?f.styles:void 0,ee=vi(f==null?void 0:f.extendData)?f.extendData:void 0,ue=er(f==null?void 0:f.lock),De=er(f==null?void 0:f.visible);if(B){if(B.pane!==Y){const Ye=Et(e,B.pane).overlays||[],Ae=Ye.findIndex(pt=>(pt==null?void 0:pt.id)===I);Ae>=0&&Ye.splice(Ae,1);const ft=Et(e,Y);ft.overlays=ft.overlays||[],ft.overlays.push(B.spec),B.pane=Y,B.spec.pane=Y}B.spec.name=P,B.spec.points=X,fe!=null&&(B.spec.styles=fe),ee!=null&&(B.spec.extendData=ee),ue!=null&&(B.spec.lock=ue),De!=null&&(B.spec.visible=De),e.overlayPointCount=e.overlayPointCount-ie+X.length,B.pointCount=X.length}else{const Ge=Et(e,Y);Ge.overlays=Ge.overlays||[];const Ye={id:I,name:P,pane:Y,points:X,styles:fe,extendData:ee,lock:ue,visible:De};Ge.overlays.push(Ye),B={id:I,pane:Y,spec:Ye,pointCount:X.length},e.overlays.set(I,B),e.overlayPointCount+=X.length}return{__overlay:!0,id:I}},set:(y,c)=>{if(!y||!c)return;const M=we(y);if(!M){St(e,"js_overlay_handle","error","overlay.set requires a valid handle returned by overlay.new","Store the handle returned by overlay.new and pass it to set.");return}if(!i())return;if(c.name!=null&&(M.spec.name=String(c.name)),c.pane!=null){const P=ri(c.pane);if(P!==M.pane){const Y=Et(e,M.pane).overlays||[],X=Y.findIndex(te=>(te==null?void 0:te.id)===M.id);X>=0&&Y.splice(X,1);const B=Et(e,P);B.overlays=B.overlays||[],B.overlays.push(M.spec),M.pane=P,M.spec.pane=P}}if(c.points!=null){let P=_e(c.points);const I=M.pointCount,Y=e.maxOverlayPoints>0?e.maxOverlayPoints-(e.overlayPointCount-I):P.length;e.maxOverlayPoints>0&&P.length>Y&&(St(e,"js_overlay_points_cap","warning",`JS guardrail: overlay points capped (max ${e.maxOverlayPoints})`,"Reduce overlay point count or split overlays."),P=P.slice(0,Math.max(0,Y))),M.spec.points=P,e.overlayPointCount=e.overlayPointCount-I+P.length,M.pointCount=P.length}c.styles!=null&&vi(c.styles)&&(M.spec.styles=c.styles),c.extendData!=null&&vi(c.extendData)&&(M.spec.extendData=c.extendData);const o=er(c.lock),f=er(c.visible);o!=null&&(M.spec.lock=o),f!=null&&(M.spec.visible=f)},set_points:(y,c)=>{Te.set(y,{points:c})},delete:y=>{const c=we(y);if(!c){St(e,"js_overlay_handle_delete","error","overlay.delete requires a valid handle returned by overlay.new","Store the handle returned by overlay.new and pass it to delete.");return}const o=Et(e,c.pane).overlays||[],f=o.findIndex(P=>(P==null?void 0:P.id)===c.id);f>=0&&o.splice(f,1),e.overlays.delete(c.id),e.overlayPointCount=Math.max(0,e.overlayPointCount-c.pointCount)}},Fe=(y,c)=>{const M=String(y??"").trim();return M?M.replace(/\s+/g,"_").toLowerCase():c},Ne=y=>{if(!y)return null;if(typeof y=="object"&&y.__heatmap){const M=String(y.id||"").trim().toLowerCase();return M?e.heatmaps.get(M)??null:null}const c=String(y||"").trim().toLowerCase();return c?e.heatmaps.get(c)??null:null},ze=()=>i()?e.heatmapPointCount<e.maxHeatmapPoints?!0:(St(e,"js_heatmap_points_cap","warning",`JS guardrail: heatmap point limit exceeded (max ${e.maxHeatmapPoints})`,"Reduce heatmap points or bin inside the script."),!1):!1,Ce={new:y=>{var Y;if(!i())return null;const c=ri(y==null?void 0:y.pane),M=`heatmap_${e.heatmaps.size+1}`,o=Fe((y==null?void 0:y.id)??(y==null?void 0:y.name),M),f=e.heatmaps.get(o);if(f)return{__heatmap:!0,id:f.id};const P={id:o,points:[],xloc:(y==null?void 0:y.xloc)??"bar_index",yloc:(y==null?void 0:y.yloc)??"price",opacity:y==null?void 0:y.opacity,colormap:(y==null?void 0:y.colormap)??(y==null?void 0:y.colors),blend:y==null?void 0:y.blend,xBinPx:(y==null?void 0:y.xBinPx)??(y==null?void 0:y.xBin),yBinPx:(y==null?void 0:y.yBinPx)??(y==null?void 0:y.yBin),minValue:y==null?void 0:y.minValue,maxValue:y==null?void 0:y.maxValue,agg:(y==null?void 0:y.agg)??(y==null?void 0:y.aggregate),layer:y==null?void 0:y.layer,zIndex:(y==null?void 0:y.zIndex)??(y==null?void 0:y.zindex),includeInAutoscale:Li((y==null?void 0:y.includeInAutoscale)??(y==null?void 0:y.include_in_autoscale)??(y==null?void 0:y.autoscale)??c==="sub"),version:0},I={id:o,pane:c,points:[],def:P,version:0};return I.def.points=I.points,e.heatmaps.set(o,I),e.heatmapOrder.push(o),(Y=Et(e,c).runtimeHeatmaps)==null||Y.push(P),{__heatmap:!0,id:o}},set:(y,c)=>{var P;const M=Ne(y);if(!M||!c||!i())return;const o=ri((c==null?void 0:c.pane)??M.pane);if(o!==M.pane){const Y=Et(e,M.pane).runtimeHeatmaps||[],X=Y.findIndex(B=>(B==null?void 0:B.id)===M.id);X>=0&&Y.splice(X,1),(P=Et(e,o).runtimeHeatmaps)==null||P.push(M.def),M.pane=o}c.xloc!=null&&(M.def.xloc=c.xloc),c.yloc!=null&&(M.def.yloc=c.yloc),c.opacity!=null&&(M.def.opacity=c.opacity),(c.colormap!=null||c.colors!=null)&&(M.def.colormap=c.colormap??c.colors),c.blend!=null&&(M.def.blend=c.blend),(c.xBinPx!=null||c.xBin!=null)&&(M.def.xBinPx=c.xBinPx??c.xBin),(c.yBinPx!=null||c.yBin!=null)&&(M.def.yBinPx=c.yBinPx??c.yBin),c.minValue!=null&&(M.def.minValue=c.minValue),c.maxValue!=null&&(M.def.maxValue=c.maxValue),(c.agg!=null||c.aggregate!=null)&&(M.def.agg=c.agg??c.aggregate),c.layer!=null&&(M.def.layer=c.layer),(c.zIndex!=null||c.zindex!=null)&&(M.def.zIndex=c.zIndex??c.zindex);const f=Li((c==null?void 0:c.includeInAutoscale)??(c==null?void 0:c.include_in_autoscale)??(c==null?void 0:c.autoscale));f!=null&&(M.def.includeInAutoscale=f),M.version+=1,M.def.version=M.version},set_grid:(y,c)=>{Ce.set(y,c)},setGrid:(y,c)=>{Ce.set(y,c)},push:(y,c,M,o)=>{if(!ze())return;const f=Ne(y);if(!f){St(e,"js_heatmap_missing_handle","error","heatmap.push requires a valid handle (call heatmap.new first)");return}const P=nt(c),I=nt(M),Y=nt(o);!Number.isFinite(P)||!Number.isFinite(I)||!Number.isFinite(Y)||(f.points.push({x:P,y:I,value:Y}),f.version+=1,f.def.version=f.version,e.heatmapPointCount+=1)},clear:y=>{const c=Ne(y);c&&(e.heatmapPointCount=Math.max(0,e.heatmapPointCount-c.points.length),c.points=[],c.def.points=c.points,c.version+=1,c.def.version=c.version)}};return{plot:r,plotshape:s,plotchar:u,plotcandle:m,plotbar:A,plotohlc:_,hline:D,fill:C,label:v,line:S,box:U,polyline:ne,polygon:V,overlay:Te,heatmap:Ce,table:{new:(y,c,M,o)=>{var Y;if(!i())return null;const f=`js_table_${e.tables.length+1}`,P={id:f,position:y,columns:c,rows:M,bgcolor:(o==null?void 0:o.bgcolor)??(o==null?void 0:o.bgColor),borderColor:(o==null?void 0:o.border_color)??(o==null?void 0:o.borderColor),borderWidth:(o==null?void 0:o.border_width)??(o==null?void 0:o.borderWidth),frameColor:(o==null?void 0:o.frame_color)??(o==null?void 0:o.frameColor),frameWidth:(o==null?void 0:o.frame_width)??(o==null?void 0:o.frameWidth),textColor:(o==null?void 0:o.text_color)??(o==null?void 0:o.textColor),textSize:(o==null?void 0:o.text_size)??(o==null?void 0:o.textSize),textHalign:Tn((o==null?void 0:o.text_halign)??(o==null?void 0:o.textHalign)),textValign:Zn((o==null?void 0:o.text_valign)??(o==null?void 0:o.textValign)),layer:o==null?void 0:o.layer,zIndex:(o==null?void 0:o.zIndex)??(o==null?void 0:o.zindex),includeInAutoscale:Li((o==null?void 0:o.includeInAutoscale)??(o==null?void 0:o.include_in_autoscale)??(o==null?void 0:o.autoscale))},I={id:f,def:P,cells:[]};return e.tables.push(I),(Y=Et(e,ri(o==null?void 0:o.pane)).runtimeTables)==null||Y.push(P),I},cell:(y,c,M,o,f)=>{y&&i()&&((f==null?void 0:f.when)!=null&&mi(f.when,"table.cell")!==1||(y.cells.push({column:c,row:M,text:o!=null?String(o):"",textColor:(f==null?void 0:f.text_color)??(f==null?void 0:f.textColor),bgcolor:(f==null?void 0:f.bgcolor)??(f==null?void 0:f.bgColor),textSize:(f==null?void 0:f.text_size)??(f==null?void 0:f.textSize),textHalign:Tn((f==null?void 0:f.text_halign)??(f==null?void 0:f.textHalign)),textValign:Zn((f==null?void 0:f.text_valign)??(f==null?void 0:f.textValign)),width:f==null?void 0:f.width,height:f==null?void 0:f.height,tooltip:f==null?void 0:f.tooltip}),y.def.cells=y.cells))}}}},ao=(e,t,i)=>{const n=(i==null?void 0:i.emitSignals)!==!1,a=i==null?void 0:i.accessors,r=new Set(["position_size","position_avg_price","open_trades","closed_trades","open_profit","closed_profit","gross_profit","gross_loss","win_trades","loss_trades","win_rate","max_drawdown","max_drawdown_value","max_drawdown_pct","max_runup","max_runup_value","max_runup_pct","avg_trade","avg_win","avg_loss","avg_bars_in_trade","equity","net_profit","net_profit_pct","final_equity","gross_profit","gross_loss","profit_factor","expectancy","payoff_ratio","max_consec_wins","max_consec_losses","exposure_pct","fees_paid","volatility_pct","sharpe","sortino","calmar","trades","wins","losses","round_trips","initial_capital"]),s={net_pnl:"net_profit",net_pnl_pct:"net_profit_pct"};for(const N of r){const g=N.replace(/_/g,"");g!==N&&(s[g]=N)}const u=N=>{const g=String(N||"").trim().replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/\s+/g,"_").toLowerCase();return s[g]??g},h=N=>{const g={};return Object.entries(N).forEach(([j,K])=>{const $=u(j);g[$]=K}),g},m=h((a==null?void 0:a.series)??{}),_=h((a==null?void 0:a.constants)??{}),A=N=>String(N??"").trim(),D=()=>((!e.strategyConfig||typeof e.strategyConfig!="object")&&(e.strategyConfig={enabled:!0}),e.strategyConfig),C=N=>{if(N===1||N==="1")return"long";if(N===-1||N==="-1")return"short";const g=String(N??"").trim().toLowerCase();return g==="long"?"long":g==="short"?"short":null},v=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();if(!g)return null;const j=g.replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop|trailingstop|trailstop/g,"trailing_stop");return j==="market"||j==="limit"||j==="stop"||j==="stop_limit"||j==="mit"||j==="lit"||j==="trailing_stop"?j:null},S=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();return g?g==="gtc"||g==="good_till_cancel"?"gtc":g==="ioc"||g==="immediate_or_cancel"?"ioc":g==="fok"||g==="fill_or_kill"?"fok":null:null},U=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();return g?g==="percent"||g==="pct"||g==="%"?"percent":g==="cash"||g==="fixed"?"cash":g==="per_unit"||g==="perunit"||g==="unit"?"per_unit":null:null},V=N=>{if(N==null)return null;const g=String(N).trim().toLowerCase();return g?g==="percent"||g==="pct"||g==="%"?"percent":g==="abs"||g==="absolute"?"abs":g==="ticks"||g==="tick"?"ticks":null:null},ne=N=>!!N&&typeof N=="object"&&!Array.isArray(N)&&!Mn(N),he=N=>ne(N)?N:{},me=N=>{const g=nt(N);return Number.isFinite(g)?g:NaN},_e=(N,g,j)=>`${N}:${g}${j?`:${j}`:""}`,we=(N,g,j,K)=>{const $=K||_e(N,g);let ve=e.signalMap.get($);if(ve)ve.spec.type=N,g&&(ve.spec.id=g),j&&(ve.spec.orderId=j);else{const se=e.signalCounter++,ge=mt("__js_signal",se,"when"),$e=ht(e,ge,0);ve={key:$,index:se,spec:{type:N,when:ge,id:g||void 0,orderId:j||void 0},when:{name:ge,series:$e},series:{}},e.signalMap.set($,ve),e.signals.push(ve)}return ve},Te=(N,g,j=NaN)=>{if(!N.series[g]){const K=mt("__js_signal",N.index,g);N.series[g]={name:K,series:ht(e,K,j)}}return N.series[g]},Fe=(N,g,j,K=NaN)=>{const $=Te(N,g,K);return $.series[e.indexRef.value]=me(j),$.name},Ne=N=>{if(N==null)return null;const g=typeof N=="number"?N:Number(N);return Number.isFinite(g)?g:null},ze=N=>{const g=Ne(N);if(g!=null)return Math.max(0,Math.min(100,g))},Ce=N=>{const g=Ne(N);if(!(g==null||g<=0))return Math.floor(g)},Ct=N=>{const g=A(N);return g||void 0},y=N=>{const g=ne(N.bracket)&&N.bracket?{...N.bracket}:{},j=Ne(N.stopLossPct??N.stop_loss_pct??N.stopLoss??N.stop_loss??N.slPct??N.sl)??Ne(g.stopLossPct),K=Ne(N.takeProfitPct??N.take_profit_pct??N.takeProfit??N.take_profit??N.tpPct??N.tp)??Ne(g.takeProfitPct),$=Ne(N.trailingStopPct??N.trailing_stop_pct??N.trailingPct??N.trailPct??N.trail_pct??N.trailing)??Ne(g.trailingStopPct),ve=N.takeProfits??N.take_profits??N.takeProfitLevels??g.takeProfits,se=[];if(Array.isArray(ve))for(const $e of ve){if(!$e||typeof $e!="object")continue;const Je=Ne($e.takeProfitPct),k=Ne($e.qtyPct);Je==null||Je<=0||k==null||k<=0||se.push({takeProfitPct:Math.max(0,Je),qtyPct:Math.max(0,Math.min(100,k))})}const ge={...g};if(j!=null&&(ge.stopLossPct=j),K!=null&&(ge.takeProfitPct=K),$!=null&&(ge.trailingStopPct=$),se.length&&(ge.takeProfits=se),!(ge.stopLossPct==null&&ge.takeProfitPct==null&&ge.trailingStopPct==null&&!Array.isArray(ge.takeProfits)))return ge},c=(N,g)=>{g!=null&&(N.spec.scoreExpr=Fe(N,"score",g))},M=(N,g)=>{g!=null&&(N.spec.cooldownExpr=Fe(N,"cooldown",g))},o=(N,g)=>{g.title!=null&&(N.spec.title=String(g.title)),g.message!=null&&(N.spec.message=String(g.message)),g.frequency!=null&&(N.spec.frequency=String(g.frequency));const j=g.score??g.signal_score??g.signalScore,K=g.cooldownBars??g.cooldown_bars??g.cooldown??g.signal_cooldown;c(N,j),M(N,K)},f=(N,g,j,K)=>{const $={},ve=ze(g.qtyPct??g.qty_percent??g.qtyPercent??g.qty_pct);ve!=null&&($.qtyPct=ve);const se=g.qty??g.quantity??j,ge=g.cash??g.cashQty??g.cash_qty,$e=g.commission??g.commissionPct??g.commission_pct,Je=g.commissionType??g.commission_type??g.commissionMode??g.commission_mode,k=g.commissionValue??g.commission_value??g.commissionVal??g.commission_val,R=g.commissionCash??g.commission_cash??g.commissionFixed??g.commission_fixed,w=g.commissionPerUnit??g.commission_per_unit??g.commissionPerShare??g.commission_per_share,O=g.slippage??g.slippagePct??g.slippage_pct,H=g.slippageType??g.slippage_type??g.slippageMode??g.slippage_mode,G=g.slippageValue??g.slippage_value??g.slippageVal??g.slippage_val,W=g.slippageAbs??g.slippage_abs??g.slippagePoints??g.slippage_points,re=g.slippageTicks??g.slippage_ticks??g.slippageTick??g.slippage_tick,oe=K??g.oco??g.oca_name??g.ocaName??g.oca,ce=g.expiresBars??g.expires_bars,J=g.tif??g.timeInForce??g.time_in_force,Ie=g.price,Ue=g.stop??g.stopPrice,et=g.limit??g.limitPrice,Bt=g.trailPct??g.trail_percent??g.trailPercent??g.trailingStopPct??g.trailing_stop_pct,Wt=g.trailOffset??g.trail_offset??g.trailPoints??g.trail_points,li=g.trailPrice??g.trail_price,di=g.kind??g.orderType??g.type,yi=se!=null?Fe(N,"qty",se):null,kt=ge!=null?Fe(N,"cash",ge):null,Jt=$e!=null?Fe(N,"commission",$e):null,Ft=k!=null?Fe(N,"commission_value",k):null,Qt=R!=null?Fe(N,"commission_cash",R):null,xi=w!=null?Fe(N,"commission_per_unit",w):null,Ii=O!=null?Fe(N,"slippage",O):null,Zt=G!=null?Fe(N,"slippage_value",G):null,Fi=W!=null?Fe(N,"slippage_abs",W):null,Ai=re!=null?Fe(N,"slippage_ticks",re):null,nn=Ie!=null?Fe(N,"price",Ie):null,zt=Ue!=null?Fe(N,"stop",Ue):null,ei=et!=null?Fe(N,"limit",et):null,zi=Bt!=null?Fe(N,"trail_pct",Bt):null,Ei=Wt!=null?Fe(N,"trail_offset",Wt):null,mn=li!=null?Fe(N,"trail_price",li):null,ti=v(di),Mi=S(J),pn=U(Je),gn=V(H),Ui=y(g);yi&&($.qty=yi),kt&&($.cash=kt),Jt&&($.commissionPct=Jt),pn&&($.commissionType=pn),Ft&&($.commissionValue=Ft),Qt&&($.commissionCash=Qt),xi&&($.commissionPerUnit=xi),Ii&&($.slippagePct=Ii),gn&&($.slippageType=gn),Zt&&($.slippageValue=Zt),Fi&&($.slippageAbs=Fi),Ai&&($.slippageTicks=Ai),zi&&($.trailPct=zi),Ei&&($.trailOffset=Ei),mn&&($.trailPrice=mn),Mi&&($.tif=Mi);const yn=Ct(oe);yn&&($.oco=yn);const kr=Ce(ce);if(kr!=null&&($.expiresBars=kr),Ui&&($.bracket=Ui),ti){if(ti==="stop_limit"){if(!zt||!ei)throw new Error("strategy order kind stop_limit requires stop + limit");return $.kind="stop_limit",$.stopPrice=zt,$.limitPrice=ei,$}if(ti==="limit"||ti==="lit"){const xn=ei??nn??zt;if(!xn)throw new Error(`strategy order kind ${ti} requires limit/price`);return $.kind=ti,$.price=xn,ei&&($.limitPrice=ei),$}if(ti==="stop"||ti==="mit"){const xn=zt??nn??ei;if(!xn)throw new Error(`strategy order kind ${ti} requires stop/price`);return $.kind=ti,$.price=xn,$}if(ti==="trailing_stop"){if(!zi&&!Ei)throw new Error("strategy order kind trailing_stop requires trailPct or trailOffset");return nn&&($.price=nn),$.kind="trailing_stop",$}return $.kind="market",$}return zt&&ei?($.kind="stop_limit",$.stopPrice=zt,$.limitPrice=ei,$):ei?($.kind="limit",$.price=ei,$):zt?($.kind="stop",$.price=zt,$):nn?($.kind="market",$):Object.keys($).length?{kind:"market",...$}:null},P=(N,g)=>{N.when.series[e.indexRef.value]=mi(g,"strategy.when")},I=(N,g,j,K)=>{const $=me(g),ve=me(j),se=me(K);if(!Number.isFinite($)||!Number.isFinite(ve)||!Number.isFinite(se)){N.when.series[e.indexRef.value]=0;return}const ge=Math.min(ve,se),$e=Math.max(ve,se);N.when.series[e.indexRef.value]=$>=ge&&$<=$e?1:0},Y=N=>{const g=String(N??"").toLowerCase().replace(/\s+/g,"");if(g){if(g.includes("onceperbarclose")||g.includes("perbarclose")||g.includes("barclose"))return"once_per_bar_close";if(g.includes("onceperbar")||g.includes("perbar")||g.includes("all"))return"once_per_bar";if(g.includes("once"))return"once"}},X=N=>String(N??"").trim(),B=(N,g,j)=>{const K=N.id??N.alert_id??N.alertId??N.key??N.name,$=X(K)||X(N.title??g)||X(N.message??j);return $||(St(e,"js_alert_missing_id","warning","alertcondition() is missing id/title; defaulting to 'alert'","Provide opts.id or a title to avoid alert rule collisions."),"alert")},te=(N,g)=>{if(g==null)return;const j=Y(g);if(!j){St(e,`js_alert_freq_invalid:${String(g)}`,"warning",`alert frequency "${g}" is not supported`,"Use once, once_per_bar, or once_per_bar_close.");return}N.spec.frequency=j},ie=(N,g,j,K)=>{if(!n)return;const $=he(K),ve=B($,g,j),se=we("alert",ve),ge=N!==void 0?N:$.when??1;P(se,ge);const $e=$.title??g,Je=$.message??j;$e!=null&&(se.spec.title=String($e)),Je!=null&&(se.spec.message=String(Je));const k=$.frequency??$.freq??$.alert_freq??$.alertFreq??$.alertFrequency;te(se,k),c(se,$.score??$.signal_score??$.signalScore),M(se,$.cooldownBars??$.cooldown_bars??$.cooldown??$.signal_cooldown)},ae=(N,g,j,K)=>{if(N===void 0)throw new Error("alertcondition requires a condition");ie(N,g,j,K)},fe=(N,g,j)=>{if(ne(N)){const K=he(N);ie(K.when??1,K.title,K.message,K);return}if(typeof N=="string"){const K=he(g);ie(K.when??1,K.title,N,K);return}if(typeof g=="string"){ie(N,void 0,g,j);return}ie(N??1,void 0,void 0,g)},ee=a==null?void 0:a.accessors,ue={profit_pct:"profit_percent",pnl:"profit",net_pnl:"net_profit",net_pnl_pct:"net_profit_percent",net_pnl_percent:"net_profit_percent",fee:"fees",max_profit:"max_runup",max_profit_pct:"max_runup_percent",max_profit_percent:"max_runup_percent",max_runup_pct:"max_runup_percent",max_drawdown_pct:"max_drawdown_percent",max_loss:"max_drawdown",max_loss_pct:"max_drawdown_percent",max_loss_percent:"max_drawdown_percent"},De=N=>{const g=u(N);return ue[g]??g},Ge=(N,g)=>{if(N==null)return 0;const j=typeof N=="number"?N:Number(N);if(!Number.isFinite(j)||!Number.isInteger(j)||j<0)throw new Error(`${g} offset must be a non-negative integer`);return j},Ye=N=>{const g=(ee==null?void 0:ee.closedTrades)||[];if(!g.length)return null;const j=m.closed_trades,$=(j&&Number.isFinite(j[e.indexRef.value])?Math.floor(j[e.indexRef.value]):g.length)-1-N;return $<0||$>=g.length?null:g[$]??null},Ae=N=>{const j=((ee==null?void 0:ee.openTradesByBar)||[])[e.indexRef.value]||[];return N<0||N>=j.length?null:j[N]??null},ft=(N,g,j)=>{const K=De(g);if(N==="closedtrades"){const J=Ye(j);if(!J)return 0;const Ie=Number.isFinite(J.entryPrice)&&Number.isFinite(J.qty)&&J.entryPrice>0&&J.qty>0?J.entryPrice*J.qty:NaN,Ue=Number.isFinite(J.netPnl)?J.netPnl:Number.isFinite(J.pnl)?J.pnl-(J.fees??0):NaN,et=Number.isFinite(Ie)&&Ie!==0?Ue/Ie*100:NaN;switch(K){case"entry_price":return J.entryPrice;case"entry_time":return J.entryTimestamp;case"entry_bar_index":return J.entryIndex;case"exit_price":return J.exitPrice;case"exit_time":return J.exitTimestamp;case"exit_bar_index":return J.exitIndex;case"size":return J.qty;case"profit":return Number.isFinite(J.pnl)?J.pnl:0;case"profit_percent":return Number.isFinite(J.pnlPct)?J.pnlPct:0;case"net_profit":return Number.isFinite(Ue)?Ue:0;case"net_profit_percent":return Number.isFinite(et)?et:0;case"fees":return Number.isFinite(J.fees)?J.fees:0;case"entry_fee":return Number.isFinite(J.entryFee)?J.entryFee:0;case"exit_fee":return Number.isFinite(J.exitFee)?J.exitFee:0;case"max_runup":return typeof J.mfePct=="number"&&Number.isFinite(J.mfePct)?J.mfePct/100*J.entryPrice*J.qty:0;case"max_runup_percent":return typeof J.mfePct=="number"&&Number.isFinite(J.mfePct)?J.mfePct:0;case"max_drawdown":return typeof J.maePct=="number"&&Number.isFinite(J.maePct)?J.maePct/100*J.entryPrice*J.qty:0;case"max_drawdown_percent":return typeof J.maePct=="number"&&Number.isFinite(J.maePct)?J.maePct:0;case"is_long":return J.side==="long"?1:0;case"is_short":return J.side==="short"?1:0;case"entry_id":return Tr(String(J.entryOrderId??J.entrySignalId??""));case"exit_id":return Tr(String(J.exitOrderId??J.exitSignalId??""));default:return 0}}const $=Ae(j);if(!$)return 0;const ve=nt(t.close),se=$.entryPrice,ge=$.qty,$e=Number.isFinite(se)&&Number.isFinite(ge)&&se>0&&ge>0?se*ge:NaN,Je=typeof $.entryFee=="number"&&Number.isFinite($.entryFee)?$.entryFee:0,k=Number.isFinite(ve)&&Number.isFinite(se)&&Number.isFinite(ge)?$.side==="long"?(ve-se)*ge:(se-ve)*ge:NaN,R=Number.isFinite($e)&&$e!==0?k/$e*100:NaN,w=Number.isFinite(k)&&Number.isFinite(Je)?k-Je:NaN,O=Number.isFinite($e)&&$e!==0?w/$e*100:NaN,H=$.maxFav,G=$.maxAdv,W=Number.isFinite(se)&&Number.isFinite(ge)&&Number.isFinite(H)?$.side==="long"?(H-se)*ge:(se-H)*ge:NaN,re=Number.isFinite(se)&&se>0&&Number.isFinite(H)?$.side==="long"?(H-se)/se*100:(se-H)/se*100:NaN,oe=Number.isFinite(se)&&Number.isFinite(ge)&&Number.isFinite(G)?$.side==="long"?(G-se)*ge:(se-G)*ge:NaN,ce=Number.isFinite(se)&&se>0&&Number.isFinite(G)?$.side==="long"?(G-se)/se*100:(se-G)/se*100:NaN;switch(K){case"entry_price":return se;case"entry_time":return $.entryTimestamp;case"entry_bar_index":return $.entryIndex;case"size":return ge;case"profit":return Number.isFinite(k)?k:0;case"profit_percent":return Number.isFinite(R)?R:0;case"net_profit":return Number.isFinite(w)?w:0;case"net_profit_percent":return Number.isFinite(O)?O:0;case"fees":return Number.isFinite(Je)?Je:0;case"entry_fee":return Number.isFinite(Je)?Je:0;case"max_runup":return Number.isFinite(W)?W:0;case"max_runup_percent":return Number.isFinite(re)?re:0;case"max_drawdown":return Number.isFinite(oe)?oe:0;case"max_drawdown_percent":return Number.isFinite(ce)?ce:0;case"is_long":return $.side==="long"?1:0;case"is_short":return $.side==="short"?1:0;case"entry_id":return Tr(String($.entryOrderId??$.entrySignalId??""));default:return 0}},pt=N=>new Proxy({},{get:(g,j)=>{var K,$;if(j==="length")return N==="closedtrades"?((K=ee==null?void 0:ee.closedTrades)==null?void 0:K.length)??0:((($=ee==null?void 0:ee.openTradesByBar)==null?void 0:$[e.indexRef.value])??[]).length??0;if(j==="count"||j==="size")return()=>{var se,ge;return N==="closedtrades"?((se=ee==null?void 0:ee.closedTrades)==null?void 0:se.length)??0:(((ge=ee==null?void 0:ee.openTradesByBar)==null?void 0:ge[e.indexRef.value])??[]).length??0};if(j!=="then"&&typeof j=="string")return ve=>{const se=Ge(ve,`strategy.${N}.${j}`);return ft(N,j,se)}}}),qt=pt("closedtrades"),Ut=pt("opentrades"),qe=(N,g)=>new Proxy(g,{get:(j,K)=>K in j?j[K]:N==="closedtrades"?qt[K]:Ut[K]});let Lt=null,wt=null;const at=()=>(Lt||(Lt=qe("closedtrades",jt("closed_trades"))),Lt),Pe=()=>(wt||(wt=qe("opentrades",jt("open_trades"))),wt),jt=N=>{const g=u(N),j=`strategy_${g}`;let K=e.seriesMap[j];K||(K=ht(e,j,NaN));const $=m[g];if($&&$.length===e.len)for(let ve=0;ve<e.len;ve++)K[ve]=$[ve];else if(_[g]!=null){const ve=_[g];for(let se=0;se<e.len;se++)K[se]=ve}return ni(j,K,e.indexRef)},Ke=(N,g,j,K)=>{if(!n)return;const $=A(N);if(!$)throw new Error("strategy.entry requires id");const ve=C(g);if(!ve)throw new Error("strategy.entry requires strategy.long/strategy.short");const se=he(ne(K)?K:j),ge=ne(j)?void 0:j;D();const Je=we(ve==="long"?"entry_long":"entry_short",$);P(Je,se.when??1);const k=f(Je,se,ge);k&&(Je.spec.order=k),o(Je,se)},je=(N,g,j,K)=>{if(!n)return;const $=A(N);if(!$)throw new Error("strategy.order requires id");const ve=C(g);if(!ve)throw new Error("strategy.order requires strategy.long/strategy.short");const se=he(ne(K)?K:j),ge=ne(j)?void 0:j;D();const Je=we(ve==="long"?"entry_long":"entry_short",$,$);P(Je,se.when??1);const k=f(Je,se,ge);k&&(Je.spec.order=k),o(Je,se)},ot=(N,g)=>{if(!n)return;const j=A(N);if(!j)throw new Error("strategy.close requires id");const K=he(g);D();const $=K.side??K.direction??K.dir,se=(C($)??"long")==="long"?"exit_long":"exit_short",ge=we(se,j);P(ge,K.when??1);const $e=f(ge,K);$e&&(ge.spec.order=$e),o(ge,K)},Vt=(N,g)=>{if(!n)return;const j=A(N);if(!j)throw new Error("strategy.exit requires id");const K=he(g);D();const $=K.side??K.direction??K.dir,se=(C($)??"long")==="long"?"exit_long":"exit_short",ge=K.stop??K.stopPrice,$e=K.limit??K.limitPrice,Je=ze(K.qtyPct??K.qty_percent??K.qtyPercent??K.qty_pct),k=j?`${j}__bracket`:void 0;let R=!1;if(ge!=null){const w=we(se,`${j}_STOP`,void 0,_e(se,j,"stop")),O=f(w,{...K,stop:ge,stopPrice:ge,limit:void 0,limitPrice:void 0},void 0,k);O&&(O.kind="stop",O.price==null&&(O.price=Fe(w,"stop",ge)),Je!=null&&(O.qtyPct=Je),k&&(O.oco=k),w.spec.order=O),I(w,ge,t.low,t.high),o(w,K),R=!0}if($e!=null){const w=we(se,`${j}_LIMIT`,void 0,_e(se,j,"limit")),O=f(w,{...K,limit:$e,limitPrice:$e,stop:void 0,stopPrice:void 0},void 0,k);O&&(O.kind="limit",O.price==null&&(O.price=Fe(w,"limit",$e)),Je!=null&&(O.qtyPct=Je),k&&(O.oco=k),w.spec.order=O),I(w,$e,t.low,t.high),o(w,K),R=!0}if(K.when!=null||!ge&&!$e){const w=we(se,j);P(w,K.when??1);const O=f(w,K);O&&((ge!=null||$e!=null)&&Je!=null&&(O.kind="market",O.qtyPct=Je),w.spec.order=O),o(w,K),R=!0}if(!R)throw new Error("strategy.exit requires when or stop/limit options")},$t=(N,g)=>{if(!n)return;const j=A(N);if(!j)throw new Error("strategy.cancel requires id");const K=he(g);D();const $=we("cancel",`cancel_${j}`,j,_e("cancel",j));P($,K.when??1),o($,K)},Nt=N=>{if(!n)return;const g=he(N);D();const j=we("cancel_all","cancel_all");P(j,g.when??1),o(j,g)},Tt=N=>{if(!n)return;const g=he(N);D();const j=g.when??1,K=we("exit_long","close_all_long");P(K,j),K.spec.order={kind:"market",qtyPct:100},o(K,g);const $=we("exit_short","close_all_short");P($,j),$.spec.order={kind:"market",qtyPct:100},o($,g)},gt=(N,g,j)=>{const K=Ne(g);if(K==null)throw new Error(`strategy.risk.${N} requires numeric value`);const $=String(j??"").toLowerCase(),ve=$.includes("cash")||$.includes("currency")||$.includes("fixed")?"cash":$.includes("qty")||$.includes("contract")?"qty":"percent",se=D();if(N==="max_drawdown"||N==="max_drawdown_percent"){ve==="cash"?se.maxDrawdownCash=K:se.maxDrawdownPct=K;return}if(N==="max_position_size"||N==="max_position"||N==="max_position_size_contracts"){ve==="cash"?se.maxPositionCash=K:ve==="qty"?se.maxPositionQty=K:se.maxPositionPct=K;return}if(N==="max_intraday_filled_orders"||N==="max_intraday_orders"){se.maxIntradayFilledOrders=Math.max(0,Math.floor(K));return}if(N==="max_intraday_loss"||N==="max_daily_loss"){ve==="cash"?se.maxIntradayLossCash=K:se.maxIntradayLossPct=K;return}throw new Error(`strategy.risk.${N} is not supported`)},Ze=N=>{if(N===void 0)return e.strategyConfig;if(N===!1)return e.strategyConfig={enabled:!1},e.strategyConfig;if(N===!0)return e.strategyConfig={enabled:!0},e.strategyConfig;if(N&&typeof N=="object"){const g=D();return Object.assign(g,N),g}throw new Error("strategy.config expects an object, true, or false")},Rt=Object.assign(N=>Ze(N),{entry:Ke,order:je,exit:Vt,close:ot,cancel:$t,alert:fe,alertcondition:ae,cancel_all:Nt,close_all:Tt,risk:{max_drawdown:(N,g)=>gt("max_drawdown",N,g),max_drawdown_percent:(N,g)=>gt("max_drawdown_percent",N,g),max_position_size:(N,g)=>gt("max_position_size",N,g),max_position:(N,g)=>gt("max_position",N,g),max_position_size_contracts:(N,g)=>gt("max_position_size_contracts",N,g),max_intraday_filled_orders:N=>gt("max_intraday_filled_orders",N),max_intraday_orders:N=>gt("max_intraday_orders",N),max_intraday_loss:(N,g)=>gt("max_intraday_loss",N,g),max_daily_loss:(N,g)=>gt("max_daily_loss",N,g)},long:"long",short:"short",config:Ze});return new Proxy(Rt,{get:(N,g)=>{if(g!=="then"){if(typeof g=="string"){const j=u(g);if(j==="closed_trades")return e.strategyAccessorsUsed=!0,n&&St(e,"js_strategy_accessor_after_backtest","warning","JS strategy accessors are computed after backtest; use them for plots only.","Move accessors to plot/visuals, not entry/exit logic."),at();if(j==="open_trades")return e.strategyAccessorsUsed=!0,n&&St(e,"js_strategy_accessor_after_backtest","warning","JS strategy accessors are computed after backtest; use them for plots only.","Move accessors to plot/visuals, not entry/exit logic."),Pe();if(r.has(j))return e.strategyAccessorsUsed=!0,n&&St(e,"js_strategy_accessor_after_backtest","warning","JS strategy accessors are computed after backtest; use them for plots only.","Move accessors to plot/visuals, not entry/exit logic."),jt(j)}if(g in N)return N[g];if(typeof g=="string")throw new Error(`strategy.${g} is not available in JS`);return N[g]}}})},oo=e=>{e.plots.forEach(s=>{var m;if(!s||io(s.seriesName))return;const u=String(((m=s.def)==null?void 0:m.name)||s.seriesName);(s.ohlc?!!s.hasOhlcFinite:!!s.hasFinite)||St(e,`js_plot_all_nan:${s.seriesName}`,"warning",`plot "${u}" produced only NaN/undefined values`,"Check inputs, lookback length, or warmup bars.")});const t=Object.values(e.panes).filter(s=>s.plots&&s.plots.length||s.overlays&&s.overlays.length||s.levels&&s.levels.length||s.fills&&s.fills.length||s.runtimeLabels&&s.runtimeLabels.length||s.runtimeLines&&s.runtimeLines.length||s.runtimeBoxes&&s.runtimeBoxes.length||s.runtimeTables&&s.runtimeTables.length||s.runtimeHeatmaps&&s.runtimeHeatmaps.length||s.runtimeDrawOps&&s.runtimeDrawOps.length);let i=e.strategyConfig;const n=e.signals.map(s=>s.spec);if(!i&&n.length&&(i={enabled:!0}),(t.some(s=>(s.runtimeDrawOps||[]).length>0||(s.runtimeHeatmaps||[]).length>0||(s.overlays||[]).length>0)||t.some(s=>s.levels&&s.levels.length||s.fills&&s.fills.length))&&t.forEach(s=>{s.plots&&s.plots.length||(s.plots=s.plots||[],s.plots.push({name:"__js_draw_stub__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:0}))}),!t.length&&n.length){const s=Et(e,"main");s.plots=s.plots||[],s.plots.push({name:"__js_strategy_stub__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:0}),t.push(s)}return{panes:t,seriesMap:e.seriesMap,signals:n.length?n:void 0,strategy:i||void 0}};var lo=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],ks=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],co="-----------------------------------------------------------------------------------------------------------------------------------------------------",Ps="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Or={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},qr="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",uo={5:qr,"5module":qr+" export import",6:qr+" const class extends export import super"},fo=/^in(stanceof)?$/,ho=new RegExp("["+Ps+"]"),mo=new RegExp("["+Ps+co+"]");function Lr(e,t){for(var i=65536,n=0;n<t.length;n+=2){if(i+=t[n],i>e)return!1;if(i+=t[n+1],i>=e)return!0}return!1}function Vi(e,t){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&ho.test(String.fromCharCode(e)):t===!1?!1:Lr(e,ks)}function rn(e,t){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&mo.test(String.fromCharCode(e)):t===!1?!1:Lr(e,ks)||Lr(e,lo)}var ut=function(t,i){i===void 0&&(i={}),this.label=t,this.keyword=i.keyword,this.beforeExpr=!!i.beforeExpr,this.startsExpr=!!i.startsExpr,this.isLoop=!!i.isLoop,this.isAssign=!!i.isAssign,this.prefix=!!i.prefix,this.postfix=!!i.postfix,this.binop=i.binop||null,this.updateContext=null};function ki(e,t){return new ut(e,{beforeExpr:!0,binop:t})}var Pi={beforeExpr:!0},pi={startsExpr:!0},Vr={};function st(e,t){return t===void 0&&(t={}),t.keyword=e,Vr[e]=new ut(e,t)}var d={num:new ut("num",pi),regexp:new ut("regexp",pi),string:new ut("string",pi),name:new ut("name",pi),privateId:new ut("privateId",pi),eof:new ut("eof"),bracketL:new ut("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new ut("]"),braceL:new ut("{",{beforeExpr:!0,startsExpr:!0}),braceR:new ut("}"),parenL:new ut("(",{beforeExpr:!0,startsExpr:!0}),parenR:new ut(")"),comma:new ut(",",Pi),semi:new ut(";",Pi),colon:new ut(":",Pi),dot:new ut("."),question:new ut("?",Pi),questionDot:new ut("?."),arrow:new ut("=>",Pi),template:new ut("template"),invalidTemplate:new ut("invalidTemplate"),ellipsis:new ut("...",Pi),backQuote:new ut("`",pi),dollarBraceL:new ut("${",{beforeExpr:!0,startsExpr:!0}),eq:new ut("=",{beforeExpr:!0,isAssign:!0}),assign:new ut("_=",{beforeExpr:!0,isAssign:!0}),incDec:new ut("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new ut("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:ki("||",1),logicalAND:ki("&&",2),bitwiseOR:ki("|",3),bitwiseXOR:ki("^",4),bitwiseAND:ki("&",5),equality:ki("==/!=/===/!==",6),relational:ki("</>/<=/>=",7),bitShift:ki("<</>>/>>>",8),plusMin:new ut("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:ki("%",10),star:ki("*",10),slash:ki("/",10),starstar:new ut("**",{beforeExpr:!0}),coalesce:ki("??",1),_break:st("break"),_case:st("case",Pi),_catch:st("catch"),_continue:st("continue"),_debugger:st("debugger"),_default:st("default",Pi),_do:st("do",{isLoop:!0,beforeExpr:!0}),_else:st("else",Pi),_finally:st("finally"),_for:st("for",{isLoop:!0}),_function:st("function",pi),_if:st("if"),_return:st("return",Pi),_switch:st("switch"),_throw:st("throw",Pi),_try:st("try"),_var:st("var"),_const:st("const"),_while:st("while",{isLoop:!0}),_with:st("with"),_new:st("new",{beforeExpr:!0,startsExpr:!0}),_this:st("this",pi),_super:st("super",pi),_class:st("class",pi),_extends:st("extends",Pi),_export:st("export"),_import:st("import",pi),_null:st("null",pi),_true:st("true",pi),_false:st("false",pi),_in:st("in",{beforeExpr:!0,binop:7}),_instanceof:st("instanceof",{beforeExpr:!0,binop:7}),_typeof:st("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:st("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:st("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},gi=/\r\n?|\n|\u2028|\u2029/,po=new RegExp(gi.source,"g");function kn(e){return e===10||e===13||e===8232||e===8233}function Ss(e,t,i){i===void 0&&(i=e.length);for(var n=t;n<i;n++){var a=e.charCodeAt(n);if(kn(a))return n<i-1&&a===13&&e.charCodeAt(n+1)===10?n+2:n+1}return-1}var Cs=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,si=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Is=Object.prototype,go=Is.hasOwnProperty,yo=Is.toString,Pn=Object.hasOwn||function(e,t){return go.call(e,t)},Fs=Array.isArray||function(e){return yo.call(e)==="[object Array]"},As=Object.create(null);function sn(e){return As[e]||(As[e]=new RegExp("^(?:"+e.replace(/ /g,"|")+")$"))}function Ji(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}var xo=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Rn=function(t,i){this.line=t,this.column=i};Rn.prototype.offset=function(t){return new Rn(this.line,this.column+t)};var tr=function(t,i,n){this.start=i,this.end=n,t.sourceFile!==null&&(this.source=t.sourceFile)};function Es(e,t){for(var i=1,n=0;;){var a=Ss(e,n,t);if(a<0)return new Rn(i,t-n);++i,n=a}}var $r={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},Ms=!1;function bo(e){var t={};for(var i in $r)t[i]=e&&Pn(e,i)?e[i]:$r[i];if(t.ecmaVersion==="latest"?t.ecmaVersion=1e8:t.ecmaVersion==null?(!Ms&&typeof console=="object"&&console.warn&&(Ms=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),t.ecmaVersion=11):t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),t.allowReserved==null&&(t.allowReserved=t.ecmaVersion<5),(!e||e.allowHashBang==null)&&(t.allowHashBang=t.ecmaVersion>=14),Fs(t.onToken)){var n=t.onToken;t.onToken=function(a){return n.push(a)}}return Fs(t.onComment)&&(t.onComment=_o(t,t.onComment)),t}function _o(e,t){return function(i,n,a,r,s,u){var h={type:i?"Block":"Line",value:n,start:a,end:r};e.locations&&(h.loc=new tr(this,s,u)),e.ranges&&(h.range=[a,r]),t.push(h)}}var On=1,Sn=2,Br=4,Ts=8,Dr=16,Rs=32,ir=64,Os=128,un=256,qn=512,nr=On|Sn|un;function jr(e,t){return Sn|(e?Br:0)|(t?Ts:0)}var rr=0,zr=1,Yi=2,qs=3,Ls=4,Vs=5,Ht=function(t,i,n){this.options=t=bo(t),this.sourceFile=t.sourceFile,this.keywords=sn(uo[t.ecmaVersion>=6?6:t.sourceType==="module"?"5module":5]);var a="";t.allowReserved!==!0&&(a=Or[t.ecmaVersion>=6?6:t.ecmaVersion===5?5:3],t.sourceType==="module"&&(a+=" await")),this.reservedWords=sn(a);var r=(a?a+" ":"")+Or.strict;this.reservedWordsStrict=sn(r),this.reservedWordsStrictBind=sn(r+" "+Or.strictBind),this.input=String(i),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf(`
`,n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(gi).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=d.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=t.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&t.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(On),this.regexpState=null,this.privateNameStack=[]},$i={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};Ht.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},$i.inFunction.get=function(){return(this.currentVarScope().flags&Sn)>0},$i.inGenerator.get=function(){return(this.currentVarScope().flags&Ts)>0},$i.inAsync.get=function(){return(this.currentVarScope().flags&Br)>0},$i.canAwait.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e],i=t.flags;if(i&(un|qn))return!1;if(i&Sn)return(i&Br)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},$i.allowSuper.get=function(){var e=this.currentThisScope(),t=e.flags;return(t&ir)>0||this.options.allowSuperOutsideMethod},$i.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Os)>0},$i.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},$i.allowNewDotTarget.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e],i=t.flags;if(i&(un|qn)||i&Sn&&!(i&Dr))return!0}return!1},$i.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&un)>0},Ht.extend=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];for(var n=this,a=0;a<t.length;a++)n=t[a](n);return n},Ht.parse=function(t,i){return new this(i,t).parse()},Ht.parseExpressionAt=function(t,i,n){var a=new this(n,t,i);return a.nextToken(),a.parseExpression()},Ht.tokenizer=function(t,i){return new this(i,t)},Object.defineProperties(Ht.prototype,$i);var hi=Ht.prototype,vo=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;hi.strictDirective=function(e){if(this.options.ecmaVersion<5)return!1;for(;;){si.lastIndex=e,e+=si.exec(this.input)[0].length;var t=vo.exec(this.input.slice(e));if(!t)return!1;if((t[1]||t[2])==="use strict"){si.lastIndex=e+t[0].length;var i=si.exec(this.input),n=i.index+i[0].length,a=this.input.charAt(n);return a===";"||a==="}"||gi.test(i[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(a)||a==="!"&&this.input.charAt(n+1)==="=")}e+=t[0].length,si.lastIndex=e,e+=si.exec(this.input)[0].length,this.input[e]===";"&&e++}},hi.eat=function(e){return this.type===e?(this.next(),!0):!1},hi.isContextual=function(e){return this.type===d.name&&this.value===e&&!this.containsEsc},hi.eatContextual=function(e){return this.isContextual(e)?(this.next(),!0):!1},hi.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},hi.canInsertSemicolon=function(){return this.type===d.eof||this.type===d.braceR||gi.test(this.input.slice(this.lastTokEnd,this.start))},hi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},hi.semicolon=function(){!this.eat(d.semi)&&!this.insertSemicolon()&&this.unexpected()},hi.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},hi.expect=function(e){this.eat(e)||this.unexpected()},hi.unexpected=function(e){this.raise(e??this.start,"Unexpected token")};var sr=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};hi.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var i=t?e.parenthesizedAssign:e.parenthesizedBind;i>-1&&this.raiseRecoverable(i,t?"Assigning to rvalue":"Parenthesized pattern")}},hi.checkExpressionErrors=function(e,t){if(!e)return!1;var i=e.shorthandAssign,n=e.doubleProto;if(!t)return i>=0||n>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},hi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},hi.isSimpleAssignTarget=function(e){return e.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(e.expression):e.type==="Identifier"||e.type==="MemberExpression"};var be=Ht.prototype;be.parseTopLevel=function(e){var t=Object.create(null);for(e.body||(e.body=[]);this.type!==d.eof;){var i=this.parseStatement(null,!0,t);e.body.push(i)}if(this.inModule)for(var n=0,a=Object.keys(this.undefinedExports);n<a.length;n+=1){var r=a[n];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var Ur={kind:"loop"},wo={kind:"switch"};be.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;si.lastIndex=this.pos;var t=si.exec(this.input),i=this.pos+t[0].length,n=this.input.charCodeAt(i);if(n===91||n===92)return!0;if(e)return!1;if(n===123||n>55295&&n<56320)return!0;if(Vi(n,!0)){for(var a=i+1;rn(n=this.input.charCodeAt(a),!0);)++a;if(n===92||n>55295&&n<56320)return!0;var r=this.input.slice(i,a);if(!fo.test(r))return!0}return!1},be.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;si.lastIndex=this.pos;var e=si.exec(this.input),t=this.pos+e[0].length,i;return!gi.test(this.input.slice(this.pos,t))&&this.input.slice(t,t+8)==="function"&&(t+8===this.input.length||!(rn(i=this.input.charCodeAt(t+8))||i>55295&&i<56320))},be.isUsingKeyword=function(e,t){if(this.options.ecmaVersion<17||!this.isContextual(e?"await":"using"))return!1;si.lastIndex=this.pos;var i=si.exec(this.input),n=this.pos+i[0].length;if(gi.test(this.input.slice(this.pos,n)))return!1;if(e){var a=n+5,r;if(this.input.slice(n,a)!=="using"||a===this.input.length||rn(r=this.input.charCodeAt(a))||r>55295&&r<56320)return!1;si.lastIndex=a;var s=si.exec(this.input);if(s&&gi.test(this.input.slice(a,a+s[0].length)))return!1}if(t){var u=n+2,h;if(this.input.slice(n,u)==="of"&&(u===this.input.length||!rn(h=this.input.charCodeAt(u))&&!(h>55295&&h<56320)))return!1}var m=this.input.charCodeAt(n);return Vi(m,!0)||m===92},be.isAwaitUsing=function(e){return this.isUsingKeyword(!0,e)},be.isUsing=function(e){return this.isUsingKeyword(!1,e)},be.parseStatement=function(e,t,i){var n=this.type,a=this.startNode(),r;switch(this.isLet(e)&&(n=d._var,r="let"),n){case d._break:case d._continue:return this.parseBreakContinueStatement(a,n.keyword);case d._debugger:return this.parseDebuggerStatement(a);case d._do:return this.parseDoStatement(a);case d._for:return this.parseForStatement(a);case d._function:return e&&(this.strict||e!=="if"&&e!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1,!e);case d._class:return e&&this.unexpected(),this.parseClass(a,!0);case d._if:return this.parseIfStatement(a);case d._return:return this.parseReturnStatement(a);case d._switch:return this.parseSwitchStatement(a);case d._throw:return this.parseThrowStatement(a);case d._try:return this.parseTryStatement(a);case d._const:case d._var:return r=r||this.value,e&&r!=="var"&&this.unexpected(),this.parseVarStatement(a,r);case d._while:return this.parseWhileStatement(a);case d._with:return this.parseWithStatement(a);case d.braceL:return this.parseBlock(!0,a);case d.semi:return this.parseEmptyStatement(a);case d._export:case d._import:if(this.options.ecmaVersion>10&&n===d._import){si.lastIndex=this.pos;var s=si.exec(this.input),u=this.pos+s[0].length,h=this.input.charCodeAt(u);if(h===40||h===46)return this.parseExpressionStatement(a,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),n===d._import?this.parseImport(a):this.parseExport(a,i);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(a,!0,!e);var m=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(m)return t&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),m==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(a,!1,m),this.semicolon(),this.finishNode(a,"VariableDeclaration");var _=this.value,A=this.parseExpression();return n===d.name&&A.type==="Identifier"&&this.eat(d.colon)?this.parseLabeledStatement(a,_,A,e):this.parseExpressionStatement(a,A)}},be.parseBreakContinueStatement=function(e,t){var i=t==="break";this.next(),this.eat(d.semi)||this.insertSemicolon()?e.label=null:this.type!==d.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var a=this.labels[n];if((e.label==null||a.name===e.label.name)&&(a.kind!=null&&(i||a.kind==="loop")||e.label&&i))break}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,i?"BreakStatement":"ContinueStatement")},be.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},be.parseDoStatement=function(e){return this.next(),this.labels.push(Ur),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(d._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(d.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},be.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ur),this.enterScope(0),this.expect(d.parenL),this.type===d.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var i=this.isLet();if(this.type===d._var||this.type===d._const||i){var n=this.startNode(),a=i?"let":this.value;return this.next(),this.parseVar(n,!0,a),this.finishNode(n,"VariableDeclaration"),this.parseForAfterInit(e,n,t)}var r=this.isContextual("let"),s=!1,u=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(u){var h=this.startNode();return this.next(),u==="await using"&&this.next(),this.parseVar(h,!0,u),this.finishNode(h,"VariableDeclaration"),this.parseForAfterInit(e,h,t)}var m=this.containsEsc,_=new sr,A=this.start,D=t>-1?this.parseExprSubscripts(_,"await"):this.parseExpression(!0,_);return this.type===d._in||(s=this.options.ecmaVersion>=6&&this.isContextual("of"))?(t>-1?(this.type===d._in&&this.unexpected(t),e.await=!0):s&&this.options.ecmaVersion>=8&&(D.start===A&&!m&&D.type==="Identifier"&&D.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(e.await=!1)),r&&s&&this.raise(D.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(D,!1,_),this.checkLValPattern(D),this.parseForIn(e,D)):(this.checkExpressionErrors(_,!0),t>-1&&this.unexpected(t),this.parseFor(e,D))},be.parseForAfterInit=function(e,t,i){return(this.type===d._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&t.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===d._in?i>-1&&this.unexpected(i):e.await=i>-1),this.parseForIn(e,t)):(i>-1&&this.unexpected(i),this.parseFor(e,t))},be.parseFunctionStatement=function(e,t,i){return this.next(),this.parseFunction(e,Ln|(i?0:Wr),!1,t)},be.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(d._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},be.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(d.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},be.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(d.braceL),this.labels.push(wo),this.enterScope(0);for(var t,i=!1;this.type!==d.braceR;)if(this.type===d._case||this.type===d._default){var n=this.type===d._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,t.test=null),this.expect(d.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},be.parseThrowStatement=function(e){return this.next(),gi.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var No=[];be.parseCatchClauseParam=function(){var e=this.parseBindingAtom(),t=e.type==="Identifier";return this.enterScope(t?Rs:0),this.checkLValPattern(e,t?Ls:Yi),this.expect(d.parenR),e},be.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===d._catch){var t=this.startNode();this.next(),this.eat(d.parenL)?t.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0)),t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(d._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},be.parseVarStatement=function(e,t,i){return this.next(),this.parseVar(e,!1,t,i),this.semicolon(),this.finishNode(e,"VariableDeclaration")},be.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(Ur),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},be.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},be.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},be.parseLabeledStatement=function(e,t,i,n){for(var a=0,r=this.labels;a<r.length;a+=1){var s=r[a];s.name===t&&this.raise(i.start,"Label '"+t+"' is already declared")}for(var u=this.type.isLoop?"loop":this.type===d._switch?"switch":null,h=this.labels.length-1;h>=0;h--){var m=this.labels[h];if(m.statementStart===e.start)m.statementStart=this.start,m.kind=u;else break}return this.labels.push({name:t,kind:u,statementStart:this.start}),e.body=this.parseStatement(n?n.indexOf("label")===-1?n+"label":n:"label"),this.labels.pop(),e.label=i,this.finishNode(e,"LabeledStatement")},be.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},be.parseBlock=function(e,t,i){for(e===void 0&&(e=!0),t===void 0&&(t=this.startNode()),t.body=[],this.expect(d.braceL),e&&this.enterScope(0);this.type!==d.braceR;){var n=this.parseStatement(null);t.body.push(n)}return i&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},be.parseFor=function(e,t){return e.init=t,this.expect(d.semi),e.test=this.type===d.semi?null:this.parseExpression(),this.expect(d.semi),e.update=this.type===d.parenR?null:this.parseExpression(),this.expect(d.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},be.parseForIn=function(e,t){var i=this.type===d._in;return this.next(),t.type==="VariableDeclaration"&&t.declarations[0].init!=null&&(!i||this.options.ecmaVersion<8||this.strict||t.kind!=="var"||t.declarations[0].id.type!=="Identifier")&&this.raise(t.start,(i?"for-in":"for-of")+" loop variable declaration may not have an initializer"),e.left=t,e.right=i?this.parseExpression():this.parseMaybeAssign(),this.expect(d.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,i?"ForInStatement":"ForOfStatement")},be.parseVar=function(e,t,i,n){for(e.declarations=[],e.kind=i;;){var a=this.startNode();if(this.parseVarId(a,i),this.eat(d.eq)?a.init=this.parseMaybeAssign(t):!n&&i==="const"&&!(this.type===d._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!n&&(i==="using"||i==="await using")&&this.options.ecmaVersion>=17&&this.type!==d._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+i+" declaration"):!n&&a.id.type!=="Identifier"&&!(t&&(this.type===d._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):a.init=null,e.declarations.push(this.finishNode(a,"VariableDeclarator")),!this.eat(d.comma))break}return e},be.parseVarId=function(e,t){e.id=t==="using"||t==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(e.id,t==="var"?zr:Yi,!1)};var Ln=1,Wr=2,$s=4;be.parseFunction=function(e,t,i,n,a){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===d.star&&t&Wr&&this.unexpected(),e.generator=this.eat(d.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&Ln&&(e.id=t&$s&&this.type!==d.name?null:this.parseIdent(),e.id&&!(t&Wr)&&this.checkLValSimple(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?zr:Yi:qs));var r=this.yieldPos,s=this.awaitPos,u=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(jr(e.async,e.generator)),t&Ln||(e.id=this.type===d.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,i,!1,a),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=u,this.finishNode(e,t&Ln?"FunctionDeclaration":"FunctionExpression")},be.parseFunctionParams=function(e){this.expect(d.parenL),e.params=this.parseBindingList(d.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},be.parseClass=function(e,t){this.next();var i=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var n=this.enterClassBody(),a=this.startNode(),r=!1;for(a.body=[],this.expect(d.braceL);this.type!==d.braceR;){var s=this.parseClassElement(e.superClass!==null);s&&(a.body.push(s),s.type==="MethodDefinition"&&s.kind==="constructor"?(r&&this.raiseRecoverable(s.start,"Duplicate constructor in the same class"),r=!0):s.key&&s.key.type==="PrivateIdentifier"&&ko(n,s)&&this.raiseRecoverable(s.key.start,"Identifier '#"+s.key.name+"' has already been declared"))}return this.strict=i,this.next(),e.body=this.finishNode(a,"ClassBody"),this.exitClassBody(),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},be.parseClassElement=function(e){if(this.eat(d.semi))return null;var t=this.options.ecmaVersion,i=this.startNode(),n="",a=!1,r=!1,s="method",u=!1;if(this.eatContextual("static")){if(t>=13&&this.eat(d.braceL))return this.parseClassStaticBlock(i),i;this.isClassElementNameStart()||this.type===d.star?u=!0:n="static"}if(i.static=u,!n&&t>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===d.star)&&!this.canInsertSemicolon()?r=!0:n="async"),!n&&(t>=9||!r)&&this.eat(d.star)&&(a=!0),!n&&!r&&!a){var h=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?s=h:n=h)}if(n?(i.computed=!1,i.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),i.key.name=n,this.finishNode(i.key,"Identifier")):this.parseClassElementName(i),t<13||this.type===d.parenL||s!=="method"||a||r){var m=!i.static&&ar(i,"constructor"),_=m&&e;m&&s!=="method"&&this.raise(i.key.start,"Constructor can't have get/set modifier"),i.kind=m?"constructor":s,this.parseClassMethod(i,a,r,_)}else this.parseClassField(i);return i},be.isClassElementNameStart=function(){return this.type===d.name||this.type===d.privateId||this.type===d.num||this.type===d.string||this.type===d.bracketL||this.type.keyword},be.parseClassElementName=function(e){this.type===d.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),e.computed=!1,e.key=this.parsePrivateIdent()):this.parsePropertyName(e)},be.parseClassMethod=function(e,t,i,n){var a=e.key;e.kind==="constructor"?(t&&this.raise(a.start,"Constructor can't be a generator"),i&&this.raise(a.start,"Constructor can't be an async method")):e.static&&ar(e,"prototype")&&this.raise(a.start,"Classes may not have a static property named prototype");var r=e.value=this.parseMethod(t,i,n);return e.kind==="get"&&r.params.length!==0&&this.raiseRecoverable(r.start,"getter should have no params"),e.kind==="set"&&r.params.length!==1&&this.raiseRecoverable(r.start,"setter should have exactly one param"),e.kind==="set"&&r.params[0].type==="RestElement"&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(e,"MethodDefinition")},be.parseClassField=function(e){return ar(e,"constructor")?this.raise(e.key.start,"Classes can't have a field named 'constructor'"):e.static&&ar(e,"prototype")&&this.raise(e.key.start,"Classes can't have a static field named 'prototype'"),this.eat(d.eq)?(this.enterScope(qn|ir),e.value=this.parseMaybeAssign(),this.exitScope()):e.value=null,this.semicolon(),this.finishNode(e,"PropertyDefinition")},be.parseClassStaticBlock=function(e){e.body=[];var t=this.labels;for(this.labels=[],this.enterScope(un|ir);this.type!==d.braceR;){var i=this.parseStatement(null);e.body.push(i)}return this.next(),this.exitScope(),this.labels=t,this.finishNode(e,"StaticBlock")},be.parseClassId=function(e,t){this.type===d.name?(e.id=this.parseIdent(),t&&this.checkLValSimple(e.id,Yi,!1)):(t===!0&&this.unexpected(),e.id=null)},be.parseClassSuper=function(e){e.superClass=this.eat(d._extends)?this.parseExprSubscripts(null,!1):null},be.enterClassBody=function(){var e={declared:Object.create(null),used:[]};return this.privateNameStack.push(e),e.declared},be.exitClassBody=function(){var e=this.privateNameStack.pop(),t=e.declared,i=e.used;if(this.options.checkPrivateFields)for(var n=this.privateNameStack.length,a=n===0?null:this.privateNameStack[n-1],r=0;r<i.length;++r){var s=i[r];Pn(t,s.name)||(a?a.used.push(s):this.raiseRecoverable(s.start,"Private field '#"+s.name+"' must be declared in an enclosing class"))}};function ko(e,t){var i=t.key.name,n=e[i],a="true";return t.type==="MethodDefinition"&&(t.kind==="get"||t.kind==="set")&&(a=(t.static?"s":"i")+t.kind),n==="iget"&&a==="iset"||n==="iset"&&a==="iget"||n==="sget"&&a==="sset"||n==="sset"&&a==="sget"?(e[i]="true",!1):n?!0:(e[i]=a,!1)}function ar(e,t){var i=e.computed,n=e.key;return!i&&(n.type==="Identifier"&&n.name===t||n.type==="Literal"&&n.value===t)}be.parseExportAllDeclaration=function(e,t){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseModuleExportName(),this.checkExport(t,e.exported,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==d.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ExportAllDeclaration")},be.parseExport=function(e,t){if(this.next(),this.eat(d.star))return this.parseExportAllDeclaration(e,t);if(this.eat(d._default))return this.checkExport(t,"default",this.lastTokStart),e.declaration=this.parseExportDefaultDeclaration(),this.finishNode(e,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())e.declaration=this.parseExportDeclaration(e),e.declaration.type==="VariableDeclaration"?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id,e.declaration.id.start),e.specifiers=[],e.source=null,this.options.ecmaVersion>=16&&(e.attributes=[]);else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==d.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause());else{for(var i=0,n=e.specifiers;i<n.length;i+=1){var a=n[i];this.checkUnreserved(a.local),this.checkLocalExport(a.local),a.local.type==="Literal"&&this.raise(a.local.start,"A string literal cannot be used as an exported binding without `from`.")}e.source=null,this.options.ecmaVersion>=16&&(e.attributes=[])}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},be.parseExportDeclaration=function(e){return this.parseStatement(null)},be.parseExportDefaultDeclaration=function(){var e;if(this.type===d._function||(e=this.isAsyncFunction())){var t=this.startNode();return this.next(),e&&this.next(),this.parseFunction(t,Ln|$s,!1,e)}else if(this.type===d._class){var i=this.startNode();return this.parseClass(i,"nullableID")}else{var n=this.parseMaybeAssign();return this.semicolon(),n}},be.checkExport=function(e,t,i){e&&(typeof t!="string"&&(t=t.type==="Identifier"?t.name:t.value),Pn(e,t)&&this.raiseRecoverable(i,"Duplicate export '"+t+"'"),e[t]=!0)},be.checkPatternExport=function(e,t){var i=t.type;if(i==="Identifier")this.checkExport(e,t,t.start);else if(i==="ObjectPattern")for(var n=0,a=t.properties;n<a.length;n+=1){var r=a[n];this.checkPatternExport(e,r)}else if(i==="ArrayPattern")for(var s=0,u=t.elements;s<u.length;s+=1){var h=u[s];h&&this.checkPatternExport(e,h)}else i==="Property"?this.checkPatternExport(e,t.value):i==="AssignmentPattern"?this.checkPatternExport(e,t.left):i==="RestElement"&&this.checkPatternExport(e,t.argument)},be.checkVariableExport=function(e,t){if(e)for(var i=0,n=t;i<n.length;i+=1){var a=n[i];this.checkPatternExport(e,a.id)}},be.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},be.parseExportSpecifier=function(e){var t=this.startNode();return t.local=this.parseModuleExportName(),t.exported=this.eatContextual("as")?this.parseModuleExportName():t.local,this.checkExport(e,t.exported,t.exported.start),this.finishNode(t,"ExportSpecifier")},be.parseExportSpecifiers=function(e){var t=[],i=!0;for(this.expect(d.braceL);!this.eat(d.braceR);){if(i)i=!1;else if(this.expect(d.comma),this.afterTrailingComma(d.braceR))break;t.push(this.parseExportSpecifier(e))}return t},be.parseImport=function(e){return this.next(),this.type===d.string?(e.specifiers=No,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===d.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},be.parseImportSpecifier=function(){var e=this.startNode();return e.imported=this.parseModuleExportName(),this.eatContextual("as")?e.local=this.parseIdent():(this.checkUnreserved(e.imported),e.local=e.imported),this.checkLValSimple(e.local,Yi),this.finishNode(e,"ImportSpecifier")},be.parseImportDefaultSpecifier=function(){var e=this.startNode();return e.local=this.parseIdent(),this.checkLValSimple(e.local,Yi),this.finishNode(e,"ImportDefaultSpecifier")},be.parseImportNamespaceSpecifier=function(){var e=this.startNode();return this.next(),this.expectContextual("as"),e.local=this.parseIdent(),this.checkLValSimple(e.local,Yi),this.finishNode(e,"ImportNamespaceSpecifier")},be.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===d.name&&(e.push(this.parseImportDefaultSpecifier()),!this.eat(d.comma)))return e;if(this.type===d.star)return e.push(this.parseImportNamespaceSpecifier()),e;for(this.expect(d.braceL);!this.eat(d.braceR);){if(t)t=!1;else if(this.expect(d.comma),this.afterTrailingComma(d.braceR))break;e.push(this.parseImportSpecifier())}return e},be.parseWithClause=function(){var e=[];if(!this.eat(d._with))return e;this.expect(d.braceL);for(var t={},i=!0;!this.eat(d.braceR);){if(i)i=!1;else if(this.expect(d.comma),this.afterTrailingComma(d.braceR))break;var n=this.parseImportAttribute(),a=n.key.type==="Identifier"?n.key.name:n.key.value;Pn(t,a)&&this.raiseRecoverable(n.key.start,"Duplicate attribute key '"+a+"'"),t[a]=!0,e.push(n)}return e},be.parseImportAttribute=function(){var e=this.startNode();return e.key=this.type===d.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(d.colon),this.type!==d.string&&this.unexpected(),e.value=this.parseExprAtom(),this.finishNode(e,"ImportAttribute")},be.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===d.string){var e=this.parseLiteral(this.value);return xo.test(e.value)&&this.raise(e.start,"An export name cannot include a lone surrogate."),e}return this.parseIdent(!0)},be.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},be.isDirectiveCandidate=function(e){return this.options.ecmaVersion>=5&&e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&typeof e.expression.value=="string"&&(this.input[e.start]==='"'||this.input[e.start]==="'")};var Si=Ht.prototype;Si.toAssignable=function(e,t,i){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&e.name==="await"&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var n=0,a=e.properties;n<a.length;n+=1){var r=a[n];this.toAssignable(r,t),r.type==="RestElement"&&(r.argument.type==="ArrayPattern"||r.argument.type==="ObjectPattern")&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":e.kind!=="init"&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),e.argument.type==="AssignmentPattern"&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":e.operator!=="="&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,i);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return e},Si.toAssignableList=function(e,t){for(var i=e.length,n=0;n<i;n++){var a=e[n];a&&this.toAssignable(a,t)}if(i){var r=e[i-1];this.options.ecmaVersion===6&&t&&r&&r.type==="RestElement"&&r.argument.type!=="Identifier"&&this.unexpected(r.argument.start)}return e},Si.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},Si.parseRestBinding=function(){var e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==d.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},Si.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case d.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(d.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case d.braceL:return this.parseObj(!0)}return this.parseIdent()},Si.parseBindingList=function(e,t,i,n){for(var a=[],r=!0;!this.eat(e);)if(r?r=!1:this.expect(d.comma),t&&this.type===d.comma)a.push(null);else{if(i&&this.afterTrailingComma(e))break;if(this.type===d.ellipsis){var s=this.parseRestBinding();this.parseBindingListItem(s),a.push(s),this.type===d.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}else a.push(this.parseAssignableListItem(n))}return a},Si.parseAssignableListItem=function(e){var t=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(t),t},Si.parseBindingListItem=function(e){return e},Si.parseMaybeDefault=function(e,t,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(d.eq))return i;var n=this.startNodeAt(e,t);return n.left=i,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},Si.checkLValSimple=function(e,t,i){t===void 0&&(t=rr);var n=t!==rr;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(n?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(t===Yi&&e.name==="let"&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),i&&(Pn(i,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),i[e.name]=!0),t!==Vs&&this.declareName(e.name,t,e.start));break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":n&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ParenthesizedExpression":return n&&this.raiseRecoverable(e.start,"Binding parenthesized expression"),this.checkLValSimple(e.expression,t,i);default:this.raise(e.start,(n?"Binding":"Assigning to")+" rvalue")}},Si.checkLValPattern=function(e,t,i){switch(t===void 0&&(t=rr),e.type){case"ObjectPattern":for(var n=0,a=e.properties;n<a.length;n+=1){var r=a[n];this.checkLValInnerPattern(r,t,i)}break;case"ArrayPattern":for(var s=0,u=e.elements;s<u.length;s+=1){var h=u[s];h&&this.checkLValInnerPattern(h,t,i)}break;default:this.checkLValSimple(e,t,i)}},Si.checkLValInnerPattern=function(e,t,i){switch(t===void 0&&(t=rr),e.type){case"Property":this.checkLValInnerPattern(e.value,t,i);break;case"AssignmentPattern":this.checkLValPattern(e.left,t,i);break;case"RestElement":this.checkLValPattern(e.argument,t,i);break;default:this.checkLValPattern(e,t,i)}};var Ti=function(t,i,n,a,r){this.token=t,this.isExpr=!!i,this.preserveSpace=!!n,this.override=a,this.generator=!!r},Mt={b_stat:new Ti("{",!1),b_expr:new Ti("{",!0),b_tmpl:new Ti("${",!1),p_stat:new Ti("(",!1),p_expr:new Ti("(",!0),q_tmpl:new Ti("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new Ti("function",!1),f_expr:new Ti("function",!0),f_expr_gen:new Ti("function",!0,!1,null,!0),f_gen:new Ti("function",!1,!1,null,!0)},Cn=Ht.prototype;Cn.initialContext=function(){return[Mt.b_stat]},Cn.curContext=function(){return this.context[this.context.length-1]},Cn.braceIsBlock=function(e){var t=this.curContext();return t===Mt.f_expr||t===Mt.f_stat?!0:e===d.colon&&(t===Mt.b_stat||t===Mt.b_expr)?!t.isExpr:e===d._return||e===d.name&&this.exprAllowed?gi.test(this.input.slice(this.lastTokEnd,this.start)):e===d._else||e===d.semi||e===d.eof||e===d.parenR||e===d.arrow?!0:e===d.braceL?t===Mt.b_stat:e===d._var||e===d._const||e===d.name?!1:!this.exprAllowed},Cn.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if(t.token==="function")return t.generator}return!1},Cn.updateContext=function(e){var t,i=this.type;i.keyword&&e===d.dot?this.exprAllowed=!1:(t=i.updateContext)?t.call(this,e):this.exprAllowed=i.beforeExpr},Cn.overrideContext=function(e){this.curContext()!==e&&(this.context[this.context.length-1]=e)},d.parenR.updateContext=d.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var e=this.context.pop();e===Mt.b_stat&&this.curContext().token==="function"&&(e=this.context.pop()),this.exprAllowed=!e.isExpr},d.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?Mt.b_stat:Mt.b_expr),this.exprAllowed=!0},d.dollarBraceL.updateContext=function(){this.context.push(Mt.b_tmpl),this.exprAllowed=!0},d.parenL.updateContext=function(e){var t=e===d._if||e===d._for||e===d._with||e===d._while;this.context.push(t?Mt.p_stat:Mt.p_expr),this.exprAllowed=!0},d.incDec.updateContext=function(){},d._function.updateContext=d._class.updateContext=function(e){e.beforeExpr&&e!==d._else&&!(e===d.semi&&this.curContext()!==Mt.p_stat)&&!(e===d._return&&gi.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===d.colon||e===d.braceL)&&this.curContext()===Mt.b_stat)?this.context.push(Mt.f_expr):this.context.push(Mt.f_stat),this.exprAllowed=!1},d.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0},d.backQuote.updateContext=function(){this.curContext()===Mt.q_tmpl?this.context.pop():this.context.push(Mt.q_tmpl),this.exprAllowed=!1},d.star.updateContext=function(e){if(e===d._function){var t=this.context.length-1;this.context[t]===Mt.f_expr?this.context[t]=Mt.f_expr_gen:this.context[t]=Mt.f_gen}this.exprAllowed=!0},d.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==d.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var Le=Ht.prototype;Le.checkPropClash=function(e,t,i){if(!(this.options.ecmaVersion>=9&&e.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n=e.key,a;switch(n.type){case"Identifier":a=n.name;break;case"Literal":a=String(n.value);break;default:return}var r=e.kind;if(this.options.ecmaVersion>=6){a==="__proto__"&&r==="init"&&(t.proto&&(i?i.doubleProto<0&&(i.doubleProto=n.start):this.raiseRecoverable(n.start,"Redefinition of __proto__ property")),t.proto=!0);return}a="$"+a;var s=t[a];if(s){var u;r==="init"?u=this.strict&&s.init||s.get||s.set:u=s.init||s[r],u&&this.raiseRecoverable(n.start,"Redefinition of property")}else s=t[a]={init:!1,get:!1,set:!1};s[r]=!0}},Le.parseExpression=function(e,t){var i=this.start,n=this.startLoc,a=this.parseMaybeAssign(e,t);if(this.type===d.comma){var r=this.startNodeAt(i,n);for(r.expressions=[a];this.eat(d.comma);)r.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(r,"SequenceExpression")}return a},Le.parseMaybeAssign=function(e,t,i){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var n=!1,a=-1,r=-1,s=-1;t?(a=t.parenthesizedAssign,r=t.trailingComma,s=t.doubleProto,t.parenthesizedAssign=t.trailingComma=-1):(t=new sr,n=!0);var u=this.start,h=this.startLoc;(this.type===d.parenL||this.type===d.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=e==="await");var m=this.parseMaybeConditional(e,t);if(i&&(m=i.call(this,m,u,h)),this.type.isAssign){var _=this.startNodeAt(u,h);return _.operator=this.value,this.type===d.eq&&(m=this.toAssignable(m,!1,t)),n||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=m.start&&(t.shorthandAssign=-1),this.type===d.eq?this.checkLValPattern(m):this.checkLValSimple(m),_.left=m,this.next(),_.right=this.parseMaybeAssign(e),s>-1&&(t.doubleProto=s),this.finishNode(_,"AssignmentExpression")}else n&&this.checkExpressionErrors(t,!0);return a>-1&&(t.parenthesizedAssign=a),r>-1&&(t.trailingComma=r),m},Le.parseMaybeConditional=function(e,t){var i=this.start,n=this.startLoc,a=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return a;if(this.eat(d.question)){var r=this.startNodeAt(i,n);return r.test=a,r.consequent=this.parseMaybeAssign(),this.expect(d.colon),r.alternate=this.parseMaybeAssign(e),this.finishNode(r,"ConditionalExpression")}return a},Le.parseExprOps=function(e,t){var i=this.start,n=this.startLoc,a=this.parseMaybeUnary(t,!1,!1,e);return this.checkExpressionErrors(t)||a.start===i&&a.type==="ArrowFunctionExpression"?a:this.parseExprOp(a,i,n,-1,e)},Le.parseExprOp=function(e,t,i,n,a){var r=this.type.binop;if(r!=null&&(!a||this.type!==d._in)&&r>n){var s=this.type===d.logicalOR||this.type===d.logicalAND,u=this.type===d.coalesce;u&&(r=d.logicalAND.binop);var h=this.value;this.next();var m=this.start,_=this.startLoc,A=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,a),m,_,r,a),D=this.buildBinary(t,i,e,A,h,s||u);return(s&&this.type===d.coalesce||u&&(this.type===d.logicalOR||this.type===d.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(D,t,i,n,a)}return e},Le.buildBinary=function(e,t,i,n,a,r){n.type==="PrivateIdentifier"&&this.raise(n.start,"Private identifier can only be left side of binary expression");var s=this.startNodeAt(e,t);return s.left=i,s.operator=a,s.right=n,this.finishNode(s,r?"LogicalExpression":"BinaryExpression")},Le.parseMaybeUnary=function(e,t,i,n){var a=this.start,r=this.startLoc,s;if(this.isContextual("await")&&this.canAwait)s=this.parseAwait(n),t=!0;else if(this.type.prefix){var u=this.startNode(),h=this.type===d.incDec;u.operator=this.value,u.prefix=!0,this.next(),u.argument=this.parseMaybeUnary(null,!0,h,n),this.checkExpressionErrors(e,!0),h?this.checkLValSimple(u.argument):this.strict&&u.operator==="delete"&&Bs(u.argument)?this.raiseRecoverable(u.start,"Deleting local variable in strict mode"):u.operator==="delete"&&Qr(u.argument)?this.raiseRecoverable(u.start,"Private fields can not be deleted"):t=!0,s=this.finishNode(u,h?"UpdateExpression":"UnaryExpression")}else if(!t&&this.type===d.privateId)(n||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),s=this.parsePrivateIdent(),this.type!==d._in&&this.unexpected();else{if(s=this.parseExprSubscripts(e,n),this.checkExpressionErrors(e))return s;for(;this.type.postfix&&!this.canInsertSemicolon();){var m=this.startNodeAt(a,r);m.operator=this.value,m.prefix=!1,m.argument=s,this.checkLValSimple(s),this.next(),s=this.finishNode(m,"UpdateExpression")}}if(!i&&this.eat(d.starstar))if(t)this.unexpected(this.lastTokStart);else return this.buildBinary(a,r,s,this.parseMaybeUnary(null,!1,!1,n),"**",!1);else return s};function Bs(e){return e.type==="Identifier"||e.type==="ParenthesizedExpression"&&Bs(e.expression)}function Qr(e){return e.type==="MemberExpression"&&e.property.type==="PrivateIdentifier"||e.type==="ChainExpression"&&Qr(e.expression)||e.type==="ParenthesizedExpression"&&Qr(e.expression)}Le.parseExprSubscripts=function(e,t){var i=this.start,n=this.startLoc,a=this.parseExprAtom(e,t);if(a.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return a;var r=this.parseSubscripts(a,i,n,!1,t);return e&&r.type==="MemberExpression"&&(e.parenthesizedAssign>=r.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=r.start&&(e.parenthesizedBind=-1),e.trailingComma>=r.start&&(e.trailingComma=-1)),r},Le.parseSubscripts=function(e,t,i,n,a){for(var r=this.options.ecmaVersion>=8&&e.type==="Identifier"&&e.name==="async"&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,s=!1;;){var u=this.parseSubscript(e,t,i,n,r,s,a);if(u.optional&&(s=!0),u===e||u.type==="ArrowFunctionExpression"){if(s){var h=this.startNodeAt(t,i);h.expression=u,u=this.finishNode(h,"ChainExpression")}return u}e=u}},Le.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(d.arrow)},Le.parseSubscriptAsyncArrow=function(e,t,i,n){return this.parseArrowExpression(this.startNodeAt(e,t),i,!0,n)},Le.parseSubscript=function(e,t,i,n,a,r,s){var u=this.options.ecmaVersion>=11,h=u&&this.eat(d.questionDot);n&&h&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var m=this.eat(d.bracketL);if(m||h&&this.type!==d.parenL&&this.type!==d.backQuote||this.eat(d.dot)){var _=this.startNodeAt(t,i);_.object=e,m?(_.property=this.parseExpression(),this.expect(d.bracketR)):this.type===d.privateId&&e.type!=="Super"?_.property=this.parsePrivateIdent():_.property=this.parseIdent(this.options.allowReserved!=="never"),_.computed=!!m,u&&(_.optional=h),e=this.finishNode(_,"MemberExpression")}else if(!n&&this.eat(d.parenL)){var A=new sr,D=this.yieldPos,C=this.awaitPos,v=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var S=this.parseExprList(d.parenR,this.options.ecmaVersion>=8,!1,A);if(a&&!h&&this.shouldParseAsyncArrow())return this.checkPatternErrors(A,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=D,this.awaitPos=C,this.awaitIdentPos=v,this.parseSubscriptAsyncArrow(t,i,S,s);this.checkExpressionErrors(A,!0),this.yieldPos=D||this.yieldPos,this.awaitPos=C||this.awaitPos,this.awaitIdentPos=v||this.awaitIdentPos;var U=this.startNodeAt(t,i);U.callee=e,U.arguments=S,u&&(U.optional=h),e=this.finishNode(U,"CallExpression")}else if(this.type===d.backQuote){(h||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var V=this.startNodeAt(t,i);V.tag=e,V.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(V,"TaggedTemplateExpression")}return e},Le.parseExprAtom=function(e,t,i){this.type===d.slash&&this.readRegexp();var n,a=this.potentialArrowAt===this.start;switch(this.type){case d._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),n=this.startNode(),this.next(),this.type===d.parenL&&!this.allowDirectSuper&&this.raise(n.start,"super() call outside constructor of a subclass"),this.type!==d.dot&&this.type!==d.bracketL&&this.type!==d.parenL&&this.unexpected(),this.finishNode(n,"Super");case d._this:return n=this.startNode(),this.next(),this.finishNode(n,"ThisExpression");case d.name:var r=this.start,s=this.startLoc,u=this.containsEsc,h=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!u&&h.name==="async"&&!this.canInsertSemicolon()&&this.eat(d._function))return this.overrideContext(Mt.f_expr),this.parseFunction(this.startNodeAt(r,s),0,!1,!0,t);if(a&&!this.canInsertSemicolon()){if(this.eat(d.arrow))return this.parseArrowExpression(this.startNodeAt(r,s),[h],!1,t);if(this.options.ecmaVersion>=8&&h.name==="async"&&this.type===d.name&&!u&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return h=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(d.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,s),[h],!0,t)}return h;case d.regexp:var m=this.value;return n=this.parseLiteral(m.value),n.regex={pattern:m.pattern,flags:m.flags},n;case d.num:case d.string:return this.parseLiteral(this.value);case d._null:case d._true:case d._false:return n=this.startNode(),n.value=this.type===d._null?null:this.type===d._true,n.raw=this.type.keyword,this.next(),this.finishNode(n,"Literal");case d.parenL:var _=this.start,A=this.parseParenAndDistinguishExpression(a,t);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(A)&&(e.parenthesizedAssign=_),e.parenthesizedBind<0&&(e.parenthesizedBind=_)),A;case d.bracketL:return n=this.startNode(),this.next(),n.elements=this.parseExprList(d.bracketR,!0,!0,e),this.finishNode(n,"ArrayExpression");case d.braceL:return this.overrideContext(Mt.b_expr),this.parseObj(!1,e);case d._function:return n=this.startNode(),this.next(),this.parseFunction(n,0);case d._class:return this.parseClass(this.startNode(),!1);case d._new:return this.parseNew();case d.backQuote:return this.parseTemplate();case d._import:return this.options.ecmaVersion>=11?this.parseExprImport(i):this.unexpected();default:return this.parseExprAtomDefault()}},Le.parseExprAtomDefault=function(){this.unexpected()},Le.parseExprImport=function(e){var t=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===d.parenL&&!e)return this.parseDynamicImport(t);if(this.type===d.dot){var i=this.startNodeAt(t.start,t.loc&&t.loc.start);return i.name="import",t.meta=this.finishNode(i,"Identifier"),this.parseImportMeta(t)}else this.unexpected()},Le.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(d.parenR)?e.options=null:(this.expect(d.comma),this.afterTrailingComma(d.parenR)?e.options=null:(e.options=this.parseMaybeAssign(),this.eat(d.parenR)||(this.expect(d.comma),this.afterTrailingComma(d.parenR)||this.unexpected())));else if(!this.eat(d.parenR)){var t=this.start;this.eat(d.comma)&&this.eat(d.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},Le.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="meta"&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},Le.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),t.raw.charCodeAt(t.raw.length-1)===110&&(t.bigint=t.value!=null?t.value.toString():t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},Le.parseParenExpression=function(){this.expect(d.parenL);var e=this.parseExpression();return this.expect(d.parenR),e},Le.shouldParseArrow=function(e){return!this.canInsertSemicolon()},Le.parseParenAndDistinguishExpression=function(e,t){var i=this.start,n=this.startLoc,a,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var s=this.start,u=this.startLoc,h=[],m=!0,_=!1,A=new sr,D=this.yieldPos,C=this.awaitPos,v;for(this.yieldPos=0,this.awaitPos=0;this.type!==d.parenR;)if(m?m=!1:this.expect(d.comma),r&&this.afterTrailingComma(d.parenR,!0)){_=!0;break}else if(this.type===d.ellipsis){v=this.start,h.push(this.parseParenItem(this.parseRestBinding())),this.type===d.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else h.push(this.parseMaybeAssign(!1,A,this.parseParenItem));var S=this.lastTokEnd,U=this.lastTokEndLoc;if(this.expect(d.parenR),e&&this.shouldParseArrow(h)&&this.eat(d.arrow))return this.checkPatternErrors(A,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=D,this.awaitPos=C,this.parseParenArrowList(i,n,h,t);(!h.length||_)&&this.unexpected(this.lastTokStart),v&&this.unexpected(v),this.checkExpressionErrors(A,!0),this.yieldPos=D||this.yieldPos,this.awaitPos=C||this.awaitPos,h.length>1?(a=this.startNodeAt(s,u),a.expressions=h,this.finishNodeAt(a,"SequenceExpression",S,U)):a=h[0]}else a=this.parseParenExpression();if(this.options.preserveParens){var V=this.startNodeAt(i,n);return V.expression=a,this.finishNode(V,"ParenthesizedExpression")}else return a},Le.parseParenItem=function(e){return e},Le.parseParenArrowList=function(e,t,i,n){return this.parseArrowExpression(this.startNodeAt(e,t),i,!1,n)};var Po=[];Le.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===d.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);t.name="new",e.meta=this.finishNode(t,"Identifier"),this.next();var i=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="target"&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),i&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(e.start,"'new.target' can only be used in functions and class static block"),this.finishNode(e,"MetaProperty")}var n=this.start,a=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),n,a,!0,!1),this.eat(d.parenL)?e.arguments=this.parseExprList(d.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Po,this.finishNode(e,"NewExpression")},Le.parseTemplateElement=function(e){var t=e.isTagged,i=this.startNode();return this.type===d.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),i.tail=this.type===d.backQuote,this.finishNode(i,"TemplateElement")},Le.parseTemplate=function(e){e===void 0&&(e={});var t=e.isTagged;t===void 0&&(t=!1);var i=this.startNode();this.next(),i.expressions=[];var n=this.parseTemplateElement({isTagged:t});for(i.quasis=[n];!n.tail;)this.type===d.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(d.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(d.braceR),i.quasis.push(n=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(i,"TemplateLiteral")},Le.isAsyncProp=function(e){return!e.computed&&e.key.type==="Identifier"&&e.key.name==="async"&&(this.type===d.name||this.type===d.num||this.type===d.string||this.type===d.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===d.star)&&!gi.test(this.input.slice(this.lastTokEnd,this.start))},Le.parseObj=function(e,t){var i=this.startNode(),n=!0,a={};for(i.properties=[],this.next();!this.eat(d.braceR);){if(n)n=!1;else if(this.expect(d.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(d.braceR))break;var r=this.parseProperty(e,t);e||this.checkPropClash(r,a,t),i.properties.push(r)}return this.finishNode(i,e?"ObjectPattern":"ObjectExpression")},Le.parseProperty=function(e,t){var i=this.startNode(),n,a,r,s;if(this.options.ecmaVersion>=9&&this.eat(d.ellipsis))return e?(i.argument=this.parseIdent(!1),this.type===d.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(i,"RestElement")):(i.argument=this.parseMaybeAssign(!1,t),this.type===d.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(i,"SpreadElement"));this.options.ecmaVersion>=6&&(i.method=!1,i.shorthand=!1,(e||t)&&(r=this.start,s=this.startLoc),e||(n=this.eat(d.star)));var u=this.containsEsc;return this.parsePropertyName(i),!e&&!u&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(i)?(a=!0,n=this.options.ecmaVersion>=9&&this.eat(d.star),this.parsePropertyName(i)):a=!1,this.parsePropertyValue(i,e,n,a,r,s,t,u),this.finishNode(i,"Property")},Le.parseGetterSetter=function(e){var t=e.key.name;this.parsePropertyName(e),e.value=this.parseMethod(!1),e.kind=t;var i=e.kind==="get"?0:1;if(e.value.params.length!==i){var n=e.value.start;e.kind==="get"?this.raiseRecoverable(n,"getter should have no params"):this.raiseRecoverable(n,"setter should have exactly one param")}else e.kind==="set"&&e.value.params[0].type==="RestElement"&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")},Le.parsePropertyValue=function(e,t,i,n,a,r,s,u){(i||n)&&this.type===d.colon&&this.unexpected(),this.eat(d.colon)?(e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,s),e.kind="init"):this.options.ecmaVersion>=6&&this.type===d.parenL?(t&&this.unexpected(),e.method=!0,e.value=this.parseMethod(i,n),e.kind="init"):!t&&!u&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==="Identifier"&&(e.key.name==="get"||e.key.name==="set")&&this.type!==d.comma&&this.type!==d.braceR&&this.type!==d.eq?((i||n)&&this.unexpected(),this.parseGetterSetter(e)):this.options.ecmaVersion>=6&&!e.computed&&e.key.type==="Identifier"?((i||n)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=a),t?e.value=this.parseMaybeDefault(a,r,this.copyNode(e.key)):this.type===d.eq&&s?(s.shorthandAssign<0&&(s.shorthandAssign=this.start),e.value=this.parseMaybeDefault(a,r,this.copyNode(e.key))):e.value=this.copyNode(e.key),e.kind="init",e.shorthand=!0):this.unexpected()},Le.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(d.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(d.bracketR),e.key;e.computed=!1}return e.key=this.type===d.num||this.type===d.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Le.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},Le.parseMethod=function(e,t,i){var n=this.startNode(),a=this.yieldPos,r=this.awaitPos,s=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(jr(t,n.generator)|ir|(i?Os:0)),this.expect(d.parenL),n.params=this.parseBindingList(d.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0,!1),this.yieldPos=a,this.awaitPos=r,this.awaitIdentPos=s,this.finishNode(n,"FunctionExpression")},Le.parseArrowExpression=function(e,t,i,n){var a=this.yieldPos,r=this.awaitPos,s=this.awaitIdentPos;return this.enterScope(jr(i,!1)|Dr),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!i),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1,n),this.yieldPos=a,this.awaitPos=r,this.awaitIdentPos=s,this.finishNode(e,"ArrowFunctionExpression")},Le.parseFunctionBody=function(e,t,i,n){var a=t&&this.type!==d.braceL,r=this.strict,s=!1;if(a)e.body=this.parseMaybeAssign(n),e.expression=!0,this.checkParams(e,!1);else{var u=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!r||u)&&(s=this.strictDirective(this.end),s&&u&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var h=this.labels;this.labels=[],s&&(this.strict=!0),this.checkParams(e,!r&&!s&&!t&&!i&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLValSimple(e.id,Vs),e.body=this.parseBlock(!1,void 0,s&&!r),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=h}this.exitScope()},Le.isSimpleParamList=function(e){for(var t=0,i=e;t<i.length;t+=1){var n=i[t];if(n.type!=="Identifier")return!1}return!0},Le.checkParams=function(e,t){for(var i=Object.create(null),n=0,a=e.params;n<a.length;n+=1){var r=a[n];this.checkLValInnerPattern(r,zr,t?null:i)}},Le.parseExprList=function(e,t,i,n){for(var a=[],r=!0;!this.eat(e);){if(r)r=!1;else if(this.expect(d.comma),t&&this.afterTrailingComma(e))break;var s=void 0;i&&this.type===d.comma?s=null:this.type===d.ellipsis?(s=this.parseSpread(n),n&&this.type===d.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):s=this.parseMaybeAssign(!1,n),a.push(s)}return a},Le.checkUnreserved=function(e){var t=e.start,i=e.end,n=e.name;if(this.inGenerator&&n==="yield"&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&n==="await"&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&nr)&&n==="arguments"&&this.raiseRecoverable(t,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(n==="arguments"||n==="await")&&this.raise(t,"Cannot use "+n+" in class static initialization block"),this.keywords.test(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),!(this.options.ecmaVersion<6&&this.input.slice(t,i).indexOf("\\")!==-1)){var a=this.strict?this.reservedWordsStrict:this.reservedWords;a.test(n)&&(!this.inAsync&&n==="await"&&this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+n+"' is reserved"))}},Le.parseIdent=function(e){var t=this.parseIdentNode();return this.next(!!e),this.finishNode(t,"Identifier"),e||(this.checkUnreserved(t),t.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t},Le.parseIdentNode=function(){var e=this.startNode();return this.type===d.name?e.name=this.value:this.type.keyword?(e.name=this.type.keyword,(e.name==="class"||e.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=d.name):this.unexpected(),e},Le.parsePrivateIdent=function(){var e=this.startNode();return this.type===d.privateId?e.name=this.value:this.unexpected(),this.next(),this.finishNode(e,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(e.start,"Private field '#"+e.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(e)),e},Le.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===d.semi||this.canInsertSemicolon()||this.type!==d.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(d.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},Le.parseAwait=function(e){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0,!1,e),this.finishNode(t,"AwaitExpression")};var or=Ht.prototype;or.raise=function(e,t){var i=Es(this.input,e);t+=" ("+i.line+":"+i.column+")",this.sourceFile&&(t+=" in "+this.sourceFile);var n=new SyntaxError(t);throw n.pos=e,n.loc=i,n.raisedAt=this.pos,n},or.raiseRecoverable=or.raise,or.curPosition=function(){if(this.options.locations)return new Rn(this.curLine,this.pos-this.lineStart)};var an=Ht.prototype,So=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(e){this.scopeStack.push(new So(e))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(e){return e.flags&Sn||!this.inModule&&e.flags&On},an.declareName=function(e,t,i){var n=!1;if(t===Yi){var a=this.currentScope();n=a.lexical.indexOf(e)>-1||a.functions.indexOf(e)>-1||a.var.indexOf(e)>-1,a.lexical.push(e),this.inModule&&a.flags&On&&delete this.undefinedExports[e]}else if(t===Ls){var r=this.currentScope();r.lexical.push(e)}else if(t===qs){var s=this.currentScope();this.treatFunctionsAsVar?n=s.lexical.indexOf(e)>-1:n=s.lexical.indexOf(e)>-1||s.var.indexOf(e)>-1,s.functions.push(e)}else for(var u=this.scopeStack.length-1;u>=0;--u){var h=this.scopeStack[u];if(h.lexical.indexOf(e)>-1&&!(h.flags&Rs&&h.lexical[0]===e)||!this.treatFunctionsAsVarInScope(h)&&h.functions.indexOf(e)>-1){n=!0;break}if(h.var.push(e),this.inModule&&h.flags&On&&delete this.undefinedExports[e],h.flags&nr)break}n&&this.raiseRecoverable(i,"Identifier '"+e+"' has already been declared")},an.checkLocalExport=function(e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&(nr|qn|un))return t}},an.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&(nr|qn|un)&&!(t.flags&Dr))return t}};var lr=function(t,i,n){this.type="",this.start=i,this.end=0,t.options.locations&&(this.loc=new tr(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[i,0])},Vn=Ht.prototype;Vn.startNode=function(){return new lr(this,this.start,this.startLoc)},Vn.startNodeAt=function(e,t){return new lr(this,e,t)};function Ds(e,t,i,n){return e.type=t,e.end=i,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=i),e}Vn.finishNode=function(e,t){return Ds.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},Vn.finishNodeAt=function(e,t,i,n){return Ds.call(this,e,t,i,n)},Vn.copyNode=function(e){var t=new lr(this,e.start,this.startLoc);for(var i in e)t[i]=e[i];return t};var Co="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",js="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",zs=js+" Extended_Pictographic",Us=zs,Ws=Us+" EBase EComp EMod EPres ExtPict",Qs=Ws,Io=Qs,Fo={9:js,10:zs,11:Us,12:Ws,13:Qs,14:Io},Ao="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",Eo={9:"",10:"",11:"",12:"",13:"",14:Ao},Gs="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ks="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Hs=Ks+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Js=Hs+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ys=Js+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Xs=Ys+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",Mo=Xs+" "+Co,To={9:Ks,10:Hs,11:Js,12:Ys,13:Xs,14:Mo},Zs={};function Ro(e){var t=Zs[e]={binary:sn(Fo[e]+" "+Gs),binaryOfStrings:sn(Eo[e]),nonBinary:{General_Category:sn(Gs),Script:sn(To[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}for(var Gr=0,ea=[9,10,11,12,13,14];Gr<ea.length;Gr+=1){var Oo=ea[Gr];Ro(Oo)}var ye=Ht.prototype,cr=function(t,i){this.parent=t,this.base=i||this};cr.prototype.separatedFrom=function(t){for(var i=this;i;i=i.parent)for(var n=t;n;n=n.parent)if(i.base===n.base&&i!==n)return!0;return!1},cr.prototype.sibling=function(){return new cr(this.parent,this.base)};var Bi=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":"")+(t.options.ecmaVersion>=13?"d":"")+(t.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Zs[t.options.ecmaVersion>=14?14:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};Bi.prototype.reset=function(t,i,n){var a=n.indexOf("v")!==-1,r=n.indexOf("u")!==-1;this.start=t|0,this.source=i+"",this.flags=n,a&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=r&&this.parser.options.ecmaVersion>=9)},Bi.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},Bi.prototype.at=function(t,i){i===void 0&&(i=!1);var n=this.source,a=n.length;if(t>=a)return-1;var r=n.charCodeAt(t);if(!(i||this.switchU)||r<=55295||r>=57344||t+1>=a)return r;var s=n.charCodeAt(t+1);return s>=56320&&s<=57343?(r<<10)+s-56613888:r},Bi.prototype.nextIndex=function(t,i){i===void 0&&(i=!1);var n=this.source,a=n.length;if(t>=a)return a;var r=n.charCodeAt(t),s;return!(i||this.switchU)||r<=55295||r>=57344||t+1>=a||(s=n.charCodeAt(t+1))<56320||s>57343?t+1:t+2},Bi.prototype.current=function(t){return t===void 0&&(t=!1),this.at(this.pos,t)},Bi.prototype.lookahead=function(t){return t===void 0&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},Bi.prototype.advance=function(t){t===void 0&&(t=!1),this.pos=this.nextIndex(this.pos,t)},Bi.prototype.eat=function(t,i){return i===void 0&&(i=!1),this.current(i)===t?(this.advance(i),!0):!1},Bi.prototype.eatChars=function(t,i){i===void 0&&(i=!1);for(var n=this.pos,a=0,r=t;a<r.length;a+=1){var s=r[a],u=this.at(n,i);if(u===-1||u!==s)return!1;n=this.nextIndex(n,i)}return this.pos=n,!0},ye.validateRegExpFlags=function(e){for(var t=e.validFlags,i=e.flags,n=!1,a=!1,r=0;r<i.length;r++){var s=i.charAt(r);t.indexOf(s)===-1&&this.raise(e.start,"Invalid regular expression flag"),i.indexOf(s,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag"),s==="u"&&(n=!0),s==="v"&&(a=!0)}this.options.ecmaVersion>=15&&n&&a&&this.raise(e.start,"Invalid regular expression flag")};function qo(e){for(var t in e)return!0;return!1}ye.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&qo(e.groupNames)&&(e.switchN=!0,this.regexp_pattern(e))},ye.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames=Object.create(null),e.backReferenceNames.length=0,e.branchID=null,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,i=e.backReferenceNames;t<i.length;t+=1){var n=i[t];e.groupNames[n]||e.raise("Invalid named capture referenced")}},ye.regexp_disjunction=function(e){var t=this.options.ecmaVersion>=16;for(t&&(e.branchID=new cr(e.branchID,null)),this.regexp_alternative(e);e.eat(124);)t&&(e.branchID=e.branchID.sibling()),this.regexp_alternative(e);t&&(e.branchID=e.branchID.parent),this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},ye.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},ye.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1},ye.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!i,!0}return e.pos=t,!1},ye.regexp_eatQuantifier=function(e,t){return t===void 0&&(t=!1),this.regexp_eatQuantifierPrefix(e,t)?(e.eat(63),!0):!1},ye.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},ye.regexp_eatBracedQuantifier=function(e,t){var i=e.pos;if(e.eat(123)){var n=0,a=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(a=e.lastIntValue),e.eat(125)))return a!==-1&&a<n&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=i}return!1},ye.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},ye.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},ye.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)){if(this.options.ecmaVersion>=16){var i=this.regexp_eatModifiers(e),n=e.eat(45);if(i||n){for(var a=0;a<i.length;a++){var r=i.charAt(a);i.indexOf(r,a+1)>-1&&e.raise("Duplicate regular expression modifiers")}if(n){var s=this.regexp_eatModifiers(e);!i&&!s&&e.current()===58&&e.raise("Invalid regular expression modifiers");for(var u=0;u<s.length;u++){var h=s.charAt(u);(s.indexOf(h,u+1)>-1||i.indexOf(h)>-1)&&e.raise("Duplicate regular expression modifiers")}}}}if(e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}}e.pos=t}return!1},ye.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},ye.regexp_eatModifiers=function(e){for(var t="",i=0;(i=e.current())!==-1&&Lo(i);)t+=Ji(i),e.advance();return t};function Lo(e){return e===105||e===109||e===115}ye.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},ye.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},ye.regexp_eatSyntaxCharacter=function(e){var t=e.current();return ta(t)?(e.lastIntValue=t,e.advance(),!0):!1};function ta(e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}ye.regexp_eatPatternCharacters=function(e){for(var t=e.pos,i=0;(i=e.current())!==-1&&!ta(i);)e.advance();return e.pos!==t},ye.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return t!==-1&&t!==36&&!(t>=40&&t<=43)&&t!==46&&t!==63&&t!==91&&t!==94&&t!==124?(e.advance(),!0):!1},ye.regexp_groupSpecifier=function(e){if(e.eat(63)){this.regexp_eatGroupName(e)||e.raise("Invalid group");var t=this.options.ecmaVersion>=16,i=e.groupNames[e.lastStringValue];if(i)if(t)for(var n=0,a=i;n<a.length;n+=1){var r=a[n];r.separatedFrom(e.branchID)||e.raise("Duplicate capture group name")}else e.raise("Duplicate capture group name");t?(i||(e.groupNames[e.lastStringValue]=[])).push(e.branchID):e.groupNames[e.lastStringValue]=!0}},ye.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},ye.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Ji(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Ji(e.lastIntValue);return!0}return!1},ye.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,i=this.options.ecmaVersion>=11,n=e.current(i);return e.advance(i),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,i)&&(n=e.lastIntValue),Vo(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)};function Vo(e){return Vi(e,!0)||e===36||e===95}ye.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,i=this.options.ecmaVersion>=11,n=e.current(i);return e.advance(i),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,i)&&(n=e.lastIntValue),$o(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)};function $o(e){return rn(e,!0)||e===36||e===95||e===8204||e===8205}ye.regexp_eatAtomEscape=function(e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},ye.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var i=e.lastIntValue;if(e.switchU)return i>e.maxBackReference&&(e.maxBackReference=i),!0;if(i<=e.numCapturingParens)return!0;e.pos=t}return!1},ye.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},ye.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},ye.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},ye.regexp_eatZero=function(e){return e.current()===48&&!ur(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1},ye.regexp_eatControlEscape=function(e){var t=e.current();return t===116?(e.lastIntValue=9,e.advance(),!0):t===110?(e.lastIntValue=10,e.advance(),!0):t===118?(e.lastIntValue=11,e.advance(),!0):t===102?(e.lastIntValue=12,e.advance(),!0):t===114?(e.lastIntValue=13,e.advance(),!0):!1},ye.regexp_eatControlLetter=function(e){var t=e.current();return ia(t)?(e.lastIntValue=t%32,e.advance(),!0):!1};function ia(e){return e>=65&&e<=90||e>=97&&e<=122}ye.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){t===void 0&&(t=!1);var i=e.pos,n=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(n&&a>=55296&&a<=56319){var r=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=(a-55296)*1024+(s-56320)+65536,!0}e.pos=r,e.lastIntValue=a}return!0}if(n&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&Bo(e.lastIntValue))return!0;n&&e.raise("Invalid unicode escape"),e.pos=i}return!1};function Bo(e){return e>=0&&e<=1114111}ye.regexp_eatIdentityEscape=function(e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;var t=e.current();return t!==99&&(!e.switchN||t!==107)?(e.lastIntValue=t,e.advance(),!0):!1},ye.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();while((t=e.current())>=48&&t<=57);return!0}return!1};var na=0,Xi=1,Ci=2;ye.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(Do(t))return e.lastIntValue=-1,e.advance(),Xi;var i=!1;if(e.switchU&&this.options.ecmaVersion>=9&&((i=t===80)||t===112)){e.lastIntValue=-1,e.advance();var n;if(e.eat(123)&&(n=this.regexp_eatUnicodePropertyValueExpression(e))&&e.eat(125))return i&&n===Ci&&e.raise("Invalid property name"),n;e.raise("Invalid property name")}return na};function Do(e){return e===100||e===68||e===115||e===83||e===119||e===87}ye.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var i=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,i,n),Xi}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var a=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,a)}return na},ye.regexp_validateUnicodePropertyNameAndValue=function(e,t,i){Pn(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(i)||e.raise("Invalid property value")},ye.regexp_validateUnicodePropertyNameOrValue=function(e,t){if(e.unicodeProperties.binary.test(t))return Xi;if(e.switchV&&e.unicodeProperties.binaryOfStrings.test(t))return Ci;e.raise("Invalid property name")},ye.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";ra(t=e.current());)e.lastStringValue+=Ji(t),e.advance();return e.lastStringValue!==""};function ra(e){return ia(e)||e===95}ye.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";jo(t=e.current());)e.lastStringValue+=Ji(t),e.advance();return e.lastStringValue!==""};function jo(e){return ra(e)||ur(e)}ye.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},ye.regexp_eatCharacterClass=function(e){if(e.eat(91)){var t=e.eat(94),i=this.regexp_classContents(e);return e.eat(93)||e.raise("Unterminated character class"),t&&i===Ci&&e.raise("Negated character class may contain strings"),!0}return!1},ye.regexp_classContents=function(e){return e.current()===93?Xi:e.switchV?this.regexp_classSetExpression(e):(this.regexp_nonEmptyClassRanges(e),Xi)},ye.regexp_nonEmptyClassRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var i=e.lastIntValue;e.switchU&&(t===-1||i===-1)&&e.raise("Invalid character class"),t!==-1&&i!==-1&&t>i&&e.raise("Range out of order in character class")}}},ye.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var i=e.current();(i===99||oa(i))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var n=e.current();return n!==93?(e.lastIntValue=n,e.advance(),!0):!1},ye.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},ye.regexp_classSetExpression=function(e){var t=Xi,i;if(!this.regexp_eatClassSetRange(e))if(i=this.regexp_eatClassSetOperand(e)){i===Ci&&(t=Ci);for(var n=e.pos;e.eatChars([38,38]);){if(e.current()!==38&&(i=this.regexp_eatClassSetOperand(e))){i!==Ci&&(t=Xi);continue}e.raise("Invalid character in character class")}if(n!==e.pos)return t;for(;e.eatChars([45,45]);)this.regexp_eatClassSetOperand(e)||e.raise("Invalid character in character class");if(n!==e.pos)return t}else e.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(e)){if(i=this.regexp_eatClassSetOperand(e),!i)return t;i===Ci&&(t=Ci)}},ye.regexp_eatClassSetRange=function(e){var t=e.pos;if(this.regexp_eatClassSetCharacter(e)){var i=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassSetCharacter(e)){var n=e.lastIntValue;return i!==-1&&n!==-1&&i>n&&e.raise("Range out of order in character class"),!0}e.pos=t}return!1},ye.regexp_eatClassSetOperand=function(e){return this.regexp_eatClassSetCharacter(e)?Xi:this.regexp_eatClassStringDisjunction(e)||this.regexp_eatNestedClass(e)},ye.regexp_eatNestedClass=function(e){var t=e.pos;if(e.eat(91)){var i=e.eat(94),n=this.regexp_classContents(e);if(e.eat(93))return i&&n===Ci&&e.raise("Negated character class may contain strings"),n;e.pos=t}if(e.eat(92)){var a=this.regexp_eatCharacterClassEscape(e);if(a)return a;e.pos=t}return null},ye.regexp_eatClassStringDisjunction=function(e){var t=e.pos;if(e.eatChars([92,113])){if(e.eat(123)){var i=this.regexp_classStringDisjunctionContents(e);if(e.eat(125))return i}else e.raise("Invalid escape");e.pos=t}return null},ye.regexp_classStringDisjunctionContents=function(e){for(var t=this.regexp_classString(e);e.eat(124);)this.regexp_classString(e)===Ci&&(t=Ci);return t},ye.regexp_classString=function(e){for(var t=0;this.regexp_eatClassSetCharacter(e);)t++;return t===1?Xi:Ci},ye.regexp_eatClassSetCharacter=function(e){var t=e.pos;if(e.eat(92))return this.regexp_eatCharacterEscape(e)||this.regexp_eatClassSetReservedPunctuator(e)?!0:e.eat(98)?(e.lastIntValue=8,!0):(e.pos=t,!1);var i=e.current();return i<0||i===e.lookahead()&&zo(i)||Uo(i)?!1:(e.advance(),e.lastIntValue=i,!0)};function zo(e){return e===33||e>=35&&e<=38||e>=42&&e<=44||e===46||e>=58&&e<=64||e===94||e===96||e===126}function Uo(e){return e===40||e===41||e===45||e===47||e>=91&&e<=93||e>=123&&e<=125}ye.regexp_eatClassSetReservedPunctuator=function(e){var t=e.current();return Wo(t)?(e.lastIntValue=t,e.advance(),!0):!1};function Wo(e){return e===33||e===35||e===37||e===38||e===44||e===45||e>=58&&e<=62||e===64||e===96||e===126}ye.regexp_eatClassControlLetter=function(e){var t=e.current();return ur(t)||t===95?(e.lastIntValue=t%32,e.advance(),!0):!1},ye.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},ye.regexp_eatDecimalDigits=function(e){var t=e.pos,i=0;for(e.lastIntValue=0;ur(i=e.current());)e.lastIntValue=10*e.lastIntValue+(i-48),e.advance();return e.pos!==t};function ur(e){return e>=48&&e<=57}ye.regexp_eatHexDigits=function(e){var t=e.pos,i=0;for(e.lastIntValue=0;sa(i=e.current());)e.lastIntValue=16*e.lastIntValue+aa(i),e.advance();return e.pos!==t};function sa(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function aa(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}ye.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var i=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=t*64+i*8+e.lastIntValue:e.lastIntValue=t*8+i}else e.lastIntValue=t;return!0}return!1},ye.regexp_eatOctalDigit=function(e){var t=e.current();return oa(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)};function oa(e){return e>=48&&e<=55}ye.regexp_eatFixedHexDigits=function(e,t){var i=e.pos;e.lastIntValue=0;for(var n=0;n<t;++n){var a=e.current();if(!sa(a))return e.pos=i,!1;e.lastIntValue=16*e.lastIntValue+aa(a),e.advance()}return!0};var Kr=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new tr(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},rt=Ht.prototype;rt.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Kr(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},rt.getToken=function(){return this.next(),new Kr(this)},typeof Symbol<"u"&&(rt[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===d.eof,value:t}}}}),rt.nextToken=function(){var e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(d.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())},rt.readToken=function(e){return Vi(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)},rt.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=56320)return e;var t=this.input.charCodeAt(this.pos+1);return t<=56319||t>=57344?e:(e<<10)+t-56613888},rt.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,i=this.input.indexOf("*/",this.pos+=2);if(i===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=i+2,this.options.locations)for(var n=void 0,a=t;(n=Ss(this.input,a,this.pos))>-1;)++this.curLine,a=this.lineStart=n;this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,i),t,this.pos,e,this.curPosition())},rt.skipLineComment=function(e){for(var t=this.pos,i=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!kn(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,i,this.curPosition())},rt.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&Cs.test(String.fromCharCode(e)))++this.pos;else break e}}},rt.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=e,this.value=t,this.updateContext(i)},rt.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&t===46?(this.pos+=3,this.finishToken(d.ellipsis)):(++this.pos,this.finishToken(d.dot))},rt.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(d.assign,2):this.finishOp(d.slash,1)},rt.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),i=1,n=e===42?d.star:d.modulo;return this.options.ecmaVersion>=7&&e===42&&t===42&&(++i,n=d.starstar,t=this.input.charCodeAt(this.pos+2)),t===61?this.finishOp(d.assign,i+1):this.finishOp(n,i)},rt.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(d.assign,3)}return this.finishOp(e===124?d.logicalOR:d.logicalAND,2)}return t===61?this.finishOp(d.assign,2):this.finishOp(e===124?d.bitwiseOR:d.bitwiseAND,1)},rt.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(d.assign,2):this.finishOp(d.bitwiseXOR,1)},rt.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?t===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||gi.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(d.incDec,2):t===61?this.finishOp(d.assign,2):this.finishOp(d.plusMin,1)},rt.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),i=1;return t===e?(i=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+i)===61?this.finishOp(d.assign,i+1):this.finishOp(d.bitShift,i)):t===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(t===61&&(i=2),this.finishOp(d.relational,i))},rt.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(d.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&t===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(d.arrow)):this.finishOp(e===61?d.eq:d.prefix,1)},rt.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(t===46){var i=this.input.charCodeAt(this.pos+2);if(i<48||i>57)return this.finishOp(d.questionDot,2)}if(t===63){if(e>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(d.assign,3)}return this.finishOp(d.coalesce,2)}}return this.finishOp(d.question,1)},rt.readToken_numberSign=function(){var e=this.options.ecmaVersion,t=35;if(e>=13&&(++this.pos,t=this.fullCharCodeAtPos(),Vi(t,!0)||t===92))return this.finishToken(d.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+Ji(t)+"'")},rt.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(d.parenL);case 41:return++this.pos,this.finishToken(d.parenR);case 59:return++this.pos,this.finishToken(d.semi);case 44:return++this.pos,this.finishToken(d.comma);case 91:return++this.pos,this.finishToken(d.bracketL);case 93:return++this.pos,this.finishToken(d.bracketR);case 123:return++this.pos,this.finishToken(d.braceL);case 125:return++this.pos,this.finishToken(d.braceR);case 58:return++this.pos,this.finishToken(d.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(d.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(t===120||t===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(t===111||t===79)return this.readRadixNumber(8);if(t===98||t===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(d.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+Ji(e)+"'")},rt.finishOp=function(e,t){var i=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,i)},rt.readRegexp=function(){for(var e,t,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(gi.test(n)&&this.raise(i,"Unterminated regular expression"),e)e=!1;else{if(n==="[")t=!0;else if(n==="]"&&t)t=!1;else if(n==="/"&&!t)break;e=n==="\\"}++this.pos}var a=this.input.slice(i,this.pos);++this.pos;var r=this.pos,s=this.readWord1();this.containsEsc&&this.unexpected(r);var u=this.regexpState||(this.regexpState=new Bi(this));u.reset(i,a,s),this.validateRegExpFlags(u),this.validateRegExpPattern(u);var h=null;try{h=new RegExp(a,s)}catch{}return this.finishToken(d.regexp,{pattern:a,flags:s,value:h})},rt.readInt=function(e,t,i){for(var n=this.options.ecmaVersion>=12&&t===void 0,a=i&&this.input.charCodeAt(this.pos)===48,r=this.pos,s=0,u=0,h=0,m=t??1/0;h<m;++h,++this.pos){var _=this.input.charCodeAt(this.pos),A=void 0;if(n&&_===95){a&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),u===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),h===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),u=_;continue}if(_>=97?A=_-97+10:_>=65?A=_-65+10:_>=48&&_<=57?A=_-48:A=1/0,A>=e)break;u=_,s=s*e+A}return n&&u===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||t!=null&&this.pos-r!==t?null:s};function Qo(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function la(e){return typeof BigInt!="function"?null:BigInt(e.replace(/_/g,""))}rt.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var i=this.readInt(e);return i==null&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(i=la(this.input.slice(t,this.pos)),++this.pos):Vi(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(d.num,i)},rt.readNumber=function(e){var t=this.pos;!e&&this.readInt(10,void 0,!0)===null&&this.raise(t,"Invalid number");var i=this.pos-t>=2&&this.input.charCodeAt(t)===48;i&&this.strict&&this.raise(t,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!i&&!e&&this.options.ecmaVersion>=11&&n===110){var a=la(this.input.slice(t,this.pos));return++this.pos,Vi(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(d.num,a)}i&&/[89]/.test(this.input.slice(t,this.pos))&&(i=!1),n===46&&!i&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(n===69||n===101)&&!i&&(n=this.input.charCodeAt(++this.pos),(n===43||n===45)&&++this.pos,this.readInt(10)===null&&this.raise(t,"Invalid number")),Vi(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=Qo(this.input.slice(t,this.pos),i);return this.finishToken(d.num,r)},rt.readCodePoint=function(){var e=this.input.charCodeAt(this.pos),t;if(e===123){this.options.ecmaVersion<6&&this.unexpected();var i=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(i,"Code point out of bounds")}else t=this.readHexChar(4);return t},rt.readString=function(e){for(var t="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;n===92?(t+=this.input.slice(i,this.pos),t+=this.readEscapedChar(!1),i=this.pos):n===8232||n===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(kn(n)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(i,this.pos++),this.finishToken(d.string,t)};var ca={};rt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===ca)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1},rt.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ca;this.raise(e,t)},rt.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(i===96||i===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===d.template||this.type===d.invalidTemplate)?i===36?(this.pos+=2,this.finishToken(d.dollarBraceL)):(++this.pos,this.finishToken(d.backQuote)):(e+=this.input.slice(t,this.pos),this.finishToken(d.template,e));if(i===92)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(kn(i)){switch(e+=this.input.slice(t,this.pos),++this.pos,i){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`
`;break;default:e+=String.fromCharCode(i);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},rt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(d.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")},rt.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ji(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),e){var i=this.pos-1;this.invalidStringToken(i,"Invalid escape sequence in template string")}default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],a=parseInt(n,8);return a>255&&(n=n.slice(0,-1),a=parseInt(n,8)),this.pos+=n.length-1,t=this.input.charCodeAt(this.pos),(n!=="0"||t===56||t===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-n.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(a)}return kn(t)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(t)}},rt.readHexChar=function(e){var t=this.pos,i=this.readInt(16,e);return i===null&&this.invalidStringToken(t,"Bad character escape sequence"),i},rt.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,i=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var a=this.fullCharCodeAtPos();if(rn(a,n))this.pos+=a<=65535?1:2;else if(a===92){this.containsEsc=!0,e+=this.input.slice(i,this.pos);var r=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var s=this.readCodePoint();(t?Vi:rn)(s,n)||this.invalidStringToken(r,"Invalid Unicode escape"),e+=Ji(s),i=this.pos}else break;t=!1}return e+this.input.slice(i,this.pos)},rt.readWord=function(){var e=this.readWord1(),t=d.name;return this.keywords.test(e)&&(t=Vr[e]),this.finishToken(t,e)};var Go="8.15.0";Ht.acorn={Parser:Ht,version:Go,defaultOptions:$r,Position:Rn,SourceLocation:tr,getLineInfo:Es,Node:lr,TokenType:ut,tokTypes:d,keywordTypes:Vr,TokContext:Ti,tokContexts:Mt,isIdentifierChar:rn,isIdentifierStart:Vi,Token:Kr,isNewLine:kn,lineBreak:gi,lineBreakG:po,nonASCIIwhitespace:Cs};function Ko(e,t){return Ht.parse(e,t)}const ua=e=>e?` (line ${e.line}, col ${e.column+1})`:"",Zi=(e,t)=>{var n;const i=(n=t==null?void 0:t.loc)==null?void 0:n.start;throw new Error(`${e}${ua(i)}`)},Ho=e=>e.replace(/^\s*export\s+(function|const|let|var)\s+/gm,"$1 "),Hr=(e,t)=>{if(!(!e||typeof e.type!="string")){t(e);for(const i of Object.keys(e)){if(i==="loc"||i==="start"||i==="end")continue;const n=e[i];Array.isArray(n)?n.forEach(a=>{a&&typeof a.type=="string"&&Hr(a,t)}):n&&typeof n.type=="string"&&Hr(n,t)}}},$n=(e,t)=>!!e&&e.type==="Identifier"&&e.name===t,Jo=(e,t,i)=>!!e&&e.type==="MemberExpression"&&!e.computed&&$n(e.object,t)&&$n(e.property,i),Yo=(e,t,i)=>{if(t.type==="BlockStatement"){i.push({kind:"insert",pos:t.start+1,text:"__guard();"});return}const n=e.slice(t.start,t.end);i.push({kind:"replace",start:t.start,end:t.end,text:`{__guard();${n}}`})},Xo=(e,t,i)=>{const n=t.body;if(!n)return;if(n.type==="BlockStatement"){i.push({kind:"insert",pos:n.start+1,text:"__guardCall();try{"}),i.push({kind:"insert",pos:n.end-1,text:"}finally{__guardExit();}"});return}const a=e.slice(n.start,n.end);i.push({kind:"replace",start:n.start,end:n.end,text:`{__guardCall();try{return ${a};}finally{__guardExit();}}`})},Zo=(e,t)=>{const i=[...t].sort((a,r)=>{const s=a.kind==="insert"?a.pos:a.start;return(r.kind==="insert"?r.pos:r.start)-s});let n=e;return i.forEach(a=>{a.kind==="insert"?n=n.slice(0,a.pos)+a.text+n.slice(a.pos):n=n.slice(0,a.start)+a.text+n.slice(a.end)}),n},el=e=>{const t=String(e||"");let i;try{i=Ko(t,{ecmaVersion:"latest",sourceType:"module",allowAwaitOutsideFunction:!0,locations:!0,ranges:!0})}catch(r){const s=r,u=s==null?void 0:s.loc,h=s!=null&&s.message?String(s.message):"JS parse error";throw new Error(`${h}${ua(u)}`)}const n=[];Hr(i,r=>{if((r.type==="ImportDeclaration"||r.type==="ImportExpression")&&Zi("JS sandbox: imports are not supported",r),r.type==="ExportAllDeclaration"&&Zi("JS sandbox: export * is not supported",r),r.type==="ExportDefaultDeclaration"&&Zi("JS sandbox: export default is not supported",r),r.type==="ExportNamedDeclaration"&&(r.source&&Zi("JS sandbox: re-exports are not supported",r),r.declaration||Zi("JS sandbox: export lists are not supported",r)),r.type==="CallExpression"){const s=r.callee;$n(s,"eval")&&Zi("JS guardrails: eval() is not allowed",r),$n(s,"require")&&Zi("JS sandbox: require() is not supported",r),Jo(s,"Date","now")&&Zi("JS guardrails: Date.now() is not allowed",r)}if(r.type==="NewExpression"){const s=r.callee;$n(s,"Function")&&Zi("JS guardrails: Function constructor is not allowed",r)}(r.type==="ForStatement"||r.type==="WhileStatement"||r.type==="DoWhileStatement"||r.type==="ForInStatement"||r.type==="ForOfStatement")&&Yo(t,r.body,n),(r.type==="FunctionDeclaration"||r.type==="FunctionExpression"||r.type==="ArrowFunctionExpression")&&Xo(t,r,n)});const a=Zo(t,n);return Ho(a)};function ai(e,t){const i=[];let n=0;for(let a=0;a<e.length;a++){const r=e[a];n+=r??0,a>=t&&(n-=e[a-t]??0),i.push(a>=t-1?n/t:void 0)}return i}function fr(e,t){const i=[],n=t*(t+1)/2;for(let a=0;a<e.length;a++){if(a<t-1){i.push(void 0);continue}let r=0;for(let s=0;s<t;s++)r+=(e[a-s]??0)*(t-s);i.push(r/n)}return i}function Bn(e,t){const i=[];let n,a=0;for(let r=0;r<e.length;r++){const s=e[r];if(s==null){i.push(void 0);continue}if(n===void 0){if(a+=s,r<t-1){i.push(void 0);continue}n=a/t,i.push(n);continue}n=(n*(t-1)+s)/t,i.push(n)}return i}function It(e,t){const i=[],n=2/(t+1);let a;for(let r=0;r<e.length;r++){const s=e[r];if(s==null){i.push(void 0);continue}a=a===void 0?s:s*n+a*(1-n),i.push(a)}return i}function fa(e,t){const i=[];let n,a=0,r=0,s=!1;const u=[],h=[];for(let m=0;m<e.length;m++){const _=e[m];if(_==null){i.push(void 0);continue}if(n===void 0){n=_,i.push(void 0);continue}const A=_-n;n=_;const D=A>0?A:0,C=A<0?-A:0;if(s)a=(a*(t-1)+D)/t,r=(r*(t-1)+C)/t;else{if(u.push(D),h.push(C),u.length<t){i.push(void 0);continue}a=u.reduce((v,S)=>v+S,0)/t,r=h.reduce((v,S)=>v+S,0)/t,s=!0}if(r===0)i.push(100);else{const v=a/r;i.push(100-100/(1+v))}}return i}function Dn(e,t,i,n){const a=i.length,r=new Array(a).fill(0);let s;for(let m=0;m<a;m++){const _=e[m]??i[m]??NaN,A=t[m]??i[m]??NaN,D=i[m]??NaN;let C=Math.max(0,_-A);s!==void 0&&(C=Math.max(C,Math.abs(_-s),Math.abs(A-s))),r[m]=C,s=D}const u=new Array(a);let h=0;for(let m=0;m<a;m++)h+=r[m],m===n-1?u[m]=h/n:m>=n?u[m]=(u[m-1]*(n-1)+r[m])/n:u[m]=void 0;return u}function tl(e,t){const i=new Array(e.length);let n=0,a;for(let r=0;r<e.length;r++){const s=e[r],u=t[r]??0;if(a===void 0||s===void 0){i[r]=void 0,a=s;continue}s>a?n+=u:s<a&&(n-=u),i[r]=n,a=s}return i}function il(e,t,i,n){const a=i.length,r=new Array(a);for(let h=0;h<a;h++)r[h]=((e[h]??i[h]??0)+(t[h]??i[h]??0)+(i[h]??0))/3;const s=ai(r.map(h=>h),n).map(h=>h),u=new Array(a);for(let h=0;h<a;h++){if(h<n-1){u[h]=void 0;continue}let m=0;for(let A=h-n+1;A<=h;A++)m+=Math.abs(r[A]-s[h]);m=m/n;const _=.015*m;u[h]=_===0?void 0:(r[h]-s[h])/_}return u}function nl(e,t,i,n,a){const r=i.length,s=new Array(r),u=new Array(r);for(let m=0;m<r;m++)u[m]=((e[m]??i[m]??0)+(t[m]??i[m]??0)+(i[m]??0))/3;const h=new Array(r);for(let m=0;m<r;m++)h[m]=u[m]*(n[m]??0);for(let m=0;m<r;m++){if(m<a){s[m]=void 0;continue}let _=0,A=0;for(let C=m-a+1;C<=m;C++)u[C]>=u[C-1]?_+=h[C]:A+=h[C];const D=A===0?1/0:_/A;s[m]=100-100/(1+D)}return s}function rl(e,t){const i=e.map((s,u)=>((s??0)+(t[u]??0))/2),n=ai(i,5),a=ai(i,34),r=new Array(i.length);for(let s=0;s<i.length;s++){const u=n[s],h=a[s];r[s]=u===void 0||h===void 0?void 0:u-h}return r}function sl(e,t){const i=It(e,t).map(s=>s??NaN),n=It(i,t).map(s=>s??NaN),a=It(n,t).map(s=>s??NaN),r=new Array(e.length);for(let s=1;s<e.length;s++){const u=a[s-1],h=a[s];r[s]=u===void 0||h===void 0||u===0?void 0:(h/u-1)*100}return r[0]=void 0,r}function al(e,t){const i=new Array(e.length);let n=0,a=0;for(let r=0;r<e.length;r++){const s=e[r],u=t[r]??0;if(s===void 0){i[r]=void 0;continue}n+=s*u,a+=u,i[r]=a===0?void 0:n/a}return i}function ol(e,t,i){const n=new Array(e.length);let a=0,r=0;for(let s=0;s<e.length;s++){const u=e[s],h=t[s]??0;if(u!==void 0&&(a+=u*h,r+=h),s>=i){const m=e[s-i],_=t[s-i]??0;m!==void 0&&(a-=m*_,r-=_)}n[s]=s>=i-1&&r!==0?a/r:void 0}return n}function ha(e,t,i){const n=e.map(h=>h??NaN),a=ai(n,t),r=[];for(let h=0;h<n.length;h++){if(h<t-1){r.push(void 0);continue}let m=0;for(let D=h-t+1;D<=h;D++)m+=n[D];const _=m/t;let A=0;for(let D=h-t+1;D<=h;D++){const C=n[D]-_;A+=C*C}r.push(Math.sqrt(A/t))}const s=new Array(n.length),u=new Array(n.length);for(let h=0;h<n.length;h++){const m=a[h],_=r[h];s[h]=m===void 0||_===void 0?void 0:m+i*_,u[h]=m===void 0||_===void 0?void 0:m-i*_}return{mid:a,upper:s,lower:u}}function ll(e,t,i,n,a){const r=i.length,s=Dn(e,t,i,n).map(C=>C??NaN),u=new Array(r),h=new Array(r);for(let C=0;C<r;C++){const v=((e[C]??i[C]??0)+(t[C]??i[C]??0))/2,S=s[C];u[C]=v+a*S,h[C]=v-a*S}const m=new Array(r);let _=NaN,A=NaN,D=!0;for(let C=0;C<r;C++){_=Number.isFinite(_)?Math.min(u[C],_):u[C],A=Number.isFinite(A)?Math.max(h[C],A):h[C];const v=i[C]??NaN;if(!Number.isFinite(v)){m[C]=void 0;continue}D?(v<A&&(D=!1,_=u[C]),m[C]=A):(v>_&&(D=!0,A=h[C]),m[C]=_)}return m}function cl(e,t,i,n,a){const r=It(i,n).map(_=>_??NaN),s=Dn(e,t,i,n).map(_=>_??NaN),u=i.length,h=new Array(u),m=new Array(u);for(let _=0;_<u;_++){const A=r[_],D=s[_];h[_]=Number.isFinite(A)&&Number.isFinite(D)?A+a*D:void 0,m[_]=Number.isFinite(A)&&Number.isFinite(D)?A-a*D:void 0}return{mid:r,upper:h,lower:m}}function ul(e,t){const i=e.length,n=new Array(i);for(let a=0;a<i;a++){if(a<t-1){n[a]=void 0;continue}let r=0;for(let _=a-t+1;_<=a;_++)r+=e[_]??0;const s=r/t;let u=0;for(let _=a-t+1;_<=a;_++){const A=(e[_]??0)-s;u+=A*A}const h=Math.sqrt(u/t),m=e[a]??NaN;n[a]=Number.isFinite(h)&&h!==0?(m-s)/h:void 0}return n}function fl(e,t,i){const n=e.length,a=new Array(n);let r=0;for(let s=0;s<n;s++){const u=e[s],h=t[s]??0;if(u==null){a[s]=void 0;continue}const m=h/Math.max(1,t[s-1]??h);r=(r*(i-1)+u*m)/i,a[s]=r}return a}const hr=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),da=e=>e.trim().replace(/[^a-zA-Z0-9_]+/g,"_").toLowerCase(),pe=e=>hr(e)?da(e.name):`const_${da(String(e))}`,le=(e,t)=>{const i=typeof e=="number"?e:Number(e);return Number.isFinite(i)?Math.max(1,Math.floor(i)):t},Q=(e,t)=>{const i=new Array(t);if(hr(e)){const r=e.data;for(let s=0;s<t;s++){const u=r[s];i[s]=Number.isFinite(u)?u:void 0}return i}const n=typeof e=="number"?e:Number(e),a=Number.isFinite(n)?n:NaN;for(let r=0;r<t;r++)i[r]=Number.isFinite(a)?a:void 0;return i},on=(e,t)=>{const i=new Array(e.length);let n=0;for(let a=0;a<e.length;a++)n+=e[a]??0,a>=t&&(n-=e[a-t]??0),i[a]=a>=t-1?n:void 0;return i},hl=(e,t)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t-1){i[n]=void 0;continue}let a=-1/0;for(let r=n-t+1;r<=n;r++){const s=e[r];Number.isFinite(s)&&s>a&&(a=s)}i[n]=Number.isFinite(a)?a:void 0}return i},dl=(e,t)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t-1){i[n]=void 0;continue}let a=1/0;for(let r=n-t+1;r<=n;r++){const s=e[r];Number.isFinite(s)&&s<a&&(a=s)}i[n]=Number.isFinite(a)?a:void 0}return i},ml=(e,t,i)=>{const n=i.length,a=new Array(n);let r;for(let s=0;s<n;s++){const u=e[s]??i[s],h=t[s]??i[s],m=i[s];if(!Number.isFinite(u)||!Number.isFinite(h)||!Number.isFinite(m)){a[s]=void 0,Number.isFinite(m)&&(r=m);continue}let _=Math.max(u-h,0);r!==void 0&&Number.isFinite(r)&&(_=Math.max(_,Math.abs(u-r),Math.abs(h-r))),a[s]=_,r=m}return a},ma=(e,t,i,n)=>{const a=e.length,r=new Array(a);for(let s=0;s<a;s++){const u=s-i;if(u-t<0){r[s]=void 0;continue}const h=e[u];if(!Number.isFinite(h)){r[s]=void 0;continue}const m=u-t,_=u+i;let A=!0;for(let D=m;D<=_;D++){const C=e[D];if(!Number.isFinite(C)){A=!1;break}if(n==="high"){if(C>h){A=!1;break}}else if(C<h){A=!1;break}}r[s]=A?h:void 0}return r},pl=(e,t,i,n,a)=>{const r=i.length,s=new Array(r),u=new Array(r),h=new Array(r),m=new Array(r),_=new Array(r),A=new Array(r),D=new Array(r),C=new Array(r),v=new Array(r);for(let S=0;S<r;S++){if(S<n){s[S]=void 0,u[S]=void 0,h[S]=void 0,m[S]=void 0,_[S]=void 0,A[S]=void 0,D[S]=void 0,C[S]=void 0,v[S]=void 0;continue}let U=-1/0,V=1/0,ne=!0;for(let Te=S-n;Te<S;Te++){const Fe=e[Te],Ne=t[Te];if(!Number.isFinite(Fe)||!Number.isFinite(Ne)){ne=!1;break}Fe>U&&(U=Fe),Ne<V&&(V=Ne)}const he=i[S-1];if(!Number.isFinite(he)||!ne){s[S]=void 0,u[S]=void 0,h[S]=void 0,m[S]=void 0,_[S]=void 0,A[S]=void 0,D[S]=void 0,C[S]=void 0,v[S]=void 0;continue}const me=U-V,_e=he;if(a==="woodie"){const Te=(U+V+2*_e)/4;s[S]=Te,u[S]=2*Te-V,h[S]=2*Te-U,m[S]=Te+me,_[S]=Te-me,A[S]=U+2*(Te-V),D[S]=V-2*(U-Te),C[S]=void 0,v[S]=void 0;continue}if(a==="fibonacci"){const Te=(U+V+_e)/3;s[S]=Te,u[S]=Te+.382*me,h[S]=Te-.382*me,m[S]=Te+.618*me,_[S]=Te-.618*me,A[S]=Te+me,D[S]=Te-me,C[S]=void 0,v[S]=void 0;continue}if(a==="camarilla"){const Te=(U+V+_e)/3,Fe=me*1.1;s[S]=Te,u[S]=_e+Fe/12,h[S]=_e-Fe/12,m[S]=_e+Fe/6,_[S]=_e-Fe/6,A[S]=_e+Fe/4,D[S]=_e-Fe/4,C[S]=_e+Fe/2,v[S]=_e-Fe/2;continue}const we=(U+V+_e)/3;s[S]=we,u[S]=2*we-V,h[S]=2*we-U,m[S]=we+me,_[S]=we-me,A[S]=U+2*(we-V),D[S]=V-2*(U-we),C[S]=void 0,v[S]=void 0}return{pp:s,r1:u,s1:h,r2:m,s2:_,r3:A,s3:D,r4:C,s4:v}},gl=(e,t=1)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t){i[n]=void 0;continue}const a=e[n],r=e[n-t];i[n]=Number.isFinite(a)&&Number.isFinite(r)?a-r:void 0}return i},jn=(e,t)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++){if(n<t){i[n]=void 0;continue}const a=e[n],r=e[n-t];!Number.isFinite(a)||!Number.isFinite(r)||r===0?i[n]=void 0:i[n]=(a-r)/r*100}return i},yl=(e,t)=>{const i=new Array(e.length),n=new Array(e.length).fill(0),a=new Array(e.length).fill(0);for(let u=1;u<e.length;u++){const h=e[u-1],m=e[u];if(!Number.isFinite(h)||!Number.isFinite(m))continue;const _=m-h;n[u]=_>0?_:0,a[u]=_<0?-_:0}let r=0,s=0;for(let u=0;u<e.length;u++){if(r+=n[u],s+=a[u],u>=t&&(r-=n[u-t],s-=a[u-t]),u<t){i[u]=void 0;continue}const h=r+s;i[u]=h===0?0:(r-s)/h*100}return i},xl=(e,t,i)=>{const n=e.length,a=new Array(n),r=new Array(n);for(let A=0;A<n;A++){if(A===0){a[A]=void 0,r[A]=void 0;continue}const D=e[A],C=e[A-1];if(!Number.isFinite(D)||!Number.isFinite(C)){a[A]=void 0,r[A]=void 0;continue}const v=D-C;a[A]=v,r[A]=Math.abs(v)}const s=It(a,t),u=It(s,i),h=It(r,t),m=It(h,i),_=new Array(n);for(let A=0;A<n;A++){const D=u[A],C=m[A];_[A]=Number.isFinite(D)&&Number.isFinite(C)&&C!==0?D/C*100:void 0}return _},bl=(e,t,i,n)=>{const a=new Array(e.length),r=i*(t-1),s=t/n,u=new Array(t);let h=0;for(let m=0;m<t;m++){const _=Math.exp(-((m-r)*(m-r))/(2*s*s));u[m]=_,h+=_}for(let m=0;m<e.length;m++){if(m<t-1){a[m]=void 0;continue}let _=0,A=!0;for(let D=0;D<t;D++){const C=e[m-t+1+D];if(!Number.isFinite(C)){A=!1;break}_+=C*u[D]}a[m]=A&&h!==0?_/h:void 0}return a},_l=(e,t)=>{const i=new Array(e.length),n=new Array(t);let a=0;for(let r=0;r<t;r++){const s=Math.sin((r+1)*Math.PI/(t+1));n[r]=s,a+=s}for(let r=0;r<e.length;r++){if(r<t-1){i[r]=void 0;continue}let s=0,u=!0;for(let h=0;h<t;h++){const m=e[r-t+1+h];if(!Number.isFinite(m)){u=!1;break}s+=m*n[h]}i[r]=u&&a!==0?s/a:void 0}return i},vl=(e,t)=>{const i=Math.ceil((t+1)/2),n=Math.floor((t+1)/2),a=ai(e,i);return ai(a,n)},wl=(e,t,i,n)=>{const a=e.length,r=new Array(a),s=2/(i+1),u=2/(n+1);let h;for(let m=0;m<a;m++){if(m<t){r[m]=void 0;continue}const _=e[m],A=e[m-t];if(!Number.isFinite(_)||!Number.isFinite(A)){r[m]=void 0;continue}let D=0;for(let U=m-t+1;U<=m;U++){const V=e[U],ne=e[U-1];!Number.isFinite(V)||!Number.isFinite(ne)||(D+=Math.abs(V-ne))}const C=Math.abs(_-A),v=D===0?0:C/D,S=Math.pow(v*(s-u)+u,2);h=h==null?_:h+S*(_-h),r[m]=h}return r},Nl=(e,t)=>{const i=Math.max(1,Math.floor(t/2)),n=Math.max(1,Math.floor(Math.sqrt(t))),a=fr(e,i),r=fr(e,t),s=new Array(e.length);for(let u=0;u<e.length;u++){const h=a[u],m=r[u];s[u]=Number.isFinite(h)&&Number.isFinite(m)?2*h-m:void 0}return fr(s,n)},kl=(e,t,i)=>{const n=It(e,t),a=It(n,t),r=It(a,t),s=It(r,t),u=It(s,t),h=It(u,t),m=i,_=-m*m*m,A=3*m*m+3*m*m*m,D=-6*m*m-3*m-3*m*m*m,C=1+3*m+m*m*m+3*m*m,v=new Array(e.length);for(let S=0;S<e.length;S++){const U=r[S],V=s[S],ne=u[S],he=h[S];v[S]=Number.isFinite(U)&&Number.isFinite(V)&&Number.isFinite(ne)&&Number.isFinite(he)?_*he+A*ne+D*V+C*U:void 0}return v},dr=(e,t)=>{const i=e.length,n=new Array(i),a=new Array(i),r=new Array(i),s=new Array(i),u=t,h=(u-1)*u/2,m=u*(u-1)*(2*u-1)/6,_=u*m-h*h;for(let A=0;A<i;A++){if(A<t-1||_===0){n[A]=void 0,a[A]=void 0,r[A]=void 0,s[A]=void 0;continue}let D=0,C=0,v=!0;for(let ne=0;ne<t;ne++){const he=e[A-t+1+ne];if(!Number.isFinite(he)){v=!1;break}D+=he,C+=ne*he}if(!v){n[A]=void 0,a[A]=void 0,r[A]=void 0,s[A]=void 0;continue}const S=(u*C-h*D)/_,U=(D-S*h)/u,V=S*(t-1)+U;n[A]=V,a[A]=S,r[A]=U,s[A]=Math.atan(S)*180/Math.PI}return{line:n,slope:a,intercept:r,angle:s}},Jr=(e,t,i,n)=>{const a=i.length,r=new Array(a);for(let s=0;s<a;s++){if(s<n-1){r[s]=void 0;continue}let u=-1/0,h=1/0;for(let A=s-n+1;A<=s;A++){const D=e[A],C=t[A];Number.isFinite(D)&&D>u&&(u=D),Number.isFinite(C)&&C<h&&(h=C)}const m=i[s],_=u-h;r[s]=Number.isFinite(m)&&Number.isFinite(_)&&_!==0?(m-h)/_*100:void 0}return r},Pl=(e,t,i,n)=>{const a=fa(e,t),r=Jr(a,a,a,i),s=ai(r,i),u=ai(s,n),h=new Array(e.length);for(let m=0;m<e.length;m++)h[m]=u[m];return h},pa=(e,t,i)=>{const n=e.length,a=new Array(n),r=new Array(n);for(let s=0;s<n;s++){if(s<i-1){a[s]=void 0,r[s]=void 0;continue}let u=-1/0,h=1/0,m=s,_=s;for(let C=s-i+1;C<=s;C++){const v=e[C],S=t[C];Number.isFinite(v)&&v>=u&&(u=v,m=C),Number.isFinite(S)&&S<=h&&(h=S,_=C)}const A=s-m,D=s-_;a[s]=(i-A)/i*100,r[s]=(i-D)/i*100}return{up:a,down:r}},mr=(e,t,i,n)=>{const a=i.length,r=new Array(a).fill(0),s=new Array(a).fill(0),u=new Array(a).fill(0);for(let S=1;S<a;S++){const U=e[S],V=t[S],ne=e[S-1],he=t[S-1],me=i[S-1];if(!Number.isFinite(U)||!Number.isFinite(V))continue;const _e=U-ne,we=he-V;r[S]=_e>we&&_e>0?_e:0,s[S]=we>_e&&we>0?we:0;const Te=Math.max(U-V,Math.abs(U-me),Math.abs(V-me));u[S]=Number.isFinite(Te)?Te:0}const h=Bn(r,n),m=Bn(s,n),_=Bn(u,n),A=new Array(a),D=new Array(a),C=new Array(a);for(let S=0;S<a;S++){const U=h[S],V=m[S],ne=_[S];if(!Number.isFinite(U)||!Number.isFinite(V)||!Number.isFinite(ne)||ne===0){A[S]=void 0,D[S]=void 0,C[S]=void 0;continue}const he=U/ne*100,me=V/ne*100;A[S]=he,D[S]=me;const _e=he+me;C[S]=_e===0?0:Math.abs(he-me)/_e*100}const v=Bn(C,n);return{plus:A,minus:D,adx:v}},ga=(e,t,i)=>{const n=new Array(e.length);let a=1e3;n[0]=a;for(let r=1;r<e.length;r++){const s=e[r],u=e[r-1],h=t[r]??0,m=t[r-1]??0;if(!Number.isFinite(s)||!Number.isFinite(u)){n[r]=a;continue}(i?h>m:h<m)&&u!==0&&(a=a+(s-u)/u*a),n[r]=a}return n},Sl=(e,t,i,n)=>{const a=i.length,r=new Array(a).fill(0),s=new Array(a).fill(0),u=new Array(a).fill(0);for(let C=1;C<a;C++){const v=e[C],S=t[C],U=e[C-1],V=t[C-1],ne=i[C-1];if(!Number.isFinite(v)||!Number.isFinite(S))continue;r[C]=Math.abs(v-V),s[C]=Math.abs(S-U);const he=Math.max(v-S,Math.abs(v-ne),Math.abs(S-ne));u[C]=Number.isFinite(he)?he:0}const h=on(r,n),m=on(s,n),_=on(u,n),A=new Array(a),D=new Array(a);for(let C=0;C<a;C++){const v=h[C],S=m[C],U=_[C];if(!Number.isFinite(v)||!Number.isFinite(S)||!Number.isFinite(U)||U===0){A[C]=void 0,D[C]=void 0;continue}A[C]=v/U,D[C]=S/U}return{plus:A,minus:D}},Cl=(e,t,i,n,a,r)=>{const s=i.length,u=new Array(s).fill(0),h=new Array(s).fill(0);for(let v=0;v<s;v++){const S=e[v],U=t[v],V=i[v],ne=v>0?i[v-1]:V;if(!Number.isFinite(S)||!Number.isFinite(U)||!Number.isFinite(V))continue;const he=Math.min(U,ne??U),me=Math.max(S,ne??S);u[v]=V-he,h[v]=me-he}const m=v=>{const S=on(u,v),U=on(h,v),V=new Array(s);for(let ne=0;ne<s;ne++){const he=S[ne],me=U[ne];V[ne]=Number.isFinite(he)&&Number.isFinite(me)&&me!==0?he/me:void 0}return V},_=m(n),A=m(a),D=m(r),C=new Array(s);for(let v=0;v<s;v++){if(!Number.isFinite(_[v])||!Number.isFinite(A[v])||!Number.isFinite(D[v])){C[v]=void 0;continue}C[v]=(4*_[v]+2*A[v]+D[v])/7*100}return C},Il=(e,t)=>{const i=e.length,n=new Array(i);for(let a=0;a<i;a++){if(a<t-1){n[a]=void 0;continue}let r=0,s=0,u=!0;for(let h=0;h<t;h++){const m=e[a-t+1+h];if(!Number.isFinite(m)){u=!1;break}r+=(h+1)*m,s+=m}n[a]=u&&s!==0?-(r/s)+(t+1)/2:void 0}return n},Fl=(e,t,i,n)=>{const a=i.length,r=new Array(a);let s=0;for(let u=0;u<a;u++){const h=e[u],m=t[u],_=i[u],A=n[u]??0;if(!Number.isFinite(h)||!Number.isFinite(m)||!Number.isFinite(_)){r[u]=void 0;continue}const D=h-m,v=(D===0?0:(_-m-(h-_))/D)*A;s+=v,r[u]=s}return r},Al=(e,t,i,n,a)=>{const r=i.length,s=new Array(r).fill(0);for(let _=0;_<r;_++){const A=e[_],D=t[_],C=i[_],v=n[_]??0;if(!Number.isFinite(A)||!Number.isFinite(D)||!Number.isFinite(C))continue;const S=A-D,U=S===0?0:(C-D-(A-C))/S;s[_]=U*v}const u=on(s,a),h=on(n,a),m=new Array(r);for(let _=0;_<r;_++){const A=u[_],D=h[_];m[_]=Number.isFinite(A)&&Number.isFinite(D)&&D!==0?A/D:void 0}return m},pr=(e,t)=>{const i=new Map,n=new Map,a=new Map,r=e.close.data.length,s=(k,R)=>{const w=i.get(k);if(w)return w;const O=ni(k,R,t);return i.set(k,O),O},u=(k,R=14)=>{const w=le(R,14),O=`ta_sma_${pe(k)}_${w}`;return s(O,ai(Q(k,r),w))},h=(k,R=14)=>{const w=le(R,14),O=`ta_ema_${pe(k)}_${w}`;return s(O,It(Q(k,r),w))},m=(k,R=14)=>{const w=le(R,14),O=`ta_rma_${pe(k)}_${w}`;return s(O,Bn(Q(k,r),w))},_=(k,R=14)=>{const w=le(R,14),O=`ta_wma_${pe(k)}_${w}`;return s(O,fr(Q(k,r),w))},A=(k,R=14)=>{const w=le(R,14),O=`ta_dema_${pe(k)}_${w}`,H=Q(k,r),G=It(H,w),W=It(G,w),re=new Array(r);for(let oe=0;oe<r;oe++){const ce=G[oe],J=W[oe];re[oe]=Number.isFinite(ce)&&Number.isFinite(J)?2*ce-J:void 0}return s(O,re)},D=(k,R=14)=>{const w=le(R,14),O=`ta_tema_${pe(k)}_${w}`,H=Q(k,r),G=It(H,w),W=It(G,w),re=It(W,w),oe=new Array(r);for(let ce=0;ce<r;ce++){const J=G[ce],Ie=W[ce],Ue=re[ce];oe[ce]=Number.isFinite(J)&&Number.isFinite(Ie)&&Number.isFinite(Ue)?3*J-3*Ie+Ue:void 0}return s(O,oe)},C=(k,R=20)=>{const w=le(R,20),O=`ta_hma_${pe(k)}_${w}`;return s(O,Nl(Q(k,r),w))},v=(k,R=10,w=2,O=30)=>{const H=le(R,10),G=le(w,2),W=le(O,30),re=`ta_kama_${pe(k)}_${H}_${G}_${W}`;return s(re,wl(Q(k,r),H,G,W))},S=(k,R=20,w=.85,O=6)=>{const H=le(R,20),G=Number.isFinite(Number(w))?Number(w):.85,W=Number.isFinite(Number(O))?Number(O):6,re=`ta_alma_${pe(k)}_${H}_${G}_${W}`;return s(re,bl(Q(k,r),H,G,W))},U=(k,R=10,w=.7)=>{const O=le(R,10),H=Number.isFinite(Number(w))?Number(w):.7,G=`ta_t3_${pe(k)}_${O}_${H}`;return s(G,kl(Q(k,r),O,H))},V=(k,R=20)=>{const w=le(R,20),O=`ta_trima_${pe(k)}_${w}`;return s(O,vl(Q(k,r),w))},ne=(k,R=20)=>{const w=le(R,20),O=`ta_swma_${pe(k)}_${w}`;return s(O,_l(Q(k,r),w))},he=(k=e.close,R=e.volume,w=20)=>{const O=le(w,20),H=`ta_evwma_${pe(k)}_${pe(R)}_${O}`;return s(H,fl(Q(k,r),Q(R,r),O))},me=(k,R=14)=>{const w=le(R,14),O=`ta_rsi_${pe(k)}_${w}`;return s(O,fa(Q(k,r),w))},_e=(k,R=14)=>{const w=le(R,14),O=`ta_cmo_${pe(k)}_${w}`;return s(O,yl(Q(k,r),w))},we=(k,R=25,w=13)=>{const O=le(R,25),H=le(w,13),G=`ta_tsi_${pe(k)}_${O}_${H}`;return s(G,xl(Q(k,r),O,H))},Te=(k,R=14)=>{const w=le(R,14),O=`ta_roc_${pe(k)}_${w}`;return s(O,jn(Q(k,r),w))},Fe=(k,R=10)=>{const w=le(R,10),O=`ta_mom_${pe(k)}_${w}`;return s(O,gl(Q(k,r),w))},Ne=(k=e.close,R=9)=>{const w=le(R,9),O=`ta_trix_${pe(k)}_${w}`;return s(O,sl(Q(k,r),w))},ze=()=>s("ta_ao",rl(Q(e.high,r),Q(e.low,r))),Ce=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_zscore_${pe(k)}_${w}`;return s(O,ul(Q(k,r),w))},Ct=(k=14)=>{const R=le(k,14),w=`ta_atr_${R}`;return s(w,Dn(Q(e.high,r),Q(e.low,r),Q(e.close,r),R))},y=(k=e.high,R=e.low,w=e.close)=>{const O=`ta_tr_${pe(k)}_${pe(R)}_${pe(w)}`;return s(O,ml(Q(k,r),Q(R,r),Q(w,r)))},c=(k=14)=>{const R=le(k,14),w=`ta_atrp_${R}`,O=Dn(Q(e.high,r),Q(e.low,r),Q(e.close,r),R),H=new Array(r);for(let G=0;G<r;G++){const W=O[G],re=e.close.data[G];H[G]=Number.isFinite(W)&&Number.isFinite(re)&&re!==0?W/re*100:void 0}return s(w,H)},M=(k=14)=>{const R=le(k,14),w=`ta_natr_${R}`,O=Dn(Q(e.high,r),Q(e.low,r),Q(e.close,r),R),H=new Array(r);for(let G=0;G<r;G++){const W=O[G],re=e.close.data[G];H[G]=Number.isFinite(W)&&Number.isFinite(re)&&re!==0?W/re*100:void 0}return s(w,H)},o=()=>s("ta_obv",tl(Q(e.close,r),Q(e.volume,r))),f=(k=20)=>{const R=le(k,20),w=`ta_cci_${R}`;return s(w,il(Q(e.high,r),Q(e.low,r),Q(e.close,r),R))},P=(k=14)=>{const R=le(k,14),w=`ta_mfi_${R}`;return s(w,nl(Q(e.high,r),Q(e.low,r),Q(e.close,r),Q(e.volume,r),R))},I=()=>s("ta_vwap",al(Q(e.close,r),Q(e.volume,r))),Y=(k=20)=>{const R=le(k,20),w=`ta_vwma_${R}`;return s(w,ol(Q(e.close,r),Q(e.volume,r),R))},X=(k=e.close,R=20,w=2)=>{const O=le(R,20),H=Number.isFinite(Number(w))?Number(w):2,G=`ta_bbands_${pe(k)}_${O}_${H}`,W=n.get(G);if(W)return W;const re=ha(Q(k,r),O,H),oe=s(`${G}_basis`,re.mid),ce=s(`${G}_upper`,re.upper),J=s(`${G}_lower`,re.lower),Ie=[oe,ce,J];return n.set(G,Ie),Ie},B=(k=e.close,R=20,w=2)=>{const O=le(R,20),H=Number.isFinite(Number(w))?Number(w):2,G=`ta_bbw_${pe(k)}_${O}_${H}`,W=ha(Q(k,r),O,H),re=new Array(r);for(let oe=0;oe<r;oe++){const ce=W.mid[oe],J=W.upper[oe],Ie=W.lower[oe];re[oe]=Number.isFinite(ce)&&Number.isFinite(J)&&Number.isFinite(Ie)&&ce!==0?(J-Ie)/ce*100:void 0}return s(G,re)},te=(k=e.close,R=12,w=26,O=9)=>{const H=le(R,12),G=le(w,26),W=le(O,9),re=`ta_macd_${pe(k)}_${H}_${G}_${W}`,oe=n.get(re);if(oe)return oe;const ce=Q(k,r),J=It(ce,H),Ie=It(ce,G),Ue=new Array(r);for(let kt=0;kt<r;kt++){const Jt=J[kt],Ft=Ie[kt];Ue[kt]=Jt===void 0||Ft===void 0?void 0:Jt-Ft}const et=It(Ue,W),Bt=new Array(r);for(let kt=0;kt<r;kt++){const Jt=Ue[kt],Ft=et[kt];Bt[kt]=Jt===void 0||Ft===void 0?void 0:Jt-Ft}const Wt=s(`${re}_line`,Ue),li=s(`${re}_signal`,et),di=s(`${re}_hist`,Bt),yi=[Wt,li,di];return n.set(re,yi),yi},ie=(k=e.close,R=12,w=26)=>{const O=le(R,12),H=le(w,26),G=`ta_ppo_${pe(k)}_${O}_${H}`,W=Q(k,r),re=It(W,O),oe=It(W,H),ce=new Array(r);for(let J=0;J<r;J++){const Ie=re[J],Ue=oe[J];ce[J]=Number.isFinite(Ie)&&Number.isFinite(Ue)&&Ue!==0?(Ie-Ue)/Ue*100:void 0}return s(G,ce)},ae=(k=e.close,R=e.high,w=e.low,O=14)=>{const H=le(O,14),G=`ta_stoch_${pe(k)}_${pe(R)}_${pe(w)}_${H}`;return s(G,Jr(Q(R,r),Q(w,r),Q(k,r),H))},fe=(k=e.close,R=14,w=3,O=3)=>{const H=le(R,14),G=le(w,3),W=le(O,3),re=`ta_stochrsi_${pe(k)}_${H}_${G}_${W}`;return s(re,Pl(Q(k,r),H,G,W))},ee=(k=14)=>{const R=le(k,14),w=`ta_aroon_${R}`,O=n.get(w);if(O)return O;const H=pa(Q(e.high,r),Q(e.low,r),R),G=s(`${w}_up`,H.up),W=s(`${w}_down`,H.down),re=[G,W];return n.set(w,re),re},ue=(k=14)=>{const R=le(k,14),w=`ta_aroonosc_${R}`,O=pa(Q(e.high,r),Q(e.low,r),R),H=new Array(r);for(let G=0;G<r;G++){const W=O.up[G],re=O.down[G];H[G]=Number.isFinite(W)&&Number.isFinite(re)?W-re:void 0}return s(w,H)},De=(k=14)=>{const R=le(k,14),w=`ta_dmi_${R}`,O=n.get(w);if(O)return O;const H=mr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R),G=s(`${w}_plus`,H.plus),W=s(`${w}_minus`,H.minus),re=s(`${w}_adx`,H.adx),oe=[G,W,re];return n.set(w,oe),oe},Ge=(k=14)=>{const R=le(k,14),w=`ta_plus_di_${R}`;return s(w,mr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R).plus)},Ye=(k=14)=>{const R=le(k,14),w=`ta_minus_di_${R}`;return s(w,mr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R).minus)},Ae=(k=14)=>{const R=le(k,14),w=`ta_adx_${R}`;return s(w,mr(Q(e.high,r),Q(e.low,r),Q(e.close,r),R).adx)},ft=(k=e.high,R=e.low,w=e.close,O=14)=>{const H=le(O,14),G=`ta_vortex_${pe(k)}_${pe(R)}_${pe(w)}_${H}`,W=n.get(G);if(W)return W;const re=Sl(Q(k,r),Q(R,r),Q(w,r),H),oe=s(`${G}_plus`,re.plus),ce=s(`${G}_minus`,re.minus),J=[oe,ce];return n.set(G,J),J},pt=(k=7,R=14,w=28)=>{const O=le(k,7),H=le(R,14),G=le(w,28),W=`ta_uo_${O}_${H}_${G}`;return s(W,Cl(Q(e.high,r),Q(e.low,r),Q(e.close,r),O,H,G))},qt=(k=e.close,R=10)=>{const w=le(R,10),O=`ta_cog_${pe(k)}_${w}`;return s(O,Il(Q(k,r),w))},Ut=(k=e.high,R=e.low,w=e.close,O=9,H=3,G=3)=>{const W=le(O,9),re=le(H,3),oe=le(G,3),ce=`ta_kdj_${pe(k)}_${pe(R)}_${pe(w)}_${W}_${re}_${oe}`,J=n.get(ce);if(J)return J;const Ie=Jr(Q(k,r),Q(R,r),Q(w,r),W),Ue=ai(Ie,re),et=ai(Ue,oe),Bt=new Array(r);for(let kt=0;kt<r;kt++){const Jt=Ue[kt],Ft=et[kt];Bt[kt]=Number.isFinite(Jt)&&Number.isFinite(Ft)?3*Jt-2*Ft:void 0}const Wt=s(`${ce}_k`,Ue),li=s(`${ce}_d`,et),di=s(`${ce}_j`,Bt),yi=[Wt,li,di];return n.set(ce,yi),yi},qe=(k=e.close,R=10,w=15,O=20,H=30,G=10,W=10,re=10,oe=15,ce=9)=>{const J=le(R,10),Ie=le(w,15),Ue=le(O,20),et=le(H,30),Bt=le(G,10),Wt=le(W,10),li=le(re,10),di=le(oe,15),yi=le(ce,9),kt=`ta_kst_${pe(k)}_${J}_${Ie}_${Ue}_${et}_${Bt}_${Wt}_${li}_${di}_${yi}`,Jt=n.get(kt);if(Jt)return Jt;const Ft=Q(k,r),Qt=jn(Ft,J),xi=jn(Ft,Ie),Ii=jn(Ft,Ue),Zt=jn(Ft,et),Fi=ai(Qt,Bt),Ai=ai(xi,Wt),nn=ai(Ii,li),zt=ai(Zt,di),ei=new Array(r);for(let Mi=0;Mi<r;Mi++){const pn=Fi[Mi],gn=Ai[Mi],Ui=nn[Mi],yn=zt[Mi];ei[Mi]=Number.isFinite(pn)&&Number.isFinite(gn)&&Number.isFinite(Ui)&&Number.isFinite(yn)?pn+2*gn+3*Ui+4*yn:void 0}const zi=ai(ei,yi),Ei=s(`${kt}_kst`,ei),mn=s(`${kt}_signal`,zi),ti=[Ei,mn];return n.set(kt,ti),ti},Lt=(k=e.close,R=e.volume)=>{const w=`ta_pvi_${pe(k)}_${pe(R)}`;return s(w,ga(Q(k,r),Q(R,r),!0))},wt=(k=e.close,R=e.volume)=>{const w=`ta_nvi_${pe(k)}_${pe(R)}`;return s(w,ga(Q(k,r),Q(R,r),!1))},at=()=>s("ta_ad",Fl(Q(e.high,r),Q(e.low,r),Q(e.close,r),Q(e.volume,r))),Pe=(k=20)=>{const R=le(k,20),w=`ta_cmf_${R}`;return s(w,Al(Q(e.high,r),Q(e.low,r),Q(e.close,r),Q(e.volume,r),R))},jt=(k=3,R=10)=>{const w=le(R,10),O=Number.isFinite(Number(k))?Number(k):3,H=`ta_supertrend_${w}_${O}`,G=n.get(H);if(G)return G;const W=ll(Q(e.high,r),Q(e.low,r),Q(e.close,r),w,O),re=new Array(r);for(let Ie=0;Ie<r;Ie++){const Ue=e.close.data[Ie],et=W[Ie];re[Ie]=Number.isFinite(Ue)&&Number.isFinite(et)?Ue>=et?1:-1:void 0}const oe=s(`${H}_line`,W),ce=s(`${H}_dir`,re),J=[oe,ce];return n.set(H,J),J},Ke=(k=20,R=1.5)=>{const w=le(k,20),O=Number.isFinite(Number(R))?Number(R):1.5,H=`ta_keltner_${w}_${O}`,G=n.get(H);if(G)return G;const W=cl(Q(e.high,r),Q(e.low,r),Q(e.close,r),w,O),re=s(`${H}_mid`,W.mid),oe=s(`${H}_upper`,W.upper),ce=s(`${H}_lower`,W.lower),J=[re,oe,ce];return n.set(H,J),J},je=(k=20)=>{const R=le(k,20),w=`ta_donchian_${R}`,O=n.get(w);if(O)return O;const H=computeDonchian(Q(e.high,r),Q(e.low,r),R),G=s(`${w}_upper`,H.upper),W=s(`${w}_lower`,H.lower),re=s(`${w}_mid`,H.mid),oe=[G,W,re];return n.set(w,oe),oe},ot=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_${pe(k)}_${w}`;return s(O,dr(Q(k,r),w).line)},Vt=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_slope_${pe(k)}_${w}`;return s(O,dr(Q(k,r),w).slope)},$t=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_intercept_${pe(k)}_${w}`;return s(O,dr(Q(k,r),w).intercept)},Nt=(k=e.close,R=20)=>{const w=le(R,20),O=`ta_linreg_angle_${pe(k)}_${w}`;return s(O,dr(Q(k,r),w).angle)},Tt=(k=e.high,R=3,w=3)=>{const O=le(R,3),H=le(w,3),G=`ta_pivothigh_${pe(k)}_${O}_${H}`;return s(G,ma(Q(k,r),O,H,"high"))},gt=(k=e.low,R=3,w=3)=>{const O=le(R,3),H=le(w,3),G=`ta_pivotlow_${pe(k)}_${O}_${H}`;return s(G,ma(Q(k,r),O,H,"low"))},Ze=(k,R,w,O,H)=>{let G=e.high,W=e.low,re=e.close,oe=20,ce="classic";if(w!==void 0)G=k,W=R,re=w,oe=le(O??20,20),ce=String(H??"classic").toLowerCase();else{if(hr(k)||hr(R))throw new Error("ta.pivot_points expects (high, low, close, length, type) or (length, type)");k!==void 0&&(oe=le(k,20)),R!==void 0&&(ce=String(R).toLowerCase())}const J=ce==="fib"?"fibonacci":ce,Ie=`ta_pivot_points_${pe(G)}_${pe(W)}_${pe(re)}_${oe}_${J}`,Ue=a.get(Ie);if(Ue)return Ue;const et=pl(Q(G,r),Q(W,r),Q(re,r),oe,J==="woodie"||J==="fibonacci"||J==="camarilla"?J:"classic"),Bt={pp:s(`${Ie}_pp`,et.pp),r1:s(`${Ie}_r1`,et.r1),s1:s(`${Ie}_s1`,et.s1),r2:s(`${Ie}_r2`,et.r2),s2:s(`${Ie}_s2`,et.s2),r3:s(`${Ie}_r3`,et.r3),s3:s(`${Ie}_s3`,et.s3),r4:s(`${Ie}_r4`,et.r4),s4:s(`${Ie}_s4`,et.s4)};return a.set(Ie,Bt),Bt};return{sma:u,ema:h,rma:m,wma:_,dema:A,tema:D,hma:C,kama:v,alma:S,t3:U,trima:V,swma:ne,evwma:he,rsi:me,cmo:_e,tsi:we,roc:Te,mom:Fe,trix:Ne,ao:ze,zscore:Ce,atr:Ct,tr:y,atrp:c,natr:M,obv:o,cci:f,mfi:P,vwap:I,vwma:Y,bbands:X,bb:X,bbw:B,macd:te,ppo:ie,stoch:ae,stochrsi:fe,aroon:ee,aroonosc:ue,dmi:De,plus_di:Ge,minus_di:Ye,adx:Ae,vortex:ft,uo:pt,cog:qt,kdj:Ut,kst:qe,pvi:Lt,nvi:wt,ad:at,cmf:Pe,supertrend:jt,keltner:Ke,kc:Ke,donchian:je,linreg:ot,linreg_slope:Vt,linreg_intercept:$t,linreg_angle:Nt,pivothigh:Tt,pivotlow:gt,pivot_points:Ze,pivot:Ze,sar:(k=.02,R=.2)=>{const w=Number.isFinite(Number(k))?Number(k):.02,O=Number.isFinite(Number(R))?Number(R):.2,H=`ta_sar_${w}_${O}`,G=Q(e.high,r),W=Q(e.low,r),re=new Array(r);let oe=w,ce=G[0],J=W[0],Ie=!0;for(let Ue=1;Ue<r;Ue++){const et=G[Ue]??NaN,Bt=W[Ue]??NaN;if(!Number.isFinite(et)||!Number.isFinite(Bt)){re[Ue]=void 0;continue}let Wt=J;Ie?(Wt=J+oe*(ce-J),et>ce&&(ce=et,oe=Math.min(O,oe+w)),Wt>Bt&&(Ie=!1,Wt=ce,ce=Bt,oe=w)):(Wt=J-oe*(J-ce),Bt<ce&&(ce=Bt,oe=Math.min(O,oe+w)),Wt<et&&(Ie=!0,Wt=ce,ce=et,oe=w)),re[Ue]=Wt,J=Wt}return re[0]=J,s(H,re)},sum:(k,R=10)=>{const w=le(R,10),O=`ta_sum_${pe(k)}_${w}`;return s(O,on(Q(k,r),w))},highest:(k,R=10)=>{const w=le(R,10),O=`ta_highest_${pe(k)}_${w}`;return s(O,hl(Q(k,r),w))},lowest:(k,R=10)=>{const w=le(R,10),O=`ta_lowest_${pe(k)}_${w}`;return s(O,dl(Q(k,r),w))},rising:(k,R=5)=>{const w=le(R,5),O=`ta_rising_${pe(k)}_${w}`,H=Q(k,r),G=new Array(r);for(let W=0;W<r;W++){if(W<w){G[W]=void 0;continue}let re=!0;for(let oe=W-w+1;oe<=W;oe++){const ce=H[oe-1],J=H[oe];if(!Number.isFinite(ce)||!Number.isFinite(J)||J<=ce){re=!1;break}}G[W]=re?1:0}return s(O,G)},falling:(k,R=5)=>{const w=le(R,5),O=`ta_falling_${pe(k)}_${w}`,H=Q(k,r),G=new Array(r);for(let W=0;W<r;W++){if(W<w){G[W]=void 0;continue}let re=!0;for(let oe=W-w+1;oe<=W;oe++){const ce=H[oe-1],J=H[oe];if(!Number.isFinite(ce)||!Number.isFinite(J)||J>=ce){re=!1;break}}G[W]=re?1:0}return s(O,G)},cross:(k,R)=>{const w=`ta_cross_${pe(k)}_${pe(R)}`,O=Q(k,r),H=Q(R,r),G=new Array(r);for(let W=0;W<r;W++){if(W===0){G[W]=void 0;continue}const re=O[W-1],oe=H[W-1],ce=O[W],J=H[W];if(!Number.isFinite(re)||!Number.isFinite(oe)||!Number.isFinite(ce)||!Number.isFinite(J)){G[W]=void 0;continue}const Ie=re<=oe&&ce>J||re>=oe&&ce<J;G[W]=Ie?1:0}return s(w,G)},crossover:(k,R)=>{const w=`ta_crossover_${pe(k)}_${pe(R)}`,O=Q(k,r),H=Q(R,r),G=new Array(r);for(let W=0;W<r;W++){if(W===0){G[W]=void 0;continue}const re=O[W-1],oe=H[W-1],ce=O[W],J=H[W];if(!Number.isFinite(re)||!Number.isFinite(oe)||!Number.isFinite(ce)||!Number.isFinite(J)){G[W]=void 0;continue}G[W]=re<=oe&&ce>J?1:0}return s(w,G)},crossunder:(k,R)=>{const w=`ta_crossunder_${pe(k)}_${pe(R)}`,O=Q(k,r),H=Q(R,r),G=new Array(r);for(let W=0;W<r;W++){if(W===0){G[W]=void 0;continue}const re=O[W-1],oe=H[W-1],ce=O[W],J=H[W];if(!Number.isFinite(re)||!Number.isFinite(oe)||!Number.isFinite(ce)||!Number.isFinite(J)){G[W]=void 0;continue}G[W]=re>=oe&&ce<J?1:0}return s(w,G)},valuewhen:(k,R,w=0)=>{const O=Math.max(0,Math.floor(Number(w)||0)),H=`ta_valuewhen_${pe(k)}_${pe(R)}_${O}`,G=Q(k,r),W=Q(R,r),re=new Array(r),oe=[];for(let ce=0;ce<r;ce++){const J=G[ce];if(Number.isFinite(J)&&J!==0){const Ie=W[ce];oe.unshift(Number.isFinite(Ie)?Ie:NaN)}re[ce]=oe.length>O?oe[O]:void 0}return s(H,re)}}},Di=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),El=e=>e.trim().replace(/\s+/g,"_").toLowerCase(),ln=e=>Di(e)?El(e.name):`const_${String(e)}`,en=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?t:NaN},Ml=e=>Number.isFinite(e)?e:void 0,Tl=e=>{for(const t of e)if(Di(t))return t.data.length;return 0},fn=(e,t)=>Di(e)?en(e.data[t]):en(e),gr=e=>{const t=new Map,i=(v,S,U)=>{const V=`${v}:${S.map(ln).join("|")}`,ne=t.get(V);if(ne)return ne;const he=Tl(S),me=new Array(he);for(let we=0;we<he;we++)me[we]=Ml(U(we));const _e=ni(v,me,e);return t.set(V,_e),_e},n=(v,S)=>U=>Di(U)?i(`math_${v}_${ln(U)}`,[U],V=>S(fn(U,V))):S(en(U)),a=(v,S)=>(U,V)=>Di(U)||Di(V)?i(`math_${v}_${ln(U)}_${ln(V)}`,[U,V],ne=>S(fn(U,ne),fn(V,ne))):S(en(U),en(V)),r=(v,S)=>(...U)=>U.some(V=>Di(V))?i(`math_${v}_${U.map(ln).join("_")}`,U,V=>S(U.map(ne=>fn(ne,V)))):S(U.map(V=>en(V))),s=(v,S)=>!Number.isFinite(v)||!Number.isFinite(S)||S===0?NaN:(v%S+S)%S,u=(v,S)=>!Number.isFinite(v)||!Number.isFinite(S)||S===0?NaN:v%S,h=v=>{if(!v.length)return NaN;let S=-1/0;for(const U of v){if(!Number.isFinite(U))return NaN;U>S&&(S=U)}return S},m=v=>{if(!v.length)return NaN;let S=1/0;for(const U of v){if(!Number.isFinite(U))return NaN;U<S&&(S=U)}return S},_=v=>{if(!v.length)return NaN;let S=0;for(const U of v){if(!Number.isFinite(U))return NaN;S+=U}return S},A=v=>{if(!v.length)return NaN;const S=_(v);return Number.isFinite(S)?S/v.length:NaN},D=(v,S,U)=>!Number.isFinite(v)||!Number.isFinite(S)||!Number.isFinite(U)?NaN:Math.min(Math.max(v,S),U),C=v=>Number.isFinite(v)?Math.round(v):NaN;return{pi:Math.PI,e:Math.E,abs:n("abs",v=>Number.isFinite(v)?Math.abs(v):NaN),acos:n("acos",v=>v>=-1&&v<=1?Math.acos(v):NaN),asin:n("asin",v=>v>=-1&&v<=1?Math.asin(v):NaN),atan:n("atan",v=>Number.isFinite(v)?Math.atan(v):NaN),atan2:a("atan2",(v,S)=>Number.isFinite(v)&&Number.isFinite(S)?Math.atan2(v,S):NaN),ceil:n("ceil",v=>Number.isFinite(v)?Math.ceil(v):NaN),cos:n("cos",v=>Number.isFinite(v)?Math.cos(v):NaN),exp:n("exp",v=>Number.isFinite(v)?Math.exp(v):NaN),floor:n("floor",v=>Number.isFinite(v)?Math.floor(v):NaN),log:n("log",v=>v>0?Math.log(v):NaN),log10:n("log10",v=>v>0?Math.log10(v):NaN),max:r("max",h),min:r("min",m),sum:r("sum",_),avg:r("avg",A),pow:a("pow",(v,S)=>Number.isFinite(v)&&Number.isFinite(S)?Math.pow(v,S):NaN),round:n("round",C),sign:n("sign",v=>Number.isFinite(v)?Math.sign(v):NaN),sin:n("sin",v=>Number.isFinite(v)?Math.sin(v):NaN),sqrt:n("sqrt",v=>v>=0?Math.sqrt(v):NaN),tan:n("tan",v=>Number.isFinite(v)?Math.tan(v):NaN),trunc:n("trunc",v=>Number.isFinite(v)?Math.trunc(v):NaN),hypot:r("hypot",v=>v.every(S=>Number.isFinite(S))?Math.hypot(...v):NaN),mod:a("mod",s),fmod:a("fmod",u),clamp:(v,S,U)=>Di(v)||Di(S)||Di(U)?i(`math_clamp_${ln(v)}_${ln(S)}_${ln(U)}`,[v,S,U],V=>D(fn(v,V),fn(S,V),fn(U,V))):D(en(v),en(S),en(U)),isfinite:n("isfinite",v=>Number.isFinite(v)?1:0),isnan:n("isnan",v=>Number.isNaN(v)?1:0),todegrees:n("todegrees",v=>Number.isFinite(v)?v*180/Math.PI:NaN),toradians:n("toradians",v=>Number.isFinite(v)?v*Math.PI/180:NaN)}},Xt=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?Math.min(255,Math.max(0,Math.round(t))):0},wi=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?Math.min(1,Math.max(0,t)):1},hn=e=>{const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?Math.min(1,Math.max(0,t)):0},Yr=e=>{const t=e.trim().replace(/^#/,"");if(/^[0-9a-fA-F]{6}$/.test(t))return`#${t.toLowerCase()}`;if(/^[0-9a-fA-F]{3}$/.test(t)){const i=t[0],n=t[1],a=t[2];return`#${i}${i}${n}${n}${a}${a}`.toLowerCase()}if(/^[0-9a-fA-F]{8}$/.test(t))return`#${t.toLowerCase()}`;if(/^[0-9a-fA-F]{4}$/.test(t)){const i=t[0],n=t[1],a=t[2],r=t[3];return`#${i}${i}${n}${n}${a}${a}${r}${r}`.toLowerCase()}return null},Rl=e=>{const t=Yr(e);if(!t)return null;const i=t.replace("#","");if(i.length===6){const n=parseInt(i.slice(0,2),16),a=parseInt(i.slice(2,4),16),r=parseInt(i.slice(4,6),16);return{r:n,g:a,b:r}}if(i.length===8){const n=parseInt(i.slice(0,2),16),a=parseInt(i.slice(2,4),16),r=parseInt(i.slice(4,6),16),s=parseInt(i.slice(6,8),16)/255;return{r:n,g:a,b:r,a:s}}return null},Ol=e=>{const t=e.trim().match(/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*(?:,\s*([0-9.]+%?)\s*)?\)$/i);if(!t)return null;const i=h=>h.endsWith("%")?Xt(Number(h.slice(0,-1))/100*255):Xt(h),n=h=>h.endsWith("%")?wi(Number(h.slice(0,-1))/100):wi(h),a=i(t[1]),r=i(t[2]),s=i(t[3]),u=t[4]!=null?n(t[4]):void 0;return{r:a,g:r,b:s,a:u}},ql=e=>{const t=e.trim().match(/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+)%\s*,\s*([0-9.]+)%\s*(?:,\s*([0-9.]+%?)\s*)?\)$/i);if(!t)return null;const i=Number(t[1]),n=hn(Number(t[2])/100),a=hn(Number(t[3])/100),r=t[4]?t[4].endsWith("%")?wi(Number(t[4].slice(0,-1))/100):wi(t[4]):void 0;return{...ya(i,n,a),a:r}},ji=e=>{const t=e.trim().toLowerCase(),n=xa[t]||e;return Rl(n)||Ol(n)||ql(n)},yr=(e,t)=>{const i=ji(e);if(!i)return e;const n=t!=null?wi(t):wi(i.a??1);return`rgba(${i.r},${i.g},${i.b},${n})`},ya=(e,t,i)=>{const n=(e%360+360)%360,a=hn(t),r=hn(i),s=(1-Math.abs(2*r-1))*a,u=s*(1-Math.abs(n/60%2-1)),h=r-s/2;let m=0,_=0,A=0;return n<60?[m,_,A]=[s,u,0]:n<120?[m,_,A]=[u,s,0]:n<180?[m,_,A]=[0,s,u]:n<240?[m,_,A]=[0,u,s]:n<300?[m,_,A]=[u,0,s]:[m,_,A]=[s,0,u],{r:Xt((m+h)*255),g:Xt((_+h)*255),b:Xt((A+h)*255)}},Ll=(e,t,i)=>{const n=(e%360+360)%360,a=hn(t),r=hn(i),s=r*a,u=s*(1-Math.abs(n/60%2-1)),h=r-s;let m=0,_=0,A=0;return n<60?[m,_,A]=[s,u,0]:n<120?[m,_,A]=[u,s,0]:n<180?[m,_,A]=[0,s,u]:n<240?[m,_,A]=[0,u,s]:n<300?[m,_,A]=[u,0,s]:[m,_,A]=[s,0,u],{r:Xt((m+h)*255),g:Xt((_+h)*255),b:Xt((A+h)*255)}},dn=(e,t,i)=>{const n=ji(e),a=ji(t);if(!n||!a)return yr(e);const r=hn(i),s=Xt(n.r+(a.r-n.r)*r),u=Xt(n.g+(a.g-n.g)*r),h=Xt(n.b+(a.b-n.b)*r),m=n.a??1,_=a.a??1,A=wi(m+(_-m)*r);return`rgba(${s},${u},${h},${A})`},xa={red:"#ef4444",green:"#16a34a",orange:"#f59e0b",blue:"#3b82f6",gray:"#64748b",grey:"#64748b",white:"#e2e8f0",black:"#0b1220",yellow:"#facc15",purple:"#a855f7",teal:"#14b8a6",cyan:"#22d3ee",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",pink:"#ec4899",rose:"#f43f5e",slate:"#94a3b8",zinc:"#a1a1aa",stone:"#a8a29e",emerald:"#10b981",sky:"#38bdf8",violet:"#8b5cf6",fuchsia:"#d946ef"},xr=()=>({...xa,rgb:(e,t,i)=>`rgb(${Xt(e)},${Xt(t)},${Xt(i)})`,rgba:(e,t,i,n)=>`rgba(${Xt(e)},${Xt(t)},${Xt(i)},${wi(n)})`,hsl:(e,t,i,n)=>{const a=t>1?t/100:t,r=i>1?i/100:i,s=ya(e,a,r),u=n==null?1:wi(n>1?n/100:n);return`rgba(${s.r},${s.g},${s.b},${u})`},hsv:(e,t,i,n)=>{const a=t>1?t/100:t,r=i>1?i/100:i,s=Ll(e,a,r),u=n==null?1:wi(n>1?n/100:n);return`rgba(${s.r},${s.g},${s.b},${u})`},from_hex:e=>Yr(e)??e,fromHex:e=>Yr(e)??e,new:(e,t=0)=>{const i=typeof t=="number"?t:Number(t),n=Number.isFinite(i)?1-Math.min(100,Math.max(0,i))/100:1;return yr(e,n)},tostring:e=>String(e??""),alpha:e=>{const t=ji(e);return wi((t==null?void 0:t.a)??1)},set_alpha:(e,t)=>yr(e,t),setAlpha:(e,t)=>yr(e,t),r:e=>{const t=ji(e);return t?t.r:0},g:e=>{const t=ji(e);return t?t.g:0},b:e=>{const t=ji(e);return t?t.b:0},a:e=>{const t=ji(e);return wi((t==null?void 0:t.a)??1)},from_gradient:(e,t,i)=>dn(e,t,i),fromGradient:(e,t,i)=>dn(e,t,i),blend:(e,t,i)=>dn(e,t,i),mix:(e,t,i)=>dn(e,t,i),lerp:(e,t,i)=>dn(e,t,i),invert:e=>{const t=ji(e);return t?`rgba(${255-t.r},${255-t.g},${255-t.b},${wi(t.a??1)})`:e},lighten:(e,t)=>dn(e,"#ffffff",t),darken:(e,t)=>dn(e,"#000000",t),is_valid:e=>!!ji(e)}),Vl=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),Xr=e=>Vl(e)||e&&typeof e=="object"&&typeof e.valueOf=="function"?e.valueOf():e,Me=e=>{const t=Xr(e);return t==null?"":String(t)},oi=e=>{const t=Xr(e);if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="boolean")return t?1:0;if(t==null)return NaN;const i=Number(t);return Number.isFinite(i)?i:NaN},zn=(e,t,i)=>{const n=Math.trunc(oi(e));return Number.isFinite(n)?n<0?Math.max(0,t+n):Math.min(t,Math.max(0,n)):i},$l=(e,t)=>{if(!Number.isFinite(e)||t==null)return String(e);const i=String(t);if(!i.trim())return String(e);const n=i.includes("%"),a=i.match(/0\.(0+)/),r=a?a[1].length:0,s=n?e*100:e,u=r>0?s.toFixed(r):String(Math.round(s));return n?`${u}%`:u},Bl=e=>e.flags.includes("g")?e:new RegExp(e.source,`${e.flags}g`),br=()=>{const e=(r,s)=>Me(r).startsWith(Me(s)),t=(r,s)=>Me(r).endsWith(Me(s)),i=(r,s,u)=>{const h=Me(r);if(s instanceof RegExp)return h.replace(Bl(s),Me(u));const m=Me(s);return m?h.split(m).join(Me(u)):h},n=(r,s,u)=>{const h=Me(r),m=Number.isFinite(oi(u))?Math.trunc(oi(u)):0;return h.indexOf(Me(s),m)},a=(r,s,u)=>{const h=Me(r),m=Number.isFinite(oi(u))?Math.trunc(oi(u)):h.length;return h.lastIndexOf(Me(s),m)};return{length:r=>Me(r).length,upper:r=>Me(r).toUpperCase(),lower:r=>Me(r).toLowerCase(),trim:r=>Me(r).trim(),trim_left:r=>Me(r).trimStart(),trim_right:r=>Me(r).trimEnd(),trimLeft:r=>Me(r).trimStart(),trimRight:r=>Me(r).trimEnd(),startswith:e,starts_with:e,startsWith:e,endswith:t,ends_with:t,endsWith:t,contains:(r,s)=>Me(r).includes(Me(s)),indexof:n,indexOf:n,last_indexof:a,lastIndexOf:a,pos:n,last_pos:a,count:(r,s)=>{const u=Me(r),h=Me(s);if(!h)return 0;let m=0,_=0;for(;;){const A=u.indexOf(h,m);if(A===-1)break;_+=1,m=A+h.length}return _},char:(r,s)=>{const u=Me(r),h=zn(s,u.length,0);return u.charAt(h)},substring:(r,s,u)=>{const h=Me(r),m=zn(s,h.length,0),_=u==null?h.length:zn(u,h.length,h.length);return h.substring(m,_)},slice:(r,s,u)=>{const h=Me(r),m=zn(s,h.length,0),_=u==null?h.length:zn(u,h.length,h.length);return h.slice(m,_)},repeat:(r,s)=>{const u=Me(r),h=Math.max(0,Math.trunc(oi(s)));return Number.isFinite(h)?u.repeat(h):""},reverse:r=>Me(r).split("").reverse().join(""),replace:(r,s,u)=>{const h=Me(r);return s instanceof RegExp?h.replace(s,Me(u)):h.replace(Me(s),Me(u))},replace_all:i,replaceAll:i,split:(r,s,u)=>{const h=Me(r),m=Number.isFinite(oi(u))?Math.max(0,Math.trunc(oi(u))):void 0;return s==null?m==null?[h]:[h].slice(0,m):s instanceof RegExp?h.split(s,m):h.split(Me(s),m)},join:(r,s)=>Array.isArray(r)?r.map(u=>Me(u)).join(s==null?",":Me(s)):Me(r),pad_left:(r,s,u)=>{const h=Me(r),m=Math.max(0,Math.trunc(oi(s))),_=u==null?" ":Me(u);return h.padStart(m,_)},pad_right:(r,s,u)=>{const h=Me(r),m=Math.max(0,Math.trunc(oi(s))),_=u==null?" ":Me(u);return h.padEnd(m,_)},padLeft:(r,s,u)=>Me(r).padStart(Math.max(0,Math.trunc(oi(s))),u==null?" ":Me(u)),padRight:(r,s,u)=>Me(r).padEnd(Math.max(0,Math.trunc(oi(s))),u==null?" ":Me(u)),format:(r,...s)=>{let h=Me(r).replace(/\{(\d+)\}/g,(_,A)=>{const D=s[Number(A)];return Me(D)}),m=0;return h=h.replace(/\{\}/g,()=>Me(s[m++])),h},tostring:(r,s)=>{const u=Xr(r);return typeof u=="number"?$l(u,s):Me(u)},tonumber:(r,s,u)=>{const h=Me(r).trim(),m=Number.isFinite(oi(u))&&Math.trunc(oi(u))>=2?Math.trunc(oi(u)):void 0,_=m!=null?Number.parseInt(h,m):Number(h);if(Number.isFinite(_))return _;const A=oi(s);return Number.isFinite(A)?A:NaN}}};function tn(e){return!Number.isFinite(e)||e<=0?0:e<1e11?e*1e3:e}function Dl(e){const t=new Date(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0)}function jl(e){const t=new Date(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1,0,0,0,0)}function zl(e){const t=String(e||"").trim(),i=t.toUpperCase();if(!i)return null;if(i==="D"||i==="1D")return{kind:"calendar",unit:"D"};if(i==="W"||i==="1W")return{kind:"calendar",unit:"W"};if(t==="M"||t==="1M")return{kind:"calendar",unit:"M"};if(/^\d+$/.test(i))return{kind:"fixed",ms:Math.max(1,Number(i))*60*1e3};const n=i.match(/^(\d+)\s*([A-Z]+)$/);if(n){const a=Math.max(1,Number(n[1])),r=n[2];if(r==="S"||r==="SEC"||r==="SECS"||r==="SECOND"||r==="SECONDS")return{kind:"fixed",ms:a*1e3};if(r==="H"||r==="HR"||r==="HRS")return{kind:"fixed",ms:a*60*60*1e3};if(r==="MIN"||r==="MINS")return{kind:"fixed",ms:a*60*1e3};if(r==="M"&&t.toLowerCase().endsWith("m"))return{kind:"fixed",ms:a*60*1e3};if(r==="D"||r==="DAY"||r==="DAYS")return{kind:"fixed",ms:a*24*60*60*1e3};if(r==="W"||r==="WK"||r==="WEEK"||r==="WEEKS")return{kind:"fixed",ms:a*7*24*60*60*1e3}}return null}const ba=new Map,_a=new Map;function Ul(e){const t=e||"UTC",i=ba.get(t);if(i)return i;const n=new Intl.DateTimeFormat("en-GB",{timeZone:t,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return ba.set(t,n),n}function Wl(e){const t=e||"UTC",i=_a.get(t);if(i)return i;const n=new Intl.DateTimeFormat("en-GB",{timeZone:t,weekday:"short"});return _a.set(t,n),n}function _r(e,t){if(!Number.isFinite(e))return null;const n=Ul(t).formatToParts(new Date(e)),a={};for(const A of n)(A.type==="year"||A.type==="month"||A.type==="day"||A.type==="hour"||A.type==="minute"||A.type==="second")&&(a[A.type]=A.value);const r=Number(a.year),s=Number(a.month),u=Number(a.day),h=Number(a.hour),m=Number(a.minute),_=Number(a.second);return[r,s,u,h,m,_].every(A=>Number.isFinite(A))?{y:r,m:s,d:u,h,min:m,s:_}:null}function Ql(e,t){const n=Wl(t).format(new Date(e));return{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}[n]??null}function vr(e,t){const i=_r(e,t);return i?Date.UTC(i.y,i.m-1,i.d,i.h,i.min,i.s,0)-e:0}function va(e,t){const i=_r(e,t);if(!i)return Dl(e);let n=Date.UTC(i.y,i.m-1,i.d,0,0,0,0);const a=vr(n,t);n=n-a;const r=vr(n,t);return n-r}function Gl(e,t){const i=va(e,t),n=Ql(e,t);return i-(typeof n=="number"?n:0)*24*60*60*1e3}function Kl(e,t){const i=_r(e,t);if(!i)return jl(e);let n=Date.UTC(i.y,i.m-1,1,0,0,0,0);const a=vr(n,t);n=n-a;const r=vr(n,t);return n-r}function Un(e,t,i){if(!t)return e;if(t.kind==="fixed")return Math.floor(e/t.ms)*t.ms;const n=i||"UTC";return t.unit==="D"?va(e,n):t.unit==="W"?Gl(e,n):Kl(e,n)}function Hl(e){const t=String(e||"").trim();if(!t)return[];if(t.toLowerCase()==="24x7"||t==="0000-2359")return[];const i=t.split(/[;,]/).map(a=>a.trim()).filter(Boolean),n=[];for(const a of i){const r=a.match(/(\d{1,2}):?(\d{2})\s*-\s*(\d{1,2}):?(\d{2})/);if(!r)continue;const s=Number(r[1]),u=Number(r[2]),h=Number(r[3]),m=Number(r[4]);if([s,u,h,m].some(D=>!Number.isFinite(D)))continue;const _=s*60+u,A=h*60+m;n.push({start:_,end:A})}return n}function Zr(e,t,i){const n=Hl(t);if(!n.length)return!0;const r=_r(e,i||"UTC");if(!r)return!0;const s=r.h*60+r.min;for(const u of n)if(u.start<=u.end){if(s>=u.start&&s<=u.end)return!0}else if(s>=u.start||s<=u.end)return!0;return!1}function Jl(e){const t=[];let i=null;for(let n=0;n<e.length;n++){const a=tn(e[n]??0);if(a){if(i!=null){const r=a-i;r>0&&Number.isFinite(r)&&t.push(r)}if(i=a,t.length>=200)break}}return t.length<3?null:(t.sort((n,a)=>n-a),t[Math.floor(t.length/2)]??null)}const Wn=e=>!!e&&typeof e=="object"&&typeof e.get=="function"&&Array.isArray(e.data),es=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="boolean")return e?1:0;if(e==null)return NaN;const t=Number(e);return Number.isFinite(t)?t:NaN},Yl=e=>{let t=2166136261;for(let i=0;i<e.length;i++)t^=e.charCodeAt(i),t=Math.imul(t,16777619);return(t>>>0).toString(36)},wr=e=>String(e||"").trim().toLowerCase().replace(/\s+/g,""),wa=e=>{const t=String(e||"").trim();if(!t)return"__CURRENT__";const i=t.toUpperCase();if(i==="CURRENT"||i==="__CURRENT__"||i==="TIMEFRAME.PERIOD")return"__CURRENT__";if(i==="D"||i==="1D")return"1d";if(i==="W"||i==="1W")return"1w";if(i==="M"||i==="1M")return"1M";if(/^\d+$/.test(t))return`${t}m`;const n=i.match(/^(\d+)\s*H$/);if(n)return`${n[1]}h`;const a=i.match(/^(\d+)\s*S$/);if(a)return`${a[1]}s`;const r=t.match(/^(\d+)\s*([A-Za-z]+)$/);if(r){const s=r[1]||"1",u=(r[2]||"").toLowerCase();if(u.startsWith("min"))return`${s}m`;if(u.startsWith("sec"))return`${s}s`;if(u==="h"||u.startsWith("hr"))return`${s}h`;if(u==="d"||u.startsWith("day"))return`${s}d`;if(u==="w"||u.startsWith("wk"))return`${s}w`;if(u==="m"&&t.toLowerCase().endsWith("m"))return`${s}m`}return t},Xl=(e,t)=>`${e}|${wa(t)}`,Zl=e=>{const t=e.length,i=new Array(t),n=new Array(t),a=new Array(t),r=new Array(t),s=new Array(t),u=new Array(t),h=new Array(t);for(let m=0;m<t;m++){const _=e[m],A=Number(_==null?void 0:_.close),D=Number(_==null?void 0:_.open),C=Number(_==null?void 0:_.high),v=Number(_==null?void 0:_.low),S=tn((_==null?void 0:_.timestamp)??(_==null?void 0:_.time)??(_==null?void 0:_.t)??0);r[m]=Number.isFinite(A)?A:void 0,i[m]=Number.isFinite(D)?D:r[m],n[m]=Number.isFinite(C)?C:r[m]??i[m],a[m]=Number.isFinite(v)?v:r[m]??i[m];const U=Number(_==null?void 0:_.volume);s[m]=Number.isFinite(U)?U:0,u[m]=S||0,h[m]=m}return{open:i,high:n,low:a,close:r,volume:s,time:u,bar_index:h}},ec=(e,t)=>{let i=0,n=e.length;for(;i<n;){const a=i+n>>>1;(e[a]??0)>t?n=a:i=a+1}return i},tc=(e,t)=>{if(Wn(e)){if(e.data.length!==t)throw new Error("request.security: expression returned a series from a different timeframe");return es(e.get(0))}if(e&&typeof e=="object")throw new Error("request.security: expression must return a number or series");return es(e)},ic=e=>{if(e==null)return"off";if(typeof e=="boolean")return e?"on":"off";const t=String(e).trim().toLowerCase();return t==="on"||t==="true"||t==="yes"?"on":"off"},nc=e=>{if(e==null)return"off";if(typeof e=="boolean")return e?"on":"off";const t=String(e).trim().toLowerCase();return t==="on"||t==="true"||t==="yes"?"on":"off"},rc=e=>{const t=(e==null?void 0:e.timezone)??(e==null?void 0:e.tz);if(t==null)return;const i=String(t).trim();return i||void 0},sc=e=>{if((e==null?void 0:e.session)==null)return;const t=String(e.session).trim();return t||void 0},ac=e=>{const t=e.trim().toLowerCase();return t==="open"||t==="high"||t==="low"||t==="close"||t==="volume"||t==="time"||t==="bar_index"},oc=(e,t,i)=>{const n=e.close.length,a=new Array(n),r=new Array(n).fill(!1),s=[],u=[],h=[],m=[],_=[],A=[];let D=NaN,C=-1;for(let V=0;V<n;V++){const ne=tn(e.time[V]??0);if(!ne){a[V]=-1;continue}const he=Un(ne,t,i);if(!Number.isFinite(D)||he!==D){D=he,C+=1,A[C]=he;const me=e.close[V]??NaN;s[C]=e.open[V]??me,u[C]=e.high[V]??me,h[C]=e.low[V]??me,m[C]=me,_[C]=e.volume[V]??0}else{const me=e.high[V],_e=e.low[V],we=e.close[V];me!=null&&Number.isFinite(me)&&(u[C]=Math.max(u[C],me)),_e!=null&&Number.isFinite(_e)&&(h[C]=Math.min(h[C],_e)),we!=null&&Number.isFinite(we)&&(m[C]=we);const Te=e.volume[V];Te!=null&&Number.isFinite(Te)&&(_[C]+=Te)}a[V]=C}for(let V=0;V<n;V++){const ne=a[V],he=V+1<n?a[V+1]:ne;r[V]=ne>=0&&V+1<n&&ne!==he}const v=C+1,S=new Array(v);for(let V=0;V<v;V++)S[V]=V;return{map:a,isEnd:r,htf:{open:s,high:u,low:h,close:m,volume:_,time:A,bar_index:S}}},ts=(e,t,i,n)=>{const a=t.close.data.length;if(Wn(e)){if(e.data.length!==a){if(ac(e.name)){const s=t[e.name];if(s&&s.data.length===a)return s.data.map(u=>Number.isFinite(u)?u:void 0)}throw new Error("request.security: series input must match the requested timeframe")}return e.data.map(s=>Number.isFinite(s)?s:void 0)}if(typeof e=="number"||typeof e=="boolean"||e==null){const s=es(e);return new Array(a).fill(Number.isFinite(s)?s:void 0)}if(typeof e!="function")throw new Error("request.security: expression must be a function or series");const r=new Array(a);for(let s=0;s<a;s++){n.value=s;const u=e(t,i),h=tc(u,a);r[s]=Number.isFinite(h)?h:void 0}return r},lc=e=>{var Ct,y,c,M;const t=e.base,i=t.close.length,n=Jl(t.time),a=t.time.some(o=>tn(o??0)>0),r=((Ct=e.mtf)==null?void 0:Ct.sources)??{},s=String(((y=e.mtf)==null?void 0:y.baseSymbol)||"__CURRENT__").trim(),u=wr(s||"__CURRENT__"),h=((c=e.mtf)==null?void 0:c.collectOnly)===!0,m=new Map;if((M=e.mtf)!=null&&M.symbolAliases)for(const[o,f]of Object.entries(e.mtf.symbolAliases))!o||!f||m.set(wr(o),String(f));const _=new Map,A=new WeakMap;let D=0,C=0,v=0;const S=6,U=[],V=[],ne=new Map,he=Xn({open:t.open,high:t.high,low:t.low,close:t.close,volume:t.volume,time:t.time,barIndex:t.bar_index,indexRef:e.baseIndexRef,params:e.params}),me={ta:pr(he,e.baseIndexRef),math:gr(e.baseIndexRef),color:xr(),str:br()},_e=o=>{const f=String(o??"").trim();if(!f)return{key:u,label:s};const P=f.toLowerCase();if(P==="syminfo.tickerid"||P==="syminfo.ticker"||P==="syminfo.root"||P==="__current__"||P==="__current_symbol__")return{key:u,label:s};const Y=m.get(wr(f))||f;return{key:wr(Y),label:Y}},we=o=>{const f=A.get(o);if(f)return f;const P=++D;return A.set(o,P),P},Te=o=>{const P=String(o||"").replace(/\s+/g," ").trim();return!P||P.includes("[native code]")?`fn_${we(o)}`:`fn_${Yl(P)}`},Fe=(o,f,P,I,Y,X,B,te)=>{let ie="expr";return typeof B=="function"?ie=Te(B):Wn(B)?ie=`series_${B.name}`:ie=`const_${String(B)}`,[o,f||"__CURRENT__",P,I,Y||"",X||"",ie,te?"ltf":"htf"].join("|")},Ne=(o,f,P,I,Y,X=!1)=>{if(C>=S)throw new Error("request.security: nesting limit exceeded");C+=1;try{const B=String(P||"").trim(),te=ic(Y==null?void 0:Y.lookahead),ie=nc(Y==null?void 0:Y.gaps),ae=rc(Y),fe=sc(Y),ee=Xl(o,B),ue=Fe(o,B,te,ie,ae,fe,I,X),De=_.get(ue);if(De)return De.ref;if(v+=1,v>Hi.maxSecurityCalls)throw new Error(`JS guardrail: request.security call limit exceeded (max ${Hi.maxSecurityCalls})`);const Ge=()=>{const je=new Array(i).fill(void 0),ot=ni(`__js_sec_${_.size+1}`,je,e.baseIndexRef);return _.set(ue,{ref:ot}),ot};if(!B||B.toLowerCase()==="current"||B==="__CURRENT__"){let je=ts(I,he,me,e.baseIndexRef);ie==="on"&&(je=je.map((Vt,$t)=>{const Nt=tn(t.time[$t]??0);return Zr(Nt,fe,ae)?Vt:void 0}));const ot=ni(`__js_sec_${_.size+1}`,je,e.baseIndexRef);return _.set(ue,{ref:ot}),ot}const Ye=zl(B);if(!Ye)throw new Error(`request.security: invalid timeframe "${B}"`);if(!a)throw new Error("request.security: base time series is missing");const Ae=n,ft=Ye.kind==="fixed"?Ye.ms:Ye.unit==="D"?24*60*60*1e3:Ye.unit==="W"?7*24*60*60*1e3:30*24*60*60*1e3;if(X&&Ae!=null&&ft>=Ae)throw new Error(`request.security_lower_tf: "${B}" must be lower than chart timeframe`);const pt=r[ee];if(!pt&&h){if(typeof I=="function")try{I(he,me)}catch{}return V.push(ee),Ge()}if(pt&&Array.isArray(pt.candles)){const je=ne.get(ee)||Zl(pt.candles);if(ne.set(ee,je),!je.close.length){if(h)return V.push(ee),Ge();throw new Error(`request.security: no data for ${f} (${wa(B)})`)}const ot={value:0},Vt=Xn({open:je.open,high:je.high,low:je.low,close:je.close,volume:je.volume,time:je.time,barIndex:je.bar_index,indexRef:ot,params:e.params}),$t={ta:pr(Vt,ot),math:gr(ot),color:xr(),str:br()},Nt=ts(I,Vt,$t,ot),Tt=new Array(i),gt=je.time,Ze=Ae??0,Rt=new Array(i),N=new Array(i);for(let j=0;j<i;j++){const K=tn(t.time[j]??0);if(!K){Rt[j]=-1;continue}let $=K;if(j+1<i){const se=tn(t.time[j+1]??0);se&&se>K&&($=se-1)}else Ze>0&&($=K+Ze-1);const ve=ec(gt,$);Rt[j]=ve-1}for(let j=0;j<i;j++){const K=Rt[j],$=j+1<i?Rt[j+1]:K;N[j]=K>=0&&j+1<i&&K!==$}for(let j=0;j<i;j++){const K=Rt[j];if(K<0||K>=Nt.length){Tt[j]=void 0;continue}const $=tn(t.time[j]??0);if(ie==="on"&&!Zr($,fe,ae)){Tt[j]=void 0;continue}const ve=te==="on"||N[j]?Nt[K]:K>0?Nt[K-1]:NaN;let se=Number.isFinite(ve)?ve:void 0;if(ie==="on"){const ge=Un($,Ye,ae),$e=Un(gt[K]??0,Ye,ae);ge!==$e&&(se=void 0)}Tt[j]=se}const g=ni(`__js_sec_${_.size+1}`,Tt,e.baseIndexRef);return _.set(ue,{ref:g}),g}if(Ye.kind==="fixed"&&n!=null&&Ye.ms<n){if(h)return V.push(ee),Ge();throw X?new Error(`request.security_lower_tf: lower timeframe "${B}" is not available from current chart data (base ~${Math.round(n/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`):new Error(`request.security: lower timeframe "${B}" is not available from current chart data (base ~${Math.round(n/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`)}const{map:qt,isEnd:Ut,htf:qe}=oc(t,Ye,ae);if(!qe.close.length)return h&&V.push(ee),Ge();const Lt={value:0},wt=Xn({open:qe.open,high:qe.high,low:qe.low,close:qe.close,volume:qe.volume,time:qe.time,barIndex:qe.bar_index,indexRef:Lt,params:e.params}),at={ta:pr(wt,Lt),math:gr(Lt),color:xr(),str:br()},Pe=ts(I,wt,at,Lt),jt=new Array(i);for(let je=0;je<i;je++){const ot=qt[je];if(ot<0||ot>=Pe.length){jt[je]=void 0;continue}const Vt=tn(t.time[je]??0);if(ie==="on"&&!Zr(Vt,fe,ae)){jt[je]=void 0;continue}const $t=te==="on"||Ut[je]?Pe[ot]:ot>0?Pe[ot-1]:NaN;let Nt=Number.isFinite($t)?$t:void 0;if(ie==="on"){const Tt=Un(Vt,Ye,ae),gt=Un(qe.time[ot]??0,Ye,ae);Tt!==gt&&(Nt=void 0)}jt[je]=Nt}const Ke=ni(`__js_sec_${_.size+1}`,jt,e.baseIndexRef);return _.set(ue,{ref:Ke}),Ke}finally{C=Math.max(0,C-1)}};return{request:{security:(...o)=>{const f=o;if(!f.length)throw new Error("request.security requires a timeframe");const P=f[0],I=f[1],Y=f[2],X=f[3],B=ue=>typeof ue=="function"||typeof ue=="number"||Wn(ue)||ue==null;let te=null,ie=P,ae=I,fe;if(f.length>=3&&typeof P=="string"&&B(Y)?(te=String(P||"").trim(),ie=I,ae=Y,fe=X&&typeof X=="object"?X:void 0):(ie=P,ae=I,fe=Y&&typeof Y=="object"?Y:void 0),ae==null)throw new Error("request.security requires an expression or series");const ee=_e(te);return U.push({symbol:te?String(te):void 0,timeframe:String(ie??""),options:fe?{...fe}:void 0,lower:!1}),Ne(ee.key,ee.label,String(ie??""),ae,fe,!1)},security_lower_tf:(...o)=>{const f=o;if(!f.length)throw new Error("request.security_lower_tf requires a timeframe");const P=f[0],I=f[1],Y=f[2],X=f[3],B=ue=>typeof ue=="function"||typeof ue=="number"||Wn(ue)||ue==null;let te=null,ie=P,ae=I,fe;if(f.length>=3&&typeof P=="string"&&B(Y)?(te=String(P||"").trim(),ie=I,ae=Y,fe=X&&typeof X=="object"?X:void 0):(ie=P,ae=I,fe=Y&&typeof Y=="object"?Y:void 0),ae==null)throw new Error("request.security_lower_tf requires an expression or series");const ee=_e(te);return U.push({symbol:te?String(te):void 0,timeframe:String(ie??""),options:fe?{...fe}:void 0,lower:!0}),Ne(ee.key,ee.label,String(ie??""),ae,fe,!0)}},mtfRequests:U,mtfMissing:V}};function vt(e,t){const i=typeof e=="number"?e:Number(e);return Number.isFinite(i)?i:t}function Na(e,t="start"){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e))return e>1e11?Math.floor(e):Math.floor(e*1e3);const i=String(e).trim();if(!i)return null;if(/^\d+$/.test(i)){const r=Number(i);if(Number.isFinite(r))return r>1e11?Math.floor(r):Math.floor(r*1e3)}const n=i.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n){const r=Number(n[1]),s=Number(n[2])-1,u=Number(n[3]);if([r,s,u].every(h=>Number.isFinite(h))){const h=Date.UTC(r,s,u);return Number.isFinite(h)?t==="end"?h+86399999:h:null}}const a=Date.parse(i);return Number.isFinite(a)?a:null}function cc(e){if(!e)return null;const t=String(e).trim();if(!t)return null;const i=t.match(/^(\d{2})(?::?(\d{2}))?\s*-\s*(\d{2})(?::?(\d{2}))?$/);if(!i)return null;const n=Number(i[1]),a=Number(i[2]||"0"),r=Number(i[3]),s=Number(i[4]||"0");return![n,a,r,s].every(u=>Number.isFinite(u))||n<0||n>23||r<0||r>23||a<0||a>59||s<0||s>59?null:{startMin:n*60+a,endMin:r*60+s}}function uc(e){if(e===!0)return{enabled:!0,execution:"intrabar_ohlc",intrabarTieBreak:"worst_case",ohlcPath:"open_high_low_close",intrabarTicks:6,initialCapital:1e4,fromTs:null,toTs:null,session:null,orderSize:{type:"percent_of_equity",value:100},commissionPct:0,commissionCash:null,commissionPerUnit:null,commissionType:"percent",slippagePct:0,slippageAbs:null,slippageTicks:null,slippageType:"percent",priceTick:null,qtyStep:null,minQty:null,spreadPct:null,leverage:1,maintenanceMarginPct:null,liquidationFeePct:null,borrowPctPerYear:null,fundingPctPerDay:null,positionMode:"netting",closeMethod:"fifo",pyramiding:1,timeInForce:"gtc",fillMode:"full",volumeFillPct:100,stopLossPct:null,takeProfitPct:null,takeProfits:[],trailingStopPct:null,maxDrawdownPct:null,maxDrawdownCash:null,maxPositionPct:null,maxPositionCash:null,maxPositionQty:null,maxIntradayFilledOrders:null,maxIntradayLossPct:null,maxIntradayLossCash:null,allowLong:!0,allowShort:!0,closeOnEnd:!0};if(!e||typeof e!="object")return null;const t=e;if(t.enabled===!1)return null;const i=String(t.execution||t.exec||t.mode||"").trim().toLowerCase()||"intrabar_ohlc",n=i==="bar_close"||i==="barclose"||i==="close"?"bar_close":i==="intrabar_ticks"||i==="intrabarticks"||i==="ticks"?"intrabar_ticks":"intrabar_ohlc",a=String(t.intrabarTieBreak||t.tieBreak||"").trim().toLowerCase(),r=a==="best_case"||a==="best"||a==="tp"?"best_case":a==="ohlc"||a==="path"?"ohlc":"worst_case",s=String(t.ohlcPath||t.path||"").trim().toLowerCase(),u=s==="open_low_high_close"||s==="olhc"?"open_low_high_close":"open_high_low_close",h=t.intrabarTicks??t.ticks??t.tickCount??t.intrabarTickCount??null,m=Math.max(2,Math.min(100,Math.floor(vt(h,6)))),_=Math.max(0,vt(t.initialCapital,1e4)),A=Math.max(0,vt(t.commissionPct,0)),D=t.commissionCash??t.commission_cash??t.commissionFixed??t.commission_fixed??null,C=t.commissionPerUnit??t.commission_per_unit??t.commissionPerShare??t.commission_per_share??null,v=D==null?null:Math.max(0,vt(D,0)),S=C==null?null:Math.max(0,vt(C,0)),U=String(t.commissionType??t.commission_mode??t.commissionMode??"").trim().toLowerCase(),V=S!=null||U==="per_unit"?"per_unit":v!=null||U==="cash"?"cash":"percent",ne=Math.max(0,vt(t.slippagePct??t.slippage??t.slippage_percent,0)),he=t.slippageAbs??t.slippage_abs??null,me=t.slippageTicks??t.slippage_ticks??t.slippageTick??null,_e=he==null?null:Math.max(0,vt(he,0)),we=me==null?null:Math.max(0,vt(me,0)),Te=String(t.slippageType??t.slippage_mode??t.slippageMode??"").trim().toLowerCase(),Fe=we!=null||Te==="ticks"?"ticks":_e!=null||Te==="abs"?"abs":"percent",Ne=t.priceTick??t.price_tick??t.tickSize??t.tick_size??t.tick??t.minTick??t.min_tick??null,ze=t.qtyStep??t.qty_step??t.quantityStep??t.quantity_step??t.lotStep??t.lot_step??null,Ce=t.minQty??t.min_qty??t.minimumQty??t.minimum_qty??null,Ct=Ne==null?null:Math.max(0,vt(Ne,0)),y=ze==null?null:Math.max(0,vt(ze,0)),c=Ce==null?null:Math.max(0,vt(Ce,0)),M=t.spreadPct??t.spread_pct??t.spread??t.spreadBps??t.spread_bps??null,o=(()=>{if(M==null)return null;const w=vt(M,0);return!Number.isFinite(w)||w<=0?null:"spreadBps"in t||"spread_bps"in t?w/100:w})(),f=t.leverage??t.lev??t.marginLeverage??t.margin_leverage??1,P=Math.max(1,vt(f,1)),I=t.maintenanceMarginPct??t.maintenance_margin_pct??t.maintMarginPct??null,Y=t.liquidationFeePct??t.liquidation_fee_pct??t.liqFeePct??null,X=t.borrowPctPerYear??t.borrow_pct_per_year??t.shortBorrowPctPerYear??null,B=t.fundingPctPerDay??t.funding_pct_per_day??t.funding??null,te=I==null?null:Math.max(0,vt(I,0)),ie=Y==null?null:Math.max(0,vt(Y,0)),ae=X==null?null:Math.max(0,vt(X,0)),fe=B==null?null:Math.max(0,vt(B,0)),ee=String(t.positionMode??t.position_mode??"").trim().toLowerCase(),ue=ee==="hedge"||ee==="hedging"?"hedging":"netting",De=String(t.closeMethod??t.close_method??t.costBasis??t.cost_basis??"").trim().toLowerCase(),Ge=De==="lifo"?"lifo":De==="avg"||De==="average"?"avg":"fifo",Ye=Math.max(1,Math.min(50,Math.floor(vt(t.pyramiding??t.maxEntries??t.max_positions??t.maxPositions??1,1)))),Ae=String(t.timeInForce??t.tif??t.orderTif??t.order_tif??"").trim().toLowerCase(),ft=Ae==="ioc"||Ae==="immediate_or_cancel"?"ioc":Ae==="fok"||Ae==="fill_or_kill"?"fok":"gtc",pt=String(t.fillMode??t.fill_mode??"").trim().toLowerCase(),qt=pt==="volume"||pt==="partial"||t.partialFills?"volume":"full",Ut=Math.max(0,Math.min(100,vt(t.volumeFillPct??t.volume_fill_pct??t.fillPct??100,100))),qe=t.stopLossPct??t.slPct??t.sl??t.stopLoss??t.stop_loss??null,Lt=t.takeProfitPct??t.tpPct??t.tp??t.takeProfit??t.take_profit??null,wt=t.trailingStopPct??t.trailPct??t.trailing??t.trailingStop??null,at=qe==null?null:Math.max(0,vt(qe,0)),Pe=Lt==null?null:Math.max(0,vt(Lt,0)),jt=wt==null?null:Math.max(0,vt(wt,0)),Ke=typeof t.allowLong=="boolean"?t.allowLong:t.allowLong!==!1,je=typeof t.allowShort=="boolean"?t.allowShort:t.allowShort!==!1,ot=typeof t.closeOnEnd=="boolean"?t.closeOnEnd:t.closeOnEnd!==!1,Vt=Na(t.from??t.start??t.startDate??t.dateFrom??t.fromDate??t.rangeStart,"start")??null,$t=Na(t.to??t.end??t.endDate??t.dateTo??t.toDate??t.rangeEnd,"end")??null,Nt=cc(t.session??t.tradingSession??t.sessionTime),Tt=t.takeProfits??t.tpLevels??t.takeProfitLevels??[],gt=[];if(Array.isArray(Tt))for(const w of Tt){if(!w||typeof w!="object")continue;const O=vt(w.takeProfitPct??w.tpPct??w.pct,NaN),H=vt(w.qtyPct??w.qty??w.percent,NaN);!Number.isFinite(O)||O<=0||!Number.isFinite(H)||H<=0||gt.push({takeProfitPct:O,qtyPct:Math.max(0,Math.min(100,H))})}gt.sort((w,O)=>w.takeProfitPct-O.takeProfitPct);const Ze=t.risk&&typeof t.risk=="object"?t.risk:{},Rt=w=>{if(w==null)return null;const O=vt(w,NaN);return Number.isFinite(O)?O:null},N=Rt(t.maxDrawdownPct??t.max_drawdown_pct??Ze.maxDrawdownPct??Ze.max_drawdown_pct??Ze.max_drawdown)??null,g=Rt(t.maxDrawdownCash??t.max_drawdown_cash??Ze.maxDrawdownCash??Ze.max_drawdown_cash)??null,j=Rt(t.maxPositionPct??t.max_position_pct??Ze.maxPositionPct??Ze.max_position_pct??Ze.max_position_size)??null,K=Rt(t.maxPositionCash??t.max_position_cash??Ze.maxPositionCash??Ze.max_position_cash)??null,$=Rt(t.maxPositionQty??t.max_position_qty??Ze.maxPositionQty??Ze.max_position_qty??Ze.max_contracts)??null,ve=Rt(t.maxIntradayFilledOrders??t.max_intraday_filled_orders??Ze.maxIntradayFilledOrders??Ze.max_intraday_filled_orders)??null,se=Rt(t.maxIntradayLossPct??t.max_intraday_loss_pct??Ze.maxIntradayLossPct??Ze.max_intraday_loss_pct??Ze.max_intraday_loss)??null,ge=Rt(t.maxIntradayLossCash??t.max_intraday_loss_cash??Ze.maxIntradayLossCash??Ze.max_intraday_loss_cash)??null;let $e=0;const Je=[];for(const w of gt){if($e>=100)break;const O=100-$e,H=Math.min(O,w.qtyPct);H<=0||(Je.push({takeProfitPct:w.takeProfitPct,qtyPct:H}),$e+=H)}const k=t.orderSize??t.positionSize??t.order??null;let R={type:"percent_of_equity",value:100};if(k&&typeof k=="object"){const w=String(k.type||"").trim().toLowerCase(),O=vt(k.value,100);w==="cash"?R={type:"cash",value:Math.max(0,O)}:w==="qty"?R={type:"qty",value:Math.max(0,O)}:w?R={type:"percent_of_equity",value:Math.max(0,Math.min(100,O))}:R={type:"percent_of_equity",value:Math.max(0,Math.min(100,O))}}else if(k!=null){const w=vt(k,100);R={type:"percent_of_equity",value:Math.max(0,Math.min(100,w))}}return{enabled:!0,execution:n,intrabarTieBreak:r,ohlcPath:u,intrabarTicks:m,initialCapital:_,fromTs:Vt,toTs:$t,session:Nt,orderSize:R,commissionPct:A,commissionCash:v,commissionPerUnit:S,commissionType:V,slippagePct:ne,slippageAbs:_e,slippageTicks:we,slippageType:Fe,priceTick:Ct&&Ct>0?Ct:null,qtyStep:y&&y>0?y:null,minQty:c&&c>0?c:null,spreadPct:o&&o>0?o:null,leverage:P,maintenanceMarginPct:te&&te>0?te:null,liquidationFeePct:ie&&ie>0?ie:null,borrowPctPerYear:ae&&ae>0?ae:null,fundingPctPerDay:fe&&fe>0?fe:null,positionMode:ue,closeMethod:Ge,pyramiding:Ye,timeInForce:ft,fillMode:qt,volumeFillPct:Ut,stopLossPct:at!=null&&at>0?at:null,takeProfitPct:Pe!=null&&Pe>0?Pe:null,takeProfits:Je,trailingStopPct:jt!=null&&jt>0?jt:null,maxDrawdownPct:N!=null&&N>0?N:null,maxDrawdownCash:g!=null&&g>0?g:null,maxPositionPct:j!=null&&j>0?j:null,maxPositionCash:K!=null&&K>0?K:null,maxPositionQty:$!=null&&$>0?$:null,maxIntradayFilledOrders:ve!=null&&ve>0?Math.floor(ve):null,maxIntradayLossPct:se!=null&&se>0?se:null,maxIntradayLossCash:ge!=null&&ge>0?ge:null,allowLong:Ke,allowShort:je,closeOnEnd:ot}}function ka(e){return e==="cancel"||e==="cancel_all"?0:e==="exit_long"?1:e==="exit_short"?2:e==="entry_long"?3:e==="entry_short"?4:9}function Nr(e){const t=e==null?void 0:e.close;return typeof t=="number"&&Number.isFinite(t)?t:null}function is(e){return typeof e=="number"&&Number.isFinite(e)?e:null}function fc(e){const t=Nr(e);if(t==null)return null;const i=is(e==null?void 0:e.open)??t,n=is(e==null?void 0:e.high)??Math.max(i,t),a=is(e==null?void 0:e.low)??Math.min(i,t);return{o:i,h:n,l:a,c:t}}function hc(e,t,i){var Da,ja,za,Ua,Wa;const n=i.initialCapital,a=i.commissionPct/100,r=i.commissionCash,s=i.commissionPerUnit,u=i.commissionType,h=i.slippagePct/100,m=i.slippageAbs,_=i.slippageTicks,A=i.slippageType,D=i.priceTick&&i.priceTick>0?i.priceTick:null,C=i.qtyStep&&i.qtyStep>0?i.qtyStep:null,v=i.minQty&&i.minQty>0?i.minQty:null,S=i.spreadPct&&i.spreadPct>0?i.spreadPct/100:0,U=S>0?S/2:0,V=Math.max(1,Number(i.leverage)||1),ne=i.maintenanceMarginPct&&i.maintenanceMarginPct>0?i.maintenanceMarginPct/100:null,he=i.liquidationFeePct&&i.liquidationFeePct>0?i.liquidationFeePct/100:null,me=i.borrowPctPerYear&&i.borrowPctPerYear>0?i.borrowPctPerYear/100:null,_e=i.fundingPctPerDay&&i.fundingPctPerDay>0?i.fundingPctPerDay/100:null,we=i.maxDrawdownPct&&i.maxDrawdownPct>0?i.maxDrawdownPct/100:null,Te=i.maxDrawdownCash&&i.maxDrawdownCash>0?i.maxDrawdownCash:null,Fe=i.maxPositionPct&&i.maxPositionPct>0?i.maxPositionPct/100:null,Ne=i.maxPositionCash&&i.maxPositionCash>0?i.maxPositionCash:null,ze=i.maxPositionQty&&i.maxPositionQty>0?i.maxPositionQty:null,Ce=i.maxIntradayFilledOrders&&i.maxIntradayFilledOrders>0?Math.floor(i.maxIntradayFilledOrders):null,Ct=i.maxIntradayLossPct&&i.maxIntradayLossPct>0?i.maxIntradayLossPct/100:null,y=i.maxIntradayLossCash&&i.maxIntradayLossCash>0?i.maxIntradayLossCash:null,c=(l,p,b)=>{const L=(b==null?void 0:b.commissionMode)??u,q=(b==null?void 0:b.commissionValue)??(L==="per_unit"?s:L==="cash"?r:a);return Number.isFinite(q)?L==="cash"?Math.max(0,q):L==="per_unit"?Math.max(0,q*Math.max(0,l)):Math.max(0,p*Math.max(0,q)):0},M=(l,p)=>{const b=(p==null?void 0:p.slippageMode)??A,L=(p==null?void 0:p.slippageValue)??(b==="ticks"?_:b==="abs"?m:h);return Number.isFinite(L)?b==="ticks"?D?Math.max(0,L*D):0:b==="abs"?Math.max(0,L):Math.max(0,l*Math.max(0,L)):0},o=l=>{if(!Number.isFinite(l)||l<=0)return 0;const p=String(l),b=p.match(/e-(\d+)$/i);if(b)return Math.max(0,Math.min(12,Number(b[1])||0));const L=p.indexOf(".");return L>=0?Math.max(0,Math.min(12,p.length-L-1)):0},f=(l,p,b)=>{if(!Number.isFinite(l))return NaN;if(!Number.isFinite(p)||p<=0)return l;const L=o(p),q=Math.pow(10,L),z=Math.round(p*q);if(!Number.isFinite(z)||z<=0)return l;const E=l*q;return(b==="ceil"?Math.ceil(E/z-1e-12):b==="round"?Math.round(E/z):Math.floor(E/z+1e-12))*z/q},P=(l,p)=>C?f(l,C,p):l,I=(l,p)=>l==="entry"?p==="long":p==="short",Y=(l,p)=>U?I(l,p)?1+U:1-U:1,X=(l,p,b)=>{const L=Y(p,b);return L===1?l:{o:l.o*L,h:l.h*L,l:l.l*L,c:l.c*L}},B=(l,p,b,L)=>{if(!D)return L;const q=I(l,p);return f(L,D,b==="limit"?q?"floor":"ceil":q?"ceil":"floor")},te=(l,p,b)=>{if(!D)return b;const q=I(l,p)?"ceil":"floor";return f(b,D,q)};let ie=0,ae=0;const fe={long:[],short:[]},ee=l=>fe[l],ue=l=>ee(l).some(p=>p.qty>1e-12),De=()=>ue("long")||ue("short"),Ge=l=>ee(l).filter(p=>p.qty>1e-12).length,Ye=l=>l==="long"?"short":"long",Ae=[],ft=[],pt=[],qt=new Map;let Ut=1;const qe=[],Lt=()=>`o${Ut++}`,wt=l=>{var b;const p=Number((b=e[l])==null?void 0:b.timestamp);return Number.isFinite(p)&&p>0?p:Date.now()},at=l=>{const p=Lt(),b={id:p,...l};return pt.push(b),qt.set(p,b),b},Pe=(l,p)=>{if(!l)return;const b=qt.get(l);b&&Object.assign(b,p)},jt=l=>{const p=l.id?qt.get(l.id):null;if(!p)return;const b=Number.isFinite(p.fillQty)?p.fillQty:0,L=Number.isFinite(p.fillPrice)?p.fillPrice:0,q=Number.isFinite(l.qty)?l.qty:0,z=b+q,E=z>0?(L*b+l.price*q)/z:l.price,x=(Number.isFinite(p.fees)?p.fees:0)+(Number.isFinite(l.fees)?l.fees:0);p.fillQty=z,p.fillPrice=E,p.fees=x,p.filledIndex=l.index,p.filledTimestamp=l.timestamp,l.targetQty!=null&&(p.targetQty=l.targetQty),l.remainingQty!=null&&(p.remainingQty=l.remainingQty),l.status&&(p.status=l.status),l.note&&(p.note=l.note)},Ke=e.length,je={initialCapital:n,finalEquity:n,netPnl:0,netPnlPct:0,grossProfit:0,grossLoss:0,profitFactor:0,trades:0,roundTrips:0,wins:0,losses:0,winRate:0,maxDrawdownPct:0,maxDrawdownValue:0,feesPaid:0,avgTrade:0,avgWin:0,avgLoss:0,payoffRatio:0,expectancy:0,maxConsecWins:0,maxConsecLosses:0,exposurePct:0,maxRunupPct:0,maxRunupValue:0,avgBarsInTrade:0,volatilityPct:0,sharpe:0,sortino:0,calmar:0};if(!Ke)return{summary:je,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]};const ot=new Array(Ke).fill(0),Vt=new Array(Ke).fill(0),$t=new Array(Ke).fill(0),Nt=new Array(Ke).fill(0),Tt=new Array(Ke).fill(0),gt=new Array(Ke).fill(0),Ze=new Array(Ke).fill(0),Rt=new Array(Ke).fill(0),N=new Array(Ke).fill(0),g=new Array(Ke).fill(0),j=new Array(Ke).fill(0),K=new Array(Ke).fill(0),$=new Array(Ke).fill(0),ve=new Array(Ke).fill(0),se=new Array(Ke).fill(0),ge=new Array(Ke).fill(0),$e=new Array(Ke).fill(0),Je=new Array(Ke).fill(0),k=new Array(Ke).fill(0),R=new Array(Ke).fill(n),w=new Array(Ke).fill(0),O=Array.from({length:Ke},()=>[]);let H=0,G=0,W=0,re=0,oe=0,ce=0,J=0,Ie="",Ue=n,et=!1;const Bt=i.fromTs!=null&&Number.isFinite(i.fromTs)?i.fromTs:null,Wt=i.toTs!=null&&Number.isFinite(i.toTs)?i.toTs:null;let li=0,di=Ke-1;if(Bt!=null){const l=e.findIndex(p=>Number(p==null?void 0:p.timestamp)>=Bt);if(l>=0)li=l;else return{summary:je,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}if(Wt!=null){for(let l=Ke-1;l>=0;l--){const p=Number((Da=e[l])==null?void 0:Da.timestamp);if(Number.isFinite(p)&&p<=Wt){di=l;break}}if(di<li)return{summary:je,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}const yi=i.session,kt=l=>{var E;if(!yi)return!0;const p=Number((E=e[l])==null?void 0:E.timestamp);if(!Number.isFinite(p)||p<=0)return!0;const b=new Date(p),L=b.getUTCHours()*60+b.getUTCMinutes(),{startMin:q,endMin:z}=yi;return q<=z?L>=q&&L<=z:L>=q||L<=z},Jt=(Array.isArray(t)?t:[]).filter(l=>typeof(l==null?void 0:l.index)=="number"&&l.index>=0).filter(l=>l.index>=li&&l.index<=di).filter(l=>kt(l.index)).slice().sort((l,p)=>l.index-p.index||ka(l.type)-ka(p.type));let Ft=0,Qt=n,xi=0,Ii=0,Zt=n,Fi=0,Ai=0,nn=1;const zt={long:null,short:null},ei=(l,p)=>{const b=zt[l];if(b)return b;const L={id:`t${nn++}`,side:l,entryIndex:p,entryTimestamp:wt(p),exitIndex:p,exitTimestamp:wt(p),qtyEntered:0,entryNotional:0,qtyExited:0,exitNotional:0,grossPnl:0,fees:0,entries:0,exits:0};return zt[l]=L,L},zi=(l,p)=>{if(ue(l))return;const b=zt[l];if(!b)return;const L=b.qtyEntered,q=L>0?b.entryNotional/L:0,z=b.qtyExited>0?b.exitNotional/b.qtyExited:0,E=b.entryNotional>0?b.grossPnl/b.entryNotional*100:0;ft.push({id:b.id,side:b.side,entryIndex:b.entryIndex,entryTimestamp:b.entryTimestamp,exitIndex:b.exitIndex,exitTimestamp:b.exitTimestamp,qty:L,avgEntryPrice:q,avgExitPrice:z,grossPnl:b.grossPnl,fees:b.fees,netPnl:b.grossPnl-b.fees,pnlPct:E,entries:b.entries,exits:b.exits,maePct:typeof b.maeMin=="number"&&Number.isFinite(b.maeMin)?b.maeMin:void 0,mfePct:typeof b.mfeMax=="number"&&Number.isFinite(b.mfeMax)?b.mfeMax:void 0}),zt[l]=null},Ei=(l,p)=>{let b=0;for(const L of ee("long"))L.qty<=0||(b+=(p-L.entryPrice)*L.qty);for(const L of ee("short"))L.qty<=0||(b+=(L.entryPrice-p)*L.qty);return n+ie+b-ae},mn=l=>{let p=0;for(const b of ee("long"))b.qty<=0||(p+=(l-b.entryPrice)*b.qty);for(const b of ee("short"))b.qty<=0||(p+=(b.entryPrice-l)*b.qty);return Number.isFinite(p)?p:0},ti=()=>{let l=0,p=0,b=0,L=0;for(const z of ee("long"))z.qty<=0||(l+=z.qty,p+=z.entryPrice*z.qty);for(const z of ee("short"))z.qty<=0||(b+=z.qty,L+=z.entryPrice*z.qty);const q=l-b;return q>0&&l>0?p/l:q<0&&b>0?L/b:NaN},Mi=(l,p)=>{if(i.orderSize.type==="cash")return Math.max(0,i.orderSize.value)*V;if(i.orderSize.type==="qty")return Math.max(0,i.orderSize.value*p);const b=Math.max(0,Math.min(100,i.orderSize.value));return l*b/100*V},pn=()=>{let l=0;for(const p of ee("long"))l+=p.qty>0?p.entryNotional:0;for(const p of ee("short"))l+=p.qty>0?p.entryNotional:0;return l},gn=()=>V>0?pn()/V:0,Ui=l=>{const p=Number(l);if(!Number.isFinite(p)||p<=0)return{long:0,short:0,total:0};let b=0,L=0;for(const q of ee("long"))b+=q.qty>0?q.qty*p:0;for(const q of ee("short"))L+=q.qty>0?q.qty*p:0;return{long:b,short:L,total:b+L}},yn=(l,p,b)=>{var ke,xe;if(!De()||!me&&!_e||l<=b)return;const L=Number((ke=e[l-1])==null?void 0:ke.timestamp),q=Number((xe=e[l])==null?void 0:xe.timestamp);if(!Number.isFinite(L)||!Number.isFinite(q)||q<=L)return;const z=q-L,E=z/864e5,x=z/(365*864e5);if(!Number.isFinite(E)||E<=0)return;const T=Ui(p);let F=0,Z=0;_e&&(F=Math.max(0,T.total*_e*E)),me&&(Z=Math.max(0,T.short*me*x));const de=F+Z;if(!(!Number.isFinite(de)||de<=0)){if(ae+=de,F>0&&T.total>0){const Ve=F*T.long/T.total,Re=F-Ve;zt.long&&(zt.long.fees+=Ve),zt.short&&(zt.short.fees+=Re)}Z>0&&zt.short&&(zt.short.fees+=Z)}},kr=(l,p,b)=>{if(!De())return!1;const L=wt(l);let q=!1;for(const z of["long","short"]){if(!ue(z))continue;const E=at({action:"exit",side:z,kind:"market",originalKind:"market",status:"pending",createdIndex:l,createdTimestamp:L,activeFromIndex:l,qtyPct:100,price:p,note:b}),x=Ri(z,l,p,"liquidation","market",{orderId:E.id},he??void 0);x?(Pe(E.id,{status:"filled",filledIndex:l,filledTimestamp:L,fillPrice:x.execPrice,fillQty:x.qtyClosed,fees:x.exitFees}),q=!0):Pe(E.id,{status:"rejected",note:`${b} (no fill)`})}if(q&&lt.length){for(const z of lt)Pe(z.orderId,{status:"canceled",note:"Canceled on liquidation"});lt.length=0}return q},xn=(l,p)=>{if(!ne||!De())return!1;const b=T=>{const F=Ei(l,T),de=Ui(T).total*ne;return{px:T,equityNow:F,req:de,gap:F-de}},L=b(p.l),q=b(p.h),z=Number.isFinite(L.gap)&&L.gap<=1e-9,E=Number.isFinite(q.gap)&&q.gap<=1e-9;if(!z&&!E)return!1;const x=z&&E?L.gap<=q.gap?L:q:z?L:q;return kr(l,x.px,"AUTO liquidation")},Sa=(l,p,b,L)=>{const q=M(b,L);return!Number.isFinite(q)||q<=0?b:I(l,p)?b+q:b-q},pc=(l,p,b,L)=>{if(b==="limit")return te("entry",l,p);const q=p*Y("entry",l),z=Sa("entry",l,q,L);return te("entry",l,z)},Qn=(l,p,b,L)=>{if(b==="limit")return te("exit",l,p);const q=p*Y("exit",l),z=Sa("exit",l,q,L);return te("exit",l,z)},Ca=l=>{if(!l||typeof l!="object")return;const p=F=>{const Z=typeof F=="number"?F:Number(F);return Number.isFinite(Z)?Z:void 0},b=p(l.stopLossPct),L=p(l.takeProfitPct),q=p(l.trailingStopPct),z=l.takeProfits,E=[];if(Array.isArray(z))for(const F of z){if(!F||typeof F!="object")continue;const Z=p(F.takeProfitPct),de=p(F.qtyPct);Z==null||Z<=0||de==null||de<=0||E.push({takeProfitPct:Math.max(0,Z),qtyPct:Math.max(0,Math.min(100,de))})}E.sort((F,Z)=>F.takeProfitPct-Z.takeProfitPct);let x=0;const T=[];for(const F of E){if(x>=100)break;const Z=100-x,de=Math.min(Z,F.qtyPct);de<=0||(T.push({takeProfitPct:F.takeProfitPct,qtyPct:de}),x+=de)}if(!(b==null&&L==null&&q==null&&T.length===0))return{stopLossPct:b,takeProfitPct:L,trailingStopPct:q,takeProfits:T.length?T:void 0}},Ia=(l,p,b,L,q)=>{if(!Number.isFinite(b)||b<=0)return{ok:!1,reject:"Invalid fill price"};const z=Ei(p,b),E=q&&typeof q.qty=="number"&&Number.isFinite(q.qty)?Math.abs(q.qty):null,x=q&&typeof q.cash=="number"&&Number.isFinite(q.cash)?Math.abs(q.cash):null;let T=0;if(E!=null)T=E;else if(x!=null)T=x*V/b;else{const xe=Number.isFinite(L)?Math.max(0,Math.min(100,L)):100;if(xe<=0)return{ok:!1,reject:"qtyPct <= 0"};const Ve=Mi(z,b)*xe/100;if(!Number.isFinite(Ve)||Ve<=0)return{ok:!1,reject:"Notional <= 0"};T=Ve/b}if(!Number.isFinite(T)||T<=0)return{ok:!1,reject:"Qty <= 0"};const F=P(T,"floor");if(!Number.isFinite(F)||F<=0)return C?{ok:!1,reject:`Qty rounded to 0 (qtyStep=${C})`}:{ok:!1,reject:"Qty <= 0"};if(v!=null&&F<v)return{ok:!1,reject:`Qty ${F} < minQty ${v}`};if(ze!=null&&Wi(l)+F>ze)return{ok:!1,reject:"Max position qty exceeded"};if(Ne!=null&&Ui(b)[l]+F*b>Ne)return{ok:!1,reject:"Max position cash exceeded"};if(Fe!=null&&Fe>0){const Ve=Ui(b)[l]+F*b,Re=z*Fe;if(Re>0&&Ve>Re)return{ok:!1,reject:"Max position percent exceeded"}}const Z=b*F,de=V>0?Z/V:Z,ke=gn();return de>0&&ke+de>z+1e-9?{ok:!1,reject:"Insufficient margin"}:{ok:!0,qty:F,equityNow:z}},ns=(l,p,b,L=100,q="market",z,E,x)=>{var bi,Oi,xt;if(i.positionMode==="netting"&&ue(Ye(l)))return{ok:!1,reject:"Netting mode: opposite position open"};if(et)return{ok:!1,reject:"Risk limit reached"};if(Ce!=null&&J>=Ce)return{ok:!1,reject:"Max intraday filled orders reached"};if(Ge(l)>=i.pyramiding)return{ok:!1,reject:`Pyramiding limit reached (${i.pyramiding})`};const T=pc(l,b,q,x),F=Ia(l,p,T,L,x);if(!F.ok)return{ok:!1,reject:F.reject};const Z=F.qty,de=T*Z,ke=c(Z,de,x);ae+=ke;{const He=ei(l,p);He.qtyEntered+=Z,He.entryNotional+=de,He.fees+=ke,He.entries+=1}const xe=i.closeMethod==="avg"?void 0:Ca(z),Ve=(xe==null?void 0:xe.stopLossPct)!=null?xe.stopLossPct:i.stopLossPct,Re=(xe==null?void 0:xe.takeProfitPct)!=null?xe.takeProfitPct:i.takeProfitPct,Oe=(xe==null?void 0:xe.trailingStopPct)!=null?xe.trailingStopPct:i.trailingStopPct,yt=Ve&&Ve>0?l==="long"?T*(1-Ve/100):T*(1+Ve/100):null,ct=Re&&Re>0?l==="long"?T*(1+Re/100):T*(1-Re/100):null,We=yt!=null&&Number.isFinite(yt)?B("exit",l,"stop",yt):null,Be=ct!=null&&Number.isFinite(ct)?B("exit",l,"limit",ct):null,tt={side:l,qty:Z,entryIndex:p,entryTimestamp:((bi=e[p])==null?void 0:bi.timestamp)??Date.now(),entryPrice:T,entrySignalId:E==null?void 0:E.signalId,entryOrderId:E==null?void 0:E.orderId,entrySignalScore:(E==null?void 0:E.score)??null,entryNotional:de,entryFee:ke,entryFeeRemaining:ke,stopPrice:We&&Number.isFinite(We)?We:null,takePrice:Be&&Number.isFinite(Be)?Be:null,trailingPct:Oe,trailingStop:Oe&&Oe>0?l==="long"?B("exit",l,"stop",T*(1-Oe/100)):B("exit",l,"stop",T*(1+Oe/100)):null,takeProfitOrders:[],maxFav:T,maxAdv:T},dt=(Oi=xe==null?void 0:xe.takeProfits)!=null&&Oi.length?xe.takeProfits:i.takeProfits;if(dt!=null&&dt.length){const He=[];let Ni=0;for(const _i of dt){if(Ni>=Z)break;const Gt=Math.max(0,Math.min(Z-Ni,Z*_i.qtyPct/100)),bt=P(Gt,"floor");if(!Number.isFinite(bt)||bt<=0||v!=null&&bt<v&&bt<Z-Ni-1e-12)continue;const Ot=l==="long"?T*(1+_i.takeProfitPct/100):T*(1-_i.takeProfitPct/100),Pt=B("exit",l,"limit",Ot);!Number.isFinite(Pt)||Pt<=0||(He.push({price:Pt,qty:bt,pct:_i.takeProfitPct}),Ni+=bt)}tt.takeProfitOrders=He.sort((_i,Gt)=>l==="long"?_i.price-Gt.price:Gt.price-_i.price)}J+=1;const Xe=ee(l);if(i.closeMethod==="avg"&&Xe.length){const He=Xe[0],Ni=He.qty+tt.qty,_i=He.entryNotional+tt.entryNotional,Gt=Ni>0?_i/Ni:He.entryPrice;He.qty=Ni,He.entryNotional=_i,He.entryPrice=Gt,He.entryFee+=tt.entryFee,He.entryFeeRemaining+=tt.entryFeeRemaining;const bt=i.stopLossPct,Ot=i.takeProfitPct,Pt=i.trailingStopPct,ui=bt&&bt>0?l==="long"?Gt*(1-bt/100):Gt*(1+bt/100):null,Yn=Ot&&Ot>0?l==="long"?Gt*(1+Ot/100):Gt*(1-Ot/100):null;if(He.stopPrice=ui!=null&&Number.isFinite(ui)?B("exit",l,"stop",ui):null,He.takePrice=Yn!=null&&Number.isFinite(Yn)?B("exit",l,"limit",Yn):null,He.trailingPct=Pt,He.trailingStop=Pt&&Pt>0?l==="long"?B("exit",l,"stop",Gt*(1-Pt/100)):B("exit",l,"stop",Gt*(1+Pt/100)):null,He.takeProfitOrders=[],(xt=i.takeProfits)!=null&&xt.length){const qi=[];let En=0;for(const Ki of i.takeProfits){if(En>=He.qty)break;const _n=Math.max(0,Math.min(He.qty-En,He.qty*Ki.qtyPct/100)),ii=P(_n,"floor");if(!Number.isFinite(ii)||ii<=0)continue;const Yt=l==="long"?Gt*(1+Ki.takeProfitPct/100):Gt*(1-Ki.takeProfitPct/100),_t=B("exit",l,"limit",Yt);!Number.isFinite(_t)||_t<=0||(qi.push({price:_t,qty:ii,pct:Ki.takeProfitPct}),En+=ii)}He.takeProfitOrders=qi.sort((Ki,_n)=>l==="long"?Ki.price-_n.price:_n.price-Ki.price)}return He.maxFav=He.maxFav==null?Gt:He.maxFav,He.maxAdv=He.maxAdv==null?Gt:He.maxAdv,{ok:!0,lot:He}}return Xe.push(tt),{ok:!0,lot:tt}},rs=(l,p,b,L,q)=>{const z=Wi(l);if(!Number.isFinite(z)||z<=0)return 0;if(L!=null&&Number.isFinite(L)){const x=Math.abs(L);return x>0?Math.min(z,x):0}if(q!=null&&Number.isFinite(q)){const x=Math.abs(q);if(x<=0||!Number.isFinite(p)||p<=0)return 0;const F=(V>0?x*V:x)/p;return Number.isFinite(F)&&F>0?Math.min(z,F):0}const E=Number.isFinite(b)?Math.max(0,Math.min(100,b)):100;return E<=0?0:z*E/100},ss=(l,p,b,L="signal",q,z="market",E,x,T)=>{var dt;const F=l.side;C&&(l.qty=P(l.qty,"round"));const Z=Qn(F,b,z,T);if(!Number.isFinite(Z)||Z<=0)return null;const de=l.qty,ke=q==null?de:Math.max(0,Math.min(de,q)),xe=q==null?C?P(ke,"round"):ke:C?P(ke,"floor"):ke;if(!Number.isFinite(xe)||xe<=0||v!=null&&q!=null&&xe<v&&xe<de-1e-12)return null;const Ve=de>0&&Number.isFinite(l.entryFeeRemaining)?l.entryFeeRemaining*xe/de:0,Re=Z*xe,Oe=c(xe,Re,T),yt=x&&x>0?Re*x:0;ae+=Oe,ae+=yt;const ct=F==="long"?(Z-l.entryPrice)*xe:(l.entryPrice-Z)*xe;ie+=ct;{const Xe=ei(F,l.entryIndex);Xe.qtyExited+=xe,Xe.exitNotional+=Re,Xe.grossPnl+=ct,Xe.fees+=Ve+Oe+yt,Xe.exits+=1,Xe.exitIndex=p,Xe.exitTimestamp=wt(p)}const We=Number.isFinite(l.entryPrice)&&l.entryPrice>0?l.entryPrice*xe:NaN,Be=(()=>{if(!(l.entryPrice<=0)&&!(l.maxAdv==null||!Number.isFinite(l.maxAdv)))return l.side==="long"?(l.maxAdv-l.entryPrice)/l.entryPrice*100:(l.entryPrice-l.maxAdv)/l.entryPrice*100})(),tt=(()=>{if(!(l.entryPrice<=0)&&!(l.maxFav==null||!Number.isFinite(l.maxFav)))return l.side==="long"?(l.maxFav-l.entryPrice)/l.entryPrice*100:(l.entryPrice-l.maxFav)/l.entryPrice*100})();Ae.push({side:F,qty:xe,entryIndex:l.entryIndex,entryTimestamp:l.entryTimestamp,entryPrice:l.entryPrice,entrySignalId:l.entrySignalId,entryOrderId:l.entryOrderId,entrySignalScore:l.entrySignalScore??null,exitIndex:p,exitTimestamp:((dt=e[p])==null?void 0:dt.timestamp)??Date.now(),exitPrice:Z,exitSignalId:E==null?void 0:E.signalId,exitOrderId:E==null?void 0:E.orderId,exitSignalScore:(E==null?void 0:E.score)??null,exitReason:L,pnl:ct,pnlPct:Number.isFinite(We)&&We>0?ct/We*100:0,fees:Ve+Oe+yt,entryFee:Ve,exitFee:Oe+yt,netPnl:ct-(Ve+Oe+yt),maePct:typeof Be=="number"&&Number.isFinite(Be)?Be:void 0,mfePct:typeof tt=="number"&&Number.isFinite(tt)?tt:void 0}),ce+=Math.max(0,p-l.entryIndex+1),H+=Ve+Oe+yt,ct>0?(G+=ct,re+=1):ct<0&&(W+=Math.abs(ct),oe+=1);try{const Xe=zt[F];typeof Be=="number"&&Number.isFinite(Be)&&Xe&&(Xe.maeMin=Xe.maeMin==null?Be:Math.min(Xe.maeMin,Be)),typeof tt=="number"&&Number.isFinite(tt)&&Xe&&(Xe.mfeMax=Xe.mfeMax==null?tt:Math.max(Xe.mfeMax,tt))}catch{}return l.qty-=xe,C&&(l.qty=P(l.qty,"round")),l.entryFeeRemaining=Math.max(0,l.entryFeeRemaining-Ve),l.qty<=1e-12&&(l.entryFeeRemaining=0),{qtyClosed:xe,fees:Ve+Oe+yt,exitFee:Oe+yt,execPrice:Z}},Ri=(l,p,b,L="signal",q="market",z,E,x)=>{const T=ee(l);if(!T.length)return null;const F=T.slice();let Z=0,de=0,ke=0,xe=0;for(const Ve of F)if(Ve.qty>0){const Re=ss(Ve,p,b,L,Ve.qty,q,z,E,x);Re&&(Z+=Re.qtyClosed,de+=Re.fees,ke+=Re.exitFee,xe+=Re.execPrice*Re.qtyClosed)}return fe[l]=ee(l).filter(Ve=>Ve.qty>1e-12),zi(l),Z<=0?null:{qtyClosed:Z,fees:de,exitFees:ke,execPrice:xe/Z}},Wi=l=>{const p=ee(l);return p.length?p.reduce((b,L)=>b+(L.qty>0?L.qty:0),0):0},as=(l,p,b,L,q="signal",z="market",E,x,T)=>{const F=ee(l);if(!F.length)return null;let Z=Math.max(0,L),de=0,ke=0,xe=0,Ve=0;const Re=i.closeMethod==="lifo"?F.slice().reverse():F;for(const Oe of Re){if(Z<=0)break;if(Oe.qty<=0)continue;const yt=Math.min(Oe.qty,Z),ct=ss(Oe,p,b,q,yt,z,E,x,T);ct&&(de+=ct.qtyClosed,ke+=ct.fees,xe+=ct.exitFee,Ve+=ct.execPrice*ct.qtyClosed),Z-=yt}return fe[l]=ee(l).filter(Oe=>Oe.qty>1e-12),zi(l),de<=0?null:{qtyClosed:de,fees:ke,exitFees:xe,execPrice:Ve/de}},lt=[],os=(l,p)=>{for(let b=lt.length-1;b>=0;b--){const L=lt[b];l(L)&&(Pe(L.orderId,{status:"canceled",note:p}),lt.splice(b,1))}},gc=(l,p)=>{if(!l)return;const b=String(l).trim();b&&os(L=>String(L.signalId||"")===b||String(L.orderId||"")===b,p)},ls=l=>{os(()=>!0,l)},yc=l=>(l==null?void 0:l.order)||{},xc=l=>{const p=typeof l=="number"?l:Number(l);return!Number.isFinite(p)||p<=0?100:Math.max(0,Math.min(100,p))},bn=l=>{const p=typeof l=="number"?l:Number(l);return Number.isFinite(p)?Math.max(0,p):null},Qi=l=>{const p=typeof l=="number"?l:Number(l);return Number.isFinite(p)?p:null},bc=l=>{if(!l||typeof l!="object")return null;const p=String(l.commissionType??l.commission_mode??l.commissionMode??"").trim().toLowerCase(),b=l.commissionCash??l.commission_cash??l.commissionFixed??l.commission_fixed??null,L=l.commissionPerUnit??l.commission_per_unit??l.commissionPerShare??l.commission_per_share??null,q=l.commissionValue??l.commission_value??null,z=l.commissionPct??l.commission??null;let E=null,x=null;return p==="cash"?(E="cash",x=Qi(q??b)):p==="per_unit"||p==="perunit"?(E="per_unit",x=Qi(q??L)):p==="percent"||p==="pct"?(E="percent",x=bn(z),x!=null&&(x/=100)):L!=null?(E="per_unit",x=Qi(L)):b!=null?(E="cash",x=Qi(b)):q!=null?(E="percent",x=bn(q),x!=null&&(x/=100)):z!=null&&(E="percent",x=bn(z),x!=null&&(x/=100)),!E||x==null||!Number.isFinite(x)?null:{commissionMode:E,commissionValue:Math.max(0,x)}},_c=l=>{if(!l||typeof l!="object")return null;const p=String(l.slippageType??l.slippage_mode??l.slippageMode??"").trim().toLowerCase(),b=l.slippageAbs??l.slippage_abs??null,L=l.slippageTicks??l.slippage_ticks??null,q=l.slippageValue??l.slippage_value??null,z=l.slippagePct??l.slippage??null;let E=null,x=null;return p==="abs"?(E="abs",x=Qi(q??b)):p==="ticks"?(E="ticks",x=Qi(q??L)):p==="percent"||p==="pct"?(E="percent",x=bn(z),x!=null&&(x/=100)):b!=null?(E="abs",x=Qi(b)):L!=null?(E="ticks",x=Qi(L)):q!=null?(E="percent",x=bn(q),x!=null&&(x/=100)):z!=null&&(E="percent",x=bn(z),x!=null&&(x/=100)),!E||x==null||!Number.isFinite(x)?null:{slippageMode:E,slippageValue:Math.max(0,x)}},vc=l=>{const p=String(l||"market").trim().toLowerCase();return p==="limit"||p==="lit"?"limit":p==="stop"||p==="trailing_stop"?"stop":"market"},In=(l,p,b,L,q)=>Number.isFinite(q)?l==="entry"?p==="long"?b==="limit"?L.l<=q:L.h>=q:b==="limit"?L.h>=q:L.l<=q:p==="long"?b==="limit"?L.h>=q:L.l<=q:b==="limit"?L.l<=q:L.h>=q:!1,wc=(l,p,b)=>{for(const L of b)l.side==="long"?L==="high"?l.maxFav=l.maxFav==null?p.h:Math.max(l.maxFav,p.h):l.maxAdv=l.maxAdv==null?p.l:Math.min(l.maxAdv,p.l):L==="low"?l.maxFav=l.maxFav==null?p.l:Math.min(l.maxFav,p.l):l.maxAdv=l.maxAdv==null?p.h:Math.max(l.maxAdv,p.h)},Gn=l=>i.intrabarTieBreak==="ohlc"?i.ohlcPath==="open_high_low_close"?["high","low"]:["low","high"]:i.intrabarTieBreak==="best_case"?l==="long"?["high","low"]:["low","high"]:l==="long"?["low","high"]:["high","low"],ci=l=>{const{lot:p,i:b,triggerPx:L,reason:q,qty:z,fillKind:E,note:x}=l;if(!Number.isFinite(L)||L<=0||!Number.isFinite(z)||z<=0)return!1;const T=E==="limit"?"limit":"stop",F=wt(b),Z=at({action:"exit",side:p.side,kind:T,originalKind:T,status:"pending",createdIndex:b,createdTimestamp:F,activeFromIndex:b,qtyPct:100,price:L,note:x}),de=ss(p,b,L,q,z,E,{orderId:Z.id});return de?(Pe(Z.id,{status:"filled",filledIndex:b,filledTimestamp:F,fillPrice:de.execPrice,fillQty:de.qtyClosed,fees:de.exitFee,note:x}),!0):(Pe(Z.id,{status:"rejected",note:`${x} (no fill)`}),!1)},Nc=l=>{var L;if(i.fillMode!=="volume")return Number.POSITIVE_INFINITY;const p=Number((L=e[l])==null?void 0:L.volume);if(!Number.isFinite(p)||p<=0)return Number.POSITIVE_INFINITY;const b=p*i.volumeFillPct/100;return Number.isFinite(b)&&b>0?b:Number.POSITIVE_INFINITY},kc=(l,p,b)=>{if(l.targetQty!=null&&l.remainingQty!=null)return{ok:!0,target:l.targetQty,remaining:l.remainingQty};if(l.action==="entry"){const E=Ia(l.side,p,b,l.qtyPct,{qty:l.qty,cash:l.cash});return E.ok?(l.targetQty=E.qty,l.remainingQty=E.qty,{ok:!0,target:E.qty,remaining:E.qty}):{ok:!1,reject:E.reject}}const L=rs(l.side,b,l.qtyPct,l.qty,l.cash),q=P(L,"floor");if(!Number.isFinite(q)||q<=0)return{ok:!1,reject:"Qty <= 0"};const z=Wi(l.side);return v!=null&&q>0&&q<v&&q<z-1e-12?{ok:!1,reject:`Qty ${q} < minQty ${v}`}:(l.targetQty=q,l.remainingQty=q,{ok:!0,target:q,remaining:q})},Pc=l=>l.tif??i.timeInForce,Fa=(l,p,b,L,q,z)=>{const E=kc(l,p,b);if(!E.ok)return Pe(l.orderId,{status:"rejected",note:E.reject}),{remove:!0,filled:!1};const x=Pc(l),T=E.remaining,F=Nc(p),Z=Math.min(T,F);if(x==="fok"&&Z+1e-12<T)return Pe(l.orderId,{status:"rejected",note:"FOK not fully filled"}),{remove:!0,filled:!1};if(x==="ioc"&&Z<=0)return Pe(l.orderId,{status:"canceled",note:"IOC not filled"}),{remove:!0,filled:!1};if(Z<=0)return{remove:!1,filled:!1};const de=l.slippageMode!=null||l.slippageValue!=null||l.commissionMode!=null||l.commissionValue!=null?{slippageMode:l.slippageMode,slippageValue:l.slippageValue,commissionMode:l.commissionMode,commissionValue:l.commissionValue}:void 0,ke=wt(p);let xe=0,Ve=b,Re=0,Oe=!1;if(l.action==="entry"){if(i.positionMode==="netting"){const Be=Ye(l.side);if(ue(Be)){const tt=at({action:"exit",side:Be,kind:L==="limit"?"limit":"market",originalKind:"market",status:"pending",createdIndex:p,createdTimestamp:ke,activeFromIndex:p,qtyPct:100,price:b,note:"AUTO netting close (reverse)"}),dt=Ri(Be,p,b,"signal",L,{orderId:tt.id,signalId:l.signalId,score:l.score??null});Pe(tt.id,{status:dt?"filled":"rejected",filledIndex:dt?p:void 0,filledTimestamp:dt?ke:void 0,fillPrice:dt==null?void 0:dt.execPrice,fillQty:(dt==null?void 0:dt.qtyClosed)??0,fees:(dt==null?void 0:dt.exitFees)??0,note:dt?"AUTO netting close (reverse)":"AUTO netting close failed"})}}const We=ns(l.side,p,b,l.qtyPct,L,l.bracket,{orderId:l.orderId,signalId:l.signalId,score:l.score??null},{qty:Z,...de});if(We.ok){const Be=We.lot;if(xe=Be.qty,Ve=Be.entryPrice,Re=Be.entryFee,Oe=!0,i.execution!=="bar_close"){const tt=Gn(l.side),dt=tt.indexOf(q),Xe=dt>=0?tt.slice(dt+1):tt;wc(Be,z,Xe),cs(l.side,p,z,Xe)}}}else{const We=Z>=Wi(l.side)-1e-12?Ri(l.side,p,b,"signal",L,{orderId:l.orderId,signalId:l.signalId,score:l.score??null},void 0,de):as(l.side,p,b,Z,"signal",L,{orderId:l.orderId,signalId:l.signalId,score:l.score??null},void 0,de);We&&(xe=We.qtyClosed,Ve=We.execPrice,Re=We.exitFees,Oe=!0)}if(!Oe||xe<=0)return Pe(l.orderId,{status:"rejected",note:"Order not filled"}),{remove:!0,filled:!1};const yt=Math.max(0,T-xe),ct=yt<=1e-12?"filled":"partial";return jt({id:l.orderId,index:p,timestamp:ke,qty:xe,price:Ve,fees:Re,targetQty:E.target,remainingQty:yt,status:ct,note:ct==="partial"?"Partial fill":void 0}),l.remainingQty=yt,l.targetQty=E.target,x==="ioc"?(yt>1e-12&&Pe(l.orderId,{status:"canceled",note:"IOC remainder canceled"}),{remove:!0,filled:!0}):{remove:yt<=1e-12,filled:!0}},cs=(l,p,b,L)=>{if(!ue(l)||i.execution==="bar_close")return!1;let q=!1;const z=E=>{var x,T;for(const F of ee(l)){if(F.qty<=0)continue;const Z=X(b,"exit",F.side);if(F.trailingPct&&F.trailingPct>0){const de=F.trailingPct/100;if(F.side==="long"&&E==="high"){const ke=b.h*(1-de);F.trailingStop=F.trailingStop==null?ke:Math.max(F.trailingStop,ke)}if(F.side==="short"&&E==="low"){const ke=b.l*(1+de);F.trailingStop=F.trailingStop==null?ke:Math.min(F.trailingStop,ke)}}if(F.side==="long"&&E==="high"){if((x=F.takeProfitOrders)!=null&&x.length){const de=[];for(const ke of F.takeProfitOrders){if(F.qty<=0)break;Z.h>=ke.price?q=ci({lot:F,i:p,triggerPx:ke.price,reason:"take_profit",qty:ke.qty,fillKind:"limit",note:`AUTO take_profit (${ke.pct}%)`})||q:de.push(ke)}F.takeProfitOrders=de}F.takePrice!=null&&Z.h>=F.takePrice&&F.qty>0&&(q=ci({lot:F,i:p,triggerPx:F.takePrice,reason:"take_profit",qty:F.qty,fillKind:"limit",note:"AUTO take_profit"})||q)}if(F.side==="short"&&E==="low"){if((T=F.takeProfitOrders)!=null&&T.length){const de=[];for(const ke of F.takeProfitOrders){if(F.qty<=0)break;Z.l<=ke.price?q=ci({lot:F,i:p,triggerPx:ke.price,reason:"take_profit",qty:ke.qty,fillKind:"limit",note:`AUTO take_profit (${ke.pct}%)`})||q:de.push(ke)}F.takeProfitOrders=de}F.takePrice!=null&&Z.l<=F.takePrice&&F.qty>0&&(q=ci({lot:F,i:p,triggerPx:F.takePrice,reason:"take_profit",qty:F.qty,fillKind:"limit",note:"AUTO take_profit"})||q)}if(F.side==="long"&&E==="low"){if(F.stopPrice!=null&&Z.l<=F.stopPrice){q=ci({lot:F,i:p,triggerPx:F.stopPrice,reason:"stop_loss",qty:F.qty,fillKind:"stop",note:"AUTO stop_loss"})||q;continue}F.trailingStop!=null&&Z.l<=F.trailingStop&&(q=ci({lot:F,i:p,triggerPx:F.trailingStop,reason:"trailing_stop",qty:F.qty,fillKind:"stop",note:"AUTO trailing_stop"})||q)}if(F.side==="short"&&E==="high"){if(F.stopPrice!=null&&Z.h>=F.stopPrice){q=ci({lot:F,i:p,triggerPx:F.stopPrice,reason:"stop_loss",qty:F.qty,fillKind:"stop",note:"AUTO stop_loss"})||q;continue}F.trailingStop!=null&&Z.h>=F.trailingStop&&(q=ci({lot:F,i:p,triggerPx:F.trailingStop,reason:"trailing_stop",qty:F.qty,fillKind:"stop",note:"AUTO trailing_stop"})||q)}}fe[l]=ee(l).filter(F=>F.qty>1e-12),zi(l)};for(const E of L){if(!ue(l))break;z(E)}return q},Aa=(l,p)=>{if(l)for(let b=lt.length-1;b>=0;b--){const L=lt[b];(L==null?void 0:L.ocoGroup)===l&&(p&&L.orderId===p||(Pe(L.orderId,{status:"canceled",note:"OCO canceled"}),lt.splice(b,1)))}},Kn=(l,p,b)=>l==="entry"?p==="long"?b==="limit"?"low":"high":b==="limit"?"high":"low":p==="long"?b==="limit"?"high":"low":b==="limit"?"low":"high",Fn=(l,p,b,L,q)=>{const z=q.o;if(!Number.isFinite(z)||!Number.isFinite(L))return{px:L,fillsAtOpen:!1};const E=z*Y(l,p);return b==="limit"?l==="entry"&&p==="long"&&z<=L||l==="entry"&&p==="short"&&z>=L||l==="exit"&&p==="long"&&z>=L||l==="exit"&&p==="short"&&z<=L?{px:E,fillsAtOpen:!0}:{px:L,fillsAtOpen:!1}:l==="entry"&&p==="long"&&z>=L||l==="entry"&&p==="short"&&z<=L||l==="exit"&&p==="long"&&z<=L||l==="exit"&&p==="short"&&z>=L?{px:z,fillsAtOpen:!0}:{px:L,fillsAtOpen:!1}},Ea=(l,p,b)=>{var E,x;if(!ue(l)||i.execution==="bar_close")return!1;const L=b.o;if(!Number.isFinite(L)||L<=0)return!1;const q=L*Y("exit",l);let z=!1;for(const T of ee(l).slice())if(!(T.qty<=0))if(T.side==="long"){if(T.stopPrice!=null&&q<=T.stopPrice){z=ci({lot:T,i:p,triggerPx:L,reason:"stop_loss",qty:T.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||z;continue}if(T.trailingStop!=null&&q<=T.trailingStop){z=ci({lot:T,i:p,triggerPx:L,reason:"trailing_stop",qty:T.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||z;continue}if((E=T.takeProfitOrders)!=null&&E.length){const F=[];for(const Z of T.takeProfitOrders){if(T.qty<=0)break;q>=Z.price?z=ci({lot:T,i:p,triggerPx:q,reason:"take_profit",qty:Z.qty,fillKind:"limit",note:`AUTO take_profit (${Z.pct}%) (gap)`})||z:F.push(Z)}T.takeProfitOrders=F}T.takePrice!=null&&q>=T.takePrice&&T.qty>0&&(z=ci({lot:T,i:p,triggerPx:q,reason:"take_profit",qty:T.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||z)}else{if(T.stopPrice!=null&&q>=T.stopPrice){z=ci({lot:T,i:p,triggerPx:L,reason:"stop_loss",qty:T.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||z;continue}if(T.trailingStop!=null&&q>=T.trailingStop){z=ci({lot:T,i:p,triggerPx:L,reason:"trailing_stop",qty:T.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||z;continue}if((x=T.takeProfitOrders)!=null&&x.length){const F=[];for(const Z of T.takeProfitOrders){if(T.qty<=0)break;q<=Z.price?z=ci({lot:T,i:p,triggerPx:q,reason:"take_profit",qty:Z.qty,fillKind:"limit",note:`AUTO take_profit (${Z.pct}%) (gap)`})||z:F.push(Z)}T.takeProfitOrders=F}T.takePrice!=null&&q<=T.takePrice&&T.qty>0&&(z=ci({lot:T,i:p,triggerPx:q,reason:"take_profit",qty:T.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||z)}return fe[l]=ee(l).filter(T=>T.qty>1e-12),zi(l),z},Sc=(l,p)=>{if(!lt.length)return;if(et){ls("Canceled by risk limit");return}Ce!=null&&J>=Ce&&os(x=>x.action==="entry","Max intraday filled orders reached");for(let x=lt.length-1;x>=0;x--){const T=lt[x];if(!(l<T.activeFromIndex)){if(T.expiresAtIndex!=null&&l>T.expiresAtIndex){Pe(T.orderId,{status:"expired",note:"Expired"}),lt.splice(x,1);continue}if(T.action==="exit"&&!ue(T.side)){Pe(T.orderId,{status:"canceled",note:"No position"}),lt.splice(x,1);continue}}}for(const x of lt){if(x.kind!=="trailing_stop"||l<x.activeFromIndex||x.action!=="exit"||!ue(x.side))continue;const T=typeof x.trailPct=="number"&&Number.isFinite(x.trailPct)?x.trailPct:null,F=typeof x.trailOffset=="number"&&Number.isFinite(x.trailOffset)?x.trailOffset:null,Z=typeof x.trailPrice=="number"&&Number.isFinite(x.trailPrice)?x.trailPrice:x.side==="long"?p.h:p.l,de=F??(T!=null&&T>0?Z*T/100:null);if(!(!de||!Number.isFinite(de)||de<=0))if(x.side==="long"){const ke=Z-de;x.price=x.price==null?ke:Math.max(x.price,ke)}else{const ke=Z+de;x.price=x.price==null?ke:Math.min(x.price,ke)}}const b=[];for(let x=0;x<lt.length;x++){const T=lt[x];if(l<T.activeFromIndex||T.expiresAtIndex!=null&&l>T.expiresAtIndex)continue;const F=X(p,T.action,T.side);if(T.action==="exit"){if(!ue(T.side))continue}else if(Ge(T.side)>=i.pyramiding)continue;const Z=T.ocoGroup||`__solo__${T.orderId||x}`,de=T.action==="exit"?0:1,ke=Gn(T.side);if(T.kind==="stop_limit"){const tt=T.stopPrice??T.price,dt=T.limitPrice??T.price;if(!Number.isFinite(tt)||!Number.isFinite(dt)||!In(T.action,T.side,"stop",F,tt))continue;const bi=Kn(T.action,T.side,"stop"),Oi=ke.indexOf(bi),xt=Fn(T.action,T.side,"stop",tt,p),He=xt.fillsAtOpen?0:Oi>=0?Oi+1:99,Ni=bi==="high"?tt:-tt;b.push({groupKey:Z,orderId:T.orderId,pi:x,action:T.action,side:T.side,kind:"stop_limit",triggerExt:bi,phase:He,actionRank:de,priceRank:Ni,sp:tt,lp:dt,stopAtOpen:xt.fillsAtOpen,limitAtOpen:Fn(T.action,T.side,"limit",dt,p).fillsAtOpen});continue}const xe=T.price;if(xe==null||!Number.isFinite(xe))continue;const Ve=T.kind==="stop"||T.kind==="trailing_stop"?"stop":"limit";if(!In(T.action,T.side,Ve,F,xe))continue;const Oe=Kn(T.action,T.side,Ve),yt=ke.indexOf(Oe),We=Fn(T.action,T.side,Ve,xe,p).fillsAtOpen?0:yt>=0?yt+1:99,Be=Oe==="high"?xe:-xe;b.push({groupKey:Z,orderId:T.orderId,pi:x,action:T.action,side:T.side,kind:T.kind,triggerKind:Ve,triggerExt:Oe,phase:We,actionRank:de,priceRank:Be,px:xe})}if(!b.length)return;const L=new Map,q=(x,T)=>x.phase!==T.phase?x.phase<T.phase?x:T:x.actionRank!==T.actionRank?x.actionRank<T.actionRank?x:T:x.priceRank!==T.priceRank?x.priceRank<T.priceRank?x:T:x.pi<T.pi?x:T;for(const x of b){const T=L.get(x.groupKey);L.set(x.groupKey,T?q(T,x):x)}const z=Array.from(L.values()).sort((x,T)=>x.phase!==T.phase?x.phase-T.phase:x.actionRank!==T.actionRank?x.actionRank-T.actionRank:x.priceRank!==T.priceRank?x.priceRank-T.priceRank:x.pi-T.pi),E=(x,T)=>{if(x){const F=lt.findIndex(Z=>Z.orderId===x);if(F>=0)return F}return typeof T=="number"?T:-1};for(const x of z){const T=E(x.orderId,x.pi);if(T<0||T>=lt.length)continue;const F=lt[T];if(l<F.activeFromIndex||F.expiresAtIndex!=null&&l>F.expiresAtIndex)continue;const Z=X(p,F.action,F.side);if(F.action==="exit"){if(!ue(F.side)){Pe(F.orderId,{status:"canceled",note:"No position"}),lt.splice(T,1);continue}}else if(Ge(F.side)>=i.pyramiding)continue;if(F.kind==="stop_limit"){const ct=F.stopPrice??F.price,We=F.limitPrice??F.price;if(!Number.isFinite(ct)||!Number.isFinite(We)||!In(F.action,F.side,"stop",Z,ct))continue;const tt=In(F.action,F.side,"limit",Z,We),dt=Kn(F.action,F.side,"stop"),Xe=Kn(F.action,F.side,"limit"),bi=Gn(F.side),Oi=bi.indexOf(dt),xt=bi.indexOf(Xe);if(tt&&Oi>=0&&xt>=0&&Oi<xt){const _i=Fn(F.action,F.side,"limit",We,p).px,Gt=Fa(F,l,_i,"limit",dt,p);Gt.filled&&Aa(F.ocoGroup,F.orderId),Gt.remove?lt.splice(T,1):F.remainingQty!=null&&F.remainingQty>1e-12&&(F.kind="limit",F.price=We,F.activeFromIndex=l+1);continue}Pe(F.orderId,{kind:"limit",note:"Stop triggered  limit active next bar"}),F.kind="limit",F.price=We,F.activeFromIndex=l+1;continue}const de=F.price;if(de==null||!Number.isFinite(de))continue;const ke=F.kind==="stop"||F.kind==="trailing_stop"?"stop":"limit";if(!In(F.action,F.side,ke,Z,de))continue;let Ve=vc(F.kind),Re=Fn(F.action,F.side,ke,de,p).px;const Oe=Kn(F.action,F.side,ke);if(F.kind==="lit"){const ct=typeof F.limitPrice=="number"&&Number.isFinite(F.limitPrice)?F.limitPrice:de;if(!In(F.action,F.side,"limit",Z,ct)){Pe(F.orderId,{kind:"limit",note:"LIT triggered  limit active next bar"}),F.kind="limit",F.price=ct,F.activeFromIndex=l+1;continue}Re=Fn(F.action,F.side,"limit",ct,p).px,Ve="limit"}const yt=Fa(F,l,Re,Ve,Oe,p);yt.filled&&Aa(F.ocoGroup,F.orderId),yt.remove&&lt.splice(T,1)}},Cc=(l,p)=>{if(!De()||i.execution==="bar_close")return!1;const b=Ea("long",l,p),L=Ea("short",l,p),q=cs("long",l,p,Gn("long")),z=cs("short",l,p,Gn("short"));return b||L||q||z};let us=0,Ma=0;for(let l=li;l<=di;l++){const p=fc(e[l]);if(!p)continue;const b=p.c;yn(l,b,li);const L=Number((ja=e[l])==null?void 0:ja.timestamp);if(Number.isFinite(L)&&L>0){const E=new Date(L).toISOString().slice(0,10);E&&E!==Ie&&(Ie=E,Ue=Ei(l,b),J=0)}for(const E of ee("long"))E.qty<=0||(E.maxFav=E.maxFav==null?p.h:Math.max(E.maxFav,p.h),E.maxAdv=E.maxAdv==null?p.l:Math.min(E.maxAdv,p.l));for(const E of ee("short"))E.qty<=0||(E.maxFav=E.maxFav==null?p.l:Math.min(E.maxFav,p.l),E.maxAdv=E.maxAdv==null?p.h:Math.max(E.maxAdv,p.h));for(De()&&Cc(l,p),Sc(l,p),xn(l,p);Ft<Jt.length&&Jt[Ft].index===l;){const E=Jt[Ft];if(E.type==="cancel"){gc(E.orderId??E.signalId,"Canceled by strategy.cancel"),Ft+=1;continue}if(E.type==="cancel_all"){ls("Canceled by strategy.cancel_all"),Ft+=1;continue}const x=yc(E),F=String((x==null?void 0:x.kind)||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop/g,"trailing_stop"),Z=xc(x==null?void 0:x.qtyPct),de=x==null?void 0:x.qty,ke=x==null?void 0:x.cash,xe=typeof de=="number"&&Number.isFinite(de)?de:Number(de),Ve=typeof ke=="number"&&Number.isFinite(ke)?ke:Number(ke),Re=Number.isFinite(xe)?xe:void 0,Oe=Number.isFinite(Ve)?Ve:void 0,yt=bc(x),ct=_c(x),We=yt||ct?{...yt,...ct}:void 0,Be=typeof(x==null?void 0:x.oco)=="string"&&String(x.oco).trim()?String(x.oco).trim():void 0,tt=String((x==null?void 0:x.tif)??(x==null?void 0:x.timeInForce)??"").trim().toLowerCase(),Xe=tt?tt==="ioc"||tt==="immediate_or_cancel"?"ioc":tt==="fok"||tt==="fill_or_kill"?"fok":"gtc":i.timeInForce,bi=x==null?void 0:x.expiresBars,Oi=typeof bi=="number"&&Number.isFinite(bi)&&bi>0?Math.floor(bi):tt==="day"?1:null,xt=Oi?l+Oi:void 0,He=Ca(x==null?void 0:x.bracket),Ni=(x==null?void 0:x.trailPct)??(x==null?void 0:x.trail_percent)??(x==null?void 0:x.trailPercent)??(x==null?void 0:x.trailingStopPct)??(x==null?void 0:x.trailing_stop_pct)??null,_i=(x==null?void 0:x.trailOffset)??(x==null?void 0:x.trailPoints)??(x==null?void 0:x.trail_points)??(x==null?void 0:x.trail_offset)??null,Gt=(x==null?void 0:x.trailPrice)??(x==null?void 0:x.trail_price)??null,bt=bn(Ni),Ot=Qi(_i),Pt=Qi(Gt),ui=et?"Risk limit reached":Ce!=null&&J>=Ce?"Max intraday filled orders reached":null,Yn={commissionMode:We==null?void 0:We.commissionMode,commissionValue:We==null?void 0:We.commissionValue,slippageMode:We==null?void 0:We.slippageMode,slippageValue:We==null?void 0:We.slippageValue},qi={qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,...Yn},En=(F==="limit"||F==="stop"||F==="mit"||F==="lit")&&typeof(x==null?void 0:x.price)=="number"?x.price:b,Ki=typeof(x==null?void 0:x.stopPrice)=="number"?x.stopPrice:typeof(x==null?void 0:x.price)=="number"?x.price:b,_n=typeof(x==null?void 0:x.limitPrice)=="number"?x.limitPrice:typeof(x==null?void 0:x.price)=="number"?x.price:b,ii=F==="limit"||F==="stop"||F==="mit"||F==="lit"?B(E.type.startsWith("entry")?"entry":"exit",E.type.endsWith("long")?"long":"short",F==="stop"?"stop":"limit",En):En,Yt=F==="stop_limit"?B(E.type.startsWith("entry")?"entry":"exit",E.type.endsWith("long")?"long":"short","stop",Ki):Ki,_t=F==="stop_limit"||F==="lit"?B(E.type.startsWith("entry")?"entry":"exit",E.type.endsWith("long")?"long":"short","limit",_n):_n,Kt=wt(l),Se=F==="limit"||F==="stop"||F==="stop_limit"||F==="mit"||F==="lit"||F==="trailing_stop"?F:"market";if(E.type==="exit_long"&&ue("long"))if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"exit",side:"long",kind:"stop_limit",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});lt.push({action:"exit",side:"long",kind:"stop_limit",signalId:E.signalId,score:E.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("exit","long","stop",it-Dt):ii,At=at({action:"exit",side:"long",kind:Se,originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});lt.push({action:"exit",side:"long",kind:Se,signalId:E.signalId,score:E.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:At.id})}}else{const it=Wi("long"),Dt=rs("long",b,Z,Re,Oe),Qe=P(Dt,"floor"),At=at({action:"exit",side:"long",kind:"market",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(v!=null&&Qe>0&&Qe<v&&Qe<it-1e-12)Pe(At.id,{status:"rejected",note:`Qty ${Qe} < minQty ${v}`});else{const Ee=Qe>=it-1e-12?Ri("long",l,b,"signal","market",{signalId:E.signalId,orderId:At.id,score:E.score??null},void 0,We):as("long",l,b,Qe,"signal","market",{signalId:E.signalId,orderId:At.id,score:E.score??null},void 0,We);Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Qn("long",b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0,note:Ee?void 0:"Exit not filled"})}}else if(E.type==="exit_short"&&ue("short"))if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"exit",side:"short",kind:"stop_limit",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});lt.push({action:"exit",side:"short",kind:"stop_limit",signalId:E.signalId,score:E.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("exit","short","stop",it+Dt):ii,At=at({action:"exit",side:"short",kind:Se,originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});lt.push({action:"exit",side:"short",kind:Se,signalId:E.signalId,score:E.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,...qi,orderId:At.id})}}else{const it=Wi("short"),Dt=rs("short",b,Z,Re,Oe),Qe=P(Dt,"floor"),At=at({action:"exit",side:"short",kind:"market",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(v!=null&&Qe>0&&Qe<v&&Qe<it-1e-12)Pe(At.id,{status:"rejected",note:`Qty ${Qe} < minQty ${v}`});else{const Ee=Qe>=it-1e-12?Ri("short",l,b,"signal","market",{signalId:E.signalId,orderId:At.id,score:E.score??null},void 0,We):as("short",l,b,Qe,"signal","market",{signalId:E.signalId,orderId:At.id,score:E.score??null},void 0,We);Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Qn("short",b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0,note:Ee?void 0:"Exit not filled"})}}else if(E.type==="entry_long"&&i.allowLong)if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"entry",side:"long",kind:"stop_limit",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});ui?Pe(it.id,{status:"rejected",note:ui}):lt.push({action:"entry",side:"long",kind:"stop_limit",signalId:E.signalId,score:E.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("entry","long","stop",it+Dt):ii,At=at({action:"entry",side:"long",kind:Se,originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});ui?Pe(At.id,{status:"rejected",note:ui}):lt.push({action:"entry",side:"long",kind:Se,signalId:E.signalId,score:E.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:At.id})}}else{const it=at({action:"entry",side:"long",kind:"market",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(ui){Pe(it.id,{status:"rejected",note:ui}),Ft+=1;continue}if(i.positionMode==="netting"){const Qe="short";if(ue(Qe)){const At=at({action:"exit",side:Qe,kind:"market",originalKind:"market",status:"pending",createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,qtyPct:100,price:b,note:"AUTO netting close (reverse)"}),Ee=Ri(Qe,l,b,"signal","market",{signalId:E.signalId,orderId:At.id,score:E.score??null});Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Qn(Qe,b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0})}}const Dt=ns("long",l,b,Z,"market",He,{signalId:E.signalId,orderId:it.id,score:E.score??null},{qty:Re,cash:Oe,...We});if(Dt.ok){const Qe=Dt.lot;Pe(it.id,{status:"filled",filledIndex:l,filledTimestamp:Kt,fillPrice:Qe.entryPrice,fillQty:Qe.qty,fees:Qe.entryFee})}else Pe(it.id,{status:"rejected",note:Dt.reject||"Entry blocked"})}else if(E.type==="entry_short"&&i.allowShort)if(Se==="stop_limit"){if(Number.isFinite(Yt)&&Yt>0&&Number.isFinite(_t)&&_t>0){const it=at({action:"entry",side:"short",kind:"stop_limit",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,stopPrice:Yt,limitPrice:_t});ui?Pe(it.id,{status:"rejected",note:ui}):lt.push({action:"entry",side:"short",kind:"stop_limit",signalId:E.signalId,score:E.score??null,stopPrice:Yt,limitPrice:_t,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:it.id})}}else if(Se==="limit"||Se==="stop"||Se==="mit"||Se==="lit"||Se==="trailing_stop"){if(Number.isFinite(ii)&&ii>0){const it=typeof Pt=="number"&&Number.isFinite(Pt)?Pt:b,Dt=Ot!=null&&Number.isFinite(Ot)?Ot:bt!=null&&Number.isFinite(bt)?it*bt/100:null,Qe=Se==="trailing_stop"&&Dt!=null?B("entry","short","stop",it-Dt):ii,At=at({action:"entry",side:"short",kind:Se,originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l+1,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe,trailPct:bt??void 0,trailOffset:Ot??void 0,trailPrice:Pt??void 0,price:Qe,limitPrice:Se==="lit"?_t:void 0});ui?Pe(At.id,{status:"rejected",note:ui}):lt.push({action:"entry",side:"short",kind:Se,signalId:E.signalId,score:E.score??null,price:Qe,limitPrice:Se==="lit"?_t:void 0,activeFromIndex:l+1,expiresAtIndex:xt,ocoGroup:Be,bracket:He,...qi,orderId:At.id})}}else{const it=at({action:"entry",side:"short",kind:"market",originalKind:Se,status:"pending",signalId:E.signalId,ocoGroup:Be,createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,expiresAtIndex:xt,qtyPct:Z,qty:Re,cash:Oe,tif:Xe});if(ui){Pe(it.id,{status:"rejected",note:ui}),Ft+=1;continue}if(i.positionMode==="netting"){const Qe="long";if(ue(Qe)){const At=at({action:"exit",side:Qe,kind:"market",originalKind:"market",status:"pending",createdIndex:l,createdTimestamp:Kt,activeFromIndex:l,qtyPct:100,price:b,note:"AUTO netting close (reverse)"}),Ee=Ri(Qe,l,b,"signal","market",{signalId:E.signalId,orderId:At.id,score:E.score??null});Pe(At.id,{status:Ee?"filled":"rejected",filledIndex:Ee?l:void 0,filledTimestamp:Ee?Kt:void 0,fillPrice:(Ee==null?void 0:Ee.execPrice)??Qn(Qe,b,"market"),fillQty:(Ee==null?void 0:Ee.qtyClosed)??0,fees:(Ee==null?void 0:Ee.exitFees)??0})}}const Dt=ns("short",l,b,Z,"market",He,{signalId:E.signalId,orderId:it.id,score:E.score??null},{qty:Re,cash:Oe,...We});if(Dt.ok){const Qe=Dt.lot;Pe(it.id,{status:"filled",filledIndex:l,filledTimestamp:Kt,fillPrice:Qe.entryPrice,fillQty:Qe.qty,fees:Qe.entryFee})}else Pe(it.id,{status:"rejected",note:Dt.reject||"Entry blocked"})}Ft+=1}let q=Ei(l,b);if(!et){const E=Ue-q,x=y??(Ct!=null?Ue*Ct:null),T=Qt>0?(Qt-q)/Qt:0,F=Qt-q,Z=we!=null&&T>=we||Te!=null&&F>=Te,de=x!=null&&Number.isFinite(E)&&E>=x;(Z||de)&&(et=!0,ls("Canceled by risk limit"),ue("long")&&Ri("long",l,b,"signal","market"),ue("short")&&Ri("short",l,b,"signal","market"),q=Ei(l,b))}{const E=(za=e==null?void 0:e[l])==null?void 0:za.timestamp,x=Number(E);qe.push({index:l,timestamp:Number.isFinite(x)&&x>0?x:Date.now(),equity:q})}if(q>Qt&&(Qt=q),Qt>0){const E=(Qt-q)/Qt;E>xi&&(xi=E);const x=Qt-q;x>Ii&&(Ii=x)}if(Number.isFinite(q)){if(!Number.isFinite(Zt)||q<Zt)Zt=q;else if(Zt>0){const E=q-Zt;E>Ai&&(Ai=E);const x=E/Zt;x>Fi&&(Fi=x)}}us+=1,De()&&(Ma+=1);const z=Wi("long")-Wi("short");ot[l]=z,Vt[l]=ti(),$t[l]=Ge("long")+Ge("short"),Nt[l]=Ae.length,Tt[l]=mn(b),gt[l]=ie-H,Ze[l]=G,Rt[l]=W,N[l]=re,g[l]=oe,j[l]=Ae.length>0?re/Ae.length*100:0,K[l]=xi*100,$[l]=Ii,ve[l]=Fi*100,se[l]=Ai,R[l]=q,w[l]=q-n,ge[l]=Ae.length>0?(ie-H)/Ae.length:0,$e[l]=re>0?G/re:0,Je[l]=oe>0?-(W/oe):0,k[l]=Ae.length>0?ce/Ae.length:0;{const E=[];for(const x of ee("long"))x.qty<=1e-12||E.push({side:"long",qty:x.qty,entryIndex:x.entryIndex,entryTimestamp:x.entryTimestamp,entryPrice:x.entryPrice,entryFee:x.entryFee,entrySignalId:x.entrySignalId,entryOrderId:x.entryOrderId,entrySignalScore:x.entrySignalScore??null,maxFav:x.maxFav,maxAdv:x.maxAdv});for(const x of ee("short"))x.qty<=1e-12||E.push({side:"short",qty:x.qty,entryIndex:x.entryIndex,entryTimestamp:x.entryTimestamp,entryPrice:x.entryPrice,entryFee:x.entryFee,entrySignalId:x.entrySignalId,entryOrderId:x.entryOrderId,entrySignalScore:x.entrySignalScore??null,maxFav:x.maxFav,maxAdv:x.maxAdv});E.sort((x,T)=>T.entryIndex-x.entryIndex),O[l]=E}}if(i.closeOnEnd&&De()&&e.length){const l=di,p=Nr(e[l]);if(p!=null){ue("long")&&Ri("long",l,p,"end","market"),ue("short")&&Ri("short",l,p,"end","market");const b=Ei(l,p);{const q=(Ua=e==null?void 0:e[l])==null?void 0:Ua.timestamp,z=Number(q);qe.push({index:l,timestamp:Number.isFinite(z)&&z>0?z:Date.now(),equity:b})}if(b>Qt&&(Qt=b),Qt>0){const q=(Qt-b)/Qt;q>xi&&(xi=q);const z=Qt-b;z>Ii&&(Ii=z)}if(Number.isFinite(b)){if(!Number.isFinite(Zt)||b<Zt)Zt=b;else if(Zt>0){const q=b-Zt;q>Ai&&(Ai=q);const z=q/Zt;z>Fi&&(Fi=z)}}const L=Wi("long")-Wi("short");ot[l]=L,Vt[l]=ti(),$t[l]=Ge("long")+Ge("short"),Nt[l]=Ae.length,Tt[l]=mn(p),gt[l]=ie-H,Ze[l]=G,Rt[l]=W,N[l]=re,g[l]=oe,j[l]=Ae.length>0?re/Ae.length*100:0,K[l]=xi*100,$[l]=Ii,ve[l]=Fi*100,se[l]=Ai,R[l]=b,w[l]=b-n,ge[l]=Ae.length>0?(ie-H)/Ae.length:0,$e[l]=re>0?G/re:0,Je[l]=oe>0?-(W/oe):0,k[l]=Ae.length>0?ce/Ae.length:0,O[l]=[]}if(lt.length){for(const b of lt)Pe(b.orderId,{status:"canceled",note:"Canceled on end"});lt.length=0}}const fs=qe.length?qe[qe.length-1].equity:n,hs=fs-n,Pr=Ae.reduce((l,p)=>l+(p.pnl>0?p.pnl:0),0),Sr=Ae.reduce((l,p)=>l+(p.pnl<0?Math.abs(p.pnl):0),0),Hn=Ae.filter(l=>l.pnl>0).length,Cr=Ae.filter(l=>l.pnl<0).length,Gi=Ae.length,Ic=Gi?Hn/Gi*100:0,Fc=Gi?hs/Gi:0,Ir=Hn?Pr/Hn:0,Fr=Cr?-(Sr/Cr):0,Ac=Fr!==0?Math.abs(Ir/Fr):Ir>0?1/0:0,Ec=Gi>0?Ae.reduce((l,p)=>l+Math.max(0,p.exitIndex-p.entryIndex+1),0)/Gi:0,Mc=us>0?Ma/us*100:0,Jn=[];{let l="",p=NaN,b=0;for(const L of qe){const q=Number(L.timestamp);if(!Number.isFinite(q)||q<=0)continue;const z=new Date(q).toISOString().slice(0,10);l&&z!==l&&Number.isFinite(p)&&Jn.push({ts:b,eq:p}),l=z,p=L.equity,b=q}l&&Number.isFinite(p)&&Jn.push({ts:b,eq:p})}const cn=[];for(let l=1;l<Jn.length;l++){const p=Jn[l-1].eq,b=Jn[l].eq;Number.isFinite(p)&&p!==0&&Number.isFinite(b)&&cn.push((b-p)/p)}const ds=cn.length?cn.reduce((l,p)=>l+p,0)/cn.length:0,Ta=cn.length>1?cn.reduce((l,p)=>l+(p-ds)**2,0)/(cn.length-1):0,Ar=Ta>0?Math.sqrt(Ta):0,An=cn.filter(l=>l<0),Tc=An.length?An.reduce((l,p)=>l+p,0)/An.length:0,Ra=An.length>1?An.reduce((l,p)=>l+(p-Tc)**2,0)/(An.length-1):0,Oa=Ra>0?Math.sqrt(Ra):0,Rc=Ar>0?ds/Ar*Math.sqrt(252):0,Oc=Oa>0?ds/Oa*Math.sqrt(252):0,qc=Ar>0?Ar*Math.sqrt(252)*100:0,qa=qe.length?qe[0].equity:n,ms=qe.length?Number(qe[0].timestamp):NaN,ps=qe.length?Number(qe[qe.length-1].timestamp):NaN,La=Number.isFinite(ms)&&Number.isFinite(ps)&&ps>ms?(ps-ms)/(365*864e5):0,Va=qa>0?fs/qa:1,$a=La>0?Math.pow(Va,1/La)-1:Va-1,Lc=xi>0?$a/xi:$a>0?1/0:0,Ba=[];if(qe.length){const l=qe[0].index,p=Nr(e[l])??NaN;if(Number.isFinite(p)&&p>0){const b=n/p;for(let L=li;L<=di;L++){const q=Nr(e[L]);if(q==null||!Number.isFinite(q))continue;const z=(Wa=e==null?void 0:e[L])==null?void 0:Wa.timestamp,E=Number(z);Ba.push({index:L,timestamp:Number.isFinite(E)&&E>0?E:Date.now(),equity:b*q})}}}const Vc=Gi?Hn/Gi*Ir+Cr/Gi*Fr:0;let gs=0,ys=0;{let l=0,p=0;for(const b of Ae)b.pnl>0?(l+=1,p=0,l>gs&&(gs=l)):b.pnl<0&&(p+=1,l=0,p>ys&&(ys=p))}return{summary:{initialCapital:n,finalEquity:fs,netPnl:hs,netPnlPct:n>0?hs/n*100:0,grossProfit:Pr,grossLoss:Sr,profitFactor:Sr>0?Pr/Sr:Pr>0?1/0:0,trades:Gi,roundTrips:ft.length,wins:Hn,losses:Cr,winRate:Ic,maxDrawdownPct:xi*100,maxDrawdownValue:Ii,feesPaid:ae,avgTrade:Fc,avgWin:Ir,avgLoss:Fr,payoffRatio:Ac,expectancy:Vc,maxConsecWins:gs,maxConsecLosses:ys,exposurePct:Mc,maxRunupPct:Fi*100,maxRunupValue:Ai,avgBarsInTrade:Ec,volatilityPct:qc,sharpe:Rc,sortino:Oc,calmar:Lc},trades:Ae,roundTrips:ft,orders:pt,equity:qe,benchmark:Ba,series:{positionSize:ot,positionAvgPrice:Vt,openTrades:$t,closedTrades:Nt,openProfit:Tt,closedProfit:gt,grossProfit:Ze,grossLoss:Rt,winTrades:N,lossTrades:g,winRate:j,maxDrawdownPct:K,maxDrawdownValue:$,maxRunupPct:ve,maxRunupValue:se,avgTrade:ge,avgWin:$e,avgLoss:Je,avgBarsInTrade:k,equity:R,netProfit:w},accessors:{openTradesByBar:O,closedTrades:Ae}}}const dc=e=>{const t=e instanceof Error?e.message:"JS engine failed",i=e instanceof Error?e.stack:void 0;if(typeof i=="string"){const n=i.match(new RegExp(`${Er}:(\\d+):(\\d+)`));if(n){const a=Number(n[1]),r=Number(n[2]),s=Number.isFinite(a)?Math.max(1,a-bs):NaN,u=Number.isFinite(r)?Math.max(1,r):NaN;if(Number.isFinite(s)&&Number.isFinite(u))return`${t} (line ${s}, col ${u})`}}return t};function mc(e){var A,D;const t=((D=(A=e.base)==null?void 0:A.close)==null?void 0:D.length)??0;if(!t)return{id:e.id,error:"JS engine: no bars available"};if(t>Hi.maxSeriesPoints)return{id:e.id,error:`JS guardrail: max series points exceeded (${t} > ${Hi.maxSeriesPoints})`};const i=e.base.volume??new Array(t).fill(void 0),n=e.base.time??new Array(t).fill(void 0),a=new Array(t).fill(0).map((C,v)=>v),r=C=>{const v={value:0},S=no(t,v),U=Xn({open:e.base.open,high:e.base.high,low:e.base.low,close:e.base.close,volume:i,time:n,barIndex:a,indexRef:v,params:e.params}),V=Ka();V.resetRun();const ne=so(S,U),he=pr(U,v),me=gr(v),_e=xr(),we=br(),{request:Te,mtfRequests:Fe,mtfMissing:Ne}=lc({base:{open:e.base.open,high:e.base.high,low:e.base.low,close:e.base.close,volume:i,time:n,bar_index:a},baseIndexRef:v,params:e.params,mtf:e.mtf}),ze=ao(S,U,C),Ce=ze.alert,Ct=ze.alertcondition,y=Ha({ctx:U,ta:he,math:me,color:_e,str:we,request:Te,plot:ne.plot,plotshape:ne.plotshape,plotchar:ne.plotchar,plotcandle:ne.plotcandle,plotbar:ne.plotbar,plotohlc:ne.plotohlc,hline:ne.hline,fill:ne.fill,label:ne.label,line:ne.line,box:ne.box,polyline:ne.polyline,polygon:ne.polygon,overlay:ne.overlay,heatmap:ne.heatmap,table:ne.table,alert:Ce,alertcondition:Ct,strategy:ze,__guard:V.guard,__guardCall:V.enterCall,__guardExit:V.exitCall,__instrument:el}),c=Ya(e.code,y);typeof c.onInit=="function"&&(V.resetBar(),c.onInit(U),V.checkTime(),V.checkTotal());for(let o=0;o<t;o++)v.value=o,V.resetBar(),ro(S),typeof c.onBar=="function"&&(c.onBar(U),V.checkTime(),V.checkTotal());const M=oo(S);return{state:S,output:M,mtfRequests:Fe,mtfMissing:Ne}},s=C=>String(C||"").replace(/\s+/g,"_").toLowerCase(),u=(C,v,S,U)=>{if(typeof v=="number"&&Number.isFinite(v))return v;if(typeof v=="string"){const V=s(v),ne=C[V];if(ne){const me=ne[S];if(Number.isFinite(me))return me}const he=Number(v);if(Number.isFinite(he))return he}return U},h=(C,v,S)=>{if(typeof v=="number"&&Number.isFinite(v))return v;if(typeof v=="string"){const U=s(v),V=C[U];if(V){const he=V[S];if(Number.isFinite(he))return he}const ne=Number(v);if(Number.isFinite(ne))return ne}},m=(C,v)=>{const S=[];C.close;const U=n;return v.forEach((V,ne)=>{const he=s((V==null?void 0:V.when)??"");if(!he)return;const me=C[he];if(!me)return;const _e=V!=null&&V.cooldownExpr?s(V.cooldownExpr):"",we=_e?C[_e]:null,Te=V!=null&&V.scoreExpr?s(V.scoreExpr):"",Fe=Te?C[Te]:null,Ne=typeof(V==null?void 0:V.cooldownBars)=="number"&&Number.isFinite(V.cooldownBars)?Math.max(0,Math.floor(V.cooldownBars)):0,ze=String((V==null?void 0:V.id)??ne),Ce=(V==null?void 0:V.orderId)!=null&&String(V.orderId).trim()?String(V.orderId).trim():void 0;let Ct=0;for(let y=0;y<t;y++){const c=me[y];if(!Number.isFinite(c)||c===0)continue;const M=we&&Number.isFinite(we[y])?Math.max(0,Math.floor(we[y])):Ne;if(M>0&&y<Ct)continue;Ct=y+M;const o=u(C,"close",y,0),f=V==null?void 0:V.order;let P;if(f&&typeof f=="object"){const X=String(f.kind||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop|trailingstop|trailstop/g,"trailing_stop"),B=X==="limit"||X==="stop"||X==="mit"||X==="lit"?u(C,f.price??f.limitPrice??f.stopPrice,y,o):void 0,te=X==="stop_limit"?h(C,f.stopPrice??f.price,y):void 0,ie=X==="stop_limit"||X==="lit"?h(C,f.limitPrice??f.price,y):void 0,ae=h(C,f.qty,y),fe=h(C,f.cash,y),ee=h(C,f.commissionPct,y),ue=typeof f.commissionType=="string"?f.commissionType:void 0,De=h(C,f.commissionValue,y),Ge=h(C,f.commissionCash,y),Ye=h(C,f.commissionPerUnit,y),Ae=h(C,f.slippagePct,y),ft=typeof f.slippageType=="string"?f.slippageType:void 0,pt=h(C,f.slippageValue,y),qt=h(C,f.slippageAbs,y),Ut=h(C,f.slippageTicks,y),qe=h(C,f.trailPct,y),Lt=h(C,f.trailOffset,y),wt=h(C,f.trailPrice,y),at=typeof f.tif=="string"?f.tif.toLowerCase():void 0,Pe=f.qtyPct==null?void 0:Math.max(0,Math.min(100,Number(f.qtyPct)||0));P={kind:X,price:B,stopPrice:te,limitPrice:ie,qty:ae,cash:fe,commissionPct:ee,commissionType:ue,commissionValue:De,commissionCash:Ge,commissionPerUnit:Ye,slippagePct:Ae,slippageType:ft,slippageValue:pt,slippageAbs:qt,slippageTicks:Ut,trailPct:qe,trailOffset:Lt,trailPrice:wt,qtyPct:Pe,oco:f.oco,expiresBars:f.expiresBars,tif:at,bracket:f.bracket}}const I=Fe&&Number.isFinite(Fe[y])?Fe[y]:typeof(V==null?void 0:V.score)=="number"?V.score:null;S.push({type:V.type,index:y,timestamp:Number.isFinite(U[y])?U[y]:Date.now(),signalId:ze,orderId:Ce,order:P,score:I,frequency:V==null?void 0:V.frequency})}}),S},_=(C,v)=>{const S=new Set,U=[],V=ne=>{const he=String(ne.code||ne.message||"").trim();!he||S.has(he)||(S.add(he),U.push(ne))};return C.forEach(V),v.forEach(V),U};try{const C=r();if(!C.state.strategyAccessorsUsed)return{id:e.id,output:C.output,diagnostics:C.state.diagnostics.length?C.state.diagnostics:void 0,mtfRequests:C.mtfRequests,mtfMissing:C.mtfMissing};let v={},S={},U=null;try{const _e=C.output.signals||[],we=uc(C.output.strategy??!0);if(we){const Te=m(C.output.seriesMap,_e),Fe=e.base.close.map((ze,Ce)=>{var Ct;return{index:Ce,timestamp:Number.isFinite(n[Ce])?n[Ce]:0,open:e.base.open[Ce],high:e.base.high[Ce],low:e.base.low[Ce],close:ze??NaN,volume:(Ct=e.base.volume)==null?void 0:Ct[Ce]}}),Ne=hc(Fe,Te,we);if(Ne&&Ne.series){const ze=(Ct,y=NaN)=>!Ct||Ct.length!==t?new Array(t).fill(Number.isFinite(y)?y:void 0):Ct.map(c=>Number.isFinite(c)?c:void 0);v={position_size:ze(Ne.series.positionSize,0),position_avg_price:ze(Ne.series.positionAvgPrice,NaN),opentrades:ze(Ne.series.openTrades,0),closedtrades:ze(Ne.series.closedTrades,0),openprofit:ze(Ne.series.openProfit,0),closedprofit:ze(Ne.series.closedProfit,0),grossprofit:ze(Ne.series.grossProfit,0),grossloss:ze(Ne.series.grossLoss,0),wintrades:ze(Ne.series.winTrades,0),losstrades:ze(Ne.series.lossTrades,0),winrate:ze(Ne.series.winRate,0),max_drawdown:ze(Ne.series.maxDrawdownPct,0),max_drawdown_value:ze(Ne.series.maxDrawdownValue,0),max_runup:ze(Ne.series.maxRunupPct,0),max_runup_value:ze(Ne.series.maxRunupValue,0),avg_trade:ze(Ne.series.avgTrade,0),avg_win:ze(Ne.series.avgWin,0),avg_loss:ze(Ne.series.avgLoss,0),avg_bars_in_trade:ze(Ne.series.avgBarsInTrade,0),equity:ze(Ne.series.equity,0),net_profit:ze(Ne.series.netProfit,0)};const Ce=Ne.summary;S={initial_capital:we.initialCapital,final_equity:Ce.finalEquity,net_profit_pct:Ce.netPnlPct,gross_profit:Ce.grossProfit,gross_loss:Ce.grossLoss,profit_factor:Ce.profitFactor,trades:Ce.trades,wins:Ce.wins,losses:Ce.losses,round_trips:Ce.roundTrips,fees_paid:Ce.feesPaid,expectancy:Ce.expectancy,payoff_ratio:Ce.payoffRatio,max_consec_wins:Ce.maxConsecWins,max_consec_losses:Ce.maxConsecLosses,exposure_pct:Ce.exposurePct,max_runup_pct:Ce.maxRunupPct,max_runup_value:Ce.maxRunupValue,max_drawdown_pct:Ce.maxDrawdownPct,max_drawdown_value:Ce.maxDrawdownValue,avg_bars_in_trade:Ce.avgBarsInTrade,volatility_pct:Ce.volatilityPct,sharpe:Ce.sharpe,sortino:Ce.sortino,calmar:Ce.calmar},U=Ne.accessors??null}}}catch{}const V=r({emitSignals:!1,accessors:{series:v,constants:S,accessors:U||void 0}}),ne=new Set;C.state.signals.forEach(_e=>{ne.add(_e.when.name),Object.values(_e.series).forEach(we=>ne.add(we.name))});const he={...V.output.seriesMap||{}};Object.entries(C.output.seriesMap||{}).forEach(([_e,we])=>{ne.has(_e)?he[_e]=we:_e in he||(he[_e]=we)});const me=_(C.state.diagnostics,V.state.diagnostics);return{id:e.id,output:{...V.output,seriesMap:he,signals:C.output.signals,strategy:C.output.strategy},diagnostics:me.length?me:void 0,mtfRequests:C.mtfRequests,mtfMissing:C.mtfMissing}}catch(C){return{id:e.id,error:dc(C)}}}const Pa=self;Pa.onmessage=e=>{const t=e.data;let i;try{i=mc(t)}catch(n){const a=n instanceof Error?n.message:"JS worker failed";i={id:(t==null?void 0:t.id)||"unknown",error:a}}Pa.postMessage(i)}})();
