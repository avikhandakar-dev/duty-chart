import{dt as Nd,bA as va,X as G,du as Mg,H,J as M,aH as Ae,ap as We,dv as Rg,dw as Dd,R as v,_ as Eo,b5 as Id,o as Oe,dx as vh,q as ot,a5 as lt,ab as Fe,cr as kd,P as D,dy as Sa,br as fe,dz as Nr,dA as Ji,bd as Ag,bM as to,z as Og,l as I,b4 as Nt,D as pe,cv as Td,a1 as Il,a0 as se,dB as zr,N as Ed,aR as Fn,aD as ee,V as F,dC as Pg,aB as Sh,dD as Bg,dE as Fg,aN as $s,dF as Wg,b$ as Mo,ak as Vg,ah as Is,aP as et,aQ as Md,W as ne,bq as Rd,aX as Hg,aW as Dr,cG as zg,b8 as xh,b0 as Gs,c0 as Ri,b1 as Sn,d5 as Ad,S as Y,aO as oe,aA as ni,aE as Wn,cd as Od,cU as Ug,u as Pd,bg as Ai,bm as jg,d0 as ks,cZ as oi,bs as Li,az as xa,d6 as $g,aJ as Ir,F as kl,aq as Gg,c as Ks,bo as Kg,M as Ui,ci as Bd,c9 as Fd,T as xn,d3 as Ts,aT as Wd,ar as Tl,cJ as qg,aa as qs,b9 as Zs,bh as Zg,dG as El,cb as ya,at as Qg,cN as yh,dH as ri,bH as Yg,dI as Nh,am as Je,ac as Vd,dJ as Xg,dp as ji,dK as cs,cf as vo,U as ln,cx as Kn,cu as Hd,dL as Es,dM as zd,cW as Jg,dN as ef,dO as tf,Y as nf,dP as sf,ai as si,dQ as Ud,bO as of,dR as rf,cz as Dh,dS as af,Q as Ml,cc as Ih,a4 as jd,bQ as lf,dT as hf,bX as $i,r as cf,dU as $d,dV as kh,dc as Ms,dd as df,cY as uf,dW as gf,dX as Ro,b2 as ff,bD as mf,ad as Na,dY as Da,w as pf,dZ as _f,d_ as Cf,cL as bf,bz as wf,bb as Lf,d$ as vf,bc as Sf,e0 as Th,bE as xf,e1 as yf,e2 as Gd,e3 as Nf,e4 as io,e5 as no,cm as en,aS as Oi,e6 as Kd,A as W,j as A,e7 as Df,h as Ia,e8 as If,e9 as kf,B as qd,f as Ao,a3 as Tf,ea as Ef,aw as Mf,dm as Eh,eb as Zd,d9 as ka,ec as Rf,ed as Mh,an as Af,bC as Of,aC as Pf,bx as Bf,Z as Ff,ee as so,ao as Wf,ef as Vf,a6 as Rh,ds as Ur,eg as Hf,g as zf,I as Uf,ax as Ah}from"./editorContextKeys.Cdn_dJhV.js";import{bt as qe,bQ as Oh,E as So,bu as Qd,bR as jf,e as $f,b as Rl,P as Yd,aF as Gf,aH as Kf,L as Xd,T as qn,aU as Ta,an as $t,J as Jd,K as eu,aW as Ne,N as K,Q as be,H as le,a as Ea,bS as Ph,bT as qf,a4 as Zf,W as kr,bU as Qf,ao as T,bV as Yf,A as Dt,bW as Xf,bX as Jf,bY as em,bZ as tm,bd as Al,b_ as im,b$ as nm,c0 as sm,c1 as om,c2 as rm,c3 as am,c4 as lm,c5 as hm,c6 as cm,c7 as dm,c8 as um,ap as gm,c9 as fm,ca as mm,cb as pm,cc as _m,cd as Cm,ce as bm,cf as wm,cg as Lm,ch as vm,ci as Sm,q as xm,cj as ym,Z as Vn,ck as Nm,cl as Dm,cm as Im,cn as km,co as Tm,cp as Em,cq as Mm,cr as Rm,cs as Am,ct as Om,cu as Pm,cv as Bm,cw as Fm,cx as Wm,cy as Vm,cz as Hm,cA as zm,cB as Um,cC as jm,cD as $m,cE as Gm,cF as Km,cG as qm,cH as Zm,cI as Bh,cJ as Qm,cK as Ym,cL as Xm,cM as Jm,cN as Fh,cO as Wh,cP as ep,cQ as tp,cR as ip,cS as np,cT as sp,cU as op,cV as rp,cW as tu,cX as iu,cY as ap,cZ as lp,c_ as hp,c$ as cp,d0 as nu,d1 as dp,d2 as up,d3 as gp,d4 as fp,d5 as mp,bf as pp,d6 as su,d7 as _p,w as Cp,v as bp,u as wp,s as Lp,d8 as vp,d9 as Sp,da as xp,db as yp,dc as Np,dd as Dp,de as Ip,df as kp,dg as Tp,dh as Ep,c as P,ar as Vh,at as ou,U as yn,az as Oo,ay as Hh,Y as Ma,aA as zh,di as Mp,bl as Ra,dj as ct,dk as Rp,dl as dt,B as Ap,dm as Uh,dn as jh,bs as st,bo as Op,dp as Aa,aE as $h,am as ai,aL as tn,z as Oa,au as Pp,dq as Bp,dr as Fp,b3 as jr,aX as Wp,ds as Vp,aM as oo,bL as Hp,X as zp,ac as ru,bx as Q,dt as Up,bF as jp,aD as au,du as Gh,dv as Et,dw as $p,dx as Gp,t as Kp,dy as qp,dz as Zp,dA as at,dB as Po,dC as Qp,ax as Yp,dD as Xp}from"./iconRegistry.BQALo55A.js";import{r as Jp,a as te,b as e_}from"./stableEditorScroll.DHPB0mmN.js";class t_ extends H{constructor(e){super(),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._listener=()=>this._handleChange(e,!0),this._mediaQueryList=null,this._handleChange(e,!1)}_handleChange(e,t){var i;(i=this._mediaQueryList)==null||i.removeEventListener("change",this._listener),this._mediaQueryList=e.matchMedia(`(resolution: ${e.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener("change",this._listener),t&&this._onDidChange.fire()}}class i_ extends H{get value(){return this._value}constructor(e){super(),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._value=this._getPixelRatio(e);const t=this._register(new t_(e));this._register(t.onDidChange(()=>{this._value=this._getPixelRatio(e),this._onDidChange.fire(this._value)}))}_getPixelRatio(e){const t=document.createElement("canvas").getContext("2d"),i=e.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return i/n}}class n_{constructor(){this.mapWindowIdToPixelRatioMonitor=new Map}_getOrCreatePixelRatioMonitor(e){const t=Nd(e);let i=this.mapWindowIdToPixelRatioMonitor.get(t);return i||(i=va(new i_(e)),this.mapWindowIdToPixelRatioMonitor.set(t,i),va(G.once(Mg)(({vscodeWindowId:n})=>{n===t&&(i==null||i.dispose(),this.mapWindowIdToPixelRatioMonitor.delete(t))}))),i}getInstance(e){return this._getOrCreatePixelRatioMonitor(e)}}const Bo=new n_;class s_{constructor(e,t){this.chr=e,this.type=t,this.width=0}fulfill(e){this.width=e}}class Ol{constructor(e,t){this._bareFontInfo=e,this._requests=t,this._container=null,this._testElements=null}read(e){var t;this._createDomElements(),e.document.body.appendChild(this._container),this._readFromDomElements(),(t=this._container)==null||t.remove(),this._container=null,this._testElements=null}_createDomElements(){const e=document.createElement("div");e.style.position="absolute",e.style.top="-50000px",e.style.width="50000px";const t=document.createElement("div");qe(t,this._bareFontInfo),e.appendChild(t);const i=document.createElement("div");qe(i,this._bareFontInfo),i.style.fontWeight="bold",e.appendChild(i);const n=document.createElement("div");qe(n,this._bareFontInfo),n.style.fontStyle="italic",e.appendChild(n);const s=[];for(const o of this._requests){let r;o.type===0&&(r=t),o.type===2&&(r=i),o.type===1&&(r=n),r.appendChild(document.createElement("br"));const l=document.createElement("span");Ol._render(l,o),r.appendChild(l),s.push(l)}this._container=e,this._testElements=s}static _render(e,t){if(t.chr===" "){let i=" ";for(let n=0;n<8;n++)i+=i;e.innerText=i}else{let i=t.chr;for(let n=0;n<8;n++)i+=i;e.textContent=i}}_readFromDomElements(){for(let e=0,t=this._requests.length;e<t;e++){const i=this._requests[e],n=this._testElements[e];i.fulfill(n.offsetWidth/256)}}}function o_(a,e,t){new Ol(e,t).read(a)}const vi=new class{constructor(){this._zoomLevel=0,this._onDidChangeZoomLevel=new M,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event}getZoomLevel(){return this._zoomLevel}setZoomLevel(a){a=Math.min(Math.max(-5,a),20),this._zoomLevel!==a&&(this._zoomLevel=a,this._onDidChangeZoomLevel.fire(this._zoomLevel))}},r_=Ae?1.5:1.35,$r=8;class Nn{static createFromValidatedSettings(e,t,i){const n=e.get(49),s=e.get(53),o=e.get(52),r=e.get(51),l=e.get(54),h=e.get(67),c=e.get(64);return Nn._create(n,s,o,r,l,h,c,t,i)}static _create(e,t,i,n,s,o,r,l,h){o===0?o=r_*i:o<$r&&(o=o*i),o=Math.round(o),o<$r&&(o=$r);const c=1+(h?0:vi.getZoomLevel()*.1);return i*=c,o*=c,s===Oh.TRANSLATE&&(t==="normal"||t==="bold"?s=Oh.OFF:(s=`'wght' ${parseInt(t,10)}`,t="normal")),new Nn({pixelRatio:l,fontFamily:e,fontWeight:t,fontSize:i,fontFeatureSettings:n,fontVariationSettings:s,lineHeight:o,letterSpacing:r})}constructor(e){this._bareFontInfoBrand=void 0,this.pixelRatio=e.pixelRatio,this.fontFamily=String(e.fontFamily),this.fontWeight=String(e.fontWeight),this.fontSize=e.fontSize,this.fontFeatureSettings=e.fontFeatureSettings,this.fontVariationSettings=e.fontVariationSettings,this.lineHeight=e.lineHeight|0,this.letterSpacing=e.letterSpacing}getId(){return`${this.pixelRatio}-${this.fontFamily}-${this.fontWeight}-${this.fontSize}-${this.fontFeatureSettings}-${this.fontVariationSettings}-${this.lineHeight}-${this.letterSpacing}`}getMassagedFontFamily(){const e=So.fontFamily,t=Nn._wrapInQuotes(this.fontFamily);return e&&this.fontFamily!==e?`${t}, ${e}`:t}static _wrapInQuotes(e){return/[,"']/.test(e)?e:/[+ ]/.test(e)?`"${e}"`:e}}const a_=2;class Kh extends Nn{constructor(e,t){super(e),this._editorStylingBrand=void 0,this.version=a_,this.isTrusted=t,this.isMonospace=e.isMonospace,this.typicalHalfwidthCharacterWidth=e.typicalHalfwidthCharacterWidth,this.typicalFullwidthCharacterWidth=e.typicalFullwidthCharacterWidth,this.canUseHalfwidthRightwardsArrow=e.canUseHalfwidthRightwardsArrow,this.spaceWidth=e.spaceWidth,this.middotWidth=e.middotWidth,this.wsmiddotWidth=e.wsmiddotWidth,this.maxDigitWidth=e.maxDigitWidth}equals(e){return this.fontFamily===e.fontFamily&&this.fontWeight===e.fontWeight&&this.fontSize===e.fontSize&&this.fontFeatureSettings===e.fontFeatureSettings&&this.fontVariationSettings===e.fontVariationSettings&&this.lineHeight===e.lineHeight&&this.letterSpacing===e.letterSpacing&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.typicalFullwidthCharacterWidth===e.typicalFullwidthCharacterWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.maxDigitWidth===e.maxDigitWidth}}class l_ extends H{constructor(){super(...arguments),this._cache=new Map,this._evictUntrustedReadingsTimeout=-1,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event}dispose(){this._evictUntrustedReadingsTimeout!==-1&&(clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearAllFontInfos(){this._cache.clear(),this._onDidChange.fire()}_ensureCache(e){const t=Nd(e);let i=this._cache.get(t);return i||(i=new h_,this._cache.set(t,i)),i}_writeToCache(e,t,i){this._ensureCache(e).put(t,i),!i.isTrusted&&this._evictUntrustedReadingsTimeout===-1&&(this._evictUntrustedReadingsTimeout=e.setTimeout(()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings(e)},5e3))}_evictUntrustedReadings(e){const t=this._ensureCache(e),i=t.getValues();let n=!1;for(const s of i)s.isTrusted||(n=!0,t.remove(s));n&&this._onDidChange.fire()}readFontInfo(e,t){const i=this._ensureCache(e);if(!i.has(t)){let n=this._actualReadFontInfo(e,t);(n.typicalHalfwidthCharacterWidth<=2||n.typicalFullwidthCharacterWidth<=2||n.spaceWidth<=2||n.maxDigitWidth<=2)&&(n=new Kh({pixelRatio:Bo.getInstance(e).value,fontFamily:n.fontFamily,fontWeight:n.fontWeight,fontSize:n.fontSize,fontFeatureSettings:n.fontFeatureSettings,fontVariationSettings:n.fontVariationSettings,lineHeight:n.lineHeight,letterSpacing:n.letterSpacing,isMonospace:n.isMonospace,typicalHalfwidthCharacterWidth:Math.max(n.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(n.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:n.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(n.spaceWidth,5),middotWidth:Math.max(n.middotWidth,5),wsmiddotWidth:Math.max(n.wsmiddotWidth,5),maxDigitWidth:Math.max(n.maxDigitWidth,5)},!1)),this._writeToCache(e,t,n)}return i.get(t)}_createRequest(e,t,i,n){const s=new s_(e,t);return i.push(s),n==null||n.push(s),s}_actualReadFontInfo(e,t){const i=[],n=[],s=this._createRequest("n",0,i,n),o=this._createRequest("ｍ",0,i,null),r=this._createRequest(" ",0,i,n),l=this._createRequest("0",0,i,n),h=this._createRequest("1",0,i,n),c=this._createRequest("2",0,i,n),d=this._createRequest("3",0,i,n),u=this._createRequest("4",0,i,n),g=this._createRequest("5",0,i,n),f=this._createRequest("6",0,i,n),m=this._createRequest("7",0,i,n),_=this._createRequest("8",0,i,n),C=this._createRequest("9",0,i,n),p=this._createRequest("→",0,i,n),b=this._createRequest("￫",0,i,null),w=this._createRequest("·",0,i,n),L=this._createRequest("⸱",0,i,null),S="|/-_ilm%";for(let k=0,E=S.length;k<E;k++)this._createRequest(S.charAt(k),0,i,n),this._createRequest(S.charAt(k),1,i,n),this._createRequest(S.charAt(k),2,i,n);o_(e,t,i);const y=Math.max(l.width,h.width,c.width,d.width,u.width,g.width,f.width,m.width,_.width,C.width);let N=t.fontFeatureSettings===Qd.OFF;const x=n[0].width;for(let k=1,E=n.length;N&&k<E;k++){const O=x-n[k].width;if(O<-.001||O>.001){N=!1;break}}let R=!0;return N&&b.width!==x&&(R=!1),b.width>p.width&&(R=!1),new Kh({pixelRatio:Bo.getInstance(e).value,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontFeatureSettings:t.fontFeatureSettings,fontVariationSettings:t.fontVariationSettings,lineHeight:t.lineHeight,letterSpacing:t.letterSpacing,isMonospace:N,typicalHalfwidthCharacterWidth:s.width,typicalFullwidthCharacterWidth:o.width,canUseHalfwidthRightwardsArrow:R,spaceWidth:r.width,middotWidth:w.width,wsmiddotWidth:L.width,maxDigitWidth:y},!0)}}class h_{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(e){const t=e.getId();return!!this._values[t]}get(e){const t=e.getId();return this._values[t]}put(e,t){const i=e.getId();this._keys[i]=e,this._values[i]=t}remove(e){const t=e.getId();delete this._keys[t],delete this._values[t]}getValues(){return Object.keys(this._keys).map(e=>this._values[e])}}const qh=new l_;var Ve;(function(a){a[a.None=0]="None",a[a.Indent=1]="Indent",a[a.IndentOutdent=2]="IndentOutdent",a[a.Outdent=3]="Outdent"})(Ve||(Ve={}));class Gr{constructor(e){if(this._neutralCharacter=null,this._neutralCharacterSearched=!1,this.open=e.open,this.close=e.close,this._inString=!0,this._inComment=!0,this._inRegEx=!0,Array.isArray(e.notIn))for(let t=0,i=e.notIn.length;t<i;t++)switch(e.notIn[t]){case"string":this._inString=!1;break;case"comment":this._inComment=!1;break;case"regex":this._inRegEx=!1;break}}isOK(e){switch(e){case 0:return!0;case 1:return this._inComment;case 2:return this._inString;case 3:return this._inRegEx}}shouldAutoClose(e,t){if(e.getTokenCount()===0)return!0;const i=e.findTokenIndexAtOffset(t-2),n=e.getStandardTokenType(i);return this.isOK(n)}_findNeutralCharacterInRange(e,t){for(let i=e;i<=t;i++){const n=String.fromCharCode(i);if(!this.open.includes(n)&&!this.close.includes(n))return n}return null}findNeutralCharacter(){return this._neutralCharacterSearched||(this._neutralCharacterSearched=!0,this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(48,57)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(97,122)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(65,90))),this._neutralCharacter}}class c_{constructor(e){this.autoClosingPairsOpenByStart=new Map,this.autoClosingPairsOpenByEnd=new Map,this.autoClosingPairsCloseByStart=new Map,this.autoClosingPairsCloseByEnd=new Map,this.autoClosingPairsCloseSingleChar=new Map;for(const t of e)Xn(this.autoClosingPairsOpenByStart,t.open.charAt(0),t),Xn(this.autoClosingPairsOpenByEnd,t.open.charAt(t.open.length-1),t),Xn(this.autoClosingPairsCloseByStart,t.close.charAt(0),t),Xn(this.autoClosingPairsCloseByEnd,t.close.charAt(t.close.length-1),t),t.close.length===1&&t.open.length===1&&Xn(this.autoClosingPairsCloseSingleChar,t.close,t)}}function Xn(a,e,t){a.has(e)?a.get(e).push(t):a.set(e,[t])}const _n=class _n{constructor(e){if(e.autoClosingPairs?this._autoClosingPairs=e.autoClosingPairs.map(t=>new Gr(t)):e.brackets?this._autoClosingPairs=e.brackets.map(t=>new Gr({open:t[0],close:t[1]})):this._autoClosingPairs=[],e.__electricCharacterSupport&&e.__electricCharacterSupport.docComment){const t=e.__electricCharacterSupport.docComment;this._autoClosingPairs.push(new Gr({open:t.open,close:t.close||""}))}this._autoCloseBeforeForQuotes=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:_n.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES,this._autoCloseBeforeForBrackets=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:_n.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS,this._surroundingPairs=e.surroundingPairs||this._autoClosingPairs}getAutoClosingPairs(){return this._autoClosingPairs}getAutoCloseBeforeSet(e){return e?this._autoCloseBeforeForQuotes:this._autoCloseBeforeForBrackets}getSurroundingPairs(){return this._surroundingPairs}};_n.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES=`;:.,=}])> 
	`,_n.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS=`'"\`;:.,=}])> 
	`;let Pa=_n;function Ti(a,e){const t=a.getCount(),i=a.findTokenIndexAtOffset(e),n=a.getLanguageId(i);let s=i;for(;s+1<t&&a.getLanguageId(s+1)===n;)s++;let o=i;for(;o>0&&a.getLanguageId(o-1)===n;)o--;return new d_(a,n,o,s+1,a.getStartOffset(o),a.getEndOffset(s))}class d_{constructor(e,t,i,n,s,o){this._scopedLineTokensBrand=void 0,this._actual=e,this.languageId=t,this._firstTokenIndex=i,this._lastTokenIndex=n,this.firstCharOffset=s,this._lastCharOffset=o,this.languageIdCodec=e.languageIdCodec}getLineContent(){return this._actual.getLineContent().substring(this.firstCharOffset,this._lastCharOffset)}getLineLength(){return this._lastCharOffset-this.firstCharOffset}getActualLineContentBefore(e){return this._actual.getLineContent().substring(0,this.firstCharOffset+e)}getTokenCount(){return this._lastTokenIndex-this._firstTokenIndex}findTokenIndexAtOffset(e){return this._actual.findTokenIndexAtOffset(e+this.firstCharOffset)-this._firstTokenIndex}getStandardTokenType(e){return this._actual.getStandardTokenType(e+this._firstTokenIndex)}toIViewLineTokens(){return this._actual.sliceAndInflate(this.firstCharOffset,this._lastCharOffset,0)}}function Ct(a){return(a&3)!==0}let Kr;function lu(){return Kr||(Kr=new TextDecoder("UTF-16LE")),Kr}let qr;function u_(){return qr||(qr=new TextDecoder("UTF-16BE")),qr}let Zr;function hu(){return Zr||(Zr=Rg()?lu():u_()),Zr}function g_(a,e,t){const i=new Uint16Array(a.buffer,e,t);return t>0&&(i[0]===65279||i[0]===65534)?f_(a,e,t):lu().decode(i)}function f_(a,e,t){const i=[];let n=0;for(let s=0;s<t;s++){const o=jf(a,e);e+=2,i[n++]=String.fromCharCode(o)}return i.join("")}class Pl{constructor(e){this._capacity=e|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const e=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return hu().decode(e)}_flushBuffer(){const e=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[e]:this._completedStrings[this._completedStrings.length]=e}appendCharCode(e){const t=this._capacity-this._bufferLength;t<=1&&(t===0||We(e))&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendASCIICharCode(e){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendString(e){const t=e.length;if(this._bufferLength+t>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=e;return}for(let i=0;i<t;i++)this._buffer[this._bufferLength++]=e.charCodeAt(i)}}class Fo{constructor(e,t,i,n,s,o){this._richEditBracketBrand=void 0,this.languageId=e,this.index=t,this.open=i,this.close=n,this.forwardRegex=s,this.reversedRegex=o,this._openSet=Fo._toSet(this.open),this._closeSet=Fo._toSet(this.close)}isOpen(e){return this._openSet.has(e)}isClose(e){return this._closeSet.has(e)}static _toSet(e){const t=new Set;for(const i of e)t.add(i);return t}}function m_(a){const e=a.length;a=a.map(o=>[o[0].toLowerCase(),o[1].toLowerCase()]);const t=[];for(let o=0;o<e;o++)t[o]=o;const i=(o,r)=>{const[l,h]=o,[c,d]=r;return l===c||l===d||h===c||h===d},n=(o,r)=>{const l=Math.min(o,r),h=Math.max(o,r);for(let c=0;c<e;c++)t[c]===h&&(t[c]=l)};for(let o=0;o<e;o++){const r=a[o];for(let l=o+1;l<e;l++){const h=a[l];i(r,h)&&n(t[o],t[l])}}const s=[];for(let o=0;o<e;o++){const r=[],l=[];for(let h=0;h<e;h++)if(t[h]===o){const[c,d]=a[h];r.push(c),l.push(d)}r.length>0&&s.push({open:r,close:l})}return s}class p_{constructor(e,t){this._richEditBracketsBrand=void 0;const i=m_(t);this.brackets=i.map((n,s)=>new Fo(e,s,n.open,n.close,__(n.open,n.close,i,s),C_(n.open,n.close,i,s))),this.forwardRegex=b_(this.brackets),this.reversedRegex=w_(this.brackets),this.textIsBracket={},this.textIsOpenBracket={},this.maxBracketLength=0;for(const n of this.brackets){for(const s of n.open)this.textIsBracket[s]=n,this.textIsOpenBracket[s]=!0,this.maxBracketLength=Math.max(this.maxBracketLength,s.length);for(const s of n.close)this.textIsBracket[s]=n,this.textIsOpenBracket[s]=!1,this.maxBracketLength=Math.max(this.maxBracketLength,s.length)}}}function cu(a,e,t,i){for(let n=0,s=e.length;n<s;n++){if(n===t)continue;const o=e[n];for(const r of o.open)r.indexOf(a)>=0&&i.push(r);for(const r of o.close)r.indexOf(a)>=0&&i.push(r)}}function du(a,e){return a.length-e.length}function Tr(a){if(a.length<=1)return a;const e=[],t=new Set;for(const i of a)t.has(i)||(e.push(i),t.add(i));return e}function __(a,e,t,i){let n=[];n=n.concat(a),n=n.concat(e);for(let s=0,o=n.length;s<o;s++)cu(n[s],t,i,n);return n=Tr(n),n.sort(du),n.reverse(),Qs(n)}function C_(a,e,t,i){let n=[];n=n.concat(a),n=n.concat(e);for(let s=0,o=n.length;s<o;s++)cu(n[s],t,i,n);return n=Tr(n),n.sort(du),n.reverse(),Qs(n.map(Bl))}function b_(a){let e=[];for(const t of a){for(const i of t.open)e.push(i);for(const i of t.close)e.push(i)}return e=Tr(e),Qs(e)}function w_(a){let e=[];for(const t of a){for(const i of t.open)e.push(i);for(const i of t.close)e.push(i)}return e=Tr(e),Qs(e.map(Bl))}function L_(a){const e=/^[\w ]+$/.test(a);return a=Eo(a),e?`\\b${a}\\b`:a}function Qs(a,e){const t=`(${a.map(L_).join(")|(")})`;return Dd(t,!0,e)}const Bl=function(){function a(i){const n=new Uint16Array(i.length);let s=0;for(let o=i.length-1;o>=0;o--)n[s++]=i.charCodeAt(o);return hu().decode(n)}let e=null,t=null;return function(n){return e!==n&&(e=n,t=a(e)),t}}();class rt{static _findPrevBracketInText(e,t,i,n){const s=i.match(e);if(!s)return null;const o=i.length-(s.index||0),r=s[0].length,l=n+o;return new v(t,l-r+1,t,l+1)}static findPrevBracketInRange(e,t,i,n,s){const r=Bl(i).substring(i.length-s,i.length-n);return this._findPrevBracketInText(e,t,r,n)}static findNextBracketInText(e,t,i,n){const s=i.match(e);if(!s)return null;const o=s.index||0,r=s[0].length;if(r===0)return null;const l=n+o;return new v(t,l+1,t,l+1+r)}static findNextBracketInRange(e,t,i,n,s){const o=i.substring(n,s);return this.findNextBracketInText(e,t,o,n)}}class v_{constructor(e){this._richEditBrackets=e}getElectricCharacters(){const e=[];if(this._richEditBrackets)for(const t of this._richEditBrackets.brackets)for(const i of t.close){const n=i.charAt(i.length-1);e.push(n)}return Id(e)}onElectricCharacter(e,t,i){if(!this._richEditBrackets||this._richEditBrackets.brackets.length===0)return null;const n=t.findTokenIndexAtOffset(i-1);if(Ct(t.getStandardTokenType(n)))return null;const s=this._richEditBrackets.reversedRegex,o=t.getLineContent().substring(0,i-1)+e,r=rt.findPrevBracketInRange(s,1,o,0,o.length);if(!r)return null;const l=o.substring(r.startColumn-1,r.endColumn-1).toLowerCase();if(this._richEditBrackets.textIsOpenBracket[l])return null;const c=t.getActualLineContentBefore(r.startColumn-1);return/^\s*$/.test(c)?{matchOpenBracket:l}:null}}function ro(a){return a.global&&(a.lastIndex=0),!0}class S_{constructor(e){this._indentationRules=e}shouldIncrease(e){return!!(this._indentationRules&&this._indentationRules.increaseIndentPattern&&ro(this._indentationRules.increaseIndentPattern)&&this._indentationRules.increaseIndentPattern.test(e))}shouldDecrease(e){return!!(this._indentationRules&&this._indentationRules.decreaseIndentPattern&&ro(this._indentationRules.decreaseIndentPattern)&&this._indentationRules.decreaseIndentPattern.test(e))}shouldIndentNextLine(e){return!!(this._indentationRules&&this._indentationRules.indentNextLinePattern&&ro(this._indentationRules.indentNextLinePattern)&&this._indentationRules.indentNextLinePattern.test(e))}shouldIgnore(e){return!!(this._indentationRules&&this._indentationRules.unIndentedLinePattern&&ro(this._indentationRules.unIndentedLinePattern)&&this._indentationRules.unIndentedLinePattern.test(e))}getIndentMetadata(e){let t=0;return this.shouldIncrease(e)&&(t+=1),this.shouldDecrease(e)&&(t+=2),this.shouldIndentNextLine(e)&&(t+=4),this.shouldIgnore(e)&&(t+=8),t}}class hn{constructor(e){e=e||{},e.brackets=e.brackets||[["(",")"],["{","}"],["[","]"]],this._brackets=[],e.brackets.forEach(t=>{const i=hn._createOpenBracketRegExp(t[0]),n=hn._createCloseBracketRegExp(t[1]);i&&n&&this._brackets.push({open:t[0],openRegExp:i,close:t[1],closeRegExp:n})}),this._regExpRules=e.onEnterRules||[]}onEnter(e,t,i,n){if(e>=3)for(let s=0,o=this._regExpRules.length;s<o;s++){const r=this._regExpRules[s];if([{reg:r.beforeText,text:i},{reg:r.afterText,text:n},{reg:r.previousLineText,text:t}].every(h=>h.reg?(h.reg.lastIndex=0,h.reg.test(h.text)):!0))return r.action}if(e>=2&&i.length>0&&n.length>0)for(let s=0,o=this._brackets.length;s<o;s++){const r=this._brackets[s];if(r.openRegExp.test(i)&&r.closeRegExp.test(n))return{indentAction:Ve.IndentOutdent}}if(e>=2&&i.length>0){for(let s=0,o=this._brackets.length;s<o;s++)if(this._brackets[s].openRegExp.test(i))return{indentAction:Ve.Indent}}return null}static _createOpenBracketRegExp(e){let t=Eo(e);return/\B/.test(t.charAt(0))||(t="\\b"+t),t+="\\s*$",hn._safeRegExp(t)}static _createCloseBracketRegExp(e){let t=Eo(e);return/\B/.test(t.charAt(t.length-1))||(t=t+"\\b"),t="^\\s*"+t,hn._safeRegExp(t)}static _safeRegExp(e){try{return new RegExp(e)}catch(t){return Oe(t),null}}}class x_{constructor(e,t){this.languageId=e;const i=t.brackets?Zh(t.brackets):[],n=new vh(r=>{const l=new Set;return{info:new y_(this,r,l),closing:l}}),s=new vh(r=>{const l=new Set,h=new Set;return{info:new N_(this,r,l,h),opening:l,openingColorized:h}});for(const[r,l]of i){const h=n.get(r),c=s.get(l);h.closing.add(c.info),c.opening.add(h.info)}const o=t.colorizedBracketPairs?Zh(t.colorizedBracketPairs):i.filter(r=>!(r[0]==="<"&&r[1]===">"));for(const[r,l]of o){const h=n.get(r),c=s.get(l);h.closing.add(c.info),c.openingColorized.add(h.info),c.opening.add(h.info)}this._openingBrackets=new Map([...n.cachedValues].map(([r,l])=>[r,l.info])),this._closingBrackets=new Map([...s.cachedValues].map(([r,l])=>[r,l.info]))}get openingBrackets(){return[...this._openingBrackets.values()]}get closingBrackets(){return[...this._closingBrackets.values()]}getOpeningBracketInfo(e){return this._openingBrackets.get(e)}getClosingBracketInfo(e){return this._closingBrackets.get(e)}getBracketInfo(e){return this.getOpeningBracketInfo(e)||this.getClosingBracketInfo(e)}getBracketRegExp(e){const t=Array.from([...this._openingBrackets.keys(),...this._closingBrackets.keys()]);return Qs(t,e)}}function Zh(a){return a.filter(([e,t])=>e!==""&&t!=="")}class uu{constructor(e,t){this.config=e,this.bracketText=t}get languageId(){return this.config.languageId}}class y_ extends uu{constructor(e,t,i){super(e,t),this.openedBrackets=i,this.isOpeningBracket=!0}}class N_ extends uu{constructor(e,t,i,n){super(e,t),this.openingBrackets=i,this.openingColorizedBrackets=n,this.isOpeningBracket=!1}closes(e){return e.config!==this.config?!1:this.openingBrackets.has(e)}closesColorized(e){return e.config!==this.config?!1:this.openingColorizedBrackets.has(e)}getOpeningBrackets(){return[...this.openingBrackets]}}var D_=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Qh=function(a,e){return function(t,i){e(t,i,a)}};class Qr{constructor(e){this.languageId=e}affects(e){return this.languageId?this.languageId===e:!0}}const Ys=ot("languageConfigurationService");let Ba=class extends H{constructor(e,t){super(),this.configurationService=e,this.languageService=t,this._registry=this._register(new E_),this.onDidChangeEmitter=this._register(new M),this.onDidChange=this.onDidChangeEmitter.event,this.configurations=new Map;const i=new Set(Object.values(Fa));this._register(this.configurationService.onDidChangeConfiguration(n=>{const s=n.change.keys.some(r=>i.has(r)),o=n.change.overrides.filter(([r,l])=>l.some(h=>i.has(h))).map(([r])=>r);if(s)this.configurations.clear(),this.onDidChangeEmitter.fire(new Qr(void 0));else for(const r of o)this.languageService.isRegisteredLanguageId(r)&&(this.configurations.delete(r),this.onDidChangeEmitter.fire(new Qr(r)))})),this._register(this._registry.onDidChange(n=>{this.configurations.delete(n.languageId),this.onDidChangeEmitter.fire(new Qr(n.languageId))}))}register(e,t,i){return this._registry.register(e,t,i)}getLanguageConfiguration(e){let t=this.configurations.get(e);return t||(t=I_(e,this._registry,this.configurationService,this.languageService),this.configurations.set(e,t)),t}};Ba=D_([Qh(0,$f),Qh(1,Rl)],Ba);function I_(a,e,t,i){let n=e.getLanguageConfiguration(a);if(!n){if(!i.isRegisteredLanguageId(a))return new Dn(a,{});n=new Dn(a,{})}const s=k_(n.languageId,t),o=fu([n.underlyingConfig,s]);return new Dn(n.languageId,o)}const Fa={brackets:"editor.language.brackets",colorizedBracketPairs:"editor.language.colorizedBracketPairs"};function k_(a,e){const t=e.getValue(Fa.brackets,{overrideIdentifier:a}),i=e.getValue(Fa.colorizedBracketPairs,{overrideIdentifier:a});return{brackets:Yh(t),colorizedBracketPairs:Yh(i)}}function Yh(a){if(Array.isArray(a))return a.map(e=>{if(!(!Array.isArray(e)||e.length!==2))return[e[0],e[1]]}).filter(e=>!!e)}function gu(a,e,t){const i=a.getLineContent(e);let n=Fe(i);return n.length>t-1&&(n=n.substring(0,t-1)),n}class T_{constructor(e){this.languageId=e,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(e,t){const i=new Xh(e,t,++this._order);return this._entries.push(i),this._resolved=null,lt(()=>{for(let n=0;n<this._entries.length;n++)if(this._entries[n]===i){this._entries.splice(n,1),this._resolved=null;break}})}getResolvedConfiguration(){if(!this._resolved){const e=this._resolve();e&&(this._resolved=new Dn(this.languageId,e))}return this._resolved}_resolve(){return this._entries.length===0?null:(this._entries.sort(Xh.cmp),fu(this._entries.map(e=>e.configuration)))}}function fu(a){let e={comments:void 0,brackets:void 0,wordPattern:void 0,indentationRules:void 0,onEnterRules:void 0,autoClosingPairs:void 0,surroundingPairs:void 0,autoCloseBefore:void 0,folding:void 0,colorizedBracketPairs:void 0,__electricCharacterSupport:void 0};for(const t of a)e={comments:t.comments||e.comments,brackets:t.brackets||e.brackets,wordPattern:t.wordPattern||e.wordPattern,indentationRules:t.indentationRules||e.indentationRules,onEnterRules:t.onEnterRules||e.onEnterRules,autoClosingPairs:t.autoClosingPairs||e.autoClosingPairs,surroundingPairs:t.surroundingPairs||e.surroundingPairs,autoCloseBefore:t.autoCloseBefore||e.autoCloseBefore,folding:t.folding||e.folding,colorizedBracketPairs:t.colorizedBracketPairs||e.colorizedBracketPairs,__electricCharacterSupport:t.__electricCharacterSupport||e.__electricCharacterSupport};return e}class Xh{constructor(e,t,i){this.configuration=e,this.priority=t,this.order=i}static cmp(e,t){return e.priority===t.priority?e.order-t.order:e.priority-t.priority}}class Jh{constructor(e){this.languageId=e}}class E_ extends H{constructor(){super(),this._entries=new Map,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._register(this.register(Yd,{brackets:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],colorizedBracketPairs:[],folding:{offSide:!0}},0))}register(e,t,i=0){let n=this._entries.get(e);n||(n=new T_(e),this._entries.set(e,n));const s=n.register(t,i);return this._onDidChange.fire(new Jh(e)),lt(()=>{s.dispose(),this._onDidChange.fire(new Jh(e))})}getLanguageConfiguration(e){const t=this._entries.get(e);return(t==null?void 0:t.getResolvedConfiguration())||null}}class Dn{constructor(e,t){this.languageId=e,this.underlyingConfig=t,this._brackets=null,this._electricCharacter=null,this._onEnterSupport=this.underlyingConfig.brackets||this.underlyingConfig.indentationRules||this.underlyingConfig.onEnterRules?new hn(this.underlyingConfig):null,this.comments=Dn._handleComments(this.underlyingConfig),this.characterPair=new Pa(this.underlyingConfig),this.wordDefinition=this.underlyingConfig.wordPattern||Gf,this.indentationRules=this.underlyingConfig.indentationRules,this.underlyingConfig.indentationRules?this.indentRulesSupport=new S_(this.underlyingConfig.indentationRules):this.indentRulesSupport=null,this.foldingRules=this.underlyingConfig.folding||{},this.bracketsNew=new x_(e,this.underlyingConfig)}getWordDefinition(){return Kf(this.wordDefinition)}get brackets(){return!this._brackets&&this.underlyingConfig.brackets&&(this._brackets=new p_(this.languageId,this.underlyingConfig.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new v_(this.brackets)),this._electricCharacter}onEnter(e,t,i,n){return this._onEnterSupport?this._onEnterSupport.onEnter(e,t,i,n):null}getAutoClosingPairs(){return new c_(this.characterPair.getAutoClosingPairs())}getAutoCloseBeforeSet(e){return this.characterPair.getAutoCloseBeforeSet(e)}getSurroundingPairs(){return this.characterPair.getSurroundingPairs()}static _handleComments(e){const t=e.comments;if(!t)return null;const i={};if(t.lineComment&&(i.lineCommentToken=t.lineComment),t.blockComment){const[n,s]=t.blockComment;i.blockCommentStartToken=n,i.blockCommentEndToken=s}return i}}Jp(Ys,Ba,1);class M_ extends kd{constructor(e,t){super(0),this._segmenter=null,this._cachedLine=null,this._cachedSegments=[],this.intlSegmenterLocales=t,this.intlSegmenterLocales.length>0?this._segmenter=new Intl.Segmenter(this.intlSegmenterLocales,{granularity:"word"}):this._segmenter=null;for(let i=0,n=e.length;i<n;i++)this.set(e.charCodeAt(i),2);this.set(32,1),this.set(9,1)}findPrevIntlWordBeforeOrAtOffset(e,t){let i=null;for(const n of this._getIntlSegmenterWordsOnLine(e)){if(n.index>t)break;i=n}return i}findNextIntlWordAtOrAfterOffset(e,t){for(const i of this._getIntlSegmenterWordsOnLine(e))if(!(i.index<t))return i;return null}_getIntlSegmenterWordsOnLine(e){return this._segmenter?this._cachedLine===e?this._cachedSegments:(this._cachedLine=e,this._cachedSegments=this._filterWordSegments(this._segmenter.segment(e)),this._cachedSegments):[]}_filterWordSegments(e){const t=[];for(const i of e)this._isWordLike(i)&&t.push(i);return t}_isWordLike(e){return!!e.isWordLike}}const ec=new Xd(10);function Hn(a,e){const t=`${a}/${e.join(",")}`;let i=ec.get(t);return i||(i=new M_(a,e),ec.set(t,i)),i}var Wa;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=4]="Right",a[a.Full=7]="Full"})(Wa||(Wa={}));var Gi;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=3]="Right"})(Gi||(Gi={}));var zn;(function(a){a[a.Both=0]="Both",a[a.Right=1]="Right",a[a.Left=2]="Left",a[a.None=3]="None"})(zn||(zn={}));class Yr{get originalIndentSize(){return this._indentSizeIsTabSize?"tabSize":this.indentSize}constructor(e){this._textModelResolvedOptionsBrand=void 0,this.tabSize=Math.max(1,e.tabSize|0),e.indentSize==="tabSize"?(this.indentSize=this.tabSize,this._indentSizeIsTabSize=!0):(this.indentSize=Math.max(1,e.indentSize|0),this._indentSizeIsTabSize=!1),this.insertSpaces=!!e.insertSpaces,this.defaultEOL=e.defaultEOL|0,this.trimAutoWhitespace=!!e.trimAutoWhitespace,this.bracketPairColorizationOptions=e.bracketPairColorizationOptions}equals(e){return this.tabSize===e.tabSize&&this._indentSizeIsTabSize===e._indentSizeIsTabSize&&this.indentSize===e.indentSize&&this.insertSpaces===e.insertSpaces&&this.defaultEOL===e.defaultEOL&&this.trimAutoWhitespace===e.trimAutoWhitespace&&qn(this.bracketPairColorizationOptions,e.bracketPairColorizationOptions)}createChangeEvent(e){return{tabSize:this.tabSize!==e.tabSize,indentSize:this.indentSize!==e.indentSize,insertSpaces:this.insertSpaces!==e.insertSpaces,trimAutoWhitespace:this.trimAutoWhitespace!==e.trimAutoWhitespace}}}class Wo{constructor(e,t){this._findMatchBrand=void 0,this.range=e,this.matches=t}}function R_(a){return a&&typeof a.read=="function"}class Xr{constructor(e,t,i,n,s,o){this.identifier=e,this.range=t,this.text=i,this.forceMoveMarkers=n,this.isAutoWhitespaceEdit=s,this._isTracked=o}}class A_{constructor(e,t,i){this.regex=e,this.wordSeparators=t,this.simpleSearch=i}}class O_{constructor(e,t,i){this.reverseEdits=e,this.changes=t,this.trimAutoWhitespaceLineNumbers=i}}function Rx(a){return!a.isTooLargeForSyncing()&&!a.isForSimpleWidget}const P_=999;class nn{constructor(e,t,i,n){this.searchString=e,this.isRegex=t,this.matchCase=i,this.wordSeparators=n}parseSearchRequest(){if(this.searchString==="")return null;let e;this.isRegex?e=B_(this.searchString):e=this.searchString.indexOf(`
`)>=0;let t=null;try{t=Dd(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch{return null}if(!t)return null;let i=!this.isRegex&&!e;return i&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(i=this.matchCase),new A_(t,this.wordSeparators?Hn(this.wordSeparators,[]):null,i?this.searchString:null)}}function B_(a){if(!a||a.length===0)return!1;for(let e=0,t=a.length;e<t;e++){const i=a.charCodeAt(e);if(i===10)return!0;if(i===92){if(e++,e>=t)break;const n=a.charCodeAt(e);if(n===110||n===114||n===87)return!0}}return!1}function Si(a,e,t){if(!t)return new Wo(a,null);const i=[];for(let n=0,s=e.length;n<s;n++)i[n]=e[n];return new Wo(a,i)}class tc{constructor(e){const t=[];let i=0;for(let n=0,s=e.length;n<s;n++)e.charCodeAt(n)===10&&(t[i++]=n);this._lineFeedsOffsets=t}findLineFeedCountBeforeOffset(e){const t=this._lineFeedsOffsets;let i=0,n=t.length-1;if(n===-1||e<=t[0])return 0;for(;i<n;){const s=i+((n-i)/2>>0);t[s]>=e?n=s-1:t[s+1]>=e?(i=s,n=s):i=s+1}return i+1}}class ao{static findMatches(e,t,i,n,s){const o=t.parseSearchRequest();return o?o.regex.multiline?this._doFindMatchesMultiline(e,i,new rs(o.wordSeparators,o.regex),n,s):this._doFindMatchesLineByLine(e,i,o,n,s):[]}static _getMultilineMatchRange(e,t,i,n,s,o){let r,l=0;n?(l=n.findLineFeedCountBeforeOffset(s),r=t+s+l):r=t+s;let h;if(n){const g=n.findLineFeedCountBeforeOffset(s+o.length)-l;h=r+o.length+g}else h=r+o.length;const c=e.getPositionAt(r),d=e.getPositionAt(h);return new v(c.lineNumber,c.column,d.lineNumber,d.column)}static _doFindMatchesMultiline(e,t,i,n,s){const o=e.getOffsetAt(t.getStartPosition()),r=e.getValueInRange(t,1),l=e.getEOL()===`\r
`?new tc(r):null,h=[];let c=0,d;for(i.reset(0);d=i.next(r);)if(h[c++]=Si(this._getMultilineMatchRange(e,o,r,l,d.index,d[0]),d,n),c>=s)return h;return h}static _doFindMatchesLineByLine(e,t,i,n,s){const o=[];let r=0;if(t.startLineNumber===t.endLineNumber){const h=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);return r=this._findMatchesInLine(i,h,t.startLineNumber,t.startColumn-1,r,o,n,s),o}const l=e.getLineContent(t.startLineNumber).substring(t.startColumn-1);r=this._findMatchesInLine(i,l,t.startLineNumber,t.startColumn-1,r,o,n,s);for(let h=t.startLineNumber+1;h<t.endLineNumber&&r<s;h++)r=this._findMatchesInLine(i,e.getLineContent(h),h,0,r,o,n,s);if(r<s){const h=e.getLineContent(t.endLineNumber).substring(0,t.endColumn-1);r=this._findMatchesInLine(i,h,t.endLineNumber,0,r,o,n,s)}return o}static _findMatchesInLine(e,t,i,n,s,o,r,l){const h=e.wordSeparators;if(!r&&e.simpleSearch){const u=e.simpleSearch,g=u.length,f=t.length;let m=-g;for(;(m=t.indexOf(u,m+g))!==-1;)if((!h||Fl(h,t,f,m,g))&&(o[s++]=new Wo(new v(i,m+1+n,i,m+1+g+n),null),s>=l))return s;return s}const c=new rs(e.wordSeparators,e.regex);let d;c.reset(0);do if(d=c.next(t),d&&(o[s++]=Si(new v(i,d.index+1+n,i,d.index+1+d[0].length+n),d,r),s>=l))return s;while(d);return s}static findNextMatch(e,t,i,n){const s=t.parseSearchRequest();if(!s)return null;const o=new rs(s.wordSeparators,s.regex);return s.regex.multiline?this._doFindNextMatchMultiline(e,i,o,n):this._doFindNextMatchLineByLine(e,i,o,n)}static _doFindNextMatchMultiline(e,t,i,n){const s=new D(t.lineNumber,1),o=e.getOffsetAt(s),r=e.getLineCount(),l=e.getValueInRange(new v(s.lineNumber,s.column,r,e.getLineMaxColumn(r)),1),h=e.getEOL()===`\r
`?new tc(l):null;i.reset(t.column-1);const c=i.next(l);return c?Si(this._getMultilineMatchRange(e,o,l,h,c.index,c[0]),c,n):t.lineNumber!==1||t.column!==1?this._doFindNextMatchMultiline(e,new D(1,1),i,n):null}static _doFindNextMatchLineByLine(e,t,i,n){const s=e.getLineCount(),o=t.lineNumber,r=e.getLineContent(o),l=this._findFirstMatchInLine(i,r,o,t.column,n);if(l)return l;for(let h=1;h<=s;h++){const c=(o+h-1)%s,d=e.getLineContent(c+1),u=this._findFirstMatchInLine(i,d,c+1,1,n);if(u)return u}return null}static _findFirstMatchInLine(e,t,i,n,s){e.reset(n-1);const o=e.next(t);return o?Si(new v(i,o.index+1,i,o.index+1+o[0].length),o,s):null}static findPreviousMatch(e,t,i,n){const s=t.parseSearchRequest();if(!s)return null;const o=new rs(s.wordSeparators,s.regex);return s.regex.multiline?this._doFindPreviousMatchMultiline(e,i,o,n):this._doFindPreviousMatchLineByLine(e,i,o,n)}static _doFindPreviousMatchMultiline(e,t,i,n){const s=this._doFindMatchesMultiline(e,new v(1,1,t.lineNumber,t.column),i,n,10*P_);if(s.length>0)return s[s.length-1];const o=e.getLineCount();return t.lineNumber!==o||t.column!==e.getLineMaxColumn(o)?this._doFindPreviousMatchMultiline(e,new D(o,e.getLineMaxColumn(o)),i,n):null}static _doFindPreviousMatchLineByLine(e,t,i,n){const s=e.getLineCount(),o=t.lineNumber,r=e.getLineContent(o).substring(0,t.column-1),l=this._findLastMatchInLine(i,r,o,n);if(l)return l;for(let h=1;h<=s;h++){const c=(s+o-h-1)%s,d=e.getLineContent(c+1),u=this._findLastMatchInLine(i,d,c+1,n);if(u)return u}return null}static _findLastMatchInLine(e,t,i,n){let s=null,o;for(e.reset(0);o=e.next(t);)s=Si(new v(i,o.index+1,i,o.index+1+o[0].length),o,n);return s}}function F_(a,e,t,i,n){if(i===0)return!0;const s=e.charCodeAt(i-1);if(a.get(s)!==0||s===13||s===10)return!0;if(n>0){const o=e.charCodeAt(i);if(a.get(o)!==0)return!0}return!1}function W_(a,e,t,i,n){if(i+n===t)return!0;const s=e.charCodeAt(i+n);if(a.get(s)!==0||s===13||s===10)return!0;if(n>0){const o=e.charCodeAt(i+n-1);if(a.get(o)!==0)return!0}return!1}function Fl(a,e,t,i,n){return F_(a,e,t,i,n)&&W_(a,e,t,i,n)}class rs{constructor(e,t){this._wordSeparators=e,this._searchRegex=t,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(e){const t=e.length;let i;do{if(this._prevMatchStartIndex+this._prevMatchLength===t||(i=this._searchRegex.exec(e),!i))return null;const n=i.index,s=i[0].length;if(n===this._prevMatchStartIndex&&s===this._prevMatchLength){if(s===0){Sa(e,t,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=n,this._prevMatchLength=s,!this._wordSeparators||Fl(this._wordSeparators,e,t,n,s))return i}while(i);return null}}class _e{static addRange(e,t){let i=0;for(;i<t.length&&t[i].endExclusive<e.start;)i++;let n=i;for(;n<t.length&&t[n].start<=e.endExclusive;)n++;if(i===n)t.splice(i,0,e);else{const s=Math.min(e.start,t[i].start),o=Math.max(e.endExclusive,t[n-1].endExclusive);t.splice(i,n-i,new _e(s,o))}}static tryCreate(e,t){if(!(e>t))return new _e(e,t)}static ofLength(e){return new _e(0,e)}static ofStartAndLength(e,t){return new _e(e,e+t)}constructor(e,t){if(this.start=e,this.endExclusive=t,e>t)throw new fe(`Invalid range: ${this.toString()}`)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new _e(this.start+e,this.endExclusive+e)}deltaStart(e){return new _e(this.start+e,this.endExclusive)}deltaEnd(e){return new _e(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new _e(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){const t=Math.max(this.start,e.start),i=Math.min(this.endExclusive,e.endExclusive);if(t<=i)return new _e(t,i)}intersects(e){const t=Math.max(this.start,e.start),i=Math.min(this.endExclusive,e.endExclusive);return t<i}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new fe(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new fe(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}forEach(e){for(let t=this.start;t<this.endExclusive;t++)e(t)}}class mu{constructor(){this._sortedRanges=[]}addRange(e){let t=0;for(;t<this._sortedRanges.length&&this._sortedRanges[t].endExclusive<e.start;)t++;let i=t;for(;i<this._sortedRanges.length&&this._sortedRanges[i].start<=e.endExclusive;)i++;if(t===i)this._sortedRanges.splice(t,0,e);else{const n=Math.min(e.start,this._sortedRanges[t].start),s=Math.max(e.endExclusive,this._sortedRanges[i-1].endExclusive);this._sortedRanges.splice(t,i-t,new _e(n,s))}}toString(){return this._sortedRanges.map(e=>e.toString()).join(", ")}intersectsStrict(e){let t=0;for(;t<this._sortedRanges.length&&this._sortedRanges[t].endExclusive<=e.start;)t++;return t<this._sortedRanges.length&&this._sortedRanges[t].start<e.endExclusive}intersectWithRange(e){const t=new mu;for(const i of this._sortedRanges){const n=i.intersect(e);n&&t.addRange(n)}return t}intersectWithRangeLength(e){return this.intersectWithRange(e).length}get length(){return this._sortedRanges.reduce((e,t)=>e+t.length,0)}}function V_(a,e){const t=H_(a,e);if(t!==-1)return a[t]}function H_(a,e,t=a.length-1){for(let i=t;i>=0;i--){const n=a[i];if(e(n))return i}return-1}function ic(a,e){const t=Vo(a,e);return t===-1?void 0:a[t]}function Vo(a,e,t=0,i=a.length){let n=t,s=i;for(;n<s;){const o=Math.floor((n+s)/2);e(a[o])?n=o+1:s=o}return n-1}function Ax(a,e){const t=Va(a,e);return t===a.length?void 0:a[t]}function Va(a,e,t=0,i=a.length){let n=t,s=i;for(;n<s;){const o=Math.floor((n+s)/2);e(a[o])?s=o:n=o+1}return n}const cr=class cr{constructor(e){this._array=e,this._findLastMonotonousLastIdx=0}findLastMonotonous(e){if(cr.assertInvariants){if(this._prevFindLastPredicate){for(const i of this._array)if(this._prevFindLastPredicate(i)&&!e(i))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=e}const t=Vo(this._array,e,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=t+1,t===-1?void 0:this._array[t]}};cr.assertInvariants=!1;let nc=cr;function z_(a,e){if(a.length===0)return;let t=a[0];for(let i=1;i<a.length;i++){const n=a[i];e(n,t)>0&&(t=n)}return t}function U_(a,e){if(a.length===0)return;let t=a[0];for(let i=1;i<a.length;i++){const n=a[i];e(n,t)>=0&&(t=n)}return t}function j_(a,e){return z_(a,(t,i)=>-e(t,i))}function Ox(a,e){if(a.length===0)return-1;let t=0;for(let i=1;i<a.length;i++){const n=a[i];e(n,a[t])>0&&(t=i)}return t}let Pi=class At{static fromRangeInclusive(e){return new At(e.startLineNumber,e.endLineNumber+1)}static joinMany(e){if(e.length===0)return[];let t=new Yt(e[0].slice());for(let i=1;i<e.length;i++)t=t.getUnion(new Yt(e[i].slice()));return t.ranges}static join(e){if(e.length===0)throw new fe("lineRanges cannot be empty");let t=e[0].startLineNumber,i=e[0].endLineNumberExclusive;for(let n=1;n<e.length;n++)t=Math.min(t,e[n].startLineNumber),i=Math.max(i,e[n].endLineNumberExclusive);return new At(t,i)}static ofLength(e,t){return new At(e,e+t)}static deserialize(e){return new At(e[0],e[1])}constructor(e,t){if(e>t)throw new fe(`startLineNumber ${e} cannot be after endLineNumberExclusive ${t}`);this.startLineNumber=e,this.endLineNumberExclusive=t}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(e){return new At(this.startLineNumber+e,this.endLineNumberExclusive+e)}deltaLength(e){return new At(this.startLineNumber,this.endLineNumberExclusive+e)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(e){return new At(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(e){const t=Math.max(this.startLineNumber,e.startLineNumber),i=Math.min(this.endLineNumberExclusive,e.endLineNumberExclusive);if(t<=i)return new At(t,i)}intersectsStrict(e){return this.startLineNumber<e.endLineNumberExclusive&&e.startLineNumber<this.endLineNumberExclusive}overlapOrTouch(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}equals(e){return this.startLineNumber===e.startLineNumber&&this.endLineNumberExclusive===e.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new v(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new v(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(e){const t=[];for(let i=this.startLineNumber;i<this.endLineNumberExclusive;i++)t.push(e(i));return t}forEach(e){for(let t=this.startLineNumber;t<this.endLineNumberExclusive;t++)e(t)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}includes(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}toOffsetRange(){return new _e(this.startLineNumber-1,this.endLineNumberExclusive-1)}};class Yt{constructor(e=[]){this._normalizedRanges=e}get ranges(){return this._normalizedRanges}addRange(e){if(e.length===0)return;const t=Va(this._normalizedRanges,n=>n.endLineNumberExclusive>=e.startLineNumber),i=Vo(this._normalizedRanges,n=>n.startLineNumber<=e.endLineNumberExclusive)+1;if(t===i)this._normalizedRanges.splice(t,0,e);else if(t===i-1){const n=this._normalizedRanges[t];this._normalizedRanges[t]=n.join(e)}else{const n=this._normalizedRanges[t].join(this._normalizedRanges[i-1]).join(e);this._normalizedRanges.splice(t,i-t,n)}}contains(e){const t=ic(this._normalizedRanges,i=>i.startLineNumber<=e);return!!t&&t.endLineNumberExclusive>e}intersects(e){const t=ic(this._normalizedRanges,i=>i.startLineNumber<e.endLineNumberExclusive);return!!t&&t.endLineNumberExclusive>e.startLineNumber}getUnion(e){if(this._normalizedRanges.length===0)return e;if(e._normalizedRanges.length===0)return this;const t=[];let i=0,n=0,s=null;for(;i<this._normalizedRanges.length||n<e._normalizedRanges.length;){let o=null;if(i<this._normalizedRanges.length&&n<e._normalizedRanges.length){const r=this._normalizedRanges[i],l=e._normalizedRanges[n];r.startLineNumber<l.startLineNumber?(o=r,i++):(o=l,n++)}else i<this._normalizedRanges.length?(o=this._normalizedRanges[i],i++):(o=e._normalizedRanges[n],n++);s===null?s=o:s.endLineNumberExclusive>=o.startLineNumber?s=new Pi(s.startLineNumber,Math.max(s.endLineNumberExclusive,o.endLineNumberExclusive)):(t.push(s),s=o)}return s!==null&&t.push(s),new Yt(t)}subtractFrom(e){const t=Va(this._normalizedRanges,o=>o.endLineNumberExclusive>=e.startLineNumber),i=Vo(this._normalizedRanges,o=>o.startLineNumber<=e.endLineNumberExclusive)+1;if(t===i)return new Yt([e]);const n=[];let s=e.startLineNumber;for(let o=t;o<i;o++){const r=this._normalizedRanges[o];r.startLineNumber>s&&n.push(new Pi(s,r.startLineNumber)),s=r.endLineNumberExclusive}return s<e.endLineNumberExclusive&&n.push(new Pi(s,e.endLineNumberExclusive)),new Yt(n)}toString(){return this._normalizedRanges.map(e=>e.toString()).join(", ")}getIntersection(e){const t=[];let i=0,n=0;for(;i<this._normalizedRanges.length&&n<e._normalizedRanges.length;){const s=this._normalizedRanges[i],o=e._normalizedRanges[n],r=s.intersect(o);r&&!r.isEmpty&&t.push(r),s.endLineNumberExclusive<o.endLineNumberExclusive?i++:n++}return new Yt(t)}getWithDelta(e){return new Yt(this._normalizedRanges.map(t=>t.delta(e)))}}const Zt=class Zt{static betweenPositions(e,t){return e.lineNumber===t.lineNumber?new Zt(0,t.column-e.column):new Zt(t.lineNumber-e.lineNumber,t.column-1)}static ofRange(e){return Zt.betweenPositions(e.getStartPosition(),e.getEndPosition())}static ofText(e){let t=0,i=0;for(const n of e)n===`
`?(t++,i=0):i++;return new Zt(t,i)}constructor(e,t){this.lineCount=e,this.columnCount=t}isGreaterThanOrEqualTo(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>=e.columnCount}createRange(e){return this.lineCount===0?new v(e.lineNumber,e.column,e.lineNumber,e.column+this.columnCount):new v(e.lineNumber,e.column,e.lineNumber+this.lineCount,this.columnCount+1)}addToPosition(e){return this.lineCount===0?new D(e.lineNumber,e.column+this.columnCount):new D(e.lineNumber+this.lineCount,this.columnCount+1)}toString(){return`${this.lineCount},${this.columnCount}`}};Zt.zero=new Zt(0,0);let Ha=Zt;class Px{constructor(e){this.values=e,this.prefixSum=new Uint32Array(e.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}insertValues(e,t){e=Ji(e);const i=this.values,n=this.prefixSum,s=t.length;return s===0?!1:(this.values=new Uint32Array(i.length+s),this.values.set(i.subarray(0,e),0),this.values.set(i.subarray(e),e+s),this.values.set(t,e),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(n.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}setValue(e,t){return e=Ji(e),t=Ji(t),this.values[e]===t?!1:(this.values[e]=t,e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),!0)}removeValues(e,t){e=Ji(e),t=Ji(t);const i=this.values,n=this.prefixSum;if(e>=i.length)return!1;const s=i.length-e;return t>=s&&(t=s),t===0?!1:(this.values=new Uint32Array(i.length-t),this.values.set(i.subarray(0,e),0),this.values.set(i.subarray(e+t),e),this.prefixSum=new Uint32Array(this.values.length),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(n.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalSum(){return this.values.length===0?0:this._getPrefixSum(this.values.length-1)}getPrefixSum(e){return e<0?0:(e=Ji(e),this._getPrefixSum(e))}_getPrefixSum(e){if(e<=this.prefixSumValidIndex[0])return this.prefixSum[e];let t=this.prefixSumValidIndex[0]+1;t===0&&(this.prefixSum[0]=this.values[0],t++),e>=this.values.length&&(e=this.values.length-1);for(let i=t;i<=e;i++)this.prefixSum[i]=this.prefixSum[i-1]+this.values[i];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],e),this.prefixSum[e]}getIndexOf(e){e=Math.floor(e),this.getTotalSum();let t=0,i=this.values.length-1,n=0,s=0,o=0;for(;t<=i;)if(n=t+(i-t)/2|0,s=this.prefixSum[n],o=s-this.values[n],e<o)i=n-1;else if(e>=s)t=n+1;else break;return new pu(n,e-o)}}class $_{constructor(e){this._values=e,this._isValid=!1,this._validEndIndex=-1,this._prefixSum=[],this._indexBySum=[]}getTotalSum(){return this._ensureValid(),this._indexBySum.length}getPrefixSum(e){return this._ensureValid(),e===0?0:this._prefixSum[e-1]}getIndexOf(e){this._ensureValid();const t=this._indexBySum[e],i=t>0?this._prefixSum[t-1]:0;return new pu(t,e-i)}removeValues(e,t){this._values.splice(e,t),this._invalidate(e)}insertValues(e,t){this._values=Nr(this._values,e,t),this._invalidate(e)}_invalidate(e){this._isValid=!1,this._validEndIndex=Math.min(this._validEndIndex,e-1)}_ensureValid(){if(!this._isValid){for(let e=this._validEndIndex+1,t=this._values.length;e<t;e++){const i=this._values[e],n=e>0?this._prefixSum[e-1]:0;this._prefixSum[e]=n+i;for(let s=0;s<i;s++)this._indexBySum[n+s]=e}this._prefixSum.length=this._values.length,this._indexBySum.length=this._prefixSum[this._prefixSum.length-1],this._isValid=!0,this._validEndIndex=this._values.length-1}}setValue(e,t){this._values[e]!==t&&(this._values[e]=t,this._invalidate(e))}}class pu{constructor(e,t){this.index=e,this.remainder=t,this._prefixSumIndexOfResultBrand=void 0,this.index=e,this.remainder=t}}var Ut;(function(a){a.DARK="dark",a.LIGHT="light",a.HIGH_CONTRAST_DARK="hcDark",a.HIGH_CONTRAST_LIGHT="hcLight"})(Ut||(Ut={}));function ds(a){return a===Ut.HIGH_CONTRAST_DARK||a===Ut.HIGH_CONTRAST_LIGHT}function _u(a){return a===Ut.DARK||a===Ut.HIGH_CONTRAST_DARK}const Wl=ot("themeService");function Bx(a){return{id:a}}function za(a){switch(a){case Ut.DARK:return"vs-dark";case Ut.HIGH_CONTRAST_DARK:return"hc-black";case Ut.HIGH_CONTRAST_LIGHT:return"hc-light";default:return"vs"}}const G_={ThemingContribution:"base.contributions.theming"};class K_{constructor(){this.themingParticipants=[],this.themingParticipants=[],this.onThemingParticipantAddedEmitter=new M}onColorThemeChange(e){return this.themingParticipants.push(e),this.onThemingParticipantAddedEmitter.fire(e),lt(()=>{const t=this.themingParticipants.indexOf(e);this.themingParticipants.splice(t,1)})}getThemingParticipants(){return this.themingParticipants}}const Cu=new K_;Ag.add(G_.ThemingContribution,Cu);function di(a){return Cu.onColorThemeChange(a)}class Fx extends H{constructor(e){super(),this.themeService=e,this.theme=e.getColorTheme(),this._register(this.themeService.onDidColorThemeChange(t=>this.onThemeChange(t)))}onThemeChange(e){this.theme=e,this.updateStyles()}updateStyles(){}}var Rs;(function(a){a[a.Ignore=0]="Ignore",a[a.Info=1]="Info",a[a.Warning=2]="Warning",a[a.Error=3]="Error"})(Rs||(Rs={}));(function(a){const e="error",t="warning",i="warn",n="info",s="ignore";function o(l){return l?to(e,l)?a.Error:to(t,l)||to(i,l)?a.Warning:to(n,l)?a.Info:a.Ignore:a.Ignore}a.fromValue=o;function r(l){switch(l){case a.Error:return e;case a.Warning:return t;case a.Info:return n;default:return s}}a.toString=r})(Rs||(Rs={}));const q_=Rs;var Z_=q_;const Vl=ot("notificationService");class Wx{}const Q_=ot("undoRedoService");class Vx{constructor(e,t){this.resource=e,this.elements=t}}const Cn=class Cn{constructor(){this.id=Cn._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}};Cn._ID=0,Cn.None=new Cn;let sc=Cn;const bn=class bn{constructor(){this.id=bn._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}};bn._ID=0,bn.None=new bn;let oc=bn;function bu(a,e,t){return Math.min(Math.max(a,e),t)}class Hx{constructor(){this._n=1,this._val=0}update(e){return this._val=this._val+(e-this._val)/this._n,this._n+=1,this._val}get value(){return this._val}}class zx{constructor(e){this._n=0,this._val=0,this._values=[],this._index=0,this._sum=0,this._values=new Array(e),this._values.fill(0,0,e)}update(e){const t=this._values[this._index];return this._values[this._index]=e,this._index=(this._index+1)%this._values.length,this._sum-=t,this._sum+=e,this._n<this._values.length&&(this._n+=1),this._val=this._sum/this._n,this._val}get value(){return this._val}}const Ux=ot("environmentService");function Un(a){let e=0,t=0,i=0,n=0;for(let s=0,o=a.length;s<o;s++){const r=a.charCodeAt(s);r===13?(e===0&&(t=s),e++,s+1<o&&a.charCodeAt(s+1)===10?(n|=2,s++):n|=3,i=s+1):r===10&&(n|=1,e===0&&(t=s),e++,i=s+1)}return e===0&&(t=a.length),[e,t,a.length-i,n]}const Y_=ot("contextViewService"),Hl=ot("contextMenuService"),Er=ot("keybindingService"),Mr=ot("accessibilityService"),jx=new Og("accessibilityModeEnabled",!1);var Be;(function(a){function e(s,o){if(s.start>=o.end||o.start>=s.end)return{start:0,end:0};const r=Math.max(s.start,o.start),l=Math.min(s.end,o.end);return l-r<=0?{start:0,end:0}:{start:r,end:l}}a.intersect=e;function t(s){return s.end-s.start<=0}a.isEmpty=t;function i(s,o){return!t(e(s,o))}a.intersects=i;function n(s,o){const r=[],l={start:s.start,end:Math.min(o.start,s.end)},h={start:Math.max(o.end,s.start),end:s.end};return t(l)||r.push(l),t(h)||r.push(h),r}a.relativeComplement=n})(Be||(Be={}));class X_{constructor(){this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._enabled=!0}get enabled(){return this._enabled}enable(){this._enabled=!0,this._onDidChange.fire()}disable(){this._enabled=!1,this._onDidChange.fire()}}const rc=new X_;class Rr{constructor(e,t,i=t){this.modifierLabels=[null],this.modifierLabels[2]=e,this.modifierLabels[1]=t,this.modifierLabels[3]=i}toLabel(e,t,i){if(t.length===0)return null;const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=i(r);if(l===null)return null;n[s]=eC(r,l,this.modifierLabels[e])}return n.join(" ")}}const J_=new Rr({ctrlKey:"⌃",shiftKey:"⇧",altKey:"⌥",metaKey:"⌘",separator:""},{ctrlKey:I({key:"ctrlKey",comment:["This is the short form for the Control key on the keyboard"]},"Ctrl"),shiftKey:I({key:"shiftKey",comment:["This is the short form for the Shift key on the keyboard"]},"Shift"),altKey:I({key:"altKey",comment:["This is the short form for the Alt key on the keyboard"]},"Alt"),metaKey:I({key:"windowsKey",comment:["This is the short form for the Windows key on the keyboard"]},"Windows"),separator:"+"},{ctrlKey:I({key:"ctrlKey",comment:["This is the short form for the Control key on the keyboard"]},"Ctrl"),shiftKey:I({key:"shiftKey",comment:["This is the short form for the Shift key on the keyboard"]},"Shift"),altKey:I({key:"altKey",comment:["This is the short form for the Alt key on the keyboard"]},"Alt"),metaKey:I({key:"superKey",comment:["This is the short form for the Super key on the keyboard"]},"Super"),separator:"+"}),$x=new Rr({ctrlKey:I({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:I({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:I({key:"optKey.long",comment:["This is the long form for the Alt/Option key on the keyboard"]},"Option"),metaKey:I({key:"cmdKey.long",comment:["This is the long form for the Command key on the keyboard"]},"Command"),separator:"+"},{ctrlKey:I({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:I({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:I({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:I({key:"windowsKey.long",comment:["This is the long form for the Windows key on the keyboard"]},"Windows"),separator:"+"},{ctrlKey:I({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:I({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:I({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:I({key:"superKey.long",comment:["This is the long form for the Super key on the keyboard"]},"Super"),separator:"+"}),Gx=new Rr({ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Cmd",separator:"+"},{ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Super",separator:"+"}),Kx=new Rr({ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"cmd",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"win",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"meta",separator:"+"});function eC(a,e,t){if(e===null)return"";const i=[];return a.ctrlKey&&i.push(t.ctrlKey),a.shiftKey&&i.push(t.shiftKey),a.altKey&&i.push(t.altKey),a.metaKey&&i.push(t.metaKey),e!==""&&i.push(e),i.join(t.separator)}const qx=ot("labelService"),It=(a,e)=>a===e;function Zx(a=It){return(e,t)=>Nt(e,t,a)}function Qx(a,e,t){{const i=a;return(n,s)=>n==null||s===void 0||s===null?s===n:i(n,s)}}class Ze{constructor(e,t,i){this.owner=e,this.debugNameSource=t,this.referenceFn=i}getDebugName(e){return tC(e,this)}}const ac=new Map,Ua=new WeakMap;function tC(a,e){const t=Ua.get(a);if(t)return t;const i=iC(a,e);if(i){let n=ac.get(i)??0;n++,ac.set(i,n);const s=n===1?i:`${i}#${n}`;return Ua.set(a,s),s}}function iC(a,e){const t=Ua.get(a);if(t)return t;const i=e.owner?sC(e.owner)+".":"";let n;const s=e.debugNameSource;if(s!==void 0)if(typeof s=="function"){if(n=s(),n!==void 0)return i+n}else return i+s;const o=e.referenceFn;if(o!==void 0&&(n=zl(o),n!==void 0))return i+n;if(e.owner!==void 0){const r=nC(e.owner,a);if(r!==void 0)return i+r}}function nC(a,e){for(const t in a)if(a[t]===e)return t}const lc=new Map,hc=new WeakMap;function sC(a){const e=hc.get(a);if(e)return e;const t=oC(a);let i=lc.get(t)??0;i++,lc.set(t,i);const n=i===1?t:`${t}#${i}`;return hc.set(a,n),n}function oC(a){const e=a.constructor;return e?e.name:"Object"}function zl(a){const e=a.toString(),i=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(e),n=i?i[1]:void 0;return n==null?void 0:n.trim()}let rC;function wu(){return rC}let Lu;function aC(a){Lu=a}let vu;function lC(a){vu=a}let ja;function hC(a){ja=a}class Su{get TChange(){return null}reportChanges(){this.get()}read(e){return e?e.readObservable(this):this.get()}map(e,t){const i=t===void 0?void 0:e,n=t===void 0?e:t;return ja({owner:i,debugName:()=>{const s=zl(n);if(s!==void 0)return s;const r=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(n.toString());if(r)return`${this.debugName}.${r[2]}`;if(!i)return`${this.debugName} (mapped)`},debugReferenceFn:n},s=>n(this.read(s),s))}flatten(){return ja({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},e=>this.read(e).read(e))}recomputeInitiallyAndOnChange(e,t){return e.add(Lu(this,t)),this}keepObserved(e){return e.add(vu(this)),this}}class Xs extends Su{constructor(){super(...arguments),this.observers=new Set}addObserver(e){const t=this.observers.size;this.observers.add(e),t===0&&this.onFirstObserverAdded()}removeObserver(e){this.observers.delete(e)&&this.observers.size===0&&this.onLastObserverRemoved()}onFirstObserverAdded(){}onLastObserverRemoved(){}}function Ul(a,e){const t=new jl(a,e);try{a(t)}finally{t.finish()}}let lo;function Yx(a){if(lo)a(lo);else{const e=new jl(a,void 0);lo=e;try{a(e)}finally{e.finish(),lo=void 0}}}function cC(a,e,t){a?e(a):Ul(e,t)}class jl{constructor(e,t){this._fn=e,this._getDebugName=t,this.updatingObservers=[]}getDebugName(){return this._getDebugName?this._getDebugName():zl(this._fn)}updateObserver(e,t){this.updatingObservers.push({observer:e,observable:t}),e.beginUpdate(t)}finish(){const e=this.updatingObservers;for(let t=0;t<e.length;t++){const{observer:i,observable:n}=e[t];i.endUpdate(n)}this.updatingObservers=null}}function Xx(a,e){let t;return typeof a=="string"?t=new Ze(void 0,a,void 0):t=new Ze(a,void 0,void 0),new xu(t,e,It)}class xu extends Xs{get debugName(){return this._debugNameData.getDebugName(this)??"ObservableValue"}constructor(e,t,i){super(),this._debugNameData=e,this._equalityComparator=i,this._value=t}get(){return this._value}set(e,t,i){var s;if(i===void 0&&this._equalityComparator(this._value,e))return;let n;t||(t=n=new jl(()=>{},()=>`Setting ${this.debugName}`));try{const o=this._value;this._setValue(e),(s=wu())==null||s.handleObservableChanged(this,{oldValue:o,newValue:e,change:i,didChange:!0,hadValue:!0});for(const r of this.observers)t.updateObserver(r,this),r.handleChange(this,i)}finally{n&&n.finish()}}toString(){return`${this.debugName}: ${this._value}`}_setValue(e){this._value=e}}function Jx(a,e){let t;return typeof a=="string"?t=new Ze(void 0,a,void 0):t=new Ze(a,void 0,void 0),new dC(t,e,It)}class dC extends xu{_setValue(e){this._value!==e&&(this._value&&this._value.dispose(),this._value=e)}dispose(){var e;(e=this._value)==null||e.dispose()}}function ey(a,e){return e!==void 0?new jn(new Ze(a,void 0,e),e,void 0,void 0,void 0,It):new jn(new Ze(void 0,void 0,a),a,void 0,void 0,void 0,It)}function ty(a,e,t){return new uC(new Ze(a,void 0,e),e,void 0,void 0,void 0,It,t)}function yu(a,e){return new jn(new Ze(a.owner,a.debugName,a.debugReferenceFn),e,void 0,void 0,a.onLastObserverRemoved,a.equalsFn??It)}hC(yu);function iy(a,e){let t,i;e===void 0?(t=a,i=void 0):(i=a,t=e);const n=new pe;return new jn(new Ze(i,void 0,t),s=>(n.clear(),t(s,n)),void 0,void 0,()=>n.dispose(),It)}function ny(a,e){let t,i;e===void 0?(t=a,i=void 0):(i=a,t=e);let n;return new jn(new Ze(i,void 0,t),s=>{n?n.clear():n=new pe;const o=t(s);return o&&n.add(o),o},void 0,void 0,()=>{n&&(n.dispose(),n=void 0)},It)}class jn extends Xs{get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}constructor(e,t,i,n,s=void 0,o){var r;super(),this._debugNameData=e,this._computeFn=t,this.createChangeSummary=i,this._handleChange=n,this._handleLastObserverRemoved=s,this._equalityComparator=o,this.state=0,this.value=void 0,this.updateCount=0,this.dependencies=new Set,this.dependenciesToBeRemoved=new Set,this.changeSummary=void 0,this.changeSummary=(r=this.createChangeSummary)==null?void 0:r.call(this)}onLastObserverRemoved(){var e;this.state=0,this.value=void 0;for(const t of this.dependencies)t.removeObserver(this);this.dependencies.clear(),(e=this._handleLastObserverRemoved)==null||e.call(this)}get(){var e;if(this.observers.size===0){const t=this._computeFn(this,(e=this.createChangeSummary)==null?void 0:e.call(this));return this.onLastObserverRemoved(),t}else{do{if(this.state===1){for(const t of this.dependencies)if(t.reportChanges(),this.state===2)break}this.state===1&&(this.state=3),this._recomputeIfNeeded()}while(this.state!==3);return this.value}}_recomputeIfNeeded(){var o;if(this.state===3)return;const e=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=e;const t=this.state!==0,i=this.value;this.state=3;const n=this.changeSummary;this.changeSummary=(o=this.createChangeSummary)==null?void 0:o.call(this);try{this.value=this._computeFn(this,n)}finally{for(const r of this.dependenciesToBeRemoved)r.removeObserver(this);this.dependenciesToBeRemoved.clear()}if(t&&!this._equalityComparator(i,this.value))for(const r of this.observers)r.handleChange(this,void 0)}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(e){this.updateCount++;const t=this.updateCount===1;if(this.state===3&&(this.state=1,!t))for(const i of this.observers)i.handlePossibleChange(this);if(t)for(const i of this.observers)i.beginUpdate(this)}endUpdate(e){if(this.updateCount--,this.updateCount===0){const t=[...this.observers];for(const i of t)i.endUpdate(this)}Td(()=>this.updateCount>=0)}handlePossibleChange(e){if(this.state===3&&this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){this.state=1;for(const t of this.observers)t.handlePossibleChange(this)}}handleChange(e,t){if(this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){const i=this._handleChange?this._handleChange({changedObservable:e,change:t,didChange:s=>s===e},this.changeSummary):!0,n=this.state===3;if(i&&(this.state===1||n)&&(this.state=2,n))for(const s of this.observers)s.handlePossibleChange(this)}}readObservable(e){e.addObserver(this);const t=e.get();return this.dependencies.add(e),this.dependenciesToBeRemoved.delete(e),t}addObserver(e){const t=!this.observers.has(e)&&this.updateCount>0;super.addObserver(e),t&&e.beginUpdate(this)}removeObserver(e){const t=this.observers.has(e)&&this.updateCount>0;super.removeObserver(e),t&&e.endUpdate(this)}}class uC extends jn{constructor(e,t,i,n,s=void 0,o,r){super(e,t,i,n,s,o),this.set=r}}function $a(a){return new Ar(new Ze(void 0,void 0,a),a,void 0,void 0)}function gC(a,e){return new Ar(new Ze(a.owner,a.debugName,a.debugReferenceFn??e),e,void 0,void 0)}function sy(a,e){return new Ar(new Ze(a.owner,a.debugName,a.debugReferenceFn??e),e,a.createEmptyChangeSummary,a.handleChange)}function oy(a){const e=new pe,t=gC({owner:void 0,debugName:void 0,debugReferenceFn:a},i=>{e.clear(),a(i,e)});return lt(()=>{t.dispose(),e.dispose()})}class Ar{get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}constructor(e,t,i,n){var s;this._debugNameData=e,this._runFn=t,this.createChangeSummary=i,this._handleChange=n,this.state=2,this.updateCount=0,this.disposed=!1,this.dependencies=new Set,this.dependenciesToBeRemoved=new Set,this.changeSummary=(s=this.createChangeSummary)==null?void 0:s.call(this),this._runIfNeeded()}dispose(){this.disposed=!0;for(const e of this.dependencies)e.removeObserver(this);this.dependencies.clear()}_runIfNeeded(){var i,n;if(this.state===3)return;const e=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=e,this.state=3;const t=this.disposed;try{if(!t){(i=wu())==null||i.handleAutorunTriggered(this);const s=this.changeSummary;this.changeSummary=(n=this.createChangeSummary)==null?void 0:n.call(this),this._runFn(this,s)}}finally{for(const s of this.dependenciesToBeRemoved)s.removeObserver(this);this.dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(){this.state===3&&(this.state=1),this.updateCount++}endUpdate(){if(this.updateCount===1)do{if(this.state===1){this.state=3;for(const e of this.dependencies)if(e.reportChanges(),this.state===2)break}this._runIfNeeded()}while(this.state!==3);this.updateCount--,Td(()=>this.updateCount>=0)}handlePossibleChange(e){this.state===3&&this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)&&(this.state=1)}handleChange(e,t){this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)&&(!this._handleChange||this._handleChange({changedObservable:e,change:t,didChange:n=>n===e},this.changeSummary))&&(this.state=2)}readObservable(e){if(this.disposed)return e.get();e.addObserver(this);const t=e.get();return this.dependencies.add(e),this.dependenciesToBeRemoved.delete(e),t}}(function(a){a.Observer=Ar})($a||($a={}));function fC(a){return new mC(a)}class mC extends Su{constructor(e){super(),this.value=e}get debugName(){return this.toString()}get(){return this.value}addObserver(e){}removeObserver(e){}toString(){return`Const: ${this.value}`}}function cc(...a){let e,t,i;return a.length===3?[e,t,i]=a:[t,i]=a,new cn(new Ze(e,void 0,i),t,i,()=>cn.globalTransaction,It)}class cn extends Xs{constructor(e,t,i,n,s){super(),this._debugNameData=e,this.event=t,this._getValue=i,this._getTransaction=n,this._equalityComparator=s,this.hasValue=!1,this.handleEvent=o=>{const r=this._getValue(o),l=this.value;(!this.hasValue||!this._equalityComparator(l,r))&&(this.value=r,this.hasValue&&cC(this._getTransaction(),c=>{for(const d of this.observers)c.updateObserver(d,this),d.handleChange(this,void 0)},()=>{const c=this.getDebugName();return"Event fired"+(c?`: ${c}`:"")}),this.hasValue=!0)}}getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){const e=this.getDebugName();return"From Event"+(e?`: ${e}`:"")}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0,this.hasValue=!1,this.value=void 0}get(){return this.subscription?(this.hasValue||this.handleEvent(void 0),this.value):this._getValue(void 0)}}(function(a){a.Observer=cn;function e(t,i){let n=!1;cn.globalTransaction===void 0&&(cn.globalTransaction=t,n=!0);try{i()}finally{n&&(cn.globalTransaction=void 0)}}a.batchEventsGlobally=e})(cc||(cc={}));function ry(a,e){return new pC(a,e)}class pC extends Xs{constructor(e,t){super(),this.debugName=e,this.event=t,this.handleEvent=()=>{Ul(i=>{for(const n of this.observers)i.updateObserver(n,this),n.handleChange(this,void 0)},()=>this.debugName)}}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0}get(){}}function ay(a){return typeof a=="string"?new dc(a):new dc(void 0,a)}class dc extends Xs{get debugName(){return new Ze(this._owner,this._debugName,void 0).getDebugName(this)??"Observable Signal"}toString(){return this.debugName}constructor(e,t){super(),this._debugName=e,this._owner=t}trigger(e,t){if(!e){Ul(i=>{this.trigger(i,t)},()=>`Trigger signal ${this.debugName}`);return}for(const i of this.observers)e.updateObserver(i,this),i.handleChange(this,t)}get(){}}function _C(a){const e=new Nu(!1,void 0);return a.addObserver(e),lt(()=>{a.removeObserver(e)})}lC(_C);function CC(a,e){const t=new Nu(!0,e);return a.addObserver(t),e?e(a.get()):a.reportChanges(),lt(()=>{a.removeObserver(t)})}aC(CC);class Nu{constructor(e,t){this._forceRecompute=e,this._handleValue=t,this._counter=0}beginUpdate(e){this._counter++}endUpdate(e){this._counter--,this._counter===0&&this._forceRecompute&&(this._handleValue?this._handleValue(e.get()):e.reportChanges())}handlePossibleChange(e){}handleChange(e,t){}}function bC(a,e){let t;return yu({owner:a,debugReferenceFn:e},n=>(t=e(n,t),t))}function ly(a,e){return bC(a,(t,i)=>i??e(t))}const Du={RESOURCES:"ResourceURLs",DOWNLOAD_URL:"DownloadURL",FILES:"Files",TEXT:Ta.text,INTERNAL_URI_LIST:"application/vnd.code.uri-list"},wC=()=>({get delay(){return-1},dispose:()=>{},showHover:()=>{}});let Or=wC;const LC=new Il(()=>Or("mouse",!1)),vC=new Il(()=>Or("element",!1));function hy(a){Or=a}function Tt(a){return a==="element"?vC.value:LC.value}function Iu(){return Or("element",!0)}let ku={showHover:()=>{},hideHover:()=>{},showAndFocusLastHover:()=>{},setupManagedHover:()=>null,showManagedHover:()=>{}};function cy(a){ku=a}function Zi(){return ku}class SC{constructor(e){this.spliceables=e}splice(e,t,i){this.spliceables.forEach(n=>n.splice(e,t,i))}}class gi extends Error{constructor(e,t){super(`ListError [${e}] ${t}`)}}function uc(a,e){const t=[];for(const i of e){if(a.start>=i.range.end)continue;if(a.end<i.range.start)break;const n=Be.intersect(a,i.range);Be.isEmpty(n)||t.push({range:n,size:i.size})}return t}function Ga({start:a,end:e},t){return{start:a+t,end:e+t}}function xC(a){const e=[];let t=null;for(const i of a){const n=i.range.start,s=i.range.end,o=i.size;if(t&&o===t.size){t.range.end=s;continue}t={range:{start:n,end:s},size:o},e.push(t)}return e}function yC(...a){return xC(a.reduce((e,t)=>e.concat(t),[]))}class NC{get paddingTop(){return this._paddingTop}set paddingTop(e){this._size=this._size+e-this._paddingTop,this._paddingTop=e}constructor(e){this.groups=[],this._size=0,this._paddingTop=0,this._paddingTop=e??0,this._size=this._paddingTop}splice(e,t,i=[]){const n=i.length-t,s=uc({start:0,end:e},this.groups),o=uc({start:e+t,end:Number.POSITIVE_INFINITY},this.groups).map(l=>({range:Ga(l.range,n),size:l.size})),r=i.map((l,h)=>({range:{start:e+h,end:e+h+1},size:l.size}));this.groups=yC(s,r,o),this._size=this._paddingTop+this.groups.reduce((l,h)=>l+h.size*(h.range.end-h.range.start),0)}get count(){const e=this.groups.length;return e?this.groups[e-1].range.end:0}get size(){return this._size}indexAt(e){if(e<0)return-1;if(e<this._paddingTop)return 0;let t=0,i=this._paddingTop;for(const n of this.groups){const s=n.range.end-n.range.start,o=i+s*n.size;if(e<o)return t+Math.floor((e-i)/n.size);t+=s,i=o}return t}indexAfter(e){return Math.min(this.indexAt(e)+1,this.count)}positionAt(e){if(e<0)return-1;let t=0,i=0;for(const n of this.groups){const s=n.range.end-n.range.start,o=i+s;if(e<o)return this._paddingTop+t+(e-i)*n.size;t+=s*n.size,i=o}return-1}}class DC{constructor(e){this.renderers=e,this.cache=new Map,this.transactionNodesPendingRemoval=new Set,this.inTransaction=!1}alloc(e){let t=this.getTemplateCache(e).pop(),i=!1;if(t)i=this.transactionNodesPendingRemoval.has(t.domNode),i&&this.transactionNodesPendingRemoval.delete(t.domNode);else{const n=se(".monaco-list-row"),o=this.getRenderer(e).renderTemplate(n);t={domNode:n,templateId:e,templateData:o}}return{row:t,isReusingConnectedDomNode:i}}release(e){e&&this.releaseRow(e)}transact(e){if(this.inTransaction)throw new Error("Already in transaction");this.inTransaction=!0;try{e()}finally{for(const t of this.transactionNodesPendingRemoval)this.doRemoveNode(t);this.transactionNodesPendingRemoval.clear(),this.inTransaction=!1}}releaseRow(e){const{domNode:t,templateId:i}=e;t&&(this.inTransaction?this.transactionNodesPendingRemoval.add(t):this.doRemoveNode(t)),this.getTemplateCache(i).push(e)}doRemoveNode(e){e.classList.remove("scrolling"),e.remove()}getTemplateCache(e){let t=this.cache.get(e);return t||(t=[],this.cache.set(e,t)),t}dispose(){this.cache.forEach((e,t)=>{for(const i of e)this.getRenderer(t).disposeTemplate(i.templateData),i.templateData=null}),this.cache.clear(),this.transactionNodesPendingRemoval.clear()}getRenderer(e){const t=this.renderers.get(e);if(!t)throw new Error(`No renderer found for ${e}`);return t}}var Gt=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s};const fi={CurrentDragAndDropData:void 0},pt={useShadows:!0,verticalScrollMode:1,setRowLineHeight:!0,setRowHeight:!0,supportDynamicHeights:!1,dnd:{getDragElements(a){return[a]},getDragURI(){return null},onDragStart(){},onDragOver(){return!1},drop(){},dispose(){}},horizontalScrolling:!1,transformOptimization:!0,alwaysConsumeMouseWheel:!0};class IC{constructor(e){this.elements=e}update(){}getData(){return this.elements}}class kC{constructor(e){this.elements=e}update(){}getData(){return this.elements}}class TC{constructor(){this.types=[],this.files=[]}update(e){if(e.types&&this.types.splice(0,this.types.length,...e.types),e.files){this.files.splice(0,this.files.length);for(let t=0;t<e.files.length;t++){const i=e.files.item(t);i&&(i.size||i.type)&&this.files.push(i)}}}getData(){return{types:this.types,files:this.files}}}function EC(a,e){return Array.isArray(a)&&Array.isArray(e)?Nt(a,e):a===e}class MC{constructor(e){e!=null&&e.getSetSize?this.getSetSize=e.getSetSize.bind(e):this.getSetSize=(t,i,n)=>n,e!=null&&e.getPosInSet?this.getPosInSet=e.getPosInSet.bind(e):this.getPosInSet=(t,i)=>i+1,e!=null&&e.getRole?this.getRole=e.getRole.bind(e):this.getRole=t=>"listitem",e!=null&&e.isChecked?this.isChecked=e.isChecked.bind(e):this.isChecked=t=>{}}}const dr=class dr{get contentHeight(){return this.rangeMap.size}get onDidScroll(){return this.scrollableElement.onScroll}get scrollableElementDomNode(){return this.scrollableElement.getDomNode()}get horizontalScrolling(){return this._horizontalScrolling}set horizontalScrolling(e){if(e!==this._horizontalScrolling){if(e&&this.supportDynamicHeights)throw new Error("Horizontal scrolling and dynamic heights not supported simultaneously");if(this._horizontalScrolling=e,this.domNode.classList.toggle("horizontal-scrolling",this._horizontalScrolling),this._horizontalScrolling){for(const t of this.items)this.measureItemWidth(t);this.updateScrollWidth(),this.scrollableElement.setScrollDimensions({width:zr(this.domNode)}),this.rowsContainer.style.width=`${Math.max(this.scrollWidth||0,this.renderWidth)}px`}else this.scrollableElementWidthDelayer.cancel(),this.scrollableElement.setScrollDimensions({width:this.renderWidth,scrollWidth:this.renderWidth}),this.rowsContainer.style.width=""}}constructor(e,t,i,n=pt){var o,r;if(this.virtualDelegate=t,this.domId=`list_id_${++dr.InstanceCount}`,this.renderers=new Map,this.renderWidth=0,this._scrollHeight=0,this.scrollableElementUpdateDisposable=null,this.scrollableElementWidthDelayer=new Ed(50),this.splicing=!1,this.dragOverAnimationStopDisposable=H.None,this.dragOverMouseY=0,this.canDrop=!1,this.currentDragFeedbackDisposable=H.None,this.onDragLeaveTimeout=H.None,this.disposables=new pe,this._onDidChangeContentHeight=new M,this._onDidChangeContentWidth=new M,this.onDidChangeContentHeight=G.latch(this._onDidChangeContentHeight.event,void 0,this.disposables),this._horizontalScrolling=!1,n.horizontalScrolling&&n.supportDynamicHeights)throw new Error("Horizontal scrolling and dynamic heights not supported simultaneously");this.items=[],this.itemId=0,this.rangeMap=this.createRangeMap(n.paddingTop??0);for(const l of i)this.renderers.set(l.templateId,l);this.cache=this.disposables.add(new DC(this.renderers)),this.lastRenderTop=0,this.lastRenderHeight=0,this.domNode=document.createElement("div"),this.domNode.className="monaco-list",this.domNode.classList.add(this.domId),this.domNode.tabIndex=0,this.domNode.classList.toggle("mouse-support",typeof n.mouseSupport=="boolean"?n.mouseSupport:!0),this._horizontalScrolling=n.horizontalScrolling??pt.horizontalScrolling,this.domNode.classList.toggle("horizontal-scrolling",this._horizontalScrolling),this.paddingBottom=typeof n.paddingBottom>"u"?0:n.paddingBottom,this.accessibilityProvider=new MC(n.accessibilityProvider),this.rowsContainer=document.createElement("div"),this.rowsContainer.className="monaco-list-rows",(n.transformOptimization??pt.transformOptimization)&&(this.rowsContainer.style.transform="translate3d(0px, 0px, 0px)",this.rowsContainer.style.overflow="hidden",this.rowsContainer.style.contain="strict"),this.disposables.add($t.addTarget(this.rowsContainer)),this.scrollable=this.disposables.add(new Jd({forceIntegerValues:!0,smoothScrollDuration:n.smoothScrolling??!1?125:0,scheduleAtNextAnimationFrame:l=>Fn(ee(this.domNode),l)})),this.scrollableElement=this.disposables.add(new eu(this.rowsContainer,{alwaysConsumeMouseWheel:n.alwaysConsumeMouseWheel??pt.alwaysConsumeMouseWheel,horizontal:1,vertical:n.verticalScrollMode??pt.verticalScrollMode,useShadows:n.useShadows??pt.useShadows,mouseWheelScrollSensitivity:n.mouseWheelScrollSensitivity,fastScrollSensitivity:n.fastScrollSensitivity,scrollByPage:n.scrollByPage},this.scrollable)),this.domNode.appendChild(this.scrollableElement.getDomNode()),e.appendChild(this.domNode),this.scrollableElement.onScroll(this.onScroll,this,this.disposables),this.disposables.add(F(this.rowsContainer,Ne.Change,l=>this.onTouchChange(l))),this.disposables.add(F(this.scrollableElement.getDomNode(),"scroll",l=>l.target.scrollTop=0)),this.disposables.add(F(this.domNode,"dragover",l=>this.onDragOver(this.toDragEvent(l)))),this.disposables.add(F(this.domNode,"drop",l=>this.onDrop(this.toDragEvent(l)))),this.disposables.add(F(this.domNode,"dragleave",l=>this.onDragLeave(this.toDragEvent(l)))),this.disposables.add(F(this.domNode,"dragend",l=>this.onDragEnd(l))),this.setRowLineHeight=n.setRowLineHeight??pt.setRowLineHeight,this.setRowHeight=n.setRowHeight??pt.setRowHeight,this.supportDynamicHeights=n.supportDynamicHeights??pt.supportDynamicHeights,this.dnd=n.dnd??this.disposables.add(pt.dnd),this.layout((o=n.initialSize)==null?void 0:o.height,(r=n.initialSize)==null?void 0:r.width)}updateOptions(e){e.paddingBottom!==void 0&&(this.paddingBottom=e.paddingBottom,this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight})),e.smoothScrolling!==void 0&&this.scrollable.setSmoothScrollDuration(e.smoothScrolling?125:0),e.horizontalScrolling!==void 0&&(this.horizontalScrolling=e.horizontalScrolling);let t;if(e.scrollByPage!==void 0&&(t={...t??{},scrollByPage:e.scrollByPage}),e.mouseWheelScrollSensitivity!==void 0&&(t={...t??{},mouseWheelScrollSensitivity:e.mouseWheelScrollSensitivity}),e.fastScrollSensitivity!==void 0&&(t={...t??{},fastScrollSensitivity:e.fastScrollSensitivity}),t&&this.scrollableElement.updateOptions(t),e.paddingTop!==void 0&&e.paddingTop!==this.rangeMap.paddingTop){const i=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),n=e.paddingTop-this.rangeMap.paddingTop;this.rangeMap.paddingTop=e.paddingTop,this.render(i,Math.max(0,this.lastRenderTop+n),this.lastRenderHeight,void 0,void 0,!0),this.setScrollTop(this.lastRenderTop),this.eventuallyUpdateScrollDimensions(),this.supportDynamicHeights&&this._rerender(this.lastRenderTop,this.lastRenderHeight)}}createRangeMap(e){return new NC(e)}splice(e,t,i=[]){if(this.splicing)throw new Error("Can't run recursive splices.");this.splicing=!0;try{return this._splice(e,t,i)}finally{this.splicing=!1,this._onDidChangeContentHeight.fire(this.contentHeight)}}_splice(e,t,i=[]){const n=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),s={start:e,end:e+t},o=Be.intersect(n,s),r=new Map;for(let L=o.end-1;L>=o.start;L--){const S=this.items[L];if(S.dragStartDisposable.dispose(),S.checkedDisposable.dispose(),S.row){let y=r.get(S.templateId);y||(y=[],r.set(S.templateId,y));const N=this.renderers.get(S.templateId);N&&N.disposeElement&&N.disposeElement(S.element,L,S.row.templateData,S.size),y.unshift(S.row)}S.row=null,S.stale=!0}const l={start:e+t,end:this.items.length},h=Be.intersect(l,n),c=Be.relativeComplement(l,n),d=i.map(L=>({id:String(this.itemId++),element:L,templateId:this.virtualDelegate.getTemplateId(L),size:this.virtualDelegate.getHeight(L),width:void 0,hasDynamicHeight:!!this.virtualDelegate.hasDynamicHeight&&this.virtualDelegate.hasDynamicHeight(L),lastDynamicHeightWidth:void 0,row:null,uri:void 0,dropTarget:!1,dragStartDisposable:H.None,checkedDisposable:H.None,stale:!1}));let u;e===0&&t>=this.items.length?(this.rangeMap=this.createRangeMap(this.rangeMap.paddingTop),this.rangeMap.splice(0,0,d),u=this.items,this.items=d):(this.rangeMap.splice(e,t,d),u=this.items.splice(e,t,...d));const g=i.length-t,f=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),m=Ga(h,g),_=Be.intersect(f,m);for(let L=_.start;L<_.end;L++)this.updateItemInDOM(this.items[L],L);const C=Be.relativeComplement(m,f);for(const L of C)for(let S=L.start;S<L.end;S++)this.removeItemFromDOM(S);const p=c.map(L=>Ga(L,g)),w=[{start:e,end:e+i.length},...p].map(L=>Be.intersect(f,L)).reverse();for(const L of w)for(let S=L.end-1;S>=L.start;S--){const y=this.items[S],N=r.get(y.templateId),x=N==null?void 0:N.pop();this.insertItemInDOM(S,x)}for(const L of r.values())for(const S of L)this.cache.release(S);return this.eventuallyUpdateScrollDimensions(),this.supportDynamicHeights&&this._rerender(this.scrollTop,this.renderHeight),u.map(L=>L.element)}eventuallyUpdateScrollDimensions(){this._scrollHeight=this.contentHeight,this.rowsContainer.style.height=`${this._scrollHeight}px`,this.scrollableElementUpdateDisposable||(this.scrollableElementUpdateDisposable=Fn(ee(this.domNode),()=>{this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight}),this.updateScrollWidth(),this.scrollableElementUpdateDisposable=null}))}eventuallyUpdateScrollWidth(){if(!this.horizontalScrolling){this.scrollableElementWidthDelayer.cancel();return}this.scrollableElementWidthDelayer.trigger(()=>this.updateScrollWidth())}updateScrollWidth(){if(!this.horizontalScrolling)return;let e=0;for(const t of this.items)typeof t.width<"u"&&(e=Math.max(e,t.width));this.scrollWidth=e,this.scrollableElement.setScrollDimensions({scrollWidth:e===0?0:e+10}),this._onDidChangeContentWidth.fire(this.scrollWidth)}rerender(){if(this.supportDynamicHeights){for(const e of this.items)e.lastDynamicHeightWidth=void 0;this._rerender(this.lastRenderTop,this.lastRenderHeight)}}get length(){return this.items.length}get renderHeight(){return this.scrollableElement.getScrollDimensions().height}get firstVisibleIndex(){return this.getRenderRange(this.lastRenderTop,this.lastRenderHeight).start}element(e){return this.items[e].element}indexOf(e){return this.items.findIndex(t=>t.element===e)}domElement(e){const t=this.items[e].row;return t&&t.domNode}elementHeight(e){return this.items[e].size}elementTop(e){return this.rangeMap.positionAt(e)}indexAt(e){return this.rangeMap.indexAt(e)}indexAfter(e){return this.rangeMap.indexAfter(e)}layout(e,t){const i={height:typeof e=="number"?e:Pg(this.domNode)};this.scrollableElementUpdateDisposable&&(this.scrollableElementUpdateDisposable.dispose(),this.scrollableElementUpdateDisposable=null,i.scrollHeight=this.scrollHeight),this.scrollableElement.setScrollDimensions(i),typeof t<"u"&&(this.renderWidth=t,this.supportDynamicHeights&&this._rerender(this.scrollTop,this.renderHeight)),this.horizontalScrolling&&this.scrollableElement.setScrollDimensions({width:typeof t=="number"?t:zr(this.domNode)})}render(e,t,i,n,s,o=!1){const r=this.getRenderRange(t,i),l=Be.relativeComplement(r,e).reverse(),h=Be.relativeComplement(e,r);if(o){const c=Be.intersect(e,r);for(let d=c.start;d<c.end;d++)this.updateItemInDOM(this.items[d],d)}this.cache.transact(()=>{for(const c of h)for(let d=c.start;d<c.end;d++)this.removeItemFromDOM(d);for(const c of l)for(let d=c.end-1;d>=c.start;d--)this.insertItemInDOM(d)}),n!==void 0&&(this.rowsContainer.style.left=`-${n}px`),this.rowsContainer.style.top=`-${t}px`,this.horizontalScrolling&&s!==void 0&&(this.rowsContainer.style.width=`${Math.max(s,this.renderWidth)}px`),this.lastRenderTop=t,this.lastRenderHeight=i}insertItemInDOM(e,t){var l,h;const i=this.items[e];if(!i.row)if(t)i.row=t,i.stale=!0;else{const c=this.cache.alloc(i.templateId);i.row=c.row,i.stale||(i.stale=c.isReusingConnectedDomNode)}const n=this.accessibilityProvider.getRole(i.element)||"listitem";i.row.domNode.setAttribute("role",n);const s=this.accessibilityProvider.isChecked(i.element);if(typeof s=="boolean")i.row.domNode.setAttribute("aria-checked",String(!!s));else if(s){const c=d=>i.row.domNode.setAttribute("aria-checked",String(!!d));c(s.value),i.checkedDisposable=s.onDidChange(()=>c(s.value))}if(i.stale||!i.row.domNode.parentElement){const c=((h=(l=this.items.at(e+1))==null?void 0:l.row)==null?void 0:h.domNode)??null;(i.row.domNode.parentElement!==this.rowsContainer||i.row.domNode.nextElementSibling!==c)&&this.rowsContainer.insertBefore(i.row.domNode,c),i.stale=!1}this.updateItemInDOM(i,e);const o=this.renderers.get(i.templateId);if(!o)throw new Error(`No renderer found for template id ${i.templateId}`);o==null||o.renderElement(i.element,e,i.row.templateData,i.size);const r=this.dnd.getDragURI(i.element);i.dragStartDisposable.dispose(),i.row.domNode.draggable=!!r,r&&(i.dragStartDisposable=F(i.row.domNode,"dragstart",c=>this.onDragStart(i.element,r,c))),this.horizontalScrolling&&(this.measureItemWidth(i),this.eventuallyUpdateScrollWidth())}measureItemWidth(e){if(!e.row||!e.row.domNode)return;e.row.domNode.style.width="fit-content",e.width=zr(e.row.domNode);const t=ee(e.row.domNode).getComputedStyle(e.row.domNode);t.paddingLeft&&(e.width+=parseFloat(t.paddingLeft)),t.paddingRight&&(e.width+=parseFloat(t.paddingRight)),e.row.domNode.style.width=""}updateItemInDOM(e,t){e.row.domNode.style.top=`${this.elementTop(t)}px`,this.setRowHeight&&(e.row.domNode.style.height=`${e.size}px`),this.setRowLineHeight&&(e.row.domNode.style.lineHeight=`${e.size}px`),e.row.domNode.setAttribute("data-index",`${t}`),e.row.domNode.setAttribute("data-last-element",t===this.length-1?"true":"false"),e.row.domNode.setAttribute("data-parity",t%2===0?"even":"odd"),e.row.domNode.setAttribute("aria-setsize",String(this.accessibilityProvider.getSetSize(e.element,t,this.length))),e.row.domNode.setAttribute("aria-posinset",String(this.accessibilityProvider.getPosInSet(e.element,t))),e.row.domNode.setAttribute("id",this.getElementDomId(t)),e.row.domNode.classList.toggle("drop-target",e.dropTarget)}removeItemFromDOM(e){const t=this.items[e];if(t.dragStartDisposable.dispose(),t.checkedDisposable.dispose(),t.row){const i=this.renderers.get(t.templateId);i&&i.disposeElement&&i.disposeElement(t.element,e,t.row.templateData,t.size),this.cache.release(t.row),t.row=null}this.horizontalScrolling&&this.eventuallyUpdateScrollWidth()}getScrollTop(){return this.scrollableElement.getScrollPosition().scrollTop}setScrollTop(e,t){this.scrollableElementUpdateDisposable&&(this.scrollableElementUpdateDisposable.dispose(),this.scrollableElementUpdateDisposable=null,this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight})),this.scrollableElement.setScrollPosition({scrollTop:e,reuseAnimation:t})}get scrollTop(){return this.getScrollTop()}set scrollTop(e){this.setScrollTop(e)}get scrollHeight(){return this._scrollHeight+(this.horizontalScrolling?10:0)+this.paddingBottom}get onMouseClick(){return G.map(this.disposables.add(new K(this.domNode,"click")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseDblClick(){return G.map(this.disposables.add(new K(this.domNode,"dblclick")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseMiddleClick(){return G.filter(G.map(this.disposables.add(new K(this.domNode,"auxclick")).event,e=>this.toMouseEvent(e),this.disposables),e=>e.browserEvent.button===1,this.disposables)}get onMouseDown(){return G.map(this.disposables.add(new K(this.domNode,"mousedown")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseOver(){return G.map(this.disposables.add(new K(this.domNode,"mouseover")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseOut(){return G.map(this.disposables.add(new K(this.domNode,"mouseout")).event,e=>this.toMouseEvent(e),this.disposables)}get onContextMenu(){return G.any(G.map(this.disposables.add(new K(this.domNode,"contextmenu")).event,e=>this.toMouseEvent(e),this.disposables),G.map(this.disposables.add(new K(this.domNode,Ne.Contextmenu)).event,e=>this.toGestureEvent(e),this.disposables))}get onTouchStart(){return G.map(this.disposables.add(new K(this.domNode,"touchstart")).event,e=>this.toTouchEvent(e),this.disposables)}get onTap(){return G.map(this.disposables.add(new K(this.rowsContainer,Ne.Tap)).event,e=>this.toGestureEvent(e),this.disposables)}toMouseEvent(e){const t=this.getItemIndexFromEventTarget(e.target||null),i=typeof t>"u"?void 0:this.items[t],n=i&&i.element;return{browserEvent:e,index:t,element:n}}toTouchEvent(e){const t=this.getItemIndexFromEventTarget(e.target||null),i=typeof t>"u"?void 0:this.items[t],n=i&&i.element;return{browserEvent:e,index:t,element:n}}toGestureEvent(e){const t=this.getItemIndexFromEventTarget(e.initialTarget||null),i=typeof t>"u"?void 0:this.items[t],n=i&&i.element;return{browserEvent:e,index:t,element:n}}toDragEvent(e){const t=this.getItemIndexFromEventTarget(e.target||null),i=typeof t>"u"?void 0:this.items[t],n=i&&i.element,s=this.getTargetSector(e,t);return{browserEvent:e,index:t,element:n,sector:s}}onScroll(e){try{const t=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight);this.render(t,e.scrollTop,e.height,e.scrollLeft,e.scrollWidth),this.supportDynamicHeights&&this._rerender(e.scrollTop,e.height,e.inSmoothScrolling)}catch(t){throw console.error("Got bad scroll event:",e),t}}onTouchChange(e){e.preventDefault(),e.stopPropagation(),this.scrollTop-=e.translationY}onDragStart(e,t,i){var s,o;if(!i.dataTransfer)return;const n=this.dnd.getDragElements(e);if(i.dataTransfer.effectAllowed="copyMove",i.dataTransfer.setData(Du.TEXT,t),i.dataTransfer.setDragImage){let r;this.dnd.getDragLabel&&(r=this.dnd.getDragLabel(n,i)),typeof r>"u"&&(r=String(n.length));const l=se(".monaco-drag-image");l.textContent=r,(d=>{for(;d&&!d.classList.contains("monaco-workbench");)d=d.parentElement;return d||this.domNode.ownerDocument})(this.domNode).appendChild(l),i.dataTransfer.setDragImage(l,-10,-10),setTimeout(()=>l.remove(),0)}this.domNode.classList.add("dragging"),this.currentDragData=new IC(n),fi.CurrentDragAndDropData=new kC(n),(o=(s=this.dnd).onDragStart)==null||o.call(s,this.currentDragData,i)}onDragOver(e){var s,o;if(e.browserEvent.preventDefault(),this.onDragLeaveTimeout.dispose(),fi.CurrentDragAndDropData&&fi.CurrentDragAndDropData.getData()==="vscode-ui"||(this.setupDragAndDropScrollTopAnimation(e.browserEvent),!e.browserEvent.dataTransfer))return!1;if(!this.currentDragData)if(fi.CurrentDragAndDropData)this.currentDragData=fi.CurrentDragAndDropData;else{if(!e.browserEvent.dataTransfer.types)return!1;this.currentDragData=new TC}const t=this.dnd.onDragOver(this.currentDragData,e.element,e.index,e.sector,e.browserEvent);if(this.canDrop=typeof t=="boolean"?t:t.accept,!this.canDrop)return this.currentDragFeedback=void 0,this.currentDragFeedbackDisposable.dispose(),!1;e.browserEvent.dataTransfer.dropEffect=typeof t!="boolean"&&((s=t.effect)==null?void 0:s.type)===0?"copy":"move";let i;typeof t!="boolean"&&t.feedback?i=t.feedback:typeof e.index>"u"?i=[-1]:i=[e.index],i=Id(i).filter(r=>r>=-1&&r<this.length).sort((r,l)=>r-l),i=i[0]===-1?[-1]:i;let n=typeof t!="boolean"&&t.effect&&t.effect.position?t.effect.position:"drop-target";if(EC(this.currentDragFeedback,i)&&this.currentDragFeedbackPosition===n)return!0;if(this.currentDragFeedback=i,this.currentDragFeedbackPosition=n,this.currentDragFeedbackDisposable.dispose(),i[0]===-1)this.domNode.classList.add(n),this.rowsContainer.classList.add(n),this.currentDragFeedbackDisposable=lt(()=>{this.domNode.classList.remove(n),this.rowsContainer.classList.remove(n)});else{if(i.length>1&&n!=="drop-target")throw new Error("Can't use multiple feedbacks with position different than 'over'");n==="drop-target-after"&&i[0]<this.length-1&&(i[0]+=1,n="drop-target-before");for(const r of i){const l=this.items[r];l.dropTarget=!0,(o=l.row)==null||o.domNode.classList.add(n)}this.currentDragFeedbackDisposable=lt(()=>{var r;for(const l of i){const h=this.items[l];h.dropTarget=!1,(r=h.row)==null||r.domNode.classList.remove(n)}})}return!0}onDragLeave(e){var t,i;this.onDragLeaveTimeout.dispose(),this.onDragLeaveTimeout=Sh(()=>this.clearDragOverFeedback(),100,this.disposables),this.currentDragData&&((i=(t=this.dnd).onDragLeave)==null||i.call(t,this.currentDragData,e.element,e.index,e.browserEvent))}onDrop(e){if(!this.canDrop)return;const t=this.currentDragData;this.teardownDragAndDropScrollTopAnimation(),this.clearDragOverFeedback(),this.domNode.classList.remove("dragging"),this.currentDragData=void 0,fi.CurrentDragAndDropData=void 0,!(!t||!e.browserEvent.dataTransfer)&&(e.browserEvent.preventDefault(),t.update(e.browserEvent.dataTransfer),this.dnd.drop(t,e.element,e.index,e.sector,e.browserEvent))}onDragEnd(e){var t,i;this.canDrop=!1,this.teardownDragAndDropScrollTopAnimation(),this.clearDragOverFeedback(),this.domNode.classList.remove("dragging"),this.currentDragData=void 0,fi.CurrentDragAndDropData=void 0,(i=(t=this.dnd).onDragEnd)==null||i.call(t,e)}clearDragOverFeedback(){this.currentDragFeedback=void 0,this.currentDragFeedbackPosition=void 0,this.currentDragFeedbackDisposable.dispose(),this.currentDragFeedbackDisposable=H.None}setupDragAndDropScrollTopAnimation(e){if(!this.dragOverAnimationDisposable){const t=Bg(this.domNode).top;this.dragOverAnimationDisposable=Fg(ee(this.domNode),this.animateDragAndDropScrollTop.bind(this,t))}this.dragOverAnimationStopDisposable.dispose(),this.dragOverAnimationStopDisposable=Sh(()=>{this.dragOverAnimationDisposable&&(this.dragOverAnimationDisposable.dispose(),this.dragOverAnimationDisposable=void 0)},1e3,this.disposables),this.dragOverMouseY=e.pageY}animateDragAndDropScrollTop(e){if(this.dragOverMouseY===void 0)return;const t=this.dragOverMouseY-e,i=this.renderHeight-35;t<35?this.scrollTop+=Math.max(-14,Math.floor(.3*(t-35))):t>i&&(this.scrollTop+=Math.min(14,Math.floor(.3*(t-i))))}teardownDragAndDropScrollTopAnimation(){this.dragOverAnimationStopDisposable.dispose(),this.dragOverAnimationDisposable&&(this.dragOverAnimationDisposable.dispose(),this.dragOverAnimationDisposable=void 0)}getTargetSector(e,t){if(t===void 0)return;const i=e.offsetY/this.items[t].size,n=Math.floor(i/.25);return bu(n,0,3)}getItemIndexFromEventTarget(e){const t=this.scrollableElement.getDomNode();let i=e;for(;($s(i)||Wg(i))&&i!==this.rowsContainer&&t.contains(i);){const n=i.getAttribute("data-index");if(n){const s=Number(n);if(!isNaN(s))return s}i=i.parentElement}}getRenderRange(e,t){return{start:this.rangeMap.indexAt(e),end:this.rangeMap.indexAfter(e+t-1)}}_rerender(e,t,i){const n=this.getRenderRange(e,t);let s,o;e===this.elementTop(n.start)?(s=n.start,o=0):n.end-n.start>1&&(s=n.start+1,o=this.elementTop(s)-e);let r=0;for(;;){const l=this.getRenderRange(e,t);let h=!1;for(let c=l.start;c<l.end;c++){const d=this.probeDynamicHeight(c);d!==0&&this.rangeMap.splice(c,1,[this.items[c]]),r+=d,h=h||d!==0}if(!h){r!==0&&this.eventuallyUpdateScrollDimensions();const c=Be.relativeComplement(n,l);for(const u of c)for(let g=u.start;g<u.end;g++)this.items[g].row&&this.removeItemFromDOM(g);const d=Be.relativeComplement(l,n).reverse();for(const u of d)for(let g=u.end-1;g>=u.start;g--)this.insertItemInDOM(g);for(let u=l.start;u<l.end;u++)this.items[u].row&&this.updateItemInDOM(this.items[u],u);if(typeof s=="number"){const u=this.scrollable.getFutureScrollPosition().scrollTop-e,g=this.elementTop(s)-o+u;this.setScrollTop(g,i)}this._onDidChangeContentHeight.fire(this.contentHeight);return}}}probeDynamicHeight(e){var o,r,l;const t=this.items[e];if(this.virtualDelegate.getDynamicHeight){const h=this.virtualDelegate.getDynamicHeight(t.element);if(h!==null){const c=t.size;return t.size=h,t.lastDynamicHeightWidth=this.renderWidth,h-c}}if(!t.hasDynamicHeight||t.lastDynamicHeightWidth===this.renderWidth||this.virtualDelegate.hasDynamicHeight&&!this.virtualDelegate.hasDynamicHeight(t.element))return 0;const i=t.size;if(t.row)return t.row.domNode.style.height="",t.size=t.row.domNode.offsetHeight,t.size===0&&!Mo(t.row.domNode,ee(t.row.domNode).document.body)&&console.warn("Measuring item node that is not in DOM! Add ListView to the DOM before measuring row height!",new Error().stack),t.lastDynamicHeightWidth=this.renderWidth,t.size-i;const{row:n}=this.cache.alloc(t.templateId);n.domNode.style.height="",this.rowsContainer.appendChild(n.domNode);const s=this.renderers.get(t.templateId);if(!s)throw new fe("Missing renderer for templateId: "+t.templateId);return s.renderElement(t.element,e,n.templateData,void 0),t.size=n.domNode.offsetHeight,(o=s.disposeElement)==null||o.call(s,t.element,e,n.templateData,void 0),(l=(r=this.virtualDelegate).setDynamicHeight)==null||l.call(r,t.element,t.size),t.lastDynamicHeightWidth=this.renderWidth,n.domNode.remove(),this.cache.release(n),t.size-i}getElementDomId(e){return`${this.domId}_${e}`}dispose(){var e,t,i;for(const n of this.items)if(n.dragStartDisposable.dispose(),n.checkedDisposable.dispose(),n.row){const s=this.renderers.get(n.row.templateId);s&&((e=s.disposeElement)==null||e.call(s,n.element,-1,n.row.templateData,void 0),s.disposeTemplate(n.row.templateData))}this.items=[],(t=this.domNode)==null||t.remove(),(i=this.dragOverAnimationDisposable)==null||i.dispose(),this.disposables.dispose()}};dr.InstanceCount=0;let ht=dr;Gt([be],ht.prototype,"onMouseClick",null);Gt([be],ht.prototype,"onMouseDblClick",null);Gt([be],ht.prototype,"onMouseMiddleClick",null);Gt([be],ht.prototype,"onMouseDown",null);Gt([be],ht.prototype,"onMouseOver",null);Gt([be],ht.prototype,"onMouseOut",null);Gt([be],ht.prototype,"onContextMenu",null);Gt([be],ht.prototype,"onTouchStart",null);Gt([be],ht.prototype,"onTap",null);var ui=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s};class RC{constructor(e){this.trait=e,this.renderedElements=[]}get templateId(){return`template:${this.trait.name}`}renderTemplate(e){return e}renderElement(e,t,i){const n=this.renderedElements.findIndex(s=>s.templateData===i);if(n>=0){const s=this.renderedElements[n];this.trait.unrender(i),s.index=t}else{const s={index:t,templateData:i};this.renderedElements.push(s)}this.trait.renderIndex(t,i)}splice(e,t,i){const n=[];for(const s of this.renderedElements)s.index<e?n.push(s):s.index>=e+t&&n.push({index:s.index+i-t,templateData:s.templateData});this.renderedElements=n}renderIndexes(e){for(const{index:t,templateData:i}of this.renderedElements)e.indexOf(t)>-1&&this.trait.renderIndex(t,i)}disposeTemplate(e){const t=this.renderedElements.findIndex(i=>i.templateData===e);t<0||this.renderedElements.splice(t,1)}}class Ho{get name(){return this._trait}get renderer(){return new RC(this)}constructor(e){this._trait=e,this.indexes=[],this.sortedIndexes=[],this._onChange=new M,this.onChange=this._onChange.event}splice(e,t,i){const n=i.length-t,s=e+t,o=[];let r=0;for(;r<this.sortedIndexes.length&&this.sortedIndexes[r]<e;)o.push(this.sortedIndexes[r++]);for(let l=0;l<i.length;l++)i[l]&&o.push(l+e);for(;r<this.sortedIndexes.length&&this.sortedIndexes[r]>=s;)o.push(this.sortedIndexes[r++]+n);this.renderer.splice(e,t,i.length),this._set(o,o)}renderIndex(e,t){t.classList.toggle(this._trait,this.contains(e))}unrender(e){e.classList.remove(this._trait)}set(e,t){return this._set(e,[...e].sort(fc),t)}_set(e,t,i){const n=this.indexes,s=this.sortedIndexes;this.indexes=e,this.sortedIndexes=t;const o=Ka(s,e);return this.renderer.renderIndexes(o),this._onChange.fire({indexes:e,browserEvent:i}),n}get(){return this.indexes}contains(e){return Vg(this.sortedIndexes,e,fc)>=0}dispose(){Is(this._onChange)}}ui([be],Ho.prototype,"renderer",null);class AC extends Ho{constructor(e){super("selected"),this.setAriaSelected=e}renderIndex(e,t){super.renderIndex(e,t),this.setAriaSelected&&(this.contains(e)?t.setAttribute("aria-selected","true"):t.setAttribute("aria-selected","false"))}}class Jr{constructor(e,t,i){this.trait=e,this.view=t,this.identityProvider=i}splice(e,t,i){if(!this.identityProvider)return this.trait.splice(e,t,new Array(i.length).fill(!1));const n=this.trait.get().map(r=>this.identityProvider.getId(this.view.element(r)).toString());if(n.length===0)return this.trait.splice(e,t,new Array(i.length).fill(!1));const s=new Set(n),o=i.map(r=>s.has(this.identityProvider.getId(r).toString()));this.trait.splice(e,t,o)}}function In(a){return a.tagName==="INPUT"||a.tagName==="TEXTAREA"}function Js(a,e){return a.classList.contains(e)?!0:a.classList.contains("monaco-list")||!a.parentElement?!1:Js(a.parentElement,e)}function ho(a){return Js(a,"monaco-editor")}function dy(a){return Js(a,"monaco-custom-toggle")}function uy(a){return Js(a,"action-item")}function gy(a){return Js(a,"monaco-tree-sticky-row")}function fy(a){return a.classList.contains("monaco-tree-sticky-container")}function OC(a){return a.tagName==="A"&&a.classList.contains("monaco-button")||a.tagName==="DIV"&&a.classList.contains("monaco-button-dropdown")?!0:a.classList.contains("monaco-list")||!a.parentElement?!1:OC(a.parentElement)}class Tu{get onKeyDown(){return G.chain(this.disposables.add(new K(this.view.domNode,"keydown")).event,e=>e.filter(t=>!In(t.target)).map(t=>new et(t)))}constructor(e,t,i){this.list=e,this.view=t,this.disposables=new pe,this.multipleSelectionDisposables=new pe,this.multipleSelectionSupport=i.multipleSelectionSupport,this.disposables.add(this.onKeyDown(n=>{switch(n.keyCode){case 3:return this.onEnter(n);case 16:return this.onUpArrow(n);case 18:return this.onDownArrow(n);case 11:return this.onPageUpArrow(n);case 12:return this.onPageDownArrow(n);case 9:return this.onEscape(n);case 31:this.multipleSelectionSupport&&(Ae?n.metaKey:n.ctrlKey)&&this.onCtrlA(n)}}))}updateOptions(e){e.multipleSelectionSupport!==void 0&&(this.multipleSelectionSupport=e.multipleSelectionSupport)}onEnter(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(this.list.getFocus(),e.browserEvent)}onUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPrevious(1,!1,e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNext(1,!1,e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onPageUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPreviousPage(e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onPageDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNextPage(e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onCtrlA(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(Md(this.list.length),e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus()}onEscape(e){this.list.getSelection().length&&(e.preventDefault(),e.stopPropagation(),this.list.setSelection([],e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus())}dispose(){this.disposables.dispose(),this.multipleSelectionDisposables.dispose()}}ui([be],Tu.prototype,"onKeyDown",null);var us;(function(a){a[a.Automatic=0]="Automatic",a[a.Trigger=1]="Trigger"})(us||(us={}));var dn;(function(a){a[a.Idle=0]="Idle",a[a.Typing=1]="Typing"})(dn||(dn={}));const PC=new class{mightProducePrintableCharacter(a){return a.ctrlKey||a.metaKey||a.altKey?!1:a.keyCode>=31&&a.keyCode<=56||a.keyCode>=21&&a.keyCode<=30||a.keyCode>=98&&a.keyCode<=107||a.keyCode>=85&&a.keyCode<=95}};class BC{constructor(e,t,i,n,s){this.list=e,this.view=t,this.keyboardNavigationLabelProvider=i,this.keyboardNavigationEventFilter=n,this.delegate=s,this.enabled=!1,this.state=dn.Idle,this.mode=us.Automatic,this.triggered=!1,this.previouslyFocused=-1,this.enabledDisposables=new pe,this.disposables=new pe,this.updateOptions(e.options)}updateOptions(e){e.typeNavigationEnabled??!0?this.enable():this.disable(),this.mode=e.typeNavigationMode??us.Automatic}enable(){if(this.enabled)return;let e=!1;const t=G.chain(this.enabledDisposables.add(new K(this.view.domNode,"keydown")).event,s=>s.filter(o=>!In(o.target)).filter(()=>this.mode===us.Automatic||this.triggered).map(o=>new et(o)).filter(o=>e||this.keyboardNavigationEventFilter(o)).filter(o=>this.delegate.mightProducePrintableCharacter(o)).forEach(o=>ne.stop(o,!0)).map(o=>o.browserEvent.key)),i=G.debounce(t,()=>null,800,void 0,void 0,void 0,this.enabledDisposables);G.reduce(G.any(t,i),(s,o)=>o===null?null:(s||"")+o,void 0,this.enabledDisposables)(this.onInput,this,this.enabledDisposables),i(this.onClear,this,this.enabledDisposables),t(()=>e=!0,void 0,this.enabledDisposables),i(()=>e=!1,void 0,this.enabledDisposables),this.enabled=!0,this.triggered=!1}disable(){this.enabled&&(this.enabledDisposables.clear(),this.enabled=!1,this.triggered=!1)}onClear(){var t;const e=this.list.getFocus();if(e.length>0&&e[0]===this.previouslyFocused){const i=(t=this.list.options.accessibilityProvider)==null?void 0:t.getAriaLabel(this.list.element(e[0]));typeof i=="string"?Ea(i):i&&Ea(i.get())}this.previouslyFocused=-1}onInput(e){if(!e){this.state=dn.Idle,this.triggered=!1;return}const t=this.list.getFocus(),i=t.length>0?t[0]:0,n=this.state===dn.Idle?1:0;this.state=dn.Typing;for(let s=0;s<this.list.length;s++){const o=(i+s+n)%this.list.length,r=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(this.view.element(o)),l=r&&r.toString();if(this.list.options.typeNavigationEnabled){if(typeof l<"u"){if(Ph(e,l)){this.previouslyFocused=i,this.list.setFocus([o]),this.list.reveal(o);return}const h=qf(e,l);if(h&&h[0].end-h[0].start>1&&h.length===1){this.previouslyFocused=i,this.list.setFocus([o]),this.list.reveal(o);return}}}else if(typeof l>"u"||Ph(e,l)){this.previouslyFocused=i,this.list.setFocus([o]),this.list.reveal(o);return}}}dispose(){this.disable(),this.enabledDisposables.dispose(),this.disposables.dispose()}}class FC{constructor(e,t){this.list=e,this.view=t,this.disposables=new pe;const i=G.chain(this.disposables.add(new K(t.domNode,"keydown")).event,s=>s.filter(o=>!In(o.target)).map(o=>new et(o)));G.chain(i,s=>s.filter(o=>o.keyCode===2&&!o.ctrlKey&&!o.metaKey&&!o.shiftKey&&!o.altKey))(this.onTab,this,this.disposables)}onTab(e){if(e.target!==this.view.domNode)return;const t=this.list.getFocus();if(t.length===0)return;const i=this.view.domElement(t[0]);if(!i)return;const n=i.querySelector("[tabIndex]");if(!n||!$s(n)||n.tabIndex===-1)return;const s=ee(n).getComputedStyle(n);s.visibility==="hidden"||s.display==="none"||(e.preventDefault(),e.stopPropagation(),n.focus())}dispose(){this.disposables.dispose()}}function WC(a){return Ae?a.browserEvent.metaKey:a.browserEvent.ctrlKey}function VC(a){return a.browserEvent.shiftKey}function HC(a){return Ad(a)&&a.button===2}const gc={isSelectionSingleChangeEvent:WC,isSelectionRangeChangeEvent:VC};class zC{constructor(e){this.list=e,this.disposables=new pe,this._onPointer=new M,this.onPointer=this._onPointer.event,e.options.multipleSelectionSupport!==!1&&(this.multipleSelectionController=this.list.options.multipleSelectionController||gc),this.mouseSupport=typeof e.options.mouseSupport>"u"||!!e.options.mouseSupport,this.mouseSupport&&(e.onMouseDown(this.onMouseDown,this,this.disposables),e.onContextMenu(this.onContextMenu,this,this.disposables),e.onMouseDblClick(this.onDoubleClick,this,this.disposables),e.onTouchStart(this.onMouseDown,this,this.disposables),this.disposables.add($t.addTarget(e.getHTMLElement()))),G.any(e.onMouseClick,e.onMouseMiddleClick,e.onTap)(this.onViewPointer,this,this.disposables)}updateOptions(e){e.multipleSelectionSupport!==void 0&&(this.multipleSelectionController=void 0,e.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||gc))}isSelectionSingleChangeEvent(e){return this.multipleSelectionController?this.multipleSelectionController.isSelectionSingleChangeEvent(e):!1}isSelectionRangeChangeEvent(e){return this.multipleSelectionController?this.multipleSelectionController.isSelectionRangeChangeEvent(e):!1}isSelectionChangeEvent(e){return this.isSelectionSingleChangeEvent(e)||this.isSelectionRangeChangeEvent(e)}onMouseDown(e){ho(e.browserEvent.target)||Ri()!==e.browserEvent.target&&this.list.domFocus()}onContextMenu(e){if(In(e.browserEvent.target)||ho(e.browserEvent.target))return;const t=typeof e.index>"u"?[]:[e.index];this.list.setFocus(t,e.browserEvent)}onViewPointer(e){if(!this.mouseSupport||In(e.browserEvent.target)||ho(e.browserEvent.target)||e.browserEvent.isHandledByList)return;e.browserEvent.isHandledByList=!0;const t=e.index;if(typeof t>"u"){this.list.setFocus([],e.browserEvent),this.list.setSelection([],e.browserEvent),this.list.setAnchor(void 0);return}if(this.isSelectionChangeEvent(e))return this.changeSelection(e);this.list.setFocus([t],e.browserEvent),this.list.setAnchor(t),HC(e.browserEvent)||this.list.setSelection([t],e.browserEvent),this._onPointer.fire(e)}onDoubleClick(e){if(In(e.browserEvent.target)||ho(e.browserEvent.target)||this.isSelectionChangeEvent(e)||e.browserEvent.isHandledByList)return;e.browserEvent.isHandledByList=!0;const t=this.list.getFocus();this.list.setSelection(t,e.browserEvent)}changeSelection(e){const t=e.index;let i=this.list.getAnchor();if(this.isSelectionRangeChangeEvent(e)){typeof i>"u"&&(i=this.list.getFocus()[0]??t,this.list.setAnchor(i));const n=Math.min(i,t),s=Math.max(i,t),o=Md(n,s+1),r=this.list.getSelection(),l=$C(Ka(r,[i]),i);if(l.length===0)return;const h=Ka(o,GC(r,l));this.list.setSelection(h,e.browserEvent),this.list.setFocus([t],e.browserEvent)}else if(this.isSelectionSingleChangeEvent(e)){const n=this.list.getSelection(),s=n.filter(o=>o!==t);this.list.setFocus([t]),this.list.setAnchor(t),n.length===s.length?this.list.setSelection([...s,t],e.browserEvent):this.list.setSelection(s,e.browserEvent)}}dispose(){this.disposables.dispose()}}class UC{constructor(e,t){this.styleElement=e,this.selectorSuffix=t}style(e){const t=this.selectorSuffix&&`.${this.selectorSuffix}`,i=[];e.listBackground&&i.push(`.monaco-list${t} .monaco-list-rows { background: ${e.listBackground}; }`),e.listFocusBackground&&(i.push(`.monaco-list${t}:focus .monaco-list-row.focused { background-color: ${e.listFocusBackground}; }`),i.push(`.monaco-list${t}:focus .monaco-list-row.focused:hover { background-color: ${e.listFocusBackground}; }`)),e.listFocusForeground&&i.push(`.monaco-list${t}:focus .monaco-list-row.focused { color: ${e.listFocusForeground}; }`),e.listActiveSelectionBackground&&(i.push(`.monaco-list${t}:focus .monaco-list-row.selected { background-color: ${e.listActiveSelectionBackground}; }`),i.push(`.monaco-list${t}:focus .monaco-list-row.selected:hover { background-color: ${e.listActiveSelectionBackground}; }`)),e.listActiveSelectionForeground&&i.push(`.monaco-list${t}:focus .monaco-list-row.selected { color: ${e.listActiveSelectionForeground}; }`),e.listActiveSelectionIconForeground&&i.push(`.monaco-list${t}:focus .monaco-list-row.selected .codicon { color: ${e.listActiveSelectionIconForeground}; }`),e.listFocusAndSelectionBackground&&i.push(`
				.monaco-drag-image,
				.monaco-list${t}:focus .monaco-list-row.selected.focused { background-color: ${e.listFocusAndSelectionBackground}; }
			`),e.listFocusAndSelectionForeground&&i.push(`
				.monaco-drag-image,
				.monaco-list${t}:focus .monaco-list-row.selected.focused { color: ${e.listFocusAndSelectionForeground}; }
			`),e.listInactiveFocusForeground&&(i.push(`.monaco-list${t} .monaco-list-row.focused { color:  ${e.listInactiveFocusForeground}; }`),i.push(`.monaco-list${t} .monaco-list-row.focused:hover { color:  ${e.listInactiveFocusForeground}; }`)),e.listInactiveSelectionIconForeground&&i.push(`.monaco-list${t} .monaco-list-row.focused .codicon { color:  ${e.listInactiveSelectionIconForeground}; }`),e.listInactiveFocusBackground&&(i.push(`.monaco-list${t} .monaco-list-row.focused { background-color:  ${e.listInactiveFocusBackground}; }`),i.push(`.monaco-list${t} .monaco-list-row.focused:hover { background-color:  ${e.listInactiveFocusBackground}; }`)),e.listInactiveSelectionBackground&&(i.push(`.monaco-list${t} .monaco-list-row.selected { background-color:  ${e.listInactiveSelectionBackground}; }`),i.push(`.monaco-list${t} .monaco-list-row.selected:hover { background-color:  ${e.listInactiveSelectionBackground}; }`)),e.listInactiveSelectionForeground&&i.push(`.monaco-list${t} .monaco-list-row.selected { color: ${e.listInactiveSelectionForeground}; }`),e.listHoverBackground&&i.push(`.monaco-list${t}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { background-color: ${e.listHoverBackground}; }`),e.listHoverForeground&&i.push(`.monaco-list${t}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { color:  ${e.listHoverForeground}; }`);const n=Sn(e.listFocusAndSelectionOutline,Sn(e.listSelectionOutline,e.listFocusOutline??""));n&&i.push(`.monaco-list${t}:focus .monaco-list-row.focused.selected { outline: 1px solid ${n}; outline-offset: -1px;}`),e.listFocusOutline&&i.push(`
				.monaco-drag-image,
				.monaco-list${t}:focus .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }
				.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }
			`);const s=Sn(e.listSelectionOutline,e.listInactiveFocusOutline??"");s&&i.push(`.monaco-list${t} .monaco-list-row.focused.selected { outline: 1px dotted ${s}; outline-offset: -1px; }`),e.listSelectionOutline&&i.push(`.monaco-list${t} .monaco-list-row.selected { outline: 1px dotted ${e.listSelectionOutline}; outline-offset: -1px; }`),e.listInactiveFocusOutline&&i.push(`.monaco-list${t} .monaco-list-row.focused { outline: 1px dotted ${e.listInactiveFocusOutline}; outline-offset: -1px; }`),e.listHoverOutline&&i.push(`.monaco-list${t} .monaco-list-row:hover { outline: 1px dashed ${e.listHoverOutline}; outline-offset: -1px; }`),e.listDropOverBackground&&i.push(`
				.monaco-list${t}.drop-target,
				.monaco-list${t} .monaco-list-rows.drop-target,
				.monaco-list${t} .monaco-list-row.drop-target { background-color: ${e.listDropOverBackground} !important; color: inherit !important; }
			`),e.listDropBetweenBackground&&(i.push(`
			.monaco-list${t} .monaco-list-rows.drop-target-before .monaco-list-row:first-child::before,
			.monaco-list${t} .monaco-list-row.drop-target-before::before {
				content: ""; position: absolute; top: 0px; left: 0px; width: 100%; height: 1px;
				background-color: ${e.listDropBetweenBackground};
			}`),i.push(`
			.monaco-list${t} .monaco-list-rows.drop-target-after .monaco-list-row:last-child::after,
			.monaco-list${t} .monaco-list-row.drop-target-after::after {
				content: ""; position: absolute; bottom: 0px; left: 0px; width: 100%; height: 1px;
				background-color: ${e.listDropBetweenBackground};
			}`)),e.tableColumnsBorder&&i.push(`
				.monaco-table > .monaco-split-view2,
				.monaco-table > .monaco-split-view2 .monaco-sash.vertical::before,
				.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2,
				.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2 .monaco-sash.vertical::before {
					border-color: ${e.tableColumnsBorder};
				}

				.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2,
				.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2 .monaco-sash.vertical::before {
					border-color: transparent;
				}
			`),e.tableOddRowsBackgroundColor&&i.push(`
				.monaco-table .monaco-list-row[data-parity=odd]:not(.focused):not(.selected):not(:hover) .monaco-table-tr,
				.monaco-table .monaco-list:not(:focus) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr,
				.monaco-table .monaco-list:not(.focused) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr {
					background-color: ${e.tableOddRowsBackgroundColor};
				}
			`),this.styleElement.textContent=i.join(`
`)}}const my={listFocusBackground:"#7FB0D0",listActiveSelectionBackground:"#0E639C",listActiveSelectionForeground:"#FFFFFF",listActiveSelectionIconForeground:"#FFFFFF",listFocusAndSelectionOutline:"#90C2F9",listFocusAndSelectionBackground:"#094771",listFocusAndSelectionForeground:"#FFFFFF",listInactiveSelectionBackground:"#3F3F46",listInactiveSelectionIconForeground:"#FFFFFF",listHoverBackground:"#2A2D2E",listDropOverBackground:"#383B3D",listDropBetweenBackground:"#EEEEEE",treeIndentGuidesStroke:"#a9a9a9",treeInactiveIndentGuidesStroke:le.fromHex("#a9a9a9").transparent(.4).toString(),tableColumnsBorder:le.fromHex("#cccccc").transparent(.2).toString(),tableOddRowsBackgroundColor:le.fromHex("#cccccc").transparent(.04).toString(),listBackground:void 0,listFocusForeground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusForeground:void 0,listInactiveFocusBackground:void 0,listHoverForeground:void 0,listFocusOutline:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listHoverOutline:void 0,treeStickyScrollBackground:void 0,treeStickyScrollBorder:void 0,treeStickyScrollShadow:void 0},jC={keyboardSupport:!0,mouseSupport:!0,multipleSelectionSupport:!0,dnd:{getDragURI(){return null},onDragStart(){},onDragOver(){return!1},drop(){},dispose(){}}};function $C(a,e){const t=a.indexOf(e);if(t===-1)return[];const i=[];let n=t-1;for(;n>=0&&a[n]===e-(t-n);)i.push(a[n--]);for(i.reverse(),n=t;n<a.length&&a[n]===e+(n-t);)i.push(a[n++]);return i}function Ka(a,e){const t=[];let i=0,n=0;for(;i<a.length||n<e.length;)if(i>=a.length)t.push(e[n++]);else if(n>=e.length)t.push(a[i++]);else if(a[i]===e[n]){t.push(a[i]),i++,n++;continue}else a[i]<e[n]?t.push(a[i++]):t.push(e[n++]);return t}function GC(a,e){const t=[];let i=0,n=0;for(;i<a.length||n<e.length;)if(i>=a.length)t.push(e[n++]);else if(n>=e.length)t.push(a[i++]);else if(a[i]===e[n]){i++,n++;continue}else a[i]<e[n]?t.push(a[i++]):n++;return t}const fc=(a,e)=>a-e;class KC{constructor(e,t){this._templateId=e,this.renderers=t}get templateId(){return this._templateId}renderTemplate(e){return this.renderers.map(t=>t.renderTemplate(e))}renderElement(e,t,i,n){let s=0;for(const o of this.renderers)o.renderElement(e,t,i[s++],n)}disposeElement(e,t,i,n){var o;let s=0;for(const r of this.renderers)(o=r.disposeElement)==null||o.call(r,e,t,i[s],n),s+=1}disposeTemplate(e){let t=0;for(const i of this.renderers)i.disposeTemplate(e[t++])}}class qC{constructor(e){this.accessibilityProvider=e,this.templateId="a18n"}renderTemplate(e){return{container:e,disposables:new pe}}renderElement(e,t,i){const n=this.accessibilityProvider.getAriaLabel(e),s=n&&typeof n!="string"?n:fC(n);i.disposables.add($a(r=>{this.setAriaLabel(r.readObservable(s),i.container)}));const o=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(e);typeof o=="number"?i.container.setAttribute("aria-level",`${o}`):i.container.removeAttribute("aria-level")}setAriaLabel(e,t){e?t.setAttribute("aria-label",e):t.removeAttribute("aria-label")}disposeElement(e,t,i,n){i.disposables.clear()}disposeTemplate(e){e.disposables.dispose()}}class ZC{constructor(e,t){this.list=e,this.dnd=t}getDragElements(e){const t=this.list.getSelectedElements();return t.indexOf(e)>-1?t:[e]}getDragURI(e){return this.dnd.getDragURI(e)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e,t)}onDragStart(e,t){var i,n;(n=(i=this.dnd).onDragStart)==null||n.call(i,e,t)}onDragOver(e,t,i,n,s){return this.dnd.onDragOver(e,t,i,n,s)}onDragLeave(e,t,i,n){var s,o;(o=(s=this.dnd).onDragLeave)==null||o.call(s,e,t,i,n)}onDragEnd(e){var t,i;(i=(t=this.dnd).onDragEnd)==null||i.call(t,e)}drop(e,t,i,n,s){this.dnd.drop(e,t,i,n,s)}dispose(){this.dnd.dispose()}}class Qi{get onDidChangeFocus(){return G.map(this.eventBufferer.wrapEvent(this.focus.onChange),e=>this.toListEvent(e),this.disposables)}get onDidChangeSelection(){return G.map(this.eventBufferer.wrapEvent(this.selection.onChange),e=>this.toListEvent(e),this.disposables)}get domId(){return this.view.domId}get onDidScroll(){return this.view.onDidScroll}get onMouseClick(){return this.view.onMouseClick}get onMouseDblClick(){return this.view.onMouseDblClick}get onMouseMiddleClick(){return this.view.onMouseMiddleClick}get onPointer(){return this.mouseController.onPointer}get onMouseDown(){return this.view.onMouseDown}get onMouseOver(){return this.view.onMouseOver}get onMouseOut(){return this.view.onMouseOut}get onTouchStart(){return this.view.onTouchStart}get onTap(){return this.view.onTap}get onContextMenu(){let e=!1;const t=G.chain(this.disposables.add(new K(this.view.domNode,"keydown")).event,s=>s.map(o=>new et(o)).filter(o=>e=o.keyCode===58||o.shiftKey&&o.keyCode===68).map(o=>ne.stop(o,!0)).filter(()=>!1)),i=G.chain(this.disposables.add(new K(this.view.domNode,"keyup")).event,s=>s.forEach(()=>e=!1).map(o=>new et(o)).filter(o=>o.keyCode===58||o.shiftKey&&o.keyCode===68).map(o=>ne.stop(o,!0)).map(({browserEvent:o})=>{const r=this.getFocus(),l=r.length?r[0]:void 0,h=typeof l<"u"?this.view.element(l):void 0,c=typeof l<"u"?this.view.domElement(l):this.view.domNode;return{index:l,element:h,anchor:c,browserEvent:o}})),n=G.chain(this.view.onContextMenu,s=>s.filter(o=>!e).map(({element:o,index:r,browserEvent:l})=>({element:o,index:r,anchor:new Rd(ee(this.view.domNode),l),browserEvent:l})));return G.any(t,i,n)}get onKeyDown(){return this.disposables.add(new K(this.view.domNode,"keydown")).event}get onDidFocus(){return G.signal(this.disposables.add(new K(this.view.domNode,"focus",!0)).event)}get onDidBlur(){return G.signal(this.disposables.add(new K(this.view.domNode,"blur",!0)).event)}constructor(e,t,i,n,s=jC){var h,c,d;this.user=e,this._options=s,this.focus=new Ho("focused"),this.anchor=new Ho("anchor"),this.eventBufferer=new Hg,this._ariaLabel="",this.disposables=new pe,this._onDidDispose=new M,this.onDidDispose=this._onDidDispose.event;const o=this._options.accessibilityProvider&&this._options.accessibilityProvider.getWidgetRole?(h=this._options.accessibilityProvider)==null?void 0:h.getWidgetRole():"list";this.selection=new AC(o!=="listbox");const r=[this.focus.renderer,this.selection.renderer];this.accessibilityProvider=s.accessibilityProvider,this.accessibilityProvider&&(r.push(new qC(this.accessibilityProvider)),(d=(c=this.accessibilityProvider).onDidChangeActiveDescendant)==null||d.call(c,this.onDidChangeActiveDescendant,this,this.disposables)),n=n.map(u=>new KC(u.templateId,[...r,u]));const l={...s,dnd:s.dnd&&new ZC(this,s.dnd)};if(this.view=this.createListView(t,i,n,l),this.view.domNode.setAttribute("role",o),s.styleController)this.styleController=s.styleController(this.view.domId);else{const u=Dr(this.view.domNode);this.styleController=new UC(u,this.view.domId)}if(this.spliceable=new SC([new Jr(this.focus,this.view,s.identityProvider),new Jr(this.selection,this.view,s.identityProvider),new Jr(this.anchor,this.view,s.identityProvider),this.view]),this.disposables.add(this.focus),this.disposables.add(this.selection),this.disposables.add(this.anchor),this.disposables.add(this.view),this.disposables.add(this._onDidDispose),this.disposables.add(new FC(this,this.view)),(typeof s.keyboardSupport!="boolean"||s.keyboardSupport)&&(this.keyboardController=new Tu(this,this.view,s),this.disposables.add(this.keyboardController)),s.keyboardNavigationLabelProvider){const u=s.keyboardNavigationDelegate||PC;this.typeNavigationController=new BC(this,this.view,s.keyboardNavigationLabelProvider,s.keyboardNavigationEventFilter??(()=>!0),u),this.disposables.add(this.typeNavigationController)}this.mouseController=this.createMouseController(s),this.disposables.add(this.mouseController),this.onDidChangeFocus(this._onFocusChange,this,this.disposables),this.onDidChangeSelection(this._onSelectionChange,this,this.disposables),this.accessibilityProvider&&(this.ariaLabel=this.accessibilityProvider.getWidgetAriaLabel()),this._options.multipleSelectionSupport!==!1&&this.view.domNode.setAttribute("aria-multiselectable","true")}createListView(e,t,i,n){return new ht(e,t,i,n)}createMouseController(e){return new zC(this)}updateOptions(e={}){var t,i;this._options={...this._options,...e},(t=this.typeNavigationController)==null||t.updateOptions(this._options),this._options.multipleSelectionController!==void 0&&(this._options.multipleSelectionSupport?this.view.domNode.setAttribute("aria-multiselectable","true"):this.view.domNode.removeAttribute("aria-multiselectable")),this.mouseController.updateOptions(e),(i=this.keyboardController)==null||i.updateOptions(e),this.view.updateOptions(e)}get options(){return this._options}splice(e,t,i=[]){if(e<0||e>this.view.length)throw new gi(this.user,`Invalid start index: ${e}`);if(t<0)throw new gi(this.user,`Invalid delete count: ${t}`);t===0&&i.length===0||this.eventBufferer.bufferEvents(()=>this.spliceable.splice(e,t,i))}rerender(){this.view.rerender()}element(e){return this.view.element(e)}indexOf(e){return this.view.indexOf(e)}indexAt(e){return this.view.indexAt(e)}get length(){return this.view.length}get contentHeight(){return this.view.contentHeight}get onDidChangeContentHeight(){return this.view.onDidChangeContentHeight}get scrollTop(){return this.view.getScrollTop()}set scrollTop(e){this.view.setScrollTop(e)}get scrollHeight(){return this.view.scrollHeight}get renderHeight(){return this.view.renderHeight}get firstVisibleIndex(){return this.view.firstVisibleIndex}get ariaLabel(){return this._ariaLabel}set ariaLabel(e){this._ariaLabel=e,this.view.domNode.setAttribute("aria-label",e)}domFocus(){this.view.domNode.focus({preventScroll:!0})}layout(e,t){this.view.layout(e,t)}setSelection(e,t){for(const i of e)if(i<0||i>=this.length)throw new gi(this.user,`Invalid index ${i}`);this.selection.set(e,t)}getSelection(){return this.selection.get()}getSelectedElements(){return this.getSelection().map(e=>this.view.element(e))}setAnchor(e){if(typeof e>"u"){this.anchor.set([]);return}if(e<0||e>=this.length)throw new gi(this.user,`Invalid index ${e}`);this.anchor.set([e])}getAnchor(){return zg(this.anchor.get(),void 0)}getAnchorElement(){const e=this.getAnchor();return typeof e>"u"?void 0:this.element(e)}setFocus(e,t){for(const i of e)if(i<0||i>=this.length)throw new gi(this.user,`Invalid index ${i}`);this.focus.set(e,t)}focusNext(e=1,t=!1,i,n){if(this.length===0)return;const s=this.focus.get(),o=this.findNextIndex(s.length>0?s[0]+e:0,t,n);o>-1&&this.setFocus([o],i)}focusPrevious(e=1,t=!1,i,n){if(this.length===0)return;const s=this.focus.get(),o=this.findPreviousIndex(s.length>0?s[0]-e:0,t,n);o>-1&&this.setFocus([o],i)}async focusNextPage(e,t){let i=this.view.indexAt(this.view.getScrollTop()+this.view.renderHeight);i=i===0?0:i-1;const n=this.getFocus()[0];if(n!==i&&(n===void 0||i>n)){const s=this.findPreviousIndex(i,!1,t);s>-1&&n!==s?this.setFocus([s],e):this.setFocus([i],e)}else{const s=this.view.getScrollTop();let o=s+this.view.renderHeight;i>n&&(o-=this.view.elementHeight(i)),this.view.setScrollTop(o),this.view.getScrollTop()!==s&&(this.setFocus([]),await xh(0),await this.focusNextPage(e,t))}}async focusPreviousPage(e,t,i=()=>0){let n;const s=i(),o=this.view.getScrollTop()+s;o===0?n=this.view.indexAt(o):n=this.view.indexAfter(o-1);const r=this.getFocus()[0];if(r!==n&&(r===void 0||r>=n)){const l=this.findNextIndex(n,!1,t);l>-1&&r!==l?this.setFocus([l],e):this.setFocus([n],e)}else{const l=o;this.view.setScrollTop(o-this.view.renderHeight-s),this.view.getScrollTop()+i()!==l&&(this.setFocus([]),await xh(0),await this.focusPreviousPage(e,t,i))}}focusLast(e,t){if(this.length===0)return;const i=this.findPreviousIndex(this.length-1,!1,t);i>-1&&this.setFocus([i],e)}focusFirst(e,t){this.focusNth(0,e,t)}focusNth(e,t,i){if(this.length===0)return;const n=this.findNextIndex(e,!1,i);n>-1&&this.setFocus([n],t)}findNextIndex(e,t=!1,i){for(let n=0;n<this.length;n++){if(e>=this.length&&!t)return-1;if(e=e%this.length,!i||i(this.element(e)))return e;e++}return-1}findPreviousIndex(e,t=!1,i){for(let n=0;n<this.length;n++){if(e<0&&!t)return-1;if(e=(this.length+e%this.length)%this.length,!i||i(this.element(e)))return e;e--}return-1}getFocus(){return this.focus.get()}getFocusedElements(){return this.getFocus().map(e=>this.view.element(e))}reveal(e,t,i=0){if(e<0||e>=this.length)throw new gi(this.user,`Invalid index ${e}`);const n=this.view.getScrollTop(),s=this.view.elementTop(e),o=this.view.elementHeight(e);if(Gs(t)){const r=o-this.view.renderHeight+i;this.view.setScrollTop(r*bu(t,0,1)+s-i)}else{const r=s+o,l=n+this.view.renderHeight;s<n+i&&r>=l||(s<n+i||r>=l&&o>=this.view.renderHeight?this.view.setScrollTop(s-i):r>=l&&this.view.setScrollTop(r-this.view.renderHeight))}}getRelativeTop(e,t=0){if(e<0||e>=this.length)throw new gi(this.user,`Invalid index ${e}`);const i=this.view.getScrollTop(),n=this.view.elementTop(e),s=this.view.elementHeight(e);if(n<i+t||n+s>i+this.view.renderHeight)return null;const o=s-this.view.renderHeight+t;return Math.abs((i+t-n)/o)}getHTMLElement(){return this.view.domNode}getScrollableElement(){return this.view.scrollableElementDomNode}getElementID(e){return this.view.getElementDomId(e)}getElementTop(e){return this.view.elementTop(e)}style(e){this.styleController.style(e)}toListEvent({indexes:e,browserEvent:t}){return{indexes:e,elements:e.map(i=>this.view.element(i)),browserEvent:t}}_onFocusChange(){const e=this.focus.get();this.view.domNode.classList.toggle("element-focused",e.length>0),this.onDidChangeActiveDescendant()}onDidChangeActiveDescendant(){var t;const e=this.focus.get();if(e.length>0){let i;(t=this.accessibilityProvider)!=null&&t.getActiveDescendantId&&(i=this.accessibilityProvider.getActiveDescendantId(this.view.element(e[0]))),this.view.domNode.setAttribute("aria-activedescendant",i||this.view.getElementDomId(e[0]))}else this.view.domNode.removeAttribute("aria-activedescendant")}_onSelectionChange(){const e=this.selection.get();this.view.domNode.classList.toggle("selection-none",e.length===0),this.view.domNode.classList.toggle("selection-single",e.length===1),this.view.domNode.classList.toggle("selection-multiple",e.length>1)}dispose(){this._onDidDispose.fire(),this.disposables.dispose(),this._onDidDispose.dispose()}}ui([be],Qi.prototype,"onDidChangeFocus",null);ui([be],Qi.prototype,"onDidChangeSelection",null);ui([be],Qi.prototype,"onContextMenu",null);ui([be],Qi.prototype,"onKeyDown",null);ui([be],Qi.prototype,"onDidFocus",null);ui([be],Qi.prototype,"onDidBlur",null);const Ei=se,Eu="selectOption.entry.template";class QC{get templateId(){return Eu}renderTemplate(e){const t=Object.create(null);return t.root=e,t.text=Y(e,Ei(".option-text")),t.detail=Y(e,Ei(".option-detail")),t.decoratorRight=Y(e,Ei(".option-decorator-right")),t}renderElement(e,t,i){const n=i,s=e.text,o=e.detail,r=e.decoratorRight,l=e.isDisabled;n.text.textContent=s,n.detail.textContent=o||"",n.decoratorRight.innerText=r||"",l?n.root.classList.add("option-disabled"):n.root.classList.remove("option-disabled")}disposeTemplate(e){}}const Lt=class Lt extends H{constructor(e,t,i,n,s){super(),this.options=[],this._currentSelection=0,this._hasDetails=!1,this._skipLayout=!1,this._sticky=!1,this._isVisible=!1,this.styles=n,this.selectBoxOptions=s||Object.create(null),typeof this.selectBoxOptions.minBottomMargin!="number"?this.selectBoxOptions.minBottomMargin=Lt.DEFAULT_DROPDOWN_MINIMUM_BOTTOM_MARGIN:this.selectBoxOptions.minBottomMargin<0&&(this.selectBoxOptions.minBottomMargin=0),this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box monaco-select-box-dropdown-padding",typeof this.selectBoxOptions.ariaLabel=="string"&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),typeof this.selectBoxOptions.ariaDescription=="string"&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=new M,this._register(this._onDidSelect),this.registerListeners(),this.constructSelectDropDown(i),this.selected=t||0,e&&this.setOptions(e,t),this.initStyleSheet()}setTitle(e){!this._hover&&e?this._hover=this._register(Zi().setupManagedHover(Tt("mouse"),this.selectElement,e)):this._hover&&this._hover.update(e)}getHeight(){return 22}getTemplateId(){return Eu}constructSelectDropDown(e){this.contextViewProvider=e,this.selectDropDownContainer=se(".monaco-select-box-dropdown-container"),this.selectDropDownContainer.classList.add("monaco-select-box-dropdown-padding"),this.selectionDetailsPane=Y(this.selectDropDownContainer,Ei(".select-box-details-pane"));const t=Y(this.selectDropDownContainer,Ei(".select-box-dropdown-container-width-control")),i=Y(t,Ei(".width-control-div"));this.widthControlElement=document.createElement("span"),this.widthControlElement.className="option-text-width-control",Y(i,this.widthControlElement),this._dropDownPosition=0,this.styleElement=Dr(this.selectDropDownContainer),this.selectDropDownContainer.setAttribute("draggable","true"),this._register(F(this.selectDropDownContainer,oe.DRAG_START,n=>{ne.stop(n,!0)}))}registerListeners(){this._register(ni(this.selectElement,"change",t=>{this.selected=t.target.selectedIndex,this._onDidSelect.fire({index:t.target.selectedIndex,selected:t.target.value}),this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)})),this._register(F(this.selectElement,oe.CLICK,t=>{ne.stop(t),this._isVisible?this.hideSelectDropDown(!0):this.showSelectDropDown()})),this._register(F(this.selectElement,oe.MOUSE_DOWN,t=>{ne.stop(t)}));let e;this._register(F(this.selectElement,"touchstart",t=>{e=this._isVisible})),this._register(F(this.selectElement,"touchend",t=>{ne.stop(t),e?this.hideSelectDropDown(!0):this.showSelectDropDown()})),this._register(F(this.selectElement,oe.KEY_DOWN,t=>{const i=new et(t);let n=!1;Ae?(i.keyCode===18||i.keyCode===16||i.keyCode===10||i.keyCode===3)&&(n=!0):(i.keyCode===18&&i.altKey||i.keyCode===16&&i.altKey||i.keyCode===10||i.keyCode===3)&&(n=!0),n&&(this.showSelectDropDown(),ne.stop(t,!0))}))}get onDidSelect(){return this._onDidSelect.event}setOptions(e,t){Nt(this.options,e)||(this.options=e,this.selectElement.options.length=0,this._hasDetails=!1,this._cachedMaxDetailsHeight=void 0,this.options.forEach((i,n)=>{this.selectElement.add(this.createOption(i.text,n,i.isDisabled)),typeof i.description=="string"&&(this._hasDetails=!0)})),t!==void 0&&(this.select(t),this._currentSelection=this.selected)}setOptionsList(){var e;(e=this.selectList)==null||e.splice(0,this.selectList.length,this.options)}select(e){e>=0&&e<this.options.length?this.selected=e:e>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(e){this.selectElement.tabIndex=e?0:-1}render(e){this.container=e,e.classList.add("select-container"),e.appendChild(this.selectElement),this.styleSelectElement()}initStyleSheet(){const e=[];this.styles.listFocusBackground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { background-color: ${this.styles.listFocusBackground} !important; }`),this.styles.listFocusForeground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { color: ${this.styles.listFocusForeground} !important; }`),this.styles.decoratorRightForeground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.focused) .option-decorator-right { color: ${this.styles.decoratorRightForeground}; }`),this.styles.selectBackground&&this.styles.selectBorder&&this.styles.selectBorder!==this.styles.selectBackground?(e.push(`.monaco-select-box-dropdown-container { border: 1px solid ${this.styles.selectBorder} } `),e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-top { border-top: 1px solid ${this.styles.selectBorder} } `),e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-bottom { border-bottom: 1px solid ${this.styles.selectBorder} } `)):this.styles.selectListBorder&&(e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-top { border-top: 1px solid ${this.styles.selectListBorder} } `),e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-bottom { border-bottom: 1px solid ${this.styles.selectListBorder} } `)),this.styles.listHoverForeground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { color: ${this.styles.listHoverForeground} !important; }`),this.styles.listHoverBackground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { background-color: ${this.styles.listHoverBackground} !important; }`),this.styles.listFocusOutline&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { outline: 1.6px dotted ${this.styles.listFocusOutline} !important; outline-offset: -1.6px !important; }`),this.styles.listHoverOutline&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { outline: 1.6px dashed ${this.styles.listHoverOutline} !important; outline-offset: -1.6px !important; }`),e.push(".monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.option-disabled.focused { background-color: transparent !important; color: inherit !important; outline: none !important; }"),e.push(".monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.option-disabled:hover { background-color: transparent !important; color: inherit !important; outline: none !important; }"),this.styleElement.textContent=e.join(`
`)}styleSelectElement(){const e=this.styles.selectBackground??"",t=this.styles.selectForeground??"",i=this.styles.selectBorder??"";this.selectElement.style.backgroundColor=e,this.selectElement.style.color=t,this.selectElement.style.borderColor=i}styleList(){const e=this.styles.selectBackground??"",t=Sn(this.styles.selectListBackground,e);this.selectDropDownListContainer.style.backgroundColor=t,this.selectionDetailsPane.style.backgroundColor=t;const i=this.styles.focusBorder??"";this.selectDropDownContainer.style.outlineColor=i,this.selectDropDownContainer.style.outlineOffset="-1px",this.selectList.style(this.styles)}createOption(e,t,i){const n=document.createElement("option");return n.value=e,n.text=e,n.disabled=!!i,n}showSelectDropDown(){this.selectionDetailsPane.innerText="",!(!this.contextViewProvider||this._isVisible)&&(this.createSelectList(this.selectDropDownContainer),this.setOptionsList(),this.contextViewProvider.showContextView({getAnchor:()=>this.selectElement,render:e=>this.renderSelectDropDown(e,!0),layout:()=>{this.layoutSelectDropDown()},onHide:()=>{this.selectDropDownContainer.classList.remove("visible"),this.selectElement.classList.remove("synthetic-focus")},anchorPosition:this._dropDownPosition},this.selectBoxOptions.optionsAsChildren?this.container:void 0),this._isVisible=!0,this.hideSelectDropDown(!1),this.contextViewProvider.showContextView({getAnchor:()=>this.selectElement,render:e=>this.renderSelectDropDown(e),layout:()=>this.layoutSelectDropDown(),onHide:()=>{this.selectDropDownContainer.classList.remove("visible"),this.selectElement.classList.remove("synthetic-focus")},anchorPosition:this._dropDownPosition},this.selectBoxOptions.optionsAsChildren?this.container:void 0),this._currentSelection=this.selected,this._isVisible=!0,this.selectElement.setAttribute("aria-expanded","true"))}hideSelectDropDown(e){!this.contextViewProvider||!this._isVisible||(this._isVisible=!1,this.selectElement.setAttribute("aria-expanded","false"),e&&this.selectElement.focus(),this.contextViewProvider.hideContextView())}renderSelectDropDown(e,t){return e.appendChild(this.selectDropDownContainer),this.layoutSelectDropDown(t),{dispose:()=>{this.selectDropDownContainer.remove()}}}measureMaxDetailsHeight(){let e=0;return this.options.forEach((t,i)=>{this.updateDetail(i),this.selectionDetailsPane.offsetHeight>e&&(e=this.selectionDetailsPane.offsetHeight)}),e}layoutSelectDropDown(e){if(this._skipLayout)return!1;if(this.selectList){this.selectDropDownContainer.classList.add("visible");const t=ee(this.selectElement),i=Wn(this.selectElement),n=ee(this.selectElement).getComputedStyle(this.selectElement),s=parseFloat(n.getPropertyValue("--dropdown-padding-top"))+parseFloat(n.getPropertyValue("--dropdown-padding-bottom")),o=t.innerHeight-i.top-i.height-(this.selectBoxOptions.minBottomMargin||0),r=i.top-Lt.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN,l=this.selectElement.offsetWidth,h=this.setWidthControlElement(this.widthControlElement),c=Math.max(h,Math.round(l)).toString()+"px";this.selectDropDownContainer.style.width=c,this.selectList.getHTMLElement().style.height="",this.selectList.layout();let d=this.selectList.contentHeight;this._hasDetails&&this._cachedMaxDetailsHeight===void 0&&(this._cachedMaxDetailsHeight=this.measureMaxDetailsHeight());const u=this._hasDetails?this._cachedMaxDetailsHeight:0,g=d+s+u,f=Math.floor((o-s-u)/this.getHeight()),m=Math.floor((r-s-u)/this.getHeight());if(e)return i.top+i.height>t.innerHeight-22||i.top<Lt.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN||f<1&&m<1?!1:(f<Lt.DEFAULT_MINIMUM_VISIBLE_OPTIONS&&m>f&&this.options.length>f?(this._dropDownPosition=1,this.selectDropDownListContainer.remove(),this.selectionDetailsPane.remove(),this.selectDropDownContainer.appendChild(this.selectionDetailsPane),this.selectDropDownContainer.appendChild(this.selectDropDownListContainer),this.selectionDetailsPane.classList.remove("border-top"),this.selectionDetailsPane.classList.add("border-bottom")):(this._dropDownPosition=0,this.selectDropDownListContainer.remove(),this.selectionDetailsPane.remove(),this.selectDropDownContainer.appendChild(this.selectDropDownListContainer),this.selectDropDownContainer.appendChild(this.selectionDetailsPane),this.selectionDetailsPane.classList.remove("border-bottom"),this.selectionDetailsPane.classList.add("border-top")),!0);if(i.top+i.height>t.innerHeight-22||i.top<Lt.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN||this._dropDownPosition===0&&f<1||this._dropDownPosition===1&&m<1)return this.hideSelectDropDown(!0),!1;if(this._dropDownPosition===0){if(this._isVisible&&f+m<1)return this.hideSelectDropDown(!0),!1;g>o&&(d=f*this.getHeight())}else g>r&&(d=m*this.getHeight());return this.selectList.layout(d),this.selectList.domFocus(),this.selectList.length>0&&(this.selectList.setFocus([this.selected||0]),this.selectList.reveal(this.selectList.getFocus()[0]||0)),this._hasDetails?(this.selectList.getHTMLElement().style.height=d+s+"px",this.selectDropDownContainer.style.height=""):this.selectDropDownContainer.style.height=d+s+"px",this.updateDetail(this.selected),this.selectDropDownContainer.style.width=c,this.selectDropDownListContainer.setAttribute("tabindex","0"),this.selectElement.classList.add("synthetic-focus"),this.selectDropDownContainer.classList.add("synthetic-focus"),!0}else return!1}setWidthControlElement(e){let t=0;if(e){let i=0,n=0;this.options.forEach((s,o)=>{const r=s.detail?s.detail.length:0,l=s.decoratorRight?s.decoratorRight.length:0,h=s.text.length+r+l;h>n&&(i=o,n=h)}),e.textContent=this.options[i].text+(this.options[i].decoratorRight?this.options[i].decoratorRight+" ":""),t=Od(e)}return t}createSelectList(e){if(this.selectList)return;this.selectDropDownListContainer=Y(e,Ei(".select-box-dropdown-list-container")),this.listRenderer=new QC,this.selectList=this._register(new Qi("SelectBoxCustom",this.selectDropDownListContainer,this,[this.listRenderer],{useShadows:!1,verticalScrollMode:3,keyboardSupport:!1,mouseSupport:!1,accessibilityProvider:{getAriaLabel:n=>{let s=n.text;return n.detail&&(s+=`. ${n.detail}`),n.decoratorRight&&(s+=`. ${n.decoratorRight}`),n.description&&(s+=`. ${n.description}`),s},getWidgetAriaLabel:()=>I({key:"selectBox",comment:["Behave like native select dropdown element."]},"Select Box"),getRole:()=>Ae?"":"option",getWidgetRole:()=>"listbox"}})),this.selectBoxOptions.ariaLabel&&(this.selectList.ariaLabel=this.selectBoxOptions.ariaLabel);const t=this._register(new K(this.selectDropDownListContainer,"keydown")),i=G.chain(t.event,n=>n.filter(()=>this.selectList.length>0).map(s=>new et(s)));this._register(G.chain(i,n=>n.filter(s=>s.keyCode===3))(this.onEnter,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===2))(this.onEnter,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===9))(this.onEscape,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===16))(this.onUpArrow,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===18))(this.onDownArrow,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===12))(this.onPageDown,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===11))(this.onPageUp,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===14))(this.onHome,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode===13))(this.onEnd,this)),this._register(G.chain(i,n=>n.filter(s=>s.keyCode>=21&&s.keyCode<=56||s.keyCode>=85&&s.keyCode<=113))(this.onCharacter,this)),this._register(F(this.selectList.getHTMLElement(),oe.POINTER_UP,n=>this.onPointerUp(n))),this._register(this.selectList.onMouseOver(n=>typeof n.index<"u"&&this.selectList.setFocus([n.index]))),this._register(this.selectList.onDidChangeFocus(n=>this.onListFocus(n))),this._register(F(this.selectDropDownContainer,oe.FOCUS_OUT,n=>{!this._isVisible||Mo(n.relatedTarget,this.selectDropDownContainer)||this.onListBlur()})),this.selectList.getHTMLElement().setAttribute("aria-label",this.selectBoxOptions.ariaLabel||""),this.selectList.getHTMLElement().setAttribute("aria-expanded","true"),this.styleList()}onPointerUp(e){if(!this.selectList.length)return;ne.stop(e);const t=e.target;if(!t||t.classList.contains("slider"))return;const i=t.closest(".monaco-list-row");if(!i)return;const n=Number(i.getAttribute("data-index")),s=i.classList.contains("option-disabled");n>=0&&n<this.options.length&&!s&&(this.selected=n,this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0]),this.selected!==this._currentSelection&&(this._currentSelection=this.selected,this._onDidSelect.fire({index:this.selectElement.selectedIndex,selected:this.options[this.selected].text}),this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)),this.hideSelectDropDown(!0))}onListBlur(){this._sticky||(this.selected!==this._currentSelection&&this.select(this._currentSelection),this.hideSelectDropDown(!1))}renderDescriptionMarkdown(e,t){const i=s=>{for(let o=0;o<s.childNodes.length;o++){const r=s.childNodes.item(o);(r.tagName&&r.tagName.toLowerCase())==="img"?r.remove():i(r)}},n=Zf({value:e,supportThemeIcons:!0},{actionHandler:t});return n.element.classList.add("select-box-description-markdown"),i(n.element),n.element}onListFocus(e){!this._isVisible||!this._hasDetails||this.updateDetail(e.indexes[0])}updateDetail(e){this.selectionDetailsPane.innerText="";const t=this.options[e],i=(t==null?void 0:t.description)??"",n=(t==null?void 0:t.descriptionIsMarkdown)??!1;if(i){if(n){const s=t.descriptionMarkdownActionHandler;this.selectionDetailsPane.appendChild(this.renderDescriptionMarkdown(i,s))}else this.selectionDetailsPane.innerText=i;this.selectionDetailsPane.style.display="block"}else this.selectionDetailsPane.style.display="none";this._skipLayout=!0,this.contextViewProvider.layout(),this._skipLayout=!1}onEscape(e){ne.stop(e),this.select(this._currentSelection),this.hideSelectDropDown(!0)}onEnter(e){ne.stop(e),this.selected!==this._currentSelection&&(this._currentSelection=this.selected,this._onDidSelect.fire({index:this.selectElement.selectedIndex,selected:this.options[this.selected].text}),this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)),this.hideSelectDropDown(!0)}onDownArrow(e){if(this.selected<this.options.length-1){ne.stop(e,!0);const t=this.options[this.selected+1].isDisabled;if(t&&this.options.length>this.selected+2)this.selected+=2;else{if(t)return;this.selected++}this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0])}}onUpArrow(e){this.selected>0&&(ne.stop(e,!0),this.options[this.selected-1].isDisabled&&this.selected>1?this.selected-=2:this.selected--,this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0]))}onPageUp(e){ne.stop(e),this.selectList.focusPreviousPage(),setTimeout(()=>{this.selected=this.selectList.getFocus()[0],this.options[this.selected].isDisabled&&this.selected<this.options.length-1&&(this.selected++,this.selectList.setFocus([this.selected])),this.selectList.reveal(this.selected),this.select(this.selected)},1)}onPageDown(e){ne.stop(e),this.selectList.focusNextPage(),setTimeout(()=>{this.selected=this.selectList.getFocus()[0],this.options[this.selected].isDisabled&&this.selected>0&&(this.selected--,this.selectList.setFocus([this.selected])),this.selectList.reveal(this.selected),this.select(this.selected)},1)}onHome(e){ne.stop(e),!(this.options.length<2)&&(this.selected=0,this.options[this.selected].isDisabled&&this.selected>1&&this.selected++,this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selected),this.select(this.selected))}onEnd(e){ne.stop(e),!(this.options.length<2)&&(this.selected=this.options.length-1,this.options[this.selected].isDisabled&&this.selected>1&&this.selected--,this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selected),this.select(this.selected))}onCharacter(e){const t=Ug.toString(e.keyCode);let i=-1;for(let n=0;n<this.options.length-1;n++)if(i=(n+this.selected+1)%this.options.length,this.options[i].text.charAt(0).toUpperCase()===t&&!this.options[i].isDisabled){this.select(i),this.selectList.setFocus([i]),this.selectList.reveal(this.selectList.getFocus()[0]),ne.stop(e);break}}dispose(){this.hideSelectDropDown(!1),super.dispose()}};Lt.DEFAULT_DROPDOWN_MINIMUM_BOTTOM_MARGIN=32,Lt.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN=2,Lt.DEFAULT_MINIMUM_VISIBLE_OPTIONS=3;let qa=Lt;class YC extends H{constructor(e,t,i,n){super(),this.selected=0,this.selectBoxOptions=n||Object.create(null),this.options=[],this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box",typeof this.selectBoxOptions.ariaLabel=="string"&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),typeof this.selectBoxOptions.ariaDescription=="string"&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=this._register(new M),this.styles=i,this.registerListeners(),this.setOptions(e,t)}registerListeners(){this._register($t.addTarget(this.selectElement)),[Ne.Tap].forEach(e=>{this._register(F(this.selectElement,e,t=>{this.selectElement.focus()}))}),this._register(ni(this.selectElement,"click",e=>{ne.stop(e,!0)})),this._register(ni(this.selectElement,"change",e=>{this.selectElement.title=e.target.value,this._onDidSelect.fire({index:e.target.selectedIndex,selected:e.target.value})})),this._register(ni(this.selectElement,"keydown",e=>{let t=!1;Ae?(e.keyCode===18||e.keyCode===16||e.keyCode===10)&&(t=!0):(e.keyCode===18&&e.altKey||e.keyCode===10||e.keyCode===3)&&(t=!0),t&&e.stopPropagation()}))}get onDidSelect(){return this._onDidSelect.event}setOptions(e,t){(!this.options||!Nt(this.options,e))&&(this.options=e,this.selectElement.options.length=0,this.options.forEach((i,n)=>{this.selectElement.add(this.createOption(i.text,n,i.isDisabled))})),t!==void 0&&this.select(t)}select(e){this.options.length===0?this.selected=0:e>=0&&e<this.options.length?this.selected=e:e>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.selected<this.options.length&&typeof this.options[this.selected].text=="string"?this.selectElement.title=this.options[this.selected].text:this.selectElement.title=""}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(e){this.selectElement.tabIndex=e?0:-1}render(e){e.classList.add("select-container"),e.appendChild(this.selectElement),this.setOptions(this.options,this.selected),this.applyStyles()}applyStyles(){this.selectElement&&(this.selectElement.style.backgroundColor=this.styles.selectBackground??"",this.selectElement.style.color=this.styles.selectForeground??"",this.selectElement.style.borderColor=this.styles.selectBorder??"")}createOption(e,t,i){const n=document.createElement("option");return n.value=e,n.text=e,n.disabled=!!i,n}}class XC extends kr{constructor(e,t,i,n,s){super(),Ae&&!(s!=null&&s.useCustomDrawn)?this.selectBoxDelegate=new YC(e,t,n,s):this.selectBoxDelegate=new qa(e,t,i,n,s),this._register(this.selectBoxDelegate)}get onDidSelect(){return this.selectBoxDelegate.onDidSelect}setOptions(e,t){this.selectBoxDelegate.setOptions(e,t)}select(e){this.selectBoxDelegate.select(e)}focus(){this.selectBoxDelegate.focus()}blur(){this.selectBoxDelegate.blur()}setFocusable(e){this.selectBoxDelegate.setFocusable(e)}render(e){this.selectBoxDelegate.render(e)}}class St extends H{get action(){return this._action}constructor(e,t,i={}){super(),this.options=i,this._context=e||this,this._action=t,t instanceof jg&&this._register(t.onDidChange(n=>{this.element&&this.handleActionChangeEvent(n)}))}handleActionChangeEvent(e){e.enabled!==void 0&&this.updateEnabled(),e.checked!==void 0&&this.updateChecked(),e.class!==void 0&&this.updateClass(),e.label!==void 0&&(this.updateLabel(),this.updateTooltip()),e.tooltip!==void 0&&this.updateTooltip()}get actionRunner(){return this._actionRunner||(this._actionRunner=this._register(new ks)),this._actionRunner}set actionRunner(e){this._actionRunner=e}isEnabled(){return this._action.enabled}setActionContext(e){this._context=e}render(e){const t=this.element=e;this._register($t.addTarget(e));const i=this.options&&this.options.draggable;i&&(e.draggable=!0,oi&&this._register(F(e,oe.DRAG_START,n=>{var s;return(s=n.dataTransfer)==null?void 0:s.setData(Du.TEXT,this._action.label)}))),this._register(F(t,Ne.Tap,n=>this.onClick(n,!0))),this._register(F(t,oe.MOUSE_DOWN,n=>{i||ne.stop(n,!0),this._action.enabled&&n.button===0&&t.classList.add("active")})),Ae&&this._register(F(t,oe.CONTEXT_MENU,n=>{n.button===0&&n.ctrlKey===!0&&this.onClick(n)})),this._register(F(t,oe.CLICK,n=>{ne.stop(n,!0),this.options&&this.options.isMenu||this.onClick(n)})),this._register(F(t,oe.DBLCLICK,n=>{ne.stop(n,!0)})),[oe.MOUSE_UP,oe.MOUSE_OUT].forEach(n=>{this._register(F(t,n,s=>{ne.stop(s),t.classList.remove("active")}))})}onClick(e,t=!1){var n;ne.stop(e,!0);const i=Li(this._context)?(n=this.options)!=null&&n.useEventAsContext?e:{preserveFocus:t}:this._context;this.actionRunner.run(this._action,i)}focus(){this.element&&(this.element.tabIndex=0,this.element.focus(),this.element.classList.add("focused"))}blur(){this.element&&(this.element.blur(),this.element.tabIndex=-1,this.element.classList.remove("focused"))}setFocusable(e){this.element&&(this.element.tabIndex=e?0:-1)}get trapsArrowNavigation(){return!1}updateEnabled(){}updateLabel(){}getClass(){return this.action.class}getTooltip(){return this.action.tooltip}updateTooltip(){var t;if(!this.element)return;const e=this.getTooltip()??"";if(this.updateAriaLabel(),(t=this.options.hoverDelegate)!=null&&t.showNativeHover)this.element.title=e;else if(!this.customHover&&e!==""){const i=this.options.hoverDelegate??Tt("element");this.customHover=this._store.add(Zi().setupManagedHover(i,this.element,e))}else this.customHover&&this.customHover.update(e)}updateAriaLabel(){if(this.element){const e=this.getTooltip()??"";this.element.setAttribute("aria-label",e)}}updateClass(){}updateChecked(){}dispose(){this.element&&(this.element.remove(),this.element=void 0),this._context=void 0,super.dispose()}}class Mu extends St{constructor(e,t,i){super(e,t,i),this.options=i,this.options.icon=i.icon!==void 0?i.icon:!1,this.options.label=i.label!==void 0?i.label:!0,this.cssClass=""}render(e){super.render(e),Pd(this.element);const t=document.createElement("a");if(t.classList.add("action-label"),t.setAttribute("role",this.getDefaultAriaRole()),this.label=t,this.element.appendChild(t),this.options.label&&this.options.keybinding){const i=document.createElement("span");i.classList.add("keybinding"),i.textContent=this.options.keybinding,this.element.appendChild(i)}this.updateClass(),this.updateLabel(),this.updateTooltip(),this.updateEnabled(),this.updateChecked()}getDefaultAriaRole(){return this._action.id===Ai.ID?"presentation":this.options.isMenu?"menuitem":this.options.isTabList?"tab":"button"}focus(){this.label&&(this.label.tabIndex=0,this.label.focus())}blur(){this.label&&(this.label.tabIndex=-1)}setFocusable(e){this.label&&(this.label.tabIndex=e?0:-1)}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this.action.label)}getTooltip(){let e=null;return this.action.tooltip?e=this.action.tooltip:!this.options.label&&this.action.label&&this.options.icon&&(e=this.action.label,this.options.keybinding&&(e=I({key:"titleLabel",comment:["action title","action keybinding"]},"{0} ({1})",e,this.options.keybinding))),e??void 0}updateClass(){var e;this.cssClass&&this.label&&this.label.classList.remove(...this.cssClass.split(" ")),this.options.icon?(this.cssClass=this.getClass(),this.label&&(this.label.classList.add("codicon"),this.cssClass&&this.label.classList.add(...this.cssClass.split(" "))),this.updateEnabled()):(e=this.label)==null||e.classList.remove("codicon")}updateEnabled(){var e,t;this.action.enabled?(this.label&&(this.label.removeAttribute("aria-disabled"),this.label.classList.remove("disabled")),(e=this.element)==null||e.classList.remove("disabled")):(this.label&&(this.label.setAttribute("aria-disabled","true"),this.label.classList.add("disabled")),(t=this.element)==null||t.classList.add("disabled"))}updateAriaLabel(){if(this.label){const e=this.getTooltip()??"";this.label.setAttribute("aria-label",e)}}updateChecked(){this.label&&(this.action.checked!==void 0?(this.label.classList.toggle("checked",this.action.checked),this.options.isTabList?this.label.setAttribute("aria-selected",this.action.checked?"true":"false"):(this.label.setAttribute("aria-checked",this.action.checked?"true":"false"),this.label.setAttribute("role","checkbox"))):(this.label.classList.remove("checked"),this.label.removeAttribute(this.options.isTabList?"aria-selected":"aria-checked"),this.label.setAttribute("role",this.getDefaultAriaRole())))}}class JC extends St{constructor(e,t,i,n,s,o,r){super(e,t),this.selectBox=new XC(i,n,s,o,r),this.selectBox.setFocusable(!1),this._register(this.selectBox),this.registerListeners()}select(e){this.selectBox.select(e)}registerListeners(){this._register(this.selectBox.onDidSelect(e=>this.runAction(e.selected,e.index)))}runAction(e,t){this.actionRunner.run(this._action,this.getActionContext(e,t))}getActionContext(e,t){return e}setFocusable(e){this.selectBox.setFocusable(e)}focus(){var e;(e=this.selectBox)==null||e.focus()}blur(){var e;(e=this.selectBox)==null||e.blur()}render(e){this.selectBox.render(e)}}class eb extends ks{constructor(e,t){super(),this._onDidChangeVisibility=this._register(new M),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._element=Y(e,se(".monaco-dropdown")),this._label=Y(this._element,se(".dropdown-label"));let i=t.labelRenderer;i||(i=s=>(s.textContent=t.label||"",null));for(const s of[oe.CLICK,oe.MOUSE_DOWN,Ne.Tap])this._register(F(this.element,s,o=>ne.stop(o,!0)));for(const s of[oe.MOUSE_DOWN,Ne.Tap])this._register(F(this._label,s,o=>{Ad(o)&&(o.detail>1||o.button!==0)||(this.visible?this.hide():this.show())}));this._register(F(this._label,oe.KEY_UP,s=>{const o=new et(s);(o.equals(3)||o.equals(10))&&(ne.stop(s,!0),this.visible?this.hide():this.show())}));const n=i(this._label);n&&this._register(n),this._register($t.addTarget(this._label))}get element(){return this._element}show(){this.visible||(this.visible=!0,this._onDidChangeVisibility.fire(!0))}hide(){this.visible&&(this.visible=!1,this._onDidChangeVisibility.fire(!1))}dispose(){super.dispose(),this.hide(),this.boxContainer&&(this.boxContainer.remove(),this.boxContainer=void 0),this.contents&&(this.contents.remove(),this.contents=void 0),this._label&&(this._label.remove(),this._label=void 0)}}class tb extends eb{constructor(e,t){super(e,t),this._options=t,this._actions=[],this.actions=t.actions||[]}set menuOptions(e){this._menuOptions=e}get menuOptions(){return this._menuOptions}get actions(){return this._options.actionProvider?this._options.actionProvider.getActions():this._actions}set actions(e){this._actions=e}show(){super.show(),this.element.classList.add("active"),this._options.contextMenuProvider.showContextMenu({getAnchor:()=>this.element,getActions:()=>this.actions,getActionsContext:()=>this.menuOptions?this.menuOptions.context:null,getActionViewItem:(e,t)=>this.menuOptions&&this.menuOptions.actionViewItemProvider?this.menuOptions.actionViewItemProvider(e,t):void 0,getKeyBinding:e=>this.menuOptions&&this.menuOptions.getKeyBinding?this.menuOptions.getKeyBinding(e):void 0,getMenuClassName:()=>this._options.menuClassName||"",onHide:()=>this.onHide(),actionRunner:this.menuOptions?this.menuOptions.actionRunner:void 0,anchorAlignment:this.menuOptions?this.menuOptions.anchorAlignment:0,domForShadowRoot:this._options.menuAsChild?this.element:void 0,skipTelemetry:this._options.skipTelemetry})}hide(){super.hide()}onHide(){this.hide(),this.element.classList.remove("active")}}class Ru extends St{constructor(e,t,i,n=Object.create(null)){super(null,e,n),this.actionItem=null,this._onDidChangeVisibility=this._register(new M),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this.menuActionsOrProvider=t,this.contextMenuProvider=i,this.options=n,this.options.actionRunner&&(this.actionRunner=this.options.actionRunner)}render(e){this.actionItem=e;const t=s=>{this.element=Y(s,se("a.action-label"));let o=[];return typeof this.options.classNames=="string"?o=this.options.classNames.split(/\s+/g).filter(r=>!!r):this.options.classNames&&(o=this.options.classNames),o.find(r=>r==="icon")||o.push("codicon"),this.element.classList.add(...o),this.element.setAttribute("role","button"),this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this._action.label&&this._register(Zi().setupManagedHover(this.options.hoverDelegate??Tt("mouse"),this.element,this._action.label)),this.element.ariaLabel=this._action.label||"",null},i=Array.isArray(this.menuActionsOrProvider),n={contextMenuProvider:this.contextMenuProvider,labelRenderer:t,menuAsChild:this.options.menuAsChild,actions:i?this.menuActionsOrProvider:void 0,actionProvider:i?void 0:this.menuActionsOrProvider,skipTelemetry:this.options.skipTelemetry};if(this.dropdownMenu=this._register(new tb(e,n)),this._register(this.dropdownMenu.onDidChangeVisibility(s=>{var o;(o=this.element)==null||o.setAttribute("aria-expanded",`${s}`),this._onDidChangeVisibility.fire(s)})),this.dropdownMenu.menuOptions={actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,getKeyBinding:this.options.keybindingProvider,context:this._context},this.options.anchorAlignmentProvider){const s=this;this.dropdownMenu.menuOptions={...this.dropdownMenu.menuOptions,get anchorAlignment(){return s.options.anchorAlignmentProvider()}}}this.updateTooltip(),this.updateEnabled()}getTooltip(){let e=null;return this.action.tooltip?e=this.action.tooltip:this.action.label&&(e=this.action.label),e??void 0}setActionContext(e){super.setActionContext(e),this.dropdownMenu&&(this.dropdownMenu.menuOptions?this.dropdownMenu.menuOptions.context=e:this.dropdownMenu.menuOptions={context:e})}show(){var e;(e=this.dropdownMenu)==null||e.show()}updateEnabled(){var t,i;const e=!this.action.enabled;(t=this.actionItem)==null||t.classList.toggle("disabled",e),(i=this.element)==null||i.classList.toggle("disabled",e)}}function ib(a){return a?a.condition!==void 0:!1}var kn;(function(a){a[a.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",a[a.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(kn||(kn={}));var un;(function(a){a[a.None=0]="None",a[a.Initialized=1]="Initialized",a[a.Closed=2]="Closed"})(un||(un={}));const ur=class ur extends H{constructor(e,t=Object.create(null)){super(),this.database=e,this.options=t,this._onDidChangeStorage=this._register(new xa),this.onDidChangeStorage=this._onDidChangeStorage.event,this.state=un.None,this.cache=new Map,this.flushDelayer=this._register(new $g(ur.DEFAULT_FLUSH_DELAY)),this.pendingDeletes=new Set,this.pendingInserts=new Map,this.whenFlushedCallbacks=[],this.registerListeners()}registerListeners(){this._register(this.database.onDidChangeItemsExternal(e=>this.onDidChangeItemsExternal(e)))}onDidChangeItemsExternal(e){var t,i;this._onDidChangeStorage.pause();try{(t=e.changed)==null||t.forEach((n,s)=>this.acceptExternal(s,n)),(i=e.deleted)==null||i.forEach(n=>this.acceptExternal(n,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(e,t){if(this.state===un.Closed)return;let i=!1;Li(t)?i=this.cache.delete(e):this.cache.get(e)!==t&&(this.cache.set(e,t),i=!0),i&&this._onDidChangeStorage.fire({key:e,external:!0})}get(e,t){const i=this.cache.get(e);return Li(i)?t:i}getBoolean(e,t){const i=this.get(e);return Li(i)?t:i==="true"}getNumber(e,t){const i=this.get(e);return Li(i)?t:parseInt(i,10)}async set(e,t,i=!1){if(this.state===un.Closed)return;if(Li(t))return this.delete(e,i);const n=Ir(t)||Array.isArray(t)?Qf(t):String(t);if(this.cache.get(e)!==n)return this.cache.set(e,n),this.pendingInserts.set(e,n),this.pendingDeletes.delete(e),this._onDidChangeStorage.fire({key:e,external:i}),this.doFlush()}async delete(e,t=!1){if(!(this.state===un.Closed||!this.cache.delete(e)))return this.pendingDeletes.has(e)||this.pendingDeletes.add(e),this.pendingInserts.delete(e),this._onDidChangeStorage.fire({key:e,external:t}),this.doFlush()}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;const e={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(e).finally(()=>{var t;if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)(t=this.whenFlushedCallbacks.pop())==null||t()})}async doFlush(e){return this.options.hint===kn.STORAGE_IN_MEMORY?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),e)}};ur.DEFAULT_FLUSH_DELAY=100;let gs=ur;class ea{constructor(){this.onDidChangeItemsExternal=G.None,this.items=new Map}async updateItems(e){var t,i;(t=e.insert)==null||t.forEach((n,s)=>this.items.set(s,n)),(i=e.delete)==null||i.forEach(n=>this.items.delete(n))}}const xo="__$__targetStorageMarker",nb=ot("storageService");var mc;(function(a){a[a.NONE=0]="NONE",a[a.SHUTDOWN=1]="SHUTDOWN"})(mc||(mc={}));function sb(a){const e=a.get(xo);if(e)try{return JSON.parse(e)}catch{}return Object.create(null)}const gr=class gr extends H{constructor(e={flushInterval:gr.DEFAULT_FLUSH_INTERVAL}){super(),this.options=e,this._onDidChangeValue=this._register(new xa),this._onDidChangeTarget=this._register(new xa),this._onWillSaveState=this._register(new M),this.onWillSaveState=this._onWillSaveState.event,this._workspaceKeyTargets=void 0,this._profileKeyTargets=void 0,this._applicationKeyTargets=void 0}onDidChangeValue(e,t,i){return G.filter(this._onDidChangeValue.event,n=>n.scope===e&&(t===void 0||n.key===t),i)}emitDidChangeValue(e,t){const{key:i,external:n}=t;if(i===xo){switch(e){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:e})}else this._onDidChangeValue.fire({scope:e,key:i,target:this.getKeyTargets(e)[i],external:n})}get(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.get(e,i)}getBoolean(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.getBoolean(e,i)}getNumber(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.getNumber(e,i)}store(e,t,i,n,s=!1){if(Li(t)){this.remove(e,i,s);return}this.withPausedEmitters(()=>{var o;this.updateKeyTarget(e,i,n),(o=this.getStorage(i))==null||o.set(e,t,s)})}remove(e,t,i=!1){this.withPausedEmitters(()=>{var n;this.updateKeyTarget(e,t,void 0),(n=this.getStorage(t))==null||n.delete(e,i)})}withPausedEmitters(e){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{e()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}updateKeyTarget(e,t,i,n=!1){var o,r;const s=this.getKeyTargets(t);typeof i=="number"?s[e]!==i&&(s[e]=i,(o=this.getStorage(t))==null||o.set(xo,JSON.stringify(s),n)):typeof s[e]=="number"&&(delete s[e],(r=this.getStorage(t))==null||r.set(xo,JSON.stringify(s),n))}get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(e){switch(e){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(e){const t=this.getStorage(e);return t?sb(t):Object.create(null)}};gr.DEFAULT_FLUSH_INTERVAL=60*1e3;let Za=gr;class py extends Za{constructor(){super(),this.applicationStorage=this._register(new gs(new ea,{hint:kn.STORAGE_IN_MEMORY})),this.profileStorage=this._register(new gs(new ea,{hint:kn.STORAGE_IN_MEMORY})),this.workspaceStorage=this._register(new gs(new ea,{hint:kn.STORAGE_IN_MEMORY})),this._register(this.workspaceStorage.onDidChangeStorage(e=>this.emitDidChangeValue(1,e))),this._register(this.profileStorage.onDidChangeStorage(e=>this.emitDidChangeValue(0,e))),this._register(this.applicationStorage.onDidChangeStorage(e=>this.emitDidChangeValue(-1,e)))}getStorage(e){switch(e){case-1:return this.applicationStorage;case 0:return this.profileStorage;default:return this.workspaceStorage}}}function ob(a,e){const t={...e};for(const i in a){const n=a[i];t[i]=n!==void 0?T(n):void 0}return t}const _y={keybindingLabelBackground:T(Xf),keybindingLabelForeground:T(Jf),keybindingLabelBorder:T(em),keybindingLabelBottomBorder:T(tm),keybindingLabelShadow:T(Al)},Cy={buttonForeground:T(im),buttonSeparator:T(nm),buttonBackground:T(sm),buttonHoverBackground:T(om),buttonSecondaryForeground:T(rm),buttonSecondaryBackground:T(am),buttonSecondaryHoverBackground:T(lm),buttonBorder:T(hm)},by={progressBarBackground:T(cm)},rb={inputActiveOptionBorder:T(dm),inputActiveOptionForeground:T(um),inputActiveOptionBackground:T(gm)};T(fm),T(mm),T(pm),T(_m),T(Cm),T(bm),T(wm);T(Lm),T(vm),T(Sm);T(xm),T(ym),T(Al),T(Vn),T(Nm),T(Dm),T(Im),T(km);const ab={inputBackground:T(Tm),inputForeground:T(Em),inputBorder:T(Mm),inputValidationInfoBorder:T(Rm),inputValidationInfoBackground:T(Am),inputValidationInfoForeground:T(Om),inputValidationWarningBorder:T(Pm),inputValidationWarningBackground:T(Bm),inputValidationWarningForeground:T(Fm),inputValidationErrorBorder:T(Wm),inputValidationErrorBackground:T(Vm),inputValidationErrorForeground:T(Hm)},wy={listFilterWidgetBackground:T(zm),listFilterWidgetOutline:T(Um),listFilterWidgetNoMatchesOutline:T(jm),listFilterWidgetShadow:T($m),inputBoxStyles:ab,toggleStyles:rb},Ly={badgeBackground:T(Gm),badgeForeground:T(Km),badgeBorder:T(Vn)};T(qm),T(Zm),T(Bh),T(Bh),T(Qm);const lb={listBackground:void 0,listInactiveFocusForeground:void 0,listFocusBackground:T(Ym),listFocusForeground:T(Xm),listFocusOutline:T(Jm),listActiveSelectionBackground:T(Fh),listActiveSelectionForeground:T(Wh),listActiveSelectionIconForeground:T(ep),listFocusAndSelectionOutline:T(tp),listFocusAndSelectionBackground:T(Fh),listFocusAndSelectionForeground:T(Wh),listInactiveSelectionBackground:T(ip),listInactiveSelectionIconForeground:T(np),listInactiveSelectionForeground:T(sp),listInactiveFocusBackground:T(op),listInactiveFocusOutline:T(rp),listHoverBackground:T(tu),listHoverForeground:T(iu),listDropOverBackground:T(ap),listDropBetweenBackground:T(lp),listSelectionOutline:T(Dt),listHoverOutline:T(Dt),treeIndentGuidesStroke:T(hp),treeInactiveIndentGuidesStroke:T(cp),treeStickyScrollBackground:void 0,treeStickyScrollBorder:void 0,treeStickyScrollShadow:T(nu),tableColumnsBorder:T(dp),tableOddRowsBackgroundColor:T(up)};function vy(a){return ob(a,lb)}const hb={selectBackground:T(gp),selectListBackground:T(fp),selectForeground:T(mp),decoratorRightForeground:T(pp),selectBorder:T(su),focusBorder:T(_p),listFocusBackground:T(Cp),listInactiveSelectionIconForeground:T(bp),listFocusForeground:T(wp),listFocusOutline:Yf(Dt,le.transparent.toString()),listHoverBackground:T(tu),listHoverForeground:T(iu),listHoverOutline:T(Dt),selectListBorder:T(Lp),listBackground:void 0,listActiveSelectionBackground:void 0,listActiveSelectionForeground:void 0,listActiveSelectionIconForeground:void 0,listFocusAndSelectionBackground:void 0,listDropOverBackground:void 0,listDropBetweenBackground:void 0,listInactiveSelectionBackground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusBackground:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listFocusAndSelectionForeground:void 0,listFocusAndSelectionOutline:void 0,listInactiveFocusForeground:void 0,tableColumnsBorder:void 0,tableOddRowsBackgroundColor:void 0,treeIndentGuidesStroke:void 0,treeInactiveIndentGuidesStroke:void 0,treeStickyScrollBackground:void 0,treeStickyScrollBorder:void 0,treeStickyScrollShadow:void 0},Sy={shadowColor:T(Al),borderColor:T(vp),foregroundColor:T(Sp),backgroundColor:T(xp),selectionForegroundColor:T(yp),selectionBackgroundColor:T(Np),selectionBorderColor:T(Dp),separatorColor:T(Ip),scrollbarShadow:T(nu),scrollbarSliderBackground:T(kp),scrollbarSliderHoverBackground:T(Tp),scrollbarSliderActiveBackground:T(Ep)};var Pr=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ze=function(a,e){return function(t,i){e(t,i,a)}};function xy(a,e,t,i){let n,s,o;if(Array.isArray(a))o=a,n=e,s=t;else{const h=e;o=a.getActions(h),n=t,s=i}const r=Bd.getInstance(),l=r.keyStatus.altKey||(qs||Zs)&&r.keyStatus.shiftKey;Au(o,n,l,s?h=>h===s:h=>h==="navigation")}function yy(a,e,t,i,n,s){let o,r,l,h,c;if(Array.isArray(a))c=a,o=e,r=t,l=i,h=n;else{const u=e;c=a.getActions(u),o=t,r=i,l=n,h=s}Au(c,o,!1,typeof r=="string"?u=>u===r:r,l,h)}function Au(a,e,t,i=o=>o==="navigation",n=()=>!1,s=!1){let o,r;Array.isArray(e)?(o=e,r=e):(o=e.primary,r=e.secondary);const l=new Set;for(const[h,c]of a){let d;i(h)?(d=o,d.length>0&&s&&d.push(new Ai)):(d=r,d.length>0&&d.push(new Ai));for(let u of c){t&&(u=u instanceof Tl&&u.alt?u.alt:u);const g=d.push(u);u instanceof Kg&&l.add({group:h,action:u,index:g-1})}}for(const{group:h,action:c,index:d}of l){const u=i(h)?o:r,g=c.actions;n(c,h,u.length)&&u.splice(d,1,...g)}}let $n=class extends Mu{constructor(e,t,i,n,s,o,r,l){super(void 0,e,{icon:!!(e.class||e.item.icon),label:!e.class&&!e.item.icon,draggable:t==null?void 0:t.draggable,keybinding:t==null?void 0:t.keybinding,hoverDelegate:t==null?void 0:t.hoverDelegate}),this._options=t,this._keybindingService=i,this._notificationService=n,this._contextKeyService=s,this._themeService=o,this._contextMenuService=r,this._accessibilityService=l,this._wantsAltCommand=!1,this._itemClassDispose=this._register(new Ui),this._altKey=Bd.getInstance()}get _menuItemAction(){return this._action}get _commandAction(){return this._wantsAltCommand&&this._menuItemAction.alt||this._menuItemAction}async onClick(e){e.preventDefault(),e.stopPropagation();try{await this.actionRunner.run(this._commandAction,this._context)}catch(t){this._notificationService.error(t)}}render(e){if(super.render(e),e.classList.add("menu-entry"),this.options.icon&&this._updateItemClass(this._menuItemAction.item),this._menuItemAction.alt){let t=!1;const i=()=>{var s;const n=!!((s=this._menuItemAction.alt)!=null&&s.enabled)&&(!this._accessibilityService.isMotionReduced()||t)&&(this._altKey.keyStatus.altKey||this._altKey.keyStatus.shiftKey&&t);n!==this._wantsAltCommand&&(this._wantsAltCommand=n,this.updateLabel(),this.updateTooltip(),this.updateClass())};this._register(this._altKey.event(i)),this._register(F(e,"mouseleave",n=>{t=!1,i()})),this._register(F(e,"mouseenter",n=>{t=!0,i()})),i()}}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this._commandAction.label)}getTooltip(){var s;const e=this._keybindingService.lookupKeybinding(this._commandAction.id,this._contextKeyService),t=e&&e.getLabel(),i=this._commandAction.tooltip||this._commandAction.label;let n=t?I("titleAndKb","{0} ({1})",i,t):i;if(!this._wantsAltCommand&&((s=this._menuItemAction.alt)!=null&&s.enabled)){const o=this._menuItemAction.alt.tooltip||this._menuItemAction.alt.label,r=this._keybindingService.lookupKeybinding(this._menuItemAction.alt.id,this._contextKeyService),l=r&&r.getLabel(),h=l?I("titleAndKb","{0} ({1})",o,l):o;n=I("titleAndKbAndAlt",`{0}
[{1}] {2}`,n,J_.modifierLabels[Fd].altKey,h)}return n}updateClass(){this.options.icon&&(this._commandAction!==this._menuItemAction?this._menuItemAction.alt&&this._updateItemClass(this._menuItemAction.alt.item):this._updateItemClass(this._menuItemAction.item))}_updateItemClass(e){this._itemClassDispose.value=void 0;const{element:t,label:i}=this;if(!t||!i)return;const n=this._commandAction.checked&&ib(e.toggled)&&e.toggled.icon?e.toggled.icon:e.icon;if(n)if(xn.isThemeIcon(n)){const s=xn.asClassNameArray(n);i.classList.add(...s),this._itemClassDispose.value=lt(()=>{i.classList.remove(...s)})}else i.style.backgroundImage=_u(this._themeService.getColorTheme().type)?Ts(n.dark):Ts(n.light),i.classList.add("icon"),this._itemClassDispose.value=Wd(lt(()=>{i.style.backgroundImage="",i.classList.remove("icon")}),this._themeService.onDidColorThemeChange(()=>{this.updateClass()}))}};$n=Pr([ze(2,Er),ze(3,Vl),ze(4,kl),ze(5,Wl),ze(6,Hl),ze(7,Mr)],$n);class Ou extends $n{render(e){var t;this.options.label=!0,this.options.icon=!1,super.render(e),e.classList.add("text-only"),e.classList.toggle("use-comma",((t=this._options)==null?void 0:t.useComma)??!1)}updateLabel(){var t;const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!e)return super.updateLabel();if(this.label){const i=Ou._symbolPrintEnter(e);(t=this._options)!=null&&t.conversational?this.label.textContent=I({key:"content2",comment:['A label with keybindg like "ESC to dismiss"']},"{1} to {0}",this._action.label,i):this.label.textContent=I({key:"content",comment:["A label","A keybinding"]},"{0} ({1})",this._action.label,i)}}static _symbolPrintEnter(e){var t;return(t=e.getLabel())==null?void 0:t.replace(/\benter\b/gi,"⏎").replace(/\bEscape\b/gi,"Esc")}}let Qa=class extends Ru{constructor(e,t,i,n,s){const o={...t,menuAsChild:(t==null?void 0:t.menuAsChild)??!1,classNames:(t==null?void 0:t.classNames)??(xn.isThemeIcon(e.item.icon)?xn.asClassName(e.item.icon):void 0),keybindingProvider:(t==null?void 0:t.keybindingProvider)??(r=>i.lookupKeybinding(r.id))};super(e,{getActions:()=>e.actions},n,o),this._keybindingService=i,this._contextMenuService=n,this._themeService=s}render(e){super.render(e),Pd(this.element),e.classList.add("menu-entry");const t=this._action,{icon:i}=t.item;if(i&&!xn.isThemeIcon(i)){this.element.classList.add("icon");const n=()=>{this.element&&(this.element.style.backgroundImage=_u(this._themeService.getColorTheme().type)?Ts(i.dark):Ts(i.light))};n(),this._register(this._themeService.onDidColorThemeChange(()=>{n()}))}}};Qa=Pr([ze(2,Er),ze(3,Hl),ze(4,Wl)],Qa);let Ya=class extends St{constructor(e,t,i,n,s,o,r,l){super(null,e),this._keybindingService=i,this._notificationService=n,this._contextMenuService=s,this._menuService=o,this._instaService=r,this._storageService=l,this._container=null,this._options=t,this._storageKey=`${e.item.submenu.id}_lastActionId`;let h;const c=t!=null&&t.persistLastActionId?l.get(this._storageKey,1):void 0;c&&(h=e.actions.find(u=>c===u.id)),h||(h=e.actions[0]),this._defaultAction=this._instaService.createInstance($n,h,{keybinding:this._getDefaultActionKeybindingLabel(h)});const d={keybindingProvider:u=>this._keybindingService.lookupKeybinding(u.id),...t,menuAsChild:(t==null?void 0:t.menuAsChild)??!0,classNames:(t==null?void 0:t.classNames)??["codicon","codicon-chevron-down"],actionRunner:(t==null?void 0:t.actionRunner)??new ks};this._dropdown=new Ru(e,e.actions,this._contextMenuService,d),this._register(this._dropdown.actionRunner.onDidRun(u=>{u.action instanceof Tl&&this.update(u.action)}))}update(e){var t;(t=this._options)!=null&&t.persistLastActionId&&this._storageService.store(this._storageKey,e.id,1,1),this._defaultAction.dispose(),this._defaultAction=this._instaService.createInstance($n,e,{keybinding:this._getDefaultActionKeybindingLabel(e)}),this._defaultAction.actionRunner=new class extends ks{async runAction(i,n){await i.run(void 0)}},this._container&&this._defaultAction.render(qg(this._container,se(".action-container")))}_getDefaultActionKeybindingLabel(e){var i;let t;if((i=this._options)!=null&&i.renderKeybindingWithDefaultActionLabel){const n=this._keybindingService.lookupKeybinding(e.id);n&&(t=`(${n.getLabel()})`)}return t}setActionContext(e){super.setActionContext(e),this._defaultAction.setActionContext(e),this._dropdown.setActionContext(e)}render(e){this._container=e,super.render(this._container),this._container.classList.add("monaco-dropdown-with-default");const t=se(".action-container");this._defaultAction.render(Y(this._container,t)),this._register(F(t,oe.KEY_DOWN,n=>{const s=new et(n);s.equals(17)&&(this._defaultAction.element.tabIndex=-1,this._dropdown.focus(),s.stopPropagation())}));const i=se(".dropdown-action-container");this._dropdown.render(Y(this._container,i)),this._register(F(i,oe.KEY_DOWN,n=>{var o;const s=new et(n);s.equals(15)&&(this._defaultAction.element.tabIndex=0,this._dropdown.setFocusable(!1),(o=this._defaultAction.element)==null||o.focus(),s.stopPropagation())}))}focus(e){e?this._dropdown.focus():(this._defaultAction.element.tabIndex=0,this._defaultAction.element.focus())}blur(){this._defaultAction.element.tabIndex=-1,this._dropdown.blur(),this._container.blur()}setFocusable(e){e?this._defaultAction.element.tabIndex=0:(this._defaultAction.element.tabIndex=-1,this._dropdown.setFocusable(!1))}dispose(){this._defaultAction.dispose(),this._dropdown.dispose(),super.dispose()}};Ya=Pr([ze(2,Er),ze(3,Vl),ze(4,Hl),ze(5,Gg),ze(6,Ks),ze(7,nb)],Ya);let Xa=class extends JC{constructor(e,t){super(null,e,e.actions.map(i=>({text:i.id===Ai.ID?"─────────":i.label,isDisabled:!i.enabled})),0,t,hb,{ariaLabel:e.tooltip,optionsAsChildren:!0}),this.select(Math.max(0,e.actions.findIndex(i=>i.checked)))}render(e){super.render(e),e.style.borderColor=T(su)}runAction(e,t){const i=this.action.actions[t];i&&this.actionRunner.run(i)}};Xa=Pr([ze(1,Y_)],Xa);function Ty(a,e,t){return e instanceof Tl?a.createInstance($n,e,t):e instanceof Zg?e.item.isSelection?a.createInstance(Xa,e):e.item.rememberDefaultAction?a.createInstance(Ya,e,{...t,persistLastActionId:!0}):a.createInstance(Qa,e,t):void 0}class cb extends H{constructor(e,t={}){var s,o;super(),this._actionRunnerDisposables=this._register(new pe),this.viewItemDisposables=this._register(new El),this.triggerKeyDown=!1,this.focusable=!0,this._onDidBlur=this._register(new M),this.onDidBlur=this._onDidBlur.event,this._onDidCancel=this._register(new M({onWillAddFirstListener:()=>this.cancelHasListener=!0})),this.onDidCancel=this._onDidCancel.event,this.cancelHasListener=!1,this._onDidRun=this._register(new M),this.onDidRun=this._onDidRun.event,this._onWillRun=this._register(new M),this.onWillRun=this._onWillRun.event,this.options=t,this._context=t.context??null,this._orientation=this.options.orientation??0,this._triggerKeys={keyDown:((s=this.options.triggerKeys)==null?void 0:s.keyDown)??!1,keys:((o=this.options.triggerKeys)==null?void 0:o.keys)??[3,10]},this._hoverDelegate=t.hoverDelegate??this._register(Iu()),this.options.actionRunner?this._actionRunner=this.options.actionRunner:(this._actionRunner=new ks,this._actionRunnerDisposables.add(this._actionRunner)),this._actionRunnerDisposables.add(this._actionRunner.onDidRun(r=>this._onDidRun.fire(r))),this._actionRunnerDisposables.add(this._actionRunner.onWillRun(r=>this._onWillRun.fire(r))),this.viewItems=[],this.focusedItem=void 0,this.domNode=document.createElement("div"),this.domNode.className="monaco-action-bar";let i,n;switch(this._orientation){case 0:i=[15],n=[17];break;case 1:i=[16],n=[18],this.domNode.className+=" vertical";break}this._register(F(this.domNode,oe.KEY_DOWN,r=>{const l=new et(r);let h=!0;const c=typeof this.focusedItem=="number"?this.viewItems[this.focusedItem]:void 0;i&&(l.equals(i[0])||l.equals(i[1]))?h=this.focusPrevious():n&&(l.equals(n[0])||l.equals(n[1]))?h=this.focusNext():l.equals(9)&&this.cancelHasListener?this._onDidCancel.fire():l.equals(14)?h=this.focusFirst():l.equals(13)?h=this.focusLast():l.equals(2)&&c instanceof St&&c.trapsArrowNavigation?h=this.focusNext(void 0,!0):this.isTriggerKeyEvent(l)?this._triggerKeys.keyDown?this.doTrigger(l):this.triggerKeyDown=!0:h=!1,h&&(l.preventDefault(),l.stopPropagation())})),this._register(F(this.domNode,oe.KEY_UP,r=>{const l=new et(r);this.isTriggerKeyEvent(l)?(!this._triggerKeys.keyDown&&this.triggerKeyDown&&(this.triggerKeyDown=!1,this.doTrigger(l)),l.preventDefault(),l.stopPropagation()):(l.equals(2)||l.equals(1026)||l.equals(16)||l.equals(18)||l.equals(15)||l.equals(17))&&this.updateFocusedItem()})),this.focusTracker=this._register(ya(this.domNode)),this._register(this.focusTracker.onDidBlur(()=>{(Ri()===this.domNode||!Mo(Ri(),this.domNode))&&(this._onDidBlur.fire(),this.previouslyFocusedItem=this.focusedItem,this.focusedItem=void 0,this.triggerKeyDown=!1)})),this._register(this.focusTracker.onDidFocus(()=>this.updateFocusedItem())),this.actionsList=document.createElement("ul"),this.actionsList.className="actions-container",this.options.highlightToggledItems&&this.actionsList.classList.add("highlight-toggled"),this.actionsList.setAttribute("role",this.options.ariaRole||"toolbar"),this.options.ariaLabel&&this.actionsList.setAttribute("aria-label",this.options.ariaLabel),this.domNode.appendChild(this.actionsList),e.appendChild(this.domNode)}refreshRole(){this.length()>=1?this.actionsList.setAttribute("role",this.options.ariaRole||"toolbar"):this.actionsList.setAttribute("role","presentation")}setFocusable(e){if(this.focusable=e,this.focusable){const t=this.viewItems.find(i=>i instanceof St&&i.isEnabled());t instanceof St&&t.setFocusable(!0)}else this.viewItems.forEach(t=>{t instanceof St&&t.setFocusable(!1)})}isTriggerKeyEvent(e){let t=!1;return this._triggerKeys.keys.forEach(i=>{t=t||e.equals(i)}),t}updateFocusedItem(){var e,t;for(let i=0;i<this.actionsList.children.length;i++){const n=this.actionsList.children[i];if(Mo(Ri(),n)){this.focusedItem=i,(t=(e=this.viewItems[this.focusedItem])==null?void 0:e.showHover)==null||t.call(e);break}}}get context(){return this._context}set context(e){this._context=e,this.viewItems.forEach(t=>t.setActionContext(e))}get actionRunner(){return this._actionRunner}set actionRunner(e){this._actionRunner=e,this._actionRunnerDisposables.clear(),this._actionRunnerDisposables.add(this._actionRunner.onDidRun(t=>this._onDidRun.fire(t))),this._actionRunnerDisposables.add(this._actionRunner.onWillRun(t=>this._onWillRun.fire(t))),this.viewItems.forEach(t=>t.actionRunner=e)}getContainer(){return this.domNode}getAction(e){var t;if(typeof e=="number")return(t=this.viewItems[e])==null?void 0:t.action;if($s(e)){for(;e.parentElement!==this.actionsList;){if(!e.parentElement)return;e=e.parentElement}for(let i=0;i<this.actionsList.childNodes.length;i++)if(this.actionsList.childNodes[i]===e)return this.viewItems[i].action}}push(e,t={}){const i=Array.isArray(e)?e:[e];let n=Gs(t.index)?t.index:null;i.forEach(s=>{const o=document.createElement("li");o.className="action-item",o.setAttribute("role","presentation");let r;const l={hoverDelegate:this._hoverDelegate,...t,isTabList:this.options.ariaRole==="tablist"};this.options.actionViewItemProvider&&(r=this.options.actionViewItemProvider(s,l)),r||(r=new Mu(this.context,s,l)),this.options.allowContextMenu||this.viewItemDisposables.set(r,F(o,oe.CONTEXT_MENU,h=>{ne.stop(h,!0)})),r.actionRunner=this._actionRunner,r.setActionContext(this.context),r.render(o),this.focusable&&r instanceof St&&this.viewItems.length===0&&r.setFocusable(!0),n===null||n<0||n>=this.actionsList.children.length?(this.actionsList.appendChild(o),this.viewItems.push(r)):(this.actionsList.insertBefore(o,this.actionsList.children[n]),this.viewItems.splice(n,0,r),n++)}),typeof this.focusedItem=="number"&&this.focus(this.focusedItem),this.refreshRole()}clear(){this.isEmpty()||(this.viewItems=Is(this.viewItems),this.viewItemDisposables.clearAndDisposeAll(),Qg(this.actionsList),this.refreshRole())}length(){return this.viewItems.length}isEmpty(){return this.viewItems.length===0}focus(e){let t=!1,i;if(e===void 0?t=!0:typeof e=="number"?i=e:typeof e=="boolean"&&(t=e),t&&typeof this.focusedItem>"u"){const n=this.viewItems.findIndex(s=>s.isEnabled());this.focusedItem=n===-1?void 0:n,this.updateFocus(void 0,void 0,!0)}else i!==void 0&&(this.focusedItem=i),this.updateFocus(void 0,void 0,!0)}focusFirst(){return this.focusedItem=this.length()-1,this.focusNext(!0)}focusLast(){return this.focusedItem=0,this.focusPrevious(!0)}focusNext(e,t){if(typeof this.focusedItem>"u")this.focusedItem=this.viewItems.length-1;else if(this.viewItems.length<=1)return!1;const i=this.focusedItem;let n;do{if(!e&&this.options.preventLoopNavigation&&this.focusedItem+1>=this.viewItems.length)return this.focusedItem=i,!1;this.focusedItem=(this.focusedItem+1)%this.viewItems.length,n=this.viewItems[this.focusedItem]}while(this.focusedItem!==i&&(this.options.focusOnlyEnabledItems&&!n.isEnabled()||n.action.id===Ai.ID));return this.updateFocus(void 0,void 0,t),!0}focusPrevious(e){if(typeof this.focusedItem>"u")this.focusedItem=0;else if(this.viewItems.length<=1)return!1;const t=this.focusedItem;let i;do{if(this.focusedItem=this.focusedItem-1,this.focusedItem<0){if(!e&&this.options.preventLoopNavigation)return this.focusedItem=t,!1;this.focusedItem=this.viewItems.length-1}i=this.viewItems[this.focusedItem]}while(this.focusedItem!==t&&(this.options.focusOnlyEnabledItems&&!i.isEnabled()||i.action.id===Ai.ID));return this.updateFocus(!0),!0}updateFocus(e,t,i=!1){var s,o;typeof this.focusedItem>"u"&&this.actionsList.focus({preventScroll:t}),this.previouslyFocusedItem!==void 0&&this.previouslyFocusedItem!==this.focusedItem&&((s=this.viewItems[this.previouslyFocusedItem])==null||s.blur());const n=this.focusedItem!==void 0?this.viewItems[this.focusedItem]:void 0;if(n){let r=!0;yh(n.focus)||(r=!1),this.options.focusOnlyEnabledItems&&yh(n.isEnabled)&&!n.isEnabled()&&(r=!1),n.action.id===Ai.ID&&(r=!1),r?(i||this.previouslyFocusedItem!==this.focusedItem)&&(n.focus(e),this.previouslyFocusedItem=this.focusedItem):(this.actionsList.focus({preventScroll:t}),this.previouslyFocusedItem=void 0),r&&((o=n.showHover)==null||o.call(n))}}doTrigger(e){if(typeof this.focusedItem>"u")return;const t=this.viewItems[this.focusedItem];if(t instanceof St){const i=t._context===null||t._context===void 0?e:t._context;this.run(t._action,i)}}async run(e,t){await this._actionRunner.run(e,t)}dispose(){this._context=void 0,this.viewItems=Is(this.viewItems),this.getContainer().remove(),super.dispose()}}const Pu=P("editor.lineHighlightBackground",null,I("lineHighlight","Background color for the highlight of line at the cursor position.")),pc=P("editor.lineHighlightBorder",{dark:"#282828",light:"#eeeeee",hcDark:"#f38518",hcLight:Vn},I("lineHighlightBorderBox","Background color for the border around the line at the cursor position."));P("editor.rangeHighlightBackground",{dark:"#ffffff0b",light:"#fdff0033",hcDark:null,hcLight:null},I("rangeHighlight","Background color of highlighted ranges, like by quick open and find features. The color must not be opaque so as not to hide underlying decorations."),!0);P("editor.rangeHighlightBorder",{dark:null,light:null,hcDark:Dt,hcLight:Dt},I("rangeHighlightBorder","Background color of the border around highlighted ranges."));P("editor.symbolHighlightBackground",{dark:Vh,light:Vh,hcDark:null,hcLight:null},I("symbolHighlight","Background color of highlighted symbol, like for go to definition or go next/previous symbol. The color must not be opaque so as not to hide underlying decorations."),!0);P("editor.symbolHighlightBorder",{dark:null,light:null,hcDark:Dt,hcLight:Dt},I("symbolHighlightBorder","Background color of the border around highlighted symbols."));const Br=P("editorCursor.foreground",{dark:"#AEAFAD",light:le.black,hcDark:le.white,hcLight:"#0F4A85"},I("caret","Color of the editor cursor.")),$l=P("editorCursor.background",null,I("editorCursorBackground","The background color of the editor cursor. Allows customizing the color of a character overlapped by a block cursor.")),Bu=P("editorMultiCursor.primary.foreground",Br,I("editorMultiCursorPrimaryForeground","Color of the primary editor cursor when multiple cursors are present.")),db=P("editorMultiCursor.primary.background",$l,I("editorMultiCursorPrimaryBackground","The background color of the primary editor cursor when multiple cursors are present. Allows customizing the color of a character overlapped by a block cursor.")),Fu=P("editorMultiCursor.secondary.foreground",Br,I("editorMultiCursorSecondaryForeground","Color of secondary editor cursors when multiple cursors are present.")),ub=P("editorMultiCursor.secondary.background",$l,I("editorMultiCursorSecondaryBackground","The background color of secondary editor cursors when multiple cursors are present. Allows customizing the color of a character overlapped by a block cursor.")),Gl=P("editorWhitespace.foreground",{dark:"#e3e4e229",light:"#33333333",hcDark:"#e3e4e229",hcLight:"#CCCCCC"},I("editorWhitespaces","Color of whitespace characters in the editor.")),gb=P("editorLineNumber.foreground",{dark:"#858585",light:"#237893",hcDark:le.white,hcLight:"#292929"},I("editorLineNumbers","Color of editor line numbers.")),fb=P("editorIndentGuide.background",Gl,I("editorIndentGuides","Color of the editor indentation guides."),!1,I("deprecatedEditorIndentGuides","'editorIndentGuide.background' is deprecated. Use 'editorIndentGuide.background1' instead.")),mb=P("editorIndentGuide.activeBackground",Gl,I("editorActiveIndentGuide","Color of the active editor indentation guides."),!1,I("deprecatedEditorActiveIndentGuide","'editorIndentGuide.activeBackground' is deprecated. Use 'editorIndentGuide.activeBackground1' instead.")),pb=P("editorIndentGuide.background1",fb,I("editorIndentGuides1","Color of the editor indentation guides (1).")),_b=P("editorIndentGuide.background2","#00000000",I("editorIndentGuides2","Color of the editor indentation guides (2).")),Cb=P("editorIndentGuide.background3","#00000000",I("editorIndentGuides3","Color of the editor indentation guides (3).")),bb=P("editorIndentGuide.background4","#00000000",I("editorIndentGuides4","Color of the editor indentation guides (4).")),wb=P("editorIndentGuide.background5","#00000000",I("editorIndentGuides5","Color of the editor indentation guides (5).")),Lb=P("editorIndentGuide.background6","#00000000",I("editorIndentGuides6","Color of the editor indentation guides (6).")),vb=P("editorIndentGuide.activeBackground1",mb,I("editorActiveIndentGuide1","Color of the active editor indentation guides (1).")),Sb=P("editorIndentGuide.activeBackground2","#00000000",I("editorActiveIndentGuide2","Color of the active editor indentation guides (2).")),xb=P("editorIndentGuide.activeBackground3","#00000000",I("editorActiveIndentGuide3","Color of the active editor indentation guides (3).")),yb=P("editorIndentGuide.activeBackground4","#00000000",I("editorActiveIndentGuide4","Color of the active editor indentation guides (4).")),Nb=P("editorIndentGuide.activeBackground5","#00000000",I("editorActiveIndentGuide5","Color of the active editor indentation guides (5).")),Db=P("editorIndentGuide.activeBackground6","#00000000",I("editorActiveIndentGuide6","Color of the active editor indentation guides (6).")),Ib=P("editorActiveLineNumber.foreground",{dark:"#c6c6c6",light:"#0B216F",hcDark:Dt,hcLight:Dt},I("editorActiveLineNumber","Color of editor active line number"),!1,I("deprecatedEditorActiveLineNumber","Id is deprecated. Use 'editorLineNumber.activeForeground' instead."));P("editorLineNumber.activeForeground",Ib,I("editorActiveLineNumber","Color of editor active line number"));const kb=P("editorLineNumber.dimmedForeground",null,I("editorDimmedLineNumber","Color of the final editor line when editor.renderFinalNewline is set to dimmed."));P("editorRuler.foreground",{dark:"#5A5A5A",light:le.lightgrey,hcDark:le.white,hcLight:"#292929"},I("editorRuler","Color of the editor rulers."));P("editorCodeLens.foreground",{dark:"#999999",light:"#919191",hcDark:"#999999",hcLight:"#292929"},I("editorCodeLensForeground","Foreground color of editor CodeLens"));P("editorBracketMatch.background",{dark:"#0064001a",light:"#0064001a",hcDark:"#0064001a",hcLight:"#0000"},I("editorBracketMatchBackground","Background color behind matching brackets"));P("editorBracketMatch.border",{dark:"#888",light:"#B9B9B9",hcDark:Vn,hcLight:Vn},I("editorBracketMatchBorder","Color for matching brackets boxes"));const Tb=P("editorOverviewRuler.border",{dark:"#7f7f7f4d",light:"#7f7f7f4d",hcDark:"#7f7f7f4d",hcLight:"#666666"},I("editorOverviewRulerBorder","Color of the overview ruler border.")),Eb=P("editorOverviewRuler.background",null,I("editorOverviewRulerBackground","Background color of the editor overview ruler."));P("editorGutter.background",ou,I("editorGutter","Background color of the editor gutter. The gutter contains the glyph margins and the line numbers."));P("editorUnnecessaryCode.border",{dark:null,light:null,hcDark:le.fromHex("#fff").transparent(.8),hcLight:Vn},I("unnecessaryCodeBorder","Border color of unnecessary (unused) source code in the editor."));const Mb=P("editorUnnecessaryCode.opacity",{dark:le.fromHex("#000a"),light:le.fromHex("#0007"),hcDark:null,hcLight:null},I("unnecessaryCodeOpacity",`Opacity of unnecessary (unused) source code in the editor. For example, "#000000c0" will render the code with 75% opacity. For high contrast themes, use the  'editorUnnecessaryCode.border' theme color to underline unnecessary code instead of fading it out.`));P("editorGhostText.border",{dark:null,light:null,hcDark:le.fromHex("#fff").transparent(.8),hcLight:le.fromHex("#292929").transparent(.8)},I("editorGhostTextBorder","Border color of ghost text in the editor."));P("editorGhostText.foreground",{dark:le.fromHex("#ffffff56"),light:le.fromHex("#0007"),hcDark:null,hcLight:null},I("editorGhostTextForeground","Foreground color of the ghost text in the editor."));P("editorGhostText.background",null,I("editorGhostTextBackground","Background color of the ghost text in the editor."));const Rb=new le(new yn(0,122,204,.6));P("editorOverviewRuler.rangeHighlightForeground",Rb,I("overviewRulerRangeHighlight","Overview ruler marker color for range highlights. The color must not be opaque so as not to hide underlying decorations."),!0);const Ey=P("editorOverviewRuler.errorForeground",{dark:new le(new yn(255,18,18,.7)),light:new le(new yn(255,18,18,.7)),hcDark:new le(new yn(255,50,50,1)),hcLight:"#B5200D"},I("overviewRuleError","Overview ruler marker color for errors.")),My=P("editorOverviewRuler.warningForeground",{dark:Oo,light:Oo,hcDark:Hh,hcLight:Hh},I("overviewRuleWarning","Overview ruler marker color for warnings.")),Ry=P("editorOverviewRuler.infoForeground",{dark:Ma,light:Ma,hcDark:zh,hcLight:zh},I("overviewRuleInfo","Overview ruler marker color for infos.")),Wu=P("editorBracketHighlight.foreground1",{dark:"#FFD700",light:"#0431FAFF",hcDark:"#FFD700",hcLight:"#0431FAFF"},I("editorBracketHighlightForeground1","Foreground color of brackets (1). Requires enabling bracket pair colorization.")),Vu=P("editorBracketHighlight.foreground2",{dark:"#DA70D6",light:"#319331FF",hcDark:"#DA70D6",hcLight:"#319331FF"},I("editorBracketHighlightForeground2","Foreground color of brackets (2). Requires enabling bracket pair colorization.")),Hu=P("editorBracketHighlight.foreground3",{dark:"#179FFF",light:"#7B3814FF",hcDark:"#87CEFA",hcLight:"#7B3814FF"},I("editorBracketHighlightForeground3","Foreground color of brackets (3). Requires enabling bracket pair colorization.")),zu=P("editorBracketHighlight.foreground4","#00000000",I("editorBracketHighlightForeground4","Foreground color of brackets (4). Requires enabling bracket pair colorization.")),Uu=P("editorBracketHighlight.foreground5","#00000000",I("editorBracketHighlightForeground5","Foreground color of brackets (5). Requires enabling bracket pair colorization.")),ju=P("editorBracketHighlight.foreground6","#00000000",I("editorBracketHighlightForeground6","Foreground color of brackets (6). Requires enabling bracket pair colorization.")),Ab=P("editorBracketHighlight.unexpectedBracket.foreground",{dark:new le(new yn(255,18,18,.8)),light:new le(new yn(255,18,18,.8)),hcDark:"new Color(new RGBA(255, 50, 50, 1))",hcLight:"#B5200D"},I("editorBracketHighlightUnexpectedBracketForeground","Foreground color of unexpected brackets.")),Ob=P("editorBracketPairGuide.background1","#00000000",I("editorBracketPairGuide.background1","Background color of inactive bracket pair guides (1). Requires enabling bracket pair guides.")),Pb=P("editorBracketPairGuide.background2","#00000000",I("editorBracketPairGuide.background2","Background color of inactive bracket pair guides (2). Requires enabling bracket pair guides.")),Bb=P("editorBracketPairGuide.background3","#00000000",I("editorBracketPairGuide.background3","Background color of inactive bracket pair guides (3). Requires enabling bracket pair guides.")),Fb=P("editorBracketPairGuide.background4","#00000000",I("editorBracketPairGuide.background4","Background color of inactive bracket pair guides (4). Requires enabling bracket pair guides.")),Wb=P("editorBracketPairGuide.background5","#00000000",I("editorBracketPairGuide.background5","Background color of inactive bracket pair guides (5). Requires enabling bracket pair guides.")),Vb=P("editorBracketPairGuide.background6","#00000000",I("editorBracketPairGuide.background6","Background color of inactive bracket pair guides (6). Requires enabling bracket pair guides.")),Hb=P("editorBracketPairGuide.activeBackground1","#00000000",I("editorBracketPairGuide.activeBackground1","Background color of active bracket pair guides (1). Requires enabling bracket pair guides.")),zb=P("editorBracketPairGuide.activeBackground2","#00000000",I("editorBracketPairGuide.activeBackground2","Background color of active bracket pair guides (2). Requires enabling bracket pair guides.")),Ub=P("editorBracketPairGuide.activeBackground3","#00000000",I("editorBracketPairGuide.activeBackground3","Background color of active bracket pair guides (3). Requires enabling bracket pair guides.")),jb=P("editorBracketPairGuide.activeBackground4","#00000000",I("editorBracketPairGuide.activeBackground4","Background color of active bracket pair guides (4). Requires enabling bracket pair guides.")),$b=P("editorBracketPairGuide.activeBackground5","#00000000",I("editorBracketPairGuide.activeBackground5","Background color of active bracket pair guides (5). Requires enabling bracket pair guides.")),Gb=P("editorBracketPairGuide.activeBackground6","#00000000",I("editorBracketPairGuide.activeBackground6","Background color of active bracket pair guides (6). Requires enabling bracket pair guides."));P("editorUnicodeHighlight.border",Oo,I("editorUnicodeHighlight.border","Border color used to highlight unicode characters."));P("editorUnicodeHighlight.background",Mp,I("editorUnicodeHighlight.background","Background color used to highlight unicode characters."));di((a,e)=>{const t=a.getColor(ou),i=a.getColor(Pu),n=i&&!i.isTransparent()?i:t;n&&e.addRule(`.monaco-editor .inputarea.ime-input { background-color: ${n}; }`)});const Kb=ot("markerDecorationsService");class Ce{static _nextVisibleColumn(e,t,i){return e===9?Ce.nextRenderTabStop(t,i):ri(e)||Yg(e)?t+2:t+1}static visibleColumnFromColumn(e,t,i){const n=Math.min(t-1,e.length),s=e.substring(0,n),o=new Nh(s);let r=0;for(;!o.eol();){const l=Sa(s,n,o.offset);o.nextGraphemeLength(),r=this._nextVisibleColumn(l,r,i)}return r}static columnFromVisibleColumn(e,t,i){if(t<=0)return 1;const n=e.length,s=new Nh(e);let o=0,r=1;for(;!s.eol();){const l=Sa(e,n,s.offset);s.nextGraphemeLength();const h=this._nextVisibleColumn(l,o,i),c=s.offset+1;if(h>=t){const d=t-o;return h-t<d?c:r}o=h,r=c}return n+1}static nextRenderTabStop(e,t){return e+t-e%t}static nextIndentTabStop(e,t){return e+t-e%t}static prevRenderTabStop(e,t){return Math.max(0,e-1-(e-1)%t)}static prevIndentTabStop(e,t){return Math.max(0,e-1-(e-1)%t)}}function qb(a,e,t){let i=0;for(let s=0;s<a.length;s++)a.charAt(s)==="	"?i=Ce.nextIndentTabStop(i,e):i++;let n="";if(!t){const s=Math.floor(i/e);i=i%e;for(let o=0;o<s;o++)n+="	"}for(let s=0;s<i;s++)n+=" ";return n}function $u(a,e,t){let i=Je(a);return i===-1&&(i=a.length),qb(a.substring(0,i),e,t)+a.substring(i)}class _c{constructor(e,t,i,n){this.range=e,this.nestingLevel=t,this.nestingLevelOfEqualBracketType=i,this.isInvalid=n}}class Zb{constructor(e,t,i,n,s,o){this.range=e,this.openingBracketRange=t,this.closingBracketRange=i,this.nestingLevel=n,this.nestingLevelOfEqualBracketType=s,this.bracketPairNode=o}get openingBracketInfo(){return this.bracketPairNode.openingBracket.bracketInfo}}class Qb extends Zb{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o),this.minVisibleColumnIndentation=r}}function Yb(a,e,t,i){return a!==t?ge(t-a,i):ge(0,i-e)}const Ue=0;function zo(a){return a===0}const Xe=2**26;function ge(a,e){return a*Xe+e}function nt(a){const e=a,t=Math.floor(e/Xe),i=e-t*Xe;return new Ha(t,i)}function Xb(a){return Math.floor(a/Xe)}function me(a,e){let t=a+e;return e>=Xe&&(t=t-a%Xe),t}function Jb(a,e){return a.reduce((t,i)=>me(t,e(i)),Ue)}function Gu(a,e){return a===e}function As(a,e){const t=a,i=e;if(i-t<=0)return Ue;const s=Math.floor(t/Xe),o=Math.floor(i/Xe),r=i-o*Xe;if(s===o){const l=t-s*Xe;return ge(0,r-l)}else return ge(o-s,r)}function Tn(a,e){return a<e}function En(a,e){return a<=e}function as(a,e){return a>=e}function gn(a){return ge(a.lineNumber-1,a.column-1)}function Bi(a,e){const t=a,i=Math.floor(t/Xe),n=t-i*Xe,s=e,o=Math.floor(s/Xe),r=s-o*Xe;return new v(i+1,n+1,o+1,r+1)}function ew(a){const e=Vd(a);return ge(e.length-1,e[e.length-1].length)}class Os{static fromModelContentChanges(e){return e.map(i=>{const n=v.lift(i.range);return new Os(gn(n.getStartPosition()),gn(n.getEndPosition()),ew(i.text))}).reverse()}constructor(e,t,i){this.startOffset=e,this.endOffset=t,this.newLength=i}toString(){return`[${nt(this.startOffset)}...${nt(this.endOffset)}) -> ${nt(this.newLength)}`}}class tw{constructor(e){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=e.map(t=>Kl.from(t))}getOffsetBeforeChange(e){return this.adjustNextEdit(e),this.translateCurToOld(e)}getDistanceToNextChange(e){this.adjustNextEdit(e);const t=this.edits[this.nextEditIdx],i=t?this.translateOldToCur(t.offsetObj):null;return i===null?null:As(e,i)}translateOldToCur(e){return e.lineCount===this.deltaLineIdxInOld?ge(e.lineCount+this.deltaOldToNewLineCount,e.columnCount+this.deltaOldToNewColumnCount):ge(e.lineCount+this.deltaOldToNewLineCount,e.columnCount)}translateCurToOld(e){const t=nt(e);return t.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?ge(t.lineCount-this.deltaOldToNewLineCount,t.columnCount-this.deltaOldToNewColumnCount):ge(t.lineCount-this.deltaOldToNewLineCount,t.columnCount)}adjustNextEdit(e){for(;this.nextEditIdx<this.edits.length;){const t=this.edits[this.nextEditIdx],i=this.translateOldToCur(t.endOffsetAfterObj);if(En(i,e)){this.nextEditIdx++;const n=nt(i),s=nt(this.translateOldToCur(t.endOffsetBeforeObj)),o=n.lineCount-s.lineCount;this.deltaOldToNewLineCount+=o;const r=this.deltaLineIdxInOld===t.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,l=n.columnCount-s.columnCount;this.deltaOldToNewColumnCount=r+l,this.deltaLineIdxInOld=t.endOffsetBeforeObj.lineCount}else break}}}class Kl{static from(e){return new Kl(e.startOffset,e.endOffset,e.newLength)}constructor(e,t,i){this.endOffsetBeforeObj=nt(t),this.endOffsetAfterObj=nt(me(e,i)),this.offsetObj=nt(e)}}const co=[],tt=class tt{static create(e,t){if(e<=128&&t.length===0){let i=tt.cache[e];return i||(i=new tt(e,t),tt.cache[e]=i),i}return new tt(e,t)}static getEmpty(){return this.empty}constructor(e,t){this.items=e,this.additionalItems=t}add(e,t){const i=t.getKey(e);let n=i>>5;if(n===0){const o=1<<i|this.items;return o===this.items?this:tt.create(o,this.additionalItems)}n--;const s=this.additionalItems.slice(0);for(;s.length<n;)s.push(0);return s[n]|=1<<(i&31),tt.create(this.items,s)}merge(e){const t=this.items|e.items;if(this.additionalItems===co&&e.additionalItems===co)return t===this.items?this:t===e.items?e:tt.create(t,co);const i=[];for(let n=0;n<Math.max(this.additionalItems.length,e.additionalItems.length);n++){const s=this.additionalItems[n]||0,o=e.additionalItems[n]||0;i.push(s|o)}return tt.create(t,i)}intersects(e){if(this.items&e.items)return!0;for(let t=0;t<Math.min(this.additionalItems.length,e.additionalItems.length);t++)if(this.additionalItems[t]&e.additionalItems[t])return!0;return!1}};tt.cache=new Array(129),tt.empty=tt.create(0,co);let Ge=tt;const Cc={getKey(a){return a}};class iw{constructor(){this.items=new Map}getKey(e){let t=this.items.get(e);return t===void 0&&(t=this.items.size,this.items.set(e,t)),t}}class ql{get length(){return this._length}constructor(e){this._length=e}}class Ps extends ql{static create(e,t,i){let n=e.length;return t&&(n=me(n,t.length)),i&&(n=me(n,i.length)),new Ps(n,e,t,i,t?t.missingOpeningBracketIds:Ge.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(e){switch(e){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const e=[];return e.push(this.openingBracket),this.child&&e.push(this.child),this.closingBracket&&e.push(this.closingBracket),e}constructor(e,t,i,n,s){super(e),this.openingBracket=t,this.child=i,this.closingBracket=n,this.missingOpeningBracketIds=s}canBeReused(e){return!(this.closingBracket===null||e.intersects(this.missingOpeningBracketIds))}deepClone(){return new Ps(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(e,t){return this.child?this.child.computeMinIndentation(me(e,this.openingBracket.length),t):Number.MAX_SAFE_INTEGER}}class kt extends ql{static create23(e,t,i,n=!1){let s=e.length,o=e.missingOpeningBracketIds;if(e.listHeight!==t.listHeight)throw new Error("Invalid list heights");if(s=me(s,t.length),o=o.merge(t.missingOpeningBracketIds),i){if(e.listHeight!==i.listHeight)throw new Error("Invalid list heights");s=me(s,i.length),o=o.merge(i.missingOpeningBracketIds)}return n?new nw(s,e.listHeight+1,e,t,i,o):new Bs(s,e.listHeight+1,e,t,i,o)}static getEmpty(){return new sw(Ue,0,[],Ge.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(e,t,i){super(e),this.listHeight=t,this._missingOpeningBracketIds=i,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const e=this.childrenLength;if(e===0)return;const t=this.getChild(e-1),i=t.kind===4?t.toMutable():t;return t!==i&&this.setChild(e-1,i),i}makeFirstElementMutable(){if(this.throwIfImmutable(),this.childrenLength===0)return;const t=this.getChild(0),i=t.kind===4?t.toMutable():t;return t!==i&&this.setChild(0,i),i}canBeReused(e){if(e.intersects(this.missingOpeningBracketIds)||this.childrenLength===0)return!1;let t=this;for(;t.kind===4;){const i=t.childrenLength;if(i===0)throw new fe;t=t.getChild(i-1)}return t.canBeReused(e)}handleChildrenChanged(){this.throwIfImmutable();const e=this.childrenLength;let t=this.getChild(0).length,i=this.getChild(0).missingOpeningBracketIds;for(let n=1;n<e;n++){const s=this.getChild(n);t=me(t,s.length),i=i.merge(s.missingOpeningBracketIds)}this._length=t,this._missingOpeningBracketIds=i,this.cachedMinIndentation=-1}computeMinIndentation(e,t){if(this.cachedMinIndentation!==-1)return this.cachedMinIndentation;let i=Number.MAX_SAFE_INTEGER,n=e;for(let s=0;s<this.childrenLength;s++){const o=this.getChild(s);o&&(i=Math.min(i,o.computeMinIndentation(n,t)),n=me(n,o.length))}return this.cachedMinIndentation=i,i}}class Bs extends kt{get childrenLength(){return this._item3!==null?3:2}getChild(e){switch(e){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(e,t){switch(e){case 0:this._item1=t;return;case 1:this._item2=t;return;case 2:this._item3=t;return}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(e,t,i,n,s,o){super(e,t,o),this._item1=i,this._item2=n,this._item3=s}deepClone(){return new Bs(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(e){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=e,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const e=this._item3;return this._item3=null,this.handleChildrenChanged(),e}prependChildOfSameHeight(e){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=e,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const e=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),e}toMutable(){return this}}class nw extends Bs{toMutable(){return new Bs(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class Uo extends kt{get childrenLength(){return this._children.length}getChild(e){return this._children[e]}setChild(e,t){this._children[e]=t}get children(){return this._children}constructor(e,t,i,n){super(e,t,n),this._children=i}deepClone(){const e=new Array(this._children.length);for(let t=0;t<this._children.length;t++)e[t]=this._children[t].deepClone();return new Uo(this.length,this.listHeight,e,this.missingOpeningBracketIds)}appendChildOfSameHeight(e){this.throwIfImmutable(),this._children.push(e),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const e=this._children.pop();return this.handleChildrenChanged(),e}prependChildOfSameHeight(e){this.throwIfImmutable(),this._children.unshift(e),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const e=this._children.shift();return this.handleChildrenChanged(),e}toMutable(){return this}}class sw extends Uo{toMutable(){return new Uo(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const ow=[];class Zl extends ql{get listHeight(){return 0}get childrenLength(){return 0}getChild(e){return null}get children(){return ow}deepClone(){return this}}class xi extends Zl{get kind(){return 0}get missingOpeningBracketIds(){return Ge.getEmpty()}canBeReused(e){return!0}computeMinIndentation(e,t){const i=nt(e),n=(i.columnCount===0?i.lineCount:i.lineCount+1)+1,s=Xb(me(e,this.length))+1;let o=Number.MAX_SAFE_INTEGER;for(let r=n;r<=s;r++){const l=t.getLineFirstNonWhitespaceColumn(r),h=t.getLineContent(r);if(l===0)continue;const c=Ce.visibleColumnFromColumn(h,l,t.getOptions().tabSize);o=Math.min(o,c)}return o}}class jo extends Zl{static create(e,t,i){return new jo(e,t,i)}get kind(){return 1}get missingOpeningBracketIds(){return Ge.getEmpty()}constructor(e,t,i){super(e),this.bracketInfo=t,this.bracketIds=i}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(e){return!1}computeMinIndentation(e,t){return Number.MAX_SAFE_INTEGER}}class rw extends Zl{get kind(){return 3}constructor(e,t){super(t),this.missingOpeningBracketIds=e}canBeReused(e){return!e.intersects(this.missingOpeningBracketIds)}computeMinIndentation(e,t){return Number.MAX_SAFE_INTEGER}}class Xt{constructor(e,t,i,n,s){this.length=e,this.kind=t,this.bracketId=i,this.bracketIds=n,this.astNode=s}}class aw{constructor(e,t){this.textModel=e,this.bracketTokens=t,this.reader=new lw(this.textModel,this.bracketTokens),this._offset=Ue,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=e.getLineCount(),this.textBufferLastLineLength=e.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return ge(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(e){this.didPeek=!1,this._offset=me(this._offset,e);const t=nt(this._offset);this.reader.setPosition(t.lineCount,t.columnCount)}read(){let e;return this.peeked?(this.didPeek=!1,e=this.peeked):e=this.reader.read(),e&&(this._offset=me(this._offset,e.length)),e}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class lw{constructor(e,t){this.textModel=e,this.bracketTokens=t,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=e.getLineCount(),this.textBufferLastLineLength=e.getLineLength(this.textBufferLineCount)}setPosition(e,t){e===this.lineIdx?(this.lineCharOffset=t,this.line!==null&&(this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=e,this.lineCharOffset=t,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const s=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=s.length,s}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;this.line===null&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const e=this.lineIdx,t=this.lineCharOffset;let i=0;for(;;){const s=this.lineTokens,o=s.getCount();let r=null;if(this.lineTokenOffset<o){const l=s.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<o&&l===s.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const h=Ra.getTokenType(l)===0,c=Ra.containsBalancedBrackets(l),d=s.getEndOffset(this.lineTokenOffset);if(c&&h&&this.lineCharOffset<d){const u=s.getLanguageId(this.lineTokenOffset),g=this.line.substring(this.lineCharOffset,d),f=this.bracketTokens.getSingleLanguageBracketTokens(u),m=f.regExpGlobal;if(m){m.lastIndex=0;const _=m.exec(g);_&&(r=f.getToken(_[0]),r&&(this.lineCharOffset+=_.index))}}if(i+=d-this.lineCharOffset,r)if(e!==this.lineIdx||t!==this.lineCharOffset){this.peekedToken=r;break}else return this.lineCharOffset+=r.length,r;else this.lineTokenOffset++,this.lineCharOffset=d}else if(this.lineIdx===this.textBufferLineCount-1||(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,i+=33,i>1e3))break;if(i>1500)break}const n=Yb(e,t,this.lineIdx,this.lineCharOffset);return new Xt(n,0,-1,Ge.getEmpty(),new xi(n))}}class hw{constructor(e,t){this.text=e,this._offset=Ue,this.idx=0;const i=t.getRegExpStr(),n=i?new RegExp(i+`|
`,"gi"):null,s=[];let o,r=0,l=0,h=0,c=0;const d=[];for(let f=0;f<60;f++)d.push(new Xt(ge(0,f),0,-1,Ge.getEmpty(),new xi(ge(0,f))));const u=[];for(let f=0;f<60;f++)u.push(new Xt(ge(1,f),0,-1,Ge.getEmpty(),new xi(ge(1,f))));if(n)for(n.lastIndex=0;(o=n.exec(e))!==null;){const f=o.index,m=o[0];if(m===`
`)r++,l=f+1;else{if(h!==f){let _;if(c===r){const C=f-h;if(C<d.length)_=d[C];else{const p=ge(0,C);_=new Xt(p,0,-1,Ge.getEmpty(),new xi(p))}}else{const C=r-c,p=f-l;if(C===1&&p<u.length)_=u[p];else{const b=ge(C,p);_=new Xt(b,0,-1,Ge.getEmpty(),new xi(b))}}s.push(_)}s.push(t.getToken(m)),h=f+m.length,c=r}}const g=e.length;if(h!==g){const f=c===r?ge(0,g-h):ge(r-c,g-l);s.push(new Xt(f,0,-1,Ge.getEmpty(),new xi(f)))}this.length=ge(r,g-l),this.tokens=s}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(e){throw new Xg}}class Ql{static createFromLanguage(e,t){function i(s){return t.getKey(`${s.languageId}:::${s.bracketText}`)}const n=new Map;for(const s of e.bracketsNew.openingBrackets){const o=ge(0,s.bracketText.length),r=i(s),l=Ge.getEmpty().add(r,Cc);n.set(s.bracketText,new Xt(o,1,r,l,jo.create(o,s,l)))}for(const s of e.bracketsNew.closingBrackets){const o=ge(0,s.bracketText.length);let r=Ge.getEmpty();const l=s.getOpeningBrackets();for(const h of l)r=r.add(i(h),Cc);n.set(s.bracketText,new Xt(o,2,i(l[0]),r,jo.create(o,s,r)))}return new Ql(n)}constructor(e){this.map=e,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const e=[...this.map.keys()];return e.sort(),e.reverse(),e.map(t=>cw(t)).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const e=this.getRegExpStr();this._regExpGlobal=e?new RegExp(e,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(e){return this.map.get(e.toLowerCase())}findClosingTokenText(e){for(const[t,i]of this.map)if(i.kind===2&&i.bracketIds.intersects(e))return t}get isEmpty(){return this.map.size===0}}function cw(a){let e=Eo(a);return/^[\w ]+/.test(a)&&(e=`\\b${e}`),/[\w ]+$/.test(a)&&(e=`${e}\\b`),e}class dw{constructor(e,t){this.denseKeyProvider=e,this.getLanguageConfiguration=t,this.languageIdToBracketTokens=new Map}didLanguageChange(e){return this.languageIdToBracketTokens.has(e)}getSingleLanguageBracketTokens(e){let t=this.languageIdToBracketTokens.get(e);return t||(t=Ql.createFromLanguage(this.getLanguageConfiguration(e),this.denseKeyProvider),this.languageIdToBracketTokens.set(e,t)),t}}function uw(a){if(a.length===0)return null;if(a.length===1)return a[0];let e=0;function t(){if(e>=a.length)return null;const o=e,r=a[o].listHeight;for(e++;e<a.length&&a[e].listHeight===r;)e++;return e-o>=2?Ku(o===0&&e===a.length?a:a.slice(o,e),!1):a[o]}let i=t(),n=t();if(!n)return i;for(let o=t();o;o=t())bc(i,n)<=bc(n,o)?(i=ta(i,n),n=o):n=ta(n,o);return ta(i,n)}function Ku(a,e=!1){if(a.length===0)return null;if(a.length===1)return a[0];let t=a.length;for(;t>3;){const i=t>>1;for(let n=0;n<i;n++){const s=n<<1;a[n]=kt.create23(a[s],a[s+1],s+3===t?a[s+2]:null,e)}t=i}return kt.create23(a[0],a[1],t>=3?a[2]:null,e)}function bc(a,e){return Math.abs(a.listHeight-e.listHeight)}function ta(a,e){return a.listHeight===e.listHeight?kt.create23(a,e,null,!1):a.listHeight>e.listHeight?gw(a,e):fw(e,a)}function gw(a,e){a=a.toMutable();let t=a;const i=[];let n;for(;;){if(e.listHeight===t.listHeight){n=e;break}if(t.kind!==4)throw new Error("unexpected");i.push(t),t=t.makeLastElementMutable()}for(let s=i.length-1;s>=0;s--){const o=i[s];n?o.childrenLength>=3?n=kt.create23(o.unappendChild(),n,null,!1):(o.appendChildOfSameHeight(n),n=void 0):o.handleChildrenChanged()}return n?kt.create23(a,n,null,!1):a}function fw(a,e){a=a.toMutable();let t=a;const i=[];for(;e.listHeight!==t.listHeight;){if(t.kind!==4)throw new Error("unexpected");i.push(t),t=t.makeFirstElementMutable()}let n=e;for(let s=i.length-1;s>=0;s--){const o=i[s];n?o.childrenLength>=3?n=kt.create23(n,o.unprependChild(),null,!1):(o.prependChildOfSameHeight(n),n=void 0):o.handleChildrenChanged()}return n?kt.create23(n,a,null,!1):a}class mw{constructor(e){this.lastOffset=Ue,this.nextNodes=[e],this.offsets=[Ue],this.idxs=[]}readLongestNodeAt(e,t){if(Tn(e,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=e;;){const i=Jn(this.nextNodes);if(!i)return;const n=Jn(this.offsets);if(Tn(e,n))return;if(Tn(n,e))if(me(n,i.length)<=e)this.nextNodeAfterCurrent();else{const s=ia(i);s!==-1?(this.nextNodes.push(i.getChild(s)),this.offsets.push(n),this.idxs.push(s)):this.nextNodeAfterCurrent()}else{if(t(i))return this.nextNodeAfterCurrent(),i;{const s=ia(i);if(s===-1){this.nextNodeAfterCurrent();return}else this.nextNodes.push(i.getChild(s)),this.offsets.push(n),this.idxs.push(s)}}}}nextNodeAfterCurrent(){for(;;){const e=Jn(this.offsets),t=Jn(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),this.idxs.length===0)break;const i=Jn(this.nextNodes),n=ia(i,this.idxs[this.idxs.length-1]);if(n!==-1){this.nextNodes.push(i.getChild(n)),this.offsets.push(me(e,t.length)),this.idxs[this.idxs.length-1]=n;break}else this.idxs.pop()}}}function ia(a,e=-1){for(;;){if(e++,e>=a.childrenLength)return-1;if(a.getChild(e))return e}}function Jn(a){return a.length>0?a[a.length-1]:void 0}function wc(a,e,t,i){return new pw(a,e,t,i).parseDocument()}class pw{constructor(e,t,i,n){if(this.tokenizer=e,this.createImmutableLists=n,this._itemsConstructed=0,this._itemsFromCache=0,i&&n)throw new Error("Not supported");this.oldNodeReader=i?new mw(i):void 0,this.positionMapper=new tw(t)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let e=this.parseList(Ge.getEmpty(),0);return e||(e=kt.getEmpty()),e}parseList(e,t){const i=[];for(;;){let s=this.tryReadChildFromCache(e);if(!s){const o=this.tokenizer.peek();if(!o||o.kind===2&&o.bracketIds.intersects(e))break;s=this.parseChild(e,t+1)}s.kind===4&&s.childrenLength===0||i.push(s)}return this.oldNodeReader?uw(i):Ku(i,this.createImmutableLists)}tryReadChildFromCache(e){if(this.oldNodeReader){const t=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(t===null||!zo(t)){const i=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),n=>t!==null&&!Tn(n.length,t)?!1:n.canBeReused(e));if(i)return this._itemsFromCache++,this.tokenizer.skip(i.length),i}}}parseChild(e,t){this._itemsConstructed++;const i=this.tokenizer.read();switch(i.kind){case 2:return new rw(i.bracketIds,i.length);case 0:return i.astNode;case 1:{if(t>300)return new xi(i.length);const n=e.merge(i.bracketIds),s=this.parseList(n,t+1),o=this.tokenizer.peek();return o&&o.kind===2&&(o.bracketId===i.bracketId||o.bracketIds.intersects(i.bracketIds))?(this.tokenizer.read(),Ps.create(i.astNode,s,o.astNode)):Ps.create(i.astNode,s,null)}default:throw new Error("unexpected")}}}function Lc(a,e){if(a.length===0)return e;if(e.length===0)return a;const t=new ji(vc(a)),i=vc(e);i.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let n=t.dequeue();function s(h){if(h===void 0){const d=t.takeWhile(u=>!0)||[];return n&&d.unshift(n),d}const c=[];for(;n&&!zo(h);){const[d,u]=n.splitAt(h);c.push(d),h=As(d.lengthAfter,h),n=u??t.dequeue()}return zo(h)||c.push(new ei(!1,h,h)),c}const o=[];function r(h,c,d){if(o.length>0&&Gu(o[o.length-1].endOffset,h)){const u=o[o.length-1];o[o.length-1]=new Os(u.startOffset,c,me(u.newLength,d))}else o.push({startOffset:h,endOffset:c,newLength:d})}let l=Ue;for(const h of i){const c=s(h.lengthBefore);if(h.modified){const d=Jb(c,g=>g.lengthBefore),u=me(l,d);r(l,u,h.lengthAfter),l=u}else for(const d of c){const u=l;l=me(l,d.lengthBefore),d.modified&&r(u,l,d.lengthAfter)}}return o}class ei{constructor(e,t,i){this.modified=e,this.lengthBefore=t,this.lengthAfter=i}splitAt(e){const t=As(e,this.lengthAfter);return Gu(t,Ue)?[this,void 0]:this.modified?[new ei(this.modified,this.lengthBefore,e),new ei(this.modified,Ue,t)]:[new ei(this.modified,e,e),new ei(this.modified,t,t)]}toString(){return`${this.modified?"M":"U"}:${nt(this.lengthBefore)} -> ${nt(this.lengthAfter)}`}}function vc(a){const e=[];let t=Ue;for(const i of a){const n=As(t,i.startOffset);zo(n)||e.push(new ei(!1,n,n));const s=As(i.startOffset,i.endOffset);e.push(new ei(!0,s,i.newLength)),t=i.endOffset}return e}class _w extends H{didLanguageChange(e){return this.brackets.didLanguageChange(e)}constructor(e,t){if(super(),this.textModel=e,this.getLanguageConfiguration=t,this.didChangeEmitter=new M,this.denseKeyProvider=new iw,this.brackets=new dw(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],e.tokenization.hasTokens)e.tokenization.backgroundTokenizationState===2?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const i=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),n=new hw(this.textModel.getValue(),i);this.initialAstWithoutTokens=wc(n,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(this.textModel.tokenization.backgroundTokenizationState===2){const e=this.initialAstWithoutTokens===void 0;this.initialAstWithoutTokens=void 0,e||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:e}){const t=e.map(i=>new Os(ge(i.fromLineNumber-1,0),ge(i.toLineNumber,0),ge(i.toLineNumber-i.fromLineNumber+1,0)));this.handleEdits(t,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(e){const t=Os.fromModelContentChanges(e.changes);this.handleEdits(t,!1)}handleEdits(e,t){const i=Lc(this.queuedTextEdits,e);this.queuedTextEdits=i,this.initialAstWithoutTokens&&!t&&(this.queuedTextEditsForInitialAstWithoutTokens=Lc(this.queuedTextEditsForInitialAstWithoutTokens,e))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(e,t,i){const n=t,s=new aw(this.textModel,this.brackets);return wc(s,e,n,i)}getBracketsInRange(e,t){this.flushQueue();const i=ge(e.startLineNumber-1,e.startColumn-1),n=ge(e.endLineNumber-1,e.endColumn-1);return new cs(s=>{const o=this.initialAstWithoutTokens||this.astWithTokens;Ja(o,Ue,o.length,i,n,s,0,0,new Map,t)})}getBracketPairsInRange(e,t){this.flushQueue();const i=gn(e.getStartPosition()),n=gn(e.getEndPosition());return new cs(s=>{const o=this.initialAstWithoutTokens||this.astWithTokens,r=new Cw(s,t,this.textModel);el(o,Ue,o.length,i,n,r,0,new Map)})}getFirstBracketAfter(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return Zu(t,Ue,t.length,gn(e))}getFirstBracketBefore(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return qu(t,Ue,t.length,gn(e))}}function qu(a,e,t,i){if(a.kind===4||a.kind===2){const n=[];for(const s of a.children)t=me(e,s.length),n.push({nodeOffsetStart:e,nodeOffsetEnd:t}),e=t;for(let s=n.length-1;s>=0;s--){const{nodeOffsetStart:o,nodeOffsetEnd:r}=n[s];if(Tn(o,i)){const l=qu(a.children[s],o,r,i);if(l)return l}}return null}else{if(a.kind===3)return null;if(a.kind===1){const n=Bi(e,t);return{bracketInfo:a.bracketInfo,range:n}}}return null}function Zu(a,e,t,i){if(a.kind===4||a.kind===2){for(const n of a.children){if(t=me(e,n.length),Tn(i,t)){const s=Zu(n,e,t,i);if(s)return s}e=t}return null}else{if(a.kind===3)return null;if(a.kind===1){const n=Bi(e,t);return{bracketInfo:a.bracketInfo,range:n}}}return null}function Ja(a,e,t,i,n,s,o,r,l,h,c=!1){if(o>200)return!0;e:for(;;)switch(a.kind){case 4:{const d=a.childrenLength;for(let u=0;u<d;u++){const g=a.getChild(u);if(g){if(t=me(e,g.length),En(e,n)&&as(t,i)){if(as(t,n)){a=g;continue e}if(!Ja(g,e,t,i,n,s,o,0,l,h))return!1}e=t}}return!0}case 2:{const d=!h||!a.closingBracket||a.closingBracket.bracketInfo.closesColorized(a.openingBracket.bracketInfo);let u=0;if(l){let f=l.get(a.openingBracket.text);f===void 0&&(f=0),u=f,d&&(f++,l.set(a.openingBracket.text,f))}const g=a.childrenLength;for(let f=0;f<g;f++){const m=a.getChild(f);if(m){if(t=me(e,m.length),En(e,n)&&as(t,i)){if(as(t,n)&&m.kind!==1){a=m,d?(o++,r=u+1):r=u;continue e}if((d||m.kind!==1||!a.closingBracket)&&!Ja(m,e,t,i,n,s,d?o+1:o,d?u+1:u,l,h,!a.closingBracket))return!1}e=t}}return l==null||l.set(a.openingBracket.text,u),!0}case 3:{const d=Bi(e,t);return s(new _c(d,o-1,0,!0))}case 1:{const d=Bi(e,t);return s(new _c(d,o-1,r-1,c))}case 0:return!0}}class Cw{constructor(e,t,i){this.push=e,this.includeMinIndentation=t,this.textModel=i}}function el(a,e,t,i,n,s,o,r){var h;if(o>200)return!0;let l=!0;if(a.kind===2){let c=0;if(r){let g=r.get(a.openingBracket.text);g===void 0&&(g=0),c=g,g++,r.set(a.openingBracket.text,g)}const d=me(e,a.openingBracket.length);let u=-1;if(s.includeMinIndentation&&(u=a.computeMinIndentation(e,s.textModel)),l=s.push(new Qb(Bi(e,t),Bi(e,d),a.closingBracket?Bi(me(d,((h=a.child)==null?void 0:h.length)||Ue),t):void 0,o,c,a,u)),e=d,l&&a.child){const g=a.child;if(t=me(e,g.length),En(e,n)&&as(t,i)&&(l=el(g,e,t,i,n,s,o+1,r),!l))return!1}r==null||r.set(a.openingBracket.text,c)}else{let c=e;for(const d of a.children){const u=c;if(c=me(c,d.length),En(u,n)&&En(i,c)&&(l=el(d,u,c,i,n,s,o,r),!l))return!1}}return l}class bw extends H{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t,this.bracketPairsTree=this._register(new Ui),this.onDidChangeEmitter=new M,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1}handleLanguageConfigurationServiceChange(e){var t;(!e.languageId||(t=this.bracketPairsTree.value)!=null&&t.object.didLanguageChange(e.languageId))&&(this.bracketPairsTree.clear(),this.updateBracketPairsTree())}handleDidChangeOptions(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(e){var t;(t=this.bracketPairsTree.value)==null||t.object.handleContentChanged(e)}handleDidChangeBackgroundTokenizationState(){var e;(e=this.bracketPairsTree.value)==null||e.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(e){var t;(t=this.bracketPairsTree.value)==null||t.object.handleDidChangeTokens(e)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const e=new pe;this.bracketPairsTree.value=ww(e.add(new _w(this.textModel,t=>this.languageConfigurationService.getLanguageConfiguration(t))),e),e.add(this.bracketPairsTree.value.object.onDidChange(t=>this.onDidChangeEmitter.fire(t))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire())}getBracketPairsInRange(e){var t;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((t=this.bracketPairsTree.value)==null?void 0:t.object.getBracketPairsInRange(e,!1))||cs.empty}getBracketPairsInRangeWithMinIndentation(e){var t;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((t=this.bracketPairsTree.value)==null?void 0:t.object.getBracketPairsInRange(e,!0))||cs.empty}getBracketsInRange(e,t=!1){var i;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((i=this.bracketPairsTree.value)==null?void 0:i.object.getBracketsInRange(e,t))||cs.empty}findMatchingBracketUp(e,t,i){const n=this.textModel.validatePosition(t),s=this.textModel.getLanguageIdAtPosition(n.lineNumber,n.column);if(this.canBuildAST){const o=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew.getClosingBracketInfo(e);if(!o)return null;const r=this.getBracketPairsInRange(v.fromPositions(t,t)).findLast(l=>o.closes(l.openingBracketInfo));return r?r.openingBracketRange:null}else{const o=e.toLowerCase(),r=this.languageConfigurationService.getLanguageConfiguration(s).brackets;if(!r)return null;const l=r.textIsBracket[o];return l?uo(this._findMatchingBracketUp(l,n,na(i))):null}}matchBracket(e,t){if(this.canBuildAST){const i=this.getBracketPairsInRange(v.fromPositions(e,e)).filter(n=>n.closingBracketRange!==void 0&&(n.openingBracketRange.containsPosition(e)||n.closingBracketRange.containsPosition(e))).findLastMaxBy(vo(n=>n.openingBracketRange.containsPosition(e)?n.openingBracketRange:n.closingBracketRange,v.compareRangesUsingStarts));return i?[i.openingBracketRange,i.closingBracketRange]:null}else{const i=na(t);return this._matchBracket(this.textModel.validatePosition(e),i)}}_establishBracketSearchOffsets(e,t,i,n){const s=t.getCount(),o=t.getLanguageId(n);let r=Math.max(0,e.column-1-i.maxBracketLength);for(let h=n-1;h>=0;h--){const c=t.getEndOffset(h);if(c<=r)break;if(Ct(t.getStandardTokenType(h))||t.getLanguageId(h)!==o){r=c;break}}let l=Math.min(t.getLineContent().length,e.column-1+i.maxBracketLength);for(let h=n+1;h<s;h++){const c=t.getStartOffset(h);if(c>=l)break;if(Ct(t.getStandardTokenType(h))||t.getLanguageId(h)!==o){l=c;break}}return{searchStartOffset:r,searchEndOffset:l}}_matchBracket(e,t){const i=e.lineNumber,n=this.textModel.tokenization.getLineTokens(i),s=this.textModel.getLineContent(i),o=n.findTokenIndexAtOffset(e.column-1);if(o<0)return null;const r=this.languageConfigurationService.getLanguageConfiguration(n.getLanguageId(o)).brackets;if(r&&!Ct(n.getStandardTokenType(o))){let{searchStartOffset:l,searchEndOffset:h}=this._establishBracketSearchOffsets(e,n,r,o),c=null;for(;;){const d=rt.findNextBracketInRange(r.forwardRegex,i,s,l,h);if(!d)break;if(d.startColumn<=e.column&&e.column<=d.endColumn){const u=s.substring(d.startColumn-1,d.endColumn-1).toLowerCase(),g=this._matchFoundBracket(d,r.textIsBracket[u],r.textIsOpenBracket[u],t);if(g){if(g instanceof Wt)return null;c=g}}l=d.endColumn-1}if(c)return c}if(o>0&&n.getStartOffset(o)===e.column-1){const l=o-1,h=this.languageConfigurationService.getLanguageConfiguration(n.getLanguageId(l)).brackets;if(h&&!Ct(n.getStandardTokenType(l))){const{searchStartOffset:c,searchEndOffset:d}=this._establishBracketSearchOffsets(e,n,h,l),u=rt.findPrevBracketInRange(h.reversedRegex,i,s,c,d);if(u&&u.startColumn<=e.column&&e.column<=u.endColumn){const g=s.substring(u.startColumn-1,u.endColumn-1).toLowerCase(),f=this._matchFoundBracket(u,h.textIsBracket[g],h.textIsOpenBracket[g],t);if(f)return f instanceof Wt?null:f}}}return null}_matchFoundBracket(e,t,i,n){if(!t)return null;const s=i?this._findMatchingBracketDown(t,e.getEndPosition(),n):this._findMatchingBracketUp(t,e.getStartPosition(),n);return s?s instanceof Wt?s:[e,s]:null}_findMatchingBracketUp(e,t,i){const n=e.languageId,s=e.reversedRegex;let o=-1,r=0;const l=(h,c,d,u)=>{for(;;){if(i&&++r%100===0&&!i())return Wt.INSTANCE;const g=rt.findPrevBracketInRange(s,h,c,d,u);if(!g)break;const f=c.substring(g.startColumn-1,g.endColumn-1).toLowerCase();if(e.isOpen(f)?o++:e.isClose(f)&&o--,o===0)return g;u=g.startColumn-1}return null};for(let h=t.lineNumber;h>=1;h--){const c=this.textModel.tokenization.getLineTokens(h),d=c.getCount(),u=this.textModel.getLineContent(h);let g=d-1,f=u.length,m=u.length;h===t.lineNumber&&(g=c.findTokenIndexAtOffset(t.column-1),f=t.column-1,m=t.column-1);let _=!0;for(;g>=0;g--){const C=c.getLanguageId(g)===n&&!Ct(c.getStandardTokenType(g));if(C)_?f=c.getStartOffset(g):(f=c.getStartOffset(g),m=c.getEndOffset(g));else if(_&&f!==m){const p=l(h,u,f,m);if(p)return p}_=C}if(_&&f!==m){const C=l(h,u,f,m);if(C)return C}}return null}_findMatchingBracketDown(e,t,i){const n=e.languageId,s=e.forwardRegex;let o=1,r=0;const l=(c,d,u,g)=>{for(;;){if(i&&++r%100===0&&!i())return Wt.INSTANCE;const f=rt.findNextBracketInRange(s,c,d,u,g);if(!f)break;const m=d.substring(f.startColumn-1,f.endColumn-1).toLowerCase();if(e.isOpen(m)?o++:e.isClose(m)&&o--,o===0)return f;u=f.endColumn-1}return null},h=this.textModel.getLineCount();for(let c=t.lineNumber;c<=h;c++){const d=this.textModel.tokenization.getLineTokens(c),u=d.getCount(),g=this.textModel.getLineContent(c);let f=0,m=0,_=0;c===t.lineNumber&&(f=d.findTokenIndexAtOffset(t.column-1),m=t.column-1,_=t.column-1);let C=!0;for(;f<u;f++){const p=d.getLanguageId(f)===n&&!Ct(d.getStandardTokenType(f));if(p)C||(m=d.getStartOffset(f)),_=d.getEndOffset(f);else if(C&&m!==_){const b=l(c,g,m,_);if(b)return b}C=p}if(C&&m!==_){const p=l(c,g,m,_);if(p)return p}}return null}findPrevBracket(e){var o;const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((o=this.bracketPairsTree.value)==null?void 0:o.object.getFirstBracketBefore(t))||null;let i=null,n=null,s=null;for(let r=t.lineNumber;r>=1;r--){const l=this.textModel.tokenization.getLineTokens(r),h=l.getCount(),c=this.textModel.getLineContent(r);let d=h-1,u=c.length,g=c.length;if(r===t.lineNumber){d=l.findTokenIndexAtOffset(t.column-1),u=t.column-1,g=t.column-1;const m=l.getLanguageId(d);i!==m&&(i=m,n=this.languageConfigurationService.getLanguageConfiguration(i).brackets,s=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew)}let f=!0;for(;d>=0;d--){const m=l.getLanguageId(d);if(i!==m){if(n&&s&&f&&u!==g){const C=rt.findPrevBracketInRange(n.reversedRegex,r,c,u,g);if(C)return this._toFoundBracket(s,C);f=!1}i=m,n=this.languageConfigurationService.getLanguageConfiguration(i).brackets,s=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew}const _=!!n&&!Ct(l.getStandardTokenType(d));if(_)f?u=l.getStartOffset(d):(u=l.getStartOffset(d),g=l.getEndOffset(d));else if(s&&n&&f&&u!==g){const C=rt.findPrevBracketInRange(n.reversedRegex,r,c,u,g);if(C)return this._toFoundBracket(s,C)}f=_}if(s&&n&&f&&u!==g){const m=rt.findPrevBracketInRange(n.reversedRegex,r,c,u,g);if(m)return this._toFoundBracket(s,m)}}return null}findNextBracket(e){var r;const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((r=this.bracketPairsTree.value)==null?void 0:r.object.getFirstBracketAfter(t))||null;const i=this.textModel.getLineCount();let n=null,s=null,o=null;for(let l=t.lineNumber;l<=i;l++){const h=this.textModel.tokenization.getLineTokens(l),c=h.getCount(),d=this.textModel.getLineContent(l);let u=0,g=0,f=0;if(l===t.lineNumber){u=h.findTokenIndexAtOffset(t.column-1),g=t.column-1,f=t.column-1;const _=h.getLanguageId(u);n!==_&&(n=_,s=this.languageConfigurationService.getLanguageConfiguration(n).brackets,o=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew)}let m=!0;for(;u<c;u++){const _=h.getLanguageId(u);if(n!==_){if(o&&s&&m&&g!==f){const p=rt.findNextBracketInRange(s.forwardRegex,l,d,g,f);if(p)return this._toFoundBracket(o,p);m=!1}n=_,s=this.languageConfigurationService.getLanguageConfiguration(n).brackets,o=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew}const C=!!s&&!Ct(h.getStandardTokenType(u));if(C)m||(g=h.getStartOffset(u)),f=h.getEndOffset(u);else if(o&&s&&m&&g!==f){const p=rt.findNextBracketInRange(s.forwardRegex,l,d,g,f);if(p)return this._toFoundBracket(o,p)}m=C}if(o&&s&&m&&g!==f){const _=rt.findNextBracketInRange(s.forwardRegex,l,d,g,f);if(_)return this._toFoundBracket(o,_)}}return null}findEnclosingBrackets(e,t){const i=this.textModel.validatePosition(e);if(this.canBuildAST){const g=v.fromPositions(i),f=this.getBracketPairsInRange(v.fromPositions(i,i)).findLast(m=>m.closingBracketRange!==void 0&&m.range.strictContainsRange(g));return f?[f.openingBracketRange,f.closingBracketRange]:null}const n=na(t),s=this.textModel.getLineCount(),o=new Map;let r=[];const l=(g,f)=>{if(!o.has(g)){const m=[];for(let _=0,C=f?f.brackets.length:0;_<C;_++)m[_]=0;o.set(g,m)}r=o.get(g)};let h=0;const c=(g,f,m,_,C)=>{for(;;){if(n&&++h%100===0&&!n())return Wt.INSTANCE;const p=rt.findNextBracketInRange(g.forwardRegex,f,m,_,C);if(!p)break;const b=m.substring(p.startColumn-1,p.endColumn-1).toLowerCase(),w=g.textIsBracket[b];if(w&&(w.isOpen(b)?r[w.index]++:w.isClose(b)&&r[w.index]--,r[w.index]===-1))return this._matchFoundBracket(p,w,!1,n);_=p.endColumn-1}return null};let d=null,u=null;for(let g=i.lineNumber;g<=s;g++){const f=this.textModel.tokenization.getLineTokens(g),m=f.getCount(),_=this.textModel.getLineContent(g);let C=0,p=0,b=0;if(g===i.lineNumber){C=f.findTokenIndexAtOffset(i.column-1),p=i.column-1,b=i.column-1;const L=f.getLanguageId(C);d!==L&&(d=L,u=this.languageConfigurationService.getLanguageConfiguration(d).brackets,l(d,u))}let w=!0;for(;C<m;C++){const L=f.getLanguageId(C);if(d!==L){if(u&&w&&p!==b){const y=c(u,g,_,p,b);if(y)return uo(y);w=!1}d=L,u=this.languageConfigurationService.getLanguageConfiguration(d).brackets,l(d,u)}const S=!!u&&!Ct(f.getStandardTokenType(C));if(S)w||(p=f.getStartOffset(C)),b=f.getEndOffset(C);else if(u&&w&&p!==b){const y=c(u,g,_,p,b);if(y)return uo(y)}w=S}if(u&&w&&p!==b){const L=c(u,g,_,p,b);if(L)return uo(L)}}return null}_toFoundBracket(e,t){if(!t)return null;let i=this.textModel.getValueInRange(t);i=i.toLowerCase();const n=e.getBracketInfo(i);return n?{range:t,bracketInfo:n}:null}}function ww(a,e){return{object:a,dispose:()=>e==null?void 0:e.dispose()}}function na(a){if(typeof a>"u")return()=>!0;{const e=Date.now();return()=>Date.now()-e<=a}}const fr=class fr{constructor(){this._searchCanceledBrand=void 0}};fr.INSTANCE=new fr;let Wt=fr;function uo(a){return a instanceof Wt?null:a}class Lw extends H{constructor(e){super(),this.textModel=e,this.colorProvider=new Qu,this.onDidChangeEmitter=new M,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=e.getOptions().bracketPairColorizationOptions,this._register(e.bracketPairs.onDidChange(t=>{this.onDidChangeEmitter.fire()}))}handleDidChangeOptions(e){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(e,t,i,n){return n?[]:t===void 0?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(e,!0).map(o=>({id:`bracket${o.range.toString()}-${o.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(o,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:o.range})).toArray():[]}getAllDecorations(e,t){return e===void 0?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new v(1,1,this.textModel.getLineCount(),1),e,t):[]}}class Qu{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(e,t){return e.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(t?e.nestingLevelOfEqualBracketType:e.nestingLevel)}getInlineClassNameOfLevel(e){return`bracket-highlighting-${e%30}`}}di((a,e)=>{const t=[Wu,Vu,Hu,zu,Uu,ju],i=new Qu;e.addRule(`.monaco-editor .${i.unexpectedClosingBracketClassName} { color: ${a.getColor(Ab)}; }`);const n=t.map(s=>a.getColor(s)).filter(s=>!!s).filter(s=>!s.isTransparent());for(let s=0;s<30;s++){const o=n[s%n.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(s)} { color: ${o}; }`)}});function go(a){return a.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class ye{get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}constructor(e,t,i,n){this.oldPosition=e,this.oldText=t,this.newPosition=i,this.newText=n}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${go(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${go(this.oldText)}")`:`(replace@${this.oldPosition} "${go(this.oldText)}" with "${go(this.newText)}")`}static _writeStringSize(e){return 4+2*e.length}static _writeString(e,t,i){const n=t.length;ct(e,n,i),i+=4;for(let s=0;s<n;s++)Rp(e,t.charCodeAt(s),i),i+=2;return i}static _readString(e,t){const i=dt(e,t);return t+=4,g_(e,t,i)}writeSize(){return 8+ye._writeStringSize(this.oldText)+ye._writeStringSize(this.newText)}write(e,t){return ct(e,this.oldPosition,t),t+=4,ct(e,this.newPosition,t),t+=4,t=ye._writeString(e,this.oldText,t),t=ye._writeString(e,this.newText,t),t}static read(e,t,i){const n=dt(e,t);t+=4;const s=dt(e,t);t+=4;const o=ye._readString(e,t);t+=ye._writeStringSize(o);const r=ye._readString(e,t);return t+=ye._writeStringSize(r),i.push(new ye(n,o,s,r)),t}}function vw(a,e){return a===null||a.length===0?e:new wt(a,e).compress()}class wt{constructor(e,t){this._prevEdits=e,this._currEdits=t,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let e=0,t=0,i=this._getPrev(e),n=this._getCurr(t);for(;e<this._prevLen||t<this._currLen;){if(i===null){this._acceptCurr(n),n=this._getCurr(++t);continue}if(n===null){this._acceptPrev(i),i=this._getPrev(++e);continue}if(n.oldEnd<=i.newPosition){this._acceptCurr(n),n=this._getCurr(++t);continue}if(i.newEnd<=n.oldPosition){this._acceptPrev(i),i=this._getPrev(++e);continue}if(n.oldPosition<i.newPosition){const[h,c]=wt._splitCurr(n,i.newPosition-n.oldPosition);this._acceptCurr(h),n=c;continue}if(i.newPosition<n.oldPosition){const[h,c]=wt._splitPrev(i,n.oldPosition-i.newPosition);this._acceptPrev(h),i=c;continue}let r,l;if(n.oldEnd===i.newEnd)r=i,l=n,i=this._getPrev(++e),n=this._getCurr(++t);else if(n.oldEnd<i.newEnd){const[h,c]=wt._splitPrev(i,n.oldLength);r=h,l=n,i=c,n=this._getCurr(++t)}else{const[h,c]=wt._splitCurr(n,i.newLength);r=i,l=h,i=this._getPrev(++e),n=c}this._result[this._resultLen++]=new ye(r.oldPosition,r.oldText,l.newPosition,l.newText),this._prevDeltaOffset+=r.newLength-r.oldLength,this._currDeltaOffset+=l.newLength-l.oldLength}const s=wt._merge(this._result);return wt._removeNoOps(s)}_acceptCurr(e){this._result[this._resultLen++]=wt._rebaseCurr(this._prevDeltaOffset,e),this._currDeltaOffset+=e.newLength-e.oldLength}_getCurr(e){return e<this._currLen?this._currEdits[e]:null}_acceptPrev(e){this._result[this._resultLen++]=wt._rebasePrev(this._currDeltaOffset,e),this._prevDeltaOffset+=e.newLength-e.oldLength}_getPrev(e){return e<this._prevLen?this._prevEdits[e]:null}static _rebaseCurr(e,t){return new ye(t.oldPosition-e,t.oldText,t.newPosition,t.newText)}static _rebasePrev(e,t){return new ye(t.oldPosition,t.oldText,t.newPosition+e,t.newText)}static _splitPrev(e,t){const i=e.newText.substr(0,t),n=e.newText.substr(t);return[new ye(e.oldPosition,e.oldText,e.newPosition,i),new ye(e.oldEnd,"",e.newPosition+t,n)]}static _splitCurr(e,t){const i=e.oldText.substr(0,t),n=e.oldText.substr(t);return[new ye(e.oldPosition,i,e.newPosition,e.newText),new ye(e.oldPosition+t,n,e.newEnd,"")]}static _merge(e){if(e.length===0)return e;const t=[];let i=0,n=e[0];for(let s=1;s<e.length;s++){const o=e[s];n.oldEnd===o.oldPosition?n=new ye(n.oldPosition,n.oldText+o.oldText,n.newPosition,n.newText+o.newText):(t[i++]=n,n=o)}return t[i++]=n,t}static _removeNoOps(e){if(e.length===0)return e;const t=[];let i=0;for(let n=0;n<e.length;n++){const s=e[n];s.oldText!==s.newText&&(t[i++]=s)}return t}}function sn(a){return a.toString()}class Le{static create(e,t){const i=e.getAlternativeVersionId(),n=tl(e);return new Le(i,i,n,n,t,t,[])}constructor(e,t,i,n,s,o,r){this.beforeVersionId=e,this.afterVersionId=t,this.beforeEOL=i,this.afterEOL=n,this.beforeCursorState=s,this.afterCursorState=o,this.changes=r}append(e,t,i,n,s){t.length>0&&(this.changes=vw(this.changes,t)),this.afterEOL=i,this.afterVersionId=n,this.afterCursorState=s}static _writeSelectionsSize(e){return 4+4*4*(e?e.length:0)}static _writeSelections(e,t,i){if(ct(e,t?t.length:0,i),i+=4,t)for(const n of t)ct(e,n.selectionStartLineNumber,i),i+=4,ct(e,n.selectionStartColumn,i),i+=4,ct(e,n.positionLineNumber,i),i+=4,ct(e,n.positionColumn,i),i+=4;return i}static _readSelections(e,t,i){const n=dt(e,t);t+=4;for(let s=0;s<n;s++){const o=dt(e,t);t+=4;const r=dt(e,t);t+=4;const l=dt(e,t);t+=4;const h=dt(e,t);t+=4,i.push(new te(o,r,l,h))}return t}serialize(){let e=10+Le._writeSelectionsSize(this.beforeCursorState)+Le._writeSelectionsSize(this.afterCursorState)+4;for(const n of this.changes)e+=n.writeSize();const t=new Uint8Array(e);let i=0;ct(t,this.beforeVersionId,i),i+=4,ct(t,this.afterVersionId,i),i+=4,Uh(t,this.beforeEOL,i),i+=1,Uh(t,this.afterEOL,i),i+=1,i=Le._writeSelections(t,this.beforeCursorState,i),i=Le._writeSelections(t,this.afterCursorState,i),ct(t,this.changes.length,i),i+=4;for(const n of this.changes)i=n.write(t,i);return t.buffer}static deserialize(e){const t=new Uint8Array(e);let i=0;const n=dt(t,i);i+=4;const s=dt(t,i);i+=4;const o=jh(t,i);i+=1;const r=jh(t,i);i+=1;const l=[];i=Le._readSelections(t,i,l);const h=[];i=Le._readSelections(t,i,h);const c=dt(t,i);i+=4;const d=[];for(let u=0;u<c;u++)i=ye.read(t,i,d);return new Le(n,s,o,r,l,h,d)}}class Yu{get type(){return 0}get resource(){return ln.isUri(this.model)?this.model:this.model.uri}constructor(e,t,i,n){this.label=e,this.code=t,this.model=i,this._data=Le.create(i,n)}toString(){return(this._data instanceof Le?this._data:Le.deserialize(this._data)).changes.map(t=>t.toString()).join(", ")}matchesResource(e){return(ln.isUri(this.model)?this.model:this.model.uri).toString()===e.toString()}setModel(e){this.model=e}canAppend(e){return this.model===e&&this._data instanceof Le}append(e,t,i,n,s){this._data instanceof Le&&this._data.append(e,t,i,n,s)}close(){this._data instanceof Le&&(this._data=this._data.serialize())}open(){this._data instanceof Le||(this._data=Le.deserialize(this._data))}undo(){if(ln.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof Le&&(this._data=this._data.serialize());const e=Le.deserialize(this._data);this.model._applyUndo(e.changes,e.beforeEOL,e.beforeVersionId,e.beforeCursorState)}redo(){if(ln.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof Le&&(this._data=this._data.serialize());const e=Le.deserialize(this._data);this.model._applyRedo(e.changes,e.afterEOL,e.afterVersionId,e.afterCursorState)}heapSize(){return this._data instanceof Le&&(this._data=this._data.serialize()),this._data.byteLength+168}}class Sw{get resources(){return this._editStackElementsArr.map(e=>e.resource)}constructor(e,t,i){this.label=e,this.code=t,this.type=1,this._isOpen=!0,this._editStackElementsArr=i.slice(0),this._editStackElementsMap=new Map;for(const n of this._editStackElementsArr){const s=sn(n.resource);this._editStackElementsMap.set(s,n)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(e){const t=sn(e);return this._editStackElementsMap.has(t)}setModel(e){const t=sn(ln.isUri(e)?e:e.uri);this._editStackElementsMap.has(t)&&this._editStackElementsMap.get(t).setModel(e)}canAppend(e){if(!this._isOpen)return!1;const t=sn(e.uri);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).canAppend(e):!1}append(e,t,i,n,s){const o=sn(e.uri);this._editStackElementsMap.get(o).append(e,t,i,n,s)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const e of this._editStackElementsArr)e.undo()}redo(){for(const e of this._editStackElementsArr)e.redo()}heapSize(e){const t=sn(e);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).heapSize():0}split(){return this._editStackElementsArr}toString(){const e=[];for(const t of this._editStackElementsArr)e.push(`${Ap(t.resource)}: ${t}`);return`{${e.join(", ")}}`}}function tl(a){return a.getEOL()===`
`?0:1}function sa(a){return a?a instanceof Yu||a instanceof Sw:!1}class Yl{constructor(e,t){this._model=e,this._undoRedoService=t}pushStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);sa(e)&&e.close()}popStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);sa(e)&&e.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(e,t){const i=this._undoRedoService.getLastElement(this._model.uri);if(sa(i)&&i.canAppend(this._model))return i;const n=new Yu(I("edit","Typing"),"undoredo.textBufferEdit",this._model,e);return this._undoRedoService.pushElement(n,t),n}pushEOL(e){const t=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(e),t.append(this._model,[],tl(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(e,t,i,n){const s=this._getOrCreateEditStackElement(e,n),o=this._model.applyEdits(t,!0),r=Yl._computeCursorState(i,o),l=o.map((h,c)=>({index:c,textChange:h.textChange}));return l.sort((h,c)=>h.textChange.oldPosition===c.textChange.oldPosition?h.index-c.index:h.textChange.oldPosition-c.textChange.oldPosition),s.append(this._model,l.map(h=>h.textChange),tl(this._model),this._model.getAlternativeVersionId(),r),r}static _computeCursorState(e,t){try{return e?e(t):null}catch(i){return Oe(i),null}}}class Xu extends H{constructor(){super(...arguments),this._isDisposed=!1}dispose(){super.dispose(),this._isDisposed=!0}assertNotDisposed(){if(this._isDisposed)throw new Error("TextModelPart is disposed!")}}function xw(a,e){let t=0,i=0;const n=a.length;for(;i<n;){const s=a.charCodeAt(i);if(s===32)t++;else if(s===9)t=t-t%e+e;else break;i++}return i===n?-1:t}var Fi;(function(a){a[a.Disabled=0]="Disabled",a[a.EnabledForActive=1]="EnabledForActive",a[a.Enabled=2]="Enabled"})(Fi||(Fi={}));class Mi{constructor(e,t,i,n,s,o){if(this.visibleColumn=e,this.column=t,this.className=i,this.horizontalLine=n,this.forWrappedLinesAfterColumn=s,this.forWrappedLinesBeforeOrAtColumn=o,e!==-1==(t!==-1))throw new Error}}class fs{constructor(e,t){this.top=e,this.endColumn=t}}class yw extends Xu{constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t}getLanguageConfiguration(e){return this.languageConfigurationService.getLanguageConfiguration(e)}_computeIndentLevel(e){return xw(this.textModel.getLineContent(e+1),this.textModel.getOptions().tabSize)}getActiveIndentGuide(e,t,i){this.assertNotDisposed();const n=this.textModel.getLineCount();if(e<1||e>n)throw new fe("Illegal value for lineNumber");const s=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,o=!!(s&&s.offSide);let r=-2,l=-1,h=-2,c=-1;const d=y=>{if(r!==-1&&(r===-2||r>y-1)){r=-1,l=-1;for(let N=y-2;N>=0;N--){const x=this._computeIndentLevel(N);if(x>=0){r=N,l=x;break}}}if(h===-2){h=-1,c=-1;for(let N=y;N<n;N++){const x=this._computeIndentLevel(N);if(x>=0){h=N,c=x;break}}}};let u=-2,g=-1,f=-2,m=-1;const _=y=>{if(u===-2){u=-1,g=-1;for(let N=y-2;N>=0;N--){const x=this._computeIndentLevel(N);if(x>=0){u=N,g=x;break}}}if(f!==-1&&(f===-2||f<y-1)){f=-1,m=-1;for(let N=y;N<n;N++){const x=this._computeIndentLevel(N);if(x>=0){f=N,m=x;break}}}};let C=0,p=!0,b=0,w=!0,L=0,S=0;for(let y=0;p||w;y++){const N=e-y,x=e+y;y>1&&(N<1||N<t)&&(p=!1),y>1&&(x>n||x>i)&&(w=!1),y>5e4&&(p=!1,w=!1);let R=-1;if(p&&N>=1){const E=this._computeIndentLevel(N-1);E>=0?(h=N-1,c=E,R=Math.ceil(E/this.textModel.getOptions().indentSize)):(d(N),R=this._getIndentLevelForWhitespaceLine(o,l,c))}let k=-1;if(w&&x<=n){const E=this._computeIndentLevel(x-1);E>=0?(u=x-1,g=E,k=Math.ceil(E/this.textModel.getOptions().indentSize)):(_(x),k=this._getIndentLevelForWhitespaceLine(o,g,m))}if(y===0){S=R;continue}if(y===1){if(x<=n&&k>=0&&S+1===k){p=!1,C=x,b=x,L=k;continue}if(N>=1&&R>=0&&R-1===S){w=!1,C=N,b=N,L=R;continue}if(C=e,b=e,L=S,L===0)return{startLineNumber:C,endLineNumber:b,indent:L}}p&&(R>=L?C=N:p=!1),w&&(k>=L?b=x:w=!1)}return{startLineNumber:C,endLineNumber:b,indent:L}}getLinesBracketGuides(e,t,i,n){var d;const s=[];for(let u=e;u<=t;u++)s.push([]);const o=!0,r=this.textModel.bracketPairs.getBracketPairsInRangeWithMinIndentation(new v(e,1,t,this.textModel.getLineMaxColumn(t))).toArray();let l;if(i&&r.length>0){const u=(e<=i.lineNumber&&i.lineNumber<=t?r:this.textModel.bracketPairs.getBracketPairsInRange(v.fromPositions(i)).toArray()).filter(g=>v.strictContainsPosition(g.range,i));l=(d=V_(u,g=>o))==null?void 0:d.range}const h=this.textModel.getOptions().bracketPairColorizationOptions.independentColorPoolPerBracketType,c=new Ju;for(const u of r){if(!u.closingBracketRange)continue;const g=l&&u.range.equalsRange(l);if(!g&&!n.includeInactive)continue;const f=c.getInlineClassName(u.nestingLevel,u.nestingLevelOfEqualBracketType,h)+(n.highlightActive&&g?" "+c.activeClassName:""),m=u.openingBracketRange.getStartPosition(),_=u.closingBracketRange.getStartPosition(),C=n.horizontalGuides===Fi.Enabled||n.horizontalGuides===Fi.EnabledForActive&&g;if(u.range.startLineNumber===u.range.endLineNumber){C&&s[u.range.startLineNumber-e].push(new Mi(-1,u.openingBracketRange.getEndPosition().column,f,new fs(!1,_.column),-1,-1));continue}const p=this.getVisibleColumnFromPosition(_),b=this.getVisibleColumnFromPosition(u.openingBracketRange.getStartPosition()),w=Math.min(b,p,u.minVisibleColumnIndentation+1);let L=!1;Je(this.textModel.getLineContent(u.closingBracketRange.startLineNumber))<u.closingBracketRange.startColumn-1&&(L=!0);const N=Math.max(m.lineNumber,e),x=Math.min(_.lineNumber,t),R=L?1:0;for(let k=N;k<x+R;k++)s[k-e].push(new Mi(w,-1,f,null,k===m.lineNumber?m.column:-1,k===_.lineNumber?_.column:-1));C&&(m.lineNumber>=e&&b>w&&s[m.lineNumber-e].push(new Mi(w,-1,f,new fs(!1,m.column),-1,-1)),_.lineNumber<=t&&p>w&&s[_.lineNumber-e].push(new Mi(w,-1,f,new fs(!L,_.column),-1,-1)))}for(const u of s)u.sort((g,f)=>g.visibleColumn-f.visibleColumn);return s}getVisibleColumnFromPosition(e){return Ce.visibleColumnFromColumn(this.textModel.getLineContent(e.lineNumber),e.column,this.textModel.getOptions().tabSize)+1}getLinesIndentGuides(e,t){this.assertNotDisposed();const i=this.textModel.getLineCount();if(e<1||e>i)throw new Error("Illegal value for startLineNumber");if(t<1||t>i)throw new Error("Illegal value for endLineNumber");const n=this.textModel.getOptions(),s=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,o=!!(s&&s.offSide),r=new Array(t-e+1);let l=-2,h=-1,c=-2,d=-1;for(let u=e;u<=t;u++){const g=u-e,f=this._computeIndentLevel(u-1);if(f>=0){l=u-1,h=f,r[g]=Math.ceil(f/n.indentSize);continue}if(l===-2){l=-1,h=-1;for(let m=u-2;m>=0;m--){const _=this._computeIndentLevel(m);if(_>=0){l=m,h=_;break}}}if(c!==-1&&(c===-2||c<u-1)){c=-1,d=-1;for(let m=u;m<i;m++){const _=this._computeIndentLevel(m);if(_>=0){c=m,d=_;break}}}r[g]=this._getIndentLevelForWhitespaceLine(o,h,d)}return r}_getIndentLevelForWhitespaceLine(e,t,i){const n=this.textModel.getOptions();return t===-1||i===-1?0:t<i?1+Math.floor(t/n.indentSize):t===i||e?Math.ceil(i/n.indentSize):1+Math.floor(i/n.indentSize)}}class Ju{constructor(){this.activeClassName="indent-active"}getInlineClassName(e,t,i){return this.getInlineClassNameOfLevel(i?t:e)}getInlineClassNameOfLevel(e){return`bracket-indent-guide lvl-${e%30}`}}class Nw{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}}function Dw(a,e,t,i,n){n.spacesDiff=0,n.looksLikeAlignment=!1;let s;for(s=0;s<e&&s<i;s++){const u=a.charCodeAt(s),g=t.charCodeAt(s);if(u!==g)break}let o=0,r=0;for(let u=s;u<e;u++)a.charCodeAt(u)===32?o++:r++;let l=0,h=0;for(let u=s;u<i;u++)t.charCodeAt(u)===32?l++:h++;if(o>0&&r>0||l>0&&h>0)return;const c=Math.abs(r-h),d=Math.abs(o-l);if(c===0){n.spacesDiff=d,d>0&&0<=l-1&&l-1<a.length&&l<t.length&&t.charCodeAt(l)!==32&&a.charCodeAt(l-1)===32&&a.charCodeAt(a.length-1)===44&&(n.looksLikeAlignment=!0);return}if(d%c===0){n.spacesDiff=d/c;return}}function Sc(a,e,t){const i=Math.min(a.getLineCount(),1e4);let n=0,s=0,o="",r=0;const l=[2,4,6,8,3,5,7],h=8,c=[0,0,0,0,0,0,0,0,0],d=new Nw;for(let f=1;f<=i;f++){const m=a.getLineLength(f),_=a.getLineContent(f),C=m<=65536;let p=!1,b=0,w=0,L=0;for(let y=0,N=m;y<N;y++){const x=C?_.charCodeAt(y):a.getLineCharCode(f,y);if(x===9)L++;else if(x===32)w++;else{p=!0,b=y;break}}if(!p||(L>0?n++:w>1&&s++,Dw(o,r,_,b,d),d.looksLikeAlignment&&!(t&&e===d.spacesDiff)))continue;const S=d.spacesDiff;S<=h&&c[S]++,o=_,r=b}let u=t;n!==s&&(u=n<s);let g=e;if(u){let f=u?0:.1*i;l.forEach(m=>{const _=c[m];_>f&&(f=_,g=m)}),g===4&&c[4]>0&&c[2]>0&&c[2]>=c[4]/2&&(g=2)}return{insertSpaces:u,tabSize:g}}function He(a){return(a.metadata&1)>>>0}function J(a,e){a.metadata=a.metadata&254|e<<0}function De(a){return(a.metadata&2)>>>1===1}function X(a,e){a.metadata=a.metadata&253|(e?1:0)<<1}function eg(a){return(a.metadata&4)>>>2===1}function xc(a,e){a.metadata=a.metadata&251|(e?1:0)<<2}function tg(a){return(a.metadata&64)>>>6===1}function yc(a,e){a.metadata=a.metadata&191|(e?1:0)<<6}function Iw(a){return(a.metadata&24)>>>3}function Nc(a,e){a.metadata=a.metadata&231|e<<3}function kw(a){return(a.metadata&32)>>>5===1}function Dc(a,e){a.metadata=a.metadata&223|(e?1:0)<<5}class ig{constructor(e,t,i){this.metadata=0,this.parent=this,this.left=this,this.right=this,J(this,1),this.start=t,this.end=i,this.delta=0,this.maxEnd=i,this.id=e,this.ownerId=0,this.options=null,xc(this,!1),yc(this,!1),Nc(this,1),Dc(this,!1),this.cachedVersionId=0,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=i,this.range=null,X(this,!1)}reset(e,t,i,n){this.start=t,this.end=i,this.maxEnd=i,this.cachedVersionId=e,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=i,this.range=n}setOptions(e){this.options=e;const t=this.options.className;xc(this,t==="squiggly-error"||t==="squiggly-warning"||t==="squiggly-info"),yc(this,this.options.glyphMarginClassName!==null),Nc(this,this.options.stickiness),Dc(this,this.options.collapseOnReplaceEdit)}setCachedOffsets(e,t,i){this.cachedVersionId!==i&&(this.range=null),this.cachedVersionId=i,this.cachedAbsoluteStart=e,this.cachedAbsoluteEnd=t}detach(){this.parent=null,this.left=null,this.right=null}}const V=new ig(null,0,0);V.parent=V;V.left=V;V.right=V;J(V,0);class oa{constructor(){this.root=V,this.requestNormalizeDelta=!1}intervalSearch(e,t,i,n,s,o){return this.root===V?[]:Bw(this,e,t,i,n,s,o)}search(e,t,i,n){return this.root===V?[]:Pw(this,e,t,i,n)}collectNodesFromOwner(e){return Aw(this,e)}collectNodesPostOrder(){return Ow(this)}insert(e){Ic(this,e),this._normalizeDeltaIfNecessary()}delete(e){kc(this,e),this._normalizeDeltaIfNecessary()}resolveNode(e,t){const i=e;let n=0;for(;e!==this.root;)e===e.parent.right&&(n+=e.parent.delta),e=e.parent;const s=i.start+n,o=i.end+n;i.setCachedOffsets(s,o,t)}acceptReplace(e,t,i,n){const s=Mw(this,e,e+t);for(let o=0,r=s.length;o<r;o++){const l=s[o];kc(this,l)}this._normalizeDeltaIfNecessary(),Rw(this,e,e+t,i),this._normalizeDeltaIfNecessary();for(let o=0,r=s.length;o<r;o++){const l=s[o];l.start=l.cachedAbsoluteStart,l.end=l.cachedAbsoluteEnd,Ew(l,e,e+t,i,n),l.maxEnd=l.end,Ic(this,l)}this._normalizeDeltaIfNecessary()}_normalizeDeltaIfNecessary(){this.requestNormalizeDelta&&(this.requestNormalizeDelta=!1,Tw(this))}}function Tw(a){let e=a.root,t=0;for(;e!==V;){if(e.left!==V&&!De(e.left)){e=e.left;continue}if(e.right!==V&&!De(e.right)){t+=e.delta,e=e.right;continue}e.start=t+e.start,e.end=t+e.end,e.delta=0,li(e),X(e,!0),X(e.left,!1),X(e.right,!1),e===e.parent.right&&(t-=e.parent.delta),e=e.parent}X(a.root,!1)}function on(a,e,t,i){return a<t?!0:a>t||i===1?!1:i===2?!0:e}function Ew(a,e,t,i,n){const s=Iw(a),o=s===0||s===2,r=s===1||s===2,l=t-e,h=i,c=Math.min(l,h),d=a.start;let u=!1;const g=a.end;let f=!1;e<=d&&g<=t&&kw(a)&&(a.start=e,u=!0,a.end=e,f=!0);{const _=n?1:l>0?2:0;!u&&on(d,o,e,_)&&(u=!0),!f&&on(g,r,e,_)&&(f=!0)}if(c>0&&!n){const _=l>h?2:0;!u&&on(d,o,e+c,_)&&(u=!0),!f&&on(g,r,e+c,_)&&(f=!0)}{const _=n?1:0;!u&&on(d,o,t,_)&&(a.start=e+h,u=!0),!f&&on(g,r,t,_)&&(a.end=e+h,f=!0)}const m=h-l;u||(a.start=Math.max(0,d+m)),f||(a.end=Math.max(0,g+m)),a.start>a.end&&(a.end=a.start)}function Mw(a,e,t){let i=a.root,n=0,s=0,o=0,r=0;const l=[];let h=0;for(;i!==V;){if(De(i)){X(i.left,!1),X(i.right,!1),i===i.parent.right&&(n-=i.parent.delta),i=i.parent;continue}if(!De(i.left)){if(s=n+i.maxEnd,s<e){X(i,!0);continue}if(i.left!==V){i=i.left;continue}}if(o=n+i.start,o>t){X(i,!0);continue}if(r=n+i.end,r>=e&&(i.setCachedOffsets(o,r,0),l[h++]=i),X(i,!0),i.right!==V&&!De(i.right)){n+=i.delta,i=i.right;continue}}return X(a.root,!1),l}function Rw(a,e,t,i){let n=a.root,s=0,o=0,r=0;const l=i-(t-e);for(;n!==V;){if(De(n)){X(n.left,!1),X(n.right,!1),n===n.parent.right&&(s-=n.parent.delta),li(n),n=n.parent;continue}if(!De(n.left)){if(o=s+n.maxEnd,o<e){X(n,!0);continue}if(n.left!==V){n=n.left;continue}}if(r=s+n.start,r>t){n.start+=l,n.end+=l,n.delta+=l,(n.delta<-1073741824||n.delta>1073741824)&&(a.requestNormalizeDelta=!0),X(n,!0);continue}if(X(n,!0),n.right!==V&&!De(n.right)){s+=n.delta,n=n.right;continue}}X(a.root,!1)}function Aw(a,e){let t=a.root;const i=[];let n=0;for(;t!==V;){if(De(t)){X(t.left,!1),X(t.right,!1),t=t.parent;continue}if(t.left!==V&&!De(t.left)){t=t.left;continue}if(t.ownerId===e&&(i[n++]=t),X(t,!0),t.right!==V&&!De(t.right)){t=t.right;continue}}return X(a.root,!1),i}function Ow(a){let e=a.root;const t=[];let i=0;for(;e!==V;){if(De(e)){X(e.left,!1),X(e.right,!1),e=e.parent;continue}if(e.left!==V&&!De(e.left)){e=e.left;continue}if(e.right!==V&&!De(e.right)){e=e.right;continue}t[i++]=e,X(e,!0)}return X(a.root,!1),t}function Pw(a,e,t,i,n){let s=a.root,o=0,r=0,l=0;const h=[];let c=0;for(;s!==V;){if(De(s)){X(s.left,!1),X(s.right,!1),s===s.parent.right&&(o-=s.parent.delta),s=s.parent;continue}if(s.left!==V&&!De(s.left)){s=s.left;continue}r=o+s.start,l=o+s.end,s.setCachedOffsets(r,l,i);let d=!0;if(e&&s.ownerId&&s.ownerId!==e&&(d=!1),t&&eg(s)&&(d=!1),n&&!tg(s)&&(d=!1),d&&(h[c++]=s),X(s,!0),s.right!==V&&!De(s.right)){o+=s.delta,s=s.right;continue}}return X(a.root,!1),h}function Bw(a,e,t,i,n,s,o){let r=a.root,l=0,h=0,c=0,d=0;const u=[];let g=0;for(;r!==V;){if(De(r)){X(r.left,!1),X(r.right,!1),r===r.parent.right&&(l-=r.parent.delta),r=r.parent;continue}if(!De(r.left)){if(h=l+r.maxEnd,h<e){X(r,!0);continue}if(r.left!==V){r=r.left;continue}}if(c=l+r.start,c>t){X(r,!0);continue}if(d=l+r.end,d>=e){r.setCachedOffsets(c,d,s);let f=!0;i&&r.ownerId&&r.ownerId!==i&&(f=!1),n&&eg(r)&&(f=!1),o&&!tg(r)&&(f=!1),f&&(u[g++]=r)}if(X(r,!0),r.right!==V&&!De(r.right)){l+=r.delta,r=r.right;continue}}return X(a.root,!1),u}function Ic(a,e){if(a.root===V)return e.parent=V,e.left=V,e.right=V,J(e,0),a.root=e,a.root;Fw(a,e),Kt(e.parent);let t=e;for(;t!==a.root&&He(t.parent)===1;)if(t.parent===t.parent.parent.left){const i=t.parent.parent.right;He(i)===1?(J(t.parent,0),J(i,0),J(t.parent.parent,1),t=t.parent.parent):(t===t.parent.right&&(t=t.parent,ms(a,t)),J(t.parent,0),J(t.parent.parent,1),ps(a,t.parent.parent))}else{const i=t.parent.parent.left;He(i)===1?(J(t.parent,0),J(i,0),J(t.parent.parent,1),t=t.parent.parent):(t===t.parent.left&&(t=t.parent,ps(a,t)),J(t.parent,0),J(t.parent.parent,1),ms(a,t.parent.parent))}return J(a.root,0),e}function Fw(a,e){let t=0,i=a.root;const n=e.start,s=e.end;for(;;)if(Vw(n,s,i.start+t,i.end+t)<0)if(i.left===V){e.start-=t,e.end-=t,e.maxEnd-=t,i.left=e;break}else i=i.left;else if(i.right===V){e.start-=t+i.delta,e.end-=t+i.delta,e.maxEnd-=t+i.delta,i.right=e;break}else t+=i.delta,i=i.right;e.parent=i,e.left=V,e.right=V,J(e,1)}function kc(a,e){let t,i;if(e.left===V?(t=e.right,i=e,t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta):e.right===V?(t=e.left,i=e):(i=Ww(e.right),t=i.right,t.start+=i.delta,t.end+=i.delta,t.delta+=i.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),i.start+=e.delta,i.end+=e.delta,i.delta=e.delta,(i.delta<-1073741824||i.delta>1073741824)&&(a.requestNormalizeDelta=!0)),i===a.root){a.root=t,J(t,0),e.detach(),ra(),li(t),a.root.parent=V;return}const n=He(i)===1;if(i===i.parent.left?i.parent.left=t:i.parent.right=t,i===e?t.parent=i.parent:(i.parent===e?t.parent=i:t.parent=i.parent,i.left=e.left,i.right=e.right,i.parent=e.parent,J(i,He(e)),e===a.root?a.root=i:e===e.parent.left?e.parent.left=i:e.parent.right=i,i.left!==V&&(i.left.parent=i),i.right!==V&&(i.right.parent=i)),e.detach(),n){Kt(t.parent),i!==e&&(Kt(i),Kt(i.parent)),ra();return}Kt(t),Kt(t.parent),i!==e&&(Kt(i),Kt(i.parent));let s;for(;t!==a.root&&He(t)===0;)t===t.parent.left?(s=t.parent.right,He(s)===1&&(J(s,0),J(t.parent,1),ms(a,t.parent),s=t.parent.right),He(s.left)===0&&He(s.right)===0?(J(s,1),t=t.parent):(He(s.right)===0&&(J(s.left,0),J(s,1),ps(a,s),s=t.parent.right),J(s,He(t.parent)),J(t.parent,0),J(s.right,0),ms(a,t.parent),t=a.root)):(s=t.parent.left,He(s)===1&&(J(s,0),J(t.parent,1),ps(a,t.parent),s=t.parent.left),He(s.left)===0&&He(s.right)===0?(J(s,1),t=t.parent):(He(s.left)===0&&(J(s.right,0),J(s,1),ms(a,s),s=t.parent.left),J(s,He(t.parent)),J(t.parent,0),J(s.left,0),ps(a,t.parent),t=a.root));J(t,0),ra()}function Ww(a){for(;a.left!==V;)a=a.left;return a}function ra(){V.parent=V,V.delta=0,V.start=0,V.end=0}function ms(a,e){const t=e.right;t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta,e.right=t.left,t.left!==V&&(t.left.parent=e),t.parent=e.parent,e.parent===V?a.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,li(e),li(t)}function ps(a,e){const t=e.left;e.delta-=t.delta,(e.delta<-1073741824||e.delta>1073741824)&&(a.requestNormalizeDelta=!0),e.start-=t.delta,e.end-=t.delta,e.left=t.right,t.right!==V&&(t.right.parent=e),t.parent=e.parent,e.parent===V?a.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t,li(e),li(t)}function ng(a){let e=a.end;if(a.left!==V){const t=a.left.maxEnd;t>e&&(e=t)}if(a.right!==V){const t=a.right.maxEnd+a.delta;t>e&&(e=t)}return e}function li(a){a.maxEnd=ng(a)}function Kt(a){for(;a!==V;){const e=ng(a);if(a.maxEnd===e)return;a.maxEnd=e,a=a.parent}}function Vw(a,e,t,i){return a===t?e-i:a-t}class il{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==B)return Xl(this.right);let e=this;for(;e.parent!==B&&e.parent.left!==e;)e=e.parent;return e.parent===B?B:e.parent}prev(){if(this.left!==B)return sg(this.left);let e=this;for(;e.parent!==B&&e.parent.right!==e;)e=e.parent;return e.parent===B?B:e.parent}detach(){this.parent=null,this.left=null,this.right=null}}const B=new il(null,0);B.parent=B;B.left=B;B.right=B;B.color=0;function Xl(a){for(;a.left!==B;)a=a.left;return a}function sg(a){for(;a.right!==B;)a=a.right;return a}function Jl(a){return a===B?0:a.size_left+a.piece.length+Jl(a.right)}function eh(a){return a===B?0:a.lf_left+a.piece.lineFeedCnt+eh(a.right)}function aa(){B.parent=B}function _s(a,e){const t=e.right;t.size_left+=e.size_left+(e.piece?e.piece.length:0),t.lf_left+=e.lf_left+(e.piece?e.piece.lineFeedCnt:0),e.right=t.left,t.left!==B&&(t.left.parent=e),t.parent=e.parent,e.parent===B?a.root=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}function Cs(a,e){const t=e.left;e.left=t.right,t.right!==B&&(t.right.parent=e),t.parent=e.parent,e.size_left-=t.size_left+(t.piece?t.piece.length:0),e.lf_left-=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),e.parent===B?a.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}function fo(a,e){let t,i;if(e.left===B?(i=e,t=i.right):e.right===B?(i=e,t=i.left):(i=Xl(e.right),t=i.right),i===a.root){a.root=t,t.color=0,e.detach(),aa(),a.root.parent=B;return}const n=i.color===1;if(i===i.parent.left?i.parent.left=t:i.parent.right=t,i===e?(t.parent=i.parent,ls(a,t)):(i.parent===e?t.parent=i:t.parent=i.parent,ls(a,t),i.left=e.left,i.right=e.right,i.parent=e.parent,i.color=e.color,e===a.root?a.root=i:e===e.parent.left?e.parent.left=i:e.parent.right=i,i.left!==B&&(i.left.parent=i),i.right!==B&&(i.right.parent=i),i.size_left=e.size_left,i.lf_left=e.lf_left,ls(a,i)),e.detach(),t.parent.left===t){const o=Jl(t),r=eh(t);if(o!==t.parent.size_left||r!==t.parent.lf_left){const l=o-t.parent.size_left,h=r-t.parent.lf_left;t.parent.size_left=o,t.parent.lf_left=r,Ot(a,t.parent,l,h)}}if(ls(a,t.parent),n){aa();return}let s;for(;t!==a.root&&t.color===0;)t===t.parent.left?(s=t.parent.right,s.color===1&&(s.color=0,t.parent.color=1,_s(a,t.parent),s=t.parent.right),s.left.color===0&&s.right.color===0?(s.color=1,t=t.parent):(s.right.color===0&&(s.left.color=0,s.color=1,Cs(a,s),s=t.parent.right),s.color=t.parent.color,t.parent.color=0,s.right.color=0,_s(a,t.parent),t=a.root)):(s=t.parent.left,s.color===1&&(s.color=0,t.parent.color=1,Cs(a,t.parent),s=t.parent.left),s.left.color===0&&s.right.color===0?(s.color=1,t=t.parent):(s.left.color===0&&(s.right.color=0,s.color=1,_s(a,s),s=t.parent.left),s.color=t.parent.color,t.parent.color=0,s.left.color=0,Cs(a,t.parent),t=a.root));t.color=0,aa()}function Tc(a,e){for(ls(a,e);e!==a.root&&e.parent.color===1;)if(e.parent===e.parent.parent.left){const t=e.parent.parent.right;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,_s(a,e)),e.parent.color=0,e.parent.parent.color=1,Cs(a,e.parent.parent))}else{const t=e.parent.parent.left;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,Cs(a,e)),e.parent.color=0,e.parent.parent.color=1,_s(a,e.parent.parent))}a.root.color=0}function Ot(a,e,t,i){for(;e!==a.root&&e!==B;)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=i),e=e.parent}function ls(a,e){let t=0,i=0;if(e!==a.root){for(;e!==a.root&&e===e.parent.right;)e=e.parent;if(e!==a.root)for(e=e.parent,t=Jl(e.left)-e.size_left,i=eh(e.left)-e.lf_left,e.size_left+=t,e.lf_left+=i;e!==a.root&&(t!==0||i!==0);)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=i),e=e.parent}}const Mt=65535;function og(a){let e;return a[a.length-1]<65536?e=new Uint16Array(a.length):e=new Uint32Array(a.length),e.set(a,0),e}class Hw{constructor(e,t,i,n,s){this.lineStarts=e,this.cr=t,this.lf=i,this.crlf=n,this.isBasicASCII=s}}function Pt(a,e=!0){const t=[0];let i=1;for(let n=0,s=a.length;n<s;n++){const o=a.charCodeAt(n);o===13?n+1<s&&a.charCodeAt(n+1)===10?(t[i++]=n+2,n++):t[i++]=n+1:o===10&&(t[i++]=n+1)}return e?og(t):t}function zw(a,e){a.length=0,a[0]=0;let t=1,i=0,n=0,s=0,o=!0;for(let l=0,h=e.length;l<h;l++){const c=e.charCodeAt(l);c===13?l+1<h&&e.charCodeAt(l+1)===10?(s++,a[t++]=l+2,l++):(i++,a[t++]=l+1):c===10?(n++,a[t++]=l+1):o&&c!==9&&(c<32||c>126)&&(o=!1)}const r=new Hw(og(a),i,n,s,o);return a.length=0,r}class $e{constructor(e,t,i,n,s){this.bufferIndex=e,this.start=t,this.end=i,this.lineFeedCnt=n,this.length=s}}class yi{constructor(e,t){this.buffer=e,this.lineStarts=t}}class Uw{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==B&&e.iterate(e.root,i=>(i!==B&&this._pieces.push(i.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class jw{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){const i=this._cache[t];if(i.nodeStartOffset<=e&&i.nodeStartOffset+i.node.piece.length>=e)return i}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){const i=this._cache[t];if(i.nodeStartLineNumber&&i.nodeStartLineNumber<e&&i.nodeStartLineNumber+i.node.piece.lineFeedCnt>=e)return i}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1;const i=this._cache;for(let n=0;n<i.length;n++){const s=i[n];if(s.node.parent===null||s.nodeStartOffset>=e){i[n]=null,t=!0;continue}}if(t){const n=[];for(const s of i)s!==null&&n.push(s);this._cache=n}}}class $w{constructor(e,t,i){this.create(e,t,i)}create(e,t,i){this._buffers=[new yi("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=B,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=i;let n=null;for(let s=0,o=e.length;s<o;s++)if(e[s].buffer.length>0){e[s].lineStarts||(e[s].lineStarts=Pt(e[s].buffer));const r=new $e(s+1,{line:0,column:0},{line:e[s].lineStarts.length-1,column:e[s].buffer.length-e[s].lineStarts[e[s].lineStarts.length-1]},e[s].lineStarts.length-1,e[s].buffer.length);this._buffers.push(e[s]),n=this.rbInsertRight(n,r)}this._searchCache=new jw(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){const t=Mt,i=t-Math.floor(t/3),n=i*2;let s="",o=0;const r=[];if(this.iterate(this.root,l=>{const h=this.getNodeContent(l),c=h.length;if(o<=i||o+c<n)return s+=h,o+=c,!0;const d=s.replace(/\r\n|\r|\n/g,e);return r.push(new yi(d,Pt(d))),s=h,o=c,!0}),o>0){const l=s.replace(/\r\n|\r|\n/g,e);r.push(new yi(l,Pt(l)))}this.create(r,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new Uw(this,e)}getOffsetAt(e,t){let i=0,n=this.root;for(;n!==B;)if(n.left!==B&&n.lf_left+1>=e)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt+1>=e){i+=n.size_left;const s=this.getAccumulatedValue(n,e-n.lf_left-2);return i+=s+t-1}else e-=n.lf_left+n.piece.lineFeedCnt,i+=n.size_left+n.piece.length,n=n.right;return i}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,i=0;const n=e;for(;t!==B;)if(t.size_left!==0&&t.size_left>=e)t=t.left;else if(t.size_left+t.piece.length>=e){const s=this.getIndexOf(t,e-t.size_left);if(i+=t.lf_left+s.index,s.index===0){const o=this.getOffsetAt(i+1,1),r=n-o;return new D(i+1,r+1)}return new D(i+1,s.remainder+1)}else if(e-=t.size_left+t.piece.length,i+=t.lf_left+t.piece.lineFeedCnt,t.right===B){const s=this.getOffsetAt(i+1,1),o=n-e-s;return new D(i+1,o+1)}else t=t.right;return new D(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";const i=this.nodeAt2(e.startLineNumber,e.startColumn),n=this.nodeAt2(e.endLineNumber,e.endColumn),s=this.getValueInRange2(i,n);return t?t!==this._EOL||!this._EOLNormalized?s.replace(/\r\n|\r|\n/g,t):t===this.getEOL()&&this._EOLNormalized?s:s.replace(/\r\n|\r|\n/g,t):s}getValueInRange2(e,t){if(e.node===t.node){const r=e.node,l=this._buffers[r.piece.bufferIndex].buffer,h=this.offsetInBuffer(r.piece.bufferIndex,r.piece.start);return l.substring(h+e.remainder,h+t.remainder)}let i=e.node;const n=this._buffers[i.piece.bufferIndex].buffer,s=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);let o=n.substring(s+e.remainder,s+i.piece.length);for(i=i.next();i!==B;){const r=this._buffers[i.piece.bufferIndex].buffer,l=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);if(i===t.node){o+=r.substring(l,l+t.remainder);break}else o+=r.substr(l,i.piece.length);i=i.next()}return o}getLinesContent(){const e=[];let t=0,i="",n=!1;return this.iterate(this.root,s=>{if(s===B)return!0;const o=s.piece;let r=o.length;if(r===0)return!0;const l=this._buffers[o.bufferIndex].buffer,h=this._buffers[o.bufferIndex].lineStarts,c=o.start.line,d=o.end.line;let u=h[c]+o.start.column;if(n&&(l.charCodeAt(u)===10&&(u++,r--),e[t++]=i,i="",n=!1,r===0))return!0;if(c===d)return!this._EOLNormalized&&l.charCodeAt(u+r-1)===13?(n=!0,i+=l.substr(u,r-1)):i+=l.substr(u,r),!0;i+=this._EOLNormalized?l.substring(u,Math.max(u,h[c+1]-this._EOLLength)):l.substring(u,h[c+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=i;for(let g=c+1;g<d;g++)i=this._EOLNormalized?l.substring(h[g],h[g+1]-this._EOLLength):l.substring(h[g],h[g+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=i;return!this._EOLNormalized&&l.charCodeAt(h[d]+o.end.column-1)===13?(n=!0,o.end.column===0?t--:i=l.substr(h[d],o.end.column-1)):i=l.substr(h[d],o.end.column),!0}),n&&(e[t++]=i,i=""),e[t++]=i,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(e){if(e.remainder===e.node.piece.length){const t=e.node.next();if(!t)return 0;const i=this._buffers[t.piece.bufferIndex],n=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return i.buffer.charCodeAt(n)}else{const t=this._buffers[e.node.piece.bufferIndex],n=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(n)}}getLineCharCode(e,t){const i=this.nodeAt2(e,t+1);return this._getCharCode(i)}getLineLength(e){if(e===this.getLineCount()){const t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}findMatchesInNode(e,t,i,n,s,o,r,l,h,c,d){const u=this._buffers[e.piece.bufferIndex],g=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),f=this.offsetInBuffer(e.piece.bufferIndex,s),m=this.offsetInBuffer(e.piece.bufferIndex,o);let _;const C={line:0,column:0};let p,b;t._wordSeparators?(p=u.buffer.substring(f,m),b=w=>w+f,t.reset(0)):(p=u.buffer,b=w=>w,t.reset(f));do if(_=t.next(p),_){if(b(_.index)>=m)return c;this.positionInBuffer(e,b(_.index)-g,C);const w=this.getLineFeedCnt(e.piece.bufferIndex,s,C),L=C.line===s.line?C.column-s.column+n:C.column+1,S=L+_[0].length;if(d[c++]=Si(new v(i+w,L,i+w,S),_,l),b(_.index)+_[0].length>=m||c>=h)return c}while(_);return c}findMatchesLineByLine(e,t,i,n){const s=[];let o=0;const r=new rs(t.wordSeparators,t.regex);let l=this.nodeAt2(e.startLineNumber,e.startColumn);if(l===null)return[];const h=this.nodeAt2(e.endLineNumber,e.endColumn);if(h===null)return[];let c=this.positionInBuffer(l.node,l.remainder);const d=this.positionInBuffer(h.node,h.remainder);if(l.node===h.node)return this.findMatchesInNode(l.node,r,e.startLineNumber,e.startColumn,c,d,t,i,n,o,s),s;let u=e.startLineNumber,g=l.node;for(;g!==h.node;){const m=this.getLineFeedCnt(g.piece.bufferIndex,c,g.piece.end);if(m>=1){const C=this._buffers[g.piece.bufferIndex].lineStarts,p=this.offsetInBuffer(g.piece.bufferIndex,g.piece.start),b=C[c.line+m],w=u===e.startLineNumber?e.startColumn:1;if(o=this.findMatchesInNode(g,r,u,w,c,this.positionInBuffer(g,b-p),t,i,n,o,s),o>=n)return s;u+=m}const _=u===e.startLineNumber?e.startColumn-1:0;if(u===e.endLineNumber){const C=this.getLineContent(u).substring(_,e.endColumn-1);return o=this._findMatchesInLine(t,r,C,e.endLineNumber,_,o,s,i,n),s}if(o=this._findMatchesInLine(t,r,this.getLineContent(u).substr(_),u,_,o,s,i,n),o>=n)return s;u++,l=this.nodeAt2(u,1),g=l.node,c=this.positionInBuffer(l.node,l.remainder)}if(u===e.endLineNumber){const m=u===e.startLineNumber?e.startColumn-1:0,_=this.getLineContent(u).substring(m,e.endColumn-1);return o=this._findMatchesInLine(t,r,_,e.endLineNumber,m,o,s,i,n),s}const f=u===e.startLineNumber?e.startColumn:1;return o=this.findMatchesInNode(h.node,r,u,f,c,d,t,i,n,o,s),s}_findMatchesInLine(e,t,i,n,s,o,r,l,h){const c=e.wordSeparators;if(!l&&e.simpleSearch){const u=e.simpleSearch,g=u.length,f=i.length;let m=-g;for(;(m=i.indexOf(u,m+g))!==-1;)if((!c||Fl(c,i,f,m,g))&&(r[o++]=new Wo(new v(n,m+1+s,n,m+1+g+s),null),o>=h))return o;return o}let d;t.reset(0);do if(d=t.next(i),d&&(r[o++]=Si(new v(n,d.index+1+s,n,d.index+1+d[0].length+s),d,l),o>=h))return o;while(d);return o}insert(e,t,i=!1){if(this._EOLNormalized=this._EOLNormalized&&i,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==B){const{node:n,remainder:s,nodeStartOffset:o}=this.nodeAt(e),r=n.piece,l=r.bufferIndex,h=this.positionInBuffer(n,s);if(n.piece.bufferIndex===0&&r.end.line===this._lastChangeBufferPos.line&&r.end.column===this._lastChangeBufferPos.column&&o+r.length===e&&t.length<Mt){this.appendToNode(n,t),this.computeBufferMetadata();return}if(o===e)this.insertContentToNodeLeft(t,n),this._searchCache.validate(e);else if(o+n.piece.length>e){const c=[];let d=new $e(r.bufferIndex,h,r.end,this.getLineFeedCnt(r.bufferIndex,h,r.end),this.offsetInBuffer(l,r.end)-this.offsetInBuffer(l,h));if(this.shouldCheckCRLF()&&this.endWithCR(t)&&this.nodeCharCodeAt(n,s)===10){const m={line:d.start.line+1,column:0};d=new $e(d.bufferIndex,m,d.end,this.getLineFeedCnt(d.bufferIndex,m,d.end),d.length-1),t+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(t))if(this.nodeCharCodeAt(n,s-1)===13){const m=this.positionInBuffer(n,s-1);this.deleteNodeTail(n,m),t="\r"+t,n.piece.length===0&&c.push(n)}else this.deleteNodeTail(n,h);else this.deleteNodeTail(n,h);const u=this.createNewPieces(t);d.length>0&&this.rbInsertRight(n,d);let g=n;for(let f=0;f<u.length;f++)g=this.rbInsertRight(g,u[f]);this.deleteNodes(c)}else this.insertContentToNodeRight(t,n)}else{const n=this.createNewPieces(t);let s=this.rbInsertLeft(null,n[0]);for(let o=1;o<n.length;o++)s=this.rbInsertRight(s,n[o])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===B)return;const i=this.nodeAt(e),n=this.nodeAt(e+t),s=i.node,o=n.node;if(s===o){const u=this.positionInBuffer(s,i.remainder),g=this.positionInBuffer(s,n.remainder);if(i.nodeStartOffset===e){if(t===s.piece.length){const f=s.next();fo(this,s),this.validateCRLFWithPrevNode(f),this.computeBufferMetadata();return}this.deleteNodeHead(s,g),this._searchCache.validate(e),this.validateCRLFWithPrevNode(s),this.computeBufferMetadata();return}if(i.nodeStartOffset+s.piece.length===e+t){this.deleteNodeTail(s,u),this.validateCRLFWithNextNode(s),this.computeBufferMetadata();return}this.shrinkNode(s,u,g),this.computeBufferMetadata();return}const r=[],l=this.positionInBuffer(s,i.remainder);this.deleteNodeTail(s,l),this._searchCache.validate(e),s.piece.length===0&&r.push(s);const h=this.positionInBuffer(o,n.remainder);this.deleteNodeHead(o,h),o.piece.length===0&&r.push(o);const c=s.next();for(let u=c;u!==B&&u!==o;u=u.next())r.push(u);const d=s.piece.length===0?s.prev():s;this.deleteNodes(r),this.validateCRLFWithNextNode(d),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){const i=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){const o=t.piece,r={line:o.start.line+1,column:0},l=new $e(o.bufferIndex,r,o.end,this.getLineFeedCnt(o.bufferIndex,r,o.end),o.length-1);t.piece=l,e+=`
`,Ot(this,t,-1,-1),t.piece.length===0&&i.push(t)}const n=this.createNewPieces(e);let s=this.rbInsertLeft(t,n[n.length-1]);for(let o=n.length-2;o>=0;o--)s=this.rbInsertLeft(s,n[o]);this.validateCRLFWithPrevNode(s),this.deleteNodes(i)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+=`
`);const i=this.createNewPieces(e),n=this.rbInsertRight(t,i[0]);let s=n;for(let o=1;o<i.length;o++)s=this.rbInsertRight(s,i[o]);this.validateCRLFWithPrevNode(n)}positionInBuffer(e,t,i){const n=e.piece,s=e.piece.bufferIndex,o=this._buffers[s].lineStarts,l=o[n.start.line]+n.start.column+t;let h=n.start.line,c=n.end.line,d=0,u=0,g=0;for(;h<=c&&(d=h+(c-h)/2|0,g=o[d],d!==c);)if(u=o[d+1],l<g)c=d-1;else if(l>=u)h=d+1;else break;return i?(i.line=d,i.column=l-g,null):{line:d,column:l-g}}getLineFeedCnt(e,t,i){if(i.column===0)return i.line-t.line;const n=this._buffers[e].lineStarts;if(i.line===n.length-1)return i.line-t.line;const s=n[i.line+1],o=n[i.line]+i.column;if(s>o+1)return i.line-t.line;const r=o-1;return this._buffers[e].buffer.charCodeAt(r)===13?i.line-t.line+1:i.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)fo(this,e[t])}createNewPieces(e){if(e.length>Mt){const c=[];for(;e.length>Mt;){const u=e.charCodeAt(Mt-1);let g;u===13||u>=55296&&u<=56319?(g=e.substring(0,Mt-1),e=e.substring(Mt-1)):(g=e.substring(0,Mt),e=e.substring(Mt));const f=Pt(g);c.push(new $e(this._buffers.length,{line:0,column:0},{line:f.length-1,column:g.length-f[f.length-1]},f.length-1,g.length)),this._buffers.push(new yi(g,f))}const d=Pt(e);return c.push(new $e(this._buffers.length,{line:0,column:0},{line:d.length-1,column:e.length-d[d.length-1]},d.length-1,e.length)),this._buffers.push(new yi(e,d)),c}let t=this._buffers[0].buffer.length;const i=Pt(e,!1);let n=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&t!==0&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},n=this._lastChangeBufferPos;for(let c=0;c<i.length;c++)i[c]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(i.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(t!==0)for(let c=0;c<i.length;c++)i[c]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(i.slice(1)),this._buffers[0].buffer+=e}const s=this._buffers[0].buffer.length,o=this._buffers[0].lineStarts.length-1,r=s-this._buffers[0].lineStarts[o],l={line:o,column:r},h=new $e(0,n,l,this.getLineFeedCnt(0,n,l),s-t);return this._lastChangeBufferPos=l,[h]}getLineRawContent(e,t=0){let i=this.root,n="";const s=this._searchCache.get2(e);if(s){i=s.node;const o=this.getAccumulatedValue(i,e-s.nodeStartLineNumber-1),r=this._buffers[i.piece.bufferIndex].buffer,l=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);if(s.nodeStartLineNumber+i.piece.lineFeedCnt===e)n=r.substring(l+o,l+i.piece.length);else{const h=this.getAccumulatedValue(i,e-s.nodeStartLineNumber);return r.substring(l+o,l+h-t)}}else{let o=0;const r=e;for(;i!==B;)if(i.left!==B&&i.lf_left>=e-1)i=i.left;else if(i.lf_left+i.piece.lineFeedCnt>e-1){const l=this.getAccumulatedValue(i,e-i.lf_left-2),h=this.getAccumulatedValue(i,e-i.lf_left-1),c=this._buffers[i.piece.bufferIndex].buffer,d=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);return o+=i.size_left,this._searchCache.set({node:i,nodeStartOffset:o,nodeStartLineNumber:r-(e-1-i.lf_left)}),c.substring(d+l,d+h-t)}else if(i.lf_left+i.piece.lineFeedCnt===e-1){const l=this.getAccumulatedValue(i,e-i.lf_left-2),h=this._buffers[i.piece.bufferIndex].buffer,c=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);n=h.substring(c+l,c+i.piece.length);break}else e-=i.lf_left+i.piece.lineFeedCnt,o+=i.size_left+i.piece.length,i=i.right}for(i=i.next();i!==B;){const o=this._buffers[i.piece.bufferIndex].buffer;if(i.piece.lineFeedCnt>0){const r=this.getAccumulatedValue(i,0),l=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);return n+=o.substring(l,l+r-t),n}else{const r=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);n+=o.substr(r,i.piece.length)}i=i.next()}return n}computeBufferMetadata(){let e=this.root,t=1,i=0;for(;e!==B;)t+=e.lf_left+e.piece.lineFeedCnt,i+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=i,this._searchCache.validate(this._length)}getIndexOf(e,t){const i=e.piece,n=this.positionInBuffer(e,t),s=n.line-i.start.line;if(this.offsetInBuffer(i.bufferIndex,i.end)-this.offsetInBuffer(i.bufferIndex,i.start)===t){const o=this.getLineFeedCnt(e.piece.bufferIndex,i.start,n);if(o!==s)return{index:o,remainder:0}}return{index:s,remainder:n.column}}getAccumulatedValue(e,t){if(t<0)return 0;const i=e.piece,n=this._buffers[i.bufferIndex].lineStarts,s=i.start.line+t+1;return s>i.end.line?n[i.end.line]+i.end.column-n[i.start.line]-i.start.column:n[s]-n[i.start.line]-i.start.column}deleteNodeTail(e,t){const i=e.piece,n=i.lineFeedCnt,s=this.offsetInBuffer(i.bufferIndex,i.end),o=t,r=this.offsetInBuffer(i.bufferIndex,o),l=this.getLineFeedCnt(i.bufferIndex,i.start,o),h=l-n,c=r-s,d=i.length+c;e.piece=new $e(i.bufferIndex,i.start,o,l,d),Ot(this,e,c,h)}deleteNodeHead(e,t){const i=e.piece,n=i.lineFeedCnt,s=this.offsetInBuffer(i.bufferIndex,i.start),o=t,r=this.getLineFeedCnt(i.bufferIndex,o,i.end),l=this.offsetInBuffer(i.bufferIndex,o),h=r-n,c=s-l,d=i.length+c;e.piece=new $e(i.bufferIndex,o,i.end,r,d),Ot(this,e,c,h)}shrinkNode(e,t,i){const n=e.piece,s=n.start,o=n.end,r=n.length,l=n.lineFeedCnt,h=t,c=this.getLineFeedCnt(n.bufferIndex,n.start,h),d=this.offsetInBuffer(n.bufferIndex,t)-this.offsetInBuffer(n.bufferIndex,s);e.piece=new $e(n.bufferIndex,n.start,h,c,d),Ot(this,e,d-r,c-l);const u=new $e(n.bufferIndex,i,o,this.getLineFeedCnt(n.bufferIndex,i,o),this.offsetInBuffer(n.bufferIndex,o)-this.offsetInBuffer(n.bufferIndex,i)),g=this.rbInsertRight(e,u);this.validateCRLFWithPrevNode(g)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+=`
`);const i=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),n=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const s=Pt(t,!1);for(let g=0;g<s.length;g++)s[g]+=n;if(i){const g=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:n-g}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(s.slice(1));const o=this._buffers[0].lineStarts.length-1,r=this._buffers[0].buffer.length-this._buffers[0].lineStarts[o],l={line:o,column:r},h=e.piece.length+t.length,c=e.piece.lineFeedCnt,d=this.getLineFeedCnt(0,e.piece.start,l),u=d-c;e.piece=new $e(e.piece.bufferIndex,e.piece.start,l,d,h),this._lastChangeBufferPos=l,Ot(this,e,t.length,u)}nodeAt(e){let t=this.root;const i=this._searchCache.get(e);if(i)return{node:i.node,nodeStartOffset:i.nodeStartOffset,remainder:e-i.nodeStartOffset};let n=0;for(;t!==B;)if(t.size_left>e)t=t.left;else if(t.size_left+t.piece.length>=e){n+=t.size_left;const s={node:t,remainder:e-t.size_left,nodeStartOffset:n};return this._searchCache.set(s),s}else e-=t.size_left+t.piece.length,n+=t.size_left+t.piece.length,t=t.right;return null}nodeAt2(e,t){let i=this.root,n=0;for(;i!==B;)if(i.left!==B&&i.lf_left>=e-1)i=i.left;else if(i.lf_left+i.piece.lineFeedCnt>e-1){const s=this.getAccumulatedValue(i,e-i.lf_left-2),o=this.getAccumulatedValue(i,e-i.lf_left-1);return n+=i.size_left,{node:i,remainder:Math.min(s+t-1,o),nodeStartOffset:n}}else if(i.lf_left+i.piece.lineFeedCnt===e-1){const s=this.getAccumulatedValue(i,e-i.lf_left-2);if(s+t-1<=i.piece.length)return{node:i,remainder:s+t-1,nodeStartOffset:n};t-=i.piece.length-s;break}else e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right;for(i=i.next();i!==B;){if(i.piece.lineFeedCnt>0){const s=this.getAccumulatedValue(i,0),o=this.offsetOfNode(i);return{node:i,remainder:Math.min(t-1,s),nodeStartOffset:o}}else if(i.piece.length>=t-1){const s=this.offsetOfNode(i);return{node:i,remainder:t-1,nodeStartOffset:s}}else t-=i.piece.length;i=i.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;const i=this._buffers[e.piece.bufferIndex],n=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return i.buffer.charCodeAt(n)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(e){if(typeof e=="string")return e.charCodeAt(0)===10;if(e===B||e.piece.lineFeedCnt===0)return!1;const t=e.piece,i=this._buffers[t.bufferIndex].lineStarts,n=t.start.line,s=i[n]+t.start.column;return n===i.length-1||i[n+1]>s+1?!1:this._buffers[t.bufferIndex].buffer.charCodeAt(s)===10}endWithCR(e){return typeof e=="string"?e.charCodeAt(e.length-1)===13:e===B||e.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(e,e.piece.length-1)===13}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){const t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){const i=[],n=this._buffers[e.piece.bufferIndex].lineStarts;let s;e.piece.end.column===0?s={line:e.piece.end.line-1,column:n[e.piece.end.line]-n[e.piece.end.line-1]-1}:s={line:e.piece.end.line,column:e.piece.end.column-1};const o=e.piece.length-1,r=e.piece.lineFeedCnt-1;e.piece=new $e(e.piece.bufferIndex,e.piece.start,s,r,o),Ot(this,e,-1,-1),e.piece.length===0&&i.push(e);const l={line:t.piece.start.line+1,column:0},h=t.piece.length-1,c=this.getLineFeedCnt(t.piece.bufferIndex,l,t.piece.end);t.piece=new $e(t.piece.bufferIndex,l,t.piece.end,c,h),Ot(this,t,-1,-1),t.piece.length===0&&i.push(t);const d=this.createNewPieces(`\r
`);this.rbInsertRight(e,d[0]);for(let u=0;u<i.length;u++)fo(this,i[u])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const i=t.next();if(this.startWithLF(i)){if(e+=`
`,i.piece.length===1)fo(this,i);else{const n=i.piece,s={line:n.start.line+1,column:0},o=n.length-1,r=this.getLineFeedCnt(n.bufferIndex,s,n.end);i.piece=new $e(n.bufferIndex,s,n.end,r,o),Ot(this,i,-1,-1)}return!0}}return!1}iterate(e,t){if(e===B)return t(B);const i=this.iterate(e.left,t);return i&&t(e)&&this.iterate(e.right,t)}getNodeContent(e){if(e===B)return"";const t=this._buffers[e.piece.bufferIndex],i=e.piece,n=this.offsetInBuffer(i.bufferIndex,i.start),s=this.offsetInBuffer(i.bufferIndex,i.end);return t.buffer.substring(n,s)}getPieceContent(e){const t=this._buffers[e.bufferIndex],i=this.offsetInBuffer(e.bufferIndex,e.start),n=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(i,n)}rbInsertRight(e,t){const i=new il(t,1);if(i.left=B,i.right=B,i.parent=B,i.size_left=0,i.lf_left=0,this.root===B)this.root=i,i.color=0;else if(e.right===B)e.right=i,i.parent=e;else{const s=Xl(e.right);s.left=i,i.parent=s}return Tc(this,i),i}rbInsertLeft(e,t){const i=new il(t,1);if(i.left=B,i.right=B,i.parent=B,i.size_left=0,i.lf_left=0,this.root===B)this.root=i,i.color=0;else if(e.left===B)e.left=i,i.parent=e;else{const n=sg(e.left);n.right=i,i.parent=n}return Tc(this,i),i}}class Mn extends H{constructor(e,t,i,n,s,o,r){super(),this._onDidChangeContent=this._register(new M),this._BOM=t,this._mightContainNonBasicASCII=!o,this._mightContainRTL=n,this._mightContainUnusualLineTerminators=s,this._pieceTree=new $w(e,i,r)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}getOffsetAt(e,t){return this._pieceTree.getOffsetAt(e,t)}getPositionAt(e){return this._pieceTree.getPositionAt(e)}getRangeAt(e,t){const i=e+t,n=this.getPositionAt(e),s=this.getPositionAt(i);return new v(n.lineNumber,n.column,s.lineNumber,s.column)}getValueInRange(e,t=0){if(e.isEmpty())return"";const i=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,i)}getValueLengthInRange(e,t=0){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;const i=this.getOffsetAt(e.startLineNumber,e.startColumn),n=this.getOffsetAt(e.endLineNumber,e.endColumn);let s=0;const o=this._getEndOfLine(t),r=this.getEOL();if(o.length!==r.length){const l=o.length-r.length,h=e.endLineNumber-e.startLineNumber;s=l*h}return n-i+s}getCharacterCountInRange(e,t=0){if(this._mightContainNonBasicASCII){let i=0;const n=e.startLineNumber,s=e.endLineNumber;for(let o=n;o<=s;o++){const r=this.getLineContent(o),l=o===n?e.startColumn-1:0,h=o===s?e.endColumn-1:r.length;for(let c=l;c<h;c++)We(r.charCodeAt(c))?(i=i+1,c=c+1):i=i+1}return i+=this._getEndOfLine(t).length*(s-n),i}return this.getValueLengthInRange(e,t)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(e){return this._pieceTree.getLineContent(e)}getLineCharCode(e,t){return this._pieceTree.getLineCharCode(e,t)}getLineLength(e){return this._pieceTree.getLineLength(e)}getLineFirstNonWhitespaceColumn(e){const t=Je(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=Kn(this.getLineContent(e));return t===-1?0:t+2}_getEndOfLine(e){switch(e){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(e){this._pieceTree.setEOL(e)}applyEdits(e,t,i){let n=this._mightContainRTL,s=this._mightContainUnusualLineTerminators,o=this._mightContainNonBasicASCII,r=!0,l=[];for(let m=0;m<e.length;m++){const _=e[m];r&&_._isTracked&&(r=!1);const C=_.range;if(_.text){let S=!0;o||(S=!Hd(_.text),o=S),!n&&S&&(n=Es(_.text)),!s&&S&&(s=zd(_.text))}let p="",b=0,w=0,L=0;if(_.text){let S;[b,w,L,S]=Un(_.text);const y=this.getEOL();S===0||S===(y===`\r
`?2:1)?p=_.text:p=_.text.replace(/\r\n|\r|\n/g,y)}l[m]={sortIndex:m,identifier:_.identifier||null,range:C,rangeOffset:this.getOffsetAt(C.startLineNumber,C.startColumn),rangeLength:this.getValueLengthInRange(C),text:p,eolCount:b,firstLineLength:w,lastLineLength:L,forceMoveMarkers:!!_.forceMoveMarkers,isAutoWhitespaceEdit:_.isAutoWhitespaceEdit||!1}}l.sort(Mn._sortOpsAscending);let h=!1;for(let m=0,_=l.length-1;m<_;m++){const C=l[m].range.getEndPosition(),p=l[m+1].range.getStartPosition();if(p.isBeforeOrEqual(C)){if(p.isBefore(C))throw new Error("Overlapping ranges are not allowed!");h=!0}}r&&(l=this._reduceOperations(l));const c=i||t?Mn._getInverseEditRanges(l):[],d=[];if(t)for(let m=0;m<l.length;m++){const _=l[m],C=c[m];if(_.isAutoWhitespaceEdit&&_.range.isEmpty())for(let p=C.startLineNumber;p<=C.endLineNumber;p++){let b="";p===C.startLineNumber&&(b=this.getLineContent(_.range.startLineNumber),Je(b)!==-1)||d.push({lineNumber:p,oldContent:b})}}let u=null;if(i){let m=0;u=[];for(let _=0;_<l.length;_++){const C=l[_],p=c[_],b=this.getValueInRange(C.range),w=C.rangeOffset+m;m+=C.text.length-b.length,u[_]={sortIndex:C.sortIndex,identifier:C.identifier,range:p,text:b,textChange:new ye(C.rangeOffset,b,w,C.text)}}h||u.sort((_,C)=>_.sortIndex-C.sortIndex)}this._mightContainRTL=n,this._mightContainUnusualLineTerminators=s,this._mightContainNonBasicASCII=o;const g=this._doApplyEdits(l);let f=null;if(t&&d.length>0){d.sort((m,_)=>_.lineNumber-m.lineNumber),f=[];for(let m=0,_=d.length;m<_;m++){const C=d[m].lineNumber;if(m>0&&d[m-1].lineNumber===C)continue;const p=d[m].oldContent,b=this.getLineContent(C);b.length===0||b===p||Je(b)!==-1||f.push(C)}}return this._onDidChangeContent.fire(),new O_(u,g,f)}_reduceOperations(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}_toSingleEditOperation(e){let t=!1;const i=e[0].range,n=e[e.length-1].range,s=new v(i.startLineNumber,i.startColumn,n.endLineNumber,n.endColumn);let o=i.startLineNumber,r=i.startColumn;const l=[];for(let g=0,f=e.length;g<f;g++){const m=e[g],_=m.range;t=t||m.forceMoveMarkers,l.push(this.getValueInRange(new v(o,r,_.startLineNumber,_.startColumn))),m.text.length>0&&l.push(m.text),o=_.endLineNumber,r=_.endColumn}const h=l.join(""),[c,d,u]=Un(h);return{sortIndex:0,identifier:e[0].identifier,range:s,rangeOffset:this.getOffsetAt(s.startLineNumber,s.startColumn),rangeLength:this.getValueLengthInRange(s,0),text:h,eolCount:c,firstLineLength:d,lastLineLength:u,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}_doApplyEdits(e){e.sort(Mn._sortOpsDescending);const t=[];for(let i=0;i<e.length;i++){const n=e[i],s=n.range.startLineNumber,o=n.range.startColumn,r=n.range.endLineNumber,l=n.range.endColumn;if(s===r&&o===l&&n.text.length===0)continue;n.text?(this._pieceTree.delete(n.rangeOffset,n.rangeLength),this._pieceTree.insert(n.rangeOffset,n.text,!0)):this._pieceTree.delete(n.rangeOffset,n.rangeLength);const h=new v(s,o,r,l);t.push({range:h,rangeLength:n.rangeLength,text:n.text,rangeOffset:n.rangeOffset,forceMoveMarkers:n.forceMoveMarkers})}return t}findMatchesLineByLine(e,t,i,n){return this._pieceTree.findMatchesLineByLine(e,t,i,n)}static _getInverseEditRanges(e){const t=[];let i=0,n=0,s=null;for(let o=0,r=e.length;o<r;o++){const l=e[o];let h,c;s?s.range.endLineNumber===l.range.startLineNumber?(h=i,c=n+(l.range.startColumn-s.range.endColumn)):(h=i+(l.range.startLineNumber-s.range.endLineNumber),c=l.range.startColumn):(h=l.range.startLineNumber,c=l.range.startColumn);let d;if(l.text.length>0){const u=l.eolCount+1;u===1?d=new v(h,c,h,c+l.firstLineLength):d=new v(h,c,h+u-1,l.lastLineLength+1)}else d=new v(h,c,h,c);i=d.endLineNumber,n=d.endColumn,t.push(d),s=l}return t}static _sortOpsAscending(e,t){const i=v.compareRangesUsingEnds(e.range,t.range);return i===0?e.sortIndex-t.sortIndex:i}static _sortOpsDescending(e,t){const i=v.compareRangesUsingEnds(e.range,t.range);return i===0?t.sortIndex-e.sortIndex:-i}}class Gw{constructor(e,t,i,n,s,o,r,l,h){this._chunks=e,this._bom=t,this._cr=i,this._lf=n,this._crlf=s,this._containsRTL=o,this._containsUnusualLineTerminators=r,this._isBasicASCII=l,this._normalizeEOL=h}_getEOL(e){const t=this._cr+this._lf+this._crlf,i=this._cr+this._crlf;return t===0?e===1?`
`:`\r
`:i>t/2?`\r
`:`
`}create(e){const t=this._getEOL(e),i=this._chunks;if(this._normalizeEOL&&(t===`\r
`&&(this._cr>0||this._lf>0)||t===`
`&&(this._cr>0||this._crlf>0)))for(let s=0,o=i.length;s<o;s++){const r=i[s].buffer.replace(/\r\n|\r|\n/g,t),l=Pt(r);i[s]=new yi(r,l)}const n=new Mn(i,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:n,disposable:n}}}class rg{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(e.length===0)return;this.chunks.length===0&&Jg(e)&&(this.BOM=ef,e=e.substr(1));const t=e.charCodeAt(e.length-1);t===13||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){!t&&e.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=zw(this._tmpLineStarts,e);this.chunks.push(new yi(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,t.isBasicASCII||(this.isBasicASCII=!1,this.containsRTL||(this.containsRTL=Es(e)),this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=zd(e)))}finish(e=!0){return this._finish(),new Gw(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);const t=Pt(e.buffer);e.lineStarts=t,this._previousChar===13&&this.cr++}}}class Kw{constructor(e){this._default=e,this._store=[]}get(e){return e<this._store.length?this._store[e]:this._default}set(e,t){for(;e>=this._store.length;)this._store[this._store.length]=this._default;this._store[e]=t}replace(e,t,i){if(e>=this._store.length)return;if(t===0){this.insert(e,i);return}else if(i===0){this.delete(e,t);return}const n=this._store.slice(0,e),s=this._store.slice(e+t),o=qw(i,this._default);this._store=n.concat(o,s)}delete(e,t){t===0||e>=this._store.length||this._store.splice(e,t)}insert(e,t){if(t===0||e>=this._store.length)return;const i=[];for(let n=0;n<t;n++)i[n]=this._default;this._store=Nr(this._store,e,i)}}function qw(a,e){const t=[];for(let i=0;i<a;i++)t[i]=e;return t}class Zw{get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._startLineNumber+this._tokens.length-1}constructor(e,t){this._startLineNumber=e,this._tokens=t}getLineTokens(e){return this._tokens[e-this._startLineNumber]}appendLineTokens(e){this._tokens.push(e)}}class nl{constructor(){this._tokens=[]}add(e,t){if(this._tokens.length>0){const i=this._tokens[this._tokens.length-1];if(i.endLineNumber+1===e){i.appendLineTokens(t);return}}this._tokens.push(new Zw(e,[t]))}finalize(){return this._tokens}}class Qw{constructor(e,t){this.tokenizationSupport=t,this.initialState=this.tokenizationSupport.getInitialState(),this.store=new sl(e)}getStartState(e){return this.store.getStartState(e,this.initialState)}getFirstInvalidLine(){return this.store.getFirstInvalidLine(this.initialState)}}class Yw extends Qw{constructor(e,t,i,n){super(e,t),this._textModel=i,this._languageIdCodec=n}updateTokensUntilLine(e,t){const i=this._textModel.getLanguageId();for(;;){const n=this.getFirstInvalidLine();if(!n||n.lineNumber>t)break;const s=this._textModel.getLineContent(n.lineNumber),o=es(this._languageIdCodec,i,this.tokenizationSupport,s,!0,n.startState);e.add(n.lineNumber,o.tokens),this.store.setEndState(n.lineNumber,o.endState)}}getTokenTypeIfInsertingCharacter(e,t){const i=this.getStartState(e.lineNumber);if(!i)return 0;const n=this._textModel.getLanguageId(),s=this._textModel.getLineContent(e.lineNumber),o=s.substring(0,e.column-1)+t+s.substring(e.column-1),r=es(this._languageIdCodec,n,this.tokenizationSupport,o,!0,i),l=new st(r.tokens,o,this._languageIdCodec);if(l.getCount()===0)return 0;const h=l.findTokenIndexAtOffset(e.column-1);return l.getStandardTokenType(h)}tokenizeLineWithEdit(e,t,i){const n=e.lineNumber,s=e.column,o=this.getStartState(n);if(!o)return null;const r=this._textModel.getLineContent(n),l=r.substring(0,s-1)+i+r.substring(s-1+t),h=this._textModel.getLanguageIdAtPosition(n,0),c=es(this._languageIdCodec,h,this.tokenizationSupport,l,!0,o);return new st(c.tokens,l,this._languageIdCodec)}hasAccurateTokensForLine(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t}isCheapToTokenize(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t||e===t&&this._textModel.getLineLength(e)<2048}tokenizeHeuristically(e,t,i){if(i<=this.store.getFirstInvalidEndStateLineNumberOrMax())return{heuristicTokens:!1};if(t<=this.store.getFirstInvalidEndStateLineNumberOrMax())return this.updateTokensUntilLine(e,i),{heuristicTokens:!1};let n=this.guessStartState(t);const s=this._textModel.getLanguageId();for(let o=t;o<=i;o++){const r=this._textModel.getLineContent(o),l=es(this._languageIdCodec,s,this.tokenizationSupport,r,!0,n);e.add(o,l.tokens),n=l.endState}return{heuristicTokens:!0}}guessStartState(e){let t=this._textModel.getLineFirstNonWhitespaceColumn(e);const i=[];let n=null;for(let r=e-1;t>1&&r>=1;r--){const l=this._textModel.getLineFirstNonWhitespaceColumn(r);if(l!==0&&l<t&&(i.push(this._textModel.getLineContent(r)),t=l,n=this.getStartState(r),n))break}n||(n=this.tokenizationSupport.getInitialState()),i.reverse();const s=this._textModel.getLanguageId();let o=n;for(const r of i)o=es(this._languageIdCodec,s,this.tokenizationSupport,r,!1,o).endState;return o}}class sl{constructor(e){this.lineCount=e,this._tokenizationStateStore=new Xw,this._invalidEndStatesLineNumbers=new Jw,this._invalidEndStatesLineNumbers.addRange(new _e(1,e+1))}getEndState(e){return this._tokenizationStateStore.getEndState(e)}setEndState(e,t){if(!t)throw new fe("Cannot set null/undefined state");this._invalidEndStatesLineNumbers.delete(e);const i=this._tokenizationStateStore.setEndState(e,t);return i&&e<this.lineCount&&this._invalidEndStatesLineNumbers.addRange(new _e(e+1,e+2)),i}acceptChange(e,t){this.lineCount+=t-e.length,this._tokenizationStateStore.acceptChange(e,t),this._invalidEndStatesLineNumbers.addRangeAndResize(new _e(e.startLineNumber,e.endLineNumberExclusive),t)}acceptChanges(e){for(const t of e){const[i]=Un(t.text);this.acceptChange(new Pi(t.range.startLineNumber,t.range.endLineNumber+1),i+1)}}invalidateEndStateRange(e){this._invalidEndStatesLineNumbers.addRange(new _e(e.startLineNumber,e.endLineNumberExclusive))}getFirstInvalidEndStateLineNumber(){return this._invalidEndStatesLineNumbers.min}getFirstInvalidEndStateLineNumberOrMax(){return this.getFirstInvalidEndStateLineNumber()||Number.MAX_SAFE_INTEGER}allStatesValid(){return this._invalidEndStatesLineNumbers.min===null}getStartState(e,t){return e===1?t:this.getEndState(e-1)}getFirstInvalidLine(e){const t=this.getFirstInvalidEndStateLineNumber();if(t===null)return null;const i=this.getStartState(t,e);if(!i)throw new fe("Start state must be defined");return{lineNumber:t,startState:i}}}class Xw{constructor(){this._lineEndStates=new Kw(null)}getEndState(e){return this._lineEndStates.get(e)}setEndState(e,t){const i=this._lineEndStates.get(e);return i&&i.equals(t)?!1:(this._lineEndStates.set(e,t),!0)}acceptChange(e,t){let i=e.length;t>0&&i>0&&(i--,t--),this._lineEndStates.replace(e.startLineNumber,i,t)}}class Jw{constructor(){this._ranges=[]}get min(){return this._ranges.length===0?null:this._ranges[0].start}delete(e){const t=this._ranges.findIndex(i=>i.contains(e));if(t!==-1){const i=this._ranges[t];i.start===e?i.endExclusive===e+1?this._ranges.splice(t,1):this._ranges[t]=new _e(e+1,i.endExclusive):i.endExclusive===e+1?this._ranges[t]=new _e(i.start,e):this._ranges.splice(t,1,new _e(i.start,e),new _e(e+1,i.endExclusive))}}addRange(e){_e.addRange(e,this._ranges)}addRangeAndResize(e,t){let i=0;for(;!(i>=this._ranges.length||e.start<=this._ranges[i].endExclusive);)i++;let n=i;for(;!(n>=this._ranges.length||e.endExclusive<this._ranges[n].start);)n++;const s=t-e.length;for(let o=n;o<this._ranges.length;o++)this._ranges[o]=this._ranges[o].delta(s);if(i===n){const o=new _e(e.start,e.start+t);o.isEmpty||this._ranges.splice(i,0,o)}else{const o=Math.min(e.start,this._ranges[i].start),r=Math.max(e.endExclusive,this._ranges[n-1].endExclusive),l=new _e(o,r+s);l.isEmpty?this._ranges.splice(i,n-i):this._ranges.splice(i,n-i,l)}}toString(){return this._ranges.map(e=>e.toString()).join(" + ")}}function es(a,e,t,i,n,s){let o=null;if(t)try{o=t.tokenizeEncoded(i,n,s.clone())}catch(r){Oe(r)}return o||(o=Op(a.encodeLanguageId(e),s)),st.convertToEndOffset(o.tokens,i.length),o}class eL{constructor(e,t){this._tokenizerWithStateStore=e,this._backgroundTokenStore=t,this._isDisposed=!1,this._isScheduled=!1}dispose(){this._isDisposed=!0}handleChanges(){this._beginBackgroundTokenization()}_beginBackgroundTokenization(){this._isScheduled||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._isScheduled=!0,tf(e=>{this._isScheduled=!1,this._backgroundTokenizeWithDeadline(e)}))}_backgroundTokenizeWithDeadline(e){const t=Date.now()+e.timeRemaining(),i=()=>{this._isDisposed||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._backgroundTokenizeForAtLeast1ms(),Date.now()<t?sf(i):this._beginBackgroundTokenization())};i()}_backgroundTokenizeForAtLeast1ms(){const e=this._tokenizerWithStateStore._textModel.getLineCount(),t=new nl,i=nf.create(!1);do if(i.elapsed()>1||this._tokenizeOneInvalidLine(t)>=e)break;while(this._hasLinesToTokenize());this._backgroundTokenStore.setTokens(t.finalize()),this.checkFinished()}_hasLinesToTokenize(){return this._tokenizerWithStateStore?!this._tokenizerWithStateStore.store.allStatesValid():!1}_tokenizeOneInvalidLine(e){var i;const t=(i=this._tokenizerWithStateStore)==null?void 0:i.getFirstInvalidLine();return t?(this._tokenizerWithStateStore.updateTokensUntilLine(e,t.lineNumber),t.lineNumber):this._tokenizerWithStateStore._textModel.getLineCount()+1}checkFinished(){this._isDisposed||this._tokenizerWithStateStore.store.allStatesValid()&&this._backgroundTokenStore.backgroundTokenizationFinished()}requestTokens(e,t){this._tokenizerWithStateStore.store.invalidateEndStateRange(new Pi(e,t))}}class tL{constructor(){this._onDidChangeVisibleRanges=new M,this.onDidChangeVisibleRanges=this._onDidChangeVisibleRanges.event,this._views=new Set}attachView(){const e=new iL(t=>{this._onDidChangeVisibleRanges.fire({view:e,state:t})});return this._views.add(e),e}detachView(e){this._views.delete(e),this._onDidChangeVisibleRanges.fire({view:e,state:void 0})}}class iL{constructor(e){this.handleStateChange=e}setVisibleLines(e,t){const i=e.map(n=>new Pi(n.startLineNumber,n.endLineNumber+1));this.handleStateChange({visibleLineRanges:i,stabilized:t})}}class nL extends H{get lineRanges(){return this._lineRanges}constructor(e){super(),this._refreshTokens=e,this.runner=this._register(new si(()=>this.update(),50)),this._computedLineRanges=[],this._lineRanges=[]}update(){Nt(this._computedLineRanges,this._lineRanges,(e,t)=>e.equals(t))||(this._computedLineRanges=this._lineRanges,this._refreshTokens())}handleStateChange(e){this._lineRanges=e.visibleLineRanges,e.stabilized?(this.runner.cancel(),this.update()):this.runner.schedule()}}class ag extends H{get backgroundTokenizationState(){return this._backgroundTokenizationState}constructor(e,t,i){super(),this._languageIdCodec=e,this._textModel=t,this.getLanguageId=i,this._backgroundTokenizationState=1,this._onDidChangeBackgroundTokenizationState=this._register(new M),this.onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event,this._onDidChangeTokens=this._register(new M),this.onDidChangeTokens=this._onDidChangeTokens.event}tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}}class Ec extends ag{constructor(e,t,i,n){super(t,i,n),this._treeSitterService=e,this._tokenizationSupport=null,this._initialize()}_initialize(){const e=this.getLanguageId();(!this._tokenizationSupport||this._lastLanguageId!==e)&&(this._lastLanguageId=e,this._tokenizationSupport=Aa.get(e))}getLineTokens(e){const t=this._textModel.getLineContent(e);if(this._tokenizationSupport){const i=this._tokenizationSupport.tokenizeEncoded(e,this._textModel);if(i)return new st(i,t,this._languageIdCodec)}return st.createEmpty(t,this._languageIdCodec)}resetTokenization(e=!0){e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]}),this._initialize()}handleDidChangeAttached(){}handleDidChangeContent(e){e.isFlush&&this.resetTokenization(!1)}forceTokenization(e){}hasAccurateTokensForLine(e){return!0}isCheapToTokenize(e){return!0}getTokenTypeIfInsertingCharacter(e,t,i){return 0}tokenizeLineWithEdit(e,t,i){return null}get hasTokens(){return this._treeSitterService.getParseResult(this._textModel)!==void 0}}const sL=ot("treeSitterParserService"),Bt=new Uint32Array(0).buffer;class vt{static deleteBeginning(e,t){return e===null||e===Bt?e:vt.delete(e,0,t)}static deleteEnding(e,t){if(e===null||e===Bt)return e;const i=Vt(e),n=i[i.length-2];return vt.delete(e,t,n)}static delete(e,t,i){if(e===null||e===Bt||t===i)return e;const n=Vt(e),s=n.length>>>1;if(t===0&&n[n.length-2]===i)return Bt;const o=st.findIndexInTokensArray(n,t),r=o>0?n[o-1<<1]:0,l=n[o<<1];if(i<l){const g=i-t;for(let f=o;f<s;f++)n[f<<1]-=g;return e}let h,c;r!==t?(n[o<<1]=t,h=o+1<<1,c=t):(h=o<<1,c=r);const d=i-t;for(let g=o+1;g<s;g++){const f=n[g<<1]-d;f>c&&(n[h++]=f,n[h++]=n[(g<<1)+1],c=f)}if(h===n.length)return e;const u=new Uint32Array(h);return u.set(n.subarray(0,h),0),u.buffer}static append(e,t){if(t===Bt)return e;if(e===Bt)return t;if(e===null)return e;if(t===null)return null;const i=Vt(e),n=Vt(t),s=n.length>>>1,o=new Uint32Array(i.length+n.length);o.set(i,0);let r=i.length;const l=i[i.length-2];for(let h=0;h<s;h++)o[r++]=n[h<<1]+l,o[r++]=n[(h<<1)+1];return o.buffer}static insert(e,t,i){if(e===null||e===Bt)return e;const n=Vt(e),s=n.length>>>1;let o=st.findIndexInTokensArray(n,t);o>0&&n[o-1<<1]===t&&o--;for(let r=o;r<s;r++)n[r<<1]+=i;return e}}function Vt(a){return a instanceof Uint32Array?a:new Uint32Array(a)}class Fs{constructor(e){this._lineTokens=[],this._len=0,this._languageIdCodec=e}flush(){this._lineTokens=[],this._len=0}get hasTokens(){return this._lineTokens.length>0}getTokens(e,t,i){let n=null;if(t<this._len&&(n=this._lineTokens[t]),n!==null&&n!==Bt)return new st(Vt(n),i,this._languageIdCodec);const s=new Uint32Array(2);return s[0]=i.length,s[1]=Mc(this._languageIdCodec.encodeLanguageId(e)),new st(s,i,this._languageIdCodec)}static _massageTokens(e,t,i){const n=i?Vt(i):null;if(t===0){let s=!1;if(n&&n.length>1&&(s=Ra.getLanguageId(n[1])!==e),!s)return Bt}if(!n||n.length===0){const s=new Uint32Array(2);return s[0]=t,s[1]=Mc(e),s.buffer}return n[n.length-2]=t,n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n}_ensureLine(e){for(;e>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(e,t){t!==0&&(e+t>this._len&&(t=this._len-e),this._lineTokens.splice(e,t),this._len-=t)}_insertLines(e,t){if(t===0)return;const i=[];for(let n=0;n<t;n++)i[n]=null;this._lineTokens=Nr(this._lineTokens,e,i),this._len+=t}setTokens(e,t,i,n,s){const o=Fs._massageTokens(this._languageIdCodec.encodeLanguageId(e),i,n);this._ensureLine(t);const r=this._lineTokens[t];return this._lineTokens[t]=o,s?!Fs._equals(r,o):!1}static _equals(e,t){if(!e||!t)return!e&&!t;const i=Vt(e),n=Vt(t);if(i.length!==n.length)return!1;for(let s=0,o=i.length;s<o;s++)if(i[s]!==n[s])return!1;return!0}acceptEdit(e,t,i){this._acceptDeleteRange(e),this._acceptInsertText(new D(e.startLineNumber,e.startColumn),t,i)}_acceptDeleteRange(e){const t=e.startLineNumber-1;if(t>=this._len)return;if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._lineTokens[t]=vt.delete(this._lineTokens[t],e.startColumn-1,e.endColumn-1);return}this._lineTokens[t]=vt.deleteEnding(this._lineTokens[t],e.startColumn-1);const i=e.endLineNumber-1;let n=null;i<this._len&&(n=vt.deleteBeginning(this._lineTokens[i],e.endColumn-1)),this._lineTokens[t]=vt.append(this._lineTokens[t],n),this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t,i){if(t===0&&i===0)return;const n=e.lineNumber-1;if(!(n>=this._len)){if(t===0){this._lineTokens[n]=vt.insert(this._lineTokens[n],e.column-1,i);return}this._lineTokens[n]=vt.deleteEnding(this._lineTokens[n],e.column-1),this._lineTokens[n]=vt.insert(this._lineTokens[n],e.column-1,i),this._insertLines(e.lineNumber,t)}}setMultilineTokens(e,t){if(e.length===0)return{changes:[]};const i=[];for(let n=0,s=e.length;n<s;n++){const o=e[n];let r=0,l=0,h=!1;for(let c=o.startLineNumber;c<=o.endLineNumber;c++)h?(this.setTokens(t.getLanguageId(),c-1,t.getLineLength(c),o.getLineTokens(c),!1),l=c):this.setTokens(t.getLanguageId(),c-1,t.getLineLength(c),o.getLineTokens(c),!0)&&(h=!0,r=c,l=c);h&&i.push({fromLineNumber:r,toLineNumber:l})}return{changes:i}}}function Mc(a){return(a<<0|0|0|32768|2<<24|1024)>>>0}class th{constructor(e){this._pieces=[],this._isComplete=!1,this._languageIdCodec=e}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return this._pieces.length===0}set(e,t){this._pieces=e||[],this._isComplete=t}setPartial(e,t){let i=e;if(t.length>0){const s=t[0].getRange(),o=t[t.length-1].getRange();if(!s||!o)return e;i=e.plusRange(s).plusRange(o)}let n=null;for(let s=0,o=this._pieces.length;s<o;s++){const r=this._pieces[s];if(r.endLineNumber<i.startLineNumber)continue;if(r.startLineNumber>i.endLineNumber){n=n||{index:s};break}if(r.removeTokens(i),r.isEmpty()){this._pieces.splice(s,1),s--,o--;continue}if(r.endLineNumber<i.startLineNumber)continue;if(r.startLineNumber>i.endLineNumber){n=n||{index:s};continue}const[l,h]=r.split(i);if(l.isEmpty()){n=n||{index:s};continue}h.isEmpty()||(this._pieces.splice(s,1,l,h),s++,o++,n=n||{index:s})}return n=n||{index:this._pieces.length},t.length>0&&(this._pieces=Nr(this._pieces,n.index,t)),i}isComplete(){return this._isComplete}addSparseTokens(e,t){if(t.getLineContent().length===0)return t;const i=this._pieces;if(i.length===0)return t;const n=th._findFirstPieceWithLine(i,e),s=i[n].getLineTokens(e);if(!s)return t;const o=t.getCount(),r=s.getCount();let l=0;const h=[];let c=0,d=0;const u=(g,f)=>{g!==d&&(d=g,h[c++]=g,h[c++]=f)};for(let g=0;g<r;g++){const f=s.getStartCharacter(g),m=s.getEndCharacter(g),_=s.getMetadata(g),C=((_&1?2048:0)|(_&2?4096:0)|(_&4?8192:0)|(_&8?16384:0)|(_&16?16744448:0)|(_&32?4278190080:0))>>>0,p=~C>>>0;for(;l<o&&t.getEndOffset(l)<=f;)u(t.getEndOffset(l),t.getMetadata(l)),l++;for(l<o&&t.getStartOffset(l)<f&&u(f,t.getMetadata(l));l<o&&t.getEndOffset(l)<m;)u(t.getEndOffset(l),t.getMetadata(l)&p|_&C),l++;if(l<o)u(m,t.getMetadata(l)&p|_&C),t.getEndOffset(l)===m&&l++;else{const b=Math.min(Math.max(0,l-1),o-1);u(m,t.getMetadata(b)&p|_&C)}}for(;l<o;)u(t.getEndOffset(l),t.getMetadata(l)),l++;return new st(new Uint32Array(h),t.getLineContent(),this._languageIdCodec)}static _findFirstPieceWithLine(e,t){let i=0,n=e.length-1;for(;i<n;){let s=i+Math.floor((n-i)/2);if(e[s].endLineNumber<t)i=s+1;else if(e[s].startLineNumber>t)n=s-1;else{for(;s>i&&e[s-1].startLineNumber<=t&&t<=e[s-1].endLineNumber;)s--;return s}}return i}acceptEdit(e,t,i,n,s){for(const o of this._pieces)o.acceptEdit(e,t,i,n,s)}}var oL=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},la=function(a,e){return function(t,i){e(t,i,a)}},yo;let ol=yo=class extends Xu{constructor(e,t,i,n,s,o,r){super(),this._textModel=e,this._bracketPairsTextModelPart=t,this._languageId=i,this._attachedViews=n,this._languageService=s,this._languageConfigurationService=o,this._treeSitterService=r,this._semanticTokens=new th(this._languageService.languageIdCodec),this._onDidChangeLanguage=this._register(new M),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new M),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new M),this.onDidChangeTokens=this._onDidChangeTokens.event,this._tokensDisposables=this._register(new pe),this._register(this._languageConfigurationService.onDidChange(l=>{l.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})})),this._register(G.filter(Aa.onDidChange,l=>l.changedLanguages.includes(this._languageId))(()=>{this.createPreferredTokenProvider()})),this.createPreferredTokenProvider()}createGrammarTokens(){return this._register(new Rc(this._languageService.languageIdCodec,this._textModel,()=>this._languageId,this._attachedViews))}createTreeSitterTokens(){return this._register(new Ec(this._treeSitterService,this._languageService.languageIdCodec,this._textModel,()=>this._languageId))}createTokens(e){var i;const t=this._tokens!==void 0;(i=this._tokens)==null||i.dispose(),this._tokens=e?this.createTreeSitterTokens():this.createGrammarTokens(),this._tokensDisposables.clear(),this._tokensDisposables.add(this._tokens.onDidChangeTokens(n=>{this._emitModelTokensChangedEvent(n)})),this._tokensDisposables.add(this._tokens.onDidChangeBackgroundTokenizationState(n=>{this._bracketPairsTextModelPart.handleDidChangeBackgroundTokenizationState()})),t&&this._tokens.resetTokenization()}createPreferredTokenProvider(){Aa.get(this._languageId)?this._tokens instanceof Ec||this.createTokens(!0):this._tokens instanceof Rc||this.createTokens(!1)}handleLanguageConfigurationServiceChange(e){e.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})}handleDidChangeContent(e){if(e.isFlush)this._semanticTokens.flush();else if(!e.isEolChange)for(const t of e.changes){const[i,n,s]=Un(t.text);this._semanticTokens.acceptEdit(t.range,i,n,s,t.text.length>0?t.text.charCodeAt(0):0)}this._tokens.handleDidChangeContent(e)}handleDidChangeAttached(){this._tokens.handleDidChangeAttached()}getLineTokens(e){this.validateLineNumber(e);const t=this._tokens.getLineTokens(e);return this._semanticTokens.addSparseTokens(e,t)}_emitModelTokensChangedEvent(e){this._textModel._isDisposing()||(this._bracketPairsTextModelPart.handleDidChangeTokens(e),this._onDidChangeTokens.fire(e))}validateLineNumber(e){if(e<1||e>this._textModel.getLineCount())throw new fe("Illegal value for lineNumber")}get hasTokens(){return this._tokens.hasTokens}resetTokenization(){this._tokens.resetTokenization()}get backgroundTokenizationState(){return this._tokens.backgroundTokenizationState}forceTokenization(e){this.validateLineNumber(e),this._tokens.forceTokenization(e)}hasAccurateTokensForLine(e){return this.validateLineNumber(e),this._tokens.hasAccurateTokensForLine(e)}isCheapToTokenize(e){return this.validateLineNumber(e),this._tokens.isCheapToTokenize(e)}tokenizeIfCheap(e){this.validateLineNumber(e),this._tokens.tokenizeIfCheap(e)}getTokenTypeIfInsertingCharacter(e,t,i){return this._tokens.getTokenTypeIfInsertingCharacter(e,t,i)}tokenizeLineWithEdit(e,t,i){return this._tokens.tokenizeLineWithEdit(e,t,i)}setSemanticTokens(e,t){this._semanticTokens.set(e,t),this._emitModelTokensChangedEvent({semanticTokensApplied:e!==null,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}hasCompleteSemanticTokens(){return this._semanticTokens.isComplete()}hasSomeSemanticTokens(){return!this._semanticTokens.isEmpty()}setPartialSemanticTokens(e,t){if(this.hasCompleteSemanticTokens())return;const i=this._textModel.validateRange(this._semanticTokens.setPartial(e,t));this._emitModelTokensChangedEvent({semanticTokensApplied:!0,ranges:[{fromLineNumber:i.startLineNumber,toLineNumber:i.endLineNumber}]})}getWordAtPosition(e){this.assertNotDisposed();const t=this._textModel.validatePosition(e),i=this._textModel.getLineContent(t.lineNumber),n=this.getLineTokens(t.lineNumber),s=n.findTokenIndexAtOffset(t.column-1),[o,r]=yo._findLanguageBoundaries(n,s),l=$h(t.column,this.getLanguageConfiguration(n.getLanguageId(s)).getWordDefinition(),i.substring(o,r),o);if(l&&l.startColumn<=e.column&&e.column<=l.endColumn)return l;if(s>0&&o===t.column-1){const[h,c]=yo._findLanguageBoundaries(n,s-1),d=$h(t.column,this.getLanguageConfiguration(n.getLanguageId(s-1)).getWordDefinition(),i.substring(h,c),h);if(d&&d.startColumn<=e.column&&e.column<=d.endColumn)return d}return null}getLanguageConfiguration(e){return this._languageConfigurationService.getLanguageConfiguration(e)}static _findLanguageBoundaries(e,t){const i=e.getLanguageId(t);let n=0;for(let o=t;o>=0&&e.getLanguageId(o)===i;o--)n=e.getStartOffset(o);let s=e.getLineContent().length;for(let o=t,r=e.getCount();o<r&&e.getLanguageId(o)===i;o++)s=e.getEndOffset(o);return[n,s]}getWordUntilPosition(e){const t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}getLanguageId(){return this._languageId}getLanguageIdAtPosition(e,t){const i=this._textModel.validatePosition(new D(e,t)),n=this.getLineTokens(i.lineNumber);return n.getLanguageId(n.findTokenIndexAtOffset(i.column-1))}setLanguageId(e,t="api"){if(this._languageId===e)return;const i={oldLanguage:this._languageId,newLanguage:e,source:t};this._languageId=e,this._bracketPairsTextModelPart.handleDidChangeLanguage(i),this._tokens.resetTokenization(),this.createPreferredTokenProvider(),this._onDidChangeLanguage.fire(i),this._onDidChangeLanguageConfiguration.fire({})}};ol=yo=oL([la(4,Rl),la(5,Ys),la(6,sL)],ol);class Rc extends ag{constructor(e,t,i,n){super(e,t,i),this._tokenizer=null,this._defaultBackgroundTokenizer=null,this._backgroundTokenizer=this._register(new Ui),this._tokens=new Fs(this._languageIdCodec),this._debugBackgroundTokenizer=this._register(new Ui),this._attachedViewStates=this._register(new El),this._register(ai.onDidChange(s=>{const o=this.getLanguageId();s.changedLanguages.indexOf(o)!==-1&&this.resetTokenization()})),this.resetTokenization(),this._register(n.onDidChangeVisibleRanges(({view:s,state:o})=>{if(o){let r=this._attachedViewStates.get(s);r||(r=new nL(()=>this.refreshRanges(r.lineRanges)),this._attachedViewStates.set(s,r)),r.handleStateChange(o)}else this._attachedViewStates.deleteAndDispose(s)}))}resetTokenization(e=!0){var s;this._tokens.flush(),(s=this._debugBackgroundTokens)==null||s.flush(),this._debugBackgroundStates&&(this._debugBackgroundStates=new sl(this._textModel.getLineCount())),e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]});const t=()=>{if(this._textModel.isTooLargeForTokenization())return[null,null];const o=ai.get(this.getLanguageId());if(!o)return[null,null];let r;try{r=o.getInitialState()}catch(l){return Oe(l),[null,null]}return[o,r]},[i,n]=t();if(i&&n?this._tokenizer=new Yw(this._textModel.getLineCount(),i,this._textModel,this._languageIdCodec):this._tokenizer=null,this._backgroundTokenizer.clear(),this._defaultBackgroundTokenizer=null,this._tokenizer){const o={setTokens:r=>{this.setTokens(r)},backgroundTokenizationFinished:()=>{if(this._backgroundTokenizationState===2)return;const r=2;this._backgroundTokenizationState=r,this._onDidChangeBackgroundTokenizationState.fire()},setEndState:(r,l)=>{var c;if(!this._tokenizer)return;const h=this._tokenizer.store.getFirstInvalidEndStateLineNumber();h!==null&&r>=h&&((c=this._tokenizer)==null||c.store.setEndState(r,l))}};i&&i.createBackgroundTokenizer&&!i.backgroundTokenizerShouldOnlyVerifyTokens&&(this._backgroundTokenizer.value=i.createBackgroundTokenizer(this._textModel,o)),!this._backgroundTokenizer.value&&!this._textModel.isTooLargeForTokenization()&&(this._backgroundTokenizer.value=this._defaultBackgroundTokenizer=new eL(this._tokenizer,o),this._defaultBackgroundTokenizer.handleChanges()),i!=null&&i.backgroundTokenizerShouldOnlyVerifyTokens&&i.createBackgroundTokenizer?(this._debugBackgroundTokens=new Fs(this._languageIdCodec),this._debugBackgroundStates=new sl(this._textModel.getLineCount()),this._debugBackgroundTokenizer.clear(),this._debugBackgroundTokenizer.value=i.createBackgroundTokenizer(this._textModel,{setTokens:r=>{var l;(l=this._debugBackgroundTokens)==null||l.setMultilineTokens(r,this._textModel)},backgroundTokenizationFinished(){},setEndState:(r,l)=>{var h;(h=this._debugBackgroundStates)==null||h.setEndState(r,l)}})):(this._debugBackgroundTokens=void 0,this._debugBackgroundStates=void 0,this._debugBackgroundTokenizer.value=void 0)}this.refreshAllVisibleLineTokens()}handleDidChangeAttached(){var e;(e=this._defaultBackgroundTokenizer)==null||e.handleChanges()}handleDidChangeContent(e){var t,i,n;if(e.isFlush)this.resetTokenization(!1);else if(!e.isEolChange){for(const s of e.changes){const[o,r]=Un(s.text);this._tokens.acceptEdit(s.range,o,r),(t=this._debugBackgroundTokens)==null||t.acceptEdit(s.range,o,r)}(i=this._debugBackgroundStates)==null||i.acceptChanges(e.changes),this._tokenizer&&this._tokenizer.store.acceptChanges(e.changes),(n=this._defaultBackgroundTokenizer)==null||n.handleChanges()}}setTokens(e){const{changes:t}=this._tokens.setMultilineTokens(e,this._textModel);return t.length>0&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:t}),{changes:t}}refreshAllVisibleLineTokens(){const e=Pi.joinMany([...this._attachedViewStates].map(([t,i])=>i.lineRanges));this.refreshRanges(e)}refreshRanges(e){for(const t of e)this.refreshRange(t.startLineNumber,t.endLineNumberExclusive-1)}refreshRange(e,t){var o,r;if(!this._tokenizer)return;e=Math.max(1,Math.min(this._textModel.getLineCount(),e)),t=Math.min(this._textModel.getLineCount(),t);const i=new nl,{heuristicTokens:n}=this._tokenizer.tokenizeHeuristically(i,e,t),s=this.setTokens(i.finalize());if(n)for(const l of s.changes)(o=this._backgroundTokenizer.value)==null||o.requestTokens(l.fromLineNumber,l.toLineNumber+1);(r=this._defaultBackgroundTokenizer)==null||r.checkFinished()}forceTokenization(e){var i,n;const t=new nl;(i=this._tokenizer)==null||i.updateTokensUntilLine(t,e),this.setTokens(t.finalize()),(n=this._defaultBackgroundTokenizer)==null||n.checkFinished()}hasAccurateTokensForLine(e){return this._tokenizer?this._tokenizer.hasAccurateTokensForLine(e):!0}isCheapToTokenize(e){return this._tokenizer?this._tokenizer.isCheapToTokenize(e):!0}getLineTokens(e){var n;const t=this._textModel.getLineContent(e),i=this._tokens.getTokens(this._textModel.getLanguageId(),e-1,t);if(this._debugBackgroundTokens&&this._debugBackgroundStates&&this._tokenizer&&this._debugBackgroundStates.getFirstInvalidEndStateLineNumberOrMax()>e&&this._tokenizer.store.getFirstInvalidEndStateLineNumberOrMax()>e){const s=this._debugBackgroundTokens.getTokens(this._textModel.getLanguageId(),e-1,t);!i.equals(s)&&((n=this._debugBackgroundTokenizer.value)!=null&&n.reportMismatchingTokens)&&this._debugBackgroundTokenizer.value.reportMismatchingTokens(e)}return i}getTokenTypeIfInsertingCharacter(e,t,i){if(!this._tokenizer)return 0;const n=this._textModel.validatePosition(new D(e,t));return this.forceTokenization(n.lineNumber),this._tokenizer.getTokenTypeIfInsertingCharacter(n,i)}tokenizeLineWithEdit(e,t,i){if(!this._tokenizer)return null;const n=this._textModel.validatePosition(e);return this.forceTokenization(n.lineNumber),this._tokenizer.tokenizeLineWithEdit(n,t,i)}get hasTokens(){return this._tokens.hasTokens}}class rL{constructor(){this.changeType=1}}class gt{static applyInjectedText(e,t){if(!t||t.length===0)return e;let i="",n=0;for(const s of t)i+=e.substring(n,s.column-1),n=s.column-1,i+=s.options.content;return i+=e.substring(n),i}static fromDecorations(e){const t=[];for(const i of e)i.options.before&&i.options.before.content.length>0&&t.push(new gt(i.ownerId,i.range.startLineNumber,i.range.startColumn,i.options.before,0)),i.options.after&&i.options.after.content.length>0&&t.push(new gt(i.ownerId,i.range.endLineNumber,i.range.endColumn,i.options.after,1));return t.sort((i,n)=>i.lineNumber===n.lineNumber?i.column===n.column?i.order-n.order:i.column-n.column:i.lineNumber-n.lineNumber),t}constructor(e,t,i,n,s){this.ownerId=e,this.lineNumber=t,this.column=i,this.options=n,this.order=s}}class Ac{constructor(e,t,i){this.changeType=2,this.lineNumber=e,this.detail=t,this.injectedText=i}}class aL{constructor(e,t){this.changeType=3,this.fromLineNumber=e,this.toLineNumber=t}}class lL{constructor(e,t,i,n){this.changeType=4,this.injectedTexts=n,this.fromLineNumber=e,this.toLineNumber=t,this.detail=i}}class hL{constructor(){this.changeType=5}}class Rn{constructor(e,t,i,n){this.changes=e,this.versionId=t,this.isUndoing=i,this.isRedoing=n,this.resultingSelection=null}containsEvent(e){for(let t=0,i=this.changes.length;t<i;t++)if(this.changes[t].changeType===e)return!0;return!1}static merge(e,t){const i=[].concat(e.changes).concat(t.changes),n=t.versionId,s=e.isUndoing||t.isUndoing,o=e.isRedoing||t.isRedoing;return new Rn(i,n,s,o)}}class lg{constructor(e){this.changes=e}}class Wi{constructor(e,t){this.rawContentChangedEvent=e,this.contentChangedEvent=t}merge(e){const t=Rn.merge(this.rawContentChangedEvent,e.rawContentChangedEvent),i=Wi._mergeChangeEvents(this.contentChangedEvent,e.contentChangedEvent);return new Wi(t,i)}static _mergeChangeEvents(e,t){const i=[].concat(e.changes).concat(t.changes),n=t.eol,s=t.versionId,o=e.isUndoing||t.isUndoing,r=e.isRedoing||t.isRedoing,l=e.isFlush||t.isFlush,h=e.isEolChange&&t.isEolChange;return{changes:i,eol:n,isEolChange:h,versionId:s,isUndoing:o,isRedoing:r,isFlush:l}}}var cL=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},mo=function(a,e){return function(t,i){e(t,i,a)}},Ci;function dL(a){const e=new rg;return e.acceptChunk(a),e.finish()}function uL(a){const e=new rg;let t;for(;typeof(t=a.read())=="string";)e.acceptChunk(t);return e.finish()}function Oc(a,e){let t;return typeof a=="string"?t=dL(a):R_(a)?t=uL(a):t=a,t.create(e)}let po=0;const gL=999,fL=1e4;class mL{constructor(e){this._source=e,this._eos=!1}read(){if(this._eos)return null;const e=[];let t=0,i=0;do{const n=this._source.read();if(n===null)return this._eos=!0,t===0?null:e.join("");if(n.length>0&&(e[t++]=n,i+=n.length),i>=64*1024)return e.join("")}while(!0)}}const ts=()=>{throw new Error("Invalid change accessor")};var ut;let Pc=(ut=class extends H{static resolveOptions(e,t){if(t.detectIndentation){const i=Sc(e,t.tabSize,t.insertSpaces);return new Yr({tabSize:i.tabSize,indentSize:"tabSize",insertSpaces:i.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new Yr(t)}get onDidChangeLanguage(){return this._tokenizationTextModelPart.onDidChangeLanguage}get onDidChangeLanguageConfiguration(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}get onDidChangeTokens(){return this._tokenizationTextModelPart.onDidChangeTokens}onDidChangeContent(e){return this._eventEmitter.slowEvent(t=>e(t.contentChangedEvent))}onDidChangeContentOrInjectedText(e){return Wd(this._eventEmitter.fastEvent(t=>e(t)),this._onDidChangeInjectedText.event(t=>e(t)))}_isDisposing(){return this.__isDisposing}get tokenization(){return this._tokenizationTextModelPart}get bracketPairs(){return this._bracketPairs}get guides(){return this._guidesTextModelPart}constructor(e,t,i,n=null,s,o,r,l){super(),this._undoRedoService=s,this._languageService=o,this._languageConfigurationService=r,this.instantiationService=l,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new LL(f=>this.handleBeforeFireDecorationsChangedEvent(f))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeOptions=this._register(new M),this.onDidChangeOptions=this._onDidChangeOptions.event,this._onDidChangeAttached=this._register(new M),this.onDidChangeAttached=this._onDidChangeAttached.event,this._onDidChangeInjectedText=this._register(new M),this._eventEmitter=this._register(new vL),this._languageSelectionListener=this._register(new Ui),this._deltaDecorationCallCnt=0,this._attachedViews=new tL,po++,this.id="$model"+po,this.isForSimpleWidget=i.isForSimpleWidget,typeof n>"u"||n===null?this._associatedResource=ln.parse("inmemory://model/"+po):this._associatedResource=n,this._attachedEditorCount=0;const{textBuffer:h,disposable:c}=Oc(e,i.defaultEOL);this._buffer=h,this._bufferDisposable=c,this._options=Ci.resolveOptions(this._buffer,i);const d=typeof t=="string"?t:t.languageId;typeof t!="string"&&(this._languageSelectionListener.value=t.onDidChange(()=>this._setLanguage(t.languageId))),this._bracketPairs=this._register(new bw(this,this._languageConfigurationService)),this._guidesTextModelPart=this._register(new yw(this,this._languageConfigurationService)),this._decorationProvider=this._register(new Lw(this)),this._tokenizationTextModelPart=this.instantiationService.createInstance(ol,this,this._bracketPairs,d,this._attachedViews);const u=this._buffer.getLineCount(),g=this._buffer.getValueLengthInRange(new v(1,1,u,this._buffer.getLineLength(u)+1),0);i.largeFileOptimizations?(this._isTooLargeForTokenization=g>Ci.LARGE_FILE_SIZE_THRESHOLD||u>Ci.LARGE_FILE_LINE_COUNT_THRESHOLD,this._isTooLargeForHeapOperation=g>Ci.LARGE_FILE_HEAP_OPERATION_THRESHOLD):(this._isTooLargeForTokenization=!1,this._isTooLargeForHeapOperation=!1),this._isTooLargeForSyncing=g>Ci._MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this.__isDisposing=!1,this._instanceId=Ud(po),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new Bc,this._commandManager=new Yl(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()})),this._languageService.requestRichLanguageFeatures(d),this._register(this._languageConfigurationService.onDidChange(f=>{this._bracketPairs.handleLanguageConfigurationServiceChange(f),this._tokenizationTextModelPart.handleLanguageConfigurationServiceChange(f)}))}dispose(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this.__isDisposing=!1;const e=new Mn([],"",`
`,!1,!1,!0,!0);e.dispose(),this._buffer=e,this._bufferDisposable=H.None}_assertNotDisposed(){if(this._isDisposed)throw new fe("Model is disposed!")}_emitContentChangedEvent(e,t){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(t),this._bracketPairs.handleDidChangeContent(t),this._eventEmitter.fire(new Wi(e,t)))}setValue(e){if(this._assertNotDisposed(),e==null)throw of();const{textBuffer:t,disposable:i}=Oc(e,this._options.defaultEOL);this._setValueFromTextBuffer(t,i)}_createContentChanged2(e,t,i,n,s,o,r,l){return{changes:[{range:e,rangeOffset:t,rangeLength:i,text:n}],eol:this._buffer.getEOL(),isEolChange:l,versionId:this.getVersionId(),isUndoing:s,isRedoing:o,isFlush:r}}_setValueFromTextBuffer(e,t){this._assertNotDisposed();const i=this.getFullModelRange(),n=this.getValueLengthInRange(i),s=this.getLineCount(),o=this.getLineMaxColumn(s);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._decorations=Object.create(null),this._decorationsTree=new Bc,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new Rn([new rL],this._versionId,!1,!1),this._createContentChanged2(new v(1,1,s,o),0,n,this.getValue(),!1,!1,!0,!1))}setEOL(e){this._assertNotDisposed();const t=e===1?`\r
`:`
`;if(this._buffer.getEOL()===t)return;const i=this.getFullModelRange(),n=this.getValueLengthInRange(i),s=this.getLineCount(),o=this.getLineMaxColumn(s);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new Rn([new hL],this._versionId,!1,!1),this._createContentChanged2(new v(1,1,s,o),0,n,this.getValue(),!1,!1,!1,!0))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let i=0,n=t.length;i<n;i++){const s=t[i],o=s.range,r=s.cachedAbsoluteStart-s.start,l=this._buffer.getOffsetAt(o.startLineNumber,o.startColumn),h=this._buffer.getOffsetAt(o.endLineNumber,o.endColumn);s.cachedAbsoluteStart=l,s.cachedAbsoluteEnd=h,s.cachedVersionId=e,s.start=l-r,s.end=h-r,li(s)}}onBeforeAttached(){return this._attachedEditorCount++,this._attachedEditorCount===1&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.attachView()}onBeforeDetached(e){this._attachedEditorCount--,this._attachedEditorCount===0&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.detachView(e)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isTooLargeForHeapOperation(){return this._isTooLargeForHeapOperation}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const i=this._buffer.getLineCount();for(let n=1;n<=i;n++){const s=this._buffer.getLineLength(n);s>=fL?t+=s:e+=s}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();const t=typeof e.tabSize<"u"?e.tabSize:this._options.tabSize,i=typeof e.indentSize<"u"?e.indentSize:this._options.originalIndentSize,n=typeof e.insertSpaces<"u"?e.insertSpaces:this._options.insertSpaces,s=typeof e.trimAutoWhitespace<"u"?e.trimAutoWhitespace:this._options.trimAutoWhitespace,o=typeof e.bracketColorizationOptions<"u"?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,r=new Yr({tabSize:t,indentSize:i,insertSpaces:n,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:s,bracketPairColorizationOptions:o});if(this._options.equals(r))return;const l=this._options.createChangeEvent(r);this._options=r,this._bracketPairs.handleDidChangeOptions(l),this._decorationProvider.handleDidChangeOptions(l),this._onDidChangeOptions.fire(l)}detectIndentation(e,t){this._assertNotDisposed();const i=Sc(this._buffer,t,e);this.updateOptions({insertSpaces:i.insertSpaces,tabSize:i.tabSize,indentSize:i.tabSize})}normalizeIndentation(e){return this._assertNotDisposed(),$u(e,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(rf.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map(i=>({range:i.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();const t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();const t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new fe("Operation would exceed heap memory limits");const i=this.getFullModelRange(),n=this.getValueInRange(i,e);return t?this._buffer.getBOM()+n:n}createSnapshot(e=!1){return new mL(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const i=this.getFullModelRange(),n=this.getValueLengthInRange(i,e);return t?this._buffer.getBOM().length+n:n}getValueInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new fe("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new fe("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new fe("Operation would exceed heap memory limits");return this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),this._buffer.getEOL()===`
`?0:1}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new fe("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new fe("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new fe("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),i=e.startLineNumber,n=e.startColumn;let s=Math.floor(typeof i=="number"&&!isNaN(i)?i:1),o=Math.floor(typeof n=="number"&&!isNaN(n)?n:1);if(s<1)s=1,o=1;else if(s>t)s=t,o=this.getLineMaxColumn(s);else if(o<=1)o=1;else{const d=this.getLineMaxColumn(s);o>=d&&(o=d)}const r=e.endLineNumber,l=e.endColumn;let h=Math.floor(typeof r=="number"&&!isNaN(r)?r:1),c=Math.floor(typeof l=="number"&&!isNaN(l)?l:1);if(h<1)h=1,c=1;else if(h>t)h=t,c=this.getLineMaxColumn(h);else if(c<=1)c=1;else{const d=this.getLineMaxColumn(h);c>=d&&(c=d)}return i===s&&n===o&&r===h&&l===c&&e instanceof v&&!(e instanceof te)?e:new v(s,o,h,c)}_isValidPosition(e,t,i){if(typeof e!="number"||typeof t!="number"||isNaN(e)||isNaN(t)||e<1||t<1||(e|0)!==e||(t|0)!==t)return!1;const n=this._buffer.getLineCount();if(e>n)return!1;if(t===1)return!0;const s=this.getLineMaxColumn(e);if(t>s)return!1;if(i===1){const o=this._buffer.getLineCharCode(e,t-2);if(We(o))return!1}return!0}_validatePosition(e,t,i){const n=Math.floor(typeof e=="number"&&!isNaN(e)?e:1),s=Math.floor(typeof t=="number"&&!isNaN(t)?t:1),o=this._buffer.getLineCount();if(n<1)return new D(1,1);if(n>o)return new D(o,this.getLineMaxColumn(o));if(s<=1)return new D(n,1);const r=this.getLineMaxColumn(n);if(s>=r)return new D(n,r);if(i===1){const l=this._buffer.getLineCharCode(n,s-2);if(We(l))return new D(n,s-1)}return new D(n,s)}validatePosition(e){return this._assertNotDisposed(),e instanceof D&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}_isValidRange(e,t){const i=e.startLineNumber,n=e.startColumn,s=e.endLineNumber,o=e.endColumn;if(!this._isValidPosition(i,n,0)||!this._isValidPosition(s,o,0))return!1;if(t===1){const r=n>1?this._buffer.getLineCharCode(i,n-2):0,l=o>1&&o<=this._buffer.getLineLength(s)?this._buffer.getLineCharCode(s,o-2):0,h=We(r),c=We(l);return!h&&!c}return!0}validateRange(e){if(this._assertNotDisposed(),e instanceof v&&!(e instanceof te)&&this._isValidRange(e,1))return e;const i=this._validatePosition(e.startLineNumber,e.startColumn,0),n=this._validatePosition(e.endLineNumber,e.endColumn,0),s=i.lineNumber,o=i.column,r=n.lineNumber,l=n.column;{const h=o>1?this._buffer.getLineCharCode(s,o-2):0,c=l>1&&l<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,l-2):0,d=We(h),u=We(c);return!d&&!u?new v(s,o,r,l):s===r&&o===l?new v(s,o-1,r,l-1):d&&u?new v(s,o-1,r,l+1):d?new v(s,o-1,r,l):new v(s,o,r,l+1)}}modifyPosition(e,t){this._assertNotDisposed();const i=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,i)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new v(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,i,n){return this._buffer.findMatchesLineByLine(e,t,i,n)}findMatches(e,t,i,n,s,o,r=gL){this._assertNotDisposed();let l=null;t!==null&&(Array.isArray(t)||(t=[t]),t.every(d=>v.isIRange(d))&&(l=t.map(d=>this.validateRange(d)))),l===null&&(l=[this.getFullModelRange()]),l=l.sort((d,u)=>d.startLineNumber-u.startLineNumber||d.startColumn-u.startColumn);const h=[];h.push(l.reduce((d,u)=>v.areIntersecting(d,u)?d.plusRange(u):(h.push(d),u)));let c;if(!i&&e.indexOf(`
`)<0){const u=new nn(e,i,n,s).parseSearchRequest();if(!u)return[];c=g=>this.findMatchesLineByLine(g,u,o,r)}else c=d=>ao.findMatches(this,new nn(e,i,n,s),d,o,r);return h.map(c).reduce((d,u)=>d.concat(u),[])}findNextMatch(e,t,i,n,s,o){this._assertNotDisposed();const r=this.validatePosition(t);if(!i&&e.indexOf(`
`)<0){const h=new nn(e,i,n,s).parseSearchRequest();if(!h)return null;const c=this.getLineCount();let d=new v(r.lineNumber,r.column,c,this.getLineMaxColumn(c)),u=this.findMatchesLineByLine(d,h,o,1);return ao.findNextMatch(this,new nn(e,i,n,s),r,o),u.length>0||(d=new v(1,1,r.lineNumber,this.getLineMaxColumn(r.lineNumber)),u=this.findMatchesLineByLine(d,h,o,1),u.length>0)?u[0]:null}return ao.findNextMatch(this,new nn(e,i,n,s),r,o)}findPreviousMatch(e,t,i,n,s,o){this._assertNotDisposed();const r=this.validatePosition(t);return ao.findPreviousMatch(this,new nn(e,i,n,s),r,o)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if((this.getEOL()===`
`?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof Xr?e:new Xr(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let i=0,n=e.length;i<n;i++)t[i]=this._validateEditOperation(e[i]);return t}pushEditOperations(e,t,i,n){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),i,n)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,i,n){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){const s=t.map(r=>({range:this.validateRange(r.range),text:r.text}));let o=!0;if(e)for(let r=0,l=e.length;r<l;r++){const h=e[r];let c=!1;for(let d=0,u=s.length;d<u;d++){const g=s[d].range,f=g.startLineNumber>h.endLineNumber,m=h.startLineNumber>g.endLineNumber;if(!f&&!m){c=!0;break}}if(!c){o=!1;break}}if(o)for(let r=0,l=this._trimAutoWhitespaceLines.length;r<l;r++){const h=this._trimAutoWhitespaceLines[r],c=this.getLineMaxColumn(h);let d=!0;for(let u=0,g=s.length;u<g;u++){const f=s[u].range,m=s[u].text;if(!(h<f.startLineNumber||h>f.endLineNumber)&&!(h===f.startLineNumber&&f.startColumn===c&&f.isEmpty()&&m&&m.length>0&&m.charAt(0)===`
`)&&!(h===f.startLineNumber&&f.startColumn===1&&f.isEmpty()&&m&&m.length>0&&m.charAt(m.length-1)===`
`)){d=!1;break}}if(d){const u=new v(h,1,h,c);t.push(new Xr(null,u,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,i,n)}_applyUndo(e,t,i,n){const s=e.map(o=>{const r=this.getPositionAt(o.newPosition),l=this.getPositionAt(o.newEnd);return{range:new v(r.lineNumber,r.column,l.lineNumber,l.column),text:o.oldText}});this._applyUndoRedoEdits(s,t,!0,!1,i,n)}_applyRedo(e,t,i,n){const s=e.map(o=>{const r=this.getPositionAt(o.oldPosition),l=this.getPositionAt(o.oldEnd);return{range:new v(r.lineNumber,r.column,l.lineNumber,l.column),text:o.newText}});this._applyUndoRedoEdits(s,t,!1,!0,i,n)}_applyUndoRedoEdits(e,t,i,n,s,o){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=i,this._isRedoing=n,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(s)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(o),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const i=this._validateEditOperations(e);return this._doApplyEdits(i,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t){const i=this._buffer.getLineCount(),n=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),s=this._buffer.getLineCount(),o=n.changes;if(this._trimAutoWhitespaceLines=n.trimAutoWhitespaceLineNumbers,o.length!==0){for(let h=0,c=o.length;h<c;h++){const d=o[h];this._decorationsTree.acceptReplace(d.rangeOffset,d.rangeLength,d.text.length,d.forceMoveMarkers)}const r=[];this._increaseVersionId();let l=i;for(let h=0,c=o.length;h<c;h++){const d=o[h],[u]=Un(d.text);this._onDidChangeDecorations.fire();const g=d.range.startLineNumber,f=d.range.endLineNumber,m=f-g,_=u,C=Math.min(m,_),p=_-m,b=s-l-p+g,w=b,L=b+_,S=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new D(w,1)),this.getOffsetAt(new D(L,this.getLineMaxColumn(L))),0),y=gt.fromDecorations(S),N=new ji(y);for(let x=C;x>=0;x--){const R=g+x,k=b+x;N.takeFromEndWhile(O=>O.lineNumber>k);const E=N.takeFromEndWhile(O=>O.lineNumber===k);r.push(new Ac(R,this.getLineContent(k),E))}if(C<m){const x=g+C;r.push(new aL(x+1,f))}if(C<_){const x=new ji(y),R=g+C,k=_-C,E=s-l-k+R+1,O=[],z=[];for(let j=0;j<k;j++){const ie=E+j;z[j]=this.getLineContent(ie),x.takeWhile(re=>re.lineNumber<ie),O[j]=x.takeWhile(re=>re.lineNumber===ie)}r.push(new lL(R+1,g+_,z,O))}l+=p}this._emitContentChangedEvent(new Rn(r,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:o,eol:this._buffer.getEOL(),isEolChange:!1,versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return n.reverseEdits===null?void 0:n.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e){if(e===null||e.size===0)return;const i=Array.from(e).map(n=>new Ac(n,this.getLineContent(n),this._getInjectedTextInLine(n)));this._onDidChangeInjectedText.fire(new lg(i))}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){const i={addDecoration:(s,o)=>this._deltaDecorationsImpl(e,[],[{range:s,options:o}])[0],changeDecoration:(s,o)=>{this._changeDecorationImpl(s,o)},changeDecorationOptions:(s,o)=>{this._changeDecorationOptionsImpl(s,Wc(o))},removeDecoration:s=>{this._deltaDecorationsImpl(e,[s],[])},deltaDecorations:(s,o)=>s.length===0&&o.length===0?[]:this._deltaDecorationsImpl(e,s,o)};let n=null;try{n=t(i)}catch(s){Oe(s)}return i.addDecoration=ts,i.changeDecoration=ts,i.changeDecorationOptions=ts,i.removeDecoration=ts,i.deltaDecorations=ts,n}deltaDecorations(e,t,i=0){if(this._assertNotDisposed(),e||(e=[]),e.length===0&&t.length===0)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(console.warn("Invoking deltaDecorations recursively could lead to leaking decorations."),Oe(new Error("Invoking deltaDecorations recursively could lead to leaking decorations."))),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(i,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,i){const n=e?this._decorations[e]:null;if(!n)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:Fc[i]}],!0)[0]:null;if(!t)return this._decorationsTree.delete(n),delete this._decorations[n.id],null;const s=this._validateRangeRelaxedNoAllocations(t),o=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),r=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);return this._decorationsTree.delete(n),n.reset(this.getVersionId(),o,r,s),n.setOptions(Fc[i]),this._decorationsTree.insert(n),n.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let i=0,n=t.length;i<n;i++){const s=t[i];this._decorationsTree.delete(s),delete this._decorations[s.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,i=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,i)}getLinesDecorations(e,t,i=0,n=!1,s=!1){const o=this.getLineCount(),r=Math.min(o,Math.max(1,e)),l=Math.min(o,Math.max(1,t)),h=this.getLineMaxColumn(l),c=new v(r,1,l,h),d=this._getDecorationsInRange(c,i,n,s);return Dh(d,this._decorationProvider.getDecorationsInRange(c,i,n)),d}getDecorationsInRange(e,t=0,i=!1,n=!1,s=!1){const o=this.validateRange(e),r=this._getDecorationsInRange(o,t,i,s);return Dh(r,this._decorationProvider.getDecorationsInRange(o,t,i,n)),r}getOverviewRulerDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!0,!1)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),i=t+this._buffer.getLineLength(e),n=this._decorationsTree.getInjectedTextInInterval(this,t,i,0);return gt.fromDecorations(n).filter(s=>s.lineNumber===e)}getAllDecorations(e=0,t=!1){let i=this._decorationsTree.getAll(this,e,t,!1,!1);return i=i.concat(this._decorationProvider.getAllDecorations(e,t)),i}getAllMarginDecorations(e=0){return this._decorationsTree.getAll(this,e,!1,!1,!0)}_getDecorationsInRange(e,t,i,n){const s=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),o=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,s,o,t,i,n)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t){const i=this._decorations[e];if(!i)return;if(i.options.after){const r=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.endLineNumber)}if(i.options.before){const r=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.startLineNumber)}const n=this._validateRangeRelaxedNoAllocations(t),s=this._buffer.getOffsetAt(n.startLineNumber,n.startColumn),o=this._buffer.getOffsetAt(n.endLineNumber,n.endColumn);this._decorationsTree.delete(i),i.reset(this.getVersionId(),s,o,n),this._decorationsTree.insert(i),this._onDidChangeDecorations.checkAffectedAndFire(i.options),i.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(n.endLineNumber),i.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(n.startLineNumber)}_changeDecorationOptionsImpl(e,t){const i=this._decorations[e];if(!i)return;const n=!!(i.options.overviewRuler&&i.options.overviewRuler.color),s=!!(t.overviewRuler&&t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(i.options),this._onDidChangeDecorations.checkAffectedAndFire(t),i.options.after||t.after){const l=this._decorationsTree.getNodeRange(this,i);this._onDidChangeDecorations.recordLineAffectedByInjectedText(l.endLineNumber)}if(i.options.before||t.before){const l=this._decorationsTree.getNodeRange(this,i);this._onDidChangeDecorations.recordLineAffectedByInjectedText(l.startLineNumber)}const o=n!==s,r=_L(t)!==No(i);o||r?(this._decorationsTree.delete(i),i.setOptions(t),this._decorationsTree.insert(i)):i.setOptions(t)}_deltaDecorationsImpl(e,t,i,n=!1){const s=this.getVersionId(),o=t.length;let r=0;const l=i.length;let h=0;this._onDidChangeDecorations.beginDeferredEmit();try{const c=new Array(l);for(;r<o||h<l;){let d=null;if(r<o){do d=this._decorations[t[r++]];while(!d&&r<o);if(d){if(d.options.after){const u=this._decorationsTree.getNodeRange(this,d);this._onDidChangeDecorations.recordLineAffectedByInjectedText(u.endLineNumber)}if(d.options.before){const u=this._decorationsTree.getNodeRange(this,d);this._onDidChangeDecorations.recordLineAffectedByInjectedText(u.startLineNumber)}this._decorationsTree.delete(d),n||this._onDidChangeDecorations.checkAffectedAndFire(d.options)}}if(h<l){if(!d){const C=++this._lastDecorationId,p=`${this._instanceId};${C}`;d=new ig(p,0,0),this._decorations[p]=d}const u=i[h],g=this._validateRangeRelaxedNoAllocations(u.range),f=Wc(u.options),m=this._buffer.getOffsetAt(g.startLineNumber,g.startColumn),_=this._buffer.getOffsetAt(g.endLineNumber,g.endColumn);d.ownerId=e,d.reset(s,m,_,g),d.setOptions(f),d.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(g.endLineNumber),d.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(g.startLineNumber),n||this._onDidChangeDecorations.checkAffectedAndFire(f),this._decorationsTree.insert(d),c[h]=d.id,h++}else d&&delete this._decorations[d.id]}return c}finally{this._onDidChangeDecorations.endDeferredEmit()}}getLanguageId(){return this.tokenization.getLanguageId()}setLanguage(e,t){typeof e=="string"?(this._languageSelectionListener.clear(),this._setLanguage(e,t)):(this._languageSelectionListener.value=e.onDidChange(()=>this._setLanguage(e.languageId,t)),this._setLanguage(e.languageId,t))}_setLanguage(e,t){this.tokenization.setLanguageId(e,t),this._languageService.requestRichLanguageFeatures(e)}getLanguageIdAtPosition(e,t){return this.tokenization.getLanguageIdAtPosition(e,t)}getWordAtPosition(e){return this._tokenizationTextModelPart.getWordAtPosition(e)}getWordUntilPosition(e){return this._tokenizationTextModelPart.getWordUntilPosition(e)}normalizePosition(e,t){return e}getLineIndentColumn(e){return pL(this.getLineContent(e))+1}},Ci=ut,ut._MODEL_SYNC_LIMIT=50*1024*1024,ut.LARGE_FILE_SIZE_THRESHOLD=20*1024*1024,ut.LARGE_FILE_LINE_COUNT_THRESHOLD=300*1e3,ut.LARGE_FILE_HEAP_OPERATION_THRESHOLD=256*1024*1024,ut.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:tn.tabSize,indentSize:tn.indentSize,insertSpaces:tn.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:tn.trimAutoWhitespace,largeFileOptimizations:tn.largeFileOptimizations,bracketPairColorizationOptions:tn.bracketPairColorizationOptions},ut);Pc=Ci=cL([mo(4,Q_),mo(5,Rl),mo(6,Ys),mo(7,Ks)],Pc);function pL(a){let e=0;for(const t of a)if(t===" "||t==="	")e++;else break;return e}function ha(a){return!!(a.options.overviewRuler&&a.options.overviewRuler.color)}function _L(a){return!!a.after||!!a.before}function No(a){return!!a.options.after||!!a.options.before}class Bc{constructor(){this._decorationsTree0=new oa,this._decorationsTree1=new oa,this._injectedTextDecorationsTree=new oa}ensureAllNodesHaveRanges(e){this.getAll(e,0,!1,!1,!1)}_ensureNodesHaveRanges(e,t){for(const i of t)i.range===null&&(i.range=e.getRangeAt(i.cachedAbsoluteStart,i.cachedAbsoluteEnd));return t}getAllInInterval(e,t,i,n,s,o){const r=e.getVersionId(),l=this._intervalSearch(t,i,n,s,r,o);return this._ensureNodesHaveRanges(e,l)}_intervalSearch(e,t,i,n,s,o){const r=this._decorationsTree0.intervalSearch(e,t,i,n,s,o),l=this._decorationsTree1.intervalSearch(e,t,i,n,s,o),h=this._injectedTextDecorationsTree.intervalSearch(e,t,i,n,s,o);return r.concat(l).concat(h)}getInjectedTextInInterval(e,t,i,n){const s=e.getVersionId(),o=this._injectedTextDecorationsTree.intervalSearch(t,i,n,!1,s,!1);return this._ensureNodesHaveRanges(e,o).filter(r=>r.options.showIfCollapsed||!r.range.isEmpty())}getAllInjectedText(e,t){const i=e.getVersionId(),n=this._injectedTextDecorationsTree.search(t,!1,i,!1);return this._ensureNodesHaveRanges(e,n).filter(s=>s.options.showIfCollapsed||!s.range.isEmpty())}getAll(e,t,i,n,s){const o=e.getVersionId(),r=this._search(t,i,n,o,s);return this._ensureNodesHaveRanges(e,r)}_search(e,t,i,n,s){if(i)return this._decorationsTree1.search(e,t,n,s);{const o=this._decorationsTree0.search(e,t,n,s),r=this._decorationsTree1.search(e,t,n,s),l=this._injectedTextDecorationsTree.search(e,t,n,s);return o.concat(r).concat(l)}}collectNodesFromOwner(e){const t=this._decorationsTree0.collectNodesFromOwner(e),i=this._decorationsTree1.collectNodesFromOwner(e),n=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(i).concat(n)}collectNodesPostOrder(){const e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),i=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(i)}insert(e){No(e)?this._injectedTextDecorationsTree.insert(e):ha(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}delete(e){No(e)?this._injectedTextDecorationsTree.delete(e):ha(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}getNodeRange(e,t){const i=e.getVersionId();return t.cachedVersionId!==i&&this._resolveNode(t,i),t.range===null&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}_resolveNode(e,t){No(e)?this._injectedTextDecorationsTree.resolveNode(e,t):ha(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}acceptReplace(e,t,i,n){this._decorationsTree0.acceptReplace(e,t,i,n),this._decorationsTree1.acceptReplace(e,t,i,n),this._injectedTextDecorationsTree.acceptReplace(e,t,i,n)}}function _t(a){return a.replace(/[^a-z0-9\-_]/gi," ")}class hg{constructor(e){this.color=e.color||"",this.darkColor=e.darkColor||""}}class CL extends hg{constructor(e){super(e),this._resolvedColor=null,this.position=typeof e.position=="number"?e.position:Wa.Center}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(e,t){if(typeof e=="string")return e;const i=e?t.getColor(e.id):null;return i?i.toString():""}}class bL{constructor(e){this.position=(e==null?void 0:e.position)??Gi.Center,this.persistLane=e==null?void 0:e.persistLane}}class wL extends hg{constructor(e){super(e),this.position=e.position,this.sectionHeaderStyle=e.sectionHeaderStyle??null,this.sectionHeaderText=e.sectionHeaderText??null}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(e,t){return typeof e=="string"?le.fromHex(e):t.getColor(e.id)}}class Ws{static from(e){return e instanceof Ws?e:new Ws(e)}constructor(e){this.content=e.content||"",this.inlineClassName=e.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=e.attachedData||null,this.cursorStops=e.cursorStops||null}}class it{static register(e){return new it(e)}static createDynamic(e){return new it(e)}constructor(e){this.description=e.description,this.blockClassName=e.blockClassName?_t(e.blockClassName):null,this.blockDoesNotCollapse=e.blockDoesNotCollapse??null,this.blockIsAfterEnd=e.blockIsAfterEnd??null,this.blockPadding=e.blockPadding??null,this.stickiness=e.stickiness||0,this.zIndex=e.zIndex||0,this.className=e.className?_t(e.className):null,this.shouldFillLineOnLineBreak=e.shouldFillLineOnLineBreak??null,this.hoverMessage=e.hoverMessage||null,this.glyphMarginHoverMessage=e.glyphMarginHoverMessage||null,this.lineNumberHoverMessage=e.lineNumberHoverMessage||null,this.isWholeLine=e.isWholeLine||!1,this.showIfCollapsed=e.showIfCollapsed||!1,this.collapseOnReplaceEdit=e.collapseOnReplaceEdit||!1,this.overviewRuler=e.overviewRuler?new CL(e.overviewRuler):null,this.minimap=e.minimap?new wL(e.minimap):null,this.glyphMargin=e.glyphMarginClassName?new bL(e.glyphMargin):null,this.glyphMarginClassName=e.glyphMarginClassName?_t(e.glyphMarginClassName):null,this.linesDecorationsClassName=e.linesDecorationsClassName?_t(e.linesDecorationsClassName):null,this.lineNumberClassName=e.lineNumberClassName?_t(e.lineNumberClassName):null,this.linesDecorationsTooltip=e.linesDecorationsTooltip?af(e.linesDecorationsTooltip):null,this.firstLineDecorationClassName=e.firstLineDecorationClassName?_t(e.firstLineDecorationClassName):null,this.marginClassName=e.marginClassName?_t(e.marginClassName):null,this.inlineClassName=e.inlineClassName?_t(e.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=e.beforeContentClassName?_t(e.beforeContentClassName):null,this.afterContentClassName=e.afterContentClassName?_t(e.afterContentClassName):null,this.after=e.after?Ws.from(e.after):null,this.before=e.before?Ws.from(e.before):null,this.hideInCommentTokens=e.hideInCommentTokens??!1,this.hideInStringTokens=e.hideInStringTokens??!1}}it.EMPTY=it.register({description:"empty"});const Fc=[it.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),it.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),it.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),it.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function Wc(a){return a instanceof it?a:it.createDynamic(a)}class LL extends H{constructor(e){super(),this.handleBeforeFire=e,this._actual=this._register(new M),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._deferredCnt=0,this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._affectsLineNumber=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){var e;this._deferredCnt--,this._deferredCnt===0&&(this._shouldFireDeferred&&this.doFire(),(e=this._affectedInjectedTextLines)==null||e.clear(),this._affectedInjectedTextLines=null)}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}checkAffectedAndFire(e){var t,i;this._affectsMinimap||(this._affectsMinimap=!!((t=e.minimap)!=null&&t.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!!((i=e.overviewRuler)!=null&&i.color)),this._affectsGlyphMargin||(this._affectsGlyphMargin=!!e.glyphMarginClassName),this._affectsLineNumber||(this._affectsLineNumber=!!e.lineNumberClassName),this.tryFire()}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._affectsGlyphMargin=!0,this.tryFire()}tryFire(){this._deferredCnt===0?this.doFire():this._shouldFireDeferred=!0}doFire(){this.handleBeforeFire(this._affectedInjectedTextLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler,affectsGlyphMargin:this._affectsGlyphMargin,affectsLineNumber:this._affectsLineNumber};this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._actual.fire(e)}}class vL extends H{constructor(){super(),this._fastEmitter=this._register(new M),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new M),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(e=null){if(this._deferredCnt--,this._deferredCnt===0&&this._deferredEvent!==null){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;const t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}fire(e){if(this._deferredCnt>0){this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e;return}this._fastEmitter.fire(e),this._slowEmitter.fire(e)}}class ih extends kr{constructor(e){super(),this._onChange=this._register(new M),this.onChange=this._onChange.event,this._onKeyDown=this._register(new M),this.onKeyDown=this._onKeyDown.event,this._opts=e,this._checked=this._opts.isChecked;const t=["monaco-custom-toggle"];this._opts.icon&&(this._icon=this._opts.icon,t.push(...xn.asClassNameArray(this._icon))),this._opts.actionClassName&&t.push(...this._opts.actionClassName.split(" ")),this._checked&&t.push("checked"),this.domNode=document.createElement("div"),this._hover=this._register(Zi().setupManagedHover(e.hoverDelegate??Tt("mouse"),this.domNode,this._opts.title)),this.domNode.classList.add(...t),this._opts.notFocusable||(this.domNode.tabIndex=0),this.domNode.setAttribute("role","checkbox"),this.domNode.setAttribute("aria-checked",String(this._checked)),this.domNode.setAttribute("aria-label",this._opts.title),this.applyStyles(),this.onclick(this.domNode,i=>{this.enabled&&(this.checked=!this._checked,this._onChange.fire(!1),i.preventDefault())}),this._register(this.ignoreGesture(this.domNode)),this.onkeydown(this.domNode,i=>{if(i.keyCode===10||i.keyCode===3){this.checked=!this._checked,this._onChange.fire(!0),i.preventDefault(),i.stopPropagation();return}this._onKeyDown.fire(i)})}get enabled(){return this.domNode.getAttribute("aria-disabled")!=="true"}focus(){this.domNode.focus()}get checked(){return this._checked}set checked(e){this._checked=e,this.domNode.setAttribute("aria-checked",String(this._checked)),this.domNode.classList.toggle("checked",this._checked),this.applyStyles()}width(){return 22}applyStyles(){this.domNode&&(this.domNode.style.borderColor=this._checked&&this._opts.inputActiveOptionBorder||"",this.domNode.style.color=this._checked&&this._opts.inputActiveOptionForeground||"inherit",this.domNode.style.backgroundColor=this._checked&&this._opts.inputActiveOptionBackground||"")}enable(){this.domNode.setAttribute("aria-disabled",String(!1))}disable(){this.domNode.setAttribute("aria-disabled",String(!0))}}const SL=I("caseDescription","Match Case"),xL=I("wordsDescription","Match Whole Word"),yL=I("regexDescription","Use Regular Expression");class NL extends ih{constructor(e){super({icon:Ml.caseSensitive,title:SL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??Tt("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class DL extends ih{constructor(e){super({icon:Ml.wholeWord,title:xL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??Tt("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class IL extends ih{constructor(e){super({icon:Ml.regex,title:yL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??Tt("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class kL{constructor(e,t=0,i=e.length,n=t-1){this.items=e,this.start=t,this.end=i,this.index=n}current(){return this.index===this.start-1||this.index===this.end?null:this.items[this.index]}next(){return this.index=Math.min(this.index+1,this.end),this.current()}previous(){return this.index=Math.max(this.index-1,this.start-1),this.current()}first(){return this.index=this.start,this.current()}last(){return this.index=this.end-1,this.current()}}class TL{constructor(e=[],t=10){this._initialize(e),this._limit=t,this._onChange()}getHistory(){return this._elements}add(e){this._history.delete(e),this._history.add(e),this._onChange()}next(){return this._navigator.next()}previous(){return this._currentPosition()!==0?this._navigator.previous():null}current(){return this._navigator.current()}first(){return this._navigator.first()}last(){return this._navigator.last()}isLast(){return this._currentPosition()>=this._elements.length-1}isNowhere(){return this._navigator.current()===null}has(e){return this._history.has(e)}_onChange(){this._reduceToLimit();const e=this._elements;this._navigator=new kL(e,0,e.length,e.length)}_reduceToLimit(){const e=this._elements;e.length>this._limit&&this._initialize(e.slice(e.length-this._limit))}_currentPosition(){const e=this._navigator.current();return e?this._elements.indexOf(e):-1}_initialize(e){this._history=new Set;for(const t of e)this._history.add(t)}get _elements(){const e=[];return this._history.forEach(t=>e.push(t)),e}}const is=se;class EL extends kr{constructor(e,t,i){super(),this.state="idle",this.maxHeight=Number.POSITIVE_INFINITY,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._onDidHeightChange=this._register(new M),this.onDidHeightChange=this._onDidHeightChange.event,this.contextViewProvider=t,this.options=i,this.message=null,this.placeholder=this.options.placeholder||"",this.tooltip=this.options.tooltip??(this.placeholder||""),this.ariaLabel=this.options.ariaLabel||"",this.options.validationOptions&&(this.validation=this.options.validationOptions.validation),this.element=Y(e,is(".monaco-inputbox.idle"));const n=this.options.flexibleHeight?"textarea":"input",s=Y(this.element,is(".ibwrapper"));if(this.input=Y(s,is(n+".input.empty")),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("spellcheck","false"),this.onfocus(this.input,()=>this.element.classList.add("synthetic-focus")),this.onblur(this.input,()=>this.element.classList.remove("synthetic-focus")),this.options.flexibleHeight){this.maxHeight=typeof this.options.flexibleMaxHeight=="number"?this.options.flexibleMaxHeight:Number.POSITIVE_INFINITY,this.mirror=Y(s,is("div.mirror")),this.mirror.innerText=" ",this.scrollableElement=new Pp(this.element,{vertical:1}),this.options.flexibleWidth&&(this.input.setAttribute("wrap","off"),this.mirror.style.whiteSpace="pre",this.mirror.style.wordWrap="initial"),Y(e,this.scrollableElement.getDomNode()),this._register(this.scrollableElement),this._register(this.scrollableElement.onScroll(l=>this.input.scrollTop=l.scrollTop));const o=this._register(new K(e.ownerDocument,"selectionchange")),r=G.filter(o.event,()=>{const l=e.ownerDocument.getSelection();return(l==null?void 0:l.anchorNode)===s});this._register(r(this.updateScrollDimensions,this)),this._register(this.onDidHeightChange(this.updateScrollDimensions,this))}else this.input.type=this.options.type||"text",this.input.setAttribute("wrap","off");this.ariaLabel&&this.input.setAttribute("aria-label",this.ariaLabel),this.placeholder&&!this.options.showPlaceholderOnFocus&&this.setPlaceHolder(this.placeholder),this.tooltip&&this.setTooltip(this.tooltip),this.oninput(this.input,()=>this.onValueChange()),this.onblur(this.input,()=>this.onBlur()),this.onfocus(this.input,()=>this.onFocus()),this._register(this.ignoreGesture(this.input)),setTimeout(()=>this.updateMirror(),0),this.options.actions&&(this.actionbar=this._register(new cb(this.element)),this.actionbar.push(this.options.actions,{icon:!0,label:!1})),this.applyStyles()}onBlur(){this._hideMessage(),this.options.showPlaceholderOnFocus&&this.input.setAttribute("placeholder","")}onFocus(){this._showMessage(),this.options.showPlaceholderOnFocus&&this.input.setAttribute("placeholder",this.placeholder||"")}setPlaceHolder(e){this.placeholder=e,this.input.setAttribute("placeholder",e)}setTooltip(e){this.tooltip=e,this.hover?this.hover.update(e):this.hover=this._register(Zi().setupManagedHover(Tt("mouse"),this.input,e))}get inputElement(){return this.input}get value(){return this.input.value}set value(e){this.input.value!==e&&(this.input.value=e,this.onValueChange())}get height(){return typeof this.cachedHeight=="number"?this.cachedHeight:Ih(this.element)}focus(){this.input.focus()}blur(){this.input.blur()}hasFocus(){return jd(this.input)}select(e=null){this.input.select(),e&&(this.input.setSelectionRange(e.start,e.end),e.end===this.input.value.length&&(this.input.scrollLeft=this.input.scrollWidth))}isSelectionAtEnd(){return this.input.selectionEnd===this.input.value.length&&this.input.selectionStart===this.input.selectionEnd}getSelection(){const e=this.input.selectionStart;if(e===null)return null;const t=this.input.selectionEnd??e;return{start:e,end:t}}enable(){this.input.removeAttribute("disabled")}disable(){this.blur(),this.input.disabled=!0,this._hideMessage()}set paddingRight(e){this.input.style.width=`calc(100% - ${e}px)`,this.mirror&&(this.mirror.style.paddingRight=e+"px")}updateScrollDimensions(){if(typeof this.cachedContentHeight!="number"||typeof this.cachedHeight!="number"||!this.scrollableElement)return;const e=this.cachedContentHeight,t=this.cachedHeight,i=this.input.scrollTop;this.scrollableElement.setScrollDimensions({scrollHeight:e,height:t}),this.scrollableElement.setScrollPosition({scrollTop:i})}showMessage(e,t){if(this.state==="open"&&qn(this.message,e))return;this.message=e,this.element.classList.remove("idle"),this.element.classList.remove("info"),this.element.classList.remove("warning"),this.element.classList.remove("error"),this.element.classList.add(this.classForType(e.type));const i=this.stylesForType(this.message.type);this.element.style.border=`1px solid ${Sn(i.border,"transparent")}`,this.message.content&&(this.hasFocus()||t)&&this._showMessage()}hideMessage(){this.message=null,this.element.classList.remove("info"),this.element.classList.remove("warning"),this.element.classList.remove("error"),this.element.classList.add("idle"),this._hideMessage(),this.applyStyles()}validate(){let e=null;return this.validation&&(e=this.validation(this.value),e?(this.inputElement.setAttribute("aria-invalid","true"),this.showMessage(e)):this.inputElement.hasAttribute("aria-invalid")&&(this.inputElement.removeAttribute("aria-invalid"),this.hideMessage())),e==null?void 0:e.type}stylesForType(e){const t=this.options.inputBoxStyles;switch(e){case 1:return{border:t.inputValidationInfoBorder,background:t.inputValidationInfoBackground,foreground:t.inputValidationInfoForeground};case 2:return{border:t.inputValidationWarningBorder,background:t.inputValidationWarningBackground,foreground:t.inputValidationWarningForeground};default:return{border:t.inputValidationErrorBorder,background:t.inputValidationErrorBackground,foreground:t.inputValidationErrorForeground}}}classForType(e){switch(e){case 1:return"info";case 2:return"warning";default:return"error"}}_showMessage(){if(!this.contextViewProvider||!this.message)return;let e;const t=()=>e.style.width=Od(this.element)+"px";this.contextViewProvider.showContextView({getAnchor:()=>this.element,anchorAlignment:1,render:n=>{if(!this.message)return null;e=Y(n,is(".monaco-inputbox-container")),t();const s={inline:!0,className:"monaco-inputbox-message"},o=this.message.formatContent?Bp(this.message.content,s):Fp(this.message.content,s);o.classList.add(this.classForType(this.message.type));const r=this.stylesForType(this.message.type);return o.style.backgroundColor=r.background??"",o.style.color=r.foreground??"",o.style.border=r.border?`1px solid ${r.border}`:"",Y(e,o),null},onHide:()=>{this.state="closed"},layout:t});let i;this.message.type===3?i=I("alertErrorMessage","Error: {0}",this.message.content):this.message.type===2?i=I("alertWarningMessage","Warning: {0}",this.message.content):i=I("alertInfoMessage","Info: {0}",this.message.content),Ea(i),this.state="open"}_hideMessage(){this.contextViewProvider&&(this.state==="open"&&this.contextViewProvider.hideContextView(),this.state="idle")}onValueChange(){this._onDidChange.fire(this.value),this.validate(),this.updateMirror(),this.input.classList.toggle("empty",!this.value),this.state==="open"&&this.contextViewProvider&&this.contextViewProvider.layout()}updateMirror(){if(!this.mirror)return;const e=this.value,i=e.charCodeAt(e.length-1)===10?" ":"";(e+i).replace(/\u000c/g,"")?this.mirror.textContent=e+i:this.mirror.innerText=" ",this.layout()}applyStyles(){const e=this.options.inputBoxStyles,t=e.inputBackground??"",i=e.inputForeground??"",n=e.inputBorder??"";this.element.style.backgroundColor=t,this.element.style.color=i,this.input.style.backgroundColor="inherit",this.input.style.color=i,this.element.style.border=`1px solid ${Sn(n,"transparent")}`}layout(){if(!this.mirror)return;const e=this.cachedContentHeight;this.cachedContentHeight=Ih(this.mirror),e!==this.cachedContentHeight&&(this.cachedHeight=Math.min(this.cachedContentHeight,this.maxHeight),this.input.style.height=this.cachedHeight+"px",this._onDidHeightChange.fire(this.cachedContentHeight))}insertAtCursor(e){const t=this.inputElement,i=t.selectionStart,n=t.selectionEnd,s=t.value;i!==null&&n!==null&&(this.value=s.substr(0,i)+e+s.substr(n),t.setSelectionRange(i+1,i+1),this.layout())}dispose(){var e;this._hideMessage(),this.message=null,(e=this.actionbar)==null||e.dispose(),super.dispose()}}class ML extends EL{constructor(e,t,i){const n=I({key:"history.inputbox.hint.suffix.noparens",comment:['Text is the suffix of an input field placeholder coming after the action the input field performs, this will be used when the input field ends in a closing parenthesis ")", for example "Filter (e.g. text, !exclude)". The character inserted into the final string is ⇅ to represent the up and down arrow keys.']}," or {0} for history","⇅"),s=I({key:"history.inputbox.hint.suffix.inparens",comment:['Text is the suffix of an input field placeholder coming after the action the input field performs, this will be used when the input field does NOT end in a closing parenthesis (eg. "Find"). The character inserted into the final string is ⇅ to represent the up and down arrow keys.']}," ({0} for history)","⇅");super(e,t,i),this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new M),this.onDidBlur=this._onDidBlur.event,this.history=new TL(i.history,100);const o=()=>{if(i.showHistoryHint&&i.showHistoryHint()&&!this.placeholder.endsWith(n)&&!this.placeholder.endsWith(s)&&this.history.getHistory().length){const r=this.placeholder.endsWith(")")?n:s,l=this.placeholder+r;i.showPlaceholderOnFocus&&!jd(this.input)?this.placeholder=l:this.setPlaceHolder(l)}};this.observer=new MutationObserver((r,l)=>{r.forEach(h=>{h.target.textContent||o()})}),this.observer.observe(this.input,{attributeFilter:["class"]}),this.onfocus(this.input,()=>o()),this.onblur(this.input,()=>{const r=l=>{if(this.placeholder.endsWith(l)){const h=this.placeholder.slice(0,this.placeholder.length-l.length);return i.showPlaceholderOnFocus?this.placeholder=h:this.setPlaceHolder(h),!0}else return!1};r(s)||r(n)})}dispose(){super.dispose(),this.observer&&(this.observer.disconnect(),this.observer=void 0)}addToHistory(e){this.value&&(e||this.value!==this.getCurrentValue())&&this.history.add(this.value)}isAtLastInHistory(){return this.history.isLast()}isNowhereInHistory(){return this.history.isNowhere()}showNextValue(){this.history.has(this.value)||this.addToHistory();let e=this.getNextValue();e&&(e=e===this.value?this.getNextValue():e),this.value=e??"",Oa(this.value?this.value:I("clearedInput","Cleared Input"))}showPreviousValue(){this.history.has(this.value)||this.addToHistory();let e=this.getPreviousValue();e&&(e=e===this.value?this.getPreviousValue():e),e&&(this.value=e,Oa(this.value))}setPlaceHolder(e){super.setPlaceHolder(e),this.setTooltip(e)}onBlur(){super.onBlur(),this._onDidBlur.fire()}onFocus(){super.onFocus(),this._onDidFocus.fire()}getCurrentValue(){let e=this.history.current();return e||(e=this.history.last(),this.history.next()),e}getPreviousValue(){return this.history.previous()||this.history.first()}getNextValue(){return this.history.next()}}const RL=I("defaultLabel","input");class Oy extends kr{constructor(e,t,i){super(),this.fixFocusOnOptionClickEnabled=!0,this.imeSessionInProgress=!1,this.additionalTogglesDisposables=this._register(new Ui),this.additionalToggles=[],this._onDidOptionChange=this._register(new M),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new M),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new M),this.onMouseDown=this._onMouseDown.event,this._onInput=this._register(new M),this._onKeyUp=this._register(new M),this._onCaseSensitiveKeyDown=this._register(new M),this.onCaseSensitiveKeyDown=this._onCaseSensitiveKeyDown.event,this._onRegexKeyDown=this._register(new M),this.onRegexKeyDown=this._onRegexKeyDown.event,this._lastHighlightFindOptions=0,this.placeholder=i.placeholder||"",this.validation=i.validation,this.label=i.label||RL,this.showCommonFindToggles=!!i.showCommonFindToggles;const n=i.appendCaseSensitiveLabel||"",s=i.appendWholeWordsLabel||"",o=i.appendRegexLabel||"",r=i.history||[],l=!!i.flexibleHeight,h=!!i.flexibleWidth,c=i.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new ML(this.domNode,t,{placeholder:this.placeholder||"",ariaLabel:this.label||"",validationOptions:{validation:this.validation},history:r,showHistoryHint:i.showHistoryHint,flexibleHeight:l,flexibleWidth:h,flexibleMaxHeight:c,inputBoxStyles:i.inputBoxStyles}));const d=this._register(Iu());if(this.showCommonFindToggles){this.regex=this._register(new IL({appendTitle:o,isChecked:!1,hoverDelegate:d,...i.toggleStyles})),this._register(this.regex.onChange(g=>{this._onDidOptionChange.fire(g),!g&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.regex.onKeyDown(g=>{this._onRegexKeyDown.fire(g)})),this.wholeWords=this._register(new DL({appendTitle:s,isChecked:!1,hoverDelegate:d,...i.toggleStyles})),this._register(this.wholeWords.onChange(g=>{this._onDidOptionChange.fire(g),!g&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this.caseSensitive=this._register(new NL({appendTitle:n,isChecked:!1,hoverDelegate:d,...i.toggleStyles})),this._register(this.caseSensitive.onChange(g=>{this._onDidOptionChange.fire(g),!g&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.caseSensitive.onKeyDown(g=>{this._onCaseSensitiveKeyDown.fire(g)}));const u=[this.caseSensitive.domNode,this.wholeWords.domNode,this.regex.domNode];this.onkeydown(this.domNode,g=>{if(g.equals(15)||g.equals(17)||g.equals(9)){const f=u.indexOf(this.domNode.ownerDocument.activeElement);if(f>=0){let m=-1;g.equals(17)?m=(f+1)%u.length:g.equals(15)&&(f===0?m=u.length-1:m=f-1),g.equals(9)?(u[f].blur(),this.inputBox.focus()):m>=0&&u[m].focus(),ne.stop(g,!0)}}})}this.controls=document.createElement("div"),this.controls.className="controls",this.controls.style.display=this.showCommonFindToggles?"":"none",this.caseSensitive&&this.controls.append(this.caseSensitive.domNode),this.wholeWords&&this.controls.appendChild(this.wholeWords.domNode),this.regex&&this.controls.appendChild(this.regex.domNode),this.setAdditionalToggles(i==null?void 0:i.additionalToggles),this.controls&&this.domNode.appendChild(this.controls),e==null||e.appendChild(this.domNode),this._register(F(this.inputBox.inputElement,"compositionstart",u=>{this.imeSessionInProgress=!0})),this._register(F(this.inputBox.inputElement,"compositionend",u=>{this.imeSessionInProgress=!1,this._onInput.fire()})),this.onkeydown(this.inputBox.inputElement,u=>this._onKeyDown.fire(u)),this.onkeyup(this.inputBox.inputElement,u=>this._onKeyUp.fire(u)),this.oninput(this.inputBox.inputElement,u=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,u=>this._onMouseDown.fire(u))}get onDidChange(){return this.inputBox.onDidChange}layout(e){this.inputBox.layout(),this.updateInputBoxPadding(e.collapsedFindWidget)}enable(){var e,t,i;this.domNode.classList.remove("disabled"),this.inputBox.enable(),(e=this.regex)==null||e.enable(),(t=this.wholeWords)==null||t.enable(),(i=this.caseSensitive)==null||i.enable();for(const n of this.additionalToggles)n.enable()}disable(){var e,t,i;this.domNode.classList.add("disabled"),this.inputBox.disable(),(e=this.regex)==null||e.disable(),(t=this.wholeWords)==null||t.disable(),(i=this.caseSensitive)==null||i.disable();for(const n of this.additionalToggles)n.disable()}setFocusInputOnOptionClick(e){this.fixFocusOnOptionClickEnabled=e}setEnabled(e){e?this.enable():this.disable()}setAdditionalToggles(e){for(const t of this.additionalToggles)t.domNode.remove();this.additionalToggles=[],this.additionalTogglesDisposables.value=new pe;for(const t of e??[])this.additionalTogglesDisposables.value.add(t),this.controls.appendChild(t.domNode),this.additionalTogglesDisposables.value.add(t.onChange(i=>{this._onDidOptionChange.fire(i),!i&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus()})),this.additionalToggles.push(t);this.additionalToggles.length>0&&(this.controls.style.display=""),this.updateInputBoxPadding()}updateInputBoxPadding(e=!1){var t,i,n;e?this.inputBox.paddingRight=0:this.inputBox.paddingRight=(((t=this.caseSensitive)==null?void 0:t.width())??0)+(((i=this.wholeWords)==null?void 0:i.width())??0)+(((n=this.regex)==null?void 0:n.width())??0)+this.additionalToggles.reduce((s,o)=>s+o.width(),0)}getValue(){return this.inputBox.value}setValue(e){this.inputBox.value!==e&&(this.inputBox.value=e)}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getCaseSensitive(){var e;return((e=this.caseSensitive)==null?void 0:e.checked)??!1}setCaseSensitive(e){this.caseSensitive&&(this.caseSensitive.checked=e)}getWholeWords(){var e;return((e=this.wholeWords)==null?void 0:e.checked)??!1}setWholeWords(e){this.wholeWords&&(this.wholeWords.checked=e)}getRegex(){var e;return((e=this.regex)==null?void 0:e.checked)??!1}setRegex(e){this.regex&&(this.regex.checked=e,this.validate())}focusOnCaseSensitive(){var e;(e=this.caseSensitive)==null||e.focus()}highlightFindOptions(){this.domNode.classList.remove("highlight-"+this._lastHighlightFindOptions),this._lastHighlightFindOptions=1-this._lastHighlightFindOptions,this.domNode.classList.add("highlight-"+this._lastHighlightFindOptions)}validate(){this.inputBox.validate()}showMessage(e){this.inputBox.showMessage(e)}clearMessage(){this.inputBox.hideMessage()}}var Zn=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s};const AL=!1;var Vc;(function(a){a.North="north",a.South="south",a.East="east",a.West="west"})(Vc||(Vc={}));let OL=4;const PL=new M;let BL=300;const FL=new M;class nh{constructor(e){this.el=e,this.disposables=new pe}get onPointerMove(){return this.disposables.add(new K(ee(this.el),"mousemove")).event}get onPointerUp(){return this.disposables.add(new K(ee(this.el),"mouseup")).event}dispose(){this.disposables.dispose()}}Zn([be],nh.prototype,"onPointerMove",null);Zn([be],nh.prototype,"onPointerUp",null);class sh{get onPointerMove(){return this.disposables.add(new K(this.el,Ne.Change)).event}get onPointerUp(){return this.disposables.add(new K(this.el,Ne.End)).event}constructor(e){this.el=e,this.disposables=new pe}dispose(){this.disposables.dispose()}}Zn([be],sh.prototype,"onPointerMove",null);Zn([be],sh.prototype,"onPointerUp",null);class $o{get onPointerMove(){return this.factory.onPointerMove}get onPointerUp(){return this.factory.onPointerUp}constructor(e){this.factory=e}dispose(){}}Zn([be],$o.prototype,"onPointerMove",null);Zn([be],$o.prototype,"onPointerUp",null);const Hc="pointer-events-disabled";class bt extends H{get state(){return this._state}get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}set state(e){this._state!==e&&(this.el.classList.toggle("disabled",e===0),this.el.classList.toggle("minimum",e===1),this.el.classList.toggle("maximum",e===2),this._state=e,this.onDidEnablementChange.fire(e))}set orthogonalStartSash(e){if(this._orthogonalStartSash!==e){if(this.orthogonalStartDragHandleDisposables.clear(),this.orthogonalStartSashDisposables.clear(),e){const t=i=>{this.orthogonalStartDragHandleDisposables.clear(),i!==0&&(this._orthogonalStartDragHandle=Y(this.el,se(".orthogonal-drag-handle.start")),this.orthogonalStartDragHandleDisposables.add(lt(()=>this._orthogonalStartDragHandle.remove())),this.orthogonalStartDragHandleDisposables.add(new K(this._orthogonalStartDragHandle,"mouseenter")).event(()=>bt.onMouseEnter(e),void 0,this.orthogonalStartDragHandleDisposables),this.orthogonalStartDragHandleDisposables.add(new K(this._orthogonalStartDragHandle,"mouseleave")).event(()=>bt.onMouseLeave(e),void 0,this.orthogonalStartDragHandleDisposables))};this.orthogonalStartSashDisposables.add(e.onDidEnablementChange.event(t,this)),t(e.state)}this._orthogonalStartSash=e}}set orthogonalEndSash(e){if(this._orthogonalEndSash!==e){if(this.orthogonalEndDragHandleDisposables.clear(),this.orthogonalEndSashDisposables.clear(),e){const t=i=>{this.orthogonalEndDragHandleDisposables.clear(),i!==0&&(this._orthogonalEndDragHandle=Y(this.el,se(".orthogonal-drag-handle.end")),this.orthogonalEndDragHandleDisposables.add(lt(()=>this._orthogonalEndDragHandle.remove())),this.orthogonalEndDragHandleDisposables.add(new K(this._orthogonalEndDragHandle,"mouseenter")).event(()=>bt.onMouseEnter(e),void 0,this.orthogonalEndDragHandleDisposables),this.orthogonalEndDragHandleDisposables.add(new K(this._orthogonalEndDragHandle,"mouseleave")).event(()=>bt.onMouseLeave(e),void 0,this.orthogonalEndDragHandleDisposables))};this.orthogonalEndSashDisposables.add(e.onDidEnablementChange.event(t,this)),t(e.state)}this._orthogonalEndSash=e}}constructor(e,t,i){super(),this.hoverDelay=BL,this.hoverDelayer=this._register(new Ed(this.hoverDelay)),this._state=3,this.onDidEnablementChange=this._register(new M),this._onDidStart=this._register(new M),this._onDidChange=this._register(new M),this._onDidReset=this._register(new M),this._onDidEnd=this._register(new M),this.orthogonalStartSashDisposables=this._register(new pe),this.orthogonalStartDragHandleDisposables=this._register(new pe),this.orthogonalEndSashDisposables=this._register(new pe),this.orthogonalEndDragHandleDisposables=this._register(new pe),this.onDidStart=this._onDidStart.event,this.onDidChange=this._onDidChange.event,this.onDidReset=this._onDidReset.event,this.onDidEnd=this._onDidEnd.event,this.linkedSash=void 0,this.el=Y(e,se(".monaco-sash")),i.orthogonalEdge&&this.el.classList.add(`orthogonal-edge-${i.orthogonalEdge}`),Ae&&this.el.classList.add("mac");const n=this._register(new K(this.el,"mousedown")).event;this._register(n(d=>this.onPointerStart(d,new nh(e)),this));const s=this._register(new K(this.el,"dblclick")).event;this._register(s(this.onPointerDoublePress,this));const o=this._register(new K(this.el,"mouseenter")).event;this._register(o(()=>bt.onMouseEnter(this)));const r=this._register(new K(this.el,"mouseleave")).event;this._register(r(()=>bt.onMouseLeave(this))),this._register($t.addTarget(this.el));const l=this._register(new K(this.el,Ne.Start)).event;this._register(l(d=>this.onPointerStart(d,new sh(this.el)),this));const h=this._register(new K(this.el,Ne.Tap)).event;let c;this._register(h(d=>{if(c){clearTimeout(c),c=void 0,this.onPointerDoublePress(d);return}clearTimeout(c),c=setTimeout(()=>c=void 0,250)},this)),typeof i.size=="number"?(this.size=i.size,i.orientation===0?this.el.style.width=`${this.size}px`:this.el.style.height=`${this.size}px`):(this.size=OL,this._register(PL.event(d=>{this.size=d,this.layout()}))),this._register(FL.event(d=>this.hoverDelay=d)),this.layoutProvider=t,this.orthogonalStartSash=i.orthogonalStartSash,this.orthogonalEndSash=i.orthogonalEndSash,this.orientation=i.orientation||0,this.orientation===1?(this.el.classList.add("horizontal"),this.el.classList.remove("vertical")):(this.el.classList.remove("horizontal"),this.el.classList.add("vertical")),this.el.classList.toggle("debug",AL),this.layout()}onPointerStart(e,t){ne.stop(e);let i=!1;if(!e.__orthogonalSashEvent){const f=this.getOrthogonalSash(e);f&&(i=!0,e.__orthogonalSashEvent=!0,f.onPointerStart(e,new $o(t)))}if(this.linkedSash&&!e.__linkedSashEvent&&(e.__linkedSashEvent=!0,this.linkedSash.onPointerStart(e,new $o(t))),!this.state)return;const n=this.el.ownerDocument.getElementsByTagName("iframe");for(const f of n)f.classList.add(Hc);const s=e.pageX,o=e.pageY,r=e.altKey,l={startX:s,currentX:s,startY:o,currentY:o,altKey:r};this.el.classList.add("active"),this._onDidStart.fire(l);const h=Dr(this.el),c=()=>{let f="";i?f="all-scroll":this.orientation===1?this.state===1?f="s-resize":this.state===2?f="n-resize":f=Ae?"row-resize":"ns-resize":this.state===1?f="e-resize":this.state===2?f="w-resize":f=Ae?"col-resize":"ew-resize",h.textContent=`* { cursor: ${f} !important; }`},d=new pe;c(),i||this.onDidEnablementChange.event(c,null,d);const u=f=>{ne.stop(f,!1);const m={startX:s,currentX:f.pageX,startY:o,currentY:f.pageY,altKey:r};this._onDidChange.fire(m)},g=f=>{ne.stop(f,!1),h.remove(),this.el.classList.remove("active"),this._onDidEnd.fire(),d.dispose();for(const m of n)m.classList.remove(Hc)};t.onPointerMove(u,null,d),t.onPointerUp(g,null,d),d.add(t)}onPointerDoublePress(e){const t=this.getOrthogonalSash(e);t&&t._onDidReset.fire(),this.linkedSash&&this.linkedSash._onDidReset.fire(),this._onDidReset.fire()}static onMouseEnter(e,t=!1){e.el.classList.contains("active")?(e.hoverDelayer.cancel(),e.el.classList.add("hover")):e.hoverDelayer.trigger(()=>e.el.classList.add("hover"),e.hoverDelay).then(void 0,()=>{}),!t&&e.linkedSash&&bt.onMouseEnter(e.linkedSash,!0)}static onMouseLeave(e,t=!1){e.hoverDelayer.cancel(),e.el.classList.remove("hover"),!t&&e.linkedSash&&bt.onMouseLeave(e.linkedSash,!0)}clearSashHoverState(){bt.onMouseLeave(this)}layout(){if(this.orientation===0){const e=this.layoutProvider;this.el.style.left=e.getVerticalSashLeft(this)-this.size/2+"px",e.getVerticalSashTop&&(this.el.style.top=e.getVerticalSashTop(this)+"px"),e.getVerticalSashHeight&&(this.el.style.height=e.getVerticalSashHeight(this)+"px")}else{const e=this.layoutProvider;this.el.style.top=e.getHorizontalSashTop(this)-this.size/2+"px",e.getHorizontalSashLeft&&(this.el.style.left=e.getHorizontalSashLeft(this)+"px"),e.getHorizontalSashWidth&&(this.el.style.width=e.getHorizontalSashWidth(this)+"px")}}getOrthogonalSash(e){const t=e.initialTarget??e.target;if(!(!t||!$s(t))&&t.classList.contains("orthogonal-drag-handle"))return t.classList.contains("start")?this.orthogonalStartSash:this.orthogonalEndSash}dispose(){super.dispose(),this.el.remove()}}class Vi extends H{constructor(e,t){super(),this.options=t,this.text="",this.title="",this.highlights=[],this.didEverRender=!1,this.supportIcons=(t==null?void 0:t.supportIcons)??!1,this.domNode=Y(e,se("span.monaco-highlighted-label"))}get element(){return this.domNode}set(e,t=[],i="",n){e||(e=""),n&&(e=Vi.escapeNewLines(e,t)),!(this.didEverRender&&this.text===e&&this.title===i&&qn(this.highlights,t))&&(this.text=e,this.title=i,this.highlights=t,this.render())}render(){var i,n,s;const e=[];let t=0;for(const o of this.highlights){if(o.end===o.start)continue;if(t<o.start){const h=this.text.substring(t,o.start);this.supportIcons?e.push(...jr(h)):e.push(h),t=o.start}const r=this.text.substring(t,o.end),l=se("span.highlight",void 0,...this.supportIcons?jr(r):[r]);o.extraClasses&&l.classList.add(...o.extraClasses),e.push(l),t=o.end}if(t<this.text.length){const o=this.text.substring(t);this.supportIcons?e.push(...jr(o)):e.push(o)}if(lf(this.domNode,...e),(n=(i=this.options)==null?void 0:i.hoverDelegate)!=null&&n.showNativeHover)this.domNode.title=this.title;else if(!this.customHover&&this.title!==""){const o=((s=this.options)==null?void 0:s.hoverDelegate)??Tt("mouse");this.customHover=this._register(Zi().setupManagedHover(o,this.domNode,this.title))}else this.customHover&&this.customHover.update(this.title);this.didEverRender=!0}static escapeNewLines(e,t){let i=0,n=0;return e.replace(/\r\n|\r|\n/g,(s,o)=>{n=s===`\r
`?-1:0,o+=i;for(const r of t)r.end<=o||(r.start>=o&&(r.start+=n),r.end>=o&&(r.end+=n));return i+=n,"⏎"})}}class ns{constructor(e){this._element=e}get element(){return this._element}set textContent(e){this.disposed||e===this._textContent||(this._textContent=e,this._element.textContent=e)}set classNames(e){this.disposed||qn(e,this._classNames)||(this._classNames=e,this._element.classList.value="",this._element.classList.add(...e))}set empty(e){this.disposed||e===this._empty||(this._empty=e,this._element.style.marginLeft=e?"0":"")}dispose(){this.disposed=!0}}class Py extends H{constructor(e,t){super(),this.customHovers=new Map,this.creationOptions=t,this.domNode=this._register(new ns(Y(e,se(".monaco-icon-label")))),this.labelContainer=Y(this.domNode.element,se(".monaco-icon-label-container")),this.nameContainer=Y(this.labelContainer,se("span.monaco-icon-name-container")),t!=null&&t.supportHighlights||t!=null&&t.supportIcons?this.nameNode=this._register(new HL(this.nameContainer,!!t.supportIcons)):this.nameNode=new WL(this.nameContainer),this.hoverDelegate=(t==null?void 0:t.hoverDelegate)??Tt("mouse")}get element(){return this.domNode.element}setLabel(e,t,i){const n=["monaco-icon-label"],s=["monaco-icon-label-container"];let o="";i&&(i.extraClasses&&n.push(...i.extraClasses),i.italic&&n.push("italic"),i.strikethrough&&n.push("strikethrough"),i.disabledCommand&&s.push("disabled"),i.title&&(typeof i.title=="string"?o+=i.title:o+=e));const r=this.domNode.element.querySelector(".monaco-icon-label-iconpath");if(i!=null&&i.iconPath){let l;!r||!$s(r)?(l=se(".monaco-icon-label-iconpath"),this.domNode.element.prepend(l)):l=r,l.style.backgroundImage=Ts(i==null?void 0:i.iconPath)}else r&&r.remove();if(this.domNode.classNames=n,this.domNode.element.setAttribute("aria-label",o),this.labelContainer.classList.value="",this.labelContainer.classList.add(...s),this.setupHover(i!=null&&i.descriptionTitle?this.labelContainer:this.element,i==null?void 0:i.title),this.nameNode.setLabel(e,i),t||this.descriptionNode){const l=this.getOrCreateDescriptionNode();l instanceof Vi?(l.set(t||"",i?i.descriptionMatches:void 0,void 0,i==null?void 0:i.labelEscapeNewLines),this.setupHover(l.element,i==null?void 0:i.descriptionTitle)):(l.textContent=t&&(i!=null&&i.labelEscapeNewLines)?Vi.escapeNewLines(t,[]):t||"",this.setupHover(l.element,(i==null?void 0:i.descriptionTitle)||""),l.empty=!t)}if(i!=null&&i.suffix||this.suffixNode){const l=this.getOrCreateSuffixNode();l.textContent=(i==null?void 0:i.suffix)??""}}setupHover(e,t){const i=this.customHovers.get(e);if(i&&(i.dispose(),this.customHovers.delete(e)),!t){e.removeAttribute("title");return}if(this.hoverDelegate.showNativeHover)(function(s,o){$i(o)?s.title=Wp(o):o!=null&&o.markdownNotSupportedFallback?s.title=o.markdownNotSupportedFallback:s.removeAttribute("title")})(e,t);else{const n=Zi().setupManagedHover(this.hoverDelegate,e,t);n&&this.customHovers.set(e,n)}}dispose(){super.dispose();for(const e of this.customHovers.values())e.dispose();this.customHovers.clear()}getOrCreateSuffixNode(){if(!this.suffixNode){const e=this._register(new ns(hf(this.nameContainer,se("span.monaco-icon-suffix-container"))));this.suffixNode=this._register(new ns(Y(e.element,se("span.label-suffix"))))}return this.suffixNode}getOrCreateDescriptionNode(){var e;if(!this.descriptionNode){const t=this._register(new ns(Y(this.labelContainer,se("span.monaco-icon-description-container"))));(e=this.creationOptions)!=null&&e.supportDescriptionHighlights?this.descriptionNode=this._register(new Vi(Y(t.element,se("span.label-description")),{supportIcons:!!this.creationOptions.supportIcons})):this.descriptionNode=this._register(new ns(Y(t.element,se("span.label-description"))))}return this.descriptionNode}}class WL{constructor(e){this.container=e,this.label=void 0,this.singleLabel=void 0}setLabel(e,t){if(!(this.label===e&&qn(this.options,t)))if(this.label=e,this.options=t,typeof e=="string")this.singleLabel||(this.container.innerText="",this.container.classList.remove("multiple"),this.singleLabel=Y(this.container,se("a.label-name",{id:t==null?void 0:t.domId}))),this.singleLabel.textContent=e;else{this.container.innerText="",this.container.classList.add("multiple"),this.singleLabel=void 0;for(let i=0;i<e.length;i++){const n=e[i],s=(t==null?void 0:t.domId)&&`${t==null?void 0:t.domId}_${i}`;Y(this.container,se("a.label-name",{id:s,"data-icon-label-count":e.length,"data-icon-label-index":i,role:"treeitem"},n)),i<e.length-1&&Y(this.container,se("span.label-separator",void 0,(t==null?void 0:t.separator)||"/"))}}}}function VL(a,e,t){if(!t)return;let i=0;return a.map(n=>{const s={start:i,end:i+n.length},o=t.map(r=>Be.intersect(s,r)).filter(r=>!Be.isEmpty(r)).map(({start:r,end:l})=>({start:r-i,end:l-i}));return i=s.end+e.length,o})}class HL extends H{constructor(e,t){super(),this.container=e,this.supportIcons=t,this.label=void 0,this.singleLabel=void 0}setLabel(e,t){if(!(this.label===e&&qn(this.options,t)))if(this.label=e,this.options=t,typeof e=="string")this.singleLabel||(this.container.innerText="",this.container.classList.remove("multiple"),this.singleLabel=this._register(new Vi(Y(this.container,se("a.label-name",{id:t==null?void 0:t.domId})),{supportIcons:this.supportIcons}))),this.singleLabel.set(e,t==null?void 0:t.matches,void 0,t==null?void 0:t.labelEscapeNewLines);else{this.container.innerText="",this.container.classList.add("multiple"),this.singleLabel=void 0;const i=(t==null?void 0:t.separator)||"/",n=VL(e,i,t==null?void 0:t.matches);for(let s=0;s<e.length;s++){const o=e[s],r=n?n[s]:void 0,l=(t==null?void 0:t.domId)&&`${t==null?void 0:t.domId}_${s}`,h=se("a.label-name",{id:l,"data-icon-label-count":e.length,"data-icon-label-index":s,role:"treeitem"});this._register(new Vi(Y(this.container,h),{supportIcons:this.supportIcons})).set(o,r,void 0,t==null?void 0:t.labelEscapeNewLines),s<e.length-1&&Y(h,se("span.label-separator",void 0,i))}}}}class zL{constructor(...e){this._entries=new Map;for(const[t,i]of e)this.set(t,i)}set(e,t){const i=this._entries.get(e);return this._entries.set(e,t),i}get(e){return this._entries.get(e)}}class yt{constructor(e,t,i,n){this.startColumn=e,this.endColumn=t,this.className=i,this.type=n,this._lineDecorationBrand=void 0}static _equals(e,t){return e.startColumn===t.startColumn&&e.endColumn===t.endColumn&&e.className===t.className&&e.type===t.type}static equalsArr(e,t){const i=e.length,n=t.length;if(i!==n)return!1;for(let s=0;s<i;s++)if(!yt._equals(e[s],t[s]))return!1;return!0}static extractWrapped(e,t,i){if(e.length===0)return e;const n=t+1,s=i+1,o=i-t,r=[];let l=0;for(const h of e)h.endColumn<=n||h.startColumn>=s||(r[l++]=new yt(Math.max(1,h.startColumn-n+1),Math.min(o+1,h.endColumn-n+1),h.className,h.type));return r}static filter(e,t,i,n){if(e.length===0)return[];const s=[];let o=0;for(let r=0,l=e.length;r<l;r++){const h=e[r],c=h.range;if(c.endLineNumber<t||c.startLineNumber>t||c.isEmpty()&&(h.type===0||h.type===3))continue;const d=c.startLineNumber===t?c.startColumn:i,u=c.endLineNumber===t?c.endColumn:n;s[o++]=new yt(d,u,h.inlineClassName,h.type)}return s}static _typeCompare(e,t){const i=[2,0,1,3];return i[e]-i[t]}static compare(e,t){if(e.startColumn!==t.startColumn)return e.startColumn-t.startColumn;if(e.endColumn!==t.endColumn)return e.endColumn-t.endColumn;const i=yt._typeCompare(e.type,t.type);return i!==0?i:e.className!==t.className?e.className<t.className?-1:1:0}}class zc{constructor(e,t,i,n){this.startOffset=e,this.endOffset=t,this.className=i,this.metadata=n}}class Go{constructor(){this.stopOffsets=[],this.classNames=[],this.metadata=[],this.count=0}static _metadata(e){let t=0;for(let i=0,n=e.length;i<n;i++)t|=e[i];return t}consumeLowerThan(e,t,i){for(;this.count>0&&this.stopOffsets[0]<e;){let n=0;for(;n+1<this.count&&this.stopOffsets[n]===this.stopOffsets[n+1];)n++;i.push(new zc(t,this.stopOffsets[n],this.classNames.join(" "),Go._metadata(this.metadata))),t=this.stopOffsets[n]+1,this.stopOffsets.splice(0,n+1),this.classNames.splice(0,n+1),this.metadata.splice(0,n+1),this.count-=n+1}return this.count>0&&t<e&&(i.push(new zc(t,e-1,this.classNames.join(" "),Go._metadata(this.metadata))),t=e),t}insert(e,t,i){if(this.count===0||this.stopOffsets[this.count-1]<=e)this.stopOffsets.push(e),this.classNames.push(t),this.metadata.push(i);else for(let n=0;n<this.count;n++)if(this.stopOffsets[n]>=e){this.stopOffsets.splice(n,0,e),this.classNames.splice(n,0,t),this.metadata.splice(n,0,i);break}this.count++}}class UL{static normalize(e,t){if(t.length===0)return[];const i=[],n=new Go;let s=0;for(let o=0,r=t.length;o<r;o++){const l=t[o];let h=l.startColumn,c=l.endColumn;const d=l.className,u=l.type===1?2:l.type===2?4:0;if(h>1){const m=e.charCodeAt(h-2);We(m)&&h--}if(c>1){const m=e.charCodeAt(c-2);We(m)&&c--}const g=h-1,f=c-2;s=n.consumeLowerThan(g,s,i),n.count===0&&(s=g),n.insert(f,d,u)}return n.consumeLowerThan(1073741824,s,i),i}}class ve{constructor(e,t,i,n){this.endIndex=e,this.type=t,this.metadata=i,this.containsRTL=n,this._linePartBrand=void 0}isWhitespace(){return!!(this.metadata&1)}isPseudoAfter(){return!!(this.metadata&4)}}class cg{constructor(e,t){this.startOffset=e,this.endOffset=t}equals(e){return this.startOffset===e.startOffset&&this.endOffset===e.endOffset}}class jL{constructor(e,t,i,n,s,o,r,l,h,c,d,u,g,f,m,_,C,p,b){this.useMonospaceOptimizations=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=i,this.continuesWithWrappedLine=n,this.isBasicASCII=s,this.containsRTL=o,this.fauxIndentLength=r,this.lineTokens=l,this.lineDecorations=h.sort(yt.compare),this.tabSize=c,this.startVisibleColumn=d,this.spaceWidth=u,this.stopRenderingLineAfter=m,this.renderWhitespace=_==="all"?4:_==="boundary"?1:_==="selection"?2:_==="trailing"?3:0,this.renderControlCharacters=C,this.fontLigatures=p,this.selectionsOnLine=b&&b.sort((S,y)=>S.startOffset<y.startOffset?-1:1);const w=Math.abs(f-u),L=Math.abs(g-u);w<L?(this.renderSpaceWidth=f,this.renderSpaceCharCode=11825):(this.renderSpaceWidth=g,this.renderSpaceCharCode=183)}sameSelection(e){if(this.selectionsOnLine===null)return e===null;if(e===null||e.length!==this.selectionsOnLine.length)return!1;for(let t=0;t<this.selectionsOnLine.length;t++)if(!this.selectionsOnLine[t].equals(e[t]))return!1;return!0}equals(e){return this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineContent===e.lineContent&&this.continuesWithWrappedLine===e.continuesWithWrappedLine&&this.isBasicASCII===e.isBasicASCII&&this.containsRTL===e.containsRTL&&this.fauxIndentLength===e.fauxIndentLength&&this.tabSize===e.tabSize&&this.startVisibleColumn===e.startVisibleColumn&&this.spaceWidth===e.spaceWidth&&this.renderSpaceWidth===e.renderSpaceWidth&&this.renderSpaceCharCode===e.renderSpaceCharCode&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.fontLigatures===e.fontLigatures&&yt.equalsArr(this.lineDecorations,e.lineDecorations)&&this.lineTokens.equals(e.lineTokens)&&this.sameSelection(e.selectionsOnLine)}}class dg{constructor(e,t){this.partIndex=e,this.charIndex=t}}class xt{static getPartIndex(e){return(e&4294901760)>>>16}static getCharIndex(e){return(e&65535)>>>0}constructor(e,t){this.length=e,this._data=new Uint32Array(this.length),this._horizontalOffset=new Uint32Array(this.length)}setColumnInfo(e,t,i,n){const s=(t<<16|i<<0)>>>0;this._data[e-1]=s,this._horizontalOffset[e-1]=n}getHorizontalOffset(e){return this._horizontalOffset.length===0?0:this._horizontalOffset[e-1]}charOffsetToPartData(e){return this.length===0?0:e<0?this._data[0]:e>=this.length?this._data[this.length-1]:this._data[e]}getDomPosition(e){const t=this.charOffsetToPartData(e-1),i=xt.getPartIndex(t),n=xt.getCharIndex(t);return new dg(i,n)}getColumn(e,t){return this.partDataToCharOffset(e.partIndex,t,e.charIndex)+1}partDataToCharOffset(e,t,i){if(this.length===0)return 0;const n=(e<<16|i<<0)>>>0;let s=0,o=this.length-1;for(;s+1<o;){const m=s+o>>>1,_=this._data[m];if(_===n)return m;_>n?o=m:s=m}if(s===o)return s;const r=this._data[s],l=this._data[o];if(r===n)return s;if(l===n)return o;const h=xt.getPartIndex(r),c=xt.getCharIndex(r),d=xt.getPartIndex(l);let u;h!==d?u=t:u=xt.getCharIndex(l);const g=i-c,f=u-i;return g<=f?s:o}}class rl{constructor(e,t,i){this._renderLineOutputBrand=void 0,this.characterMapping=e,this.containsRTL=t,this.containsForeignElements=i}}function ug(a,e){if(a.lineContent.length===0){if(a.lineDecorations.length>0){e.appendString("<span>");let t=0,i=0,n=0;for(const o of a.lineDecorations)(o.type===1||o.type===2)&&(e.appendString('<span class="'),e.appendString(o.className),e.appendString('"></span>'),o.type===1&&(n|=1,t++),o.type===2&&(n|=2,i++));e.appendString("</span>");const s=new xt(1,t+i);return s.setColumnInfo(1,t,0,0),new rl(s,!1,n)}return e.appendString("<span><span></span></span>"),new rl(new xt(0,0),!1,0)}return JL(KL(a),e)}class $L{constructor(e,t,i,n){this.characterMapping=e,this.html=t,this.containsRTL=i,this.containsForeignElements=n}}function By(a){const e=new Pl(1e4),t=ug(a,e);return new $L(t.characterMapping,e.build(),t.containsRTL,t.containsForeignElements)}class GL{constructor(e,t,i,n,s,o,r,l,h,c,d,u,g,f,m,_){this.fontIsMonospace=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=i,this.len=n,this.isOverflowing=s,this.overflowingCharCount=o,this.parts=r,this.containsForeignElements=l,this.fauxIndentLength=h,this.tabSize=c,this.startVisibleColumn=d,this.containsRTL=u,this.spaceWidth=g,this.renderSpaceCharCode=f,this.renderWhitespace=m,this.renderControlCharacters=_}}function KL(a){const e=a.lineContent;let t,i,n;a.stopRenderingLineAfter!==-1&&a.stopRenderingLineAfter<e.length?(t=!0,i=e.length-a.stopRenderingLineAfter,n=a.stopRenderingLineAfter):(t=!1,i=0,n=e.length);let s=qL(e,a.containsRTL,a.lineTokens,a.fauxIndentLength,n);a.renderControlCharacters&&!a.isBasicASCII&&(s=QL(e,s)),(a.renderWhitespace===4||a.renderWhitespace===1||a.renderWhitespace===2&&a.selectionsOnLine||a.renderWhitespace===3&&!a.continuesWithWrappedLine)&&(s=YL(a,e,n,s));let o=0;if(a.lineDecorations.length>0){for(let r=0,l=a.lineDecorations.length;r<l;r++){const h=a.lineDecorations[r];h.type===3||h.type===1?o|=1:h.type===2&&(o|=2)}s=XL(e,n,s,a.lineDecorations)}return a.containsRTL||(s=ZL(e,s,!a.isBasicASCII||a.fontLigatures)),new GL(a.useMonospaceOptimizations,a.canUseHalfwidthRightwardsArrow,e,n,t,i,s,o,a.fauxIndentLength,a.tabSize,a.startVisibleColumn,a.containsRTL,a.spaceWidth,a.renderSpaceCharCode,a.renderWhitespace,a.renderControlCharacters)}function qL(a,e,t,i,n){const s=[];let o=0;i>0&&(s[o++]=new ve(i,"",0,!1));let r=i;for(let l=0,h=t.getCount();l<h;l++){const c=t.getEndOffset(l);if(c<=i)continue;const d=t.getClassName(l);if(c>=n){const g=e?Es(a.substring(r,n)):!1;s[o++]=new ve(n,d,0,g);break}const u=e?Es(a.substring(r,c)):!1;s[o++]=new ve(c,d,0,u),r=c}return s}function ZL(a,e,t){let i=0;const n=[];let s=0;if(t)for(let o=0,r=e.length;o<r;o++){const l=e[o],h=l.endIndex;if(i+50<h){const c=l.type,d=l.metadata,u=l.containsRTL;let g=-1,f=i;for(let m=i;m<h;m++)a.charCodeAt(m)===32&&(g=m),g!==-1&&m-f>=50&&(n[s++]=new ve(g+1,c,d,u),f=g+1,g=-1);f!==h&&(n[s++]=new ve(h,c,d,u))}else n[s++]=l;i=h}else for(let o=0,r=e.length;o<r;o++){const l=e[o],h=l.endIndex,c=h-i;if(c>50){const d=l.type,u=l.metadata,g=l.containsRTL,f=Math.ceil(c/50);for(let m=1;m<f;m++){const _=i+m*50;n[s++]=new ve(_,d,u,g)}n[s++]=new ve(h,d,u,g)}else n[s++]=l;i=h}return n}function gg(a){return a<32?a!==9:a===127||a>=8234&&a<=8238||a>=8294&&a<=8297||a>=8206&&a<=8207||a===1564}function QL(a,e){const t=[];let i=new ve(0,"",0,!1),n=0;for(const s of e){const o=s.endIndex;for(;n<o;n++){const r=a.charCodeAt(n);gg(r)&&(n>i.endIndex&&(i=new ve(n,s.type,s.metadata,s.containsRTL),t.push(i)),i=new ve(n+1,"mtkcontrol",s.metadata,!1),t.push(i))}n>i.endIndex&&(i=new ve(o,s.type,s.metadata,s.containsRTL),t.push(i))}return t}function YL(a,e,t,i){const n=a.continuesWithWrappedLine,s=a.fauxIndentLength,o=a.tabSize,r=a.startVisibleColumn,l=a.useMonospaceOptimizations,h=a.selectionsOnLine,c=a.renderWhitespace===1,d=a.renderWhitespace===3,u=a.renderSpaceWidth!==a.spaceWidth,g=[];let f=0,m=0,_=i[m].type,C=i[m].containsRTL,p=i[m].endIndex;const b=i.length;let w=!1,L=Je(e),S;L===-1?(w=!0,L=t,S=t):S=Kn(e);let y=!1,N=0,x=h&&h[N],R=r%o;for(let E=s;E<t;E++){const O=e.charCodeAt(E);x&&E>=x.endOffset&&(N++,x=h&&h[N]);let z;if(E<L||E>S)z=!0;else if(O===9)z=!0;else if(O===32)if(c)if(y)z=!0;else{const j=E+1<t?e.charCodeAt(E+1):0;z=j===32||j===9}else z=!0;else z=!1;if(z&&h&&(z=!!x&&x.startOffset<=E&&x.endOffset>E),z&&d&&(z=w||E>S),z&&C&&E>=L&&E<=S&&(z=!1),y){if(!z||!l&&R>=o){if(u){const j=f>0?g[f-1].endIndex:s;for(let ie=j+1;ie<=E;ie++)g[f++]=new ve(ie,"mtkw",1,!1)}else g[f++]=new ve(E,"mtkw",1,!1);R=R%o}}else(E===p||z&&E>s)&&(g[f++]=new ve(E,_,0,C),R=R%o);for(O===9?R=o:ri(O)?R+=2:R++,y=z;E===p&&(m++,m<b);)_=i[m].type,C=i[m].containsRTL,p=i[m].endIndex}let k=!1;if(y)if(n&&c){const E=t>0?e.charCodeAt(t-1):0,O=t>1?e.charCodeAt(t-2):0;E===32&&O!==32&&O!==9||(k=!0)}else k=!0;if(k)if(u){const E=f>0?g[f-1].endIndex:s;for(let O=E+1;O<=t;O++)g[f++]=new ve(O,"mtkw",1,!1)}else g[f++]=new ve(t,"mtkw",1,!1);else g[f++]=new ve(t,_,0,C);return g}function XL(a,e,t,i){i.sort(yt.compare);const n=UL.normalize(a,i),s=n.length;let o=0;const r=[];let l=0,h=0;for(let d=0,u=t.length;d<u;d++){const g=t[d],f=g.endIndex,m=g.type,_=g.metadata,C=g.containsRTL;for(;o<s&&n[o].startOffset<f;){const p=n[o];if(p.startOffset>h&&(h=p.startOffset,r[l++]=new ve(h,m,_,C)),p.endOffset+1<=f)h=p.endOffset+1,r[l++]=new ve(h,m+" "+p.className,_|p.metadata,C),o++;else{h=f,r[l++]=new ve(h,m+" "+p.className,_|p.metadata,C);break}}f>h&&(h=f,r[l++]=new ve(h,m,_,C))}const c=t[t.length-1].endIndex;if(o<s&&n[o].startOffset===c)for(;o<s&&n[o].startOffset===c;){const d=n[o];r[l++]=new ve(h,d.className,d.metadata,!1),o++}return r}function JL(a,e){const t=a.fontIsMonospace,i=a.canUseHalfwidthRightwardsArrow,n=a.containsForeignElements,s=a.lineContent,o=a.len,r=a.isOverflowing,l=a.overflowingCharCount,h=a.parts,c=a.fauxIndentLength,d=a.tabSize,u=a.startVisibleColumn,g=a.containsRTL,f=a.spaceWidth,m=a.renderSpaceCharCode,_=a.renderWhitespace,C=a.renderControlCharacters,p=new xt(o+1,h.length);let b=!1,w=0,L=u,S=0,y=0,N=0;g?e.appendString('<span dir="ltr">'):e.appendString("<span>");for(let x=0,R=h.length;x<R;x++){const k=h[x],E=k.endIndex,O=k.type,z=k.containsRTL,j=_!==0&&k.isWhitespace(),ie=j&&!t&&(O==="mtkw"||!n),re=w===E&&k.isPseudoAfter();if(S=0,e.appendString("<span "),z&&e.appendString('style="unicode-bidi:isolate" '),e.appendString('class="'),e.appendString(ie?"mtkz":O),e.appendASCIICharCode(34),j){let he=0;{let q=w,de=L;for(;q<E;q++){const Yn=(s.charCodeAt(q)===9?d-de%d:1)|0;he+=Yn,q>=c&&(de+=Yn)}}for(ie&&(e.appendString(' style="width:'),e.appendString(String(f*he)),e.appendString('px"')),e.appendASCIICharCode(62);w<E;w++){p.setColumnInfo(w+1,x-N,S,y),N=0;const q=s.charCodeAt(w);let de,Ie;if(q===9){de=d-L%d|0,Ie=de,!i||Ie>1?e.appendCharCode(8594):e.appendCharCode(65515);for(let Yn=2;Yn<=Ie;Yn++)e.appendCharCode(160)}else de=2,Ie=1,e.appendCharCode(m),e.appendCharCode(8204);S+=de,y+=Ie,w>=c&&(L+=Ie)}}else for(e.appendASCIICharCode(62);w<E;w++){p.setColumnInfo(w+1,x-N,S,y),N=0;const he=s.charCodeAt(w);let q=1,de=1;switch(he){case 9:q=d-L%d,de=q;for(let Ie=1;Ie<=q;Ie++)e.appendCharCode(160);break;case 32:e.appendCharCode(160);break;case 60:e.appendString("&lt;");break;case 62:e.appendString("&gt;");break;case 38:e.appendString("&amp;");break;case 0:C?e.appendCharCode(9216):e.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:e.appendCharCode(65533);break;default:ri(he)&&de++,C&&he<32?e.appendCharCode(9216+he):C&&he===127?e.appendCharCode(9249):C&&gg(he)?(e.appendString("[U+"),e.appendString(ev(he)),e.appendString("]"),q=8,de=q):e.appendCharCode(he)}S+=q,y+=de,w>=c&&(L+=de)}re?N++:N=0,w>=o&&!b&&k.isPseudoAfter()&&(b=!0,p.setColumnInfo(w+1,x,S,y)),e.appendString("</span>")}return b||p.setColumnInfo(o+1,h.length-1,S,y),r&&(e.appendString('<span class="mtkoverflow">'),e.appendString(I("showMore","Show more ({0})",tv(l))),e.appendString("</span>")),e.appendString("</span>"),new rl(p,g,n)}function ev(a){return a.toString(16).toUpperCase().padStart(4,"0")}function tv(a){return a<1024?I("overflow.chars","{0} chars",a):a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/1024/1024).toFixed(1)} MB`}class Uc{constructor(e,t,i,n){this._viewportBrand=void 0,this.top=e|0,this.left=t|0,this.width=i|0,this.height=n|0}}class iv{constructor(e,t){this.tabSize=e,this.data=t}}class oh{constructor(e,t,i,n,s,o,r){this._viewLineDataBrand=void 0,this.content=e,this.continuesWithWrappedLine=t,this.minColumn=i,this.maxColumn=n,this.startVisibleColumn=s,this.tokens=o,this.inlineDecorations=r}}class Ko{constructor(e,t,i,n,s,o,r,l,h,c){this.minColumn=e,this.maxColumn=t,this.content=i,this.continuesWithWrappedLine=n,this.isBasicASCII=Ko.isBasicASCII(i,o),this.containsRTL=Ko.containsRTL(i,this.isBasicASCII,s),this.tokens=r,this.inlineDecorations=l,this.tabSize=h,this.startVisibleColumn=c}static isBasicASCII(e,t){return t?Hd(e):!0}static containsRTL(e,t,i){return!t&&i?Es(e):!1}}class Do{constructor(e,t,i){this.range=e,this.inlineClassName=t,this.type=i}}class nv{constructor(e,t,i,n){this.startOffset=e,this.endOffset=t,this.inlineClassName=i,this.inlineClassNameAffectsLetterSpacing=n}toInlineDecoration(e){return new Do(new v(e,this.startOffset+1,e,this.endOffset+1),this.inlineClassName,this.inlineClassNameAffectsLetterSpacing?3:0)}}class fg{constructor(e,t){this._viewModelDecorationBrand=void 0,this.range=e,this.options=t}}class Vs{constructor(e,t,i){this.color=e,this.zIndex=t,this.data=i}static compareByRenderingProps(e,t){return e.zIndex===t.zIndex?e.color<t.color?-1:e.color>t.color?1:0:e.zIndex-t.zIndex}static equals(e,t){return e.color===t.color&&e.zIndex===t.zIndex&&Nt(e.data,t.data)}static equalsArr(e,t){return Nt(e,t,Vs.equals)}}var sv=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ov=function(a,e){return function(t,i){e(t,i,a)}},Bn;let qo=(Bn=class{constructor(e,t){}dispose(){}},Bn.ID="editor.contrib.markerDecorations",Bn);qo=sv([ov(1,Kb)],qo);cf(qo.ID,qo,0);class rv extends H{constructor(e,t){super(),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._referenceDomElement=e,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,t)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){if(!this._resizeObserver&&this._referenceDomElement){let e=null;const t=()=>{e?this.observe({width:e.width,height:e.height}):this.observe()};let i=!1,n=!1;const s=()=>{if(i&&!n)try{i=!1,n=!0,t()}finally{Fn(ee(this._referenceDomElement),()=>{n=!1,s()})}};this._resizeObserver=new ResizeObserver(o=>{o&&o[0]&&o[0].contentRect?e={width:o[0].contentRect.width,height:o[0].contentRect.height}:e=null,i=!0,s()}),this._resizeObserver.observe(this._referenceDomElement)}}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(e){this.measureReferenceDomElement(!0,e)}measureReferenceDomElement(e,t){let i=0,n=0;t?(i=t.width,n=t.height):this._referenceDomElement&&(i=this._referenceDomElement.clientWidth,n=this._referenceDomElement.clientHeight),i=Math.max(5,i),n=Math.max(5,n),(this._width!==i||this._height!==n)&&(this._width=i,this._height=n,e&&this._onDidChange.fire())}}const wn=class wn{constructor(e,t){this.key=e,this.migrate=t}apply(e){const t=wn._read(e,this.key),i=s=>wn._read(e,s),n=(s,o)=>wn._write(e,s,o);this.migrate(t,i,n)}static _read(e,t){if(typeof e>"u")return;const i=t.indexOf(".");if(i>=0){const n=t.substring(0,i);return this._read(e[n],t.substring(i+1))}return e[t]}static _write(e,t,i){const n=t.indexOf(".");if(n>=0){const s=t.substring(0,n);e[s]=e[s]||{},this._write(e[s],t.substring(n+1),i);return}e[t]=i}};wn.items=[];let Hs=wn;function mt(a,e){Hs.items.push(new Hs(a,e))}function Qe(a,e){mt(a,(t,i,n)=>{if(typeof t<"u"){for(const[s,o]of e)if(t===s){n(a,o);return}}})}function av(a){Hs.items.forEach(e=>e.apply(a))}Qe("wordWrap",[[!0,"on"],[!1,"off"]]);Qe("lineNumbers",[[!0,"on"],[!1,"off"]]);Qe("cursorBlinking",[["visible","solid"]]);Qe("renderWhitespace",[[!0,"boundary"],[!1,"none"]]);Qe("renderLineHighlight",[[!0,"line"],[!1,"none"]]);Qe("acceptSuggestionOnEnter",[[!0,"on"],[!1,"off"]]);Qe("tabCompletion",[[!1,"off"],[!0,"onlySnippets"]]);Qe("hover",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);Qe("parameterHints",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);Qe("autoIndent",[[!1,"advanced"],[!0,"full"]]);Qe("matchBrackets",[[!0,"always"],[!1,"never"]]);Qe("renderFinalNewline",[[!0,"on"],[!1,"off"]]);Qe("cursorSmoothCaretAnimation",[[!0,"on"],[!1,"off"]]);Qe("occurrencesHighlight",[[!0,"singleFile"],[!1,"off"]]);Qe("wordBasedSuggestions",[[!0,"matchingDocuments"],[!1,"off"]]);mt("autoClosingBrackets",(a,e,t)=>{a===!1&&(t("autoClosingBrackets","never"),typeof e("autoClosingQuotes")>"u"&&t("autoClosingQuotes","never"),typeof e("autoSurround")>"u"&&t("autoSurround","never"))});mt("renderIndentGuides",(a,e,t)=>{typeof a<"u"&&(t("renderIndentGuides",void 0),typeof e("guides.indentation")>"u"&&t("guides.indentation",!!a))});mt("highlightActiveIndentGuide",(a,e,t)=>{typeof a<"u"&&(t("highlightActiveIndentGuide",void 0),typeof e("guides.highlightActiveIndentation")>"u"&&t("guides.highlightActiveIndentation",!!a))});const lv={method:"showMethods",function:"showFunctions",constructor:"showConstructors",deprecated:"showDeprecated",field:"showFields",variable:"showVariables",class:"showClasses",struct:"showStructs",interface:"showInterfaces",module:"showModules",property:"showProperties",event:"showEvents",operator:"showOperators",unit:"showUnits",value:"showValues",constant:"showConstants",enum:"showEnums",enumMember:"showEnumMembers",keyword:"showKeywords",text:"showWords",color:"showColors",file:"showFiles",reference:"showReferences",folder:"showFolders",typeParameter:"showTypeParameters",snippet:"showSnippets"};mt("suggest.filteredTypes",(a,e,t)=>{if(a&&typeof a=="object"){for(const i of Object.entries(lv))a[i[0]]===!1&&typeof e(`suggest.${i[1]}`)>"u"&&t(`suggest.${i[1]}`,!1);t("suggest.filteredTypes",void 0)}});mt("quickSuggestions",(a,e,t)=>{if(typeof a=="boolean"){const i=a?"on":"off";t("quickSuggestions",{comments:i,strings:i,other:i})}});mt("experimental.stickyScroll.enabled",(a,e,t)=>{typeof a=="boolean"&&(t("experimental.stickyScroll.enabled",void 0),typeof e("stickyScroll.enabled")>"u"&&t("stickyScroll.enabled",a))});mt("experimental.stickyScroll.maxLineCount",(a,e,t)=>{typeof a=="number"&&(t("experimental.stickyScroll.maxLineCount",void 0),typeof e("stickyScroll.maxLineCount")>"u"&&t("stickyScroll.maxLineCount",a))});mt("codeActionsOnSave",(a,e,t)=>{if(a&&typeof a=="object"){let i=!1;const n={};for(const s of Object.entries(a))typeof s[1]=="boolean"?(i=!0,n[s[0]]=s[1]?"explicit":"never"):n[s[0]]=s[1];i&&t("codeActionsOnSave",n)}});mt("codeActionWidget.includeNearbyQuickfixes",(a,e,t)=>{typeof a=="boolean"&&(t("codeActionWidget.includeNearbyQuickfixes",void 0),typeof e("codeActionWidget.includeNearbyQuickFixes")>"u"&&t("codeActionWidget.includeNearbyQuickFixes",a))});mt("lightbulb.enabled",(a,e,t)=>{typeof a=="boolean"&&t("lightbulb.enabled",a?void 0:"off")});class hv{constructor(){this._tabFocus=!1,this._onDidChangeTabFocus=new M,this.onDidChangeTabFocus=this._onDidChangeTabFocus.event}getTabFocusMode(){return this._tabFocus}setTabFocusMode(e){this._tabFocus=e,this._onDidChangeTabFocus.fire(this._tabFocus)}}const Zo=new hv;var cv=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},dv=function(a,e){return function(t,i){e(t,i,a)}};let al=class extends H{constructor(e,t,i,n,s){super(),this._accessibilityService=s,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._onDidChangeFast=this._register(new M),this.onDidChangeFast=this._onDidChangeFast.event,this._isDominatedByLongLines=!1,this._viewLineCount=1,this._lineNumbersDigitCount=1,this._reservedHeight=0,this._glyphMarginDecorationLaneCount=1,this._computeOptionsMemory=new Vp,this.isSimpleWidget=e,this.contextMenuId=t,this._containerObserver=this._register(new rv(n,i.dimension)),this._targetWindowId=ee(n).vscodeWindowId,this._rawOptions=jc(i),this._validatedOptions=Jt.validateOptions(this._rawOptions),this.options=this._computeOptions(),this.options.get(13)&&this._containerObserver.startObserving(),this._register(vi.onDidChangeZoomLevel(()=>this._recomputeOptions())),this._register(Zo.onDidChangeTabFocus(()=>this._recomputeOptions())),this._register(this._containerObserver.onDidChange(()=>this._recomputeOptions())),this._register(qh.onDidChange(()=>this._recomputeOptions())),this._register(Bo.getInstance(ee(n)).onDidChange(()=>this._recomputeOptions())),this._register(this._accessibilityService.onDidChangeScreenReaderOptimized(()=>this._recomputeOptions()))}_recomputeOptions(){const e=this._computeOptions(),t=Jt.checkEquals(this.options,e);t!==null&&(this.options=e,this._onDidChangeFast.fire(t),this._onDidChange.fire(t))}_computeOptions(){const e=this._readEnvConfiguration(),t=Nn.createFromValidatedSettings(this._validatedOptions,e.pixelRatio,this.isSimpleWidget),i=this._readFontInfo(t),n={memory:this._computeOptionsMemory,outerWidth:e.outerWidth,outerHeight:e.outerHeight-this._reservedHeight,fontInfo:i,extraEditorClassName:e.extraEditorClassName,isDominatedByLongLines:this._isDominatedByLongLines,viewLineCount:this._viewLineCount,lineNumbersDigitCount:this._lineNumbersDigitCount,emptySelectionClipboard:e.emptySelectionClipboard,pixelRatio:e.pixelRatio,tabFocusMode:Zo.getTabFocusMode(),accessibilitySupport:e.accessibilitySupport,glyphMarginDecorationLaneCount:this._glyphMarginDecorationLaneCount};return Jt.computeOptions(this._validatedOptions,n)}_readEnvConfiguration(){return{extraEditorClassName:gv(),outerWidth:this._containerObserver.getWidth(),outerHeight:this._containerObserver.getHeight(),emptySelectionClipboard:$d||oi,pixelRatio:Bo.getInstance(kh(this._targetWindowId,!0).window).value,accessibilitySupport:this._accessibilityService.isScreenReaderOptimized()?2:this._accessibilityService.getAccessibilitySupport()}}_readFontInfo(e){return qh.readFontInfo(kh(this._targetWindowId,!0).window,e)}getRawOptions(){return this._rawOptions}updateOptions(e){const t=jc(e);Jt.applyUpdate(this._rawOptions,t)&&(this._validatedOptions=Jt.validateOptions(this._rawOptions),this._recomputeOptions())}observeContainer(e){this._containerObserver.observe(e)}setIsDominatedByLongLines(e){this._isDominatedByLongLines!==e&&(this._isDominatedByLongLines=e,this._recomputeOptions())}setModelLineCount(e){const t=uv(e);this._lineNumbersDigitCount!==t&&(this._lineNumbersDigitCount=t,this._recomputeOptions())}setViewLineCount(e){this._viewLineCount!==e&&(this._viewLineCount=e,this._recomputeOptions())}setReservedHeight(e){this._reservedHeight!==e&&(this._reservedHeight=e,this._recomputeOptions())}setGlyphMarginDecorationLaneCount(e){this._glyphMarginDecorationLaneCount!==e&&(this._glyphMarginDecorationLaneCount=e,this._recomputeOptions())}};al=cv([dv(4,Mr)],al);function uv(a){let e=0;for(;a;)a=Math.floor(a/10),e++;return e||1}function gv(){let a="";return!Ms&&!df&&(a+="no-user-select "),Ms&&(a+="no-minimap-shadow ",a+="enable-user-select "),Ae&&(a+="mac "),a}class fv{constructor(){this._values=[]}_read(e){return this._values[e]}get(e){return this._values[e]}_write(e,t){this._values[e]=t}}class mv{constructor(){this._values=[]}_read(e){if(e>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[e]}get(e){return this._read(e)}_write(e,t){this._values[e]=t}}class Jt{static validateOptions(e){const t=new fv;for(const i of oo){const n=i.name==="_never_"?void 0:e[i.name];t._write(i.id,i.validate(n))}return t}static computeOptions(e,t){const i=new mv;for(const n of oo)i._write(n.id,n.compute(t,i,e._read(n.id)));return i}static _deepEquals(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return e===t;if(Array.isArray(e)||Array.isArray(t))return Array.isArray(e)&&Array.isArray(t)?Nt(e,t):!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!Jt._deepEquals(e[i],t[i]))return!1;return!0}static checkEquals(e,t){const i=[];let n=!1;for(const s of oo){const o=!Jt._deepEquals(e._read(s.id),t._read(s.id));i[s.id]=o,o&&(n=!0)}return n?new Hp(i):null}static applyUpdate(e,t){let i=!1;for(const n of oo)if(t.hasOwnProperty(n.name)){const s=n.applyUpdate(e[n.name],t[n.name]);e[n.name]=s.newValue,i=i||s.didChange}return i}}function jc(a){const e=zp(a);return av(e),e}var ti;(function(a){const e={total:0,min:Number.MAX_VALUE,max:0},t={...e},i={...e},n={...e};let s=0;const o={keydown:0,input:0,render:0};function r(){C(),performance.mark("inputlatency/start"),performance.mark("keydown/start"),o.keydown=1,queueMicrotask(l)}a.onKeyDown=r;function l(){o.keydown===1&&(performance.mark("keydown/end"),o.keydown=2)}function h(){performance.mark("input/start"),o.input=1,_()}a.onBeforeInput=h;function c(){o.input===0&&h(),queueMicrotask(d)}a.onInput=c;function d(){o.input===1&&(performance.mark("input/end"),o.input=2)}function u(){C()}a.onKeyUp=u;function g(){C()}a.onSelectionChange=g;function f(){o.keydown===2&&o.input===2&&o.render===0&&(performance.mark("render/start"),o.render=1,queueMicrotask(m),_())}a.onRenderStart=f;function m(){o.render===1&&(performance.mark("render/end"),o.render=2)}function _(){setTimeout(C)}function C(){o.keydown===2&&o.input===2&&o.render===2&&(performance.mark("inputlatency/end"),performance.measure("keydown","keydown/start","keydown/end"),performance.measure("input","input/start","input/end"),performance.measure("render","render/start","render/end"),performance.measure("inputlatency","inputlatency/start","inputlatency/end"),p("keydown",e),p("input",t),p("render",i),p("inputlatency",n),s++,b())}function p(y,N){const x=performance.getEntriesByName(y)[0].duration;N.total+=x,N.min=Math.min(N.min,x),N.max=Math.max(N.max,x)}function b(){performance.clearMarks("keydown/start"),performance.clearMarks("keydown/end"),performance.clearMarks("input/start"),performance.clearMarks("input/end"),performance.clearMarks("render/start"),performance.clearMarks("render/end"),performance.clearMarks("inputlatency/start"),performance.clearMarks("inputlatency/end"),performance.clearMeasures("keydown"),performance.clearMeasures("input"),performance.clearMeasures("render"),performance.clearMeasures("inputlatency"),o.keydown=0,o.input=0,o.render=0}function w(){if(s===0)return;const y={keydown:L(e),input:L(t),render:L(i),total:L(n),sampleCount:s};return S(e),S(t),S(i),S(n),s=0,y}a.getAndClearMeasurements=w;function L(y){return{average:y.total/s,max:y.max,min:y.min}}function S(y){y.total=0,y.min=Number.MAX_VALUE,y.max=0}})(ti||(ti={}));class Fr{constructor(e,t){this.x=e,this.y=t,this._pageCoordinatesBrand=void 0}toClientCoordinates(e){return new mg(this.x-e.scrollX,this.y-e.scrollY)}}class mg{constructor(e,t){this.clientX=e,this.clientY=t,this._clientCoordinatesBrand=void 0}toPageCoordinates(e){return new Fr(this.clientX+e.scrollX,this.clientY+e.scrollY)}}class pv{constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n,this._editorPagePositionBrand=void 0}}class _v{constructor(e,t){this.x=e,this.y=t,this._positionRelativeToEditorBrand=void 0}}function rh(a){const e=Wn(a);return new pv(e.left,e.top,e.width,e.height)}function ah(a,e,t){const i=e.width/a.offsetWidth,n=e.height/a.offsetHeight,s=(t.x-e.x)/i,o=(t.y-e.y)/n;return new _v(s,o)}class hi extends Rd{constructor(e,t,i){super(ee(i),e),this._editorMouseEventBrand=void 0,this.isFromPointerCapture=t,this.pos=new Fr(this.posx,this.posy),this.editorPos=rh(i),this.relativePos=ah(i,this.editorPos,this.pos)}}class Cv{constructor(e){this._editorViewDomNode=e}_create(e){return new hi(e,!1,this._editorViewDomNode)}onContextMenu(e,t){return F(e,"contextmenu",i=>{t(this._create(i))})}onMouseUp(e,t){return F(e,"mouseup",i=>{t(this._create(i))})}onMouseDown(e,t){return F(e,oe.MOUSE_DOWN,i=>{t(this._create(i))})}onPointerDown(e,t){return F(e,oe.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onMouseLeave(e,t){return F(e,oe.MOUSE_LEAVE,i=>{t(this._create(i))})}onMouseMove(e,t){return F(e,"mousemove",i=>t(this._create(i)))}}class bv{constructor(e){this._editorViewDomNode=e}_create(e){return new hi(e,!1,this._editorViewDomNode)}onPointerUp(e,t){return F(e,"pointerup",i=>{t(this._create(i))})}onPointerDown(e,t){return F(e,oe.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onPointerLeave(e,t){return F(e,oe.POINTER_LEAVE,i=>{t(this._create(i))})}onPointerMove(e,t){return F(e,"pointermove",i=>t(this._create(i)))}}class wv extends H{constructor(e){super(),this._editorViewDomNode=e,this._globalPointerMoveMonitor=this._register(new ru),this._keydownListener=null}startMonitoring(e,t,i,n,s){this._keydownListener=ni(e.ownerDocument,"keydown",o=>{o.toKeyCodeChord().isModifierKey()||this._globalPointerMoveMonitor.stopMonitoring(!0,o.browserEvent)},!0),this._globalPointerMoveMonitor.startMonitoring(e,t,i,o=>{n(new hi(o,!0,this._editorViewDomNode))},o=>{this._keydownListener.dispose(),s(o)})}stopMonitoring(){this._globalPointerMoveMonitor.stopMonitoring(!0)}}const mr=class mr{constructor(e){this._editor=e,this._instanceId=++mr._idPool,this._counter=0,this._rules=new Map,this._garbageCollectionScheduler=new si(()=>this.garbageCollect(),1e3)}createClassNameRef(e){const t=this.getOrCreateRule(e);return t.increaseRefCount(),{className:t.className,dispose:()=>{t.decreaseRefCount(),this._garbageCollectionScheduler.schedule()}}}getOrCreateRule(e){const t=this.computeUniqueKey(e);let i=this._rules.get(t);if(!i){const n=this._counter++;i=new Lv(t,`dyn-rule-${this._instanceId}-${n}`,uf(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,e),this._rules.set(t,i)}return i}computeUniqueKey(e){return JSON.stringify(e)}garbageCollect(){for(const e of this._rules.values())e.hasReferences()||(this._rules.delete(e.key),e.dispose())}};mr._idPool=0;let $c=mr;class Lv{constructor(e,t,i,n){this.key=e,this.className=t,this.properties=n,this._referenceCount=0,this._styleElementDisposables=new pe,this._styleElement=Dr(i,void 0,this._styleElementDisposables),this._styleElement.textContent=this.getCssText(this.className,this.properties)}getCssText(e,t){let i=`.${e} {`;for(const n in t){const s=t[n];let o;typeof s=="object"?o=T(s.id):o=s;const r=vv(n);i+=`
	${r}: ${o};`}return i+=`
}`,i}dispose(){this._styleElementDisposables.dispose(),this._styleElement=void 0}increaseRefCount(){this._referenceCount++}decreaseRefCount(){this._referenceCount--}hasReferences(){return this._referenceCount>0}}function vv(a){return a.replace(/(^[A-Z])/,([e])=>e.toLowerCase()).replace(/([A-Z])/g,([e])=>`-${e.toLowerCase()}`)}class eo extends H{constructor(){super(),this._shouldRender=!0}shouldRender(){return this._shouldRender}forceShouldRender(){this._shouldRender=!0}setShouldRender(){this._shouldRender=!0}onDidRender(){this._shouldRender=!1}onCompositionStart(e){return!1}onCompositionEnd(e){return!1}onConfigurationChanged(e){return!1}onCursorStateChanged(e){return!1}onDecorationsChanged(e){return!1}onFlushed(e){return!1}onFocusChanged(e){return!1}onLanguageConfigurationChanged(e){return!1}onLineMappingChanged(e){return!1}onLinesChanged(e){return!1}onLinesDeleted(e){return!1}onLinesInserted(e){return!1}onRevealRangeRequest(e){return!1}onScrollChanged(e){return!1}onThemeChanged(e){return!1}onTokensChanged(e){return!1}onTokensColorsChanged(e){return!1}onZonesChanged(e){return!1}handleEvents(e){let t=!1;for(let i=0,n=e.length;i<n;i++){const s=e[i];switch(s.type){case 0:this.onCompositionStart(s)&&(t=!0);break;case 1:this.onCompositionEnd(s)&&(t=!0);break;case 2:this.onConfigurationChanged(s)&&(t=!0);break;case 3:this.onCursorStateChanged(s)&&(t=!0);break;case 4:this.onDecorationsChanged(s)&&(t=!0);break;case 5:this.onFlushed(s)&&(t=!0);break;case 6:this.onFocusChanged(s)&&(t=!0);break;case 7:this.onLanguageConfigurationChanged(s)&&(t=!0);break;case 8:this.onLineMappingChanged(s)&&(t=!0);break;case 9:this.onLinesChanged(s)&&(t=!0);break;case 10:this.onLinesDeleted(s)&&(t=!0);break;case 11:this.onLinesInserted(s)&&(t=!0);break;case 12:this.onRevealRangeRequest(s)&&(t=!0);break;case 13:this.onScrollChanged(s)&&(t=!0);break;case 15:this.onTokensChanged(s)&&(t=!0);break;case 14:this.onThemeChanged(s)&&(t=!0);break;case 16:this.onTokensColorsChanged(s)&&(t=!0);break;case 17:this.onZonesChanged(s)&&(t=!0);break;default:console.info("View received unknown event: "),console.info(s)}}t&&(this._shouldRender=!0)}}class Ye extends eo{constructor(e){super(),this._context=e,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}}class ft{static write(e,t){e.setAttribute("data-mprt",String(t))}static read(e){const t=e.getAttribute("data-mprt");return t===null?0:parseInt(t,10)}static collect(e,t){const i=[];let n=0;for(;e&&e!==e.ownerDocument.body&&e!==t;)e.nodeType===e.ELEMENT_NODE&&(i[n++]=this.read(e)),e=e.parentElement;const s=new Uint8Array(n);for(let o=0;o<n;o++)s[o]=i[n-o-1];return s}}class Sv{constructor(e,t){this._restrictedRenderingContextBrand=void 0,this._viewLayout=e,this.viewportData=t,this.scrollWidth=this._viewLayout.getScrollWidth(),this.scrollHeight=this._viewLayout.getScrollHeight(),this.visibleRange=this.viewportData.visibleRange,this.bigNumbersDelta=this.viewportData.bigNumbersDelta;const i=this._viewLayout.getCurrentViewport();this.scrollTop=i.top,this.scrollLeft=i.left,this.viewportWidth=i.width,this.viewportHeight=i.height}getScrolledTopFromAbsoluteTop(e){return e-this.scrollTop}getVerticalOffsetForLineNumber(e,t){return this._viewLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t){return this._viewLayout.getVerticalOffsetAfterLineNumber(e,t)}getDecorationsInViewport(){return this.viewportData.getDecorationsInViewport()}}class xv extends Sv{constructor(e,t,i){super(e,t),this._renderingContextBrand=void 0,this._viewLines=i}linesVisibleRangesForRange(e,t){return this._viewLines.linesVisibleRangesForRange(e,t)}visibleRangeForPosition(e){return this._viewLines.visibleRangeForPosition(e)}}class yv{constructor(e,t,i,n){this.outsideRenderedLine=e,this.lineNumber=t,this.ranges=i,this.continuesOnNextLine=n}}class Wr{static from(e){const t=new Array(e.length);for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=new Wr(s.left,s.width)}return t}constructor(e,t){this._horizontalRangeBrand=void 0,this.left=Math.round(e),this.width=Math.round(t)}toString(){return`[${this.left},${this.width}]`}}class Hi{constructor(e,t){this._floatHorizontalRangeBrand=void 0,this.left=e,this.width=t}toString(){return`[${this.left},${this.width}]`}static compare(e,t){return e.left-t.left}}class Nv{constructor(e,t){this.outsideRenderedLine=e,this.originalLeft=t,this.left=Math.round(this.originalLeft)}}class Gc{constructor(e,t){this.outsideRenderedLine=e,this.ranges=t}}class Io{static _createRange(){return this._handyReadyRange||(this._handyReadyRange=document.createRange()),this._handyReadyRange}static _detachRange(e,t){e.selectNodeContents(t)}static _readClientRects(e,t,i,n,s){const o=this._createRange();try{return o.setStart(e,t),o.setEnd(i,n),o.getClientRects()}catch{return null}finally{this._detachRange(o,s)}}static _mergeAdjacentRanges(e){if(e.length===1)return e;e.sort(Hi.compare);const t=[];let i=0,n=e[0];for(let s=1,o=e.length;s<o;s++){const r=e[s];n.left+n.width+.9>=r.left?n.width=Math.max(n.width,r.left+r.width-n.left):(t[i++]=n,n=r)}return t[i++]=n,t}static _createHorizontalRangesFromClientRects(e,t,i){if(!e||e.length===0)return null;const n=[];for(let s=0,o=e.length;s<o;s++){const r=e[s];n[s]=new Hi(Math.max(0,(r.left-t)/i),r.width/i)}return this._mergeAdjacentRanges(n)}static readHorizontalRanges(e,t,i,n,s,o){const l=e.children.length-1;if(0>l)return null;if(t=Math.min(l,Math.max(0,t)),n=Math.min(l,Math.max(0,n)),t===n&&i===s&&i===0&&!e.children[t].firstChild){const u=e.children[t].getClientRects();return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(u,o.clientRectDeltaLeft,o.clientRectScale)}t!==n&&n>0&&s===0&&(n--,s=1073741824);let h=e.children[t].firstChild,c=e.children[n].firstChild;if((!h||!c)&&(!h&&i===0&&t>0&&(h=e.children[t-1].firstChild,i=1073741824),!c&&s===0&&n>0&&(c=e.children[n-1].firstChild,s=1073741824)),!h||!c)return null;i=Math.min(h.textContent.length,Math.max(0,i)),s=Math.min(c.textContent.length,Math.max(0,s));const d=this._readClientRects(h,i,c,s,o.endNode);return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(d,o.clientRectDeltaLeft,o.clientRectScale)}}const Dv=function(){return gf?!0:!(Zs||oi||Ms)}();let An=!0;class Kc{constructor(e,t){this.themeType=t;const i=e.options,n=i.get(50);i.get(38)==="off"?this.renderWhitespace=i.get(100):this.renderWhitespace="none",this.renderControlCharacters=i.get(95),this.spaceWidth=n.spaceWidth,this.middotWidth=n.middotWidth,this.wsmiddotWidth=n.wsmiddotWidth,this.useMonospaceOptimizations=n.isMonospace&&!i.get(33),this.canUseHalfwidthRightwardsArrow=n.canUseHalfwidthRightwardsArrow,this.lineHeight=i.get(67),this.stopRenderingLineAfter=i.get(118),this.fontLigatures=i.get(51)}equals(e){return this.themeType===e.themeType&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.fontLigatures===e.fontLigatures}}const pr=class pr{constructor(e){this._options=e,this._isMaybeInvalid=!0,this._renderedViewLine=null}getDomNode(){return this._renderedViewLine&&this._renderedViewLine.domNode?this._renderedViewLine.domNode.domNode:null}setDomNode(e){if(this._renderedViewLine)this._renderedViewLine.domNode=Q(e);else throw new Error("I have no rendered view line to set the dom node to...")}onContentChanged(){this._isMaybeInvalid=!0}onTokensChanged(){this._isMaybeInvalid=!0}onDecorationsChanged(){this._isMaybeInvalid=!0}onOptionsChanged(e){this._isMaybeInvalid=!0,this._options=e}onSelectionChanged(){return ds(this._options.themeType)||this._options.renderWhitespace==="selection"?(this._isMaybeInvalid=!0,!0):!1}renderLine(e,t,i,n,s){if(this._isMaybeInvalid===!1)return!1;this._isMaybeInvalid=!1;const o=n.getViewLineRenderingData(e),r=this._options,l=yt.filter(o.inlineDecorations,e,o.minColumn,o.maxColumn);let h=null;if(ds(r.themeType)||this._options.renderWhitespace==="selection"){const g=n.selections;for(const f of g){if(f.endLineNumber<e||f.startLineNumber>e)continue;const m=f.startLineNumber===e?f.startColumn:o.minColumn,_=f.endLineNumber===e?f.endColumn:o.maxColumn;m<_&&(ds(r.themeType)&&l.push(new yt(m,_,"inline-selected-text",0)),this._options.renderWhitespace==="selection"&&(h||(h=[]),h.push(new cg(m-1,_-1))))}}const c=new jL(r.useMonospaceOptimizations,r.canUseHalfwidthRightwardsArrow,o.content,o.continuesWithWrappedLine,o.isBasicASCII,o.containsRTL,o.minColumn-1,o.tokens,l,o.tabSize,o.startVisibleColumn,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,r.stopRenderingLineAfter,r.renderWhitespace,r.renderControlCharacters,r.fontLigatures!==Qd.OFF,h);if(this._renderedViewLine&&this._renderedViewLine.input.equals(c))return!1;s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString('px;" class="'),s.appendString(pr.CLASS_NAME),s.appendString('">');const d=ug(c,s);s.appendString("</div>");let u=null;return An&&Dv&&o.isBasicASCII&&r.useMonospaceOptimizations&&d.containsForeignElements===0&&(u=new _o(this._renderedViewLine?this._renderedViewLine.domNode:null,c,d.characterMapping)),u||(u=_g(this._renderedViewLine?this._renderedViewLine.domNode:null,c,d.characterMapping,d.containsRTL,d.containsForeignElements)),this._renderedViewLine=u,!0}layoutLine(e,t,i){this._renderedViewLine&&this._renderedViewLine.domNode&&(this._renderedViewLine.domNode.setTop(t),this._renderedViewLine.domNode.setHeight(i))}getWidth(e){return this._renderedViewLine?this._renderedViewLine.getWidth(e):0}getWidthIsFast(){return this._renderedViewLine?this._renderedViewLine.getWidthIsFast():!0}needsMonospaceFontCheck(){return this._renderedViewLine?this._renderedViewLine instanceof _o:!1}monospaceAssumptionsAreValid(){return this._renderedViewLine&&this._renderedViewLine instanceof _o?this._renderedViewLine.monospaceAssumptionsAreValid():An}onMonospaceAssumptionsInvalidated(){this._renderedViewLine&&this._renderedViewLine instanceof _o&&(this._renderedViewLine=this._renderedViewLine.toSlowRenderedLine())}getVisibleRangesForRange(e,t,i,n){if(!this._renderedViewLine)return null;t=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,t)),i=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,i));const s=this._renderedViewLine.input.stopRenderingLineAfter;if(s!==-1&&t>s+1&&i>s+1)return new Gc(!0,[new Hi(this.getWidth(n),0)]);s!==-1&&t>s+1&&(t=s+1),s!==-1&&i>s+1&&(i=s+1);const o=this._renderedViewLine.getVisibleRangesForRange(e,t,i,n);return o&&o.length>0?new Gc(!1,o):null}getColumnOfNodeOffset(e,t){return this._renderedViewLine?this._renderedViewLine.getColumnOfNodeOffset(e,t):1}};pr.CLASS_NAME="view-line";let Ht=pr;class _o{constructor(e,t,i){this._cachedWidth=-1,this.domNode=e,this.input=t;const n=Math.floor(t.lineContent.length/300);if(n>0){this._keyColumnPixelOffsetCache=new Float32Array(n);for(let s=0;s<n;s++)this._keyColumnPixelOffsetCache[s]=-1}else this._keyColumnPixelOffsetCache=null;this._characterMapping=i,this._charWidth=t.spaceWidth}getWidth(e){if(!this.domNode||this.input.lineContent.length<300){const t=this._characterMapping.getHorizontalOffset(this._characterMapping.length);return Math.round(this._charWidth*t)}return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth}getWidthIsFast(){return this.input.lineContent.length<300||this._cachedWidth!==-1}monospaceAssumptionsAreValid(){if(!this.domNode)return An;if(this.input.lineContent.length<300){const e=this.getWidth(null),t=this.domNode.domNode.firstChild.offsetWidth;Math.abs(e-t)>=2&&(console.warn("monospace assumptions have been violated, therefore disabling monospace optimizations!"),An=!1)}return An}toSlowRenderedLine(){return _g(this.domNode,this.input,this._characterMapping,!1,0)}getVisibleRangesForRange(e,t,i,n){const s=this._getColumnPixelOffset(e,t,n),o=this._getColumnPixelOffset(e,i,n);return[new Hi(s,o-s)]}_getColumnPixelOffset(e,t,i){if(t<=300){const h=this._characterMapping.getHorizontalOffset(t);return this._charWidth*h}const n=Math.floor((t-1)/300)-1,s=(n+1)*300+1;let o=-1;if(this._keyColumnPixelOffsetCache&&(o=this._keyColumnPixelOffsetCache[n],o===-1&&(o=this._actualReadPixelOffset(e,s,i),this._keyColumnPixelOffsetCache[n]=o)),o===-1){const h=this._characterMapping.getHorizontalOffset(t);return this._charWidth*h}const r=this._characterMapping.getHorizontalOffset(s),l=this._characterMapping.getHorizontalOffset(t);return o+this._charWidth*(l-r)}_getReadingTarget(e){return e.domNode.firstChild}_actualReadPixelOffset(e,t,i){if(!this.domNode)return-1;const n=this._characterMapping.getDomPosition(t),s=Io.readHorizontalRanges(this._getReadingTarget(this.domNode),n.partIndex,n.charIndex,n.partIndex,n.charIndex,i);return!s||s.length===0?-1:s[0].left}getColumnOfNodeOffset(e,t){return Cg(this._characterMapping,e,t)}}class pg{constructor(e,t,i,n,s){if(this.domNode=e,this.input=t,this._characterMapping=i,this._isWhitespaceOnly=/^\s*$/.test(t.lineContent),this._containsForeignElements=s,this._cachedWidth=-1,this._pixelOffsetCache=null,!n||this._characterMapping.length===0){this._pixelOffsetCache=new Float32Array(Math.max(2,this._characterMapping.length+1));for(let o=0,r=this._characterMapping.length;o<=r;o++)this._pixelOffsetCache[o]=-1}}_getReadingTarget(e){return e.domNode.firstChild}getWidth(e){return this.domNode?(this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth):0}getWidthIsFast(){return this._cachedWidth!==-1}getVisibleRangesForRange(e,t,i,n){if(!this.domNode)return null;if(this._pixelOffsetCache!==null){const s=this._readPixelOffset(this.domNode,e,t,n);if(s===-1)return null;const o=this._readPixelOffset(this.domNode,e,i,n);return o===-1?null:[new Hi(s,o-s)]}return this._readVisibleRangesForRange(this.domNode,e,t,i,n)}_readVisibleRangesForRange(e,t,i,n,s){if(i===n){const o=this._readPixelOffset(e,t,i,s);return o===-1?null:[new Hi(o,0)]}else return this._readRawVisibleRangesForRange(e,i,n,s)}_readPixelOffset(e,t,i,n){if(this._characterMapping.length===0){if(this._containsForeignElements===0||this._containsForeignElements===2)return 0;if(this._containsForeignElements===1)return this.getWidth(n);const s=this._getReadingTarget(e);return s.firstChild?(n.markDidDomLayout(),s.firstChild.offsetWidth):0}if(this._pixelOffsetCache!==null){const s=this._pixelOffsetCache[i];if(s!==-1)return s;const o=this._actualReadPixelOffset(e,t,i,n);return this._pixelOffsetCache[i]=o,o}return this._actualReadPixelOffset(e,t,i,n)}_actualReadPixelOffset(e,t,i,n){if(this._characterMapping.length===0){const l=Io.readHorizontalRanges(this._getReadingTarget(e),0,0,0,0,n);return!l||l.length===0?-1:l[0].left}if(i===this._characterMapping.length&&this._isWhitespaceOnly&&this._containsForeignElements===0)return this.getWidth(n);const s=this._characterMapping.getDomPosition(i),o=Io.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,s.partIndex,s.charIndex,n);if(!o||o.length===0)return-1;const r=o[0].left;if(this.input.isBasicASCII){const l=this._characterMapping.getHorizontalOffset(i),h=Math.round(this.input.spaceWidth*l);if(Math.abs(h-r)<=1)return h}return r}_readRawVisibleRangesForRange(e,t,i,n){if(t===1&&i===this._characterMapping.length)return[new Hi(0,this.getWidth(n))];const s=this._characterMapping.getDomPosition(t),o=this._characterMapping.getDomPosition(i);return Io.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,o.partIndex,o.charIndex,n)}getColumnOfNodeOffset(e,t){return Cg(this._characterMapping,e,t)}}class Iv extends pg{_readVisibleRangesForRange(e,t,i,n,s){const o=super._readVisibleRangesForRange(e,t,i,n,s);if(!o||o.length===0||i===n||i===1&&n===this._characterMapping.length)return o;if(!this.input.containsRTL){const r=this._readPixelOffset(e,t,n,s);if(r!==-1){const l=o[o.length-1];l.left<r&&(l.width=r-l.left)}}return o}}const _g=function(){return $d?kv:Tv}();function kv(a,e,t,i,n){return new Iv(a,e,t,i,n)}function Tv(a,e,t,i,n){return new pg(a,e,t,i,n)}function Cg(a,e,t){const i=e.textContent.length;let n=-1;for(;e;)e=e.previousSibling,n++;return a.getColumn(new dg(n,t),i)}class zs{static whitespaceVisibleColumn(e,t,i){const n=e.length;let s=0,o=-1,r=-1;for(let l=0;l<n;l++){if(l===t)return[o,r,s];switch(s%i===0&&(o=l,r=s),e.charCodeAt(l)){case 32:s+=1;break;case 9:s=Ce.nextRenderTabStop(s,i);break;default:return[-1,-1,-1]}}return t===n?[o,r,s]:[-1,-1,-1]}static atomicPosition(e,t,i,n){const s=e.length,[o,r,l]=zs.whitespaceVisibleColumn(e,t,i);if(l===-1)return-1;let h;switch(n){case 0:h=!0;break;case 1:h=!1;break;case 2:if(l%i===0)return t;h=l%i<=i/2;break}if(h){if(o===-1)return-1;let u=r;for(let g=o;g<s;++g){if(u===r+i)return o;switch(e.charCodeAt(g)){case 32:u+=1;break;case 9:u=Ce.nextRenderTabStop(u,i);break;default:return-1}}return u===r+i?o:-1}const c=Ce.nextRenderTabStop(l,i);let d=l;for(let u=t;u<s;u++){if(d===c)return u;switch(e.charCodeAt(u)){case 32:d+=1;break;case 9:d=Ce.nextRenderTabStop(d,i);break;default:return-1}}return d===c?s:-1}}class qt{constructor(e=null){this.hitTarget=e,this.type=0}}class bg{get hitTarget(){return this.spanNode}constructor(e,t,i){this.position=e,this.spanNode=t,this.injectedText=i,this.type=1}}var Ni;(function(a){function e(t,i,n){const s=t.getPositionFromDOMInfo(i,n);return s?new bg(s,i,null):new qt(i)}a.createFromDOMInfo=e})(Ni||(Ni={}));class Ev{constructor(e,t){this.lastViewCursorsRenderData=e,this.lastTextareaPosition=t}}class Me{static _deduceRage(e,t=null){return!t&&e?new v(e.lineNumber,e.column,e.lineNumber,e.column):t??null}static createUnknown(e,t,i){return{type:0,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createTextarea(e,t){return{type:1,element:e,mouseColumn:t,position:null,range:null}}static createMargin(e,t,i,n,s,o){return{type:e,element:t,mouseColumn:i,position:n,range:s,detail:o}}static createViewZone(e,t,i,n,s){return{type:e,element:t,mouseColumn:i,position:n,range:this._deduceRage(n),detail:s}}static createContentText(e,t,i,n,s){return{type:6,element:e,mouseColumn:t,position:i,range:this._deduceRage(i,n),detail:s}}static createContentEmpty(e,t,i,n){return{type:7,element:e,mouseColumn:t,position:i,range:this._deduceRage(i),detail:n}}static createContentWidget(e,t,i){return{type:9,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createScrollbar(e,t,i){return{type:11,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createOverlayWidget(e,t,i){return{type:12,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createOutsideEditor(e,t,i,n){return{type:13,element:null,mouseColumn:e,position:t,range:this._deduceRage(t),outsidePosition:i,outsideDistance:n}}static _typeToString(e){return e===1?"TEXTAREA":e===2?"GUTTER_GLYPH_MARGIN":e===3?"GUTTER_LINE_NUMBERS":e===4?"GUTTER_LINE_DECORATIONS":e===5?"GUTTER_VIEW_ZONE":e===6?"CONTENT_TEXT":e===7?"CONTENT_EMPTY":e===8?"CONTENT_VIEW_ZONE":e===9?"CONTENT_WIDGET":e===10?"OVERVIEW_RULER":e===11?"SCROLLBAR":e===12?"OVERLAY_WIDGET":"UNKNOWN"}static toString(e){return this._typeToString(e.type)+": "+e.position+" - "+e.range+" - "+JSON.stringify(e.detail)}}class Pe{static isTextArea(e){return e.length===2&&e[0]===3&&e[1]===7}static isChildOfViewLines(e){return e.length>=4&&e[0]===3&&e[3]===8}static isStrictChildOfViewLines(e){return e.length>4&&e[0]===3&&e[3]===8}static isChildOfScrollableElement(e){return e.length>=2&&e[0]===3&&e[1]===6}static isChildOfMinimap(e){return e.length>=2&&e[0]===3&&e[1]===9}static isChildOfContentWidgets(e){return e.length>=4&&e[0]===3&&e[3]===1}static isChildOfOverflowGuard(e){return e.length>=1&&e[0]===3}static isChildOfOverflowingContentWidgets(e){return e.length>=1&&e[0]===2}static isChildOfOverlayWidgets(e){return e.length>=2&&e[0]===3&&e[1]===4}static isChildOfOverflowingOverlayWidgets(e){return e.length>=1&&e[0]===5}}class Gn{constructor(e,t,i){this.viewModel=e.viewModel;const n=e.configuration.options;this.layoutInfo=n.get(146),this.viewDomNode=t.viewDomNode,this.lineHeight=n.get(67),this.stickyTabStops=n.get(117),this.typicalHalfwidthCharacterWidth=n.get(50).typicalHalfwidthCharacterWidth,this.lastRenderData=i,this._context=e,this._viewHelper=t}getZoneAtCoord(e){return Gn.getZoneAtCoord(this._context,e)}static getZoneAtCoord(e,t){const i=e.viewLayout.getWhitespaceAtVerticalOffset(t);if(i){const n=i.verticalOffset+i.height/2,s=e.viewModel.getLineCount();let o=null,r,l=null;return i.afterLineNumber!==s&&(l=new D(i.afterLineNumber+1,1)),i.afterLineNumber>0&&(o=new D(i.afterLineNumber,e.viewModel.getLineMaxColumn(i.afterLineNumber))),l===null?r=o:o===null?r=l:t<n?r=o:r=l,{viewZoneId:i.id,afterLineNumber:i.afterLineNumber,positionBefore:o,positionAfter:l,position:r}}return null}getFullLineRangeAtCoord(e){if(this._context.viewLayout.isAfterLines(e)){const n=this._context.viewModel.getLineCount(),s=this._context.viewModel.getLineMaxColumn(n);return{range:new v(n,s,n,s),isAfterLines:!0}}const t=this._context.viewLayout.getLineNumberAtVerticalOffset(e),i=this._context.viewModel.getLineMaxColumn(t);return{range:new v(t,1,t,i),isAfterLines:!1}}getLineNumberAtVerticalOffset(e){return this._context.viewLayout.getLineNumberAtVerticalOffset(e)}isAfterLines(e){return this._context.viewLayout.isAfterLines(e)}isInTopPadding(e){return this._context.viewLayout.isInTopPadding(e)}isInBottomPadding(e){return this._context.viewLayout.isInBottomPadding(e)}getVerticalOffsetForLineNumber(e){return this._context.viewLayout.getVerticalOffsetForLineNumber(e)}findAttribute(e,t){return Gn._findAttribute(e,t,this._viewHelper.viewDomNode)}static _findAttribute(e,t,i){for(;e&&e!==e.ownerDocument.body;){if(e.hasAttribute&&e.hasAttribute(t))return e.getAttribute(t);if(e===i)return null;e=e.parentNode}return null}getLineWidth(e){return this._viewHelper.getLineWidth(e)}visibleRangeForPosition(e,t){return this._viewHelper.visibleRangeForPosition(e,t)}getPositionFromDOMInfo(e,t){return this._viewHelper.getPositionFromDOMInfo(e,t)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class Mv{constructor(e,t,i,n){this.editorPos=t,this.pos=i,this.relativePos=n,this.mouseVerticalOffset=Math.max(0,e.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=e.getCurrentScrollLeft()+this.relativePos.x-e.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<e.layoutInfo.contentLeft&&this.relativePos.x>=e.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,Ee._getMouseColumn(this.mouseContentHorizontalOffset,e.typicalHalfwidthCharacterWidth))}}class Rv extends Mv{get target(){return this._useHitTestTarget?this.hitTestResult.value.hitTarget:this._eventTarget}get targetPath(){return this._targetPathCacheElement!==this.target&&(this._targetPathCacheElement=this.target,this._targetPathCacheValue=ft.collect(this.target,this._ctx.viewDomNode)),this._targetPathCacheValue}constructor(e,t,i,n,s){super(e,t,i,n),this.hitTestResult=new Il(()=>Ee.doHitTest(this._ctx,this)),this._targetPathCacheElement=null,this._targetPathCacheValue=new Uint8Array(0),this._ctx=e,this._eventTarget=s;const o=!!this._eventTarget;this._useHitTestTarget=!o}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}
	target: ${this.target?this.target.outerHTML:null}`}get wouldBenefitFromHitTestTargetSwitch(){return!this._useHitTestTarget&&this.hitTestResult.value.hitTarget!==null&&this.target!==this.hitTestResult.value.hitTarget}switchToHitTestTarget(){this._useHitTestTarget=!0}_getMouseColumn(e=null){return e&&e.column<this._ctx.viewModel.getLineMaxColumn(e.lineNumber)?Ce.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(e.lineNumber),e.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(e=null){return Me.createUnknown(this.target,this._getMouseColumn(e),e)}fulfillTextarea(){return Me.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(e,t,i,n){return Me.createMargin(e,this.target,this._getMouseColumn(t),t,i,n)}fulfillViewZone(e,t,i){return Me.createViewZone(e,this.target,this._getMouseColumn(t),t,i)}fulfillContentText(e,t,i){return Me.createContentText(this.target,this._getMouseColumn(e),e,t,i)}fulfillContentEmpty(e,t){return Me.createContentEmpty(this.target,this._getMouseColumn(e),e,t)}fulfillContentWidget(e){return Me.createContentWidget(this.target,this._getMouseColumn(),e)}fulfillScrollbar(e){return Me.createScrollbar(this.target,this._getMouseColumn(e),e)}fulfillOverlayWidget(e){return Me.createOverlayWidget(this.target,this._getMouseColumn(),e)}}const qc={isAfterLines:!0};function ca(a){return{isAfterLines:!1,horizontalDistanceToText:a}}class Ee{constructor(e,t){this._context=e,this._viewHelper=t}mouseTargetIsWidget(e){const t=e.target,i=ft.collect(t,this._viewHelper.viewDomNode);return!!(Pe.isChildOfContentWidgets(i)||Pe.isChildOfOverflowingContentWidgets(i)||Pe.isChildOfOverlayWidgets(i)||Pe.isChildOfOverflowingOverlayWidgets(i))}createMouseTarget(e,t,i,n,s){const o=new Gn(this._context,this._viewHelper,e),r=new Rv(o,t,i,n,s);try{const l=Ee._createMouseTarget(o,r);if(l.type===6&&o.stickyTabStops&&l.position!==null){const h=Ee._snapToSoftTabBoundary(l.position,o.viewModel),c=v.fromPositions(h,h).plusRange(l.range);return r.fulfillContentText(h,c,l.detail)}return l}catch{return r.fulfillUnknown()}}static _createMouseTarget(e,t){if(t.target===null)return t.fulfillUnknown();const i=t;let n=null;return!Pe.isChildOfOverflowGuard(t.targetPath)&&!Pe.isChildOfOverflowingContentWidgets(t.targetPath)&&!Pe.isChildOfOverflowingOverlayWidgets(t.targetPath)&&(n=n||t.fulfillUnknown()),n=n||Ee._hitTestContentWidget(e,i),n=n||Ee._hitTestOverlayWidget(e,i),n=n||Ee._hitTestMinimap(e,i),n=n||Ee._hitTestScrollbarSlider(e,i),n=n||Ee._hitTestViewZone(e,i),n=n||Ee._hitTestMargin(e,i),n=n||Ee._hitTestViewCursor(e,i),n=n||Ee._hitTestTextArea(e,i),n=n||Ee._hitTestViewLines(e,i),n=n||Ee._hitTestScrollbar(e,i),n||t.fulfillUnknown()}static _hitTestContentWidget(e,t){if(Pe.isChildOfContentWidgets(t.targetPath)||Pe.isChildOfOverflowingContentWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillContentWidget(i):t.fulfillUnknown()}return null}static _hitTestOverlayWidget(e,t){if(Pe.isChildOfOverlayWidgets(t.targetPath)||Pe.isChildOfOverflowingOverlayWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillOverlayWidget(i):t.fulfillUnknown()}return null}static _hitTestViewCursor(e,t){if(t.target){const i=e.lastRenderData.lastViewCursorsRenderData;for(const n of i)if(t.target===n.domNode)return t.fulfillContentText(n.position,null,{mightBeForeignElement:!1,injectedText:null})}if(t.isInContentArea){const i=e.lastRenderData.lastViewCursorsRenderData,n=t.mouseContentHorizontalOffset,s=t.mouseVerticalOffset;for(const o of i){if(n<o.contentLeft||n>o.contentLeft+o.width)continue;const r=e.getVerticalOffsetForLineNumber(o.position.lineNumber);if(r<=s&&s<=r+o.height)return t.fulfillContentText(o.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(e,t){const i=e.getZoneAtCoord(t.mouseVerticalOffset);if(i){const n=t.isInContentArea?8:5;return t.fulfillViewZone(n,i.position,i)}return null}static _hitTestTextArea(e,t){return Pe.isTextArea(t.targetPath)?e.lastRenderData.lastTextareaPosition?t.fulfillContentText(e.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):t.fulfillTextarea():null}static _hitTestMargin(e,t){if(t.isInMarginArea){const i=e.getFullLineRangeAtCoord(t.mouseVerticalOffset),n=i.range.getStartPosition();let s=Math.abs(t.relativePos.x);const o={isAfterLines:i.isAfterLines,glyphMarginLeft:e.layoutInfo.glyphMarginLeft,glyphMarginWidth:e.layoutInfo.glyphMarginWidth,lineNumbersWidth:e.layoutInfo.lineNumbersWidth,offsetX:s};if(s-=e.layoutInfo.glyphMarginLeft,s<=e.layoutInfo.glyphMarginWidth){const r=e.viewModel.coordinatesConverter.convertViewPositionToModelPosition(i.range.getStartPosition()),l=e.viewModel.glyphLanes.getLanesAtLine(r.lineNumber);return o.glyphMarginLane=l[Math.floor(s/e.lineHeight)],t.fulfillMargin(2,n,i.range,o)}return s-=e.layoutInfo.glyphMarginWidth,s<=e.layoutInfo.lineNumbersWidth?t.fulfillMargin(3,n,i.range,o):(s-=e.layoutInfo.lineNumbersWidth,t.fulfillMargin(4,n,i.range,o))}return null}static _hitTestViewLines(e,t){if(!Pe.isChildOfViewLines(t.targetPath))return null;if(e.isInTopPadding(t.mouseVerticalOffset))return t.fulfillContentEmpty(new D(1,1),qc);if(e.isAfterLines(t.mouseVerticalOffset)||e.isInBottomPadding(t.mouseVerticalOffset)){const n=e.viewModel.getLineCount(),s=e.viewModel.getLineMaxColumn(n);return t.fulfillContentEmpty(new D(n,s),qc)}if(Pe.isStrictChildOfViewLines(t.targetPath)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset);if(e.viewModel.getLineLength(n)===0){const o=e.getLineWidth(n),r=ca(t.mouseContentHorizontalOffset-o);return t.fulfillContentEmpty(new D(n,1),r)}const s=e.getLineWidth(n);if(t.mouseContentHorizontalOffset>=s){const o=ca(t.mouseContentHorizontalOffset-s),r=new D(n,e.viewModel.getLineMaxColumn(n));return t.fulfillContentEmpty(r,o)}}const i=t.hitTestResult.value;return i.type===1?Ee.createMouseTargetFromHitTestPosition(e,t,i.spanNode,i.position,i.injectedText):t.wouldBenefitFromHitTestTargetSwitch?(t.switchToHitTestTarget(),this._createMouseTarget(e,t)):t.fulfillUnknown()}static _hitTestMinimap(e,t){if(Pe.isChildOfMinimap(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new D(i,n))}return null}static _hitTestScrollbarSlider(e,t){if(Pe.isChildOfScrollableElement(t.targetPath)&&t.target&&t.target.nodeType===1){const i=t.target.className;if(i&&/\b(slider|scrollbar)\b/.test(i)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),s=e.viewModel.getLineMaxColumn(n);return t.fulfillScrollbar(new D(n,s))}}return null}static _hitTestScrollbar(e,t){if(Pe.isChildOfScrollableElement(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new D(i,n))}return null}getMouseColumn(e){const t=this._context.configuration.options,i=t.get(146),n=this._context.viewLayout.getCurrentScrollLeft()+e.x-i.contentLeft;return Ee._getMouseColumn(n,t.get(50).typicalHalfwidthCharacterWidth)}static _getMouseColumn(e,t){return e<0?1:Math.round(e/t)+1}static createMouseTargetFromHitTestPosition(e,t,i,n,s){const o=n.lineNumber,r=n.column,l=e.getLineWidth(o);if(t.mouseContentHorizontalOffset>l){const C=ca(t.mouseContentHorizontalOffset-l);return t.fulfillContentEmpty(n,C)}const h=e.visibleRangeForPosition(o,r);if(!h)return t.fulfillUnknown(n);const c=h.left;if(Math.abs(t.mouseContentHorizontalOffset-c)<1)return t.fulfillContentText(n,null,{mightBeForeignElement:!!s,injectedText:s});const d=[];if(d.push({offset:h.left,column:r}),r>1){const C=e.visibleRangeForPosition(o,r-1);C&&d.push({offset:C.left,column:r-1})}const u=e.viewModel.getLineMaxColumn(o);if(r<u){const C=e.visibleRangeForPosition(o,r+1);C&&d.push({offset:C.left,column:r+1})}d.sort((C,p)=>C.offset-p.offset);const g=t.pos.toClientCoordinates(ee(e.viewDomNode)),f=i.getBoundingClientRect(),m=f.left<=g.clientX&&g.clientX<=f.right;let _=null;for(let C=1;C<d.length;C++){const p=d[C-1],b=d[C];if(p.offset<=t.mouseContentHorizontalOffset&&t.mouseContentHorizontalOffset<=b.offset){_=new v(o,p.column,o,b.column);const w=Math.abs(p.offset-t.mouseContentHorizontalOffset),L=Math.abs(b.offset-t.mouseContentHorizontalOffset);n=w<L?new D(o,p.column):new D(o,b.column);break}}return t.fulfillContentText(n,_,{mightBeForeignElement:!m||!!s,injectedText:s})}static _doHitTestWithCaretRangeFromPoint(e,t){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.getVerticalOffsetForLineNumber(i),s=n+e.lineHeight;if(!(i===e.viewModel.getLineCount()&&t.mouseVerticalOffset>s)){const r=Math.floor((n+s)/2);let l=t.pos.y+(r-t.mouseVerticalOffset);l<=t.editorPos.y&&(l=t.editorPos.y+1),l>=t.editorPos.y+t.editorPos.height&&(l=t.editorPos.y+t.editorPos.height-1);const h=new Fr(t.pos.x,l),c=this._actualDoHitTestWithCaretRangeFromPoint(e,h.toClientCoordinates(ee(e.viewDomNode)));if(c.type===1)return c}return this._actualDoHitTestWithCaretRangeFromPoint(e,t.pos.toClientCoordinates(ee(e.viewDomNode)))}static _actualDoHitTestWithCaretRangeFromPoint(e,t){const i=Ro(e.viewDomNode);let n;if(i?typeof i.caretRangeFromPoint>"u"?n=Av(i,t.clientX,t.clientY):n=i.caretRangeFromPoint(t.clientX,t.clientY):n=e.viewDomNode.ownerDocument.caretRangeFromPoint(t.clientX,t.clientY),!n||!n.startContainer)return new qt;const s=n.startContainer;if(s.nodeType===s.TEXT_NODE){const o=s.parentNode,r=o?o.parentNode:null,l=r?r.parentNode:null;return(l&&l.nodeType===l.ELEMENT_NODE?l.className:null)===Ht.CLASS_NAME?Ni.createFromDOMInfo(e,o,n.startOffset):new qt(s.parentNode)}else if(s.nodeType===s.ELEMENT_NODE){const o=s.parentNode,r=o?o.parentNode:null;return(r&&r.nodeType===r.ELEMENT_NODE?r.className:null)===Ht.CLASS_NAME?Ni.createFromDOMInfo(e,s,s.textContent.length):new qt(s)}return new qt}static _doHitTestWithCaretPositionFromPoint(e,t){const i=e.viewDomNode.ownerDocument.caretPositionFromPoint(t.clientX,t.clientY);if(i.offsetNode.nodeType===i.offsetNode.TEXT_NODE){const n=i.offsetNode.parentNode,s=n?n.parentNode:null,o=s?s.parentNode:null;return(o&&o.nodeType===o.ELEMENT_NODE?o.className:null)===Ht.CLASS_NAME?Ni.createFromDOMInfo(e,i.offsetNode.parentNode,i.offset):new qt(i.offsetNode.parentNode)}if(i.offsetNode.nodeType===i.offsetNode.ELEMENT_NODE){const n=i.offsetNode.parentNode,s=n&&n.nodeType===n.ELEMENT_NODE?n.className:null,o=n?n.parentNode:null,r=o&&o.nodeType===o.ELEMENT_NODE?o.className:null;if(s===Ht.CLASS_NAME){const l=i.offsetNode.childNodes[Math.min(i.offset,i.offsetNode.childNodes.length-1)];if(l)return Ni.createFromDOMInfo(e,l,0)}else if(r===Ht.CLASS_NAME)return Ni.createFromDOMInfo(e,i.offsetNode,0)}return new qt(i.offsetNode)}static _snapToSoftTabBoundary(e,t){const i=t.getLineContent(e.lineNumber),{tabSize:n}=t.model.getOptions(),s=zs.atomicPosition(i,e.column-1,n,2);return s!==-1?new D(e.lineNumber,s+1):e}static doHitTest(e,t){let i=new qt;if(typeof e.viewDomNode.ownerDocument.caretRangeFromPoint=="function"?i=this._doHitTestWithCaretRangeFromPoint(e,t):e.viewDomNode.ownerDocument.caretPositionFromPoint&&(i=this._doHitTestWithCaretPositionFromPoint(e,t.pos.toClientCoordinates(ee(e.viewDomNode)))),i.type===1){const n=e.viewModel.getInjectedTextAt(i.position),s=e.viewModel.normalizePosition(i.position,2);(n||!s.equals(i.position))&&(i=new bg(s,i.spanNode,n))}return i}}function Av(a,e,t){const i=document.createRange();let n=a.elementFromPoint(e,t);if(n!==null){for(;n&&n.firstChild&&n.firstChild.nodeType!==n.firstChild.TEXT_NODE&&n.lastChild&&n.lastChild.firstChild;)n=n.lastChild;const s=n.getBoundingClientRect(),o=ee(n),r=o.getComputedStyle(n,null).getPropertyValue("font-style"),l=o.getComputedStyle(n,null).getPropertyValue("font-variant"),h=o.getComputedStyle(n,null).getPropertyValue("font-weight"),c=o.getComputedStyle(n,null).getPropertyValue("font-size"),d=o.getComputedStyle(n,null).getPropertyValue("line-height"),u=o.getComputedStyle(n,null).getPropertyValue("font-family"),g=`${r} ${l} ${h} ${c}/${d} ${u}`,f=n.innerText;let m=s.left,_=0,C;if(e>s.left+s.width)_=f.length;else{const p=ll.getInstance();for(let b=0;b<f.length+1;b++){if(C=p.getCharWidth(f.charAt(b),g)/2,m+=C,e<m){_=b;break}m+=C}}i.setStart(n.firstChild,_),i.setEnd(n.firstChild,_)}return i}const ki=class ki{static getInstance(){return ki._INSTANCE||(ki._INSTANCE=new ki),ki._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(e,t){const i=e+t;if(this._cache[i])return this._cache[i];const n=this._canvas.getContext("2d");n.font=t;const o=n.measureText(e).width;return this._cache[i]=o,o}};ki._INSTANCE=null;let ll=ki;class lh extends eo{constructor(e,t,i){super(),this._mouseLeaveMonitor=null,this._context=e,this.viewController=t,this.viewHelper=i,this.mouseTargetFactory=new Ee(this._context,i),this._mouseDownOperation=this._register(new Ov(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,(o,r)=>this._createMouseTarget(o,r),o=>this._getMouseColumn(o))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(146).height;const n=new Cv(this.viewHelper.viewDomNode);this._register(n.onContextMenu(this.viewHelper.viewDomNode,o=>this._onContextMenu(o,!0))),this._register(n.onMouseMove(this.viewHelper.viewDomNode,o=>{this._onMouseMove(o),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=F(this.viewHelper.viewDomNode.ownerDocument,"mousemove",r=>{this.viewHelper.viewDomNode.contains(r.target)||this._onMouseLeave(new hi(r,!1,this.viewHelper.viewDomNode))}))})),this._register(n.onMouseUp(this.viewHelper.viewDomNode,o=>this._onMouseUp(o))),this._register(n.onMouseLeave(this.viewHelper.viewDomNode,o=>this._onMouseLeave(o)));let s=0;this._register(n.onPointerDown(this.viewHelper.viewDomNode,(o,r)=>{s=r})),this._register(F(this.viewHelper.viewDomNode,oe.POINTER_UP,o=>{this._mouseDownOperation.onPointerUp()})),this._register(n.onMouseDown(this.viewHelper.viewDomNode,o=>this._onMouseDown(o,s))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const e=Up.INSTANCE;let t=0,i=vi.getZoomLevel(),n=!1,s=0;const o=l=>{if(this.viewController.emitMouseWheel(l),!this._context.configuration.options.get(76))return;const h=new mf(l);if(e.acceptStandardWheelEvent(h),e.isPhysicalMouseWheel()){if(r(l)){const c=vi.getZoomLevel(),d=h.deltaY>0?1:-1;vi.setZoomLevel(c+d),h.preventDefault(),h.stopPropagation()}}else Date.now()-t>50&&(i=vi.getZoomLevel(),n=r(l),s=0),t=Date.now(),s+=h.deltaY,n&&(vi.setZoomLevel(i+s/5),h.preventDefault(),h.stopPropagation())};this._register(F(this.viewHelper.viewDomNode,oe.MOUSE_WHEEL,o,{capture:!0,passive:!1}));function r(l){return Ae?(l.metaKey||l.ctrlKey)&&!l.shiftKey&&!l.altKey:l.ctrlKey&&!l.metaKey&&!l.shiftKey&&!l.altKey}}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(e){if(e.hasChanged(146)){const t=this._context.configuration.options.get(146).height;this._height!==t&&(this._height=t,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(e){return this._mouseDownOperation.onCursorStateChanged(e),!1}onFocusChanged(e){return!1}getTargetAtClientPoint(e,t){const n=new mg(e,t).toPageCoordinates(ee(this.viewHelper.viewDomNode)),s=rh(this.viewHelper.viewDomNode);if(n.y<s.y||n.y>s.y+s.height||n.x<s.x||n.x>s.x+s.width)return null;const o=ah(this.viewHelper.viewDomNode,s,n);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),s,n,o,null)}_createMouseTarget(e,t){let i=e.target;if(!this.viewHelper.viewDomNode.contains(i)){const n=Ro(this.viewHelper.viewDomNode);n&&(i=n.elementsFromPoint(e.posx,e.posy).find(s=>this.viewHelper.viewDomNode.contains(s)))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),e.editorPos,e.pos,e.relativePos,t?i:null)}_getMouseColumn(e){return this.mouseTargetFactory.getMouseColumn(e.relativePos)}_onContextMenu(e,t){this.viewController.emitContextMenu({event:e,target:this._createMouseTarget(e,t)})}_onMouseMove(e){this.mouseTargetFactory.mouseTargetIsWidget(e)||e.preventDefault(),!(this._mouseDownOperation.isActive()||e.timestamp<this.lastMouseLeaveTime)&&this.viewController.emitMouseMove({event:e,target:this._createMouseTarget(e,!0)})}_onMouseLeave(e){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=new Date().getTime(),this.viewController.emitMouseLeave({event:e,target:null})}_onMouseUp(e){this.viewController.emitMouseUp({event:e,target:this._createMouseTarget(e,!0)})}_onMouseDown(e,t){const i=this._createMouseTarget(e,!0),n=i.type===6||i.type===7,s=i.type===2||i.type===3||i.type===4,o=i.type===3,r=this._context.configuration.options.get(110),l=i.type===8||i.type===5,h=i.type===9;let c=e.leftButton||e.middleButton;Ae&&e.leftButton&&e.ctrlKey&&(c=!1);const d=()=>{e.preventDefault(),this.viewHelper.focusTextArea()};if(c&&(n||o&&r))d(),this._mouseDownOperation.start(i.type,e,t);else if(s)e.preventDefault();else if(l){const u=i.detail;c&&this.viewHelper.shouldSuppressMouseDownOnViewZone(u.viewZoneId)&&(d(),this._mouseDownOperation.start(i.type,e,t),e.preventDefault())}else h&&this.viewHelper.shouldSuppressMouseDownOnWidget(i.detail)&&(d(),e.preventDefault());this.viewController.emitMouseDown({event:e,target:i})}}class Ov extends H{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewController=t,this._viewHelper=i,this._mouseTargetFactory=n,this._createMouseTarget=s,this._getMouseColumn=o,this._mouseMoveMonitor=this._register(new wv(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new Pv(this._context,this._viewHelper,this._mouseTargetFactory,(r,l,h)=>this._dispatchMouse(r,l,h))),this._mouseState=new hl,this._currentSelection=new te(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(e){this._lastMouseEvent=e,this._mouseState.setModifiers(e);const t=this._findMousePosition(e,!1);t&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:e,target:t}):t.type===13&&(t.outsidePosition==="above"||t.outsidePosition==="below")?this._topBottomDragScrolling.start(t,e):(this._topBottomDragScrolling.stop(),this._dispatchMouse(t,!0,1)))}start(e,t,i){this._lastMouseEvent=t,this._mouseState.setStartedOnLineNumbers(e===3),this._mouseState.setStartButtons(t),this._mouseState.setModifiers(t);const n=this._findMousePosition(t,!0);if(!n||!n.position)return;this._mouseState.trySetCount(t.detail,n.position),t.detail=this._mouseState.count;const s=this._context.configuration.options;if(!s.get(92)&&s.get(35)&&!s.get(22)&&!this._mouseState.altKey&&t.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&n.type===6&&n.position&&this._currentSelection.containsPosition(n.position)){this._mouseState.isDragAndDrop=!0,this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),o=>{const r=this._findMousePosition(this._lastMouseEvent,!1);ff(o)?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:r?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()});return}this._mouseState.isDragAndDrop=!1,this._dispatchMouse(n,t.shiftKey,1),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),()=>this._stop()))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(e){this._currentSelection=e.selections[0]}_getPositionOutsideEditor(e){const t=e.editorPos,i=this._context.viewModel,n=this._context.viewLayout,s=this._getMouseColumn(e);if(e.posy<t.y){const r=t.y-e.posy,l=Math.max(n.getCurrentScrollTop()-r,0),h=Gn.getZoneAtCoord(this._context,l);if(h){const d=this._helpPositionJumpOverViewZone(h);if(d)return Me.createOutsideEditor(s,d,"above",r)}const c=n.getLineNumberAtVerticalOffset(l);return Me.createOutsideEditor(s,new D(c,1),"above",r)}if(e.posy>t.y+t.height){const r=e.posy-t.y-t.height,l=n.getCurrentScrollTop()+e.relativePos.y,h=Gn.getZoneAtCoord(this._context,l);if(h){const d=this._helpPositionJumpOverViewZone(h);if(d)return Me.createOutsideEditor(s,d,"below",r)}const c=n.getLineNumberAtVerticalOffset(l);return Me.createOutsideEditor(s,new D(c,i.getLineMaxColumn(c)),"below",r)}const o=n.getLineNumberAtVerticalOffset(n.getCurrentScrollTop()+e.relativePos.y);if(e.posx<t.x){const r=t.x-e.posx;return Me.createOutsideEditor(s,new D(o,1),"left",r)}if(e.posx>t.x+t.width){const r=e.posx-t.x-t.width;return Me.createOutsideEditor(s,new D(o,i.getLineMaxColumn(o)),"right",r)}return null}_findMousePosition(e,t){const i=this._getPositionOutsideEditor(e);if(i)return i;const n=this._createMouseTarget(e,t);if(!n.position)return null;if(n.type===8||n.type===5){const o=this._helpPositionJumpOverViewZone(n.detail);if(o)return Me.createViewZone(n.type,n.element,n.mouseColumn,o,n.detail)}return n}_helpPositionJumpOverViewZone(e){const t=new D(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),i=e.positionBefore,n=e.positionAfter;return i&&n?i.isBefore(t)?i:n:null}_dispatchMouse(e,t,i){e.position&&this._viewController.dispatchMouse({position:e.position,mouseColumn:e.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:i,inSelectionMode:t,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:e.type===6&&e.detail.injectedText!==null})}}class Pv extends H{constructor(e,t,i,n){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._operation=null}dispose(){super.dispose(),this.stop()}start(e,t){this._operation?this._operation.setPosition(e,t):this._operation=new Bv(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,e,t)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class Bv extends H{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._position=s,this._mouseEvent=o,this._lastTime=Date.now(),this._animationFrameDisposable=Fn(ee(o.browserEvent),()=>this._execute())}dispose(){this._animationFrameDisposable.dispose(),super.dispose()}setPosition(e,t){this._position=e,this._mouseEvent=t}_tick(){const e=Date.now(),t=e-this._lastTime;return this._lastTime=e,t}_getScrollSpeed(){const e=this._context.configuration.options.get(67),t=this._context.configuration.options.get(146).height/e,i=this._position.outsideDistance/e;return i<=1.5?Math.max(30,t*(1+i)):i<=3?Math.max(60,t*(2+i)):Math.max(200,t*(7+i))}_execute(){const e=this._context.configuration.options.get(67),t=this._getScrollSpeed(),i=this._tick(),n=t*(i/1e3)*e,s=this._position.outsidePosition==="above"?-n:n;this._context.viewModel.viewLayout.deltaScrollNow(0,s),this._viewHelper.renderNow();const o=this._context.viewLayout.getLinesViewportData(),r=this._position.outsidePosition==="above"?o.startLineNumber:o.endLineNumber;let l;{const h=rh(this._viewHelper.viewDomNode),c=this._context.configuration.options.get(146).horizontalScrollbarHeight,d=new Fr(this._mouseEvent.pos.x,h.y+h.height-c-.1),u=ah(this._viewHelper.viewDomNode,h,d);l=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),h,d,u,null)}(!l.position||l.position.lineNumber!==r)&&(this._position.outsidePosition==="above"?l=Me.createOutsideEditor(this._position.mouseColumn,new D(r,1),"above",this._position.outsideDistance):l=Me.createOutsideEditor(this._position.mouseColumn,new D(r,this._context.viewModel.getLineMaxColumn(r)),"below",this._position.outsideDistance)),this._dispatchMouse(l,!0,2),this._animationFrameDisposable=Fn(ee(l.element),()=>this._execute())}}const _r=class _r{get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(e){this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey}setStartButtons(e){this._leftButton=e.leftButton,this._middleButton=e.middleButton}setStartedOnLineNumbers(e){this._startedOnLineNumbers=e}trySetCount(e,t){const i=new Date().getTime();i-this._lastSetMouseDownCountTime>_r.CLEAR_MOUSE_DOWN_COUNT_TIME&&(e=1),this._lastSetMouseDownCountTime=i,e>this._lastMouseDownCount+1&&(e=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(t)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=t,this._lastMouseDownCount=Math.min(e,this._lastMouseDownPositionEqualCount)}};_r.CLEAR_MOUSE_DOWN_COUNT_TIME=400;let hl=_r;const Ln=class Ln{constructor(e,t,i,n,s){this.value=e,this.selectionStart=t,this.selectionEnd=i,this.selection=n,this.newlineCountBeforeSelection=s}toString(){return`[ <${this.value}>, selectionStart: ${this.selectionStart}, selectionEnd: ${this.selectionEnd}]`}static readFromTextArea(e,t){const i=e.getValue(),n=e.getSelectionStart(),s=e.getSelectionEnd();let o;if(t){const r=i.substring(0,n),l=t.value.substring(0,t.selectionStart);r===l&&(o=t.newlineCountBeforeSelection)}return new Ln(i,n,s,null,o)}collapseSelection(){return this.selectionStart===this.value.length?this:new Ln(this.value,this.value.length,this.value.length,null,void 0)}writeToTextArea(e,t,i){t.setValue(e,this.value),i&&t.setSelectionRange(e,this.selectionStart,this.selectionEnd)}deduceEditorPosition(e){var n,s,o,r;if(e<=this.selectionStart){const l=this.value.substring(e,this.selectionStart);return this._finishDeduceEditorPosition(((n=this.selection)==null?void 0:n.getStartPosition())??null,l,-1)}if(e>=this.selectionEnd){const l=this.value.substring(this.selectionEnd,e);return this._finishDeduceEditorPosition(((s=this.selection)==null?void 0:s.getEndPosition())??null,l,1)}const t=this.value.substring(this.selectionStart,e);if(t.indexOf("…")===-1)return this._finishDeduceEditorPosition(((o=this.selection)==null?void 0:o.getStartPosition())??null,t,1);const i=this.value.substring(e,this.selectionEnd);return this._finishDeduceEditorPosition(((r=this.selection)==null?void 0:r.getEndPosition())??null,i,-1)}_finishDeduceEditorPosition(e,t,i){let n=0,s=-1;for(;(s=t.indexOf(`
`,s+1))!==-1;)n++;return[e,i*t.length,n]}static deduceInput(e,t,i){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};const n=Math.min(Na(e.value,t.value),e.selectionStart,t.selectionStart),s=Math.min(Da(e.value,t.value),e.value.length-e.selectionEnd,t.value.length-t.selectionEnd);e.value.substring(n,e.value.length-s);const o=t.value.substring(n,t.value.length-s),r=e.selectionStart-n,l=e.selectionEnd-n,h=t.selectionStart-n,c=t.selectionEnd-n;if(h===c){const u=e.selectionStart-n;return{text:o,replacePrevCharCnt:u,replaceNextCharCnt:0,positionDelta:0}}const d=l-r;return{text:o,replacePrevCharCnt:d,replaceNextCharCnt:0,positionDelta:0}}static deduceAndroidCompositionInput(e,t){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};if(e.value===t.value)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:t.selectionEnd-e.selectionEnd};const i=Math.min(Na(e.value,t.value),e.selectionEnd),n=Math.min(Da(e.value,t.value),e.value.length-e.selectionEnd),s=e.value.substring(i,e.value.length-n),o=t.value.substring(i,t.value.length-n);e.selectionStart-i;const r=e.selectionEnd-i;t.selectionStart-i;const l=t.selectionEnd-i;return{text:o,replacePrevCharCnt:r,replaceNextCharCnt:s.length-r,positionDelta:l-o.length}}};Ln.EMPTY=new Ln("",0,0,null,void 0);let Re=Ln;class fn{static _getPageOfLine(e,t){return Math.floor((e-1)/t)}static _getRangeForPage(e,t){const i=e*t,n=i+1,s=i+t;return new v(n,1,s+1,1)}static fromEditorSelection(e,t,i,n){const o=fn._getPageOfLine(t.startLineNumber,i),r=fn._getRangeForPage(o,i),l=fn._getPageOfLine(t.endLineNumber,i),h=fn._getRangeForPage(l,i);let c=r.intersectRanges(new v(1,1,t.startLineNumber,t.startColumn));if(n&&e.getValueLengthInRange(c,1)>500){const C=e.modifyPosition(c.getEndPosition(),-500);c=v.fromPositions(C,c.getEndPosition())}const d=e.getValueInRange(c,1),u=e.getLineCount(),g=e.getLineMaxColumn(u);let f=h.intersectRanges(new v(t.endLineNumber,t.endColumn,u,g));if(n&&e.getValueLengthInRange(f,1)>500){const C=e.modifyPosition(f.getStartPosition(),500);f=v.fromPositions(f.getStartPosition(),C)}const m=e.getValueInRange(f,1);let _;if(o===l||o+1===l)_=e.getValueInRange(t,1);else{const C=r.intersectRanges(t),p=h.intersectRanges(t);_=e.getValueInRange(C,1)+"…"+e.getValueInRange(p,1)}return n&&_.length>2*500&&(_=_.substring(0,500)+"…"+_.substring(_.length-500,_.length)),new Re(d+_+m,d.length,d.length+_.length,t,c.endLineNumber-c.startLineNumber)}}var Fv=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Zc=function(a,e){return function(t,i){e(t,i,a)}},Qo;(function(a){a.Tap="-monaco-textarea-synthetic-tap"})(Qo||(Qo={}));const Cr=class Cr{constructor(){this._lastState=null}set(e,t){this._lastState={lastCopiedValue:e,data:t}}get(e){return this._lastState&&this._lastState.lastCopiedValue===e?this._lastState.data:(this._lastState=null,null)}};Cr.INSTANCE=new Cr;let Yo=Cr;class Wv{constructor(){this._lastTypeTextLength=0}handleCompositionUpdate(e){e=e||"";const t={text:e,replacePrevCharCnt:this._lastTypeTextLength,replaceNextCharCnt:0,positionDelta:0};return this._lastTypeTextLength=e.length,t}}let cl=class extends H{get textAreaState(){return this._textAreaState}constructor(e,t,i,n,s,o){super(),this._host=e,this._textArea=t,this._OS=i,this._browser=n,this._accessibilityService=s,this._logService=o,this._onFocus=this._register(new M),this.onFocus=this._onFocus.event,this._onBlur=this._register(new M),this.onBlur=this._onBlur.event,this._onKeyDown=this._register(new M),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new M),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new M),this.onCut=this._onCut.event,this._onPaste=this._register(new M),this.onPaste=this._onPaste.event,this._onType=this._register(new M),this.onType=this._onType.event,this._onCompositionStart=this._register(new M),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new M),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new M),this.onCompositionEnd=this._onCompositionEnd.event,this._onSelectionChangeRequest=this._register(new M),this.onSelectionChangeRequest=this._onSelectionChangeRequest.event,this._asyncFocusGainWriteScreenReaderContent=this._register(new Ui),this._asyncTriggerCut=this._register(new si(()=>this._onCut.fire(),0)),this._textAreaState=Re.EMPTY,this._selectionChangeListener=null,this._accessibilityService.isScreenReaderOptimized()&&this.writeNativeTextAreaContent("ctor"),this._register(G.runAndSubscribe(this._accessibilityService.onDidChangeScreenReaderOptimized,()=>{this._accessibilityService.isScreenReaderOptimized()&&!this._asyncFocusGainWriteScreenReaderContent.value?this._asyncFocusGainWriteScreenReaderContent.value=this._register(new si(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)):this._asyncFocusGainWriteScreenReaderContent.clear()})),this._hasFocus=!1,this._currentComposition=null;let r=null;this._register(this._textArea.onKeyDown(l=>{const h=new et(l);(h.keyCode===114||this._currentComposition&&h.keyCode===1)&&h.stopPropagation(),h.equals(9)&&h.preventDefault(),r=h,this._onKeyDown.fire(h)})),this._register(this._textArea.onKeyUp(l=>{const h=new et(l);this._onKeyUp.fire(h)})),this._register(this._textArea.onCompositionStart(l=>{const h=new Wv;if(this._currentComposition){this._currentComposition=h;return}if(this._currentComposition=h,this._OS===2&&r&&r.equals(114)&&this._textAreaState.selectionStart===this._textAreaState.selectionEnd&&this._textAreaState.selectionStart>0&&this._textAreaState.value.substr(this._textAreaState.selectionStart-1,1)===l.data&&(r.code==="ArrowRight"||r.code==="ArrowLeft")){h.handleCompositionUpdate("x"),this._onCompositionStart.fire({data:l.data});return}if(this._browser.isAndroid){this._onCompositionStart.fire({data:l.data});return}this._onCompositionStart.fire({data:l.data})})),this._register(this._textArea.onCompositionUpdate(l=>{const h=this._currentComposition;if(!h)return;if(this._browser.isAndroid){const d=Re.readFromTextArea(this._textArea,this._textAreaState),u=Re.deduceAndroidCompositionInput(this._textAreaState,d);this._textAreaState=d,this._onType.fire(u),this._onCompositionUpdate.fire(l);return}const c=h.handleCompositionUpdate(l.data);this._textAreaState=Re.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(c),this._onCompositionUpdate.fire(l)})),this._register(this._textArea.onCompositionEnd(l=>{const h=this._currentComposition;if(!h)return;if(this._currentComposition=null,this._browser.isAndroid){const d=Re.readFromTextArea(this._textArea,this._textAreaState),u=Re.deduceAndroidCompositionInput(this._textAreaState,d);this._textAreaState=d,this._onType.fire(u),this._onCompositionEnd.fire();return}const c=h.handleCompositionUpdate(l.data);this._textAreaState=Re.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(c),this._onCompositionEnd.fire()})),this._register(this._textArea.onInput(l=>{if(this._textArea.setIgnoreSelectionChangeTime("received input event"),this._currentComposition)return;const h=Re.readFromTextArea(this._textArea,this._textAreaState),c=Re.deduceInput(this._textAreaState,h,this._OS===2);c.replacePrevCharCnt===0&&c.text.length===1&&(We(c.text.charCodeAt(0))||c.text.charCodeAt(0)===127)||(this._textAreaState=h,(c.text!==""||c.replacePrevCharCnt!==0||c.replaceNextCharCnt!==0||c.positionDelta!==0)&&this._onType.fire(c))})),this._register(this._textArea.onCut(l=>{this._textArea.setIgnoreSelectionChangeTime("received cut event"),this._ensureClipboardGetsEditorSelection(l),this._asyncTriggerCut.schedule()})),this._register(this._textArea.onCopy(l=>{this._ensureClipboardGetsEditorSelection(l)})),this._register(this._textArea.onPaste(l=>{if(this._textArea.setIgnoreSelectionChangeTime("received paste event"),l.preventDefault(),!l.clipboardData)return;let[h,c]=Qc.getTextData(l.clipboardData);h&&(c=c||Yo.INSTANCE.get(h),this._onPaste.fire({text:h,metadata:c}))})),this._register(this._textArea.onFocus(()=>{const l=this._hasFocus;this._setHasFocus(!0),this._accessibilityService.isScreenReaderOptimized()&&this._browser.isSafari&&!l&&this._hasFocus&&(this._asyncFocusGainWriteScreenReaderContent.value||(this._asyncFocusGainWriteScreenReaderContent.value=new si(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)),this._asyncFocusGainWriteScreenReaderContent.value.schedule())})),this._register(this._textArea.onBlur(()=>{this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("blurWithoutCompositionEnd"),this._onCompositionEnd.fire()),this._setHasFocus(!1)})),this._register(this._textArea.onSyntheticTap(()=>{this._browser.isAndroid&&this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("tapWithoutCompositionEnd"),this._onCompositionEnd.fire())}))}_installSelectionChangeListener(){let e=0;return F(this._textArea.ownerDocument,"selectionchange",t=>{if(ti.onSelectionChange(),!this._hasFocus||this._currentComposition||!this._browser.isChrome)return;const i=Date.now(),n=i-e;if(e=i,n<5)return;const s=i-this._textArea.getIgnoreSelectionChangeTime();if(this._textArea.resetSelectionChangeTime(),s<100||!this._textAreaState.selection)return;const o=this._textArea.getValue();if(this._textAreaState.value!==o)return;const r=this._textArea.getSelectionStart(),l=this._textArea.getSelectionEnd();if(this._textAreaState.selectionStart===r&&this._textAreaState.selectionEnd===l)return;const h=this._textAreaState.deduceEditorPosition(r),c=this._host.deduceModelPosition(h[0],h[1],h[2]),d=this._textAreaState.deduceEditorPosition(l),u=this._host.deduceModelPosition(d[0],d[1],d[2]),g=new te(c.lineNumber,c.column,u.lineNumber,u.column);this._onSelectionChangeRequest.fire(g)})}dispose(){super.dispose(),this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null)}focusTextArea(){this._setHasFocus(!0),this.refreshFocusState()}isFocused(){return this._hasFocus}refreshFocusState(){this._setHasFocus(this._textArea.hasFocus())}_setHasFocus(e){this._hasFocus!==e&&(this._hasFocus=e,this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null),this._hasFocus&&(this._selectionChangeListener=this._installSelectionChangeListener()),this._hasFocus&&this.writeNativeTextAreaContent("focusgain"),this._hasFocus?this._onFocus.fire():this._onBlur.fire())}_setAndWriteTextAreaState(e,t){this._hasFocus||(t=t.collapseSelection()),t.writeToTextArea(e,this._textArea,this._hasFocus),this._textAreaState=t}writeNativeTextAreaContent(e){!this._accessibilityService.isScreenReaderOptimized()&&e==="render"||this._currentComposition||(this._logService.trace(`writeTextAreaState(reason: ${e})`),this._setAndWriteTextAreaState(e,this._host.getScreenReaderContent()))}_ensureClipboardGetsEditorSelection(e){const t=this._host.getDataToCopy(),i={version:1,isFromEmptySelection:t.isFromEmptySelection,multicursorText:t.multicursorText,mode:t.mode};Yo.INSTANCE.set(this._browser.isFirefox?t.text.replace(/\r\n/g,`
`):t.text,i),e.preventDefault(),e.clipboardData&&Qc.setTextData(e.clipboardData,t.text,t.html,i)}};cl=Fv([Zc(4,Mr),Zc(5,pf)],cl);const Qc={getTextData(a){const e=a.getData(Ta.text);let t=null;const i=a.getData("vscode-editor-data");if(typeof i=="string")try{t=JSON.parse(i),t.version!==1&&(t=null)}catch{}return e.length===0&&t===null&&a.files.length>0?[Array.prototype.slice.call(a.files,0).map(s=>s.name).join(`
`),null]:[e,t]},setTextData(a,e,t,i){a.setData(Ta.text,e),typeof t=="string"&&a.setData("text/html",t),a.setData("vscode-editor-data",JSON.stringify(i))}};class Vv extends H{get ownerDocument(){return this._actual.ownerDocument}constructor(e){super(),this._actual=e,this.onKeyDown=this._register(new K(this._actual,"keydown")).event,this.onKeyUp=this._register(new K(this._actual,"keyup")).event,this.onCompositionStart=this._register(new K(this._actual,"compositionstart")).event,this.onCompositionUpdate=this._register(new K(this._actual,"compositionupdate")).event,this.onCompositionEnd=this._register(new K(this._actual,"compositionend")).event,this.onBeforeInput=this._register(new K(this._actual,"beforeinput")).event,this.onInput=this._register(new K(this._actual,"input")).event,this.onCut=this._register(new K(this._actual,"cut")).event,this.onCopy=this._register(new K(this._actual,"copy")).event,this.onPaste=this._register(new K(this._actual,"paste")).event,this.onFocus=this._register(new K(this._actual,"focus")).event,this.onBlur=this._register(new K(this._actual,"blur")).event,this._onSyntheticTap=this._register(new M),this.onSyntheticTap=this._onSyntheticTap.event,this._ignoreSelectionChangeTime=0,this._register(this.onKeyDown(()=>ti.onKeyDown())),this._register(this.onBeforeInput(()=>ti.onBeforeInput())),this._register(this.onInput(()=>ti.onInput())),this._register(this.onKeyUp(()=>ti.onKeyUp())),this._register(F(this._actual,Qo.Tap,()=>this._onSyntheticTap.fire()))}hasFocus(){const e=Ro(this._actual);return e?e.activeElement===this._actual:this._actual.isConnected?Ri()===this._actual:!1}setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}getValue(){return this._actual.value}setValue(e,t){const i=this._actual;i.value!==t&&(this.setIgnoreSelectionChangeTime("setValue"),i.value=t)}getSelectionStart(){return this._actual.selectionDirection==="backward"?this._actual.selectionEnd:this._actual.selectionStart}getSelectionEnd(){return this._actual.selectionDirection==="backward"?this._actual.selectionStart:this._actual.selectionEnd}setSelectionRange(e,t,i){const n=this._actual;let s=null;const o=Ro(n);o?s=o.activeElement:s=Ri();const r=ee(s),l=s===n,h=n.selectionStart,c=n.selectionEnd;if(l&&h===t&&c===i){oi&&r.parent!==r&&n.focus();return}if(l){this.setIgnoreSelectionChangeTime("setSelectionRange"),n.setSelectionRange(t,i),oi&&r.parent!==r&&n.focus();return}try{const d=_f(n);this.setIgnoreSelectionChangeTime("setSelectionRange"),n.focus(),n.setSelectionRange(t,i),Cf(n,d)}catch{}}}class Hv extends lh{constructor(e,t,i){super(e,t,i),this._register($t.addTarget(this.viewHelper.linesContentDomNode)),this._register(F(this.viewHelper.linesContentDomNode,Ne.Tap,s=>this.onTap(s))),this._register(F(this.viewHelper.linesContentDomNode,Ne.Change,s=>this.onChange(s))),this._register(F(this.viewHelper.linesContentDomNode,Ne.Contextmenu,s=>this._onContextMenu(new hi(s,!1,this.viewHelper.viewDomNode),!1))),this._lastPointerType="mouse",this._register(F(this.viewHelper.linesContentDomNode,"pointerdown",s=>{const o=s.pointerType;if(o==="mouse"){this._lastPointerType="mouse";return}else o==="touch"?this._lastPointerType="touch":this._lastPointerType="pen"}));const n=new bv(this.viewHelper.viewDomNode);this._register(n.onPointerMove(this.viewHelper.viewDomNode,s=>this._onMouseMove(s))),this._register(n.onPointerUp(this.viewHelper.viewDomNode,s=>this._onMouseUp(s))),this._register(n.onPointerLeave(this.viewHelper.viewDomNode,s=>this._onMouseLeave(s))),this._register(n.onPointerDown(this.viewHelper.viewDomNode,(s,o)=>this._onMouseDown(s,o)))}onTap(e){!e.initialTarget||!this.viewHelper.linesContentDomNode.contains(e.initialTarget)||(e.preventDefault(),this.viewHelper.focusTextArea(),this._dispatchGesture(e,!1))}onChange(e){this._lastPointerType==="touch"&&this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY),this._lastPointerType==="pen"&&this._dispatchGesture(e,!0)}_dispatchGesture(e,t){const i=this._createMouseTarget(new hi(e,!1,this.viewHelper.viewDomNode),!1);i.position&&this.viewController.dispatchMouse({position:i.position,mouseColumn:i.position.column,startedOnLineNumbers:!1,revealType:1,mouseDownCount:e.tapCount,inSelectionMode:t,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:i.type===6&&i.detail.injectedText!==null})}_onMouseDown(e,t){e.browserEvent.pointerType!=="touch"&&super._onMouseDown(e,t)}}class zv extends lh{constructor(e,t,i){super(e,t,i),this._register($t.addTarget(this.viewHelper.linesContentDomNode)),this._register(F(this.viewHelper.linesContentDomNode,Ne.Tap,n=>this.onTap(n))),this._register(F(this.viewHelper.linesContentDomNode,Ne.Change,n=>this.onChange(n))),this._register(F(this.viewHelper.linesContentDomNode,Ne.Contextmenu,n=>this._onContextMenu(new hi(n,!1,this.viewHelper.viewDomNode),!1)))}onTap(e){e.preventDefault(),this.viewHelper.focusTextArea();const t=this._createMouseTarget(new hi(e,!1,this.viewHelper.viewDomNode),!1);if(t.position){const i=document.createEvent("CustomEvent");i.initEvent(Qo.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(i),this.viewController.moveTo(t.position,1)}}onChange(e){this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY)}}class Uv extends H{constructor(e,t,i){super(),(Lf||vf&&Sf)&&bf.pointerEvents?this.handler=this._register(new Hv(e,t,i)):wf.TouchEvent?this.handler=this._register(new zv(e,t,i)):this.handler=this._register(new lh(e,t,i))}getTargetAtClientPoint(e,t){return this.handler.getTargetAtClientPoint(e,t)}}class Yi extends eo{}const br=class br extends Yi{constructor(e){super(),this._context=e,this._readConfig(),this._lastCursorModelPosition=new D(1,1),this._renderResult=null,this._activeLineNumber=1,this._context.addEventHandler(this)}_readConfig(){const e=this._context.configuration.options;this._lineHeight=e.get(67);const t=e.get(68);this._renderLineNumbers=t.renderType,this._renderCustomLineNumbers=t.renderFn,this._renderFinalNewline=e.get(96);const i=e.get(146);this._lineNumbersLeft=i.lineNumbersLeft,this._lineNumbersWidth=i.lineNumbersWidth}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return this._readConfig(),!0}onCursorStateChanged(e){const t=e.selections[0].getPosition();this._lastCursorModelPosition=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(t);let i=!1;return this._activeLineNumber!==t.lineNumber&&(this._activeLineNumber=t.lineNumber,i=!0),(this._renderLineNumbers===2||this._renderLineNumbers===3)&&(i=!0),i}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return e.affectsLineNumber}_getLineRenderLineNumber(e){const t=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new D(e,1));if(t.column!==1)return"";const i=t.lineNumber;if(this._renderCustomLineNumbers)return this._renderCustomLineNumbers(i);if(this._renderLineNumbers===2){const n=Math.abs(this._lastCursorModelPosition.lineNumber-i);return n===0?'<span class="relative-current-line-number">'+i+"</span>":String(n)}if(this._renderLineNumbers===3){if(this._lastCursorModelPosition.lineNumber===i||i%10===0)return String(i);const n=this._context.viewModel.getLineCount();return i===n?String(i):""}return String(i)}prepareRender(e){if(this._renderLineNumbers===0){this._renderResult=null;return}const t=Zs?this._lineHeight%2===0?" lh-even":" lh-odd":"",i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=this._context.viewModel.getDecorationsInViewport(e.visibleRange).filter(h=>!!h.options.lineNumberClassName);s.sort((h,c)=>v.compareRangesUsingEnds(h.range,c.range));let o=0;const r=this._context.viewModel.getLineCount(),l=[];for(let h=i;h<=n;h++){const c=h-i;let d=this._getLineRenderLineNumber(h),u="";for(;o<s.length&&s[o].range.endLineNumber<h;)o++;for(let g=o;g<s.length;g++){const{range:f,options:m}=s[g];f.startLineNumber<=h&&(u+=" "+m.lineNumberClassName)}if(!d&&!u){l[c]="";continue}h===r&&this._context.viewModel.getLineLength(h)===0&&(this._renderFinalNewline==="off"&&(d=""),this._renderFinalNewline==="dimmed"&&(u+=" dimmed-line-number")),h===this._activeLineNumber&&(u+=" active-line-number"),l[c]=`<div class="${br.CLASS_NAME}${t}${u}" style="left:${this._lineNumbersLeft}px;width:${this._lineNumbersWidth}px;">${d}</div>`}this._renderResult=l}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}};br.CLASS_NAME="line-numbers";let Xo=br;di((a,e)=>{const t=a.getColor(gb),i=a.getColor(kb);i?e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${i}; }`):t&&e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${t.transparent(.4)}; }`)});const vn=class vn extends Ye{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._canUseLayerHinting=!t.get(32),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._domNode=Q(document.createElement("div")),this._domNode.setClassName(vn.OUTER_CLASS_NAME),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._glyphMarginBackgroundDomNode=Q(document.createElement("div")),this._glyphMarginBackgroundDomNode.setClassName(vn.CLASS_NAME),this._domNode.appendChild(this._glyphMarginBackgroundDomNode)}dispose(){super.dispose()}getDomNode(){return this._domNode}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._canUseLayerHinting=!t.get(32),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollTopChanged}prepareRender(e){}render(e){this._domNode.setLayerHinting(this._canUseLayerHinting),this._domNode.setContain("strict");const t=e.scrollTop-e.bigNumbersDelta;this._domNode.setTop(-t);const i=Math.min(e.scrollHeight,1e6);this._domNode.setHeight(i),this._domNode.setWidth(this._contentLeft),this._glyphMarginBackgroundDomNode.setLeft(this._glyphMarginLeft),this._glyphMarginBackgroundDomNode.setWidth(this._glyphMarginWidth),this._glyphMarginBackgroundDomNode.setHeight(i)}};vn.CLASS_NAME="glyph-margin",vn.OUTER_CLASS_NAME="margin";let Jo=vn;const On="monaco-mouse-cursor-text";var jv=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Yc=function(a,e){return function(t,i){e(t,i,a)}};class $v{constructor(e,t,i,n,s){this._context=e,this.modelLineNumber=t,this.distanceToModelLineStart=i,this.widthOfHiddenLineTextBefore=n,this.distanceToModelLineEnd=s,this._visibleTextAreaBrand=void 0,this.startPosition=null,this.endPosition=null,this.visibleTextareaStart=null,this.visibleTextareaEnd=null,this._previousPresentation=null}prepareRender(e){const t=new D(this.modelLineNumber,this.distanceToModelLineStart+1),i=new D(this.modelLineNumber,this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber)-this.distanceToModelLineEnd);this.startPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t),this.endPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i),this.startPosition.lineNumber===this.endPosition.lineNumber?(this.visibleTextareaStart=e.visibleRangeForPosition(this.startPosition),this.visibleTextareaEnd=e.visibleRangeForPosition(this.endPosition)):(this.visibleTextareaStart=null,this.visibleTextareaEnd=null)}definePresentation(e){return this._previousPresentation||(e?this._previousPresentation=e:this._previousPresentation={foreground:1,italic:!1,bold:!1,underline:!1,strikethrough:!1}),this._previousPresentation}}const da=oi;let dl=class extends Ye{constructor(e,t,i,n,s){super(e),this._keybindingService=n,this._instantiationService=s,this._primaryCursorPosition=new D(1,1),this._primaryCursorVisibleRange=null,this._viewController=t,this._visibleRangeProvider=i,this._scrollLeft=0,this._scrollTop=0;const o=this._context.configuration.options,r=o.get(146);this._setAccessibilityOptions(o),this._contentLeft=r.contentLeft,this._contentWidth=r.contentWidth,this._contentHeight=r.height,this._fontInfo=o.get(50),this._lineHeight=o.get(67),this._emptySelectionClipboard=o.get(37),this._copyWithSyntaxHighlighting=o.get(25),this._visibleTextArea=null,this._selections=[new te(1,1,1,1)],this._modelSelections=[new te(1,1,1,1)],this._lastRenderPosition=null,this.textArea=Q(document.createElement("textarea")),ft.write(this.textArea,7),this.textArea.setClassName(`inputarea ${On}`),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:l}=this._context.viewModel.model.getOptions();this.textArea.domNode.style.tabSize=`${l*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("autocomplete","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",this._getAriaLabel(o)),this.textArea.setAttribute("aria-required",o.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(o.get(125))),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-roledescription",I("editor","editor")),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-autocomplete",o.get(92)?"none":"both"),this._ensureReadOnlyAttribute(),this.textAreaCover=Q(document.createElement("div")),this.textAreaCover.setPosition("absolute");const h={getLineCount:()=>this._context.viewModel.getLineCount(),getLineMaxColumn:u=>this._context.viewModel.getLineMaxColumn(u),getValueInRange:(u,g)=>this._context.viewModel.getValueInRange(u,g),getValueLengthInRange:(u,g)=>this._context.viewModel.getValueLengthInRange(u,g),modifyPosition:(u,g)=>this._context.viewModel.modifyPosition(u,g)},c={getDataToCopy:()=>{const u=this._context.viewModel.getPlainTextToCopy(this._modelSelections,this._emptySelectionClipboard,qs),g=this._context.viewModel.model.getEOL(),f=this._emptySelectionClipboard&&this._modelSelections.length===1&&this._modelSelections[0].isEmpty(),m=Array.isArray(u)?u:null,_=Array.isArray(u)?u.join(g):u;let C,p=null;if(this._copyWithSyntaxHighlighting&&_.length<65536){const b=this._context.viewModel.getRichTextToCopy(this._modelSelections,this._emptySelectionClipboard);b&&(C=b.html,p=b.mode)}return{isFromEmptySelection:f,multicursorText:m,text:_,html:C,mode:p}},getScreenReaderContent:()=>{if(this._accessibilitySupport===1){const u=this._selections[0];if(Ae&&u.isEmpty()){const f=u.getStartPosition();let m=this._getWordBeforePosition(f);if(m.length===0&&(m=this._getCharacterBeforePosition(f)),m.length>0)return new Re(m,m.length,m.length,v.fromPositions(f),0)}if(Ae&&!u.isEmpty()&&h.getValueLengthInRange(u,0)<500){const f=h.getValueInRange(u,0);return new Re(f,0,f.length,u,0)}if(Ms&&!u.isEmpty()){const f="vscode-placeholder";return new Re(f,0,f.length,null,void 0)}return Re.EMPTY}if(Th){const u=this._selections[0];if(u.isEmpty()){const g=u.getStartPosition(),[f,m]=this._getAndroidWordAtPosition(g);if(f.length>0)return new Re(f,m,m,v.fromPositions(g),0)}return Re.EMPTY}return fn.fromEditorSelection(h,this._selections[0],this._accessibilityPageSize,this._accessibilitySupport===0)},deduceModelPosition:(u,g,f)=>this._context.viewModel.deduceModelPositionRelativeToViewPosition(u,g,f)},d=this._register(new Vv(this.textArea.domNode));this._textAreaInput=this._register(this._instantiationService.createInstance(cl,c,d,Fd,{isAndroid:Th,isChrome:xf,isFirefox:oi,isSafari:Ms})),this._register(this._textAreaInput.onKeyDown(u=>{this._viewController.emitKeyDown(u)})),this._register(this._textAreaInput.onKeyUp(u=>{this._viewController.emitKeyUp(u)})),this._register(this._textAreaInput.onPaste(u=>{let g=!1,f=null,m=null;u.metadata&&(g=this._emptySelectionClipboard&&!!u.metadata.isFromEmptySelection,f=typeof u.metadata.multicursorText<"u"?u.metadata.multicursorText:null,m=u.metadata.mode),this._viewController.paste(u.text,g,f,m)})),this._register(this._textAreaInput.onCut(()=>{this._viewController.cut()})),this._register(this._textAreaInput.onType(u=>{u.replacePrevCharCnt||u.replaceNextCharCnt||u.positionDelta?this._viewController.compositionType(u.text,u.replacePrevCharCnt,u.replaceNextCharCnt,u.positionDelta):this._viewController.type(u.text)})),this._register(this._textAreaInput.onSelectionChangeRequest(u=>{this._viewController.setSelection(u)})),this._register(this._textAreaInput.onCompositionStart(u=>{const g=this.textArea.domNode,f=this._modelSelections[0],{distanceToModelLineStart:m,widthOfHiddenTextBefore:_}=(()=>{const p=g.value.substring(0,Math.min(g.selectionStart,g.selectionEnd)),b=p.lastIndexOf(`
`),w=p.substring(b+1),L=w.lastIndexOf("	"),S=w.length-L-1,y=f.getStartPosition(),N=Math.min(y.column-1,S),x=y.column-1-N,R=w.substring(0,w.length-N),{tabSize:k}=this._context.viewModel.model.getOptions(),E=Gv(this.textArea.domNode.ownerDocument,R,this._fontInfo,k);return{distanceToModelLineStart:x,widthOfHiddenTextBefore:E}})(),{distanceToModelLineEnd:C}=(()=>{const p=g.value.substring(Math.max(g.selectionStart,g.selectionEnd)),b=p.indexOf(`
`),w=b===-1?p:p.substring(0,b),L=w.indexOf("	"),S=L===-1?w.length:w.length-L-1,y=f.getEndPosition(),N=Math.min(this._context.viewModel.model.getLineMaxColumn(y.lineNumber)-y.column,S);return{distanceToModelLineEnd:this._context.viewModel.model.getLineMaxColumn(y.lineNumber)-y.column-N}})();this._context.viewModel.revealRange("keyboard",!0,v.fromPositions(this._selections[0].getStartPosition()),0,1),this._visibleTextArea=new $v(this._context,f.startLineNumber,m,_,C),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render(),this.textArea.setClassName(`inputarea ${On} ime-input`),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(this._textAreaInput.onCompositionUpdate(u=>{this._visibleTextArea&&(this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render())})),this._register(this._textAreaInput.onCompositionEnd(()=>{this._visibleTextArea=null,this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._render(),this.textArea.setClassName(`inputarea ${On}`),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()})),this._register(this._textAreaInput.onFocus(()=>{this._context.viewModel.setHasFocus(!0)})),this._register(this._textAreaInput.onBlur(()=>{this._context.viewModel.setHasFocus(!1)})),this._register(rc.onDidChange(()=>{this._ensureReadOnlyAttribute()}))}writeScreenReaderContent(e){this._textAreaInput.writeNativeTextAreaContent(e)}dispose(){super.dispose()}_getAndroidWordAtPosition(e){const t='`~!@#$%^&*()-=+[{]}\\|;:",.<>/?',i=this._context.viewModel.getLineContent(e.lineNumber),n=Hn(t,[]);let s=!0,o=e.column,r=!0,l=e.column,h=0;for(;h<50&&(s||r);){if(s&&o<=1&&(s=!1),s){const c=i.charCodeAt(o-2);n.get(c)!==0?s=!1:o--}if(r&&l>i.length&&(r=!1),r){const c=i.charCodeAt(l-1);n.get(c)!==0?r=!1:l++}h++}return[i.substring(o-1,l-1),e.column-o]}_getWordBeforePosition(e){const t=this._context.viewModel.getLineContent(e.lineNumber),i=Hn(this._context.configuration.options.get(132),[]);let n=e.column,s=0;for(;n>1;){const o=t.charCodeAt(n-2);if(i.get(o)!==0||s>50)return t.substring(n-1,e.column-1);s++,n--}return t.substring(0,e.column-1)}_getCharacterBeforePosition(e){if(e.column>1){const i=this._context.viewModel.getLineContent(e.lineNumber).charAt(e.column-2);if(!We(i.charCodeAt(0)))return i}return""}_getAriaLabel(e){var i,n,s;if(e.get(2)===1){const o=(i=this._keybindingService.lookupKeybinding("editor.action.toggleScreenReaderAccessibilityMode"))==null?void 0:i.getAriaLabel(),r=(n=this._keybindingService.lookupKeybinding("workbench.action.showCommands"))==null?void 0:n.getAriaLabel(),l=(s=this._keybindingService.lookupKeybinding("workbench.action.openGlobalKeybindings"))==null?void 0:s.getAriaLabel(),h=I("accessibilityModeOff","The editor is not accessible at this time.");return o?I("accessibilityOffAriaLabel","{0} To enable screen reader optimized mode, use {1}",h,o):r?I("accessibilityOffAriaLabelNoKb","{0} To enable screen reader optimized mode, open the quick pick with {1} and run the command Toggle Screen Reader Accessibility Mode, which is currently not triggerable via keyboard.",h,r):l?I("accessibilityOffAriaLabelNoKbs","{0} Please assign a keybinding for the command Toggle Screen Reader Accessibility Mode by accessing the keybindings editor with {1} and run it.",h,l):h}return e.get(4)}_setAccessibilityOptions(e){this._accessibilitySupport=e.get(2);const t=e.get(3);this._accessibilitySupport===2&&t===jp.accessibilityPageSize.defaultValue?this._accessibilityPageSize=500:this._accessibilityPageSize=t;const n=e.get(146).wrappingColumn;if(n!==-1&&this._accessibilitySupport!==1){const s=e.get(50);this._textAreaWrapping=!0,this._textAreaWidth=Math.round(n*s.typicalHalfwidthCharacterWidth)}else this._textAreaWrapping=!1,this._textAreaWidth=da?0:1}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);this._setAccessibilityOptions(t),this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._contentHeight=i.height,this._fontInfo=t.get(50),this._lineHeight=t.get(67),this._emptySelectionClipboard=t.get(37),this._copyWithSyntaxHighlighting=t.get(25),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:n}=this._context.viewModel.model.getOptions();return this.textArea.domNode.style.tabSize=`${n*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("aria-label",this._getAriaLabel(t)),this.textArea.setAttribute("aria-required",t.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(t.get(125))),(e.hasChanged(34)||e.hasChanged(92))&&this._ensureReadOnlyAttribute(),e.hasChanged(2)&&this._textAreaInput.writeNativeTextAreaContent("strategy changed"),!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),this._modelSelections=e.modelSelections.slice(0),this._textAreaInput.writeNativeTextAreaContent("selection changed"),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}isFocused(){return this._textAreaInput.isFocused()}focusTextArea(){this._textAreaInput.focusTextArea()}getLastRenderData(){return this._lastRenderPosition}setAriaOptions(e){e.activeDescendant?(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-autocomplete","list"),this.textArea.setAttribute("aria-activedescendant",e.activeDescendant)):(this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),this.textArea.removeAttribute("aria-activedescendant")),e.role&&this.textArea.setAttribute("role",e.role)}_ensureReadOnlyAttribute(){const e=this._context.configuration.options;!rc.enabled||e.get(34)&&e.get(92)?this.textArea.setAttribute("readonly","true"):this.textArea.removeAttribute("readonly")}prepareRender(e){var t;this._primaryCursorPosition=new D(this._selections[0].positionLineNumber,this._selections[0].positionColumn),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primaryCursorPosition),(t=this._visibleTextArea)==null||t.prepareRender(e)}render(e){this._textAreaInput.writeNativeTextAreaContent("render"),this._render()}_render(){if(this._visibleTextArea){const i=this._visibleTextArea.visibleTextareaStart,n=this._visibleTextArea.visibleTextareaEnd,s=this._visibleTextArea.startPosition,o=this._visibleTextArea.endPosition;if(s&&o&&i&&n&&n.left>=this._scrollLeft&&i.left<=this._scrollLeft+this._contentWidth){const r=this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber)-this._scrollTop,l=this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));let h=this._visibleTextArea.widthOfHiddenLineTextBefore,c=this._contentLeft+i.left-this._scrollLeft,d=n.left-i.left+1;if(c<this._contentLeft){const C=this._contentLeft-c;c+=C,h+=C,d-=C}d>this._contentWidth&&(d=this._contentWidth);const u=this._context.viewModel.getViewLineData(s.lineNumber),g=u.tokens.findTokenIndexAtOffset(s.column-1),f=u.tokens.findTokenIndexAtOffset(o.column-1),m=g===f,_=this._visibleTextArea.definePresentation(m?u.tokens.getPresentation(g):null);this.textArea.domNode.scrollTop=l*this._lineHeight,this.textArea.domNode.scrollLeft=h,this._doRender({lastRenderPosition:null,top:r,left:c,width:d,height:this._lineHeight,useCover:!1,color:(ai.getColorMap()||[])[_.foreground],italic:_.italic,bold:_.bold,underline:_.underline,strikethrough:_.strikethrough})}return}if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const e=this._contentLeft+this._primaryCursorVisibleRange.left-this._scrollLeft;if(e<this._contentLeft||e>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const t=this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber)-this._scrollTop;if(t<0||t>this._contentHeight){this._renderAtTopLeft();return}if(Ae||this._accessibilitySupport===2){this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:this._lineHeight,useCover:!1}),this.textArea.domNode.scrollLeft=this._primaryCursorVisibleRange.left;const i=this._textAreaInput.textAreaState.newlineCountBeforeSelection??this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));this.textArea.domNode.scrollTop=i*this._lineHeight;return}this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:da?0:1,useCover:!1})}_newlinecount(e){let t=0,i=-1;do{if(i=e.indexOf(`
`,i+1),i===-1)break;t++}while(!0);return t}_renderAtTopLeft(){this._doRender({lastRenderPosition:null,top:0,left:0,width:this._textAreaWidth,height:da?0:1,useCover:!0})}_doRender(e){this._lastRenderPosition=e.lastRenderPosition;const t=this.textArea,i=this.textAreaCover;qe(t,this._fontInfo),t.setTop(e.top),t.setLeft(e.left),t.setWidth(e.width),t.setHeight(e.height),t.setColor(e.color?le.Format.CSS.formatHex(e.color):""),t.setFontStyle(e.italic?"italic":""),e.bold&&t.setFontWeight("bold"),t.setTextDecoration(`${e.underline?" underline":""}${e.strikethrough?" line-through":""}`),i.setTop(e.useCover?e.top:0),i.setLeft(e.useCover?e.left:0),i.setWidth(e.useCover?e.width:0),i.setHeight(e.useCover?e.height:0);const n=this._context.configuration.options;n.get(57)?i.setClassName("monaco-editor-background textAreaCover "+Jo.OUTER_CLASS_NAME):n.get(68).renderType!==0?i.setClassName("monaco-editor-background textAreaCover "+Xo.CLASS_NAME):i.setClassName("monaco-editor-background textAreaCover")}};dl=jv([Yc(3,Er),Yc(4,Ks)],dl);function Gv(a,e,t,i){if(e.length===0)return 0;const n=a.createElement("div");n.style.position="absolute",n.style.top="-50000px",n.style.width="50000px";const s=a.createElement("span");qe(s,t),s.style.whiteSpace="pre",s.style.tabSize=`${i*t.spaceWidth}px`,s.append(e),n.appendChild(s),a.body.appendChild(n);const o=s.offsetWidth;return n.remove(),o}const Kv=()=>!0,qv=()=>!1,Zv=a=>a===" "||a==="	";class rn{static shouldRecreate(e){return e.hasChanged(146)||e.hasChanged(132)||e.hasChanged(37)||e.hasChanged(77)||e.hasChanged(79)||e.hasChanged(80)||e.hasChanged(6)||e.hasChanged(7)||e.hasChanged(11)||e.hasChanged(9)||e.hasChanged(10)||e.hasChanged(14)||e.hasChanged(129)||e.hasChanged(50)||e.hasChanged(92)||e.hasChanged(131)}constructor(e,t,i,n){this.languageConfigurationService=n,this._cursorMoveConfigurationBrand=void 0,this._languageId=e;const s=i.options,o=s.get(146),r=s.get(50);this.readOnly=s.get(92),this.tabSize=t.tabSize,this.indentSize=t.indentSize,this.insertSpaces=t.insertSpaces,this.stickyTabStops=s.get(117),this.lineHeight=r.lineHeight,this.typicalHalfwidthCharacterWidth=r.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(o.height/this.lineHeight)-2),this.useTabStops=s.get(129),this.wordSeparators=s.get(132),this.emptySelectionClipboard=s.get(37),this.copyWithSyntaxHighlighting=s.get(25),this.multiCursorMergeOverlapping=s.get(77),this.multiCursorPaste=s.get(79),this.multiCursorLimit=s.get(80),this.autoClosingBrackets=s.get(6),this.autoClosingComments=s.get(7),this.autoClosingQuotes=s.get(11),this.autoClosingDelete=s.get(9),this.autoClosingOvertype=s.get(10),this.autoSurround=s.get(14),this.autoIndent=s.get(12),this.wordSegmenterLocales=s.get(131),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(e,this.autoClosingQuotes,!0),comment:this._getShouldAutoClose(e,this.autoClosingComments,!1),bracket:this._getShouldAutoClose(e,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(e).getAutoClosingPairs();const l=this.languageConfigurationService.getLanguageConfiguration(e).getSurroundingPairs();if(l)for(const c of l)this.surroundingPairs[c.open]=c.close;const h=this.languageConfigurationService.getLanguageConfiguration(e).comments;this.blockCommentStartToken=(h==null?void 0:h.blockCommentStartToken)??null}get electricChars(){var e;if(!this._electricChars){this._electricChars={};const t=(e=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)==null?void 0:e.getElectricCharacters();if(t)for(const i of t)this._electricChars[i]=!0}return this._electricChars}onElectricCharacter(e,t,i){const n=Ti(t,i-1),s=this.languageConfigurationService.getLanguageConfiguration(n.languageId).electricCharacter;return s?s.onElectricCharacter(e,n,i-n.firstCharOffset):null}normalizeIndentation(e){return $u(e,this.indentSize,this.insertSpaces)}_getShouldAutoClose(e,t,i){switch(t){case"beforeWhitespace":return Zv;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(e,i);case"always":return Kv;case"never":return qv}}_getLanguageDefinedShouldAutoClose(e,t){const i=this.languageConfigurationService.getLanguageConfiguration(e).getAutoCloseBeforeSet(t);return n=>i.indexOf(n)!==-1}visibleColumnFromColumn(e,t){return Ce.visibleColumnFromColumn(e.getLineContent(t.lineNumber),t.column,this.tabSize)}columnFromVisibleColumn(e,t,i){const n=Ce.columnFromVisibleColumn(e.getLineContent(t),i,this.tabSize),s=e.getLineMinColumn(t);if(n<s)return s;const o=e.getLineMaxColumn(t);return n>o?o:n}}class U{static fromModelState(e){return new Qv(e)}static fromViewState(e){return new Yv(e)}static fromModelSelection(e){const t=te.liftSelection(e),i=new Se(v.fromPositions(t.getSelectionStart()),0,0,t.getPosition(),0);return U.fromModelState(i)}static fromModelSelections(e){const t=[];for(let i=0,n=e.length;i<n;i++)t[i]=this.fromModelSelection(e[i]);return t}constructor(e,t){this._cursorStateBrand=void 0,this.modelState=e,this.viewState=t}equals(e){return this.viewState.equals(e.viewState)&&this.modelState.equals(e.modelState)}}class Qv{constructor(e){this.modelState=e,this.viewState=null}}class Yv{constructor(e){this.modelState=null,this.viewState=e}}class Se{constructor(e,t,i,n,s){this.selectionStart=e,this.selectionStartKind=t,this.selectionStartLeftoverVisibleColumns=i,this.position=n,this.leftoverVisibleColumns=s,this._singleCursorStateBrand=void 0,this.selection=Se._computeSelection(this.selectionStart,this.position)}equals(e){return this.selectionStartLeftoverVisibleColumns===e.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===e.leftoverVisibleColumns&&this.selectionStartKind===e.selectionStartKind&&this.position.equals(e.position)&&this.selectionStart.equalsRange(e.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(e,t,i,n){return e?new Se(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new D(t,i),n):new Se(new v(t,i,t,i),0,n,new D(t,i),n)}static _computeSelection(e,t){return e.isEmpty()||!t.isBeforeOrEqual(e.getStartPosition())?te.fromPositions(e.getStartPosition(),t):te.fromPositions(e.getEndPosition(),t)}}class je{constructor(e,t,i){this._editOperationResultBrand=void 0,this.type=e,this.commands=t,this.shouldPushStackElementBefore=i.shouldPushStackElementBefore,this.shouldPushStackElementAfter=i.shouldPushStackElementAfter}}function ci(a){return a==="'"||a==='"'||a==="`"}class Di{static columnSelect(e,t,i,n,s,o){const r=Math.abs(s-i)+1,l=i>s,h=n>o,c=n<o,d=[];for(let u=0;u<r;u++){const g=i+(l?-u:u),f=e.columnFromVisibleColumn(t,g,n),m=e.columnFromVisibleColumn(t,g,o),_=e.visibleColumnFromColumn(t,new D(g,f)),C=e.visibleColumnFromColumn(t,new D(g,m));c&&(_>o||C<n)||h&&(C>n||_<o)||d.push(new Se(new v(g,f,g,f),0,0,new D(g,m),0))}if(d.length===0)for(let u=0;u<r;u++){const g=i+(l?-u:u),f=t.getLineMaxColumn(g);d.push(new Se(new v(g,f,g,f),0,0,new D(g,f),0))}return{viewStates:d,reversed:l,fromLineNumber:i,fromVisualColumn:n,toLineNumber:s,toVisualColumn:o}}static columnSelectLeft(e,t,i){let n=i.toViewVisualColumn;return n>0&&n--,Di.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,i.toViewLineNumber,n)}static columnSelectRight(e,t,i){let n=0;const s=Math.min(i.fromViewLineNumber,i.toViewLineNumber),o=Math.max(i.fromViewLineNumber,i.toViewLineNumber);for(let l=s;l<=o;l++){const h=t.getLineMaxColumn(l),c=e.visibleColumnFromColumn(t,new D(l,h));n=Math.max(n,c)}let r=i.toViewVisualColumn;return r<n&&r++,this.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,i.toViewLineNumber,r)}static columnSelectUp(e,t,i,n){const s=n?e.pageSize:1,o=Math.max(1,i.toViewLineNumber-s);return this.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,o,i.toViewVisualColumn)}static columnSelectDown(e,t,i,n){const s=n?e.pageSize:1,o=Math.min(t.getLineCount(),i.toViewLineNumber+s);return this.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,o,i.toViewVisualColumn)}}class Ke{constructor(e,t,i=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=i}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return te.fromPositions(n.getEndPosition())}}class ko{constructor(e,t,i=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=i}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return te.fromPositions(n.getStartPosition())}}class er{constructor(e,t,i,n,s=!1){this._range=e,this._text=t,this._columnDeltaOffset=n,this._lineNumberDeltaOffset=i,this.insertsAutoWhitespace=s}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return te.fromPositions(n.getEndPosition().delta(this._lineNumberDeltaOffset,this._columnDeltaOffset))}}class Xv{constructor(e,t,i,n=!1){this._range=e,this._text=t,this._initialSelection=i,this._forceMoveMarkers=n,this._selectionId=null}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text,this._forceMoveMarkers),this._selectionId=t.trackSelection(this._initialSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}class ua{constructor(e,t,i){this._cursorPositionBrand=void 0,this.lineNumber=e,this.column=t,this.leftoverVisibleColumns=i}}class Z{static leftPosition(e,t){if(t.column>e.getLineMinColumn(t.lineNumber))return t.delta(void 0,-yf(e.getLineContent(t.lineNumber),t.column-1));if(t.lineNumber>1){const i=t.lineNumber-1;return new D(i,e.getLineMaxColumn(i))}else return t}static leftPositionAtomicSoftTabs(e,t,i){if(t.column<=e.getLineIndentColumn(t.lineNumber)){const n=e.getLineMinColumn(t.lineNumber),s=e.getLineContent(t.lineNumber),o=zs.atomicPosition(s,t.column-1,i,0);if(o!==-1&&o+1>=n)return new D(t.lineNumber,o+1)}return this.leftPosition(e,t)}static left(e,t,i){const n=e.stickyTabStops?Z.leftPositionAtomicSoftTabs(t,i,e.tabSize):Z.leftPosition(t,i);return new ua(n.lineNumber,n.column,0)}static moveLeft(e,t,i,n,s){let o,r;if(i.hasSelection()&&!n)o=i.selection.startLineNumber,r=i.selection.startColumn;else{const l=i.position.delta(void 0,-(s-1)),h=t.normalizePosition(Z.clipPositionColumn(l,t),0),c=Z.left(e,t,h);o=c.lineNumber,r=c.column}return i.move(n,o,r,0)}static clipPositionColumn(e,t){return new D(e.lineNumber,Z.clipRange(e.column,t.getLineMinColumn(e.lineNumber),t.getLineMaxColumn(e.lineNumber)))}static clipRange(e,t,i){return e<t?t:e>i?i:e}static rightPosition(e,t,i){return i<e.getLineMaxColumn(t)?i=i+Gd(e.getLineContent(t),i-1):t<e.getLineCount()&&(t=t+1,i=e.getLineMinColumn(t)),new D(t,i)}static rightPositionAtomicSoftTabs(e,t,i,n,s){if(i<e.getLineIndentColumn(t)){const o=e.getLineContent(t),r=zs.atomicPosition(o,i-1,n,1);if(r!==-1)return new D(t,r+1)}return this.rightPosition(e,t,i)}static right(e,t,i){const n=e.stickyTabStops?Z.rightPositionAtomicSoftTabs(t,i.lineNumber,i.column,e.tabSize,e.indentSize):Z.rightPosition(t,i.lineNumber,i.column);return new ua(n.lineNumber,n.column,0)}static moveRight(e,t,i,n,s){let o,r;if(i.hasSelection()&&!n)o=i.selection.endLineNumber,r=i.selection.endColumn;else{const l=i.position.delta(void 0,s-1),h=t.normalizePosition(Z.clipPositionColumn(l,t),1),c=Z.right(e,t,h);o=c.lineNumber,r=c.column}return i.move(n,o,r,0)}static vertical(e,t,i,n,s,o,r,l){const h=Ce.visibleColumnFromColumn(t.getLineContent(i),n,e.tabSize)+s,c=t.getLineCount(),d=i===1&&n===1,u=i===c&&n===t.getLineMaxColumn(i),g=o<i?d:u;if(i=o,i<1?(i=1,r?n=t.getLineMinColumn(i):n=Math.min(t.getLineMaxColumn(i),n)):i>c?(i=c,r?n=t.getLineMaxColumn(i):n=Math.min(t.getLineMaxColumn(i),n)):n=e.columnFromVisibleColumn(t,i,h),g?s=0:s=h-Ce.visibleColumnFromColumn(t.getLineContent(i),n,e.tabSize),l!==void 0){const f=new D(i,n),m=t.normalizePosition(f,l);s=s+(n-m.column),i=m.lineNumber,n=m.column}return new ua(i,n,s)}static down(e,t,i,n,s,o,r){return this.vertical(e,t,i,n,s,i+o,r,4)}static moveDown(e,t,i,n,s){let o,r;i.hasSelection()&&!n?(o=i.selection.endLineNumber,r=i.selection.endColumn):(o=i.position.lineNumber,r=i.position.column);let l=0,h;do if(h=Z.down(e,t,o+l,r,i.leftoverVisibleColumns,s,!0),t.normalizePosition(new D(h.lineNumber,h.column),2).lineNumber>o)break;while(l++<10&&o+l<t.getLineCount());return i.move(n,h.lineNumber,h.column,h.leftoverVisibleColumns)}static translateDown(e,t,i){const n=i.selection,s=Z.down(e,t,n.selectionStartLineNumber,n.selectionStartColumn,i.selectionStartLeftoverVisibleColumns,1,!1),o=Z.down(e,t,n.positionLineNumber,n.positionColumn,i.leftoverVisibleColumns,1,!1);return new Se(new v(s.lineNumber,s.column,s.lineNumber,s.column),0,s.leftoverVisibleColumns,new D(o.lineNumber,o.column),o.leftoverVisibleColumns)}static up(e,t,i,n,s,o,r){return this.vertical(e,t,i,n,s,i-o,r,3)}static moveUp(e,t,i,n,s){let o,r;i.hasSelection()&&!n?(o=i.selection.startLineNumber,r=i.selection.startColumn):(o=i.position.lineNumber,r=i.position.column);const l=Z.up(e,t,o,r,i.leftoverVisibleColumns,s,!0);return i.move(n,l.lineNumber,l.column,l.leftoverVisibleColumns)}static translateUp(e,t,i){const n=i.selection,s=Z.up(e,t,n.selectionStartLineNumber,n.selectionStartColumn,i.selectionStartLeftoverVisibleColumns,1,!1),o=Z.up(e,t,n.positionLineNumber,n.positionColumn,i.leftoverVisibleColumns,1,!1);return new Se(new v(s.lineNumber,s.column,s.lineNumber,s.column),0,s.leftoverVisibleColumns,new D(o.lineNumber,o.column),o.leftoverVisibleColumns)}static _isBlankLine(e,t){return e.getLineFirstNonWhitespaceColumn(t)===0}static moveToPrevBlankLine(e,t,i,n){let s=i.position.lineNumber;for(;s>1&&this._isBlankLine(t,s);)s--;for(;s>1&&!this._isBlankLine(t,s);)s--;return i.move(n,s,t.getLineMinColumn(s),0)}static moveToNextBlankLine(e,t,i,n){const s=t.getLineCount();let o=i.position.lineNumber;for(;o<s&&this._isBlankLine(t,o);)o++;for(;o<s&&!this._isBlankLine(t,o);)o++;return i.move(n,o,t.getLineMinColumn(o),0)}static moveToBeginningOfLine(e,t,i,n){const s=i.position.lineNumber,o=t.getLineMinColumn(s),r=t.getLineFirstNonWhitespaceColumn(s)||o;let l;return i.position.column===r?l=o:l=r,i.move(n,s,l,0)}static moveToEndOfLine(e,t,i,n,s){const o=i.position.lineNumber,r=t.getLineMaxColumn(o);return i.move(n,o,r,s?1073741824-r:0)}static moveToBeginningOfBuffer(e,t,i,n){return i.move(n,1,1,0)}static moveToEndOfBuffer(e,t,i,n){const s=t.getLineCount(),o=t.getLineMaxColumn(s);return i.move(n,s,o,0)}}class Ki{static deleteRight(e,t,i,n){const s=[];let o=e!==3;for(let r=0,l=n.length;r<l;r++){const h=n[r];let c=h;if(c.isEmpty()){const d=h.getPosition(),u=Z.right(t,i,d);c=new v(u.lineNumber,u.column,d.lineNumber,d.column)}if(c.isEmpty()){s[r]=null;continue}c.startLineNumber!==c.endLineNumber&&(o=!0),s[r]=new Ke(c,"")}return[o,s]}static isAutoClosingPairDelete(e,t,i,n,s,o,r){if(t==="never"&&i==="never"||e==="never")return!1;for(let l=0,h=o.length;l<h;l++){const c=o[l],d=c.getPosition();if(!c.isEmpty())return!1;const u=s.getLineContent(d.lineNumber);if(d.column<2||d.column>=u.length+1)return!1;const g=u.charAt(d.column-2),f=n.get(g);if(!f)return!1;if(ci(g)){if(i==="never")return!1}else if(t==="never")return!1;const m=u.charAt(d.column-1);let _=!1;for(const C of f)C.open===g&&C.close===m&&(_=!0);if(!_)return!1;if(e==="auto"){let C=!1;for(let p=0,b=r.length;p<b;p++){const w=r[p];if(d.lineNumber===w.startLineNumber&&d.column===w.startColumn){C=!0;break}}if(!C)return!1}}return!0}static _runAutoClosingPairDelete(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++){const r=i[s].getPosition(),l=new v(r.lineNumber,r.column-1,r.lineNumber,r.column+1);n[s]=new Ke(l,"")}return[!0,n]}static deleteLeft(e,t,i,n,s){if(this.isAutoClosingPairDelete(t.autoClosingDelete,t.autoClosingBrackets,t.autoClosingQuotes,t.autoClosingPairs.autoClosingPairsOpenByEnd,i,n,s))return this._runAutoClosingPairDelete(t,i,n);const o=[];let r=e!==2;for(let l=0,h=n.length;l<h;l++){const c=Ki.getDeleteRange(n[l],i,t);if(c.isEmpty()){o[l]=null;continue}c.startLineNumber!==c.endLineNumber&&(r=!0),o[l]=new Ke(c,"")}return[r,o]}static getDeleteRange(e,t,i){if(!e.isEmpty())return e;const n=e.getPosition();if(i.useTabStops&&n.column>1){const s=t.getLineContent(n.lineNumber),o=Je(s),r=o===-1?s.length+1:o+1;if(n.column<=r){const l=i.visibleColumnFromColumn(t,n),h=Ce.prevIndentTabStop(l,i.indentSize),c=i.columnFromVisibleColumn(t,n.lineNumber,h);return new v(n.lineNumber,c,n.lineNumber,n.column)}}return v.fromPositions(Ki.getPositionAfterDeleteLeft(n,t),n)}static getPositionAfterDeleteLeft(e,t){if(e.column>1){const i=Nf(e.column-1,t.getLineContent(e.lineNumber));return e.with(void 0,i+1)}else if(e.lineNumber>1){const i=e.lineNumber-1;return new D(i,t.getLineMaxColumn(i))}else return e}static cut(e,t,i){const n=[];let s=null;i.sort((o,r)=>D.compare(o.getStartPosition(),r.getEndPosition()));for(let o=0,r=i.length;o<r;o++){const l=i[o];if(l.isEmpty())if(e.emptySelectionClipboard){const h=l.getPosition();let c,d,u,g;h.lineNumber<t.getLineCount()?(c=h.lineNumber,d=1,u=h.lineNumber+1,g=1):h.lineNumber>1&&(s==null?void 0:s.endLineNumber)!==h.lineNumber?(c=h.lineNumber-1,d=t.getLineMaxColumn(h.lineNumber-1),u=h.lineNumber,g=t.getLineMaxColumn(h.lineNumber)):(c=h.lineNumber,d=1,u=h.lineNumber,g=t.getLineMaxColumn(h.lineNumber));const f=new v(c,d,u,g);s=f,f.isEmpty()?n[o]=null:n[o]=new Ke(f,"")}else n[o]=null;else n[o]=new Ke(l,"")}return new je(0,n,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class ue{static _createWord(e,t,i,n,s){return{start:n,end:s,wordType:t,nextCharClass:i}}static _createIntlWord(e,t){return{start:e.index,end:e.index+e.segment.length,wordType:1,nextCharClass:t}}static _findPreviousWordOnLine(e,t,i){const n=t.getLineContent(i.lineNumber);return this._doFindPreviousWordOnLine(n,e,i)}static _doFindPreviousWordOnLine(e,t,i){let n=0;const s=t.findPrevIntlWordBeforeOrAtOffset(e,i.column-2);for(let o=i.column-2;o>=0;o--){const r=e.charCodeAt(o),l=t.get(r);if(s&&o===s.index)return this._createIntlWord(s,l);if(l===0){if(n===2)return this._createWord(e,n,l,o+1,this._findEndOfWord(e,t,n,o+1));n=1}else if(l===2){if(n===1)return this._createWord(e,n,l,o+1,this._findEndOfWord(e,t,n,o+1));n=2}else if(l===1&&n!==0)return this._createWord(e,n,l,o+1,this._findEndOfWord(e,t,n,o+1))}return n!==0?this._createWord(e,n,1,0,this._findEndOfWord(e,t,n,0)):null}static _findEndOfWord(e,t,i,n){const s=t.findNextIntlWordAtOrAfterOffset(e,n),o=e.length;for(let r=n;r<o;r++){const l=e.charCodeAt(r),h=t.get(l);if(s&&r===s.index+s.segment.length||h===1||i===1&&h===2||i===2&&h===0)return r}return o}static _findNextWordOnLine(e,t,i){const n=t.getLineContent(i.lineNumber);return this._doFindNextWordOnLine(n,e,i)}static _doFindNextWordOnLine(e,t,i){let n=0;const s=e.length,o=t.findNextIntlWordAtOrAfterOffset(e,i.column-1);for(let r=i.column-1;r<s;r++){const l=e.charCodeAt(r),h=t.get(l);if(o&&r===o.index)return this._createIntlWord(o,h);if(h===0){if(n===2)return this._createWord(e,n,h,this._findStartOfWord(e,t,n,r-1),r);n=1}else if(h===2){if(n===1)return this._createWord(e,n,h,this._findStartOfWord(e,t,n,r-1),r);n=2}else if(h===1&&n!==0)return this._createWord(e,n,h,this._findStartOfWord(e,t,n,r-1),r)}return n!==0?this._createWord(e,n,1,this._findStartOfWord(e,t,n,s-1),s):null}static _findStartOfWord(e,t,i,n){const s=t.findPrevIntlWordBeforeOrAtOffset(e,n);for(let o=n;o>=0;o--){const r=e.charCodeAt(o),l=t.get(r);if(s&&o===s.index)return o;if(l===1||i===1&&l===2||i===2&&l===0)return o+1}return 0}static moveWordLeft(e,t,i,n,s){let o=i.lineNumber,r=i.column;r===1&&o>1&&(o=o-1,r=t.getLineMaxColumn(o));let l=ue._findPreviousWordOnLine(e,t,new D(o,r));if(n===0)return new D(o,l?l.start+1:1);if(n===1)return!s&&l&&l.wordType===2&&l.end-l.start===1&&l.nextCharClass===0&&(l=ue._findPreviousWordOnLine(e,t,new D(o,l.start+1))),new D(o,l?l.start+1:1);if(n===3){for(;l&&l.wordType===2;)l=ue._findPreviousWordOnLine(e,t,new D(o,l.start+1));return new D(o,l?l.start+1:1)}return l&&r<=l.end+1&&(l=ue._findPreviousWordOnLine(e,t,new D(o,l.start+1))),new D(o,l?l.end+1:1)}static _moveWordPartLeft(e,t){const i=t.lineNumber,n=e.getLineMaxColumn(i);if(t.column===1)return i>1?new D(i-1,e.getLineMaxColumn(i-1)):t;const s=e.getLineContent(i);for(let o=t.column-1;o>1;o--){const r=s.charCodeAt(o-2),l=s.charCodeAt(o-1);if(r===95&&l!==95)return new D(i,o);if(r===45&&l!==45)return new D(i,o);if((io(r)||no(r))&&en(l))return new D(i,o);if(en(r)&&en(l)&&o+1<n){const h=s.charCodeAt(o);if(io(h)||no(h))return new D(i,o)}}return new D(i,1)}static moveWordRight(e,t,i,n){let s=i.lineNumber,o=i.column,r=!1;o===t.getLineMaxColumn(s)&&s<t.getLineCount()&&(r=!0,s=s+1,o=1);let l=ue._findNextWordOnLine(e,t,new D(s,o));if(n===2)l&&l.wordType===2&&l.end-l.start===1&&l.nextCharClass===0&&(l=ue._findNextWordOnLine(e,t,new D(s,l.end+1))),l?o=l.end+1:o=t.getLineMaxColumn(s);else if(n===3){for(r&&(o=0);l&&(l.wordType===2||l.start+1<=o);)l=ue._findNextWordOnLine(e,t,new D(s,l.end+1));l?o=l.start+1:o=t.getLineMaxColumn(s)}else l&&!r&&o>=l.start+1&&(l=ue._findNextWordOnLine(e,t,new D(s,l.end+1))),l?o=l.start+1:o=t.getLineMaxColumn(s);return new D(s,o)}static _moveWordPartRight(e,t){const i=t.lineNumber,n=e.getLineMaxColumn(i);if(t.column===n)return i<e.getLineCount()?new D(i+1,1):t;const s=e.getLineContent(i);for(let o=t.column+1;o<n;o++){const r=s.charCodeAt(o-2),l=s.charCodeAt(o-1);if(r!==95&&l===95)return new D(i,o);if(r!==45&&l===45)return new D(i,o);if((io(r)||no(r))&&en(l))return new D(i,o);if(en(r)&&en(l)&&o+1<n){const h=s.charCodeAt(o);if(io(h)||no(h))return new D(i,o)}}return new D(i,n)}static _deleteWordLeftWhitespace(e,t){const i=e.getLineContent(t.lineNumber),n=t.column-2,s=Kn(i,n);return s+1<n?new v(t.lineNumber,s+2,t.lineNumber,t.column):null}static deleteWordLeft(e,t){const i=e.wordSeparators,n=e.model,s=e.selection,o=e.whitespaceHeuristics;if(!s.isEmpty())return s;if(Ki.isAutoClosingPairDelete(e.autoClosingDelete,e.autoClosingBrackets,e.autoClosingQuotes,e.autoClosingPairs.autoClosingPairsOpenByEnd,e.model,[e.selection],e.autoClosedCharacters)){const d=e.selection.getPosition();return new v(d.lineNumber,d.column-1,d.lineNumber,d.column+1)}const r=new D(s.positionLineNumber,s.positionColumn);let l=r.lineNumber,h=r.column;if(l===1&&h===1)return null;if(o){const d=this._deleteWordLeftWhitespace(n,r);if(d)return d}let c=ue._findPreviousWordOnLine(i,n,r);return t===0?c?h=c.start+1:h>1?h=1:(l--,h=n.getLineMaxColumn(l)):(c&&h<=c.end+1&&(c=ue._findPreviousWordOnLine(i,n,new D(l,c.start+1))),c?h=c.end+1:h>1?h=1:(l--,h=n.getLineMaxColumn(l))),new v(l,h,r.lineNumber,r.column)}static deleteInsideWord(e,t,i){if(!i.isEmpty())return i;const n=new D(i.positionLineNumber,i.positionColumn),s=this._deleteInsideWordWhitespace(t,n);return s||this._deleteInsideWordDetermineDeleteRange(e,t,n)}static _charAtIsWhitespace(e,t){const i=e.charCodeAt(t);return i===32||i===9}static _deleteInsideWordWhitespace(e,t){const i=e.getLineContent(t.lineNumber),n=i.length;if(n===0)return null;let s=Math.max(t.column-2,0);if(!this._charAtIsWhitespace(i,s))return null;let o=Math.min(t.column-1,n-1);if(!this._charAtIsWhitespace(i,o))return null;for(;s>0&&this._charAtIsWhitespace(i,s-1);)s--;for(;o+1<n&&this._charAtIsWhitespace(i,o+1);)o++;return new v(t.lineNumber,s+1,t.lineNumber,o+2)}static _deleteInsideWordDetermineDeleteRange(e,t,i){const n=t.getLineContent(i.lineNumber),s=n.length;if(s===0)return i.lineNumber>1?new v(i.lineNumber-1,t.getLineMaxColumn(i.lineNumber-1),i.lineNumber,1):i.lineNumber<t.getLineCount()?new v(i.lineNumber,1,i.lineNumber+1,1):new v(i.lineNumber,1,i.lineNumber,1);const o=d=>d.start+1<=i.column&&i.column<=d.end+1,r=(d,u)=>(d=Math.min(d,i.column),u=Math.max(u,i.column),new v(i.lineNumber,d,i.lineNumber,u)),l=d=>{let u=d.start+1,g=d.end+1,f=!1;for(;g-1<s&&this._charAtIsWhitespace(n,g-1);)f=!0,g++;if(!f)for(;u>1&&this._charAtIsWhitespace(n,u-2);)u--;return r(u,g)},h=ue._findPreviousWordOnLine(e,t,i);if(h&&o(h))return l(h);const c=ue._findNextWordOnLine(e,t,i);return c&&o(c)?l(c):h&&c?r(h.end+1,c.start+1):h?r(h.start+1,h.end+1):c?r(c.start+1,c.end+1):r(1,s+1)}static _deleteWordPartLeft(e,t){if(!t.isEmpty())return t;const i=t.getPosition(),n=ue._moveWordPartLeft(e,i);return new v(i.lineNumber,i.column,n.lineNumber,n.column)}static _findFirstNonWhitespaceChar(e,t){const i=e.length;for(let n=t;n<i;n++){const s=e.charAt(n);if(s!==" "&&s!=="	")return n}return i}static _deleteWordRightWhitespace(e,t){const i=e.getLineContent(t.lineNumber),n=t.column-1,s=this._findFirstNonWhitespaceChar(i,n);return n+1<s?new v(t.lineNumber,t.column,t.lineNumber,s+1):null}static deleteWordRight(e,t){const i=e.wordSeparators,n=e.model,s=e.selection,o=e.whitespaceHeuristics;if(!s.isEmpty())return s;const r=new D(s.positionLineNumber,s.positionColumn);let l=r.lineNumber,h=r.column;const c=n.getLineCount(),d=n.getLineMaxColumn(l);if(l===c&&h===d)return null;if(o){const g=this._deleteWordRightWhitespace(n,r);if(g)return g}let u=ue._findNextWordOnLine(i,n,r);return t===2?u?h=u.end+1:h<d||l===c?h=d:(l++,u=ue._findNextWordOnLine(i,n,new D(l,1)),u?h=u.start+1:h=n.getLineMaxColumn(l)):(u&&h>=u.start+1&&(u=ue._findNextWordOnLine(i,n,new D(l,u.end+1))),u?h=u.start+1:h<d||l===c?h=d:(l++,u=ue._findNextWordOnLine(i,n,new D(l,1)),u?h=u.start+1:h=n.getLineMaxColumn(l))),new v(l,h,r.lineNumber,r.column)}static _deleteWordPartRight(e,t){if(!t.isEmpty())return t;const i=t.getPosition(),n=ue._moveWordPartRight(e,i);return new v(i.lineNumber,i.column,n.lineNumber,n.column)}static _createWordAtPosition(e,t,i){const n=new v(t,i.start+1,t,i.end+1);return{word:e.getValueInRange(n),startColumn:n.startColumn,endColumn:n.endColumn}}static getWordAtPosition(e,t,i,n){const s=Hn(t,i),o=ue._findPreviousWordOnLine(s,e,n);if(o&&o.wordType===1&&o.start<=n.column-1&&n.column-1<=o.end)return ue._createWordAtPosition(e,n.lineNumber,o);const r=ue._findNextWordOnLine(s,e,n);return r&&r.wordType===1&&r.start<=n.column-1&&n.column-1<=r.end?ue._createWordAtPosition(e,n.lineNumber,r):null}static word(e,t,i,n,s){const o=Hn(e.wordSeparators,e.wordSegmenterLocales),r=ue._findPreviousWordOnLine(o,t,s),l=ue._findNextWordOnLine(o,t,s);if(!n){let g,f;return r&&r.wordType===1&&r.start<=s.column-1&&s.column-1<=r.end?(g=r.start+1,f=r.end+1):l&&l.wordType===1&&l.start<=s.column-1&&s.column-1<=l.end?(g=l.start+1,f=l.end+1):(r?g=r.end+1:g=1,l?f=l.start+1:f=t.getLineMaxColumn(s.lineNumber)),new Se(new v(s.lineNumber,g,s.lineNumber,f),1,0,new D(s.lineNumber,f),0)}let h,c;r&&r.wordType===1&&r.start<s.column-1&&s.column-1<r.end?(h=r.start+1,c=r.end+1):l&&l.wordType===1&&l.start<s.column-1&&s.column-1<l.end?(h=l.start+1,c=l.end+1):(h=s.column,c=s.column);const d=s.lineNumber;let u;if(i.selectionStart.containsPosition(s))u=i.selectionStart.endColumn;else if(s.isBeforeOrEqual(i.selectionStart.getStartPosition())){u=h;const g=new D(d,u);i.selectionStart.containsPosition(g)&&(u=i.selectionStart.endColumn)}else{u=c;const g=new D(d,u);i.selectionStart.containsPosition(g)&&(u=i.selectionStart.startColumn)}return i.move(!0,d,u,0)}}class ke{static addCursorDown(e,t,i){const n=[];let s=0;for(let o=0,r=t.length;o<r;o++){const l=t[o];n[s++]=new U(l.modelState,l.viewState),i?n[s++]=U.fromModelState(Z.translateDown(e.cursorConfig,e.model,l.modelState)):n[s++]=U.fromViewState(Z.translateDown(e.cursorConfig,e,l.viewState))}return n}static addCursorUp(e,t,i){const n=[];let s=0;for(let o=0,r=t.length;o<r;o++){const l=t[o];n[s++]=new U(l.modelState,l.viewState),i?n[s++]=U.fromModelState(Z.translateUp(e.cursorConfig,e.model,l.modelState)):n[s++]=U.fromViewState(Z.translateUp(e.cursorConfig,e,l.viewState))}return n}static moveToBeginningOfLine(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s];n[s]=this._moveToLineStart(e,r,i)}return n}static _moveToLineStart(e,t,i){const n=t.viewState.position.column,s=t.modelState.position.column,o=n===s,r=t.viewState.position.lineNumber,l=e.getLineFirstNonWhitespaceColumn(r);return!o&&!(n===l)?this._moveToLineStartByView(e,t,i):this._moveToLineStartByModel(e,t,i)}static _moveToLineStartByView(e,t,i){return U.fromViewState(Z.moveToBeginningOfLine(e.cursorConfig,e,t.viewState,i))}static _moveToLineStartByModel(e,t,i){return U.fromModelState(Z.moveToBeginningOfLine(e.cursorConfig,e.model,t.modelState,i))}static moveToEndOfLine(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=this._moveToLineEnd(e,l,i,n)}return s}static _moveToLineEnd(e,t,i,n){const s=t.viewState.position,o=e.getLineMaxColumn(s.lineNumber),r=s.column===o,l=t.modelState.position,h=e.model.getLineMaxColumn(l.lineNumber),c=o-s.column===h-l.column;return r||c?this._moveToLineEndByModel(e,t,i,n):this._moveToLineEndByView(e,t,i,n)}static _moveToLineEndByView(e,t,i,n){return U.fromViewState(Z.moveToEndOfLine(e.cursorConfig,e,t.viewState,i,n))}static _moveToLineEndByModel(e,t,i,n){return U.fromModelState(Z.moveToEndOfLine(e.cursorConfig,e.model,t.modelState,i,n))}static expandLineSelection(e,t){const i=[];for(let n=0,s=t.length;n<s;n++){const o=t[n],r=o.modelState.selection.startLineNumber,l=e.model.getLineCount();let h=o.modelState.selection.endLineNumber,c;h===l?c=e.model.getLineMaxColumn(l):(h++,c=1),i[n]=U.fromModelState(new Se(new v(r,1,r,1),0,0,new D(h,c),0))}return i}static moveToBeginningOfBuffer(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s];n[s]=U.fromModelState(Z.moveToBeginningOfBuffer(e.cursorConfig,e.model,r.modelState,i))}return n}static moveToEndOfBuffer(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s];n[s]=U.fromModelState(Z.moveToEndOfBuffer(e.cursorConfig,e.model,r.modelState,i))}return n}static selectAll(e,t){const i=e.model.getLineCount(),n=e.model.getLineMaxColumn(i);return U.fromModelState(new Se(new v(1,1,1,1),0,0,new D(i,n),0))}static line(e,t,i,n,s){const o=e.model.validatePosition(n),r=s?e.coordinatesConverter.validateViewPosition(new D(s.lineNumber,s.column),o):e.coordinatesConverter.convertModelPositionToViewPosition(o);if(!i){const h=e.model.getLineCount();let c=o.lineNumber+1,d=1;return c>h&&(c=h,d=e.model.getLineMaxColumn(c)),U.fromModelState(new Se(new v(o.lineNumber,1,c,d),2,0,new D(c,d),0))}const l=t.modelState.selectionStart.getStartPosition().lineNumber;if(o.lineNumber<l)return U.fromViewState(t.viewState.move(!0,r.lineNumber,1,0));if(o.lineNumber>l){const h=e.getLineCount();let c=r.lineNumber+1,d=1;return c>h&&(c=h,d=e.getLineMaxColumn(c)),U.fromViewState(t.viewState.move(!0,c,d,0))}else{const h=t.modelState.selectionStart.getEndPosition();return U.fromModelState(t.modelState.move(!0,h.lineNumber,h.column,0))}}static word(e,t,i,n){const s=e.model.validatePosition(n);return U.fromModelState(ue.word(e.cursorConfig,e.model,t.modelState,i,s))}static cancelSelection(e,t){if(!t.modelState.hasSelection())return new U(t.modelState,t.viewState);const i=t.viewState.position.lineNumber,n=t.viewState.position.column;return U.fromViewState(new Se(new v(i,n,i,n),0,0,new D(i,n),0))}static moveTo(e,t,i,n,s){if(i){if(t.modelState.selectionStartKind===1)return this.word(e,t,i,n);if(t.modelState.selectionStartKind===2)return this.line(e,t,i,n,s)}const o=e.model.validatePosition(n),r=s?e.coordinatesConverter.validateViewPosition(new D(s.lineNumber,s.column),o):e.coordinatesConverter.convertModelPositionToViewPosition(o);return U.fromViewState(t.viewState.move(i,r.lineNumber,r.column,0))}static simpleMove(e,t,i,n,s,o){switch(i){case 0:return o===4?this._moveHalfLineLeft(e,t,n):this._moveLeft(e,t,n,s);case 1:return o===4?this._moveHalfLineRight(e,t,n):this._moveRight(e,t,n,s);case 2:return o===2?this._moveUpByViewLines(e,t,n,s):this._moveUpByModelLines(e,t,n,s);case 3:return o===2?this._moveDownByViewLines(e,t,n,s):this._moveDownByModelLines(e,t,n,s);case 4:return o===2?t.map(r=>U.fromViewState(Z.moveToPrevBlankLine(e.cursorConfig,e,r.viewState,n))):t.map(r=>U.fromModelState(Z.moveToPrevBlankLine(e.cursorConfig,e.model,r.modelState,n)));case 5:return o===2?t.map(r=>U.fromViewState(Z.moveToNextBlankLine(e.cursorConfig,e,r.viewState,n))):t.map(r=>U.fromModelState(Z.moveToNextBlankLine(e.cursorConfig,e.model,r.modelState,n)));case 6:return this._moveToViewMinColumn(e,t,n);case 7:return this._moveToViewFirstNonWhitespaceColumn(e,t,n);case 8:return this._moveToViewCenterColumn(e,t,n);case 9:return this._moveToViewMaxColumn(e,t,n);case 10:return this._moveToViewLastNonWhitespaceColumn(e,t,n);default:return null}}static viewportMove(e,t,i,n,s){const o=e.getCompletelyVisibleViewRange(),r=e.coordinatesConverter.convertViewRangeToModelRange(o);switch(i){case 11:{const l=this._firstLineNumberInRange(e.model,r,s),h=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],n,l,h)]}case 13:{const l=this._lastLineNumberInRange(e.model,r,s),h=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],n,l,h)]}case 12:{const l=Math.round((r.startLineNumber+r.endLineNumber)/2),h=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],n,l,h)]}case 14:{const l=[];for(let h=0,c=t.length;h<c;h++){const d=t[h];l[h]=this.findPositionInViewportIfOutside(e,d,o,n)}return l}default:return null}}static findPositionInViewportIfOutside(e,t,i,n){const s=t.viewState.position.lineNumber;if(i.startLineNumber<=s&&s<=i.endLineNumber-1)return new U(t.modelState,t.viewState);{let o;s>i.endLineNumber-1?o=i.endLineNumber-1:s<i.startLineNumber?o=i.startLineNumber:o=s;const r=Z.vertical(e.cursorConfig,e,s,t.viewState.position.column,t.viewState.leftoverVisibleColumns,o,!1);return U.fromViewState(t.viewState.move(n,r.lineNumber,r.column,r.leftoverVisibleColumns))}}static _firstLineNumberInRange(e,t,i){let n=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(n)&&n++,Math.min(t.endLineNumber,n+i-1)}static _lastLineNumberInRange(e,t,i){let n=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(n)&&n++,Math.max(n,t.endLineNumber-i+1)}static _moveLeft(e,t,i,n){return t.map(s=>U.fromViewState(Z.moveLeft(e.cursorConfig,e,s.viewState,i,n)))}static _moveHalfLineLeft(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=Math.round(e.getLineLength(l)/2);n[s]=U.fromViewState(Z.moveLeft(e.cursorConfig,e,r.viewState,i,h))}return n}static _moveRight(e,t,i,n){return t.map(s=>U.fromViewState(Z.moveRight(e.cursorConfig,e,s.viewState,i,n)))}static _moveHalfLineRight(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=Math.round(e.getLineLength(l)/2);n[s]=U.fromViewState(Z.moveRight(e.cursorConfig,e,r.viewState,i,h))}return n}static _moveDownByViewLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=U.fromViewState(Z.moveDown(e.cursorConfig,e,l.viewState,i,n))}return s}static _moveDownByModelLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=U.fromModelState(Z.moveDown(e.cursorConfig,e.model,l.modelState,i,n))}return s}static _moveUpByViewLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=U.fromViewState(Z.moveUp(e.cursorConfig,e,l.viewState,i,n))}return s}static _moveUpByModelLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=U.fromModelState(Z.moveUp(e.cursorConfig,e.model,l.modelState,i,n))}return s}static _moveToViewPosition(e,t,i,n,s){return U.fromViewState(t.viewState.move(i,n,s,0))}static _moveToModelPosition(e,t,i,n,s){return U.fromModelState(t.modelState.move(i,n,s,0))}static _moveToViewMinColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=e.getLineMinColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,h)}return n}static _moveToViewFirstNonWhitespaceColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=e.getLineFirstNonWhitespaceColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,h)}return n}static _moveToViewCenterColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=Math.round((e.getLineMaxColumn(l)+e.getLineMinColumn(l))/2);n[s]=this._moveToViewPosition(e,r,i,l,h)}return n}static _moveToViewMaxColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=e.getLineMaxColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,h)}return n}static _moveToViewLastNonWhitespaceColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,h=e.getLineLastNonWhitespaceColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,h)}return n}}var tr;(function(a){const e=function(i){if(!Ir(i))return!1;const n=i;return!(!$i(n.to)||!Oi(n.select)&&!Kd(n.select)||!Oi(n.by)&&!$i(n.by)||!Oi(n.value)&&!Gs(n.value))};a.metadata={description:"Move cursor to a logical position in the view",args:[{name:"Cursor move argument object",description:`Property-value pairs that can be passed through this argument:
					* 'to': A mandatory logical position value providing where to move the cursor.
						\`\`\`
						'left', 'right', 'up', 'down', 'prevBlankLine', 'nextBlankLine',
						'wrappedLineStart', 'wrappedLineEnd', 'wrappedLineColumnCenter'
						'wrappedLineFirstNonWhitespaceCharacter', 'wrappedLineLastNonWhitespaceCharacter'
						'viewPortTop', 'viewPortCenter', 'viewPortBottom', 'viewPortIfOutside'
						\`\`\`
					* 'by': Unit to move. Default is computed based on 'to' value.
						\`\`\`
						'line', 'wrappedLine', 'character', 'halfLine'
						\`\`\`
					* 'value': Number of units to move. Default is '1'.
					* 'select': If 'true' makes the selection. Default is 'false'.
				`,constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right","up","down","prevBlankLine","nextBlankLine","wrappedLineStart","wrappedLineEnd","wrappedLineColumnCenter","wrappedLineFirstNonWhitespaceCharacter","wrappedLineLastNonWhitespaceCharacter","viewPortTop","viewPortCenter","viewPortBottom","viewPortIfOutside"]},by:{type:"string",enum:["line","wrappedLine","character","halfLine"]},value:{type:"number",default:1},select:{type:"boolean",default:!1}}}}]},a.RawDirection={Left:"left",Right:"right",Up:"up",Down:"down",PrevBlankLine:"prevBlankLine",NextBlankLine:"nextBlankLine",WrappedLineStart:"wrappedLineStart",WrappedLineFirstNonWhitespaceCharacter:"wrappedLineFirstNonWhitespaceCharacter",WrappedLineColumnCenter:"wrappedLineColumnCenter",WrappedLineEnd:"wrappedLineEnd",WrappedLineLastNonWhitespaceCharacter:"wrappedLineLastNonWhitespaceCharacter",ViewPortTop:"viewPortTop",ViewPortCenter:"viewPortCenter",ViewPortBottom:"viewPortBottom",ViewPortIfOutside:"viewPortIfOutside"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Character:"character",HalfLine:"halfLine"};function t(i){if(!i.to)return null;let n;switch(i.to){case a.RawDirection.Left:n=0;break;case a.RawDirection.Right:n=1;break;case a.RawDirection.Up:n=2;break;case a.RawDirection.Down:n=3;break;case a.RawDirection.PrevBlankLine:n=4;break;case a.RawDirection.NextBlankLine:n=5;break;case a.RawDirection.WrappedLineStart:n=6;break;case a.RawDirection.WrappedLineFirstNonWhitespaceCharacter:n=7;break;case a.RawDirection.WrappedLineColumnCenter:n=8;break;case a.RawDirection.WrappedLineEnd:n=9;break;case a.RawDirection.WrappedLineLastNonWhitespaceCharacter:n=10;break;case a.RawDirection.ViewPortTop:n=11;break;case a.RawDirection.ViewPortBottom:n=13;break;case a.RawDirection.ViewPortCenter:n=12;break;case a.RawDirection.ViewPortIfOutside:n=14;break;default:return null}let s=0;switch(i.by){case a.RawUnit.Line:s=1;break;case a.RawUnit.WrappedLine:s=2;break;case a.RawUnit.Character:s=3;break;case a.RawUnit.HalfLine:s=4;break}return{direction:n,unit:s,select:!!i.select,value:i.value||1}}a.parse=t})(tr||(tr={}));class Jv{constructor(e,t,i){this._indentRulesSupport=t,this._indentationLineProcessor=new wg(e,i)}shouldIncrease(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIncrease(i)}shouldDecrease(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldDecrease(i)}shouldIgnore(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIgnore(i)}shouldIndentNextLine(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIndentNextLine(i)}}class hh{constructor(e,t){this.model=e,this.indentationLineProcessor=new wg(e,t)}getProcessedTokenContextAroundRange(e){const t=this._getProcessedTokensBeforeRange(e),i=this._getProcessedTokensAfterRange(e),n=this._getProcessedPreviousLineTokens(e);return{beforeRangeProcessedTokens:t,afterRangeProcessedTokens:i,previousLineProcessedTokens:n}}_getProcessedTokensBeforeRange(e){this.model.tokenization.forceTokenization(e.startLineNumber);const t=this.model.tokenization.getLineTokens(e.startLineNumber),i=Ti(t,e.startColumn-1);let n;if(ch(this.model,e.getStartPosition())){const o=e.startColumn-1-i.firstCharOffset,r=i.firstCharOffset,l=r+o;n=t.sliceAndInflate(r,l,0)}else{const o=e.startColumn-1;n=t.sliceAndInflate(0,o,0)}return this.indentationLineProcessor.getProcessedTokens(n)}_getProcessedTokensAfterRange(e){const t=e.isEmpty()?e.getStartPosition():e.getEndPosition();this.model.tokenization.forceTokenization(t.lineNumber);const i=this.model.tokenization.getLineTokens(t.lineNumber),n=Ti(i,t.column-1),s=t.column-1-n.firstCharOffset,o=n.firstCharOffset+s,r=n.firstCharOffset+n.getLineLength(),l=i.sliceAndInflate(o,r,0);return this.indentationLineProcessor.getProcessedTokens(l)}_getProcessedPreviousLineTokens(e){const t=g=>{this.model.tokenization.forceTokenization(g);const f=this.model.tokenization.getLineTokens(g),m=this.model.getLineMaxColumn(g)-1;return Ti(f,m)};this.model.tokenization.forceTokenization(e.startLineNumber);const i=this.model.tokenization.getLineTokens(e.startLineNumber),n=Ti(i,e.startColumn-1),s=st.createEmpty("",n.languageIdCodec),o=e.startLineNumber-1;if(o===0||!(n.firstCharOffset===0))return s;const h=t(o);if(!(n.languageId===h.languageId))return s;const d=h.toIViewLineTokens();return this.indentationLineProcessor.getProcessedTokens(d)}}class wg{constructor(e,t){this.model=e,this.languageConfigurationService=t}getProcessedLine(e,t){var o,r;const i=(l,h)=>{const c=Fe(l);return h+l.substring(c.length)};(r=(o=this.model.tokenization).forceTokenization)==null||r.call(o,e);const n=this.model.tokenization.getLineTokens(e);let s=this.getProcessedTokens(n).getLineContent();return t!==void 0&&(s=i(s,t)),s}getProcessedTokens(e){const t=l=>l===2||l===3||l===1,i=e.getLanguageId(0),s=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew.getBracketRegExp({global:!0}),o=[];return e.forEach(l=>{const h=e.getStandardTokenType(l);let c=e.getTokenText(l);t(h)&&(c=c.replace(s,""));const d=e.getMetadata(l);o.push({text:c,metadata:d})}),st.createFromTextAndMetadata(o,e.languageIdCodec)}}function ch(a,e){a.tokenization.forceTokenization(e.lineNumber);const t=a.tokenization.getLineTokens(e.lineNumber),i=Ti(t,e.column-1),n=i.firstCharOffset===0,s=t.getLanguageId(0)===i.languageId;return!n&&!s}function dh(a,e,t,i){e.tokenization.forceTokenization(t.startLineNumber);const n=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),s=i.getLanguageConfiguration(n);if(!s)return null;const r=new hh(e,i).getProcessedTokenContextAroundRange(t),l=r.previousLineProcessedTokens.getLineContent(),h=r.beforeRangeProcessedTokens.getLineContent(),c=r.afterRangeProcessedTokens.getLineContent(),d=s.onEnter(a,l,h,c);if(!d)return null;const u=d.indentAction;let g=d.appendText;const f=d.removeText||0;g?u===Ve.Indent&&(g="	"+g):u===Ve.Indent||u===Ve.IndentOutdent?g="	":g="";let m=gu(e,t.startLineNumber,t.startColumn);return f&&(m=m.substring(0,m.length-f)),{indentAction:u,appendText:g,removeText:f,indentation:m}}var eS=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},tS=function(a,e){return function(t,i){e(t,i,a)}},To;const ga=Object.create(null);function mi(a,e){if(e<=0)return"";ga[a]||(ga[a]=["",a]);const t=ga[a];for(let i=t.length;i<=e;i++)t[i]=t[i-1]+a;return t[e]}let qi=To=class{static unshiftIndent(e,t,i,n,s){const o=Ce.visibleColumnFromColumn(e,t,i);if(s){const r=mi(" ",n),h=Ce.prevIndentTabStop(o,n)/n;return mi(r,h)}else{const r="	",h=Ce.prevRenderTabStop(o,i)/i;return mi(r,h)}}static shiftIndent(e,t,i,n,s){const o=Ce.visibleColumnFromColumn(e,t,i);if(s){const r=mi(" ",n),h=Ce.nextIndentTabStop(o,n)/n;return mi(r,h)}else{const r="	",h=Ce.nextRenderTabStop(o,i)/i;return mi(r,h)}}constructor(e,t,i){this._languageConfigurationService=i,this._opts=t,this._selection=e,this._selectionId=null,this._useLastEditRangeForCursorEndPosition=!1,this._selectionStartColumnStaysPut=!1}_addEditOperation(e,t,i){this._useLastEditRangeForCursorEndPosition?e.addTrackedEditOperation(t,i):e.addEditOperation(t,i)}getEditOperations(e,t){const i=this._selection.startLineNumber;let n=this._selection.endLineNumber;this._selection.endColumn===1&&i!==n&&(n=n-1);const{tabSize:s,indentSize:o,insertSpaces:r}=this._opts,l=i===n;if(this._opts.useTabStops){this._selection.isEmpty()&&/^\s*$/.test(e.getLineContent(i))&&(this._useLastEditRangeForCursorEndPosition=!0);let h=0,c=0;for(let d=i;d<=n;d++,h=c){c=0;const u=e.getLineContent(d);let g=Je(u);if(this._opts.isUnshift&&(u.length===0||g===0)||!l&&!this._opts.isUnshift&&u.length===0)continue;if(g===-1&&(g=u.length),d>1&&Ce.visibleColumnFromColumn(u,g+1,s)%o!==0&&e.tokenization.isCheapToTokenize(d-1)){const _=dh(this._opts.autoIndent,e,new v(d-1,e.getLineMaxColumn(d-1),d-1,e.getLineMaxColumn(d-1)),this._languageConfigurationService);if(_){if(c=h,_.appendText)for(let C=0,p=_.appendText.length;C<p&&c<o&&_.appendText.charCodeAt(C)===32;C++)c++;_.removeText&&(c=Math.max(0,c-_.removeText));for(let C=0;C<c&&!(g===0||u.charCodeAt(g-1)!==32);C++)g--}}if(this._opts.isUnshift&&g===0)continue;let f;this._opts.isUnshift?f=To.unshiftIndent(u,g+1,s,o,r):f=To.shiftIndent(u,g+1,s,o,r),this._addEditOperation(t,new v(d,1,d,g+1),f),d===i&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn<=g+1)}}else{!this._opts.isUnshift&&this._selection.isEmpty()&&e.getLineLength(i)===0&&(this._useLastEditRangeForCursorEndPosition=!0);const h=r?mi(" ",o):"	";for(let c=i;c<=n;c++){const d=e.getLineContent(c);let u=Je(d);if(!(this._opts.isUnshift&&(d.length===0||u===0))&&!(!l&&!this._opts.isUnshift&&d.length===0)&&(u===-1&&(u=d.length),!(this._opts.isUnshift&&u===0)))if(this._opts.isUnshift){u=Math.min(u,o);for(let g=0;g<u;g++)if(d.charCodeAt(g)===9){u=g+1;break}this._addEditOperation(t,new v(c,1,c,u+1),"")}else this._addEditOperation(t,new v(c,1,c,1),h),c===i&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn===1)}}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){if(this._useLastEditRangeForCursorEndPosition){const n=t.getInverseEditOperations()[0];return new te(n.range.endLineNumber,n.range.endColumn,n.range.endLineNumber,n.range.endColumn)}const i=t.getTrackedSelection(this._selectionId);if(this._selectionStartColumnStaysPut){const n=this._selection.startColumn;return i.startColumn<=n?i:i.getDirection()===0?new te(i.startLineNumber,n,i.endLineNumber,i.endColumn):new te(i.endLineNumber,i.endColumn,i.startLineNumber,n)}return i}};qi=To=eS([tS(2,Ys)],qi);class iS{constructor(e,t,i){this._range=e,this._charBeforeSelection=t,this._charAfterSelection=i}getEditOperations(e,t){t.addTrackedEditOperation(new v(this._range.startLineNumber,this._range.startColumn,this._range.startLineNumber,this._range.startColumn),this._charBeforeSelection),t.addTrackedEditOperation(new v(this._range.endLineNumber,this._range.endColumn,this._range.endLineNumber,this._range.endColumn),this._charAfterSelection)}computeCursorState(e,t){const i=t.getInverseEditOperations(),n=i[0].range,s=i[1].range;return new te(n.endLineNumber,n.endColumn,s.endLineNumber,s.endColumn-this._charAfterSelection.length)}}class nS{constructor(e,t,i){this._position=e,this._text=t,this._charAfter=i}getEditOperations(e,t){t.addTrackedEditOperation(new v(this._position.lineNumber,this._position.column,this._position.lineNumber,this._position.column),this._text+this._charAfter)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return new te(n.endLineNumber,n.startColumn,n.endLineNumber,n.endColumn-this._charAfter.length)}}function sS(a,e,t){const i=a.tokenization.getLanguageIdAtPosition(e,0);if(e>1){let n,s=-1;for(n=e-1;n>=1;n--){if(a.tokenization.getLanguageIdAtPosition(n,0)!==i)return s;const o=a.getLineContent(n);if(t.shouldIgnore(n)||/^\s+$/.test(o)||o===""){s=n;continue}return n}}return-1}function ir(a,e,t,i=!0,n){if(a<4)return null;const s=n.getLanguageConfiguration(e.tokenization.getLanguageId()).indentRulesSupport;if(!s)return null;const o=new Jv(e,s,n);if(t<=1)return{indentation:"",action:null};for(let l=t-1;l>0&&e.getLineContent(l)==="";l--)if(l===1)return{indentation:"",action:null};const r=sS(e,t,o);if(r<0)return null;if(r<1)return{indentation:"",action:null};if(o.shouldIncrease(r)||o.shouldIndentNextLine(r)){const l=e.getLineContent(r);return{indentation:Fe(l),action:Ve.Indent,line:r}}else if(o.shouldDecrease(r)){const l=e.getLineContent(r);return{indentation:Fe(l),action:null,line:r}}else{if(r===1)return{indentation:Fe(e.getLineContent(r)),action:null,line:r};const l=r-1,h=s.getIndentMetadata(e.getLineContent(l));if(!(h&3)&&h&4){let c=0;for(let d=l-1;d>0;d--)if(!o.shouldIndentNextLine(d)){c=d;break}return{indentation:Fe(e.getLineContent(c+1)),action:null,line:c+1}}if(i)return{indentation:Fe(e.getLineContent(r)),action:null,line:r};for(let c=r;c>0;c--){if(o.shouldIncrease(c))return{indentation:Fe(e.getLineContent(c)),action:Ve.Indent,line:c};if(o.shouldIndentNextLine(c)){let d=0;for(let u=c-1;u>0;u--)if(!o.shouldIndentNextLine(c)){d=u;break}return{indentation:Fe(e.getLineContent(d+1)),action:null,line:d+1}}else if(o.shouldDecrease(c))return{indentation:Fe(e.getLineContent(c)),action:null,line:c}}return{indentation:Fe(e.getLineContent(1)),action:null,line:1}}}function oS(a,e,t,i,n){if(a<4)return null;const s=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),o=n.getLanguageConfiguration(s).indentRulesSupport;if(!o)return null;e.tokenization.forceTokenization(t.startLineNumber);const l=new hh(e,n).getProcessedTokenContextAroundRange(t),h=l.afterRangeProcessedTokens,c=l.beforeRangeProcessedTokens,d=Fe(c.getLineContent()),u=aS(e,t.startLineNumber,c),g=ch(e,t.getStartPosition()),f=e.getLineContent(t.startLineNumber),m=Fe(f),_=ir(a,u,t.startLineNumber+1,void 0,n);if(!_){const p=g?m:d;return{beforeEnter:p,afterEnter:p}}let C=g?m:_.indentation;return _.action===Ve.Indent&&(C=i.shiftIndent(C)),o.shouldDecrease(h.getLineContent())&&(C=i.unshiftIndent(C)),{beforeEnter:g?m:d,afterEnter:C}}function rS(a,e,t,i,n,s){const o=a.autoIndent;if(o<4||ch(e,t.getStartPosition()))return null;const l=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),h=s.getLanguageConfiguration(l).indentRulesSupport;if(!h)return null;const d=new hh(e,s).getProcessedTokenContextAroundRange(t),u=d.beforeRangeProcessedTokens.getLineContent(),g=d.afterRangeProcessedTokens.getLineContent(),f=u+g,m=u+i+g;if(!h.shouldDecrease(f)&&h.shouldDecrease(m)){const C=ir(o,e,t.startLineNumber,!1,s);if(!C)return null;let p=C.indentation;return C.action!==Ve.Indent&&(p=n.unshiftIndent(p)),p}const _=t.startLineNumber-1;if(_>0){const C=e.getLineContent(_);if(h.shouldIndentNextLine(C)&&h.shouldIncrease(m)){const p=ir(o,e,t.startLineNumber,!1,s),b=p==null?void 0:p.indentation;if(b!==void 0){const w=e.getLineContent(t.startLineNumber),L=Fe(w),y=n.shiftIndent(b)===L,N=/^\s*$/.test(f),x=a.autoClosingPairs.autoClosingPairsOpenByEnd.get(i),k=x&&x.length>0&&N;if(y&&k)return b}}}return null}function aS(a,e,t){return{tokenization:{getLineTokens:n=>n===e?t:a.tokenization.getLineTokens(n),getLanguageId:()=>a.getLanguageId(),getLanguageIdAtPosition:(n,s)=>a.getLanguageIdAtPosition(n,s)},getLineContent:n=>n===e?t.getLineContent():a.getLineContent(n)}}class lS{static getEdits(e,t,i,n,s){if(!s&&this._isAutoIndentType(e,t,i)){const o=[];for(const l of i){const h=this._findActualIndentationForSelection(e,t,l,n);if(h===null)return;o.push({selection:l,indentation:h})}const r=ul.getAutoClosingPairClose(e,t,i,n,!1);return this._getIndentationAndAutoClosingPairEdits(e,t,o,n,r)}}static _isAutoIndentType(e,t,i){if(e.autoIndent<4)return!1;for(let n=0,s=i.length;n<s;n++)if(!t.tokenization.isCheapToTokenize(i[n].getEndPosition().lineNumber))return!1;return!0}static _findActualIndentationForSelection(e,t,i,n){const s=rS(e,t,i,n,{shiftIndent:r=>fh(e,r),unshiftIndent:r=>nr(e,r)},e.languageConfigurationService);if(s===null)return null;const o=gu(t,i.startLineNumber,i.startColumn);return s===e.normalizeIndentation(o)?null:s}static _getIndentationAndAutoClosingPairEdits(e,t,i,n,s){const o=i.map(({selection:l,indentation:h})=>{if(s!==null){const c=this._getEditFromIndentationAndSelection(e,t,h,l,n,!1);return new bS(c,l,n,s)}else{const c=this._getEditFromIndentationAndSelection(e,t,h,l,n,!0);return bi(c.range,c.text,!1)}}),r={shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1};return new je(4,o,r)}static _getEditFromIndentationAndSelection(e,t,i,n,s,o=!0){const r=n.startLineNumber,l=t.getLineFirstNonWhitespaceColumn(r);let h=e.normalizeIndentation(i);if(l!==0){const d=t.getLineContent(r);h+=d.substring(l-1,n.startColumn-1)}return h+=o?s:"",{range:new v(r,1,n.endLineNumber,n.endColumn),text:h}}}class hS{static getEdits(e,t,i,n,s,o){if(vg(t,i,n,s,o))return this._runAutoClosingOvertype(e,n,o)}static _runAutoClosingOvertype(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const l=t[s].getPosition(),h=new v(l.lineNumber,l.column,l.lineNumber,l.column+1);n[s]=new Ke(h,i)}return new je(4,n,{shouldPushStackElementBefore:Vr(e,4),shouldPushStackElementAfter:!1})}}class cS{static getEdits(e,t,i,n,s){if(vg(e,t,i,n,s)){const o=i.map(r=>new Ke(new v(r.positionLineNumber,r.positionColumn,r.positionLineNumber,r.positionColumn+1),"",!1));return new je(4,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}}class ul{static getEdits(e,t,i,n,s,o){if(!o){const r=this.getAutoClosingPairClose(e,t,i,n,s);if(r!==null)return this._runAutoClosingOpenCharType(i,n,s,r)}}static _runAutoClosingOpenCharType(e,t,i,n){const s=[];for(let o=0,r=e.length;o<r;o++){const l=e[o];s[o]=new CS(l,t,!i,n)}return new je(4,s,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}static getAutoClosingPairClose(e,t,i,n,s){for(const f of i)if(!f.isEmpty())return null;const o=i.map(f=>{const m=f.getPosition();return s?{lineNumber:m.lineNumber,beforeColumn:m.column-n.length,afterColumn:m.column}:{lineNumber:m.lineNumber,beforeColumn:m.column,afterColumn:m.column}}),r=this._findAutoClosingPairOpen(e,t,o.map(f=>new D(f.lineNumber,f.beforeColumn)),n);if(!r)return null;let l,h;if(ci(n)?(l=e.autoClosingQuotes,h=e.shouldAutoCloseBefore.quote):(e.blockCommentStartToken?r.open.includes(e.blockCommentStartToken):!1)?(l=e.autoClosingComments,h=e.shouldAutoCloseBefore.comment):(l=e.autoClosingBrackets,h=e.shouldAutoCloseBefore.bracket),l==="never")return null;const d=this._findContainedAutoClosingPair(e,r),u=d?d.close:"";let g=!0;for(const f of o){const{lineNumber:m,beforeColumn:_,afterColumn:C}=f,p=t.getLineContent(m),b=p.substring(0,_-1),w=p.substring(C-1);if(w.startsWith(u)||(g=!1),w.length>0){const N=w.charAt(0);if(!this._isBeforeClosingBrace(e,w)&&!h(N))return null}if(r.open.length===1&&(n==="'"||n==='"')&&l!=="always"){const N=Hn(e.wordSeparators,[]);if(b.length>0){const x=b.charCodeAt(b.length-1);if(N.get(x)===0)return null}}if(!t.tokenization.isCheapToTokenize(m))return null;t.tokenization.forceTokenization(m);const L=t.tokenization.getLineTokens(m),S=Ti(L,_-1);if(!r.shouldAutoClose(S,_-S.firstCharOffset))return null;const y=r.findNeutralCharacter();if(y){const N=t.tokenization.getTokenTypeIfInsertingCharacter(m,_,y);if(!r.isOK(N))return null}}return g?r.close.substring(0,r.close.length-u.length):r.close}static _findContainedAutoClosingPair(e,t){if(t.open.length<=1)return null;const i=t.close.charAt(t.close.length-1),n=e.autoClosingPairs.autoClosingPairsCloseByEnd.get(i)||[];let s=null;for(const o of n)o.open!==t.open&&t.open.includes(o.open)&&t.close.endsWith(o.close)&&(!s||o.open.length>s.open.length)&&(s=o);return s}static _findAutoClosingPairOpen(e,t,i,n){const s=e.autoClosingPairs.autoClosingPairsOpenByEnd.get(n);if(!s)return null;let o=null;for(const r of s)if(o===null||r.open.length>o.open.length){let l=!0;for(const h of i)if(t.getValueInRange(new v(h.lineNumber,h.column-r.open.length+1,h.lineNumber,h.column))+n!==r.open){l=!1;break}l&&(o=r)}return o}static _isBeforeClosingBrace(e,t){const i=t.charAt(0),n=e.autoClosingPairs.autoClosingPairsOpenByStart.get(i)||[],s=e.autoClosingPairs.autoClosingPairsCloseByStart.get(i)||[],o=n.some(l=>t.startsWith(l.open)),r=s.some(l=>t.startsWith(l.close));return!o&&r}}class dS{static getEdits(e,t,i,n,s){if(!s&&this._isSurroundSelectionType(e,t,i,n))return this._runSurroundSelectionType(e,i,n)}static _runSurroundSelectionType(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=e.surroundingPairs[i];n[s]=new iS(r,i,l)}return new je(0,n,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _isSurroundSelectionType(e,t,i,n){if(!Sg(e,n)||!e.surroundingPairs.hasOwnProperty(n))return!1;const s=ci(n);for(const o of i){if(o.isEmpty())return!1;let r=!0;for(let l=o.startLineNumber;l<=o.endLineNumber;l++){const h=t.getLineContent(l),c=l===o.startLineNumber?o.startColumn-1:0,d=l===o.endLineNumber?o.endColumn-1:h.length,u=h.substring(c,d);if(/[^ \t]/.test(u)){r=!1;break}}if(r)return!1;if(s&&o.startLineNumber===o.endLineNumber&&o.startColumn+1===o.endColumn){const l=t.getValueInRange(o);if(ci(l))return!1}}return!0}}class uS{static getEdits(e,t,i,n,s,o){if(!o&&this._isTypeInterceptorElectricChar(t,i,n)){const r=this._typeInterceptorElectricChar(e,t,i,n[0],s);if(r)return r}}static _isTypeInterceptorElectricChar(e,t,i){return!!(i.length===1&&t.tokenization.isCheapToTokenize(i[0].getEndPosition().lineNumber))}static _typeInterceptorElectricChar(e,t,i,n,s){if(!t.electricChars.hasOwnProperty(s)||!n.isEmpty())return null;const o=n.getPosition();i.tokenization.forceTokenization(o.lineNumber);const r=i.tokenization.getLineTokens(o.lineNumber);let l;try{l=t.onElectricCharacter(s,r,o.column)}catch(h){return Oe(h),null}if(!l)return null;if(l.matchOpenBracket){const h=(r.getLineContent()+s).lastIndexOf(l.matchOpenBracket)+1,c=i.bracketPairs.findMatchingBracketUp(l.matchOpenBracket,{lineNumber:o.lineNumber,column:h},500);if(c){if(c.startLineNumber===o.lineNumber)return null;const d=i.getLineContent(c.startLineNumber),u=Fe(d),g=t.normalizeIndentation(u),f=i.getLineContent(o.lineNumber),m=i.getLineFirstNonWhitespaceColumn(o.lineNumber)||o.column,_=f.substring(m-1,o.column-1),C=g+_+s,p=new v(o.lineNumber,1,o.lineNumber,o.column),b=new Ke(p,C);return new je(gh(C,e),[b],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!0})}}return null}}class gS{static getEdits(e,t,i){const n=[];for(let o=0,r=t.length;o<r;o++)n[o]=new Ke(t[o],i);const s=gh(i,e);return new je(s,n,{shouldPushStackElementBefore:Vr(e,s),shouldPushStackElementAfter:!1})}}class Lg{static getEdits(e,t,i,n,s){if(!s&&n===`
`){const o=[];for(let r=0,l=i.length;r<l;r++)o[r]=this._enter(e,t,!1,i[r]);return new je(4,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}static _enter(e,t,i,n){if(e.autoIndent===0)return bi(n,`
`,i);if(!t.tokenization.isCheapToTokenize(n.getStartPosition().lineNumber)||e.autoIndent===1){const l=t.getLineContent(n.startLineNumber),h=Fe(l).substring(0,n.startColumn-1);return bi(n,`
`+e.normalizeIndentation(h),i)}const s=dh(e.autoIndent,t,n,e.languageConfigurationService);if(s){if(s.indentAction===Ve.None)return bi(n,`
`+e.normalizeIndentation(s.indentation+s.appendText),i);if(s.indentAction===Ve.Indent)return bi(n,`
`+e.normalizeIndentation(s.indentation+s.appendText),i);if(s.indentAction===Ve.IndentOutdent){const l=e.normalizeIndentation(s.indentation),h=e.normalizeIndentation(s.indentation+s.appendText),c=`
`+h+`
`+l;return i?new ko(n,c,!0):new er(n,c,-1,h.length-l.length,!0)}else if(s.indentAction===Ve.Outdent){const l=nr(e,s.indentation);return bi(n,`
`+e.normalizeIndentation(l+s.appendText),i)}}const o=t.getLineContent(n.startLineNumber),r=Fe(o).substring(0,n.startColumn-1);if(e.autoIndent>=4){const l=oS(e.autoIndent,t,n,{unshiftIndent:h=>nr(e,h),shiftIndent:h=>fh(e,h),normalizeIndentation:h=>e.normalizeIndentation(h)},e.languageConfigurationService);if(l){let h=e.visibleColumnFromColumn(t,n.getEndPosition());const c=n.endColumn,d=t.getLineContent(n.endLineNumber),u=Je(d);if(u>=0?n=n.setEndPosition(n.endLineNumber,Math.max(n.endColumn,u+1)):n=n.setEndPosition(n.endLineNumber,t.getLineMaxColumn(n.endLineNumber)),i)return new ko(n,`
`+e.normalizeIndentation(l.afterEnter),!0);{let g=0;return c<=u+1&&(e.insertSpaces||(h=Math.ceil(h/e.indentSize)),g=Math.min(h+1-e.normalizeIndentation(l.afterEnter).length-1,0)),new er(n,`
`+e.normalizeIndentation(l.afterEnter),0,g,!0)}}}return bi(n,`
`+e.normalizeIndentation(r),i)}static lineInsertBefore(e,t,i){if(t===null||i===null)return[];const n=[];for(let s=0,o=i.length;s<o;s++){let r=i[s].positionLineNumber;if(r===1)n[s]=new ko(new v(1,1,1,1),`
`);else{r--;const l=t.getLineMaxColumn(r);n[s]=this._enter(e,t,!1,new v(r,l,r,l))}}return n}static lineInsertAfter(e,t,i){if(t===null||i===null)return[];const n=[];for(let s=0,o=i.length;s<o;s++){const r=i[s].positionLineNumber,l=t.getLineMaxColumn(r);n[s]=this._enter(e,t,!1,new v(r,l,r,l))}return n}static lineBreakInsert(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++)n[s]=this._enter(e,t,!0,i[s]);return n}}class fS{static getEdits(e,t,i,n,s,o){const r=this._distributePasteToCursors(e,i,n,s,o);return r?(i=i.sort(v.compareRangesUsingStarts),this._distributedPaste(e,t,i,r)):this._simplePaste(e,t,i,n,s)}static _distributePasteToCursors(e,t,i,n,s){if(n||t.length===1)return null;if(s&&s.length===t.length)return s;if(e.multiCursorPaste==="spread"){i.charCodeAt(i.length-1)===10&&(i=i.substring(0,i.length-1)),i.charCodeAt(i.length-1)===13&&(i=i.substring(0,i.length-1));const o=Vd(i);if(o.length===t.length)return o}return null}static _distributedPaste(e,t,i,n){const s=[];for(let o=0,r=i.length;o<r;o++)s[o]=new Ke(i[o],n[o]);return new je(0,s,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _simplePaste(e,t,i,n,s){const o=[];for(let r=0,l=i.length;r<l;r++){const h=i[r],c=h.getPosition();if(s&&!h.isEmpty()&&(s=!1),s&&n.indexOf(`
`)!==n.length-1&&(s=!1),s){const d=new v(c.lineNumber,1,c.lineNumber,1);o[r]=new Xv(d,n,h,!0)}else o[r]=new Ke(h,n)}return new je(0,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class mS{static getEdits(e,t,i,n,s,o,r,l){const h=n.map(c=>this._compositionType(i,c,s,o,r,l));return new je(4,h,{shouldPushStackElementBefore:Vr(e,4),shouldPushStackElementAfter:!1})}static _compositionType(e,t,i,n,s,o){if(!t.isEmpty())return null;const r=t.getPosition(),l=Math.max(1,r.column-n),h=Math.min(e.getLineMaxColumn(r.lineNumber),r.column+s),c=new v(r.lineNumber,l,r.lineNumber,h);return e.getValueInRange(c)===i&&o===0?null:new er(c,i,0,o)}}class pS{static getEdits(e,t,i){const n=[];for(let o=0,r=t.length;o<r;o++)n[o]=new Ke(t[o],i);const s=gh(i,e);return new je(s,n,{shouldPushStackElementBefore:Vr(e,s),shouldPushStackElementAfter:!1})}}class _S{static getCommands(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++){const r=i[s];if(r.isEmpty()){const l=t.getLineContent(r.startLineNumber);if(/^\s*$/.test(l)&&t.tokenization.isCheapToTokenize(r.startLineNumber)){let h=this._goodIndentForLine(e,t,r.startLineNumber);h=h||"	";const c=e.normalizeIndentation(h);if(!l.startsWith(c)){n[s]=new Ke(new v(r.startLineNumber,1,r.startLineNumber,l.length+1),c,!0);continue}}n[s]=this._replaceJumpToNextIndent(e,t,r,!0)}else{if(r.startLineNumber===r.endLineNumber){const l=t.getLineMaxColumn(r.startLineNumber);if(r.startColumn!==1||r.endColumn!==l){n[s]=this._replaceJumpToNextIndent(e,t,r,!1);continue}}n[s]=new qi(r,{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService)}}return n}static _goodIndentForLine(e,t,i){let n=null,s="";const o=ir(e.autoIndent,t,i,!1,e.languageConfigurationService);if(o)n=o.action,s=o.indentation;else if(i>1){let r;for(r=i-1;r>=1;r--){const c=t.getLineContent(r);if(Kn(c)>=0)break}if(r<1)return null;const l=t.getLineMaxColumn(r),h=dh(e.autoIndent,t,new v(r,l,r,l),e.languageConfigurationService);h&&(s=h.indentation+h.appendText)}return n&&(n===Ve.Indent&&(s=fh(e,s)),n===Ve.Outdent&&(s=nr(e,s)),s=e.normalizeIndentation(s)),s||null}static _replaceJumpToNextIndent(e,t,i,n){let s="";const o=i.getStartPosition();if(e.insertSpaces){const r=e.visibleColumnFromColumn(t,o),l=e.indentSize,h=l-r%l;for(let c=0;c<h;c++)s+=" "}else s="	";return new Ke(i,s,n)}}class uh extends er{constructor(e,t,i,n,s,o){super(e,t,i,n),this._openCharacter=s,this._closeCharacter=o,this.closeCharacterRange=null,this.enclosingRange=null}_computeCursorStateWithRange(e,t,i){return this.closeCharacterRange=new v(t.startLineNumber,t.endColumn-this._closeCharacter.length,t.endLineNumber,t.endColumn),this.enclosingRange=new v(t.startLineNumber,t.endColumn-this._openCharacter.length-this._closeCharacter.length,t.endLineNumber,t.endColumn),super.computeCursorState(e,i)}}class CS extends uh{constructor(e,t,i,n){const s=(i?t:"")+n,o=0,r=-n.length;super(e,s,o,r,t,n)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return this._computeCursorStateWithRange(e,n,t)}}class bS extends uh{constructor(e,t,i,n){const s=i+n,o=0,r=i.length;super(t,s,o,r,i,n),this._autoIndentationEdit=e,this._autoClosingEdit={range:t,text:s}}getEditOperations(e,t){t.addTrackedEditOperation(this._autoIndentationEdit.range,this._autoIndentationEdit.text),t.addTrackedEditOperation(this._autoClosingEdit.range,this._autoClosingEdit.text)}computeCursorState(e,t){const i=t.getInverseEditOperations();if(i.length!==2)throw new Error("There should be two inverse edit operations!");const n=i[0].range,s=i[1].range,o=n.plusRange(s);return this._computeCursorStateWithRange(e,o,t)}}function gh(a,e){return a===" "?e===5||e===6?6:5:4}function Vr(a,e){return Jc(a)&&!Jc(e)?!0:a===5?!1:Xc(a)!==Xc(e)}function Xc(a){return a===6||a===5?"space":a}function Jc(a){return a===4||a===5||a===6}function vg(a,e,t,i,n){if(a.autoClosingOvertype==="never"||!a.autoClosingPairs.autoClosingPairsCloseSingleChar.has(n))return!1;for(let s=0,o=t.length;s<o;s++){const r=t[s];if(!r.isEmpty())return!1;const l=r.getPosition(),h=e.getLineContent(l.lineNumber);if(h.charAt(l.column-1)!==n)return!1;const d=ci(n);if((l.column>2?h.charCodeAt(l.column-2):0)===92&&d)return!1;if(a.autoClosingOvertype==="auto"){let g=!1;for(let f=0,m=i.length;f<m;f++){const _=i[f];if(l.lineNumber===_.startLineNumber&&l.column===_.startColumn){g=!0;break}}if(!g)return!1}}return!0}function bi(a,e,t){return t?new ko(a,e,!0):new Ke(a,e,!0)}function fh(a,e,t){return t=t||1,qi.shiftIndent(e,e.length+t,a.tabSize,a.indentSize,a.insertSpaces)}function nr(a,e,t){return t=t||1,qi.unshiftIndent(e,e.length+t,a.tabSize,a.indentSize,a.insertSpaces)}function Sg(a,e){return ci(e)?a.autoSurround==="quotes"||a.autoSurround==="languageDefined":a.autoSurround==="brackets"||a.autoSurround==="languageDefined"}class Ii{static indent(e,t,i){if(t===null||i===null)return[];const n=[];for(let s=0,o=i.length;s<o;s++)n[s]=new qi(i[s],{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return n}static outdent(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++)n[s]=new qi(i[s],{isUnshift:!0,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return n}static paste(e,t,i,n,s,o){return fS.getEdits(e,t,i,n,s,o)}static tab(e,t,i){return _S.getCommands(e,t,i)}static compositionType(e,t,i,n,s,o,r,l){return mS.getEdits(e,t,i,n,s,o,r,l)}static compositionEndWithInterceptors(e,t,i,n,s,o){if(!n)return null;let r=null;for(const u of n)if(r===null)r=u.insertedText;else if(r!==u.insertedText)return null;if(!r||r.length!==1)return null;const l=r;let h=!1;for(const u of n)if(u.deletedText.length!==0){h=!0;break}if(h){if(!Sg(t,l)||!t.surroundingPairs.hasOwnProperty(l))return null;const u=ci(l);for(const m of n)if(m.deletedSelectionStart!==0||m.deletedSelectionEnd!==m.deletedText.length||/^[ \t]+$/.test(m.deletedText)||u&&ci(m.deletedText))return null;const g=[];for(const m of s){if(!m.isEmpty())return null;g.push(m.getPosition())}if(g.length!==n.length)return null;const f=[];for(let m=0,_=g.length;m<_;m++)f.push(new nS(g[m],n[m].deletedText,t.surroundingPairs[l]));return new je(4,f,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}const c=cS.getEdits(t,i,s,o,l);if(c!==void 0)return c;const d=ul.getEdits(t,i,s,l,!0,!1);return d!==void 0?d:null}static typeWithInterceptors(e,t,i,n,s,o,r){const l=Lg.getEdits(i,n,s,r,e);if(l!==void 0)return l;const h=lS.getEdits(i,n,s,r,e);if(h!==void 0)return h;const c=hS.getEdits(t,i,n,s,o,r);if(c!==void 0)return c;const d=ul.getEdits(i,n,s,r,!1,e);if(d!==void 0)return d;const u=dS.getEdits(i,n,s,r,e);if(u!==void 0)return u;const g=uS.getEdits(t,i,n,s,r,e);return g!==void 0?g:gS.getEdits(t,s,r)}static typeWithoutInterceptors(e,t,i,n,s){return pS.getEdits(e,n,s)}}class wS{constructor(e,t,i,n,s,o){this.deletedText=e,this.deletedSelectionStart=t,this.deletedSelectionEnd=i,this.insertedText=n,this.insertedSelectionStart=s,this.insertedSelectionEnd=o}}const $=0;class ae extends qd{runEditorCommand(e,t,i){const n=t._getViewModel();n&&this.runCoreEditorCommand(n,i||{})}}var xe;(function(a){const e=function(i){if(!Ir(i))return!1;const n=i;return!(!$i(n.to)||!Oi(n.by)&&!$i(n.by)||!Oi(n.value)&&!Gs(n.value)||!Oi(n.revealCursor)&&!Kd(n.revealCursor))};a.metadata={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},a.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function t(i){let n;switch(i.to){case a.RawDirection.Up:n=1;break;case a.RawDirection.Right:n=2;break;case a.RawDirection.Down:n=3;break;case a.RawDirection.Left:n=4;break;default:return null}let s;switch(i.by){case a.RawUnit.Line:s=1;break;case a.RawUnit.WrappedLine:s=2;break;case a.RawUnit.Page:s=3;break;case a.RawUnit.HalfPage:s=4;break;case a.RawUnit.Editor:s=5;break;case a.RawUnit.Column:s=6;break;default:s=2}const o=Math.floor(i.value||1),r=!!i.revealCursor;return{direction:n,unit:s,value:o,revealCursor:r,select:!!i.select}}a.parse=t})(xe||(xe={}));var mn;(function(a){const e=function(t){if(!Ir(t))return!1;const i=t;return!(!Gs(i.lineNumber)&&!$i(i.lineNumber)||!Oi(i.at)&&!$i(i.at))};a.metadata={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:e,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},a.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(mn||(mn={}));class gl{constructor(e){e.addImplementation(1e4,"code-editor",(t,i)=>{const n=t.get(Ao).getFocusedCodeEditor();return n&&n.hasTextFocus()?this._runEditorCommand(t,n,i):!1}),e.addImplementation(1e3,"generic-dom-input-textarea",(t,i)=>{const n=Ri();return n&&["input","textarea"].indexOf(n.tagName.toLowerCase())>=0?(this.runDOMCommand(n),!0):!1}),e.addImplementation(0,"generic-dom",(t,i)=>{const n=t.get(Ao).getActiveCodeEditor();return n?(n.focus(),this._runEditorCommand(t,n,i)):!1})}_runEditorCommand(e,t,i){const n=this.runEditorCommand(e,t,i);return n||!0}}var we;(function(a){class e extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){if(!b.position)return;p.model.pushStackElement(),p.setCursorStates(b.source,3,[ke.moveTo(p,p.getPrimaryCursorState(),this._inSelectionMode,b.position,b.viewPosition)])&&b.revealType!==2&&p.revealAllCursors(b.source,!0,!0)}}a.MoveTo=W(new e({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),a.MoveToSelect=W(new e({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class t extends ae{runCoreEditorCommand(p,b){p.model.pushStackElement();const w=this._getColumnSelectResult(p,p.getPrimaryCursorState(),p.getCursorColumnSelectData(),b);w!==null&&(p.setCursorStates(b.source,3,w.viewStates.map(L=>U.fromViewState(L))),p.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:w.fromLineNumber,fromViewVisualColumn:w.fromVisualColumn,toViewLineNumber:w.toLineNumber,toViewVisualColumn:w.toVisualColumn}),w.reversed?p.revealTopMostCursor(b.source):p.revealBottomMostCursor(b.source))}}a.ColumnSelect=W(new class extends t{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(C,p,b,w){if(typeof w.position>"u"||typeof w.viewPosition>"u"||typeof w.mouseColumn>"u")return null;const L=C.model.validatePosition(w.position),S=C.coordinatesConverter.validateViewPosition(new D(w.viewPosition.lineNumber,w.viewPosition.column),L),y=w.doColumnSelect?b.fromViewLineNumber:S.lineNumber,N=w.doColumnSelect?b.fromViewVisualColumn:w.mouseColumn-1;return Di.columnSelect(C.cursorConfig,C,y,N,S.lineNumber,w.mouseColumn-1)}}),a.CursorColumnSelectLeft=W(new class extends t{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3599,linux:{primary:0}}})}_getColumnSelectResult(C,p,b,w){return Di.columnSelectLeft(C.cursorConfig,C,b)}}),a.CursorColumnSelectRight=W(new class extends t{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3601,linux:{primary:0}}})}_getColumnSelectResult(C,p,b,w){return Di.columnSelectRight(C.cursorConfig,C,b)}});class i extends t{constructor(p){super(p),this._isPaged=p.isPaged}_getColumnSelectResult(p,b,w,L){return Di.columnSelectUp(p.cursorConfig,p,w,this._isPaged)}}a.CursorColumnSelectUp=W(new i({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3600,linux:{primary:0}}})),a.CursorColumnSelectPageUp=W(new i({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3595,linux:{primary:0}}}));class n extends t{constructor(p){super(p),this._isPaged=p.isPaged}_getColumnSelectResult(p,b,w,L){return Di.columnSelectDown(p.cursorConfig,p,w,this._isPaged)}}a.CursorColumnSelectDown=W(new n({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3602,linux:{primary:0}}})),a.CursorColumnSelectPageDown=W(new n({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3596,linux:{primary:0}}}));class s extends ae{constructor(){super({id:"cursorMove",precondition:void 0,metadata:tr.metadata})}runCoreEditorCommand(p,b){const w=tr.parse(b);w&&this._runCursorMove(p,b.source,w)}_runCursorMove(p,b,w){p.model.pushStackElement(),p.setCursorStates(b,3,s._move(p,p.getCursorStates(),w)),p.revealAllCursors(b,!0)}static _move(p,b,w){const L=w.select,S=w.value;switch(w.direction){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return ke.simpleMove(p,b,w.direction,L,S,w.unit);case 11:case 13:case 12:case 14:return ke.viewportMove(p,b,w.direction,L,S);default:return null}}}a.CursorMoveImpl=s,a.CursorMove=W(new s);class o extends ae{constructor(p){super(p),this._staticArgs=p.args}runCoreEditorCommand(p,b){let w=this._staticArgs;this._staticArgs.value===-1&&(w={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:b.pageSize||p.cursorConfig.pageSize}),p.model.pushStackElement(),p.setCursorStates(b.source,3,ke.simpleMove(p,p.getCursorStates(),w.direction,w.select,w.value,w.unit)),p.revealAllCursors(b.source,!0)}}a.CursorLeft=W(new o({args:{direction:0,unit:0,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:15,mac:{primary:15,secondary:[288]}}})),a.CursorLeftSelect=W(new o({args:{direction:0,unit:0,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1039}})),a.CursorRight=W(new o({args:{direction:1,unit:0,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:17,mac:{primary:17,secondary:[292]}}})),a.CursorRightSelect=W(new o({args:{direction:1,unit:0,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1041}})),a.CursorUp=W(new o({args:{direction:2,unit:2,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:16,mac:{primary:16,secondary:[302]}}})),a.CursorUpSelect=W(new o({args:{direction:2,unit:2,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1040,secondary:[3088],mac:{primary:1040},linux:{primary:1040}}})),a.CursorPageUp=W(new o({args:{direction:2,unit:2,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:11}})),a.CursorPageUpSelect=W(new o({args:{direction:2,unit:2,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1035}})),a.CursorDown=W(new o({args:{direction:3,unit:2,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:18,mac:{primary:18,secondary:[300]}}})),a.CursorDownSelect=W(new o({args:{direction:3,unit:2,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1042,secondary:[3090],mac:{primary:1042},linux:{primary:1042}}})),a.CursorPageDown=W(new o({args:{direction:3,unit:2,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:12}})),a.CursorPageDownSelect=W(new o({args:{direction:3,unit:2,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1036}})),a.CreateCursor=W(new class extends ae{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(C,p){if(!p.position)return;let b;p.wholeLine?b=ke.line(C,C.getPrimaryCursorState(),!1,p.position,p.viewPosition):b=ke.moveTo(C,C.getPrimaryCursorState(),!1,p.position,p.viewPosition);const w=C.getCursorStates();if(w.length>1){const L=b.modelState?b.modelState.position:null,S=b.viewState?b.viewState.position:null;for(let y=0,N=w.length;y<N;y++){const x=w[y];if(!(L&&!x.modelState.selection.containsPosition(L))&&!(S&&!x.viewState.selection.containsPosition(S))){w.splice(y,1),C.model.pushStackElement(),C.setCursorStates(p.source,3,w);return}}}w.push(b),C.model.pushStackElement(),C.setCursorStates(p.source,3,w)}}),a.LastCursorMoveToSelect=W(new class extends ae{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(C,p){if(!p.position)return;const b=C.getLastAddedCursorIndex(),w=C.getCursorStates(),L=w.slice(0);L[b]=ke.moveTo(C,w[b],!0,p.position,p.viewPosition),C.model.pushStackElement(),C.setCursorStates(p.source,3,L)}});class r extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){p.model.pushStackElement(),p.setCursorStates(b.source,3,ke.moveToBeginningOfLine(p,p.getCursorStates(),this._inSelectionMode)),p.revealAllCursors(b.source,!0)}}a.CursorHome=W(new r({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:14,mac:{primary:14,secondary:[2063]}}})),a.CursorHomeSelect=W(new r({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1038,mac:{primary:1038,secondary:[3087]}}}));class l extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){p.model.pushStackElement(),p.setCursorStates(b.source,3,this._exec(p.getCursorStates())),p.revealAllCursors(b.source,!0)}_exec(p){const b=[];for(let w=0,L=p.length;w<L;w++){const S=p[w],y=S.modelState.position.lineNumber;b[w]=U.fromModelState(S.modelState.move(this._inSelectionMode,y,1,0))}return b}}a.CursorLineStart=W(new l({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:0,mac:{primary:287}}})),a.CursorLineStartSelect=W(new l({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:0,mac:{primary:1311}}}));class h extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){p.model.pushStackElement(),p.setCursorStates(b.source,3,ke.moveToEndOfLine(p,p.getCursorStates(),this._inSelectionMode,b.sticky||!1)),p.revealAllCursors(b.source,!0)}}a.CursorEnd=W(new h({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:$,kbExpr:A.textInputFocus,primary:13,mac:{primary:13,secondary:[2065]}},metadata:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:I("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),a.CursorEndSelect=W(new h({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:$,kbExpr:A.textInputFocus,primary:1037,mac:{primary:1037,secondary:[3089]}},metadata:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:I("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class c extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){p.model.pushStackElement(),p.setCursorStates(b.source,3,this._exec(p,p.getCursorStates())),p.revealAllCursors(b.source,!0)}_exec(p,b){const w=[];for(let L=0,S=b.length;L<S;L++){const y=b[L],N=y.modelState.position.lineNumber,x=p.model.getLineMaxColumn(N);w[L]=U.fromModelState(y.modelState.move(this._inSelectionMode,N,x,0))}return w}}a.CursorLineEnd=W(new c({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:0,mac:{primary:291}}})),a.CursorLineEndSelect=W(new c({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:0,mac:{primary:1315}}}));class d extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){p.model.pushStackElement(),p.setCursorStates(b.source,3,ke.moveToBeginningOfBuffer(p,p.getCursorStates(),this._inSelectionMode)),p.revealAllCursors(b.source,!0)}}a.CursorTop=W(new d({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:2062,mac:{primary:2064}}})),a.CursorTopSelect=W(new d({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3086,mac:{primary:3088}}}));class u extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){p.model.pushStackElement(),p.setCursorStates(b.source,3,ke.moveToEndOfBuffer(p,p.getCursorStates(),this._inSelectionMode)),p.revealAllCursors(b.source,!0)}}a.CursorBottom=W(new u({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:2061,mac:{primary:2066}}})),a.CursorBottomSelect=W(new u({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:3085,mac:{primary:3090}}}));class g extends ae{constructor(){super({id:"editorScroll",precondition:void 0,metadata:xe.metadata})}determineScrollMethod(p){const b=[6],w=[1,2,3,4,5,6],L=[4,2],S=[1,3];return b.includes(p.unit)&&L.includes(p.direction)?this._runHorizontalEditorScroll.bind(this):w.includes(p.unit)&&S.includes(p.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(p,b){const w=xe.parse(b);if(!w)return;const L=this.determineScrollMethod(w);L&&L(p,b.source,w)}_runVerticalEditorScroll(p,b,w){const L=this._computeDesiredScrollTop(p,w);if(w.revealCursor){const S=p.getCompletelyVisibleViewRangeAtScrollTop(L);p.setCursorStates(b,3,[ke.findPositionInViewportIfOutside(p,p.getPrimaryCursorState(),S,w.select)])}p.viewLayout.setScrollPosition({scrollTop:L},0)}_computeDesiredScrollTop(p,b){if(b.unit===1){const S=p.viewLayout.getFutureViewport(),y=p.getCompletelyVisibleViewRangeAtScrollTop(S.top),N=p.coordinatesConverter.convertViewRangeToModelRange(y);let x;b.direction===1?x=Math.max(1,N.startLineNumber-b.value):x=Math.min(p.model.getLineCount(),N.startLineNumber+b.value);const R=p.coordinatesConverter.convertModelPositionToViewPosition(new D(x,1));return p.viewLayout.getVerticalOffsetForLineNumber(R.lineNumber)}if(b.unit===5){let S=0;return b.direction===3&&(S=p.model.getLineCount()-p.cursorConfig.pageSize),p.viewLayout.getVerticalOffsetForLineNumber(S)}let w;b.unit===3?w=p.cursorConfig.pageSize*b.value:b.unit===4?w=Math.round(p.cursorConfig.pageSize/2)*b.value:w=b.value;const L=(b.direction===1?-1:1)*w;return p.viewLayout.getCurrentScrollTop()+L*p.cursorConfig.lineHeight}_runHorizontalEditorScroll(p,b,w){const L=this._computeDesiredScrollLeft(p,w);p.viewLayout.setScrollPosition({scrollLeft:L},0)}_computeDesiredScrollLeft(p,b){const w=(b.direction===4?-1:1)*b.value;return p.viewLayout.getCurrentScrollLeft()+w*p.cursorConfig.typicalHalfwidthCharacterWidth}}a.EditorScrollImpl=g,a.EditorScroll=W(new g),a.ScrollLineUp=W(new class extends ae{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:2064,mac:{primary:267}}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Up,by:xe.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollPageUp=W(new class extends ae{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:2059,win:{primary:523},linux:{primary:523}}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Up,by:xe.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollEditorTop=W(new class extends ae{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Up,by:xe.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollLineDown=W(new class extends ae{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:2066,mac:{primary:268}}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Down,by:xe.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollPageDown=W(new class extends ae{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:2060,win:{primary:524},linux:{primary:524}}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Down,by:xe.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollEditorBottom=W(new class extends ae{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Down,by:xe.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollLeft=W(new class extends ae{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Left,by:xe.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollRight=W(new class extends ae{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus}})}runCoreEditorCommand(C,p){a.EditorScroll.runCoreEditorCommand(C,{to:xe.RawDirection.Right,by:xe.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:p.source})}});class f extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){b.position&&(p.model.pushStackElement(),p.setCursorStates(b.source,3,[ke.word(p,p.getPrimaryCursorState(),this._inSelectionMode,b.position)]),b.revealType!==2&&p.revealAllCursors(b.source,!0,!0))}}a.WordSelect=W(new f({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),a.WordSelectDrag=W(new f({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),a.LastCursorWordSelect=W(new class extends ae{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(C,p){if(!p.position)return;const b=C.getLastAddedCursorIndex(),w=C.getCursorStates(),L=w.slice(0),S=w[b];L[b]=ke.word(C,S,S.modelState.hasSelection(),p.position),C.model.pushStackElement(),C.setCursorStates(p.source,3,L)}});class m extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){b.position&&(p.model.pushStackElement(),p.setCursorStates(b.source,3,[ke.line(p,p.getPrimaryCursorState(),this._inSelectionMode,b.position,b.viewPosition)]),b.revealType!==2&&p.revealAllCursors(b.source,!1,!0))}}a.LineSelect=W(new m({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),a.LineSelectDrag=W(new m({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class _ extends ae{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,b){if(!b.position)return;const w=p.getLastAddedCursorIndex(),L=p.getCursorStates(),S=L.slice(0);S[w]=ke.line(p,L[w],this._inSelectionMode,b.position,b.viewPosition),p.model.pushStackElement(),p.setCursorStates(b.source,3,S)}}a.LastCursorLineSelect=W(new _({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),a.LastCursorLineSelectDrag=W(new _({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),a.CancelSelection=W(new class extends ae{constructor(){super({id:"cancelSelection",precondition:A.hasNonEmptySelection,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(C,p){C.model.pushStackElement(),C.setCursorStates(p.source,3,[ke.cancelSelection(C,C.getPrimaryCursorState())]),C.revealAllCursors(p.source,!0)}}),a.RemoveSecondaryCursors=W(new class extends ae{constructor(){super({id:"removeSecondaryCursors",precondition:A.hasMultipleSelections,kbOpts:{weight:$+1,kbExpr:A.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(C,p){C.model.pushStackElement(),C.setCursorStates(p.source,3,[C.getPrimaryCursorState()]),C.revealAllCursors(p.source,!0),Oa(I("removedCursor","Removed secondary cursors"))}}),a.RevealLine=W(new class extends ae{constructor(){super({id:"revealLine",precondition:void 0,metadata:mn.metadata})}runCoreEditorCommand(C,p){const b=p,w=b.lineNumber||0;let L=typeof w=="number"?w+1:parseInt(w)+1;L<1&&(L=1);const S=C.model.getLineCount();L>S&&(L=S);const y=new v(L,1,L,C.model.getLineMaxColumn(L));let N=0;if(b.at)switch(b.at){case mn.RawAtArgument.Top:N=3;break;case mn.RawAtArgument.Center:N=1;break;case mn.RawAtArgument.Bottom:N=4;break}const x=C.coordinatesConverter.convertModelRangeToViewRange(y);C.revealRange(p.source,!1,x,N,0)}}),a.SelectAll=new class extends gl{constructor(){super(Df)}runDOMCommand(C){oi&&(C.focus(),C.select()),C.ownerDocument.execCommand("selectAll")}runEditorCommand(C,p,b){const w=p._getViewModel();w&&this.runCoreEditorCommand(w,b)}runCoreEditorCommand(C,p){C.model.pushStackElement(),C.setCursorStates("keyboard",3,[ke.selectAll(C,C.getPrimaryCursorState())])}},a.SetSelection=W(new class extends ae{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(C,p){p.selection&&(C.model.pushStackElement(),C.setCursorStates(p.source,3,[U.fromModelSelection(p.selection)]))}})})(we||(we={}));const LS=Ia.and(A.textInputFocus,A.columnSelection);function Qn(a,e){Tf.registerKeybindingRule({id:a,primary:e,when:LS,weight:$+1})}Qn(we.CursorColumnSelectLeft.id,1039);Qn(we.CursorColumnSelectRight.id,1041);Qn(we.CursorColumnSelectUp.id,1040);Qn(we.CursorColumnSelectPageUp.id,1035);Qn(we.CursorColumnSelectDown.id,1042);Qn(we.CursorColumnSelectPageDown.id,1036);function ed(a){return a.register(),a}var td;(function(a){class e extends qd{runEditorCommand(i,n,s){const o=n._getViewModel();o&&this.runCoreEditingCommand(n,o,s||{})}}a.CoreEditingCommand=e,a.LineBreakInsert=W(new class extends e{constructor(){super({id:"lineBreakInsert",precondition:A.writable,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:0,mac:{primary:301}}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Lg.lineBreakInsert(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection)))}}),a.Outdent=W(new class extends e{constructor(){super({id:"outdent",precondition:A.writable,kbOpts:{weight:$,kbExpr:Ia.and(A.editorTextFocus,A.tabDoesNotMoveFocus),primary:1026}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Ii.outdent(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),a.Tab=W(new class extends e{constructor(){super({id:"tab",precondition:A.writable,kbOpts:{weight:$,kbExpr:Ia.and(A.editorTextFocus,A.tabDoesNotMoveFocus),primary:2}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Ii.tab(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),a.DeleteLeft=W(new class extends e{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:1,secondary:[1025],mac:{primary:1,secondary:[1025,294,257]}}})}runCoreEditingCommand(t,i,n){const[s,o]=Ki.deleteLeft(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection),i.getCursorAutoClosedCharacters());s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(2)}}),a.DeleteRight=W(new class extends e{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:$,kbExpr:A.textInputFocus,primary:20,mac:{primary:20,secondary:[290,276]}}})}runCoreEditingCommand(t,i,n){const[s,o]=Ki.deleteRight(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection));s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(3)}}),a.Undo=new class extends gl{constructor(){super(If)}runDOMCommand(t){t.ownerDocument.execCommand("undo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(92)===!0))return i.getModel().undo()}},a.Redo=new class extends gl{constructor(){super(kf)}runDOMCommand(t){t.ownerDocument.execCommand("redo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(92)===!0))return i.getModel().redo()}}})(td||(td={}));class id extends Ef{constructor(e,t,i){super({id:e,precondition:void 0,metadata:i}),this._handlerId=t}runCommand(e,t){const i=e.get(Ao).getFocusedCodeEditor();i&&i.trigger("keyboard",this._handlerId,t)}}function Xi(a,e){ed(new id("default:"+a,a)),ed(new id(a,a,e))}Xi("type",{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]});Xi("replacePreviousChar");Xi("compositionType");Xi("compositionStart");Xi("compositionEnd");Xi("paste");Xi("cut");class vS{constructor(e,t,i,n){this.configuration=e,this.viewModel=t,this.userInputEvents=i,this.commandDelegate=n}paste(e,t,i,n){this.commandDelegate.paste(e,t,i,n)}type(e){this.commandDelegate.type(e)}compositionType(e,t,i,n){this.commandDelegate.compositionType(e,t,i,n)}compositionStart(){this.commandDelegate.startComposition()}compositionEnd(){this.commandDelegate.endComposition()}cut(){this.commandDelegate.cut()}setSelection(e){we.SetSelection.runCoreEditorCommand(this.viewModel,{source:"keyboard",selection:e})}_validateViewColumn(e){const t=this.viewModel.getLineMinColumn(e.lineNumber);return e.column<t?new D(e.lineNumber,t):e}_hasMulticursorModifier(e){switch(this.configuration.options.get(78)){case"altKey":return e.altKey;case"ctrlKey":return e.ctrlKey;case"metaKey":return e.metaKey;default:return!1}}_hasNonMulticursorModifier(e){switch(this.configuration.options.get(78)){case"altKey":return e.ctrlKey||e.metaKey;case"ctrlKey":return e.altKey||e.metaKey;case"metaKey":return e.ctrlKey||e.altKey;default:return!1}}dispatchMouse(e){const t=this.configuration.options,i=Zs&&t.get(108),n=t.get(22);e.middleButton&&!i?this._columnSelect(e.position,e.mouseColumn,e.inSelectionMode):e.startedOnLineNumbers?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelect(e.position,e.revealType):this._createCursor(e.position,!0):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount>=4?this._selectAll():e.mouseDownCount===3?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelectDrag(e.position,e.revealType):this._lastCursorLineSelect(e.position,e.revealType):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount===2?e.onInjectedText||(this._hasMulticursorModifier(e)?this._lastCursorWordSelect(e.position,e.revealType):e.inSelectionMode?this._wordSelectDrag(e.position,e.revealType):this._wordSelect(e.position,e.revealType)):this._hasMulticursorModifier(e)?this._hasNonMulticursorModifier(e)||(e.shiftKey?this._columnSelect(e.position,e.mouseColumn,!0):e.inSelectionMode?this._lastCursorMoveToSelect(e.position,e.revealType):this._createCursor(e.position,!1)):e.inSelectionMode?e.altKey?this._columnSelect(e.position,e.mouseColumn,!0):n?this._columnSelect(e.position,e.mouseColumn,!0):this._moveToSelect(e.position,e.revealType):this.moveTo(e.position,e.revealType)}_usualArgs(e,t){return e=this._validateViewColumn(e),{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,revealType:t}}moveTo(e,t){we.MoveTo.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_moveToSelect(e,t){we.MoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_columnSelect(e,t,i){e=this._validateViewColumn(e),we.ColumnSelect.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,mouseColumn:t,doColumnSelect:i})}_createCursor(e,t){e=this._validateViewColumn(e),we.CreateCursor.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,wholeLine:t})}_lastCursorMoveToSelect(e,t){we.LastCursorMoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelect(e,t){we.WordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelectDrag(e,t){we.WordSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorWordSelect(e,t){we.LastCursorWordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelect(e,t){we.LineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelectDrag(e,t){we.LineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelect(e,t){we.LastCursorLineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelectDrag(e,t){we.LastCursorLineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_selectAll(){we.SelectAll.runCoreEditorCommand(this.viewModel,{source:"mouse"})}_convertViewToModelPosition(e){return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(e)}emitKeyDown(e){this.userInputEvents.emitKeyDown(e)}emitKeyUp(e){this.userInputEvents.emitKeyUp(e)}emitContextMenu(e){this.userInputEvents.emitContextMenu(e)}emitMouseMove(e){this.userInputEvents.emitMouseMove(e)}emitMouseLeave(e){this.userInputEvents.emitMouseLeave(e)}emitMouseUp(e){this.userInputEvents.emitMouseUp(e)}emitMouseDown(e){this.userInputEvents.emitMouseDown(e)}emitMouseDrag(e){this.userInputEvents.emitMouseDrag(e)}emitMouseDrop(e){this.userInputEvents.emitMouseDrop(e)}emitMouseDropCanceled(){this.userInputEvents.emitMouseDropCanceled()}emitMouseWheel(e){this.userInputEvents.emitMouseWheel(e)}}class xg{constructor(e){this._lineFactory=e,this._set(1,[])}flush(){this._set(1,[])}_set(e,t){this._lines=t,this._rendLineNumberStart=e}_get(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}}getStartLineNumber(){return this._rendLineNumberStart}getEndLineNumber(){return this._rendLineNumberStart+this._lines.length-1}getCount(){return this._lines.length}getLine(e){const t=e-this._rendLineNumberStart;if(t<0||t>=this._lines.length)throw new fe("Illegal value for lineNumber");return this._lines[t]}onLinesDeleted(e,t){if(this.getCount()===0)return null;const i=this.getStartLineNumber(),n=this.getEndLineNumber();if(t<i){const l=t-e+1;return this._rendLineNumberStart-=l,null}if(e>n)return null;let s=0,o=0;for(let l=i;l<=n;l++){const h=l-this._rendLineNumberStart;e<=l&&l<=t&&(o===0?(s=h,o=1):o++)}if(e<i){let l=0;t<i?l=t-e+1:l=i-e,this._rendLineNumberStart-=l}return this._lines.splice(s,o)}onLinesChanged(e,t){const i=e+t-1;if(this.getCount()===0)return!1;const n=this.getStartLineNumber(),s=this.getEndLineNumber();let o=!1;for(let r=e;r<=i;r++)r>=n&&r<=s&&(this._lines[r-this._rendLineNumberStart].onContentChanged(),o=!0);return o}onLinesInserted(e,t){if(this.getCount()===0)return null;const i=t-e+1,n=this.getStartLineNumber(),s=this.getEndLineNumber();if(e<=n)return this._rendLineNumberStart+=i,null;if(e>s)return null;if(i+e>s)return this._lines.splice(e-this._rendLineNumberStart,s-e+1);const o=[];for(let d=0;d<i;d++)o[d]=this._lineFactory.createLine();const r=e-this._rendLineNumberStart,l=this._lines.slice(0,r),h=this._lines.slice(r,this._lines.length-i),c=this._lines.slice(this._lines.length-i,this._lines.length);return this._lines=l.concat(o).concat(h),c}onTokensChanged(e){if(this.getCount()===0)return!1;const t=this.getStartLineNumber(),i=this.getEndLineNumber();let n=!1;for(let s=0,o=e.length;s<o;s++){const r=e[s];if(r.toLineNumber<t||r.fromLineNumber>i)continue;const l=Math.max(t,r.fromLineNumber),h=Math.min(i,r.toLineNumber);for(let c=l;c<=h;c++){const d=c-this._rendLineNumberStart;this._lines[d].onTokensChanged(),n=!0}}return n}}class yg{constructor(e){this._lineFactory=e,this.domNode=this._createDomNode(),this._linesCollection=new xg(this._lineFactory)}_createDomNode(){const e=Q(document.createElement("div"));return e.setClassName("view-layer"),e.setPosition("absolute"),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e}onConfigurationChanged(e){return!!e.hasChanged(146)}onFlushed(e){return this._linesCollection.flush(),!0}onLinesChanged(e){return this._linesCollection.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){const t=this._linesCollection.onLinesDeleted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++){const s=t[i].getDomNode();s==null||s.remove()}return!0}onLinesInserted(e){const t=this._linesCollection.onLinesInserted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++){const s=t[i].getDomNode();s==null||s.remove()}return!0}onScrollChanged(e){return e.scrollTopChanged}onTokensChanged(e){return this._linesCollection.onTokensChanged(e.ranges)}onZonesChanged(e){return!0}getStartLineNumber(){return this._linesCollection.getStartLineNumber()}getEndLineNumber(){return this._linesCollection.getEndLineNumber()}getVisibleLine(e){return this._linesCollection.getLine(e)}renderLines(e){const t=this._linesCollection._get(),i=new fl(this.domNode.domNode,this._lineFactory,e),n={rendLineNumberStart:t.rendLineNumberStart,lines:t.lines,linesLength:t.lines.length},s=i.render(n,e.startLineNumber,e.endLineNumber,e.relativeVerticalOffset);this._linesCollection._set(s.rendLineNumberStart,s.lines)}}const Ft=class Ft{constructor(e,t,i){this._domNode=e,this._lineFactory=t,this._viewportData=i}render(e,t,i,n){const s={rendLineNumberStart:e.rendLineNumberStart,lines:e.lines.slice(0),linesLength:e.linesLength};if(s.rendLineNumberStart+s.linesLength-1<t||i<s.rendLineNumberStart){s.rendLineNumberStart=t,s.linesLength=i-t+1,s.lines=[];for(let o=t;o<=i;o++)s.lines[o-t]=this._lineFactory.createLine();return this._finishRendering(s,!0,n),s}if(this._renderUntouchedLines(s,Math.max(t-s.rendLineNumberStart,0),Math.min(i-s.rendLineNumberStart,s.linesLength-1),n,t),s.rendLineNumberStart>t){const o=t,r=Math.min(i,s.rendLineNumberStart-1);o<=r&&(this._insertLinesBefore(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart<t){const o=Math.min(s.linesLength,t-s.rendLineNumberStart);o>0&&(this._removeLinesBefore(s,o),s.linesLength-=o)}if(s.rendLineNumberStart=t,s.rendLineNumberStart+s.linesLength-1<i){const o=s.rendLineNumberStart+s.linesLength,r=i;o<=r&&(this._insertLinesAfter(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart+s.linesLength-1>i){const o=Math.max(0,i-s.rendLineNumberStart+1),l=s.linesLength-1-o+1;l>0&&(this._removeLinesAfter(s,l),s.linesLength-=l)}return this._finishRendering(s,!1,n),s}_renderUntouchedLines(e,t,i,n,s){const o=e.rendLineNumberStart,r=e.lines;for(let l=t;l<=i;l++){const h=o+l;r[l].layoutLine(h,n[h-s],this._viewportData.lineHeight)}}_insertLinesBefore(e,t,i,n,s){const o=[];let r=0;for(let l=t;l<=i;l++)o[r++]=this._lineFactory.createLine();e.lines=o.concat(e.lines)}_removeLinesBefore(e,t){for(let i=0;i<t;i++){const n=e.lines[i].getDomNode();n==null||n.remove()}e.lines.splice(0,t)}_insertLinesAfter(e,t,i,n,s){const o=[];let r=0;for(let l=t;l<=i;l++)o[r++]=this._lineFactory.createLine();e.lines=e.lines.concat(o)}_removeLinesAfter(e,t){const i=e.linesLength-t;for(let n=0;n<t;n++){const s=e.lines[i+n].getDomNode();s==null||s.remove()}e.lines.splice(i,t)}_finishRenderingNewLines(e,t,i,n){Ft._ttPolicy&&(i=Ft._ttPolicy.createHTML(i));const s=this._domNode.lastChild;t||!s?this._domNode.innerHTML=i:s.insertAdjacentHTML("afterend",i);let o=this._domNode.lastChild;for(let r=e.linesLength-1;r>=0;r--){const l=e.lines[r];n[r]&&(l.setDomNode(o),o=o.previousSibling)}}_finishRenderingInvalidLines(e,t,i){const n=document.createElement("div");Ft._ttPolicy&&(t=Ft._ttPolicy.createHTML(t)),n.innerHTML=t;for(let s=0;s<e.linesLength;s++){const o=e.lines[s];if(i[s]){const r=n.firstChild,l=o.getDomNode();l.parentNode.replaceChild(r,l),o.setDomNode(r)}}}_finishRendering(e,t,i){const n=Ft._sb,s=e.linesLength,o=e.lines,r=e.rendLineNumberStart,l=[];{n.reset();let h=!1;for(let c=0;c<s;c++){const d=o[c];l[c]=!1,!(d.getDomNode()||!d.renderLine(c+r,i[c],this._viewportData.lineHeight,this._viewportData,n))&&(l[c]=!0,h=!0)}h&&this._finishRenderingNewLines(e,t,n.build(),l)}{n.reset();let h=!1;const c=[];for(let d=0;d<s;d++){const u=o[d];c[d]=!1,!(l[d]||!u.renderLine(d+r,i[d],this._viewportData.lineHeight,this._viewportData,n))&&(c[d]=!0,h=!0)}h&&this._finishRenderingInvalidLines(e,n.build(),c)}}};Ft._ttPolicy=au("editorViewLayer",{createHTML:e=>e}),Ft._sb=new Pl(1e5);let fl=Ft;class Ng extends Ye{constructor(e){super(e),this._dynamicOverlays=[],this._isFocused=!1,this._visibleLines=new yg({createLine:()=>new SS(this._dynamicOverlays)}),this.domNode=this._visibleLines.domNode;const i=this._context.configuration.options.get(50);qe(this.domNode,i),this.domNode.setClassName("view-overlays")}shouldRender(){if(super.shouldRender())return!0;for(let e=0,t=this._dynamicOverlays.length;e<t;e++)if(this._dynamicOverlays[e].shouldRender())return!0;return!1}dispose(){super.dispose();for(let e=0,t=this._dynamicOverlays.length;e<t;e++)this._dynamicOverlays[e].dispose();this._dynamicOverlays=[]}getDomNode(){return this.domNode}addDynamicOverlay(e){this._dynamicOverlays.push(e)}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e);const i=this._context.configuration.options.get(50);return qe(this.domNode,i),!0}onFlushed(e){return this._visibleLines.onFlushed(e)}onFocusChanged(e){return this._isFocused=e.isFocused,!0}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onScrollChanged(e){return this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._visibleLines.onZonesChanged(e)}prepareRender(e){const t=this._dynamicOverlays.filter(i=>i.shouldRender());for(let i=0,n=t.length;i<n;i++){const s=t[i];s.prepareRender(e),s.onDidRender()}}render(e){this._viewOverlaysRender(e),this.domNode.toggleClassName("focused",this._isFocused)}_viewOverlaysRender(e){this._visibleLines.renderLines(e.viewportData)}}class SS{constructor(e){this._dynamicOverlays=e,this._domNode=null,this._renderedContent=null}getDomNode(){return this._domNode?this._domNode.domNode:null}setDomNode(e){this._domNode=Q(e)}onContentChanged(){}onTokensChanged(){}renderLine(e,t,i,n,s){let o="";for(let r=0,l=this._dynamicOverlays.length;r<l;r++){const h=this._dynamicOverlays[r];o+=h.render(n.startLineNumber,e)}return this._renderedContent===o?!1:(this._renderedContent=o,s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString('px;">'),s.appendString(o),s.appendString("</div>"),!0)}layoutLine(e,t,i){this._domNode&&(this._domNode.setTop(t),this._domNode.setHeight(i))}}class xS extends Ng{constructor(e){super(e);const i=this._context.configuration.options.get(146);this._contentWidth=i.contentWidth,this.domNode.setHeight(0)}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._contentWidth=i.contentWidth,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollWidthChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e),this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth))}}class yS extends Ng{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._contentLeft=i.contentLeft,this.domNode.setClassName("margin-view-overlays"),this.domNode.setWidth(1),qe(this.domNode,t.get(50))}onConfigurationChanged(e){const t=this._context.configuration.options;qe(this.domNode,t.get(50));const i=t.get(146);return this._contentLeft=i.contentLeft,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollHeightChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e);const t=Math.min(e.scrollHeight,1e6);this.domNode.setHeight(t),this.domNode.setWidth(this._contentLeft)}}class Hr{constructor(e){this.onKeyDown=null,this.onKeyUp=null,this.onContextMenu=null,this.onMouseMove=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseDrag=null,this.onMouseDrop=null,this.onMouseDropCanceled=null,this.onMouseWheel=null,this._coordinatesConverter=e}emitKeyDown(e){var t;(t=this.onKeyDown)==null||t.call(this,e)}emitKeyUp(e){var t;(t=this.onKeyUp)==null||t.call(this,e)}emitContextMenu(e){var t;(t=this.onContextMenu)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseMove(e){var t;(t=this.onMouseMove)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseLeave(e){var t;(t=this.onMouseLeave)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDown(e){var t;(t=this.onMouseDown)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseUp(e){var t;(t=this.onMouseUp)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrag(e){var t;(t=this.onMouseDrag)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrop(e){var t;(t=this.onMouseDrop)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDropCanceled(){var e;(e=this.onMouseDropCanceled)==null||e.call(this)}emitMouseWheel(e){var t;(t=this.onMouseWheel)==null||t.call(this,e)}_convertViewToModelMouseEvent(e){return e.target?{event:e.event,target:this._convertViewToModelMouseTarget(e.target)}:e}_convertViewToModelMouseTarget(e){return Hr.convertViewToModelMouseTarget(e,this._coordinatesConverter)}static convertViewToModelMouseTarget(e,t){const i={...e};return i.position&&(i.position=t.convertViewPositionToModelPosition(i.position)),i.range&&(i.range=t.convertViewRangeToModelRange(i.range)),(i.type===5||i.type===8)&&(i.detail=this.convertViewToModelViewZoneData(i.detail,t)),i}static convertViewToModelViewZoneData(e,t){return{viewZoneId:e.viewZoneId,positionBefore:e.positionBefore?t.convertViewPositionToModelPosition(e.positionBefore):e.positionBefore,positionAfter:e.positionAfter?t.convertViewPositionToModelPosition(e.positionAfter):e.positionAfter,position:t.convertViewPositionToModelPosition(e.position),afterLineNumber:t.convertViewPositionToModelPosition(new D(e.afterLineNumber,1)).lineNumber}}}class NS extends Ye{constructor(e){super(e),this.blocks=[],this.contentWidth=-1,this.contentLeft=0,this.domNode=Q(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let e=!1;const i=this._context.configuration.options.get(146),n=i.contentWidth-i.verticalScrollbarWidth;this.contentWidth!==n&&(this.contentWidth=n,e=!0);const s=i.contentLeft;return this.contentLeft!==s&&(this.contentLeft=s,e=!0),e}dispose(){super.dispose()}onConfigurationChanged(e){return this.update()}onScrollChanged(e){return e.scrollTopChanged||e.scrollLeftChanged}onDecorationsChanged(e){return!0}onZonesChanged(e){return!0}prepareRender(e){}render(e){let t=0;const i=e.getDecorationsInViewport();for(const n of i){if(!n.options.blockClassName)continue;let s=this.blocks[t];s||(s=this.blocks[t]=Q(document.createElement("div")),this.domNode.appendChild(s));let o,r;n.options.blockIsAfterEnd?(o=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!1),r=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0)):(o=e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!0),r=n.range.isEmpty()&&!n.options.blockDoesNotCollapse?e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!1):e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0));const[l,h,c,d]=n.options.blockPadding??[0,0,0,0];s.setClassName("blockDecorations-block "+n.options.blockClassName),s.setLeft(this.contentLeft-d),s.setWidth(this.contentWidth+d+h),s.setTop(o-e.scrollTop-l),s.setHeight(r-o+l+c),t++}for(let n=t;n<this.blocks.length;n++)this.blocks[n].domNode.remove();this.blocks.length=t}}class DS extends Ye{constructor(e,t){super(e),this._viewDomNode=t,this._widgets={},this.domNode=Q(document.createElement("div")),ft.write(this.domNode,1),this.domNode.setClassName("contentWidgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this.overflowingContentWidgetsDomNode=Q(document.createElement("div")),ft.write(this.overflowingContentWidgetsDomNode,2),this.overflowingContentWidgetsDomNode.setClassName("overflowingContentWidgets")}dispose(){super.dispose(),this._widgets={}}onConfigurationChanged(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onConfigurationChanged(e);return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLineMappingChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesDeleted(e){return this._updateAnchorsViewPositions(),!0}onLinesInserted(e){return this._updateAnchorsViewPositions(),!0}onScrollChanged(e){return!0}onZonesChanged(e){return!0}_updateAnchorsViewPositions(){const e=Object.keys(this._widgets);for(const t of e)this._widgets[t].updateAnchorViewPosition()}addWidget(e){const t=new IS(this._context,this._viewDomNode,e);this._widgets[t.id]=t,t.allowEditorOverflow?this.overflowingContentWidgetsDomNode.appendChild(t.domNode):this.domNode.appendChild(t.domNode),this.setShouldRender()}setWidgetPosition(e,t,i,n,s){this._widgets[e.getId()].setPosition(t,i,n,s),this.setShouldRender()}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const i=this._widgets[t];delete this._widgets[t];const n=i.domNode.domNode;n.remove(),n.removeAttribute("monaco-visible-content-widget"),this.setShouldRender()}}shouldSuppressMouseDownOnWidget(e){return this._widgets.hasOwnProperty(e)?this._widgets[e].suppressMouseDown:!1}onBeforeRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onBeforeRender(e)}prepareRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].prepareRender(e)}render(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].render(e)}}class IS{constructor(e,t,i){this._primaryAnchor=new ss(null,null),this._secondaryAnchor=new ss(null,null),this._context=e,this._viewDomNode=t,this._actual=i,this.domNode=Q(this._actual.getDomNode()),this.id=this._actual.getId(),this.allowEditorOverflow=this._actual.allowEditorOverflow||!1,this.suppressMouseDown=this._actual.suppressMouseDown||!1;const n=this._context.configuration.options,s=n.get(146);this._fixedOverflowWidgets=n.get(42),this._contentWidth=s.contentWidth,this._contentLeft=s.contentLeft,this._lineHeight=n.get(67),this._affinity=null,this._preference=[],this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1,this._maxWidth=this._getMaxWidth(),this._isVisible=!1,this._renderData=null,this.domNode.setPosition(this._fixedOverflowWidgets&&this.allowEditorOverflow?"fixed":"absolute"),this.domNode.setDisplay("none"),this.domNode.setVisibility("hidden"),this.domNode.setAttribute("widgetId",this.id),this.domNode.setMaxWidth(this._maxWidth)}onConfigurationChanged(e){const t=this._context.configuration.options;if(this._lineHeight=t.get(67),e.hasChanged(146)){const i=t.get(146);this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._maxWidth=this._getMaxWidth()}}updateAnchorViewPosition(){this._setPosition(this._affinity,this._primaryAnchor.modelPosition,this._secondaryAnchor.modelPosition)}_setPosition(e,t,i){this._affinity=e,this._primaryAnchor=n(t,this._context.viewModel,this._affinity),this._secondaryAnchor=n(i,this._context.viewModel,this._affinity);function n(s,o,r){if(!s)return new ss(null,null);const l=o.model.validatePosition(s);if(o.coordinatesConverter.modelPositionIsVisible(l)){const h=o.coordinatesConverter.convertModelPositionToViewPosition(l,r??void 0);return new ss(s,h)}return new ss(s,null)}}_getMaxWidth(){const e=this.domNode.domNode.ownerDocument,t=e.defaultView;return this.allowEditorOverflow?(t==null?void 0:t.innerWidth)||e.documentElement.offsetWidth||e.body.offsetWidth:this._contentWidth}setPosition(e,t,i,n){this._setPosition(n,e,t),this._preference=i,this._primaryAnchor.viewPosition&&this._preference&&this._preference.length>0?this.domNode.setDisplay("block"):this.domNode.setDisplay("none"),this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1}_layoutBoxInViewport(e,t,i,n){const s=e.top,o=s,r=e.top+e.height,l=n.viewportHeight-r,h=s-i,c=o>=i,d=r,u=l>=i;let g=e.left;return g+t>n.scrollLeft+n.viewportWidth&&(g=n.scrollLeft+n.viewportWidth-t),g<n.scrollLeft&&(g=n.scrollLeft),{fitsAbove:c,aboveTop:h,fitsBelow:u,belowTop:d,left:g}}_layoutHorizontalSegmentInPage(e,t,i,n){const r=Math.max(15,t.left-n),l=Math.min(t.left+t.width+n,e.width-15),c=this._viewDomNode.domNode.ownerDocument.defaultView;let d=t.left+i-((c==null?void 0:c.scrollX)??0);if(d+n>l){const u=d-(l-n);d-=u,i-=u}if(d<r){const u=d-r;d-=u,i-=u}return[i,d]}_layoutBoxInPage(e,t,i,n){const s=e.top-i,o=e.top+e.height,r=Wn(this._viewDomNode.domNode),l=this._viewDomNode.domNode.ownerDocument,h=l.defaultView,c=r.top+s-((h==null?void 0:h.scrollY)??0),d=r.top+o-((h==null?void 0:h.scrollY)??0),u=Mf(l.body),[g,f]=this._layoutHorizontalSegmentInPage(u,r,e.left-n.scrollLeft+this._contentLeft,t),m=22,_=22,C=c>=m,p=d+i<=u.height-_;return this._fixedOverflowWidgets?{fitsAbove:C,aboveTop:Math.max(c,m),fitsBelow:p,belowTop:d,left:f}:{fitsAbove:C,aboveTop:s,fitsBelow:p,belowTop:o,left:g}}_prepareRenderWidgetAtExactPositionOverflowing(e){return new os(e.top,e.left+this._contentLeft)}_getAnchorsCoordinates(e){var o,r;const t=s(this._primaryAnchor.viewPosition,this._affinity,this._lineHeight),i=((o=this._secondaryAnchor.viewPosition)==null?void 0:o.lineNumber)===((r=this._primaryAnchor.viewPosition)==null?void 0:r.lineNumber)?this._secondaryAnchor.viewPosition:null,n=s(i,this._affinity,this._lineHeight);return{primary:t,secondary:n};function s(l,h,c){if(!l)return null;const d=e.visibleRangeForPosition(l);if(!d)return null;const u=l.column===1&&h===3?0:d.left,g=e.getVerticalOffsetForLineNumber(l.lineNumber)-e.scrollTop;return new nd(g,u,c)}}_reduceAnchorCoordinates(e,t,i){if(!t)return e;const n=this._context.configuration.options.get(50);let s=t.left;return s<e.left?s=Math.max(s,e.left-i+n.typicalFullwidthCharacterWidth):s=Math.min(s,e.left+i-n.typicalFullwidthCharacterWidth),new nd(e.top,s,e.height)}_prepareRenderWidget(e){if(!this._preference||this._preference.length===0)return null;const{primary:t,secondary:i}=this._getAnchorsCoordinates(e);if(!t)return{kind:"offViewport",preserveFocus:this.domNode.domNode.contains(this.domNode.domNode.ownerDocument.activeElement)};if(this._cachedDomNodeOffsetWidth===-1||this._cachedDomNodeOffsetHeight===-1){let o=null;if(typeof this._actual.beforeRender=="function"&&(o=fa(this._actual.beforeRender,this._actual)),o)this._cachedDomNodeOffsetWidth=o.width,this._cachedDomNodeOffsetHeight=o.height;else{const l=this.domNode.domNode.getBoundingClientRect();this._cachedDomNodeOffsetWidth=Math.round(l.width),this._cachedDomNodeOffsetHeight=Math.round(l.height)}}const n=this._reduceAnchorCoordinates(t,i,this._cachedDomNodeOffsetWidth);let s;this.allowEditorOverflow?s=this._layoutBoxInPage(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e):s=this._layoutBoxInViewport(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e);for(let o=1;o<=2;o++)for(const r of this._preference)if(r===1){if(!s)return null;if(o===2||s.fitsAbove)return{kind:"inViewport",coordinate:new os(s.aboveTop,s.left),position:1}}else if(r===2){if(!s)return null;if(o===2||s.fitsBelow)return{kind:"inViewport",coordinate:new os(s.belowTop,s.left),position:2}}else return this.allowEditorOverflow?{kind:"inViewport",coordinate:this._prepareRenderWidgetAtExactPositionOverflowing(new os(n.top,n.left)),position:0}:{kind:"inViewport",coordinate:new os(n.top,n.left),position:0};return null}onBeforeRender(e){!this._primaryAnchor.viewPosition||!this._preference||this._primaryAnchor.viewPosition.lineNumber<e.startLineNumber||this._primaryAnchor.viewPosition.lineNumber>e.endLineNumber||this.domNode.setMaxWidth(this._maxWidth)}prepareRender(e){this._renderData=this._prepareRenderWidget(e)}render(e){var t;if(!this._renderData||this._renderData.kind==="offViewport"){this._isVisible&&(this.domNode.removeAttribute("monaco-visible-content-widget"),this._isVisible=!1,((t=this._renderData)==null?void 0:t.kind)==="offViewport"&&this._renderData.preserveFocus?this.domNode.setTop(-1e3):this.domNode.setVisibility("hidden")),typeof this._actual.afterRender=="function"&&fa(this._actual.afterRender,this._actual,null);return}this.allowEditorOverflow?(this.domNode.setTop(this._renderData.coordinate.top),this.domNode.setLeft(this._renderData.coordinate.left)):(this.domNode.setTop(this._renderData.coordinate.top+e.scrollTop-e.bigNumbersDelta),this.domNode.setLeft(this._renderData.coordinate.left)),this._isVisible||(this.domNode.setVisibility("inherit"),this.domNode.setAttribute("monaco-visible-content-widget","true"),this._isVisible=!0),typeof this._actual.afterRender=="function"&&fa(this._actual.afterRender,this._actual,this._renderData.position)}}class ss{constructor(e,t){this.modelPosition=e,this.viewPosition=t}}class os{constructor(e,t){this.top=e,this.left=t,this._coordinateBrand=void 0}}class nd{constructor(e,t,i){this.top=e,this.left=t,this.height=i,this._anchorCoordinateBrand=void 0}}function fa(a,e,...t){try{return a.call(e,...t)}catch{return null}}class Dg extends Yi{constructor(e){super(),this._context=e;const t=this._context.configuration.options,i=t.get(146);this._renderLineHighlight=t.get(97),this._renderLineHighlightOnlyWhenFocus=t.get(98),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._selectionIsEmpty=!0,this._focused=!1,this._cursorLineNumbers=[1],this._selections=[new te(1,1,1,1)],this._renderData=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}_readFromSelections(){let e=!1;const t=new Set;for(const s of this._selections)t.add(s.positionLineNumber);const i=Array.from(t);i.sort((s,o)=>s-o),Nt(this._cursorLineNumbers,i)||(this._cursorLineNumbers=i,e=!0);const n=this._selections.every(s=>s.isEmpty());return this._selectionIsEmpty!==n&&(this._selectionIsEmpty=n,e=!0),e}onThemeChanged(e){return this._readFromSelections()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._renderLineHighlight=t.get(97),this._renderLineHighlightOnlyWhenFocus=t.get(98),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,!0}onCursorStateChanged(e){return this._selections=e.selections,this._readFromSelections()}onFlushed(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollWidthChanged||e.scrollTopChanged}onZonesChanged(e){return!0}onFocusChanged(e){return this._renderLineHighlightOnlyWhenFocus?(this._focused=e.isFocused,!0):!1}prepareRender(e){if(!this._shouldRenderThis()){this._renderData=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=[];for(let o=t;o<=i;o++){const r=o-t;n[r]=""}if(this._wordWrap){const o=this._renderOne(e,!1);for(const r of this._cursorLineNumbers){const l=this._context.viewModel.coordinatesConverter,h=l.convertViewPositionToModelPosition(new D(r,1)).lineNumber,c=l.convertModelPositionToViewPosition(new D(h,1)).lineNumber,d=l.convertModelPositionToViewPosition(new D(h,this._context.viewModel.model.getLineMaxColumn(h))).lineNumber,u=Math.max(c,t),g=Math.min(d,i);for(let f=u;f<=g;f++){const m=f-t;n[m]=o}}}const s=this._renderOne(e,!0);for(const o of this._cursorLineNumbers){if(o<t||o>i)continue;const r=o-t;n[r]=s}this._renderData=n}render(e,t){if(!this._renderData)return"";const i=t-e;return i>=this._renderData.length?"":this._renderData[i]}_shouldRenderInMargin(){return(this._renderLineHighlight==="gutter"||this._renderLineHighlight==="all")&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}_shouldRenderInContent(){return(this._renderLineHighlight==="line"||this._renderLineHighlight==="all")&&this._selectionIsEmpty&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}}class kS extends Dg{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-both":"")+(t?" current-line-exact":"")}" style="width:${Math.max(e.scrollWidth,this._contentWidth)}px;"></div>`}_shouldRenderThis(){return this._shouldRenderInContent()}_shouldRenderOther(){return this._shouldRenderInMargin()}}class TS extends Dg{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-margin":"")+(this._shouldRenderOther()?" current-line-margin-both":"")+(this._shouldRenderInMargin()&&t?" current-line-exact-margin":"")}" style="width:${this._contentLeft}px"></div>`}_shouldRenderThis(){return!0}_shouldRenderOther(){return this._shouldRenderInContent()}}di((a,e)=>{const t=a.getColor(Pu);if(t&&(e.addRule(`.monaco-editor .view-overlays .current-line { background-color: ${t}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { background-color: ${t}; border: none; }`)),!t||t.isTransparent()||a.defines(pc)){const i=a.getColor(pc);i&&(e.addRule(`.monaco-editor .view-overlays .current-line-exact { border: 2px solid ${i}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-exact-margin { border: 2px solid ${i}; }`),ds(a.type)&&(e.addRule(".monaco-editor .view-overlays .current-line-exact { border-width: 1px; }"),e.addRule(".monaco-editor .margin-view-overlays .current-line-exact-margin { border-width: 1px; }")))}});class ES extends Yi{constructor(e){super(),this._context=e;const t=this._context.configuration.options;this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}prepareRender(e){const t=e.getDecorationsInViewport();let i=[],n=0;for(let l=0,h=t.length;l<h;l++){const c=t[l];c.options.className&&(i[n++]=c)}i=i.sort((l,h)=>{if(l.options.zIndex<h.options.zIndex)return-1;if(l.options.zIndex>h.options.zIndex)return 1;const c=l.options.className,d=h.options.className;return c<d?-1:c>d?1:v.compareRangesUsingStarts(l.range,h.range)});const s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber,r=[];for(let l=s;l<=o;l++){const h=l-s;r[h]=""}this._renderWholeLineDecorations(e,i,r),this._renderNormalDecorations(e,i,r),this._renderResult=r}_renderWholeLineDecorations(e,t,i){const n=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber;for(let o=0,r=t.length;o<r;o++){const l=t[o];if(!l.options.isWholeLine)continue;const h='<div class="cdr '+l.options.className+'" style="left:0;width:100%;"></div>',c=Math.max(l.range.startLineNumber,n),d=Math.min(l.range.endLineNumber,s);for(let u=c;u<=d;u++){const g=u-n;i[g]+=h}}}_renderNormalDecorations(e,t,i){const n=e.visibleRange.startLineNumber;let s=null,o=!1,r=null,l=!1;for(let h=0,c=t.length;h<c;h++){const d=t[h];if(d.options.isWholeLine)continue;const u=d.options.className,g=!!d.options.showIfCollapsed;let f=d.range;if(g&&f.endColumn===1&&f.endLineNumber!==f.startLineNumber&&(f=new v(f.startLineNumber,f.startColumn,f.endLineNumber-1,this._context.viewModel.getLineMaxColumn(f.endLineNumber-1))),s===u&&o===g&&v.areIntersectingOrTouching(r,f)){r=v.plusRange(r,f);continue}s!==null&&this._renderNormalDecoration(e,r,s,l,o,n,i),s=u,o=g,r=f,l=d.options.shouldFillLineOnLineBreak??!1}s!==null&&this._renderNormalDecoration(e,r,s,l,o,n,i)}_renderNormalDecoration(e,t,i,n,s,o,r){const l=e.linesVisibleRangesForRange(t,i==="findMatch");if(l)for(let h=0,c=l.length;h<c;h++){const d=l[h];if(d.outsideRenderedLine)continue;const u=d.lineNumber-o;if(s&&d.ranges.length===1){const g=d.ranges[0];if(g.width<this._typicalHalfwidthCharacterWidth){const f=Math.round(g.left+g.width/2),m=Math.max(0,Math.round(f-this._typicalHalfwidthCharacterWidth/2));d.ranges[0]=new Wr(m,this._typicalHalfwidthCharacterWidth)}}for(let g=0,f=d.ranges.length;g<f;g++){const m=n&&d.continuesOnNextLine&&f===1,_=d.ranges[g],C='<div class="cdr '+i+'" style="left:'+String(_.left)+"px;width:"+(m?"100%;":String(_.width)+"px;")+'"></div>';r[u]+=C}}}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class MS extends Ye{constructor(e,t,i,n){super(e);const s=this._context.configuration.options,o=s.get(104),r=s.get(75),l=s.get(40),h=s.get(107),c={listenOnDomNode:i.domNode,className:"editor-scrollable "+za(e.theme.type),useShadows:!1,lazyRender:!0,vertical:o.vertical,horizontal:o.horizontal,verticalHasArrows:o.verticalHasArrows,horizontalHasArrows:o.horizontalHasArrows,verticalScrollbarSize:o.verticalScrollbarSize,verticalSliderSize:o.verticalSliderSize,horizontalScrollbarSize:o.horizontalScrollbarSize,horizontalSliderSize:o.horizontalSliderSize,handleMouseWheel:o.handleMouseWheel,alwaysConsumeMouseWheel:o.alwaysConsumeMouseWheel,arrowSize:o.arrowSize,mouseWheelScrollSensitivity:r,fastScrollSensitivity:l,scrollPredominantAxis:h,scrollByPage:o.scrollByPage};this.scrollbar=this._register(new eu(t.domNode,c,this._context.viewLayout.getScrollable())),ft.write(this.scrollbar.getDomNode(),6),this.scrollbarDomNode=Q(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const d=(u,g,f)=>{const m={};{const _=u.scrollTop;_&&(m.scrollTop=this._context.viewLayout.getCurrentScrollTop()+_,u.scrollTop=0)}if(f){const _=u.scrollLeft;_&&(m.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+_,u.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(m,1)};this._register(F(i.domNode,"scroll",u=>d(i.domNode,!0,!0))),this._register(F(t.domNode,"scroll",u=>d(t.domNode,!0,!1))),this._register(F(n.domNode,"scroll",u=>d(n.domNode,!0,!1))),this._register(F(this.scrollbarDomNode.domNode,"scroll",u=>d(this.scrollbarDomNode.domNode,!0,!1)))}dispose(){super.dispose()}_setLayout(){const e=this._context.configuration.options,t=e.get(146);this.scrollbarDomNode.setLeft(t.contentLeft),e.get(73).side==="right"?this.scrollbarDomNode.setWidth(t.contentWidth+t.minimap.minimapWidth):this.scrollbarDomNode.setWidth(t.contentWidth),this.scrollbarDomNode.setHeight(t.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(e){this.scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this.scrollbar.delegateScrollFromMouseWheelEvent(e)}onConfigurationChanged(e){if(e.hasChanged(104)||e.hasChanged(75)||e.hasChanged(40)){const t=this._context.configuration.options,i=t.get(104),n=t.get(75),s=t.get(40),o=t.get(107),r={vertical:i.vertical,horizontal:i.horizontal,verticalScrollbarSize:i.verticalScrollbarSize,horizontalScrollbarSize:i.horizontalScrollbarSize,scrollByPage:i.scrollByPage,handleMouseWheel:i.handleMouseWheel,mouseWheelScrollSensitivity:n,fastScrollSensitivity:s,scrollPredominantAxis:o};this.scrollbar.updateOptions(r)}return e.hasChanged(146)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+za(this._context.theme.type)),!0}prepareRender(e){}render(e){this.scrollbar.renderNow()}}class ml{constructor(e,t,i,n,s){this.startLineNumber=e,this.endLineNumber=t,this.className=i,this.tooltip=n,this._decorationToRenderBrand=void 0,this.zIndex=s??0}}class RS{constructor(e,t,i){this.className=e,this.zIndex=t,this.tooltip=i}}class AS{constructor(){this.decorations=[]}add(e){this.decorations.push(e)}getDecorations(){return this.decorations}}class Ig extends Yi{_render(e,t,i){const n=[];for(let r=e;r<=t;r++){const l=r-e;n[l]=new AS}if(i.length===0)return n;i.sort((r,l)=>r.className===l.className?r.startLineNumber===l.startLineNumber?r.endLineNumber-l.endLineNumber:r.startLineNumber-l.startLineNumber:r.className<l.className?-1:1);let s=null,o=0;for(let r=0,l=i.length;r<l;r++){const h=i[r],c=h.className,d=h.zIndex;let u=Math.max(h.startLineNumber,e)-e;const g=Math.min(h.endLineNumber,t)-e;s===c?(u=Math.max(o+1,u),o=Math.max(o,g)):(s=c,o=g);for(let f=u;f<=o;f++)n[f].add(new RS(c,d,h.tooltip))}return n}}class OS extends Ye{constructor(e){super(e),this._widgets={},this._context=e;const t=this._context.configuration.options,i=t.get(146);this.domNode=Q(document.createElement("div")),this.domNode.setClassName("glyph-margin-widgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this._lineHeight=t.get(67),this._glyphMargin=t.get(57),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,this._managedDomNodes=[],this._decorationGlyphsToRender=[]}dispose(){this._managedDomNodes=[],this._decorationGlyphsToRender=[],this._widgets={},super.dispose()}getWidgets(){return Object.values(this._widgets)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._lineHeight=t.get(67),this._glyphMargin=t.get(57),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}addWidget(e){const t=Q(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:e.getPosition(),domNode:t,renderInfo:null},t.setPosition("absolute"),t.setDisplay("none"),t.setAttribute("widgetId",e.getId()),this.domNode.appendChild(t),this.setShouldRender()}setWidgetPosition(e,t){const i=this._widgets[e.getId()];return i.preference.lane===t.lane&&i.preference.zIndex===t.zIndex&&v.equalsRange(i.preference.range,t.range)?!1:(i.preference=t,this.setShouldRender(),!0)}removeWidget(e){const t=e.getId();if(this._widgets[t]){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender()}}_collectDecorationBasedGlyphRenderRequest(e,t){var o;const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=e.getDecorationsInViewport();for(const r of s){const l=r.options.glyphMarginClassName;if(!l)continue;const h=Math.max(r.range.startLineNumber,i),c=Math.min(r.range.endLineNumber,n),d=((o=r.options.glyphMargin)==null?void 0:o.position)??Gi.Center,u=r.options.zIndex??0;for(let g=h;g<=c;g++){const f=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new D(g,0)),m=this._context.viewModel.glyphLanes.getLanesAtLine(f.lineNumber).indexOf(d);t.push(new PS(g,m,u,l))}}}_collectWidgetBasedGlyphRenderRequest(e,t){const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(const s of Object.values(this._widgets)){const o=s.preference.range,{startLineNumber:r,endLineNumber:l}=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(v.lift(o));if(!r||!l||l<i||r>n)continue;const h=Math.max(r,i),c=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new D(h,0)),d=this._context.viewModel.glyphLanes.getLanesAtLine(c.lineNumber).indexOf(s.preference.lane);t.push(new BS(h,d,s.preference.zIndex,s))}}_collectSortedGlyphRenderRequests(e){const t=[];return this._collectDecorationBasedGlyphRenderRequest(e,t),this._collectWidgetBasedGlyphRenderRequest(e,t),t.sort((i,n)=>i.lineNumber===n.lineNumber?i.laneIndex===n.laneIndex?i.zIndex===n.zIndex?n.type===i.type?i.type===0&&n.type===0?i.className<n.className?-1:1:0:n.type-i.type:n.zIndex-i.zIndex:i.laneIndex-n.laneIndex:i.lineNumber-n.lineNumber),t}prepareRender(e){if(!this._glyphMargin){this._decorationGlyphsToRender=[];return}for(const n of Object.values(this._widgets))n.renderInfo=null;const t=new ji(this._collectSortedGlyphRenderRequests(e)),i=[];for(;t.length>0;){const n=t.peek();if(!n)break;const s=t.takeWhile(r=>r.lineNumber===n.lineNumber&&r.laneIndex===n.laneIndex);if(!s||s.length===0)break;const o=s[0];if(o.type===0){const r=[];for(const l of s){if(l.zIndex!==o.zIndex||l.type!==o.type)break;(r.length===0||r[r.length-1]!==l.className)&&r.push(l.className)}i.push(o.accept(r.join(" ")))}else o.widget.renderInfo={lineNumber:o.lineNumber,laneIndex:o.laneIndex}}this._decorationGlyphsToRender=i}render(e){if(!this._glyphMargin){for(const i of Object.values(this._widgets))i.domNode.setDisplay("none");for(;this._managedDomNodes.length>0;){const i=this._managedDomNodes.pop();i==null||i.domNode.remove()}return}const t=Math.round(this._glyphMarginWidth/this._glyphMarginDecorationLaneCount);for(const i of Object.values(this._widgets))if(!i.renderInfo)i.domNode.setDisplay("none");else{const n=e.viewportData.relativeVerticalOffset[i.renderInfo.lineNumber-e.viewportData.startLineNumber],s=this._glyphMarginLeft+i.renderInfo.laneIndex*this._lineHeight;i.domNode.setDisplay("block"),i.domNode.setTop(n),i.domNode.setLeft(s),i.domNode.setWidth(t),i.domNode.setHeight(this._lineHeight)}for(let i=0;i<this._decorationGlyphsToRender.length;i++){const n=this._decorationGlyphsToRender[i],s=e.viewportData.relativeVerticalOffset[n.lineNumber-e.viewportData.startLineNumber],o=this._glyphMarginLeft+n.laneIndex*this._lineHeight;let r;i<this._managedDomNodes.length?r=this._managedDomNodes[i]:(r=Q(document.createElement("div")),this._managedDomNodes.push(r),this.domNode.appendChild(r)),r.setClassName("cgmr codicon "+n.combinedClassName),r.setPosition("absolute"),r.setTop(s),r.setLeft(o),r.setWidth(t),r.setHeight(this._lineHeight)}for(;this._managedDomNodes.length>this._decorationGlyphsToRender.length;){const i=this._managedDomNodes.pop();i==null||i.domNode.remove()}}}class PS{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.className=n,this.type=0}accept(e){return new FS(this.lineNumber,this.laneIndex,e)}}class BS{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.widget=n,this.type=1}}class FS{constructor(e,t,i){this.lineNumber=e,this.laneIndex=t,this.combinedClassName=i}}class WS extends Yi{constructor(e){super(),this._context=e,this._primaryPosition=null;const t=this._context.configuration.options,i=t.get(147),n=t.get(50);this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(16),this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(147),n=t.get(50);return this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(16),!0}onCursorStateChanged(e){var n;const i=e.selections[0].getPosition();return(n=this._primaryPosition)!=null&&n.equals(i)?!1:(this._primaryPosition=i,!0)}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onLanguageConfigurationChanged(e){return!0}prepareRender(e){var l,h;if(!this._bracketPairGuideOptions.indentation&&this._bracketPairGuideOptions.bracketPairs===!1){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=e.scrollWidth,s=this._primaryPosition,o=this.getGuidesByLine(t,Math.min(i+1,this._context.viewModel.getLineCount()),s),r=[];for(let c=t;c<=i;c++){const d=c-t,u=o[d];let g="";const f=((l=e.visibleRangeForPosition(new D(c,1)))==null?void 0:l.left)??0;for(const m of u){const _=m.column===-1?f+(m.visibleColumn-1)*this._spaceWidth:e.visibleRangeForPosition(new D(c,m.column)).left;if(_>n||this._maxIndentLeft>0&&_>this._maxIndentLeft)break;const C=m.horizontalLine?m.horizontalLine.top?"horizontal-top":"horizontal-bottom":"vertical",p=m.horizontalLine?(((h=e.visibleRangeForPosition(new D(c,m.horizontalLine.endColumn)))==null?void 0:h.left)??_+this._spaceWidth)-_:this._spaceWidth;g+=`<div class="core-guide ${m.className} ${C}" style="left:${_}px;width:${p}px"></div>`}r[d]=g}this._renderResult=r}getGuidesByLine(e,t,i){const n=this._bracketPairGuideOptions.bracketPairs!==!1?this._context.viewModel.getBracketGuidesInRangeByLine(e,t,i,{highlightActive:this._bracketPairGuideOptions.highlightActiveBracketPair,horizontalGuides:this._bracketPairGuideOptions.bracketPairsHorizontal===!0?Fi.Enabled:this._bracketPairGuideOptions.bracketPairsHorizontal==="active"?Fi.EnabledForActive:Fi.Disabled,includeInactive:this._bracketPairGuideOptions.bracketPairs===!0}):null,s=this._bracketPairGuideOptions.indentation?this._context.viewModel.getLinesIndentGuides(e,t):null;let o=0,r=0,l=0;if(this._bracketPairGuideOptions.highlightActiveIndentation!==!1&&i){const d=this._context.viewModel.getActiveIndentGuide(i.lineNumber,e,t);o=d.startLineNumber,r=d.endLineNumber,l=d.indent}const{indentSize:h}=this._context.viewModel.model.getOptions(),c=[];for(let d=e;d<=t;d++){const u=new Array;c.push(u);const g=n?n[d-e]:[],f=new ji(g),m=s?s[d-e]:0;for(let _=1;_<=m;_++){const C=(_-1)*h+1,p=(this._bracketPairGuideOptions.highlightActiveIndentation==="always"||g.length===0)&&o<=d&&d<=r&&_===l;u.push(...f.takeWhile(w=>w.visibleColumn<C)||[]);const b=f.peek();(!b||b.visibleColumn!==C||b.horizontalLine)&&u.push(new Mi(C,-1,`core-guide-indent lvl-${(_-1)%30}`+(p?" indent-active":""),null,-1,-1))}u.push(...f.takeWhile(_=>!0)||[])}return c}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}function an(a){if(!(a&&a.isTransparent()))return a}di((a,e)=>{const t=[{bracketColor:Wu,guideColor:Ob,guideColorActive:Hb},{bracketColor:Vu,guideColor:Pb,guideColorActive:zb},{bracketColor:Hu,guideColor:Bb,guideColorActive:Ub},{bracketColor:zu,guideColor:Fb,guideColorActive:jb},{bracketColor:Uu,guideColor:Wb,guideColorActive:$b},{bracketColor:ju,guideColor:Vb,guideColorActive:Gb}],i=new Ju,n=[{indentColor:pb,indentColorActive:vb},{indentColor:_b,indentColorActive:Sb},{indentColor:Cb,indentColorActive:xb},{indentColor:bb,indentColorActive:yb},{indentColor:wb,indentColorActive:Nb},{indentColor:Lb,indentColorActive:Db}],s=t.map(r=>{const l=a.getColor(r.bracketColor),h=a.getColor(r.guideColor),c=a.getColor(r.guideColorActive),d=an(an(h)??(l==null?void 0:l.transparent(.3))),u=an(an(c)??l);if(!(!d||!u))return{guideColor:d,guideColorActive:u}}).filter(Eh),o=n.map(r=>{const l=a.getColor(r.indentColor),h=a.getColor(r.indentColorActive),c=an(l),d=an(h);if(!(!c||!d))return{indentColor:c,indentColorActive:d}}).filter(Eh);if(s.length>0){for(let r=0;r<30;r++){const l=s[r%s.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(r).replace(/ /g,".")} { --guide-color: ${l.guideColor}; --guide-color-active: ${l.guideColorActive}; }`)}e.addRule(".monaco-editor .vertical { box-shadow: 1px 0 0 0 var(--guide-color) inset; }"),e.addRule(".monaco-editor .horizontal-top { border-top: 1px solid var(--guide-color); }"),e.addRule(".monaco-editor .horizontal-bottom { border-bottom: 1px solid var(--guide-color); }"),e.addRule(`.monaco-editor .vertical.${i.activeClassName} { box-shadow: 1px 0 0 0 var(--guide-color-active) inset; }`),e.addRule(`.monaco-editor .horizontal-top.${i.activeClassName} { border-top: 1px solid var(--guide-color-active); }`),e.addRule(`.monaco-editor .horizontal-bottom.${i.activeClassName} { border-bottom: 1px solid var(--guide-color-active); }`)}if(o.length>0){for(let r=0;r<30;r++){const l=o[r%o.length];e.addRule(`.monaco-editor .lines-content .core-guide-indent.lvl-${r} { --indent-color: ${l.indentColor}; --indent-color-active: ${l.indentColorActive}; }`)}e.addRule(".monaco-editor .lines-content .core-guide-indent { box-shadow: 1px 0 0 0 var(--indent-color) inset; }"),e.addRule(".monaco-editor .lines-content .core-guide-indent.indent-active { box-shadow: 1px 0 0 0 var(--indent-color-active) inset; }")}});class ma{get didDomLayout(){return this._didDomLayout}readClientRect(){if(!this._clientRectRead){this._clientRectRead=!0;const e=this._domNode.getBoundingClientRect();this.markDidDomLayout(),this._clientRectDeltaLeft=e.left,this._clientRectScale=e.width/this._domNode.offsetWidth}}get clientRectDeltaLeft(){return this._clientRectRead||this.readClientRect(),this._clientRectDeltaLeft}get clientRectScale(){return this._clientRectRead||this.readClientRect(),this._clientRectScale}constructor(e,t){this._domNode=e,this.endNode=t,this._didDomLayout=!1,this._clientRectDeltaLeft=0,this._clientRectScale=1,this._clientRectRead=!1}markDidDomLayout(){this._didDomLayout=!0}}class VS{constructor(){this._currentVisibleRange=new v(1,1,1,1)}getCurrentVisibleRange(){return this._currentVisibleRange}setCurrentVisibleRange(e){this._currentVisibleRange=e}}class HS{constructor(e,t,i,n,s,o,r){this.minimalReveal=e,this.lineNumber=t,this.startColumn=i,this.endColumn=n,this.startScrollTop=s,this.stopScrollTop=o,this.scrollType=r,this.type="range",this.minLineNumber=t,this.maxLineNumber=t}}class zS{constructor(e,t,i,n,s){this.minimalReveal=e,this.selections=t,this.startScrollTop=i,this.stopScrollTop=n,this.scrollType=s,this.type="selections";let o=t[0].startLineNumber,r=t[0].endLineNumber;for(let l=1,h=t.length;l<h;l++){const c=t[l];o=Math.min(o,c.startLineNumber),r=Math.max(r,c.endLineNumber)}this.minLineNumber=o,this.maxLineNumber=r}}const wr=class wr extends Ye{constructor(e,t){super(e);const i=this._context.configuration,n=this._context.configuration.options,s=n.get(50),o=n.get(147);this._lineHeight=n.get(67),this._typicalHalfwidthCharacterWidth=s.typicalHalfwidthCharacterWidth,this._isViewportWrapping=o.isViewportWrapping,this._revealHorizontalRightPadding=n.get(101),this._cursorSurroundingLines=n.get(29),this._cursorSurroundingLinesStyle=n.get(30),this._canUseLayerHinting=!n.get(32),this._viewLineOptions=new Kc(i,this._context.theme.type),this._linesContent=t,this._textRangeRestingSpot=document.createElement("div"),this._visibleLines=new yg({createLine:()=>new Ht(this._viewLineOptions)}),this.domNode=this._visibleLines.domNode,ft.write(this.domNode,8),this.domNode.setClassName(`view-lines ${On}`),qe(this.domNode,s),this._maxLineWidth=0,this._asyncUpdateLineWidths=new si(()=>{this._updateLineWidthsSlow()},200),this._asyncCheckMonospaceFontAssumptions=new si(()=>{this._checkMonospaceFontAssumptions()},2e3),this._lastRenderedData=new VS,this._horizontalRevealRequest=null,this._stickyScrollEnabled=n.get(116).enabled,this._maxNumberStickyLines=n.get(116).maxLineCount}dispose(){this._asyncUpdateLineWidths.dispose(),this._asyncCheckMonospaceFontAssumptions.dispose(),super.dispose()}getDomNode(){return this.domNode}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e),e.hasChanged(147)&&(this._maxLineWidth=0);const t=this._context.configuration.options,i=t.get(50),n=t.get(147);return this._lineHeight=t.get(67),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._isViewportWrapping=n.isViewportWrapping,this._revealHorizontalRightPadding=t.get(101),this._cursorSurroundingLines=t.get(29),this._cursorSurroundingLinesStyle=t.get(30),this._canUseLayerHinting=!t.get(32),this._stickyScrollEnabled=t.get(116).enabled,this._maxNumberStickyLines=t.get(116).maxLineCount,qe(this.domNode,i),this._onOptionsMaybeChanged(),e.hasChanged(146)&&(this._maxLineWidth=0),!0}_onOptionsMaybeChanged(){const e=this._context.configuration,t=new Kc(e,this._context.theme.type);if(!this._viewLineOptions.equals(t)){this._viewLineOptions=t;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onOptionsChanged(this._viewLineOptions);return!0}return!1}onCursorStateChanged(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=!1;for(let s=t;s<=i;s++)n=this._visibleLines.getVisibleLine(s).onSelectionChanged()||n;return n}onDecorationsChanged(e){{const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++)this._visibleLines.getVisibleLine(n).onDecorationsChanged()}return!0}onFlushed(e){const t=this._visibleLines.onFlushed(e);return this._maxLineWidth=0,t}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onRevealRangeRequest(e){const t=this._computeScrollTopToRevealRange(this._context.viewLayout.getFutureViewport(),e.source,e.minimalReveal,e.range,e.selections,e.verticalType);if(t===-1)return!1;let i=this._context.viewLayout.validateScrollPosition({scrollTop:t});e.revealHorizontal?e.range&&e.range.startLineNumber!==e.range.endLineNumber?i={scrollTop:i.scrollTop,scrollLeft:0}:e.range?this._horizontalRevealRequest=new HS(e.minimalReveal,e.range.startLineNumber,e.range.startColumn,e.range.endColumn,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType):e.selections&&e.selections.length>0&&(this._horizontalRevealRequest=new zS(e.minimalReveal,e.selections,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType)):this._horizontalRevealRequest=null;const s=Math.abs(this._context.viewLayout.getCurrentScrollTop()-i.scrollTop)<=this._lineHeight?1:e.scrollType;return this._context.viewModel.viewLayout.setScrollPosition(i,s),!0}onScrollChanged(e){if(this._horizontalRevealRequest&&e.scrollLeftChanged&&(this._horizontalRevealRequest=null),this._horizontalRevealRequest&&e.scrollTopChanged){const t=Math.min(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop),i=Math.max(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop);(e.scrollTop<t||e.scrollTop>i)&&(this._horizontalRevealRequest=null)}return this.domNode.setWidth(e.scrollWidth),this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth),this._visibleLines.onZonesChanged(e)}onThemeChanged(e){return this._onOptionsMaybeChanged()}getPositionFromDOMInfo(e,t){const i=this._getViewLineDomNode(e);if(i===null)return null;const n=this._getLineNumberFor(i);if(n===-1||n<1||n>this._context.viewModel.getLineCount())return null;if(this._context.viewModel.getLineMaxColumn(n)===1)return new D(n,1);const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();if(n<s||n>o)return null;let r=this._visibleLines.getVisibleLine(n).getColumnOfNodeOffset(e,t);const l=this._context.viewModel.getLineMinColumn(n);return r<l&&(r=l),new D(n,r)}_getViewLineDomNode(e){for(;e&&e.nodeType===1;){if(e.className===Ht.CLASS_NAME)return e;e=e.parentElement}return null}_getLineNumberFor(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++){const s=this._visibleLines.getVisibleLine(n);if(e===s.getDomNode())return n}return-1}getLineWidth(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();if(e<t||e>i)return-1;const n=new ma(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getWidth(n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}linesVisibleRangesForRange(e,t){if(this.shouldRender())return null;const i=e.endLineNumber,n=v.intersectRanges(e,this._lastRenderedData.getCurrentVisibleRange());if(!n)return null;const s=[];let o=0;const r=new ma(this.domNode.domNode,this._textRangeRestingSpot);let l=0;t&&(l=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new D(n.startLineNumber,1)).lineNumber);const h=this._visibleLines.getStartLineNumber(),c=this._visibleLines.getEndLineNumber();for(let d=n.startLineNumber;d<=n.endLineNumber;d++){if(d<h||d>c)continue;const u=d===n.startLineNumber?n.startColumn:1,g=d!==n.endLineNumber,f=g?this._context.viewModel.getLineMaxColumn(d):n.endColumn,m=this._visibleLines.getVisibleLine(d).getVisibleRangesForRange(d,u,f,r);if(m){if(t&&d<i){const _=l;l=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new D(d+1,1)).lineNumber,_!==l&&(m.ranges[m.ranges.length-1].width+=this._typicalHalfwidthCharacterWidth)}s[o++]=new yv(m.outsideRenderedLine,d,Wr.from(m.ranges),g)}}return this._updateLineWidthsSlowIfDomDidLayout(r),o===0?null:s}_visibleRangesForLineRange(e,t,i){if(this.shouldRender()||e<this._visibleLines.getStartLineNumber()||e>this._visibleLines.getEndLineNumber())return null;const n=new ma(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getVisibleRangesForRange(e,t,i,n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new Nv(t.outsideRenderedLine,t.ranges[0].left):null}_updateLineWidthsFast(){return this._updateLineWidths(!0)}_updateLineWidthsSlow(){this._updateLineWidths(!1)}_updateLineWidthsSlowIfDomDidLayout(e){e.didDomLayout&&(this._asyncUpdateLineWidths.isScheduled()||(this._asyncUpdateLineWidths.cancel(),this._updateLineWidthsSlow()))}_updateLineWidths(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=1,s=!0;for(let o=t;o<=i;o++){const r=this._visibleLines.getVisibleLine(o);if(e&&!r.getWidthIsFast()){s=!1;continue}n=Math.max(n,r.getWidth(null))}return s&&t===1&&i===this._context.viewModel.getLineCount()&&(this._maxLineWidth=0),this._ensureMaxLineWidth(n),s}_checkMonospaceFontAssumptions(){let e=-1,t=-1;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++){const o=this._visibleLines.getVisibleLine(s);if(o.needsMonospaceFontCheck()){const r=o.getWidth(null);r>t&&(t=r,e=s)}}if(e!==-1&&!this._visibleLines.getVisibleLine(e).monospaceAssumptionsAreValid())for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onMonospaceAssumptionsInvalidated()}prepareRender(){throw new Error("Not supported")}render(){throw new Error("Not supported")}renderText(e){if(this._visibleLines.renderLines(e),this._lastRenderedData.setCurrentVisibleRange(e.visibleRange),this.domNode.setWidth(this._context.viewLayout.getScrollWidth()),this.domNode.setHeight(Math.min(this._context.viewLayout.getScrollHeight(),1e6)),this._horizontalRevealRequest){const i=this._horizontalRevealRequest;if(e.startLineNumber<=i.minLineNumber&&i.maxLineNumber<=e.endLineNumber){this._horizontalRevealRequest=null,this.onDidRender();const n=this._computeScrollLeftToReveal(i);n&&(this._isViewportWrapping||this._ensureMaxLineWidth(n.maxHorizontalOffset),this._context.viewModel.viewLayout.setScrollPosition({scrollLeft:n.scrollLeft},i.scrollType))}}if(this._updateLineWidthsFast()?this._asyncUpdateLineWidths.cancel():this._asyncUpdateLineWidths.schedule(),Zs&&!this._asyncCheckMonospaceFontAssumptions.isScheduled()){const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)if(this._visibleLines.getVisibleLine(s).needsMonospaceFontCheck()){this._asyncCheckMonospaceFontAssumptions.schedule();break}}this._linesContent.setLayerHinting(this._canUseLayerHinting),this._linesContent.setContain("strict");const t=this._context.viewLayout.getCurrentScrollTop()-e.bigNumbersDelta;this._linesContent.setTop(-t),this._linesContent.setLeft(-this._context.viewLayout.getCurrentScrollLeft())}_ensureMaxLineWidth(e){const t=Math.ceil(e);this._maxLineWidth<t&&(this._maxLineWidth=t,this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth))}_computeScrollTopToRevealRange(e,t,i,n,s,o){const r=e.top,l=e.height,h=r+l;let c,d,u;if(s&&s.length>0){let C=s[0].startLineNumber,p=s[0].endLineNumber;for(let b=1,w=s.length;b<w;b++){const L=s[b];C=Math.min(C,L.startLineNumber),p=Math.max(p,L.endLineNumber)}c=!1,d=this._context.viewLayout.getVerticalOffsetForLineNumber(C),u=this._context.viewLayout.getVerticalOffsetForLineNumber(p)+this._lineHeight}else if(n)c=!0,d=this._context.viewLayout.getVerticalOffsetForLineNumber(n.startLineNumber),u=this._context.viewLayout.getVerticalOffsetForLineNumber(n.endLineNumber)+this._lineHeight;else return-1;const g=(t==="mouse"||i)&&this._cursorSurroundingLinesStyle==="default";let f=0,m=0;if(g)i||(f=this._lineHeight);else{const C=l/this._lineHeight,p=Math.max(this._cursorSurroundingLines,this._stickyScrollEnabled?this._maxNumberStickyLines:0),b=Math.min(C/2,p);f=b*this._lineHeight,m=Math.max(0,b-1)*this._lineHeight}i||(o===0||o===4)&&(m+=this._lineHeight),d-=f,u+=m;let _;if(u-d>l){if(!c)return-1;_=d}else if(o===5||o===6)if(o===6&&r<=d&&u<=h)_=r;else{const C=Math.max(5*this._lineHeight,l*.2),p=d-C,b=u-l;_=Math.max(b,p)}else if(o===1||o===2)if(o===2&&r<=d&&u<=h)_=r;else{const C=(d+u)/2;_=Math.max(0,C-l/2)}else _=this._computeMinimumScrolling(r,h,d,u,o===3,o===4);return _}_computeScrollLeftToReveal(e){const t=this._context.viewLayout.getCurrentViewport(),i=this._context.configuration.options.get(146),n=t.left,s=n+t.width-i.verticalScrollbarWidth;let o=1073741824,r=0;if(e.type==="range"){const h=this._visibleRangesForLineRange(e.lineNumber,e.startColumn,e.endColumn);if(!h)return null;for(const c of h.ranges)o=Math.min(o,Math.round(c.left)),r=Math.max(r,Math.round(c.left+c.width))}else for(const h of e.selections){if(h.startLineNumber!==h.endLineNumber)return null;const c=this._visibleRangesForLineRange(h.startLineNumber,h.startColumn,h.endColumn);if(!c)return null;for(const d of c.ranges)o=Math.min(o,Math.round(d.left)),r=Math.max(r,Math.round(d.left+d.width))}return e.minimalReveal||(o=Math.max(0,o-wr.HORIZONTAL_EXTRA_PX),r+=this._revealHorizontalRightPadding),e.type==="selections"&&r-o>t.width?null:{scrollLeft:this._computeMinimumScrolling(n,s,o,r),maxHorizontalOffset:r}}_computeMinimumScrolling(e,t,i,n,s,o){e=e|0,t=t|0,i=i|0,n=n|0,s=!!s,o=!!o;const r=t-e;if(n-i<r){if(s)return i;if(o)return Math.max(0,n-r);if(i<e)return i;if(n>t)return Math.max(0,n-r)}else return i;return e}};wr.HORIZONTAL_EXTRA_PX=30;let pl=wr;class US extends Ig{constructor(e){super(),this._context=e;const i=this._context.configuration.options.get(146);this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.options.linesDecorationsClassName,h=r.options.zIndex;l&&(i[n++]=new ml(r.range.startLineNumber,r.range.endLineNumber,l,r.options.linesDecorationsTooltip??null,h));const c=r.options.firstLineDecorationClassName;c&&(i[n++]=new ml(r.range.startLineNumber,r.range.startLineNumber,c,r.options.linesDecorationsTooltip??null,h))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=this._decorationsLeft.toString(),o=this._decorationsWidth.toString(),r='" style="left:'+s+"px;width:"+o+'px;"></div>',l=[];for(let h=t;h<=i;h++){const c=h-t,d=n[c].getDecorations();let u="";for(const g of d){let f='<div class="cldr '+g.className;g.tooltip!==null&&(f+='" title="'+g.tooltip),f+=r,u+=f}l[c]=u}this._renderResult=l}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}class jS extends Ig{constructor(e){super(),this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.options.marginClassName,h=r.options.zIndex;l&&(i[n++]=new ml(r.range.startLineNumber,r.range.endLineNumber,l,null,h))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=[];for(let o=t;o<=i;o++){const r=o-t,l=n[r].getDecorations();let h="";for(const c of l)h+='<div class="cmdr '+c.className+'" style=""></div>';s[r]=h}this._renderResult=s}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const Qt=class Qt{constructor(e,t,i,n){this._rgba8Brand=void 0,this.r=Qt._clamp(e),this.g=Qt._clamp(t),this.b=Qt._clamp(i),this.a=Qt._clamp(n)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}static _clamp(e){return e<0?0:e>255?255:e|0}};Qt.Empty=new Qt(0,0,0,0);let jt=Qt;const Lr=class Lr extends H{static getInstance(){return this._INSTANCE||(this._INSTANCE=va(new Lr)),this._INSTANCE}constructor(){super(),this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._updateColorMap(),this._register(ai.onDidChange(e=>{e.changedColorMap&&this._updateColorMap()}))}_updateColorMap(){const e=ai.getColorMap();if(!e){this._colors=[jt.Empty],this._backgroundIsLight=!0;return}this._colors=[jt.Empty];for(let i=1;i<e.length;i++){const n=e[i].rgba;this._colors[i]=new jt(n.r,n.g,n.b,Math.round(n.a*255))}const t=e[2].getRelativeLuminance();this._backgroundIsLight=t>=.5,this._onDidChange.fire(void 0)}getColor(e){return(e<1||e>=this._colors.length)&&(e=2),this._colors[e]}backgroundIsLight(){return this._backgroundIsLight}};Lr._INSTANCE=null;let sr=Lr;const $S=(()=>{const a=[];for(let e=32;e<=126;e++)a.push(e);return a.push(65533),a})(),GS=(a,e)=>(a-=32,a<0||a>96?e<=2?(a+96)%96:95:a);class Us{constructor(e,t){this.scale=t,this._minimapCharRendererBrand=void 0,this.charDataNormal=Us.soften(e,12/15),this.charDataLight=Us.soften(e,50/60)}static soften(e,t){const i=new Uint8ClampedArray(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=Zd(e[n]*t);return i}renderChar(e,t,i,n,s,o,r,l,h,c,d){const u=1*this.scale,g=2*this.scale,f=d?1:g;if(t+u>e.width||i+f>e.height){console.warn("bad render request outside image data");return}const m=c?this.charDataLight:this.charDataNormal,_=GS(n,h),C=e.width*4,p=r.r,b=r.g,w=r.b,L=s.r-p,S=s.g-b,y=s.b-w,N=Math.max(o,l),x=e.data;let R=_*u*g,k=i*C+t*4;for(let E=0;E<f;E++){let O=k;for(let z=0;z<u;z++){const j=m[R++]/255*(o/255);x[O++]=p+L*j,x[O++]=b+S*j,x[O++]=w+y*j,x[O++]=N}k+=C}}blockRenderChar(e,t,i,n,s,o,r,l){const h=1*this.scale,c=2*this.scale,d=l?1:c;if(t+h>e.width||i+d>e.height){console.warn("bad render request outside image data");return}const u=e.width*4,g=.5*(s/255),f=o.r,m=o.g,_=o.b,C=n.r-f,p=n.g-m,b=n.b-_,w=f+C*g,L=m+p*g,S=_+b*g,y=Math.max(s,r),N=e.data;let x=i*u+t*4;for(let R=0;R<d;R++){let k=x;for(let E=0;E<h;E++)N[k++]=w,N[k++]=L,N[k++]=S,N[k++]=y;x+=u}}}const sd={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},od=a=>{const e=new Uint8ClampedArray(a.length/2);for(let t=0;t<a.length;t+=2)e[t>>1]=sd[a[t]]<<4|sd[a[t+1]]&15;return e},rd={1:ka(()=>od("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:ka(()=>od("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};class bs{static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let i;return rd[e]?i=new Us(rd[e](),e):i=bs.createFromSampleData(bs.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=i,i}static createSampleData(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.style.height="16px",t.height=16,t.width=96*10,t.style.width=96*10+"px",i.fillStyle="#ffffff",i.font=`bold 16px ${e}`,i.textBaseline="middle";let n=0;for(const s of $S)i.fillText(String.fromCharCode(s),n,16/2),n+=10;return i.getImageData(0,0,96*10,16)}static createFromSampleData(e,t){if(e.length!==61440)throw new Error("Unexpected source in MinimapCharRenderer");const n=bs._downsample(e,t);return new Us(n,t)}static _downsampleChar(e,t,i,n,s){const o=1*s,r=2*s;let l=n,h=0;for(let c=0;c<r;c++){const d=c/r*16,u=(c+1)/r*16;for(let g=0;g<o;g++){const f=g/o*10,m=(g+1)/o*10;let _=0,C=0;for(let b=d;b<u;b++){const w=t+Math.floor(b)*3840,L=1-(b-Math.floor(b));for(let S=f;S<m;S++){const y=1-(S-Math.floor(S)),N=w+Math.floor(S)*4,x=y*L;C+=x,_+=e[N]*e[N+3]/255*x}}const p=_/C;h=Math.max(h,p),i[l++]=Zd(p)}}return h}static _downsample(e,t){const i=2*t*1*t,n=i*96,s=new Uint8ClampedArray(n);let o=0,r=0,l=0;for(let h=0;h<96;h++)l=Math.max(l,this._downsampleChar(e,r,s,o,t)),o+=i,r+=10*4;if(l>0){const h=255/l;for(let c=0;c<n;c++)s[c]*=h}return s}}const KS=qs?'"Segoe WPC", "Segoe UI", sans-serif':Ae?"-apple-system, BlinkMacSystemFont, sans-serif":'system-ui, "Ubuntu", "Droid Sans", sans-serif',qS=140,ZS=2;class Pn{constructor(e,t,i){const n=e.options,s=n.get(144),o=n.get(146),r=o.minimap,l=n.get(50),h=n.get(73);this.renderMinimap=r.renderMinimap,this.size=h.size,this.minimapHeightIsEditorHeight=r.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=n.get(106),this.paddingTop=n.get(84).top,this.paddingBottom=n.get(84).bottom,this.showSlider=h.showSlider,this.autohide=h.autohide,this.pixelRatio=s,this.typicalHalfwidthCharacterWidth=l.typicalHalfwidthCharacterWidth,this.lineHeight=n.get(67),this.minimapLeft=r.minimapLeft,this.minimapWidth=r.minimapWidth,this.minimapHeight=o.height,this.canvasInnerWidth=r.minimapCanvasInnerWidth,this.canvasInnerHeight=r.minimapCanvasInnerHeight,this.canvasOuterWidth=r.minimapCanvasOuterWidth,this.canvasOuterHeight=r.minimapCanvasOuterHeight,this.isSampling=r.minimapIsSampling,this.editorHeight=o.height,this.fontScale=r.minimapScale,this.minimapLineHeight=r.minimapLineHeight,this.minimapCharWidth=1*this.fontScale,this.sectionHeaderFontFamily=KS,this.sectionHeaderFontSize=h.sectionHeaderFontSize*s,this.sectionHeaderLetterSpacing=h.sectionHeaderLetterSpacing,this.sectionHeaderFontColor=Pn._getSectionHeaderColor(t,i.getColor(1)),this.charRenderer=ka(()=>bs.create(this.fontScale,l.fontFamily)),this.defaultBackgroundColor=i.getColor(2),this.backgroundColor=Pn._getMinimapBackground(t,this.defaultBackgroundColor),this.foregroundAlpha=Pn._getMinimapForegroundOpacity(t)}static _getMinimapBackground(e,t){const i=e.getColor($p);return i?new jt(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}static _getMinimapForegroundOpacity(e){const t=e.getColor(Gp);return t?jt._clamp(Math.round(255*t.rgba.a)):255}static _getSectionHeaderColor(e,t){const i=e.getColor(Kp);return i?new jt(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}equals(e){return this.renderMinimap===e.renderMinimap&&this.size===e.size&&this.minimapHeightIsEditorHeight===e.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===e.scrollBeyondLastLine&&this.paddingTop===e.paddingTop&&this.paddingBottom===e.paddingBottom&&this.showSlider===e.showSlider&&this.autohide===e.autohide&&this.pixelRatio===e.pixelRatio&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.lineHeight===e.lineHeight&&this.minimapLeft===e.minimapLeft&&this.minimapWidth===e.minimapWidth&&this.minimapHeight===e.minimapHeight&&this.canvasInnerWidth===e.canvasInnerWidth&&this.canvasInnerHeight===e.canvasInnerHeight&&this.canvasOuterWidth===e.canvasOuterWidth&&this.canvasOuterHeight===e.canvasOuterHeight&&this.isSampling===e.isSampling&&this.editorHeight===e.editorHeight&&this.fontScale===e.fontScale&&this.minimapLineHeight===e.minimapLineHeight&&this.minimapCharWidth===e.minimapCharWidth&&this.sectionHeaderFontSize===e.sectionHeaderFontSize&&this.sectionHeaderLetterSpacing===e.sectionHeaderLetterSpacing&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(e.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(e.backgroundColor)&&this.foregroundAlpha===e.foregroundAlpha}}class ws{constructor(e,t,i,n,s,o,r,l,h){this.scrollTop=e,this.scrollHeight=t,this.sliderNeeded=i,this._computedSliderRatio=n,this.sliderTop=s,this.sliderHeight=o,this.topPaddingLineCount=r,this.startLineNumber=l,this.endLineNumber=h}getDesiredScrollTopFromDelta(e){return Math.round(this.scrollTop+e/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(e){return Math.round((e-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(e){const t=Math.max(this.startLineNumber,e.startLineNumber),i=Math.min(this.endLineNumber,e.endLineNumber);return t>i?null:[t,i]}getYForLineNumber(e,t){return+(e-this.startLineNumber+this.topPaddingLineCount)*t}static create(e,t,i,n,s,o,r,l,h,c,d){const u=e.pixelRatio,g=e.minimapLineHeight,f=Math.floor(e.canvasInnerHeight/g),m=e.lineHeight;if(e.minimapHeightIsEditorHeight){let S=l*e.lineHeight+e.paddingTop+e.paddingBottom;e.scrollBeyondLastLine&&(S+=Math.max(0,s-e.lineHeight-e.paddingBottom));const y=Math.max(1,Math.floor(s*s/S)),N=Math.max(0,e.minimapHeight-y),x=N/(c-s),R=h*x,k=N>0,E=Math.floor(e.canvasInnerHeight/e.minimapLineHeight),O=Math.floor(e.paddingTop/e.lineHeight);return new ws(h,c,k,x,R,y,O,1,Math.min(r,E))}let _;if(o&&i!==r){const S=i-t+1;_=Math.floor(S*g/u)}else{const S=s/m;_=Math.floor(S*g/u)}const C=Math.floor(e.paddingTop/m);let p=Math.floor(e.paddingBottom/m);if(e.scrollBeyondLastLine){const S=s/m;p=Math.max(p,S-1)}let b;if(p>0){const S=s/m;b=(C+r+p-S-1)*g/u}else b=Math.max(0,(C+r)*g/u-_);b=Math.min(e.minimapHeight-_,b);const w=b/(c-s),L=h*w;if(f>=C+r+p){const S=b>0;return new ws(h,c,S,w,L,_,C,1,r)}else{let S;t>1?S=t+C:S=Math.max(1,h/m);let y,N=Math.max(1,Math.floor(S-L*u/g));N<C?(y=C-N+1,N=1):(y=0,N=Math.max(1,N-C)),d&&d.scrollHeight===c&&(d.scrollTop>h&&(N=Math.min(N,d.startLineNumber),y=Math.max(y,d.topPaddingLineCount)),d.scrollTop<h&&(N=Math.max(N,d.startLineNumber),y=Math.min(y,d.topPaddingLineCount)));const x=Math.min(r,N-y+f-1),R=(h-n)/m;let k;return h>=e.paddingTop?k=(t-N+y+R)*g/u:k=h/e.paddingTop*(y+R)*g/u,new ws(h,c,!0,w,k,_,y,N,x)}}}const vr=class vr{constructor(e){this.dy=e}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}};vr.INVALID=new vr(-1);let or=vr;class ad{constructor(e,t,i){this.renderedLayout=e,this._imageData=t,this._renderedLines=new xg({createLine:()=>or.INVALID}),this._renderedLines._set(e.startLineNumber,i)}linesEquals(e){if(!this.scrollEquals(e))return!1;const i=this._renderedLines._get().lines;for(let n=0,s=i.length;n<s;n++)if(i[n].dy===-1)return!1;return!0}scrollEquals(e){return this.renderedLayout.startLineNumber===e.startLineNumber&&this.renderedLayout.endLineNumber===e.endLineNumber}_get(){const e=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines}}onLinesChanged(e,t){return this._renderedLines.onLinesChanged(e,t)}onLinesDeleted(e,t){this._renderedLines.onLinesDeleted(e,t)}onLinesInserted(e,t){this._renderedLines.onLinesInserted(e,t)}onTokensChanged(e){return this._renderedLines.onTokensChanged(e)}}class mh{constructor(e,t,i,n){this._backgroundFillData=mh._createBackgroundFillData(t,i,n),this._buffers=[e.createImageData(t,i),e.createImageData(t,i)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const e=this._buffers[this._lastUsedBuffer];return e.data.set(this._backgroundFillData),e}static _createBackgroundFillData(e,t,i){const n=i.r,s=i.g,o=i.b,r=i.a,l=new Uint8ClampedArray(e*t*4);let h=0;for(let c=0;c<t;c++)for(let d=0;d<e;d++)l[h]=n,l[h+1]=s,l[h+2]=o,l[h+3]=r,h+=4;return l}}class js{static compute(e,t,i){if(e.renderMinimap===0||!e.isSampling)return[null,[]];const{minimapLineCount:n}=qp.computeContainedMinimapLineCount({viewLineCount:t,scrollBeyondLastLine:e.scrollBeyondLastLine,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:e.editorHeight,lineHeight:e.lineHeight,pixelRatio:e.pixelRatio}),s=t/n,o=s/2;if(!i||i.minimapLines.length===0){const _=[];if(_[0]=1,n>1){for(let C=0,p=n-1;C<p;C++)_[C]=Math.round(C*s+o);_[n-1]=t}return[new js(s,_),[]]}const r=i.minimapLines,l=r.length,h=[];let c=0,d=0,u=1;const g=10;let f=[],m=null;for(let _=0;_<n;_++){const C=Math.max(u,Math.round(_*s)),p=Math.max(C,Math.round((_+1)*s));for(;c<l&&r[c]<C;){if(f.length<g){const w=c+1+d;m&&m.type==="deleted"&&m._oldIndex===c-1?m.deleteToLineNumber++:(m={type:"deleted",_oldIndex:c,deleteFromLineNumber:w,deleteToLineNumber:w},f.push(m)),d--}c++}let b;if(c<l&&r[c]<=p)b=r[c],c++;else if(_===0?b=1:_+1===n?b=t:b=Math.round(_*s+o),f.length<g){const w=c+1+d;m&&m.type==="inserted"&&m._i===_-1?m.insertToLineNumber++:(m={type:"inserted",_i:_,insertFromLineNumber:w,insertToLineNumber:w},f.push(m)),d++}h[_]=b,u=b}if(f.length<g)for(;c<l;){const _=c+1+d;m&&m.type==="deleted"&&m._oldIndex===c-1?m.deleteToLineNumber++:(m={type:"deleted",_oldIndex:c,deleteFromLineNumber:_,deleteToLineNumber:_},f.push(m)),d--,c++}else f=[{type:"flush"}];return[new js(s,h),f]}constructor(e,t){this.samplingRatio=e,this.minimapLines=t}modelLineToMinimapLine(e){return Math.min(this.minimapLines.length,Math.max(1,Math.round(e/this.samplingRatio)))}modelLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e)-1;for(;i>0&&this.minimapLines[i-1]>=e;)i--;let n=this.modelLineToMinimapLine(t)-1;for(;n+1<this.minimapLines.length&&this.minimapLines[n+1]<=t;)n++;if(i===n){const s=this.minimapLines[i];if(s<e||s>t)return null}return[i+1,n+1]}decorationLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e),n=this.modelLineToMinimapLine(t);return e!==t&&n===i&&(n===this.minimapLines.length?i>1&&i--:n++),[i,n]}onLinesDeleted(e){const t=e.toLineNumber-e.fromLineNumber+1;let i=this.minimapLines.length,n=0;for(let s=this.minimapLines.length-1;s>=0&&!(this.minimapLines[s]<e.fromLineNumber);s--)this.minimapLines[s]<=e.toLineNumber?(this.minimapLines[s]=Math.max(1,e.fromLineNumber-1),i=Math.min(i,s),n=Math.max(n,s)):this.minimapLines[s]-=t;return[i,n]}onLinesInserted(e){const t=e.toLineNumber-e.fromLineNumber+1;for(let i=this.minimapLines.length-1;i>=0&&!(this.minimapLines[i]<e.fromLineNumber);i--)this.minimapLines[i]+=t}}class QS extends Ye{constructor(e){super(e),this._sectionHeaderCache=new Xd(10,1.5),this.tokensColorTracker=sr.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new Pn(this._context.configuration,this._context.theme,this.tokensColorTracker);const[t]=js.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=t,this._shouldCheckSampling=!1,this._actual=new pn(e.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const e=new Pn(this._context.configuration,this._context.theme,this.tokensColorTracker);return this.options.equals(e)?!1:(this.options=e,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(e){return this._onOptionsMaybeChanged()}onCursorStateChanged(e){return this._selections=e.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(e){return e.affectsMinimap?this._actual.onDecorationsChanged():!1}onFlushed(e){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(e){if(this._samplingState){const t=this._samplingState.modelLineRangeToMinimapLineRange(e.fromLineNumber,e.fromLineNumber+e.count-1);return t?this._actual.onLinesChanged(t[0],t[1]-t[0]+1):!1}else return this._actual.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){if(this._samplingState){const[t,i]=this._samplingState.onLinesDeleted(e);return t<=i&&this._actual.onLinesChanged(t+1,i-t+1),this._shouldCheckSampling=!0,!0}else return this._actual.onLinesDeleted(e.fromLineNumber,e.toLineNumber)}onLinesInserted(e){return this._samplingState?(this._samplingState.onLinesInserted(e),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(e.fromLineNumber,e.toLineNumber)}onScrollChanged(e){return this._actual.onScrollChanged()}onThemeChanged(e){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(e){if(this._samplingState){const t=[];for(const i of e.ranges){const n=this._samplingState.modelLineRangeToMinimapLineRange(i.fromLineNumber,i.toLineNumber);n&&t.push({fromLineNumber:n[0],toLineNumber:n[1]})}return t.length?this._actual.onTokensChanged(t):!1}else return this._actual.onTokensChanged(e.ranges)}onTokensColorsChanged(e){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(e){return this._actual.onZonesChanged()}prepareRender(e){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(e){let t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber;this._samplingState&&(t=this._samplingState.modelLineToMinimapLine(t),i=this._samplingState.modelLineToMinimapLine(i));const n={viewportContainsWhitespaceGaps:e.viewportData.whitespaceViewportData.length>0,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,viewportStartLineNumber:t,viewportEndLineNumber:i,viewportStartLineNumberVerticalOffset:e.getVerticalOffsetForLineNumber(t),scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight};this._actual.render(n)}_recreateLineSampling(){this._minimapSelections=null;const e=!!this._samplingState,[t,i]=js.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=t,e&&this._samplingState)for(const n of i)switch(n.type){case"deleted":this._actual.onLinesDeleted(n.deleteFromLineNumber,n.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(n.insertFromLineNumber,n.insertToLineNumber);break;case"flush":this._actual.onFlushed();break}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(e){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineContent(e)}getLineMaxColumn(e){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineMaxColumn(e)}getMinimapLinesRenderingData(e,t,i){if(this._samplingState){const n=[];for(let s=0,o=t-e+1;s<o;s++)i[s]?n[s]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[e+s-1]):n[s]=null;return n}return this._context.viewModel.getMinimapLinesRenderingData(e,t,i).data}getSelections(){if(this._minimapSelections===null)if(this._samplingState){this._minimapSelections=[];for(const e of this._selections){const[t,i]=this._samplingState.decorationLineRangeToMinimapLineRange(e.startLineNumber,e.endLineNumber);this._minimapSelections.push(new te(t,e.startColumn,i,e.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(e,t){const i=this._getMinimapDecorationsInViewport(e,t).filter(n=>{var s;return!((s=n.options.minimap)!=null&&s.sectionHeaderStyle)});if(this._samplingState){const n=[];for(const s of i){if(!s.options.minimap)continue;const o=s.range,r=this._samplingState.modelLineToMinimapLine(o.startLineNumber),l=this._samplingState.modelLineToMinimapLine(o.endLineNumber);n.push(new fg(new v(r,o.startColumn,l,o.endColumn),s.options))}return n}return i}getSectionHeaderDecorationsInViewport(e,t){const i=this.options.minimapLineHeight,s=this.options.sectionHeaderFontSize/i;return e=Math.floor(Math.max(1,e-s)),this._getMinimapDecorationsInViewport(e,t).filter(o=>{var r;return!!((r=o.options.minimap)!=null&&r.sectionHeaderStyle)})}_getMinimapDecorationsInViewport(e,t){let i;if(this._samplingState){const n=this._samplingState.minimapLines[e-1],s=this._samplingState.minimapLines[t-1];i=new v(n,1,s,this._context.viewModel.getLineMaxColumn(s))}else i=new v(e,1,t,this._context.viewModel.getLineMaxColumn(t));return this._context.viewModel.getMinimapDecorationsInRange(i)}getSectionHeaderText(e,t){var o;const i=(o=e.options.minimap)==null?void 0:o.sectionHeaderText;if(!i)return null;const n=this._sectionHeaderCache.get(i);if(n)return n;const s=t(i);return this._sectionHeaderCache.set(i,s),s}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(e){this._samplingState&&(e=this._samplingState.minimapLines[e-1]),this._context.viewModel.revealRange("mouse",!1,new v(e,1,e,1),1,0)}setScrollTop(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e},1)}}class pn extends H{constructor(e,t){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._theme=e,this._model=t,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(Gh),this._domNode=Q(document.createElement("div")),ft.write(this._domNode,9),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=Q(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=Q(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=Q(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=Q(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=Q(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._pointerDownListener=ni(this._domNode.domNode,oe.POINTER_DOWN,i=>{if(i.preventDefault(),this._model.options.renderMinimap===0||!this._lastRenderData)return;if(this._model.options.size!=="proportional"){if(i.button===0&&this._lastRenderData){const h=Wn(this._slider.domNode),c=h.top+h.height/2;this._startSliderDragging(i,c,this._lastRenderData.renderedLayout)}return}const s=this._model.options.minimapLineHeight,o=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*i.offsetY;let l=Math.floor(o/s)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;l=Math.min(l,this._model.getLineCount()),this._model.revealLineNumber(l)}),this._sliderPointerMoveMonitor=new ru,this._sliderPointerDownListener=ni(this._slider.domNode,oe.POINTER_DOWN,i=>{i.preventDefault(),i.stopPropagation(),i.button===0&&this._lastRenderData&&this._startSliderDragging(i,i.pageY,this._lastRenderData.renderedLayout)}),this._gestureDisposable=$t.addTarget(this._domNode.domNode),this._sliderTouchStartListener=F(this._domNode.domNode,Ne.Start,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(i))},{passive:!1}),this._sliderTouchMoveListener=F(this._domNode.domNode,Ne.Change,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(i)},{passive:!1}),this._sliderTouchEndListener=ni(this._domNode.domNode,Ne.End,i=>{i.preventDefault(),i.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)})}_startSliderDragging(e,t,i){if(!e.target||!(e.target instanceof Element))return;const n=e.pageX;this._slider.toggleClassName("active",!0);const s=(o,r)=>{const l=Wn(this._domNode.domNode),h=Math.min(Math.abs(r-n),Math.abs(r-l.left),Math.abs(r-l.left-l.width));if(qs&&h>qS){this._model.setScrollTop(i.scrollTop);return}const c=o-t;this._model.setScrollTop(i.getDesiredScrollTopFromDelta(c))};e.pageY!==t&&s(e.pageY,n),this._sliderPointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,o=>s(o.pageY,o.pageX),()=>{this._slider.toggleClassName("active",!1)})}scrollDueToTouchEvent(e){const t=this._domNode.domNode.getBoundingClientRect().top,i=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(e.pageY-t);this._model.setScrollTop(i)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const e=["minimap"];return this._model.options.showSlider==="always"?e.push("slider-always"):e.push("slider-mouseover"),this._model.options.autohide&&e.push("autohide"),e.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new mh(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(e,t){return this._lastRenderData?this._lastRenderData.onLinesChanged(e,t):!1}onLinesDeleted(e,t){var i;return(i=this._lastRenderData)==null||i.onLinesDeleted(e,t),!0}onLinesInserted(e,t){var i;return(i=this._lastRenderData)==null||i.onLinesInserted(e,t),!0}onScrollChanged(){return this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(Gh),this._renderDecorations=!0,!0}onTokensChanged(e){return this._lastRenderData?this._lastRenderData.onTokensChanged(e):!1}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(e){if(this._model.options.renderMinimap===0){this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),this._sliderHorizontal.setHeight(0);return}e.scrollLeft+e.viewportWidth>=e.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const i=ws.create(this._model.options,e.viewportStartLineNumber,e.viewportEndLineNumber,e.viewportStartLineNumberVerticalOffset,e.viewportHeight,e.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),e.scrollTop,e.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(i.sliderNeeded?"block":"none"),this._slider.setTop(i.sliderTop),this._slider.setHeight(i.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(i.sliderHeight),this.renderDecorations(i),this._lastRenderData=this.renderLines(i)}renderDecorations(e){if(this._renderDecorations){this._renderDecorations=!1;const t=this._model.getSelections();t.sort(v.compareRangesUsingStarts);const i=this._model.getMinimapDecorationsInViewport(e.startLineNumber,e.endLineNumber);i.sort((u,g)=>(u.options.zIndex||0)-(g.options.zIndex||0));const{canvasInnerWidth:n,canvasInnerHeight:s}=this._model.options,o=this._model.options.minimapLineHeight,r=this._model.options.minimapCharWidth,l=this._model.getOptions().tabSize,h=this._decorationsCanvas.domNode.getContext("2d");h.clearRect(0,0,n,s);const c=new ld(e.startLineNumber,e.endLineNumber,!1);this._renderSelectionLineHighlights(h,t,c,e,o),this._renderDecorationsLineHighlights(h,i,c,e,o);const d=new ld(e.startLineNumber,e.endLineNumber,null);this._renderSelectionsHighlights(h,t,d,e,o,l,r,n),this._renderDecorationsHighlights(h,i,d,e,o,l,r,n),this._renderSectionHeaders(e)}}_renderSelectionLineHighlights(e,t,i,n,s){if(!this._selectionColor||this._selectionColor.isTransparent())return;e.fillStyle=this._selectionColor.transparent(.5).toString();let o=0,r=0;for(const l of t){const h=n.intersectWithViewport(l);if(!h)continue;const[c,d]=h;for(let f=c;f<=d;f++)i.set(f,!0);const u=n.getYForLineNumber(c,s),g=n.getYForLineNumber(d,s);r>=u||(r>o&&e.fillRect(Et,o,e.canvas.width,r-o),o=u),r=g}r>o&&e.fillRect(Et,o,e.canvas.width,r-o)}_renderDecorationsLineHighlights(e,t,i,n,s){const o=new Map;for(let r=t.length-1;r>=0;r--){const l=t[r],h=l.options.minimap;if(!h||h.position!==1)continue;const c=n.intersectWithViewport(l.range);if(!c)continue;const[d,u]=c,g=h.getColor(this._theme.value);if(!g||g.isTransparent())continue;let f=o.get(g.toString());f||(f=g.transparent(.5).toString(),o.set(g.toString(),f)),e.fillStyle=f;for(let m=d;m<=u;m++){if(i.has(m))continue;i.set(m,!0);const _=n.getYForLineNumber(d,s);e.fillRect(Et,_,e.canvas.width,s)}}}_renderSelectionsHighlights(e,t,i,n,s,o,r,l){if(!(!this._selectionColor||this._selectionColor.isTransparent()))for(const h of t){const c=n.intersectWithViewport(h);if(!c)continue;const[d,u]=c;for(let g=d;g<=u;g++)this.renderDecorationOnLine(e,i,h,this._selectionColor,n,g,s,s,o,r,l)}}_renderDecorationsHighlights(e,t,i,n,s,o,r,l){for(const h of t){const c=h.options.minimap;if(!c)continue;const d=n.intersectWithViewport(h.range);if(!d)continue;const[u,g]=d,f=c.getColor(this._theme.value);if(!(!f||f.isTransparent()))for(let m=u;m<=g;m++)switch(c.position){case 1:this.renderDecorationOnLine(e,i,h.range,f,n,m,s,s,o,r,l);continue;case 2:{const _=n.getYForLineNumber(m,s);this.renderDecoration(e,f,2,_,ZS,s);continue}}}}renderDecorationOnLine(e,t,i,n,s,o,r,l,h,c,d){const u=s.getYForLineNumber(o,l);if(u+r<0||u>this._model.options.canvasInnerHeight)return;const{startLineNumber:g,endLineNumber:f}=i,m=g===o?i.startColumn:1,_=f===o?i.endColumn:this._model.getLineMaxColumn(o),C=this.getXOffsetForPosition(t,o,m,h,c,d),p=this.getXOffsetForPosition(t,o,_,h,c,d);this.renderDecoration(e,n,C,u,p-C,r)}getXOffsetForPosition(e,t,i,n,s,o){if(i===1)return Et;if((i-1)*s>=o)return o;let l=e.get(t);if(!l){const h=this._model.getLineContent(t);l=[Et];let c=Et;for(let d=1;d<h.length+1;d++){const u=h.charCodeAt(d-1),g=u===9?n*s:ri(u)?2*s:s,f=c+g;if(f>=o){l[d]=o;break}l[d]=f,c=f}e.set(t,l)}return i-1<l.length?l[i-1]:o}renderDecoration(e,t,i,n,s,o){e.fillStyle=t&&t.toString()||"",e.fillRect(i,n,s,o)}_renderSectionHeaders(e){var m;const t=this._model.options.minimapLineHeight,i=this._model.options.sectionHeaderFontSize,n=this._model.options.sectionHeaderLetterSpacing,s=i*1.5,{canvasInnerWidth:o}=this._model.options,r=this._model.options.backgroundColor,l=`rgb(${r.r} ${r.g} ${r.b} / .7)`,h=this._model.options.sectionHeaderFontColor,c=`rgb(${h.r} ${h.g} ${h.b})`,d=c,u=this._decorationsCanvas.domNode.getContext("2d");u.letterSpacing=n+"px",u.font="500 "+i+"px "+this._model.options.sectionHeaderFontFamily,u.strokeStyle=d,u.lineWidth=.2;const g=this._model.getSectionHeaderDecorationsInViewport(e.startLineNumber,e.endLineNumber);g.sort((_,C)=>_.range.startLineNumber-C.range.startLineNumber);const f=pn._fitSectionHeader.bind(null,u,o-Et);for(const _ of g){const C=e.getYForLineNumber(_.range.startLineNumber,t)+i,p=C-i,b=p+2,w=this._model.getSectionHeaderText(_,f);pn._renderSectionLabel(u,w,((m=_.options.minimap)==null?void 0:m.sectionHeaderStyle)===2,l,c,o,p,s,C,b)}}static _fitSectionHeader(e,t,i){if(!i)return i;const n="…",s=e.measureText(i).width,o=e.measureText(n).width;if(s<=t||s<=o)return i;const r=i.length,l=s/i.length,h=Math.floor((t-o)/l)-1;let c=Math.ceil(h/2);for(;c>0&&/\s/.test(i[c-1]);)--c;return i.substring(0,c)+n+i.substring(r-(h-c))}static _renderSectionLabel(e,t,i,n,s,o,r,l,h,c){t&&(e.fillStyle=n,e.fillRect(0,r,o,l),e.fillStyle=s,e.fillText(t,Et,h)),i&&(e.beginPath(),e.moveTo(0,c),e.lineTo(o,c),e.closePath(),e.stroke())}renderLines(e){const t=e.startLineNumber,i=e.endLineNumber,n=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(e)){const j=this._lastRenderData._get();return new ad(e,j.imageData,j.lines)}const s=this._getBuffer();if(!s)return null;const[o,r,l]=pn._renderUntouchedLines(s,e.topPaddingLineCount,t,i,n,this._lastRenderData),h=this._model.getMinimapLinesRenderingData(t,i,l),c=this._model.getOptions().tabSize,d=this._model.options.defaultBackgroundColor,u=this._model.options.backgroundColor,g=this._model.options.foregroundAlpha,f=this._model.tokensColorTracker,m=f.backgroundIsLight(),_=this._model.options.renderMinimap,C=this._model.options.charRenderer(),p=this._model.options.fontScale,b=this._model.options.minimapCharWidth,L=(_===1?2:3)*p,S=n>L?Math.floor((n-L)/2):0,y=u.a/255,N=new jt(Math.round((u.r-d.r)*y+d.r),Math.round((u.g-d.g)*y+d.g),Math.round((u.b-d.b)*y+d.b),255);let x=e.topPaddingLineCount*n;const R=[];for(let j=0,ie=i-t+1;j<ie;j++)l[j]&&pn._renderLine(s,N,u.a,m,_,b,f,g,C,x,S,c,h[j],p,n),R[j]=new or(x),x+=n;const k=o===-1?0:o,O=(r===-1?s.height:r)-k;return this._canvas.domNode.getContext("2d").putImageData(s,0,0,0,k,s.width,O),new ad(e,s,R)}static _renderUntouchedLines(e,t,i,n,s,o){const r=[];if(!o){for(let x=0,R=n-i+1;x<R;x++)r[x]=!0;return[-1,-1,r]}const l=o._get(),h=l.imageData.data,c=l.rendLineNumberStart,d=l.lines,u=d.length,g=e.width,f=e.data,m=(n-i+1)*s*g*4;let _=-1,C=-1,p=-1,b=-1,w=-1,L=-1,S=t*s;for(let x=i;x<=n;x++){const R=x-i,k=x-c,E=k>=0&&k<u?d[k].dy:-1;if(E===-1){r[R]=!0,S+=s;continue}const O=E*g*4,z=(E+s)*g*4,j=S*g*4,ie=(S+s)*g*4;b===O&&L===j?(b=z,L=ie):(p!==-1&&(f.set(h.subarray(p,b),w),_===-1&&p===0&&p===w&&(_=b),C===-1&&b===m&&p===w&&(C=p)),p=O,b=z,w=j,L=ie),r[R]=!1,S+=s}p!==-1&&(f.set(h.subarray(p,b),w),_===-1&&p===0&&p===w&&(_=b),C===-1&&b===m&&p===w&&(C=p));const y=_===-1?-1:_/(g*4),N=C===-1?-1:C/(g*4);return[y,N,r]}static _renderLine(e,t,i,n,s,o,r,l,h,c,d,u,g,f,m){const _=g.content,C=g.tokens,p=e.width-o,b=m===1;let w=Et,L=0,S=0;for(let y=0,N=C.getCount();y<N;y++){const x=C.getEndOffset(y),R=C.getForeground(y),k=r.getColor(R);for(;L<x;L++){if(w>p)return;const E=_.charCodeAt(L);if(E===9){const O=u-(L+S)%u;S+=O-1,w+=O*o}else if(E===32)w+=o;else{const O=ri(E)?2:1;for(let z=0;z<O;z++)if(s===2?h.blockRenderChar(e,w,c+d,k,l,t,i,b):h.renderChar(e,w,c+d,E,k,l,t,i,f,n,b),w+=o,w>p)return}}}}}class ld{constructor(e,t,i){this._startLineNumber=e,this._endLineNumber=t,this._defaultValue=i,this._values=[];for(let n=0,s=this._endLineNumber-this._startLineNumber+1;n<s;n++)this._values[n]=i}has(e){return this.get(e)!==this._defaultValue}set(e,t){e<this._startLineNumber||e>this._endLineNumber||(this._values[e-this._startLineNumber]=t)}get(e){return e<this._startLineNumber||e>this._endLineNumber?this._defaultValue:this._values[e-this._startLineNumber]}}class YS extends Ye{constructor(e,t){super(e),this._viewDomNode=t;const n=this._context.configuration.options.get(146);this._widgets={},this._verticalScrollbarWidth=n.verticalScrollbarWidth,this._minimapWidth=n.minimap.minimapWidth,this._horizontalScrollbarHeight=n.horizontalScrollbarHeight,this._editorHeight=n.height,this._editorWidth=n.width,this._viewDomNodeRect={top:0,left:0,width:0,height:0},this._domNode=Q(document.createElement("div")),ft.write(this._domNode,4),this._domNode.setClassName("overlayWidgets"),this.overflowingOverlayWidgetsDomNode=Q(document.createElement("div")),ft.write(this.overflowingOverlayWidgetsDomNode,5),this.overflowingOverlayWidgetsDomNode.setClassName("overflowingOverlayWidgets")}dispose(){super.dispose(),this._widgets={}}getDomNode(){return this._domNode}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._verticalScrollbarWidth=i.verticalScrollbarWidth,this._minimapWidth=i.minimap.minimapWidth,this._horizontalScrollbarHeight=i.horizontalScrollbarHeight,this._editorHeight=i.height,this._editorWidth=i.width,!0}addWidget(e){const t=Q(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:null,domNode:t},t.setPosition("absolute"),t.setAttribute("widgetId",e.getId()),e.allowEditorOverflow?this.overflowingOverlayWidgetsDomNode.appendChild(t):this._domNode.appendChild(t),this.setShouldRender(),this._updateMaxMinWidth()}setWidgetPosition(e,t){const i=this._widgets[e.getId()],n=t?t.preference:null,s=t==null?void 0:t.stackOridinal;return i.preference===n&&i.stack===s?(this._updateMaxMinWidth(),!1):(i.preference=n,i.stack=s,this.setShouldRender(),this._updateMaxMinWidth(),!0)}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender(),this._updateMaxMinWidth()}}_updateMaxMinWidth(){var i,n;let e=0;const t=Object.keys(this._widgets);for(let s=0,o=t.length;s<o;s++){const r=t[s],h=(n=(i=this._widgets[r].widget).getMinContentWidthInPx)==null?void 0:n.call(i);typeof h<"u"&&(e=Math.max(e,h))}this._context.viewLayout.setOverlayWidgetsMinWidth(e)}_renderWidget(e,t){const i=e.domNode;if(e.preference===null){i.setTop("");return}const n=2*this._verticalScrollbarWidth+this._minimapWidth;if(e.preference===0||e.preference===1){if(e.preference===1){const s=i.domNode.clientHeight;i.setTop(this._editorHeight-s-2*this._horizontalScrollbarHeight)}else i.setTop(0);e.stack!==void 0?(i.setTop(t[e.preference]),t[e.preference]+=i.domNode.clientWidth):i.setRight(n)}else if(e.preference===2)i.domNode.style.right="50%",e.stack!==void 0?(i.setTop(t[2]),t[2]+=i.domNode.clientHeight):i.setTop(0);else{const{top:s,left:o}=e.preference;if(this._context.configuration.options.get(42)&&e.widget.allowEditorOverflow){const l=this._viewDomNodeRect;i.setTop(s+l.top),i.setLeft(o+l.left),i.setPosition("fixed")}else i.setTop(s),i.setLeft(o),i.setPosition("absolute")}}prepareRender(e){this._viewDomNodeRect=Wn(this._viewDomNode.domNode)}render(e){this._domNode.setWidth(this._editorWidth);const t=Object.keys(this._widgets),i=Array.from({length:3},()=>0);t.sort((n,s)=>(this._widgets[n].stack||0)-(this._widgets[s].stack||0));for(let n=0,s=t.length;n<s;n++){const o=t[n];this._renderWidget(this._widgets[o],i)}}}class XS{constructor(e,t){const i=e.options;this.lineHeight=i.get(67),this.pixelRatio=i.get(144),this.overviewRulerLanes=i.get(83),this.renderBorder=i.get(82);const n=t.getColor(Tb);this.borderColor=n?n.toString():null,this.hideCursor=i.get(59);const s=t.getColor(Br);this.cursorColorSingle=s?s.transparent(.7).toString():null;const o=t.getColor(Bu);this.cursorColorPrimary=o?o.transparent(.7).toString():null;const r=t.getColor(Fu);this.cursorColorSecondary=r?r.transparent(.7).toString():null,this.themeType=t.type;const l=i.get(73),h=l.enabled,c=l.side,d=t.getColor(Eb),u=ai.getDefaultBackground();d?this.backgroundColor=d:h&&c==="right"?this.backgroundColor=u:this.backgroundColor=null;const f=i.get(146).overviewRuler;this.top=f.top,this.right=f.right,this.domWidth=f.width,this.domHeight=f.height,this.overviewRulerLanes===0?(this.canvasWidth=0,this.canvasHeight=0):(this.canvasWidth=this.domWidth*this.pixelRatio|0,this.canvasHeight=this.domHeight*this.pixelRatio|0);const[m,_]=this._initLanes(1,this.canvasWidth,this.overviewRulerLanes);this.x=m,this.w=_}_initLanes(e,t,i){const n=t-e;if(i>=3){const s=Math.floor(n/3),o=Math.floor(n/3),r=n-s-o,l=e,h=l+s,c=l+s+r;return[[0,l,h,l,c,l,h,l],[0,s,r,s+r,o,s+r+o,r+o,s+r+o]]}else if(i===2){const s=Math.floor(n/2),o=n-s,r=e,l=r+s;return[[0,r,r,r,l,r,r,r],[0,s,s,s,o,s+o,s+o,s+o]]}else{const s=e,o=n;return[[0,s,s,s,s,s,s,s],[0,o,o,o,o,o,o,o]]}}equals(e){return this.lineHeight===e.lineHeight&&this.pixelRatio===e.pixelRatio&&this.overviewRulerLanes===e.overviewRulerLanes&&this.renderBorder===e.renderBorder&&this.borderColor===e.borderColor&&this.hideCursor===e.hideCursor&&this.cursorColorSingle===e.cursorColorSingle&&this.cursorColorPrimary===e.cursorColorPrimary&&this.cursorColorSecondary===e.cursorColorSecondary&&this.themeType===e.themeType&&le.equals(this.backgroundColor,e.backgroundColor)&&this.top===e.top&&this.right===e.right&&this.domWidth===e.domWidth&&this.domHeight===e.domHeight&&this.canvasWidth===e.canvasWidth&&this.canvasHeight===e.canvasHeight}}class JS extends Ye{constructor(e){super(e),this._actualShouldRender=0,this._renderedDecorations=[],this._renderedCursorPositions=[],this._domNode=Q(document.createElement("canvas")),this._domNode.setClassName("decorationsOverviewRuler"),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._domNode.setAttribute("aria-hidden","true"),this._updateSettings(!1),this._tokensColorTrackerListener=ai.onDidChange(t=>{t.changedColorMap&&this._updateSettings(!0)}),this._cursorPositions=[{position:new D(1,1),color:this._settings.cursorColorSingle}]}dispose(){super.dispose(),this._tokensColorTrackerListener.dispose()}_updateSettings(e){const t=new XS(this._context.configuration,this._context.theme);return this._settings&&this._settings.equals(t)?!1:(this._settings=t,this._domNode.setTop(this._settings.top),this._domNode.setRight(this._settings.right),this._domNode.setWidth(this._settings.domWidth),this._domNode.setHeight(this._settings.domHeight),this._domNode.domNode.width=this._settings.canvasWidth,this._domNode.domNode.height=this._settings.canvasHeight,e&&this._render(),!0)}_markRenderingIsNeeded(){return this._actualShouldRender=2,!0}_markRenderingIsMaybeNeeded(){return this._actualShouldRender=1,!0}onConfigurationChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}onCursorStateChanged(e){this._cursorPositions=[];for(let t=0,i=e.selections.length;t<i;t++){let n=this._settings.cursorColorSingle;i>1&&(n=t===0?this._settings.cursorColorPrimary:this._settings.cursorColorSecondary),this._cursorPositions.push({position:e.selections[t].getPosition(),color:n})}return this._cursorPositions.sort((t,i)=>D.compare(t.position,i.position)),this._markRenderingIsMaybeNeeded()}onDecorationsChanged(e){return e.affectsOverviewRuler?this._markRenderingIsMaybeNeeded():!1}onFlushed(e){return this._markRenderingIsNeeded()}onScrollChanged(e){return e.scrollHeightChanged?this._markRenderingIsNeeded():!1}onZonesChanged(e){return this._markRenderingIsNeeded()}onThemeChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}getDomNode(){return this._domNode.domNode}prepareRender(e){}render(e){this._render(),this._actualShouldRender=0}_render(){const e=this._settings.backgroundColor;if(this._settings.overviewRulerLanes===0){this._domNode.setBackgroundColor(e?le.Format.CSS.formatHexA(e):""),this._domNode.setDisplay("none");return}const t=this._context.viewModel.getAllOverviewRulerDecorations(this._context.theme);if(t.sort(Vs.compareByRenderingProps),this._actualShouldRender===1&&!Vs.equalsArr(this._renderedDecorations,t)&&(this._actualShouldRender=2),this._actualShouldRender===1&&!Nt(this._renderedCursorPositions,this._cursorPositions,(f,m)=>f.position.lineNumber===m.position.lineNumber&&f.color===m.color)&&(this._actualShouldRender=2),this._actualShouldRender===1)return;this._renderedDecorations=t,this._renderedCursorPositions=this._cursorPositions,this._domNode.setDisplay("block");const i=this._settings.canvasWidth,n=this._settings.canvasHeight,s=this._settings.lineHeight,o=this._context.viewLayout,r=this._context.viewLayout.getScrollHeight(),l=n/r,h=6*this._settings.pixelRatio|0,c=h/2|0,d=this._domNode.domNode.getContext("2d");e?e.isOpaque()?(d.fillStyle=le.Format.CSS.formatHexA(e),d.fillRect(0,0,i,n)):(d.clearRect(0,0,i,n),d.fillStyle=le.Format.CSS.formatHexA(e),d.fillRect(0,0,i,n)):d.clearRect(0,0,i,n);const u=this._settings.x,g=this._settings.w;for(const f of t){const m=f.color,_=f.data;d.fillStyle=m;let C=0,p=0,b=0;for(let w=0,L=_.length/3;w<L;w++){const S=_[3*w],y=_[3*w+1],N=_[3*w+2];let x=o.getVerticalOffsetForLineNumber(y)*l|0,R=(o.getVerticalOffsetForLineNumber(N)+s)*l|0;if(R-x<h){let E=(x+R)/2|0;E<c?E=c:E+c>n&&(E=n-c),x=E-c,R=E+c}x>b+1||S!==C?(w!==0&&d.fillRect(u[C],p,g[C],b-p),C=S,p=x,b=R):R>b&&(b=R)}d.fillRect(u[C],p,g[C],b-p)}if(!this._settings.hideCursor){const f=2*this._settings.pixelRatio|0,m=f/2|0,_=this._settings.x[7],C=this._settings.w[7];let p=-100,b=-100,w=null;for(let L=0,S=this._cursorPositions.length;L<S;L++){const y=this._cursorPositions[L].color;if(!y)continue;const N=this._cursorPositions[L].position;let x=o.getVerticalOffsetForLineNumber(N.lineNumber)*l|0;x<m?x=m:x+m>n&&(x=n-m);const R=x-m,k=R+f;R>b+1||y!==w?(L!==0&&w&&d.fillRect(_,p,C,b-p),p=R,b=k):k>b&&(b=k),w=y,d.fillStyle=y}w&&d.fillRect(_,p,C,b-p)}this._settings.renderBorder&&this._settings.borderColor&&this._settings.overviewRulerLanes>0&&(d.beginPath(),d.lineWidth=1,d.strokeStyle=this._settings.borderColor,d.moveTo(0,0),d.lineTo(0,n),d.moveTo(1,0),d.lineTo(i,0),d.stroke())}}class hd{constructor(e,t,i){this._colorZoneBrand=void 0,this.from=e|0,this.to=t|0,this.colorId=i|0}static compare(e,t){return e.colorId===t.colorId?e.from===t.from?e.to-t.to:e.from-t.from:e.colorId-t.colorId}}class e0{constructor(e,t,i,n){this._overviewRulerZoneBrand=void 0,this.startLineNumber=e,this.endLineNumber=t,this.heightInLines=i,this.color=n,this._colorZone=null}static compare(e,t){return e.color===t.color?e.startLineNumber===t.startLineNumber?e.heightInLines===t.heightInLines?e.endLineNumber-t.endLineNumber:e.heightInLines-t.heightInLines:e.startLineNumber-t.startLineNumber:e.color<t.color?-1:1}setColorZone(e){this._colorZone=e}getColorZones(){return this._colorZone}}class t0{constructor(e){this._getVerticalOffsetForLine=e,this._zones=[],this._colorZonesInvalid=!1,this._lineHeight=0,this._domWidth=0,this._domHeight=0,this._outerHeight=0,this._pixelRatio=1,this._lastAssignedId=0,this._color2Id=Object.create(null),this._id2Color=[]}getId2Color(){return this._id2Color}setZones(e){this._zones=e,this._zones.sort(e0.compare)}setLineHeight(e){return this._lineHeight===e?!1:(this._lineHeight=e,this._colorZonesInvalid=!0,!0)}setPixelRatio(e){this._pixelRatio=e,this._colorZonesInvalid=!0}getDOMWidth(){return this._domWidth}getCanvasWidth(){return this._domWidth*this._pixelRatio}setDOMWidth(e){return this._domWidth===e?!1:(this._domWidth=e,this._colorZonesInvalid=!0,!0)}getDOMHeight(){return this._domHeight}getCanvasHeight(){return this._domHeight*this._pixelRatio}setDOMHeight(e){return this._domHeight===e?!1:(this._domHeight=e,this._colorZonesInvalid=!0,!0)}getOuterHeight(){return this._outerHeight}setOuterHeight(e){return this._outerHeight===e?!1:(this._outerHeight=e,this._colorZonesInvalid=!0,!0)}resolveColorZones(){const e=this._colorZonesInvalid,t=Math.floor(this._lineHeight),i=Math.floor(this.getCanvasHeight()),n=Math.floor(this._outerHeight),s=i/n,o=Math.floor(4*this._pixelRatio/2),r=[];for(let l=0,h=this._zones.length;l<h;l++){const c=this._zones[l];if(!e){const w=c.getColorZones();if(w){r.push(w);continue}}const d=this._getVerticalOffsetForLine(c.startLineNumber),u=c.heightInLines===0?this._getVerticalOffsetForLine(c.endLineNumber)+t:d+c.heightInLines*t,g=Math.floor(s*d),f=Math.floor(s*u);let m=Math.floor((g+f)/2),_=f-m;_<o&&(_=o),m-_<0&&(m=_),m+_>i&&(m=i-_);const C=c.color;let p=this._color2Id[C];p||(p=++this._lastAssignedId,this._color2Id[C]=p,this._id2Color[p]=C);const b=new hd(m-_,m+_,p);c.setColorZone(b),r.push(b)}return this._colorZonesInvalid=!1,r.sort(hd.compare),r}}class i0 extends eo{constructor(e,t){super(),this._context=e;const i=this._context.configuration.options;this._domNode=Q(document.createElement("canvas")),this._domNode.setClassName(t),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._zoneManager=new t0(n=>this._context.viewLayout.getVerticalOffsetForLineNumber(n)),this._zoneManager.setDOMWidth(0),this._zoneManager.setDOMHeight(0),this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight()),this._zoneManager.setLineHeight(i.get(67)),this._zoneManager.setPixelRatio(i.get(144)),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return e.hasChanged(67)&&(this._zoneManager.setLineHeight(t.get(67)),this._render()),e.hasChanged(144)&&(this._zoneManager.setPixelRatio(t.get(144)),this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render()),!0}onFlushed(e){return this._render(),!0}onScrollChanged(e){return e.scrollHeightChanged&&(this._zoneManager.setOuterHeight(e.scrollHeight),this._render()),!0}onZonesChanged(e){return this._render(),!0}getDomNode(){return this._domNode.domNode}setLayout(e){this._domNode.setTop(e.top),this._domNode.setRight(e.right);let t=!1;t=this._zoneManager.setDOMWidth(e.width)||t,t=this._zoneManager.setDOMHeight(e.height)||t,t&&(this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render())}setZones(e){this._zoneManager.setZones(e),this._render()}_render(){if(this._zoneManager.getOuterHeight()===0)return!1;const e=this._zoneManager.getCanvasWidth(),t=this._zoneManager.getCanvasHeight(),i=this._zoneManager.resolveColorZones(),n=this._zoneManager.getId2Color(),s=this._domNode.domNode.getContext("2d");return s.clearRect(0,0,e,t),i.length>0&&this._renderOneLane(s,i,n,e),!0}_renderOneLane(e,t,i,n){let s=0,o=0,r=0;for(const l of t){const h=l.colorId,c=l.from,d=l.to;h!==s?(e.fillRect(0,o,n,r-o),s=h,e.fillStyle=i[s],o=c,r=d):r>=c?r=Math.max(r,d):(e.fillRect(0,o,n,r-o),o=c,r=d)}e.fillRect(0,o,n,r-o)}}class n0 extends Ye{constructor(e){super(e),this.domNode=Q(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("view-rulers"),this._renderedRulers=[];const t=this._context.configuration.options;this._rulers=t.get(103),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth}dispose(){super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._rulers=t.get(103),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onScrollChanged(e){return e.scrollHeightChanged}prepareRender(e){}_ensureRulersCount(){const e=this._renderedRulers.length,t=this._rulers.length;if(e===t)return;if(e<t){const{tabSize:n}=this._context.viewModel.model.getOptions(),s=n;let o=t-e;for(;o>0;){const r=Q(document.createElement("div"));r.setClassName("view-ruler"),r.setWidth(s),this.domNode.appendChild(r),this._renderedRulers.push(r),o--}return}let i=e-t;for(;i>0;){const n=this._renderedRulers.pop();this.domNode.removeChild(n),i--}}render(e){this._ensureRulersCount();for(let t=0,i=this._rulers.length;t<i;t++){const n=this._renderedRulers[t],s=this._rulers[t];n.setBoxShadow(s.color?`1px 0 0 0 ${s.color} inset`:""),n.setHeight(Math.min(e.scrollHeight,1e6)),n.setLeft(s.column*this._typicalHalfwidthCharacterWidth)}}}class s0 extends Ye{constructor(e){super(e),this._scrollTop=0,this._width=0,this._updateWidth(),this._shouldShow=!1;const i=this._context.configuration.options.get(104);this._useShadows=i.useShadows,this._domNode=Q(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true")}dispose(){super.dispose()}_updateShouldShow(){const e=this._useShadows&&this._scrollTop>0;return this._shouldShow!==e?(this._shouldShow=e,!0):!1}getDomNode(){return this._domNode}_updateWidth(){const t=this._context.configuration.options.get(146);t.minimap.renderMinimap===0||t.minimap.minimapWidth>0&&t.minimap.minimapLeft===0?this._width=t.width:this._width=t.width-t.verticalScrollbarWidth}onConfigurationChanged(e){const i=this._context.configuration.options.get(104);return this._useShadows=i.useShadows,this._updateWidth(),this._updateShouldShow(),!0}onScrollChanged(e){return this._scrollTop=e.scrollTop,this._updateShouldShow()}prepareRender(e){}render(e){this._domNode.setWidth(this._width),this._domNode.setClassName(this._shouldShow?"scroll-decoration":"")}}class o0{constructor(e){this.left=e.left,this.width=e.width,this.startStyle=null,this.endStyle=null}}class r0{constructor(e,t){this.lineNumber=e,this.ranges=t}}function a0(a){return new o0(a)}function l0(a){return new r0(a.lineNumber,a.ranges.map(a0))}const ce=class ce extends Yi{constructor(e){super(),this._previousFrameVisibleRangesWithStyle=[],this._context=e;const t=this._context.configuration.options;this._roundedSelection=t.get(102),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._roundedSelection=t.get(102),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_visibleRangesHaveGaps(e){for(let t=0,i=e.length;t<i;t++)if(e[t].ranges.length>1)return!0;return!1}_enrichVisibleRangesWithStyle(e,t,i){const n=this._typicalHalfwidthCharacterWidth/4;let s=null,o=null;if(i&&i.length>0&&t.length>0){const r=t[0].lineNumber;if(r===e.startLineNumber)for(let h=0;!s&&h<i.length;h++)i[h].lineNumber===r&&(s=i[h].ranges[0]);const l=t[t.length-1].lineNumber;if(l===e.endLineNumber)for(let h=i.length-1;!o&&h>=0;h--)i[h].lineNumber===l&&(o=i[h].ranges[0]);s&&!s.startStyle&&(s=null),o&&!o.startStyle&&(o=null)}for(let r=0,l=t.length;r<l;r++){const h=t[r].ranges[0],c=h.left,d=h.left+h.width,u={top:0,bottom:0},g={top:0,bottom:0};if(r>0){const f=t[r-1].ranges[0].left,m=t[r-1].ranges[0].left+t[r-1].ranges[0].width;Co(c-f)<n?u.top=2:c>f&&(u.top=1),Co(d-m)<n?g.top=2:f<d&&d<m&&(g.top=1)}else s&&(u.top=s.startStyle.top,g.top=s.endStyle.top);if(r+1<l){const f=t[r+1].ranges[0].left,m=t[r+1].ranges[0].left+t[r+1].ranges[0].width;Co(c-f)<n?u.bottom=2:f<c&&c<m&&(u.bottom=1),Co(d-m)<n?g.bottom=2:d<m&&(g.bottom=1)}else o&&(u.bottom=o.startStyle.bottom,g.bottom=o.endStyle.bottom);h.startStyle=u,h.endStyle=g}}_getVisibleRangesWithStyle(e,t,i){const s=(t.linesVisibleRangesForRange(e,!0)||[]).map(l0);return!this._visibleRangesHaveGaps(s)&&this._roundedSelection&&this._enrichVisibleRangesWithStyle(t.visibleRange,s,i),s}_createSelectionPiece(e,t,i,n,s){return'<div class="cslr '+i+'" style="top:'+e.toString()+"px;bottom:"+t.toString()+"px;left:"+n.toString()+"px;width:"+s.toString()+'px;"></div>'}_actualRenderOneSelection(e,t,i,n){if(n.length===0)return;const s=!!n[0].ranges[0].startStyle,o=n[0].lineNumber,r=n[n.length-1].lineNumber;for(let l=0,h=n.length;l<h;l++){const c=n[l],d=c.lineNumber,u=d-t,g=i&&d===o?1:0,f=i&&d!==o&&d===r?1:0;let m="",_="";for(let C=0,p=c.ranges.length;C<p;C++){const b=c.ranges[C];if(s){const L=b.startStyle,S=b.endStyle;if(L.top===1||L.bottom===1){m+=this._createSelectionPiece(g,f,ce.SELECTION_CLASS_NAME,b.left-ce.ROUNDED_PIECE_WIDTH,ce.ROUNDED_PIECE_WIDTH);let y=ce.EDITOR_BACKGROUND_CLASS_NAME;L.top===1&&(y+=" "+ce.SELECTION_TOP_RIGHT),L.bottom===1&&(y+=" "+ce.SELECTION_BOTTOM_RIGHT),m+=this._createSelectionPiece(g,f,y,b.left-ce.ROUNDED_PIECE_WIDTH,ce.ROUNDED_PIECE_WIDTH)}if(S.top===1||S.bottom===1){m+=this._createSelectionPiece(g,f,ce.SELECTION_CLASS_NAME,b.left+b.width,ce.ROUNDED_PIECE_WIDTH);let y=ce.EDITOR_BACKGROUND_CLASS_NAME;S.top===1&&(y+=" "+ce.SELECTION_TOP_LEFT),S.bottom===1&&(y+=" "+ce.SELECTION_BOTTOM_LEFT),m+=this._createSelectionPiece(g,f,y,b.left+b.width,ce.ROUNDED_PIECE_WIDTH)}}let w=ce.SELECTION_CLASS_NAME;if(s){const L=b.startStyle,S=b.endStyle;L.top===0&&(w+=" "+ce.SELECTION_TOP_LEFT),L.bottom===0&&(w+=" "+ce.SELECTION_BOTTOM_LEFT),S.top===0&&(w+=" "+ce.SELECTION_TOP_RIGHT),S.bottom===0&&(w+=" "+ce.SELECTION_BOTTOM_RIGHT)}_+=this._createSelectionPiece(g,f,w,b.left,b.width)}e[u][0]+=m,e[u][1]+=_}}prepareRender(e){const t=[],i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(let o=i;o<=n;o++){const r=o-i;t[r]=["",""]}const s=[];for(let o=0,r=this._selections.length;o<r;o++){const l=this._selections[o];if(l.isEmpty()){s[o]=null;continue}const h=this._getVisibleRangesWithStyle(l,e,this._previousFrameVisibleRangesWithStyle[o]);s[o]=h,this._actualRenderOneSelection(t,i,this._selections.length>1,h)}this._previousFrameVisibleRangesWithStyle=s,this._renderResult=t.map(([o,r])=>o+r)}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}};ce.SELECTION_CLASS_NAME="selected-text",ce.SELECTION_TOP_LEFT="top-left-radius",ce.SELECTION_BOTTOM_LEFT="bottom-left-radius",ce.SELECTION_TOP_RIGHT="top-right-radius",ce.SELECTION_BOTTOM_RIGHT="bottom-right-radius",ce.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background",ce.ROUNDED_PIECE_WIDTH=10;let _l=ce;di((a,e)=>{const t=a.getColor(Zp);t&&!t.isTransparent()&&e.addRule(`.monaco-editor .view-line span.inline-selected-text { color: ${t}; }`)});function Co(a){return a<0?-a:a}class cd{constructor(e,t,i,n,s,o,r){this.top=e,this.left=t,this.paddingLeft=i,this.width=n,this.height=s,this.textContent=o,this.textContentClassName=r}}var zt;(function(a){a[a.Single=0]="Single",a[a.MultiPrimary=1]="MultiPrimary",a[a.MultiSecondary=2]="MultiSecondary"})(zt||(zt={}));class dd{constructor(e,t){this._context=e;const i=this._context.configuration.options,n=i.get(50);this._cursorStyle=i.get(28),this._lineHeight=i.get(67),this._typicalHalfwidthCharacterWidth=n.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(i.get(31),this._typicalHalfwidthCharacterWidth),this._isVisible=!0,this._domNode=Q(document.createElement("div")),this._domNode.setClassName(`cursor ${On}`),this._domNode.setHeight(this._lineHeight),this._domNode.setTop(0),this._domNode.setLeft(0),qe(this._domNode,n),this._domNode.setDisplay("none"),this._position=new D(1,1),this._pluralityClass="",this.setPlurality(t),this._lastRenderedContent="",this._renderData=null}getDomNode(){return this._domNode}getPosition(){return this._position}setPlurality(e){switch(e){default:case zt.Single:this._pluralityClass="";break;case zt.MultiPrimary:this._pluralityClass="cursor-primary";break;case zt.MultiSecondary:this._pluralityClass="cursor-secondary";break}}show(){this._isVisible||(this._domNode.setVisibility("inherit"),this._isVisible=!0)}hide(){this._isVisible&&(this._domNode.setVisibility("hidden"),this._isVisible=!1)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(50);return this._cursorStyle=t.get(28),this._lineHeight=t.get(67),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(t.get(31),this._typicalHalfwidthCharacterWidth),qe(this._domNode,i),!0}onCursorPositionChanged(e,t){return t?this._domNode.domNode.style.transitionProperty="none":this._domNode.domNode.style.transitionProperty="",this._position=e,!0}_getGraphemeAwarePosition(){const{lineNumber:e,column:t}=this._position,i=this._context.viewModel.getLineContent(e),[n,s]=Rf(i,t-1);return[new D(e,n+1),i.substring(n,s)]}_prepareRender(e){let t="",i="";const[n,s]=this._getGraphemeAwarePosition();if(this._cursorStyle===at.Line||this._cursorStyle===at.LineThin){const u=e.visibleRangeForPosition(n);if(!u||u.outsideRenderedLine)return null;const g=ee(this._domNode.domNode);let f;this._cursorStyle===at.Line?(f=Mh(g,this._lineCursorWidth>0?this._lineCursorWidth:2),f>2&&(t=s,i=this._getTokenClassName(n))):f=Mh(g,1);let m=u.left,_=0;f>=2&&m>=1&&(_=1,m-=_);const C=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta;return new cd(C,m,_,f,this._lineHeight,t,i)}const o=e.linesVisibleRangesForRange(new v(n.lineNumber,n.column,n.lineNumber,n.column+s.length),!1);if(!o||o.length===0)return null;const r=o[0];if(r.outsideRenderedLine||r.ranges.length===0)return null;const l=r.ranges[0],h=s==="	"?this._typicalHalfwidthCharacterWidth:l.width<1?this._typicalHalfwidthCharacterWidth:l.width;this._cursorStyle===at.Block&&(t=s,i=this._getTokenClassName(n));let c=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta,d=this._lineHeight;return(this._cursorStyle===at.Underline||this._cursorStyle===at.UnderlineThin)&&(c+=this._lineHeight-2,d=2),new cd(c,l.left,0,h,d,t,i)}_getTokenClassName(e){const t=this._context.viewModel.getViewLineData(e.lineNumber),i=t.tokens.findTokenIndexAtOffset(e.column-1);return t.tokens.getClassName(i)}prepareRender(e){this._renderData=this._prepareRender(e)}render(e){return this._renderData?(this._lastRenderedContent!==this._renderData.textContent&&(this._lastRenderedContent=this._renderData.textContent,this._domNode.domNode.textContent=this._lastRenderedContent),this._domNode.setClassName(`cursor ${this._pluralityClass} ${On} ${this._renderData.textContentClassName}`),this._domNode.setDisplay("block"),this._domNode.setTop(this._renderData.top),this._domNode.setLeft(this._renderData.left),this._domNode.setPaddingLeft(this._renderData.paddingLeft),this._domNode.setWidth(this._renderData.width),this._domNode.setLineHeight(this._renderData.height),this._domNode.setHeight(this._renderData.height),{domNode:this._domNode.domNode,position:this._position,contentLeft:this._renderData.left,height:this._renderData.height,width:2}):(this._domNode.setDisplay("none"),null)}}const Ns=class Ns extends Ye{constructor(e){super(e);const t=this._context.configuration.options;this._readOnly=t.get(92),this._cursorBlinking=t.get(26),this._cursorStyle=t.get(28),this._cursorSmoothCaretAnimation=t.get(27),this._selectionIsEmpty=!0,this._isComposingInput=!1,this._isVisible=!1,this._primaryCursor=new dd(this._context,zt.Single),this._secondaryCursors=[],this._renderData=[],this._domNode=Q(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._updateDomClassName(),this._domNode.appendChild(this._primaryCursor.getDomNode()),this._startCursorBlinkAnimation=new Af,this._cursorFlatBlinkInterval=new Of,this._blinkingEnabled=!1,this._editorHasFocus=!1,this._updateBlinking()}dispose(){super.dispose(),this._startCursorBlinkAnimation.dispose(),this._cursorFlatBlinkInterval.dispose()}getDomNode(){return this._domNode}onCompositionStart(e){return this._isComposingInput=!0,this._updateBlinking(),!0}onCompositionEnd(e){return this._isComposingInput=!1,this._updateBlinking(),!0}onConfigurationChanged(e){const t=this._context.configuration.options;this._readOnly=t.get(92),this._cursorBlinking=t.get(26),this._cursorStyle=t.get(28),this._cursorSmoothCaretAnimation=t.get(27),this._updateBlinking(),this._updateDomClassName(),this._primaryCursor.onConfigurationChanged(e);for(let i=0,n=this._secondaryCursors.length;i<n;i++)this._secondaryCursors[i].onConfigurationChanged(e);return!0}_onCursorPositionChanged(e,t,i){const n=this._secondaryCursors.length!==t.length||this._cursorSmoothCaretAnimation==="explicit"&&i!==3;if(this._primaryCursor.setPlurality(t.length?zt.MultiPrimary:zt.Single),this._primaryCursor.onCursorPositionChanged(e,n),this._updateBlinking(),this._secondaryCursors.length<t.length){const s=t.length-this._secondaryCursors.length;for(let o=0;o<s;o++){const r=new dd(this._context,zt.MultiSecondary);this._domNode.domNode.insertBefore(r.getDomNode().domNode,this._primaryCursor.getDomNode().domNode.nextSibling),this._secondaryCursors.push(r)}}else if(this._secondaryCursors.length>t.length){const s=this._secondaryCursors.length-t.length;for(let o=0;o<s;o++)this._domNode.removeChild(this._secondaryCursors[0].getDomNode()),this._secondaryCursors.splice(0,1)}for(let s=0;s<t.length;s++)this._secondaryCursors[s].onCursorPositionChanged(t[s],n)}onCursorStateChanged(e){const t=[];for(let n=0,s=e.selections.length;n<s;n++)t[n]=e.selections[n].getPosition();this._onCursorPositionChanged(t[0],t.slice(1),e.reason);const i=e.selections[0].isEmpty();return this._selectionIsEmpty!==i&&(this._selectionIsEmpty=i,this._updateDomClassName()),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onFocusChanged(e){return this._editorHasFocus=e.isFocused,this._updateBlinking(),!1}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return!0}onTokensChanged(e){const t=i=>{for(let n=0,s=e.ranges.length;n<s;n++)if(e.ranges[n].fromLineNumber<=i.lineNumber&&i.lineNumber<=e.ranges[n].toLineNumber)return!0;return!1};if(t(this._primaryCursor.getPosition()))return!0;for(const i of this._secondaryCursors)if(t(i.getPosition()))return!0;return!1}onZonesChanged(e){return!0}_getCursorBlinking(){return this._isComposingInput||!this._editorHasFocus?0:this._readOnly?5:this._cursorBlinking}_updateBlinking(){this._startCursorBlinkAnimation.cancel(),this._cursorFlatBlinkInterval.cancel();const e=this._getCursorBlinking(),t=e===0,i=e===5;t?this._hide():this._show(),this._blinkingEnabled=!1,this._updateDomClassName(),!t&&!i&&(e===1?this._cursorFlatBlinkInterval.cancelAndSet(()=>{this._isVisible?this._hide():this._show()},Ns.BLINK_INTERVAL,ee(this._domNode.domNode)):this._startCursorBlinkAnimation.setIfNotSet(()=>{this._blinkingEnabled=!0,this._updateDomClassName()},Ns.BLINK_INTERVAL))}_updateDomClassName(){this._domNode.setClassName(this._getClassName())}_getClassName(){let e="cursors-layer";switch(this._selectionIsEmpty||(e+=" has-selection"),this._cursorStyle){case at.Line:e+=" cursor-line-style";break;case at.Block:e+=" cursor-block-style";break;case at.Underline:e+=" cursor-underline-style";break;case at.LineThin:e+=" cursor-line-thin-style";break;case at.BlockOutline:e+=" cursor-block-outline-style";break;case at.UnderlineThin:e+=" cursor-underline-thin-style";break;default:e+=" cursor-line-style"}if(this._blinkingEnabled)switch(this._getCursorBlinking()){case 1:e+=" cursor-blink";break;case 2:e+=" cursor-smooth";break;case 3:e+=" cursor-phase";break;case 4:e+=" cursor-expand";break;case 5:e+=" cursor-solid";break;default:e+=" cursor-solid"}else e+=" cursor-solid";return(this._cursorSmoothCaretAnimation==="on"||this._cursorSmoothCaretAnimation==="explicit")&&(e+=" cursor-smooth-caret-animation"),e}_show(){this._primaryCursor.show();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].show();this._isVisible=!0}_hide(){this._primaryCursor.hide();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].hide();this._isVisible=!1}prepareRender(e){this._primaryCursor.prepareRender(e);for(let t=0,i=this._secondaryCursors.length;t<i;t++)this._secondaryCursors[t].prepareRender(e)}render(e){const t=[];let i=0;const n=this._primaryCursor.render(e);n&&(t[i++]=n);for(let s=0,o=this._secondaryCursors.length;s<o;s++){const r=this._secondaryCursors[s].render(e);r&&(t[i++]=r)}this._renderData=t}getLastRenderData(){return this._renderData}};Ns.BLINK_INTERVAL=500;let Cl=Ns;di((a,e)=>{const t=[{class:".cursor",foreground:Br,background:$l},{class:".cursor-primary",foreground:Bu,background:db},{class:".cursor-secondary",foreground:Fu,background:ub}];for(const i of t){const n=a.getColor(i.foreground);if(n){let s=a.getColor(i.background);s||(s=n.opposite()),e.addRule(`.monaco-editor .cursors-layer ${i.class} { background-color: ${n}; border-color: ${n}; color: ${s}; }`),ds(a.type)&&e.addRule(`.monaco-editor .cursors-layer.has-selection ${i.class} { border-left: 1px solid ${s}; border-right: 1px solid ${s}; }`)}}});const pa=()=>{throw new Error("Invalid change accessor")};class h0 extends Ye{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._lineHeight=t.get(67),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,this.domNode=Q(document.createElement("div")),this.domNode.setClassName("view-zones"),this.domNode.setPosition("absolute"),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.marginDomNode=Q(document.createElement("div")),this.marginDomNode.setClassName("margin-view-zones"),this.marginDomNode.setPosition("absolute"),this.marginDomNode.setAttribute("role","presentation"),this.marginDomNode.setAttribute("aria-hidden","true"),this._zones={}}dispose(){super.dispose(),this._zones={}}_recomputeWhitespacesProps(){const e=this._context.viewLayout.getWhitespaces(),t=new Map;for(const n of e)t.set(n.id,n);let i=!1;return this._context.viewModel.changeWhitespace(n=>{const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const l=s[o],h=this._zones[l],c=this._computeWhitespaceProps(h.delegate);h.isInHiddenArea=c.isInHiddenArea;const d=t.get(l);d&&(d.afterLineNumber!==c.afterViewLineNumber||d.height!==c.heightInPx)&&(n.changeOneWhitespace(l,c.afterViewLineNumber,c.heightInPx),this._safeCallOnComputedHeight(h.delegate,c.heightInPx),i=!0)}}),i}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._lineHeight=t.get(67),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,e.hasChanged(67)&&this._recomputeWhitespacesProps(),!0}onLineMappingChanged(e){return this._recomputeWhitespacesProps()}onLinesDeleted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}onLinesInserted(e){return!0}_getZoneOrdinal(e){return e.ordinal??e.afterColumn??1e4}_computeWhitespaceProps(e){if(e.afterLineNumber===0)return{isInHiddenArea:!1,afterViewLineNumber:0,heightInPx:this._heightInPixels(e),minWidthInPx:this._minWidthInPixels(e)};let t;if(typeof e.afterColumn<"u")t=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:e.afterColumn});else{const o=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:1}).lineNumber;t=new D(o,this._context.viewModel.model.getLineMaxColumn(o))}let i;t.column===this._context.viewModel.model.getLineMaxColumn(t.lineNumber)?i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber+1,column:1}):i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber,column:t.column+1});const n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t,e.afterColumnAffinity,!0),s=e.showInHiddenAreas||this._context.viewModel.coordinatesConverter.modelPositionIsVisible(i);return{isInHiddenArea:!s,afterViewLineNumber:n.lineNumber,heightInPx:s?this._heightInPixels(e):0,minWidthInPx:this._minWidthInPixels(e)}}changeViewZones(e){let t=!1;return this._context.viewModel.changeWhitespace(i=>{const n={addZone:s=>(t=!0,this._addZone(i,s)),removeZone:s=>{s&&(t=this._removeZone(i,s)||t)},layoutZone:s=>{s&&(t=this._layoutZone(i,s)||t)}};c0(e,n),n.addZone=pa,n.removeZone=pa,n.layoutZone=pa}),t}_addZone(e,t){const i=this._computeWhitespaceProps(t),s={whitespaceId:e.insertWhitespace(i.afterViewLineNumber,this._getZoneOrdinal(t),i.heightInPx,i.minWidthInPx),delegate:t,isInHiddenArea:i.isInHiddenArea,isVisible:!1,domNode:Q(t.domNode),marginDomNode:t.marginDomNode?Q(t.marginDomNode):null};return this._safeCallOnComputedHeight(s.delegate,i.heightInPx),s.domNode.setPosition("absolute"),s.domNode.domNode.style.width="100%",s.domNode.setDisplay("none"),s.domNode.setAttribute("monaco-view-zone",s.whitespaceId),this.domNode.appendChild(s.domNode),s.marginDomNode&&(s.marginDomNode.setPosition("absolute"),s.marginDomNode.domNode.style.width="100%",s.marginDomNode.setDisplay("none"),s.marginDomNode.setAttribute("monaco-view-zone",s.whitespaceId),this.marginDomNode.appendChild(s.marginDomNode)),this._zones[s.whitespaceId]=s,this.setShouldRender(),s.whitespaceId}_removeZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t];return delete this._zones[t],e.removeWhitespace(i.whitespaceId),i.domNode.removeAttribute("monaco-visible-view-zone"),i.domNode.removeAttribute("monaco-view-zone"),i.domNode.domNode.remove(),i.marginDomNode&&(i.marginDomNode.removeAttribute("monaco-visible-view-zone"),i.marginDomNode.removeAttribute("monaco-view-zone"),i.marginDomNode.domNode.remove()),this.setShouldRender(),!0}return!1}_layoutZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t],n=this._computeWhitespaceProps(i.delegate);return i.isInHiddenArea=n.isInHiddenArea,e.changeOneWhitespace(i.whitespaceId,n.afterViewLineNumber,n.heightInPx),this._safeCallOnComputedHeight(i.delegate,n.heightInPx),this.setShouldRender(),!0}return!1}shouldSuppressMouseDownOnViewZone(e){return this._zones.hasOwnProperty(e)?!!this._zones[e].delegate.suppressMouseDown:!1}_heightInPixels(e){return typeof e.heightInPx=="number"?e.heightInPx:typeof e.heightInLines=="number"?this._lineHeight*e.heightInLines:this._lineHeight}_minWidthInPixels(e){return typeof e.minWidthInPx=="number"?e.minWidthInPx:0}_safeCallOnComputedHeight(e,t){if(typeof e.onComputedHeight=="function")try{e.onComputedHeight(t)}catch(i){Oe(i)}}_safeCallOnDomNodeTop(e,t){if(typeof e.onDomNodeTop=="function")try{e.onDomNodeTop(t)}catch(i){Oe(i)}}prepareRender(e){}render(e){const t=e.viewportData.whitespaceViewportData,i={};let n=!1;for(const o of t)this._zones[o.id].isInHiddenArea||(i[o.id]=o,n=!0);const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const l=s[o],h=this._zones[l];let c=0,d=0,u="none";i.hasOwnProperty(l)?(c=i[l].verticalOffset-e.bigNumbersDelta,d=i[l].height,u="block",h.isVisible||(h.domNode.setAttribute("monaco-visible-view-zone","true"),h.isVisible=!0),this._safeCallOnDomNodeTop(h.delegate,e.getScrolledTopFromAbsoluteTop(i[l].verticalOffset))):(h.isVisible&&(h.domNode.removeAttribute("monaco-visible-view-zone"),h.isVisible=!1),this._safeCallOnDomNodeTop(h.delegate,e.getScrolledTopFromAbsoluteTop(-1e6))),h.domNode.setTop(c),h.domNode.setHeight(d),h.domNode.setDisplay(u),h.marginDomNode&&(h.marginDomNode.setTop(c),h.marginDomNode.setHeight(d),h.marginDomNode.setDisplay(u))}n&&(this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth)),this.marginDomNode.setWidth(this._contentLeft))}}function c0(a,e){try{return a(e)}catch(t){Oe(t)}}class d0 extends Yi{constructor(e){super(),this._context=e,this._options=new ud(this._context.configuration),this._selection=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=new ud(this._context.configuration);return this._options.equals(t)?e.hasChanged(146):(this._options=t,!0)}onCursorStateChanged(e){return this._selection=e.selections,this._options.renderWhitespace==="selection"}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}prepareRender(e){if(this._options.renderWhitespace==="none"){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber-t+1,s=new Array(n);for(let r=0;r<n;r++)s[r]=!0;const o=this._context.viewModel.getMinimapLinesRenderingData(e.viewportData.startLineNumber,e.viewportData.endLineNumber,s);this._renderResult=[];for(let r=e.viewportData.startLineNumber;r<=e.viewportData.endLineNumber;r++){const l=r-e.viewportData.startLineNumber,h=o.data[l];let c=null;if(this._options.renderWhitespace==="selection"){const d=this._selection;for(const u of d){if(u.endLineNumber<r||u.startLineNumber>r)continue;const g=u.startLineNumber===r?u.startColumn:h.minColumn,f=u.endLineNumber===r?u.endColumn:h.maxColumn;g<f&&(c||(c=[]),c.push(new cg(g-1,f-1)))}}this._renderResult[l]=this._applyRenderWhitespace(e,r,c,h)}}_applyRenderWhitespace(e,t,i,n){if(this._options.renderWhitespace==="selection"&&!i||this._options.renderWhitespace==="trailing"&&n.continuesWithWrappedLine)return"";const s=this._context.theme.getColor(Gl),o=this._options.renderWithSVG,r=n.content,l=this._options.stopRenderingLineAfter===-1?r.length:Math.min(this._options.stopRenderingLineAfter,r.length),h=n.continuesWithWrappedLine,c=n.minColumn-1,d=this._options.renderWhitespace==="boundary",u=this._options.renderWhitespace==="trailing",g=this._options.lineHeight,f=this._options.middotWidth,m=this._options.wsmiddotWidth,_=this._options.spaceWidth,C=Math.abs(m-_),p=Math.abs(f-_),b=C<p?11825:183,w=this._options.canUseHalfwidthRightwardsArrow;let L="",S=!1,y=Je(r),N;y===-1?(S=!0,y=l,N=l):N=Kn(r);let x=0,R=i&&i[x],k=0;for(let E=c;E<l;E++){const O=r.charCodeAt(E);if(R&&E>=R.endOffset&&(x++,R=i&&i[x]),O!==9&&O!==32||u&&!S&&E<=N)continue;if(d&&E>=y&&E<=N&&O===32){const j=E-1>=0?r.charCodeAt(E-1):0,ie=E+1<l?r.charCodeAt(E+1):0;if(j!==32&&ie!==32)continue}if(d&&h&&E===l-1){const j=E-1>=0?r.charCodeAt(E-1):0;if(O===32&&j!==32&&j!==9)continue}if(i&&(!R||R.startOffset>E||R.endOffset<=E))continue;const z=e.visibleRangeForPosition(new D(t,E+1));z&&(o?(k=Math.max(k,z.left),O===9?L+=this._renderArrow(g,_,z.left):L+=`<circle cx="${(z.left+_/2).toFixed(2)}" cy="${(g/2).toFixed(2)}" r="${(_/7).toFixed(2)}" />`):O===9?L+=`<div class="mwh" style="left:${z.left}px;height:${g}px;">${w?"￫":"→"}</div>`:L+=`<div class="mwh" style="left:${z.left}px;height:${g}px;">${String.fromCharCode(b)}</div>`)}return o?(k=Math.round(k+_),`<svg style="bottom:0;position:absolute;width:${k}px;height:${g}px" viewBox="0 0 ${k} ${g}" xmlns="http://www.w3.org/2000/svg" fill="${s}">`+L+"</svg>"):L}_renderArrow(e,t,i){const n=t/7,s=t,o=e/2,r=i,l={x:0,y:n/2},h={x:100/125*s,y:l.y},c={x:h.x-.2*h.x,y:h.y+.2*h.x},d={x:c.x+.1*h.x,y:c.y+.1*h.x},u={x:d.x+.35*h.x,y:d.y-.35*h.x},g={x:u.x,y:-u.y},f={x:d.x,y:-d.y},m={x:c.x,y:-c.y},_={x:h.x,y:-h.y},C={x:l.x,y:-l.y};return`<path d="M ${[l,h,c,d,u,g,f,m,_,C].map(w=>`${(r+w.x).toFixed(2)} ${(o+w.y).toFixed(2)}`).join(" L ")}" />`}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class ud{constructor(e){const t=e.options,i=t.get(50),n=t.get(38);n==="off"?(this.renderWhitespace="none",this.renderWithSVG=!1):n==="svg"?(this.renderWhitespace=t.get(100),this.renderWithSVG=!0):(this.renderWhitespace=t.get(100),this.renderWithSVG=!1),this.spaceWidth=i.spaceWidth,this.middotWidth=i.middotWidth,this.wsmiddotWidth=i.wsmiddotWidth,this.canUseHalfwidthRightwardsArrow=i.canUseHalfwidthRightwardsArrow,this.lineHeight=t.get(67),this.stopRenderingLineAfter=t.get(118)}equals(e){return this.renderWhitespace===e.renderWhitespace&&this.renderWithSVG===e.renderWithSVG&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter}}class u0{constructor(e,t,i,n){this.selections=e,this.startLineNumber=t.startLineNumber|0,this.endLineNumber=t.endLineNumber|0,this.relativeVerticalOffset=t.relativeVerticalOffset,this.bigNumbersDelta=t.bigNumbersDelta|0,this.lineHeight=t.lineHeight|0,this.whitespaceViewportData=i,this._model=n,this.visibleRange=new v(t.startLineNumber,this._model.getLineMinColumn(t.startLineNumber),t.endLineNumber,this._model.getLineMaxColumn(t.endLineNumber))}getViewLineRenderingData(e){return this._model.getViewportViewLineRenderingData(this.visibleRange,e)}getDecorationsInViewport(){return this._model.getDecorationsInViewport(this.visibleRange)}}class g0{get type(){return this._theme.type}get value(){return this._theme}constructor(e){this._theme=e}update(e){this._theme=e}getColor(e){return this._theme.getColor(e)}}class f0{constructor(e,t,i){this.configuration=e,this.theme=new g0(t),this.viewModel=i,this.viewLayout=i.viewLayout}addEventHandler(e){this.viewModel.addViewEventHandler(e)}removeEventHandler(e){this.viewModel.removeViewEventHandler(e)}}var m0=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},p0=function(a,e){return function(t,i){e(t,i,a)}};let bl=class extends eo{constructor(e,t,i,n,s,o,r){super(),this._instantiationService=r,this._shouldRecomputeGlyphMarginLanes=!1,this._selections=[new te(1,1,1,1)],this._renderAnimationFrame=null;const l=new vS(t,n,s,e);this._context=new f0(t,i,n),this._context.addEventHandler(this),this._viewParts=[],this._textAreaHandler=this._instantiationService.createInstance(dl,this._context,l,this._createTextAreaHandlerHelper()),this._viewParts.push(this._textAreaHandler),this._linesContent=Q(document.createElement("div")),this._linesContent.setClassName("lines-content monaco-editor-background"),this._linesContent.setPosition("absolute"),this.domNode=Q(document.createElement("div")),this.domNode.setClassName(this._getEditorClassName()),this.domNode.setAttribute("role","code"),this._overflowGuardContainer=Q(document.createElement("div")),ft.write(this._overflowGuardContainer,3),this._overflowGuardContainer.setClassName("overflow-guard"),this._scrollbar=new MS(this._context,this._linesContent,this.domNode,this._overflowGuardContainer),this._viewParts.push(this._scrollbar),this._viewLines=new pl(this._context,this._linesContent),this._viewZones=new h0(this._context),this._viewParts.push(this._viewZones);const h=new JS(this._context);this._viewParts.push(h);const c=new s0(this._context);this._viewParts.push(c);const d=new xS(this._context);this._viewParts.push(d),d.addDynamicOverlay(new kS(this._context)),d.addDynamicOverlay(new _l(this._context)),d.addDynamicOverlay(new WS(this._context)),d.addDynamicOverlay(new ES(this._context)),d.addDynamicOverlay(new d0(this._context));const u=new yS(this._context);this._viewParts.push(u),u.addDynamicOverlay(new TS(this._context)),u.addDynamicOverlay(new jS(this._context)),u.addDynamicOverlay(new US(this._context)),u.addDynamicOverlay(new Xo(this._context)),this._glyphMarginWidgets=new OS(this._context),this._viewParts.push(this._glyphMarginWidgets);const g=new Jo(this._context);g.getDomNode().appendChild(this._viewZones.marginDomNode),g.getDomNode().appendChild(u.getDomNode()),g.getDomNode().appendChild(this._glyphMarginWidgets.domNode),this._viewParts.push(g),this._contentWidgets=new DS(this._context,this.domNode),this._viewParts.push(this._contentWidgets),this._viewCursors=new Cl(this._context),this._viewParts.push(this._viewCursors),this._overlayWidgets=new YS(this._context,this.domNode),this._viewParts.push(this._overlayWidgets);const f=new n0(this._context);this._viewParts.push(f);const m=new NS(this._context);this._viewParts.push(m);const _=new QS(this._context);if(this._viewParts.push(_),h){const C=this._scrollbar.getOverviewRulerLayoutInfo();C.parent.insertBefore(h.getDomNode(),C.insertBefore)}this._linesContent.appendChild(d.getDomNode()),this._linesContent.appendChild(f.domNode),this._linesContent.appendChild(this._viewZones.domNode),this._linesContent.appendChild(this._viewLines.getDomNode()),this._linesContent.appendChild(this._contentWidgets.domNode),this._linesContent.appendChild(this._viewCursors.getDomNode()),this._overflowGuardContainer.appendChild(g.getDomNode()),this._overflowGuardContainer.appendChild(this._scrollbar.getDomNode()),this._overflowGuardContainer.appendChild(c.getDomNode()),this._overflowGuardContainer.appendChild(this._textAreaHandler.textArea),this._overflowGuardContainer.appendChild(this._textAreaHandler.textAreaCover),this._overflowGuardContainer.appendChild(this._overlayWidgets.getDomNode()),this._overflowGuardContainer.appendChild(_.getDomNode()),this._overflowGuardContainer.appendChild(m.domNode),this.domNode.appendChild(this._overflowGuardContainer),o?(o.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode.domNode),o.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode)):(this.domNode.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode),this.domNode.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode)),this._applyLayout(),this._pointerHandler=this._register(new Uv(this._context,l,this._createPointerHandlerHelper()))}_computeGlyphMarginLanes(){const e=this._context.viewModel.model,t=this._context.viewModel.glyphLanes;let i=[],n=0;i=i.concat(e.getAllMarginDecorations().map(s=>{var r,l;const o=((r=s.options.glyphMargin)==null?void 0:r.position)??Gi.Center;return n=Math.max(n,s.range.endLineNumber),{range:s.range,lane:o,persist:(l=s.options.glyphMargin)==null?void 0:l.persistLane}})),i=i.concat(this._glyphMarginWidgets.getWidgets().map(s=>{const o=e.validateRange(s.preference.range);return n=Math.max(n,o.endLineNumber),{range:o,lane:s.preference.lane}})),i.sort((s,o)=>v.compareRangesUsingStarts(s.range,o.range)),t.reset(n);for(const s of i)t.push(s.lane,s.range,s.persist);return t}_createPointerHandlerHelper(){return{viewDomNode:this.domNode.domNode,linesContentDomNode:this._linesContent.domNode,viewLinesDomNode:this._viewLines.getDomNode().domNode,focusTextArea:()=>{this.focus()},dispatchTextAreaEvent:e=>{this._textAreaHandler.textArea.domNode.dispatchEvent(e)},getLastRenderData:()=>{const e=this._viewCursors.getLastRenderData()||[],t=this._textAreaHandler.getLastRenderData();return new Ev(e,t)},renderNow:()=>{this.render(!0,!1)},shouldSuppressMouseDownOnViewZone:e=>this._viewZones.shouldSuppressMouseDownOnViewZone(e),shouldSuppressMouseDownOnWidget:e=>this._contentWidgets.shouldSuppressMouseDownOnWidget(e),getPositionFromDOMInfo:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getPositionFromDOMInfo(e,t)),visibleRangeForPosition:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(new D(e,t))),getLineWidth:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getLineWidth(e))}}_createTextAreaHandlerHelper(){return{visibleRangeForPosition:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(e))}}_applyLayout(){const t=this._context.configuration.options.get(146);this.domNode.setWidth(t.width),this.domNode.setHeight(t.height),this._overflowGuardContainer.setWidth(t.width),this._overflowGuardContainer.setHeight(t.height),this._linesContent.setWidth(16777216),this._linesContent.setHeight(16777216)}_getEditorClassName(){const e=this._textAreaHandler.isFocused()?" focused":"";return this._context.configuration.options.get(143)+" "+za(this._context.theme.type)+e}handleEvents(e){super.handleEvents(e),this._scheduleRender()}onConfigurationChanged(e){return this.domNode.setClassName(this._getEditorClassName()),this._applyLayout(),!1}onCursorStateChanged(e){return this._selections=e.selections,!1}onDecorationsChanged(e){return e.affectsGlyphMargin&&(this._shouldRecomputeGlyphMarginLanes=!0),!1}onFocusChanged(e){return this.domNode.setClassName(this._getEditorClassName()),!1}onThemeChanged(e){return this._context.theme.update(e.theme),this.domNode.setClassName(this._getEditorClassName()),!1}dispose(){this._renderAnimationFrame!==null&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this._contentWidgets.overflowingContentWidgetsDomNode.domNode.remove(),this._context.removeEventHandler(this),this._viewLines.dispose();for(const e of this._viewParts)e.dispose();super.dispose()}_scheduleRender(){var e;if(this._store.isDisposed)throw new fe;if(this._renderAnimationFrame===null){const t=this._createCoordinatedRendering();this._renderAnimationFrame=wl.INSTANCE.scheduleCoordinatedRendering({window:ee((e=this.domNode)==null?void 0:e.domNode),prepareRenderText:()=>{if(this._store.isDisposed)throw new fe;try{return t.prepareRenderText()}finally{this._renderAnimationFrame=null}},renderText:()=>{if(this._store.isDisposed)throw new fe;return t.renderText()},prepareRender:(i,n)=>{if(this._store.isDisposed)throw new fe;return t.prepareRender(i,n)},render:(i,n)=>{if(this._store.isDisposed)throw new fe;return t.render(i,n)}})}}_flushAccumulatedAndRenderNow(){const e=this._createCoordinatedRendering();ii(()=>e.prepareRenderText());const t=ii(()=>e.renderText());if(t){const[i,n]=t;ii(()=>e.prepareRender(i,n)),ii(()=>e.render(i,n))}}_getViewPartsToRender(){const e=[];let t=0;for(const i of this._viewParts)i.shouldRender()&&(e[t++]=i);return e}_createCoordinatedRendering(){return{prepareRenderText:()=>{if(this._shouldRecomputeGlyphMarginLanes){this._shouldRecomputeGlyphMarginLanes=!1;const e=this._computeGlyphMarginLanes();this._context.configuration.setGlyphMarginDecorationLaneCount(e.requiredLanes)}ti.onRenderStart()},renderText:()=>{if(!this.domNode.domNode.isConnected)return null;let e=this._getViewPartsToRender();if(!this._viewLines.shouldRender()&&e.length===0)return null;const t=this._context.viewLayout.getLinesViewportData();this._context.viewModel.setViewport(t.startLineNumber,t.endLineNumber,t.centeredLineNumber);const i=new u0(this._selections,t,this._context.viewLayout.getWhitespaceViewportData(),this._context.viewModel);return this._contentWidgets.shouldRender()&&this._contentWidgets.onBeforeRender(i),this._viewLines.shouldRender()&&(this._viewLines.renderText(i),this._viewLines.onDidRender(),e=this._getViewPartsToRender()),[e,new xv(this._context.viewLayout,i,this._viewLines)]},prepareRender:(e,t)=>{for(const i of e)i.prepareRender(t)},render:(e,t)=>{for(const i of e)i.render(t),i.onDidRender()}}}delegateVerticalScrollbarPointerDown(e){this._scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this._scrollbar.delegateScrollFromMouseWheelEvent(e)}restoreState(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft},1),this._context.viewModel.visibleLinesStabilized()}getOffsetForColumn(e,t){const i=this._context.viewModel.model.validatePosition({lineNumber:e,column:t}),n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i);this._flushAccumulatedAndRenderNow();const s=this._viewLines.visibleRangeForPosition(new D(n.lineNumber,n.column));return s?s.left:-1}getTargetAtClientPoint(e,t){const i=this._pointerHandler.getTargetAtClientPoint(e,t);return i?Hr.convertViewToModelMouseTarget(i,this._context.viewModel.coordinatesConverter):null}createOverviewRuler(e){return new i0(this._context,e)}change(e){this._viewZones.changeViewZones(e),this._scheduleRender()}render(e,t){if(t){this._viewLines.forceShouldRender();for(const i of this._viewParts)i.forceShouldRender()}e?this._flushAccumulatedAndRenderNow():this._scheduleRender()}writeScreenReaderContent(e){this._textAreaHandler.writeScreenReaderContent(e)}focus(){this._textAreaHandler.focusTextArea()}isFocused(){return this._textAreaHandler.isFocused()}setAriaOptions(e){this._textAreaHandler.setAriaOptions(e)}addContentWidget(e){this._contentWidgets.addWidget(e.widget),this.layoutContentWidget(e),this._scheduleRender()}layoutContentWidget(e){var t,i,n,s;this._contentWidgets.setWidgetPosition(e.widget,((t=e.position)==null?void 0:t.position)??null,((i=e.position)==null?void 0:i.secondaryPosition)??null,((n=e.position)==null?void 0:n.preference)??null,((s=e.position)==null?void 0:s.positionAffinity)??null),this._scheduleRender()}removeContentWidget(e){this._contentWidgets.removeWidget(e.widget),this._scheduleRender()}addOverlayWidget(e){this._overlayWidgets.addWidget(e.widget),this.layoutOverlayWidget(e),this._scheduleRender()}layoutOverlayWidget(e){this._overlayWidgets.setWidgetPosition(e.widget,e.position)&&this._scheduleRender()}removeOverlayWidget(e){this._overlayWidgets.removeWidget(e.widget),this._scheduleRender()}addGlyphMarginWidget(e){this._glyphMarginWidgets.addWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}layoutGlyphMarginWidget(e){const t=e.position;this._glyphMarginWidgets.setWidgetPosition(e.widget,t)&&(this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender())}removeGlyphMarginWidget(e){this._glyphMarginWidgets.removeWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}};bl=m0([p0(6,Ks)],bl);function ii(a){try{return a()}catch(e){return Oe(e),null}}const Sr=class Sr{constructor(){this._coordinatedRenderings=[],this._animationFrameRunners=new Map}scheduleCoordinatedRendering(e){return this._coordinatedRenderings.push(e),this._scheduleRender(e.window),{dispose:()=>{const t=this._coordinatedRenderings.indexOf(e);if(t!==-1&&(this._coordinatedRenderings.splice(t,1),this._coordinatedRenderings.length===0)){for(const[i,n]of this._animationFrameRunners)n.dispose();this._animationFrameRunners.clear()}}}}_scheduleRender(e){if(!this._animationFrameRunners.has(e)){const t=()=>{this._animationFrameRunners.delete(e),this._onRenderScheduled()};this._animationFrameRunners.set(e,Pf(e,t,100))}}_onRenderScheduled(){const e=this._coordinatedRenderings.slice(0);this._coordinatedRenderings=[];for(const i of e)ii(()=>i.prepareRenderText());const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=ii(()=>s.renderText())}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,l]=o;ii(()=>s.prepareRender(r,l))}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,l]=o;ii(()=>s.render(r,l))}}};Sr.INSTANCE=new Sr;let wl=Sr;class Ls{constructor(e,t,i,n,s){this.injectionOffsets=e,this.injectionOptions=t,this.breakOffsets=i,this.breakOffsetsVisibleColumn=n,this.wrappedTextIndentLength=s}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(e){return e>0?this.wrappedTextIndentLength:0}getLineLength(e){const t=e>0?this.breakOffsets[e-1]:0;let n=this.breakOffsets[e]-t;return e>0&&(n+=this.wrappedTextIndentLength),n}getMaxOutputOffset(e){return this.getLineLength(e)}translateToInputOffset(e,t){e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength));let n=e===0?t:this.breakOffsets[e-1]+t;if(this.injectionOffsets!==null)for(let s=0;s<this.injectionOffsets.length&&n>this.injectionOffsets[s];s++)n<this.injectionOffsets[s]+this.injectionOptions[s].content.length?n=this.injectionOffsets[s]:n-=this.injectionOptions[s].content.length;return n}translateToOutputPosition(e,t=2){let i=e;if(this.injectionOffsets!==null)for(let n=0;n<this.injectionOffsets.length&&!(e<this.injectionOffsets[n]||t!==1&&e===this.injectionOffsets[n]);n++)i+=this.injectionOptions[n].content.length;return this.offsetInInputWithInjectionsToOutputPosition(i,t)}offsetInInputWithInjectionsToOutputPosition(e,t=2){let i=0,n=this.breakOffsets.length-1,s=0,o=0;for(;i<=n;){s=i+(n-i)/2|0;const l=this.breakOffsets[s];if(o=s>0?this.breakOffsets[s-1]:0,t===0)if(e<=o)n=s-1;else if(e>l)i=s+1;else break;else if(e<o)n=s-1;else if(e>=l)i=s+1;else break}let r=e-o;return s>0&&(r+=this.wrappedTextIndentLength),new bo(s,r)}normalizeOutputPosition(e,t,i){if(this.injectionOffsets!==null){const n=this.outputPositionToOffsetInInputWithInjections(e,t),s=this.normalizeOffsetInInputWithInjectionsAroundInjections(n,i);if(s!==n)return this.offsetInInputWithInjectionsToOutputPosition(s,i)}if(i===0){if(e>0&&t===this.getMinOutputOffset(e))return new bo(e-1,this.getMaxOutputOffset(e-1))}else if(i===1){const n=this.getOutputLineCount()-1;if(e<n&&t===this.getMaxOutputOffset(e))return new bo(e+1,this.getMinOutputOffset(e+1))}return new bo(e,t)}outputPositionToOffsetInInputWithInjections(e,t){return e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength)),(e>0?this.breakOffsets[e-1]:0)+t}normalizeOffsetInInputWithInjectionsAroundInjections(e,t){const i=this.getInjectedTextAtOffset(e);if(!i)return e;if(t===2){if(e===i.offsetInInputWithInjections+i.length&&gd(this.injectionOptions[i.injectedTextIndex].cursorStops))return i.offsetInInputWithInjections+i.length;{let n=i.offsetInInputWithInjections;if(fd(this.injectionOptions[i.injectedTextIndex].cursorStops))return n;let s=i.injectedTextIndex-1;for(;s>=0&&this.injectionOffsets[s]===this.injectionOffsets[i.injectedTextIndex]&&!(gd(this.injectionOptions[s].cursorStops)||(n-=this.injectionOptions[s].content.length,fd(this.injectionOptions[s].cursorStops)));)s--;return n}}else if(t===1||t===4){let n=i.offsetInInputWithInjections+i.length,s=i.injectedTextIndex;for(;s+1<this.injectionOffsets.length&&this.injectionOffsets[s+1]===this.injectionOffsets[s];)n+=this.injectionOptions[s+1].content.length,s++;return n}else if(t===0||t===3){let n=i.offsetInInputWithInjections,s=i.injectedTextIndex;for(;s-1>=0&&this.injectionOffsets[s-1]===this.injectionOffsets[s];)n-=this.injectionOptions[s-1].content.length,s--;return n}Bf()}getInjectedText(e,t){const i=this.outputPositionToOffsetInInputWithInjections(e,t),n=this.getInjectedTextAtOffset(i);return n?{options:this.injectionOptions[n.injectedTextIndex]}:null}getInjectedTextAtOffset(e){const t=this.injectionOffsets,i=this.injectionOptions;if(t!==null){let n=0;for(let s=0;s<t.length;s++){const o=i[s].content.length,r=t[s]+n,l=t[s]+n+o;if(r>e)break;if(e<=l)return{injectedTextIndex:s,offsetInInputWithInjections:r,length:o};n+=o}}}}function gd(a){return a==null?!0:a===zn.Right||a===zn.Both}function fd(a){return a==null?!0:a===zn.Left||a===zn.Both}class bo{constructor(e,t){this.outputLineIndex=e,this.outputOffset=t}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(e){return new D(e+this.outputLineIndex,this.outputOffset+1)}}const _a=au("domLineBreaksComputer",{createHTML:a=>a});class ph{static create(e){return new ph(new WeakRef(e))}constructor(e){this.targetWindow=e}createLineBreaksComputer(e,t,i,n,s){const o=[],r=[];return{addRequest:(l,h,c)=>{o.push(l),r.push(h)},finalize:()=>_0(Ff(this.targetWindow.deref()),o,e,t,i,n,s,r)}}}function _0(a,e,t,i,n,s,o,r){function l(x){const R=r[x];if(R){const k=gt.applyInjectedText(e[x],R),E=R.map(z=>z.options),O=R.map(z=>z.column-1);return new Ls(O,E,[k.length],[],0)}else return null}if(n===-1){const x=[];for(let R=0,k=e.length;R<k;R++)x[R]=l(R);return x}const h=Math.round(n*t.typicalHalfwidthCharacterWidth),d=Math.round(i*(s===3?2:s===2?1:0)),u=Math.ceil(t.spaceWidth*d),g=document.createElement("div");qe(g,t);const f=new Pl(1e4),m=[],_=[],C=[],p=[],b=[];for(let x=0;x<e.length;x++){const R=gt.applyInjectedText(e[x],r[x]);let k=0,E=0,O=h;if(s!==0)if(k=Je(R),k===-1)k=0;else{for(let re=0;re<k;re++){const he=R.charCodeAt(re)===9?i-E%i:1;E+=he}const ie=Math.ceil(t.spaceWidth*E);ie+t.typicalFullwidthCharacterWidth>h?(k=0,E=0):O=h-ie}const z=R.substr(k),j=C0(z,E,i,O,f,u);m[x]=k,_[x]=E,C[x]=z,p[x]=j[0],b[x]=j[1]}const w=f.build(),L=(_a==null?void 0:_a.createHTML(w))??w;g.innerHTML=L,g.style.position="absolute",g.style.top="10000",o==="keepAll"?(g.style.wordBreak="keep-all",g.style.overflowWrap="anywhere"):(g.style.wordBreak="inherit",g.style.overflowWrap="break-word"),a.document.body.appendChild(g);const S=document.createRange(),y=Array.prototype.slice.call(g.children,0),N=[];for(let x=0;x<e.length;x++){const R=y[x],k=b0(S,R,C[x],p[x]);if(k===null){N[x]=l(x);continue}const E=m[x],O=_[x]+d,z=b[x],j=[];for(let q=0,de=k.length;q<de;q++)j[q]=z[k[q]];if(E!==0)for(let q=0,de=k.length;q<de;q++)k[q]+=E;let ie,re;const he=r[x];he?(ie=he.map(q=>q.options),re=he.map(q=>q.column-1)):(ie=null,re=null),N[x]=new Ls(re,ie,k,j,O)}return g.remove(),N}function C0(a,e,t,i,n,s){if(s!==0){const u=String(s);n.appendString('<div style="text-indent: -'),n.appendString(u),n.appendString("px; padding-left: "),n.appendString(u),n.appendString("px; box-sizing: border-box; width:")}else n.appendString('<div style="width:');n.appendString(String(i)),n.appendString('px;">');const o=a.length;let r=e,l=0;const h=[],c=[];let d=0<o?a.charCodeAt(0):0;n.appendString("<span>");for(let u=0;u<o;u++){u!==0&&u%16384===0&&n.appendString("</span><span>"),h[u]=l,c[u]=r;const g=d;d=u+1<o?a.charCodeAt(u+1):0;let f=1,m=1;switch(g){case 9:f=t-r%t,m=f;for(let _=1;_<=f;_++)_<f?n.appendCharCode(160):n.appendASCIICharCode(32);break;case 32:d===32?n.appendCharCode(160):n.appendASCIICharCode(32);break;case 60:n.appendString("&lt;");break;case 62:n.appendString("&gt;");break;case 38:n.appendString("&amp;");break;case 0:n.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:n.appendCharCode(65533);break;default:ri(g)&&m++,g<32?n.appendCharCode(9216+g):n.appendCharCode(g)}l+=f,r+=m}return n.appendString("</span>"),h[a.length]=l,c[a.length]=r,n.appendString("</div>"),[h,c]}function b0(a,e,t,i){if(t.length<=1)return null;const n=Array.prototype.slice.call(e.children,0),s=[];try{Ll(a,n,i,0,null,t.length-1,null,s)}catch(o){return console.log(o),null}return s.length===0?null:(s.push(t.length),s)}function Ll(a,e,t,i,n,s,o,r){if(i===s||(n=n||Ca(a,e,t[i],t[i+1]),o=o||Ca(a,e,t[s],t[s+1]),Math.abs(n[0].top-o[0].top)<=.1))return;if(i+1===s){r.push(s);return}const l=i+(s-i)/2|0,h=Ca(a,e,t[l],t[l+1]);Ll(a,e,t,i,n,l,h,r),Ll(a,e,t,l,h,s,o,r)}function Ca(a,e,t,i){return a.setStart(e[t/16384|0].firstChild,t%16384),a.setEnd(e[i/16384|0].firstChild,i%16384),a.getClientRects()}class w0 extends H{constructor(){super(),this._editor=null,this._instantiationService=null,this._instances=this._register(new El),this._pending=new Map,this._finishedInstantiation=[],this._finishedInstantiation[0]=!1,this._finishedInstantiation[1]=!1,this._finishedInstantiation[2]=!1,this._finishedInstantiation[3]=!1}initialize(e,t,i){this._editor=e,this._instantiationService=i;for(const n of t){if(this._pending.has(n.id)){Oe(new Error(`Cannot have two contributions with the same id ${n.id}`));continue}this._pending.set(n.id,n)}this._instantiateSome(0),this._register(so(ee(this._editor.getDomNode()),()=>{this._instantiateSome(1)})),this._register(so(ee(this._editor.getDomNode()),()=>{this._instantiateSome(2)})),this._register(so(ee(this._editor.getDomNode()),()=>{this._instantiateSome(3)},5e3))}saveViewState(){const e={};for(const[t,i]of this._instances)typeof i.saveViewState=="function"&&(e[t]=i.saveViewState());return e}restoreViewState(e){for(const[t,i]of this._instances)typeof i.restoreViewState=="function"&&i.restoreViewState(e[t])}get(e){return this._instantiateById(e),this._instances.get(e)||null}onBeforeInteractionEvent(){this._instantiateSome(2)}onAfterModelAttached(){var e;return so(ee((e=this._editor)==null?void 0:e.getDomNode()),()=>{this._instantiateSome(1)},50)}_instantiateSome(e){if(this._finishedInstantiation[e])return;this._finishedInstantiation[e]=!0;const t=this._findPendingContributionsByInstantiation(e);for(const i of t)this._instantiateById(i.id)}_findPendingContributionsByInstantiation(e){const t=[];for(const[,i]of this._pending)i.instantiation===e&&t.push(i);return t}_instantiateById(e){const t=this._pending.get(e);if(t){if(this._pending.delete(e),!this._instantiationService||!this._editor)throw new Error("Cannot instantiate contributions before being initialized!");try{const i=this._instantiationService.createInstance(t.ctor,this._editor);this._instances.set(t.id,i),typeof i.restoreViewState=="function"&&t.instantiation!==0&&console.warn(`Editor contribution '${t.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`)}catch(i){Oe(i)}}}}class L0{constructor(e,t,i,n,s,o,r){this.id=e,this.label=t,this.alias=i,this.metadata=n,this._precondition=s,this._run=o,this._contextKeyService=r}isSupported(){return this._contextKeyService.contextMatchesRules(this._precondition)}run(e){return this.isSupported()?this._run(e):Promise.resolve(void 0)}}class _h{static create(e){return new _h(e.get(135),e.get(134))}constructor(e,t){this.classifier=new v0(e,t)}createLineBreaksComputer(e,t,i,n,s){const o=[],r=[],l=[];return{addRequest:(h,c,d)=>{o.push(h),r.push(c),l.push(d)},finalize:()=>{const h=e.typicalFullwidthCharacterWidth/e.typicalHalfwidthCharacterWidth,c=[];for(let d=0,u=o.length;d<u;d++){const g=r[d],f=l[d];f&&!f.injectionOptions&&!g?c[d]=S0(this.classifier,f,o[d],t,i,h,n,s):c[d]=x0(this.classifier,o[d],g,t,i,h,n,s)}return vl.length=0,Sl.length=0,c}}}}class v0 extends kd{constructor(e,t){super(0);for(let i=0;i<e.length;i++)this.set(e.charCodeAt(i),1);for(let i=0;i<t.length;i++)this.set(t.charCodeAt(i),2)}get(e){return e>=0&&e<256?this._asciiMap[e]:e>=12352&&e<=12543||e>=13312&&e<=19903||e>=19968&&e<=40959?3:this._map.get(e)||this._defaultValue}}let vl=[],Sl=[];function S0(a,e,t,i,n,s,o,r){if(n===-1)return null;const l=t.length;if(l<=1)return null;const h=r==="keepAll",c=e.breakOffsets,d=e.breakOffsetsVisibleColumn,u=kg(t,i,n,s,o),g=n-u,f=vl,m=Sl;let _=0,C=0,p=0,b=n;const w=c.length;let L=0;if(L>=0){let S=Math.abs(d[L]-b);for(;L+1<w;){const y=Math.abs(d[L+1]-b);if(y>=S)break;S=y,L++}}for(;L<w;){let S=L<0?0:c[L],y=L<0?0:d[L];C>S&&(S=C,y=p);let N=0,x=0,R=0,k=0;if(y<=b){let O=y,z=S===0?0:t.charCodeAt(S-1),j=S===0?0:a.get(z),ie=!0;for(let re=S;re<l;re++){const he=re,q=t.charCodeAt(re);let de,Ie;if(We(q)?(re++,de=0,Ie=2):(de=a.get(q),Ie=vs(q,O,i,s)),he>C&&xl(z,j,q,de,h)&&(N=he,x=O),O+=Ie,O>b){he>C?(R=he,k=O-Ie):(R=re+1,k=O),O-x>g&&(N=0),ie=!1;break}z=q,j=de}if(ie){_>0&&(f[_]=c[c.length-1],m[_]=d[c.length-1],_++);break}}if(N===0){let O=y,z=t.charCodeAt(S),j=a.get(z),ie=!1;for(let re=S-1;re>=C;re--){const he=re+1,q=t.charCodeAt(re);if(q===9){ie=!0;break}let de,Ie;if(Wf(q)?(re--,de=0,Ie=2):(de=a.get(q),Ie=ri(q)?s:1),O<=b){if(R===0&&(R=he,k=O),O<=b-g)break;if(xl(q,de,z,j,h)){N=he,x=O;break}}O-=Ie,z=q,j=de}if(N!==0){const re=g-(k-x);if(re<=i){const he=t.charCodeAt(R);let q;We(he)?q=2:q=vs(he,k,i,s),re-q<0&&(N=0)}}if(ie){L--;continue}}if(N===0&&(N=R,x=k),N<=C){const O=t.charCodeAt(C);We(O)?(N=C+2,x=p+2):(N=C+1,x=p+vs(O,p,i,s))}for(C=N,f[_]=N,p=x,m[_]=x,_++,b=x+g;L<0||L<w&&d[L]<x;)L++;let E=Math.abs(d[L]-b);for(;L+1<w;){const O=Math.abs(d[L+1]-b);if(O>=E)break;E=O,L++}}return _===0?null:(f.length=_,m.length=_,vl=e.breakOffsets,Sl=e.breakOffsetsVisibleColumn,e.breakOffsets=f,e.breakOffsetsVisibleColumn=m,e.wrappedTextIndentLength=u,e)}function x0(a,e,t,i,n,s,o,r){const l=gt.applyInjectedText(e,t);let h,c;if(t&&t.length>0?(h=t.map(x=>x.options),c=t.map(x=>x.column-1)):(h=null,c=null),n===-1)return h?new Ls(c,h,[l.length],[],0):null;const d=l.length;if(d<=1)return h?new Ls(c,h,[l.length],[],0):null;const u=r==="keepAll",g=kg(l,i,n,s,o),f=n-g,m=[],_=[];let C=0,p=0,b=0,w=n,L=l.charCodeAt(0),S=a.get(L),y=vs(L,0,i,s),N=1;We(L)&&(y+=1,L=l.charCodeAt(1),S=a.get(L),N++);for(let x=N;x<d;x++){const R=x,k=l.charCodeAt(x);let E,O;We(k)?(x++,E=0,O=2):(E=a.get(k),O=vs(k,y,i,s)),xl(L,S,k,E,u)&&(p=R,b=y),y+=O,y>w&&((p===0||y-b>f)&&(p=R,b=y-O),m[C]=p,_[C]=b,C++,w=b+f,p=0),L=k,S=E}return C===0&&(!t||t.length===0)?null:(m[C]=d,_[C]=y,new Ls(c,h,m,_,g))}function vs(a,e,t,i){return a===9?t-e%t:ri(a)||a<32?i:1}function md(a,e){return e-a%e}function xl(a,e,t,i,n){return t!==32&&(e===2&&i!==2||e!==1&&i===1||!n&&e===3&&i!==2||!n&&i===3&&e!==1)}function kg(a,e,t,i,n){let s=0;if(n!==0){const o=Je(a);if(o!==-1){for(let l=0;l<o;l++){const h=a.charCodeAt(l)===9?md(s,e):1;s+=h}const r=n===3?2:n===2?1:0;for(let l=0;l<r;l++){const h=md(s,e);s+=h}s+i>t&&(s=0)}}return s}class rr{constructor(e){this._selTrackedRange=null,this._trackSelection=!0,this._setState(e,new Se(new v(1,1,1,1),0,0,new D(1,1),0),new Se(new v(1,1,1,1),0,0,new D(1,1),0))}dispose(e){this._removeTrackedRange(e)}startTrackingSelection(e){this._trackSelection=!0,this._updateTrackedRange(e)}stopTrackingSelection(e){this._trackSelection=!1,this._removeTrackedRange(e)}_updateTrackedRange(e){this._trackSelection&&(this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,this.modelState.selection,0))}_removeTrackedRange(e){this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,null,0)}asCursorState(){return new U(this.modelState,this.viewState)}readSelectionFromMarkers(e){const t=e.model._getTrackedRange(this._selTrackedRange);return this.modelState.selection.isEmpty()&&!t.isEmpty()?te.fromRange(t.collapseToEnd(),this.modelState.selection.getDirection()):te.fromRange(t,this.modelState.selection.getDirection())}ensureValidState(e){this._setState(e,this.modelState,this.viewState)}setState(e,t,i){this._setState(e,t,i)}static _validatePositionWithCache(e,t,i,n){return t.equals(i)?n:e.normalizePosition(t,2)}static _validateViewState(e,t){const i=t.position,n=t.selectionStart.getStartPosition(),s=t.selectionStart.getEndPosition(),o=e.normalizePosition(i,2),r=this._validatePositionWithCache(e,n,i,o),l=this._validatePositionWithCache(e,s,n,r);return i.equals(o)&&n.equals(r)&&s.equals(l)?t:new Se(v.fromPositions(r,l),t.selectionStartKind,t.selectionStartLeftoverVisibleColumns+n.column-r.column,o,t.leftoverVisibleColumns+i.column-o.column)}_setState(e,t,i){if(i&&(i=rr._validateViewState(e.viewModel,i)),t){const n=e.model.validateRange(t.selectionStart),s=t.selectionStart.equalsRange(n)?t.selectionStartLeftoverVisibleColumns:0,o=e.model.validatePosition(t.position),r=t.position.equals(o)?t.leftoverVisibleColumns:0;t=new Se(n,t.selectionStartKind,s,o,r)}else{if(!i)return;const n=e.model.validateRange(e.coordinatesConverter.convertViewRangeToModelRange(i.selectionStart)),s=e.model.validatePosition(e.coordinatesConverter.convertViewPositionToModelPosition(i.position));t=new Se(n,i.selectionStartKind,i.selectionStartLeftoverVisibleColumns,s,i.leftoverVisibleColumns)}if(i){const n=e.coordinatesConverter.validateViewRange(i.selectionStart,t.selectionStart),s=e.coordinatesConverter.validateViewPosition(i.position,t.position);i=new Se(n,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,s,t.leftoverVisibleColumns)}else{const n=e.coordinatesConverter.convertModelPositionToViewPosition(new D(t.selectionStart.startLineNumber,t.selectionStart.startColumn)),s=e.coordinatesConverter.convertModelPositionToViewPosition(new D(t.selectionStart.endLineNumber,t.selectionStart.endColumn)),o=new v(n.lineNumber,n.column,s.lineNumber,s.column),r=e.coordinatesConverter.convertModelPositionToViewPosition(t.position);i=new Se(o,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,r,t.leftoverVisibleColumns)}this.modelState=t,this.viewState=i,this._updateTrackedRange(e)}}class pd{constructor(e){this.context=e,this.cursors=[new rr(e)],this.lastAddedCursorIndex=0}dispose(){for(const e of this.cursors)e.dispose(this.context)}startTrackingSelections(){for(const e of this.cursors)e.startTrackingSelection(this.context)}stopTrackingSelections(){for(const e of this.cursors)e.stopTrackingSelection(this.context)}updateContext(e){this.context=e}ensureValidState(){for(const e of this.cursors)e.ensureValidState(this.context)}readSelectionFromMarkers(){return this.cursors.map(e=>e.readSelectionFromMarkers(this.context))}getAll(){return this.cursors.map(e=>e.asCursorState())}getViewPositions(){return this.cursors.map(e=>e.viewState.position)}getTopMostViewPosition(){return j_(this.cursors,vo(e=>e.viewState.position,D.compare)).viewState.position}getBottomMostViewPosition(){return U_(this.cursors,vo(e=>e.viewState.position,D.compare)).viewState.position}getSelections(){return this.cursors.map(e=>e.modelState.selection)}getViewSelections(){return this.cursors.map(e=>e.viewState.selection)}setSelections(e){this.setStates(U.fromModelSelections(e))}getPrimaryCursor(){return this.cursors[0].asCursorState()}setStates(e){e!==null&&(this.cursors[0].setState(this.context,e[0].modelState,e[0].viewState),this._setSecondaryStates(e.slice(1)))}_setSecondaryStates(e){const t=this.cursors.length-1,i=e.length;if(t<i){const n=i-t;for(let s=0;s<n;s++)this._addSecondaryCursor()}else if(t>i){const n=t-i;for(let s=0;s<n;s++)this._removeSecondaryCursor(this.cursors.length-2)}for(let n=0;n<i;n++)this.cursors[n+1].setState(this.context,e[n].modelState,e[n].viewState)}killSecondaryCursors(){this._setSecondaryStates([])}_addSecondaryCursor(){this.cursors.push(new rr(this.context)),this.lastAddedCursorIndex=this.cursors.length-1}getLastAddedCursorIndex(){return this.cursors.length===1||this.lastAddedCursorIndex===0?0:this.lastAddedCursorIndex}_removeSecondaryCursor(e){this.lastAddedCursorIndex>=e+1&&this.lastAddedCursorIndex--,this.cursors[e+1].dispose(this.context),this.cursors.splice(e+1,1)}normalize(){if(this.cursors.length===1)return;const e=this.cursors.slice(0),t=[];for(let i=0,n=e.length;i<n;i++)t.push({index:i,selection:e[i].modelState.selection});t.sort(vo(i=>i.selection,v.compareRangesUsingStarts));for(let i=0;i<t.length-1;i++){const n=t[i],s=t[i+1],o=n.selection,r=s.selection;if(!this.context.cursorConfig.multiCursorMergeOverlapping)continue;let l;if(r.isEmpty()||o.isEmpty()?l=r.getStartPosition().isBeforeOrEqual(o.getEndPosition()):l=r.getStartPosition().isBefore(o.getEndPosition()),l){const h=n.index<s.index?i:i+1,c=n.index<s.index?i+1:i,d=t[c].index,u=t[h].index,g=t[c].selection,f=t[h].selection;if(!g.equalsSelection(f)){const m=g.plusRange(f),_=g.selectionStartLineNumber===g.startLineNumber&&g.selectionStartColumn===g.startColumn,C=f.selectionStartLineNumber===f.startLineNumber&&f.selectionStartColumn===f.startColumn;let p;d===this.lastAddedCursorIndex?(p=_,this.lastAddedCursorIndex=u):p=C;let b;p?b=new te(m.startLineNumber,m.startColumn,m.endLineNumber,m.endColumn):b=new te(m.endLineNumber,m.endColumn,m.startLineNumber,m.startColumn),t[h].selection=b;const w=U.fromModelSelection(b);e[u].setState(this.context,w.modelState,w.viewState)}for(const m of t)m.index>d&&m.index--;e.splice(d,1),t.splice(c,1),this._removeSecondaryCursor(d-1),i--}}}}class _d{constructor(e,t,i,n){this._cursorContextBrand=void 0,this.model=e,this.viewModel=t,this.coordinatesConverter=i,this.cursorConfig=n}}class y0{constructor(){this.type=0}}class N0{constructor(){this.type=1}}class D0{constructor(e){this.type=2,this._source=e}hasChanged(e){return this._source.hasChanged(e)}}class I0{constructor(e,t,i){this.selections=e,this.modelSelections=t,this.reason=i,this.type=3}}class pi{constructor(e){this.type=4,e?(this.affectsMinimap=e.affectsMinimap,this.affectsOverviewRuler=e.affectsOverviewRuler,this.affectsGlyphMargin=e.affectsGlyphMargin,this.affectsLineNumber=e.affectsLineNumber):(this.affectsMinimap=!0,this.affectsOverviewRuler=!0,this.affectsGlyphMargin=!0,this.affectsLineNumber=!0)}}class wo{constructor(){this.type=5}}class k0{constructor(e){this.type=6,this.isFocused=e}}class T0{constructor(){this.type=7}}class Lo{constructor(){this.type=8}}class Tg{constructor(e,t){this.fromLineNumber=e,this.count=t,this.type=9}}class yl{constructor(e,t){this.type=10,this.fromLineNumber=e,this.toLineNumber=t}}class Nl{constructor(e,t){this.type=11,this.fromLineNumber=e,this.toLineNumber=t}}class Ss{constructor(e,t,i,n,s,o,r){this.source=e,this.minimalReveal=t,this.range=i,this.selections=n,this.verticalType=s,this.revealHorizontal=o,this.scrollType=r,this.type=12}}class E0{constructor(e){this.type=13,this.scrollWidth=e.scrollWidth,this.scrollLeft=e.scrollLeft,this.scrollHeight=e.scrollHeight,this.scrollTop=e.scrollTop,this.scrollWidthChanged=e.scrollWidthChanged,this.scrollLeftChanged=e.scrollLeftChanged,this.scrollHeightChanged=e.scrollHeightChanged,this.scrollTopChanged=e.scrollTopChanged}}class M0{constructor(e){this.theme=e,this.type=14}}class R0{constructor(e){this.type=15,this.ranges=e}}class A0{constructor(){this.type=16}}let O0=class{constructor(){this.type=17}};class P0 extends H{constructor(){super(),this._onEvent=this._register(new M),this.onEvent=this._onEvent.event,this._eventHandlers=[],this._viewEventQueue=null,this._isConsumingViewEventQueue=!1,this._collector=null,this._collectorCnt=0,this._outgoingEvents=[]}emitOutgoingEvent(e){this._addOutgoingEvent(e),this._emitOutgoingEvents()}_addOutgoingEvent(e){for(let t=0,i=this._outgoingEvents.length;t<i;t++){const n=this._outgoingEvents[t].kind===e.kind?this._outgoingEvents[t].attemptToMerge(e):null;if(n){this._outgoingEvents[t]=n;return}}this._outgoingEvents.push(e)}_emitOutgoingEvents(){for(;this._outgoingEvents.length>0;){if(this._collector||this._isConsumingViewEventQueue)return;const e=this._outgoingEvents.shift();e.isNoOp()||this._onEvent.fire(e)}}addViewEventHandler(e){for(let t=0,i=this._eventHandlers.length;t<i;t++)this._eventHandlers[t]===e&&console.warn("Detected duplicate listener in ViewEventDispatcher",e);this._eventHandlers.push(e)}removeViewEventHandler(e){for(let t=0;t<this._eventHandlers.length;t++)if(this._eventHandlers[t]===e){this._eventHandlers.splice(t,1);break}}beginEmitViewEvents(){return this._collectorCnt++,this._collectorCnt===1&&(this._collector=new B0),this._collector}endEmitViewEvents(){if(this._collectorCnt--,this._collectorCnt===0){const e=this._collector.outgoingEvents,t=this._collector.viewEvents;this._collector=null;for(const i of e)this._addOutgoingEvent(i);t.length>0&&this._emitMany(t)}this._emitOutgoingEvents()}emitSingleViewEvent(e){try{this.beginEmitViewEvents().emitViewEvent(e)}finally{this.endEmitViewEvents()}}_emitMany(e){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(e):this._viewEventQueue=e,this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const e=this._viewEventQueue;this._viewEventQueue=null;const t=this._eventHandlers.slice(0);for(const i of t)i.handleEvents(e)}}}class B0{constructor(){this.viewEvents=[],this.outgoingEvents=[]}emitViewEvent(e){this.viewEvents.push(e)}emitOutgoingEvent(e){this.outgoingEvents.push(e)}}class Ch{constructor(e,t,i,n){this.kind=0,this._oldContentWidth=e,this._oldContentHeight=t,this.contentWidth=i,this.contentHeight=n,this.contentWidthChanged=this._oldContentWidth!==this.contentWidth,this.contentHeightChanged=this._oldContentHeight!==this.contentHeight}isNoOp(){return!this.contentWidthChanged&&!this.contentHeightChanged}attemptToMerge(e){return e.kind!==this.kind?null:new Ch(this._oldContentWidth,this._oldContentHeight,e.contentWidth,e.contentHeight)}}class bh{constructor(e,t){this.kind=1,this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new bh(this.oldHasFocus,e.hasFocus)}}class wh{constructor(e,t,i,n,s,o,r,l){this.kind=2,this._oldScrollWidth=e,this._oldScrollLeft=t,this._oldScrollHeight=i,this._oldScrollTop=n,this.scrollWidth=s,this.scrollLeft=o,this.scrollHeight=r,this.scrollTop=l,this.scrollWidthChanged=this._oldScrollWidth!==this.scrollWidth,this.scrollLeftChanged=this._oldScrollLeft!==this.scrollLeft,this.scrollHeightChanged=this._oldScrollHeight!==this.scrollHeight,this.scrollTopChanged=this._oldScrollTop!==this.scrollTop}isNoOp(){return!this.scrollWidthChanged&&!this.scrollLeftChanged&&!this.scrollHeightChanged&&!this.scrollTopChanged}attemptToMerge(e){return e.kind!==this.kind?null:new wh(this._oldScrollWidth,this._oldScrollLeft,this._oldScrollHeight,this._oldScrollTop,e.scrollWidth,e.scrollLeft,e.scrollHeight,e.scrollTop)}}class F0{constructor(){this.kind=3}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class W0{constructor(){this.kind=4}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class ar{constructor(e,t,i,n,s,o,r){this.kind=6,this.oldSelections=e,this.selections=t,this.oldModelVersionId=i,this.modelVersionId=n,this.source=s,this.reason=o,this.reachedMaxCursorCount=r}static _selectionsAreEqual(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const i=e.length,n=t.length;if(i!==n)return!1;for(let s=0;s<i;s++)if(!e[s].equalsSelection(t[s]))return!1;return!0}isNoOp(){return ar._selectionsAreEqual(this.oldSelections,this.selections)&&this.oldModelVersionId===this.modelVersionId}attemptToMerge(e){return e.kind!==this.kind?null:new ar(this.oldSelections,e.selections,this.oldModelVersionId,e.modelVersionId,e.source,e.reason,this.reachedMaxCursorCount||e.reachedMaxCursorCount)}}class V0{constructor(){this.kind=5}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class H0{constructor(e){this.event=e,this.kind=7}isNoOp(){return!1}attemptToMerge(e){return null}}class z0{constructor(e){this.event=e,this.kind=8}isNoOp(){return!1}attemptToMerge(e){return null}}class U0{constructor(e){this.event=e,this.kind=9}isNoOp(){return!1}attemptToMerge(e){return null}}class j0{constructor(e){this.event=e,this.kind=10}isNoOp(){return!1}attemptToMerge(e){return null}}class $0{constructor(e){this.event=e,this.kind=11}isNoOp(){return!1}attemptToMerge(e){return null}}class G0{constructor(e){this.event=e,this.kind=12}isNoOp(){return!1}attemptToMerge(e){return null}}class K0 extends H{constructor(e,t,i,n){super(),this._model=e,this._knownModelVersionId=this._model.getVersionId(),this._viewModel=t,this._coordinatesConverter=i,this.context=new _d(this._model,this._viewModel,this._coordinatesConverter,n),this._cursors=new pd(this.context),this._hasFocus=!1,this._isHandling=!1,this._compositionState=null,this._columnSelectData=null,this._autoClosedActions=[],this._prevEditOperationType=0}dispose(){this._cursors.dispose(),this._autoClosedActions=Is(this._autoClosedActions),super.dispose()}updateConfiguration(e){this.context=new _d(this._model,this._viewModel,this._coordinatesConverter,e),this._cursors.updateContext(this.context)}onLineMappingChanged(e){this._knownModelVersionId===this._model.getVersionId()&&this.setStates(e,"viewModel",0,this.getCursorStates())}setHasFocus(e){this._hasFocus=e}_validateAutoClosedActions(){if(this._autoClosedActions.length>0){const e=this._cursors.getSelections();for(let t=0;t<this._autoClosedActions.length;t++){const i=this._autoClosedActions[t];i.isValid(e)||(i.dispose(),this._autoClosedActions.splice(t,1),t--)}}}getPrimaryCursorState(){return this._cursors.getPrimaryCursor()}getLastAddedCursorIndex(){return this._cursors.getLastAddedCursorIndex()}getCursorStates(){return this._cursors.getAll()}setStates(e,t,i,n){let s=!1;const o=this.context.cursorConfig.multiCursorLimit;n!==null&&n.length>o&&(n=n.slice(0,o),s=!0);const r=xs.from(this._model,this);return this._cursors.setStates(n),this._cursors.normalize(),this._columnSelectData=null,this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,t,i,r,s)}setCursorColumnSelectData(e){this._columnSelectData=e}revealAll(e,t,i,n,s,o){const r=this._cursors.getViewPositions();let l=null,h=null;r.length>1?h=this._cursors.getViewSelections():l=v.fromPositions(r[0],r[0]),e.emitViewEvent(new Ss(t,i,l,h,n,s,o))}revealPrimary(e,t,i,n,s,o){const l=[this._cursors.getPrimaryCursor().viewState.selection];e.emitViewEvent(new Ss(t,i,null,l,n,s,o))}saveState(){const e=[],t=this._cursors.getSelections();for(let i=0,n=t.length;i<n;i++){const s=t[i];e.push({inSelectionMode:!s.isEmpty(),selectionStart:{lineNumber:s.selectionStartLineNumber,column:s.selectionStartColumn},position:{lineNumber:s.positionLineNumber,column:s.positionColumn}})}return e}restoreState(e,t){const i=[];for(let n=0,s=t.length;n<s;n++){const o=t[n];let r=1,l=1;o.position&&o.position.lineNumber&&(r=o.position.lineNumber),o.position&&o.position.column&&(l=o.position.column);let h=r,c=l;o.selectionStart&&o.selectionStart.lineNumber&&(h=o.selectionStart.lineNumber),o.selectionStart&&o.selectionStart.column&&(c=o.selectionStart.column),i.push({selectionStartLineNumber:h,selectionStartColumn:c,positionLineNumber:r,positionColumn:l})}this.setStates(e,"restoreState",0,U.fromModelSelections(i)),this.revealAll(e,"restoreState",!1,0,!0,1)}onModelContentChanged(e,t){if(t instanceof lg){if(this._isHandling)return;this._isHandling=!0;try{this.setStates(e,"modelChange",0,this.getCursorStates())}finally{this._isHandling=!1}}else{const i=t.rawContentChangedEvent;if(this._knownModelVersionId=i.versionId,this._isHandling)return;const n=i.containsEvent(1);if(this._prevEditOperationType=0,n)this._cursors.dispose(),this._cursors=new pd(this.context),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,"model",1,null,!1);else if(this._hasFocus&&i.resultingSelection&&i.resultingSelection.length>0){const s=U.fromModelSelections(i.resultingSelection);this.setStates(e,"modelChange",i.isUndoing?5:i.isRedoing?6:2,s)&&this.revealAll(e,"modelChange",!1,0,!0,0)}else{const s=this._cursors.readSelectionFromMarkers();this.setStates(e,"modelChange",2,U.fromModelSelections(s))}}}getSelection(){return this._cursors.getPrimaryCursor().modelState.selection}getTopMostViewPosition(){return this._cursors.getTopMostViewPosition()}getBottomMostViewPosition(){return this._cursors.getBottomMostViewPosition()}getCursorColumnSelectData(){if(this._columnSelectData)return this._columnSelectData;const e=this._cursors.getPrimaryCursor(),t=e.viewState.selectionStart.getStartPosition(),i=e.viewState.position;return{isReal:!1,fromViewLineNumber:t.lineNumber,fromViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,t),toViewLineNumber:i.lineNumber,toViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,i)}}getSelections(){return this._cursors.getSelections()}setSelections(e,t,i,n){this.setStates(e,t,n,U.fromModelSelections(i))}getPrevEditOperationType(){return this._prevEditOperationType}setPrevEditOperationType(e){this._prevEditOperationType=e}_pushAutoClosedAction(e,t){const i=[],n=[];for(let r=0,l=e.length;r<l;r++)i.push({range:e[r],options:{description:"auto-closed-character",inlineClassName:"auto-closed-character",stickiness:1}}),n.push({range:t[r],options:{description:"auto-closed-enclosing",stickiness:1}});const s=this._model.deltaDecorations([],i),o=this._model.deltaDecorations([],n);this._autoClosedActions.push(new Cd(this._model,s,o))}_executeEditOperation(e){if(!e)return;e.shouldPushStackElementBefore&&this._model.pushStackElement();const t=q0.executeCommands(this._model,this._cursors.getSelections(),e.commands);if(t){this._interpretCommandResult(t);const i=[],n=[];for(let s=0;s<e.commands.length;s++){const o=e.commands[s];o instanceof uh&&o.enclosingRange&&o.closeCharacterRange&&(i.push(o.closeCharacterRange),n.push(o.enclosingRange))}i.length>0&&this._pushAutoClosedAction(i,n),this._prevEditOperationType=e.type}e.shouldPushStackElementAfter&&this._model.pushStackElement()}_interpretCommandResult(e){(!e||e.length===0)&&(e=this._cursors.readSelectionFromMarkers()),this._columnSelectData=null,this._cursors.setSelections(e),this._cursors.normalize()}_emitStateChangedIfNecessary(e,t,i,n,s){const o=xs.from(this._model,this);if(o.equals(n))return!1;const r=this._cursors.getSelections(),l=this._cursors.getViewSelections();if(e.emitViewEvent(new I0(l,r,i)),!n||n.cursorState.length!==o.cursorState.length||o.cursorState.some((h,c)=>!h.modelState.equals(n.cursorState[c].modelState))){const h=n?n.cursorState.map(d=>d.modelState.selection):null,c=n?n.modelVersionId:0;e.emitOutgoingEvent(new ar(h,r,c,o.modelVersionId,t||"keyboard",i,s))}return!0}_findAutoClosingPairs(e){if(!e.length)return null;const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];if(!s.text||s.text.indexOf(`
`)>=0)return null;const o=s.text.match(/([)\]}>'"`])([^)\]}>'"`]*)$/);if(!o)return null;const r=o[1],l=this.context.cursorConfig.autoClosingPairs.autoClosingPairsCloseSingleChar.get(r);if(!l||l.length!==1)return null;const h=l[0].open,c=s.text.length-o[2].length-1,d=s.text.lastIndexOf(h,c-1);if(d===-1)return null;t.push([d,c])}return t}executeEdits(e,t,i,n){let s=null;t==="snippet"&&(s=this._findAutoClosingPairs(i)),s&&(i[0]._isTracked=!0);const o=[],r=[],l=this._model.pushEditOperations(this.getSelections(),i,h=>{if(s)for(let d=0,u=s.length;d<u;d++){const[g,f]=s[d],m=h[d],_=m.range.startLineNumber,C=m.range.startColumn-1+g,p=m.range.startColumn-1+f;o.push(new v(_,p+1,_,p+2)),r.push(new v(_,C+1,_,p+2))}const c=n(h);return c&&(this._isHandling=!0),c});l&&(this._isHandling=!1,this.setSelections(e,t,l,0)),o.length>0&&this._pushAutoClosedAction(o,r)}_executeEdit(e,t,i,n=0){if(this.context.cursorConfig.readOnly)return;const s=xs.from(this._model,this);this._cursors.stopTrackingSelections(),this._isHandling=!0;try{this._cursors.ensureValidState(),e()}catch(o){Oe(o)}this._isHandling=!1,this._cursors.startTrackingSelections(),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(t,i,n,s,!1)&&this.revealAll(t,i,!1,0,!0,0)}getAutoClosedCharacters(){return Cd.getAllAutoClosedCharacters(this._autoClosedActions)}startComposition(e){this._compositionState=new ys(this._model,this.getSelections())}endComposition(e,t){const i=this._compositionState?this._compositionState.deduceOutcome(this._model,this.getSelections()):null;this._compositionState=null,this._executeEdit(()=>{t==="keyboard"&&this._executeEditOperation(Ii.compositionEndWithInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,i,this.getSelections(),this.getAutoClosedCharacters()))},e,t)}type(e,t,i){this._executeEdit(()=>{if(i==="keyboard"){const n=t.length;let s=0;for(;s<n;){const o=Gd(t,s),r=t.substr(s,o);this._executeEditOperation(Ii.typeWithInterceptors(!!this._compositionState,this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),this.getAutoClosedCharacters(),r)),s+=o}}else this._executeEditOperation(Ii.typeWithoutInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t))},e,i)}compositionType(e,t,i,n,s,o){if(t.length===0&&i===0&&n===0){if(s!==0){const r=this.getSelections().map(l=>{const h=l.getPosition();return new te(h.lineNumber,h.column+s,h.lineNumber,h.column+s)});this.setSelections(e,o,r,0)}return}this._executeEdit(()=>{this._executeEditOperation(Ii.compositionType(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t,i,n,s))},e,o)}paste(e,t,i,n,s){this._executeEdit(()=>{this._executeEditOperation(Ii.paste(this.context.cursorConfig,this._model,this.getSelections(),t,i,n||[]))},e,s,4)}cut(e,t){this._executeEdit(()=>{this._executeEditOperation(Ki.cut(this.context.cursorConfig,this._model,this.getSelections()))},e,t)}executeCommand(e,t,i){this._executeEdit(()=>{this._cursors.killSecondaryCursors(),this._executeEditOperation(new je(0,[t],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},e,i)}executeCommands(e,t,i){this._executeEdit(()=>{this._executeEditOperation(new je(0,t,{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},e,i)}}class xs{static from(e,t){return new xs(e.getVersionId(),t.getCursorStates())}constructor(e,t){this.modelVersionId=e,this.cursorState=t}equals(e){if(!e||this.modelVersionId!==e.modelVersionId||this.cursorState.length!==e.cursorState.length)return!1;for(let t=0,i=this.cursorState.length;t<i;t++)if(!this.cursorState[t].equals(e.cursorState[t]))return!1;return!0}}class Cd{static getAllAutoClosedCharacters(e){let t=[];for(const i of e)t=t.concat(i.getAutoClosedCharactersRanges());return t}constructor(e,t,i){this._model=e,this._autoClosedCharactersDecorations=t,this._autoClosedEnclosingDecorations=i}dispose(){this._autoClosedCharactersDecorations=this._model.deltaDecorations(this._autoClosedCharactersDecorations,[]),this._autoClosedEnclosingDecorations=this._model.deltaDecorations(this._autoClosedEnclosingDecorations,[])}getAutoClosedCharactersRanges(){const e=[];for(let t=0;t<this._autoClosedCharactersDecorations.length;t++){const i=this._model.getDecorationRange(this._autoClosedCharactersDecorations[t]);i&&e.push(i)}return e}isValid(e){const t=[];for(let i=0;i<this._autoClosedEnclosingDecorations.length;i++){const n=this._model.getDecorationRange(this._autoClosedEnclosingDecorations[i]);if(n&&(t.push(n),n.startLineNumber!==n.endLineNumber))return!1}t.sort(v.compareRangesUsingStarts),e.sort(v.compareRangesUsingStarts);for(let i=0;i<e.length;i++)if(i>=t.length||!t[i].strictContainsRange(e[i]))return!1;return!0}}class q0{static executeCommands(e,t,i){const n={model:e,selectionsBefore:t,trackedRanges:[],trackedRangesDirection:[]},s=this._innerExecuteCommands(n,i);for(let o=0,r=n.trackedRanges.length;o<r;o++)n.model._setTrackedRange(n.trackedRanges[o],null,0);return s}static _innerExecuteCommands(e,t){if(this._arrayIsEmpty(t))return null;const i=this._getEditOperations(e,t);if(i.operations.length===0)return null;const n=i.operations,s=this._getLoserCursorMap(n);if(s.hasOwnProperty("0"))return console.warn("Ignoring commands"),null;const o=[];for(let h=0,c=n.length;h<c;h++)s.hasOwnProperty(n[h].identifier.major.toString())||o.push(n[h]);i.hadTrackedEditOperation&&o.length>0&&(o[0]._isTracked=!0);let r=e.model.pushEditOperations(e.selectionsBefore,o,h=>{const c=[];for(let g=0;g<e.selectionsBefore.length;g++)c[g]=[];for(const g of h)g.identifier&&c[g.identifier.major].push(g);const d=(g,f)=>g.identifier.minor-f.identifier.minor,u=[];for(let g=0;g<e.selectionsBefore.length;g++)c[g].length>0?(c[g].sort(d),u[g]=t[g].computeCursorState(e.model,{getInverseEditOperations:()=>c[g],getTrackedSelection:f=>{const m=parseInt(f,10),_=e.model._getTrackedRange(e.trackedRanges[m]);return e.trackedRangesDirection[m]===0?new te(_.startLineNumber,_.startColumn,_.endLineNumber,_.endColumn):new te(_.endLineNumber,_.endColumn,_.startLineNumber,_.startColumn)}})):u[g]=e.selectionsBefore[g];return u});r||(r=e.selectionsBefore);const l=[];for(const h in s)s.hasOwnProperty(h)&&l.push(parseInt(h,10));l.sort((h,c)=>c-h);for(const h of l)r.splice(h,1);return r}static _arrayIsEmpty(e){for(let t=0,i=e.length;t<i;t++)if(e[t])return!1;return!0}static _getEditOperations(e,t){let i=[],n=!1;for(let s=0,o=t.length;s<o;s++){const r=t[s];if(r){const l=this._getEditOperationsFromCommand(e,s,r);i=i.concat(l.operations),n=n||l.hadTrackedEditOperation}}return{operations:i,hadTrackedEditOperation:n}}static _getEditOperationsFromCommand(e,t,i){const n=[];let s=0;const o=(d,u,g=!1)=>{v.isEmpty(d)&&u===""||n.push({identifier:{major:t,minor:s++},range:d,text:u,forceMoveMarkers:g,isAutoWhitespaceEdit:i.insertsAutoWhitespace})};let r=!1;const c={addEditOperation:o,addTrackedEditOperation:(d,u,g)=>{r=!0,o(d,u,g)},trackSelection:(d,u)=>{const g=te.liftSelection(d);let f;if(g.isEmpty())if(typeof u=="boolean")u?f=2:f=3;else{const C=e.model.getLineMaxColumn(g.startLineNumber);g.startColumn===C?f=2:f=3}else f=1;const m=e.trackedRanges.length,_=e.model._setTrackedRange(null,g,f);return e.trackedRanges[m]=_,e.trackedRangesDirection[m]=g.getDirection(),m.toString()}};try{i.getEditOperations(e.model,c)}catch(d){return Oe(d),{operations:[],hadTrackedEditOperation:!1}}return{operations:n,hadTrackedEditOperation:r}}static _getLoserCursorMap(e){e=e.slice(0),e.sort((i,n)=>-v.compareRangesUsingEnds(i.range,n.range));const t={};for(let i=1;i<e.length;i++){const n=e[i-1],s=e[i];if(v.getStartPosition(n.range).isBefore(v.getEndPosition(s.range))){let o;n.identifier.major>s.identifier.major?o=n.identifier.major:o=s.identifier.major,t[o.toString()]=!0;for(let r=0;r<e.length;r++)e[r].identifier.major===o&&(e.splice(r,1),r<i&&i--,r--);i>0&&i--}}return t}}class Z0{constructor(e,t,i){this.text=e,this.startSelection=t,this.endSelection=i}}class ys{static _capture(e,t){const i=[];for(const n of t){if(n.startLineNumber!==n.endLineNumber)return null;i.push(new Z0(e.getLineContent(n.startLineNumber),n.startColumn-1,n.endColumn-1))}return i}constructor(e,t){this._original=ys._capture(e,t)}deduceOutcome(e,t){if(!this._original)return null;const i=ys._capture(e,t);if(!i||this._original.length!==i.length)return null;const n=[];for(let s=0,o=this._original.length;s<o;s++)n.push(ys._deduceOutcome(this._original[s],i[s]));return n}static _deduceOutcome(e,t){const i=Math.min(e.startSelection,t.startSelection,Na(e.text,t.text)),n=Math.min(e.text.length-e.endSelection,t.text.length-t.endSelection,Da(e.text,t.text)),s=e.text.substring(i,e.text.length-n),o=t.text.substring(i,t.text.length-n);return new wS(s,e.startSelection-i,e.endSelection-i,o,t.startSelection-i,t.endSelection-i)}}class Q0{constructor(){this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[]}insert(e){this._hasPending=!0,this._inserts.push(e)}change(e){this._hasPending=!0,this._changes.push(e)}remove(e){this._hasPending=!0,this._removes.push(e)}mustCommit(){return this._hasPending}commit(e){if(!this._hasPending)return;const t=this._inserts,i=this._changes,n=this._removes;this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[],e._commitPendingChanges(t,i,n)}}class Y0{constructor(e,t,i,n,s){this.id=e,this.afterLineNumber=t,this.ordinal=i,this.height=n,this.minWidth=s,this.prefixSum=0}}const Ds=class Ds{constructor(e,t,i,n){this._instanceId=Ud(++Ds.INSTANCE_COUNT),this._pendingChanges=new Q0,this._lastWhitespaceId=0,this._arr=[],this._prefixSumValidIndex=-1,this._minWidth=-1,this._lineCount=e,this._lineHeight=t,this._paddingTop=i,this._paddingBottom=n}static findInsertionIndex(e,t,i){let n=0,s=e.length;for(;n<s;){const o=n+s>>>1;t===e[o].afterLineNumber?i<e[o].ordinal?s=o:n=o+1:t<e[o].afterLineNumber?s=o:n=o+1}return n}setLineHeight(e){this._checkPendingChanges(),this._lineHeight=e}setPadding(e,t){this._paddingTop=e,this._paddingBottom=t}onFlushed(e){this._checkPendingChanges(),this._lineCount=e}changeWhitespace(e){let t=!1;try{e({insertWhitespace:(n,s,o,r)=>{t=!0,n=n|0,s=s|0,o=o|0,r=r|0;const l=this._instanceId+ ++this._lastWhitespaceId;return this._pendingChanges.insert(new Y0(l,n,s,o,r)),l},changeOneWhitespace:(n,s,o)=>{t=!0,s=s|0,o=o|0,this._pendingChanges.change({id:n,newAfterLineNumber:s,newHeight:o})},removeWhitespace:n=>{t=!0,this._pendingChanges.remove({id:n})}})}finally{this._pendingChanges.commit(this)}return t}_commitPendingChanges(e,t,i){if((e.length>0||i.length>0)&&(this._minWidth=-1),e.length+t.length+i.length<=1){for(const l of e)this._insertWhitespace(l);for(const l of t)this._changeOneWhitespace(l.id,l.newAfterLineNumber,l.newHeight);for(const l of i){const h=this._findWhitespaceIndex(l.id);h!==-1&&this._removeWhitespace(h)}return}const n=new Set;for(const l of i)n.add(l.id);const s=new Map;for(const l of t)s.set(l.id,l);const o=l=>{const h=[];for(const c of l)if(!n.has(c.id)){if(s.has(c.id)){const d=s.get(c.id);c.afterLineNumber=d.newAfterLineNumber,c.height=d.newHeight}h.push(c)}return h},r=o(this._arr).concat(o(e));r.sort((l,h)=>l.afterLineNumber===h.afterLineNumber?l.ordinal-h.ordinal:l.afterLineNumber-h.afterLineNumber),this._arr=r,this._prefixSumValidIndex=-1}_checkPendingChanges(){this._pendingChanges.mustCommit()&&this._pendingChanges.commit(this)}_insertWhitespace(e){const t=Ds.findInsertionIndex(this._arr,e.afterLineNumber,e.ordinal);this._arr.splice(t,0,e),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,t-1)}_findWhitespaceIndex(e){const t=this._arr;for(let i=0,n=t.length;i<n;i++)if(t[i].id===e)return i;return-1}_changeOneWhitespace(e,t,i){const n=this._findWhitespaceIndex(e);if(n!==-1&&(this._arr[n].height!==i&&(this._arr[n].height=i,this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,n-1)),this._arr[n].afterLineNumber!==t)){const s=this._arr[n];this._removeWhitespace(n),s.afterLineNumber=t,this._insertWhitespace(s)}}_removeWhitespace(e){this._arr.splice(e,1),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,e-1)}onLinesDeleted(e,t){this._checkPendingChanges(),e=e|0,t=t|0,this._lineCount-=t-e+1;for(let i=0,n=this._arr.length;i<n;i++){const s=this._arr[i].afterLineNumber;e<=s&&s<=t?this._arr[i].afterLineNumber=e-1:s>t&&(this._arr[i].afterLineNumber-=t-e+1)}}onLinesInserted(e,t){this._checkPendingChanges(),e=e|0,t=t|0,this._lineCount+=t-e+1;for(let i=0,n=this._arr.length;i<n;i++){const s=this._arr[i].afterLineNumber;e<=s&&(this._arr[i].afterLineNumber+=t-e+1)}}getWhitespacesTotalHeight(){return this._checkPendingChanges(),this._arr.length===0?0:this.getWhitespacesAccumulatedHeight(this._arr.length-1)}getWhitespacesAccumulatedHeight(e){this._checkPendingChanges(),e=e|0;let t=Math.max(0,this._prefixSumValidIndex+1);t===0&&(this._arr[0].prefixSum=this._arr[0].height,t++);for(let i=t;i<=e;i++)this._arr[i].prefixSum=this._arr[i-1].prefixSum+this._arr[i].height;return this._prefixSumValidIndex=Math.max(this._prefixSumValidIndex,e),this._arr[e].prefixSum}getLinesTotalHeight(){this._checkPendingChanges();const e=this._lineHeight*this._lineCount,t=this.getWhitespacesTotalHeight();return e+t+this._paddingTop+this._paddingBottom}getWhitespaceAccumulatedHeightBeforeLineNumber(e){this._checkPendingChanges(),e=e|0;const t=this._findLastWhitespaceBeforeLineNumber(e);return t===-1?0:this.getWhitespacesAccumulatedHeight(t)}_findLastWhitespaceBeforeLineNumber(e){e=e|0;const t=this._arr;let i=0,n=t.length-1;for(;i<=n;){const o=(n-i|0)/2|0,r=i+o|0;if(t[r].afterLineNumber<e){if(r+1>=t.length||t[r+1].afterLineNumber>=e)return r;i=r+1|0}else n=r-1|0}return-1}_findFirstWhitespaceAfterLineNumber(e){e=e|0;const i=this._findLastWhitespaceBeforeLineNumber(e)+1;return i<this._arr.length?i:-1}getFirstWhitespaceIndexAfterLineNumber(e){return this._checkPendingChanges(),e=e|0,this._findFirstWhitespaceAfterLineNumber(e)}getVerticalOffsetForLineNumber(e,t=!1){this._checkPendingChanges(),e=e|0;let i;e>1?i=this._lineHeight*(e-1):i=0;const n=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e-(t?1:0));return i+n+this._paddingTop}getVerticalOffsetAfterLineNumber(e,t=!1){this._checkPendingChanges(),e=e|0;const i=this._lineHeight*e,n=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e+(t?1:0));return i+n+this._paddingTop}getWhitespaceMinWidth(){if(this._checkPendingChanges(),this._minWidth===-1){let e=0;for(let t=0,i=this._arr.length;t<i;t++)e=Math.max(e,this._arr[t].minWidth);this._minWidth=e}return this._minWidth}isAfterLines(e){this._checkPendingChanges();const t=this.getLinesTotalHeight();return e>t}isInTopPadding(e){return this._paddingTop===0?!1:(this._checkPendingChanges(),e<this._paddingTop)}isInBottomPadding(e){if(this._paddingBottom===0)return!1;this._checkPendingChanges();const t=this.getLinesTotalHeight();return e>=t-this._paddingBottom}getLineNumberAtOrAfterVerticalOffset(e){if(this._checkPendingChanges(),e=e|0,e<0)return 1;const t=this._lineCount|0,i=this._lineHeight;let n=1,s=t;for(;n<s;){const o=(n+s)/2|0,r=this.getVerticalOffsetForLineNumber(o)|0;if(e>=r+i)n=o+1;else{if(e>=r)return o;s=o}}return n>t?t:n}getLinesViewportData(e,t){this._checkPendingChanges(),e=e|0,t=t|0;const i=this._lineHeight,n=this.getLineNumberAtOrAfterVerticalOffset(e)|0,s=this.getVerticalOffsetForLineNumber(n)|0;let o=this._lineCount|0,r=this.getFirstWhitespaceIndexAfterLineNumber(n)|0;const l=this.getWhitespacesCount()|0;let h,c;r===-1?(r=l,c=o+1,h=0):(c=this.getAfterLineNumberForWhitespaceIndex(r)|0,h=this.getHeightForWhitespaceIndex(r)|0);let d=s,u=d;const g=5e5;let f=0;s>=g&&(f=Math.floor(s/g)*g,f=Math.floor(f/i)*i,u-=f);const m=[],_=e+(t-e)/2;let C=-1;for(let L=n;L<=o;L++){if(C===-1){const S=d,y=d+i;(S<=_&&_<y||S>_)&&(C=L)}for(d+=i,m[L-n]=u,u+=i;c===L;)u+=h,d+=h,r++,r>=l?c=o+1:(c=this.getAfterLineNumberForWhitespaceIndex(r)|0,h=this.getHeightForWhitespaceIndex(r)|0);if(d>=t){o=L;break}}C===-1&&(C=o);const p=this.getVerticalOffsetForLineNumber(o)|0;let b=n,w=o;return b<w&&s<e&&b++,b<w&&p+i>t&&w--,{bigNumbersDelta:f,startLineNumber:n,endLineNumber:o,relativeVerticalOffset:m,centeredLineNumber:C,completelyVisibleStartLineNumber:b,completelyVisibleEndLineNumber:w,lineHeight:this._lineHeight}}getVerticalOffsetForWhitespaceIndex(e){this._checkPendingChanges(),e=e|0;const t=this.getAfterLineNumberForWhitespaceIndex(e);let i;t>=1?i=this._lineHeight*t:i=0;let n;return e>0?n=this.getWhitespacesAccumulatedHeight(e-1):n=0,i+n+this._paddingTop}getWhitespaceIndexAtOrAfterVerticallOffset(e){this._checkPendingChanges(),e=e|0;let t=0,i=this.getWhitespacesCount()-1;if(i<0)return-1;const n=this.getVerticalOffsetForWhitespaceIndex(i),s=this.getHeightForWhitespaceIndex(i);if(e>=n+s)return-1;for(;t<i;){const o=Math.floor((t+i)/2),r=this.getVerticalOffsetForWhitespaceIndex(o),l=this.getHeightForWhitespaceIndex(o);if(e>=r+l)t=o+1;else{if(e>=r)return o;i=o}}return t}getWhitespaceAtVerticalOffset(e){this._checkPendingChanges(),e=e|0;const t=this.getWhitespaceIndexAtOrAfterVerticallOffset(e);if(t<0||t>=this.getWhitespacesCount())return null;const i=this.getVerticalOffsetForWhitespaceIndex(t);if(i>e)return null;const n=this.getHeightForWhitespaceIndex(t),s=this.getIdForWhitespaceIndex(t),o=this.getAfterLineNumberForWhitespaceIndex(t);return{id:s,afterLineNumber:o,verticalOffset:i,height:n}}getWhitespaceViewportData(e,t){this._checkPendingChanges(),e=e|0,t=t|0;const i=this.getWhitespaceIndexAtOrAfterVerticallOffset(e),n=this.getWhitespacesCount()-1;if(i<0)return[];const s=[];for(let o=i;o<=n;o++){const r=this.getVerticalOffsetForWhitespaceIndex(o),l=this.getHeightForWhitespaceIndex(o);if(r>=t)break;s.push({id:this.getIdForWhitespaceIndex(o),afterLineNumber:this.getAfterLineNumberForWhitespaceIndex(o),verticalOffset:r,height:l})}return s}getWhitespaces(){return this._checkPendingChanges(),this._arr.slice(0)}getWhitespacesCount(){return this._checkPendingChanges(),this._arr.length}getIdForWhitespaceIndex(e){return this._checkPendingChanges(),e=e|0,this._arr[e].id}getAfterLineNumberForWhitespaceIndex(e){return this._checkPendingChanges(),e=e|0,this._arr[e].afterLineNumber}getHeightForWhitespaceIndex(e){return this._checkPendingChanges(),e=e|0,this._arr[e].height}};Ds.INSTANCE_COUNT=0;let Dl=Ds;const X0=125;class hs{constructor(e,t,i,n){e=e|0,t=t|0,i=i|0,n=n|0,e<0&&(e=0),t<0&&(t=0),i<0&&(i=0),n<0&&(n=0),this.width=e,this.contentWidth=t,this.scrollWidth=Math.max(e,t),this.height=i,this.contentHeight=n,this.scrollHeight=Math.max(i,n)}equals(e){return this.width===e.width&&this.contentWidth===e.contentWidth&&this.height===e.height&&this.contentHeight===e.contentHeight}}class J0 extends H{constructor(e,t){super(),this._onDidContentSizeChange=this._register(new M),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._dimensions=new hs(0,0,0,0),this._scrollable=this._register(new Jd({forceIntegerValues:!0,smoothScrollDuration:e,scheduleAtNextAnimationFrame:t})),this.onDidScroll=this._scrollable.onScroll}getScrollable(){return this._scrollable}setSmoothScrollDuration(e){this._scrollable.setSmoothScrollDuration(e)}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}getScrollDimensions(){return this._dimensions}setScrollDimensions(e){if(this._dimensions.equals(e))return;const t=this._dimensions;this._dimensions=e,this._scrollable.setScrollDimensions({width:e.width,scrollWidth:e.scrollWidth,height:e.height,scrollHeight:e.scrollHeight},!0);const i=t.contentWidth!==e.contentWidth,n=t.contentHeight!==e.contentHeight;(i||n)&&this._onDidContentSizeChange.fire(new Ch(t.contentWidth,t.contentHeight,e.contentWidth,e.contentHeight))}getFutureScrollPosition(){return this._scrollable.getFutureScrollPosition()}getCurrentScrollPosition(){return this._scrollable.getCurrentScrollPosition()}setScrollPositionNow(e){this._scrollable.setScrollPositionNow(e)}setScrollPositionSmooth(e){this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}}class ex extends H{constructor(e,t,i){super(),this._configuration=e;const n=this._configuration.options,s=n.get(146),o=n.get(84);this._linesLayout=new Dl(t,n.get(67),o.top,o.bottom),this._maxLineWidth=0,this._overlayWidgetsMinWidth=0,this._scrollable=this._register(new J0(0,i)),this._configureSmoothScrollDuration(),this._scrollable.setScrollDimensions(new hs(s.contentWidth,0,s.height,0)),this.onDidScroll=this._scrollable.onDidScroll,this.onDidContentSizeChange=this._scrollable.onDidContentSizeChange,this._updateHeight()}dispose(){super.dispose()}getScrollable(){return this._scrollable.getScrollable()}onHeightMaybeChanged(){this._updateHeight()}_configureSmoothScrollDuration(){this._scrollable.setSmoothScrollDuration(this._configuration.options.get(115)?X0:0)}onConfigurationChanged(e){const t=this._configuration.options;if(e.hasChanged(67)&&this._linesLayout.setLineHeight(t.get(67)),e.hasChanged(84)){const i=t.get(84);this._linesLayout.setPadding(i.top,i.bottom)}if(e.hasChanged(146)){const i=t.get(146),n=i.contentWidth,s=i.height,o=this._scrollable.getScrollDimensions(),r=o.contentWidth;this._scrollable.setScrollDimensions(new hs(n,o.contentWidth,s,this._getContentHeight(n,s,r)))}else this._updateHeight();e.hasChanged(115)&&this._configureSmoothScrollDuration()}onFlushed(e){this._linesLayout.onFlushed(e)}onLinesDeleted(e,t){this._linesLayout.onLinesDeleted(e,t)}onLinesInserted(e,t){this._linesLayout.onLinesInserted(e,t)}_getHorizontalScrollbarHeight(e,t){const n=this._configuration.options.get(104);return n.horizontal===2||e>=t?0:n.horizontalScrollbarSize}_getContentHeight(e,t,i){const n=this._configuration.options;let s=this._linesLayout.getLinesTotalHeight();return n.get(106)?s+=Math.max(0,t-n.get(67)-n.get(84).bottom):n.get(104).ignoreHorizontalScrollbarInContentHeight||(s+=this._getHorizontalScrollbarHeight(e,i)),s}_updateHeight(){const e=this._scrollable.getScrollDimensions(),t=e.width,i=e.height,n=e.contentWidth;this._scrollable.setScrollDimensions(new hs(t,e.contentWidth,i,this._getContentHeight(t,i,n)))}getCurrentViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getCurrentScrollPosition();return new Uc(t.scrollTop,t.scrollLeft,e.width,e.height)}getFutureViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getFutureScrollPosition();return new Uc(t.scrollTop,t.scrollLeft,e.width,e.height)}_computeContentWidth(){const e=this._configuration.options,t=this._maxLineWidth,i=e.get(147),n=e.get(50),s=e.get(146);if(i.isViewportWrapping){const o=e.get(73);return t>s.contentWidth+n.typicalHalfwidthCharacterWidth&&o.enabled&&o.side==="right"?t+s.verticalScrollbarWidth:t}else{const o=e.get(105)*n.typicalHalfwidthCharacterWidth,r=this._linesLayout.getWhitespaceMinWidth();return Math.max(t+o+s.verticalScrollbarWidth,r,this._overlayWidgetsMinWidth)}}setMaxLineWidth(e){this._maxLineWidth=e,this._updateContentWidth()}setOverlayWidgetsMinWidth(e){this._overlayWidgetsMinWidth=e,this._updateContentWidth()}_updateContentWidth(){const e=this._scrollable.getScrollDimensions();this._scrollable.setScrollDimensions(new hs(e.width,this._computeContentWidth(),e.height,e.contentHeight)),this._updateHeight()}saveState(){const e=this._scrollable.getFutureScrollPosition(),t=e.scrollTop,i=this._linesLayout.getLineNumberAtOrAfterVerticalOffset(t),n=this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(i);return{scrollTop:t,scrollTopWithoutViewZones:t-n,scrollLeft:e.scrollLeft}}changeWhitespace(e){const t=this._linesLayout.changeWhitespace(e);return t&&this.onHeightMaybeChanged(),t}getVerticalOffsetForLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetAfterLineNumber(e,t)}isAfterLines(e){return this._linesLayout.isAfterLines(e)}isInTopPadding(e){return this._linesLayout.isInTopPadding(e)}isInBottomPadding(e){return this._linesLayout.isInBottomPadding(e)}getLineNumberAtVerticalOffset(e){return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(e)}getWhitespaceAtVerticalOffset(e){return this._linesLayout.getWhitespaceAtVerticalOffset(e)}getLinesViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getLinesViewportData(e.top,e.top+e.height)}getLinesViewportDataAtScrollTop(e){const t=this._scrollable.getScrollDimensions();return e+t.height>t.scrollHeight&&(e=t.scrollHeight-t.height),e<0&&(e=0),this._linesLayout.getLinesViewportData(e,e+t.height)}getWhitespaceViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getWhitespaceViewportData(e.top,e.top+e.height)}getWhitespaces(){return this._linesLayout.getWhitespaces()}getContentWidth(){return this._scrollable.getScrollDimensions().contentWidth}getScrollWidth(){return this._scrollable.getScrollDimensions().scrollWidth}getContentHeight(){return this._scrollable.getScrollDimensions().contentHeight}getScrollHeight(){return this._scrollable.getScrollDimensions().scrollHeight}getCurrentScrollLeft(){return this._scrollable.getCurrentScrollPosition().scrollLeft}getCurrentScrollTop(){return this._scrollable.getCurrentScrollPosition().scrollTop}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}setScrollPosition(e,t){t===1?this._scrollable.setScrollPositionNow(e):this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}deltaScrollNow(e,t){const i=this._scrollable.getCurrentScrollPosition();this._scrollable.setScrollPositionNow({scrollLeft:i.scrollLeft+e,scrollTop:i.scrollTop+t})}}class tx{constructor(e,t,i,n,s){this.editorId=e,this.model=t,this.configuration=i,this._linesCollection=n,this._coordinatesConverter=s,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(e){const t=e.id;let i=this._decorationsCache[t];if(!i){const n=e.range,s=e.options;let o;if(s.isWholeLine){const r=this._coordinatesConverter.convertModelPositionToViewPosition(new D(n.startLineNumber,1),0,!1,!0),l=this._coordinatesConverter.convertModelPositionToViewPosition(new D(n.endLineNumber,this.model.getLineMaxColumn(n.endLineNumber)),1);o=new v(r.lineNumber,r.column,l.lineNumber,l.column)}else o=this._coordinatesConverter.convertModelRangeToViewRange(n,1);i=new fg(o,s),this._decorationsCache[t]=i}return i}getMinimapDecorationsInRange(e){return this._getDecorationsInRange(e,!0,!1).decorations}getDecorationsViewportData(e){let t=this._cachedModelDecorationsResolver!==null;return t=t&&e.equalsRange(this._cachedModelDecorationsResolverViewRange),t||(this._cachedModelDecorationsResolver=this._getDecorationsInRange(e,!1,!1),this._cachedModelDecorationsResolverViewRange=e),this._cachedModelDecorationsResolver}getInlineDecorationsOnLine(e,t=!1,i=!1){const n=new v(e,this._linesCollection.getViewLineMinColumn(e),e,this._linesCollection.getViewLineMaxColumn(e));return this._getDecorationsInRange(n,t,i).inlineDecorations[0]}_getDecorationsInRange(e,t,i){const n=this._linesCollection.getDecorationsInRange(e,this.editorId,Po(this.configuration.options),t,i),s=e.startLineNumber,o=e.endLineNumber,r=[];let l=0;const h=[];for(let c=s;c<=o;c++)h[c-s]=[];for(let c=0,d=n.length;c<d;c++){const u=n[c],g=u.options;if(!ix(this.model,u))continue;const f=this._getOrCreateViewModelDecoration(u),m=f.range;if(r[l++]=f,g.inlineClassName){const _=new Do(m,g.inlineClassName,g.inlineClassNameAffectsLetterSpacing?3:0),C=Math.max(s,m.startLineNumber),p=Math.min(o,m.endLineNumber);for(let b=C;b<=p;b++)h[b-s].push(_)}if(g.beforeContentClassName&&s<=m.startLineNumber&&m.startLineNumber<=o){const _=new Do(new v(m.startLineNumber,m.startColumn,m.startLineNumber,m.startColumn),g.beforeContentClassName,1);h[m.startLineNumber-s].push(_)}if(g.afterContentClassName&&s<=m.endLineNumber&&m.endLineNumber<=o){const _=new Do(new v(m.endLineNumber,m.endColumn,m.endLineNumber,m.endColumn),g.afterContentClassName,2);h[m.endLineNumber-s].push(_)}}return{decorations:r,inlineDecorations:h}}}function ix(a,e){return!(e.options.hideInCommentTokens&&nx(a,e)||e.options.hideInStringTokens&&sx(a,e))}function nx(a,e){return Eg(a,e.range,t=>t===1)}function sx(a,e){return Eg(a,e.range,t=>t===2)}function Eg(a,e,t){for(let i=e.startLineNumber;i<=e.endLineNumber;i++){const n=a.tokenization.getLineTokens(i),s=i===e.startLineNumber,o=i===e.endLineNumber;let r=s?n.findTokenIndexAtOffset(e.startColumn-1):0;for(;r<n.getCount()&&!(o&&n.getStartOffset(r)>e.endColumn-1);){if(!t(n.getStandardTokenType(r)))return!1;r++}}return!0}function ba(a,e){return a===null?e?lr.INSTANCE:hr.INSTANCE:new ox(a,e)}class ox{constructor(e,t){this._projectionData=e,this._isVisible=t}isVisible(){return this._isVisible}setVisible(e){return this._isVisible=e,this}getProjectionData(){return this._projectionData}getViewLineCount(){return this._isVisible?this._projectionData.getOutputLineCount():0}getViewLineContent(e,t,i){this._assertVisible();const n=i>0?this._projectionData.breakOffsets[i-1]:0,s=this._projectionData.breakOffsets[i];let o;if(this._projectionData.injectionOffsets!==null){const r=this._projectionData.injectionOffsets.map((h,c)=>new gt(0,0,h+1,this._projectionData.injectionOptions[c],0));o=gt.applyInjectedText(e.getLineContent(t),r).substring(n,s)}else o=e.getValueInRange({startLineNumber:t,startColumn:n+1,endLineNumber:t,endColumn:s+1});return i>0&&(o=bd(this._projectionData.wrappedTextIndentLength)+o),o}getViewLineLength(e,t,i){return this._assertVisible(),this._projectionData.getLineLength(i)}getViewLineMinColumn(e,t,i){return this._assertVisible(),this._projectionData.getMinOutputOffset(i)+1}getViewLineMaxColumn(e,t,i){return this._assertVisible(),this._projectionData.getMaxOutputOffset(i)+1}getViewLineData(e,t,i){const n=new Array;return this.getViewLinesData(e,t,i,1,0,[!0],n),n[0]}getViewLinesData(e,t,i,n,s,o,r){this._assertVisible();const l=this._projectionData,h=l.injectionOffsets,c=l.injectionOptions;let d=null;if(h){d=[];let g=0,f=0;for(let m=0;m<l.getOutputLineCount();m++){const _=new Array;d[m]=_;const C=m>0?l.breakOffsets[m-1]:0,p=l.breakOffsets[m];for(;f<h.length;){const b=c[f].content.length,w=h[f]+g,L=w+b;if(w>p)break;if(C<L){const S=c[f];if(S.inlineClassName){const y=m>0?l.wrappedTextIndentLength:0,N=y+Math.max(w-C,0),x=y+Math.min(L-C,p-C);N!==x&&_.push(new nv(N,x,S.inlineClassName,S.inlineClassNameAffectsLetterSpacing))}}if(L<=p)g+=b,f++;else break}}}let u;h?u=e.tokenization.getLineTokens(t).withInserted(h.map((g,f)=>({offset:g,text:c[f].content,tokenMetadata:st.defaultTokenMetadata}))):u=e.tokenization.getLineTokens(t);for(let g=i;g<i+n;g++){const f=s+g-i;if(!o[f]){r[f]=null;continue}r[f]=this._getViewLineData(u,d?d[g]:null,g)}}_getViewLineData(e,t,i){this._assertVisible();const n=this._projectionData,s=i>0?n.wrappedTextIndentLength:0,o=i>0?n.breakOffsets[i-1]:0,r=n.breakOffsets[i],l=e.sliceAndInflate(o,r,s);let h=l.getLineContent();i>0&&(h=bd(n.wrappedTextIndentLength)+h);const c=this._projectionData.getMinOutputOffset(i)+1,d=h.length+1,u=i+1<this.getViewLineCount(),g=i===0?0:n.breakOffsetsVisibleColumn[i-1];return new oh(h,u,c,d,g,l,t)}getModelColumnOfViewPosition(e,t){return this._assertVisible(),this._projectionData.translateToInputOffset(e,t-1)+1}getViewPositionOfModelPosition(e,t,i=2){return this._assertVisible(),this._projectionData.translateToOutputPosition(t-1,i).toPosition(e)}getViewLineNumberOfModelPosition(e,t){this._assertVisible();const i=this._projectionData.translateToOutputPosition(t-1);return e+i.outputLineIndex}normalizePosition(e,t,i){const n=t.lineNumber-e;return this._projectionData.normalizeOutputPosition(e,t.column-1,i).toPosition(n)}getInjectedTextAt(e,t){return this._projectionData.getInjectedText(e,t-1)}_assertVisible(){if(!this._isVisible)throw new Error("Not supported")}}const xr=class xr{constructor(){}isVisible(){return!0}setVisible(e){return e?this:hr.INSTANCE}getProjectionData(){return null}getViewLineCount(){return 1}getViewLineContent(e,t,i){return e.getLineContent(t)}getViewLineLength(e,t,i){return e.getLineLength(t)}getViewLineMinColumn(e,t,i){return e.getLineMinColumn(t)}getViewLineMaxColumn(e,t,i){return e.getLineMaxColumn(t)}getViewLineData(e,t,i){const n=e.tokenization.getLineTokens(t),s=n.getLineContent();return new oh(s,!1,1,s.length+1,0,n.inflate(),null)}getViewLinesData(e,t,i,n,s,o,r){if(!o[s]){r[s]=null;return}r[s]=this.getViewLineData(e,t,0)}getModelColumnOfViewPosition(e,t){return t}getViewPositionOfModelPosition(e,t){return new D(e,t)}getViewLineNumberOfModelPosition(e,t){return e}normalizePosition(e,t,i){return t}getInjectedTextAt(e,t){return null}};xr.INSTANCE=new xr;let lr=xr;const yr=class yr{constructor(){}isVisible(){return!1}setVisible(e){return e?lr.INSTANCE:this}getProjectionData(){return null}getViewLineCount(){return 0}getViewLineContent(e,t,i){throw new Error("Not supported")}getViewLineLength(e,t,i){throw new Error("Not supported")}getViewLineMinColumn(e,t,i){throw new Error("Not supported")}getViewLineMaxColumn(e,t,i){throw new Error("Not supported")}getViewLineData(e,t,i){throw new Error("Not supported")}getViewLinesData(e,t,i,n,s,o,r){throw new Error("Not supported")}getModelColumnOfViewPosition(e,t){throw new Error("Not supported")}getViewPositionOfModelPosition(e,t){throw new Error("Not supported")}getViewLineNumberOfModelPosition(e,t){throw new Error("Not supported")}normalizePosition(e,t,i){throw new Error("Not supported")}getInjectedTextAt(e,t){throw new Error("Not supported")}};yr.INSTANCE=new yr;let hr=yr;const wa=[""];function bd(a){if(a>=wa.length)for(let e=1;e<=a;e++)wa[e]=rx(e);return wa[a]}function rx(a){return new Array(a+1).join(" ")}class ax{constructor(e,t,i,n,s,o,r,l,h,c){this._editorId=e,this.model=t,this._validModelVersionId=-1,this._domLineBreaksComputerFactory=i,this._monospaceLineBreaksComputerFactory=n,this.fontInfo=s,this.tabSize=o,this.wrappingStrategy=r,this.wrappingColumn=l,this.wrappingIndent=h,this.wordBreak=c,this._constructLines(!0,null)}dispose(){this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[])}createCoordinatesConverter(){return new hx(this)}_constructLines(e,t){this.modelLineProjections=[],e&&(this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[]));const i=this.model.getLinesContent(),n=this.model.getInjectedTextDecorations(this._editorId),s=i.length,o=this.createLineBreaksComputer(),r=new ji(gt.fromDecorations(n));for(let m=0;m<s;m++){const _=r.takeWhile(C=>C.lineNumber===m+1);o.addRequest(i[m],_,t?t[m]:null)}const l=o.finalize(),h=[],c=this.hiddenAreasDecorationIds.map(m=>this.model.getDecorationRange(m)).sort(v.compareRangesUsingStarts);let d=1,u=0,g=-1,f=g+1<c.length?u+1:s+2;for(let m=0;m<s;m++){const _=m+1;_===f&&(g++,d=c[g].startLineNumber,u=c[g].endLineNumber,f=g+1<c.length?u+1:s+2);const C=_>=d&&_<=u,p=ba(l[m],!C);h[m]=p.getViewLineCount(),this.modelLineProjections[m]=p}this._validModelVersionId=this.model.getVersionId(),this.projectedModelLineLineCounts=new $_(h)}getHiddenAreas(){return this.hiddenAreasDecorationIds.map(e=>this.model.getDecorationRange(e))}setHiddenAreas(e){const t=e.map(u=>this.model.validateRange(u)),i=lx(t),n=this.hiddenAreasDecorationIds.map(u=>this.model.getDecorationRange(u)).sort(v.compareRangesUsingStarts);if(i.length===n.length){let u=!1;for(let g=0;g<i.length;g++)if(!i[g].equalsRange(n[g])){u=!0;break}if(!u)return!1}const s=i.map(u=>({range:u,options:it.EMPTY}));this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,s);const o=i;let r=1,l=0,h=-1,c=h+1<o.length?l+1:this.modelLineProjections.length+2,d=!1;for(let u=0;u<this.modelLineProjections.length;u++){const g=u+1;g===c&&(h++,r=o[h].startLineNumber,l=o[h].endLineNumber,c=h+1<o.length?l+1:this.modelLineProjections.length+2);let f=!1;if(g>=r&&g<=l?this.modelLineProjections[u].isVisible()&&(this.modelLineProjections[u]=this.modelLineProjections[u].setVisible(!1),f=!0):(d=!0,this.modelLineProjections[u].isVisible()||(this.modelLineProjections[u]=this.modelLineProjections[u].setVisible(!0),f=!0)),f){const m=this.modelLineProjections[u].getViewLineCount();this.projectedModelLineLineCounts.setValue(u,m)}}return d||this.setHiddenAreas([]),!0}modelPositionIsVisible(e,t){return e<1||e>this.modelLineProjections.length?!1:this.modelLineProjections[e-1].isVisible()}getModelLineViewLineCount(e){return e<1||e>this.modelLineProjections.length?1:this.modelLineProjections[e-1].getViewLineCount()}setTabSize(e){return this.tabSize===e?!1:(this.tabSize=e,this._constructLines(!1,null),!0)}setWrappingSettings(e,t,i,n,s){const o=this.fontInfo.equals(e),r=this.wrappingStrategy===t,l=this.wrappingColumn===i,h=this.wrappingIndent===n,c=this.wordBreak===s;if(o&&r&&l&&h&&c)return!1;const d=o&&r&&!l&&h&&c;this.fontInfo=e,this.wrappingStrategy=t,this.wrappingColumn=i,this.wrappingIndent=n,this.wordBreak=s;let u=null;if(d){u=[];for(let g=0,f=this.modelLineProjections.length;g<f;g++)u[g]=this.modelLineProjections[g].getProjectionData()}return this._constructLines(!1,u),!0}createLineBreaksComputer(){return(this.wrappingStrategy==="advanced"?this._domLineBreaksComputerFactory:this._monospaceLineBreaksComputerFactory).createLineBreaksComputer(this.fontInfo,this.tabSize,this.wrappingColumn,this.wrappingIndent,this.wordBreak)}onModelFlushed(){this._constructLines(!0,null)}onModelLinesDeleted(e,t,i){if(!e||e<=this._validModelVersionId)return null;const n=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,s=this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections.splice(t-1,i-t+1),this.projectedModelLineLineCounts.removeValues(t-1,i-t+1),new yl(n,s)}onModelLinesInserted(e,t,i,n){if(!e||e<=this._validModelVersionId)return null;const s=t>2&&!this.modelLineProjections[t-2].isVisible(),o=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1;let r=0;const l=[],h=[];for(let c=0,d=n.length;c<d;c++){const u=ba(n[c],!s);l.push(u);const g=u.getViewLineCount();r+=g,h[c]=g}return this.modelLineProjections=this.modelLineProjections.slice(0,t-1).concat(l).concat(this.modelLineProjections.slice(t-1)),this.projectedModelLineLineCounts.insertValues(t-1,h),new Nl(o,o+r-1)}onModelLineChanged(e,t,i){if(e!==null&&e<=this._validModelVersionId)return[!1,null,null,null];const n=t-1,s=this.modelLineProjections[n].getViewLineCount(),o=this.modelLineProjections[n].isVisible(),r=ba(i,o);this.modelLineProjections[n]=r;const l=this.modelLineProjections[n].getViewLineCount();let h=!1,c=0,d=-1,u=0,g=-1,f=0,m=-1;s>l?(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,d=c+l-1,f=d+1,m=f+(s-l)-1,h=!0):s<l?(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,d=c+s-1,u=d+1,g=u+(l-s)-1,h=!0):(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,d=c+l-1),this.projectedModelLineLineCounts.setValue(n,l);const _=c<=d?new Tg(c,d-c+1):null,C=u<=g?new Nl(u,g):null,p=f<=m?new yl(f,m):null;return[h,_,C,p]}acceptVersionId(e){this._validModelVersionId=e,this.modelLineProjections.length===1&&!this.modelLineProjections[0].isVisible()&&this.setHiddenAreas([])}getViewLineCount(){return this.projectedModelLineLineCounts.getTotalSum()}_toValidViewLineNumber(e){if(e<1)return 1;const t=this.getViewLineCount();return e>t?t:e|0}getActiveIndentGuide(e,t,i){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t),i=this._toValidViewLineNumber(i);const n=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),s=this.convertViewPositionToModelPosition(t,this.getViewLineMinColumn(t)),o=this.convertViewPositionToModelPosition(i,this.getViewLineMinColumn(i)),r=this.model.guides.getActiveIndentGuide(n.lineNumber,s.lineNumber,o.lineNumber),l=this.convertModelPositionToViewPosition(r.startLineNumber,1),h=this.convertModelPositionToViewPosition(r.endLineNumber,this.model.getLineMaxColumn(r.endLineNumber));return{startLineNumber:l.lineNumber,endLineNumber:h.lineNumber,indent:r.indent}}getViewLineInfo(e){e=this._toValidViewLineNumber(e);const t=this.projectedModelLineLineCounts.getIndexOf(e-1),i=t.index,n=t.remainder;return new wd(i+1,n)}getMinColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getMaxColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getModelStartPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],i=t.getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),n=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,i);return new D(e.modelLineNumber,n)}getModelEndPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],i=t.getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),n=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,i);return new D(e.modelLineNumber,n)}getViewLineInfosGroupedByModelRanges(e,t){const i=this.getViewLineInfo(e),n=this.getViewLineInfo(t),s=new Array;let o=this.getModelStartPositionOfViewLine(i),r=new Array;for(let l=i.modelLineNumber;l<=n.modelLineNumber;l++){const h=this.modelLineProjections[l-1];if(h.isVisible()){const c=l===i.modelLineNumber?i.modelLineWrappedLineIdx:0,d=l===n.modelLineNumber?n.modelLineWrappedLineIdx+1:h.getViewLineCount();for(let u=c;u<d;u++)r.push(new wd(l,u))}if(!h.isVisible()&&o){const c=new D(l-1,this.model.getLineMaxColumn(l-1)+1),d=v.fromPositions(o,c);s.push(new Ld(d,r)),r=[],o=null}else h.isVisible()&&!o&&(o=new D(l,1))}if(o){const l=v.fromPositions(o,this.getModelEndPositionOfViewLine(n));s.push(new Ld(l,r))}return s}getViewLinesBracketGuides(e,t,i,n){const s=i?this.convertViewPositionToModelPosition(i.lineNumber,i.column):null,o=[];for(const r of this.getViewLineInfosGroupedByModelRanges(e,t)){const l=r.modelRange.startLineNumber,h=this.model.guides.getLinesBracketGuides(l,r.modelRange.endLineNumber,s,n);for(const c of r.viewLines){const u=h[c.modelLineNumber-l].map(g=>{if(g.forWrappedLinesAfterColumn!==-1&&this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.forWrappedLinesAfterColumn).lineNumber>=c.modelLineWrappedLineIdx||g.forWrappedLinesBeforeOrAtColumn!==-1&&this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.forWrappedLinesBeforeOrAtColumn).lineNumber<c.modelLineWrappedLineIdx)return;if(!g.horizontalLine)return g;let f=-1;if(g.column!==-1){const C=this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.column);if(C.lineNumber===c.modelLineWrappedLineIdx)f=C.column;else if(C.lineNumber<c.modelLineWrappedLineIdx)f=this.getMinColumnOfViewLine(c);else if(C.lineNumber>c.modelLineWrappedLineIdx)return}const m=this.convertModelPositionToViewPosition(c.modelLineNumber,g.horizontalLine.endColumn),_=this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.horizontalLine.endColumn);return _.lineNumber===c.modelLineWrappedLineIdx?new Mi(g.visibleColumn,f,g.className,new fs(g.horizontalLine.top,m.column),-1,-1):_.lineNumber<c.modelLineWrappedLineIdx||g.visibleColumn!==-1?void 0:new Mi(g.visibleColumn,f,g.className,new fs(g.horizontalLine.top,this.getMaxColumnOfViewLine(c)),-1,-1)});o.push(u.filter(g=>!!g))}}return o}getViewLinesIndentGuides(e,t){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const i=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),n=this.convertViewPositionToModelPosition(t,this.getViewLineMaxColumn(t));let s=[];const o=[],r=[],l=i.lineNumber-1,h=n.lineNumber-1;let c=null;for(let f=l;f<=h;f++){const m=this.modelLineProjections[f];if(m.isVisible()){const _=m.getViewLineNumberOfModelPosition(0,f===l?i.column:1),C=m.getViewLineNumberOfModelPosition(0,this.model.getLineMaxColumn(f+1)),p=C-_+1;let b=0;p>1&&m.getViewLineMinColumn(this.model,f+1,C)===1&&(b=_===0?1:2),o.push(p),r.push(b),c===null&&(c=new D(f+1,0))}else c!==null&&(s=s.concat(this.model.guides.getLinesIndentGuides(c.lineNumber,f)),c=null)}c!==null&&(s=s.concat(this.model.guides.getLinesIndentGuides(c.lineNumber,n.lineNumber)),c=null);const d=t-e+1,u=new Array(d);let g=0;for(let f=0,m=s.length;f<m;f++){let _=s[f];const C=Math.min(d-g,o[f]),p=r[f];let b;p===2?b=0:p===1?b=1:b=C;for(let w=0;w<C;w++)w===b&&(_=0),u[g++]=_}return u}getViewLineContent(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineContent(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineLength(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineLength(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMinColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMinColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMaxColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMaxColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineData(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineData(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLinesData(e,t,i){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const n=this.projectedModelLineLineCounts.getIndexOf(e-1);let s=e;const o=n.index,r=n.remainder,l=[];for(let h=o,c=this.model.getLineCount();h<c;h++){const d=this.modelLineProjections[h];if(!d.isVisible())continue;const u=h===o?r:0;let g=d.getViewLineCount()-u,f=!1;if(s+g>t&&(f=!0,g=t-s+1),d.getViewLinesData(this.model,h+1,u,g,s-e,i,l),s+=g,f)break}return l}validateViewPosition(e,t,i){e=this._toValidViewLineNumber(e);const n=this.projectedModelLineLineCounts.getIndexOf(e-1),s=n.index,o=n.remainder,r=this.modelLineProjections[s],l=r.getViewLineMinColumn(this.model,s+1,o),h=r.getViewLineMaxColumn(this.model,s+1,o);t<l&&(t=l),t>h&&(t=h);const c=r.getModelColumnOfViewPosition(o,t);return this.model.validatePosition(new D(s+1,c)).equals(i)?new D(e,t):this.convertModelPositionToViewPosition(i.lineNumber,i.column)}validateViewRange(e,t){const i=this.validateViewPosition(e.startLineNumber,e.startColumn,t.getStartPosition()),n=this.validateViewPosition(e.endLineNumber,e.endColumn,t.getEndPosition());return new v(i.lineNumber,i.column,n.lineNumber,n.column)}convertViewPositionToModelPosition(e,t){const i=this.getViewLineInfo(e),n=this.modelLineProjections[i.modelLineNumber-1].getModelColumnOfViewPosition(i.modelLineWrappedLineIdx,t);return this.model.validatePosition(new D(i.modelLineNumber,n))}convertViewRangeToModelRange(e){const t=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),i=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);return new v(t.lineNumber,t.column,i.lineNumber,i.column)}convertModelPositionToViewPosition(e,t,i=2,n=!1,s=!1){const o=this.model.validatePosition(new D(e,t)),r=o.lineNumber,l=o.column;let h=r-1,c=!1;if(s)for(;h<this.modelLineProjections.length&&!this.modelLineProjections[h].isVisible();)h++,c=!0;else for(;h>0&&!this.modelLineProjections[h].isVisible();)h--,c=!0;if(h===0&&!this.modelLineProjections[h].isVisible())return new D(n?0:1,1);const d=1+this.projectedModelLineLineCounts.getPrefixSum(h);let u;return c?s?u=this.modelLineProjections[h].getViewPositionOfModelPosition(d,1,i):u=this.modelLineProjections[h].getViewPositionOfModelPosition(d,this.model.getLineMaxColumn(h+1),i):u=this.modelLineProjections[r-1].getViewPositionOfModelPosition(d,l,i),u}convertModelRangeToViewRange(e,t=0){if(e.isEmpty()){const i=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,t);return v.fromPositions(i)}else{const i=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,1),n=this.convertModelPositionToViewPosition(e.endLineNumber,e.endColumn,0);return new v(i.lineNumber,i.column,n.lineNumber,n.column)}}getViewLineNumberOfModelPosition(e,t){let i=e-1;if(this.modelLineProjections[i].isVisible()){const s=1+this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections[i].getViewLineNumberOfModelPosition(s,t)}for(;i>0&&!this.modelLineProjections[i].isVisible();)i--;if(i===0&&!this.modelLineProjections[i].isVisible())return 1;const n=1+this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections[i].getViewLineNumberOfModelPosition(n,this.model.getLineMaxColumn(i+1))}getDecorationsInRange(e,t,i,n,s){const o=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),r=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);if(r.lineNumber-o.lineNumber<=e.endLineNumber-e.startLineNumber)return this.model.getDecorationsInRange(new v(o.lineNumber,1,r.lineNumber,r.column),t,i,n,s);let l=[];const h=o.lineNumber-1,c=r.lineNumber-1;let d=null;for(let m=h;m<=c;m++)if(this.modelLineProjections[m].isVisible())d===null&&(d=new D(m+1,m===h?o.column:1));else if(d!==null){const C=this.model.getLineMaxColumn(m);l=l.concat(this.model.getDecorationsInRange(new v(d.lineNumber,d.column,m,C),t,i,n)),d=null}d!==null&&(l=l.concat(this.model.getDecorationsInRange(new v(d.lineNumber,d.column,r.lineNumber,r.column),t,i,n)),d=null),l.sort((m,_)=>{const C=v.compareRangesUsingStarts(m.range,_.range);return C===0?m.id<_.id?-1:m.id>_.id?1:0:C});const u=[];let g=0,f=null;for(const m of l){const _=m.id;f!==_&&(f=_,u[g++]=m)}return u}getInjectedTextAt(e){const t=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[t.modelLineNumber-1].getInjectedTextAt(t.modelLineWrappedLineIdx,e.column)}normalizePosition(e,t){const i=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[i.modelLineNumber-1].normalizePosition(i.modelLineWrappedLineIdx,e,t)}getLineIndentColumn(e){const t=this.getViewLineInfo(e);return t.modelLineWrappedLineIdx===0?this.model.getLineIndentColumn(t.modelLineNumber):0}}function lx(a){if(a.length===0)return[];const e=a.slice();e.sort(v.compareRangesUsingStarts);const t=[];let i=e[0].startLineNumber,n=e[0].endLineNumber;for(let s=1,o=e.length;s<o;s++){const r=e[s];r.startLineNumber>n+1?(t.push(new v(i,1,n,1)),i=r.startLineNumber,n=r.endLineNumber):r.endLineNumber>n&&(n=r.endLineNumber)}return t.push(new v(i,1,n,1)),t}class wd{constructor(e,t){this.modelLineNumber=e,this.modelLineWrappedLineIdx=t}}class Ld{constructor(e,t){this.modelRange=e,this.viewLines=t}}class hx{constructor(e){this._lines=e}convertViewPositionToModelPosition(e){return this._lines.convertViewPositionToModelPosition(e.lineNumber,e.column)}convertViewRangeToModelRange(e){return this._lines.convertViewRangeToModelRange(e)}validateViewPosition(e,t){return this._lines.validateViewPosition(e.lineNumber,e.column,t)}validateViewRange(e,t){return this._lines.validateViewRange(e,t)}convertModelPositionToViewPosition(e,t,i,n){return this._lines.convertModelPositionToViewPosition(e.lineNumber,e.column,t,i,n)}convertModelRangeToViewRange(e,t){return this._lines.convertModelRangeToViewRange(e,t)}modelPositionIsVisible(e){return this._lines.modelPositionIsVisible(e.lineNumber,e.column)}getModelLineViewLineCount(e){return this._lines.getModelLineViewLineCount(e)}getViewLineNumberOfModelPosition(e,t){return this._lines.getViewLineNumberOfModelPosition(e,t)}}class cx{constructor(e){this.model=e}dispose(){}createCoordinatesConverter(){return new dx(this)}getHiddenAreas(){return[]}setHiddenAreas(e){return!1}setTabSize(e){return!1}setWrappingSettings(e,t,i,n){return!1}createLineBreaksComputer(){const e=[];return{addRequest:(t,i,n)=>{e.push(null)},finalize:()=>e}}onModelFlushed(){}onModelLinesDeleted(e,t,i){return new yl(t,i)}onModelLinesInserted(e,t,i,n){return new Nl(t,i)}onModelLineChanged(e,t,i){return[!1,new Tg(t,1),null,null]}acceptVersionId(e){}getViewLineCount(){return this.model.getLineCount()}getActiveIndentGuide(e,t,i){return{startLineNumber:e,endLineNumber:e,indent:0}}getViewLinesBracketGuides(e,t,i){return new Array(t-e+1).fill([])}getViewLinesIndentGuides(e,t){const i=t-e+1,n=new Array(i);for(let s=0;s<i;s++)n[s]=0;return n}getViewLineContent(e){return this.model.getLineContent(e)}getViewLineLength(e){return this.model.getLineLength(e)}getViewLineMinColumn(e){return this.model.getLineMinColumn(e)}getViewLineMaxColumn(e){return this.model.getLineMaxColumn(e)}getViewLineData(e){const t=this.model.tokenization.getLineTokens(e),i=t.getLineContent();return new oh(i,!1,1,i.length+1,0,t.inflate(),null)}getViewLinesData(e,t,i){const n=this.model.getLineCount();e=Math.min(Math.max(1,e),n),t=Math.min(Math.max(1,t),n);const s=[];for(let o=e;o<=t;o++){const r=o-e;s[r]=i[r]?this.getViewLineData(o):null}return s}getDecorationsInRange(e,t,i,n,s){return this.model.getDecorationsInRange(e,t,i,n,s)}normalizePosition(e,t){return this.model.normalizePosition(e,t)}getLineIndentColumn(e){return this.model.getLineIndentColumn(e)}getInjectedTextAt(e){return null}}class dx{constructor(e){this._lines=e}_validPosition(e){return this._lines.model.validatePosition(e)}_validRange(e){return this._lines.model.validateRange(e)}convertViewPositionToModelPosition(e){return this._validPosition(e)}convertViewRangeToModelRange(e){return this._validRange(e)}validateViewPosition(e,t){return this._validPosition(t)}validateViewRange(e,t){return this._validRange(t)}convertModelPositionToViewPosition(e){return this._validPosition(e)}convertModelRangeToViewRange(e){return this._validRange(e)}modelPositionIsVisible(e){const t=this._lines.model.getLineCount();return!(e.lineNumber<1||e.lineNumber>t)}getModelLineViewLineCount(e){return 1}getViewLineNumberOfModelPosition(e,t){return e}}const _i=Gi.Right;class ux{constructor(e){this.persist=0,this._requiredLanes=1,this.lanes=new Uint8Array(Math.ceil((e+1)*_i/8))}reset(e){const t=Math.ceil((e+1)*_i/8);this.lanes.length<t?this.lanes=new Uint8Array(t):this.lanes.fill(0),this._requiredLanes=1}get requiredLanes(){return this._requiredLanes}push(e,t,i){i&&(this.persist|=1<<e-1);for(let n=t.startLineNumber;n<=t.endLineNumber;n++){const s=_i*n+(e-1);this.lanes[s>>>3]|=1<<s%8,this._requiredLanes=Math.max(this._requiredLanes,this.countAtLine(n))}}getLanesAtLine(e){const t=[];let i=_i*e;for(let n=0;n<_i;n++)(this.persist&1<<n||this.lanes[i>>>3]&1<<i%8)&&t.push(n+1),i++;return t.length?t:[Gi.Center]}countAtLine(e){let t=_i*e,i=0;for(let n=0;n<_i;n++)(this.persist&1<<n||this.lanes[t>>>3]&1<<t%8)&&i++,t++;return i}}class gx extends H{constructor(e,t,i,n,s,o,r,l,h,c){if(super(),this.languageConfigurationService=r,this._themeService=l,this._attachedView=h,this._transactionalTarget=c,this.hiddenAreasModel=new mx,this.previousHiddenAreas=[],this._editorId=e,this._configuration=t,this.model=i,this._eventDispatcher=new P0,this.onEvent=this._eventDispatcher.onEvent,this.cursorConfig=new rn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._updateConfigurationViewLineCount=this._register(new si(()=>this._updateConfigurationViewLineCountNow(),0)),this._hasFocus=!1,this._viewportStart=Lh.create(this.model),this.glyphLanes=new ux(0),this.model.isTooLargeForTokenization())this._lines=new cx(this.model);else{const d=this._configuration.options,u=d.get(50),g=d.get(140),f=d.get(147),m=d.get(139),_=d.get(130);this._lines=new ax(this._editorId,this.model,n,s,u,this.model.getOptions().tabSize,g,f.wrappingColumn,m,_)}this.coordinatesConverter=this._lines.createCoordinatesConverter(),this._cursor=this._register(new K0(i,this,this.coordinatesConverter,this.cursorConfig)),this.viewLayout=this._register(new ex(this._configuration,this.getLineCount(),o)),this._register(this.viewLayout.onDidScroll(d=>{d.scrollTopChanged&&this._handleVisibleLinesChanged(),d.scrollTopChanged&&this._viewportStart.invalidate(),this._eventDispatcher.emitSingleViewEvent(new E0(d)),this._eventDispatcher.emitOutgoingEvent(new wh(d.oldScrollWidth,d.oldScrollLeft,d.oldScrollHeight,d.oldScrollTop,d.scrollWidth,d.scrollLeft,d.scrollHeight,d.scrollTop))})),this._register(this.viewLayout.onDidContentSizeChange(d=>{this._eventDispatcher.emitOutgoingEvent(d)})),this._decorations=new tx(this._editorId,this.model,this._configuration,this._lines,this.coordinatesConverter),this._registerModelEvents(),this._register(this._configuration.onDidChangeFast(d=>{try{const u=this._eventDispatcher.beginEmitViewEvents();this._onConfigurationChanged(u,d)}finally{this._eventDispatcher.endEmitViewEvents()}})),this._register(sr.getInstance().onDidChange(()=>{this._eventDispatcher.emitSingleViewEvent(new A0)})),this._register(this._themeService.onDidColorThemeChange(d=>{this._invalidateDecorationsColorCache(),this._eventDispatcher.emitSingleViewEvent(new M0(d))})),this._updateConfigurationViewLineCountNow()}dispose(){super.dispose(),this._decorations.dispose(),this._lines.dispose(),this._viewportStart.dispose(),this._eventDispatcher.dispose()}createLineBreaksComputer(){return this._lines.createLineBreaksComputer()}addViewEventHandler(e){this._eventDispatcher.addViewEventHandler(e)}removeViewEventHandler(e){this._eventDispatcher.removeViewEventHandler(e)}_updateConfigurationViewLineCountNow(){this._configuration.setViewLineCount(this._lines.getViewLineCount())}getModelVisibleRanges(){const e=this.viewLayout.getLinesViewportData(),t=new v(e.startLineNumber,this.getLineMinColumn(e.startLineNumber),e.endLineNumber,this.getLineMaxColumn(e.endLineNumber));return this._toModelVisibleRanges(t)}visibleLinesStabilized(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!0)}_handleVisibleLinesChanged(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!1)}setHasFocus(e){this._hasFocus=e,this._cursor.setHasFocus(e),this._eventDispatcher.emitSingleViewEvent(new k0(e)),this._eventDispatcher.emitOutgoingEvent(new bh(!e,e))}onCompositionStart(){this._eventDispatcher.emitSingleViewEvent(new y0)}onCompositionEnd(){this._eventDispatcher.emitSingleViewEvent(new N0)}_captureStableViewport(){if(this._viewportStart.isValid&&this.viewLayout.getCurrentScrollTop()>0){const e=new D(this._viewportStart.viewLineNumber,this.getLineMinColumn(this._viewportStart.viewLineNumber)),t=this.coordinatesConverter.convertViewPositionToModelPosition(e);return new Sd(t,this._viewportStart.startLineDelta)}return new Sd(null,0)}_onConfigurationChanged(e,t){const i=this._captureStableViewport(),n=this._configuration.options,s=n.get(50),o=n.get(140),r=n.get(147),l=n.get(139),h=n.get(130);this._lines.setWrappingSettings(s,o,r.wrappingColumn,l,h)&&(e.emitViewEvent(new wo),e.emitViewEvent(new Lo),e.emitViewEvent(new pi(null)),this._cursor.onLineMappingChanged(e),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this._updateConfigurationViewLineCount.schedule()),t.hasChanged(92)&&(this._decorations.reset(),e.emitViewEvent(new pi(null))),t.hasChanged(99)&&(this._decorations.reset(),e.emitViewEvent(new pi(null))),e.emitViewEvent(new D0(t)),this.viewLayout.onConfigurationChanged(t),i.recoverViewportStart(this.coordinatesConverter,this.viewLayout),rn.shouldRecreate(t)&&(this.cursorConfig=new rn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig))}_registerModelEvents(){this._register(this.model.onDidChangeContentOrInjectedText(e=>{try{const i=this._eventDispatcher.beginEmitViewEvents();let n=!1,s=!1;const o=e instanceof Wi?e.rawContentChangedEvent.changes:e.changes,r=e instanceof Wi?e.rawContentChangedEvent.versionId:null,l=this._lines.createLineBreaksComputer();for(const d of o)switch(d.changeType){case 4:{for(let u=0;u<d.detail.length;u++){const g=d.detail[u];let f=d.injectedTexts[u];f&&(f=f.filter(m=>!m.ownerId||m.ownerId===this._editorId)),l.addRequest(g,f,null)}break}case 2:{let u=null;d.injectedText&&(u=d.injectedText.filter(g=>!g.ownerId||g.ownerId===this._editorId)),l.addRequest(d.detail,u,null);break}}const h=l.finalize(),c=new ji(h);for(const d of o)switch(d.changeType){case 1:{this._lines.onModelFlushed(),i.emitViewEvent(new wo),this._decorations.reset(),this.viewLayout.onFlushed(this.getLineCount()),n=!0;break}case 3:{const u=this._lines.onModelLinesDeleted(r,d.fromLineNumber,d.toLineNumber);u!==null&&(i.emitViewEvent(u),this.viewLayout.onLinesDeleted(u.fromLineNumber,u.toLineNumber)),n=!0;break}case 4:{const u=c.takeCount(d.detail.length),g=this._lines.onModelLinesInserted(r,d.fromLineNumber,d.toLineNumber,u);g!==null&&(i.emitViewEvent(g),this.viewLayout.onLinesInserted(g.fromLineNumber,g.toLineNumber)),n=!0;break}case 2:{const u=c.dequeue(),[g,f,m,_]=this._lines.onModelLineChanged(r,d.lineNumber,u);s=g,f&&i.emitViewEvent(f),m&&(i.emitViewEvent(m),this.viewLayout.onLinesInserted(m.fromLineNumber,m.toLineNumber)),_&&(i.emitViewEvent(_),this.viewLayout.onLinesDeleted(_.fromLineNumber,_.toLineNumber));break}case 5:break}r!==null&&this._lines.acceptVersionId(r),this.viewLayout.onHeightMaybeChanged(),!n&&s&&(i.emitViewEvent(new Lo),i.emitViewEvent(new pi(null)),this._cursor.onLineMappingChanged(i),this._decorations.onLineMappingChanged())}finally{this._eventDispatcher.endEmitViewEvents()}const t=this._viewportStart.isValid;if(this._viewportStart.invalidate(),this._configuration.setModelLineCount(this.model.getLineCount()),this._updateConfigurationViewLineCountNow(),!this._hasFocus&&this.model.getAttachedEditorCount()>=2&&t){const i=this.model._getTrackedRange(this._viewportStart.modelTrackedRange);if(i){const n=this.coordinatesConverter.convertModelPositionToViewPosition(i.getStartPosition()),s=this.viewLayout.getVerticalOffsetForLineNumber(n.lineNumber);this.viewLayout.setScrollPosition({scrollTop:s+this._viewportStart.startLineDelta},1)}}try{const i=this._eventDispatcher.beginEmitViewEvents();e instanceof Wi&&i.emitOutgoingEvent(new j0(e.contentChangedEvent)),this._cursor.onModelContentChanged(i,e)}finally{this._eventDispatcher.endEmitViewEvents()}this._handleVisibleLinesChanged()})),this._register(this.model.onDidChangeTokens(e=>{const t=[];for(let i=0,n=e.ranges.length;i<n;i++){const s=e.ranges[i],o=this.coordinatesConverter.convertModelPositionToViewPosition(new D(s.fromLineNumber,1)).lineNumber,r=this.coordinatesConverter.convertModelPositionToViewPosition(new D(s.toLineNumber,this.model.getLineMaxColumn(s.toLineNumber))).lineNumber;t[i]={fromLineNumber:o,toLineNumber:r}}this._eventDispatcher.emitSingleViewEvent(new R0(t)),this._eventDispatcher.emitOutgoingEvent(new G0(e))})),this._register(this.model.onDidChangeLanguageConfiguration(e=>{this._eventDispatcher.emitSingleViewEvent(new T0),this.cursorConfig=new rn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new U0(e))})),this._register(this.model.onDidChangeLanguage(e=>{this.cursorConfig=new rn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new z0(e))})),this._register(this.model.onDidChangeOptions(e=>{if(this._lines.setTabSize(this.model.getOptions().tabSize)){try{const t=this._eventDispatcher.beginEmitViewEvents();t.emitViewEvent(new wo),t.emitViewEvent(new Lo),t.emitViewEvent(new pi(null)),this._cursor.onLineMappingChanged(t),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule()}this.cursorConfig=new rn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new $0(e))})),this._register(this.model.onDidChangeDecorations(e=>{this._decorations.onModelDecorationsChanged(),this._eventDispatcher.emitSingleViewEvent(new pi(e)),this._eventDispatcher.emitOutgoingEvent(new H0(e))}))}setHiddenAreas(e,t){var o;this.hiddenAreasModel.setHiddenAreas(t,e);const i=this.hiddenAreasModel.getMergedRanges();if(i===this.previousHiddenAreas)return;this.previousHiddenAreas=i;const n=this._captureStableViewport();let s=!1;try{const r=this._eventDispatcher.beginEmitViewEvents();s=this._lines.setHiddenAreas(i),s&&(r.emitViewEvent(new wo),r.emitViewEvent(new Lo),r.emitViewEvent(new pi(null)),this._cursor.onLineMappingChanged(r),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this.viewLayout.onHeightMaybeChanged());const l=(o=n.viewportStartModelPosition)==null?void 0:o.lineNumber;l&&i.some(c=>c.startLineNumber<=l&&l<=c.endLineNumber)||n.recoverViewportStart(this.coordinatesConverter,this.viewLayout)}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule(),s&&this._eventDispatcher.emitOutgoingEvent(new W0)}getVisibleRangesPlusViewportAboveBelow(){const e=this._configuration.options.get(146),t=this._configuration.options.get(67),i=Math.max(20,Math.round(e.height/t)),n=this.viewLayout.getLinesViewportData(),s=Math.max(1,n.completelyVisibleStartLineNumber-i),o=Math.min(this.getLineCount(),n.completelyVisibleEndLineNumber+i);return this._toModelVisibleRanges(new v(s,this.getLineMinColumn(s),o,this.getLineMaxColumn(o)))}getVisibleRanges(){const e=this.getCompletelyVisibleViewRange();return this._toModelVisibleRanges(e)}getHiddenAreas(){return this._lines.getHiddenAreas()}_toModelVisibleRanges(e){const t=this.coordinatesConverter.convertViewRangeToModelRange(e),i=this._lines.getHiddenAreas();if(i.length===0)return[t];const n=[];let s=0,o=t.startLineNumber,r=t.startColumn;const l=t.endLineNumber,h=t.endColumn;for(let c=0,d=i.length;c<d;c++){const u=i[c].startLineNumber,g=i[c].endLineNumber;g<o||u>l||(o<u&&(n[s++]=new v(o,r,u-1,this.model.getLineMaxColumn(u-1))),o=g+1,r=1)}return(o<l||o===l&&r<h)&&(n[s++]=new v(o,r,l,h)),n}getCompletelyVisibleViewRange(){const e=this.viewLayout.getLinesViewportData(),t=e.completelyVisibleStartLineNumber,i=e.completelyVisibleEndLineNumber;return new v(t,this.getLineMinColumn(t),i,this.getLineMaxColumn(i))}getCompletelyVisibleViewRangeAtScrollTop(e){const t=this.viewLayout.getLinesViewportDataAtScrollTop(e),i=t.completelyVisibleStartLineNumber,n=t.completelyVisibleEndLineNumber;return new v(i,this.getLineMinColumn(i),n,this.getLineMaxColumn(n))}saveState(){const e=this.viewLayout.saveState(),t=e.scrollTop,i=this.viewLayout.getLineNumberAtVerticalOffset(t),n=this.coordinatesConverter.convertViewPositionToModelPosition(new D(i,this.getLineMinColumn(i))),s=this.viewLayout.getVerticalOffsetForLineNumber(i)-t;return{scrollLeft:e.scrollLeft,firstPosition:n,firstPositionDeltaTop:s}}reduceRestoreState(e){if(typeof e.firstPosition>"u")return this._reduceRestoreStateCompatibility(e);const t=this.model.validatePosition(e.firstPosition),i=this.coordinatesConverter.convertModelPositionToViewPosition(t),n=this.viewLayout.getVerticalOffsetForLineNumber(i.lineNumber)-e.firstPositionDeltaTop;return{scrollLeft:e.scrollLeft,scrollTop:n}}_reduceRestoreStateCompatibility(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTopWithoutViewZones}}getTabSize(){return this.model.getOptions().tabSize}getLineCount(){return this._lines.getViewLineCount()}setViewport(e,t,i){this._viewportStart.update(this,e)}getActiveIndentGuide(e,t,i){return this._lines.getActiveIndentGuide(e,t,i)}getLinesIndentGuides(e,t){return this._lines.getViewLinesIndentGuides(e,t)}getBracketGuidesInRangeByLine(e,t,i,n){return this._lines.getViewLinesBracketGuides(e,t,i,n)}getLineContent(e){return this._lines.getViewLineContent(e)}getLineLength(e){return this._lines.getViewLineLength(e)}getLineMinColumn(e){return this._lines.getViewLineMinColumn(e)}getLineMaxColumn(e){return this._lines.getViewLineMaxColumn(e)}getLineFirstNonWhitespaceColumn(e){const t=Je(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=Kn(this.getLineContent(e));return t===-1?0:t+2}getMinimapDecorationsInRange(e){return this._decorations.getMinimapDecorationsInRange(e)}getDecorationsInViewport(e){return this._decorations.getDecorationsViewportData(e).decorations}getInjectedTextAt(e){return this._lines.getInjectedTextAt(e)}getViewportViewLineRenderingData(e,t){const n=this._decorations.getDecorationsViewportData(e).inlineDecorations[t-e.startLineNumber];return this._getViewLineRenderingData(t,n)}getViewLineRenderingData(e){const t=this._decorations.getInlineDecorationsOnLine(e);return this._getViewLineRenderingData(e,t)}_getViewLineRenderingData(e,t){const i=this.model.mightContainRTL(),n=this.model.mightContainNonBasicASCII(),s=this.getTabSize(),o=this._lines.getViewLineData(e);return o.inlineDecorations&&(t=[...t,...o.inlineDecorations.map(r=>r.toInlineDecoration(e))]),new Ko(o.minColumn,o.maxColumn,o.content,o.continuesWithWrappedLine,i,n,o.tokens,t,s,o.startVisibleColumn)}getViewLineData(e){return this._lines.getViewLineData(e)}getMinimapLinesRenderingData(e,t,i){const n=this._lines.getViewLinesData(e,t,i);return new iv(this.getTabSize(),n)}getAllOverviewRulerDecorations(e){const t=this.model.getOverviewRulerDecorations(this._editorId,Po(this._configuration.options)),i=new fx;for(const n of t){const s=n.options,o=s.overviewRuler;if(!o)continue;const r=o.position;if(r===0)continue;const l=o.getColor(e.value),h=this.coordinatesConverter.getViewLineNumberOfModelPosition(n.range.startLineNumber,n.range.startColumn),c=this.coordinatesConverter.getViewLineNumberOfModelPosition(n.range.endLineNumber,n.range.endColumn);i.accept(l,s.zIndex,h,c,r)}return i.asArray}_invalidateDecorationsColorCache(){const e=this.model.getOverviewRulerDecorations();for(const t of e){const i=t.options.overviewRuler;i==null||i.invalidateCachedColor();const n=t.options.minimap;n==null||n.invalidateCachedColor()}}getValueInRange(e,t){const i=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueInRange(i,t)}getValueLengthInRange(e,t){const i=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueLengthInRange(i,t)}modifyPosition(e,t){const i=this.coordinatesConverter.convertViewPositionToModelPosition(e),n=this.model.modifyPosition(i,t);return this.coordinatesConverter.convertModelPositionToViewPosition(n)}deduceModelPositionRelativeToViewPosition(e,t,i){const n=this.coordinatesConverter.convertViewPositionToModelPosition(e);this.model.getEOL().length===2&&(t<0?t-=i:t+=i);const o=this.model.getOffsetAt(n)+t;return this.model.getPositionAt(o)}getPlainTextToCopy(e,t,i){const n=i?`\r
`:this.model.getEOL();e=e.slice(0),e.sort(v.compareRangesUsingStarts);let s=!1,o=!1;for(const l of e)l.isEmpty()?s=!0:o=!0;if(!o){if(!t)return"";const l=e.map(c=>c.startLineNumber);let h="";for(let c=0;c<l.length;c++)c>0&&l[c-1]===l[c]||(h+=this.model.getLineContent(l[c])+n);return h}if(s&&t){const l=[];let h=0;for(const c of e){const d=c.startLineNumber;c.isEmpty()?d!==h&&l.push(this.model.getLineContent(d)):l.push(this.model.getValueInRange(c,i?2:0)),h=d}return l.length===1?l[0]:l}const r=[];for(const l of e)l.isEmpty()||r.push(this.model.getValueInRange(l,i?2:0));return r.length===1?r[0]:r}getRichTextToCopy(e,t){const i=this.model.getLanguageId();if(i===Yd||e.length!==1)return null;let n=e[0];if(n.isEmpty()){if(!t)return null;const c=n.startLineNumber;n=new v(c,this.model.getLineMinColumn(c),c,this.model.getLineMaxColumn(c))}const s=this._configuration.options.get(50),o=this._getColorMap(),l=/[:;\\\/<>]/.test(s.fontFamily)||s.fontFamily===So.fontFamily;let h;return l?h=So.fontFamily:(h=s.fontFamily,h=h.replace(/"/g,"'"),/[,']/.test(h)||/[+ ]/.test(h)&&(h=`'${h}'`),h=`${h}, ${So.fontFamily}`),{mode:i,html:`<div style="color: ${o[1]};background-color: ${o[2]};font-family: ${h};font-weight: ${s.fontWeight};font-size: ${s.fontSize}px;line-height: ${s.lineHeight}px;white-space: pre;">`+this._getHTMLToCopy(n,o)+"</div>"}}_getHTMLToCopy(e,t){const i=e.startLineNumber,n=e.startColumn,s=e.endLineNumber,o=e.endColumn,r=this.getTabSize();let l="";for(let h=i;h<=s;h++){const c=this.model.tokenization.getLineTokens(h),d=c.getLineContent(),u=h===i?n-1:0,g=h===s?o-1:d.length;d===""?l+="<br>":l+=Qp(d,c.inflate(),t,u,g,r,qs)}return l}_getColorMap(){const e=ai.getColorMap(),t=["#000000"];if(e)for(let i=1,n=e.length;i<n;i++)t[i]=le.Format.CSS.formatHex(e[i]);return t}getPrimaryCursorState(){return this._cursor.getPrimaryCursorState()}getLastAddedCursorIndex(){return this._cursor.getLastAddedCursorIndex()}getCursorStates(){return this._cursor.getCursorStates()}setCursorStates(e,t,i){return this._withViewEventsCollector(n=>this._cursor.setStates(n,e,t,i))}getCursorColumnSelectData(){return this._cursor.getCursorColumnSelectData()}getCursorAutoClosedCharacters(){return this._cursor.getAutoClosedCharacters()}setCursorColumnSelectData(e){this._cursor.setCursorColumnSelectData(e)}getPrevEditOperationType(){return this._cursor.getPrevEditOperationType()}setPrevEditOperationType(e){this._cursor.setPrevEditOperationType(e)}getSelection(){return this._cursor.getSelection()}getSelections(){return this._cursor.getSelections()}getPosition(){return this._cursor.getPrimaryCursorState().modelState.position}setSelections(e,t,i=0){this._withViewEventsCollector(n=>this._cursor.setSelections(n,e,t,i))}saveCursorState(){return this._cursor.saveState()}restoreCursorState(e){this._withViewEventsCollector(t=>this._cursor.restoreState(t,e))}_executeCursorEdit(e){if(this._cursor.context.cursorConfig.readOnly){this._eventDispatcher.emitOutgoingEvent(new V0);return}this._withViewEventsCollector(e)}executeEdits(e,t,i){this._executeCursorEdit(n=>this._cursor.executeEdits(n,e,t,i))}startComposition(){this._executeCursorEdit(e=>this._cursor.startComposition(e))}endComposition(e){this._executeCursorEdit(t=>this._cursor.endComposition(t,e))}type(e,t){this._executeCursorEdit(i=>this._cursor.type(i,e,t))}compositionType(e,t,i,n,s){this._executeCursorEdit(o=>this._cursor.compositionType(o,e,t,i,n,s))}paste(e,t,i,n){this._executeCursorEdit(s=>this._cursor.paste(s,e,t,i,n))}cut(e){this._executeCursorEdit(t=>this._cursor.cut(t,e))}executeCommand(e,t){this._executeCursorEdit(i=>this._cursor.executeCommand(i,e,t))}executeCommands(e,t){this._executeCursorEdit(i=>this._cursor.executeCommands(i,e,t))}revealAllCursors(e,t,i=!1){this._withViewEventsCollector(n=>this._cursor.revealAll(n,e,i,0,t,0))}revealPrimaryCursor(e,t,i=!1){this._withViewEventsCollector(n=>this._cursor.revealPrimary(n,e,i,0,t,0))}revealTopMostCursor(e){const t=this._cursor.getTopMostViewPosition(),i=new v(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(n=>n.emitViewEvent(new Ss(e,!1,i,null,0,!0,0)))}revealBottomMostCursor(e){const t=this._cursor.getBottomMostViewPosition(),i=new v(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(n=>n.emitViewEvent(new Ss(e,!1,i,null,0,!0,0)))}revealRange(e,t,i,n,s){this._withViewEventsCollector(o=>o.emitViewEvent(new Ss(e,!1,i,null,n,t,s)))}changeWhitespace(e){this.viewLayout.changeWhitespace(e)&&(this._eventDispatcher.emitSingleViewEvent(new O0),this._eventDispatcher.emitOutgoingEvent(new F0))}_withViewEventsCollector(e){return this._transactionalTarget.batchChanges(()=>{try{const t=this._eventDispatcher.beginEmitViewEvents();return e(t)}finally{this._eventDispatcher.endEmitViewEvents()}})}batchEvents(e){this._withViewEventsCollector(()=>{e()})}normalizePosition(e,t){return this._lines.normalizePosition(e,t)}getLineIndentColumn(e){return this._lines.getLineIndentColumn(e)}}class Lh{static create(e){const t=e._setTrackedRange(null,new v(1,1,1,1),1);return new Lh(e,1,!1,t,0)}get viewLineNumber(){return this._viewLineNumber}get isValid(){return this._isValid}get modelTrackedRange(){return this._modelTrackedRange}get startLineDelta(){return this._startLineDelta}constructor(e,t,i,n,s){this._model=e,this._viewLineNumber=t,this._isValid=i,this._modelTrackedRange=n,this._startLineDelta=s}dispose(){this._model._setTrackedRange(this._modelTrackedRange,null,1)}update(e,t){const i=e.coordinatesConverter.convertViewPositionToModelPosition(new D(t,e.getLineMinColumn(t))),n=e.model._setTrackedRange(this._modelTrackedRange,new v(i.lineNumber,i.column,i.lineNumber,i.column),1),s=e.viewLayout.getVerticalOffsetForLineNumber(t),o=e.viewLayout.getCurrentScrollTop();this._viewLineNumber=t,this._isValid=!0,this._modelTrackedRange=n,this._startLineDelta=o-s}invalidate(){this._isValid=!1}}class fx{constructor(){this._asMap=Object.create(null),this.asArray=[]}accept(e,t,i,n,s){const o=this._asMap[e];if(o){const r=o.data,l=r[r.length-3],h=r[r.length-1];if(l===s&&h+1>=i){n>h&&(r[r.length-1]=n);return}r.push(s,i,n)}else{const r=new Vs(e,t,[s,i,n]);this._asMap[e]=r,this.asArray.push(r)}}}class mx{constructor(){this.hiddenAreas=new Map,this.shouldRecompute=!1,this.ranges=[]}setHiddenAreas(e,t){const i=this.hiddenAreas.get(e);i&&vd(i,t)||(this.hiddenAreas.set(e,t),this.shouldRecompute=!0)}getMergedRanges(){if(!this.shouldRecompute)return this.ranges;this.shouldRecompute=!1;const e=Array.from(this.hiddenAreas.values()).reduce((t,i)=>px(t,i),[]);return vd(this.ranges,e)?this.ranges:(this.ranges=e,this.ranges)}}function px(a,e){const t=[];let i=0,n=0;for(;i<a.length&&n<e.length;){const s=a[i],o=e[n];if(s.endLineNumber<o.startLineNumber-1)t.push(a[i++]);else if(o.endLineNumber<s.startLineNumber-1)t.push(e[n++]);else{const r=Math.min(s.startLineNumber,o.startLineNumber),l=Math.max(s.endLineNumber,o.endLineNumber);t.push(new v(r,1,l,1)),i++,n++}}for(;i<a.length;)t.push(a[i++]);for(;n<e.length;)t.push(e[n++]);return t}function vd(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!a[t].equalsRange(e[t]))return!1;return!0}class Sd{constructor(e,t){this.viewportStartModelPosition=e,this.startLineDelta=t}recoverViewportStart(e,t){if(!this.viewportStartModelPosition)return;const i=e.convertModelPositionToViewPosition(this.viewportStartModelPosition),n=t.getVerticalOffsetForLineNumber(i.lineNumber);t.setScrollPosition({scrollTop:n+this.startLineDelta},1)}}var _x=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Rt=function(a,e){return function(t,i){e(t,i,a)}},wi,zi;let xd=(zi=class extends H{get isSimpleWidget(){return this._configuration.isSimpleWidget}get contextMenuId(){return this._configuration.contextMenuId}constructor(e,t,i,n,s,o,r,l,h,c,d,u){super(),this.languageConfigurationService=d,this._deliveryQueue=Vf(),this._contributions=this._register(new w0),this._onDidDispose=this._register(new M),this.onDidDispose=this._onDidDispose.event,this._onDidChangeModelContent=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelContent=this._onDidChangeModelContent.event,this._onDidChangeModelLanguage=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguage=this._onDidChangeModelLanguage.event,this._onDidChangeModelLanguageConfiguration=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event,this._onDidChangeModelOptions=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelOptions=this._onDidChangeModelOptions.event,this._onDidChangeModelDecorations=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelDecorations=this._onDidChangeModelDecorations.event,this._onDidChangeModelTokens=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelTokens=this._onDidChangeModelTokens.event,this._onDidChangeConfiguration=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeModel=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onWillChangeModel=this._onWillChangeModel.event,this._onDidChangeModel=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeModel=this._onDidChangeModel.event,this._onDidChangeCursorPosition=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorPosition=this._onDidChangeCursorPosition.event,this._onDidChangeCursorSelection=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorSelection=this._onDidChangeCursorSelection.event,this._onDidAttemptReadOnlyEdit=this._register(new Te(this._contributions,this._deliveryQueue)),this.onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event,this._onDidLayoutChange=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidLayoutChange=this._onDidLayoutChange.event,this._editorTextFocus=this._register(new yd({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue,this.onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse,this._editorWidgetFocus=this._register(new yd({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue,this.onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse,this._onWillType=this._register(new Te(this._contributions,this._deliveryQueue)),this.onWillType=this._onWillType.event,this._onDidType=this._register(new Te(this._contributions,this._deliveryQueue)),this.onDidType=this._onDidType.event,this._onDidCompositionStart=this._register(new Te(this._contributions,this._deliveryQueue)),this.onDidCompositionStart=this._onDidCompositionStart.event,this._onDidCompositionEnd=this._register(new Te(this._contributions,this._deliveryQueue)),this.onDidCompositionEnd=this._onDidCompositionEnd.event,this._onDidPaste=this._register(new Te(this._contributions,this._deliveryQueue)),this.onDidPaste=this._onDidPaste.event,this._onMouseUp=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseUp=this._onMouseUp.event,this._onMouseDown=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseDown=this._onMouseDown.event,this._onMouseDrag=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseDrag=this._onMouseDrag.event,this._onMouseDrop=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseDrop=this._onMouseDrop.event,this._onMouseDropCanceled=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseDropCanceled=this._onMouseDropCanceled.event,this._onDropIntoEditor=this._register(new Te(this._contributions,this._deliveryQueue)),this.onDropIntoEditor=this._onDropIntoEditor.event,this._onContextMenu=this._register(new Te(this._contributions,this._deliveryQueue)),this.onContextMenu=this._onContextMenu.event,this._onMouseMove=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseMove=this._onMouseMove.event,this._onMouseLeave=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseLeave=this._onMouseLeave.event,this._onMouseWheel=this._register(new Te(this._contributions,this._deliveryQueue)),this.onMouseWheel=this._onMouseWheel.event,this._onKeyUp=this._register(new Te(this._contributions,this._deliveryQueue)),this.onKeyUp=this._onKeyUp.event,this._onKeyDown=this._register(new Te(this._contributions,this._deliveryQueue)),this.onKeyDown=this._onKeyDown.event,this._onDidContentSizeChange=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._onDidScrollChange=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidScrollChange=this._onDidScrollChange.event,this._onDidChangeViewZones=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeViewZones=this._onDidChangeViewZones.event,this._onDidChangeHiddenAreas=this._register(new M({deliveryQueue:this._deliveryQueue})),this.onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event,this._updateCounter=0,this._onBeginUpdate=this._register(new M),this.onBeginUpdate=this._onBeginUpdate.event,this._onEndUpdate=this._register(new M),this.onEndUpdate=this._onEndUpdate.event,this._actions=new Map,this._bannerDomNode=null,this._dropIntoEditorDecorations=this.createDecorationsCollection(),s.willCreateCodeEditor();const g={...t};this._domElement=e,this._overflowWidgetsDomNode=g.overflowWidgetsDomNode,delete g.overflowWidgetsDomNode,this._id=++Cx,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=i.telemetryData,this._configuration=this._register(this._createConfiguration(i.isSimpleWidget||!1,i.contextMenuId??(i.isSimpleWidget?Rh.SimpleEditorContext:Rh.EditorContext),g,c)),this._register(this._configuration.onDidChange(_=>{this._onDidChangeConfiguration.fire(_);const C=this._configuration.options;if(_.hasChanged(146)){const p=C.get(146);this._onDidLayoutChange.fire(p)}})),this._contextKeyService=this._register(r.createScoped(this._domElement)),this._notificationService=h,this._codeEditorService=s,this._commandService=o,this._themeService=l,this._register(new wx(this,this._contextKeyService)),this._register(new Lx(this,this._contextKeyService,u)),this._instantiationService=this._register(n.createChild(new zL([kl,this._contextKeyService]))),this._modelData=null,this._focusTracker=new vx(e,this._overflowWidgetsDomNode),this._register(this._focusTracker.onChange(()=>{this._editorWidgetFocus.setValue(this._focusTracker.hasFocus())})),this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let f;Array.isArray(i.contributions)?f=i.contributions:f=Ur.getEditorContributions(),this._contributions.initialize(this,f,this._instantiationService);for(const _ of Ur.getEditorActions()){if(this._actions.has(_.id)){Oe(new Error(`Cannot have two actions with the same id ${_.id}`));continue}const C=new L0(_.id,_.label,_.alias,_.metadata,_.precondition??void 0,p=>this._instantiationService.invokeFunction(b=>Promise.resolve(_.runEditorCommand(b,this,p))),this._contextKeyService);this._actions.set(C.id,C)}const m=()=>!this._configuration.options.get(92)&&this._configuration.options.get(36).enabled;this._register(new Hf(this._domElement,{onDragOver:_=>{if(!m())return;const C=this.getTargetAtClientPoint(_.clientX,_.clientY);C!=null&&C.position&&this.showDropIndicatorAt(C.position)},onDrop:async _=>{if(!m()||(this.removeDropIndicator(),!_.dataTransfer))return;const C=this.getTargetAtClientPoint(_.clientX,_.clientY);C!=null&&C.position&&this._onDropIntoEditor.fire({position:C.position,event:_})},onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}writeScreenReaderContent(e){var t;(t=this._modelData)==null||t.view.writeScreenReaderContent(e)}_createConfiguration(e,t,i,n){return new al(e,t,i,this._domElement,n)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return e_.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._focusTracker.dispose(),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(e){return this._instantiationService.invokeFunction(e)}updateOptions(e){this._configuration.updateOptions(e||{})}getOptions(){return this._configuration.options}getOption(e){return this._configuration.options.get(e)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(e){return this._modelData?ue.getWordAtPosition(this._modelData.model,this._configuration.options.get(132),this._configuration.options.get(131),e):null}getValue(e=null){if(!this._modelData)return"";const t=!!(e&&e.preserveBOM);let i=0;return e&&e.lineEnding&&e.lineEnding===`
`?i=1:e&&e.lineEnding&&e.lineEnding===`\r
`&&(i=2),this._modelData.model.getValue(i,t)}setValue(e){try{if(this._beginUpdate(),!this._modelData)return;this._modelData.model.setValue(e)}finally{this._endUpdate()}}getModel(){return this._modelData?this._modelData.model:null}setModel(e=null){var t;try{this._beginUpdate();const i=e;if(this._modelData===null&&i===null||this._modelData&&this._modelData.model===i)return;const n={oldModelUrl:((t=this._modelData)==null?void 0:t.model.uri)||null,newModelUrl:(i==null?void 0:i.uri)||null};this._onWillChangeModel.fire(n);const s=this.hasTextFocus(),o=this._detachModel();this._attachModel(i),s&&this.hasModel()&&this.focus(),this._removeDecorationTypes(),this._onDidChangeModel.fire(n),this._postDetachModelCleanup(o),this._contributionsDisposable=this._contributions.onAfterModelAttached()}finally{this._endUpdate()}}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const e in this._decorationTypeSubtypes){const t=this._decorationTypeSubtypes[e];for(const i in t)this._removeDecorationType(e+"-"+i)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(e,t,i,n){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(o.lineNumber,n)}getTopForLineNumber(e,t=!1){return this._modelData?wi._getVerticalOffsetForPosition(this._modelData,e,1,t):-1}getTopForPosition(e,t){return this._modelData?wi._getVerticalOffsetForPosition(this._modelData,e,t,!1):-1}static _getVerticalOffsetForPosition(e,t,i,n=!1){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetForLineNumber(o.lineNumber,n)}getBottomForLineNumber(e,t=!1){if(!this._modelData)return-1;const i=this._modelData.model.getLineMaxColumn(e);return wi._getVerticalOffsetAfterPosition(this._modelData,e,i,t)}setHiddenAreas(e,t){var i;(i=this._modelData)==null||i.viewModel.setHiddenAreas(e.map(n=>v.lift(n)),t)}getVisibleColumnFromPosition(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),i=this._modelData.model.getOptions().tabSize;return Ce.visibleColumnFromColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,i)+1}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(e,t="api"){if(this._modelData){if(!D.isIPosition(e))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,[{selectionStartLineNumber:e.lineNumber,selectionStartColumn:e.column,positionLineNumber:e.lineNumber,positionColumn:e.column}])}}_sendRevealRange(e,t,i,n){if(!this._modelData)return;if(!v.isIRange(e))throw new Error("Invalid arguments");const s=this._modelData.model.validateRange(e),o=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(s);this._modelData.viewModel.revealRange("api",i,o,t,n)}revealLine(e,t=0){this._revealLine(e,0,t)}revealLineInCenter(e,t=0){this._revealLine(e,1,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._revealLine(e,2,t)}revealLineNearTop(e,t=0){this._revealLine(e,5,t)}_revealLine(e,t,i){if(typeof e!="number")throw new Error("Invalid arguments");this._sendRevealRange(new v(e,1,e,1),t,!1,i)}revealPosition(e,t=0){this._revealPosition(e,0,!0,t)}revealPositionInCenter(e,t=0){this._revealPosition(e,1,!0,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._revealPosition(e,2,!0,t)}revealPositionNearTop(e,t=0){this._revealPosition(e,5,!0,t)}_revealPosition(e,t,i,n){if(!D.isIPosition(e))throw new Error("Invalid arguments");this._sendRevealRange(new v(e.lineNumber,e.column,e.lineNumber,e.column),t,i,n)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(e,t="api"){const i=te.isISelection(e),n=v.isIRange(e);if(!i&&!n)throw new Error("Invalid arguments");if(i)this._setSelectionImpl(e,t);else if(n){const s={selectionStartLineNumber:e.startLineNumber,selectionStartColumn:e.startColumn,positionLineNumber:e.endLineNumber,positionColumn:e.endColumn};this._setSelectionImpl(s,t)}}_setSelectionImpl(e,t){if(!this._modelData)return;const i=new te(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn);this._modelData.viewModel.setSelections(t,[i])}revealLines(e,t,i=0){this._revealLines(e,t,0,i)}revealLinesInCenter(e,t,i=0){this._revealLines(e,t,1,i)}revealLinesInCenterIfOutsideViewport(e,t,i=0){this._revealLines(e,t,2,i)}revealLinesNearTop(e,t,i=0){this._revealLines(e,t,5,i)}_revealLines(e,t,i,n){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid arguments");this._sendRevealRange(new v(e,1,t,1),i,!1,n)}revealRange(e,t=0,i=!1,n=!0){this._revealRange(e,i?1:0,n,t)}revealRangeInCenter(e,t=0){this._revealRange(e,1,!0,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._revealRange(e,2,!0,t)}revealRangeNearTop(e,t=0){this._revealRange(e,5,!0,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._revealRange(e,6,!0,t)}revealRangeAtTop(e,t=0){this._revealRange(e,3,!0,t)}_revealRange(e,t,i,n){if(!v.isIRange(e))throw new Error("Invalid arguments");this._sendRevealRange(v.lift(e),t,i,n)}setSelections(e,t="api",i=0){if(this._modelData){if(!e||e.length===0)throw new Error("Invalid arguments");for(let n=0,s=e.length;n<s;n++)if(!te.isISelection(e[n]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,e,i)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:e},t)}}setScrollTop(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:e},t)}}setScrollPosition(e,t=1){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(e,t)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const e=this._contributions.saveViewState(),t=this._modelData.viewModel.saveCursorState(),i=this._modelData.viewModel.saveState();return{cursorState:t,viewState:i,contributionsState:e}}restoreViewState(e){if(!this._modelData||!this._modelData.hasRealView)return;const t=e;if(t&&t.cursorState&&t.viewState){const i=t.cursorState;Array.isArray(i)?i.length>0&&this._modelData.viewModel.restoreCursorState(i):this._modelData.viewModel.restoreCursorState([i]),this._contributions.restoreViewState(t.contributionsState||{});const n=this._modelData.viewModel.reduceRestoreState(t.viewState);this._modelData.view.restoreState(n)}}handleInitialized(){var e;(e=this._getViewModel())==null||e.visibleLinesStabilized()}getContribution(e){return this._contributions.get(e)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let e=this.getActions();return e=e.filter(t=>t.isSupported()),e}getAction(e){return this._actions.get(e)||null}trigger(e,t,i){i=i||{};try{switch(this._beginUpdate(),t){case"compositionStart":this._startComposition();return;case"compositionEnd":this._endComposition(e);return;case"type":{const s=i;this._type(e,s.text||"");return}case"replacePreviousChar":{const s=i;this._compositionType(e,s.text||"",s.replaceCharCnt||0,0,0);return}case"compositionType":{const s=i;this._compositionType(e,s.text||"",s.replacePrevCharCnt||0,s.replaceNextCharCnt||0,s.positionDelta||0);return}case"paste":{const s=i;this._paste(e,s.text||"",s.pasteOnNewLine||!1,s.multicursorText||null,s.mode||null,s.clipboardEvent);return}case"cut":this._cut(e);return}const n=this.getAction(t);if(n){Promise.resolve(n.run(i)).then(void 0,Oe);return}if(!this._modelData||this._triggerEditorCommand(e,t,i))return;this._triggerCommand(t,i)}finally{this._endUpdate()}}_triggerCommand(e,t){this._commandService.executeCommand(e,t)}_startComposition(){this._modelData&&(this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(e){this._modelData&&(this._modelData.viewModel.endComposition(e),this._onDidCompositionEnd.fire())}_type(e,t){!this._modelData||t.length===0||(e==="keyboard"&&this._onWillType.fire(t),this._modelData.viewModel.type(t,e),e==="keyboard"&&this._onDidType.fire(t))}_compositionType(e,t,i,n,s){this._modelData&&this._modelData.viewModel.compositionType(t,i,n,s,e)}_paste(e,t,i,n,s,o){if(!this._modelData)return;const r=this._modelData.viewModel,l=r.getSelection().getStartPosition();r.paste(t,i,n,e);const h=r.getSelection().getStartPosition();e==="keyboard"&&this._onDidPaste.fire({clipboardEvent:o,range:new v(l.lineNumber,l.column,h.lineNumber,h.column),languageId:s})}_cut(e){this._modelData&&this._modelData.viewModel.cut(e)}_triggerEditorCommand(e,t,i){const n=Ur.getEditorCommand(t);return n?(i=i||{},i.source=e,this._instantiationService.invokeFunction(s=>{Promise.resolve(n.runEditorCommand(s,this,i)).then(void 0,Oe)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(92)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(92)?!1:(this._modelData.model.popStackElement(),!0)}executeEdits(e,t,i){if(!this._modelData||this._configuration.options.get(92))return!1;let n;return i?Array.isArray(i)?n=()=>i:n=i:n=()=>null,this._modelData.viewModel.executeEdits(e,t,n),!0}executeCommand(e,t){this._modelData&&this._modelData.viewModel.executeCommand(t,e)}executeCommands(e,t){this._modelData&&this._modelData.viewModel.executeCommands(t,e)}createDecorationsCollection(e){return new Sx(this,e)}changeDecorations(e){return this._modelData?this._modelData.model.changeDecorations(e,this._id):null}getLineDecorations(e){return this._modelData?this._modelData.model.getLineDecorations(e,this._id,Po(this._configuration.options)):null}getDecorationsInRange(e){return this._modelData?this._modelData.model.getDecorationsInRange(e,this._id,Po(this._configuration.options)):null}deltaDecorations(e,t){return this._modelData?e.length===0&&t.length===0?e:this._modelData.model.deltaDecorations(e,t,this._id):[]}removeDecorations(e){!this._modelData||e.length===0||this._modelData.model.changeDecorations(t=>{t.deltaDecorations(e,[])})}removeDecorationsByType(e){const t=this._decorationTypeKeysToIds[e];t&&this.changeDecorations(i=>i.deltaDecorations(t,[])),this._decorationTypeKeysToIds.hasOwnProperty(e)&&delete this._decorationTypeKeysToIds[e],this._decorationTypeSubtypes.hasOwnProperty(e)&&delete this._decorationTypeSubtypes[e]}getLayoutInfo(){return this._configuration.options.get(146)}createOverviewRuler(e){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(e)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(e)}layout(e,t=!1){this._configuration.observeContainer(e),t||this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return this._focusTracker&&this._focusTracker.hasFocus()}addContentWidget(e){const t={widget:e,position:e.getPosition()};this._contentWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a content widget with the same id:"+e.getId()),this._contentWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(t)}layoutContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(i)}}removeContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];delete this._contentWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(i)}}addOverlayWidget(e){const t={widget:e,position:e.getPosition()};this._overlayWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(t)}layoutOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(i)}}removeOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];delete this._overlayWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(i)}}addGlyphMarginWidget(e){const t={widget:e,position:e.getPosition()};this._glyphMarginWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(t)}layoutGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(i)}}removeGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];delete this._glyphMarginWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(i)}}changeViewZones(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(e)}getTargetAtClientPoint(e,t){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(e,t)}getScrolledVisiblePosition(e){if(!this._modelData||!this._modelData.hasRealView)return null;const t=this._modelData.model.validatePosition(e),i=this._configuration.options,n=i.get(146),s=wi._getVerticalOffsetForPosition(this._modelData,t.lineNumber,t.column)-this.getScrollTop(),o=this._modelData.view.getOffsetForColumn(t.lineNumber,t.column)+n.glyphMarginWidth+n.lineNumbersWidth+n.decorationsWidth-this.getScrollLeft();return{top:s,left:o,height:i.get(67)}}getOffsetForColumn(e,t){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(e,t)}render(e=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.viewModel.batchEvents(()=>{this._modelData.view.render(!0,e)})}setAriaOptions(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(e)}applyFontInfo(e){qe(e,this._configuration.options.get(50))}setBanner(e,t){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),this._bannerDomNode=e,this._configuration.setReservedHeight(e?t:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(e){if(!e){this._modelData=null;return}const t=[];this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._configuration.setIsDominatedByLongLines(e.isDominatedByLongLines()),this._configuration.setModelLineCount(e.getLineCount());const i=e.onBeforeAttached(),n=new gx(this._id,this._configuration,e,ph.create(ee(this._domElement)),_h.create(this._configuration.options),r=>Fn(ee(this._domElement),r),this.languageConfigurationService,this._themeService,i,{batchChanges:r=>{try{return this._beginUpdate(),r()}finally{this._endUpdate()}}});t.push(e.onWillDispose(()=>this.setModel(null))),t.push(n.onEvent(r=>{switch(r.kind){case 0:this._onDidContentSizeChange.fire(r);break;case 1:this._editorTextFocus.setValue(r.hasFocus);break;case 2:this._onDidScrollChange.fire(r);break;case 3:this._onDidChangeViewZones.fire();break;case 4:this._onDidChangeHiddenAreas.fire();break;case 5:this._onDidAttemptReadOnlyEdit.fire();break;case 6:{if(r.reachedMaxCursorCount){const d=this.getOption(80),u=I("cursors.maximum","The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",d);this._notificationService.prompt(Z_.Warning,u,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:I("goToSetting","Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const l=[];for(let d=0,u=r.selections.length;d<u;d++)l[d]=r.selections[d].getPosition();const h={position:l[0],secondaryPositions:l.slice(1),reason:r.reason,source:r.source};this._onDidChangeCursorPosition.fire(h);const c={selection:r.selections[0],secondarySelections:r.selections.slice(1),modelVersionId:r.modelVersionId,oldSelections:r.oldSelections,oldModelVersionId:r.oldModelVersionId,source:r.source,reason:r.reason};this._onDidChangeCursorSelection.fire(c);break}case 7:this._onDidChangeModelDecorations.fire(r.event);break;case 8:this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._onDidChangeModelLanguage.fire(r.event);break;case 9:this._onDidChangeModelLanguageConfiguration.fire(r.event);break;case 10:this._onDidChangeModelContent.fire(r.event);break;case 11:this._onDidChangeModelOptions.fire(r.event);break;case 12:this._onDidChangeModelTokens.fire(r.event);break}}));const[s,o]=this._createView(n);if(o){this._domElement.appendChild(s.domNode.domNode);let r=Object.keys(this._contentWidgets);for(let l=0,h=r.length;l<h;l++){const c=r[l];s.addContentWidget(this._contentWidgets[c])}r=Object.keys(this._overlayWidgets);for(let l=0,h=r.length;l<h;l++){const c=r[l];s.addOverlayWidget(this._overlayWidgets[c])}r=Object.keys(this._glyphMarginWidgets);for(let l=0,h=r.length;l<h;l++){const c=r[l];s.addGlyphMarginWidget(this._glyphMarginWidgets[c])}s.render(!1,!0),s.domNode.domNode.setAttribute("data-uri",e.uri.toString())}this._modelData=new bx(e,n,s,o,t,i)}_createView(e){let t;this.isSimpleWidget?t={paste:(s,o,r,l)=>{this._paste("keyboard",s,o,r,l)},type:s=>{this._type("keyboard",s)},compositionType:(s,o,r,l)=>{this._compositionType("keyboard",s,o,r,l)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:t={paste:(s,o,r,l)=>{const h={text:s,pasteOnNewLine:o,multicursorText:r,mode:l};this._commandService.executeCommand("paste",h)},type:s=>{const o={text:s};this._commandService.executeCommand("type",o)},compositionType:(s,o,r,l)=>{if(r||l){const h={text:s,replacePrevCharCnt:o,replaceNextCharCnt:r,positionDelta:l};this._commandService.executeCommand("compositionType",h)}else{const h={text:s,replaceCharCnt:o};this._commandService.executeCommand("replacePreviousChar",h)}},startComposition:()=>{this._commandService.executeCommand("compositionStart",{})},endComposition:()=>{this._commandService.executeCommand("compositionEnd",{})},cut:()=>{this._commandService.executeCommand("cut",{})}};const i=new Hr(e.coordinatesConverter);return i.onKeyDown=s=>this._onKeyDown.fire(s),i.onKeyUp=s=>this._onKeyUp.fire(s),i.onContextMenu=s=>this._onContextMenu.fire(s),i.onMouseMove=s=>this._onMouseMove.fire(s),i.onMouseLeave=s=>this._onMouseLeave.fire(s),i.onMouseDown=s=>this._onMouseDown.fire(s),i.onMouseUp=s=>this._onMouseUp.fire(s),i.onMouseDrag=s=>this._onMouseDrag.fire(s),i.onMouseDrop=s=>this._onMouseDrop.fire(s),i.onMouseDropCanceled=s=>this._onMouseDropCanceled.fire(s),i.onMouseWheel=s=>this._onMouseWheel.fire(s),[new bl(t,this._configuration,this._themeService.getColorTheme(),e,i,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(e){e==null||e.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){var i;if((i=this._contributionsDisposable)==null||i.dispose(),this._contributionsDisposable=void 0,!this._modelData)return null;const e=this._modelData.model,t=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),t&&this._domElement.contains(t)&&t.remove(),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),e}_removeDecorationType(e){this._codeEditorService.removeDecorationType(e)}hasModel(){return this._modelData!==null}showDropIndicatorAt(e){const t=[{range:new v(e.lineNumber,e.column,e.lineNumber,e.column),options:wi.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(t),this.revealPosition(e,1)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}setContextValue(e,t){this._contextKeyService.createKey(e,t)}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&this._onBeginUpdate.fire()}_endUpdate(){this._updateCounter--,this._updateCounter===0&&this._onEndUpdate.fire()}},wi=zi,zi.dropIntoEditorDecorationOptions=it.register({description:"workbench-dnd-target",className:"dnd-target"}),zi);xd=wi=_x([Rt(3,Ks),Rt(4,Ao),Rt(5,zf),Rt(6,kl),Rt(7,Wl),Rt(8,Vl),Rt(9,Mr),Rt(10,Ys),Rt(11,Uf)],xd);let Cx=0;class bx{constructor(e,t,i,n,s,o){this.model=e,this.viewModel=t,this.view=i,this.hasRealView=n,this.listenersToRemove=s,this.attachedView=o}dispose(){Is(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}}class yd extends H{constructor(e){super(),this._emitterOptions=e,this._onDidChangeToTrue=this._register(new M(this._emitterOptions)),this.onDidChangeToTrue=this._onDidChangeToTrue.event,this._onDidChangeToFalse=this._register(new M(this._emitterOptions)),this.onDidChangeToFalse=this._onDidChangeToFalse.event,this._value=0}setValue(e){const t=e?2:1;this._value!==t&&(this._value=t,this._value===2?this._onDidChangeToTrue.fire():this._value===1&&this._onDidChangeToFalse.fire())}}class Te extends M{constructor(e,t){super({deliveryQueue:t}),this._contributions=e}fire(e){this._contributions.onBeforeInteractionEvent(),super.fire(e)}}class wx extends H{constructor(e,t){super(),this._editor=e,t.createKey("editorId",e.getId()),this._editorSimpleInput=A.editorSimpleInput.bindTo(t),this._editorFocus=A.focus.bindTo(t),this._textInputFocus=A.textInputFocus.bindTo(t),this._editorTextFocus=A.editorTextFocus.bindTo(t),this._tabMovesFocus=A.tabMovesFocus.bindTo(t),this._editorReadonly=A.readOnly.bindTo(t),this._inDiffEditor=A.inDiffEditor.bindTo(t),this._editorColumnSelection=A.columnSelection.bindTo(t),this._hasMultipleSelections=A.hasMultipleSelections.bindTo(t),this._hasNonEmptySelection=A.hasNonEmptySelection.bindTo(t),this._canUndo=A.canUndo.bindTo(t),this._canRedo=A.canRedo.bindTo(t),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register(Zo.onDidChangeTabFocus(i=>this._tabMovesFocus.set(i))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const e=this._editor.getOptions();this._tabMovesFocus.set(Zo.getTabFocusMode()),this._editorReadonly.set(e.get(92)),this._inDiffEditor.set(e.get(61)),this._editorColumnSelection.set(e.get(22))}_updateFromSelection(){const e=this._editor.getSelections();e?(this._hasMultipleSelections.set(e.length>1),this._hasNonEmptySelection.set(e.some(t=>!t.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const e=this._editor.getModel();this._canUndo.set(!!(e&&e.canUndo())),this._canRedo.set(!!(e&&e.canRedo()))}}class Lx extends H{constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._languageFeaturesService=i,this._langId=A.languageId.bindTo(t),this._hasCompletionItemProvider=A.hasCompletionItemProvider.bindTo(t),this._hasCodeActionsProvider=A.hasCodeActionsProvider.bindTo(t),this._hasCodeLensProvider=A.hasCodeLensProvider.bindTo(t),this._hasDefinitionProvider=A.hasDefinitionProvider.bindTo(t),this._hasDeclarationProvider=A.hasDeclarationProvider.bindTo(t),this._hasImplementationProvider=A.hasImplementationProvider.bindTo(t),this._hasTypeDefinitionProvider=A.hasTypeDefinitionProvider.bindTo(t),this._hasHoverProvider=A.hasHoverProvider.bindTo(t),this._hasDocumentHighlightProvider=A.hasDocumentHighlightProvider.bindTo(t),this._hasDocumentSymbolProvider=A.hasDocumentSymbolProvider.bindTo(t),this._hasReferenceProvider=A.hasReferenceProvider.bindTo(t),this._hasRenameProvider=A.hasRenameProvider.bindTo(t),this._hasSignatureHelpProvider=A.hasSignatureHelpProvider.bindTo(t),this._hasInlayHintsProvider=A.hasInlayHintsProvider.bindTo(t),this._hasDocumentFormattingProvider=A.hasDocumentFormattingProvider.bindTo(t),this._hasDocumentSelectionFormattingProvider=A.hasDocumentSelectionFormattingProvider.bindTo(t),this._hasMultipleDocumentFormattingProvider=A.hasMultipleDocumentFormattingProvider.bindTo(t),this._hasMultipleDocumentSelectionFormattingProvider=A.hasMultipleDocumentSelectionFormattingProvider.bindTo(t),this._isInEmbeddedEditor=A.isInEmbeddedEditor.bindTo(t);const n=()=>this._update();this._register(e.onDidChangeModel(n)),this._register(e.onDidChangeModelLanguage(n)),this._register(i.completionProvider.onDidChange(n)),this._register(i.codeActionProvider.onDidChange(n)),this._register(i.codeLensProvider.onDidChange(n)),this._register(i.definitionProvider.onDidChange(n)),this._register(i.declarationProvider.onDidChange(n)),this._register(i.implementationProvider.onDidChange(n)),this._register(i.typeDefinitionProvider.onDidChange(n)),this._register(i.hoverProvider.onDidChange(n)),this._register(i.documentHighlightProvider.onDidChange(n)),this._register(i.documentSymbolProvider.onDidChange(n)),this._register(i.referenceProvider.onDidChange(n)),this._register(i.renameProvider.onDidChange(n)),this._register(i.documentFormattingEditProvider.onDidChange(n)),this._register(i.documentRangeFormattingEditProvider.onDidChange(n)),this._register(i.signatureHelpProvider.onDidChange(n)),this._register(i.inlayHintsProvider.onDidChange(n)),n()}dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInEmbeddedEditor.reset()})}_update(){const e=this._editor.getModel();if(!e){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(e.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(e)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(e)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(e)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(e)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(e)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(e)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(e)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(e)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(e)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(e)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(e)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(e)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(e)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(e)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(e)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(e).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._isInEmbeddedEditor.set(e.uri.scheme===Ah.walkThroughSnippet||e.uri.scheme===Ah.vscodeChatCodeBlock)})}}class vx extends H{constructor(e,t){super(),this._onChange=this._register(new M),this.onChange=this._onChange.event,this._hadFocus=void 0,this._hasDomElementFocus=!1,this._domFocusTracker=this._register(ya(e)),this._overflowWidgetsDomNodeHasFocus=!1,this._register(this._domFocusTracker.onDidFocus(()=>{this._hasDomElementFocus=!0,this._update()})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasDomElementFocus=!1,this._update()})),t&&(this._overflowWidgetsDomNode=this._register(ya(t)),this._register(this._overflowWidgetsDomNode.onDidFocus(()=>{this._overflowWidgetsDomNodeHasFocus=!0,this._update()})),this._register(this._overflowWidgetsDomNode.onDidBlur(()=>{this._overflowWidgetsDomNodeHasFocus=!1,this._update()})))}_update(){const e=this._hasDomElementFocus||this._overflowWidgetsDomNodeHasFocus;this._hadFocus!==e&&(this._hadFocus=e,this._onChange.fire(void 0))}hasFocus(){return this._hadFocus??!1}}class Sx{get length(){return this._decorationIds.length}constructor(e,t){this._editor=e,this._decorationIds=[],this._isChangingDecorations=!1,Array.isArray(t)&&t.length>0&&this.set(t)}onDidChange(e,t,i){return this._editor.onDidChangeModelDecorations(n=>{this._isChangingDecorations||e.call(t,n)},i)}getRange(e){return!this._editor.hasModel()||e>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[e])}getRanges(){if(!this._editor.hasModel())return[];const e=this._editor.getModel(),t=[];for(const i of this._decorationIds){const n=e.getDecorationRange(i);n&&t.push(n)}return t}has(e){return this._decorationIds.includes(e.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(e){try{this._isChangingDecorations=!0,this._editor.changeDecorations(t=>{this._decorationIds=t.deltaDecorations(this._decorationIds,e)})}finally{this._isChangingDecorations=!1}return this._decorationIds}append(e){let t=[];try{this._isChangingDecorations=!0,this._editor.changeDecorations(i=>{t=i.deltaDecorations([],e),this._decorationIds=this._decorationIds.concat(t)})}finally{this._isChangingDecorations=!1}return t}}const xx=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),yx=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function La(a){return xx+encodeURIComponent(a.toString())+yx}const Nx=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),Dx=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function Ix(a){return Nx+encodeURIComponent(a.toString())+Dx}di((a,e)=>{const t=a.getColor(Yp);t&&e.addRule(`.monaco-editor .squiggly-error { background: url("data:image/svg+xml,${La(t)}") repeat-x bottom left; }`);const i=a.getColor(Oo);i&&e.addRule(`.monaco-editor .squiggly-warning { background: url("data:image/svg+xml,${La(i)}") repeat-x bottom left; }`);const n=a.getColor(Ma);n&&e.addRule(`.monaco-editor .squiggly-info { background: url("data:image/svg+xml,${La(n)}") repeat-x bottom left; }`);const s=a.getColor(Xp);s&&e.addRule(`.monaco-editor .squiggly-hint { background: url("data:image/svg+xml,${Ix(s)}") no-repeat bottom left; }`);const o=a.getColor(Mb);o&&e.addRule(`.monaco-editor.showUnused .squiggly-inline-unnecessary { opacity: ${o.rgba.a}; }`)});export{Ty as $,cb as A,dy as B,xd as C,uy as D,IC as E,Oy as F,lb as G,ML as H,Wl as I,Y_ as J,wy as K,Qi as L,it as M,UC as N,Vc as O,Er as P,us as Q,WC as R,bt as S,ih as T,VC as U,J_ as V,mc as W,Iu as X,Ru as Y,Hl as Z,yy as _,Vl as a,vb as a$,Ly as a0,Vi as a1,Pc as a2,Ws as a3,Mu as a4,$n as a5,cc as a6,ey as a7,oy as a8,iy as a9,rc as aA,$x as aB,Gx as aC,Kx as aD,Xs as aE,jl as aF,Ze as aG,It as aH,xu as aI,St as aJ,Sy as aK,xy as aL,Wa as aM,Ey as aN,My as aO,Ry as aP,sa as aQ,_u as aR,Xx as aS,Ul as aT,Fx as aU,ab as aV,rb as aW,Cy as aX,by as aY,_y as aZ,pb as a_,bC as aa,$c as ab,Bo as ac,Z_ as ad,Bx as ae,zn as af,Gi as ag,xw as ah,di as ai,Kb as aj,rs as ak,_e as al,Ha as am,Pi as an,Vo as ao,ic as ap,Ax as aq,Yt as ar,nc as as,Px as at,sc as au,oc as av,Vx as aw,Q_ as ax,Rx as ay,Be as az,Mr as b,G_ as b0,Ut as b1,jx as b2,zL as b3,Wx as b4,py as b5,sL as b6,Ko as b7,By as b8,jL as b9,hy as bA,Yx as bB,z_ as bC,Nn as bD,Kh as bE,Yr as bF,Wo as bG,vi as bH,qh as bI,gC as ba,sy as bb,rv as bc,V_ as bd,cC as be,ry as bf,ay as bg,Os as bh,Lc as bi,yt as bj,ug as bk,Pl as bl,Do as bm,CC as bn,Ox as bo,mu as bp,ty as bq,ny as br,Qx as bs,Zx as bt,yu as bu,e0 as bv,ly as bw,Jx as bx,cy as by,L0 as bz,Ys as c,qx as d,nb as e,$a as f,Tt as g,Ce as h,Ux as i,Ou as j,Py as k,vy as l,ds as m,bu as n,zx as o,Hx as p,q_ as q,Zi as r,In as s,fC as t,my as u,fy as v,gy as w,zC as x,OC as y,ho as z};
