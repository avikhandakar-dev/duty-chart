import{l as u,H as P,J as x,aH as Fi,bZ as jn,b_ as oa,R as m,D as k,q as pi,z as kt,F as re,r as Mt,c as U,a0 as F,aA as Gt,S as y,bm as di,T as oe,Q as M,at as Ho,as as Ri,au as ti,f as Qe,ah as Ae,o as Me,ad as na,v as Pt,a2 as ne,X as Vi,ax as si,P as q,O as It,a3 as Je,K as Bi,h as W,e as Y,j as v,A as Dn,B as kn,aT as Rs,M as co,b$ as sa,c0 as ra,V as $,aO as J,c1 as he,I as R,b as L,y as et,c2 as Mn,c3 as aa,bi as Ns,a6 as H,c4 as da,t as ca,c5 as la,c6 as X,c7 as I,U as me,u as xe,g as Le,c8 as Ro,ai as Te,ar as No,bg as Ls,aq as Pn,c9 as Es,b4 as Lo,$ as In,a5 as De,aE as ve,ca as ha,aw as Os,cb as Ts,cc as ki,cd as qn,ce as pe,x as Ws,cf as ua,a as Ki,cg as ga,bO as $t,ay as Fs,an as Vs,ch as fa,Y as Bs,aD as _a,a7 as pa,bf as ma,ci as va,i as We,aN as ba,br as wa,E as ae,a9 as Ks,a1 as $s,cj as Ca,ck as ya,cl as mi,ak as Sa,L as Da,p as Zn,ac as ka,d as Q,aB as Ma}from"./editorContextKeys.Cdn_dJhV.js";import{H as S,U as jt,V as Pa,X as Ia,m as Us,c as O,t as lo,Y as Eo,Z as qe,A as Yn,_ as Aa,B as Ze,$ as xa,a0 as Xn,p as zs,d as Gs,F as Ha,P as Ra,a1 as Na,e as Ee,a2 as js,a as qs,a3 as So,a4 as La,a5 as Ea,I as Yt,a6 as Oa,n as Ie,b as ho,r as ue,a7 as Ta,a8 as ci,a9 as se,M as Zs,W as Wa,aa as Qn,ab as Ni,ac as Ys,ad as Fa,ae as Jn,E as Va,af as Ba,ag as Ka,ah as $a,ai as Ua,aj as za,ak as Ga,al as ja,L as qa,am as Za,an as Ya,ao as Xa,ap as Qa,aq as Do,z as Ja,ar as ed,as as td,y as dt,at as id,au as od,av as An,aw as nd,ax as sd,ay as rd,az as ad,aA as dd,aB as cd}from"./iconRegistry.BJgxFQLY.js";import{I as Xs,E as ld,i as Qs,a as hd,P as Ft,T as ud}from"./editorBrowser.CzkYJKPy.js";import{M as Ct,S as gd,A as Js,$ as fd,P as te,d as xn,k as _d,a0 as pd,a1 as md,I as uo,a2 as es,a as Xt,e as vd,a3 as Hn,f as ri,a4 as bd,a5 as wd,_ as er,Z as tr,a6 as Cd,a7 as yd,a8 as Sd,a9 as Dd,aa as kd,b as Md,ab as ir,ac as Pd,ad as or,ae as tt,af as Mi,ag as $i,ah as Id,J as nr,L as Ad,G as xd,ai as sr,m as Hd,q as Pi,aj as Rd}from"./codeEditorWidget.CXeIzSuq.js";import{E as go,R as Nd,g as Ld}from"./resizable.CSJhciM7.js";import{r as vi,I as rr,E as Ed,S as Od,a as Oo}from"./stableEditorScroll.DHPB0mmN.js";import{C as Td,S as Wd,a as ts,W as Fd,I as Vd,b as ar,c as dr,d as cr,e as Rn,f as lr,K as hr,u as Bd,g as Kd,H as ur,h as $d,i as Ud,j as gr,k as zd,l as Gd,m as jd,r as qd,n as fr,o as Zd,p as Nn,M as G,q as is}from"./toolbar.BTiJf7ch.js";const _r="editor.action.showHover",Yd="editor.action.showDefinitionPreviewHover",Xd="editor.action.scrollUpHover",Qd="editor.action.scrollDownHover",Jd="editor.action.scrollLeftHover",ec="editor.action.scrollRightHover",tc="editor.action.pageUpHover",ic="editor.action.pageDownHover",oc="editor.action.goToTopHover",nc="editor.action.goToBottomHover",fo="editor.action.increaseHoverVerbosityLevel",sc=u({key:"increaseHoverVerbosityLevel",comment:["Label for action that will increase the hover verbosity level."]},"Increase Hover Verbosity Level"),_o="editor.action.decreaseHoverVerbosityLevel",rc=u({key:"decreaseHoverVerbosityLevel",comment:["Label for action that will decrease the hover verbosity level."]},"Decrease Hover Verbosity Level");function To(r,e){return!!r[e]}class ko{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=To(e.event,t.triggerModifier),this.hasSideBySideModifier=To(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}class os{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=To(e,t.triggerModifier)}}class Ii{constructor(e,t,i,o){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=i,this.triggerSideBySideModifier=o}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}}function ns(r){return r==="altKey"?Fi?new Ii(57,"metaKey",6,"altKey"):new Ii(5,"ctrlKey",6,"altKey"):Fi?new Ii(6,"altKey",57,"metaKey"):new Ii(6,"altKey",5,"ctrlKey")}class pr extends P{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new x),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new x),this.onExecute=this._onExecute.event,this._onCancel=this._register(new x),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=(t==null?void 0:t.extractLineNumberFromMouseEvent)??(i=>i.target.position?i.target.position.lineNumber:0),this._opts=ns(this._editor.getOption(78)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(i=>{if(i.hasChanged(78)){const o=ns(this._editor.getOption(78));if(this._opts.equals(o))return;this._opts=o,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(i=>this._onEditorMouseMove(new ko(i,this._opts)))),this._register(this._editor.onMouseDown(i=>this._onEditorMouseDown(new ko(i,this._opts)))),this._register(this._editor.onMouseUp(i=>this._onEditorMouseUp(new ko(i,this._opts)))),this._register(this._editor.onKeyDown(i=>this._onEditorKeyDown(new os(i,this._opts)))),this._register(this._editor.onKeyUp(i=>this._onEditorKeyUp(new os(i,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(i=>this._onDidChangeCursorSelection(i))),this._register(this._editor.onDidChangeModel(i=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(i=>{(i.scrollTopChanged||i.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){const t=this._extractLineNumberFromMouseEvent(e);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}const ss=new S(new jt(0,122,204)),ac={showArrow:!0,showFrame:!0,className:"",frameColor:ss,arrowColor:ss,keepEditorSelection:!1},dc="vs.editor.contrib.zoneWidget";class cc{constructor(e,t,i,o,n,s,a,d){this.id="",this.domNode=e,this.afterLineNumber=t,this.afterColumn=i,this.heightInLines=o,this.showInHiddenAreas=a,this.ordinal=d,this._onDomNodeTop=n,this._onComputedHeight=s}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}}class lc{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}}const no=class no{constructor(e){this._editor=e,this._ruleName=no._IdGenerator.nextId(),this._decorations=this._editor.createDecorationsCollection(),this._color=null,this._height=-1}dispose(){this.hide(),jn(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){jn(this._ruleName),oa(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:m.fromPositions(e),options:{description:"zone-widget-arrow",className:this._ruleName,stickiness:1}}])}hide(){this._decorations.clear()}};no._IdGenerator=new Pa(".arrow-decoration-");let Wo=no;class hc{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._viewZone=null,this._disposables=new k,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=Ia(t),Us(this.options,ac,!1),this.domNode=document.createElement("div"),this.options.isAccessible||(this.domNode.setAttribute("aria-hidden","true"),this.domNode.setAttribute("role","presentation")),this._disposables.add(this.editor.onDidLayoutChange(i=>{const o=this._getWidth(i);this.domNode.style.width=o+"px",this.domNode.style.left=this._getLeft(i)+"px",this._onWidth(o)}))}dispose(){this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add("zone-widget"),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement("div"),this.container.classList.add("zone-widget-container"),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new Wo(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){const e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){const e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+"px"}_onViewZoneHeight(e){var t;if(this.domNode.style.height=`${e}px`,this.container){const i=e-this._decoratingElementsHeight();this.container.style.height=`${i}px`;const o=this.editor.getLayoutInfo();this._doLayout(i,this._getWidth(o))}(t=this._resizeSash)==null||t.layout()}get position(){const e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}show(e,t){const i=m.isIRange(e)?m.lift(e):m.fromPositions(e);this._isShowing=!0,this._showImpl(i,t),this._isShowing=!1,this._positionMarkerId.set([{range:i,options:Ct.EMPTY}])}hide(){var e;this._viewZone&&(this.editor.changeViewZones(t=>{this._viewZone&&t.removeZone(this._viewZone.id)}),this._viewZone=null),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),(e=this._arrow)==null||e.hide(),this._positionMarkerId.clear()}_decoratingElementsHeight(){const e=this.editor.getOption(67);let t=0;if(this.options.showArrow){const i=Math.round(e/3);t+=2*i}if(this.options.showFrame){const i=Math.round(e/9);t+=2*i}return t}_showImpl(e,t){const i=e.getStartPosition(),o=this.editor.getLayoutInfo(),n=this._getWidth(o);this.domNode.style.width=`${n}px`,this.domNode.style.left=this._getLeft(o)+"px";const s=document.createElement("div");s.style.overflow="hidden";const a=this.editor.getOption(67);if(!this.options.allowUnlimitedHeight){const g=Math.max(12,this.editor.getLayoutInfo().height/a*.8);t=Math.min(t,g)}let d=0,c=0;if(this._arrow&&this.options.showArrow&&(d=Math.round(a/3),this._arrow.height=d,this._arrow.show(i)),this.options.showFrame&&(c=Math.round(a/9)),this.editor.changeViewZones(g=>{this._viewZone&&g.removeZone(this._viewZone.id),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this.domNode.style.top="-1000px",this._viewZone=new cc(s,i.lineNumber,i.column,t,f=>this._onViewZoneTop(f),f=>this._onViewZoneHeight(f),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=g.addZone(this._viewZone),this._overlayWidget=new lc(dc+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this.container&&this.options.showFrame){const g=this.options.frameWidth?this.options.frameWidth:c;this.container.style.borderTopWidth=g+"px",this.container.style.borderBottomWidth=g+"px"}const l=t*a-this._decoratingElementsHeight();this.container&&(this.container.style.top=d+"px",this.container.style.height=l+"px",this.container.style.overflow="hidden"),this._doLayout(l,n),this.options.keepEditorSelection||this.editor.setSelection(e);const h=this.editor.getModel();if(h){const g=h.validateRange(new m(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(g,g.startLineNumber===h.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,0):this.editor.revealRange(e,0)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e){this._viewZone&&this._viewZone.heightInLines!==e&&this.editor.changeViewZones(t=>{this._viewZone&&(this._viewZone.heightInLines=e,t.layoutZone(this._viewZone.id))})}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new gd(this.domNode,this,{orientation:1})),this.options.isResizeable||(this._resizeSash.state=0);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){const i=(t.currentY-e.startY)/this.editor.getOption(67),o=i<0?Math.ceil(i):Math.floor(i),n=e.heightInLines+o;n>5&&n<35&&this._relayout(n)}}))}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){const e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}}var mr=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},vr=function(r,e){return function(t,i){e(t,i,r)}};const br=pi("IPeekViewService");vi(br,class{constructor(){this._widgets=new Map}addExclusiveWidget(r,e){const t=this._widgets.get(r);t&&(t.listener.dispose(),t.widget.dispose());const i=()=>{const o=this._widgets.get(r);o&&o.widget===e&&(o.listener.dispose(),this._widgets.delete(r))};this._widgets.set(r,{widget:e,listener:e.onDidClose(i)})}},1);var Z;(function(r){r.inPeekEditor=new kt("inReferenceSearchEditor",!0,u("inReferenceSearchEditor","Whether the current code editor is embedded inside peek")),r.notInPeekEditor=r.inPeekEditor.toNegated()})(Z||(Z={}));var Ut;let Ui=(Ut=class{constructor(e,t){e instanceof go&&Z.inPeekEditor.bindTo(t)}dispose(){}},Ut.ID="editor.contrib.referenceController",Ut);Ui=mr([vr(1,re)],Ui);Mt(Ui.ID,Ui,0);function uc(r){const e=r.get(Qe).getFocusedCodeEditor();return e instanceof go?e.getParentEditor():e}const gc={headerBackgroundColor:S.white,primaryHeadingColor:S.fromHex("#333333"),secondaryHeadingColor:S.fromHex("#6c6c6cb3")};let zi=class extends hc{constructor(e,t,i){super(e,t),this.instantiationService=i,this._onDidClose=new x,this.onDidClose=this._onDidClose.event,Us(this.options,gc,!1)}dispose(){this.disposed||(this.disposed=!0,super.dispose(),this._onDidClose.fire(this))}style(e){const t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();const e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass("peekview-widget"),this._headElement=F(".head"),this._bodyElement=F(".body"),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=F(".peekview-title"),this.options.supportOnTitleClick&&(this._titleElement.classList.add("clickable"),Gt(this._titleElement,"click",n=>this._onTitleClick(n))),y(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=F("span.filename"),this._secondaryHeading=F("span.dirname"),this._metaHeading=F("span.meta"),y(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);const i=F(".peekview-actions");y(this._headElement,i);const o=this._getActionBarOptions();this._actionbarWidget=new Js(i,o),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(new di("peekview.close",u("label.close","Close"),oe.asClassName(M.close),!0,()=>(this.dispose(),Promise.resolve())),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:fd.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute("title",e),t?this._secondaryHeading.innerText=t:Ho(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,Ri(this._metaHeading)):ti(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}const i=Math.ceil(this.editor.getOption(67)*1.2),o=Math.round(e-(i+2));this._doLayoutHead(i,t),this._doLayoutBody(o,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};zi=mr([vr(2,U)],zi);const fc=O("peekViewTitle.background",{dark:"#252526",light:"#F3F3F3",hcDark:S.black,hcLight:S.white},u("peekViewTitleBackground","Background color of the peek view title area.")),wr=O("peekViewTitleLabel.foreground",{dark:S.white,light:S.black,hcDark:S.white,hcLight:lo},u("peekViewTitleForeground","Color of the peek view title.")),Cr=O("peekViewTitleDescription.foreground",{dark:"#ccccccb3",light:"#616161",hcDark:"#FFFFFF99",hcLight:"#292929"},u("peekViewTitleInfoForeground","Color of the peek view title info.")),_c=O("peekView.border",{dark:Eo,light:Eo,hcDark:qe,hcLight:qe},u("peekViewBorder","Color of the peek view borders and arrow.")),pc=O("peekViewResult.background",{dark:"#252526",light:"#F3F3F3",hcDark:S.black,hcLight:S.white},u("peekViewResultsBackground","Background color of the peek view result list."));O("peekViewResult.lineForeground",{dark:"#bbbbbb",light:"#646465",hcDark:S.white,hcLight:lo},u("peekViewResultsMatchForeground","Foreground color for line nodes in the peek view result list."));O("peekViewResult.fileForeground",{dark:S.white,light:"#1E1E1E",hcDark:S.white,hcLight:lo},u("peekViewResultsFileForeground","Foreground color for file nodes in the peek view result list."));O("peekViewResult.selectionBackground",{dark:"#3399ff33",light:"#3399ff33",hcDark:null,hcLight:null},u("peekViewResultsSelectionBackground","Background color of the selected entry in the peek view result list."));O("peekViewResult.selectionForeground",{dark:S.white,light:"#6C6C6C",hcDark:S.white,hcLight:lo},u("peekViewResultsSelectionForeground","Foreground color of the selected entry in the peek view result list."));const yr=O("peekViewEditor.background",{dark:"#001F33",light:"#F2F8FC",hcDark:S.black,hcLight:S.white},u("peekViewEditorBackground","Background color of the peek view editor."));O("peekViewEditorGutter.background",yr,u("peekViewEditorGutterBackground","Background color of the gutter in the peek view editor."));O("peekViewEditorStickyScroll.background",yr,u("peekViewEditorStickScrollBackground","Background color of sticky scroll in the peek view editor."));O("peekViewResult.matchHighlightBackground",{dark:"#ea5c004d",light:"#ea5c004d",hcDark:null,hcLight:null},u("peekViewResultsMatchHighlight","Match highlight color in the peek view result list."));O("peekViewEditor.matchHighlightBackground",{dark:"#ff8f0099",light:"#f5d802de",hcDark:null,hcLight:null},u("peekViewEditorMatchHighlight","Match highlight color in the peek view editor."));O("peekViewEditor.matchHighlightBorder",{dark:null,light:null,hcDark:Yn,hcLight:Yn},u("peekViewEditorMatchHighlightBorder","Match highlight border in the peek view editor."));class Ye{constructor(e,t,i,o){this.isProviderFirst=e,this.parent=t,this.link=i,this._rangeCallback=o,this.id=Aa.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){var t;const e=(t=this.parent.getPreview(this))==null?void 0:t.preview(this.range);return e?u({key:"aria.oneReference.preview",comment:["Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code"]},"{0} in {1} on line {2} at column {3}",e.value,Ze(this.uri),this.range.startLineNumber,this.range.startColumn):u("aria.oneReference","in {0} on line {1} at column {2}",Ze(this.uri),this.range.startLineNumber,this.range.startColumn)}}class mc{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){const i=this._modelReference.object.textEditorModel;if(!i)return;const{startLineNumber:o,startColumn:n,endLineNumber:s,endColumn:a}=e,d=i.getWordUntilPosition({lineNumber:o,column:n-t}),c=new m(o,d.startColumn,o,n),l=new m(s,a,s,1073741824),h=i.getValueInRange(c).replace(/^\s+/,""),g=i.getValueInRange(e),f=i.getValueInRange(l).replace(/\s+$/,"");return{value:h+g+f,highlight:{start:h.length,end:h.length+g.length}}}}class li{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new xa}dispose(){Ae(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){const e=this.children.length;return e===1?u("aria.fileReferences.1","1 symbol in {0}, full path {1}",Ze(this.uri),this.uri.fsPath):u("aria.fileReferences.N","{0} symbols in {1}, full path {2}",e,Ze(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(const t of this.children)if(!this._previews.has(t.uri))try{const i=await e.createModelReference(t.uri);this._previews.set(t.uri,new mc(i))}catch(i){Me(i)}return this}}class ee{constructor(e,t){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new x,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=e,this._title=t;const[i]=e;e.sort(ee._compareReferences);let o;for(const n of e)if((!o||!Xn.isEqual(o.uri,n.uri,!0))&&(o=new li(this,n.uri),this.groups.push(o)),o.children.length===0||ee._compareReferences(n,o.children[o.children.length-1])!==0){const s=new Ye(i===n,o,n,a=>this._onDidChangeReferenceRange.fire(a));this.references.push(s),o.children.push(s)}}dispose(){Ae(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new ee(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?u("aria.result.0","No results found"):this.references.length===1?u("aria.result.1","Found 1 symbol in {0}",this.references[0].uri.fsPath):this.groups.length===1?u("aria.result.n1","Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):u("aria.result.nm","Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(e,t){const{parent:i}=e;let o=i.children.indexOf(e);const n=i.children.length,s=i.parent.groups.length;return s===1||t&&o+1<n||!t&&o>0?(t?o=(o+1)%n:o=(o+n-1)%n,i.children[o]):(o=i.parent.groups.indexOf(i),t?(o=(o+1)%s,i.parent.groups[o].children[0]):(o=(o+s-1)%s,i.parent.groups[o].children[i.parent.groups[o].children.length-1]))}nearestReference(e,t){const i=this.references.map((o,n)=>({idx:n,prefixLen:na(o.uri.toString(),e.toString()),offsetDist:Math.abs(o.range.startLineNumber-t.lineNumber)*100+Math.abs(o.range.startColumn-t.column)})).sort((o,n)=>o.prefixLen>n.prefixLen?-1:o.prefixLen<n.prefixLen?1:o.offsetDist<n.offsetDist?-1:o.offsetDist>n.offsetDist?1:0)[0];if(i)return this.references[i.idx]}referenceAt(e,t){for(const i of this.references)if(i.uri.toString()===e.toString()&&m.containsPosition(i.range,t))return i}firstReference(){for(const e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return Xn.compare(e.uri,t.uri)||m.compareRangesUsingStarts(e.range,t.range)}}var po=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},mo=function(r,e){return function(t,i){e(t,i,r)}},Fo;let Vo=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof ee||e instanceof li}getChildren(e){if(e instanceof ee)return e.groups;if(e instanceof li)return e.resolve(this._resolverService).then(t=>t.children);throw new Error("bad tree")}};Vo=po([mo(0,Pt)],Vo);class vc{getHeight(){return 23}getTemplateId(e){return e instanceof li?Gi.id:ji.id}}let Bo=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){var t;if(e instanceof Ye){const i=(t=e.parent.getPreview(e))==null?void 0:t.preview(e.range);if(i)return i.value}return Ze(e.uri)}};Bo=po([mo(0,te)],Bo);class bc{getId(e){return e instanceof Ye?e.id:e.uri}}let Ko=class extends P{constructor(e,t){super(),this._labelService=t;const i=document.createElement("div");i.classList.add("reference-file"),this.file=this._register(new _d(i,{supportHighlights:!0})),this.badge=new Td(y(i,F(".count")),{},pd),e.appendChild(i)}set(e,t){const i=Gs(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(i,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});const o=e.children.length;this.badge.setCount(o),o>1?this.badge.setTitleFormat(u("referencesCount","{0} references",o)):this.badge.setTitleFormat(u("referenceCount","{0} reference",o))}};Ko=po([mo(1,xn)],Ko);var ct;let Gi=(ct=class{constructor(e){this._instantiationService=e,this.templateId=Fo.id}renderTemplate(e){return this._instantiationService.createInstance(Ko,e)}renderElement(e,t,i){i.set(e.element,zs(e.filterData))}disposeTemplate(e){e.dispose()}},Fo=ct,ct.id="FileReferencesRenderer",ct);Gi=Fo=po([mo(0,U)],Gi);class wc extends P{constructor(e){super(),this.label=this._register(new md(e))}set(e,t){var o;const i=(o=e.parent.getPreview(e))==null?void 0:o.preview(e.range);if(!i||!i.value)this.label.set(`${Ze(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{const{value:n,highlight:s}=i;t&&!Ha.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(n,zs(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(n,[s]))}}}const so=class so{constructor(){this.templateId=so.id}renderTemplate(e){return new wc(e)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}};so.id="OneReferenceRenderer";let ji=so;class Cc{getWidgetAriaLabel(){return u("treeAriaLabel","References")}getAriaLabel(e){return e.ariaMessage}}var yc=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Rt=function(r,e){return function(t,i){e(t,i,r)}};const ro=class ro{constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new k,this._callOnModelChange=new k,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const e=this._editor.getModel();if(e){for(const t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(e){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));const t=[],i=[];for(let o=0,n=e.children.length;o<n;o++){const s=e.children[o];this._decorationIgnoreSet.has(s.id)||s.uri.toString()===this._editor.getModel().uri.toString()&&(t.push({range:s.range,options:ro.DecorationOptions}),i.push(o))}this._editor.changeDecorations(o=>{const n=o.deltaDecorations([],t);for(let s=0;s<n.length;s++)this._decorations.set(n[s],e.children[i[s]])})}_onDecorationChanged(){const e=[],t=this._editor.getModel();if(t){for(const[i,o]of this._decorations){const n=t.getDecorationRange(i);if(!n)continue;let s=!1;if(!m.equalsRange(n,o.range)){if(m.spansMultipleLines(n))s=!0;else{const a=o.range.endColumn-o.range.startColumn,d=n.endColumn-n.startColumn;a!==d&&(s=!0)}s?(this._decorationIgnoreSet.add(o.id),e.push(i)):o.range=n}}for(let i=0,o=e.length;i<o;i++)this._decorations.delete(e[i]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}};ro.DecorationOptions=Ct.register({description:"reference-decoration",stickiness:1,className:"reference-decoration"});let $o=ro;class Sc{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,i;try{const o=JSON.parse(e);t=o.ratio,i=o.heightInLines}catch{}return{ratio:t||.7,heightInLines:i||18}}}class Dc extends Fd{}let Uo=class extends zi{constructor(e,t,i,o,n,s,a,d,c){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},s),this._defaultTreeKeyboardSupport=t,this.layoutData=i,this._textModelResolverService=n,this._instantiationService=s,this._peekViewService=a,this._uriLabel=d,this._keybindingService=c,this._disposeOnNewModel=new k,this._callOnDispose=new k,this._onDidSelectReference=new x,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new ne(0,0),this._isClosing=!1,this._applyTheme(o.getColorTheme()),this._callOnDispose.add(o.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),Ae(this._preview),Ae(this._previewNotAvailableMessage),Ae(this._tree),Ae(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){const t=e.getColor(_c)||S.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(fc)||S.transparent,primaryHeadingColor:e.getColor(wr),secondaryHeadingColor:e.getColor(Cr)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?"side":"open",source:"title"})}_fillBody(e){this.setCssClass("reference-zone-widget"),this._messageContainer=y(e,F("div.messages")),ti(this._messageContainer),this._splitView=new Wd(e,{orientation:1}),this._previewContainer=y(e,F("div.preview.inline"));const t={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._preview=this._instantiationService.createInstance(go,this._previewContainer,t,{},this.editor),ti(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(es,u("missingPreviewMessage","no preview available"),Ra,es.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=y(e,F("div.ref-tree.inline"));const i={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new Cc,keyboardNavigationLabelProvider:this._instantiationService.createInstance(Bo),identityProvider:new bc,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:pc}};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(Gt(this._treeContainer,"keydown",n=>{n.equals(9)&&(this._keybindingService.dispatchEvent(n,n.target),n.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(Dc,"ReferencesWidget",this._treeContainer,new vc,[this._instantiationService.createInstance(Gi),this._instantiationService.createInstance(ji)],this._instantiationService.createInstance(Vo),i),this._splitView.addView({onDidChange:Vi.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:n=>{this._preview.layout({height:this._dim.height,width:n})}},ts.Distribute),this._splitView.addView({onDidChange:Vi.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:n=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${n}px`,this._tree.layout(this._dim.height,n)}},ts.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));const o=(n,s)=>{n instanceof Ye&&(s==="show"&&this._revealReference(n,!1),this._onDidSelectReference.fire({element:n,kind:s,source:"tree"}))};this._disposables.add(this._tree.onDidOpen(n=>{n.sideBySide?o(n.element,"side"):n.editorOptions.pinned?o(n.element,"goto"):o(n.element,"show")})),ti(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new ne(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=u("noResults","No results"),Ri(this._messageContainer),Promise.resolve(void 0)):(ti(this._messageContainer),this._decorationsManager=new $o(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{const{event:t,target:i}=e;if(t.detail!==2)return;const o=this._getFocusedReference();o&&this._onDidSelectReference.fire({element:{uri:o.uri,range:i.range},kind:t.ctrlKey||t.metaKey||t.altKey?"side":"open",source:"editor"})})),this.container.classList.add("results-loaded"),Ri(this._treeContainer),Ri(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[e]=this._tree.getFocus();if(e instanceof Ye)return e;if(e instanceof li&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:"goto",source:"tree"})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme!==si.inMemory?this.setTitle(Na(e.uri),this._uriLabel.getUriLabel(Gs(e.uri))):this.setTitle(u("peekView.alternateTitle","References"));const i=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));const o=await i;if(!this._model){o.dispose();return}Ae(this._previewModelReference);const n=o.object;if(n){const s=this._preview.getModel()===n.textEditorModel?0:1,a=m.lift(e.range).collapseToStart();this._previewModelReference=o,this._preview.setModel(n.textEditorModel),this._preview.setSelection(a),this._preview.revealRangeInCenter(a,s)}else this._preview.setModel(this._previewNotAvailableMessage),o.dispose()}};Uo=yc([Rt(3,uo),Rt(4,Pt),Rt(5,U),Rt(6,br),Rt(7,xn),Rt(8,te)],Uo);var kc=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Nt=function(r,e){return function(t,i){e(t,i,r)}},Li;const At=new kt("referenceSearchVisible",!1,u("referenceSearchVisible","Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));var lt;let hi=(lt=class{static get(e){return e.getContribution(Li.ID)}constructor(e,t,i,o,n,s,a,d){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=o,this._notificationService=n,this._instantiationService=s,this._storageService=a,this._configurationService=d,this._disposables=new k,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=At.bindTo(i)}dispose(){var e,t;this._referenceSearchVisible.reset(),this._disposables.dispose(),(e=this._widget)==null||e.dispose(),(t=this._model)==null||t.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,i){let o;if(this._widget&&(o=this._widget.position),this.closeWidget(),o&&e.containsPosition(o))return;this._peekMode=i,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));const n="peekViewLayout",s=Sc.fromJSON(this._storageService.get(n,0,"{}"));this._widget=this._instantiationService.createInstance(Uo,this._editor,this._defaultTreeKeyboardSupport,s),this._widget.setTitle(u("labelLoading","Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(n,JSON.stringify(this._widget.layoutData),0,1),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(d=>{const{element:c,kind:l}=d;if(c)switch(l){case"open":(d.source!=="editor"||!this._configurationService.getValue("editor.stablePeek"))&&this.openReference(c,!1,!1);break;case"side":this.openReference(c,!0,!1);break;case"goto":i?this._gotoReference(c,!0):this.openReference(c,!1,!0);break}}));const a=++this._requestIdPool;t.then(d=>{var c;if(a!==this._requestIdPool||!this._widget){d.dispose();return}return(c=this._model)==null||c.dispose(),this._model=d,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(u("metaTitle.N","{0} ({1})",this._model.title,this._model.references.length));const l=this._editor.getModel().uri,h=new q(e.startLineNumber,e.startColumn),g=this._model.nearestReference(l,h);if(g)return this._widget.setSelection(g).then(()=>{this._widget&&this._editor.getOption(87)==="editor"&&this._widget.focusOnPreviewEditor()})}})},d=>{this._notificationService.error(d)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const i=this._model.nearestReference(this._editor.getModel().uri,t);if(!i)return;const o=this._model.nextOrPreviousReference(i,e),n=this._editor.hasTextFocus(),s=this._widget.isPreviewEditorFocused();await this._widget.setSelection(o),await this._gotoReference(o,!1),n?this._editor.focus():this._widget&&s&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){var t,i;(t=this._widget)==null||t.dispose(),(i=this._model)==null||i.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){var o;(o=this._widget)==null||o.hide(),this._ignoreModelChangeEvent=!0;const i=m.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:i,selectionSource:"code.jump",pinned:t}},this._editor).then(n=>{if(this._ignoreModelChangeEvent=!1,!n||!this._widget){this.closeWidget();return}if(this._editor===n)this._widget.show(i),this._widget.focusOnReferenceTree();else{const s=Li.get(n),a=this._model.clone();this.closeWidget(),n.focus(),s==null||s.toggleWidget(i,It(d=>Promise.resolve(a)),this._peekMode??!1)}},n=>{this._ignoreModelChangeEvent=!1,Me(n)})}openReference(e,t,i){t||this.closeWidget();const{uri:o,range:n}=e;this._editorService.openCodeEditor({resource:o,options:{selection:n,selectionSource:"code.jump",pinned:i}},this._editor,t)}},Li=lt,lt.ID="editor.contrib.referencesController",lt);hi=Li=kc([Nt(2,re),Nt(3,Qe),Nt(4,Xt),Nt(5,U),Nt(6,vd),Nt(7,Ee)],hi);function xt(r,e){const t=uc(r);if(!t)return;const i=hi.get(t);i&&e(i)}Je.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:100,primary:Bi(2089,60),when:W.or(At,Z.inPeekEditor),handler(r){xt(r,e=>{e.changeFocusBetweenPreviewAndReferences()})}});Je.registerCommandAndKeybindingRule({id:"goToNextReference",weight:90,primary:62,secondary:[70],when:W.or(At,Z.inPeekEditor),handler(r){xt(r,e=>{e.goToNextOrPreviousReference(!0)})}});Je.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:90,primary:1086,secondary:[1094],when:W.or(At,Z.inPeekEditor),handler(r){xt(r,e=>{e.goToNextOrPreviousReference(!1)})}});Y.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference");Y.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference");Y.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch");Y.registerCommand("closeReferenceSearch",r=>xt(r,e=>e.closeWidget()));Je.registerKeybindingRule({id:"closeReferenceSearch",weight:-1,primary:9,secondary:[1033],when:W.and(Z.inPeekEditor,W.not("config.editor.stablePeek"))});Je.registerKeybindingRule({id:"closeReferenceSearch",weight:250,primary:9,secondary:[1033],when:W.and(At,W.not("config.editor.stablePeek"),W.or(v.editorTextFocus,Vd.negate()))});Je.registerCommandAndKeybindingRule({id:"revealReference",weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:W.and(At,ar,dr.negate(),cr.negate()),handler(r){var i;const t=(i=r.get(Rn).lastFocusedList)==null?void 0:i.getFocus();Array.isArray(t)&&t[0]instanceof Ye&&xt(r,o=>o.revealReference(t[0]))}});Je.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:100,primary:2051,mac:{primary:259},when:W.and(At,ar,dr.negate(),cr.negate()),handler(r){var i;const t=(i=r.get(Rn).lastFocusedList)==null?void 0:i.getFocus();Array.isArray(t)&&t[0]instanceof Ye&&xt(r,o=>o.openReference(t[0],!0,!0))}});Y.registerCommand("openReference",r=>{var i;const t=(i=r.get(Rn).lastFocusedList)==null?void 0:i.getFocus();Array.isArray(t)&&t[0]instanceof Ye&&xt(r,o=>o.openReference(t[0],!1,!0))});var Sr=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},ii=function(r,e){return function(t,i){e(t,i,r)}};const Ln=new kt("hasSymbols",!1,u("hasSymbols","Whether there are symbol locations that can be navigated via keyboard-only.")),vo=pi("ISymbolNavigationService");let zo=class{constructor(e,t,i,o){this._editorService=t,this._notificationService=i,this._keybindingService=o,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=Ln.bindTo(e)}reset(){var e,t;this._ctxHasSymbols.reset(),(e=this._currentState)==null||e.dispose(),(t=this._currentMessage)==null||t.dispose(),this._currentModel=void 0,this._currentIdx=-1}put(e){const t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();const i=new Go(this._editorService),o=i.onDidChange(n=>{if(this._ignoreEditorChange)return;const s=this._editorService.getActiveCodeEditor();if(!s)return;const a=s.getModel(),d=s.getPosition();if(!a||!d)return;let c=!1,l=!1;for(const h of t.references)if(js(h.uri,a.uri))c=!0,l=l||m.containsPosition(h.range,d);else if(c)break;(!c||!l)&&this.reset()});this._currentState=Rs(i,o)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:m.collapseToStart(t.range),selectionRevealType:3}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){var i;(i=this._currentMessage)==null||i.dispose();const e=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),t=e?u("location.kb","Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,e.getLabel()):u("location","Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};zo=Sr([ii(0,re),ii(1,Qe),ii(2,Xt),ii(3,te)],zo);vi(vo,zo,1);Dn(new class extends kn{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:Ln,kbOpts:{weight:100,primary:70}})}runEditorCommand(r,e){return r.get(vo).revealNext(e)}});Je.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:100,when:Ln,primary:9,handler(r){r.get(vo).reset()}});let Go=class{constructor(e){this._listener=new Map,this._disposables=new k,this._onDidChange=new x,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),Ae(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,Rs(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){var t;(t=this._listener.get(e))==null||t.dispose(),this._listener.delete(e)}};Go=Sr([ii(0,Qe)],Go);var Mc=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},rs=function(r,e){return function(t,i){e(t,i,r)}},Ei,Fe;let ke=(Fe=class{static get(e){return e.getContribution(Ei.ID)}constructor(e,t,i){this._openerService=i,this._messageWidget=new co,this._messageListeners=new k,this._mouseOverMessage=!1,this._editor=e,this._visible=Ei.MESSAGE_VISIBLE.bindTo(t)}dispose(){var e;(e=this._message)==null||e.dispose(),this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(e,t){qs(So(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),this._message=So(e)?La(e,{actionHandler:{callback:o=>{this.closeMessage(),Ea(this._openerService,o,So(e)?e.isTrusted:void 0)},disposables:this._messageListeners}}):void 0,this._messageWidget.value=new as(this._editor,t,typeof e=="string"?e:this._message.element),this._messageListeners.add(Vi.debounce(this._editor.onDidBlurEditorText,(o,n)=>n,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&sa(ra(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add($(this._messageWidget.value.getDomNode(),J.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add($(this._messageWidget.value.getDomNode(),J.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let i;this._messageListeners.add(this._editor.onMouseMove(o=>{o.target.position&&(i?i.containsPosition(o.target.position)||this.closeMessage():i=new m(t.lineNumber-3,1,o.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(as.fadeOut(this._messageWidget.value))}},Ei=Fe,Fe.ID="editor.contrib.messageController",Fe.MESSAGE_VISIBLE=new kt("messageVisible",!1,u("messageVisible","Whether the editor is currently showing an inline message")),Fe);ke=Ei=Mc([rs(1,re),rs(2,Yt)],ke);const Pc=kn.bindToContribution(ke.get);Dn(new Pc({id:"leaveEditorMessage",precondition:ke.MESSAGE_VISIBLE,handler:r=>r.closeMessage(),kbOpts:{weight:130,primary:9}}));let as=class{static fadeOut(e){const t=()=>{e.dispose(),clearTimeout(i),e.getDomNode().removeEventListener("animationend",t)},i=setTimeout(t,110);return e.getDomNode().addEventListener("animationend",t),e.getDomNode().classList.add("fadeOut"),{dispose:t}}constructor(e,{lineNumber:t,column:i},o){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,0),this._position={lineNumber:t,column:i},this._domNode=document.createElement("div"),this._domNode.classList.add("monaco-editor-overlaymessage"),this._domNode.style.marginLeft="-6px";const n=document.createElement("div");n.classList.add("anchor","top"),this._domNode.appendChild(n);const s=document.createElement("div");typeof o=="string"?(s.classList.add("message"),s.textContent=o):(o.classList.add("message"),s.appendChild(o)),this._domNode.appendChild(s);const a=document.createElement("div");a.classList.add("anchor","below"),this._domNode.appendChild(a),this._editor.addContentWidget(this),this._domNode.classList.add("fadeIn")}dispose(){this._editor.removeContentWidget(this)}getId(){return"messageoverlay"}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2],positionAffinity:1}}afterRender(e){this._domNode.classList.toggle("below",e===2)}};Mt(ke.ID,ke,4);function jo(r,e){return e.uri.scheme===r.uri.scheme?!0:!aa(e.uri,si.walkThroughSnippet,si.vscodeChatCodeBlock,si.vscodeChatCodeCompareBlock)}async function bi(r,e,t,i,o){const s=t.ordered(r,i).map(d=>Promise.resolve(o(d,r,e)).then(void 0,c=>{et(c)})),a=await Promise.all(s);return Mn(a.flat()).filter(d=>jo(r,d))}function bo(r,e,t,i,o){return bi(e,t,r,i,(n,s,a)=>n.provideDefinition(s,a,o))}function En(r,e,t,i,o){return bi(e,t,r,i,(n,s,a)=>n.provideDeclaration(s,a,o))}function On(r,e,t,i,o){return bi(e,t,r,i,(n,s,a)=>n.provideImplementation(s,a,o))}function Tn(r,e,t,i,o){return bi(e,t,r,i,(n,s,a)=>n.provideTypeDefinition(s,a,o))}function wi(r,e,t,i,o,n){return bi(e,t,r,o,async(s,a,d)=>{var h,g;const c=(h=await s.provideReferences(a,d,{includeDeclaration:!0},n))==null?void 0:h.filter(f=>jo(a,f));if(!i||!c||c.length!==2)return c;const l=(g=await s.provideReferences(a,d,{includeDeclaration:!1},n))==null?void 0:g.filter(f=>jo(a,f));return l&&l.length===1?l:c})}async function Pe(r){const e=await r(),t=new ee(e,""),i=t.references.map(o=>o.link);return t.dispose(),i}he("_executeDefinitionProvider",(r,e,t)=>{const i=r.get(R),o=bo(i.definitionProvider,e,t,!1,L.None);return Pe(()=>o)});he("_executeDefinitionProvider_recursive",(r,e,t)=>{const i=r.get(R),o=bo(i.definitionProvider,e,t,!0,L.None);return Pe(()=>o)});he("_executeTypeDefinitionProvider",(r,e,t)=>{const i=r.get(R),o=Tn(i.typeDefinitionProvider,e,t,!1,L.None);return Pe(()=>o)});he("_executeTypeDefinitionProvider_recursive",(r,e,t)=>{const i=r.get(R),o=Tn(i.typeDefinitionProvider,e,t,!0,L.None);return Pe(()=>o)});he("_executeDeclarationProvider",(r,e,t)=>{const i=r.get(R),o=En(i.declarationProvider,e,t,!1,L.None);return Pe(()=>o)});he("_executeDeclarationProvider_recursive",(r,e,t)=>{const i=r.get(R),o=En(i.declarationProvider,e,t,!0,L.None);return Pe(()=>o)});he("_executeReferenceProvider",(r,e,t)=>{const i=r.get(R),o=wi(i.referenceProvider,e,t,!1,!1,L.None);return Pe(()=>o)});he("_executeReferenceProvider_recursive",(r,e,t)=>{const i=r.get(R),o=wi(i.referenceProvider,e,t,!1,!0,L.None);return Pe(()=>o)});he("_executeImplementationProvider",(r,e,t)=>{const i=r.get(R),o=On(i.implementationProvider,e,t,!1,L.None);return Pe(()=>o)});he("_executeImplementationProvider_recursive",(r,e,t)=>{const i=r.get(R),o=On(i.implementationProvider,e,t,!0,L.None);return Pe(()=>o)});Ns.appendMenuItem(H.EditorContext,{submenu:H.EditorContextPeek,title:u("peek.submenu","Peek"),group:"navigation",order:100});class qt{static is(e){return!e||typeof e!="object"?!1:!!(e instanceof qt||q.isIPosition(e.position)&&e.model)}constructor(e,t){this.model=e,this.position=t}}const ce=class ce extends da{static all(){return ce._allSymbolNavigationCommands.values()}static _patchConfig(e){const t={...e,f1:!0};if(t.menu)for(const i of ca.wrap(t.menu))(i.id===H.EditorContext||i.id===H.EditorContextPeek)&&(i.when=W.and(e.precondition,i.when));return t}constructor(e,t){super(ce._patchConfig(t)),this.configuration=e,ce._allSymbolNavigationCommands.set(t.id,this)}runEditorCommand(e,t,i,o){if(!t.hasModel())return Promise.resolve(void 0);const n=e.get(Xt),s=e.get(Qe),a=e.get(Xs),d=e.get(vo),c=e.get(R),l=e.get(U),h=t.getModel(),g=t.getPosition(),f=qt.is(i)?i:new qt(h,g),p=new ld(t,5),b=la(this._getLocationModel(c,f.model,f.position,p.token),p.token).then(async _=>{var A;if(!_||p.token.isCancellationRequested)return;qs(_.ariaMessage);let w;if(_.referenceAt(h.uri,g)){const D=this._getAlternativeCommand(t);!ce._activeAlternativeCommands.has(D)&&ce._allSymbolNavigationCommands.has(D)&&(w=ce._allSymbolNavigationCommands.get(D))}const C=_.references.length;if(C===0){if(!this.configuration.muteMessage){const D=h.getWordAtPosition(g);(A=ke.get(t))==null||A.showMessage(this._getNoResultFoundMessage(D),g)}}else if(C===1&&w)ce._activeAlternativeCommands.add(this.desc.id),l.invokeFunction(D=>w.runEditorCommand(D,t,i,o).finally(()=>{ce._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(s,d,t,_,o)},_=>{n.error(_)}).finally(()=>{p.dispose()});return a.showWhile(b,250),b}async _onResult(e,t,i,o,n){const s=this._getGoToPreference(i);if(!(i instanceof go)&&(this.configuration.openInPeek||s==="peek"&&o.references.length>1))this._openInPeek(i,o,n);else{const a=o.firstReference(),d=o.references.length>1&&s==="gotoAndPeek",c=await this._openReference(i,e,a,this.configuration.openToSide,!d);d&&c?this._openInPeek(c,o,n):o.dispose(),s==="goto"&&t.put(a)}}async _openReference(e,t,i,o,n){let s;if(Oa(i)&&(s=i.targetSelectionRange),s||(s=i.range),!s)return;const a=await t.openCodeEditor({resource:i.uri,options:{selection:m.collapseToStart(s),selectionRevealType:3,selectionSource:"code.jump"}},e,o);if(a){if(n){const d=a.getModel(),c=a.createDecorationsCollection([{range:s,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{a.getModel()===d&&c.clear()},350)}return a}}_openInPeek(e,t,i){const o=hi.get(e);o&&e.hasModel()?o.toggleWidget(i??e.getSelection(),It(n=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}};ce._allSymbolNavigationCommands=new Map,ce._activeAlternativeCommands=new Set;let Ne=ce;class Ci extends Ne{async _getLocationModel(e,t,i,o){return new ee(await bo(e.definitionProvider,t,i,!1,o),u("def.title","Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?u("noResultWord","No definition found for '{0}'",e.word):u("generic.noResults","No definition found")}_getAlternativeCommand(e){return e.getOption(58).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(58).multipleDefinitions}}var Ve;X((Ve=class extends Ci{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:Ve.id,title:{...I("actions.goToDecl.label","Go to Definition"),mnemonicTitle:u({key:"miGotoDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Definition")},precondition:v.hasDefinitionProvider,keybinding:[{when:v.editorTextFocus,primary:70,weight:100},{when:W.and(v.editorTextFocus,lr),primary:2118,weight:100}],menu:[{id:H.EditorContext,group:"navigation",order:1.1},{id:H.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:2}]}),Y.registerCommandAlias("editor.action.goToDeclaration",Ve.id)}},Ve.id="editor.action.revealDefinition",Ve));var Be;X((Be=class extends Ci{constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:Be.id,title:I("actions.goToDeclToSide.label","Open Definition to the Side"),precondition:W.and(v.hasDefinitionProvider,v.isInEmbeddedEditor.toNegated()),keybinding:[{when:v.editorTextFocus,primary:Bi(2089,70),weight:100},{when:W.and(v.editorTextFocus,lr),primary:Bi(2089,2118),weight:100}]}),Y.registerCommandAlias("editor.action.openDeclarationToTheSide",Be.id)}},Be.id="editor.action.revealDefinitionAside",Be));var Ke;X((Ke=class extends Ci{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:Ke.id,title:I("actions.previewDecl.label","Peek Definition"),precondition:W.and(v.hasDefinitionProvider,Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated()),keybinding:{when:v.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:H.EditorContextPeek,group:"peek",order:2}}),Y.registerCommandAlias("editor.action.previewDeclaration",Ke.id)}},Ke.id="editor.action.peekDefinition",Ke));class Dr extends Ne{async _getLocationModel(e,t,i,o){return new ee(await En(e.declarationProvider,t,i,!1,o),u("decl.title","Declarations"))}_getNoResultFoundMessage(e){return e&&e.word?u("decl.noResultWord","No declaration found for '{0}'",e.word):u("decl.generic.noResults","No declaration found")}_getAlternativeCommand(e){return e.getOption(58).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(58).multipleDeclarations}}var ht;X((ht=class extends Dr{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:ht.id,title:{...I("actions.goToDeclaration.label","Go to Declaration"),mnemonicTitle:u({key:"miGotoDeclaration",comment:["&& denotes a mnemonic"]},"Go to &&Declaration")},precondition:W.and(v.hasDeclarationProvider,v.isInEmbeddedEditor.toNegated()),menu:[{id:H.EditorContext,group:"navigation",order:1.3},{id:H.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?u("decl.noResultWord","No declaration found for '{0}'",e.word):u("decl.generic.noResults","No declaration found")}},ht.id="editor.action.revealDeclaration",ht));X(class extends Dr{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",title:I("actions.peekDecl.label","Peek Declaration"),precondition:W.and(v.hasDeclarationProvider,Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated()),menu:{id:H.EditorContextPeek,group:"peek",order:3}})}});class kr extends Ne{async _getLocationModel(e,t,i,o){return new ee(await Tn(e.typeDefinitionProvider,t,i,!1,o),u("typedef.title","Type Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?u("goToTypeDefinition.noResultWord","No type definition found for '{0}'",e.word):u("goToTypeDefinition.generic.noResults","No type definition found")}_getAlternativeCommand(e){return e.getOption(58).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(58).multipleTypeDefinitions}}var ut;X((ut=class extends kr{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:ut.ID,title:{...I("actions.goToTypeDefinition.label","Go to Type Definition"),mnemonicTitle:u({key:"miGotoTypeDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Type Definition")},precondition:v.hasTypeDefinitionProvider,keybinding:{when:v.editorTextFocus,primary:0,weight:100},menu:[{id:H.EditorContext,group:"navigation",order:1.4},{id:H.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}},ut.ID="editor.action.goToTypeDefinition",ut));var gt;X((gt=class extends kr{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:gt.ID,title:I("actions.peekTypeDefinition.label","Peek Type Definition"),precondition:W.and(v.hasTypeDefinitionProvider,Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated()),menu:{id:H.EditorContextPeek,group:"peek",order:4}})}},gt.ID="editor.action.peekTypeDefinition",gt));class Mr extends Ne{async _getLocationModel(e,t,i,o){return new ee(await On(e.implementationProvider,t,i,!1,o),u("impl.title","Implementations"))}_getNoResultFoundMessage(e){return e&&e.word?u("goToImplementation.noResultWord","No implementation found for '{0}'",e.word):u("goToImplementation.generic.noResults","No implementation found")}_getAlternativeCommand(e){return e.getOption(58).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(58).multipleImplementations}}var ft;X((ft=class extends Mr{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:ft.ID,title:{...I("actions.goToImplementation.label","Go to Implementations"),mnemonicTitle:u({key:"miGotoImplementation",comment:["&& denotes a mnemonic"]},"Go to &&Implementations")},precondition:v.hasImplementationProvider,keybinding:{when:v.editorTextFocus,primary:2118,weight:100},menu:[{id:H.EditorContext,group:"navigation",order:1.45},{id:H.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:4}]})}},ft.ID="editor.action.goToImplementation",ft));var _t;X((_t=class extends Mr{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:_t.ID,title:I("actions.peekImplementation.label","Peek Implementations"),precondition:W.and(v.hasImplementationProvider,Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated()),keybinding:{when:v.editorTextFocus,primary:3142,weight:100},menu:{id:H.EditorContextPeek,group:"peek",order:5}})}},_t.ID="editor.action.peekImplementation",_t));class Pr extends Ne{_getNoResultFoundMessage(e){return e?u("references.no","No references found for '{0}'",e.word):u("references.noGeneric","No references found")}_getAlternativeCommand(e){return e.getOption(58).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(58).multipleReferences}}X(class extends Pr{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",title:{...I("goToReferences.label","Go to References"),mnemonicTitle:u({key:"miGotoReference",comment:["&& denotes a mnemonic"]},"Go to &&References")},precondition:W.and(v.hasReferenceProvider,Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated()),keybinding:{when:v.editorTextFocus,primary:1094,weight:100},menu:[{id:H.EditorContext,group:"navigation",order:1.45},{id:H.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:5}]})}async _getLocationModel(e,t,i,o){return new ee(await wi(e.referenceProvider,t,i,!0,!1,o),u("ref.title","References"))}});X(class extends Pr{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",title:I("references.action.label","Peek References"),precondition:W.and(v.hasReferenceProvider,Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated()),menu:{id:H.EditorContextPeek,group:"peek",order:6}})}async _getLocationModel(e,t,i,o){return new ee(await wi(e.referenceProvider,t,i,!1,!1,o),u("ref.title","References"))}});class Ic extends Ne{constructor(e,t,i){super(e,{id:"editor.action.goToLocation",title:I("label.generic","Go to Any Symbol"),precondition:W.and(Z.notInPeekEditor,v.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=i}async _getLocationModel(e,t,i,o){return new ee(this._references,u("generic.title","Locations"))}_getNoResultFoundMessage(e){return e&&u("generic.noResult","No results for '{0}'",e.word)||""}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(58).multipleReferences}_getAlternativeCommand(){return""}}Y.registerCommand({id:"editor.action.goToLocations",metadata:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:me},{name:"position",description:"The position at which to start",constraint:q.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:async(r,e,t,i,o,n,s)=>{xe(me.isUri(e)),xe(q.isIPosition(t)),xe(Array.isArray(i)),xe(typeof o>"u"||typeof o=="string"),xe(typeof s>"u"||typeof s=="boolean");const a=r.get(Qe),d=await a.openCodeEditor({resource:e},a.getFocusedCodeEditor());if(Qs(d))return d.setPosition(t),d.revealPositionInCenterIfOutsideViewport(t,0),d.invokeWithinContext(c=>{const l=new class extends Ic{_getNoResultFoundMessage(h){return n||super._getNoResultFoundMessage(h)}}({muteMessage:!n,openInPeek:!!s,openToSide:!1},i,o);c.get(U).invokeFunction(l.run.bind(l),d)})}});Y.registerCommand({id:"editor.action.peekLocations",metadata:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:me},{name:"position",description:"The position at which to start",constraint:q.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(r,e,t,i,o)=>{r.get(Le).executeCommand("editor.action.goToLocations",e,t,i,o,void 0,!0)}});Y.registerCommand({id:"editor.action.findReferences",handler:(r,e,t)=>{xe(me.isUri(e)),xe(q.isIPosition(t));const i=r.get(R),o=r.get(Qe);return o.openCodeEditor({resource:e},o.getFocusedCodeEditor()).then(n=>{if(!Qs(n)||!n.hasModel())return;const s=hi.get(n);if(!s)return;const a=It(c=>wi(i.referenceProvider,n.getModel(),q.lift(t),!1,!1,c).then(l=>new ee(l,u("ref.title","References")))),d=new m(t.lineNumber,t.column,t.lineNumber,t.column);return Promise.resolve(s.toggleWidget(d,a,!1))})}});Y.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations");var Ac=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Mo=function(r,e){return function(t,i){e(t,i,r)}},oi,$e;let ui=($e=class{constructor(e,t,i,o){this.textModelResolverService=t,this.languageService=i,this.languageFeaturesService=o,this.toUnhook=new k,this.toUnhookForKeyboard=new k,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();const n=new pr(e);this.toUnhook.add(n),this.toUnhook.add(n.onMouseMoveOrRelevantKeyDown(([s,a])=>{this.startFindDefinitionFromMouse(s,a??void 0)})),this.toUnhook.add(n.onExecute(s=>{this.isEnabled(s)&&this.gotoDefinition(s.target.position,s.hasSideBySideModifier).catch(a=>{Me(a)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(n.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(oi.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(t=>{t&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===9&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}const i=e.target.position;this.startFindDefinition(i)}async startFindDefinition(e){var s;this.toUnhookForKeyboard.clear();const t=e?(s=this.editor.getModel())==null?void 0:s.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;const i=new hd(this.editor,15);this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=It(a=>this.findDefinition(e,a));let o;try{o=await this.previousPromise}catch(a){Me(a);return}if(!o||!o.length||!i.validate(this.editor)){this.removeLinkDecorations();return}const n=o[0].originSelectionRange?m.lift(o[0].originSelectionRange):new m(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(o.length>1){let a=n;for(const{originSelectionRange:d}of o)d&&(a=m.plusRange(a,d));this.addDecoration(a,new Ie().appendText(u("multipleResults","Click to show {0} definitions.",o.length)))}else{const a=o[0];if(!a.uri)return;this.textModelResolverService.createModelReference(a.uri).then(d=>{if(!d.object||!d.object.textEditorModel){d.dispose();return}const{object:{textEditorModel:c}}=d,{startLineNumber:l}=a.range;if(l<1||l>c.getLineCount()){d.dispose();return}const h=this.getPreviewValue(c,l,a),g=this.languageService.guessLanguageIdByFilepathOrFirstLine(c.uri);this.addDecoration(n,h?new Ie().appendCodeblock(g||"",h):void 0),d.dispose()})}}getPreviewValue(e,t,i){let o=i.range;return o.endLineNumber-o.startLineNumber>=oi.MAX_SOURCE_PREVIEW_LINES&&(o=this.getPreviewRangeBasedOnIndentation(e,t)),this.stripIndentationFromPreviewRange(e,t,o)}stripIndentationFromPreviewRange(e,t,i){let n=e.getLineFirstNonWhitespaceColumn(t);for(let a=t+1;a<i.endLineNumber;a++){const d=e.getLineFirstNonWhitespaceColumn(a);n=Math.min(n,d)}return e.getValueInRange(i).replace(new RegExp(`^\\s{${n-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(e,t){const i=e.getLineFirstNonWhitespaceColumn(t),o=Math.min(e.getLineCount(),t+oi.MAX_SOURCE_PREVIEW_LINES);let n=t+1;for(;n<o;n++){const s=e.getLineFirstNonWhitespaceColumn(n);if(i===s)break}return new m(t,1,n+1,1)}addDecoration(e,t){const i={range:e,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:t}};this.linkDecorations.set([i])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){var i;return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===6&&!(((i=e.target.detail.injectedText)==null?void 0:i.options)instanceof Hn)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){const i=this.editor.getModel();return i?bo(this.languageFeaturesService.definitionProvider,i,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(i=>{const o=!t&&this.editor.getOption(89)&&!this.isInPeekEditor(i);return new Ci({openToSide:t,openInPeek:o,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(i)})}isInPeekEditor(e){const t=e.get(re);return Z.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}},oi=$e,$e.ID="editor.contrib.gotodefinitionatposition",$e.MAX_SOURCE_PREVIEW_LINES=8,$e);ui=oi=Ac([Mo(1,Pt),Mo(2,ho),Mo(3,R)],ui);Mt(ui.ID,ui,2);const xc="editor.action.inlineSuggest.showPrevious",Hc="editor.action.inlineSuggest.showNext";var Wn=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},le=function(r,e){return function(t,i){e(t,i,r)}},Oi;let ds=class extends P{constructor(e,t,i){super(),this.editor=e,this.model=t,this.instantiationService=i,this.alwaysShowToolbar=Cd(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).showToolbar==="always"),this.sessionPosition=void 0,this.position=yd(this,o=>{var d,c;const n=(d=this.model.read(o))==null?void 0:d.primaryGhostText.read(o);if(!this.alwaysShowToolbar.read(o)||!n||n.parts.length===0)return this.sessionPosition=void 0,null;const s=n.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==n.lineNumber&&(this.sessionPosition=void 0);const a=new q(n.lineNumber,Math.min(s,((c=this.sessionPosition)==null?void 0:c.column)??Number.MAX_SAFE_INTEGER));return this.sessionPosition=a,a}),this._register(Sd((o,n)=>{const s=this.model.read(o);if(!s||!this.alwaysShowToolbar.read(o))return;const a=Dd((c,l)=>{const h=l.add(this.instantiationService.createInstance(qi,this.editor,!0,this.position,s.selectedInlineCompletionIndex,s.inlineCompletionsCount,s.activeCommands));return e.addContentWidget(h),l.add(De(()=>e.removeContentWidget(h))),l.add(ri(g=>{this.position.read(g)&&s.lastTriggerKind.read(g)!==Ta.Explicit&&s.triggerExplicitly()})),h}),d=kd(this,(c,l)=>!!this.position.read(c)||!!l);n.add(ri(c=>{d.read(c)&&a.read(c)}))}))}};ds=Wn([le(2,U)],ds);const Rc=ue("inline-suggestion-hints-next",M.chevronRight,u("parameterHintsNextIcon","Icon for show next parameter hint.")),Nc=ue("inline-suggestion-hints-previous",M.chevronLeft,u("parameterHintsPreviousIcon","Icon for show previous parameter hint."));var Ue;let qi=(Ue=class extends P{static get dropDownVisible(){return this._dropDownVisible}createCommandAction(e,t,i){const o=new di(e,t,i,!0,()=>this._commandService.executeCommand(e)),n=this.keybindingService.lookupKeybinding(e,this._contextKeyService);let s=t;return n&&(s=u({key:"content",comment:["A label","A keybinding"]},"{0} ({1})",t,n.getLabel())),o.tooltip=s,o}constructor(e,t,i,o,n,s,a,d,c,l,h){super(),this.editor=e,this.withBorder=t,this._position=i,this._currentSuggestionIdx=o,this._suggestionCount=n,this._extraCommands=s,this._commandService=a,this.keybindingService=c,this._contextKeyService=l,this._menuService=h,this.id=`InlineSuggestionHintsContentWidget${Oi.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this.nodes=Ro("div.inlineSuggestionsHints",{className:this.withBorder?".withBorder":""},[Ro("div@toolBar")]),this.previousAction=this.createCommandAction(xc,u("previous","Previous"),oe.asClassName(Nc)),this.availableSuggestionCountAction=new di("inlineSuggestionHints.availableSuggestionCount","",void 0,!1),this.nextAction=this.createCommandAction(Hc,u("next","Next"),oe.asClassName(Rc)),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(H.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new Te(()=>{this.availableSuggestionCountAction.label=""},100)),this.disableButtonsDebounced=this._register(new Te(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this.toolBar=this._register(d.createInstance(qo,this.nodes.toolBar,H.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:g=>g.startsWith("primary")},actionViewItemProvider:(g,f)=>{if(g instanceof No)return d.createInstance(Ec,g,void 0);if(g===this.availableSuggestionCountAction){const p=new Lc(void 0,g,{label:!0,icon:!1});return p.setClass("availableSuggestionCount"),p}},telemetrySource:"InlineSuggestionToolbar"})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(g=>{Oi._dropDownVisible=g})),this._register(ri(g=>{this._position.read(g),this.editor.layoutContentWidget(this)})),this._register(ri(g=>{const f=this._suggestionCount.read(g),p=this._currentSuggestionIdx.read(g);f!==void 0?(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${p+1}/${f}`):this.clearAvailableSuggestionCountLabelDebounced.schedule(),f!==void 0&&f>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(ri(g=>{const p=this._extraCommands.read(g).map(b=>({class:void 0,id:b.id,enabled:!0,tooltip:b.tooltip||"",label:b.title,run:_=>this._commandService.executeCommand(b.id)}));for(const[b,_]of this.inlineCompletionsActionsMenus.getActions())for(const w of _)w instanceof No&&p.push(w);p.length>0&&p.unshift(new Ls),this.toolBar.setAdditionalSecondaryActions(p)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}},Oi=Ue,Ue._dropDownVisible=!1,Ue.id=0,Ue);qi=Oi=Wn([le(6,Le),le(7,U),le(8,te),le(9,re),le(10,Pn)],qi);class Lc extends bd{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}}class Ec extends wd{updateLabel(){const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!e)return super.updateLabel();if(this.label){const t=Ro("div.keybinding").root;this._register(new hr(t,Es,{disableTitle:!0,...Bd})).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add("inlineSuggestionStatusBarItemLabel")}}updateTooltip(){}}let qo=class extends Kd{constructor(e,t,i,o,n,s,a,d,c){super(e,{resetMenu:t,...i},o,n,s,a,d,c),this.menuId=t,this.options2=i,this.menuService=o,this.contextKeyService=n,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){var i,o,n,s,a,d,c;const e=[],t=[];er(this.menu,(i=this.options2)==null?void 0:i.menuOptions,{primary:e,secondary:t},(n=(o=this.options2)==null?void 0:o.toolbarOptions)==null?void 0:n.primaryGroup,(a=(s=this.options2)==null?void 0:s.toolbarOptions)==null?void 0:a.shouldInlineSubmenu,(c=(d=this.options2)==null?void 0:d.toolbarOptions)==null?void 0:c.useSeparatorsInPrimaryActions),t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){Lo(this.prependedPrimaryActions,e,(t,i)=>t===i)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){Lo(this.additionalActions,e,(t,i)=>t===i)||(this.additionalActions=e,this.updateToolbar())}};qo=Wn([le(3,Pn),le(4,re),le(5,tr),le(6,te),le(7,Le),le(8,In)],qo);function wo(r,e,t){const i=ve(r);return!(e<i.left||e>i.left+i.width||t<i.top||t>i.top+i.height)}let Oc=class{constructor(e,t,i){this.value=e,this.isComplete=t,this.hasLoadingMessage=i}};class Ir extends P{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new x),this.onResult=this._onResult.event,this._firstWaitScheduler=this._register(new Te(()=>this._triggerAsyncComputation(),0)),this._secondWaitScheduler=this._register(new Te(()=>this._triggerSyncComputation(),0)),this._loadingMessageScheduler=this._register(new Te(()=>this._triggerLoadingMessage(),0)),this._state=0,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),super.dispose()}get _hoverTime(){return this._editor.getOption(60).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t=!0){this._state=e,t&&this._fireResult()}_triggerAsyncComputation(){this._setState(2),this._secondWaitScheduler.schedule(this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=ha(e=>this._computer.computeAsync(e)),(async()=>{try{for await(const e of this._asyncIterable)e&&(this._result.push(e),this._fireResult());this._asyncIterableDone=!0,(this._state===3||this._state===4)&&this._setState(0)}catch(e){Me(e)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync())),this._setState(this._asyncIterableDone?0:3)}_triggerLoadingMessage(){this._state===3&&this._setState(4)}_fireResult(){if(this._state===1||this._state===2)return;const e=this._state===0,t=this._state===4;this._onResult.fire(new Oc(this._result.slice(0),e,t))}start(e){if(e===0)this._state===0&&(this._setState(1),this._firstWaitScheduler.schedule(this._firstWaitTime),this._loadingMessageScheduler.schedule(this._loadingMessageTime));else switch(this._state){case 0:this._triggerAsyncComputation(),this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break;case 2:this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break}}cancel(){this._firstWaitScheduler.cancel(),this._secondWaitScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._result=[],this._setState(0,!1)}}class Po{constructor(e,t,i,o){this.priority=e,this.range=t,this.initialMousePosX=i,this.initialMousePosY=o,this.type=1}equals(e){return e.type===1&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===1&&t.lineNumber===this.range.startLineNumber}}class Tc{constructor(e,t,i,o,n,s){this.priority=e,this.owner=t,this.range=i,this.initialMousePosX=o,this.initialMousePosY=n,this.supportsMarkerHover=s,this.type=2}equals(e){return e.type===2&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===2&&this.owner===e.owner}}class gi{constructor(e){this.renderedHoverParts=e}dispose(){for(const e of this.renderedHoverParts)e.dispose()}}const Fn=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}},Wc=30,Fc=24;class Vc extends P{constructor(e,t=new ne(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new Nd),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position="absolute",this._resizableNode.minSize=ne.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(i=>{this._resize(new ne(i.dimension.width,i.dimension.height)),i.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){var e;return(e=this._contentPosition)!=null&&e.position?q.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){const t=this._editor.getDomNode(),i=this._editor.getScrolledVisiblePosition(e);return!t||!i?void 0:ve(t).top+i.top-Wc}_availableVerticalSpaceBelow(e){const t=this._editor.getDomNode(),i=this._editor.getScrolledVisiblePosition(e);if(!t||!i)return;const o=ve(t),n=Os(t.ownerDocument.body),s=o.top+i.top+i.height;return n.height-s-Fc}_findPositionPreference(e,t){const i=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),o=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),n=Math.min(Math.max(o,i),e),s=Math.min(e,n);let a;return this._editor.getOption(60).above?a=s<=o?1:2:a=s<=i?2:1,a===1?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),a}_resize(e){this._resizableNode.layout(e.height,e.width)}}var Bc=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Ai=function(r,e){return function(t,i){e(t,i,r)}},ye;const cs=30,Kc=6;var ze;let Zo=(ze=class extends Vc{get isVisibleFromKeyboard(){var e;return((e=this._renderedHover)==null?void 0:e.source)===1}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,i,o,n){const s=e.getOption(67)+8,a=150,d=new ne(a,s);super(e,d),this._configurationService=i,this._accessibilityService=o,this._keybindingService=n,this._hover=this._register(new ur),this._onDidResize=this._register(new x),this.onDidResize=this._onDidResize.event,this._minimumSize=d,this._hoverVisibleKey=v.hoverVisible.bindTo(t),this._hoverFocusedKey=v.hoverFocused.bindTo(t),y(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex="50",this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(l=>{l.hasChanged(50)&&this._updateFont()}));const c=this._register(Ts(this._resizableNode.domNode));this._register(c.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(c.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){var e;super.dispose(),(e=this._renderedHover)==null||e.dispose(),this._editor.removeContentWidget(this)}getId(){return ye.ID}static _applyDimensions(e,t,i){const o=typeof t=="number"?`${t}px`:t,n=typeof i=="number"?`${i}px`:i;e.style.width=o,e.style.height=n}_setContentsDomNodeDimensions(e,t){const i=this._hover.contentsDomNode;return ye._applyDimensions(i,e,t)}_setContainerDomNodeDimensions(e,t){const i=this._hover.containerDomNode;return ye._applyDimensions(i,e,t)}_setHoverWidgetDimensions(e,t){this._setContentsDomNodeDimensions(e,t),this._setContainerDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,i){const o=typeof t=="number"?`${t}px`:t,n=typeof i=="number"?`${i}px`:i;e.style.maxWidth=o,e.style.maxHeight=n}_setHoverWidgetMaxDimensions(e,t){ye._applyMaxDimensions(this._hover.contentsDomNode,e,t),ye._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty("--vscode-hover-maxWidth",typeof e=="number"?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions("none","none");const t=e.width,i=e.height;this._setHoverWidgetDimensions(t,i)}_updateResizableNodeMaxDimensions(){const e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new ne(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){ye._lastDimensions=new ne(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){var t;const e=(t=this._renderedHover)==null?void 0:t.showAtPosition;if(e)return this._positionPreference===1?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){const e=this._findAvailableSpaceVertically();if(!e)return;let t=Kc;return Array.from(this._hover.contentsDomNode.children).forEach(i=>{t+=i.clientHeight}),Math.min(e,t)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty("--vscode-hover-whiteSpace","nowrap"),this._hover.containerDomNode.style.setProperty("--vscode-hover-sourceWhiteSpace","nowrap");const e=Array.from(this._hover.contentsDomNode.children).some(t=>t.scrollWidth>t.clientWidth);return this._hover.containerDomNode.style.removeProperty("--vscode-hover-whiteSpace"),this._hover.containerDomNode.style.removeProperty("--vscode-hover-sourceWhiteSpace"),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;const e=this._isHoverTextOverflowing(),t=typeof this._contentWidth>"u"?0:this._contentWidth-2;return e||this._hover.containerDomNode.clientWidth<t?Os(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth+2}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;const i=ve(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=ls(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,i.left,i.top,i.width,i.height));const o=ls(e,t,i.left,i.top,i.width,i.height);return o>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,o),!0)}_setRenderedHover(e){var t;(t=this._renderedHover)==null||t.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle("hidden",!e)}_updateFont(){const{fontSize:e,lineHeight:t}=this._editor.getOption(50),i=this._hover.contentsDomNode;i.style.fontSize=`${e}px`,i.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(n=>this._editor.applyFontInfo(n))}_updateContent(e){const t=this._hover.contentsDomNode;t.style.paddingBottom="",t.textContent="",t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){const e=Math.max(this._editor.getLayoutInfo().height/4,250,ye._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,500,ye._lastDimensions.width);this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this._updateMaxDimensions(),this.onContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?3:void 0,preference:[this._positionPreference??1]}:null}show(e){var s;if(!this._editor||!this._editor.hasModel())return;this._render(e);const t=ki(this._hover.containerDomNode),i=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,i)??1,this.onContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();const n=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&$d(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),((s=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))==null?void 0:s.getAriaLabel())??"");n&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+", "+n)}hide(){if(!this._renderedHover)return;const e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new ne(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){const e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions("auto","auto")}setMinimumDimensions(e){this._minimumSize=new ne(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){const e=typeof this._contentWidth>"u"?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new ne(e,this._minimumSize.height)}onContentsChanged(){var o;this._removeConstraintsRenderNormally();const e=this._hover.containerDomNode;let t=ki(e),i=qn(e);if(this._resizableNode.layout(t,i),this._setHoverWidgetDimensions(i,t),t=ki(e),i=qn(e),this._contentWidth=i,this._updateMinimumWidth(),this._resizableNode.layout(t,i),(o=this._renderedHover)!=null&&o.showAtPosition){const n=ki(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(n,this._renderedHover.showAtPosition)}this._layoutContentWidget()}focus(){this._hover.containerDomNode.focus()}scrollUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(50);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(50);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-cs})}scrollRight(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+cs})}pageUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}},ye=ze,ze.ID="editor.contrib.resizableContentHoverWidget",ze._lastDimensions=new ne(0,0),ze);Zo=ye=Bc([Ai(1,re),Ai(2,Ee),Ai(3,Md),Ai(4,te)],Zo);function ls(r,e,t,i,o,n){const s=t+o/2,a=i+n/2,d=Math.max(Math.abs(r-s)-o/2,0),c=Math.max(Math.abs(e-a)-n/2,0);return Math.sqrt(d*d+c*c)}class Zi{get anchor(){return this._anchor}set anchor(e){this._anchor=e}get shouldFocus(){return this._shouldFocus}set shouldFocus(e){this._shouldFocus=e}get source(){return this._source}set source(e){this._source=e}get insistOnKeepingHoverVisible(){return this._insistOnKeepingHoverVisible}set insistOnKeepingHoverVisible(e){this._insistOnKeepingHoverVisible=e}constructor(e,t){this._editor=e,this._participants=t,this._anchor=null,this._shouldFocus=!1,this._source=0,this._insistOnKeepingHoverVisible=!1}static _getLineDecorations(e,t){if(t.type!==1&&!t.supportsMarkerHover)return[];const i=e.getModel(),o=t.range.startLineNumber;if(o>i.getLineCount())return[];const n=i.getLineMaxColumn(o);return e.getLineDecorations(o).filter(s=>{if(s.options.isWholeLine)return!0;const a=s.range.startLineNumber===o?s.range.startColumn:1,d=s.range.endLineNumber===o?s.range.endColumn:n;if(s.options.showIfCollapsed){if(a>t.range.startColumn+1||t.range.endColumn-1>d)return!1}else if(a>t.range.startColumn||t.range.endColumn>d)return!1;return!0})}computeAsync(e){const t=this._anchor;if(!this._editor.hasModel()||!t)return pe.EMPTY;const i=Zi._getLineDecorations(this._editor,t);return pe.merge(this._participants.map(o=>o.computeAsync?o.computeAsync(t,i,e):pe.EMPTY))}computeSync(){if(!this._editor.hasModel()||!this._anchor)return[];const e=Zi._getLineDecorations(this._editor,this._anchor);let t=[];for(const i of this._participants)t=t.concat(i.computeSync(this._anchor,e));return Mn(t)}}class Ar{constructor(e,t,i){this.anchor=e,this.hoverParts=t,this.isComplete=i}filter(e){const t=this.hoverParts.filter(i=>i.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new $c(this,this.anchor,t,this.isComplete)}}class $c extends Ar{constructor(e,t,i,o){super(t,i,o),this.original=e}filter(e){return this.original.filter(e)}}var Uc=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},zc=function(r,e){return function(t,i){e(t,i,r)}};const hs=F;let Yo=class extends P{get hasContent(){return this._hasContent}constructor(e){super(),this._keybindingService=e,this.actions=[],this._hasContent=!1,this.hoverElement=hs("div.hover-row.status-bar"),this.hoverElement.tabIndex=0,this.actionsElement=y(this.hoverElement,hs("div.actions"))}addAction(e){const t=this._keybindingService.lookupKeybinding(e.commandId),i=t?t.getLabel():null;this._hasContent=!0;const o=this._register(Ud.render(this.actionsElement,e,i));return this.actions.push(o),o}append(e){const t=y(this.actionsElement,e);return this._hasContent=!0,t}};Yo=Uc([zc(0,te)],Yo);class Gc{constructor(e,t,i){this.provider=e,this.hover=t,this.ordinal=i}}async function jc(r,e,t,i,o){const n=await Promise.resolve(r.provideHover(t,i,o)).catch(et);if(!(!n||!qc(n)))return new Gc(r,n,e)}function Vn(r,e,t,i,o=!1){const s=r.ordered(e,o).map((a,d)=>jc(a,d,e,t,i));return pe.fromPromises(s).coalesce()}function xr(r,e,t,i,o=!1){return Vn(r,e,t,i,o).map(n=>n.hover).toPromise()}he("_executeHoverProvider",(r,e,t)=>{const i=r.get(R);return xr(i.hoverProvider,e,t,L.None)});he("_executeHoverProvider_recursive",(r,e,t)=>{const i=r.get(R);return xr(i.hoverProvider,e,t,L.None,!0)});function qc(r){const e=typeof r.range<"u",t=typeof r.contents<"u"&&r.contents&&r.contents.length>0;return e&&t}var Zc=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},it=function(r,e){return function(t,i){e(t,i,r)}};const Vt=F,Yc=ue("hover-increase-verbosity",M.add,u("increaseHoverVerbosity","Icon for increaseing hover verbosity.")),Xc=ue("hover-decrease-verbosity",M.remove,u("decreaseHoverVerbosity","Icon for decreasing hover verbosity."));class _e{constructor(e,t,i,o,n,s=void 0){this.owner=e,this.range=t,this.contents=i,this.isBeforeContent=o,this.ordinal=n,this.source=s}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}class Hr{constructor(e,t,i){this.hover=e,this.hoverProvider=t,this.hoverPosition=i}supportsVerbosityAction(e){switch(e){case se.Increase:return this.hover.canIncreaseVerbosity??!1;case se.Decrease:return this.hover.canDecreaseVerbosity??!1}}}let fi=class{constructor(e,t,i,o,n,s,a,d){this._editor=e,this._languageService=t,this._openerService=i,this._configurationService=o,this._languageFeaturesService=n,this._keybindingService=s,this._hoverService=a,this._commandService=d,this.hoverOrdinal=3}createLoadingMessage(e){return new _e(this,e.range,[new Ie().appendText(u("modesContentHover.loading","Loading..."))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];const i=this._editor.getModel(),o=e.range.startLineNumber,n=i.getLineMaxColumn(o),s=[];let a=1e3;const d=i.getLineLength(o),c=i.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),l=this._editor.getOption(118),h=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:c});let g=!1;l>=0&&d>l&&e.range.startColumn>=l&&(g=!0,s.push(new _e(this,e.range,[{value:u("stopped rendering","Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,a++))),!g&&typeof h=="number"&&d>=h&&s.push(new _e(this,e.range,[{value:u("too many characters","Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,a++));let f=!1;for(const p of t){const b=p.range.startLineNumber===o?p.range.startColumn:1,_=p.range.endLineNumber===o?p.range.endColumn:n,w=p.options.hoverMessage;if(!w||ci(w))continue;p.options.beforeContentClassName&&(f=!0);const C=new m(e.range.startLineNumber,b,e.range.startLineNumber,_);s.push(new _e(this,C,Ws(w),f,a++))}return s}computeAsync(e,t,i){if(!this._editor.hasModel()||e.type!==1)return pe.EMPTY;const o=this._editor.getModel(),n=this._languageFeaturesService.hoverProvider;return n.has(o)?this._getMarkdownHovers(n,o,e,i):pe.EMPTY}_getMarkdownHovers(e,t,i,o){const n=i.range.getStartPosition();return Vn(e,t,n,o).filter(d=>!ci(d.hover.contents)).map(d=>{const c=d.hover.range?m.lift(d.hover.range):i.range,l=new Hr(d.hover,d.provider,n);return new _e(this,c,d.hover.contents,!1,d.ordinal,l)})}renderHoverParts(e,t){return this._renderedHoverParts=new Qc(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}updateMarkdownHoverVerbosityLevel(e,t,i){var o;return Promise.resolve((o=this._renderedHoverParts)==null?void 0:o.updateMarkdownHoverPartVerbosityLevel(e,t,i))}};fi=Zc([it(1,ho),it(2,Yt),it(3,Ee),it(4,R),it(5,te),it(6,gr),it(7,Le)],fi);class xi{constructor(e,t,i){this.hoverPart=e,this.hoverElement=t,this.disposables=i}dispose(){this.disposables.dispose()}}class Qc{constructor(e,t,i,o,n,s,a,d,c,l,h){this._hoverParticipant=i,this._editor=o,this._languageService=n,this._openerService=s,this._commandService=a,this._keybindingService=d,this._hoverService=c,this._configurationService=l,this._onFinishedRendering=h,this._ongoingHoverOperations=new Map,this._disposables=new k,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(De(()=>{this.renderedHoverParts.forEach(g=>{g.dispose()}),this._ongoingHoverOperations.forEach(g=>{g.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,i){return e.sort(ua(o=>o.ordinal,ga)),e.map(o=>{const n=this._renderHoverPart(o,i);return t.appendChild(n.hoverElement),n})}_renderHoverPart(e,t){const i=this._renderMarkdownHover(e,t),o=i.hoverElement,n=e.source,s=new k;if(s.add(i),!n)return new xi(e,o,s);const a=n.supportsVerbosityAction(se.Increase),d=n.supportsVerbosityAction(se.Decrease);if(!a&&!d)return new xi(e,o,s);const c=Vt("div.verbosity-actions");return o.prepend(c),s.add(this._renderHoverExpansionAction(c,se.Increase,a)),s.add(this._renderHoverExpansionAction(c,se.Decrease,d)),new xi(e,o,s)}_renderMarkdownHover(e,t){return Jc(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,i){const o=new k,n=t===se.Increase,s=y(e,Vt(oe.asCSSSelector(n?Yc:Xc)));s.tabIndex=0;const a=new zd("mouse",!1,{target:e,position:{hoverPosition:0}},this._configurationService,this._hoverService);if(o.add(this._hoverService.setupManagedHover(a,s,el(this._keybindingService,t))),!i)return s.classList.add("disabled"),o;s.classList.add("enabled");const d=()=>this._commandService.executeCommand(t===se.Increase?fo:_o);return o.add(new Gd(s,d)),o.add(new jd(s,d,[3,10])),o}async updateMarkdownHoverPartVerbosityLevel(e,t,i=!0){const o=this._editor.getModel();if(!o)return;const n=this._getRenderedHoverPartAtIndex(t),s=n==null?void 0:n.hoverPart.source;if(!n||!(s!=null&&s.supportsVerbosityAction(e)))return;const a=await this._fetchHover(s,o,e);if(!a)return;const d=new Hr(a,s.hoverProvider,s.hoverPosition),c=n.hoverPart,l=new _e(this._hoverParticipant,c.range,a.contents,c.isBeforeContent,c.ordinal,d),h=this._renderHoverPart(l,this._onFinishedRendering);return this._replaceRenderedHoverPartAtIndex(t,h,l),i&&this._focusOnHoverPartWithIndex(t),{hoverPart:l,hoverElement:h.hoverElement}}async _fetchHover(e,t,i){let o=i===se.Increase?1:-1;const n=e.hoverProvider,s=this._ongoingHoverOperations.get(n);s&&(s.tokenSource.cancel(),o+=s.verbosityDelta);const a=new Ki;this._ongoingHoverOperations.set(n,{verbosityDelta:o,tokenSource:a});const d={verbosityRequest:{verbosityDelta:o,previousHover:e.hover}};let c;try{c=await Promise.resolve(n.provideHover(t,e.hoverPosition,a.token,d))}catch(l){et(l)}return a.dispose(),this._ongoingHoverOperations.delete(n),c}_replaceRenderedHoverPartAtIndex(e,t,i){if(e>=this.renderedHoverParts.length||e<0)return;const o=this.renderedHoverParts[e],n=o.hoverElement,s=t.hoverElement,a=Array.from(s.children);n.replaceChildren(...a);const d=new xi(i,n,t.disposables);n.focus(),o.dispose(),this.renderedHoverParts[e]=d}_focusOnHoverPartWithIndex(e){this.renderedHoverParts[e].hoverElement.focus()}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}}function Jc(r,e,t,i,o){const n=new k,s=Vt("div.hover-row"),a=Vt("div.hover-row-contents");s.appendChild(a);const d=e.contents;for(const l of d){if(ci(l))continue;const h=Vt("div.markdown-hover"),g=y(h,Vt("div.hover-contents")),f=n.add(new Zs({editor:r},t,i));n.add(f.onDidRenderAsync(()=>{g.className="hover-contents code-hover-contents",o()}));const p=n.add(f.render(l));g.appendChild(p.element),a.appendChild(h)}return{hoverPart:e,hoverElement:s,dispose(){n.dispose()}}}function el(r,e){switch(e){case se.Increase:{const t=r.lookupKeybinding(fo);return t?u("increaseVerbosityWithKb","Increase Hover Verbosity ({0})",t.getLabel()):u("increaseVerbosity","Increase Hover Verbosity")}case se.Decrease:{const t=r.lookupKeybinding(_o);return t?u("decreaseVerbosityWithKb","Decrease Hover Verbosity ({0})",t.getLabel()):u("decreaseVerbosity","Decrease Hover Verbosity")}}}var Rr=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Xo=function(r,e){return function(t,i){e(t,i,r)}};let Yi=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,i){const o=t.range,n=t.color,s=n.alpha,a=new S(new jt(Math.round(255*n.red),Math.round(255*n.green),Math.round(255*n.blue),s)),d=s?S.Format.CSS.formatRGB(a):S.Format.CSS.formatRGBA(a),c=s?S.Format.CSS.formatHSL(a):S.Format.CSS.formatHSLA(a),l=s?S.Format.CSS.formatHex(a):S.Format.CSS.formatHexA(a),h=[];return h.push({label:d,textEdit:{range:o,text:d}}),h.push({label:c,textEdit:{range:o,text:c}}),h.push({label:l,textEdit:{range:o,text:l}}),h}};Yi=Rr([Xo(0,rr)],Yi);let Qo=class extends P{constructor(e,t){super(),this._register(e.colorProvider.register("*",new Yi(t)))}};Qo=Rr([Xo(0,R),Xo(1,rr)],Qo);qd(Qo);async function Nr(r,e,t,i=!0){return Bn(new tl,r,e,t,i)}function Lr(r,e,t,i){return Promise.resolve(t.provideColorPresentations(r,e,i))}class tl{constructor(){}async compute(e,t,i,o){const n=await e.provideDocumentColors(t,i);if(Array.isArray(n))for(const s of n)o.push({colorInfo:s,provider:e});return Array.isArray(n)}}class il{constructor(){}async compute(e,t,i,o){const n=await e.provideDocumentColors(t,i);if(Array.isArray(n))for(const s of n)o.push({range:s.range,color:[s.color.red,s.color.green,s.color.blue,s.color.alpha]});return Array.isArray(n)}}class ol{constructor(e){this.colorInfo=e}async compute(e,t,i,o){const n=await e.provideColorPresentations(t,this.colorInfo,L.None);return Array.isArray(n)&&o.push(...n),Array.isArray(n)}}async function Bn(r,e,t,i,o){let n=!1,s;const a=[],d=e.ordered(t);for(let c=d.length-1;c>=0;c--){const l=d[c];if(l instanceof Yi)s=l;else try{await r.compute(l,t,i,a)&&(n=!0)}catch(h){et(h)}}return n?a:s&&o?(await r.compute(s,t,i,a),a):[]}function Er(r,e){const{colorProvider:t}=r.get(R),i=r.get(Fs).getModel(e);if(!i)throw $t();const o=r.get(Ee).getValue("editor.defaultColorDecorators",{resource:e});return{model:i,colorProviderRegistry:t,isDefaultColorDecoratorsEnabled:o}}Y.registerCommand("_executeDocumentColorProvider",function(r,...e){const[t]=e;if(!(t instanceof me))throw $t();const{model:i,colorProviderRegistry:o,isDefaultColorDecoratorsEnabled:n}=Er(r,t);return Bn(new il,o,i,L.None,n)});Y.registerCommand("_executeColorPresentationProvider",function(r,...e){const[t,i]=e,{uri:o,range:n}=i;if(!(o instanceof me)||!Array.isArray(t)||t.length!==4||!m.isIRange(n))throw $t();const{model:s,colorProviderRegistry:a,isDefaultColorDecoratorsEnabled:d}=Er(r,o),[c,l,h,g]=t;return Bn(new ol({range:n,color:{red:c,green:l,blue:h,alpha:g}}),a,s,L.None,d)});var nl=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Io=function(r,e){return function(t,i){e(t,i,r)}},Jo;const sl=Object.create({});var Ge;let Zt=(Ge=class extends P{constructor(e,t,i,o){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=i,this._localToDispose=this._register(new k),this._decorationsIds=[],this._colorDatas=new Map,this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=new ir(this._editor),this._decoratorLimitReporter=new rl,this._colorDecorationClassRefs=this._register(new k),this._debounceInformation=o.for(i.colorProvider,"Document Colors",{min:Jo.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(i.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(n=>{const s=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._isDefaultColorDecoratorsEnabled=this._editor.getOption(148);const a=s!==this._isColorDecoratorsEnabled||n.hasChanged(21),d=n.hasChanged(148);(a||d)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._isDefaultColorDecoratorsEnabled=this._editor.getOption(148),this.updateColors()}isEnabled(){const e=this._editor.getModel();if(!e)return!1;const t=e.getLanguageId(),i=this._configurationService.getValue(t);if(i&&typeof i=="object"){const o=i.colorDecorators;if(o&&o.enable!==void 0&&!o.enable)return o.enable}return this._editor.getOption(20)}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;const e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new Vs,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=It(async e=>{const t=this._editor.getModel();if(!t)return[];const i=new Bs(!1),o=await Nr(this._languageFeaturesService.colorProvider,t,e,this._isDefaultColorDecoratorsEnabled);return this._debounceInformation.update(t,i.elapsed()),o});try{const e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){Me(e)}}stop(){this._timeoutTimer&&(this._timeoutTimer.cancel(),this._timeoutTimer=null),this._computePromise&&(this._computePromise.cancel(),this._computePromise=null),this._localToDispose.clear()}updateDecorations(e){const t=e.map(i=>({range:{startLineNumber:i.colorInfo.range.startLineNumber,startColumn:i.colorInfo.range.startColumn,endLineNumber:i.colorInfo.range.endLineNumber,endColumn:i.colorInfo.range.endColumn},options:Ct.EMPTY}));this._editor.changeDecorations(i=>{this._decorationsIds=i.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((o,n)=>this._colorDatas.set(o,e[n]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();const t=[],i=this._editor.getOption(21);for(let n=0;n<e.length&&t.length<i;n++){const{red:s,green:a,blue:d,alpha:c}=e[n].colorInfo.color,l=new jt(Math.round(s*255),Math.round(a*255),Math.round(d*255),c),h=`rgba(${l.r}, ${l.g}, ${l.b}, ${l.a})`,g=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:h}));t.push({range:{startLineNumber:e[n].colorInfo.range.startLineNumber,startColumn:e[n].colorInfo.range.startColumn,endLineNumber:e[n].colorInfo.range.endLineNumber,endColumn:e[n].colorInfo.range.endColumn},options:{description:"colorDetector",before:{content:fa,inlineClassName:`${g.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:sl}}})}const o=i<e.length?i:!1;this._decoratorLimitReporter.update(e.length,o),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){const t=this._editor.getModel();if(!t)return null;const i=t.getDecorationsInRange(m.fromPositions(e,e)).filter(o=>this._colorDatas.has(o.id));return i.length===0?null:this._colorDatas.get(i[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}},Jo=Ge,Ge.ID="editor.contrib.colorDetector",Ge.RECOMPUTE_TIME=1e3,Ge);Zt=Jo=nl([Io(1,Ee),Io(2,R),Io(3,fr)],Zt);class rl{constructor(){this._onDidChange=new x,this._computed=0,this._limited=!1}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}}Mt(Zt.ID,Zt,1);class al{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,i){this.presentationIndex=i,this._onColorFlushed=new x,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new x,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new x,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let i=-1;for(let o=0;o<this.colorPresentations.length;o++)if(t.toLowerCase()===this.colorPresentations[o].label){i=o;break}if(i===-1){const o=t.split("(")[0].toLowerCase();for(let n=0;n<this.colorPresentations.length;n++)if(this.colorPresentations[n].label.toLowerCase().startsWith(o)){i=n;break}}i!==-1&&i!==this.presentationIndex&&(this.presentationIndex=i,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}}const ie=F;class dl extends P{constructor(e,t,i,o=!1){super(),this.model=t,this.showingStandaloneColorPicker=o,this._closeButton=null,this._domNode=ie(".colorpicker-header"),y(e,this._domNode),this._pickedColorNode=y(this._domNode,ie(".picked-color")),y(this._pickedColorNode,ie("span.codicon.codicon-color-mode")),this._pickedColorPresentation=y(this._pickedColorNode,document.createElement("span")),this._pickedColorPresentation.classList.add("picked-color-presentation");const n=u("clickToToggleColorOptions","Click to toggle color options (rgb/hsl/hex)");this._pickedColorNode.setAttribute("title",n),this._originalColorNode=y(this._domNode,ie(".original-color")),this._originalColorNode.style.backgroundColor=S.Format.CSS.format(this.model.originalColor)||"",this.backgroundColor=i.getColorTheme().getColor(Qn)||S.white,this._register(i.onDidColorThemeChange(s=>{this.backgroundColor=s.getColor(Qn)||S.white})),this._register($(this._pickedColorNode,J.CLICK,()=>this.model.selectNextColorPresentation())),this._register($(this._originalColorNode,J.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=S.Format.CSS.format(t.color)||"",this._pickedColorNode.classList.toggle("light",t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.showingStandaloneColorPicker&&(this._domNode.classList.add("standalone-colorpicker"),this._closeButton=this._register(new cl(this._domNode)))}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=S.Format.CSS.format(e)||"",this._pickedColorNode.classList.toggle("light",e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:""}}class cl extends P{constructor(e){super(),this._onClicked=this._register(new x),this.onClicked=this._onClicked.event,this._button=document.createElement("div"),this._button.classList.add("close-button"),y(e,this._button);const t=document.createElement("div");t.classList.add("close-button-inner-div"),y(this._button,t),y(t,ie(".button"+oe.asCSSSelector(ue("color-picker-close",M.close,u("closeIcon","Icon to close the color picker"))))).classList.add("close-icon"),this._register($(this._button,J.CLICK,()=>{this._onClicked.fire()}))}}class ll extends P{constructor(e,t,i,o=!1){super(),this.model=t,this.pixelRatio=i,this._insertButton=null,this._domNode=ie(".colorpicker-body"),y(e,this._domNode),this._saturationBox=new hl(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new ul(this._domNode,this.model,o),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new gl(this._domNode,this.model,o),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),o&&(this._insertButton=this._register(new fl(this._domNode)),this._domNode.classList.add("standalone-colorpicker"))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){const i=this.model.color.hsva;this.model.color=new S(new Ni(i.h,e,t,i.a))}onDidOpacityChange(e){const t=this.model.color.hsva;this.model.color=new S(new Ni(t.h,t.s,t.v,e))}onDidHueChange(e){const t=this.model.color.hsva,i=(1-e)*360;this.model.color=new S(new Ni(i===360?0:i,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}}class hl extends P{constructor(e,t,i){super(),this.model=t,this.pixelRatio=i,this._onDidChange=new x,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new x,this.onColorFlushed=this._onColorFlushed.event,this._domNode=ie(".saturation-wrap"),y(e,this._domNode),this._canvas=document.createElement("canvas"),this._canvas.className="saturation-box",y(this._domNode,this._canvas),this.selection=ie(".saturation-selection"),y(this._domNode,this.selection),this.layout(),this._register($(this._domNode,J.POINTER_DOWN,o=>this.onPointerDown(o))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new Ys);const t=ve(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,o=>this.onDidChangePosition(o.pageX-t.left,o.pageY-t.top),()=>null);const i=$(e.target.ownerDocument,J.POINTER_UP,()=>{this._onColorFlushed.fire(),i.dispose(),this.monitor&&(this.monitor.stopMonitoring(!0),this.monitor=null)},!0)}onDidChangePosition(e,t){const i=Math.max(0,Math.min(1,e/this.width)),o=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(i,o),this._onDidChange.fire({s:i,v:o})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();const e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){const e=this.model.color.hsva,t=new S(new Ni(e.h,1,1,1)),i=this._canvas.getContext("2d"),o=i.createLinearGradient(0,0,this._canvas.width,0);o.addColorStop(0,"rgba(255, 255, 255, 1)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),o.addColorStop(1,"rgba(255, 255, 255, 0)");const n=i.createLinearGradient(0,0,0,this._canvas.height);n.addColorStop(0,"rgba(0, 0, 0, 0)"),n.addColorStop(1,"rgba(0, 0, 0, 1)"),i.rect(0,0,this._canvas.width,this._canvas.height),i.fillStyle=S.Format.CSS.format(t),i.fill(),i.fillStyle=o,i.fill(),i.fillStyle=n,i.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();const t=e.hsva;this.paintSelection(t.s,t.v)}}class Or extends P{constructor(e,t,i=!1){super(),this.model=t,this._onDidChange=new x,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new x,this.onColorFlushed=this._onColorFlushed.event,i?(this.domNode=y(e,ie(".standalone-strip")),this.overlay=y(this.domNode,ie(".standalone-overlay"))):(this.domNode=y(e,ie(".strip")),this.overlay=y(this.domNode,ie(".overlay"))),this.slider=y(this.domNode,ie(".slider")),this.slider.style.top="0px",this._register($(this.domNode,J.POINTER_DOWN,o=>this.onPointerDown(o))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;const e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){const t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;const t=this._register(new Ys),i=ve(this.domNode);this.domNode.classList.add("grabbing"),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,n=>this.onDidChangeTop(n.pageY-i.top),()=>null);const o=$(e.target.ownerDocument,J.POINTER_UP,()=>{this._onColorFlushed.fire(),o.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove("grabbing")},!0)}onDidChangeTop(e){const t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}}class ul extends Or{constructor(e,t,i=!1){super(e,t,i),this.domNode.classList.add("opacity-strip"),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);const{r:t,g:i,b:o}=e.rgba,n=new S(new jt(t,i,o,1)),s=new S(new jt(t,i,o,0));this.overlay.style.background=`linear-gradient(to bottom, ${n} 0%, ${s} 100%)`}getValue(e){return e.hsva.a}}class gl extends Or{constructor(e,t,i=!1){super(e,t,i),this.domNode.classList.add("hue-strip")}getValue(e){return 1-e.hsva.h/360}}class fl extends P{constructor(e){super(),this._onClicked=this._register(new x),this.onClicked=this._onClicked.event,this._button=y(e,document.createElement("button")),this._button.classList.add("insert-button"),this._button.textContent="Insert",this._register($(this._button,J.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}}class _l extends Wa{constructor(e,t,i,o,n=!1){super(),this.model=t,this.pixelRatio=i,this._register(Pd.getInstance(_a(e)).onDidChange(()=>this.layout())),this._domNode=ie(".colorpicker-widget"),e.appendChild(this._domNode),this.header=this._register(new dl(this._domNode,this.model,o,n)),this.body=this._register(new ll(this._domNode,this.model,this.pixelRatio,n))}layout(){this.body.layout()}get domNode(){return this._domNode}}var Tr=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Wr=function(r,e){return function(t,i){e(t,i,r)}};class pl{constructor(e,t,i,o){this.owner=e,this.range=t,this.model=i,this.provider=o,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}let Xi=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t){return[]}computeAsync(e,t,i){return pe.fromPromise(this._computeAsync(e,t,i))}async _computeAsync(e,t,i){if(!this._editor.hasModel())return[];const o=Zt.get(this._editor);if(!o)return[];for(const n of t){if(!o.isColorDecoration(n))continue;const s=o.getColorData(n.range.getStartPosition());if(s)return[await Fr(this,this._editor.getModel(),s.colorInfo,s.provider)]}return[]}renderHoverParts(e,t){const i=Vr(this,this._editor,this._themeService,t,e);if(!i)return new gi([]);this._colorPicker=i.colorPicker;const o={hoverPart:i.hoverPart,hoverElement:this._colorPicker.domNode,dispose(){i.disposables.dispose()}};return new gi([o])}handleResize(){var e;(e=this._colorPicker)==null||e.layout()}isColorPickerVisible(){return!!this._colorPicker}};Xi=Tr([Wr(1,uo)],Xi);class ml{constructor(e,t,i,o){this.owner=e,this.range=t,this.model=i,this.provider=o}}let Qi=class{constructor(e,t){this._editor=e,this._themeService=t,this._color=null}async createColorHover(e,t,i){if(!this._editor.hasModel()||!Zt.get(this._editor))return null;const n=await Nr(i,this._editor.getModel(),L.None);let s=null,a=null;for(const h of n){const g=h.colorInfo;m.containsRange(g.range,e.range)&&(s=g,a=h.provider)}const d=s??e,c=a??t,l=!!s;return{colorHover:await Fr(this,this._editor.getModel(),d,c),foundInEditor:l}}async updateEditorModel(e){if(!this._editor.hasModel())return;const t=e.model;let i=new m(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await Ti(this._editor.getModel(),t,this._color,i,e),i=Br(this._editor,i,t))}renderHoverParts(e,t){return Vr(this,this._editor,this._themeService,t,e)}set color(e){this._color=e}get color(){return this._color}};Qi=Tr([Wr(1,uo)],Qi);async function Fr(r,e,t,i){const o=e.getValueInRange(t.range),{red:n,green:s,blue:a,alpha:d}=t.color,c=new jt(Math.round(n*255),Math.round(s*255),Math.round(a*255),d),l=new S(c),h=await Lr(e,t,i,L.None),g=new al(l,[],0);return g.colorPresentations=h||[],g.guessColorPresentation(l,o),r instanceof Xi?new pl(r,m.lift(t.range),g,i):new ml(r,m.lift(t.range),g,i)}function Vr(r,e,t,i,o){if(i.length===0||!e.hasModel())return;if(o.setMinimumDimensions){const g=e.getOption(67)+8;o.setMinimumDimensions(new ne(302,g))}const n=new k,s=i[0],a=e.getModel(),d=s.model,c=n.add(new _l(o.fragment,d,e.getOption(144),t,r instanceof Qi));let l=!1,h=new m(s.range.startLineNumber,s.range.startColumn,s.range.endLineNumber,s.range.endColumn);if(r instanceof Qi){const g=s.model.color;r.color=g,Ti(a,d,g,h,s),n.add(d.onColorFlushed(f=>{r.color=f}))}else n.add(d.onColorFlushed(async g=>{await Ti(a,d,g,h,s),l=!0,h=Br(e,h,d)}));return n.add(d.onDidChangeColor(g=>{Ti(a,d,g,h,s)})),n.add(e.onDidChangeModelContent(g=>{l?l=!1:(o.hide(),e.focus())})),{hoverPart:s,colorPicker:c,disposables:n}}function Br(r,e,t){const i=[],o=t.presentation.textEdit??{range:e,text:t.presentation.label,forceMoveMarkers:!1};i.push(o),t.presentation.additionalTextEdits&&i.push(...t.presentation.additionalTextEdits);const n=m.lift(o.range),s=r.getModel()._setTrackedRange(null,n,3);return r.executeEdits("colorpicker",i),r.pushUndoStop(),r.getModel()._getTrackedRange(s)??n}async function Ti(r,e,t,i,o){const n=await Lr(r,{range:i,color:{red:t.rgba.r/255,green:t.rgba.g/255,blue:t.rgba.b/255,alpha:t.rgba.a}},o.provider,L.None);e.colorPresentations=n||[]}class Kr{constructor(e,t){this.range=e,this.direction=t}}class Kn{constructor(e,t,i){this.hint=e,this.anchor=t,this.provider=i,this._isResolved=!1}with(e){const t=new Kn(this.hint,e.anchor,this.provider);return t._isResolved=this._isResolved,t._currentResolve=this._currentResolve,t}async resolve(e){if(typeof this.provider.resolveInlayHint=="function"){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{const t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=(t==null?void 0:t.tooltip)??this.hint.tooltip,this.hint.label=(t==null?void 0:t.label)??this.hint.label,this.hint.textEdits=(t==null?void 0:t.textEdits)??this.hint.textEdits,this._isResolved=!0}catch(t){et(t),this._isResolved=!1}}}const Kt=class Kt{static async create(e,t,i,o){const n=[],s=e.ordered(t).reverse().map(a=>i.map(async d=>{try{const c=await a.provideInlayHints(t,d,o);(c!=null&&c.hints.length||a.onDidChangeInlayHints)&&n.push([c??Kt._emptyInlayHintList,a])}catch(c){et(c)}}));if(await Promise.all(s.flat()),o.isCancellationRequested||t.isDisposed())throw new pa;return new Kt(i,n,t)}constructor(e,t,i){this._disposables=new k,this.ranges=e,this.provider=new Set;const o=[];for(const[n,s]of t){this._disposables.add(n),this.provider.add(s);for(const a of n.hints){const d=i.validatePosition(a.position);let c="before";const l=Kt._getRangeAtPosition(i,d);let h;l.getStartPosition().isBefore(d)?(h=m.fromPositions(l.getStartPosition(),d),c="after"):(h=m.fromPositions(d,l.getEndPosition()),c="before"),o.push(new Kn(a,new Kr(h,c),s))}}this.items=o.sort((n,s)=>q.compare(n.hint.position,s.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){const i=t.lineNumber,o=e.getWordAtPosition(t);if(o)return new m(i,o.startColumn,i,o.endColumn);e.tokenization.tokenizeIfCheap(i);const n=e.tokenization.getLineTokens(i),s=t.column-1,a=n.findTokenIndexAtOffset(s);let d=n.getStartOffset(a),c=n.getEndOffset(a);return c-d===1&&(d===s&&a>1?(d=n.getStartOffset(a-1),c=n.getEndOffset(a-1)):c===s&&a<n.getCount()-1&&(d=n.getStartOffset(a+1),c=n.getEndOffset(a+1))),new m(i,d+1,i,c+1)}};Kt._emptyInlayHintList=Object.freeze({dispose(){},hints:[]});let Ji=Kt;function vl(r){return me.from({scheme:si.command,path:r.id,query:r.arguments&&encodeURIComponent(JSON.stringify(r.arguments))}).toString()}async function bl(r,e,t,i){const o=r.get(Pt),n=r.get(tr),s=r.get(Le),a=r.get(U),d=r.get(Xt);if(await i.item.resolve(L.None),!i.part.location)return;const c=i.part.location,l=[],h=new Set(Ns.getMenuItems(H.EditorContext).map(f=>ma(f)?f.command.id:Ld()));for(const f of Ne.all())h.has(f.desc.id)&&l.push(new di(f.desc.id,No.label(f.desc,{renderShortTitle:!0}),void 0,!0,async()=>{const p=await o.createModelReference(c.uri);try{const b=new qt(p.object.textEditorModel,m.getStartPosition(c.range)),_=i.item.anchor.range;await a.invokeFunction(f.runEditorCommand.bind(f),e,b,_)}finally{p.dispose()}}));if(i.part.command){const{command:f}=i.part;l.push(new Ls),l.push(new di(f.id,f.title,void 0,!0,async()=>{try{await s.executeCommand(f.id,...f.arguments??[])}catch(p){d.notify({severity:or.Error,source:i.item.provider.displayName,message:p})}}))}const g=e.getOption(128);n.showContextMenu({domForShadowRoot:g?e.getDomNode()??void 0:void 0,getAnchor:()=>{const f=ve(t);return{x:f.left,y:f.top+f.height+8}},getActions:()=>l,onHide:()=>{e.focus()},autoSelectFirstItem:!0})}async function wl(r,e,t,i){const n=await r.get(Pt).createModelReference(i.uri);await t.invokeWithinContext(async s=>{const a=e.hasSideBySideModifier,d=s.get(re),c=Z.inPeekEditor.getValue(d),l=!a&&t.getOption(89)&&!c;return new Ci({openToSide:a,openInPeek:l,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(s,new qt(n.object.textEditorModel,m.getStartPosition(i.range)),m.lift(i.range))}),n.dispose()}var Cl=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Lt=function(r,e){return function(t,i){e(t,i,r)}},Ot;class eo{constructor(){this._entries=new qa(50)}get(e){const t=eo._key(e);return this._entries.get(t)}set(e,t){const i=eo._key(e);this._entries.set(i,t)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}}const $r=pi("IInlayHintsCache");vi($r,eo,1);class en{constructor(e,t){this.item=e,this.index=t}get part(){const e=this.item.hint.label;return typeof e=="string"?{label:e}:e[this.index]}}class yl{constructor(e,t){this.part=e,this.hasTriggerModifier=t}}var He;let tn=(He=class{static get(e){return e.getContribution(Ot.ID)??void 0}constructor(e,t,i,o,n,s,a){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=o,this._commandService=n,this._notificationService=s,this._instaService=a,this._disposables=new k,this._sessionDisposables=new k,this._decorationsMetadata=new Map,this._ruleFactory=new ir(this._editor),this._activeRenderMode=0,this._debounceInfo=i.for(t.inlayHintsProvider,"InlayHint",{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(d=>{d.hasChanged(142)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();const e=this._editor.getOption(142);if(e.enabled==="off")return;const t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled==="on")this._activeRenderMode=0;else{let a,d;e.enabled==="onUnlessPressed"?(a=0,d=1):(a=1,d=0),this._activeRenderMode=a,this._sessionDisposables.add(va.getInstance().event(c=>{if(!this._editor.hasModel())return;const l=c.altKey&&c.ctrlKey&&!(c.shiftKey||c.metaKey)?d:a;if(l!==this._activeRenderMode){this._activeRenderMode=l;const h=this._editor.getModel(),g=this._copyInlayHintsWithCurrentAnchor(h);this._updateHintsDecorators([h.getFullModelRange()],g),s.schedule(0)}}))}const i=this._inlayHintsCache.get(t);i&&this._updateHintsDecorators([t.getFullModelRange()],i),this._sessionDisposables.add(De(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let o;const n=new Set,s=new Te(async()=>{const a=Date.now();o==null||o.dispose(!0),o=new Ki;const d=t.onWillDispose(()=>o==null?void 0:o.cancel());try{const c=o.token,l=await Ji.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),c);if(s.delay=this._debounceInfo.update(t,Date.now()-a),c.isCancellationRequested){l.dispose();return}for(const h of l.provider)typeof h.onDidChangeInlayHints=="function"&&!n.has(h)&&(n.add(h),this._sessionDisposables.add(h.onDidChangeInlayHints(()=>{s.isScheduled()||s.schedule()})));this._sessionDisposables.add(l),this._updateHintsDecorators(l.ranges,l.items),this._cacheHintsForFastRestore(t)}catch(c){Me(c)}finally{o.dispose(),d.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(s),this._sessionDisposables.add(De(()=>o==null?void 0:o.dispose(!0))),s.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(a=>{(a.scrollTopChanged||!s.isScheduled())&&s.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeModelContent(a=>{o==null||o.cancel();const d=Math.max(s.delay,1250);s.schedule(d)})),this._sessionDisposables.add(this._installDblClickGesture(()=>s.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){const e=new k,t=e.add(new pr(this._editor)),i=new k;return e.add(i),e.add(t.onMouseMoveOrRelevantKeyDown(o=>{const[n]=o,s=this._getInlayHintLabelPart(n),a=this._editor.getModel();if(!s||!a){i.clear();return}const d=new Ki;i.add(De(()=>d.dispose(!0))),s.item.resolve(d.token),this._activeInlayHintPart=s.part.command||s.part.location?new yl(s,n.hasTriggerModifier):void 0;const c=a.validatePosition(s.item.hint.position).lineNumber,l=new m(c,1,c,a.getLineMaxColumn(c)),h=this._getInlineHintsForRange(l);this._updateHintsDecorators([l],h),i.add(De(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([l],h)}))})),e.add(t.onCancel(()=>i.clear())),e.add(t.onExecute(async o=>{const n=this._getInlayHintLabelPart(o);if(n){const s=n.part;s.location?this._instaService.invokeFunction(wl,o,this._editor,s.location):Fa.is(s.command)&&await this._invokeCommand(s.command,n.item)}})),e}_getInlineHintsForRange(e){const t=new Set;for(const i of this._decorationsMetadata.values())e.containsRange(i.item.anchor.range)&&t.add(i.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;const i=this._getInlayHintLabelPart(t);if(i&&(t.event.preventDefault(),await i.item.resolve(L.None),We(i.item.hint.textEdits))){const o=i.item.hint.textEdits.map(n=>Ed.replace(m.lift(n.range),n.text));this._editor.executeEdits("inlayHint.default",o),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!ba(e.event.target))return;const t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(bl,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){var i;if(e.target.type!==6)return;const t=(i=e.target.detail.injectedText)==null?void 0:i.options;if(t instanceof Hn&&(t==null?void 0:t.attachedData)instanceof en)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(i){this._notificationService.notify({severity:or.Error,source:t.provider.displayName,message:i})}}_cacheHintsForFastRestore(e){const t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){const t=new Map;for(const[i,o]of this._decorationsMetadata){if(t.has(o.item))continue;const n=e.getDecorationRange(i);if(n){const s=new Kr(n,o.item.anchor.direction),a=o.item.with({anchor:s});t.set(o.item,a)}}return Array.from(t.values())}_getHintsRanges(){const t=this._editor.getModel(),i=this._editor.getVisibleRangesPlusViewportAboveBelow(),o=[];for(const n of i.sort(m.compareRangesUsingStarts)){const s=t.validateRange(new m(n.startLineNumber-30,n.startColumn,n.endLineNumber+30,n.endColumn));o.length===0||!m.areIntersectingOrTouching(o[o.length-1],s)?o.push(s):o[o.length-1]=m.plusRange(o[o.length-1],s)}return o}_updateHintsDecorators(e,t){var p,b;const i=[],o=(_,w,C,A,D)=>{const N={content:C,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:w.className,cursorStops:A,attachedData:D};i.push({item:_,classNameRef:w,decoration:{range:_.anchor.range,options:{description:"InlayHint",showIfCollapsed:_.anchor.range.isEmpty(),collapseOnReplaceEdit:!_.anchor.range.isEmpty(),stickiness:0,[_.anchor.direction]:this._activeRenderMode===0?N:void 0}}})},n=(_,w)=>{const C=this._ruleFactory.createClassNameRef({width:`${s/3|0}px`,display:"inline-block"});o(_,C,"",w?Mi.Right:Mi.None)},{fontSize:s,fontFamily:a,padding:d,isUniform:c}=this._getLayoutInfo(),l="--code-editorInlayHintsFontFamily";this._editor.getContainerDomNode().style.setProperty(l,a);let h={line:0,totalLen:0};for(const _ of t){if(h.line!==_.anchor.range.startLineNumber&&(h={line:_.anchor.range.startLineNumber,totalLen:0}),h.totalLen>Ot._MAX_LABEL_LEN)continue;_.hint.paddingLeft&&n(_,!1);const w=typeof _.hint.label=="string"?[{label:_.hint.label}]:_.hint.label;for(let C=0;C<w.length;C++){const A=w[C],D=C===0,N=C===w.length-1,E={fontSize:`${s}px`,fontFamily:`var(${l}), ${Va.fontFamily}`,verticalAlign:c?"baseline":"middle",unicodeBidi:"isolate"};We(_.hint.textEdits)&&(E.cursor="default"),this._fillInColors(E,_.hint),(A.command||A.location)&&((p=this._activeInlayHintPart)==null?void 0:p.part.item)===_&&this._activeInlayHintPart.part.index===C&&(E.textDecoration="underline",this._activeInlayHintPart.hasTriggerModifier&&(E.color=tt(Ba),E.cursor="pointer")),d&&(D&&N?(E.padding=`1px ${Math.max(1,s/4)|0}px`,E.borderRadius=`${s/4|0}px`):D?(E.padding=`1px 0 1px ${Math.max(1,s/4)|0}px`,E.borderRadius=`${s/4|0}px 0 0 ${s/4|0}px`):N?(E.padding=`1px ${Math.max(1,s/4)|0}px 1px 0`,E.borderRadius=`0 ${s/4|0}px ${s/4|0}px 0`):E.padding="1px 0 1px 0");let z=A.label;h.totalLen+=z.length;let B=!1;const K=h.totalLen-Ot._MAX_LABEL_LEN;if(K>0&&(z=z.slice(0,-K)+"",B=!0),o(_,this._ruleFactory.createClassNameRef(E),Sl(z),N&&!_.hint.paddingRight?Mi.Right:Mi.None,new en(_,C)),B)break}if(_.hint.paddingRight&&n(_,!0),i.length>Ot._MAX_DECORATORS)break}const g=[];for(const[_,w]of this._decorationsMetadata){const C=(b=this._editor.getModel())==null?void 0:b.getDecorationRange(_);C&&e.some(A=>A.containsRange(C))&&(g.push(_),w.classNameRef.dispose(),this._decorationsMetadata.delete(_))}const f=Od.capture(this._editor);this._editor.changeDecorations(_=>{const w=_.deltaDecorations(g,i.map(C=>C.decoration));for(let C=0;C<w.length;C++){const A=i[C];this._decorationsMetadata.set(w[C],A)}}),f.restore(this._editor)}_fillInColors(e,t){t.kind===Jn.Parameter?(e.backgroundColor=tt(Ka),e.color=tt($a)):t.kind===Jn.Type?(e.backgroundColor=tt(Ua),e.color=tt(za)):(e.backgroundColor=tt(Ga),e.color=tt(ja))}_getLayoutInfo(){const e=this._editor.getOption(142),t=e.padding,i=this._editor.getOption(52),o=this._editor.getOption(49);let n=e.fontSize;(!n||n<5||n>i)&&(n=i);const s=e.fontFamily||o;return{fontSize:n,fontFamily:s,padding:t,isUniform:!t&&s===o&&n===i}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(const e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}},Ot=He,He.ID="editor.contrib.InlayHints",He._MAX_DECORATORS=1500,He._MAX_LABEL_LEN=43,He);tn=Ot=Cl([Lt(1,R),Lt(2,fr),Lt(3,$r),Lt(4,Le),Lt(5,Xt),Lt(6,U)],tn);function Sl(r){return r.replace(/[ \t]/g,"")}Y.registerCommand("_executeInlayHintProvider",async(r,...e)=>{const[t,i]=e;xe(me.isUri(t)),xe(m.isIRange(i));const{inlayHintsProvider:o}=r.get(R),n=await r.get(Pt).createModelReference(t);try{const s=await Ji.create(o,n.object.textEditorModel,[m.lift(i)],L.None),a=s.items.map(d=>d.hint);return setTimeout(()=>s.dispose(),0),a}finally{n.dispose()}});var Dl=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Oe=function(r,e){return function(t,i){e(t,i,r)}};class us extends Tc{constructor(e,t,i,o){super(10,t,e.item.anchor.range,i,o,!0),this.part=e}}let on=class extends fi{constructor(e,t,i,o,n,s,a,d,c){super(e,t,i,s,d,o,n,c),this._resolverService=a,this.hoverOrdinal=6}suggestHoverAnchor(e){var o;if(!tn.get(this._editor)||e.target.type!==6)return null;const i=(o=e.target.detail.injectedText)==null?void 0:o.options;return i instanceof Hn&&i.attachedData instanceof en?new us(i.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,i){return e instanceof us?new pe(async o=>{const{part:n}=e;if(await n.item.resolve(i),i.isCancellationRequested)return;let s;typeof n.item.hint.tooltip=="string"?s=new Ie().appendText(n.item.hint.tooltip):n.item.hint.tooltip&&(s=n.item.hint.tooltip),s&&o.emitOne(new _e(this,e.range,[s],!1,0)),We(n.item.hint.textEdits)&&o.emitOne(new _e(this,e.range,[new Ie().appendText(u("hint.dbl","Double-click to insert"))],!1,10001));let a;if(typeof n.part.tooltip=="string"?a=new Ie().appendText(n.part.tooltip):n.part.tooltip&&(a=n.part.tooltip),a&&o.emitOne(new _e(this,e.range,[a],!1,1)),n.part.location||n.part.command){let c;const h=this._editor.getOption(78)==="altKey"?Fi?u("links.navigate.kb.meta.mac","cmd + click"):u("links.navigate.kb.meta","ctrl + click"):Fi?u("links.navigate.kb.alt.mac","option + click"):u("links.navigate.kb.alt","alt + click");n.part.location&&n.part.command?c=new Ie().appendText(u("hint.defAndCommand","Go to Definition ({0}), right click for more",h)):n.part.location?c=new Ie().appendText(u("hint.def","Go to Definition ({0})",h)):n.part.command&&(c=new Ie(`[${u("hint.cmd","Execute Command")}](${vl(n.part.command)} "${n.part.command.title}") (${h})`,{isTrusted:!0})),c&&o.emitOne(new _e(this,e.range,[c],!1,1e4))}const d=await this._resolveInlayHintLabelPartHover(n,i);for await(const c of d)o.emitOne(c)}):pe.EMPTY}async _resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return pe.EMPTY;const{uri:i,range:o}=e.part.location,n=await this._resolverService.createModelReference(i);try{const s=n.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(s)?Vn(this._languageFeaturesService.hoverProvider,s,new q(o.startLineNumber,o.startColumn),t).filter(a=>!ci(a.hover.contents)).map(a=>new _e(this,e.item.anchor.range,a.hover.contents,!1,2+a.ordinal)):pe.EMPTY}finally{n.dispose()}}};on=Dl([Oe(1,ho),Oe(2,Yt),Oe(3,te),Oe(4,gr),Oe(5,Ee),Oe(6,Pt),Oe(7,R),Oe(8,Le)],on);class $n extends P{constructor(e,t,i,o,n,s){super();const a=t.anchor,d=t.hoverParts;this._renderedHoverParts=this._register(new nn(e,i,d,s,n));const{showAtPosition:c,showAtSecondaryPosition:l}=$n.computeHoverPositions(e,a.range,d);this.shouldAppearBeforeContent=d.some(h=>h.isBeforeContent),this.showAtPosition=c,this.showAtSecondaryPosition=l,this.initialMousePosX=a.initialMousePosX,this.initialMousePosY=a.initialMousePosY,this.shouldFocus=o.shouldFocus,this.source=o.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}async updateHoverVerbosityLevel(e,t,i){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,i)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,i){let o=1;if(e.hasModel()){const l=e._getViewModel(),h=l.coordinatesConverter,g=h.convertModelRangeToViewRange(t),f=l.getLineMinColumn(g.startLineNumber),p=new q(g.startLineNumber,f);o=h.convertViewPositionToModelPosition(p).column}const n=t.startLineNumber;let s=t.startColumn,a;for(const l of i){const h=l.range,g=h.startLineNumber===n,f=h.endLineNumber===n;if(g&&f){const b=h.startColumn,_=Math.min(s,b);s=Math.max(_,o)}l.forceShowAtRange&&(a=h)}let d,c;if(a){const l=a.getStartPosition();d=l,c=l}else d=t.getStartPosition(),c=new q(n,s);return{showAtPosition:d,showAtSecondaryPosition:c}}}class kl{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}}const ao=class ao extends P{constructor(e,t,i,o,n){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=n,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,i,n,o)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,i)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,t){if(t.length===0)return P.None;let i=t[0].range;for(const n of t){const s=n.range;i=m.plusRange(i,s)}const o=e.createDecorationsCollection();return o.set([{range:i,options:ao._DECORATION_OPTIONS}]),De(()=>{o.clear()})}_renderParts(e,t,i,o){const n=new Yo(o),s={fragment:this._fragment,statusBar:n,...i},a=new k;for(const c of e){const l=this._renderHoverPartsForParticipant(t,c,s);a.add(l);for(const h of l.renderedHoverParts)this._renderedParts.push({type:"hoverPart",participant:c,hoverPart:h.hoverPart,hoverElement:h.hoverElement})}const d=this._renderStatusBar(this._fragment,n);return d&&(a.add(d),this._renderedParts.push({type:"statusBar",hoverElement:d.hoverElement,actions:d.actions})),De(()=>{a.dispose()})}_renderHoverPartsForParticipant(e,t,i){const o=e.filter(s=>s.owner===t);return o.length>0?t.renderHoverParts(i,o):new gi([])}_renderStatusBar(e,t){if(t.hasContent)return new kl(e,t)}_registerListenersOnRenderedParts(){const e=new k;return this._renderedParts.forEach((t,i)=>{const o=t.hoverElement;o.tabIndex=0,e.add($(o,J.FOCUS_IN,n=>{n.stopPropagation(),this._focusedHoverPartIndex=i})),e.add($(o,J.FOCUS_OUT,n=>{n.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){const t=e.find(i=>i instanceof fi&&!(i instanceof on));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(i=>i instanceof Xi)}async updateHoverVerbosityLevel(e,t,i){if(!this._markdownHoverParticipant)return;const o=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,t);if(o===void 0)return;const n=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,o,i);n&&(this._renderedParts[t]={type:"hoverPart",participant:this._markdownHoverParticipant,hoverPart:n.hoverPart,hoverElement:n.hoverElement},this._context.onContentsChanged())}isColorPickerVisible(){var e;return((e=this._colorHoverParticipant)==null?void 0:e.isColorPickerVisible())??!1}_normalizedIndexToMarkdownHoverIndexRange(e,t){const i=this._renderedParts[t];if(!i||i.type!=="hoverPart"||!(i.participant===e))return;const n=this._renderedParts.findIndex(s=>s.type==="hoverPart"&&s.participant===e);if(n===-1)throw new wa;return t-n}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}};ao._DECORATION_OPTIONS=Ct.register({description:"content-hover-highlight",className:"hoverHighlight"});let nn=ao;var Ml=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},gs=function(r,e){return function(t,i){e(t,i,r)}};let sn=class extends P{constructor(e,t,i){super(),this._editor=e,this._instantiationService=t,this._keybindingService=i,this._currentResult=null,this._onContentsChanged=this._register(new x),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance(Zo,this._editor)),this._participants=this._initializeHoverParticipants(),this._computer=new Zi(this._editor,this._participants),this._hoverOperation=this._register(new Ir(this._editor,this._computer)),this._registerListeners()}_initializeHoverParticipants(){const e=[];for(const t of Fn.getAll()){const i=this._instantiationService.createInstance(t,this._editor);e.push(i)}return e.sort((t,i)=>t.hoverOrdinal-i.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(t=>{var i;return(i=t.handleResize)==null?void 0:i.call(t)})})),e}_registerListeners(){this._register(this._hoverOperation.onResult(t=>{if(!this._computer.anchor)return;const i=t.hasLoadingMessage?this._addLoadingMessage(t.value):t.value;this._withResult(new Ar(this._computer.anchor,i,t.isComplete))}));const e=this._contentHoverWidget.getDomNode();this._register(Gt(e,"keydown",t=>{t.equals(9)&&this.hide()})),this._register(Gt(e,"mouseleave",t=>{this._onMouseLeave(t)})),this._register(Za.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)}))}_startShowingOrUpdateHover(e,t,i,o,n){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,i,o,!1),!0):!1;const a=this._editor.getOption(60).sticky,d=n&&this._contentHoverWidget.isMouseGettingCloser(n.event.posx,n.event.posy);return a&&d?(e&&this._startHoverOperationIfNecessary(e,t,i,o,!0),!0):e?this._currentResult.anchor.equals(e)?!0:e.canAdoptVisibleHover(this._currentResult.anchor,this._contentHoverWidget.position)?(this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,i,o,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,i,o,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,i,o,n){this._computer.anchor&&this._computer.anchor.equals(e)||(this._hoverOperation.cancel(),this._computer.anchor=e,this._computer.shouldFocus=o,this._computer.source=i,this._computer.insistOnKeepingHoverVisible=n,this._hoverOperation.start(t))}_setCurrentResult(e){let t=e;if(this._currentResult===t)return;t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover()}_addLoadingMessage(e){if(!this._computer.anchor)return e;for(const t of this._participants){if(!t.createLoadingMessage)continue;const i=t.createLoadingMessage(this._computer.anchor);if(i)return e.slice(0).concat([i])}return e}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;const o=e.hoverParts.length===0,n=this._computer.insistOnKeepingHoverVisible;o&&n||this._setCurrentResult(e)}_showHover(e){const t=this._getHoverContext();this._renderedContentHover=new $n(this._editor,e,this._participants,this._computer,t,this._keybindingService),this._renderedContentHover.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover):this._renderedContentHover.dispose()}_hideHover(){this._contentHoverWidget.hide()}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._onContentsChanged.fire(),this._contentHoverWidget.onContentsChanged()},setMinimumDimensions:o=>{this._contentHoverWidget.setMinimumDimensions(o)}}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;const i=this._findHoverAnchorCandidates(e);if(!(i.length>0))return this._startShowingOrUpdateHover(null,0,0,!1,e);const n=i[0];return this._startShowingOrUpdateHover(n,0,0,!1,e)}_findHoverAnchorCandidates(e){const t=[];for(const o of this._participants){if(!o.suggestHoverAnchor)continue;const n=o.suggestHoverAnchor(e);n&&t.push(n)}const i=e.target;switch(i.type){case 6:{t.push(new Po(0,i.range,e.event.posx,e.event.posy));break}case 7:{const o=this._editor.getOption(50).typicalHalfwidthCharacterWidth/2;if(!(!i.detail.isAfterLines&&typeof i.detail.horizontalDistanceToText=="number"&&i.detail.horizontalDistanceToText<o))break;t.push(new Po(0,i.range,e.event.posx,e.event.posy));break}}return t.sort((o,n)=>n.priority-o.priority),t}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!wo(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,i,o){this._startShowingOrUpdateHover(new Po(0,e,void 0,void 0),t,i,o,null)}async updateHoverVerbosityLevel(e,t,i){var o;(o=this._renderedContentHover)==null||o.updateHoverVerbosityLevel(e,t,i)}focusedHoverPartIndex(){var e;return((e=this._renderedContentHover)==null?void 0:e.focusedHoverPartIndex)??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){this._contentHoverWidget.focus()}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._computer.anchor=null,this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){var e;return((e=this._renderedContentHover)==null?void 0:e.isColorPickerVisible())??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};sn=Ml([gs(1,U),gs(2,te)],sn);var Pl=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},fs=function(r,e){return function(t,i){e(t,i,r)}},rn;const Il=!1;var pt;let j=(pt=class extends P{constructor(e,t,i){super(),this._editor=e,this._instantiationService=t,this._keybindingService=i,this._onHoverContentsChanged=this._register(new x),this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new k,this._hoverState={mouseDown:!1,activatedByDecoratorClick:!1},this._reactToEditorMouseMoveRunner=this._register(new Te(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(o=>{o.hasChanged(60)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(rn.ID)}_hookListeners(){const e=this._editor.getOption(60);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))):(this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this._hideWidgets()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this._hideWidgets()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._shouldNotHideCurrentHoverWidget(e)&&this._hideWidgets()}_shouldNotHideCurrentHoverWidget(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()}_isMouseOnContentHoverWidget(e){var i;const t=(i=this._contentWidget)==null?void 0:i.getDomNode();return t?wo(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._shouldNotHideCurrentHoverWidget(e))||this._hideWidgets()}_shouldNotRecomputeCurrentHoverWidget(e){const t=this._hoverSettings.sticky,i=(s,a)=>{const d=this._isMouseOnContentHoverWidget(s);return a&&d},o=s=>{var c;const a=this._isMouseOnContentHoverWidget(s),d=((c=this._contentWidget)==null?void 0:c.isColorPickerVisible)??!1;return a&&d},n=(s,a)=>{var d,c,l,h;return(a&&((c=this._contentWidget)==null?void 0:c.containsNode((d=s.event.browserEvent.view)==null?void 0:d.document.activeElement))&&!((h=(l=s.event.browserEvent.view)==null?void 0:l.getSelection())!=null&&h.isCollapsed))??!1};return i(e,t)||o(e)||n(e,t)}_onEditorMouseMove(e){var a,d,c,l;if(this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._mouseMoveEvent=e,(a=this._contentWidget)!=null&&a.isFocused||(d=this._contentWidget)!=null&&d.isResizing))return;const t=this._hoverSettings.sticky;if(t&&((c=this._contentWidget)!=null&&c.isVisibleFromKeyboard))return;if(this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}const o=this._hoverSettings.hidingDelay;if(((l=this._contentWidget)==null?void 0:l.isVisible)&&t&&o>0){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(o);return}this._reactToEditorMouseMove(e)}_reactToEditorMouseMove(e){var d;if(!e)return;const i=(d=e.target.element)==null?void 0:d.classList.contains("colorpicker-color-decoration"),o=this._editor.getOption(149),n=this._hoverSettings.enabled,s=this._hoverState.activatedByDecoratorClick;if(i&&(o==="click"&&!s||o==="hover"&&!n&&!Il||o==="clickAndHover"&&!n&&!s)||!i&&!n&&!s){this._hideWidgets();return}this._tryShowHoverWidget(e)||this._hideWidgets()}_tryShowHoverWidget(e){return this._getOrCreateContentWidget().showsOrWillShow(e)}_onKeyDown(e){var o;if(!this._editor.hasModel())return;const t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),i=t.kind===1||t.kind===2&&(t.commandId===_r||t.commandId===fo||t.commandId===_o)&&((o=this._contentWidget)==null?void 0:o.isVisible);e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||i||this._hideWidgets()}_hideWidgets(){var e,t;this._hoverState.mouseDown&&((e=this._contentWidget)!=null&&e.isColorPickerVisible)||qi.dropDownVisible||(this._hoverState.activatedByDecoratorClick=!1,(t=this._contentWidget)==null||t.hide())}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(sn,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,i,o,n=!1){this._hoverState.activatedByDecoratorClick=n,this._getOrCreateContentWidget().startShowingAtRange(e,t,i,o)}_isContentWidgetResizing(){var e;return((e=this._contentWidget)==null?void 0:e.widget.isResizing)||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}updateHoverVerbosityLevel(e,t,i){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,i)}focus(){var e;(e=this._contentWidget)==null||e.focus()}scrollUp(){var e;(e=this._contentWidget)==null||e.scrollUp()}scrollDown(){var e;(e=this._contentWidget)==null||e.scrollDown()}scrollLeft(){var e;(e=this._contentWidget)==null||e.scrollLeft()}scrollRight(){var e;(e=this._contentWidget)==null||e.scrollRight()}pageUp(){var e;(e=this._contentWidget)==null||e.pageUp()}pageDown(){var e;(e=this._contentWidget)==null||e.pageDown()}goToTop(){var e;(e=this._contentWidget)==null||e.goToTop()}goToBottom(){var e;(e=this._contentWidget)==null||e.goToBottom()}get isColorPickerVisible(){var e;return(e=this._contentWidget)==null?void 0:e.isColorPickerVisible}get isHoverVisible(){var e;return(e=this._contentWidget)==null?void 0:e.isVisible}dispose(){var e;super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),(e=this._contentWidget)==null||e.dispose()}},rn=pt,pt.ID="editor.contrib.contentHover",pt);j=rn=Pl([fs(1,U),fs(2,te)],j);var ge;(function(r){r.NoAutoFocus="noAutoFocus",r.FocusIfVisible="focusIfVisible",r.AutoFocusImmediately="autoFocusImmediately"})(ge||(ge={}));class Al extends ae{constructor(){super({id:_r,label:u({key:"showOrFocusHover",comment:["Label for action that will trigger the showing/focusing of a hover in the editor.","If the hover is not visible, it will show the hover.","This allows for users to show the hover without using the mouse."]},"Show or Focus Hover"),metadata:{description:I("showOrFocusHoverDescription","Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position."),args:[{name:"args",schema:{type:"object",properties:{focus:{description:"Controls if and when the hover should take focus upon being triggered by this action.",enum:[ge.NoAutoFocus,ge.FocusIfVisible,ge.AutoFocusImmediately],enumDescriptions:[u("showOrFocusHover.focus.noAutoFocus","The hover will not automatically take focus."),u("showOrFocusHover.focus.focusIfVisible","The hover will take focus only if it is already visible."),u("showOrFocusHover.focus.autoFocusImmediately","The hover will automatically take focus when it appears.")],default:ge.FocusIfVisible}}}}]},alias:"Show or Focus Hover",precondition:void 0,kbOpts:{kbExpr:v.editorTextFocus,primary:Bi(2089,2087),weight:100}})}run(e,t,i){if(!t.hasModel())return;const o=j.get(t);if(!o)return;const n=i==null?void 0:i.focus;let s=ge.FocusIfVisible;Object.values(ge).includes(n)?s=n:typeof n=="boolean"&&n&&(s=ge.AutoFocusImmediately);const a=c=>{const l=t.getPosition(),h=new m(l.lineNumber,l.column,l.lineNumber,l.column);o.showContentHover(h,1,1,c)},d=t.getOption(2)===2;o.isHoverVisible?s!==ge.NoAutoFocus?o.focus():a(d):a(d||s===ge.AutoFocusImmediately)}}class xl extends ae{constructor(){super({id:Yd,label:u({key:"showDefinitionPreviewHover",comment:["Label for action that will trigger the showing of definition preview hover in the editor.","This allows for users to show the definition preview hover without using the mouse."]},"Show Definition Preview Hover"),alias:"Show Definition Preview Hover",precondition:void 0,metadata:{description:I("showDefinitionPreviewHoverDescription","Show the definition preview hover in the editor.")}})}run(e,t){const i=j.get(t);if(!i)return;const o=t.getPosition();if(!o)return;const n=new m(o.lineNumber,o.column,o.lineNumber,o.column),s=ui.get(t);if(!s)return;s.startFindDefinitionFromCursor(o).then(()=>{i.showContentHover(n,1,1,!0)})}}class Hl extends ae{constructor(){super({id:Xd,label:u({key:"scrollUpHover",comment:["Action that allows to scroll up in the hover widget with the up arrow when the hover widget is focused."]},"Scroll Up Hover"),alias:"Scroll Up Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:16,weight:100},metadata:{description:I("scrollUpHoverDescription","Scroll up the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.scrollUp()}}class Rl extends ae{constructor(){super({id:Qd,label:u({key:"scrollDownHover",comment:["Action that allows to scroll down in the hover widget with the up arrow when the hover widget is focused."]},"Scroll Down Hover"),alias:"Scroll Down Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:18,weight:100},metadata:{description:I("scrollDownHoverDescription","Scroll down the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.scrollDown()}}class Nl extends ae{constructor(){super({id:Jd,label:u({key:"scrollLeftHover",comment:["Action that allows to scroll left in the hover widget with the left arrow when the hover widget is focused."]},"Scroll Left Hover"),alias:"Scroll Left Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:15,weight:100},metadata:{description:I("scrollLeftHoverDescription","Scroll left the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.scrollLeft()}}class Ll extends ae{constructor(){super({id:ec,label:u({key:"scrollRightHover",comment:["Action that allows to scroll right in the hover widget with the right arrow when the hover widget is focused."]},"Scroll Right Hover"),alias:"Scroll Right Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:17,weight:100},metadata:{description:I("scrollRightHoverDescription","Scroll right the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.scrollRight()}}class El extends ae{constructor(){super({id:tc,label:u({key:"pageUpHover",comment:["Action that allows to page up in the hover widget with the page up command when the hover widget is focused."]},"Page Up Hover"),alias:"Page Up Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:11,secondary:[528],weight:100},metadata:{description:I("pageUpHoverDescription","Page up the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.pageUp()}}class Ol extends ae{constructor(){super({id:ic,label:u({key:"pageDownHover",comment:["Action that allows to page down in the hover widget with the page down command when the hover widget is focused."]},"Page Down Hover"),alias:"Page Down Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:12,secondary:[530],weight:100},metadata:{description:I("pageDownHoverDescription","Page down the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.pageDown()}}class Tl extends ae{constructor(){super({id:oc,label:u({key:"goToTopHover",comment:["Action that allows to go to the top of the hover widget with the home command when the hover widget is focused."]},"Go To Top Hover"),alias:"Go To Bottom Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:14,secondary:[2064],weight:100},metadata:{description:I("goToTopHoverDescription","Go to the top of the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.goToTop()}}class Wl extends ae{constructor(){super({id:nc,label:u({key:"goToBottomHover",comment:["Action that allows to go to the bottom in the hover widget with the end command when the hover widget is focused."]},"Go To Bottom Hover"),alias:"Go To Bottom Hover",precondition:v.hoverFocused,kbOpts:{kbExpr:v.hoverFocused,primary:13,secondary:[2066],weight:100},metadata:{description:I("goToBottomHoverDescription","Go to the bottom of the editor hover.")}})}run(e,t){const i=j.get(t);i&&i.goToBottom()}}class Fl extends ae{constructor(){super({id:fo,label:sc,alias:"Increase Hover Verbosity Level",precondition:v.hoverVisible})}run(e,t,i){const o=j.get(t);if(!o)return;const n=(i==null?void 0:i.index)!==void 0?i.index:o.focusedHoverPartIndex();o.updateHoverVerbosityLevel(se.Increase,n,i==null?void 0:i.focus)}}class Vl extends ae{constructor(){super({id:_o,label:rc,alias:"Decrease Hover Verbosity Level",precondition:v.hoverVisible})}run(e,t,i){var s;const o=j.get(t);if(!o)return;const n=(i==null?void 0:i.index)!==void 0?i.index:o.focusedHoverPartIndex();(s=j.get(t))==null||s.updateHoverVerbosityLevel(se.Decrease,n,i==null?void 0:i.focus)}}const Se=class Se{constructor(e){this.value=e}equals(e){return this.value===e.value}contains(e){return this.equals(e)||this.value===""||e.value.startsWith(this.value+Se.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...e){return new Se((this.value?[this.value,...e]:e).join(Se.sep))}};Se.sep=".",Se.None=new Se("@@none@@"),Se.Empty=new Se("");let V=Se;const T=new class{constructor(){this.QuickFix=new V("quickfix"),this.Refactor=new V("refactor"),this.RefactorExtract=this.Refactor.append("extract"),this.RefactorInline=this.Refactor.append("inline"),this.RefactorMove=this.Refactor.append("move"),this.RefactorRewrite=this.Refactor.append("rewrite"),this.Notebook=new V("notebook"),this.Source=new V("source"),this.SourceOrganizeImports=this.Source.append("organizeImports"),this.SourceFixAll=this.Source.append("fixAll"),this.SurroundWith=this.Refactor.append("surround")}};var Xe;(function(r){r.Refactor="refactor",r.RefactorPreview="refactor preview",r.Lightbulb="lightbulb",r.Default="other (default)",r.SourceAction="source action",r.QuickFix="quick fix action",r.FixAll="fix all",r.OrganizeImports="organize imports",r.AutoFix="auto fix",r.QuickFixHover="quick fix hover window",r.OnSave="save participants",r.ProblemsView="problems view"})(Xe||(Xe={}));function Bl(r,e){return!(r.include&&!r.include.intersects(e)||r.excludes&&r.excludes.some(t=>Ur(e,t,r.include))||!r.includeSourceActions&&T.Source.contains(e))}function Kl(r,e){const t=e.kind?new V(e.kind):void 0;return!(r.include&&(!t||!r.include.contains(t))||r.excludes&&t&&r.excludes.some(i=>Ur(t,i,r.include))||!r.includeSourceActions&&t&&T.Source.contains(t)||r.onlyIncludePreferredActions&&!e.isPreferred)}function Ur(r,e,t){return!(!e.contains(r)||t&&e.contains(t))}class ot{static fromUser(e,t){return!e||typeof e!="object"?new ot(t.kind,t.apply,!1):new ot(ot.getKindFromUser(e,t.kind),ot.getApplyFromUser(e,t.apply),ot.getPreferredUser(e))}static getApplyFromUser(e,t){switch(typeof e.apply=="string"?e.apply.toLowerCase():""){case"first":return"first";case"never":return"never";case"ifsingle":return"ifSingle";default:return t}}static getKindFromUser(e,t){return typeof e.kind=="string"?new V(e.kind):t}static getPreferredUser(e){return typeof e.preferred=="boolean"?e.preferred:!1}constructor(e,t,i){this.kind=e,this.apply=t,this.preferred=i}}class $l{constructor(e,t,i){this.action=e,this.provider=t,this.highlightRange=i}async resolve(e){var t;if((t=this.provider)!=null&&t.resolveCodeAction&&!this.action.edit){let i;try{i=await this.provider.resolveCodeAction(this.action,e)}catch(o){et(o)}i&&(this.action.edit=i.edit)}return this}}const Ul="editor.action.codeAction",zr="editor.action.quickFix",zl="editor.action.autoFix",Gl="editor.action.refactor",jl="editor.action.sourceAction",_s="editor.action.organizeImports",ps="editor.action.fixAll";class ai extends P{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:e},{action:t}){return e.isAI&&!t.isAI?1:!e.isAI&&t.isAI?-1:We(e.diagnostics)?We(t.diagnostics)?ai.codeActionsPreferredComparator(e,t):-1:We(t.diagnostics)?1:ai.codeActionsPreferredComparator(e,t)}constructor(e,t,i){super(),this.documentation=t,this._register(i),this.allActions=[...e].sort(ai.codeActionsComparator),this.validActions=this.allActions.filter(({action:o})=>!o.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&T.QuickFix.contains(new V(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}}const ms={actions:[],documentation:void 0};async function Bt(r,e,t,i,o,n){var b;const s=i.filter||{},a={...s,excludes:[...s.excludes||[],T.Notebook]},d={only:(b=s.include)==null?void 0:b.value,trigger:i.type},c=new ud(e,n),l=i.type===2,h=ql(r,e,l?a:s),g=new k,f=h.map(async _=>{try{o.report(_);const w=await _.provideCodeActions(e,t,d,c.token);if(w&&g.add(w),c.token.isCancellationRequested)return ms;const C=((w==null?void 0:w.actions)||[]).filter(D=>D&&Kl(s,D)),A=Yl(_,C,s.include);return{actions:C.map(D=>new $l(D,_)),documentation:A}}catch(w){if(Ks(w))throw w;return et(w),ms}}),p=r.onDidChange(()=>{const _=r.all(e);Lo(_,h)||c.cancel()});try{const _=await Promise.all(f),w=_.map(A=>A.actions).flat(),C=[...Mn(_.map(A=>A.documentation)),...Zl(r,e,i,w)];return new ai(w,C,g)}finally{p.dispose(),c.dispose()}}function ql(r,e,t){return r.all(e).filter(i=>i.providedCodeActionKinds?i.providedCodeActionKinds.some(o=>Bl(t,new V(o))):!0)}function*Zl(r,e,t,i){var o,n,s;if(e&&i.length)for(const a of r.all(e))a._getAdditionalMenuItems&&(yield*(s=a._getAdditionalMenuItems)==null?void 0:s.call(a,{trigger:t.type,only:(n=(o=t.filter)==null?void 0:o.include)==null?void 0:n.value},i.map(d=>d.action)))}function Yl(r,e,t){if(!r.documentation)return;const i=r.documentation.map(o=>({kind:new V(o.kind),command:o.command}));if(t){let o;for(const n of i)n.kind.contains(t)&&(o?o.kind.contains(n.kind)&&(o=n):o=n);if(o)return o==null?void 0:o.command}for(const o of e)if(o.kind){for(const n of i)if(n.kind.contains(new V(o.kind)))return n.command}}var at;(function(r){r.OnSave="onSave",r.FromProblemsView="fromProblemsView",r.FromCodeActions="fromCodeActions",r.FromAILightbulb="fromAILightbulb"})(at||(at={}));async function Xl(r,e,t,i,o=L.None){var c;const n=r.get(Zd),s=r.get(Le),a=r.get(In),d=r.get(Xt);if(a.publicLog2("codeAction.applyCodeAction",{codeActionTitle:e.action.title,codeActionKind:e.action.kind,codeActionIsPreferred:!!e.action.isPreferred,reason:t}),await e.resolve(o),!o.isCancellationRequested&&!((c=e.action.edit)!=null&&c.edits.length&&!(await n.apply(e.action.edit,{editor:i==null?void 0:i.editor,label:e.action.title,quotableLabel:e.action.title,code:"undoredo.codeAction",respectAutoSaveConfig:t!==at.OnSave,showPreview:i==null?void 0:i.preview})).isApplied)&&e.action.command)try{await s.executeCommand(e.action.command.id,...e.action.command.arguments||[])}catch(l){const h=Ql(l);d.error(typeof h=="string"?h:u("applyCodeActionFailed","An unknown error occurred while applying the code action"))}}function Ql(r){return typeof r=="string"?r:r instanceof Error&&typeof r.message=="string"?r.message:void 0}Y.registerCommand("_executeCodeActionProvider",async function(r,e,t,i,o){if(!(e instanceof me))throw $t();const{codeActionProvider:n}=r.get(R),s=r.get(Fs).getModel(e);if(!s)throw $t();const a=Oo.isISelection(t)?Oo.liftSelection(t):m.isIRange(t)?s.validateRange(t):void 0;if(!a)throw $t();const d=typeof i=="string"?new V(i):void 0,c=await Bt(n,s,a,{type:1,triggerAction:Xe.Default,filter:{includeSourceActions:!0,include:d}},Ft.None,L.None),l=[],h=Math.min(c.validActions.length,typeof o=="number"?o:0);for(let g=0;g<h;g++)l.push(c.validActions[g].resolve(L.None));try{return await Promise.all(l),c.validActions.map(g=>g.action)}finally{setTimeout(()=>c.dispose(),100)}});var Jl=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},eh=function(r,e){return function(t,i){e(t,i,r)}},an,mt;let dn=(mt=class{constructor(e){this.keybindingService=e}getResolver(){const e=new $s(()=>this.keybindingService.getKeybindings().filter(t=>an.codeActionCommands.indexOf(t.command)>=0).filter(t=>t.resolvedKeybinding).map(t=>{let i=t.commandArgs;return t.command===_s?i={kind:T.SourceOrganizeImports.value}:t.command===ps&&(i={kind:T.SourceFixAll.value}),{resolvedKeybinding:t.resolvedKeybinding,...ot.fromUser(i,{kind:V.None,apply:"never"})}}));return t=>{if(t.kind){const i=this.bestKeybindingForCodeAction(t,e.value);return i==null?void 0:i.resolvedKeybinding}}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;const i=new V(e.kind);return t.filter(o=>o.kind.contains(i)).filter(o=>o.preferred?e.isPreferred:!0).reduceRight((o,n)=>o?o.kind.contains(n.kind)?n:o:n,void 0)}},an=mt,mt.codeActionCommands=[Gl,Ul,jl,_s,ps],mt);dn=an=Jl([eh(0,te)],dn);const Gr=Object.freeze({kind:V.Empty,title:u("codeAction.widget.id.more","More Actions...")}),th=Object.freeze([{kind:T.QuickFix,title:u("codeAction.widget.id.quickfix","Quick Fix")},{kind:T.RefactorExtract,title:u("codeAction.widget.id.extract","Extract"),icon:M.wrench},{kind:T.RefactorInline,title:u("codeAction.widget.id.inline","Inline"),icon:M.wrench},{kind:T.RefactorRewrite,title:u("codeAction.widget.id.convert","Rewrite"),icon:M.wrench},{kind:T.RefactorMove,title:u("codeAction.widget.id.move","Move"),icon:M.wrench},{kind:T.SurroundWith,title:u("codeAction.widget.id.surround","Surround With"),icon:M.surroundWith},{kind:T.Source,title:u("codeAction.widget.id.source","Source Action"),icon:M.symbolFile},Gr]);function ih(r,e,t){if(!e)return r.map(n=>{var s;return{kind:"action",item:n,group:Gr,disabled:!!n.action.disabled,label:n.action.disabled||n.action.title,canPreview:!!((s=n.action.edit)!=null&&s.edits.length)}});const i=th.map(n=>({group:n,actions:[]}));for(const n of r){const s=n.action.kind?new V(n.action.kind):V.None;for(const a of i)if(a.group.kind.contains(s)){a.actions.push(n);break}}const o=[];for(const n of i)if(n.actions.length){o.push({kind:"header",group:n.group});for(const s of n.actions){const a=n.group;o.push({kind:"action",item:s,group:s.action.isAI?{title:a.title,kind:a.kind,icon:M.sparkle}:a,label:s.action.title,disabled:!!s.action.disabled,keybinding:t(s.action)})}}return o}var oh=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},nh=function(r,e){return function(t,i){e(t,i,r)}},Tt;const vs=ue("gutter-lightbulb",M.lightBulb,u("gutterLightbulbWidget","Icon which spawns code actions menu from the gutter when there is no space in the editor.")),bs=ue("gutter-lightbulb-auto-fix",M.lightbulbAutofix,u("gutterLightbulbAutoFixWidget","Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.")),ws=ue("gutter-lightbulb-sparkle",M.lightbulbSparkle,u("gutterLightbulbAIFixWidget","Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.")),Cs=ue("gutter-lightbulb-aifix-auto-fix",M.lightbulbSparkleAutofix,u("gutterLightbulbAIFixAutoFixWidget","Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.")),ys=ue("gutter-lightbulb-sparkle-filled",M.sparkleFilled,u("gutterLightbulbSparkleFilledWidget","Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available."));var fe;(function(r){r.Hidden={type:0};class e{constructor(i,o,n,s){this.actions=i,this.trigger=o,this.editorPosition=n,this.widgetPosition=s,this.type=1}}r.Showing=e})(fe||(fe={}));var Re;let cn=(Re=class extends P{constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new x),this.onClick=this._onClick.event,this._state=fe.Hidden,this._gutterState=fe.Hidden,this._iconClasses=[],this.lightbulbClasses=["codicon-"+vs.id,"codicon-"+Cs.id,"codicon-"+bs.id,"codicon-"+ws.id,"codicon-"+ys.id],this.gutterDecoration=Tt.GUTTER_DECORATION,this._domNode=F("div.lightBulbWidget"),this._domNode.role="listbox",this._register(Ya.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(i=>{const o=this._editor.getModel();(this.state.type!==1||!o||this.state.editorPosition.lineNumber>=o.getLineCount())&&this.hide(),(this.gutterState.type!==1||!o||this.gutterState.editorPosition.lineNumber>=o.getLineCount())&&this.gutterHide()})),this._register(Ca(this._domNode,i=>{if(this.state.type!==1)return;this._editor.focus(),i.preventDefault();const{top:o,height:n}=ve(this._domNode),s=this._editor.getOption(67);let a=Math.floor(s/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(a+=s),this._onClick.fire({x:i.posx,y:o+n+a,actions:this.state.actions,trigger:this.state.trigger})})),this._register($(this._domNode,"mouseenter",i=>{(i.buttons&1)===1&&this.hide()})),this._register(Vi.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{var i,o;this._preferredKbLabel=((i=this._keybindingService.lookupKeybinding(zl))==null?void 0:i.getLabel())??void 0,this._quickFixKbLabel=((o=this._keybindingService.lookupKeybinding(zr))==null?void 0:o.getLabel())??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async i=>{if(!i.target.element||!this.lightbulbClasses.some(d=>i.target.element&&i.target.element.classList.contains(d))||this.gutterState.type!==1)return;this._editor.focus();const{top:o,height:n}=ve(i.target.element),s=this._editor.getOption(67);let a=Math.floor(s/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(a+=s),this._onClick.fire({x:i.event.posx,y:o+n+a,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return"LightBulbWidget"}getDomNode(){return this._domNode}getPosition(){return this._state.type===1?this._state.widgetPosition:null}update(e,t,i){if(e.validActions.length<=0)return this.gutterHide(),this.hide();if(!this._editor.hasTextFocus())return this.gutterHide(),this.hide();if(!this._editor.getOptions().get(65).enabled)return this.gutterHide(),this.hide();const s=this._editor.getModel();if(!s)return this.gutterHide(),this.hide();const{lineNumber:a,column:d}=s.validatePosition(i),c=s.getOptions().tabSize,l=this._editor.getOptions().get(50),h=s.getLineContent(a),g=Id(h,c),f=l.spaceWidth*g>22,p=N=>N>2&&this._editor.getTopForLineNumber(N)===this._editor.getTopForLineNumber(N-1),b=this._editor.getLineDecorations(a);let _=!1;if(b)for(const N of b){const E=N.options.glyphMarginClassName;if(E&&!this.lightbulbClasses.some(z=>E.includes(z))){_=!0;break}}let w=a,C=1;if(!f){const N=E=>{const z=s.getLineContent(E);return/^\s*$|^\s+/.test(z)||z.length<=C};if(a>1&&!p(a-1)){const E=s.getLineCount(),z=a===E,B=a>1&&N(a-1),K=!z&&N(a+1),Qt=N(a),Jt=!K&&!B;if(!K&&!B&&!_)return this.gutterState=new fe.Showing(e,t,i,{position:{lineNumber:w,column:C},preference:Tt._posPref}),this.renderGutterLightbub(),this.hide();B||z||B&&!Qt?w-=1:(K||Jt&&Qt)&&(w+=1)}else if(a===1&&(a===s.getLineCount()||!N(a+1)&&!N(a)))if(this.gutterState=new fe.Showing(e,t,i,{position:{lineNumber:w,column:C},preference:Tt._posPref}),_)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(a<s.getLineCount()&&!p(a+1))w+=1;else if(d*l.spaceWidth<22)return this.hide();C=/^\S\s*$/.test(s.getLineContent(w))?2:1}this.state=new fe.Showing(e,t,i,{position:{lineNumber:w,column:C},preference:Tt._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());const A=e.validActions,D=e.validActions[0].action.kind;if(A.length!==1||!D){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==fe.Hidden&&(this.state=fe.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==fe.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=fe.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==1)return;let e,t=!1;this.state.actions.allAIFixes?(e=M.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):this.state.actions.hasAutoFix?this.state.actions.hasAIFix?e=M.lightbulbSparkleAutofix:e=M.lightbulbAutofix:this.state.actions.hasAIFix?e=M.lightbulbSparkle:e=M.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=oe.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==1)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=ys,this.gutterState.actions.validActions.length===1&&(t=!0)):this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?e=Cs:e=bs:this.gutterState.actions.hasAIFix?e=ws:e=vs,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t);const i=Ct.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:oe.asClassName(e),glyphMargin:{position:$i.Left},stickiness:1});this.gutterDecoration=i}renderGutterLightbub(){const e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new m(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(i=>{i.changeDecoration(e,new m(t,0,t,0)),i.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===1&&(t?this.title=u("codeActionAutoRun","Run: {0}",this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=u("preferredcodeActionWithKb","Show Code Actions. Preferred Quick Fix Available ({0})",this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=u("codeActionWithKb","Show Code Actions ({0})",this._quickFixKbLabel):e||(this.title=u("codeAction","Show Code Actions")))}set title(e){this._domNode.title=e}},Tt=Re,Re.GUTTER_DECORATION=Ct.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:oe.asClassName(M.lightBulb),glyphMargin:{position:$i.Left},stickiness:1}),Re.ID="editor.contrib.lightbulbWidget",Re._posPref=[0],Re);cn=Tt=oh([nh(1,te)],cn);var jr=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},ln=function(r,e){return function(t,i){e(t,i,r)}};const qr="acceptSelectedCodeAction",Zr="previewSelectedCodeAction";class sh{get templateId(){return"header"}renderTemplate(e){e.classList.add("group-header");const t=document.createElement("span");return e.append(t),{container:e,text:t}}renderElement(e,t,i){var o;i.text.textContent=((o=e.group)==null?void 0:o.title)??""}disposeTemplate(e){}}let hn=class{get templateId(){return"action"}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);const t=document.createElement("div");t.className="icon",e.append(t);const i=document.createElement("span");i.className="title",e.append(i);const o=new hr(e,Es);return{container:e,icon:t,text:i,keybinding:o}}renderElement(e,t,i){var s,a,d;if((s=e.group)!=null&&s.icon?(i.icon.className=oe.asClassName(e.group.icon),e.group.icon.color&&(i.icon.style.color=Xa(e.group.icon.color.id))):(i.icon.className=oe.asClassName(M.lightBulb),i.icon.style.color="var(--vscode-editorLightBulb-foreground)"),!e.item||!e.label)return;i.text.textContent=Yr(e.label),i.keybinding.set(e.keybinding),ya(!!e.keybinding,i.keybinding.element);const o=(a=this._keybindingService.lookupKeybinding(qr))==null?void 0:a.getLabel(),n=(d=this._keybindingService.lookupKeybinding(Zr))==null?void 0:d.getLabel();i.container.classList.toggle("option-disabled",e.disabled),e.disabled?i.container.title=e.label:o&&n?this._supportsPreview&&e.canPreview?i.container.title=u({key:"label-preview",comment:['placeholders are keybindings, e.g "F2 to Apply, Shift+F2 to Preview"']},"{0} to Apply, {1} to Preview",o,n):i.container.title=u({key:"label",comment:['placeholder is a keybinding, e.g "F2 to Apply"']},"{0} to Apply",o):i.container.title=""}disposeTemplate(e){e.keybinding.dispose()}};hn=jr([ln(1,te)],hn);class rh extends UIEvent{constructor(){super("acceptSelectedAction")}}class Ss extends UIEvent{constructor(){super("previewSelectedAction")}}function ah(r){if(r.kind==="action")return r.label}let un=class extends P{constructor(e,t,i,o,n,s){super(),this._delegate=o,this._contextViewService=n,this._keybindingService=s,this._actionLineHeight=24,this._headerLineHeight=26,this.cts=this._register(new Ki),this.domNode=document.createElement("div"),this.domNode.classList.add("actionList");const a={getHeight:d=>d.kind==="header"?this._headerLineHeight:this._actionLineHeight,getTemplateId:d=>d.kind};this._list=this._register(new Ad(e,this.domNode,a,[new hn(t,this._keybindingService),new sh],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:ah},accessibilityProvider:{getAriaLabel:d=>{if(d.kind==="action"){let c=d.label?Yr(d==null?void 0:d.label):"";return d.disabled&&(c=u({key:"customQuickFixWidget.labels",comment:["Action widget labels for accessibility."]},"{0}, Disabled Reason: {1}",c,d.disabled)),c}return null},getWidgetAriaLabel:()=>u({key:"customQuickFixWidget",comment:["An action widget option"]},"Action Widget"),getRole:d=>d.kind==="action"?"option":"separator",getWidgetRole:()=>"listbox"}})),this._list.style(xd),this._register(this._list.onMouseClick(d=>this.onListClick(d))),this._register(this._list.onMouseOver(d=>this.onListHover(d))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(d=>this.onListSelection(d))),this._allMenuItems=i,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind==="action"}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){const t=this._allMenuItems.filter(d=>d.kind==="header").length,o=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight;this._list.layout(o);let n=e;if(this._allMenuItems.length>=50)n=380;else{const d=this._allMenuItems.map((c,l)=>{const h=this.domNode.ownerDocument.getElementById(this._list.getElementID(l));if(h){h.style.width="auto";const g=h.getBoundingClientRect().width;return h.style.width="",g}return 0});n=Math.max(...d,e)}const a=Math.min(o,this.domNode.ownerDocument.body.clientHeight*.7);return this._list.layout(a,n),this.domNode.style.height=`${a}px`,this._list.domFocus(),n}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){const t=this._list.getFocus();if(t.length===0)return;const i=t[0],o=this._list.element(i);if(!this.focusCondition(o))return;const n=e?new Ss:new rh;this._list.setSelection([i],n)}onListSelection(e){if(!e.elements.length)return;const t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof Ss):this._list.setSelection([])}onFocus(){var o,n;const e=this._list.getFocus();if(e.length===0)return;const t=e[0],i=this._list.element(t);(n=(o=this._delegate).onFocus)==null||n.call(o,i.item)}async onListHover(e){const t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind==="action"){const i=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=i?i.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index=="number"?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};un=jr([ln(4,nr),ln(5,te)],un);function Yr(r){return r.replace(/\r\n|\r|\n/g," ")}var dh=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Ao=function(r,e){return function(t,i){e(t,i,r)}};O("actionBar.toggledBackground",Qa,u("actionBar.toggledBackground","Background color for toggled action items in action bar."));const yt={Visible:new kt("codeActionMenuVisible",!1,u("codeActionMenuVisible","Whether the action widget list is visible"))},Ht=pi("actionWidgetService");let St=class extends P{get isVisible(){return yt.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,i){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=i,this._list=this._register(new co)}show(e,t,i,o,n,s,a){const d=yt.Visible.bindTo(this._contextKeyService),c=this._instantiationService.createInstance(un,e,t,i,o);this._contextViewService.showContextView({getAnchor:()=>n,render:l=>(d.set(!0),this._renderWidget(l,c,a??[])),onHide:l=>{d.reset(),this._onWidgetClosed(l)}},s,!1)}acceptSelected(e){var t;(t=this._list.value)==null||t.acceptSelected(e)}focusPrevious(){var e,t;(t=(e=this._list)==null?void 0:e.value)==null||t.focusPrevious()}focusNext(){var e,t;(t=(e=this._list)==null?void 0:e.value)==null||t.focusNext()}hide(e){var t;(t=this._list.value)==null||t.hide(e),this._list.clear()}_renderWidget(e,t,i){var f;const o=document.createElement("div");if(o.classList.add("action-widget"),e.appendChild(o),this._list.value=t,this._list.value)o.appendChild(this._list.value.domNode);else throw new Error("List has no value");const n=new k,s=document.createElement("div"),a=e.appendChild(s);a.classList.add("context-view-block"),n.add($(a,J.MOUSE_DOWN,p=>p.stopPropagation()));const d=document.createElement("div"),c=e.appendChild(d);c.classList.add("context-view-pointerBlock"),n.add($(c,J.POINTER_MOVE,()=>c.remove())),n.add($(c,J.MOUSE_DOWN,()=>c.remove()));let l=0;if(i.length){const p=this._createActionBar(".action-widget-action-bar",i);p&&(o.appendChild(p.getContainer().parentElement),n.add(p),l=p.getContainer().offsetWidth)}const h=(f=this._list.value)==null?void 0:f.layout(l);o.style.width=`${h}px`;const g=n.add(Ts(e));return n.add(g.onDidBlur(()=>this.hide(!0))),n}_createActionBar(e,t){if(!t.length)return;const i=F(e),o=new Js(i);return o.push(t,{icon:!1,label:!0}),o}_onWidgetClosed(e){var t;(t=this._list.value)==null||t.hide(e)}};St=dh([Ao(0,nr),Ao(1,re),Ao(2,U)],St);vi(Ht,St,1);const yi=1100;X(class extends mi{constructor(){super({id:"hideCodeActionWidget",title:I("hideCodeActionWidget.title","Hide action widget"),precondition:yt.Visible,keybinding:{weight:yi,primary:9,secondary:[1033]}})}run(r){r.get(Ht).hide(!0)}});X(class extends mi{constructor(){super({id:"selectPrevCodeAction",title:I("selectPrevCodeAction.title","Select previous action"),precondition:yt.Visible,keybinding:{weight:yi,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})}run(r){const e=r.get(Ht);e instanceof St&&e.focusPrevious()}});X(class extends mi{constructor(){super({id:"selectNextCodeAction",title:I("selectNextCodeAction.title","Select next action"),precondition:yt.Visible,keybinding:{weight:yi,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})}run(r){const e=r.get(Ht);e instanceof St&&e.focusNext()}});X(class extends mi{constructor(){super({id:qr,title:I("acceptSelected.title","Accept selected action"),precondition:yt.Visible,keybinding:{weight:yi,primary:3,secondary:[2137]}})}run(r){const e=r.get(Ht);e instanceof St&&e.acceptSelected()}});X(class extends mi{constructor(){super({id:Zr,title:I("previewSelected.title","Preview selected action"),precondition:yt.Visible,keybinding:{weight:yi,primary:2051}})}run(r){const e=r.get(Ht);e instanceof St&&e.acceptSelected(!0)}});const ch=new kt("supportedCodeAction",""),Ds="_typescript.applyFixAllCodeAction";class lh extends P{constructor(e,t,i,o=250){super(),this._editor=e,this._markerService=t,this._signalChange=i,this._delay=o,this._autoTriggerTimer=this._register(new Vs),this._register(this._markerService.onMarkerChanged(n=>this._onMarkerChanges(n))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){const t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){const t=this._editor.getModel();t&&e.some(i=>js(i,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:2,triggerAction:Xe.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;const t=this._editor.getSelection();if(e.type===1)return t;const i=this._editor.getOption(65).enabled;if(i!==Do.Off){{if(i===Do.On)return t;if(i===Do.OnCode){if(!t.isEmpty())return t;const n=this._editor.getModel(),{lineNumber:s,column:a}=t.getPosition(),d=n.getLineContent(s);if(d.length===0)return;if(a===1){if(/\s/.test(d[0]))return}else if(a===n.getLineMaxColumn(s)){if(/\s/.test(d[d.length-1]))return}else if(/\s/.test(d[a-2])&&/\s/.test(d[a-1]))return}}return t}}}var nt;(function(r){r.Empty={type:0};class e{constructor(i,o,n){this.trigger=i,this.position=o,this._cancellablePromise=n,this.type=1,this.actions=n.catch(s=>{if(Ks(s))return Xr;throw s})}cancel(){this._cancellablePromise.cancel()}}r.Triggered=e})(nt||(nt={}));const Xr=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1});class hh extends P{constructor(e,t,i,o,n,s,a){super(),this._editor=e,this._registry=t,this._markerService=i,this._progressService=n,this._configurationService=s,this._telemetryService=a,this._codeActionOracle=this._register(new co),this._state=nt.Empty,this._onDidChangeState=this._register(new x),this.onDidChangeState=this._onDidChangeState.event,this._disposed=!1,this._supportedCodeActions=ch.bindTo(o),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(d=>{d.hasChanged(65)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(nt.Empty,!0))}_settingEnabledNearbyQuickfixes(){var t;const e=(t=this._editor)==null?void 0:t.getModel();return this._configurationService?this._configurationService.getValue("editor.codeActionWidget.includeNearbyQuickFixes",{resource:e==null?void 0:e.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(nt.Empty);const e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(92)){const t=this._registry.all(e).flatMap(i=>i.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(" ")),this._codeActionOracle.value=new lh(this._editor,this._markerService,i=>{var d;if(!i){this.setState(nt.Empty);return}const o=i.selection.getStartPosition(),n=It(async c=>{var l,h,g,f,p,b,_,w,C,A;if(this._settingEnabledNearbyQuickfixes()&&i.trigger.type===1&&(i.trigger.triggerAction===Xe.QuickFix||(h=(l=i.trigger.filter)==null?void 0:l.include)!=null&&h.contains(T.QuickFix))){const D=await Bt(this._registry,e,i.selection,i.trigger,Ft.None,c),N=[...D.allActions];if(c.isCancellationRequested)return Xr;const E=(g=D.validActions)==null?void 0:g.some(B=>B.action.kind?T.QuickFix.contains(new V(B.action.kind)):!1),z=this._markerService.read({resource:e.uri});if(E){for(const B of D.validActions)(p=(f=B.action.command)==null?void 0:f.arguments)!=null&&p.some(K=>typeof K=="string"&&K.includes(Ds))&&(B.action.diagnostics=[...z.filter(K=>K.relatedInformation)]);return{validActions:D.validActions,allActions:N,documentation:D.documentation,hasAutoFix:D.hasAutoFix,hasAIFix:D.hasAIFix,allAIFixes:D.allAIFixes,dispose:()=>{D.dispose()}}}else if(!E&&z.length>0){const B=i.selection.getPosition();let K=B,Qt=Number.MAX_VALUE;const Jt=[...D.validActions];for(const be of z){const we=be.endColumn,Si=be.endLineNumber,yo=be.startLineNumber;if(Si===B.lineNumber||yo===B.lineNumber){K=new q(Si,we);const ta={type:i.trigger.type,triggerAction:i.trigger.triggerAction,filter:{include:(b=i.trigger.filter)!=null&&b.include?(_=i.trigger.filter)==null?void 0:_.include:T.QuickFix},autoApply:i.trigger.autoApply,context:{notAvailableMessage:((w=i.trigger.context)==null?void 0:w.notAvailableMessage)||"",position:K}},ia=new Oo(K.lineNumber,K.column,K.lineNumber,K.column),ei=await Bt(this._registry,e,ia,ta,Ft.None,c);if(ei.validActions.length!==0){for(const Gn of ei.validActions)(A=(C=Gn.action.command)==null?void 0:C.arguments)!=null&&A.some(Di=>typeof Di=="string"&&Di.includes(Ds))&&(Gn.action.diagnostics=[...z.filter(Di=>Di.relatedInformation)]);D.allActions.length===0&&N.push(...ei.allActions),Math.abs(B.column-we)<Qt?Jt.unshift(...ei.validActions):Jt.push(...ei.validActions)}Qt=Math.abs(B.column-we)}}const zn=Jt.filter((be,we,Si)=>Si.findIndex(yo=>yo.action.title===be.action.title)===we);return zn.sort((be,we)=>be.action.isPreferred&&!we.action.isPreferred?-1:!be.action.isPreferred&&we.action.isPreferred||be.action.isAI&&!we.action.isAI?1:!be.action.isAI&&we.action.isAI?-1:0),{validActions:zn,allActions:N,documentation:D.documentation,hasAutoFix:D.hasAutoFix,hasAIFix:D.hasAIFix,allAIFixes:D.allAIFixes,dispose:()=>{D.dispose()}}}}if(i.trigger.type===1){const D=new Bs,N=await Bt(this._registry,e,i.selection,i.trigger,Ft.None,c);return this._telemetryService&&this._telemetryService.publicLog2("codeAction.invokedDurations",{codeActions:N.validActions.length,duration:D.elapsed()}),N}return Bt(this._registry,e,i.selection,i.trigger,Ft.None,c)});i.trigger.type===1&&((d=this._progressService)==null||d.showWhile(n,250));const s=new nt.Triggered(i.trigger,o,n);let a=!1;this._state.type===1&&(a=this._state.trigger.type===1&&s.type===1&&s.trigger.type===2&&this._state.position!==s.position),a?setTimeout(()=>{this.setState(s)},500):this.setState(s)},void 0),this._codeActionOracle.value.trigger({type:2,triggerAction:Xe.Default})}else this._supportedCodeActions.reset()}trigger(e){var t;(t=this._codeActionOracle.value)==null||t.trigger(e)}setState(e,t){e!==this._state&&(this._state.type===1&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}}var uh=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Ce=function(r,e){return function(t,i){e(t,i,r)}},Wt;const gh="quickfix-edit-highlight";var je;let gn=(je=class extends P{static get(e){return e.getContribution(Wt.ID)}constructor(e,t,i,o,n,s,a,d,c,l,h){super(),this._commandService=a,this._configurationService=d,this._actionWidgetService=c,this._instantiationService=l,this._telemetryService=h,this._activeCodeActions=this._register(new co),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new hh(this._editor,n.codeActionProvider,t,i,s,d,this._telemetryService)),this._register(this._model.onDidChangeState(g=>this.update(g))),this._lightBulbWidget=new $s(()=>{const g=this._editor.getContribution(cn.ID);return g&&this._register(g.onClick(f=>this.showCodeActionsFromLightbulb(f.actions,f))),g}),this._resolver=o.createInstance(dn),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){const i=e.validActions[0],o=i.action.command;o&&o.id==="inlineChat.start"&&o.arguments&&o.arguments.length>=1&&(o.arguments[0]={...o.arguments[0],autoSend:!1}),await this._applyCodeAction(i,!1,!1,at.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,i){return this.showCodeActionList(t,i,{includeDisabledActions:!1,fromLightbulb:!1})}manualTriggerAtCurrentPosition(e,t,i,o){var s;if(!this._editor.hasModel())return;(s=ke.get(this._editor))==null||s.closeMessage();const n=this._editor.getPosition();this._trigger({type:1,triggerAction:t,filter:i,autoApply:o,context:{notAvailableMessage:e,position:n}})}_trigger(e){return this._model.trigger(e)}async _applyCodeAction(e,t,i,o){try{await this._instantiationService.invokeFunction(Xl,e,o,{preview:i,editor:this._editor})}finally{t&&this._trigger({type:2,triggerAction:Xe.QuickFix,filter:{}})}}hideLightBulbWidget(){var e,t;(e=this._lightBulbWidget.rawValue)==null||e.hide(),(t=this._lightBulbWidget.rawValue)==null||t.gutterHide()}async update(e){var o,n,s,a,d;if(e.type!==1){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(c){Me(c);return}if(this._disposed)return;const i=this._editor.getSelection();if((i==null?void 0:i.startLineNumber)===e.position.lineNumber)if((o=this._lightBulbWidget.value)==null||o.update(t,e.trigger,e.position),e.trigger.type===1){if((n=e.trigger.filter)!=null&&n.include){const l=this.tryGetValidActionToApply(e.trigger,t);if(l){try{this.hideLightBulbWidget(),await this._applyCodeAction(l,!1,!1,at.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){const h=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(h&&h.action.disabled){(s=ke.get(this._editor))==null||s.showMessage(h.action.disabled,e.trigger.context.position),t.dispose();return}}}const c=!!((a=e.trigger.filter)!=null&&a.include);if(e.trigger.context&&(!t.allActions.length||!c&&!t.validActions.length)){(d=ke.get(this._editor))==null||d.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:c,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply==="first"&&t.validActions.length===0||e.autoApply==="ifSingle"&&t.allActions.length===1))return t.allActions.find(({action:i})=>i.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply==="first"&&t.validActions.length>0||e.autoApply==="ifSingle"&&t.validActions.length===1))return t.validActions[0]}async showCodeActionList(e,t,i){const o=this._editor.createDecorationsCollection(),n=this._editor.getDomNode();if(!n)return;const s=i.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!s.length)return;const a=q.isIPosition(t)?this.toCoords(t):t,d={onSelect:async(c,l)=>{this._applyCodeAction(c,!0,!!l,i.fromLightbulb?at.FromAILightbulb:at.FromCodeActions),this._actionWidgetService.hide(!1),o.clear()},onHide:c=>{var l;(l=this._editor)==null||l.focus(),o.clear()},onHover:async(c,l)=>{var f;if(l.isCancellationRequested)return;let h=!1;const g=c.action.kind;if(g){const p=new V(g);h=[T.RefactorExtract,T.RefactorInline,T.RefactorRewrite,T.RefactorMove,T.Source].some(_=>_.contains(p))}return{canPreview:h||!!((f=c.action.edit)!=null&&f.edits.length)}},onFocus:c=>{var l,h;if(c&&c.action){const g=c.action.ranges,f=c.action.diagnostics;if(o.clear(),g&&g.length>0){const p=f&&(f==null?void 0:f.length)>1?f.map(b=>({range:b,options:Wt.DECORATION})):g.map(b=>({range:b,options:Wt.DECORATION}));o.set(p)}else if(f&&f.length>0){const p=f.map(_=>({range:_,options:Wt.DECORATION}));o.set(p);const b=f[0];if(b.startLineNumber&&b.startColumn){const _=(h=(l=this._editor.getModel())==null?void 0:l.getWordAtPosition({lineNumber:b.startLineNumber,column:b.startColumn}))==null?void 0:h.word;Ja(u("editingNewSelection","Context: {0} at line {1} and column {2}.",_,b.startLineNumber,b.startColumn))}}}else o.clear()}};this._actionWidgetService.show("codeActionWidget",!0,ih(s,this._shouldShowHeaders(),this._resolver.getResolver()),d,a,n,this._getActionBarActions(e,t,i))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,1),this._editor.render();const t=this._editor.getScrolledVisiblePosition(e),i=ve(this._editor.getDomNode()),o=i.left+t.left,n=i.top+t.top+t.height;return{x:o,y:n}}_shouldShowHeaders(){var t;const e=(t=this._editor)==null?void 0:t.getModel();return this._configurationService.getValue("editor.codeActionWidget.showHeaders",{resource:e==null?void 0:e.uri})}_getActionBarActions(e,t,i){if(i.fromLightbulb)return[];const o=e.documentation.map(n=>({id:n.id,label:n.title,tooltip:n.tooltip??"",class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(n.id,...n.arguments??[])}));return i.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&o.push(this._showDisabled?{id:"hideMoreActions",label:u("hideMoreActions","Hide Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,i))}:{id:"showMoreActions",label:u("showMoreActions","Show Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,i))}),o}},Wt=je,je.ID="editor.contrib.codeActionController",je.DECORATION=Ct.register({description:"quickfix-highlight",className:gh}),je);gn=Wt=uh([Ce(1,Nn),Ce(2,re),Ce(3,U),Ce(4,R),Ce(5,Xs),Ce(6,Le),Ce(7,Ee),Ce(8,Ht),Ce(9,U),Ce(10,In)],gn);sr((r,e)=>{((o,n)=>{n&&e.addRule(`.monaco-editor ${o} { background-color: ${n}; }`)})(".quickfix-edit-highlight",r.getColor(ed));const i=r.getColor(td);i&&e.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${Hd(r.type)?"dotted":"solid"} ${i}; box-sizing: border-box; }`)});var Qr=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},to=function(r,e){return function(t,i){e(t,i,r)}};class ks{constructor(e,t,i){this.marker=e,this.index=t,this.total=i}}let fn=class{constructor(e,t,i){this._markerService=t,this._configService=i,this._onDidChange=new x,this.onDidChange=this._onDidChange.event,this._dispoables=new k,this._markers=[],this._nextIdx=-1,me.isUri(e)?this._resourceFilter=a=>a.toString()===e.toString():e&&(this._resourceFilter=e);const o=this._configService.getValue("problems.sortOrder"),n=(a,d)=>{let c=Zn(a.resource.toString(),d.resource.toString());return c===0&&(o==="position"?c=m.compareRangesUsingStarts(a,d)||G.compare(a.severity,d.severity):c=G.compare(a.severity,d.severity)||m.compareRangesUsingStarts(a,d)),c},s=()=>{this._markers=this._markerService.read({resource:me.isUri(e)?e:void 0,severities:G.Error|G.Warning|G.Info}),typeof e=="function"&&(this._markers=this._markers.filter(a=>this._resourceFilter(a.resource))),this._markers.sort(n)};s(),this._dispoables.add(t.onMarkerChanged(a=>{(!this._resourceFilter||a.some(d=>this._resourceFilter(d)))&&(s(),this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){const e=this._markers[this._nextIdx];return e&&new ks(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,i){let o=!1,n=this._markers.findIndex(s=>s.resource.toString()===e.uri.toString());n<0&&(n=Sa(this._markers,{resource:e.uri},(s,a)=>Zn(s.resource.toString(),a.resource.toString())),n<0&&(n=~n));for(let s=n;s<this._markers.length;s++){let a=m.lift(this._markers[s]);if(a.isEmpty()){const d=e.getWordAtPosition(a.getStartPosition());d&&(a=new m(a.startLineNumber,d.startColumn,a.startLineNumber,d.endColumn))}if(t&&(a.containsPosition(t)||t.isBeforeOrEqual(a.getStartPosition()))){this._nextIdx=s,o=!0;break}if(this._markers[s].resource.toString()!==e.uri.toString())break}o||(this._nextIdx=i?0:this._markers.length-1),this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,i){if(this._markers.length===0)return!1;const o=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,i,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),o!==this._nextIdx}find(e,t){let i=this._markers.findIndex(o=>o.resource.toString()===e.toString());if(!(i<0)){for(;i<this._markers.length;i++)if(m.containsPosition(this._markers[i],t))return new ks(this._markers[i],i+1,this._markers.length)}}};fn=Qr([to(1,Nn),to(2,Ee)],fn);const Jr=pi("IMarkerNavigationService");let _n=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new Da}getMarkerList(e){for(const t of this._provider){const i=t.getMarkerList(e);if(i)return i}return new fn(e,this._markerService,this._configService)}};_n=Qr([to(0,Nn),to(1,Ee)],_n);vi(Jr,_n,1);var pn;(function(r){function e(t){switch(t){case Pi.Ignore:return"severity-ignore "+oe.asClassName(M.info);case Pi.Info:return oe.asClassName(M.info);case Pi.Warning:return oe.asClassName(M.warning);case Pi.Error:return oe.asClassName(M.error);default:return""}}r.className=e})(pn||(pn={}));var fh=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Et=function(r,e){return function(t,i){e(t,i,r)}},mn;class _h{constructor(e,t,i,o,n){this._openerService=o,this._labelService=n,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new k,this._editor=t;const s=document.createElement("div");s.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),s.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),s.appendChild(this._relatedBlock),this._disposables.add(Gt(this._relatedBlock,"click",a=>{a.preventDefault();const d=this._relatedDiagnostics.get(a.target);d&&i(d)})),this._scrollable=new od(s,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(a=>{s.style.left=`-${a.scrollLeft}px`,s.style.top=`-${a.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){Ae(this._disposables)}update(e){const{source:t,message:i,relatedInformation:o,code:n}=e;let s=((t==null?void 0:t.length)||0)+2;n&&(typeof n=="string"?s+=n.length:s+=n.value.length);const a=ka(i);this._lines=a.length,this._longestLineLength=0;for(const g of a)this._longestLineLength=Math.max(g.length+s,this._longestLineLength);Ho(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let d=this._messageBlock;for(const g of a)d=document.createElement("div"),d.innerText=g,g===""&&(d.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(d);if(t||n){const g=document.createElement("span");if(g.classList.add("details"),d.appendChild(g),t){const f=document.createElement("span");f.innerText=t,f.classList.add("source"),g.appendChild(f)}if(n)if(typeof n=="string"){const f=document.createElement("span");f.innerText=`(${n})`,f.classList.add("code"),g.appendChild(f)}else{this._codeLink=F("a.code-link"),this._codeLink.setAttribute("href",`${n.target.toString()}`),this._codeLink.onclick=p=>{this._openerService.open(n.target,{allowCommands:!0}),p.preventDefault(),p.stopPropagation()};const f=y(this._codeLink,F("span"));f.innerText=n.value,g.appendChild(this._codeLink)}}if(Ho(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),We(o)){const g=this._relatedBlock.appendChild(document.createElement("div"));g.style.paddingTop=`${Math.floor(this._editor.getOption(67)*.66)}px`,this._lines+=1;for(const f of o){const p=document.createElement("div"),b=document.createElement("a");b.classList.add("filename"),b.innerText=`${this._labelService.getUriBasenameLabel(f.resource)}(${f.startLineNumber}, ${f.startColumn}): `,b.title=this._labelService.getUriLabel(f.resource),this._relatedDiagnostics.set(b,f);const _=document.createElement("span");_.innerText=f.message,p.appendChild(b),p.appendChild(_),this._lines+=1,g.appendChild(p)}}const c=this._editor.getOption(50),l=Math.ceil(c.typicalFullwidthCharacterWidth*this._longestLineLength*.75),h=c.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:h})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t="";switch(e.severity){case G.Error:t=u("Error","Error");break;case G.Warning:t=u("Warning","Warning");break;case G.Info:t=u("Info","Info");break;case G.Hint:t=u("Hint","Hint");break}let i=u("marker aria","{0} at {1}. ",t,e.startLineNumber+":"+e.startColumn);const o=this._editor.getModel();return o&&e.startLineNumber<=o.getLineCount()&&e.startLineNumber>=1&&(i=`${o.getLineContent(e.startLineNumber)}, ${i}`),i}}var vt;let _i=(vt=class extends zi{constructor(e,t,i,o,n,s,a){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},n),this._themeService=t,this._openerService=i,this._menuService=o,this._contextKeyService=s,this._labelService=a,this._callOnDispose=new k,this._onDidSelectRelatedInformation=new x,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=G.Warning,this._backgroundColor=S.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(bh);let t=vn,i=ph;this._severity===G.Warning?(t=Wi,i=mh):this._severity===G.Info&&(t=bn,i=vh);const o=e.getColor(t),n=e.getColor(i);this.style({arrowColor:o,frameColor:o,headerBackgroundColor:n,primaryHeadingColor:e.getColor(wr),secondaryHeadingColor:e.getColor(Cr)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(o=>this.editor.focus()));const t=[],i=this._menuService.getMenuActions(mn.TitleMenu,this._contextKeyService);er(i,t),this._actionbarWidget.push(t,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=y(e,F(""))}_fillBody(e){this._parentContainer=e,e.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),e.appendChild(this._container),this._message=new _h(this._container,this.editor,t=>this._onDidSelectRelatedInformation.fire(t),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(e,t,i){this._container.classList.remove("stale"),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());const o=m.lift(e),n=this.editor.getPosition(),s=n&&o.containsPosition(n)?n:o.getStartPosition();super.show(s,this.computeRequiredHeight());const a=this.editor.getModel();if(a){const d=i>1?u("problems","{0} of {1} problems",t,i):u("change","{0} of {1} problem",t,i);this.setTitle(Ze(a.uri),d)}this._icon.className=`codicon ${pn.className(G.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(s,0),this.editor.focus()}updateMarker(e){this._container.classList.remove("stale"),this._message.update(e)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}},mn=vt,vt.TitleMenu=new H("gotoErrorTitleMenu"),vt);_i=mn=fh([Et(1,uo),Et(2,Yt),Et(3,Pn),Et(4,U),Et(5,re),Et(6,xn)],_i);const Ms=An(sd,nd),Ps=An(ad,rd),Is=An(Eo,dd),vn=O("editorMarkerNavigationError.background",{dark:Ms,light:Ms,hcDark:qe,hcLight:qe},u("editorMarkerNavigationError","Editor marker navigation widget error color.")),ph=O("editorMarkerNavigationError.headerBackground",{dark:dt(vn,.1),light:dt(vn,.1),hcDark:null,hcLight:null},u("editorMarkerNavigationErrorHeaderBackground","Editor marker navigation widget error heading background.")),Wi=O("editorMarkerNavigationWarning.background",{dark:Ps,light:Ps,hcDark:qe,hcLight:qe},u("editorMarkerNavigationWarning","Editor marker navigation widget warning color.")),mh=O("editorMarkerNavigationWarning.headerBackground",{dark:dt(Wi,.1),light:dt(Wi,.1),hcDark:"#0C141F",hcLight:dt(Wi,.2)},u("editorMarkerNavigationWarningBackground","Editor marker navigation widget warning heading background.")),bn=O("editorMarkerNavigationInfo.background",{dark:Is,light:Is,hcDark:qe,hcLight:qe},u("editorMarkerNavigationInfo","Editor marker navigation widget info color.")),vh=O("editorMarkerNavigationInfo.headerBackground",{dark:dt(bn,.1),light:dt(bn,.1),hcDark:null,hcLight:null},u("editorMarkerNavigationInfoHeaderBackground","Editor marker navigation widget info heading background.")),bh=O("editorMarkerNavigation.background",id,u("editorMarkerNavigationBackground","Editor marker navigation widget background."));var wh=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Hi=function(r,e){return function(t,i){e(t,i,r)}},ni,bt;let Dt=(bt=class{static get(e){return e.getContribution(ni.ID)}constructor(e,t,i,o,n){this._markerNavigationService=t,this._contextKeyService=i,this._editorService=o,this._instantiationService=n,this._sessionDispoables=new k,this._editor=e,this._widgetVisible=ea.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(_i,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(i=>{var o,n,s;(!((o=this._model)!=null&&o.selected)||!m.containsPosition((n=this._model)==null?void 0:n.selected.marker,i.position))&&((s=this._model)==null||s.resetIndex())})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;const i=this._model.find(this._editor.getModel().uri,this._widget.position);i?this._widget.updateMarker(i.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(i=>{this._editorService.openCodeEditor({resource:i.resource,options:{pinned:!0,revealIfOpened:!0,selection:m.lift(i).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(this._editor.hasModel()){const t=this._getOrCreateModel(this._editor.getModel().uri);t.resetIndex(),t.move(!0,this._editor.getModel(),new q(e.startLineNumber,e.startColumn)),t.selected&&this._widget.showAtMarker(t.selected.marker,t.selected.index,t.selected.total)}}async nagivate(e,t){var i,o;if(this._editor.hasModel()){const n=this._getOrCreateModel(t?void 0:this._editor.getModel().uri);if(n.move(e,this._editor.getModel(),this._editor.getPosition()),!n.selected)return;if(n.selected.marker.resource.toString()!==this._editor.getModel().uri.toString()){this._cleanUp();const s=await this._editorService.openCodeEditor({resource:n.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:n.selected.marker}},this._editor);s&&((i=ni.get(s))==null||i.close(),(o=ni.get(s))==null||o.nagivate(e,t))}else this._widget.showAtMarker(n.selected.marker,n.selected.index,n.selected.total)}}},ni=bt,bt.ID="editor.contrib.markerController",bt);Dt=ni=wh([Hi(1,Jr),Hi(2,re),Hi(3,Qe),Hi(4,U)],Dt);class Co extends ae{constructor(e,t,i){super(i),this._next=e,this._multiFile=t}async run(e,t){var i;t.hasModel()&&((i=Dt.get(t))==null||i.nagivate(this._next,this._multiFile))}}const st=class st extends Co{constructor(){super(!0,!1,{id:st.ID,label:st.LABEL,alias:"Go to Next Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:v.focus,primary:578,weight:100},menuOpts:{menuId:_i.TitleMenu,title:st.LABEL,icon:ue("marker-navigation-next",M.arrowDown,u("nextMarkerIcon","Icon for goto next marker.")),group:"navigation",order:1}})}};st.ID="editor.action.marker.next",st.LABEL=u("markerAction.next.label","Go to Next Problem (Error, Warning, Info)");let io=st;const rt=class rt extends Co{constructor(){super(!1,!1,{id:rt.ID,label:rt.LABEL,alias:"Go to Previous Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:v.focus,primary:1602,weight:100},menuOpts:{menuId:_i.TitleMenu,title:rt.LABEL,icon:ue("marker-navigation-previous",M.arrowUp,u("previousMarkerIcon","Icon for goto previous marker.")),group:"navigation",order:2}})}};rt.ID="editor.action.marker.prev",rt.LABEL=u("markerAction.previous.label","Go to Previous Problem (Error, Warning, Info)");let wn=rt;class Ch extends Co{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:u("markerAction.nextInFiles.label","Go to Next Problem in Files (Error, Warning, Info)"),alias:"Go to Next Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:v.focus,primary:66,weight:100},menuOpts:{menuId:H.MenubarGoMenu,title:u({key:"miGotoNextProblem",comment:["&& denotes a mnemonic"]},"Next &&Problem"),group:"6_problem_nav",order:1}})}}class yh extends Co{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:u("markerAction.previousInFiles.label","Go to Previous Problem in Files (Error, Warning, Info)"),alias:"Go to Previous Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:v.focus,primary:1090,weight:100},menuOpts:{menuId:H.MenubarGoMenu,title:u({key:"miGotoPreviousProblem",comment:["&& denotes a mnemonic"]},"Previous &&Problem"),group:"6_problem_nav",order:2}})}}Mt(Dt.ID,Dt,4);Q(io);Q(wn);Q(Ch);Q(yh);const ea=new kt("markersNavigationVisible",!1),Sh=kn.bindToContribution(Dt.get);Dn(new Sh({id:"closeMarkersNavigation",precondition:ea,handler:r=>r.close(),kbOpts:{weight:150,kbExpr:v.focus,primary:9,secondary:[1033]}}));var Dh=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},xo=function(r,e){return function(t,i){e(t,i,r)}};const de=F;class kh{constructor(e,t,i){this.owner=e,this.range=t,this.marker=i}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}const As={type:1,filter:{include:T.QuickFix},triggerAction:Xe.QuickFixHover};let Cn=class{constructor(e,t,i,o){this._editor=e,this._markerDecorationsService=t,this._openerService=i,this._languageFeaturesService=o,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1&&!e.supportsMarkerHover)return[];const i=this._editor.getModel(),o=e.range.startLineNumber,n=i.getLineMaxColumn(o),s=[];for(const a of t){const d=a.range.startLineNumber===o?a.range.startColumn:1,c=a.range.endLineNumber===o?a.range.endColumn:n,l=this._markerDecorationsService.getMarker(i.uri,a);if(!l)continue;const h=new m(e.range.startLineNumber,d,e.range.startLineNumber,c);s.push(new kh(this,h,l))}return s}renderHoverParts(e,t){if(!t.length)return new gi([]);const i=new k,o=[];t.forEach(s=>{const a=this._renderMarkerHover(s);e.fragment.appendChild(a.hoverElement),o.push(a)});const n=t.length===1?t[0]:t.sort((s,a)=>G.compare(s.marker.severity,a.marker.severity))[0];return this.renderMarkerStatusbar(e,n,i),new gi(o)}_renderMarkerHover(e){const t=new k,i=de("div.hover-row"),o=y(i,de("div.marker.hover-contents")),{source:n,message:s,code:a,relatedInformation:d}=e.marker;this._editor.applyFontInfo(o);const c=y(o,de("span"));if(c.style.whiteSpace="pre-wrap",c.innerText=s,n||a)if(a&&typeof a!="string"){const h=de("span");if(n){const b=y(h,de("span"));b.innerText=n}const g=y(h,de("a.code-link"));g.setAttribute("href",a.target.toString()),t.add($(g,"click",b=>{this._openerService.open(a.target,{allowCommands:!0}),b.preventDefault(),b.stopPropagation()}));const f=y(g,de("span"));f.innerText=a.value;const p=y(o,h);p.style.opacity="0.6",p.style.paddingLeft="6px"}else{const h=y(o,de("span"));h.style.opacity="0.6",h.style.paddingLeft="6px",h.innerText=n&&a?`${n}(${a})`:n||`(${a})`}if(We(d))for(const{message:h,resource:g,startLineNumber:f,startColumn:p}of d){const b=y(o,de("div"));b.style.marginTop="8px";const _=y(b,de("a"));_.innerText=`${Ze(g)}(${f}, ${p}): `,_.style.cursor="pointer",t.add($(_,"click",C=>{if(C.stopPropagation(),C.preventDefault(),this._openerService){const A={selection:{startLineNumber:f,startColumn:p}};this._openerService.open(g,{fromUserGesture:!0,editorOptions:A}).catch(Me)}}));const w=y(b,de("span"));w.innerText=h,this._editor.applyFontInfo(w)}return{hoverPart:e,hoverElement:i,dispose:()=>t.dispose()}}renderMarkerStatusbar(e,t,i){if(t.marker.severity===G.Error||t.marker.severity===G.Warning||t.marker.severity===G.Info){const o=Dt.get(this._editor);o&&e.statusBar.addAction({label:u("view problem","View Problem"),commandId:io.ID,run:()=>{e.hide(),o.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(92)){const o=e.statusBar.append(de("div"));this.recentMarkerCodeActionsInfo&&(is.makeKey(this.recentMarkerCodeActionsInfo.marker)===is.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(o.textContent=u("noQuickFixes","No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const n=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?P.None:Ma(()=>o.textContent=u("checkingForQuickFixes","Checking for quick fixes..."),200,i);o.textContent||(o.textContent="");const s=this.getCodeActions(t.marker);i.add(De(()=>s.cancel())),s.then(a=>{if(n.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:a.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){a.dispose(),o.textContent=u("noQuickFixes","No quick fixes available");return}o.style.display="none";let d=!1;i.add(De(()=>{d||a.dispose()})),e.statusBar.addAction({label:u("quick fixes","Quick Fix..."),commandId:zr,run:c=>{d=!0;const l=gn.get(this._editor),h=ve(c);e.hide(),l==null||l.showCodeActions(As,a,{x:h.left,y:h.top,width:h.width,height:h.height})}})},Me)}}getCodeActions(e){return It(t=>Bt(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new m(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),As,Ft.None,t))}};Cn=Dh([xo(1,Rd),xo(2,Yt),xo(3,R)],Cn);class Mh{get lineNumber(){return this._lineNumber}set lineNumber(e){this._lineNumber=e}get lane(){return this._laneOrLine}set lane(e){this._laneOrLine=e}constructor(e){this._editor=e,this._lineNumber=-1,this._laneOrLine=$i.Center}computeSync(){var n;const e=s=>({value:s}),t=this._editor.getLineDecorations(this._lineNumber),i=[],o=this._laneOrLine==="lineNo";if(!t)return i;for(const s of t){const a=((n=s.options.glyphMargin)==null?void 0:n.position)??$i.Center;if(!o&&a!==this._laneOrLine)continue;const d=o?s.options.lineNumberHoverMessage:s.options.glyphMarginHoverMessage;!d||ci(d)||i.push(...Ws(d).map(e))}return i}}var Ph=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},xs=function(r,e){return function(t,i){e(t,i,r)}},yn;const Hs=F;var wt;let Sn=(wt=class extends P{constructor(e,t,i){super(),this._renderDisposeables=this._register(new k),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new ur),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._markdownRenderer=this._register(new Zs({editor:this._editor},t,i)),this._computer=new Mh(this._editor),this._hoverOperation=this._register(new Ir(this._editor,this._computer)),this._register(this._hoverOperation.onResult(o=>{this._withResult(o.value)})),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(o=>{o.hasChanged(50)&&this._updateFont()})),this._register(Gt(this._hover.containerDomNode,"mouseleave",o=>{this._onMouseLeave(o)})),this._editor.addOverlayWidget(this)}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return yn.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(t=>this._editor.applyFontInfo(t))}_onModelDecorationsChanged(){this._isVisible&&(this._hoverOperation.cancel(),this._hoverOperation.start(0))}showsOrWillShow(e){const t=e.target;return t.type===2&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===3?(this._startShowingAt(t.position.lineNumber,"lineNo"),!0):!1}_startShowingAt(e,t){this._computer.lineNumber===e&&this._computer.lane===t||(this._hoverOperation.cancel(),this.hide(),this._computer.lineNumber=e,this._computer.lane=t,this._hoverOperation.start(0))}hide(){this._computer.lineNumber=-1,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible))}_withResult(e){this._messages=e,this._messages.length>0?this._renderMessages(this._computer.lineNumber,this._messages):this.hide()}_renderMessages(e,t){this._renderDisposeables.clear();const i=document.createDocumentFragment();for(const o of t){const n=Hs("div.hover-row.markdown-hover"),s=y(n,Hs("div.hover-contents")),a=this._renderDisposeables.add(this._markdownRenderer.render(o.value));s.appendChild(a.element),i.appendChild(n)}this._updateContents(i),this._showAt(e)}_updateContents(e){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible));const t=this._editor.getLayoutInfo(),i=this._editor.getTopForLineNumber(e),o=this._editor.getScrollTop(),n=this._editor.getOption(67),s=this._hover.containerDomNode.clientHeight,a=i-o-(s-n)/2,d=t.glyphMarginLeft+t.glyphMarginWidth+(this._computer.lane==="lineNo"?t.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${d}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(a),0)}px`}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!wo(t,e.x,e.y))&&this.hide()}},yn=wt,wt.ID="editor.contrib.modesGlyphHoverWidget",wt);Sn=yn=Ph([xs(1,ho),xs(2,Yt)],Sn);var Ih=function(r,e,t,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(n=(o<3?s(n):o>3?s(e,t,n):s(e,t))||n);return o>3&&n&&Object.defineProperty(e,t,n),n},Ah=function(r,e){return function(t,i){e(t,i,r)}},zt;let oo=(zt=class extends P{constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new k,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new Te(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(60)&&(this._unhookListeners(),this._hookListeners())}))}_hookListeners(){const e=this._editor.getOption(60);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))):(this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this._hideWidgets()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this._hideWidgets()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnMarginHoverWidget(e)&&this._hideWidgets()}_isMouseOnMarginHoverWidget(e){var i;const t=(i=this._glyphWidget)==null?void 0:i.getDomNode();return t?wo(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._isMouseOnMarginHoverWidget(e))||this._hideWidgets()}_shouldNotRecomputeCurrentHoverWidget(e){const t=this._hoverSettings.sticky,i=this._isMouseOnMarginHoverWidget(e);return t&&i}_onEditorMouseMove(e){if(this.shouldKeepOpenOnEditorMouseMoveOrLeave)return;if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}_reactToEditorMouseMove(e){!e||this._tryShowHoverWidget(e)||this._hideWidgets()}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||this._hideWidgets())}_hideWidgets(){var e;(e=this._glyphWidget)==null||e.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||(this._glyphWidget=this._instantiationService.createInstance(Sn,this._editor)),this._glyphWidget}dispose(){var e;super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),(e=this._glyphWidget)==null||e.dispose()}},zt.ID="editor.contrib.marginHover",zt);oo=Ih([Ah(1,U)],oo);const Un=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{const t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};class xh{}class Hh{}class Rh{}Mt(j.ID,j,2);Mt(oo.ID,oo,2);Q(Al);Q(xl);Q(Hl);Q(Rl);Q(Nl);Q(Ll);Q(El);Q(Ol);Q(Tl);Q(Wl);Q(Fl);Q(Vl);Fn.register(fi);Fn.register(Cn);sr((r,e)=>{const t=r.getColor(cd);t&&(e.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${t.transparent(.5)}; }`))});Un.register(new xh);Un.register(new Hh);Un.register(new Rh);
