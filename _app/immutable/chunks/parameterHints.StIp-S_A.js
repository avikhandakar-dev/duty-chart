import{z as R,e as J,u as _,U as Q,P as k,I as U,v as X,b as Z,y as G,H as M,J as ee,M as te,C as F,N as ie,o as W,O as se,l as D,Q as z,D as re,S as c,T as $,V,W as K,X as ne,Y as oe,Z as x,_ as ae,F as de,$ as he,a0 as le,a1 as ce,c as ge,E as ue,j as w,r as pe,d as me,B as fe,A as P,h as q}from"./editorContextKeys.Cdn_dJhV.js";import{S as m,r as B,M as Ce,D as ve,a as ye,I as be,b as we,c as De,l as xe,E as He}from"./iconRegistry.BJgxFQLY.js";const v={Visible:new R("parameterHintsVisible",!1),MultipleSignatures:new R("parameterHintsMultipleSignatures",!1)};async function Y(o,e,i,t,s){const r=o.ordered(e);for(const a of r)try{const n=await a.provideSignatureHelp(e,i,s,t);if(n)return n}catch(n){G(n)}}J.registerCommand("_executeSignatureHelpProvider",async(o,...e)=>{const[i,t,s]=e;_(Q.isUri(i)),_(k.isIPosition(t)),_(typeof s=="string"||!s);const r=o.get(U),a=await o.get(X).createModelReference(i);try{const n=await Y(r.signatureHelpProvider,a.object.textEditorModel,k.lift(t),{triggerKind:m.Invoke,isRetrigger:!1,triggerCharacter:s},Z.None);return n?(setTimeout(()=>n.dispose(),0),n.value):void 0}finally{a.dispose()}});var p;(function(o){o.Default={type:0};class e{constructor(s,r){this.request=s,this.previouslyActiveHints=r,this.type=2}}o.Pending=e;class i{constructor(s){this.hints=s,this.type=1}}o.Active=i})(p||(p={}));const S=class S extends M{constructor(e,i,t=S.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new ee),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=p.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new te),this.triggerChars=new F,this.retriggerChars=new F,this.triggerId=0,this.editor=e,this.providers=i,this.throttledDelayer=new ie(t),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(s=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(s=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(s=>this.onCursorChange(s))),this._register(this.editor.onDidChangeModelContent(s=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(s=>this.onDidType(s))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===2&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=p.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,i){const t=this.editor.getModel();if(!t||!this.providers.has(t))return;const s=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(s),i).catch(W)}next(){if(this.state.type!==1)return;const e=this.state.hints.signatures.length,i=this.state.hints.activeSignature,t=i%e===e-1,s=this.editor.getOption(86).cycle;if((e<2||t)&&!s){this.cancel();return}this.updateActiveSignature(t&&s?0:i+1)}previous(){if(this.state.type!==1)return;const e=this.state.hints.signatures.length,i=this.state.hints.activeSignature,t=i===0,s=this.editor.getOption(86).cycle;if((e<2||t)&&!s){this.cancel();return}this.updateActiveSignature(t&&s?e-1:i-1)}updateActiveSignature(e){this.state.type===1&&(this.state=new p.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){const i=this.state.type===1||this.state.type===2,t=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;const s=this._pendingTriggers.reduce(Se);this._pendingTriggers=[];const r={triggerKind:s.triggerKind,triggerCharacter:s.triggerCharacter,isRetrigger:i,activeSignatureHelp:t};if(!this.editor.hasModel())return!1;const a=this.editor.getModel(),n=this.editor.getPosition();this.state=new p.Pending(se(d=>Y(this.providers,a,n,r,d)),t);try{const d=await this.state.request;return e!==this.triggerId?(d==null||d.dispose(),!1):!d||!d.value.signatures||d.value.signatures.length===0?(d==null||d.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new p.Active(d.value),this._lastSignatureHelpResult.value=d,this._onChangedHints.fire(this.state.hints),!0)}catch(d){return e===this.triggerId&&(this.state=p.Default),W(d),!1}}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===1||this.state.type===2||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();const e=this.editor.getModel();if(e)for(const i of this.providers.ordered(e)){for(const t of i.signatureHelpTriggerCharacters||[])if(t.length){const s=t.charCodeAt(0);this.triggerChars.add(s),this.retriggerChars.add(s)}for(const t of i.signatureHelpRetriggerCharacters||[])t.length&&this.retriggerChars.add(t.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;const i=e.length-1,t=e.charCodeAt(i);(this.triggerChars.has(t)||this.isTriggered&&this.retriggerChars.has(t))&&this.trigger({triggerKind:m.TriggerCharacter,triggerCharacter:e.charAt(i)})}onCursorChange(e){e.source==="mouse"?this.cancel():this.isTriggered&&this.trigger({triggerKind:m.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:m.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(86).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}};S.DEFAULT_DELAY=120;let T=S;function Se(o,e){switch(e.triggerKind){case m.Invoke:return e;case m.ContentChange:return o;case m.TriggerCharacter:default:return e}}var _e=function(o,e,i,t){var s=arguments.length,r=s<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,i):t,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(o,e,i,t);else for(var n=o.length-1;n>=0;n--)(a=o[n])&&(r=(s<3?a(r):s>3?a(e,i,r):a(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},H=function(o,e){return function(i,t){e(i,t,o)}},I;const l=le,Te=B("parameter-hints-next",z.chevronDown,D("parameterHintsNextIcon","Icon for show next parameter hint.")),Ie=B("parameter-hints-previous",z.chevronUp,D("parameterHintsPreviousIcon","Icon for show previous parameter hint."));var f;let N=(f=class extends M{constructor(e,i,t,s,r,a){super(),this.editor=e,this.model=i,this.telemetryService=a,this.renderDisposeables=this._register(new re),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=this._register(new Ce({editor:e},r,s)),this.keyVisible=v.Visible.bindTo(t),this.keyMultipleSignatures=v.MultipleSignatures.bindTo(t)}createParameterHintDOMNodes(){const e=l(".editor-widget.parameter-hints-widget"),i=c(e,l(".phwrapper"));i.tabIndex=-1;const t=c(i,l(".controls")),s=c(t,l(".button"+$.asCSSSelector(Ie))),r=c(t,l(".overloads")),a=c(t,l(".button"+$.asCSSSelector(Te)));this._register(V(s,"click",u=>{K.stop(u),this.previous()})),this._register(V(a,"click",u=>{K.stop(u),this.next()}));const n=l(".body"),d=new ve(n,{alwaysConsumeMouseWheel:!0});this._register(d),i.appendChild(d.getDomNode());const h=c(n,l(".signature")),g=c(n,l(".docs"));e.style.userSelect="text",this.domNodes={element:e,signature:h,overloads:r,docs:g,scrollbar:d},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(u=>{this.visible&&this.editor.layoutContentWidget(this)}));const L=()=>{if(!this.domNodes)return;const u=this.editor.getOption(50),y=this.domNodes.element;y.style.fontSize=`${u.fontSize}px`,y.style.lineHeight=`${u.lineHeight/u.fontSize}`,y.style.setProperty("--vscode-parameterHintsWidget-editorFontFamily",u.fontFamily),y.style.setProperty("--vscode-parameterHintsWidget-editorFontFamilyDefault",He.fontFamily)};L(),this._register(ne.chain(this.editor.onDidChangeConfiguration.bind(this.editor),u=>u.filter(y=>y.hasChanged(50)))(L)),this._register(this.editor.onDidLayoutChange(u=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{var e;(e=this.domNodes)==null||e.element.classList.add("visible")},100),this.editor.layoutContentWidget(this))}hide(){var e;this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,(e=this.domNodes)==null||e.element.classList.remove("visible"),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;const i=e.signatures.length>1;this.domNodes.element.classList.toggle("multiple",i),this.keyMultipleSignatures.set(i),this.domNodes.signature.innerText="",this.domNodes.docs.innerText="";const t=e.signatures[e.activeSignature];if(!t)return;const s=c(this.domNodes.signature,l(".code")),r=t.parameters.length>0,a=t.activeParameter??e.activeParameter;if(r)this.renderParameters(s,t,a);else{const h=c(s,l("span"));h.textContent=t.label}const n=t.parameters[a];if(n!=null&&n.documentation){const h=l("span.documentation");if(typeof n.documentation=="string")h.textContent=n.documentation;else{const g=this.renderMarkdownDocs(n.documentation);h.appendChild(g.element)}c(this.domNodes.docs,l("p",{},h))}if(t.documentation!==void 0)if(typeof t.documentation=="string")c(this.domNodes.docs,l("p",{},t.documentation));else{const h=this.renderMarkdownDocs(t.documentation);c(this.domNodes.docs,h.element)}const d=this.hasDocs(t,n);if(this.domNodes.signature.classList.toggle("has-docs",d),this.domNodes.docs.classList.toggle("empty",!d),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,"0")+"/"+e.signatures.length,n){let h="";const g=t.parameters[a];Array.isArray(g.label)?h=t.label.substring(g.label[0],g.label[1]):h=g.label,g.documentation&&(h+=typeof g.documentation=="string"?`, ${g.documentation}`:`, ${g.documentation.value}`),t.documentation&&(h+=typeof t.documentation=="string"?`, ${t.documentation}`:`, ${t.documentation.value}`),this.announcedLabel!==h&&(ye(D("hint","{0}, hint",h)),this.announcedLabel=h)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){const i=new oe,t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{var r;(r=this.domNodes)==null||r.scrollbar.scanDomNode()}}));t.element.classList.add("markdown-docs");const s=i.elapsed();return s>300&&this.telemetryService.publicLog2("parameterHints.parseMarkdown",{renderDuration:s}),t}hasDocs(e,i){return!!(i&&typeof i.documentation=="string"&&x(i.documentation).length>0||i&&typeof i.documentation=="object"&&x(i.documentation).value.length>0||e.documentation&&typeof e.documentation=="string"&&x(e.documentation).length>0||e.documentation&&typeof e.documentation=="object"&&x(e.documentation.value).length>0)}renderParameters(e,i,t){const[s,r]=this.getParameterLabelOffsets(i,t),a=document.createElement("span");a.textContent=i.label.substring(0,s);const n=document.createElement("span");n.textContent=i.label.substring(s,r),n.className="parameter active";const d=document.createElement("span");d.textContent=i.label.substring(r),c(e,a,n,d)}getParameterLabelOffsets(e,i){const t=e.parameters[i];if(t){if(Array.isArray(t.label))return t.label;if(t.label.length){const s=new RegExp(`(\\W|^)${ae(t.label)}(?=\\W|$)`,"g");s.test(e.label);const r=s.lastIndex-t.label.length;return r>=0?[r,s.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return I.ID}updateMaxHeight(){if(!this.domNodes)return;const i=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=i;const t=this.domNodes.element.getElementsByClassName("phwrapper");t.length&&(t[0].style.maxHeight=i)}},I=f,f.ID="editor.widget.parameterHintsWidget",f);N=I=_e([H(2,de),H(3,be),H(4,we),H(5,he)],N);De("editorHoverWidget.highlightForeground",xe,D("editorHoverWidgetHighlightForeground","Foreground color of the active item in the parameter hint."));var Ne=function(o,e,i,t){var s=arguments.length,r=s<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,i):t,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(o,e,i,t);else for(var n=o.length-1;n>=0;n--)(a=o[n])&&(r=(s<3?a(r):s>3?a(e,i,r):a(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},j=function(o,e){return function(i,t){e(i,t,o)}},E,C;let b=(C=class extends M{static get(e){return e.getContribution(E.ID)}constructor(e,i,t){super(),this.editor=e,this.model=this._register(new T(e,t.signatureHelpProvider)),this._register(this.model.onChangedHints(s=>{var r;s?(this.widget.value.show(),this.widget.value.render(s)):(r=this.widget.rawValue)==null||r.hide()})),this.widget=new ce(()=>this._register(i.createInstance(N,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){var e;(e=this.widget.rawValue)==null||e.previous()}next(){var e;(e=this.widget.rawValue)==null||e.next()}trigger(e){this.model.trigger(e,0)}},E=C,C.ID="editor.controller.parameterHints",C);b=E=Ne([j(1,ge),j(2,U)],b);class Ee extends ue{constructor(){super({id:"editor.action.triggerParameterHints",label:D("parameterHints.trigger.label","Trigger Parameter Hints"),alias:"Trigger Parameter Hints",precondition:w.hasSignatureHelpProvider,kbOpts:{kbExpr:w.editorTextFocus,primary:3082,weight:100}})}run(e,i){const t=b.get(i);t==null||t.trigger({triggerKind:m.Invoke})}}pe(b.ID,b,2);me(Ee);const A=175,O=fe.bindToContribution(b.get);P(new O({id:"closeParameterHints",precondition:v.Visible,handler:o=>o.cancel(),kbOpts:{weight:A,kbExpr:w.focus,primary:9,secondary:[1033]}}));P(new O({id:"showPrevParameterHint",precondition:q.and(v.Visible,v.MultipleSignatures),handler:o=>o.previous(),kbOpts:{weight:A,kbExpr:w.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}}));P(new O({id:"showNextParameterHint",precondition:q.and(v.Visible,v.MultipleSignatures),handler:o=>o.next(),kbOpts:{weight:A,kbExpr:w.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}));export{b as ParameterHintsController,Ee as TriggerParameterHintsAction};
