import{q as r,z as g,l as k,A as C,B as m,F as _,L as S,a as p,G as T,D as E,R as h}from"./editorContextKeys.Cdn_dJhV.js";import{r as y,b}from"./stableEditorScroll.DHPB0mmN.js";const D=r("progressService"),c=class c{constructor(e){this.callback=e}report(e){this._value=e,this.callback(this._value)}};c.None=Object.freeze({report(){}});let d=c;const w=r("editorProgressService"),a=r("IEditorCancelService"),u=new g("cancellableOperation",!1,k("cancellableOperation","Whether the editor runs a cancellable operation, e.g. like 'Peek References'"));y(a,class{constructor(){this._tokens=new WeakMap}add(i,e){let s=this._tokens.get(i);s||(s=i.invokeWithinContext(n=>{const o=u.bindTo(n.get(_)),f=new S;return{key:o,tokens:f}}),this._tokens.set(i,s));let t;return s.key.set(!0),t=s.tokens.push(e),()=>{t&&(t(),s.key.set(!s.tokens.isEmpty()),t=void 0)}}cancel(i){const e=this._tokens.get(i);if(!e)return;const s=e.tokens.pop();s&&(s.cancel(),e.key.set(!e.tokens.isEmpty()))}},1);class v extends p{constructor(e,s){super(s),this.editor=e,this._unregister=e.invokeWithinContext(t=>t.get(a).add(e,this))}dispose(){this._unregister(),super.dispose()}}C(new class extends m{constructor(){super({id:"editor.cancelOperation",kbOpts:{weight:100,primary:9},precondition:u})}runEditorCommand(i,e){i.get(a).cancel(e)}});class l{constructor(e,s){if(this.flags=s,this.flags&1){const t=e.getModel();this.modelVersionId=t?T("{0}#{1}",t.uri.toString(),t.getVersionId()):null}else this.modelVersionId=null;this.flags&4?this.position=e.getPosition():this.position=null,this.flags&2?this.selection=e.getSelection():this.selection=null,this.flags&8?(this.scrollLeft=e.getScrollLeft(),this.scrollTop=e.getScrollTop()):(this.scrollLeft=-1,this.scrollTop=-1)}_equals(e){if(!(e instanceof l))return!1;const s=e;return!(this.modelVersionId!==s.modelVersionId||this.scrollLeft!==s.scrollLeft||this.scrollTop!==s.scrollTop||!this.position&&s.position||this.position&&!s.position||this.position&&s.position&&!this.position.equals(s.position)||!this.selection&&s.selection||this.selection&&!s.selection||this.selection&&s.selection&&!this.selection.equalsRange(s.selection))}validate(e){return this._equals(new l(e,this.flags))}}class L extends v{constructor(e,s,t,n){super(e,n),this._listener=new E,s&4&&this._listener.add(e.onDidChangeCursorPosition(o=>{(!t||!h.containsPosition(t,o.position))&&this.cancel()})),s&2&&this._listener.add(e.onDidChangeCursorSelection(o=>{(!t||!h.containsRange(t,o.selection))&&this.cancel()})),s&8&&this._listener.add(e.onDidScrollChange(o=>this.cancel())),s&1&&(this._listener.add(e.onDidChangeModel(o=>this.cancel())),this._listener.add(e.onDidChangeModelContent(o=>this.cancel())))}dispose(){this._listener.dispose(),super.dispose()}}class O extends p{constructor(e,s){super(s),this._listener=e.onDidChangeContent(()=>this.cancel())}dispose(){this._listener.dispose(),super.dispose()}}function P(i){return i&&typeof i.getEditorType=="function"?i.getEditorType()===b.ICodeEditor:!1}export{L as E,w as I,d as P,O as T,l as a,D as b,P as i};
