import{D as u,C as w,a as x,i as I,I as S,b as m,o as P,c as f,r as C,d as b,e as N,f as T,g as k,E as v,l as D,h as F,j as d,K as A,R}from"./editorContextKeys.Cdn_dJhV.js";import{I as L}from"./stableEditorScroll.DHPB0mmN.js";import{g as W,A as j,F as K,I as q,f as y,a as z}from"./format.Bb1_og6G.js";import{P as _,I as E}from"./editorBrowser.CzkYJKPy.js";var O=function(a,e,t,i){var o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var n=a.length-1;n>=0;n--)(r=a[n])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},h=function(a,e){return function(t,i){e(t,i,a)}},c;let g=(c=class{constructor(e,t,i,o){this._editor=e,this._languageFeaturesService=t,this._workerService=i,this._accessibilitySignalService=o,this._disposables=new u,this._sessionDisposables=new u,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(s=>{s.hasChanged(56)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(56)||!this._editor.hasModel())return;const e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;const i=new w;for(const o of t.autoFormatTriggerCharacters)i.add(o.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(o=>{const s=o.charCodeAt(o.length-1);i.has(s)&&this._trigger(String.fromCharCode(s))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;const t=this._editor.getModel(),i=this._editor.getPosition(),o=new x,s=this._editor.onDidChangeModelContent(r=>{if(r.isFlush){o.cancel(),s.dispose();return}for(let n=0,M=r.changes.length;n<M;n++)if(r.changes[n].range.endLineNumber<=i.lineNumber){o.cancel(),s.dispose();return}});W(this._workerService,this._languageFeaturesService,t,i,e,t.getFormattingOptions(),o.token).then(r=>{o.token.isCancellationRequested||I(r)&&(this._accessibilitySignalService.playSignal(j.format,{userGesture:!1}),K.execute(this._editor,r,!0))}).finally(()=>{s.dispose()})}},c.ID="editor.contrib.autoFormat",c);g=O([h(1,S),h(2,L),h(3,q)],g);var l;let p=(l=class{constructor(e,t,i){this.editor=e,this._languageFeaturesService=t,this._instantiationService=i,this._callOnDispose=new u,this._callOnModel=new u,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(55)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(y,this.editor,e,2,_.None,m.None,!1).catch(P))}},l.ID="editor.contrib.formatOnPaste",l);p=O([h(1,S),h(2,f)],p);class G extends v{constructor(){super({id:"editor.action.formatDocument",label:D("formatDocument.label","Format Document"),alias:"Format Document",precondition:F.and(d.notInCompositeEditor,d.writable,d.hasDocumentFormattingProvider),kbOpts:{kbExpr:d.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:"1_modification",order:1.3}})}async run(e,t){if(t.hasModel()){const i=e.get(f);await e.get(E).showWhile(i.invokeFunction(z,t,1,_.None,m.None,!0),250)}}}class U extends v{constructor(){super({id:"editor.action.formatSelection",label:D("formatSelection.label","Format Selection"),alias:"Format Selection",precondition:F.and(d.writable,d.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:d.editorTextFocus,primary:A(2089,2084),weight:100},contextMenuOpts:{when:d.hasNonEmptySelection,group:"1_modification",order:1.31}})}async run(e,t){if(!t.hasModel())return;const i=e.get(f),o=t.getModel(),s=t.getSelections().map(n=>n.isEmpty()?new R(n.startLineNumber,1,n.startLineNumber,o.getLineMaxColumn(n.startLineNumber)):n);await e.get(E).showWhile(i.invokeFunction(y,t,s,1,_.None,m.None,!0),250)}}C(g.ID,g,2);C(p.ID,p,2);b(G);b(U);N.registerCommand("editor.action.format",async a=>{const e=a.get(T).getFocusedCodeEditor();if(!e||!e.hasModel())return;const t=a.get(k);e.getSelection().isEmpty()?await t.executeCommand("editor.action.formatDocument"):await t.executeCommand("editor.action.formatSelection")});export{g as FormatOnType};
