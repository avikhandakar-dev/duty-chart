import{W as Vi,F as ct,h as $i,d as Ui,e as gi,L as ji,C as It,g as pi,i as qi,j as Gi,k as Ki,M as Ji,D as Yi,n as Qi,o as Ue,P as Xi,r as Zi,b as es,p as ts,c as te,q as is,s as ss,t as ns,u as os,v as rs,w as as,l as ls,x as ds,y as hs,z as zt,A as cs,B as us,G as gs,a as ps}from"./iconRegistry.BQALo55A.js";import{l as f,J as R,W as fs,Q as Lt,z as L,F as ie,a3 as fi,h as x,D as A,a4 as _s,a5 as _i,a6 as ms,e as mi,u as re,U as ve,P as z,I as Nt,v as Ss,b as Si,Y as Ee,R as D,y as bi,a7 as bs,a8 as ws,a9 as vs,aa as Cs,ab as Pe,ac as xs,ad as ys,s as Le,ae as Ds,af as Ts,ag as Ht,ah as Oe,w as Mt,r as wi,B as vi,A as N,j as I,ai as Is,q as Ls,i as Ci,C as Ns,L as Ms,aj as Es,ak as Ps,n as Os,al as Rs,H as ks,am as Fs,$ as xi,an as yi,a as Di,o as Et,ao as As,ap as Ws,c as it,aq as zs,S as P,a0 as E,ar as Hs,a2 as k,T as je,as as oe,at as rt,au as Z,av as Bs,aw as Ti,ax as Ii,ay as Vs,M as ut,az as Bt,G as $s,aA as Us,O as js,aB as Vt,aC as $t,aD as Ne,aE as qs,aF as at,aG as Ut,aH as Gs,aI as Ks,X as jt,g as Js,E as Li,d as Ni,aJ as Ys}from"./editorContextKeys.Cdn_dJhV.js";import{E as Re,a as Me,r as Qs,I as Xs,S as qt}from"./stableEditorScroll.DHPB0mmN.js";import{H as Zs,T as en,g as tn,F as sn,c as Pt,M as De,d as Gt,W as nn,e as Mi,f as Kt,h as on,i as rn,A as Jt,j as an,I as Ei,k as ln,L as dn,l as hn,m as cn,n as un}from"./codeEditorWidget.B5nwRVQy.js";import{t as gn,i as pn,a as Yt,W as Qt,I as Xt,T as fn,b as _n}from"./clipboardService.BTmHAzm-.js";import{g as mn,R as Pi,E as Sn}from"./resizable.BRTVkcIb.js";const $=class ${constructor(){this.value="",this.pos=0}static isDigitCharacter(e){return e>=48&&e<=57}static isVariableCharacter(e){return e===95||e>=97&&e<=122||e>=65&&e<=90}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:14,pos:this.pos,len:0};const e=this.pos;let t=0,i=this.value.charCodeAt(e),s;if(s=$._table[i],typeof s=="number")return this.pos+=1,{type:s,pos:e,len:1};if($.isDigitCharacter(i)){s=8;do t+=1,i=this.value.charCodeAt(e+t);while($.isDigitCharacter(i));return this.pos+=t,{type:s,pos:e,len:t}}if($.isVariableCharacter(i)){s=9;do i=this.value.charCodeAt(e+ ++t);while($.isVariableCharacter(i)||$.isDigitCharacter(i));return this.pos+=t,{type:s,pos:e,len:t}}s=10;do t+=1,i=this.value.charCodeAt(e+t);while(!isNaN(i)&&typeof $._table[i]>"u"&&!$.isDigitCharacter(i)&&!$.isVariableCharacter(i));return this.pos+=t,{type:s,pos:e,len:t}}};$._table={36:0,58:1,44:2,123:3,125:4,92:5,47:6,124:7,43:11,45:12,63:13};let gt=$;class xe{constructor(){this._children=[]}appendChild(e){return e instanceof F&&this._children[this._children.length-1]instanceof F?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){const{parent:i}=e,s=i.children.indexOf(e),n=i.children.slice(0);n.splice(s,1,...t),i._children=n,function o(r,l){for(const h of r)h.parent=l,o(h.children,h)}(t,i)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof Ae)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),"")}len(){return 0}}class F extends xe{constructor(e){super(),this.value=e}toString(){return this.value}len(){return this.value.length}clone(){return new F(this.value)}}class Oi extends xe{}class V extends Oi{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof ye?this._children[0]:void 0}clone(){const e=new V(this.index);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}class ye extends xe{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof F&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}len(){return this.options[0].len()}clone(){const e=new ye;return this.options.forEach(e.appendChild,e),e}}class Ot extends xe{constructor(){super(...arguments),this.regexp=new RegExp("")}resolve(e){const t=this;let i=!1,s=e.replace(this.regexp,function(){return i=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!i&&this._children.some(n=>n instanceof q&&!!n.elseValue)&&(s=this._replace([])),s}_replace(e){let t="";for(const i of this._children)if(i instanceof q){let s=e[i.index]||"";s=i.resolve(s),t+=s}else t+=i.toString();return t}toString(){return""}clone(){const e=new Ot;return e.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")),e._children=this.children.map(t=>t.clone()),e}}class q extends xe{constructor(e,t,i,s){super(),this.index=e,this.shorthandName=t,this.ifValue=i,this.elseValue=s}resolve(e){return this.shorthandName==="upcase"?e?e.toLocaleUpperCase():"":this.shorthandName==="downcase"?e?e.toLocaleLowerCase():"":this.shorthandName==="capitalize"?e?e[0].toLocaleUpperCase()+e.substr(1):"":this.shorthandName==="pascalcase"?e?this._toPascalCase(e):"":this.shorthandName==="camelcase"?e?this._toCamelCase(e):"":e&&typeof this.ifValue=="string"?this.ifValue:!e&&typeof this.elseValue=="string"?this.elseValue:e||""}_toPascalCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map(i=>i.charAt(0).toUpperCase()+i.substr(1)).join(""):e}_toCamelCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map((i,s)=>s===0?i.charAt(0).toLowerCase()+i.substr(1):i.charAt(0).toUpperCase()+i.substr(1)).join(""):e}clone(){return new q(this.index,this.shorthandName,this.ifValue,this.elseValue)}}class ke extends Oi{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||"")),t!==void 0?(this._children=[new F(t)],!0):!1}clone(){const e=new ke(this.name);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}function Zt(a,e){const t=[...a];for(;t.length>0;){const i=t.shift();if(!e(i))break;t.unshift(...i.children)}}class Ae extends xe{get placeholderInfo(){if(!this._placeholders){const e=[];let t;this.walk(function(i){return i instanceof V&&(e.push(i),t=!t||t.index<i.index?i:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){const{all:e}=this.placeholderInfo;return e}offset(e){let t=0,i=!1;return this.walk(s=>s===e?(i=!0,!1):(t+=s.len(),!0)),i?t:-1}fullLen(e){let t=0;return Zt([e],i=>(t+=i.len(),!0)),t}enclosingPlaceholders(e){const t=[];let{parent:i}=e;for(;i;)i instanceof V&&t.push(i),i=i.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof ke&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}clone(){const e=new Ae;return this._children=this.children.map(t=>t.clone()),e}walk(e){Zt(this.children,e)}}class qe{constructor(){this._scanner=new gt,this._token={type:14,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,"\\$&")}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,i){const s=new Ae;return this.parseFragment(e,s),this.ensureFinalTabstop(s,i??!1,t??!1),s}parseFragment(e,t){const i=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););const s=new Map,n=[];t.walk(l=>(l instanceof V&&(l.isFinalTabstop?s.set(0,void 0):!s.has(l.index)&&l.children.length>0?s.set(l.index,l.children):n.push(l)),!0));const o=(l,h)=>{const c=s.get(l.index);if(!c)return;const u=new V(l.index);u.transform=l.transform;for(const d of c){const g=d.clone();u.appendChild(g),g instanceof V&&s.has(g.index)&&!h.has(g.index)&&(h.add(g.index),o(g,h),h.delete(g.index))}t.replace(l,[u])},r=new Set;for(const l of n)o(l,r);return t.children.slice(i)}ensureFinalTabstop(e,t,i){(t||i&&e.placeholders.length>0)&&(e.placeholders.find(n=>n.index===0)||e.appendChild(new V(0)))}_accept(e,t){if(e===void 0||this._token.type===e){const i=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),i}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){const t=this._token;for(;this._token.type!==e;){if(this._token.type===14)return!1;if(this._token.type===5){const s=this._scanner.next();if(s.type!==0&&s.type!==4&&s.type!==5)return!1}this._token=this._scanner.next()}const i=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,"$1");return this._token=this._scanner.next(),i}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(5,!0))?(t=this._accept(0,!0)||this._accept(4,!0)||this._accept(5,!0)||t,e.appendChild(new F(t)),!0):!1}_parseTabstopOrVariableName(e){let t;const i=this._token;return this._accept(0)&&(t=this._accept(9,!0)||this._accept(8,!0))?(e.appendChild(/^\d+$/.test(t)?new V(Number(t)):new ke(t)),!0):this._backTo(i)}_parseComplexPlaceholder(e){let t;const i=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(8,!0))))return this._backTo(i);const n=new V(Number(t));if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(n),!0;if(!this._parse(n))return e.appendChild(new F("${"+t+":")),n.children.forEach(e.appendChild,e),!0}else if(n.index>0&&this._accept(7)){const o=new ye;for(;;){if(this._parseChoiceElement(o)){if(this._accept(2))continue;if(this._accept(7)&&(n.appendChild(o),this._accept(4)))return e.appendChild(n),!0}return this._backTo(i),!1}}else return this._accept(6)?this._parseTransform(n)?(e.appendChild(n),!0):(this._backTo(i),!1):this._accept(4)?(e.appendChild(n),!0):this._backTo(i)}_parseChoiceElement(e){const t=this._token,i=[];for(;!(this._token.type===2||this._token.type===7);){let s;if((s=this._accept(5,!0))?s=this._accept(2,!0)||this._accept(7,!0)||this._accept(5,!0)||s:s=this._accept(void 0,!0),!s)return this._backTo(t),!1;i.push(s)}return i.length===0?(this._backTo(t),!1):(e.appendChild(new F(i.join(""))),!0)}_parseComplexVariable(e){let t;const i=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(9,!0))))return this._backTo(i);const n=new ke(t);if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(n),!0;if(!this._parse(n))return e.appendChild(new F("${"+t+":")),n.children.forEach(e.appendChild,e),!0}else return this._accept(6)?this._parseTransform(n)?(e.appendChild(n),!0):(this._backTo(i),!1):this._accept(4)?(e.appendChild(n),!0):this._backTo(i)}_parseTransform(e){const t=new Ot;let i="",s="";for(;!this._accept(6);){let n;if(n=this._accept(5,!0)){n=this._accept(6,!0)||n,i+=n;continue}if(this._token.type!==14){i+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(6);){let n;if(n=this._accept(5,!0)){n=this._accept(5,!0)||this._accept(6,!0)||n,t.appendChild(new F(n));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(4);){if(this._token.type!==14){s+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(i,s)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){const t=this._token;if(!this._accept(0))return!1;let i=!1;this._accept(3)&&(i=!0);const s=this._accept(8,!0);if(s)if(i){if(this._accept(4))return e.appendChild(new q(Number(s))),!0;if(!this._accept(1))return this._backTo(t),!1}else return e.appendChild(new q(Number(s))),!0;else return this._backTo(t),!1;if(this._accept(6)){const n=this._accept(9,!0);return!n||!this._accept(4)?(this._backTo(t),!1):(e.appendChild(new q(Number(s),n)),!0)}else if(this._accept(11)){const n=this._until(4);if(n)return e.appendChild(new q(Number(s),void 0,n,void 0)),!0}else if(this._accept(12)){const n=this._until(4);if(n)return e.appendChild(new q(Number(s),void 0,void 0,n)),!0}else if(this._accept(13)){const n=this._until(1);if(n){const o=this._until(4);if(o)return e.appendChild(new q(Number(s),void 0,n,o)),!0}}else{const n=this._until(4);if(n)return e.appendChild(new q(Number(s),void 0,void 0,n)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type!==14?(e.appendChild(new F(this._scanner.tokenText(this._token))),this._accept(void 0),!0):!1}}const bn=f("defaultLabel","input"),wn=f("label.preserveCaseToggle","Preserve Case");class vn extends en{constructor(e){super({icon:Lt.preserveCase,title:wn+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??tn("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class Cn extends Vi{constructor(e,t,i,s){super(),this._showOptionButtons=i,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new R),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new R),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new R),this._onInput=this._register(new R),this._onKeyUp=this._register(new R),this._onPreserveCaseKeyDown=this._register(new R),this.onPreserveCaseKeyDown=this._onPreserveCaseKeyDown.event,this.contextViewProvider=t,this.placeholder=s.placeholder||"",this.validation=s.validation,this.label=s.label||bn;const n=s.appendPreserveCaseLabel||"",o=s.history||[],r=!!s.flexibleHeight,l=!!s.flexibleWidth,h=s.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new Zs(this.domNode,this.contextViewProvider,{ariaLabel:this.label||"",placeholder:this.placeholder||"",validationOptions:{validation:this.validation},history:o,showHistoryHint:s.showHistoryHint,flexibleHeight:r,flexibleWidth:l,flexibleMaxHeight:h,inputBoxStyles:s.inputBoxStyles})),this.preserveCase=this._register(new vn({appendTitle:n,isChecked:!1,...s.toggleStyles})),this._register(this.preserveCase.onChange(d=>{this._onDidOptionChange.fire(d),!d&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(d=>{this._onPreserveCaseKeyDown.fire(d)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;const c=[this.preserveCase.domNode];this.onkeydown(this.domNode,d=>{if(d.equals(15)||d.equals(17)||d.equals(9)){const g=c.indexOf(this.domNode.ownerDocument.activeElement);if(g>=0){let p=-1;d.equals(17)?p=(g+1)%c.length:d.equals(15)&&(g===0?p=c.length-1:p=g-1),d.equals(9)?(c[g].blur(),this.inputBox.focus()):p>=0&&c[p].focus(),fs.stop(d,!0)}}});const u=document.createElement("div");u.className="controls",u.style.display=this._showOptionButtons?"block":"none",u.appendChild(this.preserveCase.domNode),this.domNode.appendChild(u),e==null||e.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,d=>this._onKeyDown.fire(d)),this.onkeyup(this.inputBox.inputElement,d=>this._onKeyUp.fire(d)),this.oninput(this.inputBox.inputElement,d=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,d=>this._onMouseDown.fire(d))}enable(){this.domNode.classList.remove("disabled"),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add("disabled"),this.inputBox.disable(),this.preserveCase.disable()}setEnabled(e){e?this.enable():this.disable()}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}validate(){var e;(e=this.inputBox)==null||e.validate()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+"px"}dispose(){super.dispose()}}var Ri=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},ki=function(a,e){return function(t,i){e(t,i,a)}};const Rt=new L("suggestWidgetVisible",!1,f("suggestWidgetVisible","Whether suggestion are visible")),kt="historyNavigationWidgetFocus",Fi="historyNavigationForwardsEnabled",Ai="historyNavigationBackwardsEnabled";let ee;const We=[];function Wi(a,e){if(We.includes(e))throw new Error("Cannot register the same widget multiple times");We.push(e);const t=new A,i=new L(kt,!1).bindTo(a),s=new L(Fi,!0).bindTo(a),n=new L(Ai,!0).bindTo(a),o=()=>{i.set(!0),ee=e},r=()=>{i.set(!1),ee===e&&(ee=void 0)};return _s(e.element)&&o(),t.add(e.onDidFocus(()=>o())),t.add(e.onDidBlur(()=>r())),t.add(_i(()=>{We.splice(We.indexOf(e),1),r()})),{historyNavigationForwardsEnablement:s,historyNavigationBackwardsEnablement:n,dispose(){t.dispose()}}}let ei=class extends sn{constructor(e,t,i,s){super(e,t,i);const n=this._register(s.createScoped(this.inputBox.element));this._register(Wi(n,this.inputBox))}};ei=Ri([ki(3,ie)],ei);let ti=class extends Cn{constructor(e,t,i,s,n=!1){super(e,t,n,i);const o=this._register(s.createScoped(this.inputBox.element));this._register(Wi(o,this.inputBox))}};ti=Ri([ki(3,ie)],ti);fi.registerCommandAndKeybindingRule({id:"history.showPrevious",weight:200,when:x.and(x.has(kt),x.equals(Ai,!0),x.not("isComposing"),Rt.isEqualTo(!1)),primary:16,secondary:[528],handler:a=>{ee==null||ee.showPreviousValue()}});fi.registerCommandAndKeybindingRule({id:"history.showNext",weight:200,when:x.and(x.has(kt),x.equals(Fi,!0),x.not("isComposing"),Rt.isEqualTo(!1)),primary:18,secondary:[530],handler:a=>{ee==null||ee.showNextValue()}});const S={Visible:Rt,HasFocusedSuggestion:new L("suggestWidgetHasFocusedSuggestion",!1,f("suggestWidgetHasSelection","Whether any suggestion is focused")),DetailsVisible:new L("suggestWidgetDetailsVisible",!1,f("suggestWidgetDetailsVisible","Whether suggestion details are visible")),MultipleSuggestions:new L("suggestWidgetMultipleSuggestions",!1,f("suggestWidgetMultipleSuggestions","Whether there are multiple suggestions to pick from")),MakesTextEdit:new L("suggestionMakesTextEdit",!0,f("suggestionMakesTextEdit","Whether inserting the current suggestion yields in a change or has everything already been typed")),AcceptSuggestionsOnEnter:new L("acceptSuggestionOnEnter",!0,f("acceptSuggestionOnEnter","Whether suggestions are inserted when pressing Enter")),HasInsertAndReplaceRange:new L("suggestionHasInsertAndReplaceRange",!1,f("suggestionHasInsertAndReplaceRange","Whether the current suggestion has insert and replace behaviour")),InsertMode:new L("suggestionInsertMode",void 0,{type:"string",description:f("suggestionInsertMode","Whether the default behaviour is to insert or replace")}),CanResolve:new L("suggestionCanResolve",!1,f("suggestionCanResolve","Whether the current suggestion supports to resolve further details"))},ae=new ms("suggestWidgetStatusBar");class xn{constructor(e,t,i,s){var n;this.position=e,this.completion=t,this.container=i,this.provider=s,this.isInvalid=!1,this.score=ct.Default,this.distance=0,this.textLabel=typeof t.label=="string"?t.label:(n=t.label)==null?void 0:n.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,D.isIRange(t.range)?(this.editStart=new z(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new z(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new z(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||D.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new z(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new z(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new z(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||D.spansMultipleLines(t.range.insert)||D.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof s.resolveCompletionItem!="function"&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration!==void 0?this._resolveDuration:-1}async resolve(e){if(!this._resolveCache){const t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),i=new Ee(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(s=>{Object.assign(this.completion,s),this._resolveDuration=i.elapsed()},s=>{vs(s)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}}const Ze=class Ze{constructor(e=2,t=new Set,i=new Set,s=new Map,n=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=i,this.providerItemsToReuse=s,this.showDeprecated=n}};Ze.default=new Ze;let Ge=Ze;class yn{constructor(e,t,i,s){this.items=e,this.needsClipboard=t,this.durations=i,this.disposable=s}}async function zi(a,e,t,i=Ge.default,s={triggerKind:0},n=Si.None){const o=new Ee;t=t.clone();const r=e.getWordAtPosition(t),l=r?new D(t.lineNumber,r.startColumn,t.lineNumber,r.endColumn):D.fromPositions(t),h={replace:l,insert:l.setEndPosition(t.lineNumber,t.column)},c=[],u=new A,d=[];let g=!1;const p=(m,w,v)=>{var C;let y=!1;if(!w)return y;for(const b of w.suggestions)if(!i.kindFilter.has(b.kind)){if(!i.showDeprecated&&((C=b==null?void 0:b.tags)!=null&&C.includes(1)))continue;b.range||(b.range=h),b.sortText||(b.sortText=typeof b.label=="string"?b.label:b.label.label),!g&&b.insertTextRules&&b.insertTextRules&4&&(g=qe.guessNeedsClipboard(b.insertText)),c.push(new xn(t,b,w,m)),y=!0}return ws(w)&&u.add(w),d.push({providerName:m._debugDisplayName??"unknown_provider",elapsedProvider:w.duration??-1,elapsedOverall:v.elapsed()}),y},_=(async()=>{})();for(const m of a.orderedGroups(e)){let w=!1;if(await Promise.all(m.map(async v=>{if(i.providerItemsToReuse.has(v)){const y=i.providerItemsToReuse.get(v);y.forEach(C=>c.push(C)),w=w||y.length>0;return}if(!(i.providerFilter.size>0&&!i.providerFilter.has(v)))try{const y=new Ee,C=await v.provideCompletionItems(e,t,s,n);w=p(v,C,y)||w}catch(y){bi(y)}})),w||n.isCancellationRequested)break}return await _,n.isCancellationRequested?(u.dispose(),Promise.reject(new bs)):new yn(c.sort(In(i.snippetSortOrder)),g,{entries:d,elapsed:o.elapsed()},u)}function Ft(a,e){if(a.sortTextLow&&e.sortTextLow){if(a.sortTextLow<e.sortTextLow)return-1;if(a.sortTextLow>e.sortTextLow)return 1}return a.textLabel<e.textLabel?-1:a.textLabel>e.textLabel?1:a.completion.kind-e.completion.kind}function Dn(a,e){if(a.completion.kind!==e.completion.kind){if(a.completion.kind===27)return-1;if(e.completion.kind===27)return 1}return Ft(a,e)}function Tn(a,e){if(a.completion.kind!==e.completion.kind){if(a.completion.kind===27)return 1;if(e.completion.kind===27)return-1}return Ft(a,e)}const st=new Map;st.set(0,Dn);st.set(2,Tn);st.set(1,Ft);function In(a){return st.get(a)}mi.registerCommand("_executeCompletionItemProvider",async(a,...e)=>{const[t,i,s,n]=e;re(ve.isUri(t)),re(z.isIPosition(i)),re(typeof s=="string"||!s),re(typeof n=="number"||!n);const{completionProvider:o}=a.get(Nt),r=await a.get(Ss).createModelReference(t);try{const l={incomplete:!1,suggestions:[]},h=[],c=r.object.textEditorModel.validatePosition(i),u=await zi(o,r.object.textEditorModel,c,void 0,{triggerCharacter:s??void 0,triggerKind:s?1:0});for(const d of u.items)h.length<(n??0)&&h.push(d.resolve(Si.None)),l.incomplete=l.incomplete||d.container.incomplete,l.suggestions.push(d.completion);try{return await Promise.all(h),l}finally{setTimeout(()=>u.disposable.dispose(),100)}}finally{r.dispose()}});function Ln(a,e){var t;(t=a.getContribution("editor.contrib.suggestController"))==null||t.triggerSuggest(new Set().add(e),void 0,!0)}class ze{static isAllOff(e){return e.other==="off"&&e.comments==="off"&&e.strings==="off"}static isAllOn(e){return e.other==="on"&&e.comments==="on"&&e.strings==="on"}static valueFor(e,t){switch(t){case 1:return e.comments;case 2:return e.strings;default:return e.other}}}function ii(a,e=Cs){return $i(a,e)?a.charAt(0).toUpperCase()+a.slice(1):a}var Nn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Mn=function(a,e){return function(t,i){e(t,i,a)}};class si{constructor(e){this._delegates=e}resolve(e){for(const t of this._delegates){const i=t.resolve(e);if(i!==void 0)return i}}}class ni{constructor(e,t,i,s){this._model=e,this._selection=t,this._selectionIdx=i,this._overtypingCapturer=s}resolve(e){const{name:t}=e;if(t==="SELECTION"||t==="TM_SELECTED_TEXT"){let i=this._model.getValueInRange(this._selection)||void 0,s=this._selection.startLineNumber!==this._selection.endLineNumber;if(!i&&this._overtypingCapturer){const n=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);n&&(i=n.value,s=n.multiline)}if(i&&s&&e.snippet){const n=this._model.getLineContent(this._selection.startLineNumber),o=Pe(n,0,this._selection.startColumn-1);let r=o;e.snippet.walk(h=>h===e?!1:(h instanceof F&&(r=Pe(xs(h.value).pop())),!0));const l=ys(r,o);i=i.replace(/(\r\n|\r|\n)(.*)/g,(h,c,u)=>`${c}${r.substr(l)}${u}`)}return i}else{if(t==="TM_CURRENT_LINE")return this._model.getLineContent(this._selection.positionLineNumber);if(t==="TM_CURRENT_WORD"){const i=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return i&&i.word||void 0}else{if(t==="TM_LINE_INDEX")return String(this._selection.positionLineNumber-1);if(t==="TM_LINE_NUMBER")return String(this._selection.positionLineNumber);if(t==="CURSOR_INDEX")return String(this._selectionIdx);if(t==="CURSOR_NUMBER")return String(this._selectionIdx+1)}}}}class oi{constructor(e,t){this._labelService=e,this._model=t}resolve(e){const{name:t}=e;if(t==="TM_FILENAME")return Le(this._model.uri.fsPath);if(t==="TM_FILENAME_BASE"){const i=Le(this._model.uri.fsPath),s=i.lastIndexOf(".");return s<=0?i:i.slice(0,s)}else{if(t==="TM_DIRECTORY")return Ds(this._model.uri.fsPath)==="."?"":this._labelService.getUriLabel(Ui(this._model.uri));if(t==="TM_FILEPATH")return this._labelService.getUriLabel(this._model.uri);if(t==="RELATIVE_FILEPATH")return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}}}class ri{constructor(e,t,i,s){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=i,this._spread=s}resolve(e){if(e.name!=="CLIPBOARD")return;const t=this._readClipboardText();if(t){if(this._spread){const i=t.split(/\r\n|\n|\r/).filter(s=>!Ts(s));if(i.length===this._selectionCount)return i[this._selectionIdx]}return t}}}let Ke=class{constructor(e,t,i){this._model=e,this._selection=t,this._languageConfigurationService=i}resolve(e){const{name:t}=e,i=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),s=this._languageConfigurationService.getLanguageConfiguration(i).comments;if(s){if(t==="LINE_COMMENT")return s.lineCommentToken||void 0;if(t==="BLOCK_COMMENT_START")return s.blockCommentStartToken||void 0;if(t==="BLOCK_COMMENT_END")return s.blockCommentEndToken||void 0}}};Ke=Nn([Mn(2,Pt)],Ke);const K=class K{constructor(){this._date=new Date}resolve(e){const{name:t}=e;if(t==="CURRENT_YEAR")return String(this._date.getFullYear());if(t==="CURRENT_YEAR_SHORT")return String(this._date.getFullYear()).slice(-2);if(t==="CURRENT_MONTH")return String(this._date.getMonth().valueOf()+1).padStart(2,"0");if(t==="CURRENT_DATE")return String(this._date.getDate().valueOf()).padStart(2,"0");if(t==="CURRENT_HOUR")return String(this._date.getHours().valueOf()).padStart(2,"0");if(t==="CURRENT_MINUTE")return String(this._date.getMinutes().valueOf()).padStart(2,"0");if(t==="CURRENT_SECOND")return String(this._date.getSeconds().valueOf()).padStart(2,"0");if(t==="CURRENT_DAY_NAME")return K.dayNames[this._date.getDay()];if(t==="CURRENT_DAY_NAME_SHORT")return K.dayNamesShort[this._date.getDay()];if(t==="CURRENT_MONTH_NAME")return K.monthNames[this._date.getMonth()];if(t==="CURRENT_MONTH_NAME_SHORT")return K.monthNamesShort[this._date.getMonth()];if(t==="CURRENT_SECONDS_UNIX")return String(Math.floor(this._date.getTime()/1e3));if(t==="CURRENT_TIMEZONE_OFFSET"){const i=this._date.getTimezoneOffset(),s=i>0?"-":"+",n=Math.trunc(Math.abs(i/60)),o=n<10?"0"+n:n,r=Math.abs(i)-n*60,l=r<10?"0"+r:r;return s+o+":"+l}}};K.dayNames=[f("Sunday","Sunday"),f("Monday","Monday"),f("Tuesday","Tuesday"),f("Wednesday","Wednesday"),f("Thursday","Thursday"),f("Friday","Friday"),f("Saturday","Saturday")],K.dayNamesShort=[f("SundayShort","Sun"),f("MondayShort","Mon"),f("TuesdayShort","Tue"),f("WednesdayShort","Wed"),f("ThursdayShort","Thu"),f("FridayShort","Fri"),f("SaturdayShort","Sat")],K.monthNames=[f("January","January"),f("February","February"),f("March","March"),f("April","April"),f("May","May"),f("June","June"),f("July","July"),f("August","August"),f("September","September"),f("October","October"),f("November","November"),f("December","December")],K.monthNamesShort=[f("JanuaryShort","Jan"),f("FebruaryShort","Feb"),f("MarchShort","Mar"),f("AprilShort","Apr"),f("MayShort","May"),f("JuneShort","Jun"),f("JulyShort","Jul"),f("AugustShort","Aug"),f("SeptemberShort","Sep"),f("OctoberShort","Oct"),f("NovemberShort","Nov"),f("DecemberShort","Dec")];let Je=K;class ai{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;const t=gn(this._workspaceService.getWorkspace());if(!pn(t)){if(e.name==="WORKSPACE_NAME")return this._resolveWorkspaceName(t);if(e.name==="WORKSPACE_FOLDER")return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(Yt(e))return Le(e.uri.path);let t=Le(e.configPath.path);return t.endsWith(Qt)&&(t=t.substr(0,t.length-Qt.length-1)),t}_resoveWorkspacePath(e){if(Yt(e))return ii(e.uri.fsPath);const t=Le(e.configPath.path);let i=e.configPath.fsPath;return i.endsWith(t)&&(i=i.substr(0,i.length-t.length-1)),i?ii(i):"/"}}class li{resolve(e){const{name:t}=e;if(t==="RANDOM")return Math.random().toString().slice(-6);if(t==="RANDOM_HEX")return Math.random().toString(16).slice(-6);if(t==="UUID")return mn()}}var En=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Pn=function(a,e){return function(t,i){e(t,i,a)}},j;const U=class U{constructor(e,t,i){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=i,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=Ht(t.placeholders,V.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw new Error("Snippet not initialized!");if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;const e=this._editor.getModel();this._editor.changeDecorations(t=>{for(const i of this._snippet.placeholders){const s=this._snippet.offset(i),n=this._snippet.fullLen(i),o=D.fromPositions(e.getPositionAt(this._offset+s),e.getPositionAt(this._offset+s+n)),r=i.isFinalTabstop?U._decor.inactiveFinal:U._decor.inactive,l=t.addDecoration(o,r);this._placeholderDecorations.set(i,l)}})}move(e){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){const s=[];for(const n of this._placeholderGroups[this._placeholderGroupsIdx])if(n.transform){const o=this._placeholderDecorations.get(n),r=this._editor.getModel().getDecorationRange(o),l=this._editor.getModel().getValueInRange(r),h=n.transform.resolve(l).split(/\r\n|\r|\n/);for(let c=1;c<h.length;c++)h[c]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+h[c]);s.push(Re.replace(r,h.join(this._editor.getModel().getEOL())))}s.length>0&&this._editor.executeEdits("snippet.placeholderTransform",s)}let t=!1;e===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,t=!0):e===!1&&this._placeholderGroupsIdx>0&&(this._placeholderGroupsIdx-=1,t=!0);const i=this._editor.getModel().changeDecorations(s=>{const n=new Set,o=[];for(const r of this._placeholderGroups[this._placeholderGroupsIdx]){const l=this._placeholderDecorations.get(r),h=this._editor.getModel().getDecorationRange(l);o.push(new Me(h.startLineNumber,h.startColumn,h.endLineNumber,h.endColumn)),t=t&&this._hasPlaceholderBeenCollapsed(r),s.changeDecorationOptions(l,r.isFinalTabstop?U._decor.activeFinal:U._decor.active),n.add(r);for(const c of this._snippet.enclosingPlaceholders(r)){const u=this._placeholderDecorations.get(c);s.changeDecorationOptions(u,c.isFinalTabstop?U._decor.activeFinal:U._decor.active),n.add(c)}}for(const[r,l]of this._placeholderDecorations)n.has(r)||s.changeDecorationOptions(l,r.isFinalTabstop?U._decor.inactiveFinal:U._decor.inactive);return o});return t?this.move(e):i??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof V){const i=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(i).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){const[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){const e=new Map;for(const t of this._placeholderGroups){let i;for(const s of t){if(s.isFinalTabstop)break;i||(i=[],e.set(s.index,i));const n=this._placeholderDecorations.get(s),o=this._editor.getModel().getDecorationRange(n);if(!o){e.delete(s.index);break}i.push(o)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;const e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!(e!=null&&e.choice))return;const t=this._placeholderDecorations.get(e);if(!t)return;const i=this._editor.getModel().getDecorationRange(t);if(i)return{range:i,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof ye,!e)),e}merge(e){const t=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(i=>{for(const s of this._placeholderGroups[this._placeholderGroupsIdx]){const n=e.shift();console.assert(n._offset!==-1),console.assert(!n._placeholderDecorations);const o=n._snippet.placeholderInfo.last.index;for(const l of n._snippet.placeholderInfo.all)l.isFinalTabstop?l.index=s.index+(o+1)/this._nestingLevel:l.index=s.index+l.index/this._nestingLevel;this._snippet.replace(s,n._snippet.children);const r=this._placeholderDecorations.get(s);i.removeDecoration(r),this._placeholderDecorations.delete(s);for(const l of n._snippet.placeholders){const h=n._snippet.offset(l),c=n._snippet.fullLen(l),u=D.fromPositions(t.getPositionAt(n._offset+h),t.getPositionAt(n._offset+h+c)),d=i.addDecoration(u,U._decor.inactive);this._placeholderDecorations.set(l,d)}}this._placeholderGroups=Ht(this._snippet.placeholders,V.compareByIndex)})}};U._decor={active:De.register({description:"snippet-placeholder-1",stickiness:0,className:"snippet-placeholder"}),inactive:De.register({description:"snippet-placeholder-2",stickiness:1,className:"snippet-placeholder"}),activeFinal:De.register({description:"snippet-placeholder-3",stickiness:1,className:"finish-snippet-placeholder"}),inactiveFinal:De.register({description:"snippet-placeholder-4",stickiness:1,className:"finish-snippet-placeholder"})};let Ye=U;const di={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let pt=j=class{static adjustWhitespace(e,t,i,s,n){const o=e.getLineContent(t.lineNumber),r=Pe(o,0,t.column-1);let l;return s.walk(h=>{if(!(h instanceof F)||h.parent instanceof ye||n&&!n.has(h))return!0;const c=h.value.split(/\r\n|\r|\n/);if(i){const d=s.offset(h);if(d===0)c[0]=e.normalizeIndentation(c[0]);else{l=l??s.toString();const g=l.charCodeAt(d-1);(g===10||g===13)&&(c[0]=e.normalizeIndentation(r+c[0]))}for(let g=1;g<c.length;g++)c[g]=e.normalizeIndentation(r+c[g])}const u=c.join(e.getEOL());return u!==h.value&&(h.parent.replace(h,[new F(u)]),l=void 0),!0}),r}static adjustSelection(e,t,i,s){if(i!==0||s!==0){const{positionLineNumber:n,positionColumn:o}=t,r=o-i,l=o+s,h=e.validateRange({startLineNumber:n,startColumn:r,endLineNumber:n,endColumn:l});t=Me.createWithDirection(h.startLineNumber,h.startColumn,h.endLineNumber,h.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,i,s,n,o,r,l,h){const c=[],u=[];if(!e.hasModel())return{edits:c,snippets:u};const d=e.getModel(),g=e.invokeWithinContext(C=>C.get(Xt)),p=e.invokeWithinContext(C=>new oi(C.get(Gt),d)),_=()=>r,m=d.getValueInRange(j.adjustSelection(d,e.getSelection(),i,0)),w=d.getValueInRange(j.adjustSelection(d,e.getSelection(),0,s)),v=d.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),y=e.getSelections().map((C,b)=>({selection:C,idx:b})).sort((C,b)=>D.compareRangesUsingStarts(C.selection,b.selection));for(const{selection:C,idx:b}of y){let T=j.adjustSelection(d,C,i,0),M=j.adjustSelection(d,C,0,s);m!==d.getValueInRange(T)&&(T=C),w!==d.getValueInRange(M)&&(M=C);const se=C.setStartPosition(T.startLineNumber,T.startColumn).setEndPosition(M.endLineNumber,M.endColumn),me=new qe().parse(t,!0,n),he=se.getStartPosition(),ot=j.adjustWhitespace(d,he,o||b>0&&v!==d.getLineFirstNonWhitespaceColumn(C.positionLineNumber),me);me.resolveVariables(new si([p,new ri(_,b,y.length,e.getOption(79)==="spread"),new ni(d,C,b,l),new Ke(d,C,h),new Je,new ai(g),new li])),c[b]=Re.replace(se,me.toString()),c[b].identifier={major:b,minor:0},c[b]._isTracked=!0,u[b]=new Ye(e,me,ot)}return{edits:c,snippets:u}}static createEditsAndSnippetsFromEdits(e,t,i,s,n,o,r){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};const l=[],h=e.getModel(),c=new qe,u=new Ae,d=new si([e.invokeWithinContext(p=>new oi(p.get(Gt),h)),new ri(()=>n,0,e.getSelections().length,e.getOption(79)==="spread"),new ni(h,e.getSelection(),0,o),new Ke(h,e.getSelection(),r),new Je,new ai(e.invokeWithinContext(p=>p.get(Xt))),new li]);t=t.sort((p,_)=>D.compareRangesUsingStarts(p.range,_.range));let g=0;for(let p=0;p<t.length;p++){const{range:_,template:m}=t[p];if(p>0){const b=t[p-1].range,T=D.fromPositions(b.getEndPosition(),_.getStartPosition()),M=new F(h.getValueInRange(T));u.appendChild(M),g+=M.value.length}const w=c.parseFragment(m,u);j.adjustWhitespace(h,_.getStartPosition(),!0,u,new Set(w)),u.resolveVariables(d);const v=u.toString(),y=v.slice(g);g=v.length;const C=Re.replace(_,y);C.identifier={major:p,minor:0},C._isTracked=!0,l.push(C)}return c.ensureFinalTabstop(u,i,!0),{edits:l,snippets:[new Ye(e,u,"")]}}constructor(e,t,i=di,s){this._editor=e,this._template=t,this._options=i,this._languageConfigurationService=s,this._templateMerges=[],this._snippets=[]}dispose(){Oe(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(" -> ")}"`}insert(){if(!this._editor.hasModel())return;const{edits:e,snippets:t}=typeof this._template=="string"?j.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):j.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=t,this._editor.executeEdits("snippet",e,i=>{const s=i.filter(n=>!!n.identifier);for(let n=0;n<t.length;n++)t[n].initialize(s[n].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):s.map(n=>Me.fromPositions(n.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=di){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);const{edits:i,snippets:s}=j.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits("snippet",i,n=>{const o=n.filter(l=>!!l.identifier);for(let l=0;l<s.length;l++)s[l].initialize(o[l].textChange);const r=s[0].isTrivialSnippet;if(!r){for(const l of this._snippets)l.merge(s);console.assert(s.length===0)}return this._snippets[0].hasPlaceholder&&!r?this._move(void 0):o.map(l=>Me.fromPositions(l.range.getEndPosition()))})}next(){const e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){const e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){const t=[];for(const i of this._snippets){const s=i.move(e);t.push(...s)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;const e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;const t=new Map;for(const i of this._snippets){const s=i.computePossibleSelections();if(t.size===0)for(const[n,o]of s){o.sort(D.compareRangesUsingStarts);for(const r of e)if(o[0].containsRange(r)){t.set(n,[]);break}}if(t.size===0)return!1;t.forEach((n,o)=>{n.push(...s.get(o))})}e.sort(D.compareRangesUsingStarts);for(const[i,s]of t){if(s.length!==e.length){t.delete(i);continue}s.sort(D.compareRangesUsingStarts);for(let n=0;n<s.length;n++)if(!s[n].containsRange(e[n])){t.delete(i);continue}}return t.size>0}};pt=j=En([Pn(3,Pt)],pt);var On=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},He=function(a,e){return function(t,i){e(t,i,a)}},be;const hi={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};var Q;let W=(Q=class{static get(e){return e.getContribution(be.ID)}constructor(e,t,i,s,n){this._editor=e,this._logService=t,this._languageFeaturesService=i,this._languageConfigurationService=n,this._snippetListener=new A,this._modelVersionId=-1,this._inSnippet=be.InSnippetMode.bindTo(s),this._hasNextTabstop=be.HasNextTabstop.bindTo(s),this._hasPrevTabstop=be.HasPrevTabstop.bindTo(s)}dispose(){var e;this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),(e=this._session)==null||e.dispose(),this._snippetListener.dispose()}insert(e,t){try{this._doInsert(e,typeof t>"u"?hi:{...hi,...t})}catch(i){this.cancel(),this._logService.error(i),this._logService.error("snippet_error"),this._logService.error("insert_template=",e),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}_doInsert(e,t){var i;if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!="string"&&this.cancel(),this._session?(re(typeof e=="string"),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new pt(this._editor,e,t,this._languageConfigurationService),this._session.insert()),t.undoStopAfter&&this._editor.getModel().pushStackElement(),(i=this._session)!=null&&i.hasChoice){const s={_debugDisplayName:"snippetChoiceCompletions",provideCompletionItems:(c,u)=>{if(!this._session||c!==this._editor.getModel()||!z.equals(this._editor.getPosition(),u))return;const{activeChoice:d}=this._session;if(!d||d.choice.options.length===0)return;const g=c.getValueInRange(d.range),p=!!d.choice.options.find(m=>m.value===g),_=[];for(let m=0;m<d.choice.options.length;m++){const w=d.choice.options[m];_.push({kind:13,label:w.value,insertText:w.value,sortText:"a".repeat(m+1),range:d.range,filterText:p?`${g}_${w.value}`:void 0,command:{id:"jumpToNextSnippetPlaceholder",title:f("next","Go to next placeholder...")}})}return{suggestions:_}}},n=this._editor.getModel();let o,r=!1;const l=()=>{o==null||o.dispose(),r=!1},h=()=>{r||(o=this._languageFeaturesService.completionProvider.register({language:n.getLanguageId(),pattern:n.uri.fsPath,scheme:n.uri.scheme,exclusive:!0},s),this._snippetListener.add(o),r=!0)};this._choiceCompletions={provider:s,enable:h,disable:l}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(s=>s.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId())return this.cancel();if(!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){var t;if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}const{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){(t=this._choiceCompletions)==null||t.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{Ln(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){var t;this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,(t=this._session)==null||t.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){var e;(e=this._session)==null||e.prev(),this._updateState()}next(){var e;(e=this._session)==null||e.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}},be=Q,Q.ID="snippetController2",Q.InSnippetMode=new L("inSnippetMode",!1,f("inSnippetMode","Whether the editor in current in snippet mode")),Q.HasNextTabstop=new L("hasNextTabstop",!1,f("hasNextTabstop","Whether there is a next tab stop when in snippet mode")),Q.HasPrevTabstop=new L("hasPrevTabstop",!1,f("hasPrevTabstop","Whether there is a previous tab stop when in snippet mode")),Q);W=be=On([He(1,Mt),He(2,Nt),He(3,ie),He(4,Pt)],W);wi(W.ID,W,4);const nt=vi.bindToContribution(W.get);N(new nt({id:"jumpToNextSnippetPlaceholder",precondition:x.and(W.InSnippetMode,W.HasNextTabstop),handler:a=>a.next(),kbOpts:{weight:130,kbExpr:I.textInputFocus,primary:2}}));N(new nt({id:"jumpToPrevSnippetPlaceholder",precondition:x.and(W.InSnippetMode,W.HasPrevTabstop),handler:a=>a.prev(),kbOpts:{weight:130,kbExpr:I.textInputFocus,primary:1026}}));N(new nt({id:"leaveSnippet",precondition:W.InSnippetMode,handler:a=>a.cancel(!0),kbOpts:{weight:130,kbExpr:I.textInputFocus,primary:9,secondary:[1033]}}));N(new nt({id:"acceptSnippet",precondition:W.InSnippetMode,handler:a=>a.finish()}));var Rn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},ci=function(a,e){return function(t,i){e(t,i,a)}},Te;class At{constructor(e){this.name=e}select(e,t,i){if(i.length===0)return 0;const s=i[0].score[0];for(let n=0;n<i.length;n++){const{score:o,completion:r}=i[n];if(o[0]!==s)break;if(r.preselect)return n}return 0}}class ui extends At{constructor(){super("first")}memorize(e,t,i){}toJSON(){}fromJSON(){}}class kn extends At{constructor(){super("recentlyUsed"),this._cache=new ji(300,.66),this._seq=0}memorize(e,t,i){const s=`${e.getLanguageId()}/${i.textLabel}`;this._cache.set(s,{touch:this._seq++,type:i.completion.kind,insertText:i.completion.insertText})}select(e,t,i){if(i.length===0)return 0;const s=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(s))return super.select(e,t,i);const n=i[0].score[0];let o=-1,r=-1,l=-1;for(let h=0;h<i.length&&i[h].score[0]===n;h++){const c=`${e.getLanguageId()}/${i[h].textLabel}`,u=this._cache.peek(c);if(u&&u.touch>l&&u.type===i[h].completion.kind&&u.insertText===i[h].completion.insertText&&(l=u.touch,r=h),i[h].completion.preselect&&o===-1)return o=h}return r!==-1?r:o!==-1?o:0}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();const t=0;for(const[i,s]of e)s.touch=t,s.type=typeof s.type=="number"?s.type:It.fromString(s.type),this._cache.set(i,s);this._seq=this._cache.size}}class Fn extends At{constructor(){super("recentlyUsedByPrefix"),this._trie=fn.forStrings(),this._seq=0}memorize(e,t,i){const{word:s}=e.getWordUntilPosition(t),n=`${e.getLanguageId()}/${s}`;this._trie.set(n,{type:i.completion.kind,insertText:i.completion.insertText,touch:this._seq++})}select(e,t,i){const{word:s}=e.getWordUntilPosition(t);if(!s)return super.select(e,t,i);const n=`${e.getLanguageId()}/${s}`;let o=this._trie.get(n);if(o||(o=this._trie.findSubstr(n)),o)for(let r=0;r<i.length;r++){const{kind:l,insertText:h}=i[r].completion;if(l===o.type&&h===o.insertText)return r}return super.select(e,t,i)}toJSON(){const e=[];return this._trie.forEach((t,i)=>e.push([i,t])),e.sort((t,i)=>-(t[1].touch-i[1].touch)).forEach((t,i)=>t[1].touch=i),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(const[t,i]of e)i.type=typeof i.type=="number"?i.type:It.fromString(i.type),this._trie.set(t,i)}}}var le;let ft=(le=class{constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new A,this._persistSoon=new Is(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(i=>{i.reason===nn.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,i){this._withStrategy(e,t).memorize(e,t,i),this._persistSoon.schedule()}select(e,t,i){return this._withStrategy(e,t).select(e,t,i)}_withStrategy(e,t){var s;const i=this._configService.getValue("editor.suggestSelection",{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(((s=this._strategy)==null?void 0:s.name)!==i){this._saveState();const n=Te._strategyCtors.get(i)||ui;this._strategy=new n;try{const r=this._configService.getValue("editor.suggest.shareSuggestSelections")?0:1,l=this._storageService.get(`${Te._storagePrefix}/${i}`,r);l&&this._strategy.fromJSON(JSON.parse(l))}catch{}}return this._strategy}_saveState(){if(this._strategy){const t=this._configService.getValue("editor.suggest.shareSuggestSelections")?0:1,i=JSON.stringify(this._strategy);this._storageService.store(`${Te._storagePrefix}/${this._strategy.name}`,i,t,1)}}},Te=le,le._strategyCtors=new Map([["recentlyUsedByPrefix",Fn],["recentlyUsed",kn],["first",ui]]),le._storagePrefix="suggest/memories",le);ft=Te=Rn([ci(0,Mi),ci(1,gi)],ft);const Hi=Ls("ISuggestMemories");Qs(Hi,ft,1);var An=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Wn=function(a,e){return function(t,i){e(t,i,a)}},_t,ge;let Qe=(ge=class{constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=_t.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(i=>i.hasChanged(124)&&this._update()),this._update()}dispose(){var e;this._configListener.dispose(),(e=this._selectionListener)==null||e.dispose(),this._ckAtEnd.reset()}_update(){const e=this._editor.getOption(124)==="on";if(this._enabled!==e)if(this._enabled=e,this._enabled){const t=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}const i=this._editor.getModel(),s=this._editor.getSelection(),n=i.getWordAtPosition(s.getStartPosition());if(!n){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(n.endColumn===s.getStartPosition().column)};this._selectionListener=this._editor.onDidChangeCursorSelection(t),t()}else this._selectionListener&&(this._ckAtEnd.reset(),this._selectionListener.dispose(),this._selectionListener=void 0)}},_t=ge,ge.AtEnd=new L("atEndOfWord",!1),ge);Qe=_t=An([Wn(1,ie)],Qe);var zn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Hn=function(a,e){return function(t,i){e(t,i,a)}},Ie,pe;let Ce=(pe=class{constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=Ie.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){var e;this._ckOtherSuggestions.reset(),(e=this._listener)==null||e.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},i){if(e.items.length===0){this.reset();return}if(Ie._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=i,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,i){let s=i;for(let n=t.items.length;n>0&&(s=(s+t.items.length+(e?1:-1))%t.items.length,!(s===i||!t.items[s].completion.additionalTextEdits));n--);return s}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=Ie._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}},Ie=pe,pe.OtherSuggestions=new L("hasOtherSuggestions",!1),pe);Ce=Ie=zn([Hn(1,ie)],Ce);class Bn{constructor(e,t,i,s){this._disposables=new A,this._disposables.add(i.onDidSuggest(n=>{n.completionModel.items.length===0&&this.reset()})),this._disposables.add(i.onDidCancel(n=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(n=>{if(this._active&&!t.isFrozen()&&i.state!==0){const o=n.charCodeAt(n.length-1);this._active.acceptCharacters.has(o)&&e.getOption(0)&&s(this._active.item)}}))}_onItem(e){if(!e||!Ci(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;const t=new Ns;for(const i of e.item.completion.commitCharacters)i.length>0&&t.add(i.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}}const B=class B{async provideSelectionRanges(e,t){const i=[];for(const s of t){const n=[];i.push(n);const o=new Map;await new Promise(r=>B._bracketsRightYield(r,0,e,s,o)),await new Promise(r=>B._bracketsLeftYield(r,0,e,s,o,n))}return i}static _bracketsRightYield(e,t,i,s,n){const o=new Map,r=Date.now();for(;;){if(t>=B._maxRounds){e();break}if(!s){e();break}const l=i.bracketPairs.findNextBracket(s);if(!l){e();break}if(Date.now()-r>B._maxDuration){setTimeout(()=>B._bracketsRightYield(e,t+1,i,s,n));break}if(l.bracketInfo.isOpeningBracket){const c=l.bracketInfo.bracketText,u=o.has(c)?o.get(c):0;o.set(c,u+1)}else{const c=l.bracketInfo.getOpeningBrackets()[0].bracketText;let u=o.has(c)?o.get(c):0;if(u-=1,o.set(c,Math.max(0,u)),u<0){let d=n.get(c);d||(d=new Ms,n.set(c,d)),d.push(l.range)}}s=l.range.getEndPosition()}}static _bracketsLeftYield(e,t,i,s,n,o){const r=new Map,l=Date.now();for(;;){if(t>=B._maxRounds&&n.size===0){e();break}if(!s){e();break}const h=i.bracketPairs.findPrevBracket(s);if(!h){e();break}if(Date.now()-l>B._maxDuration){setTimeout(()=>B._bracketsLeftYield(e,t+1,i,s,n,o));break}if(h.bracketInfo.isOpeningBracket){const u=h.bracketInfo.bracketText;let d=r.has(u)?r.get(u):0;if(d-=1,r.set(u,Math.max(0,d)),d<0){const g=n.get(u);if(g){const p=g.shift();g.size===0&&n.delete(u);const _=D.fromPositions(h.range.getEndPosition(),p.getStartPosition()),m=D.fromPositions(h.range.getStartPosition(),p.getEndPosition());o.push({range:_}),o.push({range:m}),B._addBracketLeading(i,m,o)}}}else{const u=h.bracketInfo.getOpeningBrackets()[0].bracketText,d=r.has(u)?r.get(u):0;r.set(u,d+1)}s=h.range.getStartPosition()}}static _addBracketLeading(e,t,i){if(t.startLineNumber===t.endLineNumber)return;const s=t.startLineNumber,n=e.getLineFirstNonWhitespaceColumn(s);n!==0&&n!==t.startColumn&&(i.push({range:D.fromPositions(new z(s,n),t.getEndPosition())}),i.push({range:D.fromPositions(new z(s,1),t.getEndPosition())}));const o=s-1;if(o>0){const r=e.getLineFirstNonWhitespaceColumn(o);r===t.startColumn&&r!==e.getLineLastNonWhitespaceColumn(o)&&(i.push({range:D.fromPositions(new z(o,r),t.getEndPosition())}),i.push({range:D.fromPositions(new z(o,1),t.getEndPosition())}))}}};B._maxDuration=30,B._maxRounds=2;let mt=B;const J=class J{static async create(e,t){if(!t.getOption(119).localityBonus||!t.hasModel())return J.None;const i=t.getModel(),s=t.getPosition();if(!e.canComputeWordRanges(i.uri))return J.None;const[n]=await new mt().provideSelectionRanges(i,[s]);if(n.length===0)return J.None;const o=await e.computeWordRanges(i.uri,n[0].range);if(!o)return J.None;const r=i.getWordUntilPosition(s);return delete o[r.word],new class extends J{distance(l,h){if(!s.equals(t.getPosition()))return 0;if(h.kind===17)return 2<<20;const c=typeof h.label=="string"?h.label:h.label.label,u=o[c];if(Es(u))return 2<<20;const d=Ps(u,D.fromPositions(l),D.compareRangesUsingStarts),g=d>=0?u[d]:u[Math.max(0,~d-1)];let p=n.length;for(const _ of n){if(!D.containsRange(_.range,g))break;p-=1}return p}}}};J.None=new class extends J{distance(){return 0}};let St=J;class ue{constructor(e,t,i,s,n,o,r=pi.default,l=void 0){this.clipboardText=l,this._snippetCompareFn=ue._compareCompletionItems,this._items=e,this._column=t,this._wordDistance=s,this._options=n,this._refilterKind=1,this._lineContext=i,this._fuzzyScoreOptions=r,o==="top"?this._snippetCompareFn=ue._compareCompletionItemsSnippetsUp:o==="bottom"&&(this._snippetCompareFn=ue._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();const e=new Set;for(const[t,i]of this.getItemsByProvider())i.length>0&&i[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;const e=[],{leadingLineContent:t,characterCountDelta:i}=this._lineContext;let s="",n="";const o=this._refilterKind===1?this._items:this._filteredItems,r=[],l=!this._options.filterGraceful||o.length>2e3?qi:Gi;for(let h=0;h<o.length;h++){const c=o[h];if(c.isInvalid)continue;const u=this._itemsByProvider.get(c.provider);u?u.push(c):this._itemsByProvider.set(c.provider,[c]);const d=c.position.column-c.editStart.column,g=d+i-(c.position.column-this._column);if(s.length!==g&&(s=g===0?"":t.slice(-g),n=s.toLowerCase()),c.word=s,g===0)c.score=ct.Default;else{let p=0;for(;p<d;){const _=s.charCodeAt(p);if(_===32||_===9)p+=1;else break}if(p>=g)c.score=ct.Default;else if(typeof c.completion.filterText=="string"){const _=l(s,n,p,c.completion.filterText,c.filterTextLow,0,this._fuzzyScoreOptions);if(!_)continue;Os(c.completion.filterText,c.textLabel)===0?c.score=_:(c.score=Ki(s,n,p,c.textLabel,c.labelLow,0),c.score[0]=_[0])}else{const _=l(s,n,p,c.textLabel,c.labelLow,0,this._fuzzyScoreOptions);if(!_)continue;c.score=_}}c.idx=h,c.distance=this._wordDistance.distance(c.position,c.completion),r.push(c),e.push(c.textLabel.length)}this._filteredItems=r.sort(this._snippetCompareFn),this._refilterKind=0,this._stats={pLabelLen:e.length?Rs(e.length-.85,e,(h,c)=>h-c):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===27)return 1;if(t.completion.kind===27)return-1}return ue._compareCompletionItems(e,t)}static _compareCompletionItemsSnippetsUp(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===27)return-1;if(t.completion.kind===27)return 1}return ue._compareCompletionItems(e,t)}}const Y=class Y extends ks{constructor(e,t){super(),this.contextKeyService=e,this.model=t,this.inlineCompletionVisible=Y.inlineSuggestionVisible.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentation=Y.inlineSuggestionHasIndentation.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentationLessThanTabSize=Y.inlineSuggestionHasIndentationLessThanTabSize.bindTo(this.contextKeyService),this.suppressSuggestions=Y.suppressSuggestions.bindTo(this.contextKeyService),this._register(Kt(i=>{const s=this.model.read(i),n=s==null?void 0:s.state.read(i),o=!!(n!=null&&n.inlineCompletion)&&(n==null?void 0:n.primaryGhostText)!==void 0&&!(n!=null&&n.primaryGhostText.isEmpty());this.inlineCompletionVisible.set(o),n!=null&&n.primaryGhostText&&(n!=null&&n.inlineCompletion)&&this.suppressSuggestions.set(n.inlineCompletion.inlineCompletion.source.inlineCompletions.suppressSuggestions)})),this._register(Kt(i=>{const s=this.model.read(i);let n=!1,o=!0;const r=s==null?void 0:s.primaryGhostText.read(i);if(s!=null&&s.selectedSuggestItem&&r&&r.parts.length>0){const{column:l,lines:h}=r.parts[0],c=h[0],u=s.textModel.getLineIndentColumn(r.lineNumber);if(l<=u){let g=Fs(c);g===-1&&(g=c.length-1),n=g>0;const p=s.textModel.getOptions().tabSize;o=on.visibleColumnFromColumn(c,g+1,p)<p}}this.inlineCompletionSuggestsIndentation.set(n),this.inlineCompletionSuggestsIndentationLessThanTabSize.set(o)}))}};Y.inlineSuggestionVisible=new L("inlineSuggestionVisible",!1,f("inlineSuggestionVisible","Whether an inline suggestion is visible")),Y.inlineSuggestionHasIndentation=new L("inlineSuggestionHasIndentation",!1,f("inlineSuggestionHasIndentation","Whether the inline suggestion starts with whitespace")),Y.inlineSuggestionHasIndentationLessThanTabSize=new L("inlineSuggestionHasIndentationLessThanTabSize",!0,f("inlineSuggestionHasIndentationLessThanTabSize","Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab")),Y.suppressSuggestions=new L("inlineSuggestionSuppressSuggestions",void 0,f("suppressSuggestions","Whether suggestions should be suppressed for the current suggestion"));let Fe=Y;var Vn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},ne=function(a,e){return function(t,i){e(t,i,a)}},bt;class ce{static shouldAutoTrigger(e){if(!e.hasModel())return!1;const t=e.getModel(),i=e.getPosition();t.tokenization.tokenizeIfCheap(i.lineNumber);const s=t.getWordAtPosition(i);return!(!s||s.endColumn!==i.column&&s.startColumn+1!==i.column||!isNaN(Number(s.word)))}constructor(e,t,i){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=i}}function $n(a,e,t){if(!e.getContextKeyValue(Fe.inlineSuggestionVisible.key))return!0;const i=e.getContextKeyValue(Fe.suppressSuggestions.key);return i!==void 0?!i:!a.getOption(62).suppressSuggestions}function Un(a,e,t){if(!e.getContextKeyValue("inlineSuggestionVisible"))return!0;const i=e.getContextKeyValue(Fe.suppressSuggestions.key);return i!==void 0?!i:!a.getOption(62).suppressSuggestions}let wt=bt=class{constructor(e,t,i,s,n,o,r,l,h){this._editor=e,this._editorWorkerService=t,this._clipboardService=i,this._telemetryService=s,this._logService=n,this._contextKeyService=o,this._configurationService=r,this._languageFeaturesService=l,this._envService=h,this._toDispose=new A,this._triggerCharacterListener=new A,this._triggerQuickSuggest=new yi,this._triggerState=void 0,this._completionDisposables=new A,this._onDidCancel=new R,this._onDidTrigger=new R,this._onDidSuggest=new R,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._telemetryGate=0,this._currentSelection=this._editor.getSelection()||new Me(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let c=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{c=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{c=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(u=>{c||this._onCursorChange(u)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!c&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){Oe(this._triggerCharacterListener),Oe([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(92)||!this._editor.hasModel()||!this._editor.getOption(122))return;const e=new Map;for(const i of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(const s of i.triggerCharacters||[]){let n=e.get(s);n||(n=new Set,e.set(s,n)),n.add(i)}const t=i=>{var o;if(!Un(this._editor,this._contextKeyService,this._configurationService)||ce.shouldAutoTrigger(this._editor))return;if(!i){const r=this._editor.getPosition();i=this._editor.getModel().getLineContent(r.lineNumber).substr(0,r.column-1)}let s="";As(i.charCodeAt(i.length-1))?Ws(i.charCodeAt(i.length-2))&&(s=i.substr(i.length-2)):s=i.charAt(i.length-1);const n=e.get(s);if(n){const r=new Map;if(this._completionModel)for(const[l,h]of this._completionModel.getItemsByProvider())n.has(l)||r.set(l,h);this.trigger({auto:!0,triggerKind:1,triggerCharacter:s,retrigger:!!this._completionModel,clipboardText:(o=this._completionModel)==null?void 0:o.clipboardText,completionOptions:{providerFilter:n,providerItemsToReuse:r}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?2:1:0}cancel(e=!1){var t;this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),(t=this._requestToken)==null||t.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;const t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==0&&e.reason!==3||e.source!=="keyboard"&&e.source!=="deleteLeft"){this.cancel();return}this._triggerState===void 0&&e.reason===0?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===3&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){var e;ze.isAllOff(this._editor.getOption(90))||this._editor.getOption(119).snippetsPreventQuickSuggestions&&((e=W.get(this._editor))!=null&&e.isInSnippet())||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!ce.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;const t=this._editor.getModel(),i=this._editor.getPosition(),s=this._editor.getOption(90);if(!ze.isAllOff(s)){if(!ze.isAllOn(s)){t.tokenization.tokenizeIfCheap(i.lineNumber);const n=t.tokenization.getLineTokens(i.lineNumber),o=n.getStandardTokenType(n.findTokenIndexAtOffset(Math.max(i.column-1-1,0)));if(ze.valueFor(s,o)!=="on")return}$n(this._editor,this._contextKeyService,this._configurationService)&&this._languageFeaturesService.completionProvider.has(t)&&this.trigger({auto:!0})}},this._editor.getOption(91)))}_refilterCompletionItems(){re(this._editor.hasModel()),re(this._triggerState!==void 0);const e=this._editor.getModel(),t=this._editor.getPosition(),i=new ce(e,t,{...this._triggerState,refilter:!0});this._onNewContext(i)}trigger(e){var d,g,p;if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=new ce(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=i;let s={triggerKind:e.triggerKind??0};e.triggerCharacter&&(s={triggerKind:1,triggerCharacter:e.triggerCharacter}),this._requestToken=new Di;const n=this._editor.getOption(113);let o=1;switch(n){case"top":o=0;break;case"bottom":o=2;break}const{itemKind:r,showDeprecated:l}=bt.createSuggestFilter(this._editor),h=new Ge(o,((d=e.completionOptions)==null?void 0:d.kindFilter)??r,(g=e.completionOptions)==null?void 0:g.providerFilter,(p=e.completionOptions)==null?void 0:p.providerItemsToReuse,l),c=St.create(this._editorWorkerService,this._editor),u=zi(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),h,s,this._requestToken.token);Promise.all([u,c]).then(async([_,m])=>{var b;if((b=this._requestToken)==null||b.dispose(),!this._editor.hasModel())return;let w=e==null?void 0:e.clipboardText;if(!w&&_.needsClipboard&&(w=await this._clipboardService.readText()),this._triggerState===void 0)return;const v=this._editor.getModel(),y=new ce(v,this._editor.getPosition(),e),C={...pi.default,firstMatchCanBeWeak:!this._editor.getOption(119).matchOnWordStartOnly};if(this._completionModel=new ue(_.items,this._context.column,{leadingLineContent:y.leadingLineContent,characterCountDelta:y.column-this._context.column},m,this._editor.getOption(119),this._editor.getOption(113),C,w),this._completionDisposables.add(_.disposable),this._onNewContext(y),this._reportDurationsTelemetry(_.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(const T of _.items)T.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${T.provider._debugDisplayName}`,T.completion)}).catch(Et)}_reportDurationsTelemetry(e){this._telemetryGate++%230===0&&setTimeout(()=>{this._telemetryService.publicLog2("suggest.durations.json",{data:JSON.stringify(e)}),this._logService.debug("suggest.durations.json",e)})}static createSuggestFilter(e){const t=new Set;e.getOption(113)==="none"&&t.add(27);const s=e.getOption(119);return s.showMethods||t.add(0),s.showFunctions||t.add(1),s.showConstructors||t.add(2),s.showFields||t.add(3),s.showVariables||t.add(4),s.showClasses||t.add(5),s.showStructs||t.add(6),s.showInterfaces||t.add(7),s.showModules||t.add(8),s.showProperties||t.add(9),s.showEvents||t.add(10),s.showOperators||t.add(11),s.showUnits||t.add(12),s.showValues||t.add(13),s.showConstants||t.add(14),s.showEnums||t.add(15),s.showEnumMembers||t.add(16),s.showKeywords||t.add(17),s.showWords||t.add(18),s.showColors||t.add(19),s.showFiles||t.add(20),s.showReferences||t.add(21),s.showColors||t.add(22),s.showFolders||t.add(23),s.showTypeParameters||t.add(24),s.showSnippets||t.add(27),s.showUsers||t.add(25),s.showIssues||t.add(26),{itemKind:t,showDeprecated:s.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(Pe(e.leadingLineContent)!==Pe(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(ce.shouldAutoTrigger(this._editor)&&this._context){const i=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:i}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){const t=new Map,i=new Set;for(const[s,n]of this._completionModel.getItemsByProvider())n.length>0&&n[0].container.incomplete?i.add(s):t.set(s,n);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:2,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:i,providerItemsToReuse:t}})}else{const t=this._completionModel.lineContext;let i=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){const s=ce.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(s&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,i=this._completionModel.items.length>0,i&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:i})}}}}};wt=bt=Vn([ne(1,Xs),ne(2,_n),ne(3,xi),ne(4,Mt),ne(5,ie),ne(6,gi),ne(7,Nt),ne(8,rn)],wt);const et=class et{constructor(e,t){this._disposables=new A,this._lastOvertyped=[],this._locked=!1,this._disposables.add(e.onWillType(()=>{if(this._locked||!e.hasModel())return;const i=e.getSelections(),s=i.length;let n=!1;for(let r=0;r<s;r++)if(!i[r].isEmpty()){n=!0;break}if(!n){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];const o=e.getModel();for(let r=0;r<s;r++){const l=i[r];if(o.getValueLengthInRange(l)>et._maxSelectionLength)return;this._lastOvertyped[r]={value:o.getValueInRange(l),multiline:l.startLineNumber!==l.endLineNumber}}})),this._disposables.add(t.onDidTrigger(i=>{this._locked=!0})),this._disposables.add(t.onDidCancel(i=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}};et._maxSelectionLength=51200;let vt=et;var jn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},lt=function(a,e){return function(t,i){e(t,i,a)}};let Ct=class{constructor(e,t,i,s,n){this._menuId=t,this._menuService=s,this._contextKeyService=n,this._menuDisposables=new A,this.element=P(e,E(".suggest-status-bar"));const o=r=>r instanceof Hs?i.createInstance(an,r,{useComma:!0}):void 0;this._leftActions=new Jt(this.element,{actionViewItemProvider:o}),this._rightActions=new Jt(this.element,{actionViewItemProvider:o}),this._leftActions.domNode.classList.add("left"),this._rightActions.domNode.classList.add("right")}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){const e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{const i=[],s=[];for(const[n,o]of e.getActions())n==="left"?i.push(...o):s.push(...o);this._leftActions.clear(),this._leftActions.push(i),this._rightActions.clear(),this._rightActions.push(s)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};Ct=jn([lt(2,it),lt(3,zs),lt(4,ie)],Ct);var qn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Gn=function(a,e){return function(t,i){e(t,i,a)}};function Wt(a){return!!a&&!!(a.completion.documentation||a.completion.detail&&a.completion.detail!==a.completion.label)}let xt=class{constructor(e,t){this._editor=e,this._onDidClose=new R,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new R,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new A,this._renderDisposeable=new A,this._borderWidth=1,this._size=new k(330,0),this.domNode=E(".suggest-details"),this.domNode.classList.add("no-docs"),this._markdownRenderer=t.createInstance(Ji,{editor:e}),this._body=E(".body"),this._scrollbar=new Yi(this._body,{alwaysConsumeMouseWheel:!0}),P(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=P(this._body,E(".header")),this._close=P(this._header,E("span"+je.asCSSSelector(Lt.close))),this._close.title=f("details.close","Close"),this._type=P(this._header,E("p.type")),this._docs=P(this._body,E("p.docs")),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(50)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){const e=this._editor.getOptions(),t=e.get(50),i=t.getMassagedFontFamily(),s=e.get(120)||t.fontSize,n=e.get(121)||t.lineHeight,o=t.fontWeight,r=`${s}px`,l=`${n}px`;this.domNode.style.fontSize=r,this.domNode.style.lineHeight=`${n/s}`,this.domNode.style.fontWeight=o,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=i,this._close.style.height=l,this._close.style.width=l}getLayoutInfo(){const e=this._editor.getOption(121)||this._editor.getOption(50).lineHeight,t=this._borderWidth,i=t*2;return{lineHeight:e,borderWidth:t,borderHeight:i,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=f("loading","Loading..."),this._docs.textContent="",this.domNode.classList.remove("no-docs","no-type"),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){var n;this._renderDisposeable.clear();let{detail:i,documentation:s}=e.completion;if(t){let o="";o+=`score: ${e.score[0]}
`,o+=`prefix: ${e.word??"(no prefix)"}
`,o+=`word: ${e.completion.filterText?e.completion.filterText+" (filterText)":e.textLabel}
`,o+=`distance: ${e.distance} (localityBonus-setting)
`,o+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||"label"}
`,o+=`commit_chars: ${(n=e.completion.commitCharacters)==null?void 0:n.join("")}
`,s=new Qi().appendCodeblock("empty",o),i=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!Wt(e)){this.clearContents();return}if(this.domNode.classList.remove("no-docs","no-type"),i){const o=i.length>1e5?`${i.substr(0,1e5)}`:i;this._type.textContent=o,this._type.title=o,oe(this._type),this._type.classList.toggle("auto-wrap",!/\r?\n^\s+/gmi.test(o))}else rt(this._type),this._type.title="",Z(this._type),this.domNode.classList.add("no-type");if(rt(this._docs),typeof s=="string")this._docs.classList.remove("markdown-docs"),this._docs.textContent=s;else if(s){this._docs.classList.add("markdown-docs"),rt(this._docs);const o=this._markdownRenderer.render(s);this._docs.appendChild(o.element),this._renderDisposeable.add(o),this._renderDisposeable.add(this._markdownRenderer.onDidRenderAsync(()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}))}this.domNode.style.userSelect="text",this.domNode.tabIndex=-1,this._close.onmousedown=o=>{o.preventDefault(),o.stopPropagation()},this._close.onclick=o=>{o.preventDefault(),o.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add("no-docs"),this._type.textContent="",this._docs.textContent=""}get isEmpty(){return this.domNode.classList.contains("no-docs")}get size(){return this._size}layout(e,t){const i=new k(e,t);k.equals(i,this._size)||(this._size=i,Bs(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}};xt=qn([Gn(1,it)],xt);class Kn{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new A,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new Pi,this._resizable.domNode.classList.add("suggest-details-container"),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let i,s,n=0,o=0;this._disposables.add(this._resizable.onDidWillResize(()=>{i=this._topLeft,s=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(r=>{if(i&&s){this.widget.layout(r.dimension.width,r.dimension.height);let l=!1;r.west&&(o=s.width-r.dimension.width,l=!0),r.north&&(n=s.height-r.dimension.height,l=!0),l&&this._applyTopLeft({top:i.top+n,left:i.left+o})}r.done&&(i=void 0,s=void 0,n=0,o=0,this._userSize=r.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return"suggest.details"}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||(this._editor.addOverlayWidget(this),this._added=!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){const i=e.getBoundingClientRect();this._anchorBox=i,this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,i){const s=Ti(this.getDomNode().ownerDocument.body),n=this.widget.getLayoutInfo(),o=new k(220,2*n.lineHeight),r=e.top,l=function(){const b=s.width-(e.left+e.width+n.borderWidth+n.horizontalPadding),T=-n.borderWidth+e.left+e.width,M=new k(b,s.height-e.top-n.borderHeight-n.verticalPadding),se=M.with(void 0,e.top+e.height-n.borderHeight-n.verticalPadding);return{top:r,left:T,fit:b-t.width,maxSizeTop:M,maxSizeBottom:se,minSize:o.with(Math.min(b,o.width))}}(),h=function(){const b=e.left-n.borderWidth-n.horizontalPadding,T=Math.max(n.horizontalPadding,e.left-t.width-n.borderWidth),M=new k(b,s.height-e.top-n.borderHeight-n.verticalPadding),se=M.with(void 0,e.top+e.height-n.borderHeight-n.verticalPadding);return{top:r,left:T,fit:b-t.width,maxSizeTop:M,maxSizeBottom:se,minSize:o.with(Math.min(b,o.width))}}(),c=function(){const b=e.left,T=-n.borderWidth+e.top+e.height,M=new k(e.width-n.borderHeight,s.height-e.top-e.height-n.verticalPadding);return{top:T,left:b,fit:M.height-t.height,maxSizeBottom:M,maxSizeTop:M,minSize:o.with(M.width)}}(),u=[l,h,c],d=u.find(b=>b.fit>=0)??u.sort((b,T)=>T.fit-b.fit)[0],g=e.top+e.height-n.borderHeight;let p,_=t.height;const m=Math.max(d.maxSizeTop.height,d.maxSizeBottom.height);_>m&&(_=m);let w;i?_<=d.maxSizeTop.height?(p=!0,w=d.maxSizeTop):(p=!1,w=d.maxSizeBottom):_<=d.maxSizeBottom.height?(p=!1,w=d.maxSizeBottom):(p=!0,w=d.maxSizeTop);let{top:v,left:y}=d;!p&&_>e.height&&(v=g-_);const C=this._editor.getDomNode();if(C){const b=C.getBoundingClientRect();v-=b.top,y-=b.left}this._applyTopLeft({left:y,top:v}),this._resizable.enableSashes(!p,d===l,p,d!==l),this._resizable.minSize=d.minSize,this._resizable.maxSize=w,this._resizable.layout(_,Math.min(w.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}}var X;(function(a){a[a.FILE=0]="FILE",a[a.FOLDER=1]="FOLDER",a[a.ROOT_FOLDER=2]="ROOT_FOLDER"})(X||(X={}));const Jn=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function Be(a,e,t,i,s){if(je.isThemeIcon(s))return[`codicon-${s.id}`,"predefined-file-icon"];if(ve.isUri(s))return[];const n=i===X.ROOT_FOLDER?["rootfolder-icon"]:i===X.FOLDER?["folder-icon"]:["file-icon"];if(t){let o;if(t.scheme===Ii.data)o=Ue.parseMetaData(t).get(Ue.META_DATA_LABEL);else{const r=t.path.match(Jn);r?(o=Ve(r[2].toLowerCase()),r[1]&&n.push(`${Ve(r[1].toLowerCase())}-name-dir-icon`)):o=Ve(t.authority.toLowerCase())}if(i===X.ROOT_FOLDER)n.push(`${o}-root-name-folder-icon`);else if(i===X.FOLDER)n.push(`${o}-name-folder-icon`);else{if(o){if(n.push(`${o}-name-file-icon`),n.push("name-file-icon"),o.length<=255){const l=o.split(".");for(let h=1;h<l.length;h++)n.push(`${l.slice(h).join(".")}-ext-file-icon`)}n.push("ext-file-icon")}const r=Yn(a,e,t);r&&n.push(`${Ve(r)}-lang-file-icon`)}}return n}function Yn(a,e,t){if(!t)return null;let i=null;if(t.scheme===Ii.data){const n=Ue.parseMetaData(t).get(Ue.META_DATA_MIME);n&&(i=e.getLanguageIdByMimeType(n))}else{const s=a.getModel(t);s&&(i=s.getLanguageId())}return i&&i!==Xi?i:e.guessLanguageIdByFilepathOrFirstLine(t)}function Ve(a){return a.replace(/[\s]/g,"/")}var Qn=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},dt=function(a,e){return function(t,i){e(t,i,a)}};function Bi(a){return`suggest-aria-id:${a}`}const Xn=Zi("suggest-more-info",Lt.chevronRight,f("suggestMoreInfoIcon","Icon for more information in the suggest widget."));var G;const Zn=new(G=class{extract(e,t){if(e.textLabel.match(G._regexStrict))return t[0]=e.textLabel,!0;if(e.completion.detail&&e.completion.detail.match(G._regexStrict))return t[0]=e.completion.detail,!0;if(e.completion.documentation){const i=typeof e.completion.documentation=="string"?e.completion.documentation:e.completion.documentation.value,s=G._regexRelaxed.exec(i);if(s&&(s.index===0||s.index+s[0].length===i.length))return t[0]=s[0],!0}return!1}},G._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/,G._regexStrict=new RegExp(`^${G._regexRelaxed.source}$`,"i"),G);let yt=class{constructor(e,t,i,s){this._editor=e,this._modelService=t,this._languageService=i,this._themeService=s,this._onDidToggleDetails=new R,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=new A,i=e;i.classList.add("show-file-icons");const s=P(e,E(".icon")),n=P(s,E("span.colorspan")),o=P(e,E(".contents")),r=P(o,E(".main")),l=P(r,E(".icon-label.codicon")),h=P(r,E("span.left")),c=P(r,E("span.right")),u=new ln(h,{supportHighlights:!0,supportIcons:!0});t.add(u);const d=P(h,E("span.signature-label")),g=P(h,E("span.qualifier-label")),p=P(c,E("span.details-label")),_=P(c,E("span.readMore"+je.asCSSSelector(Xn)));return _.title=f("readMore","Read More"),{root:i,left:h,right:c,icon:s,colorspan:n,iconLabel:u,iconContainer:l,parametersLabel:d,qualifierLabel:g,detailsLabel:p,readMore:_,disposables:t,configureFont:()=>{const w=this._editor.getOptions(),v=w.get(50),y=v.getMassagedFontFamily(),C=v.fontFeatureSettings,b=w.get(120)||v.fontSize,T=w.get(121)||v.lineHeight,M=v.fontWeight,se=v.letterSpacing,me=`${b}px`,he=`${T}px`,ot=`${se}px`;i.style.fontSize=me,i.style.fontWeight=M,i.style.letterSpacing=ot,r.style.fontFamily=y,r.style.fontFeatureSettings=C,r.style.lineHeight=he,s.style.height=he,s.style.width=he,_.style.height=he,_.style.width=he}}}renderElement(e,t,i){i.configureFont();const{completion:s}=e;i.root.id=Bi(t),i.colorspan.style.backgroundColor="";const n={labelEscapeNewLines:!0,matches:ts(e.score)},o=[];if(s.kind===19&&Zn.extract(e,o))i.icon.className="icon customcolor",i.iconContainer.className="icon hide",i.colorspan.style.backgroundColor=o[0];else if(s.kind===20&&this._themeService.getFileIconTheme().hasFileIcons){i.icon.className="icon hide",i.iconContainer.className="icon hide";const r=Be(this._modelService,this._languageService,ve.from({scheme:"fake",path:e.textLabel}),X.FILE),l=Be(this._modelService,this._languageService,ve.from({scheme:"fake",path:s.detail}),X.FILE);n.extraClasses=r.length>l.length?r:l}else s.kind===23&&this._themeService.getFileIconTheme().hasFolderIcons?(i.icon.className="icon hide",i.iconContainer.className="icon hide",n.extraClasses=[Be(this._modelService,this._languageService,ve.from({scheme:"fake",path:e.textLabel}),X.FOLDER),Be(this._modelService,this._languageService,ve.from({scheme:"fake",path:s.detail}),X.FOLDER)].flat()):(i.icon.className="icon hide",i.iconContainer.className="",i.iconContainer.classList.add("suggest-icon",...je.asClassNameArray(It.toIcon(s.kind))));s.tags&&s.tags.indexOf(1)>=0&&(n.extraClasses=(n.extraClasses||[]).concat(["deprecated"]),n.matches=[]),i.iconLabel.setLabel(e.textLabel,void 0,n),typeof s.label=="string"?(i.parametersLabel.textContent="",i.detailsLabel.textContent=ht(s.detail||""),i.root.classList.add("string-label")):(i.parametersLabel.textContent=ht(s.label.detail||""),i.detailsLabel.textContent=ht(s.label.description||""),i.root.classList.remove("string-label")),this._editor.getOption(119).showInlineDetails?oe(i.detailsLabel):Z(i.detailsLabel),Wt(e)?(i.right.classList.add("can-expand-details"),oe(i.readMore),i.readMore.onmousedown=r=>{r.stopPropagation(),r.preventDefault()},i.readMore.onclick=r=>{r.stopPropagation(),r.preventDefault(),this._onDidToggleDetails.fire()}):(i.right.classList.remove("can-expand-details"),Z(i.readMore),i.readMore.onmousedown=null,i.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};yt=Qn([dt(1,Vs),dt(2,es),dt(3,Ei)],yt);function ht(a){return a.replace(/\r\n|\r|\n/g,"")}var eo=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},$e=function(a,e){return function(t,i){e(t,i,a)}},we;te("editorSuggestWidget.background",is,f("editorSuggestWidgetBackground","Background color of the suggest widget."));te("editorSuggestWidget.border",ss,f("editorSuggestWidgetBorder","Border color of the suggest widget."));const to=te("editorSuggestWidget.foreground",ns,f("editorSuggestWidgetForeground","Foreground color of the suggest widget."));te("editorSuggestWidget.selectedForeground",os,f("editorSuggestWidgetSelectedForeground","Foreground color of the selected entry in the suggest widget."));te("editorSuggestWidget.selectedIconForeground",rs,f("editorSuggestWidgetSelectedIconForeground","Icon foreground color of the selected entry in the suggest widget."));const io=te("editorSuggestWidget.selectedBackground",as,f("editorSuggestWidgetSelectedBackground","Background color of the selected entry in the suggest widget."));te("editorSuggestWidget.highlightForeground",ls,f("editorSuggestWidgetHighlightForeground","Color of the match highlights in the suggest widget."));te("editorSuggestWidget.focusHighlightForeground",ds,f("editorSuggestWidgetFocusHighlightForeground","Color of the match highlights in the suggest widget when an item is focused."));te("editorSuggestWidgetStatus.foreground",hs(to,.5),f("editorSuggestWidgetStatusForeground","Foreground color of the suggest widget status."));class so{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof Sn}`}restore(){const e=this._service.get(this._key,0)??"";try{const t=JSON.parse(e);if(k.is(t))return k.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),0,1)}reset(){this._service.remove(this._key,0)}}var de;let Dt=(de=class{constructor(e,t,i,s,n){this.editor=e,this._storageService=t,this._state=0,this._isAuto=!1,this._pendingLayout=new ut,this._pendingShowDetails=new ut,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new yi,this._disposables=new A,this._onDidSelect=new Bt,this._onDidFocus=new Bt,this._onDidHide=new R,this._onDidShow=new R,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new R,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new Pi,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new no(this,e),this._persistedSize=new so(t,e);class o{constructor(g,p,_=!1,m=!1){this.persistedSize=g,this.currentSize=p,this.persistHeight=_,this.persistWidth=m}}let r;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),r=new o(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(d=>{var g,p;if(this._resize(d.dimension.width,d.dimension.height),r&&(r.persistHeight=r.persistHeight||!!d.north||!!d.south,r.persistWidth=r.persistWidth||!!d.east||!!d.west),!!d.done){if(r){const{itemHeight:_,defaultSize:m}=this.getLayoutInfo(),w=Math.round(_/2);let{width:v,height:y}=this.element.size;(!r.persistHeight||Math.abs(r.currentSize.height-y)<=w)&&(y=((g=r.persistedSize)==null?void 0:g.height)??m.height),(!r.persistWidth||Math.abs(r.currentSize.width-v)<=w)&&(v=((p=r.persistedSize)==null?void 0:p.width)??m.width),this._persistedSize.store(new k(v,y))}this._contentWidget.unlockPreference(),r=void 0}})),this._messageElement=P(this.element.domNode,E(".message")),this._listElement=P(this.element.domNode,E(".tree"));const l=this._disposables.add(n.createInstance(xt,this.editor));l.onDidClose(this.toggleDetails,this,this._disposables),this._details=new Kn(l,this.editor);const h=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(119).showIcons);h();const c=n.createInstance(yt,this.editor);this._disposables.add(c),this._disposables.add(c.onDidToggleDetails(()=>this.toggleDetails())),this._list=new dn("SuggestWidget",this._listElement,{getHeight:d=>this.getLayoutInfo().itemHeight,getTemplateId:d=>"suggestion"},[c],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>"option",getWidgetAriaLabel:()=>f("suggest","Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:d=>{let g=d.textLabel;if(typeof d.completion.label!="string"){const{detail:w,description:v}=d.completion.label;w&&v?g=f("label.full","{0} {1}, {2}",g,w,v):w?g=f("label.detail","{0} {1}",g,w):v&&(g=f("label.desc","{0}, {1}",g,v))}if(!d.isResolved||!this._isDetailsVisible())return g;const{documentation:p,detail:_}=d.completion,m=$s("{0}{1}",_||"",p?typeof p=="string"?p:p.value:"");return f("ariaCurrenttSuggestionReadDetails","{0}, docs: {1}",g,m)}}}),this._list.style(hn({listInactiveFocusBackground:io,listInactiveFocusOutline:cs})),this._status=n.createInstance(Ct,this.element.domNode,ae);const u=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(119).showStatusBar);u(),this._disposables.add(s.onDidColorThemeChange(d=>this._onThemeChange(d))),this._onThemeChange(s.getColorTheme()),this._disposables.add(this._list.onMouseDown(d=>this._onListMouseDownOrTap(d))),this._disposables.add(this._list.onTap(d=>this._onListMouseDownOrTap(d))),this._disposables.add(this._list.onDidChangeSelection(d=>this._onListSelection(d))),this._disposables.add(this._list.onDidChangeFocus(d=>this._onListFocus(d))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(d=>{d.hasChanged(119)&&(u(),h()),this._completionModel&&(d.hasChanged(50)||d.hasChanged(120)||d.hasChanged(121))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=S.Visible.bindTo(i),this._ctxSuggestWidgetDetailsVisible=S.DetailsVisible.bindTo(i),this._ctxSuggestWidgetMultipleSuggestions=S.MultipleSuggestions.bindTo(i),this._ctxSuggestWidgetHasFocusedSuggestion=S.HasFocusedSuggestion.bindTo(i),this._disposables.add(Us(this._details.widget.domNode,"keydown",d=>{this._onDetailsKeydown.fire(d)})),this._disposables.add(this.editor.onMouseDown(d=>this._onEditorMouseDown(d)))}dispose(){var e;this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),(e=this._loadingTimeout)==null||e.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==0&&this._contentWidget.layout()}_onListMouseDownOrTap(e){typeof e.element>"u"||typeof e.index>"u"||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const i=this._completionModel;i&&(this._onDidSelect.fire({item:e,index:t,model:i}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=cn(e.type)?2:1}_onListFocus(e){var s;if(this._ignoreFocusEvents)return;if(!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const t=e.elements[0],i=e.indexes[0];t!==this._focusedItem&&((s=this._currentSuggestionDetails)==null||s.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(i),this._currentSuggestionDetails=js(async n=>{const o=Vt(()=>{this._isDetailsVisible()&&this.showDetails(!0)},250),r=n.onCancellationRequested(()=>o.dispose());try{return await t.resolve(n)}finally{o.dispose(),r.dispose()}}),this._currentSuggestionDetails.then(()=>{i>=this._list.length||t!==this._list.element(i)||(this._ignoreFocusEvents=!0,this._list.splice(i,1,[t]),this._list.setFocus([i]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this.showDetails(!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:Bi(i)}))}).catch(Et)),this._onDidFocus.fire({item:t,index:i,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle("frozen",e===4),this.element.domNode.classList.remove("message"),e){case 0:Z(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add("message"),this._messageElement.textContent=we.LOADING_MESSAGE,Z(this._listElement,this._status.element),oe(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,zt(we.LOADING_MESSAGE);break;case 2:this.element.domNode.classList.add("message"),this._messageElement.textContent=we.NO_SUGGESTIONS_MESSAGE,Z(this._listElement,this._status.element),oe(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,zt(we.NO_SUGGESTIONS_MESSAGE);break;case 3:Z(this._messageElement),oe(this._listElement,this._status.element),this._show();break;case 4:Z(this._messageElement),oe(this._listElement,this._status.element),this._show();break;case 5:Z(this._messageElement),oe(this._listElement,this._status.element),this._details.show(),this._show();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===0&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=Vt(()=>this._setState(1),t)))}showSuggestions(e,t,i,s,n){var l,h;if(this._contentWidget.setPosition(this.editor.getPosition()),(l=this._loadingTimeout)==null||l.dispose(),(h=this._currentSuggestionDetails)==null||h.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),i&&this._state!==2&&this._state!==0){this._setState(4);return}const o=this._completionModel.items.length,r=o===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(o>1),r){this._setState(s?0:2),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(i?4:3),this._list.reveal(t,0),this._list.setFocus(n?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=$t(Ne(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==0&&this._state!==2&&this._state!==1&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===5?(this._setState(3),this._details.widget.domNode.classList.remove("focused")):this._state===3&&this._isDetailsVisible()&&(this._setState(5),this._details.widget.domNode.classList.add("focused"))}toggleDetails(){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):(Wt(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===3||this._state===5||this._state===4)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this.showDetails(!1))}showDetails(e){this._pendingShowDetails.value=$t(Ne(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show(),e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add("shows-details")),this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this.showDetails(!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){var i;this._pendingLayout.clear(),this._pendingShowDetails.clear(),(i=this._loadingTimeout)==null||i.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();const e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===4}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===2||this._state===1||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){var o,r;if(!this.editor.hasModel()||!this.editor.getDomNode())return;const t=Ti(this.element.domNode.ownerDocument.body),i=this.getLayoutInfo();e||(e=i.defaultSize);let s=e.height,n=e.width;if(this._status.element.style.height=`${i.itemHeight}px`,this._state===2||this._state===1)s=i.itemHeight+i.borderHeight,n=i.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new k(n,s),this._contentWidget.setPreference(2);else{const l=t.width-i.borderHeight-2*i.horizontalPadding;n>l&&(n=l);const h=this._completionModel?this._completionModel.stats.pLabelLen*i.typicalHalfwidthCharacterWidth:n,c=i.statusBarHeight+this._list.contentHeight+i.borderHeight,u=i.itemHeight+i.statusBarHeight,d=qs(this.editor.getDomNode()),g=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),p=d.top+g.top+g.height,_=Math.min(t.height-p-i.verticalPadding,c),m=d.top+g.top-i.verticalPadding,w=Math.min(m,c);let v=Math.min(Math.max(w,_)+i.borderHeight,c);s===((o=this._cappedHeight)==null?void 0:o.capped)&&(s=this._cappedHeight.wanted),s<u&&(s=u),s>v&&(s=v),s>_||this._forceRenderingAbove&&m>150?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),v=w):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),v=_),this.element.preferredSize=new k(h,i.defaultSize.height),this.element.maxSize=new k(l,v),this.element.minSize=new k(220,u),this._cappedHeight=s===c?{wanted:((r=this._cappedHeight)==null?void 0:r.wanted)??e.height,capped:s}:void 0}this._resize(n,s)}_resize(e,t){const{width:i,height:s}=this.element.maxSize;e=Math.min(i,e),t=Math.min(s,t);const{statusBarHeight:n}=this.getLayoutInfo();this._list.layout(t-n,e),this._listElement.style.height=`${t-n}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){var e;this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,((e=this._contentWidget.getPosition())==null?void 0:e.preference[0])===2)}getLayoutInfo(){const e=this.editor.getOption(50),t=un(this.editor.getOption(121)||e.lineHeight,8,1e3),i=!this.editor.getOption(119).showStatusBar||this._state===2||this._state===1?0:t,s=this._details.widget.borderWidth,n=2*s;return{itemHeight:t,statusBarHeight:i,borderWidth:s,borderHeight:n,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new k(430,i+12*t+n)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",0,!1)}_setDetailsVisible(e){this._storageService.store("expandSuggestionDocs",e,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}},we=de,de.LOADING_MESSAGE=f("suggestWidget.loading","Loading..."),de.NO_SUGGESTIONS_MESSAGE=f("suggestWidget.noSuggestions","No suggestions."),de);Dt=we=eo([$e(1,Mi),$e(2,ie),$e(3,Ei),$e(4,it)],Dt);class no{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){const{height:e,width:t}=this._widget.element.size,{borderWidth:i,horizontalPadding:s}=this._widget.getLayoutInfo();return new k(t+2*i+s,e+2*i)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}}var oo=function(a,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Se=function(a,e){return function(t,i){e(t,i,a)}},Tt;class ro{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=De.register({description:"suggest-line-suffix",stickiness:1}),e.getLineMaxColumn(t.lineNumber)!==t.column){const s=e.getOffsetAt(t),n=e.getPositionAt(s+1);e.changeDecorations(o=>{this._marker&&o.removeDecoration(this._marker),this._marker=o.addDecoration(D.fromPositions(t,n),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){const t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}}var fe;let _e=(fe=class{static get(e){return e.getContribution(Tt.ID)}constructor(e,t,i,s,n,o,r){this._memoryService=t,this._commandService=i,this._contextKeyService=s,this._instantiationService=n,this._logService=o,this._telemetryService=r,this._lineSuffix=new ut,this._toDispose=new A,this._selectors=new ao(u=>u.priority),this._onWillInsertSuggestItem=new R,this.onWillInsertSuggestItem=this._onWillInsertSuggestItem.event,this.editor=e,this.model=n.createInstance(wt,this.editor),this._selectors.register({priority:0,select:(u,d,g)=>this._memoryService.select(u,d,g)});const l=S.InsertMode.bindTo(s);l.set(e.getOption(119).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>l.set(e.getOption(119).insertMode))),this.widget=this._toDispose.add(new at(Ne(e.getDomNode()),()=>{const u=this._instantiationService.createInstance(Dt,this.editor);this._toDispose.add(u),this._toDispose.add(u.onDidSelect(m=>this._insertSuggestion(m,0),this));const d=new Bn(this.editor,u,this.model,m=>this._insertSuggestion(m,2));this._toDispose.add(d);const g=S.MakesTextEdit.bindTo(this._contextKeyService),p=S.HasInsertAndReplaceRange.bindTo(this._contextKeyService),_=S.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(_i(()=>{g.reset(),p.reset(),_.reset()})),this._toDispose.add(u.onDidFocus(({item:m})=>{const w=this.editor.getPosition(),v=m.editStart.column,y=w.column;let C=!0;this.editor.getOption(1)==="smart"&&this.model.state===2&&!m.completion.additionalTextEdits&&!(m.completion.insertTextRules&4)&&y-v===m.completion.insertText.length&&(C=this.editor.getModel().getValueInRange({startLineNumber:w.lineNumber,startColumn:v,endLineNumber:w.lineNumber,endColumn:y})!==m.completion.insertText),g.set(C),p.set(!z.equals(m.editInsertEnd,m.editReplaceEnd)),_.set(!!m.provider.resolveCompletionItem||!!m.completion.documentation||m.completion.detail!==m.completion.label)})),this._toDispose.add(u.onDetailsKeyDown(m=>{if(m.toKeyCodeChord().equals(new Ut(!0,!1,!1,!1,33))||Gs&&m.toKeyCodeChord().equals(new Ut(!1,!1,!1,!0,33))){m.stopPropagation();return}m.toKeyCodeChord().isModifierKey()||this.editor.focus()})),u})),this._overtypingCapturer=this._toDispose.add(new at(Ne(e.getDomNode()),()=>this._toDispose.add(new vt(this.editor,this.model)))),this._alternatives=this._toDispose.add(new at(Ne(e.getDomNode()),()=>this._toDispose.add(new Ce(this.editor,this._contextKeyService)))),this._toDispose.add(n.createInstance(Qe,e)),this._toDispose.add(this.model.onDidTrigger(u=>{this.widget.value.showTriggered(u.auto,u.shy?250:50),this._lineSuffix.value=new ro(this.editor.getModel(),u.position)})),this._toDispose.add(this.model.onDidSuggest(u=>{if(u.triggerOptions.shy)return;let d=-1;for(const p of this._selectors.itemsOrderedByPriorityDesc)if(d=p.select(this.editor.getModel(),this.editor.getPosition(),u.completionModel.items),d!==-1)break;if(d===-1&&(d=0),this.model.state===0)return;let g=!1;if(u.triggerOptions.auto){const p=this.editor.getOption(119);p.selectionMode==="never"||p.selectionMode==="always"?g=p.selectionMode==="never":p.selectionMode==="whenTriggerCharacter"?g=u.triggerOptions.triggerKind!==1:p.selectionMode==="whenQuickSuggestion"&&(g=u.triggerOptions.triggerKind===1&&!u.triggerOptions.refilter)}this.widget.value.showSuggestions(u.completionModel,d,u.isFrozen,u.triggerOptions.auto,g)})),this._toDispose.add(this.model.onDidCancel(u=>{u.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));const h=S.AcceptSuggestionsOnEnter.bindTo(s),c=()=>{const u=this.editor.getOption(1);h.set(u==="on"||u==="smart")};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>c())),c()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;const i=W.get(this.editor);if(!i)return;this._onWillInsertSuggestItem.fire({item:e.item});const s=this.editor.getModel(),n=s.getAlternativeVersionId(),{item:o}=e,r=[],l=new Di;t&1||this.editor.pushUndoStop();const h=this.getOverwriteInfo(o,!!(t&8));this._memoryService.memorize(s,this.editor.getPosition(),o);const c=o.isResolved;let u=-1,d=-1;if(Array.isArray(o.completion.additionalTextEdits)){this.model.cancel();const p=qt.capture(this.editor);this.editor.executeEdits("suggestController.additionalTextEdits.sync",o.completion.additionalTextEdits.map(_=>{let m=D.lift(_.range);if(m.startLineNumber===o.position.lineNumber&&m.startColumn>o.position.column){const w=this.editor.getPosition().column-o.position.column,v=w,y=D.spansMultipleLines(m)?0:w;m=new D(m.startLineNumber,m.startColumn+v,m.endLineNumber,m.endColumn+y)}return Re.replaceMove(m,_.text)})),p.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!c){const p=new Ee;let _;const m=s.onDidChangeContent(C=>{if(C.isFlush){l.cancel(),m.dispose();return}for(const b of C.changes){const T=D.getEndPosition(b.range);(!_||z.isBefore(T,_))&&(_=T)}}),w=t;t|=2;let v=!1;const y=this.editor.onWillType(()=>{y.dispose(),v=!0,w&2||this.editor.pushUndoStop()});r.push(o.resolve(l.token).then(()=>{if(!o.completion.additionalTextEdits||l.token.isCancellationRequested)return;if(_&&o.completion.additionalTextEdits.some(b=>z.isBefore(_,D.getStartPosition(b.range))))return!1;v&&this.editor.pushUndoStop();const C=qt.capture(this.editor);return this.editor.executeEdits("suggestController.additionalTextEdits.async",o.completion.additionalTextEdits.map(b=>Re.replaceMove(D.lift(b.range),b.text))),C.restoreRelativeVerticalPositionOfCursor(this.editor),(v||!(w&2))&&this.editor.pushUndoStop(),!0}).then(C=>{this._logService.trace("[suggest] async resolving of edits DONE (ms, applied?)",p.elapsed(),C),d=C===!0?1:C===!1?0:-2}).finally(()=>{m.dispose(),y.dispose()}))}let{insertText:g}=o.completion;if(o.completion.insertTextRules&4||(g=qe.escape(g)),this.model.cancel(),i.insert(g,{overwriteBefore:h.overwriteBefore,overwriteAfter:h.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(o.completion.insertTextRules&1),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value}),t&2||this.editor.pushUndoStop(),o.completion.command)if(o.completion.command.id===Xe.id)this.model.trigger({auto:!0,retrigger:!0});else{const p=new Ee;r.push(this._commandService.executeCommand(o.completion.command.id,...o.completion.command.arguments?[...o.completion.command.arguments]:[]).catch(_=>{o.completion.extensionId?bi(_):Et(_)}).finally(()=>{u=p.elapsed()}))}t&4&&this._alternatives.value.set(e,p=>{for(l.cancel();s.canUndo();){n!==s.getAlternativeVersionId()&&s.undo(),this._insertSuggestion(p,3|(t&8?8:0));break}}),this._alertCompletionItem(o),Promise.all(r).finally(()=>{this._reportSuggestionAcceptedTelemetry(o,s,c,u,d,e.index,e.model.items),this.model.clear(),l.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,i,s,n,o,r){var d;if(Math.floor(Math.random()*100)===0)return;const l=new Map;for(let g=0;g<Math.min(30,r.length);g++){const p=r[g].textLabel;l.has(p)?l.get(p).push(g):l.set(p,[g])}const h=l.get(e.textLabel),u=h&&h.length>1?h[0]:-1;this._telemetryService.publicLog2("suggest.acceptedSuggestion",{extensionId:((d=e.extensionId)==null?void 0:d.value)??"unknown",providerId:e.provider._debugDisplayName??"unknown",kind:e.completion.kind,basenameHash:Ks(us(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:gs(t.uri),resolveInfo:e.provider.resolveCompletionItem?i?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:s,additionalEditsAsync:n,index:o,firstIndex:u})}getOverwriteInfo(e,t){re(this.editor.hasModel());let i=this.editor.getOption(119).insertMode==="replace";t&&(i=!i);const s=e.position.column-e.editStart.column,n=(i?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,o=this.editor.getPosition().column-e.position.column,r=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:s+o,overwriteAfter:n+r}}_alertCompletionItem(e){if(Ci(e.completion.additionalTextEdits)){const t=f("aria.alert.snippet","Accepting '{0}' made {1} additional edits",e.textLabel,e.completion.additionalTextEdits.length);ps(t)}}triggerSuggest(e,t,i){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:i?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;const t=this.editor.getPosition(),i=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},s=n=>{if(n.completion.insertTextRules&4||n.completion.additionalTextEdits)return!0;const o=this.editor.getPosition(),r=n.editStart.column,l=o.column;return l-r!==n.completion.insertText.length?!0:this.editor.getModel().getValueInRange({startLineNumber:o.lineNumber,startColumn:r,endLineNumber:o.lineNumber,endColumn:l})!==n.completion.insertText};jt.once(this.model.onDidTrigger)(n=>{const o=[];jt.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{Oe(o),i()},void 0,o),this.model.onDidSuggest(({completionModel:r})=>{if(Oe(o),r.items.length===0){i();return}const l=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),r.items),h=r.items[l];if(!s(h)){i();return}this.editor.pushUndoStop(),this._insertSuggestion({index:l,item:h,model:r},7)},void 0,o)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,0),this.editor.focus()}acceptSelectedSuggestion(e,t){const i=this.widget.value.getFocusedItem();let s=0;e&&(s|=4),t&&(s|=8),this._insertSuggestion(i,s)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.value.forceRenderingAbove()}stopForceRenderingAbove(){this.widget.isInitialized&&this.widget.value.stopForceRenderingAbove()}registerSelector(e){return this._selectors.register(e)}},Tt=fe,fe.ID="editor.contrib.suggestController",fe);_e=Tt=oo([Se(1,Hi),Se(2,Js),Se(3,ie),Se(4,it),Se(5,Mt),Se(6,xi)],_e);class ao{constructor(e){this.prioritySelector=e,this._items=new Array}register(e){if(this._items.indexOf(e)!==-1)throw new Error("Value is already registered");return this._items.push(e),this._items.sort((t,i)=>this.prioritySelector(i)-this.prioritySelector(t)),{dispose:()=>{const t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}}const tt=class tt extends Li{constructor(){super({id:tt.id,label:f("suggest.trigger.label","Trigger Suggest"),alias:"Trigger Suggest",precondition:x.and(I.writable,I.hasCompletionItemProvider,S.Visible.toNegated()),kbOpts:{kbExpr:I.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(e,t,i){const s=_e.get(t);if(!s)return;let n;i&&typeof i=="object"&&i.auto===!0&&(n=!0),s.triggerSuggest(void 0,n,void 0)}};tt.id="editor.action.triggerSuggest";let Xe=tt;wi(_e.ID,_e,2);Ni(Xe);const H=190,O=vi.bindToContribution(_e.get);N(new O({id:"acceptSelectedSuggestion",precondition:x.and(S.Visible,S.HasFocusedSuggestion),handler(a){a.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:x.and(S.Visible,I.textInputFocus),weight:H},{primary:3,kbExpr:x.and(S.Visible,I.textInputFocus,S.AcceptSuggestionsOnEnter,S.MakesTextEdit),weight:H}],menuOpts:[{menuId:ae,title:f("accept.insert","Insert"),group:"left",order:1,when:S.HasInsertAndReplaceRange.toNegated()},{menuId:ae,title:f("accept.insert","Insert"),group:"left",order:1,when:x.and(S.HasInsertAndReplaceRange,S.InsertMode.isEqualTo("insert"))},{menuId:ae,title:f("accept.replace","Replace"),group:"left",order:1,when:x.and(S.HasInsertAndReplaceRange,S.InsertMode.isEqualTo("replace"))}]}));N(new O({id:"acceptAlternativeSelectedSuggestion",precondition:x.and(S.Visible,I.textInputFocus,S.HasFocusedSuggestion),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:1027,secondary:[1026]},handler(a){a.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:ae,group:"left",order:2,when:x.and(S.HasInsertAndReplaceRange,S.InsertMode.isEqualTo("insert")),title:f("accept.replace","Replace")},{menuId:ae,group:"left",order:2,when:x.and(S.HasInsertAndReplaceRange,S.InsertMode.isEqualTo("replace")),title:f("accept.insert","Insert")}]}));mi.registerCommandAlias("acceptSelectedSuggestionOnEnter","acceptSelectedSuggestion");N(new O({id:"hideSuggestWidget",precondition:S.Visible,handler:a=>a.cancelSuggestWidget(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:9,secondary:[1033]}}));N(new O({id:"selectNextSuggestion",precondition:x.and(S.Visible,x.or(S.MultipleSuggestions,S.HasFocusedSuggestion.negate())),handler:a=>a.selectNextSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}}));N(new O({id:"selectNextPageSuggestion",precondition:x.and(S.Visible,x.or(S.MultipleSuggestions,S.HasFocusedSuggestion.negate())),handler:a=>a.selectNextPageSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:12,secondary:[2060]}}));N(new O({id:"selectLastSuggestion",precondition:x.and(S.Visible,x.or(S.MultipleSuggestions,S.HasFocusedSuggestion.negate())),handler:a=>a.selectLastSuggestion()}));N(new O({id:"selectPrevSuggestion",precondition:x.and(S.Visible,x.or(S.MultipleSuggestions,S.HasFocusedSuggestion.negate())),handler:a=>a.selectPrevSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}}));N(new O({id:"selectPrevPageSuggestion",precondition:x.and(S.Visible,x.or(S.MultipleSuggestions,S.HasFocusedSuggestion.negate())),handler:a=>a.selectPrevPageSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:11,secondary:[2059]}}));N(new O({id:"selectFirstSuggestion",precondition:x.and(S.Visible,x.or(S.MultipleSuggestions,S.HasFocusedSuggestion.negate())),handler:a=>a.selectFirstSuggestion()}));N(new O({id:"focusSuggestion",precondition:x.and(S.Visible,S.HasFocusedSuggestion.negate()),handler:a=>a.focusSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}}));N(new O({id:"focusAndAcceptSuggestion",precondition:x.and(S.Visible,S.HasFocusedSuggestion.negate()),handler:a=>{a.focusSuggestion(),a.acceptSelectedSuggestion(!0,!1)}}));N(new O({id:"toggleSuggestionDetails",precondition:x.and(S.Visible,S.HasFocusedSuggestion),handler:a=>a.toggleSuggestionDetails(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:ae,group:"right",order:1,when:x.and(S.DetailsVisible,S.CanResolve),title:f("detail.more","Show Less")},{menuId:ae,group:"right",order:1,when:x.and(S.DetailsVisible.toNegated(),S.CanResolve),title:f("detail.less","Show More")}]}));N(new O({id:"toggleExplainMode",precondition:S.Visible,handler:a=>a.toggleExplainMode(),kbOpts:{weight:100,primary:2138}}));N(new O({id:"toggleSuggestionFocus",precondition:S.Visible,handler:a=>a.toggleSuggestionFocus(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:2570,mac:{primary:778}}}));N(new O({id:"insertBestCompletion",precondition:x.and(I.textInputFocus,x.equals("config.editor.tabCompletion","on"),Qe.AtEnd,S.Visible.toNegated(),Ce.OtherSuggestions.toNegated(),W.InSnippetMode.toNegated()),handler:(a,e)=>{a.triggerSuggestAndAcceptBest(Ys(e)?{fallback:"tab",...e}:{fallback:"tab"})},kbOpts:{weight:H,primary:2}}));N(new O({id:"insertNextSuggestion",precondition:x.and(I.textInputFocus,x.equals("config.editor.tabCompletion","on"),Ce.OtherSuggestions,S.Visible.toNegated(),W.InSnippetMode.toNegated()),handler:a=>a.acceptNextSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:2}}));N(new O({id:"insertPrevSuggestion",precondition:x.and(I.textInputFocus,x.equals("config.editor.tabCompletion","on"),Ce.OtherSuggestions,S.Visible.toNegated(),W.InSnippetMode.toNegated()),handler:a=>a.acceptPrevSuggestion(),kbOpts:{weight:H,kbExpr:I.textInputFocus,primary:1026}}));Ni(class extends Li{constructor(){super({id:"editor.action.resetSuggestSize",label:f("suggest.reset.label","Reset Suggest Widget Size"),alias:"Reset Suggest Widget Size",precondition:void 0})}run(a,e){var t;(t=_e.get(e))==null||t.resetWidgetSize()}});export{_e as SuggestController,Xe as TriggerSuggestAction};
