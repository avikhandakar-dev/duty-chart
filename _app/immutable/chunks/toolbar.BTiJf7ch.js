import{aK as Cs,q as Ke,w as ws,aL as Ds,aM as _s,H as K,D as F,aN as oi,aA as Ns,l as C,S as A,V as ce,aO as zi,aP as Hi,a0 as z,aJ as Lt,U as Is,G as ri,X as _,aQ as H,a as xs,J as P,aR as Es,aD as Ri,aS as ks,aT as Ge,a5 as gt,aU as _t,aV as Be,ah as De,aW as Vt,at as Wt,aX as Bi,N as Vi,aY as Ts,t as k,aZ as li,a_ as Ls,T as ue,Q as fe,a$ as ai,b0 as Ms,b1 as di,b2 as le,b3 as Nt,b4 as tt,b5 as hi,aB as Ps,b6 as Fs,b7 as ci,b8 as Os,a9 as As,O as Ks,o as zs,z as M,aH as Wi,b9 as Hs,aa as Rs,ba as $i,bb as Bs,bc as Vs,h as it,F as W,c as te,bd as Ws,a4 as $s,g as ze,be as Gs,bf as je,ar as qe,bg as Ue,bh as Ye,ai as js,bi as Mt,bj as qs,bk as Us,bl as ve,bm as Ys,bn as Xs,bo as Js,aq as Gi,$ as ji,bp as ui,bq as Qs,br as Zs}from"./editorContextKeys.Cdn_dJhV.js";import{L as en,e as j,D as tn,H as sn,J as nn,K as on,N as rn,F as Xe,i as ln,a as fi,O as an,Q as dn,R as hn,T as gi}from"./iconRegistry.BJgxFQLY.js";import{i as cn,n as R,o as un,p as qi,q as oe,L as pt,S as pi,u as fn,r as Ui,g as Yi,s as Xi,t as gn,f as pn,v as Te,w as xe,x as mn,y as bn,z as yn,B as Sn,D as vn,E as mt,l as bt,G as He,J as Cn,K as wn,N as Dn,P as _e,Q as Ne,R as _n,U as Nn,V as In,e as Ji,X as xn,A as En,Y as mi,Z as Qi,_ as kn}from"./codeEditorWidget.CXeIzSuq.js";import{r as Tn}from"./stableEditorScroll.DHPB0mmN.js";class re{constructor(e,t,i,s){this.originalStart=e,this.originalLength=t,this.modifiedStart=i,this.modifiedLength=s}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}}class bi{constructor(e){this.source=e}getElements(){const e=this.source,t=new Int32Array(e.length);for(let i=0,s=e.length;i<s;i++)t[i]=e.charCodeAt(i);return t}}function qo(r,e,t){return new ae(new bi(r),new bi(e)).ComputeDiff(t).changes}class be{static Assert(e,t){if(!e)throw new Error(t)}}class ye{static Copy(e,t,i,s,n){for(let o=0;o<n;o++)i[s+o]=e[t+o]}static Copy2(e,t,i,s,n){for(let o=0;o<n;o++)i[s+o]=e[t+o]}}class yi{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new re(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(e,t){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,t),this.m_originalCount++}AddModifiedElement(e,t){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,t),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}}class ae{constructor(e,t,i=null){this.ContinueProcessingPredicate=i,this._originalSequence=e,this._modifiedSequence=t;const[s,n,o]=ae._getElements(e),[l,a,h]=ae._getElements(t);this._hasStrings=o&&h,this._originalStringElements=s,this._originalElementsOrHash=n,this._modifiedStringElements=l,this._modifiedElementsOrHash=a,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _isStringArray(e){return e.length>0&&typeof e[0]=="string"}static _getElements(e){const t=e.getElements();if(ae._isStringArray(t)){const i=new Int32Array(t.length);for(let s=0,n=t.length;s<n;s++)i[s]=Cs(t[s],0);return[t,i,!0]}return t instanceof Int32Array?[[],t,!1]:[[],new Int32Array(t),!1]}ElementsAreEqual(e,t){return this._originalElementsOrHash[e]!==this._modifiedElementsOrHash[t]?!1:this._hasStrings?this._originalStringElements[e]===this._modifiedStringElements[t]:!0}ElementsAreStrictEqual(e,t){if(!this.ElementsAreEqual(e,t))return!1;const i=ae._getStrictElement(this._originalSequence,e),s=ae._getStrictElement(this._modifiedSequence,t);return i===s}static _getStrictElement(e,t){return typeof e.getStrictElement=="function"?e.getStrictElement(t):null}OriginalElementsAreEqual(e,t){return this._originalElementsOrHash[e]!==this._originalElementsOrHash[t]?!1:this._hasStrings?this._originalStringElements[e]===this._originalStringElements[t]:!0}ModifiedElementsAreEqual(e,t){return this._modifiedElementsOrHash[e]!==this._modifiedElementsOrHash[t]?!1:this._hasStrings?this._modifiedStringElements[e]===this._modifiedStringElements[t]:!0}ComputeDiff(e){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,e)}_ComputeDiff(e,t,i,s,n){const o=[!1];let l=this.ComputeDiffRecursive(e,t,i,s,o);return n&&(l=this.PrettifyChanges(l)),{quitEarly:o[0],changes:l}}ComputeDiffRecursive(e,t,i,s,n){for(n[0]=!1;e<=t&&i<=s&&this.ElementsAreEqual(e,i);)e++,i++;for(;t>=e&&s>=i&&this.ElementsAreEqual(t,s);)t--,s--;if(e>t||i>s){let d;return i<=s?(be.Assert(e===t+1,"originalStart should only be one more than originalEnd"),d=[new re(e,0,i,s-i+1)]):e<=t?(be.Assert(i===s+1,"modifiedStart should only be one more than modifiedEnd"),d=[new re(e,t-e+1,i,0)]):(be.Assert(e===t+1,"originalStart should only be one more than originalEnd"),be.Assert(i===s+1,"modifiedStart should only be one more than modifiedEnd"),d=[]),d}const o=[0],l=[0],a=this.ComputeRecursionPoint(e,t,i,s,o,l,n),h=o[0],c=l[0];if(a!==null)return a;if(!n[0]){const d=this.ComputeDiffRecursive(e,h,i,c,n);let f=[];return n[0]?f=[new re(h+1,t-(h+1)+1,c+1,s-(c+1)+1)]:f=this.ComputeDiffRecursive(h+1,t,c+1,s,n),this.ConcatenateChanges(d,f)}return[new re(e,t-e+1,i,s-i+1)]}WALKTRACE(e,t,i,s,n,o,l,a,h,c,d,f,g,p,u,m,S,N){let I=null,L=null,v=new yi,T=t,y=i,b=g[0]-m[0]-s,w=-1073741824,O=this.m_forwardHistory.length-1;do{const E=b+e;E===T||E<y&&h[E-1]<h[E+1]?(d=h[E+1],p=d-b-s,d<w&&v.MarkNextChange(),w=d,v.AddModifiedElement(d+1,p),b=E+1-e):(d=h[E-1]+1,p=d-b-s,d<w&&v.MarkNextChange(),w=d-1,v.AddOriginalElement(d,p+1),b=E-1-e),O>=0&&(h=this.m_forwardHistory[O],e=h[0],T=1,y=h.length-1)}while(--O>=-1);if(I=v.getReverseChanges(),N[0]){let E=g[0]+1,D=m[0]+1;if(I!==null&&I.length>0){const ne=I[I.length-1];E=Math.max(E,ne.getOriginalEnd()),D=Math.max(D,ne.getModifiedEnd())}L=[new re(E,f-E+1,D,u-D+1)]}else{v=new yi,T=o,y=l,b=g[0]-m[0]-a,w=1073741824,O=S?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{const E=b+n;E===T||E<y&&c[E-1]>=c[E+1]?(d=c[E+1]-1,p=d-b-a,d>w&&v.MarkNextChange(),w=d+1,v.AddOriginalElement(d+1,p+1),b=E+1-n):(d=c[E-1],p=d-b-a,d>w&&v.MarkNextChange(),w=d,v.AddModifiedElement(d+1,p+1),b=E-1-n),O>=0&&(c=this.m_reverseHistory[O],n=c[0],T=1,y=c.length-1)}while(--O>=-1);L=v.getChanges()}return this.ConcatenateChanges(I,L)}ComputeRecursionPoint(e,t,i,s,n,o,l){let a=0,h=0,c=0,d=0,f=0,g=0;e--,i--,n[0]=0,o[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];const p=t-e+(s-i),u=p+1,m=new Int32Array(u),S=new Int32Array(u),N=s-i,I=t-e,L=e-i,v=t-s,y=(I-N)%2===0;m[N]=e,S[I]=t,l[0]=!1;for(let b=1;b<=p/2+1;b++){let w=0,O=0;c=this.ClipDiagonalBound(N-b,b,N,u),d=this.ClipDiagonalBound(N+b,b,N,u);for(let D=c;D<=d;D+=2){D===c||D<d&&m[D-1]<m[D+1]?a=m[D+1]:a=m[D-1]+1,h=a-(D-N)-L;const ne=a;for(;a<t&&h<s&&this.ElementsAreEqual(a+1,h+1);)a++,h++;if(m[D]=a,a+h>w+O&&(w=a,O=h),!y&&Math.abs(D-I)<=b-1&&a>=S[D])return n[0]=a,o[0]=h,ne<=S[D]&&b<=1448?this.WALKTRACE(N,c,d,L,I,f,g,v,m,S,a,t,n,h,s,o,y,l):null}const E=(w-e+(O-i)-b)/2;if(this.ContinueProcessingPredicate!==null&&!this.ContinueProcessingPredicate(w,E))return l[0]=!0,n[0]=w,o[0]=O,E>0&&b<=1448?this.WALKTRACE(N,c,d,L,I,f,g,v,m,S,a,t,n,h,s,o,y,l):(e++,i++,[new re(e,t-e+1,i,s-i+1)]);f=this.ClipDiagonalBound(I-b,b,I,u),g=this.ClipDiagonalBound(I+b,b,I,u);for(let D=f;D<=g;D+=2){D===f||D<g&&S[D-1]>=S[D+1]?a=S[D+1]-1:a=S[D-1],h=a-(D-I)-v;const ne=a;for(;a>e&&h>i&&this.ElementsAreEqual(a,h);)a--,h--;if(S[D]=a,y&&Math.abs(D-N)<=b&&a<=m[D])return n[0]=a,o[0]=h,ne>=m[D]&&b<=1448?this.WALKTRACE(N,c,d,L,I,f,g,v,m,S,a,t,n,h,s,o,y,l):null}if(b<=1447){let D=new Int32Array(d-c+2);D[0]=N-c+1,ye.Copy2(m,c,D,1,d-c+1),this.m_forwardHistory.push(D),D=new Int32Array(g-f+2),D[0]=I-f+1,ye.Copy2(S,f,D,1,g-f+1),this.m_reverseHistory.push(D)}}return this.WALKTRACE(N,c,d,L,I,f,g,v,m,S,a,t,n,h,s,o,y,l)}PrettifyChanges(e){for(let t=0;t<e.length;t++){const i=e[t],s=t<e.length-1?e[t+1].originalStart:this._originalElementsOrHash.length,n=t<e.length-1?e[t+1].modifiedStart:this._modifiedElementsOrHash.length,o=i.originalLength>0,l=i.modifiedLength>0;for(;i.originalStart+i.originalLength<s&&i.modifiedStart+i.modifiedLength<n&&(!o||this.OriginalElementsAreEqual(i.originalStart,i.originalStart+i.originalLength))&&(!l||this.ModifiedElementsAreEqual(i.modifiedStart,i.modifiedStart+i.modifiedLength));){const h=this.ElementsAreStrictEqual(i.originalStart,i.modifiedStart);if(this.ElementsAreStrictEqual(i.originalStart+i.originalLength,i.modifiedStart+i.modifiedLength)&&!h)break;i.originalStart++,i.modifiedStart++}const a=[null];if(t<e.length-1&&this.ChangesOverlap(e[t],e[t+1],a)){e[t]=a[0],e.splice(t+1,1),t--;continue}}for(let t=e.length-1;t>=0;t--){const i=e[t];let s=0,n=0;if(t>0){const d=e[t-1];s=d.originalStart+d.originalLength,n=d.modifiedStart+d.modifiedLength}const o=i.originalLength>0,l=i.modifiedLength>0;let a=0,h=this._boundaryScore(i.originalStart,i.originalLength,i.modifiedStart,i.modifiedLength);for(let d=1;;d++){const f=i.originalStart-d,g=i.modifiedStart-d;if(f<s||g<n||o&&!this.OriginalElementsAreEqual(f,f+i.originalLength)||l&&!this.ModifiedElementsAreEqual(g,g+i.modifiedLength))break;const u=(f===s&&g===n?5:0)+this._boundaryScore(f,i.originalLength,g,i.modifiedLength);u>h&&(h=u,a=d)}i.originalStart-=a,i.modifiedStart-=a;const c=[null];if(t>0&&this.ChangesOverlap(e[t-1],e[t],c)){e[t-1]=c[0],e.splice(t,1),t++;continue}}if(this._hasStrings)for(let t=1,i=e.length;t<i;t++){const s=e[t-1],n=e[t],o=n.originalStart-s.originalStart-s.originalLength,l=s.originalStart,a=n.originalStart+n.originalLength,h=a-l,c=s.modifiedStart,d=n.modifiedStart+n.modifiedLength,f=d-c;if(o<5&&h<20&&f<20){const g=this._findBetterContiguousSequence(l,h,c,f,o);if(g){const[p,u]=g;(p!==s.originalStart+s.originalLength||u!==s.modifiedStart+s.modifiedLength)&&(s.originalLength=p-s.originalStart,s.modifiedLength=u-s.modifiedStart,n.originalStart=p+o,n.modifiedStart=u+o,n.originalLength=a-n.originalStart,n.modifiedLength=d-n.modifiedStart)}}}return e}_findBetterContiguousSequence(e,t,i,s,n){if(t<n||s<n)return null;const o=e+t-n+1,l=i+s-n+1;let a=0,h=0,c=0;for(let d=e;d<o;d++)for(let f=i;f<l;f++){const g=this._contiguousSequenceScore(d,f,n);g>0&&g>a&&(a=g,h=d,c=f)}return a>0?[h,c]:null}_contiguousSequenceScore(e,t,i){let s=0;for(let n=0;n<i;n++){if(!this.ElementsAreEqual(e+n,t+n))return 0;s+=this._originalStringElements[e+n].length}return s}_OriginalIsBoundary(e){return e<=0||e>=this._originalElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._originalStringElements[e])}_OriginalRegionIsBoundary(e,t){if(this._OriginalIsBoundary(e)||this._OriginalIsBoundary(e-1))return!0;if(t>0){const i=e+t;if(this._OriginalIsBoundary(i-1)||this._OriginalIsBoundary(i))return!0}return!1}_ModifiedIsBoundary(e){return e<=0||e>=this._modifiedElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[e])}_ModifiedRegionIsBoundary(e,t){if(this._ModifiedIsBoundary(e)||this._ModifiedIsBoundary(e-1))return!0;if(t>0){const i=e+t;if(this._ModifiedIsBoundary(i-1)||this._ModifiedIsBoundary(i))return!0}return!1}_boundaryScore(e,t,i,s){const n=this._OriginalRegionIsBoundary(e,t)?1:0,o=this._ModifiedRegionIsBoundary(i,s)?1:0;return n+o}ConcatenateChanges(e,t){const i=[];if(e.length===0||t.length===0)return t.length>0?t:e;if(this.ChangesOverlap(e[e.length-1],t[0],i)){const s=new Array(e.length+t.length-1);return ye.Copy(e,0,s,0,e.length-1),s[e.length-1]=i[0],ye.Copy(t,1,s,e.length,t.length-1),s}else{const s=new Array(e.length+t.length);return ye.Copy(e,0,s,0,e.length),ye.Copy(t,0,s,e.length,t.length),s}}ChangesOverlap(e,t,i){if(be.Assert(e.originalStart<=t.originalStart,"Left change is not less than or equal to right change"),be.Assert(e.modifiedStart<=t.modifiedStart,"Left change is not less than or equal to right change"),e.originalStart+e.originalLength>=t.originalStart||e.modifiedStart+e.modifiedLength>=t.modifiedStart){const s=e.originalStart;let n=e.originalLength;const o=e.modifiedStart;let l=e.modifiedLength;return e.originalStart+e.originalLength>=t.originalStart&&(n=t.originalStart+t.originalLength-e.originalStart),e.modifiedStart+e.modifiedLength>=t.modifiedStart&&(l=t.modifiedStart+t.modifiedLength-e.modifiedStart),i[0]=new re(s,n,o,l),!0}else return i[0]=null,!1}ClipDiagonalBound(e,t,i,s){if(e>=0&&e<s)return e;const n=i,o=s-i-1,l=t%2===0;if(e<0){const a=n%2===0;return l===a?0:1}else{const a=o%2===0;return l===a?s-1:s-2}}}var Ln=function(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var l=r.length-1;l>=0;l--)(o=r[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Si=function(r,e){return function(t,i){e(t,i,r)}};const Mn=Ke("ILanguageFeatureDebounceService");var st;(function(r){const e=new WeakMap;let t=0;function i(s){let n=e.get(s);return n===void 0&&(n=++t,e.set(s,n)),n}r.of=i})(st||(st={}));class Pn{constructor(e){this._default=e}get(e){return this._default}update(e,t){return this._default}default(){return this._default}}class Fn{constructor(e,t,i,s,n,o){this._logService=e,this._name=t,this._registry=i,this._default=s,this._min=n,this._max=o,this._cache=new en(50,.7)}_key(e){return e.id+this._registry.all(e).reduce((t,i)=>Ds(st.of(i),t),0)}get(e){const t=this._key(e),i=this._cache.get(t);return i?R(i.value,this._min,this._max):this.default()}update(e,t){const i=this._key(e);let s=this._cache.get(i);s||(s=new un(6),this._cache.set(i,s));const n=R(s.update(t),this._min,this._max);return _s(e.uri,"output")||this._logService.trace(`[DEBOUNCE: ${this._name}] for ${e.uri.toString()} is ${n}ms`),n}_overall(){const e=new qi;for(const[,t]of this._cache)e.update(t.value);return e.value}default(){const e=this._overall()|0||this._default;return R(e,this._min,this._max)}}let Pt=class{constructor(e,t){this._logService=e,this._data=new Map,this._isDev=t.isExtensionDevelopment||!t.isBuilt}for(e,t,i){const s=(i==null?void 0:i.min)??50,n=(i==null?void 0:i.max)??s**2,o=(i==null?void 0:i.key)??void 0,l=`${st.of(e)},${s}${o?","+o:""}`;let a=this._data.get(l);return a||(this._isDev?(this._logService.debug(`[DEBOUNCE: ${t}] is disabled in developed mode`),a=new Pn(s*1.5)):a=new Fn(this._logService,t,e,this._overallAverage()|0||s*1.5,s,n),this._data.set(l,a)),a}_overallAverage(){const e=new qi;for(const t of this._data.values())e.update(t.default());return e.value}};Pt=Ln([Si(0,ws),Si(1,cn)],Pt);Tn(Mn,Pt,1);var On=function(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var l=r.length-1;l>=0;l--)(o=r[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},vi=function(r,e){return function(t,i){e(t,i,r)}};const An=Ke("hoverService");let Ci=class extends K{get delay(){return this.isInstantlyHovering()?0:this._delay}constructor(e,t,i={},s,n){super(),this.placement=e,this.instantHover=t,this.overrideOptions=i,this.configurationService=s,this.hoverService=n,this.lastHoverHideTime=0,this.timeLimit=200,this.hoverDisposables=this._register(new F),this._delay=this.configurationService.getValue("workbench.hover.delay"),this._register(this.configurationService.onDidChangeConfiguration(o=>{o.affectsConfiguration("workbench.hover.delay")&&(this._delay=this.configurationService.getValue("workbench.hover.delay"))}))}showHover(e,t){const i=typeof this.overrideOptions=="function"?this.overrideOptions(e,t):this.overrideOptions;this.hoverDisposables.clear();const s=oi(e.target)?[e.target]:e.target.targetElements;for(const o of s)this.hoverDisposables.add(Ns(o,"keydown",l=>{l.equals(9)&&this.hoverService.hideHover()}));const n=oi(e.content)?void 0:e.content.toString();return this.hoverService.showHover({...e,...i,persistence:{hideOnKeyDown:!0,...i.persistence},id:n,appearance:{...e.appearance,compact:!0,skipFadeInAnimation:this.isInstantlyHovering(),...i.appearance}},t)}isInstantlyHovering(){return this.instantHover&&Date.now()-this.lastHoverHideTime<this.timeLimit}onDidHideHover(){this.hoverDisposables.clear(),this.instantHover&&(this.lastHoverHideTime=Date.now())}};Ci=On([vi(3,j),vi(4,An)],Ci);const Ve=z;class Xo extends K{constructor(){super(),this.containerDomNode=document.createElement("div"),this.containerDomNode.className="monaco-hover",this.containerDomNode.tabIndex=0,this.containerDomNode.setAttribute("role","tooltip"),this.contentsDomNode=document.createElement("div"),this.contentsDomNode.className="monaco-hover-content",this.scrollbar=this._register(new tn(this.contentsDomNode,{consumeMouseWheelIfScrollbarIsNeeded:!0})),this.containerDomNode.appendChild(this.scrollbar.getDomNode())}onContentsChanged(){this.scrollbar.scanDomNode()}}class Zi extends K{static render(e,t,i){return new Zi(e,t,i)}constructor(e,t,i){super(),this.actionLabel=t.label,this.actionKeybindingLabel=i,this.actionContainer=A(e,Ve("div.action-container")),this.actionContainer.setAttribute("tabindex","0"),this.action=A(this.actionContainer,Ve("a.action")),this.action.setAttribute("role","button"),t.iconClass&&A(this.action,Ve(`span.icon.${t.iconClass}`));const s=A(this.action,Ve("span"));s.textContent=i?`${t.label} (${i})`:t.label,this._store.add(new Kn(this.actionContainer,t.run)),this._store.add(new zn(this.actionContainer,t.run,[3,10])),this.setEnabled(!0)}setEnabled(e){e?(this.actionContainer.classList.remove("disabled"),this.actionContainer.removeAttribute("aria-disabled")):(this.actionContainer.classList.add("disabled"),this.actionContainer.setAttribute("aria-disabled","true"))}}function Jo(r,e){return r&&e?C("acessibleViewHint","Inspect this in the accessible view with {0}.",e):r?C("acessibleViewHintNoKbOpen","Inspect this in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding."):""}class Kn extends K{constructor(e,t){super(),this._register(ce(e,zi.CLICK,i=>{i.stopPropagation(),i.preventDefault(),t(e)}))}}class zn extends K{constructor(e,t,i){super(),this._register(ce(e,zi.KEY_DOWN,s=>{const n=new Hi(s);i.some(o=>n.equals(o))&&(s.stopPropagation(),s.preventDefault(),t(e))}))}}const Qo=Ke("IWorkspaceEditService");class es{constructor(e){this.metadata=e}static convert(e){return e.edits.map(t=>{if(Ce.is(t))return Ce.lift(t);if(we.is(t))return we.lift(t);throw new Error("Unsupported edit")})}}class Ce extends es{static is(e){return e instanceof Ce?!0:Lt(e)&&Is.isUri(e.resource)&&Lt(e.textEdit)}static lift(e){return e instanceof Ce?e:new Ce(e.resource,e.textEdit,e.versionId,e.metadata)}constructor(e,t,i=void 0,s){super(s),this.resource=e,this.textEdit=t,this.versionId=i}}class we extends es{static is(e){return e instanceof we?!0:Lt(e)&&(!!e.newResource||!!e.oldResource)}static lift(e){return e instanceof we?e:new we(e.oldResource,e.newResource,e.options,e.metadata)}constructor(e,t,i={},s){super(s),this.oldResource=e,this.newResource=t,this.options=i}}var Le;(function(r){r[r.Hint=1]="Hint",r[r.Info=2]="Info",r[r.Warning=4]="Warning",r[r.Error=8]="Error"})(Le||(Le={}));(function(r){function e(o,l){return l-o}r.compare=e;const t=Object.create(null);t[r.Error]=C("sev.error","Error"),t[r.Warning]=C("sev.warning","Warning"),t[r.Info]=C("sev.info","Info");function i(o){return t[o]||""}r.toString=i;function s(o){switch(o){case oe.Error:return r.Error;case oe.Warning:return r.Warning;case oe.Info:return r.Info;case oe.Ignore:return r.Hint}}r.fromSeverity=s;function n(o){switch(o){case r.Error:return oe.Error;case r.Warning:return oe.Warning;case r.Info:return oe.Info;case r.Hint:return oe.Ignore}}r.toSeverity=n})(Le||(Le={}));var wi;(function(r){const e="";function t(s){return i(s,!0)}r.makeKey=t;function i(s,n){const o=[e];return s.source?o.push(s.source.replace("¦","\\¦")):o.push(e),s.code?typeof s.code=="string"?o.push(s.code.replace("¦","\\¦")):o.push(s.code.value.replace("¦","\\¦")):o.push(e),s.severity!==void 0&&s.severity!==null?o.push(Le.toString(s.severity)):o.push(e),s.message&&n?o.push(s.message.replace("¦","\\¦")):o.push(e),s.startLineNumber!==void 0&&s.startLineNumber!==null?o.push(s.startLineNumber.toString()):o.push(e),s.startColumn!==void 0&&s.startColumn!==null?o.push(s.startColumn.toString()):o.push(e),s.endLineNumber!==void 0&&s.endLineNumber!==null?o.push(s.endLineNumber.toString()):o.push(e),s.endColumn!==void 0&&s.endColumn!==null?o.push(s.endColumn.toString()):o.push(e),o.push(e),o.join("¦")}r.makeKeyOptionalMessage=i})(wi||(wi={}));const Zo=Ke("markerService");function er(r,e){const t=[],i=[];for(const s of r)e.has(s)||t.push(s);for(const s of e)r.has(s)||i.push(s);return{removed:t,added:i}}function Hn(r,e){const t=new Set;for(const i of e)r.has(i)&&t.add(i);return t}class tr{constructor(e,t,i){this.options=t,this.styles=i,this.count=0,this.element=A(e,z(".monaco-count-badge")),this.countFormat=this.options.countFormat||"{0}",this.titleFormat=this.options.titleFormat||"",this.setCount(this.options.count||0)}setCount(e){this.count=e,this.render()}setTitleFormat(e){this.titleFormat=e,this.render()}render(){this.element.textContent=ri(this.countFormat,this.count),this.element.title=ri(this.titleFormat,this.count),this.element.style.backgroundColor=this.styles.badgeBackground??"",this.element.style.color=this.styles.badgeForeground??"",this.styles.badgeBorder&&(this.element.style.border=`1px solid ${this.styles.badgeBorder}`)}}class Rn{get templateId(){return this.renderer.templateId}constructor(e,t){this.renderer=e,this.modelProvider=t}renderTemplate(e){return{data:this.renderer.renderTemplate(e),disposable:K.None}}renderElement(e,t,i,s){var a;if((a=i.disposable)==null||a.dispose(),!i.data)return;const n=this.modelProvider();if(n.isResolved(e))return this.renderer.renderElement(n.get(e),e,i.data,s);const o=new xs,l=n.resolve(e,o.token);i.disposable={dispose:()=>o.cancel()},this.renderer.renderPlaceholder(e,i.data),l.then(h=>this.renderer.renderElement(h,e,i.data,s))}disposeTemplate(e){e.disposable&&(e.disposable.dispose(),e.disposable=void 0),e.data&&(this.renderer.disposeTemplate(e.data),e.data=void 0)}}class Bn{constructor(e,t){this.modelProvider=e,this.accessibilityProvider=t}getWidgetAriaLabel(){return this.accessibilityProvider.getWidgetAriaLabel()}getAriaLabel(e){const t=this.modelProvider();return t.isResolved(e)?this.accessibilityProvider.getAriaLabel(t.get(e)):null}}function Vn(r,e){return{...e,accessibilityProvider:e.accessibilityProvider&&new Bn(r,e.accessibilityProvider)}}class Wn{constructor(e,t,i,s,n={}){const o=()=>this.model,l=s.map(a=>new Rn(a,o));this.list=new pt(e,t,i,l,Vn(o,n))}updateOptions(e){this.list.updateOptions(e)}getHTMLElement(){return this.list.getHTMLElement()}get onDidFocus(){return this.list.onDidFocus}get widget(){return this.list}get onDidDispose(){return this.list.onDidDispose}get onMouseDblClick(){return _.map(this.list.onMouseDblClick,({element:e,index:t,browserEvent:i})=>({element:e===void 0?void 0:this._model.get(e),index:t,browserEvent:i}))}get onPointer(){return _.map(this.list.onPointer,({element:e,index:t,browserEvent:i})=>({element:e===void 0?void 0:this._model.get(e),index:t,browserEvent:i}))}get onDidChangeSelection(){return _.map(this.list.onDidChangeSelection,({elements:e,indexes:t,browserEvent:i})=>({elements:e.map(s=>this._model.get(s)),indexes:t,browserEvent:i}))}get model(){return this._model}set model(e){this._model=e,this.list.splice(0,this.list.length,H(e.length))}getFocus(){return this.list.getFocus()}getSelection(){return this.list.getSelection()}getSelectedElements(){return this.getSelection().map(e=>this.model.get(e))}style(e){this.list.style(e)}dispose(){this.list.dispose()}}const $n={separatorBorder:sn.transparent};class ts{set size(e){this._size=e}get size(){return this._size}get visible(){return typeof this._cachedVisibleSize>"u"}setVisible(e,t){var i,s;if(e!==this.visible){e?(this.size=R(this._cachedVisibleSize,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof t=="number"?t:this.size,this.size=0),this.container.classList.toggle("visible",e);try{(s=(i=this.view).setVisible)==null||s.call(i,e)}catch(n){console.error("Splitview: Failed to set visible view"),console.error(n)}}}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get proportionalLayout(){return this.view.proportionalLayout??!0}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,t,i,s){this.container=e,this.view=t,this.disposable=s,this._cachedVisibleSize=void 0,typeof i=="number"?(this._size=i,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=i.cachedVisibleSize)}layout(e,t){this.layoutContainer(e);try{this.view.layout(this.size,e,t)}catch(i){console.error("Splitview: Failed to layout view"),console.error(i)}}dispose(){this.disposable.dispose()}}class Gn extends ts{layoutContainer(e){this.container.style.top=`${e}px`,this.container.style.height=`${this.size}px`}}class jn extends ts{layoutContainer(e){this.container.style.left=`${e}px`,this.container.style.width=`${this.size}px`}}var Z;(function(r){r[r.Idle=0]="Idle",r[r.Busy=1]="Busy"})(Z||(Z={}));var Di;(function(r){r.Distribute={type:"distribute"};function e(s){return{type:"split",index:s}}r.Split=e;function t(s){return{type:"auto",index:s}}r.Auto=t;function i(s){return{type:"invisible",cachedVisibleSize:s}}r.Invisible=i})(Di||(Di={}));class qn extends K{get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}get startSnappingEnabled(){return this._startSnappingEnabled}get endSnappingEnabled(){return this._endSnappingEnabled}set orthogonalStartSash(e){for(const t of this.sashItems)t.sash.orthogonalStartSash=e;this._orthogonalStartSash=e}set orthogonalEndSash(e){for(const t of this.sashItems)t.sash.orthogonalEndSash=e;this._orthogonalEndSash=e}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}constructor(e,t={}){super(),this.size=0,this._contentSize=0,this.proportions=void 0,this.viewItems=[],this.sashItems=[],this.state=Z.Idle,this._onDidSashChange=this._register(new P),this._onDidSashReset=this._register(new P),this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this.onDidSashChange=this._onDidSashChange.event,this.onDidSashReset=this._onDidSashReset.event,this.orientation=t.orientation??0,this.inverseAltBehavior=t.inverseAltBehavior??!1,this.proportionalLayout=t.proportionalLayout??!0,this.getSashOrthogonalSize=t.getSashOrthogonalSize,this.el=document.createElement("div"),this.el.classList.add("monaco-split-view2"),this.el.classList.add(this.orientation===0?"vertical":"horizontal"),e.appendChild(this.el),this.sashContainer=A(this.el,z(".sash-container")),this.viewContainer=z(".split-view-container"),this.scrollable=this._register(new nn({forceIntegerValues:!0,smoothScrollDuration:125,scheduleAtNextAnimationFrame:s=>Es(Ri(this.el),s)})),this.scrollableElement=this._register(new on(this.viewContainer,{vertical:this.orientation===0?t.scrollbarVisibility??1:2,horizontal:this.orientation===1?t.scrollbarVisibility??1:2},this.scrollable));const i=this._register(new rn(this.viewContainer,"scroll")).event;this._register(i(s=>{const n=this.scrollableElement.getScrollPosition(),o=Math.abs(this.viewContainer.scrollLeft-n.scrollLeft)<=1?void 0:this.viewContainer.scrollLeft,l=Math.abs(this.viewContainer.scrollTop-n.scrollTop)<=1?void 0:this.viewContainer.scrollTop;(o!==void 0||l!==void 0)&&this.scrollableElement.setScrollPosition({scrollLeft:o,scrollTop:l})})),this.onDidScroll=this.scrollableElement.onScroll,this._register(this.onDidScroll(s=>{s.scrollTopChanged&&(this.viewContainer.scrollTop=s.scrollTop),s.scrollLeftChanged&&(this.viewContainer.scrollLeft=s.scrollLeft)})),A(this.el,this.scrollableElement.getDomNode()),this.style(t.styles||$n),t.descriptor&&(this.size=t.descriptor.size,t.descriptor.views.forEach((s,n)=>{const o=ks(s.visible)||s.visible?s.size:{type:"invisible",cachedVisibleSize:s.size},l=s.view;this.doAddView(l,o,n,!0)}),this._contentSize=this.viewItems.reduce((s,n)=>s+n.size,0),this.saveProportions())}style(e){e.separatorBorder.isTransparent()?(this.el.classList.remove("separator-border"),this.el.style.removeProperty("--separator-border")):(this.el.classList.add("separator-border"),this.el.style.setProperty("--separator-border",e.separatorBorder.toString()))}addView(e,t,i=this.viewItems.length,s){this.doAddView(e,t,i,s)}layout(e,t){const i=Math.max(this.size,this._contentSize);if(this.size=e,this.layoutContext=t,this.proportions){let s=0;for(let n=0;n<this.viewItems.length;n++){const o=this.viewItems[n],l=this.proportions[n];typeof l=="number"?s+=l:e-=o.size}for(let n=0;n<this.viewItems.length;n++){const o=this.viewItems[n],l=this.proportions[n];typeof l=="number"&&s>0&&(o.size=R(Math.round(l*e/s),o.minimumSize,o.maximumSize))}}else{const s=H(this.viewItems.length),n=s.filter(l=>this.viewItems[l].priority===1),o=s.filter(l=>this.viewItems[l].priority===2);this.resize(this.viewItems.length-1,e-i,void 0,n,o)}this.distributeEmptySpace(),this.layoutViews()}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this.proportions=this.viewItems.map(e=>e.proportionalLayout&&e.visible?e.size/this._contentSize:void 0))}onSashStart({sash:e,start:t,alt:i}){for(const l of this.viewItems)l.enabled=!1;const s=this.sashItems.findIndex(l=>l.sash===e),n=Ge(ce(this.el.ownerDocument.body,"keydown",l=>o(this.sashDragState.current,l.altKey)),ce(this.el.ownerDocument.body,"keyup",()=>o(this.sashDragState.current,!1))),o=(l,a)=>{const h=this.viewItems.map(p=>p.size);let c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY;if(this.inverseAltBehavior&&(a=!a),a)if(s===this.sashItems.length-1){const u=this.viewItems[s];c=(u.minimumSize-u.size)/2,d=(u.maximumSize-u.size)/2}else{const u=this.viewItems[s+1];c=(u.size-u.maximumSize)/2,d=(u.size-u.minimumSize)/2}let f,g;if(!a){const p=H(s,-1),u=H(s+1,this.viewItems.length),m=p.reduce((b,w)=>b+(this.viewItems[w].minimumSize-h[w]),0),S=p.reduce((b,w)=>b+(this.viewItems[w].viewMaximumSize-h[w]),0),N=u.length===0?Number.POSITIVE_INFINITY:u.reduce((b,w)=>b+(h[w]-this.viewItems[w].minimumSize),0),I=u.length===0?Number.NEGATIVE_INFINITY:u.reduce((b,w)=>b+(h[w]-this.viewItems[w].viewMaximumSize),0),L=Math.max(m,I),v=Math.min(N,S),T=this.findFirstSnapIndex(p),y=this.findFirstSnapIndex(u);if(typeof T=="number"){const b=this.viewItems[T],w=Math.floor(b.viewMinimumSize/2);f={index:T,limitDelta:b.visible?L-w:L+w,size:b.size}}if(typeof y=="number"){const b=this.viewItems[y],w=Math.floor(b.viewMinimumSize/2);g={index:y,limitDelta:b.visible?v+w:v-w,size:b.size}}}this.sashDragState={start:l,current:l,index:s,sizes:h,minDelta:c,maxDelta:d,alt:a,snapBefore:f,snapAfter:g,disposable:n}};o(t,i)}onSashChange({current:e}){const{index:t,start:i,sizes:s,alt:n,minDelta:o,maxDelta:l,snapBefore:a,snapAfter:h}=this.sashDragState;this.sashDragState.current=e;const c=e-i,d=this.resize(t,c,s,void 0,void 0,o,l,a,h);if(n){const f=t===this.sashItems.length-1,g=this.viewItems.map(I=>I.size),p=f?t:t+1,u=this.viewItems[p],m=u.size-u.maximumSize,S=u.size-u.minimumSize,N=f?t-1:t+1;this.resize(N,-d,g,void 0,void 0,m,S)}this.distributeEmptySpace(),this.layoutViews()}onSashEnd(e){this._onDidSashChange.fire(e),this.sashDragState.disposable.dispose(),this.saveProportions();for(const t of this.viewItems)t.enabled=!0}onViewChange(e,t){const i=this.viewItems.indexOf(e);i<0||i>=this.viewItems.length||(t=typeof t=="number"?t:e.size,t=R(t,e.minimumSize,e.maximumSize),this.inverseAltBehavior&&i>0?(this.resize(i-1,Math.floor((e.size-t)/2)),this.distributeEmptySpace(),this.layoutViews()):(e.size=t,this.relayout([i],void 0)))}resizeView(e,t){if(!(e<0||e>=this.viewItems.length)){if(this.state!==Z.Idle)throw new Error("Cant modify splitview");this.state=Z.Busy;try{const i=H(this.viewItems.length).filter(l=>l!==e),s=[...i.filter(l=>this.viewItems[l].priority===1),e],n=i.filter(l=>this.viewItems[l].priority===2),o=this.viewItems[e];t=Math.round(t),t=R(t,o.minimumSize,Math.min(o.maximumSize,this.size)),o.size=t,this.relayout(s,n)}finally{this.state=Z.Idle}}}distributeViewSizes(){const e=[];let t=0;for(const l of this.viewItems)l.maximumSize-l.minimumSize>0&&(e.push(l),t+=l.size);const i=Math.floor(t/e.length);for(const l of e)l.size=R(i,l.minimumSize,l.maximumSize);const s=H(this.viewItems.length),n=s.filter(l=>this.viewItems[l].priority===1),o=s.filter(l=>this.viewItems[l].priority===2);this.relayout(n,o)}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}doAddView(e,t,i=this.viewItems.length,s){if(this.state!==Z.Idle)throw new Error("Cant modify splitview");this.state=Z.Busy;try{const n=z(".split-view-view");i===this.viewItems.length?this.viewContainer.appendChild(n):this.viewContainer.insertBefore(n,this.viewContainer.children.item(i));const o=e.onDidChange(f=>this.onViewChange(c,f)),l=gt(()=>n.remove()),a=Ge(o,l);let h;typeof t=="number"?h=t:(t.type==="auto"&&(this.areViewsDistributed()?t={type:"distribute"}:t={type:"split",index:t.index}),t.type==="split"?h=this.getViewSize(t.index)/2:t.type==="invisible"?h={cachedVisibleSize:t.cachedVisibleSize}:h=e.minimumSize);const c=this.orientation===0?new Gn(n,e,h,a):new jn(n,e,h,a);if(this.viewItems.splice(i,0,c),this.viewItems.length>1){const f={orthogonalStartSash:this.orthogonalStartSash,orthogonalEndSash:this.orthogonalEndSash},g=this.orientation===0?new pi(this.sashContainer,{getHorizontalSashTop:b=>this.getSashPosition(b),getHorizontalSashWidth:this.getSashOrthogonalSize},{...f,orientation:1}):new pi(this.sashContainer,{getVerticalSashLeft:b=>this.getSashPosition(b),getVerticalSashHeight:this.getSashOrthogonalSize},{...f,orientation:0}),p=this.orientation===0?b=>({sash:g,start:b.startY,current:b.currentY,alt:b.altKey}):b=>({sash:g,start:b.startX,current:b.currentX,alt:b.altKey}),m=_.map(g.onDidStart,p)(this.onSashStart,this),N=_.map(g.onDidChange,p)(this.onSashChange,this),L=_.map(g.onDidEnd,()=>this.sashItems.findIndex(b=>b.sash===g))(this.onSashEnd,this),v=g.onDidReset(()=>{const b=this.sashItems.findIndex(ne=>ne.sash===g),w=H(b,-1),O=H(b+1,this.viewItems.length),E=this.findFirstSnapIndex(w),D=this.findFirstSnapIndex(O);typeof E=="number"&&!this.viewItems[E].visible||typeof D=="number"&&!this.viewItems[D].visible||this._onDidSashReset.fire(b)}),T=Ge(m,N,L,v,g),y={sash:g,disposable:T};this.sashItems.splice(i-1,0,y)}n.appendChild(e.element);let d;typeof t!="number"&&t.type==="split"&&(d=[t.index]),s||this.relayout([i],d),!s&&typeof t!="number"&&t.type==="distribute"&&this.distributeViewSizes()}finally{this.state=Z.Idle}}relayout(e,t){const i=this.viewItems.reduce((s,n)=>s+n.size,0);this.resize(this.viewItems.length-1,this.size-i,void 0,e,t),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}resize(e,t,i=this.viewItems.map(c=>c.size),s,n,o=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY,a,h){if(e<0||e>=this.viewItems.length)return 0;const c=H(e,-1),d=H(e+1,this.viewItems.length);if(n)for(const y of n)_t(c,y),_t(d,y);if(s)for(const y of s)Be(c,y),Be(d,y);const f=c.map(y=>this.viewItems[y]),g=c.map(y=>i[y]),p=d.map(y=>this.viewItems[y]),u=d.map(y=>i[y]),m=c.reduce((y,b)=>y+(this.viewItems[b].minimumSize-i[b]),0),S=c.reduce((y,b)=>y+(this.viewItems[b].maximumSize-i[b]),0),N=d.length===0?Number.POSITIVE_INFINITY:d.reduce((y,b)=>y+(i[b]-this.viewItems[b].minimumSize),0),I=d.length===0?Number.NEGATIVE_INFINITY:d.reduce((y,b)=>y+(i[b]-this.viewItems[b].maximumSize),0),L=Math.max(m,I,o),v=Math.min(N,S,l);let T=!1;if(a){const y=this.viewItems[a.index],b=t>=a.limitDelta;T=b!==y.visible,y.setVisible(b,a.size)}if(!T&&h){const y=this.viewItems[h.index],b=t<h.limitDelta;T=b!==y.visible,y.setVisible(b,h.size)}if(T)return this.resize(e,t,i,s,n,o,l);t=R(t,L,v);for(let y=0,b=t;y<f.length;y++){const w=f[y],O=R(g[y]+b,w.minimumSize,w.maximumSize),E=O-g[y];b-=E,w.size=O}for(let y=0,b=t;y<p.length;y++){const w=p[y],O=R(u[y]-b,w.minimumSize,w.maximumSize),E=O-u[y];b+=E,w.size=O}return t}distributeEmptySpace(e){const t=this.viewItems.reduce((l,a)=>l+a.size,0);let i=this.size-t;const s=H(this.viewItems.length-1,-1),n=s.filter(l=>this.viewItems[l].priority===1),o=s.filter(l=>this.viewItems[l].priority===2);for(const l of o)_t(s,l);for(const l of n)Be(s,l);typeof e=="number"&&Be(s,e);for(let l=0;i!==0&&l<s.length;l++){const a=this.viewItems[s[l]],h=R(a.size+i,a.minimumSize,a.maximumSize),c=h-a.size;i-=c,a.size=h}}layoutViews(){this._contentSize=this.viewItems.reduce((t,i)=>t+i.size,0);let e=0;for(const t of this.viewItems)t.layout(e,this.layoutContext),e+=t.size;this.sashItems.forEach(t=>t.sash.layout()),this.updateSashEnablement(),this.updateScrollableElement()}updateScrollableElement(){this.orientation===0?this.scrollableElement.setScrollDimensions({height:this.size,scrollHeight:this._contentSize}):this.scrollableElement.setScrollDimensions({width:this.size,scrollWidth:this._contentSize})}updateSashEnablement(){let e=!1;const t=this.viewItems.map(a=>e=a.size-a.minimumSize>0||e);e=!1;const i=this.viewItems.map(a=>e=a.maximumSize-a.size>0||e),s=[...this.viewItems].reverse();e=!1;const n=s.map(a=>e=a.size-a.minimumSize>0||e).reverse();e=!1;const o=s.map(a=>e=a.maximumSize-a.size>0||e).reverse();let l=0;for(let a=0;a<this.sashItems.length;a++){const{sash:h}=this.sashItems[a],c=this.viewItems[a];l+=c.size;const d=!(t[a]&&o[a+1]),f=!(i[a]&&n[a+1]);if(d&&f){const g=H(a,-1),p=H(a+1,this.viewItems.length),u=this.findFirstSnapIndex(g),m=this.findFirstSnapIndex(p),S=typeof u=="number"&&!this.viewItems[u].visible,N=typeof m=="number"&&!this.viewItems[m].visible;S&&n[a]&&(l>0||this.startSnappingEnabled)?h.state=1:N&&t[a]&&(l<this._contentSize||this.endSnappingEnabled)?h.state=2:h.state=0}else d&&!f?h.state=1:!d&&f?h.state=2:h.state=3}}getSashPosition(e){let t=0;for(let i=0;i<this.sashItems.length;i++)if(t+=this.viewItems[i].size,this.sashItems[i].sash===e)return t;return 0}findFirstSnapIndex(e){for(const t of e){const i=this.viewItems[t];if(i.visible&&i.snap)return t}for(const t of e){const i=this.viewItems[t];if(i.visible&&i.maximumSize-i.minimumSize>0)return;if(!i.visible&&i.snap)return t}}areViewsDistributed(){let e,t;for(const i of this.viewItems)if(e=e===void 0?i.size:Math.min(e,i.size),t=t===void 0?i.size:Math.max(t,i.size),t-e>2)return!1;return!0}dispose(){var e;(e=this.sashDragState)==null||e.disposable.dispose(),De(this.viewItems),this.viewItems=[],this.sashItems.forEach(t=>t.disposable.dispose()),this.sashItems=[],super.dispose()}}const ct=class ct{constructor(e,t,i){this.columns=e,this.getColumnSize=i,this.templateId=ct.TemplateId,this.renderedTemplates=new Set;const s=new Map(t.map(n=>[n.templateId,n]));this.renderers=[];for(const n of e){const o=s.get(n.templateId);if(!o)throw new Error(`Table cell renderer for template id ${n.templateId} not found.`);this.renderers.push(o)}}renderTemplate(e){const t=A(e,z(".monaco-table-tr")),i=[],s=[];for(let o=0;o<this.columns.length;o++){const l=this.renderers[o],a=A(t,z(".monaco-table-td",{"data-col-index":o}));a.style.width=`${this.getColumnSize(o)}px`,i.push(a),s.push(l.renderTemplate(a))}const n={container:e,cellContainers:i,cellTemplateData:s};return this.renderedTemplates.add(n),n}renderElement(e,t,i,s){for(let n=0;n<this.columns.length;n++){const l=this.columns[n].project(e);this.renderers[n].renderElement(l,t,i.cellTemplateData[n],s)}}disposeElement(e,t,i,s){for(let n=0;n<this.columns.length;n++){const o=this.renderers[n];if(o.disposeElement){const a=this.columns[n].project(e);o.disposeElement(a,t,i.cellTemplateData[n],s)}}}disposeTemplate(e){for(let t=0;t<this.columns.length;t++)this.renderers[t].disposeTemplate(e.cellTemplateData[t]);Wt(e.container),this.renderedTemplates.delete(e)}layoutColumn(e,t){for(const{cellContainers:i}of this.renderedTemplates)i[e].style.width=`${t}px`}};ct.TemplateId="row";let nt=ct;function Un(r){return{getHeight(e){return r.getHeight(e)},getTemplateId(){return nt.TemplateId}}}class Yn extends K{get minimumSize(){return this.column.minimumWidth??120}get maximumSize(){return this.column.maximumWidth??Number.POSITIVE_INFINITY}get onDidChange(){return this.column.onDidChangeWidthConstraints??_.None}constructor(e,t){super(),this.column=e,this.index=t,this._onDidLayout=new P,this.onDidLayout=this._onDidLayout.event,this.element=z(".monaco-table-th",{"data-col-index":t},e.label),e.tooltip&&this._register(Ui().setupManagedHover(Yi("mouse"),this.element,e.tooltip))}layout(e){this._onDidLayout.fire([this.index,e])}}const ut=class ut{get onDidChangeFocus(){return this.list.onDidChangeFocus}get onDidChangeSelection(){return this.list.onDidChangeSelection}get onDidScroll(){return this.list.onDidScroll}get onMouseDblClick(){return this.list.onMouseDblClick}get onPointer(){return this.list.onPointer}get onDidFocus(){return this.list.onDidFocus}get scrollTop(){return this.list.scrollTop}set scrollTop(e){this.list.scrollTop=e}get scrollHeight(){return this.list.scrollHeight}get renderHeight(){return this.list.renderHeight}get onDidDispose(){return this.list.onDidDispose}constructor(e,t,i,s,n,o){this.virtualDelegate=i,this.columns=s,this.domId=`table_id_${++ut.InstanceCount}`,this.disposables=new F,this.cachedWidth=0,this.cachedHeight=0,this.domNode=A(t,z(`.monaco-table.${this.domId}`));const l=s.map((c,d)=>this.disposables.add(new Yn(c,d))),a={size:l.reduce((c,d)=>c+d.column.weight,0),views:l.map(c=>({size:c.column.weight,view:c}))};this.splitview=this.disposables.add(new qn(this.domNode,{orientation:1,scrollbarVisibility:2,getSashOrthogonalSize:()=>this.cachedHeight,descriptor:a})),this.splitview.el.style.height=`${i.headerRowHeight}px`,this.splitview.el.style.lineHeight=`${i.headerRowHeight}px`;const h=new nt(s,n,c=>this.splitview.getViewSize(c));this.list=this.disposables.add(new pt(e,this.domNode,Un(i),[h],o)),_.any(...l.map(c=>c.onDidLayout))(([c,d])=>h.layoutColumn(c,d),null,this.disposables),this.splitview.onDidSashReset(c=>{const d=s.reduce((g,p)=>g+p.weight,0),f=s[c].weight/d*this.cachedWidth;this.splitview.resizeView(c,f)},null,this.disposables),this.styleElement=Vt(this.domNode),this.style(fn)}updateOptions(e){this.list.updateOptions(e)}splice(e,t,i=[]){this.list.splice(e,t,i)}getHTMLElement(){return this.domNode}style(e){const t=[];t.push(`.monaco-table.${this.domId} > .monaco-split-view2 .monaco-sash.vertical::before {
			top: ${this.virtualDelegate.headerRowHeight+1}px;
			height: calc(100% - ${this.virtualDelegate.headerRowHeight}px);
		}`),this.styleElement.textContent=t.join(`
`),this.list.style(e)}getSelectedElements(){return this.list.getSelectedElements()}getSelection(){return this.list.getSelection()}getFocus(){return this.list.getFocus()}dispose(){this.disposables.dispose()}};ut.InstanceCount=0;let Ft=ut;var B;(function(r){r[r.Expanded=0]="Expanded",r[r.Collapsed=1]="Collapsed",r[r.PreserveOrExpanded=2]="PreserveOrExpanded",r[r.PreserveOrCollapsed=3]="PreserveOrCollapsed"})(B||(B={}));var de;(function(r){r[r.Unknown=0]="Unknown",r[r.Twistie=1]="Twistie",r[r.Element=2]="Element",r[r.Filter=3]="Filter"})(de||(de={}));class V extends Error{constructor(e,t){super(`TreeError [${e}] ${t}`)}}class $t{constructor(e){this.fn=e,this._map=new WeakMap}map(e){let t=this._map.get(e);return t||(t=this.fn(e),this._map.set(e,t)),t}}function Gt(r){return typeof r=="object"&&"visibility"in r&&"data"in r}function Me(r){switch(r){case!0:return 1;case!1:return 0;default:return r}}function It(r){return typeof r.collapsible=="boolean"}class Xn{constructor(e,t,i,s={}){this.user=e,this.list=t,this.rootRef=[],this.eventBufferer=new Bi,this._onDidChangeCollapseState=new P,this.onDidChangeCollapseState=this.eventBufferer.wrapEvent(this._onDidChangeCollapseState.event),this._onDidChangeRenderNodeCount=new P,this.onDidChangeRenderNodeCount=this.eventBufferer.wrapEvent(this._onDidChangeRenderNodeCount.event),this._onDidSplice=new P,this.onDidSplice=this._onDidSplice.event,this.refilterDelayer=new Vi(Ts),this.collapseByDefault=typeof s.collapseByDefault>"u"?!1:s.collapseByDefault,this.allowNonCollapsibleParents=s.allowNonCollapsibleParents??!1,this.filter=s.filter,this.autoExpandSingleChildren=typeof s.autoExpandSingleChildren>"u"?!1:s.autoExpandSingleChildren,this.root={parent:void 0,element:i,children:[],depth:0,visibleChildrenCount:0,visibleChildIndex:-1,collapsible:!1,collapsed:!1,renderNodeCount:0,visibility:1,visible:!0,filterData:void 0}}splice(e,t,i=k.empty(),s={}){if(e.length===0)throw new V(this.user,"Invalid tree location");s.diffIdentityProvider?this.spliceSmart(s.diffIdentityProvider,e,t,i,s):this.spliceSimple(e,t,i,s)}spliceSmart(e,t,i,s=k.empty(),n,o=n.diffDepth??0){const{parentNode:l}=this.getParentNodeWithListIndex(t);if(!l.lastDiffIds)return this.spliceSimple(t,i,s,n);const a=[...s],h=t[t.length-1],c=new ae({getElements:()=>l.lastDiffIds},{getElements:()=>[...l.children.slice(0,h),...a,...l.children.slice(h+i)].map(u=>e.getId(u.element).toString())}).ComputeDiff(!1);if(c.quitEarly)return l.lastDiffIds=void 0,this.spliceSimple(t,i,a,n);const d=t.slice(0,-1),f=(u,m,S)=>{if(o>0)for(let N=0;N<S;N++)u--,m--,this.spliceSmart(e,[...d,u,0],Number.MAX_SAFE_INTEGER,a[m].children,n,o-1)};let g=Math.min(l.children.length,h+i),p=a.length;for(const u of c.changes.sort((m,S)=>S.originalStart-m.originalStart))f(g,p,g-(u.originalStart+u.originalLength)),g=u.originalStart,p=u.modifiedStart-h,this.spliceSimple([...d,g],u.originalLength,k.slice(a,p,p+u.modifiedLength),n);f(g,p,g)}spliceSimple(e,t,i=k.empty(),{onDidCreateNode:s,onDidDeleteNode:n,diffIdentityProvider:o}){const{parentNode:l,listIndex:a,revealed:h,visible:c}=this.getParentNodeWithListIndex(e),d=[],f=k.map(i,v=>this.createTreeNode(v,l,l.visible?1:0,h,d,s)),g=e[e.length-1];let p=0;for(let v=g;v>=0&&v<l.children.length;v--){const T=l.children[v];if(T.visible){p=T.visibleChildIndex;break}}const u=[];let m=0,S=0;for(const v of f)u.push(v),S+=v.renderNodeCount,v.visible&&(v.visibleChildIndex=p+m++);const N=li(l.children,g,t,u);o?l.lastDiffIds?li(l.lastDiffIds,g,t,u.map(v=>o.getId(v.element).toString())):l.lastDiffIds=l.children.map(v=>o.getId(v.element).toString()):l.lastDiffIds=void 0;let I=0;for(const v of N)v.visible&&I++;if(I!==0)for(let v=g+u.length;v<l.children.length;v++){const T=l.children[v];T.visible&&(T.visibleChildIndex-=I)}if(l.visibleChildrenCount+=m-I,h&&c){const v=N.reduce((T,y)=>T+(y.visible?y.renderNodeCount:0),0);this._updateAncestorsRenderNodeCount(l,S-v),this.list.splice(a,v,d)}if(N.length>0&&n){const v=T=>{n(T),T.children.forEach(v)};N.forEach(v)}this._onDidSplice.fire({insertedNodes:u,deletedNodes:N});let L=l;for(;L;){if(L.visibility===2){this.refilterDelayer.trigger(()=>this.refilter());break}L=L.parent}}rerender(e){if(e.length===0)throw new V(this.user,"Invalid tree location");const{node:t,listIndex:i,revealed:s}=this.getTreeNodeWithListIndex(e);t.visible&&s&&this.list.splice(i,1,[t])}has(e){return this.hasTreeNode(e)}getListIndex(e){const{listIndex:t,visible:i,revealed:s}=this.getTreeNodeWithListIndex(e);return i&&s?t:-1}getListRenderCount(e){return this.getTreeNode(e).renderNodeCount}isCollapsible(e){return this.getTreeNode(e).collapsible}setCollapsible(e,t){const i=this.getTreeNode(e);typeof t>"u"&&(t=!i.collapsible);const s={collapsible:t};return this.eventBufferer.bufferEvents(()=>this._setCollapseState(e,s))}isCollapsed(e){return this.getTreeNode(e).collapsed}setCollapsed(e,t,i){const s=this.getTreeNode(e);typeof t>"u"&&(t=!s.collapsed);const n={collapsed:t,recursive:i||!1};return this.eventBufferer.bufferEvents(()=>this._setCollapseState(e,n))}_setCollapseState(e,t){const{node:i,listIndex:s,revealed:n}=this.getTreeNodeWithListIndex(e),o=this._setListNodeCollapseState(i,s,n,t);if(i!==this.root&&this.autoExpandSingleChildren&&o&&!It(t)&&i.collapsible&&!i.collapsed&&!t.recursive){let l=-1;for(let a=0;a<i.children.length;a++)if(i.children[a].visible)if(l>-1){l=-1;break}else l=a;l>-1&&this._setCollapseState([...e,l],t)}return o}_setListNodeCollapseState(e,t,i,s){const n=this._setNodeCollapseState(e,s,!1);if(!i||!e.visible||!n)return n;const o=e.renderNodeCount,l=this.updateNodeAfterCollapseChange(e),a=o-(t===-1?0:1);return this.list.splice(t+1,a,l.slice(1)),n}_setNodeCollapseState(e,t,i){let s;if(e===this.root?s=!1:(It(t)?(s=e.collapsible!==t.collapsible,e.collapsible=t.collapsible):e.collapsible?(s=e.collapsed!==t.collapsed,e.collapsed=t.collapsed):s=!1,s&&this._onDidChangeCollapseState.fire({node:e,deep:i})),!It(t)&&t.recursive)for(const n of e.children)s=this._setNodeCollapseState(n,t,!0)||s;return s}expandTo(e){this.eventBufferer.bufferEvents(()=>{let t=this.getTreeNode(e);for(;t.parent;)t=t.parent,e=e.slice(0,e.length-1),t.collapsed&&this._setCollapseState(e,{collapsed:!1,recursive:!1})})}refilter(){const e=this.root.renderNodeCount,t=this.updateNodeAfterFilterChange(this.root);this.list.splice(0,e,t),this.refilterDelayer.cancel()}createTreeNode(e,t,i,s,n,o){const l={parent:t,element:e.element,children:[],depth:t.depth+1,visibleChildrenCount:0,visibleChildIndex:-1,collapsible:typeof e.collapsible=="boolean"?e.collapsible:typeof e.collapsed<"u",collapsed:typeof e.collapsed>"u"?this.collapseByDefault:e.collapsed,renderNodeCount:1,visibility:1,visible:!0,filterData:void 0},a=this._filterNode(l,i);l.visibility=a,s&&n.push(l);const h=e.children||k.empty(),c=s&&a!==0&&!l.collapsed;let d=0,f=1;for(const g of h){const p=this.createTreeNode(g,l,a,c,n,o);l.children.push(p),f+=p.renderNodeCount,p.visible&&(p.visibleChildIndex=d++)}return this.allowNonCollapsibleParents||(l.collapsible=l.collapsible||l.children.length>0),l.visibleChildrenCount=d,l.visible=a===2?d>0:a===1,l.visible?l.collapsed||(l.renderNodeCount=f):(l.renderNodeCount=0,s&&n.pop()),o==null||o(l),l}updateNodeAfterCollapseChange(e){const t=e.renderNodeCount,i=[];return this._updateNodeAfterCollapseChange(e,i),this._updateAncestorsRenderNodeCount(e.parent,i.length-t),i}_updateNodeAfterCollapseChange(e,t){if(e.visible===!1)return 0;if(t.push(e),e.renderNodeCount=1,!e.collapsed)for(const i of e.children)e.renderNodeCount+=this._updateNodeAfterCollapseChange(i,t);return this._onDidChangeRenderNodeCount.fire(e),e.renderNodeCount}updateNodeAfterFilterChange(e){const t=e.renderNodeCount,i=[];return this._updateNodeAfterFilterChange(e,e.visible?1:0,i),this._updateAncestorsRenderNodeCount(e.parent,i.length-t),i}_updateNodeAfterFilterChange(e,t,i,s=!0){let n;if(e!==this.root){if(n=this._filterNode(e,t),n===0)return e.visible=!1,e.renderNodeCount=0,!1;s&&i.push(e)}const o=i.length;e.renderNodeCount=e===this.root?0:1;let l=!1;if(!e.collapsed||n!==0){let a=0;for(const h of e.children)l=this._updateNodeAfterFilterChange(h,n,i,s&&!e.collapsed)||l,h.visible&&(h.visibleChildIndex=a++);e.visibleChildrenCount=a}else e.visibleChildrenCount=0;return e!==this.root&&(e.visible=n===2?l:n===1,e.visibility=n),e.visible?e.collapsed||(e.renderNodeCount+=i.length-o):(e.renderNodeCount=0,s&&i.pop()),this._onDidChangeRenderNodeCount.fire(e),e.visible}_updateAncestorsRenderNodeCount(e,t){if(t!==0)for(;e;)e.renderNodeCount+=t,this._onDidChangeRenderNodeCount.fire(e),e=e.parent}_filterNode(e,t){const i=this.filter?this.filter.filter(e.element,t):1;return typeof i=="boolean"?(e.filterData=void 0,i?1:0):Gt(i)?(e.filterData=i.data,Me(i.visibility)):(e.filterData=void 0,Me(i))}hasTreeNode(e,t=this.root){if(!e||e.length===0)return!0;const[i,...s]=e;return i<0||i>t.children.length?!1:this.hasTreeNode(s,t.children[i])}getTreeNode(e,t=this.root){if(!e||e.length===0)return t;const[i,...s]=e;if(i<0||i>t.children.length)throw new V(this.user,"Invalid tree location");return this.getTreeNode(s,t.children[i])}getTreeNodeWithListIndex(e){if(e.length===0)return{node:this.root,listIndex:-1,revealed:!0,visible:!1};const{parentNode:t,listIndex:i,revealed:s,visible:n}=this.getParentNodeWithListIndex(e),o=e[e.length-1];if(o<0||o>t.children.length)throw new V(this.user,"Invalid tree location");const l=t.children[o];return{node:l,listIndex:i,revealed:s,visible:n&&l.visible}}getParentNodeWithListIndex(e,t=this.root,i=0,s=!0,n=!0){const[o,...l]=e;if(o<0||o>t.children.length)throw new V(this.user,"Invalid tree location");for(let a=0;a<o;a++)i+=t.children[a].renderNodeCount;return s=s&&!t.collapsed,n=n&&t.visible,l.length===0?{parentNode:t,listIndex:i,revealed:s,visible:n}:this.getParentNodeWithListIndex(l,t.children[o],i+1,s,n)}getNode(e=[]){return this.getTreeNode(e)}getNodeLocation(e){const t=[];let i=e;for(;i.parent;)t.push(i.parent.children.indexOf(i)),i=i.parent;return t.reverse()}getParentNodeLocation(e){if(e.length!==0)return e.length===1?[]:Ls(e)[0]}getFirstElementChild(e){const t=this.getTreeNode(e);if(t.children.length!==0)return t.children[0].element}}class Jn extends mt{constructor(e){super(e.elements.map(t=>t.element)),this.data=e}}function xt(r){return r instanceof mt?new Jn(r):r}class Qn{constructor(e,t){this.modelProvider=e,this.dnd=t,this.autoExpandDisposable=K.None,this.disposables=new F}getDragURI(e){return this.dnd.getDragURI(e.element)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e.map(i=>i.element),t)}onDragStart(e,t){var i,s;(s=(i=this.dnd).onDragStart)==null||s.call(i,xt(e),t)}onDragOver(e,t,i,s,n,o=!0){const l=this.dnd.onDragOver(xt(e),t&&t.element,i,s,n),a=this.autoExpandNode!==t;if(a&&(this.autoExpandDisposable.dispose(),this.autoExpandNode=t),typeof t>"u")return l;if(a&&typeof l!="boolean"&&l.autoExpand&&(this.autoExpandDisposable=Ps(()=>{const g=this.modelProvider(),p=g.getNodeLocation(t);g.isCollapsed(p)&&g.setCollapsed(p,!1),this.autoExpandNode=void 0},500,this.disposables)),typeof l=="boolean"||!l.accept||typeof l.bubble>"u"||l.feedback){if(!o){const g=typeof l=="boolean"?l:l.accept,p=typeof l=="boolean"?void 0:l.effect;return{accept:g,effect:p,feedback:[i]}}return l}if(l.bubble===1){const g=this.modelProvider(),p=g.getNodeLocation(t),u=g.getParentNodeLocation(p),m=g.getNode(u),S=u&&g.getListIndex(u);return this.onDragOver(e,m,S,s,n,!1)}const h=this.modelProvider(),c=h.getNodeLocation(t),d=h.getListIndex(c),f=h.getListRenderCount(c);return{...l,feedback:H(d,d+f)}}drop(e,t,i,s,n){this.autoExpandDisposable.dispose(),this.autoExpandNode=void 0,this.dnd.drop(xt(e),t&&t.element,i,s,n)}onDragEnd(e){var t,i;(i=(t=this.dnd).onDragEnd)==null||i.call(t,e)}dispose(){this.disposables.dispose(),this.dnd.dispose()}}function Zn(r,e){return e&&{...e,identityProvider:e.identityProvider&&{getId(t){return e.identityProvider.getId(t.element)}},dnd:e.dnd&&new Qn(r,e.dnd),multipleSelectionController:e.multipleSelectionController&&{isSelectionSingleChangeEvent(t){return e.multipleSelectionController.isSelectionSingleChangeEvent({...t,element:t.element})},isSelectionRangeChangeEvent(t){return e.multipleSelectionController.isSelectionRangeChangeEvent({...t,element:t.element})}},accessibilityProvider:e.accessibilityProvider&&{...e.accessibilityProvider,getSetSize(t){const i=r(),s=i.getNodeLocation(t),n=i.getParentNodeLocation(s);return i.getNode(n).visibleChildrenCount},getPosInSet(t){return t.visibleChildIndex+1},isChecked:e.accessibilityProvider&&e.accessibilityProvider.isChecked?t=>e.accessibilityProvider.isChecked(t.element):void 0,getRole:e.accessibilityProvider&&e.accessibilityProvider.getRole?t=>e.accessibilityProvider.getRole(t.element):()=>"treeitem",getAriaLabel(t){return e.accessibilityProvider.getAriaLabel(t.element)},getWidgetAriaLabel(){return e.accessibilityProvider.getWidgetAriaLabel()},getWidgetRole:e.accessibilityProvider&&e.accessibilityProvider.getWidgetRole?()=>e.accessibilityProvider.getWidgetRole():()=>"tree",getAriaLevel:e.accessibilityProvider&&e.accessibilityProvider.getAriaLevel?t=>e.accessibilityProvider.getAriaLevel(t.element):t=>t.depth,getActiveDescendantId:e.accessibilityProvider.getActiveDescendantId&&(t=>e.accessibilityProvider.getActiveDescendantId(t.element))},keyboardNavigationLabelProvider:e.keyboardNavigationLabelProvider&&{...e.keyboardNavigationLabelProvider,getKeyboardNavigationLabel(t){return e.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(t.element)}}}}class jt{constructor(e){this.delegate=e}getHeight(e){return this.delegate.getHeight(e.element)}getTemplateId(e){return this.delegate.getTemplateId(e.element)}hasDynamicHeight(e){return!!this.delegate.hasDynamicHeight&&this.delegate.hasDynamicHeight(e.element)}setDynamicHeight(e,t){var i,s;(s=(i=this.delegate).setDynamicHeight)==null||s.call(i,e.element,t)}}var Pe;(function(r){r.None="none",r.OnHover="onHover",r.Always="always"})(Pe||(Pe={}));class eo{get elements(){return this._elements}constructor(e,t=[]){this._elements=t,this.disposables=new F,this.onDidChange=_.forEach(e,i=>this._elements=i,this.disposables)}dispose(){this.disposables.dispose()}}const ke=class ke{constructor(e,t,i,s,n,o={}){var l;this.renderer=e,this.modelProvider=t,this.activeNodes=s,this.renderedIndentGuides=n,this.renderedElements=new Map,this.renderedNodes=new Map,this.indent=ke.DefaultIndent,this.hideTwistiesOfChildlessElements=!1,this.shouldRenderIndentGuides=!1,this.activeIndentNodes=new Set,this.indentGuidesDisposable=K.None,this.disposables=new F,this.templateId=e.templateId,this.updateOptions(o),_.map(i,a=>a.node)(this.onDidChangeNodeTwistieState,this,this.disposables),(l=e.onDidChangeTwistieState)==null||l.call(e,this.onDidChangeTwistieState,this,this.disposables)}updateOptions(e={}){if(typeof e.indent<"u"){const t=R(e.indent,0,40);if(t!==this.indent){this.indent=t;for(const[i,s]of this.renderedNodes)this.renderTreeElement(i,s)}}if(typeof e.renderIndentGuides<"u"){const t=e.renderIndentGuides!==Pe.None;if(t!==this.shouldRenderIndentGuides){this.shouldRenderIndentGuides=t;for(const[i,s]of this.renderedNodes)this._renderIndentGuides(i,s);if(this.indentGuidesDisposable.dispose(),t){const i=new F;this.activeNodes.onDidChange(this._onDidChangeActiveNodes,this,i),this.indentGuidesDisposable=i,this._onDidChangeActiveNodes(this.activeNodes.elements)}}}typeof e.hideTwistiesOfChildlessElements<"u"&&(this.hideTwistiesOfChildlessElements=e.hideTwistiesOfChildlessElements)}renderTemplate(e){const t=A(e,z(".monaco-tl-row")),i=A(t,z(".monaco-tl-indent")),s=A(t,z(".monaco-tl-twistie")),n=A(t,z(".monaco-tl-contents")),o=this.renderer.renderTemplate(n);return{container:e,indent:i,twistie:s,indentGuidesDisposable:K.None,templateData:o}}renderElement(e,t,i,s){this.renderedNodes.set(e,i),this.renderedElements.set(e.element,e),this.renderTreeElement(e,i),this.renderer.renderElement(e,t,i.templateData,s)}disposeElement(e,t,i,s){var n,o;i.indentGuidesDisposable.dispose(),(o=(n=this.renderer).disposeElement)==null||o.call(n,e,t,i.templateData,s),typeof s=="number"&&(this.renderedNodes.delete(e),this.renderedElements.delete(e.element))}disposeTemplate(e){this.renderer.disposeTemplate(e.templateData)}onDidChangeTwistieState(e){const t=this.renderedElements.get(e);t&&this.onDidChangeNodeTwistieState(t)}onDidChangeNodeTwistieState(e){const t=this.renderedNodes.get(e);t&&(this._onDidChangeActiveNodes(this.activeNodes.elements),this.renderTreeElement(e,t))}renderTreeElement(e,t){const i=ke.DefaultIndent+(e.depth-1)*this.indent;t.twistie.style.paddingLeft=`${i}px`,t.indent.style.width=`${i+this.indent-16}px`,e.collapsible?t.container.setAttribute("aria-expanded",String(!e.collapsed)):t.container.removeAttribute("aria-expanded"),t.twistie.classList.remove(...ue.asClassNameArray(fe.treeItemExpanded));let s=!1;this.renderer.renderTwistie&&(s=this.renderer.renderTwistie(e.element,t.twistie)),e.collapsible&&(!this.hideTwistiesOfChildlessElements||e.visibleChildrenCount>0)?(s||t.twistie.classList.add(...ue.asClassNameArray(fe.treeItemExpanded)),t.twistie.classList.add("collapsible"),t.twistie.classList.toggle("collapsed",e.collapsed)):t.twistie.classList.remove("collapsible","collapsed"),this._renderIndentGuides(e,t)}_renderIndentGuides(e,t){if(Wt(t.indent),t.indentGuidesDisposable.dispose(),!this.shouldRenderIndentGuides)return;const i=new F,s=this.modelProvider();for(;;){const n=s.getNodeLocation(e),o=s.getParentNodeLocation(n);if(!o)break;const l=s.getNode(o),a=z(".indent-guide",{style:`width: ${this.indent}px`});this.activeIndentNodes.has(l)&&a.classList.add("active"),t.indent.childElementCount===0?t.indent.appendChild(a):t.indent.insertBefore(a,t.indent.firstElementChild),this.renderedIndentGuides.add(l,a),i.add(gt(()=>this.renderedIndentGuides.delete(l,a))),e=l}t.indentGuidesDisposable=i}_onDidChangeActiveNodes(e){if(!this.shouldRenderIndentGuides)return;const t=new Set,i=this.modelProvider();e.forEach(s=>{const n=i.getNodeLocation(s);try{const o=i.getParentNodeLocation(n);s.collapsible&&s.children.length>0&&!s.collapsed?t.add(s):o&&t.add(i.getNode(o))}catch{}}),this.activeIndentNodes.forEach(s=>{t.has(s)||this.renderedIndentGuides.forEach(s,n=>n.classList.remove("active"))}),t.forEach(s=>{this.activeIndentNodes.has(s)||this.renderedIndentGuides.forEach(s,n=>n.classList.add("active"))}),this.activeIndentNodes=t}dispose(){this.renderedNodes.clear(),this.renderedElements.clear(),this.indentGuidesDisposable.dispose(),De(this.disposables)}};ke.DefaultIndent=8;let Ot=ke;class to{get totalCount(){return this._totalCount}get matchCount(){return this._matchCount}constructor(e,t,i){this.tree=e,this.keyboardNavigationLabelProvider=t,this._filter=i,this._totalCount=0,this._matchCount=0,this._pattern="",this._lowercasePattern="",this.disposables=new F,e.onWillRefilter(this.reset,this,this.disposables)}filter(e,t){let i=1;if(this._filter){const o=this._filter.filter(e,t);if(typeof o=="boolean"?i=o?1:0:Gt(o)?i=Me(o.visibility):i=o,i===0)return!1}if(this._totalCount++,!this._pattern)return this._matchCount++,{data:Xe.Default,visibility:i};const s=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e),n=Array.isArray(s)?s:[s];for(const o of n){const l=o&&o.toString();if(typeof l>"u")return{data:Xe.Default,visibility:i};let a;if(this.tree.findMatchType===ge.Contiguous){const h=l.toLowerCase().indexOf(this._lowercasePattern);if(h>-1){a=[Number.MAX_SAFE_INTEGER,0];for(let c=this._lowercasePattern.length;c>0;c--)a.push(h+c-1)}}else a=ln(this._pattern,this._lowercasePattern,0,l,l.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});if(a)return this._matchCount++,n.length===1?{data:a,visibility:i}:{data:{label:l,score:a},visibility:i}}return this.tree.findMode===ee.Filter?typeof this.tree.options.defaultFindVisibility=="number"?this.tree.options.defaultFindVisibility:this.tree.options.defaultFindVisibility?this.tree.options.defaultFindVisibility(e):2:{data:Xe.Default,visibility:i}}reset(){this._totalCount=0,this._matchCount=0}dispose(){De(this.disposables)}}var ee;(function(r){r[r.Highlight=0]="Highlight",r[r.Filter=1]="Filter"})(ee||(ee={}));var ge;(function(r){r[r.Fuzzy=0]="Fuzzy",r[r.Contiguous=1]="Contiguous"})(ge||(ge={}));class io{get pattern(){return this._pattern}get mode(){return this._mode}set mode(e){e!==this._mode&&(this._mode=e,this.widget&&(this.widget.mode=this._mode),this.tree.refilter(),this.render(),this._onDidChangeMode.fire(e))}get matchType(){return this._matchType}set matchType(e){e!==this._matchType&&(this._matchType=e,this.widget&&(this.widget.matchType=this._matchType),this.tree.refilter(),this.render(),this._onDidChangeMatchType.fire(e))}constructor(e,t,i,s,n,o={}){this.tree=e,this.view=i,this.filter=s,this.contextViewProvider=n,this.options=o,this._pattern="",this.width=0,this._onDidChangeMode=new P,this.onDidChangeMode=this._onDidChangeMode.event,this._onDidChangeMatchType=new P,this.onDidChangeMatchType=this._onDidChangeMatchType.event,this._onDidChangePattern=new P,this._onDidChangeOpenState=new P,this.onDidChangeOpenState=this._onDidChangeOpenState.event,this.enabledDisposables=new F,this.disposables=new F,this._mode=e.options.defaultFindMode??ee.Highlight,this._matchType=e.options.defaultFindMatchType??ge.Fuzzy,t.onDidSplice(this.onDidSpliceModel,this,this.disposables)}updateOptions(e={}){e.defaultFindMode!==void 0&&(this.mode=e.defaultFindMode),e.defaultFindMatchType!==void 0&&(this.matchType=e.defaultFindMatchType)}onDidSpliceModel(){!this.widget||this.pattern.length===0||(this.tree.refilter(),this.render())}render(){var t,i,s;const e=this.filter.totalCount>0&&this.filter.matchCount===0;this.pattern&&e?(fi(C("replFindNoResults","No results")),this.tree.options.showNotFoundMessage??!0?(t=this.widget)==null||t.showMessage({type:2,content:C("not found","No elements found.")}):(i=this.widget)==null||i.showMessage({type:2})):((s=this.widget)==null||s.clearMessage(),this.pattern&&fi(C("replFindResults","{0} results",this.filter.matchCount)))}shouldAllowFocus(e){return!this.widget||!this.pattern||this.filter.totalCount>0&&this.filter.matchCount<=1?!0:!Xe.isDefault(e.filterData)}layout(e){var t;this.width=e,(t=this.widget)==null||t.layout(e)}dispose(){this._history=void 0,this._onDidChangePattern.dispose(),this.enabledDisposables.dispose(),this.disposables.dispose()}}function so(r,e){return r.position===e.position&&is(r,e)}function is(r,e){return r.node.element===e.node.element&&r.startIndex===e.startIndex&&r.height===e.height&&r.endIndex===e.endIndex}class no{constructor(e=[]){this.stickyNodes=e}get count(){return this.stickyNodes.length}equal(e){return tt(this.stickyNodes,e.stickyNodes,so)}lastNodePartiallyVisible(){if(this.count===0)return!1;const e=this.stickyNodes[this.count-1];if(this.count===1)return e.position!==0;const t=this.stickyNodes[this.count-2];return t.position+t.height!==e.position}animationStateChanged(e){if(!tt(this.stickyNodes,e.stickyNodes,is)||this.count===0)return!1;const t=this.stickyNodes[this.count-1],i=e.stickyNodes[e.count-1];return t.position!==i.position}}class oo{constrainStickyScrollNodes(e,t,i){for(let s=0;s<e.length;s++){const n=e[s];if(n.position+n.height>i||s>=t)return e.slice(0,s)}return e}}class _i extends K{constructor(e,t,i,s,n,o={}){super(),this.tree=e,this.model=t,this.view=i,this.treeDelegate=n,this.maxWidgetViewRatio=.4;const l=this.validateStickySettings(o);this.stickyScrollMaxItemCount=l.stickyScrollMaxItemCount,this.stickyScrollDelegate=o.stickyScrollDelegate??new oo,this._widget=this._register(new ro(i.getScrollableElement(),i,e,s,n,o.accessibilityProvider)),this.onDidChangeHasFocus=this._widget.onDidChangeHasFocus,this.onContextMenu=this._widget.onContextMenu,this._register(i.onDidScroll(()=>this.update())),this._register(i.onDidChangeContentHeight(()=>this.update())),this._register(e.onDidChangeCollapseState(()=>this.update())),this.update()}get height(){return this._widget.height}getNodeAtHeight(e){let t;if(e===0?t=this.view.firstVisibleIndex:t=this.view.indexAt(e+this.view.scrollTop),!(t<0||t>=this.view.length))return this.view.element(t)}update(){const e=this.getNodeAtHeight(0);if(!e||this.tree.scrollTop===0){this._widget.setState(void 0);return}const t=this.findStickyState(e);this._widget.setState(t)}findStickyState(e){const t=[];let i=e,s=0,n=this.getNextStickyNode(i,void 0,s);for(;n&&(t.push(n),s+=n.height,!(t.length<=this.stickyScrollMaxItemCount&&(i=this.getNextVisibleNode(n),!i)));)n=this.getNextStickyNode(i,n.node,s);const o=this.constrainStickyNodes(t);return o.length?new no(o):void 0}getNextVisibleNode(e){return this.getNodeAtHeight(e.position+e.height)}getNextStickyNode(e,t,i){const s=this.getAncestorUnderPrevious(e,t);if(s&&!(s===e&&(!this.nodeIsUncollapsedParent(e)||this.nodeTopAlignsWithStickyNodesBottom(e,i))))return this.createStickyScrollNode(s,i)}nodeTopAlignsWithStickyNodesBottom(e,t){const i=this.getNodeIndex(e),s=this.view.getElementTop(i),n=t;return this.view.scrollTop===s-n}createStickyScrollNode(e,t){const i=this.treeDelegate.getHeight(e),{startIndex:s,endIndex:n}=this.getNodeRange(e),o=this.calculateStickyNodePosition(n,t,i);return{node:e,position:o,height:i,startIndex:s,endIndex:n}}getAncestorUnderPrevious(e,t=void 0){let i=e,s=this.getParentNode(i);for(;s;){if(s===t)return i;i=s,s=this.getParentNode(i)}if(t===void 0)return i}calculateStickyNodePosition(e,t,i){let s=this.view.getRelativeTop(e);if(s===null&&this.view.firstVisibleIndex===e&&e+1<this.view.length){const h=this.treeDelegate.getHeight(this.view.element(e)),c=this.view.getRelativeTop(e+1);s=c?c-h/this.view.renderHeight:null}if(s===null)return t;const n=this.view.element(e),o=this.treeDelegate.getHeight(n),a=s*this.view.renderHeight+o;return t+i>a&&t<=a?a-i:t}constrainStickyNodes(e){if(e.length===0)return[];const t=this.view.renderHeight*this.maxWidgetViewRatio,i=e[e.length-1];if(e.length<=this.stickyScrollMaxItemCount&&i.position+i.height<=t)return e;const s=this.stickyScrollDelegate.constrainStickyScrollNodes(e,this.stickyScrollMaxItemCount,t);if(!s.length)return[];const n=s[s.length-1];if(s.length>this.stickyScrollMaxItemCount||n.position+n.height>t)throw new Error("stickyScrollDelegate violates constraints");return s}getParentNode(e){const t=this.model.getNodeLocation(e),i=this.model.getParentNodeLocation(t);return i?this.model.getNode(i):void 0}nodeIsUncollapsedParent(e){const t=this.model.getNodeLocation(e);return this.model.getListRenderCount(t)>1}getNodeIndex(e){const t=this.model.getNodeLocation(e);return this.model.getListIndex(t)}getNodeRange(e){const t=this.model.getNodeLocation(e),i=this.model.getListIndex(t);if(i<0)throw new Error("Node not found in tree");const s=this.model.getListRenderCount(t),n=i+s-1;return{startIndex:i,endIndex:n}}nodePositionTopBelowWidget(e){const t=[];let i=this.getParentNode(e);for(;i;)t.push(i),i=this.getParentNode(i);let s=0;for(let n=0;n<t.length&&n<this.stickyScrollMaxItemCount;n++)s+=this.treeDelegate.getHeight(t[n]);return s}domFocus(){this._widget.domFocus()}focusedLast(){return this._widget.focusedLast()}updateOptions(e={}){if(!e.stickyScrollMaxItemCount)return;const t=this.validateStickySettings(e);this.stickyScrollMaxItemCount!==t.stickyScrollMaxItemCount&&(this.stickyScrollMaxItemCount=t.stickyScrollMaxItemCount,this.update())}validateStickySettings(e){let t=7;return typeof e.stickyScrollMaxItemCount=="number"&&(t=Math.max(e.stickyScrollMaxItemCount,1)),{stickyScrollMaxItemCount:t}}}class ro{constructor(e,t,i,s,n,o){this.view=t,this.tree=i,this.treeRenderers=s,this.treeDelegate=n,this.accessibilityProvider=o,this._previousElements=[],this._previousStateDisposables=new F,this._rootDomNode=z(".monaco-tree-sticky-container.empty"),e.appendChild(this._rootDomNode);const l=z(".monaco-tree-sticky-container-shadow");this._rootDomNode.appendChild(l),this.stickyScrollFocus=new lo(this._rootDomNode,t),this.onDidChangeHasFocus=this.stickyScrollFocus.onDidChangeHasFocus,this.onContextMenu=this.stickyScrollFocus.onContextMenu}get height(){if(!this._previousState)return 0;const e=this._previousState.stickyNodes[this._previousState.count-1];return e.position+e.height}setState(e){const t=!!this._previousState&&this._previousState.count>0,i=!!e&&e.count>0;if(!t&&!i||t&&i&&this._previousState.equal(e))return;if(t!==i&&this.setVisible(i),!i){this._previousState=void 0,this._previousElements=[],this._previousStateDisposables.clear();return}const s=e.stickyNodes[e.count-1];if(this._previousState&&e.animationStateChanged(this._previousState))this._previousElements[this._previousState.count-1].style.top=`${s.position}px`;else{this._previousStateDisposables.clear();const n=Array(e.count);for(let o=e.count-1;o>=0;o--){const l=e.stickyNodes[o],{element:a,disposable:h}=this.createElement(l,o,e.count);n[o]=a,this._rootDomNode.appendChild(a),this._previousStateDisposables.add(h)}this.stickyScrollFocus.updateElements(n,e),this._previousElements=n}this._previousState=e,this._rootDomNode.style.height=`${s.position+s.height}px`}createElement(e,t,i){const s=e.startIndex,n=document.createElement("div");n.style.top=`${e.position}px`,this.tree.options.setRowHeight!==!1&&(n.style.height=`${e.height}px`),this.tree.options.setRowLineHeight!==!1&&(n.style.lineHeight=`${e.height}px`),n.classList.add("monaco-tree-sticky-row"),n.classList.add("monaco-list-row"),n.setAttribute("data-index",`${s}`),n.setAttribute("data-parity",s%2===0?"even":"odd"),n.setAttribute("id",this.view.getElementID(s));const o=this.setAccessibilityAttributes(n,e.node.element,t,i),l=this.treeDelegate.getTemplateId(e.node),a=this.treeRenderers.find(f=>f.templateId===l);if(!a)throw new Error(`No renderer found for template id ${l}`);let h=e.node;h===this.tree.getNode(this.tree.getNodeLocation(e.node))&&(h=new Proxy(e.node,{}));const c=a.renderTemplate(n);a.renderElement(h,e.startIndex,c,e.height);const d=gt(()=>{o.dispose(),a.disposeElement(h,e.startIndex,c,e.height),a.disposeTemplate(c),n.remove()});return{element:n,disposable:d}}setAccessibilityAttributes(e,t,i,s){if(!this.accessibilityProvider)return K.None;this.accessibilityProvider.getSetSize&&e.setAttribute("aria-setsize",String(this.accessibilityProvider.getSetSize(t,i,s))),this.accessibilityProvider.getPosInSet&&e.setAttribute("aria-posinset",String(this.accessibilityProvider.getPosInSet(t,i))),this.accessibilityProvider.getRole&&e.setAttribute("role",this.accessibilityProvider.getRole(t)??"treeitem");const n=this.accessibilityProvider.getAriaLabel(t),o=n&&typeof n!="string"?n:gn(n),l=pn(h=>{const c=h.readObservable(o);c?e.setAttribute("aria-label",c):e.removeAttribute("aria-label")});typeof n=="string"||n&&e.setAttribute("aria-label",n.get());const a=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(t);return typeof a=="number"&&e.setAttribute("aria-level",`${a}`),e.setAttribute("aria-selected",String(!1)),l}setVisible(e){this._rootDomNode.classList.toggle("empty",!e),e||this.stickyScrollFocus.updateElements([],void 0)}domFocus(){this.stickyScrollFocus.domFocus()}focusedLast(){return this.stickyScrollFocus.focusedLast()}dispose(){this.stickyScrollFocus.dispose(),this._previousStateDisposables.dispose(),this._rootDomNode.remove()}}class lo extends K{get domHasFocus(){return this._domHasFocus}set domHasFocus(e){e!==this._domHasFocus&&(this._onDidChangeHasFocus.fire(e),this._domHasFocus=e)}constructor(e,t){super(),this.container=e,this.view=t,this.focusedIndex=-1,this.elements=[],this._onDidChangeHasFocus=new P,this.onDidChangeHasFocus=this._onDidChangeHasFocus.event,this._onContextMenu=new P,this.onContextMenu=this._onContextMenu.event,this._domHasFocus=!1,this._register(ce(this.container,"focus",()=>this.onFocus())),this._register(ce(this.container,"blur",()=>this.onBlur())),this._register(this.view.onDidFocus(()=>this.toggleStickyScrollFocused(!1))),this._register(this.view.onKeyDown(i=>this.onKeyDown(i))),this._register(this.view.onMouseDown(i=>this.onMouseDown(i))),this._register(this.view.onContextMenu(i=>this.handleContextMenu(i)))}handleContextMenu(e){const t=e.browserEvent.target;if(!Te(t)&&!xe(t)){this.focusedLast()&&this.view.domFocus();return}if(!le(e.browserEvent)){if(!this.state)throw new Error("Context menu should not be triggered when state is undefined");const o=this.state.stickyNodes.findIndex(l=>{var a;return l.node.element===((a=e.element)==null?void 0:a.element)});if(o===-1)throw new Error("Context menu should not be triggered when element is not in sticky scroll widget");this.container.focus(),this.setFocus(o);return}if(!this.state||this.focusedIndex<0)throw new Error("Context menu key should not be triggered when focus is not in sticky scroll widget");const s=this.state.stickyNodes[this.focusedIndex].node.element,n=this.elements[this.focusedIndex];this._onContextMenu.fire({element:s,anchor:n,browserEvent:e.browserEvent,isStickyScroll:!0})}onKeyDown(e){if(this.domHasFocus&&this.state){if(e.key==="ArrowUp")this.setFocusedElement(Math.max(0,this.focusedIndex-1)),e.preventDefault(),e.stopPropagation();else if(e.key==="ArrowDown"||e.key==="ArrowRight"){if(this.focusedIndex>=this.state.count-1){const t=this.state.stickyNodes[this.state.count-1].startIndex+1;this.view.domFocus(),this.view.setFocus([t]),this.scrollNodeUnderWidget(t,this.state)}else this.setFocusedElement(this.focusedIndex+1);e.preventDefault(),e.stopPropagation()}}}onMouseDown(e){const t=e.browserEvent.target;!Te(t)&&!xe(t)||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation())}updateElements(e,t){if(t&&t.count===0)throw new Error("Sticky scroll state must be undefined when there are no sticky nodes");if(t&&t.count!==e.length)throw new Error("Sticky scroll focus received illigel state");const i=this.focusedIndex;if(this.removeFocus(),this.elements=e,this.state=t,t){const s=R(i,0,t.count-1);this.setFocus(s)}else this.domHasFocus&&this.view.domFocus();this.container.tabIndex=t?0:-1}setFocusedElement(e){const t=this.state;if(!t)throw new Error("Cannot set focus when state is undefined");if(this.setFocus(e),!(e<t.count-1)&&t.lastNodePartiallyVisible()){const i=t.stickyNodes[e];this.scrollNodeUnderWidget(i.endIndex+1,t)}}scrollNodeUnderWidget(e,t){const i=t.stickyNodes[t.count-1],s=t.count>1?t.stickyNodes[t.count-2]:void 0,n=this.view.getElementTop(e),o=s?s.position+s.height+i.height:i.height;this.view.scrollTop=n-o}domFocus(){if(!this.state)throw new Error("Cannot focus when state is undefined");this.container.focus()}focusedLast(){return this.state?this.view.getHTMLElement().classList.contains("sticky-scroll-focused"):!1}removeFocus(){this.focusedIndex!==-1&&(this.toggleElementFocus(this.elements[this.focusedIndex],!1),this.focusedIndex=-1)}setFocus(e){if(0>e)throw new Error("addFocus() can not remove focus");if(!this.state&&e>=0)throw new Error("Cannot set focus index when state is undefined");if(this.state&&e>=this.state.count)throw new Error("Cannot set focus index to an index that does not exist");const t=this.focusedIndex;t>=0&&this.toggleElementFocus(this.elements[t],!1),e>=0&&this.toggleElementFocus(this.elements[e],!0),this.focusedIndex=e}toggleElementFocus(e,t){this.toggleElementActiveFocus(e,t&&this.domHasFocus),this.toggleElementPassiveFocus(e,t)}toggleCurrentElementActiveFocus(e){this.focusedIndex!==-1&&this.toggleElementActiveFocus(this.elements[this.focusedIndex],e)}toggleElementActiveFocus(e,t){e.classList.toggle("focused",t)}toggleElementPassiveFocus(e,t){e.classList.toggle("passive-focused",t)}toggleStickyScrollFocused(e){this.view.getHTMLElement().classList.toggle("sticky-scroll-focused",e)}onFocus(){if(!this.state||this.elements.length===0)throw new Error("Cannot focus when state is undefined or elements are empty");this.domHasFocus=!0,this.toggleStickyScrollFocused(!0),this.toggleCurrentElementActiveFocus(!0),this.focusedIndex===-1&&this.setFocus(0)}onBlur(){this.domHasFocus=!1,this.toggleCurrentElementActiveFocus(!1)}dispose(){this.toggleStickyScrollFocused(!1),this._onDidChangeHasFocus.fire(!1),super.dispose()}}function We(r){let e=de.Unknown;return Nt(r.browserEvent.target,"monaco-tl-twistie","monaco-tl-row")?e=de.Twistie:Nt(r.browserEvent.target,"monaco-tl-contents","monaco-tl-row")?e=de.Element:Nt(r.browserEvent.target,"monaco-tree-type-filter","monaco-list")&&(e=de.Filter),{browserEvent:r.browserEvent,element:r.element?r.element.element:null,target:e}}function ao(r){const e=Te(r.browserEvent.target);return{element:r.element?r.element.element:null,browserEvent:r.browserEvent,anchor:r.anchor,isStickyScroll:e}}function Je(r,e){e(r),r.children.forEach(t=>Je(t,e))}class Et{get nodeSet(){return this._nodeSet||(this._nodeSet=this.createNodeSet()),this._nodeSet}constructor(e,t){this.getFirstViewElementWithTrait=e,this.identityProvider=t,this.nodes=[],this._onDidChange=new P,this.onDidChange=this._onDidChange.event}set(e,t){!(t!=null&&t.__forceEvent)&&tt(this.nodes,e)||this._set(e,!1,t)}_set(e,t,i){if(this.nodes=[...e],this.elements=void 0,this._nodeSet=void 0,!t){const s=this;this._onDidChange.fire({get elements(){return s.get()},browserEvent:i})}}get(){return this.elements||(this.elements=this.nodes.map(e=>e.element)),[...this.elements]}getNodes(){return this.nodes}has(e){return this.nodeSet.has(e)}onDidModelSplice({insertedNodes:e,deletedNodes:t}){if(!this.identityProvider){const a=this.createNodeSet(),h=c=>a.delete(c);t.forEach(c=>Je(c,h)),this.set([...a.values()]);return}const i=new Set,s=a=>i.add(this.identityProvider.getId(a.element).toString());t.forEach(a=>Je(a,s));const n=new Map,o=a=>n.set(this.identityProvider.getId(a.element).toString(),a);e.forEach(a=>Je(a,o));const l=[];for(const a of this.nodes){const h=this.identityProvider.getId(a.element).toString();if(!i.has(h))l.push(a);else{const d=n.get(h);d&&d.visible&&l.push(d)}}if(this.nodes.length>0&&l.length===0){const a=this.getFirstViewElementWithTrait();a&&l.push(a)}this._set(l,!0)}createNodeSet(){const e=new Set;for(const t of this.nodes)e.add(t);return e}}class ho extends mn{constructor(e,t,i){super(e),this.tree=t,this.stickyScrollProvider=i}onViewPointer(e){if(bn(e.browserEvent.target)||Xi(e.browserEvent.target)||yn(e.browserEvent.target)||e.browserEvent.isHandledByList)return;const t=e.element;if(!t)return super.onViewPointer(e);if(this.isSelectionRangeChangeEvent(e)||this.isSelectionSingleChangeEvent(e))return super.onViewPointer(e);const i=e.browserEvent.target,s=i.classList.contains("monaco-tl-twistie")||i.classList.contains("monaco-icon-label")&&i.classList.contains("folder-icon")&&e.browserEvent.offsetX<16,n=xe(e.browserEvent.target);let o=!1;if(n?o=!0:typeof this.tree.expandOnlyOnTwistieClick=="function"?o=this.tree.expandOnlyOnTwistieClick(t.element):o=!!this.tree.expandOnlyOnTwistieClick,n)this.handleStickyScrollMouseEvent(e,t);else{if(o&&!s&&e.browserEvent.detail!==2)return super.onViewPointer(e);if(!this.tree.expandOnDoubleClick&&e.browserEvent.detail===2)return super.onViewPointer(e)}if(t.collapsible&&(!n||s)){const l=this.tree.getNodeLocation(t),a=e.browserEvent.altKey;if(this.tree.setFocus([l]),this.tree.toggleCollapsed(l,a),s){e.browserEvent.isHandledByList=!0;return}}n||super.onViewPointer(e)}handleStickyScrollMouseEvent(e,t){if(Sn(e.browserEvent.target)||vn(e.browserEvent.target))return;const i=this.stickyScrollProvider();if(!i)throw new Error("Sticky scroll controller not found");const s=this.list.indexOf(t),n=this.list.getElementTop(s),o=i.nodePositionTopBelowWidget(t);this.tree.scrollTop=n-o,this.list.domFocus(),this.list.setFocus([s]),this.list.setSelection([s])}onDoubleClick(e){e.browserEvent.target.classList.contains("monaco-tl-twistie")||!this.tree.expandOnDoubleClick||e.browserEvent.isHandledByList||super.onDoubleClick(e)}onMouseDown(e){const t=e.browserEvent.target;if(!Te(t)&&!xe(t)){super.onMouseDown(e);return}}onContextMenu(e){const t=e.browserEvent.target;if(!Te(t)&&!xe(t)){super.onContextMenu(e);return}}}class co extends pt{constructor(e,t,i,s,n,o,l,a){super(e,t,i,s,a),this.focusTrait=n,this.selectionTrait=o,this.anchorTrait=l}createMouseController(e){return new ho(this,e.tree,e.stickyScrollProvider)}splice(e,t,i=[]){if(super.splice(e,t,i),i.length===0)return;const s=[],n=[];let o;i.forEach((l,a)=>{this.focusTrait.has(l)&&s.push(e+a),this.selectionTrait.has(l)&&n.push(e+a),this.anchorTrait.has(l)&&(o=e+a)}),s.length>0&&super.setFocus(hi([...super.getFocus(),...s])),n.length>0&&super.setSelection(hi([...super.getSelection(),...n])),typeof o=="number"&&super.setAnchor(o)}setFocus(e,t,i=!1){super.setFocus(e,t),i||this.focusTrait.set(e.map(s=>this.element(s)),t)}setSelection(e,t,i=!1){super.setSelection(e,t),i||this.selectionTrait.set(e.map(s=>this.element(s)),t)}setAnchor(e,t=!1){super.setAnchor(e),t||(typeof e>"u"?this.anchorTrait.set([]):this.anchorTrait.set([this.element(e)]))}}class ss{get onDidScroll(){return this.view.onDidScroll}get onDidChangeFocus(){return this.eventBufferer.wrapEvent(this.focus.onDidChange)}get onDidChangeSelection(){return this.eventBufferer.wrapEvent(this.selection.onDidChange)}get onMouseDblClick(){return _.filter(_.map(this.view.onMouseDblClick,We),e=>e.target!==de.Filter)}get onMouseOver(){return _.map(this.view.onMouseOver,We)}get onMouseOut(){return _.map(this.view.onMouseOut,We)}get onContextMenu(){var e;return _.any(_.filter(_.map(this.view.onContextMenu,ao),t=>!t.isStickyScroll),((e=this.stickyScrollController)==null?void 0:e.onContextMenu)??_.None)}get onPointer(){return _.map(this.view.onPointer,We)}get onKeyDown(){return this.view.onKeyDown}get onDidFocus(){return this.view.onDidFocus}get onDidChangeModel(){return _.signal(this.model.onDidSplice)}get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}get findMode(){var e;return((e=this.findController)==null?void 0:e.mode)??ee.Highlight}set findMode(e){this.findController&&(this.findController.mode=e)}get findMatchType(){var e;return((e=this.findController)==null?void 0:e.matchType)??ge.Fuzzy}set findMatchType(e){this.findController&&(this.findController.matchType=e)}get expandOnDoubleClick(){return typeof this._options.expandOnDoubleClick>"u"?!0:this._options.expandOnDoubleClick}get expandOnlyOnTwistieClick(){return typeof this._options.expandOnlyOnTwistieClick>"u"?!0:this._options.expandOnlyOnTwistieClick}get onDidDispose(){return this.view.onDidDispose}constructor(e,t,i,s,n={}){this._user=e,this._options=n,this.eventBufferer=new Bi,this.onDidChangeFindOpenState=_.None,this.onDidChangeStickyScrollFocused=_.None,this.disposables=new F,this._onWillRefilter=new P,this.onWillRefilter=this._onWillRefilter.event,this._onDidUpdateOptions=new P,this.treeDelegate=new jt(i);const o=new ai,l=new ai,a=this.disposables.add(new eo(l.event)),h=new an;this.renderers=s.map(p=>new Ot(p,()=>this.model,o.event,a,h,n));for(const p of this.renderers)this.disposables.add(p);let c;n.keyboardNavigationLabelProvider&&(c=new to(this,n.keyboardNavigationLabelProvider,n.filter),n={...n,filter:c},this.disposables.add(c)),this.focus=new Et(()=>this.view.getFocusedElements()[0],n.identityProvider),this.selection=new Et(()=>this.view.getSelectedElements()[0],n.identityProvider),this.anchor=new Et(()=>this.view.getAnchorElement(),n.identityProvider),this.view=new co(e,t,this.treeDelegate,this.renderers,this.focus,this.selection,this.anchor,{...Zn(()=>this.model,n),tree:this,stickyScrollProvider:()=>this.stickyScrollController}),this.model=this.createModel(e,this.view,n),o.input=this.model.onDidChangeCollapseState;const d=_.forEach(this.model.onDidSplice,p=>{this.eventBufferer.bufferEvents(()=>{this.focus.onDidModelSplice(p),this.selection.onDidModelSplice(p)})},this.disposables);d(()=>null,null,this.disposables);const f=this.disposables.add(new P),g=this.disposables.add(new Vi(0));if(this.disposables.add(_.any(d,this.focus.onDidChange,this.selection.onDidChange)(()=>{g.trigger(()=>{const p=new Set;for(const u of this.focus.getNodes())p.add(u);for(const u of this.selection.getNodes())p.add(u);f.fire([...p.values()])})})),l.input=f.event,n.keyboardSupport!==!1){const p=_.chain(this.view.onKeyDown,u=>u.filter(m=>!Xi(m.target)).map(m=>new Hi(m)));_.chain(p,u=>u.filter(m=>m.keyCode===15))(this.onLeftArrow,this,this.disposables),_.chain(p,u=>u.filter(m=>m.keyCode===17))(this.onRightArrow,this,this.disposables),_.chain(p,u=>u.filter(m=>m.keyCode===10))(this.onSpace,this,this.disposables)}if((n.findWidgetEnabled??!0)&&n.keyboardNavigationLabelProvider&&n.contextViewProvider){const p=this.options.findWidgetStyles?{styles:this.options.findWidgetStyles}:void 0;this.findController=new io(this,this.model,this.view,c,n.contextViewProvider,p),this.focusNavigationFilter=u=>this.findController.shouldAllowFocus(u),this.onDidChangeFindOpenState=this.findController.onDidChangeOpenState,this.disposables.add(this.findController),this.onDidChangeFindMode=this.findController.onDidChangeMode,this.onDidChangeFindMatchType=this.findController.onDidChangeMatchType}else this.onDidChangeFindMode=_.None,this.onDidChangeFindMatchType=_.None;n.enableStickyScroll&&(this.stickyScrollController=new _i(this,this.model,this.view,this.renderers,this.treeDelegate,n),this.onDidChangeStickyScrollFocused=this.stickyScrollController.onDidChangeHasFocus),this.styleElement=Vt(this.view.getHTMLElement()),this.getHTMLElement().classList.toggle("always",this._options.renderIndentGuides===Pe.Always)}updateOptions(e={}){var t;this._options={...this._options,...e};for(const i of this.renderers)i.updateOptions(e);this.view.updateOptions(this._options),(t=this.findController)==null||t.updateOptions(e),this.updateStickyScroll(e),this._onDidUpdateOptions.fire(this._options),this.getHTMLElement().classList.toggle("always",this._options.renderIndentGuides===Pe.Always)}get options(){return this._options}updateStickyScroll(e){var t;!this.stickyScrollController&&this._options.enableStickyScroll?(this.stickyScrollController=new _i(this,this.model,this.view,this.renderers,this.treeDelegate,this._options),this.onDidChangeStickyScrollFocused=this.stickyScrollController.onDidChangeHasFocus):this.stickyScrollController&&!this._options.enableStickyScroll&&(this.onDidChangeStickyScrollFocused=_.None,this.stickyScrollController.dispose(),this.stickyScrollController=void 0),(t=this.stickyScrollController)==null||t.updateOptions(e)}getHTMLElement(){return this.view.getHTMLElement()}get scrollTop(){return this.view.scrollTop}set scrollTop(e){this.view.scrollTop=e}get scrollHeight(){return this.view.scrollHeight}get renderHeight(){return this.view.renderHeight}get ariaLabel(){return this.view.ariaLabel}set ariaLabel(e){this.view.ariaLabel=e}domFocus(){var e;(e=this.stickyScrollController)!=null&&e.focusedLast()?this.stickyScrollController.domFocus():this.view.domFocus()}layout(e,t){var i;this.view.layout(e,t),Ms(t)&&((i=this.findController)==null||i.layout(t))}style(e){const t=`.${this.view.domId}`,i=[];e.treeIndentGuidesStroke&&(i.push(`.monaco-list${t}:hover .monaco-tl-indent > .indent-guide, .monaco-list${t}.always .monaco-tl-indent > .indent-guide  { border-color: ${e.treeInactiveIndentGuidesStroke}; }`),i.push(`.monaco-list${t} .monaco-tl-indent > .indent-guide.active { border-color: ${e.treeIndentGuidesStroke}; }`));const s=e.treeStickyScrollBackground??e.listBackground;s&&(i.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container { background-color: ${s}; }`),i.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container .monaco-tree-sticky-row { background-color: ${s}; }`)),e.treeStickyScrollBorder&&i.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container { border-bottom: 1px solid ${e.treeStickyScrollBorder}; }`),e.treeStickyScrollShadow&&i.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container .monaco-tree-sticky-container-shadow { box-shadow: ${e.treeStickyScrollShadow} 0 6px 6px -6px inset; height: 3px; }`),e.listFocusForeground&&(i.push(`.monaco-list${t}.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container:focus .monaco-list-row.focused { color: ${e.listFocusForeground}; }`),i.push(`.monaco-list${t}:not(.sticky-scroll-focused) .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.focused { color: inherit; }`));const n=di(e.listFocusAndSelectionOutline,di(e.listSelectionOutline,e.listFocusOutline??""));n&&(i.push(`.monaco-list${t}.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container:focus .monaco-list-row.focused.selected { outline: 1px solid ${n}; outline-offset: -1px;}`),i.push(`.monaco-list${t}:not(.sticky-scroll-focused) .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.focused.selected { outline: inherit;}`)),e.listFocusOutline&&(i.push(`.monaco-list${t}.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container:focus .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }`),i.push(`.monaco-list${t}:not(.sticky-scroll-focused) .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.focused { outline: inherit; }`),i.push(`.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.passive-focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }`),i.push(`.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused.sticky-scroll-focused .monaco-list-rows .monaco-list-row.focused { outline: inherit; }`),i.push(`.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused:not(.sticky-scroll-focused) .monaco-tree-sticky-container .monaco-list-rows .monaco-list-row.focused { outline: inherit; }`)),this.styleElement.textContent=i.join(`
`),this.view.style(e)}getParentElement(e){const t=this.model.getParentNodeLocation(e);return this.model.getNode(t).element}getFirstElementChild(e){return this.model.getFirstElementChild(e)}getNode(e){return this.model.getNode(e)}getNodeLocation(e){return this.model.getNodeLocation(e)}collapse(e,t=!1){return this.model.setCollapsed(e,!0,t)}expand(e,t=!1){return this.model.setCollapsed(e,!1,t)}toggleCollapsed(e,t=!1){return this.model.setCollapsed(e,void 0,t)}isCollapsible(e){return this.model.isCollapsible(e)}setCollapsible(e,t){return this.model.setCollapsible(e,t)}isCollapsed(e){return this.model.isCollapsed(e)}refilter(){this._onWillRefilter.fire(void 0),this.model.refilter()}setSelection(e,t){this.eventBufferer.bufferEvents(()=>{const i=e.map(n=>this.model.getNode(n));this.selection.set(i,t);const s=e.map(n=>this.model.getListIndex(n)).filter(n=>n>-1);this.view.setSelection(s,t,!0)})}getSelection(){return this.selection.get()}setFocus(e,t){this.eventBufferer.bufferEvents(()=>{const i=e.map(n=>this.model.getNode(n));this.focus.set(i,t);const s=e.map(n=>this.model.getListIndex(n)).filter(n=>n>-1);this.view.setFocus(s,t,!0)})}focusNext(e=1,t=!1,i,s=le(i)&&i.altKey?void 0:this.focusNavigationFilter){this.view.focusNext(e,t,i,s)}focusPrevious(e=1,t=!1,i,s=le(i)&&i.altKey?void 0:this.focusNavigationFilter){this.view.focusPrevious(e,t,i,s)}focusNextPage(e,t=le(e)&&e.altKey?void 0:this.focusNavigationFilter){return this.view.focusNextPage(e,t)}focusPreviousPage(e,t=le(e)&&e.altKey?void 0:this.focusNavigationFilter){return this.view.focusPreviousPage(e,t,()=>{var i;return((i=this.stickyScrollController)==null?void 0:i.height)??0})}focusLast(e,t=le(e)&&e.altKey?void 0:this.focusNavigationFilter){this.view.focusLast(e,t)}focusFirst(e,t=le(e)&&e.altKey?void 0:this.focusNavigationFilter){this.view.focusFirst(e,t)}getFocus(){return this.focus.get()}reveal(e,t){this.model.expandTo(e);const i=this.model.getListIndex(e);if(i!==-1)if(!this.stickyScrollController)this.view.reveal(i,t);else{const s=this.stickyScrollController.nodePositionTopBelowWidget(this.getNode(e));this.view.reveal(i,t,s)}}onLeftArrow(e){e.preventDefault(),e.stopPropagation();const t=this.view.getFocusedElements();if(t.length===0)return;const i=t[0],s=this.model.getNodeLocation(i);if(!this.model.setCollapsed(s,!0)){const o=this.model.getParentNodeLocation(s);if(!o)return;const l=this.model.getListIndex(o);this.view.reveal(l),this.view.setFocus([l])}}onRightArrow(e){e.preventDefault(),e.stopPropagation();const t=this.view.getFocusedElements();if(t.length===0)return;const i=t[0],s=this.model.getNodeLocation(i);if(!this.model.setCollapsed(s,!1)){if(!i.children.some(a=>a.visible))return;const[o]=this.view.getFocus(),l=o+1;this.view.reveal(l),this.view.setFocus([l])}}onSpace(e){e.preventDefault(),e.stopPropagation();const t=this.view.getFocusedElements();if(t.length===0)return;const i=t[0],s=this.model.getNodeLocation(i),n=e.browserEvent.altKey;this.model.setCollapsed(s,void 0,n)}dispose(){var e;De(this.disposables),(e=this.stickyScrollController)==null||e.dispose(),this.view.dispose()}}class qt{constructor(e,t,i={}){this.user=e,this.rootRef=null,this.nodes=new Map,this.nodesByIdentity=new Map,this.model=new Xn(e,t,null,i),this.onDidSplice=this.model.onDidSplice,this.onDidChangeCollapseState=this.model.onDidChangeCollapseState,this.onDidChangeRenderNodeCount=this.model.onDidChangeRenderNodeCount,i.sorter&&(this.sorter={compare(s,n){return i.sorter.compare(s.element,n.element)}}),this.identityProvider=i.identityProvider}setChildren(e,t=k.empty(),i={}){const s=this.getElementLocation(e);this._setChildren(s,this.preserveCollapseState(t),i)}_setChildren(e,t=k.empty(),i){const s=new Set,n=new Set,o=a=>{var c;if(a.element===null)return;const h=a;if(s.add(h.element),this.nodes.set(h.element,h),this.identityProvider){const d=this.identityProvider.getId(h.element).toString();n.add(d),this.nodesByIdentity.set(d,h)}(c=i.onDidCreateNode)==null||c.call(i,h)},l=a=>{var c;if(a.element===null)return;const h=a;if(s.has(h.element)||this.nodes.delete(h.element),this.identityProvider){const d=this.identityProvider.getId(h.element).toString();n.has(d)||this.nodesByIdentity.delete(d)}(c=i.onDidDeleteNode)==null||c.call(i,h)};this.model.splice([...e,0],Number.MAX_VALUE,t,{...i,onDidCreateNode:o,onDidDeleteNode:l})}preserveCollapseState(e=k.empty()){return this.sorter&&(e=[...e].sort(this.sorter.compare.bind(this.sorter))),k.map(e,t=>{let i=this.nodes.get(t.element);if(!i&&this.identityProvider){const o=this.identityProvider.getId(t.element).toString();i=this.nodesByIdentity.get(o)}if(!i){let o;return typeof t.collapsed>"u"?o=void 0:t.collapsed===B.Collapsed||t.collapsed===B.PreserveOrCollapsed?o=!0:t.collapsed===B.Expanded||t.collapsed===B.PreserveOrExpanded?o=!1:o=!!t.collapsed,{...t,children:this.preserveCollapseState(t.children),collapsed:o}}const s=typeof t.collapsible=="boolean"?t.collapsible:i.collapsible;let n;return typeof t.collapsed>"u"||t.collapsed===B.PreserveOrCollapsed||t.collapsed===B.PreserveOrExpanded?n=i.collapsed:t.collapsed===B.Collapsed?n=!0:t.collapsed===B.Expanded?n=!1:n=!!t.collapsed,{...t,collapsible:s,collapsed:n,children:this.preserveCollapseState(t.children)}})}rerender(e){const t=this.getElementLocation(e);this.model.rerender(t)}getFirstElementChild(e=null){const t=this.getElementLocation(e);return this.model.getFirstElementChild(t)}has(e){return this.nodes.has(e)}getListIndex(e){const t=this.getElementLocation(e);return this.model.getListIndex(t)}getListRenderCount(e){const t=this.getElementLocation(e);return this.model.getListRenderCount(t)}isCollapsible(e){const t=this.getElementLocation(e);return this.model.isCollapsible(t)}setCollapsible(e,t){const i=this.getElementLocation(e);return this.model.setCollapsible(i,t)}isCollapsed(e){const t=this.getElementLocation(e);return this.model.isCollapsed(t)}setCollapsed(e,t,i){const s=this.getElementLocation(e);return this.model.setCollapsed(s,t,i)}expandTo(e){const t=this.getElementLocation(e);this.model.expandTo(t)}refilter(){this.model.refilter()}getNode(e=null){if(e===null)return this.model.getNode(this.model.rootRef);const t=this.nodes.get(e);if(!t)throw new V(this.user,`Tree element not found: ${e}`);return t}getNodeLocation(e){return e.element}getParentNodeLocation(e){if(e===null)throw new V(this.user,"Invalid getParentNodeLocation call");const t=this.nodes.get(e);if(!t)throw new V(this.user,`Tree element not found: ${e}`);const i=this.model.getNodeLocation(t),s=this.model.getParentNodeLocation(i);return this.model.getNode(s).element}getElementLocation(e){if(e===null)return[];const t=this.nodes.get(e);if(!t)throw new V(this.user,`Tree element not found: ${e}`);return this.model.getNodeLocation(t)}}function Qe(r){const e=[r.element],t=r.incompressible||!1;return{element:{elements:e,incompressible:t},children:k.map(k.from(r.children),Qe),collapsible:r.collapsible,collapsed:r.collapsed}}function Ze(r){const e=[r.element],t=r.incompressible||!1;let i,s;for(;[s,i]=k.consume(k.from(r.children),2),!(s.length!==1||s[0].incompressible);)r=s[0],e.push(r.element);return{element:{elements:e,incompressible:t},children:k.map(k.concat(s,i),Ze),collapsible:r.collapsible,collapsed:r.collapsed}}function At(r,e=0){let t;return e<r.element.elements.length-1?t=[At(r,e+1)]:t=k.map(k.from(r.children),i=>At(i,0)),e===0&&r.element.incompressible?{element:r.element.elements[e],children:t,incompressible:!0,collapsible:r.collapsible,collapsed:r.collapsed}:{element:r.element.elements[e],children:t,collapsible:r.collapsible,collapsed:r.collapsed}}function Ni(r){return At(r,0)}function ns(r,e,t){return r.element===e?{...r,children:t}:{...r,children:k.map(k.from(r.children),i=>ns(i,e,t))}}const uo=r=>({getId(e){return e.elements.map(t=>r.getId(t).toString()).join("\0")}});class fo{get onDidSplice(){return this.model.onDidSplice}get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}get onDidChangeRenderNodeCount(){return this.model.onDidChangeRenderNodeCount}constructor(e,t,i={}){this.user=e,this.rootRef=null,this.nodes=new Map,this.model=new qt(e,t,i),this.enabled=typeof i.compressionEnabled>"u"?!0:i.compressionEnabled,this.identityProvider=i.identityProvider}setChildren(e,t=k.empty(),i){const s=i.diffIdentityProvider&&uo(i.diffIdentityProvider);if(e===null){const p=k.map(t,this.enabled?Ze:Qe);this._setChildren(null,p,{diffIdentityProvider:s,diffDepth:1/0});return}const n=this.nodes.get(e);if(!n)throw new V(this.user,"Unknown compressed tree node");const o=this.model.getNode(n),l=this.model.getParentNodeLocation(n),a=this.model.getNode(l),h=Ni(o),c=ns(h,e,t),d=(this.enabled?Ze:Qe)(c),f=i.diffIdentityProvider?(p,u)=>i.diffIdentityProvider.getId(p)===i.diffIdentityProvider.getId(u):void 0;if(tt(d.element.elements,o.element.elements,f)){this._setChildren(n,d.children||k.empty(),{diffIdentityProvider:s,diffDepth:1});return}const g=a.children.map(p=>p===o?d:p);this._setChildren(a.element,g,{diffIdentityProvider:s,diffDepth:o.depth-a.depth})}isCompressionEnabled(){return this.enabled}setCompressionEnabled(e){if(e===this.enabled)return;this.enabled=e;const i=this.model.getNode().children,s=k.map(i,Ni),n=k.map(s,e?Ze:Qe);this._setChildren(null,n,{diffIdentityProvider:this.identityProvider,diffDepth:1/0})}_setChildren(e,t,i){const s=new Set,n=l=>{for(const a of l.element.elements)s.add(a),this.nodes.set(a,l.element)},o=l=>{for(const a of l.element.elements)s.has(a)||this.nodes.delete(a)};this.model.setChildren(e,t,{...i,onDidCreateNode:n,onDidDeleteNode:o})}has(e){return this.nodes.has(e)}getListIndex(e){const t=this.getCompressedNode(e);return this.model.getListIndex(t)}getListRenderCount(e){const t=this.getCompressedNode(e);return this.model.getListRenderCount(t)}getNode(e){if(typeof e>"u")return this.model.getNode();const t=this.getCompressedNode(e);return this.model.getNode(t)}getNodeLocation(e){const t=this.model.getNodeLocation(e);return t===null?null:t.elements[t.elements.length-1]}getParentNodeLocation(e){const t=this.getCompressedNode(e),i=this.model.getParentNodeLocation(t);return i===null?null:i.elements[i.elements.length-1]}getFirstElementChild(e){const t=this.getCompressedNode(e);return this.model.getFirstElementChild(t)}isCollapsible(e){const t=this.getCompressedNode(e);return this.model.isCollapsible(t)}setCollapsible(e,t){const i=this.getCompressedNode(e);return this.model.setCollapsible(i,t)}isCollapsed(e){const t=this.getCompressedNode(e);return this.model.isCollapsed(t)}setCollapsed(e,t,i){const s=this.getCompressedNode(e);return this.model.setCollapsed(s,t,i)}expandTo(e){const t=this.getCompressedNode(e);this.model.expandTo(t)}rerender(e){const t=this.getCompressedNode(e);this.model.rerender(t)}refilter(){this.model.refilter()}getCompressedNode(e){if(e===null)return null;const t=this.nodes.get(e);if(!t)throw new V(this.user,`Tree element not found: ${e}`);return t}}const go=r=>r[r.length-1];class Ut{get element(){return this.node.element===null?null:this.unwrapper(this.node.element)}get children(){return this.node.children.map(e=>new Ut(this.unwrapper,e))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(e,t){this.unwrapper=e,this.node=t}}function po(r,e){return{splice(t,i,s){e.splice(t,i,s.map(n=>r.map(n)))},updateElementHeight(t,i){e.updateElementHeight(t,i)}}}function mo(r,e){return{...e,identityProvider:e.identityProvider&&{getId(t){return e.identityProvider.getId(r(t))}},sorter:e.sorter&&{compare(t,i){return e.sorter.compare(t.elements[0],i.elements[0])}},filter:e.filter&&{filter(t,i){return e.filter.filter(r(t),i)}}}}class bo{get onDidSplice(){return _.map(this.model.onDidSplice,({insertedNodes:e,deletedNodes:t})=>({insertedNodes:e.map(i=>this.nodeMapper.map(i)),deletedNodes:t.map(i=>this.nodeMapper.map(i))}))}get onDidChangeCollapseState(){return _.map(this.model.onDidChangeCollapseState,({node:e,deep:t})=>({node:this.nodeMapper.map(e),deep:t}))}get onDidChangeRenderNodeCount(){return _.map(this.model.onDidChangeRenderNodeCount,e=>this.nodeMapper.map(e))}constructor(e,t,i={}){this.rootRef=null,this.elementMapper=i.elementMapper||go;const s=n=>this.elementMapper(n.elements);this.nodeMapper=new $t(n=>new Ut(s,n)),this.model=new fo(e,po(this.nodeMapper,t),mo(s,i))}setChildren(e,t=k.empty(),i={}){this.model.setChildren(e,t,i)}isCompressionEnabled(){return this.model.isCompressionEnabled()}setCompressionEnabled(e){this.model.setCompressionEnabled(e)}has(e){return this.model.has(e)}getListIndex(e){return this.model.getListIndex(e)}getListRenderCount(e){return this.model.getListRenderCount(e)}getNode(e){return this.nodeMapper.map(this.model.getNode(e))}getNodeLocation(e){return e.element}getParentNodeLocation(e){return this.model.getParentNodeLocation(e)}getFirstElementChild(e){const t=this.model.getFirstElementChild(e);return t===null||typeof t>"u"?t:this.elementMapper(t.elements)}isCollapsible(e){return this.model.isCollapsible(e)}setCollapsible(e,t){return this.model.setCollapsible(e,t)}isCollapsed(e){return this.model.isCollapsed(e)}setCollapsed(e,t,i){return this.model.setCollapsed(e,t,i)}expandTo(e){return this.model.expandTo(e)}rerender(e){return this.model.rerender(e)}refilter(){return this.model.refilter()}getCompressedTreeNode(e=null){return this.model.getNode(e)}}var yo=function(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var l=r.length-1;l>=0;l--)(o=r[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n};class Yt extends ss{get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}constructor(e,t,i,s,n={}){super(e,t,i,s,n),this.user=e}setChildren(e,t=k.empty(),i){this.model.setChildren(e,t,i)}rerender(e){if(e===void 0){this.view.rerender();return}this.model.rerender(e)}hasElement(e){return this.model.has(e)}createModel(e,t,i){return new qt(e,t,i)}}class os{get compressedTreeNodeProvider(){return this._compressedTreeNodeProvider()}constructor(e,t,i){this._compressedTreeNodeProvider=e,this.stickyScrollDelegate=t,this.renderer=i,this.templateId=i.templateId,i.onDidChangeTwistieState&&(this.onDidChangeTwistieState=i.onDidChangeTwistieState)}renderTemplate(e){return{compressedTreeNode:void 0,data:this.renderer.renderTemplate(e)}}renderElement(e,t,i,s){let n=this.stickyScrollDelegate.getCompressedNode(e);n||(n=this.compressedTreeNodeProvider.getCompressedTreeNode(e.element)),n.element.elements.length===1?(i.compressedTreeNode=void 0,this.renderer.renderElement(e,t,i.data,s)):(i.compressedTreeNode=n,this.renderer.renderCompressedElements(n,t,i.data,s))}disposeElement(e,t,i,s){var n,o,l,a;i.compressedTreeNode?(o=(n=this.renderer).disposeCompressedElements)==null||o.call(n,i.compressedTreeNode,t,i.data,s):(a=(l=this.renderer).disposeElement)==null||a.call(l,e,t,i.data,s)}disposeTemplate(e){this.renderer.disposeTemplate(e.data)}renderTwistie(e,t){return this.renderer.renderTwistie?this.renderer.renderTwistie(e,t):!1}}yo([dn],os.prototype,"compressedTreeNodeProvider",null);class So{constructor(e){this.modelProvider=e,this.compressedStickyNodes=new Map}getCompressedNode(e){return this.compressedStickyNodes.get(e)}constrainStickyScrollNodes(e,t,i){if(this.compressedStickyNodes.clear(),e.length===0)return[];for(let s=0;s<e.length;s++){const n=e[s],o=n.position+n.height;if(s+1<e.length&&o+e[s+1].height>i||s>=t-1&&t<e.length){const a=e.slice(0,s),h=e.slice(s),c=this.compressStickyNodes(h);return[...a,c]}}return e}compressStickyNodes(e){if(e.length===0)throw new Error("Can't compress empty sticky nodes");const t=this.modelProvider();if(!t.isCompressionEnabled())return e[0];const i=[];for(let h=0;h<e.length;h++){const c=e[h],d=t.getCompressedTreeNode(c.node.element);if(d.element){if(h!==0&&d.element.incompressible)break;i.push(...d.element.elements)}}if(i.length<2)return e[0];const s=e[e.length-1],n={elements:i,incompressible:!1},o={...s.node,children:[],element:n},l=new Proxy(e[0].node,{}),a={node:l,startIndex:e[0].startIndex,endIndex:s.endIndex,position:e[0].position,height:e[0].height};return this.compressedStickyNodes.set(l,o),a}}function vo(r,e){return e&&{...e,keyboardNavigationLabelProvider:e.keyboardNavigationLabelProvider&&{getKeyboardNavigationLabel(t){let i;try{i=r().getCompressedTreeNode(t)}catch{return e.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(t)}return i.element.elements.length===1?e.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(t):e.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(i.element.elements)}}}}class rs extends Yt{constructor(e,t,i,s,n={}){const o=()=>this,l=new So(()=>this.model),a=s.map(h=>new os(o,l,h));super(e,t,i,a,{...vo(o,n),stickyScrollDelegate:l})}setChildren(e,t=k.empty(),i){this.model.setChildren(e,t,i)}createModel(e,t,i){return new bo(e,t,i)}updateOptions(e={}){super.updateOptions(e),typeof e.compressionEnabled<"u"&&this.model.setCompressionEnabled(e.compressionEnabled)}getCompressedTreeNode(e=null){return this.model.getCompressedTreeNode(e)}}function kt(r){return{...r,children:[],refreshPromise:void 0,stale:!0,slow:!1,forceExpanded:!1}}function Kt(r,e){return e.parent?e.parent===r?!0:Kt(r,e.parent):!1}function Co(r,e){return r===e||Kt(r,e)||Kt(e,r)}class Xt{get element(){return this.node.element.element}get children(){return this.node.children.map(e=>new Xt(e))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(e){this.node=e}}class wo{constructor(e,t,i){this.renderer=e,this.nodeMapper=t,this.onDidChangeTwistieState=i,this.renderedNodes=new Map,this.templateId=e.templateId}renderTemplate(e){return{templateData:this.renderer.renderTemplate(e)}}renderElement(e,t,i,s){this.renderer.renderElement(this.nodeMapper.map(e),t,i.templateData,s)}renderTwistie(e,t){return e.slow?(t.classList.add(...ue.asClassNameArray(fe.treeItemLoading)),!0):(t.classList.remove(...ue.asClassNameArray(fe.treeItemLoading)),!1)}disposeElement(e,t,i,s){var n,o;(o=(n=this.renderer).disposeElement)==null||o.call(n,this.nodeMapper.map(e),t,i.templateData,s)}disposeTemplate(e){this.renderer.disposeTemplate(e.templateData)}dispose(){this.renderedNodes.clear()}}function Ii(r){return{browserEvent:r.browserEvent,elements:r.elements.map(e=>e.element)}}function xi(r){return{browserEvent:r.browserEvent,element:r.element&&r.element.element,target:r.target}}class Do extends mt{constructor(e){super(e.elements.map(t=>t.element)),this.data=e}}function Tt(r){return r instanceof mt?new Do(r):r}class _o{constructor(e){this.dnd=e}getDragURI(e){return this.dnd.getDragURI(e.element)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e.map(i=>i.element),t)}onDragStart(e,t){var i,s;(s=(i=this.dnd).onDragStart)==null||s.call(i,Tt(e),t)}onDragOver(e,t,i,s,n,o=!0){return this.dnd.onDragOver(Tt(e),t&&t.element,i,s,n)}drop(e,t,i,s,n){this.dnd.drop(Tt(e),t&&t.element,i,s,n)}onDragEnd(e){var t,i;(i=(t=this.dnd).onDragEnd)==null||i.call(t,e)}dispose(){this.dnd.dispose()}}function ls(r){return r&&{...r,collapseByDefault:!0,identityProvider:r.identityProvider&&{getId(e){return r.identityProvider.getId(e.element)}},dnd:r.dnd&&new _o(r.dnd),multipleSelectionController:r.multipleSelectionController&&{isSelectionSingleChangeEvent(e){return r.multipleSelectionController.isSelectionSingleChangeEvent({...e,element:e.element})},isSelectionRangeChangeEvent(e){return r.multipleSelectionController.isSelectionRangeChangeEvent({...e,element:e.element})}},accessibilityProvider:r.accessibilityProvider&&{...r.accessibilityProvider,getPosInSet:void 0,getSetSize:void 0,getRole:r.accessibilityProvider.getRole?e=>r.accessibilityProvider.getRole(e.element):()=>"treeitem",isChecked:r.accessibilityProvider.isChecked?e=>{var t;return!!((t=r.accessibilityProvider)!=null&&t.isChecked(e.element))}:void 0,getAriaLabel(e){return r.accessibilityProvider.getAriaLabel(e.element)},getWidgetAriaLabel(){return r.accessibilityProvider.getWidgetAriaLabel()},getWidgetRole:r.accessibilityProvider.getWidgetRole?()=>r.accessibilityProvider.getWidgetRole():()=>"tree",getAriaLevel:r.accessibilityProvider.getAriaLevel&&(e=>r.accessibilityProvider.getAriaLevel(e.element)),getActiveDescendantId:r.accessibilityProvider.getActiveDescendantId&&(e=>r.accessibilityProvider.getActiveDescendantId(e.element))},filter:r.filter&&{filter(e,t){return r.filter.filter(e.element,t)}},keyboardNavigationLabelProvider:r.keyboardNavigationLabelProvider&&{...r.keyboardNavigationLabelProvider,getKeyboardNavigationLabel(e){return r.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e.element)}},sorter:void 0,expandOnlyOnTwistieClick:typeof r.expandOnlyOnTwistieClick>"u"?void 0:typeof r.expandOnlyOnTwistieClick!="function"?r.expandOnlyOnTwistieClick:e=>r.expandOnlyOnTwistieClick(e.element),defaultFindVisibility:e=>e.hasChildren&&e.stale?1:typeof r.defaultFindVisibility=="number"?r.defaultFindVisibility:typeof r.defaultFindVisibility>"u"?2:r.defaultFindVisibility(e.element)}}function zt(r,e){e(r),r.children.forEach(t=>zt(t,e))}class as{get onDidScroll(){return this.tree.onDidScroll}get onDidChangeFocus(){return _.map(this.tree.onDidChangeFocus,Ii)}get onDidChangeSelection(){return _.map(this.tree.onDidChangeSelection,Ii)}get onMouseDblClick(){return _.map(this.tree.onMouseDblClick,xi)}get onPointer(){return _.map(this.tree.onPointer,xi)}get onDidFocus(){return this.tree.onDidFocus}get onDidChangeModel(){return this.tree.onDidChangeModel}get onDidChangeCollapseState(){return this.tree.onDidChangeCollapseState}get onDidChangeFindOpenState(){return this.tree.onDidChangeFindOpenState}get onDidChangeStickyScrollFocused(){return this.tree.onDidChangeStickyScrollFocused}get onDidDispose(){return this.tree.onDidDispose}constructor(e,t,i,s,n,o={}){this.user=e,this.dataSource=n,this.nodes=new Map,this.subTreeRefreshPromises=new Map,this.refreshPromises=new Map,this._onDidRender=new P,this._onDidChangeNodeSlowState=new P,this.nodeMapper=new $t(l=>new Xt(l)),this.disposables=new F,this.identityProvider=o.identityProvider,this.autoExpandSingleChildren=typeof o.autoExpandSingleChildren>"u"?!1:o.autoExpandSingleChildren,this.sorter=o.sorter,this.getDefaultCollapseState=l=>o.collapseByDefault?o.collapseByDefault(l)?B.PreserveOrCollapsed:B.PreserveOrExpanded:void 0,this.tree=this.createTree(e,t,i,s,o),this.onDidChangeFindMode=this.tree.onDidChangeFindMode,this.onDidChangeFindMatchType=this.tree.onDidChangeFindMatchType,this.root=kt({element:void 0,parent:null,hasChildren:!0,defaultCollapseState:void 0}),this.identityProvider&&(this.root={...this.root,id:null}),this.nodes.set(null,this.root),this.tree.onDidChangeCollapseState(this._onDidChangeCollapseState,this,this.disposables)}createTree(e,t,i,s,n){const o=new jt(i),l=s.map(h=>new wo(h,this.nodeMapper,this._onDidChangeNodeSlowState.event)),a=ls(n)||{};return new Yt(e,t,o,l,a)}updateOptions(e={}){this.tree.updateOptions(e)}getHTMLElement(){return this.tree.getHTMLElement()}get scrollTop(){return this.tree.scrollTop}set scrollTop(e){this.tree.scrollTop=e}get scrollHeight(){return this.tree.scrollHeight}get renderHeight(){return this.tree.renderHeight}domFocus(){this.tree.domFocus()}layout(e,t){this.tree.layout(e,t)}style(e){this.tree.style(e)}getInput(){return this.root.element}async setInput(e,t){this.refreshPromises.forEach(s=>s.cancel()),this.refreshPromises.clear(),this.root.element=e;const i=t&&{viewState:t,focus:[],selection:[]};await this._updateChildren(e,!0,!1,i),i&&(this.tree.setFocus(i.focus),this.tree.setSelection(i.selection)),t&&typeof t.scrollTop=="number"&&(this.scrollTop=t.scrollTop)}async _updateChildren(e=this.root.element,t=!0,i=!1,s,n){if(typeof this.root.element>"u")throw new V(this.user,"Tree input not set");this.root.refreshPromise&&(await this.root.refreshPromise,await _.toPromise(this._onDidRender.event));const o=this.getDataNode(e);if(await this.refreshAndRenderNode(o,t,s,n),i)try{this.tree.rerender(o)}catch{}}rerender(e){if(e===void 0||e===this.root.element){this.tree.rerender();return}const t=this.getDataNode(e);this.tree.rerender(t)}getNode(e=this.root.element){const t=this.getDataNode(e),i=this.tree.getNode(t===this.root?null:t);return this.nodeMapper.map(i)}collapse(e,t=!1){const i=this.getDataNode(e);return this.tree.collapse(i===this.root?null:i,t)}async expand(e,t=!1){if(typeof this.root.element>"u")throw new V(this.user,"Tree input not set");this.root.refreshPromise&&(await this.root.refreshPromise,await _.toPromise(this._onDidRender.event));const i=this.getDataNode(e);if(this.tree.hasElement(i)&&!this.tree.isCollapsible(i)||(i.refreshPromise&&(await this.root.refreshPromise,await _.toPromise(this._onDidRender.event)),i!==this.root&&!i.refreshPromise&&!this.tree.isCollapsed(i)))return!1;const s=this.tree.expand(i===this.root?null:i,t);return i.refreshPromise&&(await this.root.refreshPromise,await _.toPromise(this._onDidRender.event)),s}setSelection(e,t){const i=e.map(s=>this.getDataNode(s));this.tree.setSelection(i,t)}getSelection(){return this.tree.getSelection().map(t=>t.element)}setFocus(e,t){const i=e.map(s=>this.getDataNode(s));this.tree.setFocus(i,t)}getFocus(){return this.tree.getFocus().map(t=>t.element)}reveal(e,t){this.tree.reveal(this.getDataNode(e),t)}getParentElement(e){const t=this.tree.getParentElement(this.getDataNode(e));return t&&t.element}getFirstElementChild(e=this.root.element){const t=this.getDataNode(e),i=this.tree.getFirstElementChild(t===this.root?null:t);return i&&i.element}getDataNode(e){const t=this.nodes.get(e===this.root.element?null:e);if(!t)throw new V(this.user,`Data tree node not found: ${e}`);return t}async refreshAndRenderNode(e,t,i,s){await this.refreshNode(e,t,i),!this.disposables.isDisposed&&this.render(e,i,s)}async refreshNode(e,t,i){let s;if(this.subTreeRefreshPromises.forEach((n,o)=>{!s&&Co(o,e)&&(s=n.then(()=>this.refreshNode(e,t,i)))}),s)return s;if(e!==this.root&&this.tree.getNode(e).collapsed){e.hasChildren=!!this.dataSource.hasChildren(e.element),e.stale=!0,this.setChildren(e,[],t,i);return}return this.doRefreshSubTree(e,t,i)}async doRefreshSubTree(e,t,i){let s;e.refreshPromise=new Promise(n=>s=n),this.subTreeRefreshPromises.set(e,e.refreshPromise),e.refreshPromise.finally(()=>{e.refreshPromise=void 0,this.subTreeRefreshPromises.delete(e)});try{const n=await this.doRefreshNode(e,t,i);e.stale=!1,await Fs.settled(n.map(o=>this.doRefreshSubTree(o,t,i)))}finally{s()}}async doRefreshNode(e,t,i){e.hasChildren=!!this.dataSource.hasChildren(e.element);let s;if(!e.hasChildren)s=Promise.resolve(k.empty());else{const n=this.doGetChildren(e);if(ci(n))s=Promise.resolve(n);else{const o=Os(800);o.then(()=>{e.slow=!0,this._onDidChangeNodeSlowState.fire(e)},l=>null),s=n.finally(()=>o.cancel())}}try{const n=await s;return this.setChildren(e,n,t,i)}catch(n){if(e!==this.root&&this.tree.hasElement(e)&&this.tree.collapse(e),As(n))return[];throw n}finally{e.slow&&(e.slow=!1,this._onDidChangeNodeSlowState.fire(e))}}doGetChildren(e){let t=this.refreshPromises.get(e);if(t)return t;const i=this.dataSource.getChildren(e.element);return ci(i)?this.processChildren(i):(t=Ks(async()=>this.processChildren(await i)),this.refreshPromises.set(e,t),t.finally(()=>{this.refreshPromises.delete(e)}))}_onDidChangeCollapseState({node:e,deep:t}){e.element!==null&&!e.collapsed&&e.element.stale&&(t?this.collapse(e.element.element):this.refreshAndRenderNode(e.element,!1).catch(zs))}setChildren(e,t,i,s){const n=[...t];if(e.children.length===0&&n.length===0)return[];const o=new Map,l=new Map;for(const c of e.children)o.set(c.element,c),this.identityProvider&&l.set(c.id,{node:c,collapsed:this.tree.hasElement(c)&&this.tree.isCollapsed(c)});const a=[],h=n.map(c=>{const d=!!this.dataSource.hasChildren(c);if(!this.identityProvider){const u=kt({element:c,parent:e,hasChildren:d,defaultCollapseState:this.getDefaultCollapseState(c)});return d&&u.defaultCollapseState===B.PreserveOrExpanded&&a.push(u),u}const f=this.identityProvider.getId(c).toString(),g=l.get(f);if(g){const u=g.node;return o.delete(u.element),this.nodes.delete(u.element),this.nodes.set(c,u),u.element=c,u.hasChildren=d,i?g.collapsed?(u.children.forEach(m=>zt(m,S=>this.nodes.delete(S.element))),u.children.splice(0,u.children.length),u.stale=!0):a.push(u):d&&!g.collapsed&&a.push(u),u}const p=kt({element:c,parent:e,id:f,hasChildren:d,defaultCollapseState:this.getDefaultCollapseState(c)});return s&&s.viewState.focus&&s.viewState.focus.indexOf(f)>-1&&s.focus.push(p),s&&s.viewState.selection&&s.viewState.selection.indexOf(f)>-1&&s.selection.push(p),(s&&s.viewState.expanded&&s.viewState.expanded.indexOf(f)>-1||d&&p.defaultCollapseState===B.PreserveOrExpanded)&&a.push(p),p});for(const c of o.values())zt(c,d=>this.nodes.delete(d.element));for(const c of h)this.nodes.set(c.element,c);return e.children.splice(0,e.children.length,...h),e!==this.root&&this.autoExpandSingleChildren&&h.length===1&&a.length===0&&(h[0].forceExpanded=!0,a.push(h[0])),a}render(e,t,i){const s=e.children.map(o=>this.asTreeElement(o,t)),n=i&&{...i,diffIdentityProvider:i.diffIdentityProvider&&{getId(o){return i.diffIdentityProvider.getId(o.element)}}};this.tree.setChildren(e===this.root?null:e,s,n),e!==this.root&&this.tree.setCollapsible(e,e.hasChildren),this._onDidRender.fire()}asTreeElement(e,t){if(e.stale)return{element:e,collapsible:e.hasChildren,collapsed:!0};let i;return t&&t.viewState.expanded&&e.id&&t.viewState.expanded.indexOf(e.id)>-1?i=!1:e.forceExpanded?(i=!1,e.forceExpanded=!1):i=e.defaultCollapseState,{element:e,children:e.hasChildren?k.map(e.children,s=>this.asTreeElement(s,t)):[],collapsible:e.hasChildren,collapsed:i}}processChildren(e){return this.sorter&&(e=[...e].sort(this.sorter.compare.bind(this.sorter))),e}dispose(){this.disposables.dispose(),this.tree.dispose()}}class Jt{get element(){return{elements:this.node.element.elements.map(e=>e.element),incompressible:this.node.element.incompressible}}get children(){return this.node.children.map(e=>new Jt(e))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(e){this.node=e}}class No{constructor(e,t,i,s){this.renderer=e,this.nodeMapper=t,this.compressibleNodeMapperProvider=i,this.onDidChangeTwistieState=s,this.renderedNodes=new Map,this.disposables=[],this.templateId=e.templateId}renderTemplate(e){return{templateData:this.renderer.renderTemplate(e)}}renderElement(e,t,i,s){this.renderer.renderElement(this.nodeMapper.map(e),t,i.templateData,s)}renderCompressedElements(e,t,i,s){this.renderer.renderCompressedElements(this.compressibleNodeMapperProvider().map(e),t,i.templateData,s)}renderTwistie(e,t){return e.slow?(t.classList.add(...ue.asClassNameArray(fe.treeItemLoading)),!0):(t.classList.remove(...ue.asClassNameArray(fe.treeItemLoading)),!1)}disposeElement(e,t,i,s){var n,o;(o=(n=this.renderer).disposeElement)==null||o.call(n,this.nodeMapper.map(e),t,i.templateData,s)}disposeCompressedElements(e,t,i,s){var n,o;(o=(n=this.renderer).disposeCompressedElements)==null||o.call(n,this.compressibleNodeMapperProvider().map(e),t,i.templateData,s)}disposeTemplate(e){this.renderer.disposeTemplate(e.templateData)}dispose(){this.renderedNodes.clear(),this.disposables=De(this.disposables)}}function Io(r){const e=r&&ls(r);return e&&{...e,keyboardNavigationLabelProvider:e.keyboardNavigationLabelProvider&&{...e.keyboardNavigationLabelProvider,getCompressedNodeKeyboardNavigationLabel(t){return r.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(t.map(i=>i.element))}}}}class xo extends as{constructor(e,t,i,s,n,o,l={}){super(e,t,i,n,o,l),this.compressionDelegate=s,this.compressibleNodeMapper=new $t(a=>new Jt(a)),this.filter=l.filter}createTree(e,t,i,s,n){const o=new jt(i),l=s.map(h=>new No(h,this.nodeMapper,()=>this.compressibleNodeMapper,this._onDidChangeNodeSlowState.event)),a=Io(n)||{};return new rs(e,t,o,l,a)}asTreeElement(e,t){return{incompressible:this.compressionDelegate.isIncompressible(e.element),...super.asTreeElement(e,t)}}updateOptions(e={}){this.tree.updateOptions(e)}render(e,t,i){if(!this.identityProvider)return super.render(e,t);const s=g=>this.identityProvider.getId(g).toString(),n=g=>{const p=new Set;for(const u of g){const m=this.tree.getCompressedTreeNode(u===this.root?null:u);if(m.element)for(const S of m.element.elements)p.add(s(S.element))}return p},o=n(this.tree.getSelection()),l=n(this.tree.getFocus());super.render(e,t,i);const a=this.getSelection();let h=!1;const c=this.getFocus();let d=!1;const f=g=>{const p=g.element;if(p)for(let u=0;u<p.elements.length;u++){const m=s(p.elements[u].element),S=p.elements[p.elements.length-1].element;o.has(m)&&a.indexOf(S)===-1&&(a.push(S),h=!0),l.has(m)&&c.indexOf(S)===-1&&(c.push(S),d=!0)}g.children.forEach(f)};f(this.tree.getCompressedTreeNode(e===this.root?null:e)),h&&this.setSelection(a),d&&this.setFocus(c)}processChildren(e){return this.filter&&(e=k.filter(e,t=>{const i=this.filter.filter(t,1),s=Eo(i);if(s===2)throw new Error("Recursive tree visibility not supported in async data compressed trees");return s===1})),super.processChildren(e)}}function Eo(r){return typeof r=="boolean"?r?1:0:Gt(r)?Me(r.visibility):Me(r)}class ko extends ss{constructor(e,t,i,s,n,o={}){super(e,t,i,s,o),this.user=e,this.dataSource=n,this.identityProvider=o.identityProvider}createModel(e,t,i){return new qt(e,t,i)}}new M("isMac",Wi,C("isMac","Whether the operating system is macOS"));new M("isLinux",Hs,C("isLinux","Whether the operating system is Linux"));new M("isWindows",Rs,C("isWindows","Whether the operating system is Windows"));const ir=new M("isWeb",$i,C("isWeb","Whether the platform is a web browser"));new M("isMacNative",Wi&&!$i,C("isMacNative","Whether the operating system is macOS on a non-browser platform"));new M("isIOS",Bs,C("isIOS","Whether the operating system is iOS"));new M("isMobile",Vs,C("isMobile","Whether the platform is a mobile web browser"));new M("isDevelopment",!1,!0);new M("productQualityType","",C("productQualityType","Quality type of VS Code"));const ds="inputFocus",sr=new M(ds,!1,C("inputFocus","Whether keyboard focus is inside an input box"));var ie=function(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var l=r.length-1;l>=0;l--)(o=r[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},x=function(r,e){return function(t,i){e(t,i,r)}};const se=Ke("listService");class nr{get lastFocusedList(){return this._lastFocusedWidget}constructor(){this.disposables=new F,this.lists=[],this._lastFocusedWidget=void 0,this._hasCreatedStyleController=!1}setLastFocusedList(e){var t,i;e!==this._lastFocusedWidget&&((t=this._lastFocusedWidget)==null||t.getHTMLElement().classList.remove("last-focused"),this._lastFocusedWidget=e,(i=this._lastFocusedWidget)==null||i.getHTMLElement().classList.add("last-focused"))}register(e,t){if(this._hasCreatedStyleController||(this._hasCreatedStyleController=!0,new Dn(Vt(),"").style(He)),this.lists.some(s=>s.widget===e))throw new Error("Cannot register the same widget multiple times");const i={widget:e,extraContextKeys:t};return this.lists.push(i),$s(e.getHTMLElement())&&this.setLastFocusedList(e),Ge(e.onDidFocus(()=>this.setLastFocusedList(e)),gt(()=>this.lists.splice(this.lists.indexOf(i),1)),e.onDidDispose(()=>{this.lists=this.lists.filter(s=>s!==i),this._lastFocusedWidget===e&&this.setLastFocusedList(void 0)}))}dispose(){this.disposables.dispose()}}const Fe=new M("listScrollAtBoundary","none");it.or(Fe.isEqualTo("top"),Fe.isEqualTo("both"));it.or(Fe.isEqualTo("bottom"),Fe.isEqualTo("both"));const hs=new M("listFocus",!0),cs=new M("treestickyScrollFocused",!1),yt=new M("listSupportsMultiselect",!0),or=it.and(hs,it.not(ds),cs.negate()),Qt=new M("listHasSelectionOrFocus",!1),Zt=new M("listDoubleSelection",!1),ei=new M("listMultiSelection",!1),St=new M("listSelectionNavigation",!1),To=new M("listSupportsFind",!0),Lo=new M("treeElementCanCollapse",!1),Mo=new M("treeElementHasParent",!1),Po=new M("treeElementCanExpand",!1),Fo=new M("treeElementHasChild",!1),Oo=new M("treeFindOpen",!1),us="listTypeNavigationMode",fs="listAutomaticKeyboardNavigation";function vt(r,e){const t=r.createScoped(e.getHTMLElement());return hs.bindTo(t),t}function Ct(r,e){const t=Fe.bindTo(r),i=()=>{const s=e.scrollTop===0,n=e.scrollHeight-e.renderHeight-e.scrollTop<1;s&&n?t.set("both"):s?t.set("top"):n?t.set("bottom"):t.set("none")};return i(),e.onDidScroll(i)}const me="workbench.list.multiSelectModifier",et="workbench.list.openMode",$="workbench.list.horizontalScrolling",ti="workbench.list.defaultFindMode",ii="workbench.list.typeNavigationMode",ot="workbench.list.keyboardNavigation",q="workbench.list.scrollByPage",si="workbench.list.defaultFindMatchType",Oe="workbench.tree.indent",rt="workbench.tree.renderIndentGuides",U="workbench.list.smoothScrolling",X="workbench.list.mouseWheelScrollSensitivity",J="workbench.list.fastScrollSensitivity",lt="workbench.tree.expandMode",at="workbench.tree.enableStickyScroll",dt="workbench.tree.stickyScrollMaxItemCount";function Q(r){return r.getValue(me)==="alt"}class Ao extends K{constructor(e){super(),this.configurationService=e,this.useAltAsMultipleSelectionModifier=Q(e),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(me)&&(this.useAltAsMultipleSelectionModifier=Q(this.configurationService))}))}isSelectionSingleChangeEvent(e){return this.useAltAsMultipleSelectionModifier?e.browserEvent.altKey:_n(e)}isSelectionRangeChangeEvent(e){return Nn(e)}}function wt(r,e){const t=r.get(j),i=r.get(_e),s=new F;return[{...e,keyboardNavigationDelegate:{mightProducePrintableCharacter(o){return i.mightProducePrintableCharacter(o)}},smoothScrolling:!!t.getValue(U),mouseWheelScrollSensitivity:t.getValue(X),fastScrollSensitivity:t.getValue(J),multipleSelectionController:e.multipleSelectionController??s.add(new Ao(t)),keyboardNavigationEventFilter:Ho(i),scrollByPage:!!t.getValue(q)},s]}let Ei=class extends pt{constructor(e,t,i,s,n,o,l,a,h){const c=typeof n.horizontalScrolling<"u"?n.horizontalScrolling:!!a.getValue($),[d,f]=h.invokeFunction(wt,n);super(e,t,i,s,{keyboardSupport:!1,...d,horizontalScrolling:c}),this.disposables.add(f),this.contextKeyService=vt(o,this),this.disposables.add(Ct(this.contextKeyService,this)),this.listSupportsMultiSelect=yt.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(n.multipleSelectionSupport!==!1),St.bindTo(this.contextKeyService).set(!!n.selectionNavigation),this.listHasSelectionOrFocus=Qt.bindTo(this.contextKeyService),this.listDoubleSelection=Zt.bindTo(this.contextKeyService),this.listMultiSelection=ei.bindTo(this.contextKeyService),this.horizontalScrolling=n.horizontalScrolling,this._useAltAsMultipleSelectionModifier=Q(a),this.disposables.add(this.contextKeyService),this.disposables.add(l.register(this)),this.updateStyles(n.overrideStyles),this.disposables.add(this.onDidChangeSelection(()=>{const p=this.getSelection(),u=this.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.listHasSelectionOrFocus.set(p.length>0||u.length>0),this.listMultiSelection.set(p.length>1),this.listDoubleSelection.set(p.length===2)})})),this.disposables.add(this.onDidChangeFocus(()=>{const p=this.getSelection(),u=this.getFocus();this.listHasSelectionOrFocus.set(p.length>0||u.length>0)})),this.disposables.add(a.onDidChangeConfiguration(p=>{p.affectsConfiguration(me)&&(this._useAltAsMultipleSelectionModifier=Q(a));let u={};if(p.affectsConfiguration($)&&this.horizontalScrolling===void 0){const m=!!a.getValue($);u={...u,horizontalScrolling:m}}if(p.affectsConfiguration(q)){const m=!!a.getValue(q);u={...u,scrollByPage:m}}if(p.affectsConfiguration(U)){const m=!!a.getValue(U);u={...u,smoothScrolling:m}}if(p.affectsConfiguration(X)){const m=a.getValue(X);u={...u,mouseWheelScrollSensitivity:m}}if(p.affectsConfiguration(J)){const m=a.getValue(J);u={...u,fastScrollSensitivity:m}}Object.keys(u).length>0&&this.updateOptions(u)})),this.navigator=new gs(this,{configurationService:a,...n}),this.disposables.add(this.navigator)}updateOptions(e){super.updateOptions(e),e.overrideStyles!==void 0&&this.updateStyles(e.overrideStyles),e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyles(e){this.style(e?bt(e):He)}};Ei=ie([x(5,W),x(6,se),x(7,j),x(8,te)],Ei);let ki=class extends Wn{constructor(e,t,i,s,n,o,l,a,h){const c=typeof n.horizontalScrolling<"u"?n.horizontalScrolling:!!a.getValue($),[d,f]=h.invokeFunction(wt,n);super(e,t,i,s,{keyboardSupport:!1,...d,horizontalScrolling:c}),this.disposables=new F,this.disposables.add(f),this.contextKeyService=vt(o,this),this.disposables.add(Ct(this.contextKeyService,this.widget)),this.horizontalScrolling=n.horizontalScrolling,this.listSupportsMultiSelect=yt.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(n.multipleSelectionSupport!==!1),St.bindTo(this.contextKeyService).set(!!n.selectionNavigation),this._useAltAsMultipleSelectionModifier=Q(a),this.disposables.add(this.contextKeyService),this.disposables.add(l.register(this)),this.updateStyles(n.overrideStyles),this.disposables.add(a.onDidChangeConfiguration(p=>{p.affectsConfiguration(me)&&(this._useAltAsMultipleSelectionModifier=Q(a));let u={};if(p.affectsConfiguration($)&&this.horizontalScrolling===void 0){const m=!!a.getValue($);u={...u,horizontalScrolling:m}}if(p.affectsConfiguration(q)){const m=!!a.getValue(q);u={...u,scrollByPage:m}}if(p.affectsConfiguration(U)){const m=!!a.getValue(U);u={...u,smoothScrolling:m}}if(p.affectsConfiguration(X)){const m=a.getValue(X);u={...u,mouseWheelScrollSensitivity:m}}if(p.affectsConfiguration(J)){const m=a.getValue(J);u={...u,fastScrollSensitivity:m}}Object.keys(u).length>0&&this.updateOptions(u)})),this.navigator=new gs(this,{configurationService:a,...n}),this.disposables.add(this.navigator)}updateOptions(e){super.updateOptions(e),e.overrideStyles!==void 0&&this.updateStyles(e.overrideStyles),e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyles(e){this.style(e?bt(e):He)}dispose(){this.disposables.dispose(),super.dispose()}};ki=ie([x(5,W),x(6,se),x(7,j),x(8,te)],ki);let Ti=class extends Ft{constructor(e,t,i,s,n,o,l,a,h,c){const d=typeof o.horizontalScrolling<"u"?o.horizontalScrolling:!!h.getValue($),[f,g]=c.invokeFunction(wt,o);super(e,t,i,s,n,{keyboardSupport:!1,...f,horizontalScrolling:d}),this.disposables.add(g),this.contextKeyService=vt(l,this),this.disposables.add(Ct(this.contextKeyService,this)),this.listSupportsMultiSelect=yt.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(o.multipleSelectionSupport!==!1),St.bindTo(this.contextKeyService).set(!!o.selectionNavigation),this.listHasSelectionOrFocus=Qt.bindTo(this.contextKeyService),this.listDoubleSelection=Zt.bindTo(this.contextKeyService),this.listMultiSelection=ei.bindTo(this.contextKeyService),this.horizontalScrolling=o.horizontalScrolling,this._useAltAsMultipleSelectionModifier=Q(h),this.disposables.add(this.contextKeyService),this.disposables.add(a.register(this)),this.updateStyles(o.overrideStyles),this.disposables.add(this.onDidChangeSelection(()=>{const u=this.getSelection(),m=this.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.listHasSelectionOrFocus.set(u.length>0||m.length>0),this.listMultiSelection.set(u.length>1),this.listDoubleSelection.set(u.length===2)})})),this.disposables.add(this.onDidChangeFocus(()=>{const u=this.getSelection(),m=this.getFocus();this.listHasSelectionOrFocus.set(u.length>0||m.length>0)})),this.disposables.add(h.onDidChangeConfiguration(u=>{u.affectsConfiguration(me)&&(this._useAltAsMultipleSelectionModifier=Q(h));let m={};if(u.affectsConfiguration($)&&this.horizontalScrolling===void 0){const S=!!h.getValue($);m={...m,horizontalScrolling:S}}if(u.affectsConfiguration(q)){const S=!!h.getValue(q);m={...m,scrollByPage:S}}if(u.affectsConfiguration(U)){const S=!!h.getValue(U);m={...m,smoothScrolling:S}}if(u.affectsConfiguration(X)){const S=h.getValue(X);m={...m,mouseWheelScrollSensitivity:S}}if(u.affectsConfiguration(J)){const S=h.getValue(J);m={...m,fastScrollSensitivity:S}}Object.keys(m).length>0&&this.updateOptions(m)})),this.navigator=new Ko(this,{configurationService:h,...o}),this.disposables.add(this.navigator)}updateOptions(e){super.updateOptions(e),e.overrideStyles!==void 0&&this.updateStyles(e.overrideStyles),e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyles(e){this.style(e?bt(e):He)}dispose(){this.disposables.dispose(),super.dispose()}};Ti=ie([x(6,W),x(7,se),x(8,j),x(9,te)],Ti);class ni extends K{constructor(e,t){super(),this.widget=e,this._onDidOpen=this._register(new P),this.onDidOpen=this._onDidOpen.event,this._register(_.filter(this.widget.onDidChangeSelection,i=>le(i.browserEvent))(i=>this.onSelectionFromKeyboard(i))),this._register(this.widget.onPointer(i=>this.onPointer(i.element,i.browserEvent))),this._register(this.widget.onMouseDblClick(i=>this.onMouseDblClick(i.element,i.browserEvent))),typeof(t==null?void 0:t.openOnSingleClick)!="boolean"&&(t!=null&&t.configurationService)?(this.openOnSingleClick=(t==null?void 0:t.configurationService.getValue(et))!=="doubleClick",this._register(t==null?void 0:t.configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration(et)&&(this.openOnSingleClick=(t==null?void 0:t.configurationService.getValue(et))!=="doubleClick")}))):this.openOnSingleClick=(t==null?void 0:t.openOnSingleClick)??!0}onSelectionFromKeyboard(e){if(e.elements.length!==1)return;const t=e.browserEvent,i=typeof t.preserveFocus=="boolean"?t.preserveFocus:!0,s=typeof t.pinned=="boolean"?t.pinned:!i;this._open(this.getSelectedElement(),i,s,!1,e.browserEvent)}onPointer(e,t){if(!this.openOnSingleClick||t.detail===2)return;const s=t.button===1,n=!0,o=s,l=t.ctrlKey||t.metaKey||t.altKey;this._open(e,n,o,l,t)}onMouseDblClick(e,t){if(!t)return;const i=t.target;if(i.classList.contains("monaco-tl-twistie")||i.classList.contains("monaco-icon-label")&&i.classList.contains("folder-icon")&&t.offsetX<16)return;const n=!1,o=!0,l=t.ctrlKey||t.metaKey||t.altKey;this._open(e,n,o,l,t)}_open(e,t,i,s,n){e&&this._onDidOpen.fire({editorOptions:{preserveFocus:t,pinned:i,revealIfVisible:!0},sideBySide:s,element:e,browserEvent:n})}}class gs extends ni{constructor(e,t){super(e,t),this.widget=e}getSelectedElement(){return this.widget.getSelectedElements()[0]}}class Ko extends ni{constructor(e,t){super(e,t)}getSelectedElement(){return this.widget.getSelectedElements()[0]}}class zo extends ni{constructor(e,t){super(e,t)}getSelectedElement(){return this.widget.getSelection()[0]??void 0}}function Ho(r){let e=!1;return t=>{if(t.toKeyCodeChord().isModifierKey())return!1;if(e)return e=!1,!1;const i=r.softDispatch(t,t.target);return i.kind===1?(e=!0,!1):(e=!1,i.kind===0)}}let Li=class extends Yt{constructor(e,t,i,s,n,o,l,a,h){const{options:c,getTypeNavigationMode:d,disposable:f}=o.invokeFunction(Re,n);super(e,t,i,s,c),this.disposables.add(f),this.internals=new pe(this,n,d,n.overrideStyles,l,a,h),this.disposables.add(this.internals)}updateOptions(e){super.updateOptions(e),this.internals.updateOptions(e)}};Li=ie([x(5,te),x(6,W),x(7,se),x(8,j)],Li);let Mi=class extends rs{constructor(e,t,i,s,n,o,l,a,h){const{options:c,getTypeNavigationMode:d,disposable:f}=o.invokeFunction(Re,n);super(e,t,i,s,c),this.disposables.add(f),this.internals=new pe(this,n,d,n.overrideStyles,l,a,h),this.disposables.add(this.internals)}updateOptions(e={}){super.updateOptions(e),e.overrideStyles&&this.internals.updateStyleOverrides(e.overrideStyles),this.internals.updateOptions(e)}};Mi=ie([x(5,te),x(6,W),x(7,se),x(8,j)],Mi);let Pi=class extends ko{constructor(e,t,i,s,n,o,l,a,h,c){const{options:d,getTypeNavigationMode:f,disposable:g}=l.invokeFunction(Re,o);super(e,t,i,s,n,d),this.disposables.add(g),this.internals=new pe(this,o,f,o.overrideStyles,a,h,c),this.disposables.add(this.internals)}updateOptions(e={}){super.updateOptions(e),e.overrideStyles!==void 0&&this.internals.updateStyleOverrides(e.overrideStyles),this.internals.updateOptions(e)}};Pi=ie([x(6,te),x(7,W),x(8,se),x(9,j)],Pi);let Fi=class extends as{get onDidOpen(){return this.internals.onDidOpen}constructor(e,t,i,s,n,o,l,a,h,c){const{options:d,getTypeNavigationMode:f,disposable:g}=l.invokeFunction(Re,o);super(e,t,i,s,n,d),this.disposables.add(g),this.internals=new pe(this,o,f,o.overrideStyles,a,h,c),this.disposables.add(this.internals)}updateOptions(e={}){super.updateOptions(e),e.overrideStyles&&this.internals.updateStyleOverrides(e.overrideStyles),this.internals.updateOptions(e)}};Fi=ie([x(6,te),x(7,W),x(8,se),x(9,j)],Fi);let Oi=class extends xo{constructor(e,t,i,s,n,o,l,a,h,c,d){const{options:f,getTypeNavigationMode:g,disposable:p}=a.invokeFunction(Re,l);super(e,t,i,s,n,o,f),this.disposables.add(p),this.internals=new pe(this,l,g,l.overrideStyles,h,c,d),this.disposables.add(this.internals)}updateOptions(e){super.updateOptions(e),this.internals.updateOptions(e)}};Oi=ie([x(7,te),x(8,W),x(9,se),x(10,j)],Oi);function ps(r){const e=r.getValue(ti);if(e==="highlight")return ee.Highlight;if(e==="filter")return ee.Filter;const t=r.getValue(ot);if(t==="simple"||t==="highlight")return ee.Highlight;if(t==="filter")return ee.Filter}function ms(r){const e=r.getValue(si);if(e==="fuzzy")return ge.Fuzzy;if(e==="contiguous")return ge.Contiguous}function Re(r,e){const t=r.get(j),i=r.get(Cn),s=r.get(W),n=r.get(te),o=()=>{const f=s.getContextKeyValue(us);if(f==="automatic")return Ne.Automatic;if(f==="trigger")return Ne.Trigger;if(s.getContextKeyValue(fs)===!1)return Ne.Trigger;const p=t.getValue(ii);if(p==="automatic")return Ne.Automatic;if(p==="trigger")return Ne.Trigger},l=e.horizontalScrolling!==void 0?e.horizontalScrolling:!!t.getValue($),[a,h]=n.invokeFunction(wt,e),c=e.paddingBottom,d=e.renderIndentGuides!==void 0?e.renderIndentGuides:t.getValue(rt);return{getTypeNavigationMode:o,disposable:h,options:{keyboardSupport:!1,...a,indent:typeof t.getValue(Oe)=="number"?t.getValue(Oe):void 0,renderIndentGuides:d,smoothScrolling:!!t.getValue(U),defaultFindMode:ps(t),defaultFindMatchType:ms(t),horizontalScrolling:l,scrollByPage:!!t.getValue(q),paddingBottom:c,hideTwistiesOfChildlessElements:e.hideTwistiesOfChildlessElements,expandOnlyOnTwistieClick:e.expandOnlyOnTwistieClick??t.getValue(lt)==="doubleClick",contextViewProvider:i,findWidgetStyles:wn,enableStickyScroll:!!t.getValue(at),stickyScrollMaxItemCount:Number(t.getValue(dt))}}}let pe=class{get onDidOpen(){return this.navigator.onDidOpen}constructor(e,t,i,s,n,o,l){this.tree=e,this.disposables=[],this.contextKeyService=vt(n,e),this.disposables.push(Ct(this.contextKeyService,e)),this.listSupportsMultiSelect=yt.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(t.multipleSelectionSupport!==!1),St.bindTo(this.contextKeyService).set(!!t.selectionNavigation),this.listSupportFindWidget=To.bindTo(this.contextKeyService),this.listSupportFindWidget.set(t.findWidgetEnabled??!0),this.hasSelectionOrFocus=Qt.bindTo(this.contextKeyService),this.hasDoubleSelection=Zt.bindTo(this.contextKeyService),this.hasMultiSelection=ei.bindTo(this.contextKeyService),this.treeElementCanCollapse=Lo.bindTo(this.contextKeyService),this.treeElementHasParent=Mo.bindTo(this.contextKeyService),this.treeElementCanExpand=Po.bindTo(this.contextKeyService),this.treeElementHasChild=Fo.bindTo(this.contextKeyService),this.treeFindOpen=Oo.bindTo(this.contextKeyService),this.treeStickyScrollFocused=cs.bindTo(this.contextKeyService),this._useAltAsMultipleSelectionModifier=Q(l),this.updateStyleOverrides(s);const h=()=>{const d=e.getFocus()[0];if(!d)return;const f=e.getNode(d);this.treeElementCanCollapse.set(f.collapsible&&!f.collapsed),this.treeElementHasParent.set(!!e.getParentElement(d)),this.treeElementCanExpand.set(f.collapsible&&f.collapsed),this.treeElementHasChild.set(!!e.getFirstElementChild(d))},c=new Set;c.add(us),c.add(fs),this.disposables.push(this.contextKeyService,o.register(e),e.onDidChangeSelection(()=>{const d=e.getSelection(),f=e.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.hasSelectionOrFocus.set(d.length>0||f.length>0),this.hasMultiSelection.set(d.length>1),this.hasDoubleSelection.set(d.length===2)})}),e.onDidChangeFocus(()=>{const d=e.getSelection(),f=e.getFocus();this.hasSelectionOrFocus.set(d.length>0||f.length>0),h()}),e.onDidChangeCollapseState(h),e.onDidChangeModel(h),e.onDidChangeFindOpenState(d=>this.treeFindOpen.set(d)),e.onDidChangeStickyScrollFocused(d=>this.treeStickyScrollFocused.set(d)),l.onDidChangeConfiguration(d=>{let f={};if(d.affectsConfiguration(me)&&(this._useAltAsMultipleSelectionModifier=Q(l)),d.affectsConfiguration(Oe)){const g=l.getValue(Oe);f={...f,indent:g}}if(d.affectsConfiguration(rt)&&t.renderIndentGuides===void 0){const g=l.getValue(rt);f={...f,renderIndentGuides:g}}if(d.affectsConfiguration(U)){const g=!!l.getValue(U);f={...f,smoothScrolling:g}}if(d.affectsConfiguration(ti)||d.affectsConfiguration(ot)){const g=ps(l);f={...f,defaultFindMode:g}}if(d.affectsConfiguration(ii)||d.affectsConfiguration(ot)){const g=i();f={...f,typeNavigationMode:g}}if(d.affectsConfiguration(si)){const g=ms(l);f={...f,defaultFindMatchType:g}}if(d.affectsConfiguration($)&&t.horizontalScrolling===void 0){const g=!!l.getValue($);f={...f,horizontalScrolling:g}}if(d.affectsConfiguration(q)){const g=!!l.getValue(q);f={...f,scrollByPage:g}}if(d.affectsConfiguration(lt)&&t.expandOnlyOnTwistieClick===void 0&&(f={...f,expandOnlyOnTwistieClick:l.getValue(lt)==="doubleClick"}),d.affectsConfiguration(at)){const g=l.getValue(at);f={...f,enableStickyScroll:g}}if(d.affectsConfiguration(dt)){const g=Math.max(1,l.getValue(dt));f={...f,stickyScrollMaxItemCount:g}}if(d.affectsConfiguration(X)){const g=l.getValue(X);f={...f,mouseWheelScrollSensitivity:g}}if(d.affectsConfiguration(J)){const g=l.getValue(J);f={...f,fastScrollSensitivity:g}}Object.keys(f).length>0&&e.updateOptions(f)}),this.contextKeyService.onDidChangeContext(d=>{d.affectsSome(c)&&e.updateOptions({typeNavigationMode:i()})})),this.navigator=new zo(e,{configurationService:l,...t}),this.disposables.push(this.navigator)}updateOptions(e){e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyleOverrides(e){this.tree.style(e?bt(e):He)}dispose(){this.disposables=De(this.disposables)}};pe=ie([x(4,W),x(5,se),x(6,j)],pe);const Ro=Ws.as(hn.Configuration);Ro.registerConfiguration({id:"workbench",order:7,title:C("workbenchConfigurationTitle","Workbench"),type:"object",properties:{[me]:{type:"string",enum:["ctrlCmd","alt"],markdownEnumDescriptions:[C("multiSelectModifier.ctrlCmd","Maps to `Control` on Windows and Linux and to `Command` on macOS."),C("multiSelectModifier.alt","Maps to `Alt` on Windows and Linux and to `Option` on macOS.")],default:"ctrlCmd",description:C({key:"multiSelectModifier",comment:["- `ctrlCmd` refers to a value the setting can take and should not be localized.","- `Control` and `Command` refer to the modifier keys Ctrl or Cmd on the keyboard and can be localized."]},"The modifier to be used to add an item in trees and lists to a multi-selection with the mouse (for example in the explorer, open editors and scm view). The 'Open to Side' mouse gestures - if supported - will adapt such that they do not conflict with the multiselect modifier.")},[et]:{type:"string",enum:["singleClick","doubleClick"],default:"singleClick",description:C({key:"openModeModifier",comment:["`singleClick` and `doubleClick` refers to a value the setting can take and should not be localized."]},"Controls how to open items in trees and lists using the mouse (if supported). Note that some trees and lists might choose to ignore this setting if it is not applicable.")},[$]:{type:"boolean",default:!1,description:C("horizontalScrolling setting","Controls whether lists and trees support horizontal scrolling in the workbench. Warning: turning on this setting has a performance implication.")},[q]:{type:"boolean",default:!1,description:C("list.scrollByPage","Controls whether clicks in the scrollbar scroll page by page.")},[Oe]:{type:"number",default:8,minimum:4,maximum:40,description:C("tree indent setting","Controls tree indentation in pixels.")},[rt]:{type:"string",enum:["none","onHover","always"],default:"onHover",description:C("render tree indent guides","Controls whether the tree should render indent guides.")},[U]:{type:"boolean",default:!1,description:C("list smoothScrolling setting","Controls whether lists and trees have smooth scrolling.")},[X]:{type:"number",default:1,markdownDescription:C("Mouse Wheel Scroll Sensitivity","A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.")},[J]:{type:"number",default:5,markdownDescription:C("Fast Scroll Sensitivity","Scrolling speed multiplier when pressing `Alt`.")},[ti]:{type:"string",enum:["highlight","filter"],enumDescriptions:[C("defaultFindModeSettingKey.highlight","Highlight elements when searching. Further up and down navigation will traverse only the highlighted elements."),C("defaultFindModeSettingKey.filter","Filter elements when searching.")],default:"highlight",description:C("defaultFindModeSettingKey","Controls the default find mode for lists and trees in the workbench.")},[ot]:{type:"string",enum:["simple","highlight","filter"],enumDescriptions:[C("keyboardNavigationSettingKey.simple","Simple keyboard navigation focuses elements which match the keyboard input. Matching is done only on prefixes."),C("keyboardNavigationSettingKey.highlight","Highlight keyboard navigation highlights elements which match the keyboard input. Further up and down navigation will traverse only the highlighted elements."),C("keyboardNavigationSettingKey.filter","Filter keyboard navigation will filter out and hide all the elements which do not match the keyboard input.")],default:"highlight",description:C("keyboardNavigationSettingKey","Controls the keyboard navigation style for lists and trees in the workbench. Can be simple, highlight and filter."),deprecated:!0,deprecationMessage:C("keyboardNavigationSettingKeyDeprecated","Please use 'workbench.list.defaultFindMode' and	'workbench.list.typeNavigationMode' instead.")},[si]:{type:"string",enum:["fuzzy","contiguous"],enumDescriptions:[C("defaultFindMatchTypeSettingKey.fuzzy","Use fuzzy matching when searching."),C("defaultFindMatchTypeSettingKey.contiguous","Use contiguous matching when searching.")],default:"fuzzy",description:C("defaultFindMatchTypeSettingKey","Controls the type of matching used when searching lists and trees in the workbench.")},[lt]:{type:"string",enum:["singleClick","doubleClick"],default:"singleClick",description:C("expand mode","Controls how tree folders are expanded when clicking the folder names. Note that some trees and lists might choose to ignore this setting if it is not applicable.")},[at]:{type:"boolean",default:!0,description:C("sticky scroll","Controls whether sticky scrolling is enabled in trees.")},[dt]:{type:"number",minimum:1,default:7,markdownDescription:C("sticky scroll maximum items","Controls the number of sticky elements displayed in the tree when {0} is enabled.","`#workbench.tree.enableStickyScroll#`")},[ii]:{type:"string",enum:["automatic","trigger"],default:"automatic",markdownDescription:C("typeNavigationMode2","Controls how type navigation works in lists and trees in the workbench. When set to `trigger`, type navigation begins once the `list.triggerTypeNavigation` command is run.")}}});const $e=z,pr={keybindingLabelBackground:void 0,keybindingLabelForeground:void 0,keybindingLabelBorder:void 0,keybindingLabelBottomBorder:void 0,keybindingLabelShadow:void 0};class bs extends K{constructor(e,t,i){super(),this.os=t,this.keyElements=new Set,this.options=i||Object.create(null);const s=this.options.keybindingLabelForeground;this.domNode=A(e,$e(".monaco-keybinding")),s&&(this.domNode.style.color=s),this.hover=this._register(Ui().setupManagedHover(Yi("mouse"),this.domNode,"")),this.didEverRender=!1,e.appendChild(this.domNode)}get element(){return this.domNode}set(e,t){this.didEverRender&&this.keybinding===e&&bs.areSame(this.matches,t)||(this.keybinding=e,this.matches=t,this.render())}render(){if(this.clear(),this.keybinding){const e=this.keybinding.getChords();e[0]&&this.renderChord(this.domNode,e[0],this.matches?this.matches.firstPart:null);for(let i=1;i<e.length;i++)A(this.domNode,$e("span.monaco-keybinding-key-chord-separator",void 0," ")),this.renderChord(this.domNode,e[i],this.matches?this.matches.chordPart:null);const t=this.options.disableTitle??!1?void 0:this.keybinding.getAriaLabel()||void 0;this.hover.update(t),this.domNode.setAttribute("aria-label",t||"")}else this.options&&this.options.renderUnboundKeybindings&&this.renderUnbound(this.domNode);this.didEverRender=!0}clear(){Wt(this.domNode),this.keyElements.clear()}renderChord(e,t,i){const s=In.modifierLabels[this.os];t.ctrlKey&&this.renderKey(e,s.ctrlKey,!!(i!=null&&i.ctrlKey),s.separator),t.shiftKey&&this.renderKey(e,s.shiftKey,!!(i!=null&&i.shiftKey),s.separator),t.altKey&&this.renderKey(e,s.altKey,!!(i!=null&&i.altKey),s.separator),t.metaKey&&this.renderKey(e,s.metaKey,!!(i!=null&&i.metaKey),s.separator);const n=t.keyLabel;n&&this.renderKey(e,n,!!(i!=null&&i.keyCode),"")}renderKey(e,t,i,s){A(e,this.createKeyElement(t,i?".highlight":"")),s&&A(e,$e("span.monaco-keybinding-key-separator",void 0,s))}renderUnbound(e){A(e,this.createKeyElement(C("unbound","Unbound")))}createKeyElement(e,t=""){const i=$e("span.monaco-keybinding-key"+t,void 0,e);return this.keyElements.add(i),this.options.keybindingLabelBackground&&(i.style.backgroundColor=this.options.keybindingLabelBackground),this.options.keybindingLabelBorder&&(i.style.borderColor=this.options.keybindingLabelBorder),this.options.keybindingLabelBottomBorder&&(i.style.borderBottomColor=this.options.keybindingLabelBottomBorder),this.options.keybindingLabelShadow&&(i.style.boxShadow=`inset 0 -1px 0 ${this.options.keybindingLabelShadow}`),i}static areSame(e,t){return e===t||!e&&!t?!0:!!e&&!!t&&gi(e.firstPart,t.firstPart)&&gi(e.chordPart,t.chordPart)}}var Dt=function(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var l=r.length-1;l>=0;l--)(o=r[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},Y=function(r,e){return function(t,i){e(t,i,r)}},Se,Ie;let Ai=class{constructor(e,t,i){this._commandService=e,this._keybindingService=t,this._hiddenStates=new Ht(i)}createMenu(e,t,i){return new ht(e,this._hiddenStates,{emitEventsForSubmenuChanges:!1,eventDebounceDelay:50,...i},this._commandService,this._keybindingService,t)}getMenuActions(e,t,i){const s=new ht(e,this._hiddenStates,{emitEventsForSubmenuChanges:!1,eventDebounceDelay:50,...i},this._commandService,this._keybindingService,t),n=s.getActions(i);return s.dispose(),n}resetHiddenStates(e){this._hiddenStates.reset(e)}};Ai=Dt([Y(0,ze),Y(1,_e),Y(2,Ji)],Ai);var he;let Ht=(he=class{constructor(e){this._storageService=e,this._disposables=new F,this._onDidChange=new P,this.onDidChange=this._onDidChange.event,this._ignoreChangeEvent=!1,this._hiddenByDefaultCache=new Map;try{const t=e.get(Se._key,0,"{}");this._data=JSON.parse(t)}catch{this._data=Object.create(null)}this._disposables.add(e.onDidChangeValue(0,Se._key,this._disposables)(()=>{if(!this._ignoreChangeEvent)try{const t=e.get(Se._key,0,"{}");this._data=JSON.parse(t)}catch(t){console.log("FAILED to read storage after UPDATE",t)}this._onDidChange.fire()}))}dispose(){this._onDidChange.dispose(),this._disposables.dispose()}_isHiddenByDefault(e,t){return this._hiddenByDefaultCache.get(`${e.id}/${t}`)??!1}setDefaultState(e,t,i){this._hiddenByDefaultCache.set(`${e.id}/${t}`,i)}isHidden(e,t){var n;const i=this._isHiddenByDefault(e,t),s=((n=this._data[e.id])==null?void 0:n.includes(t))??!1;return i?!s:s}updateHidden(e,t,i){this._isHiddenByDefault(e,t)&&(i=!i);const n=this._data[e.id];if(i)n?n.indexOf(t)<0&&n.push(t):this._data[e.id]=[t];else if(n){const o=n.indexOf(t);o>=0&&Gs(n,o),n.length===0&&delete this._data[e.id]}this._persist()}reset(e){if(e===void 0)this._data=Object.create(null),this._persist();else{for(const{id:t}of e)this._data[t]&&delete this._data[t];this._persist()}}_persist(){try{this._ignoreChangeEvent=!0;const e=JSON.stringify(this._data);this._storageService.store(Se._key,e,0,0)}finally{this._ignoreChangeEvent=!1}}},Se=he,he._key="menu.hiddenCommands",he);Ht=Se=Dt([Y(0,Ji)],Ht);class Ee{constructor(e,t){this._id=e,this._collectContextKeysForSubmenus=t,this._menuGroups=[],this._allMenuIds=new Set,this._structureContextKeys=new Set,this._preconditionContextKeys=new Set,this._toggledContextKeys=new Set,this.refresh()}get allMenuIds(){return this._allMenuIds}get structureContextKeys(){return this._structureContextKeys}get preconditionContextKeys(){return this._preconditionContextKeys}get toggledContextKeys(){return this._toggledContextKeys}refresh(){this._menuGroups.length=0,this._allMenuIds.clear(),this._structureContextKeys.clear(),this._preconditionContextKeys.clear(),this._toggledContextKeys.clear();const e=this._sort(Mt.getMenuItems(this._id));let t;for(const i of e){const s=i.group||"";(!t||t[0]!==s)&&(t=[s,[]],this._menuGroups.push(t)),t[1].push(i),this._collectContextKeysAndSubmenuIds(i)}this._allMenuIds.add(this._id)}_sort(e){return e}_collectContextKeysAndSubmenuIds(e){if(Ee._fillInKbExprKeys(e.when,this._structureContextKeys),je(e)){if(e.command.precondition&&Ee._fillInKbExprKeys(e.command.precondition,this._preconditionContextKeys),e.command.toggled){const t=e.command.toggled.condition||e.command.toggled;Ee._fillInKbExprKeys(t,this._toggledContextKeys)}}else this._collectContextKeysForSubmenus&&(Mt.getMenuItems(e.submenu).forEach(this._collectContextKeysAndSubmenuIds,this),this._allMenuIds.add(e.submenu))}static _fillInKbExprKeys(e,t){if(e)for(const i of e.keys())t.add(i)}}let Rt=Ie=class extends Ee{constructor(e,t,i,s,n,o){super(e,i),this._hiddenStates=t,this._commandService=s,this._keybindingService=n,this._contextKeyService=o,this.refresh()}createActionGroups(e){const t=[];for(const i of this._menuGroups){const[s,n]=i;let o;for(const l of n)if(this._contextKeyService.contextMatchesRules(l.when)){const a=je(l);a&&this._hiddenStates.setDefaultState(this._id,l.command.id,!!l.isHiddenByDefault);const h=Bo(this._id,a?l.command:l,this._hiddenStates);if(a){const c=ys(this._commandService,this._keybindingService,l.command.id,l.when);(o??(o=[])).push(new qe(l.command,l.alt,e,h,c,this._contextKeyService,this._commandService))}else{const c=new Ie(l.submenu,this._hiddenStates,this._collectContextKeysForSubmenus,this._commandService,this._keybindingService,this._contextKeyService).createActionGroups(e),d=Ue.join(...c.map(f=>f[1]));d.length>0&&(o??(o=[])).push(new Ye(l,h,d))}}o&&o.length>0&&t.push([s,o])}return t}_sort(e){return e.sort(Ie._compareMenuItems)}static _compareMenuItems(e,t){const i=e.group,s=t.group;if(i!==s){if(i){if(!s)return-1}else return 1;if(i==="navigation")return-1;if(s==="navigation")return 1;const l=i.localeCompare(s);if(l!==0)return l}const n=e.order||0,o=t.order||0;return n<o?-1:n>o?1:Ie._compareTitles(je(e)?e.command.title:e.title,je(t)?t.command.title:t.title)}static _compareTitles(e,t){const i=typeof e=="string"?e:e.original,s=typeof t=="string"?t:t.original;return i.localeCompare(s)}};Rt=Ie=Dt([Y(3,ze),Y(4,_e),Y(5,W)],Rt);let ht=class{constructor(e,t,i,s,n,o){this._disposables=new F,this._menuInfo=new Rt(e,t,i.emitEventsForSubmenuChanges,s,n,o);const l=new js(()=>{this._menuInfo.refresh(),this._onDidChange.fire({menu:this,isStructuralChange:!0,isEnablementChange:!0,isToggleChange:!0})},i.eventDebounceDelay);this._disposables.add(l),this._disposables.add(Mt.onDidChangeMenu(d=>{for(const f of this._menuInfo.allMenuIds)if(d.has(f)){l.schedule();break}}));const a=this._disposables.add(new F),h=d=>{let f=!1,g=!1,p=!1;for(const u of d)if(f=f||u.isStructuralChange,g=g||u.isEnablementChange,p=p||u.isToggleChange,f&&g&&p)break;return{menu:this,isStructuralChange:f,isEnablementChange:g,isToggleChange:p}},c=()=>{a.add(o.onDidChangeContext(d=>{const f=d.affectsSome(this._menuInfo.structureContextKeys),g=d.affectsSome(this._menuInfo.preconditionContextKeys),p=d.affectsSome(this._menuInfo.toggledContextKeys);(f||g||p)&&this._onDidChange.fire({menu:this,isStructuralChange:f,isEnablementChange:g,isToggleChange:p})})),a.add(t.onDidChange(d=>{this._onDidChange.fire({menu:this,isStructuralChange:!0,isEnablementChange:!1,isToggleChange:!1})}))};this._onDidChange=new qs({onWillAddFirstListener:c,onDidRemoveLastListener:a.clear.bind(a),delay:i.eventDebounceDelay,merge:h}),this.onDidChange=this._onDidChange.event}getActions(e){return this._menuInfo.createActionGroups(e)}dispose(){this._disposables.dispose(),this._onDidChange.dispose()}};ht=Dt([Y(3,ze),Y(4,_e),Y(5,W)],ht);function Bo(r,e,t){const i=Us(e)?e.submenu.id:e.id,s=typeof e.title=="string"?e.title:e.title.value,n=ve({id:`hide/${r.id}/${i}`,label:C("hide.label","Hide '{0}'",s),run(){t.updateHidden(r,i,!0)}}),o=ve({id:`toggle/${r.id}/${i}`,label:s,get checked(){return!t.isHidden(r,i)},run(){t.updateHidden(r,i,!!this.checked)}});return{hide:n,toggle:o,get isHidden(){return!o.checked}}}function ys(r,e,t,i=void 0,s=!0){return ve({id:`configureKeybinding/${t}`,label:C("configure keybinding","Configure Keybinding"),enabled:s,run(){const o=!!!e.lookupKeybinding(t)&&i?i.serialize():void 0;r.executeCommand("workbench.action.openGlobalKeybindings",`@command:${t}`+(o?` +when:${o}`:""))}})}const Ss=[];function Sr(r){Ss.push(r)}function vr(){return Ss.slice(0)}class Vo extends K{constructor(e,t,i={orientation:0}){super(),this.submenuActionViewItems=[],this.hasSecondaryActions=!1,this._onDidChangeDropdownVisibility=this._register(new Xs),this.onDidChangeDropdownVisibility=this._onDidChangeDropdownVisibility.event,this.disposables=this._register(new F),i.hoverDelegate=i.hoverDelegate??this._register(xn()),this.options=i,this.toggleMenuAction=this._register(new Ae(()=>{var s;return(s=this.toggleMenuActionViewItem)==null?void 0:s.show()},i.toggleMenuTitle)),this.element=document.createElement("div"),this.element.className="monaco-toolbar",e.appendChild(this.element),this.actionBar=this._register(new En(this.element,{orientation:i.orientation,ariaLabel:i.ariaLabel,actionRunner:i.actionRunner,allowContextMenu:i.allowContextMenu,highlightToggledItems:i.highlightToggledItems,hoverDelegate:i.hoverDelegate,actionViewItemProvider:(s,n)=>{if(s.id===Ae.ID)return this.toggleMenuActionViewItem=new mi(s,s.menuActions,t,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:ue.asClassNameArray(i.moreIcon??fe.toolBarMore),anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry,isMenu:!0,hoverDelegate:this.options.hoverDelegate}),this.toggleMenuActionViewItem.setActionContext(this.actionBar.context),this.disposables.add(this._onDidChangeDropdownVisibility.add(this.toggleMenuActionViewItem.onDidChangeVisibility)),this.toggleMenuActionViewItem;if(i.actionViewItemProvider){const o=i.actionViewItemProvider(s,n);if(o)return o}if(s instanceof Js){const o=new mi(s,s.actions,t,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:s.class,anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry,hoverDelegate:this.options.hoverDelegate});return o.setActionContext(this.actionBar.context),this.submenuActionViewItems.push(o),this.disposables.add(this._onDidChangeDropdownVisibility.add(o.onDidChangeVisibility)),o}}}))}set actionRunner(e){this.actionBar.actionRunner=e}get actionRunner(){return this.actionBar.actionRunner}getElement(){return this.element}getItemAction(e){return this.actionBar.getAction(e)}setActions(e,t){this.clear();const i=e?e.slice(0):[];this.hasSecondaryActions=!!(t&&t.length>0),this.hasSecondaryActions&&t&&(this.toggleMenuAction.menuActions=t.slice(0),i.push(this.toggleMenuAction)),i.forEach(s=>{this.actionBar.push(s,{icon:this.options.icon??!0,label:this.options.label??!1,keybinding:this.getKeybindingLabel(s)})})}getKeybindingLabel(e){var i,s;const t=(s=(i=this.options).getKeyBinding)==null?void 0:s.call(i,e);return(t==null?void 0:t.getLabel())??void 0}clear(){this.submenuActionViewItems=[],this.disposables.clear(),this.actionBar.clear()}dispose(){this.clear(),this.disposables.dispose(),super.dispose()}}const ft=class ft extends Ys{constructor(e,t){t=t||C("moreActions","More Actions..."),super(ft.ID,t,void 0,!0),this._menuActions=[],this.toggleDropdownMenu=e}async run(){this.toggleDropdownMenu()}get menuActions(){return this._menuActions}set menuActions(e){this._menuActions=e}};ft.ID="toolbar.toggle.more";let Ae=ft;var vs=function(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var l=r.length-1;l>=0;l--)(o=r[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n},G=function(r,e){return function(t,i){e(t,i,r)}};let Bt=class extends Vo{constructor(e,t,i,s,n,o,l,a){super(e,n,{getKeyBinding:c=>o.lookupKeybinding(c.id)??void 0,...t,allowContextMenu:!0,skipTelemetry:typeof(t==null?void 0:t.telemetrySource)=="string"}),this._options=t,this._menuService=i,this._contextKeyService=s,this._contextMenuService=n,this._keybindingService=o,this._commandService=l,this._sessionDisposables=this._store.add(new F);const h=t==null?void 0:t.telemetrySource;h&&this._store.add(this.actionBar.onDidRun(c=>a.publicLog2("workbenchActionExecuted",{id:c.action.id,from:h})))}setActions(e,t=[],i){var c,d,f;this._sessionDisposables.clear();const s=e.slice(),n=t.slice(),o=[];let l=0;const a=[];let h=!1;if(((c=this._options)==null?void 0:c.hiddenItemStrategy)!==-1)for(let g=0;g<s.length;g++){const p=s[g];!(p instanceof qe)&&!(p instanceof Ye)||p.hideActions&&(o.push(p.hideActions.toggle),p.hideActions.toggle.checked&&l++,p.hideActions.isHidden&&(h=!0,s[g]=void 0,((d=this._options)==null?void 0:d.hiddenItemStrategy)!==0&&(a[g]=p)))}if(((f=this._options)==null?void 0:f.overflowBehavior)!==void 0){const g=Hn(new Set(this._options.overflowBehavior.exempted),k.map(s,m=>m==null?void 0:m.id)),p=this._options.overflowBehavior.maxItems-g.size;let u=0;for(let m=0;m<s.length;m++){const S=s[m];S&&(u++,!g.has(S.id)&&u>=p&&(s[m]=void 0,a[m]=S))}}ui(s),ui(a),super.setActions(s,Ue.join(a,n)),(o.length>0||s.length>0)&&this._sessionDisposables.add(ce(this.getElement(),"contextmenu",g=>{var N,I,L,v,T;const p=new Qs(Ri(this.getElement()),g),u=this.getItemAction(p.target);if(!u)return;p.preventDefault(),p.stopPropagation();const m=[];if(u instanceof qe&&u.menuKeybinding)m.push(u.menuKeybinding);else if(!(u instanceof Ye||u instanceof Ae)){const y=!!this._keybindingService.lookupKeybinding(u.id);m.push(ys(this._commandService,this._keybindingService,u.id,void 0,y))}if(o.length>0){let y=!1;if(l===1&&((N=this._options)==null?void 0:N.hiddenItemStrategy)===0){y=!0;for(let b=0;b<o.length;b++)if(o[b].checked){o[b]=ve({id:u.id,label:u.label,checked:!0,enabled:!1,run(){}});break}}if(!y&&(u instanceof qe||u instanceof Ye)){if(!u.hideActions)return;m.push(u.hideActions.hide)}else m.push(ve({id:"label",label:C("hide","Hide"),enabled:!1,run(){}}))}const S=Ue.join(m,o);(I=this._options)!=null&&I.resetMenu&&!i&&(i=[this._options.resetMenu]),h&&i&&(S.push(new Ue),S.push(ve({id:"resetThisMenu",label:C("resetThisMenu","Reset Menu"),run:()=>this._menuService.resetHiddenStates(i)}))),S.length!==0&&this._contextMenuService.showContextMenu({getAnchor:()=>p,getActions:()=>S,menuId:(L=this._options)==null?void 0:L.contextMenu,menuActionOptions:{renderShortTitle:!0,...(v=this._options)==null?void 0:v.menuOptions},skipTelemetry:typeof((T=this._options)==null?void 0:T.telemetrySource)=="string",contextKeyService:this._contextKeyService})}))}};Bt=vs([G(2,Gi),G(3,W),G(4,Qi),G(5,_e),G(6,ze),G(7,ji)],Bt);let Ki=class extends Bt{constructor(e,t,i,s,n,o,l,a,h){super(e,{resetMenu:t,...i},s,n,o,l,a,h),this._onDidChangeMenuItems=this._store.add(new P),this.onDidChangeMenuItems=this._onDidChangeMenuItems.event;const c=this._store.add(s.createMenu(t,n,{emitEventsForSubmenuChanges:!0})),d=()=>{var p,u,m;const f=[],g=[];kn(c,i==null?void 0:i.menuOptions,{primary:f,secondary:g},(p=i==null?void 0:i.toolbarOptions)==null?void 0:p.primaryGroup,(u=i==null?void 0:i.toolbarOptions)==null?void 0:u.shouldInlineSubmenu,(m=i==null?void 0:i.toolbarOptions)==null?void 0:m.useSeparatorsInPrimaryActions),e.classList.toggle("has-no-actions",f.length===0&&g.length===0),super.setActions(f,g)};this._store.add(c.onDidChange(()=>{d(),this._onDidChangeMenuItems.fire(this)})),d()}setActions(){throw new Zs("This toolbar is populated from a menu.")}};Ki=vs([G(3,Gi),G(4,W),G(5,Qi),G(6,_e),G(7,ze),G(8,ji)],Ki);export{vr as A,Ki as B,tr as C,Xo as H,sr as I,bs as K,ae as L,Le as M,Pe as R,qn as S,Fi as W,Di as a,or as b,Lo as c,Po as d,se as e,ir as f,Bt as g,Jo as h,Zi as i,An as j,Ci as k,Kn as l,zn as m,Mn as n,Qo as o,Zo as p,wi as q,Sr as r,qo as s,er as t,pr as u,Li as v,es as w,Ce as x,nr as y,Ai as z};
