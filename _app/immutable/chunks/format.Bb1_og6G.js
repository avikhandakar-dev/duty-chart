import{q as $,l as s,R as v,L as _,t as ee,e as B,u as K,U as T,v as q,I as x,b as W,P as Q,c as z,w as te,x as ie,y as A,i as G}from"./editorContextKeys.Cdn_dJhV.js";import{i as E,E as J,T as X}from"./editorBrowser.CzkYJKPy.js";import{S as se,E as V,I as M,a as N}from"./stableEditorScroll.DHPB0mmN.js";const Y=$("accessibilitySignalService"),n=class n{static register(e){return new n(e.fileName)}constructor(e){this.fileName=e}};n.error=n.register({fileName:"error.mp3"}),n.warning=n.register({fileName:"warning.mp3"}),n.success=n.register({fileName:"success.mp3"}),n.foldedArea=n.register({fileName:"foldedAreas.mp3"}),n.break=n.register({fileName:"break.mp3"}),n.quickFixes=n.register({fileName:"quickFixes.mp3"}),n.taskCompleted=n.register({fileName:"taskCompleted.mp3"}),n.taskFailed=n.register({fileName:"taskFailed.mp3"}),n.terminalBell=n.register({fileName:"terminalBell.mp3"}),n.diffLineInserted=n.register({fileName:"diffLineInserted.mp3"}),n.diffLineDeleted=n.register({fileName:"diffLineDeleted.mp3"}),n.diffLineModified=n.register({fileName:"diffLineModified.mp3"}),n.chatRequestSent=n.register({fileName:"chatRequestSent.mp3"}),n.chatResponseReceived1=n.register({fileName:"chatResponseReceived1.mp3"}),n.chatResponseReceived2=n.register({fileName:"chatResponseReceived2.mp3"}),n.chatResponseReceived3=n.register({fileName:"chatResponseReceived3.mp3"}),n.chatResponseReceived4=n.register({fileName:"chatResponseReceived4.mp3"}),n.clear=n.register({fileName:"clear.mp3"}),n.save=n.register({fileName:"save.mp3"}),n.format=n.register({fileName:"format.mp3"}),n.voiceRecordingStarted=n.register({fileName:"voiceRecordingStarted.mp3"}),n.voiceRecordingStopped=n.register({fileName:"voiceRecordingStopped.mp3"}),n.progress=n.register({fileName:"progress.mp3"});let g=n;class ne{constructor(e){this.randomOneOf=e}}const i=class i{constructor(e,t,a,r,o,u){this.sound=e,this.name=t,this.legacySoundSettingsKey=a,this.settingsKey=r,this.legacyAnnouncementSettingsKey=o,this.announcementMessage=u}static register(e){const t=new ne("randomOneOf"in e.sound?e.sound.randomOneOf:[e.sound]),a=new i(t,e.name,e.legacySoundSettingsKey,e.settingsKey,e.legacyAnnouncementSettingsKey,e.announcementMessage);return i._signals.add(a),a}};i._signals=new Set,i.errorAtPosition=i.register({name:s("accessibilitySignals.positionHasError.name","Error at Position"),sound:g.error,announcementMessage:s("accessibility.signals.positionHasError","Error"),settingsKey:"accessibility.signals.positionHasError",delaySettingsKey:"accessibility.signalOptions.delays.errorAtPosition"}),i.warningAtPosition=i.register({name:s("accessibilitySignals.positionHasWarning.name","Warning at Position"),sound:g.warning,announcementMessage:s("accessibility.signals.positionHasWarning","Warning"),settingsKey:"accessibility.signals.positionHasWarning",delaySettingsKey:"accessibility.signalOptions.delays.warningAtPosition"}),i.errorOnLine=i.register({name:s("accessibilitySignals.lineHasError.name","Error on Line"),sound:g.error,legacySoundSettingsKey:"audioCues.lineHasError",legacyAnnouncementSettingsKey:"accessibility.alert.error",announcementMessage:s("accessibility.signals.lineHasError","Error on Line"),settingsKey:"accessibility.signals.lineHasError"}),i.warningOnLine=i.register({name:s("accessibilitySignals.lineHasWarning.name","Warning on Line"),sound:g.warning,legacySoundSettingsKey:"audioCues.lineHasWarning",legacyAnnouncementSettingsKey:"accessibility.alert.warning",announcementMessage:s("accessibility.signals.lineHasWarning","Warning on Line"),settingsKey:"accessibility.signals.lineHasWarning"}),i.foldedArea=i.register({name:s("accessibilitySignals.lineHasFoldedArea.name","Folded Area on Line"),sound:g.foldedArea,legacySoundSettingsKey:"audioCues.lineHasFoldedArea",legacyAnnouncementSettingsKey:"accessibility.alert.foldedArea",announcementMessage:s("accessibility.signals.lineHasFoldedArea","Folded"),settingsKey:"accessibility.signals.lineHasFoldedArea"}),i.break=i.register({name:s("accessibilitySignals.lineHasBreakpoint.name","Breakpoint on Line"),sound:g.break,legacySoundSettingsKey:"audioCues.lineHasBreakpoint",legacyAnnouncementSettingsKey:"accessibility.alert.breakpoint",announcementMessage:s("accessibility.signals.lineHasBreakpoint","Breakpoint"),settingsKey:"accessibility.signals.lineHasBreakpoint"}),i.inlineSuggestion=i.register({name:s("accessibilitySignals.lineHasInlineSuggestion.name","Inline Suggestion on Line"),sound:g.quickFixes,legacySoundSettingsKey:"audioCues.lineHasInlineSuggestion",settingsKey:"accessibility.signals.lineHasInlineSuggestion"}),i.terminalQuickFix=i.register({name:s("accessibilitySignals.terminalQuickFix.name","Terminal Quick Fix"),sound:g.quickFixes,legacySoundSettingsKey:"audioCues.terminalQuickFix",legacyAnnouncementSettingsKey:"accessibility.alert.terminalQuickFix",announcementMessage:s("accessibility.signals.terminalQuickFix","Quick Fix"),settingsKey:"accessibility.signals.terminalQuickFix"}),i.onDebugBreak=i.register({name:s("accessibilitySignals.onDebugBreak.name","Debugger Stopped on Breakpoint"),sound:g.break,legacySoundSettingsKey:"audioCues.onDebugBreak",legacyAnnouncementSettingsKey:"accessibility.alert.onDebugBreak",announcementMessage:s("accessibility.signals.onDebugBreak","Breakpoint"),settingsKey:"accessibility.signals.onDebugBreak"}),i.noInlayHints=i.register({name:s("accessibilitySignals.noInlayHints","No Inlay Hints on Line"),sound:g.error,legacySoundSettingsKey:"audioCues.noInlayHints",legacyAnnouncementSettingsKey:"accessibility.alert.noInlayHints",announcementMessage:s("accessibility.signals.noInlayHints","No Inlay Hints"),settingsKey:"accessibility.signals.noInlayHints"}),i.taskCompleted=i.register({name:s("accessibilitySignals.taskCompleted","Task Completed"),sound:g.taskCompleted,legacySoundSettingsKey:"audioCues.taskCompleted",legacyAnnouncementSettingsKey:"accessibility.alert.taskCompleted",announcementMessage:s("accessibility.signals.taskCompleted","Task Completed"),settingsKey:"accessibility.signals.taskCompleted"}),i.taskFailed=i.register({name:s("accessibilitySignals.taskFailed","Task Failed"),sound:g.taskFailed,legacySoundSettingsKey:"audioCues.taskFailed",legacyAnnouncementSettingsKey:"accessibility.alert.taskFailed",announcementMessage:s("accessibility.signals.taskFailed","Task Failed"),settingsKey:"accessibility.signals.taskFailed"}),i.terminalCommandFailed=i.register({name:s("accessibilitySignals.terminalCommandFailed","Terminal Command Failed"),sound:g.error,legacySoundSettingsKey:"audioCues.terminalCommandFailed",legacyAnnouncementSettingsKey:"accessibility.alert.terminalCommandFailed",announcementMessage:s("accessibility.signals.terminalCommandFailed","Command Failed"),settingsKey:"accessibility.signals.terminalCommandFailed"}),i.terminalCommandSucceeded=i.register({name:s("accessibilitySignals.terminalCommandSucceeded","Terminal Command Succeeded"),sound:g.success,announcementMessage:s("accessibility.signals.terminalCommandSucceeded","Command Succeeded"),settingsKey:"accessibility.signals.terminalCommandSucceeded"}),i.terminalBell=i.register({name:s("accessibilitySignals.terminalBell","Terminal Bell"),sound:g.terminalBell,legacySoundSettingsKey:"audioCues.terminalBell",legacyAnnouncementSettingsKey:"accessibility.alert.terminalBell",announcementMessage:s("accessibility.signals.terminalBell","Terminal Bell"),settingsKey:"accessibility.signals.terminalBell"}),i.notebookCellCompleted=i.register({name:s("accessibilitySignals.notebookCellCompleted","Notebook Cell Completed"),sound:g.taskCompleted,legacySoundSettingsKey:"audioCues.notebookCellCompleted",legacyAnnouncementSettingsKey:"accessibility.alert.notebookCellCompleted",announcementMessage:s("accessibility.signals.notebookCellCompleted","Notebook Cell Completed"),settingsKey:"accessibility.signals.notebookCellCompleted"}),i.notebookCellFailed=i.register({name:s("accessibilitySignals.notebookCellFailed","Notebook Cell Failed"),sound:g.taskFailed,legacySoundSettingsKey:"audioCues.notebookCellFailed",legacyAnnouncementSettingsKey:"accessibility.alert.notebookCellFailed",announcementMessage:s("accessibility.signals.notebookCellFailed","Notebook Cell Failed"),settingsKey:"accessibility.signals.notebookCellFailed"}),i.diffLineInserted=i.register({name:s("accessibilitySignals.diffLineInserted","Diff Line Inserted"),sound:g.diffLineInserted,legacySoundSettingsKey:"audioCues.diffLineInserted",settingsKey:"accessibility.signals.diffLineInserted"}),i.diffLineDeleted=i.register({name:s("accessibilitySignals.diffLineDeleted","Diff Line Deleted"),sound:g.diffLineDeleted,legacySoundSettingsKey:"audioCues.diffLineDeleted",settingsKey:"accessibility.signals.diffLineDeleted"}),i.diffLineModified=i.register({name:s("accessibilitySignals.diffLineModified","Diff Line Modified"),sound:g.diffLineModified,legacySoundSettingsKey:"audioCues.diffLineModified",settingsKey:"accessibility.signals.diffLineModified"}),i.chatRequestSent=i.register({name:s("accessibilitySignals.chatRequestSent","Chat Request Sent"),sound:g.chatRequestSent,legacySoundSettingsKey:"audioCues.chatRequestSent",legacyAnnouncementSettingsKey:"accessibility.alert.chatRequestSent",announcementMessage:s("accessibility.signals.chatRequestSent","Chat Request Sent"),settingsKey:"accessibility.signals.chatRequestSent"}),i.chatResponseReceived=i.register({name:s("accessibilitySignals.chatResponseReceived","Chat Response Received"),legacySoundSettingsKey:"audioCues.chatResponseReceived",sound:{randomOneOf:[g.chatResponseReceived1,g.chatResponseReceived2,g.chatResponseReceived3,g.chatResponseReceived4]},settingsKey:"accessibility.signals.chatResponseReceived"}),i.progress=i.register({name:s("accessibilitySignals.progress","Progress"),sound:g.progress,legacySoundSettingsKey:"audioCues.chatResponsePending",legacyAnnouncementSettingsKey:"accessibility.alert.progress",announcementMessage:s("accessibility.signals.progress","Progress"),settingsKey:"accessibility.signals.progress"}),i.clear=i.register({name:s("accessibilitySignals.clear","Clear"),sound:g.clear,legacySoundSettingsKey:"audioCues.clear",legacyAnnouncementSettingsKey:"accessibility.alert.clear",announcementMessage:s("accessibility.signals.clear","Clear"),settingsKey:"accessibility.signals.clear"}),i.save=i.register({name:s("accessibilitySignals.save","Save"),sound:g.save,legacySoundSettingsKey:"audioCues.save",legacyAnnouncementSettingsKey:"accessibility.alert.save",announcementMessage:s("accessibility.signals.save","Save"),settingsKey:"accessibility.signals.save"}),i.format=i.register({name:s("accessibilitySignals.format","Format"),sound:g.format,legacySoundSettingsKey:"audioCues.format",legacyAnnouncementSettingsKey:"accessibility.alert.format",announcementMessage:s("accessibility.signals.format","Format"),settingsKey:"accessibility.signals.format"}),i.voiceRecordingStarted=i.register({name:s("accessibilitySignals.voiceRecordingStarted","Voice Recording Started"),sound:g.voiceRecordingStarted,legacySoundSettingsKey:"audioCues.voiceRecordingStarted",settingsKey:"accessibility.signals.voiceRecordingStarted"}),i.voiceRecordingStopped=i.register({name:s("accessibilitySignals.voiceRecordingStopped","Voice Recording Stopped"),sound:g.voiceRecordingStopped,legacySoundSettingsKey:"audioCues.voiceRecordingStopped",settingsKey:"accessibility.signals.voiceRecordingStopped"});let P=i;class L{static _handleEolEdits(e,t){let a;const r=[];for(const o of t)typeof o.eol=="number"&&(a=o.eol),o.range&&typeof o.text=="string"&&r.push(o);return typeof a=="number"&&e.hasModel()&&e.getModel().pushEOL(a),r}static _isFullModelReplaceEdit(e,t){if(!e.hasModel())return!1;const a=e.getModel(),r=a.validateRange(t.range);return a.getFullModelRange().equalsRange(r)}static execute(e,t,a){a&&e.pushUndoStop();const r=se.capture(e),o=L._handleEolEdits(e,t);o.length===1&&L._isFullModelReplaceEdit(e,o[0])?e.executeEdits("formatEditsCommand",o.map(u=>V.replace(v.lift(u.range),u.text))):e.executeEdits("formatEditsCommand",o.map(u=>V.replaceMove(v.lift(u.range),u.text))),a&&e.pushUndoStop(),r.restoreRelativeVerticalPositionOfCursor(e)}}class j{constructor(e){this.value=e,this._lower=e.toLowerCase()}static toKey(e){return typeof e=="string"?e.toLowerCase():e._lower}}class ae{constructor(e){if(this._set=new Set,e)for(const t of e)this.add(t)}add(e){this._set.add(j.toKey(e))}has(e){return this._set.has(j.toKey(e))}}function Z(l,e,t){const a=[],r=new ae,o=l.ordered(t);for(const c of o)a.push(c),c.extensionId&&r.add(c.extensionId);const u=e.ordered(t);for(const c of u){if(c.extensionId){if(r.has(c.extensionId))continue;r.add(c.extensionId)}a.push({displayName:c.displayName,extensionId:c.extensionId,provideDocumentFormattingEdits(m,f,p){return c.provideDocumentRangeFormattingEdits(m,m.getFullModelRange(),f,p)}})}return a}const I=class I{static setFormatterSelector(e){return{dispose:I._selectors.unshift(e)}}static async select(e,t,a,r){if(e.length===0)return;const o=ee.first(I._selectors);if(o)return await o(e,t,a,r)}};I._selectors=new _;let D=I;async function ye(l,e,t,a,r,o,u){const c=l.get(z),{documentRangeFormattingEditProvider:m}=l.get(x),f=E(e)?e.getModel():e,p=m.ordered(f),y=await D.select(p,f,a,2);y&&(r.report(y),await c.invokeFunction(re,y,e,t,o,u))}async function re(l,e,t,a,r,o){var U,O;const u=l.get(M),c=l.get(te),m=l.get(Y);let f,p;E(t)?(f=t.getModel(),p=new J(t,5,void 0,r)):(f=t,p=new X(t,r));const y=[];let R=0;for(const d of ie(a).sort(v.compareRangesUsingStarts))R>0&&v.areIntersectingOrTouching(y[R-1],d)?y[R-1]=v.fromPositions(y[R-1].getStartPosition(),d.getEndPosition()):R=y.push(d);const k=async d=>{var b,h;c.trace("[format][provideDocumentRangeFormattingEdits] (request)",(b=e.extensionId)==null?void 0:b.value,d);const S=await e.provideDocumentRangeFormattingEdits(f,d,f.getFormattingOptions(),p.token)||[];return c.trace("[format][provideDocumentRangeFormattingEdits] (response)",(h=e.extensionId)==null?void 0:h.value,S),S},F=(d,S)=>{if(!d.length||!S.length)return!1;const b=d.reduce((h,H)=>v.plusRange(h,H.range),d[0].range);if(!S.some(h=>v.intersectRanges(b,h.range)))return!1;for(const h of d)for(const H of S)if(v.intersectRanges(h.range,H.range))return!0;return!1},w=[],C=[];try{if(typeof e.provideDocumentRangesFormattingEdits=="function"){c.trace("[format][provideDocumentRangeFormattingEdits] (request)",(U=e.extensionId)==null?void 0:U.value,y);const d=await e.provideDocumentRangesFormattingEdits(f,y,f.getFormattingOptions(),p.token)||[];c.trace("[format][provideDocumentRangeFormattingEdits] (response)",(O=e.extensionId)==null?void 0:O.value,d),C.push(d)}else{for(const d of y){if(p.token.isCancellationRequested)return!0;C.push(await k(d))}for(let d=0;d<y.length;++d)for(let S=d+1;S<y.length;++S){if(p.token.isCancellationRequested)return!0;if(F(C[d],C[S])){const b=v.plusRange(y[d],y[S]),h=await k(b);y.splice(S,1),y.splice(d,1),y.push(b),C.splice(S,1),C.splice(d,1),C.push(h),d=0,S=0}}}for(const d of C){if(p.token.isCancellationRequested)return!0;const S=await u.computeMoreMinimalEdits(f.uri,d);S&&w.push(...S)}}finally{p.dispose()}if(w.length===0)return!1;if(E(t))L.execute(t,w,!0),t.revealPositionInCenterIfOutsideViewport(t.getPosition(),1);else{const[{range:d}]=w,S=new N(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn);f.pushEditOperations([S],w.map(b=>({text:b.text,range:v.lift(b.range),forceMoveMarkers:!0})),b=>{for(const{range:h}of b)if(v.areIntersectingOrTouching(h,S))return[new N(h.startLineNumber,h.startColumn,h.endLineNumber,h.endColumn)];return null})}return m.playSignal(P.format,{userGesture:o}),!0}async function fe(l,e,t,a,r,o){const u=l.get(z),c=l.get(x),m=E(e)?e.getModel():e,f=Z(c.documentFormattingEditProvider,c.documentRangeFormattingEditProvider,m),p=await D.select(f,m,t,1);p&&(a.report(p),await u.invokeFunction(oe,p,e,t,r,o))}async function oe(l,e,t,a,r,o){const u=l.get(M),c=l.get(Y);let m,f;E(t)?(m=t.getModel(),f=new J(t,5,void 0,r)):(m=t,f=new X(t,r));let p;try{const y=await e.provideDocumentFormattingEdits(m,m.getFormattingOptions(),f.token);if(p=await u.computeMoreMinimalEdits(m.uri,y),f.token.isCancellationRequested)return!0}finally{f.dispose()}if(!p||p.length===0)return!1;if(E(t))L.execute(t,p,a!==2),a!==2&&t.revealPositionInCenterIfOutsideViewport(t.getPosition(),1);else{const[{range:y}]=p,R=new N(y.startLineNumber,y.startColumn,y.endLineNumber,y.endColumn);m.pushEditOperations([R],p.map(k=>({text:k.text,range:v.lift(k.range),forceMoveMarkers:!0})),k=>{for(const{range:F}of k)if(v.areIntersectingOrTouching(F,R))return[new N(F.startLineNumber,F.startColumn,F.endLineNumber,F.endColumn)];return null})}return c.playSignal(P.format,{userGesture:o}),!0}async function ce(l,e,t,a,r,o){const u=e.documentRangeFormattingEditProvider.ordered(t);for(const c of u){const m=await Promise.resolve(c.provideDocumentRangeFormattingEdits(t,a,r,o)).catch(A);if(G(m))return await l.computeMoreMinimalEdits(t.uri,m)}}async function le(l,e,t,a,r){const o=Z(e.documentFormattingEditProvider,e.documentRangeFormattingEditProvider,t);for(const u of o){const c=await Promise.resolve(u.provideDocumentFormattingEdits(t,a,r)).catch(A);if(G(c))return await l.computeMoreMinimalEdits(t.uri,c)}}function ge(l,e,t,a,r,o,u){const c=e.onTypeFormattingEditProvider.ordered(t);return c.length===0||c[0].autoFormatTriggerCharacters.indexOf(r)<0?Promise.resolve(void 0):Promise.resolve(c[0].provideOnTypeFormattingEdits(t,a,r,o,u)).catch(A).then(m=>l.computeMoreMinimalEdits(t.uri,m))}B.registerCommand("_executeFormatRangeProvider",async function(l,...e){const[t,a,r]=e;K(T.isUri(t)),K(v.isIRange(a));const o=l.get(q),u=l.get(M),c=l.get(x),m=await o.createModelReference(t);try{return ce(u,c,m.object.textEditorModel,v.lift(a),r,W.None)}finally{m.dispose()}});B.registerCommand("_executeFormatDocumentProvider",async function(l,...e){const[t,a]=e;K(T.isUri(t));const r=l.get(q),o=l.get(M),u=l.get(x),c=await r.createModelReference(t);try{return le(o,u,c.object.textEditorModel,a,W.None)}finally{c.dispose()}});B.registerCommand("_executeFormatOnTypeProvider",async function(l,...e){const[t,a,r,o]=e;K(T.isUri(t)),K(Q.isIPosition(a)),K(typeof r=="string");const u=l.get(q),c=l.get(M),m=l.get(x),f=await u.createModelReference(t);try{return ge(c,m,f.object.textEditorModel,Q.lift(a),r,o,W.None)}finally{f.dispose()}});export{P as A,L as F,Y as I,fe as a,D as b,ye as f,ge as g};
