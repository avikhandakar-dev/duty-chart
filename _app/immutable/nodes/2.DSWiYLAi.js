const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/editor.api.XtYpUk0H.js","../chunks/iconRegistry.BJgxFQLY.js","../chunks/editorContextKeys.Cdn_dJhV.js","../assets/iconRegistry.DaOXeWeJ.css","../chunks/stableEditorScroll.DHPB0mmN.js","../chunks/codeEditorWidget.CXeIzSuq.js","../assets/codeEditorWidget.Bg48Qpty.css","../chunks/preload-helper.Q8GAf1eS.js","../chunks/entry.BhqEV8NL.js","../chunks/toolbar.BTiJf7ch.js","../assets/toolbar.CglUw5ev.css","../chunks/editorBrowser.CzkYJKPy.js","../chunks/clipboardService.BTmHAzm-.js","../chunks/format.Bb1_og6G.js","../assets/editor.BcE45i8R.css","../chunks/monaco.contribution.BLSvLrUx.js","../chunks/monaco.contribution.CopFz6KF.js","../chunks/monaco.contribution.2-k9hypo.js","../chunks/monaco.contribution.Bc7meUci.js","../chunks/suggestController.TAqXY2ko.js","../chunks/resizable.CSJhciM7.js","../assets/resizable.BfBUCCsp.css","../assets/suggestController.ChoziUlt.css","../chunks/parameterHints.StIp-S_A.js","../assets/parameterHints.BBE0dURY.css","../chunks/hoverContribution.CisGEAg6.js","../assets/hoverContribution.NSOZYWNZ.css","../chunks/formatActions.BuL_rer4.js"])))=>i.map(i=>d[i]);
var oC=Object.defineProperty;var iC=Object.getPrototypeOf;var rC=Reflect.get;var x6=n=>{throw TypeError(n)};var aC=(n,e,t)=>e in n?oC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var $e=(n,e,t)=>aC(n,typeof e!="symbol"?e+"":e,t),w6=(n,e,t)=>e.has(n)||x6("Cannot "+t);var Tm=(n,e,t)=>(w6(n,e,"read from private field"),t?t.call(n):e.get(n)),I1=(n,e,t)=>e.has(n)?x6("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);var nb=(n,e,t)=>(w6(n,e,"access private method"),t);var k6=(n,e,t)=>rC(iC(n),t,e);import{r as Bx,v as lC,w as S6,x as cC,y as I2,e as Yn,a as Y,z as ta,b as tt,l as Tp,s as tm,A as ld,t as Me,c as vl,B as Fc,n as n3,C as W2,D as s3,f as G0,E as uC,p as o3}from"../chunks/stores.Cki5QxNM.js";import{v as dC,E as fC,w as pC,F as i3,J as Jg,K as s2,H as r3,Q as Q1,aB as mC,aS as hC,aR as vC,O as Ox,at as a3,as as l3,L as c3,al as gC,P as C6,C as zx,aY as u3,I as _C,G as yC,l as P2,e as Ao,aZ as bC,a_ as xC,a$ as wC,a6 as kC,q as Vx,aC as m_,b0 as SC,b1 as CC,aK as I6,Z as P6,av as IC,ai as PC,m as Fw,aL as d3,B as MC,A as x,aJ as Fm,c as y,f as tn,b2 as Di,r as _,t as Ne,ag as mm,p as Ld,af as vd,ad as vm,ae as j0,i,s as v,a as Ed,j as th,ab as xe,k as At,b3 as M6,a2 as sv,aI as cd,b as wr,b4 as hp,b5 as sb,aa as o2,b6 as f0,y as T_,b7 as NC,aH as I0,a5 as AC}from"../chunks/entry.BhqEV8NL.js";import{b as f3,l as lo,p as pi,i as Ye,a as V,c as gm,s as oh}from"../chunks/runtime.BDGY6N_C.js";import{i as _v}from"../chunks/lifecycle.VBqE1jgE.js";import{s as Dt,t as rr,e as Ro,i as fi,r as mn,h as Fi,j as Hf,l as ey,f as TC,m as a_,b as Lm,n as N6,o as Av,p as p3,A as FC,k as LC,q as EC}from"../chunks/alert.DgiSeHm2.js";import{c as Hh,o as Mh,a as b0,b as ep,_ as Rg}from"../chunks/preload-helper.Q8GAf1eS.js";const $C=[];function p0(n,e=!1){return Db(n,new Map,"",$C)}function Db(n,e,t,s,o=null){if(typeof n=="object"&&n!==null){const a=e.get(n);if(a!==void 0)return a;if(n instanceof Map)return new Map(n);if(n instanceof Set)return new Set(n);if(dC(n)){const l=[];e.set(n,l),o!==null&&e.set(o,l);for(let c=0;c<n.length;c+=1)l.push(Db(n[c],e,t,s));return l}if(fC(n)===pC){const l={};e.set(n,l),o!==null&&e.set(o,l);for(var r in n)l[r]=Db(n[r],e,t,s);return l}if(n instanceof Date)return structuredClone(n);if(typeof n.toJSON=="function")return Db(n.toJSON(),e,t,s,n)}if(n instanceof EventTarget)return n;try{return structuredClone(n)}catch{return n}}function DC(n,e,t,s,o){var r=n,a="",l;i3(()=>{if(a===(a=e()??"")){Jg&&s2();return}l!==void 0&&(l3(l),l=void 0),a!==""&&(l=r3(()=>{if(Jg){Q1.data;for(var c=s2(),f=c;c!==null&&(c.nodeType!==8||c.data!=="");)f=c,c=mC(c);if(c===null)throw hC(),vC;Bx(Q1,f),r=Ox(c);return}var u=a+"",d=lC(u);Bx(a3(d),d.lastChild),r.before(d)}))})}function RC(n,e,t,s,o,r){let a=Jg;Jg&&s2();var l,c,f=null;Jg&&Q1.nodeType===1&&(f=Q1,s2());var u=Jg?Q1:n,d;i3(()=>{const h=e()||null;var m=u3;h!==l&&(d&&(h===null?_C(d,()=>{d=null,c=null}):h===c?yC(d):(l3(d),S6(!1))),h&&h!==c&&(d=r3(()=>{if(f=Jg?f:document.createElementNS(m,h),Bx(f,f),s){var g=Jg?a3(f):f.appendChild(gC());Jg&&(g===null?C6(!1):Ox(g)),s(f,g)}zx.nodes_end=f,u.before(f)})),l=h,l&&(c=l),S6(!0))},c3),a&&(C6(!0),Ox(u))}function A6(n,e,t){P2(()=>{var s=Ao(()=>e(n,t==null?void 0:t())||{});if(s!=null&&s.destroy)return()=>s.destroy()})}const jC=()=>performance.now(),Z0={tick:n=>requestAnimationFrame(n),now:()=>jC(),tasks:new Set};function m3(n){Z0.tasks.forEach(e=>{e.c(n)||(Z0.tasks.delete(e),e.f())}),Z0.tasks.size!==0&&Z0.tick(m3)}function BC(n){let e;return Z0.tasks.size===0&&Z0.tick(m3),{promise:new Promise(t=>{Z0.tasks.add(e={c:n,f:t})}),abort(){Z0.tasks.delete(e)}}}function ob(n,e){n.dispatchEvent(new CustomEvent(e))}function OC(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function T6(n){const e={},t=n.split(";");for(const s of t){const[o,r]=s.split(":");if(!o||r===void 0)break;const a=OC(o.trim());e[a]=r.trim()}return e}const zC=n=>n;function xg(n,e,t,s){var o=(n&wC)!==0,r=(n&SC)!==0,a=o&&r,l=(n&CC)!==0,c=a?"both":o?"in":"out",f,u=e.inert,d,h;function m(){var P=IC,T=zx;I6(null),P6(null);try{return f??(f=t()(e,(s==null?void 0:s())??{},{direction:c}))}finally{I6(P),P6(T)}}var g={is_global:l,in(){var P;if(e.inert=u,!o){h==null||h.abort(),(P=h==null?void 0:h.reset)==null||P.call(h);return}r||d==null||d.abort(),ob(e,"introstart"),d=Wx(e,m(),h,1,()=>{ob(e,"introend"),d==null||d.abort(),d=f=void 0})},out(P){if(!r){P==null||P(),f=void 0;return}e.inert=!0,ob(e,"outrostart"),h=Wx(e,m(),d,0,()=>{ob(e,"outroend"),P==null||P()})},stop:()=>{d==null||d.abort(),h==null||h.abort()}},w=zx;if((w.transitions??(w.transitions=[])).push(g),o&&cC){var C=l;if(!C){for(var M=w.parent;M&&M.f&c3;)for(;(M=M.parent)&&!(M.f&bC););C=!M||(M.f&xC)!==0}C&&P2(()=>{Ao(()=>g.in())})}}function Wx(n,e,t,s,o){var r=s===1;if(kC(e)){var a,l=!1;return Vx(()=>{if(!l){var C=e({direction:r?"in":"out"});a=Wx(n,C,t,s,o)}}),{abort:()=>{l=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return o(),{abort:m_,deactivate:m_,reset:m_,t:()=>s};const{delay:c=0,css:f,tick:u,easing:d=zC}=e;var h=[];if(r&&t===void 0&&(u&&u(0,1),f)){var m=T6(f(0,1));h.push(m,m)}var g=()=>1-s,w=n.animate(h,{duration:c});return w.onfinish=()=>{var C=(t==null?void 0:t.t())??1-s;t==null||t.abort();var M=s-C,P=e.duration*Math.abs(M),T=[];if(P>0){if(f)for(var N=Math.ceil(P/16.666666666666668),L=0;L<=N;L+=1){var O=C+M*d(L/N),D=f(O,1-O);T.push(T6(D))}g=()=>{var $=w.currentTime;return C+M*d($/P)},u&&BC(()=>{if(w.playState!=="running")return!1;var $=g();return u($,1-$),!0})}w=n.animate(T,{duration:P,fill:"forwards"}),w.onfinish=()=>{g=()=>s,u==null||u(s,1-s),o()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=m_)},deactivate:()=>{o=m_},reset:()=>{s===0&&(u==null||u(1,0))},t:()=>g()}}function As(n,e,t=e){var s=PC();I2(n,"input",()=>{var o=q2(n)?U2(n.value):n.value;t(o),s&&o!==(o=e())&&(n.value=o??"")}),Fw(()=>{var o=e();if(Jg&&n.defaultValue!==n.value){t(q2(n)?U2(n.value):n.value);return}q2(n)&&o===U2(n.value)||n.type==="date"&&!o&&!n.value||o!==n.value&&(n.value=o??"")})}const H2=new Set;function VC(n,e,t,s,o=s){var r=t.getAttribute("type")==="checkbox",a=n;let l=!1;if(e!==null)for(var c of e)a=a[c]??(a[c]=[]);a.push(t),I2(t,"change",()=>{var f=t.__value;r&&(f=F6(a,f,t.checked)),o(f)},()=>o(r?[]:null)),Fw(()=>{var f=s();if(Jg&&t.defaultChecked!==t.checked){l=!0;return}r?(f=f||[],t.checked=f.includes(t.__value)):t.checked=f3(t.__value,f)}),d3(()=>{var f=a.indexOf(t);f!==-1&&a.splice(f,1)}),H2.has(a)||(H2.add(a),Vx(()=>{a.sort((f,u)=>f.compareDocumentPosition(u)===4?-1:1),H2.delete(a)})),Vx(()=>{if(l){var f;if(r)f=F6(a,f,t.checked);else{var u=a.find(d=>d.checked);f=u==null?void 0:u.__value}o(f)}})}function jg(n,e,t=e){I2(n,"change",()=>{var s=n.checked;t(s)}),e()==null&&t(!1),Fw(()=>{var s=e();n.checked=!!s})}function F6(n,e,t){for(var s=new Set,o=0;o<n.length;o+=1)n[o].checked&&s.add(n[o].__value);return t||s.delete(e),Array.from(s)}function q2(n){var e=n.type;return e==="number"||e==="range"}function U2(n){return n===""?null:+n}function L6(n,e,t){var s=MC(n,e);s&&s.set&&(n[e]=t,d3(()=>{n[e]=null}))}function _0(n,e,t){if(n.multiple)return WC(n,e);for(var s of n.options){var o=ty(s);if(f3(o,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function e_(n,e){let t=!0;P2(()=>{e&&_0(n,Ao(e),t),t=!1;var s=new MutationObserver(()=>{var o=n.__value;_0(n,o)});return s.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{s.disconnect()}})}function po(n,e,t=e){var s=!0;I2(n,"change",()=>{var o;if(n.multiple)o=[].map.call(n.querySelectorAll(":checked"),ty);else{var r=n.querySelector(":checked");o=r&&ty(r)}t(o)}),P2(()=>{var o=e();if(_0(n,o,s),s&&o===void 0){var r=n.querySelector(":checked");r!==null&&(o=ty(r),t(o))}n.__value=o,s=!1}),e_(n)}function WC(n,e){for(var t of n.options)t.selected=~e.indexOf(ty(t))}function ty(n){return"__value"in n?n.__value:n.value}function P1(n){x(n,n.v+1)}const G_={},ib={},Rb={},jb={};function HC(n){if(n)return G_[n]}function qC(n){const e=jb[n];!e||e.size===0||e.forEach(t=>{try{t()}catch{}})}async function UC(n,e=2){if(G_[n])return G_[n];if(ib[n])return ib[n];Rb[n]="loading";const t=new Promise((s,o)=>{let r=0;const a=()=>{const l=new Image;l.crossOrigin="anonymous";try{l.referrerPolicy="no-referrer"}catch{}const c=async()=>{var u;try{await((u=l.decode)==null?void 0:u.call(l))}catch{}G_[n]=l,Rb[n]="loaded",qC(n),s(l)},f=()=>{if(r+=1,r<=e){const u=Math.min(500*r,1500);setTimeout(a,u)}else Rb[n]="error",o(new Error("load error"))};l.onload=c,l.onerror=f,l.src=n};a()});ib[n]=t;try{return await t}finally{delete ib[n]}}function Hx(n){if(n&&!(G_[n]||Rb[n]==="loading"))try{UC(n)}catch{}}function GC(n,e){if(jb[n]||(jb[n]=new Set),jb[n].add(e),G_[n])try{e()}catch{}}function h3(n){n&&(Hx(n.logo),Hx(n.logo2))}function nh(n,e){if(!(!wg(n)&&!wg(e))){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const s=n[t],o=e[t];wg(o)&&wg(s)?nh(s,o):Os(e[t])&&(n[t]=Q_(e[t]))}}}function Q_(n){if(!wg(n))return n;let e=null;e0(n)?e=[]:e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];wg(s)?e[t]=Q_(s):e[t]=s}return e}function e0(n){return Object.prototype.toString.call(n)==="[object Array]"}function ng(n){return typeof n=="function"}function wg(n){return typeof n=="object"&&Os(n)}function nl(n){return typeof n=="number"&&Number.isFinite(n)}function Os(n){return n!=null}function dy(n){return typeof n=="boolean"}function pf(n){return typeof n=="string"}const YC=/\\(\\)?/g,KC=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function Ph(n,e,t){if(Os(n)){const s=[];e.replace(KC,(l,...c)=>{let f=l;return Os(c[1])?f=c[2].replace(YC,"$1"):Os(c[0])&&(f=c[0].trim()),s.push(f),""});let o=n,r=0;const a=s.length;for(;Os(o)&&r<a;)o=o==null?void 0:o[s[r++]];return Os(o)?o:t??"--"}return t??"--"}function v3(n,e){const t={};return n.formatToParts(new Date(e)).forEach(({type:s,value:o})=>{switch(s){case"year":{t.YYYY=o;break}case"month":{t.MM=o;break}case"day":{t.DD=o;break}case"hour":{t.HH=o==="24"?"00":o;break}case"minute":{t.mm=o;break}case"second":{t.ss=o;break}}}),t}function g3(n,e,t){const s=v3(n,e);return t.replace(/YYYY|MM|DD|HH|mm|ss/g,o=>s[o])}function tv(n,e){const t=+n;return nl(t)?t.toFixed(e??2):`${n}`}function _3(n){const e=+n;if(nl(e)){if(e>1e9)return`${+(e/1e9).toFixed(3)}B`;if(e>1e6)return`${+(e/1e6).toFixed(3)}M`;if(e>1e3)return`${+(e/1e3).toFixed(3)}K`}return`${n}`}function y3(n,e){const t=`${n}`;if(e.length===0)return t;if(t.includes(".")){const s=t.split(".");return`${s[0].replace(/(\d)(?=(\d{3})+$)/g,o=>`${o}${e}`)}.${s[1]}`}return t.replace(/(\d)(?=(\d{3})+$)/g,s=>`${s}${e}`)}function b3(n,e){const t=`${n}`;if(new RegExp("\\.0{"+e+",}[1-9][0-9]*$").test(t)){const o=t.split("."),r=o.length-1,a=o[r],l=/0*/.exec(a);if(Os(l)){const c=l[0].length;return o[r]=a.replace(/0*/,`0{${c}}`),o.join(".")}}return t}function E6(n,e){return n.replace(/\{(\w+)\}/g,(t,s)=>{const o=e[s];return Os(o)?o:`{${s}}`})}let M1=null;function t_(n){var e;return((e=n.ownerDocument.defaultView)==null?void 0:e.devicePixelRatio)??1}function E0(n,e,t){return`${e??"normal"} ${n??12}px ${t??"Helvetica Neue"}`}function sh(n,e,t,s){if(!Os(M1)){const o=document.createElement("canvas"),r=t_(o);M1=o.getContext("2d"),M1.scale(r,r)}return M1.font=E0(e,t,s),Math.round(M1.measureText(n).width)}function i2(n){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return Os(n)&&nh(e,n),e}var Ef=(n=>(n[n.Main=0]="Main",n[n.Overlay=1]="Overlay",n[n.Separator=2]="Separator",n[n.Drawer=3]="Drawer",n[n.All=4]="All",n))(Ef||{});const G2=-1;function n_(n){return ng(window.requestAnimationFrame)?window.requestAnimationFrame(n):window.setTimeout(n,20)}function Y2(n){ng(window.cancelAnimationFrame)?window.cancelAnimationFrame(n):window.clearTimeout(n)}class qx{constructor(e){$e(this,"_options",{duration:500,iterationCount:1});$e(this,"_doFrameCallback");$e(this,"_currentIterationCount",0);$e(this,"_running",!1);$e(this,"_time",0);nh(this._options,e)}_loop(){this._running=!0;const e=()=>{var t;if(this._running){const s=new Date().getTime()-this._time;s<this._options.duration?((t=this._doFrameCallback)==null||t.call(this,s),n_(e)):(this.stop(),this._currentIterationCount++,this._currentIterationCount<this._options.iterationCount&&this.start())}};n_(e)}doFrame(e){return this._doFrameCallback=e,this}setDuration(e){return this._options.duration=e,this}setIterationCount(e){return this._options.iterationCount=e,this}start(){this._running||(this._time=new Date().getTime(),this._loop())}stop(){var e;this._running&&((e=this._doFrameCallback)==null||e.call(this,this._options.duration)),this._running=!1}}let K2=1,$6=new Date().getTime();function q1(n){const e=new Date().getTime();return e===$6?++K2:K2=1,$6=e,`${n??""}${e}_${K2}`}function R0(n,e){const t=document.createElement(n),s=e??{};for(const o in s)t.style[o]=s[o]??"";return t}function Ux(n,e,t){let s=0,o=0;for(o=n.length-1;s!==o;){const r=Math.floor((o+s)/2),a=o-s,l=n[r][e];if(t===n[s][e])return s;if(t===n[o][e])return o;if(t===l)return r;if(t>l?s=r:o=r,a<=2)break}return s}function D6(n,e){e=Math.max(0,e??0);const t=Math.pow(10,e);return Math.round(n*t)/t}function XC(n){const e=n.toString(),t=e.indexOf("e");if(t>0){const o=+e.slice(t+1);return o<0?-o:0}const s=e.indexOf(".");return s<0?0:e.length-1-s}function x3(n,e,t){const s=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],o=n.length;let r=0;for(;r<o;){const a=n[r];s[0]=Math.max(a[e]??Number.MIN_SAFE_INTEGER,s[0]),s[1]=Math.min(a[t]??Number.MAX_SAFE_INTEGER,s[1]),++r}return s}function H0(n){return n===0?0:Math.log10(n)}function j_(n){return Math.pow(10,n)}function R6(){return{from:0,to:0,realFrom:0,realTo:0}}function j6(...n){return n.join("_")}const ZC=5;class JC{constructor(e){$e(this,"_limit");$e(this,"_running",0);$e(this,"_queue",[]);$e(this,"_taskMap",new Map);this._limit=e??ZC}async add(e){return await new Promise((t,s)=>{const{id:o,handler:r}=e,a=()=>{this._running++,r().then(c=>{t(c)}).catch(()=>{s("failed")}).finally(()=>{this._running--,this._taskMap.delete(o),this._next()})},l=this._taskMap.get(o);if(Os(l)){l.reject("canceled");const c=this._queue.indexOf(l.run);c>-1&&this._queue.splice(c,1)}this._taskMap.set(o,{run:a,reject:s}),this._queue.push(a),this._next()})}_next(){for(;this._running<this._limit&&this._queue.length>0;){const e=this._queue.shift();e==null||e()}}remove(e){const t=this._taskMap.get(e);if(Os(t)){this._taskMap.delete(e);const s=this._queue.indexOf(t.run);s>-1&&this._queue.splice(s,1),t.reject("canceled")}}clear(){for(const[,{reject:e}]of this._taskMap)e("canceled");this._taskMap.clear(),this._queue=[]}}const Wh={PRICE:2,VOLUME:0};class QC{constructor(){$e(this,"_callbacks",[])}subscribe(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)}unsubscribe(e){if(ng(e)){const t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}else this._callbacks=[]}execute(e){this._callbacks.forEach(t=>{t(e)})}isEmpty(){return this._callbacks.length===0}}function i_(n){return n==="transparent"||n==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(n)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(n)}function $0(n,e){const t=n.replace(/^#/,""),s=parseInt(t,16),o=s>>16&255,r=s>>8&255,a=s&255;return`rgba(${o}, ${r}, ${a}, ${e??1})`}function X2(n){return Number.isNaN(n)?0:Math.max(0,Math.min(255,n))}function e9(n){const e=n.replace(/^#/,"").trim();if(![3,4,6,8].includes(e.length))return null;const t=e.length<=4?e.split("").map(r=>`${r}${r}`).join(""):e,s=t.length===8?t:`${t}ff`,o=Number.parseInt(s,16);return Number.isFinite(o)?{r:o>>>24&255,g:o>>>16&255,b:o>>>8&255,a:(o&255)/255}:null}function t9(n){const e=n.trim().match(/^rgba?\(([^)]+)\)$/i);if(!e)return null;const t=e[1].split(",").map(l=>l.trim());if(t.length<3)return null;const s=X2(Number(t[0])),o=X2(Number(t[1])),r=X2(Number(t[2])),a=t.length>=4&&t[3]!==""?Math.max(0,Math.min(1,Number(t[3]))):1;return{r:s,g:o,b:r,a}}function n9(n){return n?n.startsWith("#")?e9(n):n.toLowerCase().startsWith("rgb")?t9(n):null:null}function J0(n,e,{light:t="#FFFFFF",dark:s="#111111",threshold:o=.6}={}){if(!n||i_(n))return e;const r=n9(n);return!r||r.a===0?e:(.2126*r.r+.7152*r.g+.0722*r.b)/255>o?s:t}const jc={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function s9(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}}}function o9(){const n={show:!0,color:jc.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:"candle_solid",bar:{compareRule:"current_open",upColor:jc.GREEN,downColor:jc.RED,noChangeColor:jc.GREY,upBorderColor:jc.GREEN,downBorderColor:jc.RED,noChangeBorderColor:jc.GREY,upWickColor:jc.GREEN,downWickColor:jc.RED,noChangeWickColor:jc.GREY},area:{lineSize:2,lineColor:jc.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:$0(jc.BLUE,.01)},{offset:1,color:$0(jc.BLUE,.2)}],point:{show:!0,color:jc.BLUE,radius:4,rippleColor:$0(jc.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:{...n},low:{...n},last:{show:!0,compareRule:"current_open",upColor:jc.GREEN,downColor:jc.RED,noChangeColor:jc.GREY,line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:jc.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2},extendTexts:[]}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",rect:{position:"fixed",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},title:{show:!0,size:14,family:"Helvetica Neue",weight:"normal",color:jc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,template:"{ticker} · {period}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:jc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:[{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]},features:[]}}}function i9(){const n=$0(jc.GREEN,.7),e=$0(jc.RED,.7);return{ohlc:{compareRule:"current_open",upColor:n,downColor:e,noChangeColor:jc.GREY},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:n,downColor:e,noChangeColor:jc.GREY}],lines:["#FF9600","#935EBD",jc.BLUE,"#E11D74","#01C5C4"].map(t=>({style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:t})),circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:n,downColor:e,noChangeColor:jc.GREY}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:jc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",title:{show:!0,showName:!0,showParams:!0,size:12,family:"Helvetica Neue",weight:"normal",color:jc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:jc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a"},features:[]}}}function B6(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:jc.GREY,size:14,family:'"IBM Plex Sans", "Helvetica Neue", Arial, sans-serif',weight:"normal",marginStart:4,marginEnd:6},ticduty:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function r9(){return{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:jc.GREY},text:{show:!0,style:"fill",color:jc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:jc.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:jc.GREY},features:[]},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:jc.GREY},text:{show:!0,style:"fill",color:jc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:jc.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:jc.GREY}}}}function a9(){const n=$0(jc.BLUE,.35),e=$0(jc.BLUE,.25);function t(){return{style:"fill",color:jc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:jc.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:jc.BLUE}}return{point:{color:jc.BLUE,borderColor:n,borderSize:1,radius:5,activeColor:jc.BLUE,activeBorderColor:n,activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:jc.BLUE,size:1,dashedValue:[2,2]},rect:{style:"fill",color:e,borderColor:jc.BLUE,borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:jc.BLUE,borderColor:jc.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:e,borderColor:jc.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:jc.BLUE,size:1,dashedValue:[2,2]},text:t()}}function l9(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:$0(jc.BLUE,.08)}}function c9(){const n=B6(),e=B6();return e.tickText.family="sans-serif",e.tickText.size=12,e.tickText.weight="normal",e.tickText.color="#6b7280",e.tickText.weight="normal",{grid:s9(),candle:o9(),indicator:i9(),xAxis:n,yAxis:e,separator:l9(),crosshair:r9(),overlay:a9()}}function Lw(n,e,t,s){const o=n.result,r=n.figures,a=n.styles,l=Ph(a,"circles",t.circles),c=l.length,f=Ph(a,"bars",t.bars),u=f.length,d=Ph(a,"lines",t.lines),h=d.length;let m=0,g=0,w=0,C,M=0;r.forEach(P=>{var T;switch(P.type){case"circle":{M=m;const N=l[m%c];C={...N,color:N.noChangeColor},m++;break}case"bar":{M=g;const N=f[g%u];C={...N,color:N.noChangeColor},g++;break}case"line":{M=w,C=d[w%h],w++;break}}if(Os(P.type)){const N=(T=P.styles)==null?void 0:T.call(P,{data:{prev:o[e.prev??""],current:o[e.current??""],next:o[e.next??""]},indicator:n,defaultStyles:t});s(P,{...C,...N},M)}})}class M2{constructor(e){$e(this,"id");$e(this,"paneId");$e(this,"name");$e(this,"shortName");$e(this,"precision",4);$e(this,"calcParams",[]);$e(this,"shouldOhlc",!1);$e(this,"shouldFormatBigNumber",!1);$e(this,"visible",!0);$e(this,"zLevel",-10);$e(this,"extendData");$e(this,"series","normal");$e(this,"figures",[]);$e(this,"minValue",null);$e(this,"maxValue",null);$e(this,"styles",null);$e(this,"shouldUpdate",(e,t)=>{const s=JSON.stringify(e.calcParams)!==JSON.stringify(t.calcParams)||e.figures!==t.figures||e.calc!==t.calc,o=s||e.shortName!==t.shortName||e.series!==t.series||e.minValue!==t.minValue||e.maxValue!==t.maxValue||e.precision!==t.precision||e.shouldOhlc!==t.shouldOhlc||e.shouldFormatBigNumber!==t.shouldFormatBigNumber||e.visible!==t.visible||e.zLevel!==t.zLevel||e.extendData!==t.extendData||e.regenerateFigures!==t.regenerateFigures||e.createTooltipDataSource!==t.createTooltipDataSource||e.draw!==t.draw;return{calc:s,draw:o}});$e(this,"calc",()=>({}));$e(this,"regenerateFigures",null);$e(this,"createTooltipDataSource",null);$e(this,"draw",null);$e(this,"onDataStateChange",null);$e(this,"result",{});$e(this,"_prevIndicator");$e(this,"_lockSeriesPrecision",!1);this.override(e),this._lockSeriesPrecision=!1}override(e){const{result:t,...s}=this;this._prevIndicator={...Q_(s),result:t};const{id:o,name:r,shortName:a,precision:l,styles:c,figures:f,calcParams:u,...d}=e;!pf(this.id)&&pf(o)&&(this.id=o),pf(this.name)||(this.name=r??""),this.shortName=a??this.shortName??this.name,nl(l)&&(this.precision=l,this._lockSeriesPrecision=!0),Os(c)&&(this.styles??(this.styles={}),nh(this.styles,c)),nh(this,d),Os(u)&&(this.calcParams=u,ng(this.regenerateFigures)&&(this.figures=this.regenerateFigures(this.calcParams))),this.figures=f??this.figures}setSeriesPrecision(e){this._lockSeriesPrecision||(this.precision=e)}shouldUpdateImp(){const e=this._prevIndicator.zLevel!==this.zLevel,t=this.shouldUpdate(this._prevIndicator,this);return dy(t)?{calc:t,draw:t,sort:e}:{...t,sort:e}}async calcImp(e){try{const t=await this.calc(e,this);return this.result=t,!0}catch{return!1}}static extend(e){class t extends M2{constructor(){super(e)}}return t}}const u9={name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:n=>{let e=0,t=0;return n.reduce((s,o)=>{const r={},a=o.turnover??0,l=o.volume??0;return e+=a,t+=l,t!==0&&(r.avp=e/t),s[o.timestamp]=r,s},{})}},d9={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const{prev:s,current:o}=n,r=(s==null?void 0:s.ao)??Number.MIN_SAFE_INTEGER,a=(o==null?void 0:o.ao)??Number.MIN_SAFE_INTEGER;let l="";a>r?l=Ph(e.styles,"bars[0].upColor",t.bars[0].upColor):l=Ph(e.styles,"bars[0].downColor",t.bars[0].downColor);const c=a>r?"stroke":"fill";return{color:l,style:c,borderColor:l}}}],calc:(n,e)=>{const t=e.calcParams,s=Math.max(t[0],t[1]);let o=0,r=0,a=0,l=0;return n.reduce((c,f,u)=>{const d={},h=(f.low+f.high)/2;if(o+=h,r+=h,u>=t[0]-1){a=o/t[0];const m=n[u-(t[0]-1)];o-=(m.low+m.high)/2}if(u>=t[1]-1){l=r/t[1];const m=n[u-(t[1]-1)];r-=(m.low+m.high)/2}return u>=s-1&&(d.ao=a-l),c[f.timestamp]=d,c},{})}},f9={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`bias${t+1}`,title:`BIAS${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[];return n.reduce((r,a,l)=>{const c={},f=a.close;return t.forEach((u,d)=>{if(o[d]=(o[d]??0)+f,l>=u-1){const h=o[d]/t[d];c[s[d].key]=(f-h)/h*100,o[d]-=n[l-(u-1)].close}}),r[a.timestamp]=c,r},{})}};function p9(n,e){const t=n.length;let s=0;return n.forEach(o=>{const r=o.close-e;s+=r*r}),s=Math.abs(s),Math.sqrt(s/t)}const m9={name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=t[0]-1;let o=0;return n.reduce((r,a,l)=>{const c=a.close,f={};if(o+=c,l>=s){f.mid=o/t[0];const u=p9(n.slice(l-s,l+1),f.mid);f.up=f.mid+t[1]*u,f.dn=f.mid-t[1]*u,o-=n[l-s].close}return r[a.timestamp]=f,r},{})}},h9={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0;return n.reduce((l,c,f)=>{const u={},d=c.high,h=c.low,m=c.open,g=(n[f-1]??c).close;if(r+=d-m,a+=m-h,s+=d-g,o+=g-h,f>=t[0]-1){a!==0?u.ar=r/a*100:u.ar=0,o!==0?u.br=s/o*100:u.br=0;const w=n[f-(t[0]-1)],C=w.high,M=w.low,P=w.open,T=(n[f-t[0]]??n[f-(t[0]-1)]).close;s-=C-T,o-=T-M,r-=C-P,a-=P-M}return l[c.timestamp]=u,l},{})}},v9={name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=Math.max(...t),o=[],r=[];return n.reduce((a,l,c)=>{const f={},u=l.close;if(t.forEach((d,h)=>{o[h]=(o[h]??0)+u,c>=d-1&&(r[h]=o[h]/d,o[h]-=n[c-(d-1)].close)}),c>=s-1){let d=0;r.forEach(h=>{d+=h}),f.bbi=d/4}return a[l.timestamp]=f,a},{})}},g9={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=t[0]-1;let o=0;const r=[];return n.reduce((a,l,c)=>{const f={},u=(l.high+l.low+l.close)/3;if(o+=u,r.push(u),c>=s){const d=o/t[0],h=r.slice(c-s,c+1);let m=0;h.forEach(C=>{m+=Math.abs(C-d)});const g=m/t[0];f.cci=g!==0?(u-d)/g/.015:0;const w=(n[c-s].high+n[c-s].low+n[c-s].close)/3;o-=w}return a[l.timestamp]=f,a},{})}},_9={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=Math.ceil(t[1]/2.5+1),o=Math.ceil(t[2]/2.5+1),r=Math.ceil(t[3]/2.5+1),a=Math.ceil(t[4]/2.5+1);let l=0;const c=[];let f=0;const u=[];let d=0;const h=[];let m=0;const g=[],w=[],C={};return n.forEach((M,P)=>{const T={},N=n[P-1]??M,L=(N.high+N.close+N.low+N.open)/4,O=Math.max(0,M.high-L),D=Math.max(0,L-M.low);P>=t[0]-1&&(D!==0?T.cr=O/D*100:T.cr=0,l+=T.cr,f+=T.cr,d+=T.cr,m+=T.cr,P>=t[0]+t[1]-2&&(c.push(l/t[1]),P>=t[0]+t[1]+s-3&&(T.ma1=c[c.length-1-s]),l-=w[P-(t[1]-1)].cr??0),P>=t[0]+t[2]-2&&(u.push(f/t[2]),P>=t[0]+t[2]+o-3&&(T.ma2=u[u.length-1-o]),f-=w[P-(t[2]-1)].cr??0),P>=t[0]+t[3]-2&&(h.push(d/t[3]),P>=t[0]+t[3]+r-3&&(T.ma3=h[h.length-1-r]),d-=w[P-(t[3]-1)].cr??0),P>=t[0]+t[4]-2&&(g.push(m/t[4]),P>=t[0]+t[4]+a-3&&(T.ma4=g[g.length-1-a]),m-=w[P-(t[4]-1)].cr??0)),w.push(T),C[M.timestamp]=T}),C}},y9={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=Math.max(t[0],t[1]);let o=0,r=0,a=0;const l=[],c={};return n.forEach((f,u)=>{const d={},h=f.close;o+=h,r+=h;let m=0,g=0;if(u>=t[0]-1&&(m=o/t[0],o-=n[u-(t[0]-1)].close),u>=t[1]-1&&(g=r/t[1],r-=n[u-(t[1]-1)].close),u>=s-1){const w=m-g;d.dma=w,a+=w,u>=s+t[2]-2&&(d.ama=a/t[2],a-=l[u-(t[2]-1)].dma??0)}l.push(d),c[f.timestamp]=d}),c}},b9={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0,l=0,c=0,f=0,u=0;const d=[],h={};return n.forEach((m,g)=>{const w={},C=n[g-1]??m,M=C.close,P=m.high,T=m.low,N=P-T,L=Math.abs(P-M),O=Math.abs(M-T),D=P-C.high,$=C.low-T,z=Math.max(Math.max(N,L),O),te=D>0&&D>$?D:0,pe=$>0&&$>D?$:0;if(s+=z,o+=te,r+=pe,g>=t[0]-1){g>t[0]-1?(a=a-a/t[0]+z,l=l-l/t[0]+te,c=c-c/t[0]+pe):(a=s,l=o,c=r);let J=0,le=0;a!==0&&(J=l*100/a,le=c*100/a),w.pdi=J,w.mdi=le;let de=0;le+J!==0&&(de=Math.abs(le-J)/(le+J)*100),f+=de,g>=t[0]*2-2&&(g>t[0]*2-2?u=(u*(t[0]-1)+de)/t[0]:u=f/t[0],w.adx=u,g>=t[0]*2+t[1]-3&&(w.adxr=((d[g-(t[1]-1)].adx??0)+u)/2))}d.push(w),h[m.timestamp]=w}),h}},x9={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0;const o=[];return n.reduce((r,a,l)=>{const c={};if(l>0){const f=n[l-1],u=a.high,d=a.low,h=a.volume??0,m=(u+d)/2-(f.high+f.low)/2;if(h===0||u-d===0)c.emv=0;else{const g=h/1e8/(u-d);c.emv=m/g}s+=c.emv,o.push(c.emv),l>=t[0]&&(c.maEmv=s/t[0],s-=o[l-t[0]])}return r[a.timestamp]=c,r},{})}},w9={name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`ema${t+1}`,title:`EMA${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e;let o=0;const r=[];return n.reduce((a,l,c)=>{const f={},u=l.close;return o+=u,t.forEach((d,h)=>{c>=d-1&&(c>d-1?r[h]=(2*u+(d-1)*r[h])/(d+1):r[h]=o/d,f[s[h].key]=r[h])}),a[l.timestamp]=f,a},{})}},k9={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0;const o=[],r={};return n.forEach((a,l)=>{const c={};if(l>=t[0]){const f=a.close,u=n[l-t[0]].close;c.mtm=f-u,s+=c.mtm,l>=t[0]+t[1]-1&&(c.maMtm=s/t[1],s-=o[l-(t[1]-1)].mtm??0)}o.push(c),r[a.timestamp]=c}),r}},S9={name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA30: ",type:"line"},{key:"ma4",title:"MA60: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`ma${t+1}`,title:`MA${e}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[];return n.reduce((r,a,l)=>{const c={},f=a.close;return t.forEach((u,d)=>{o[d]=(o[d]??0)+f,l>=u-1&&(c[s[d].key]=o[d]/u,o[d]-=n[l-(u-1)].close)}),r[a.timestamp]=c,r},{})}},C9={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const{prev:s,current:o}=n,r=(s==null?void 0:s.macd)??Number.MIN_SAFE_INTEGER,a=(o==null?void 0:o.macd)??Number.MIN_SAFE_INTEGER;let l="";return a>0?l=Ph(e.styles,"bars[0].upColor",t.bars[0].upColor):a<0?l=Ph(e.styles,"bars[0].downColor",t.bars[0].downColor):l=Ph(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor),{style:r<a?"stroke":"fill",color:l,borderColor:l}}}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0,l=0,c=0;const f=Math.max(t[0],t[1]);return n.reduce((u,d,h)=>{const m={},g=d.close;return s+=g,h>=t[0]-1&&(h>t[0]-1?o=(2*g+(t[0]-1)*o)/(t[0]+1):o=s/t[0]),h>=t[1]-1&&(h>t[1]-1?r=(2*g+(t[1]-1)*r)/(t[1]+1):r=s/t[1]),h>=f-1&&(a=o-r,m.dif=a,l+=a,h>=f+t[2]-2&&(h>f+t[2]-2?c=(a*2+c*(t[2]-1))/(t[2]+1):c=l/t[2],m.macd=(a-c)*2,m.dea=c)),u[d.timestamp]=m,u},{})}},I9={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0;const r=[],a={};return n.forEach((l,c)=>{const f=n[c-1]??l;l.close<f.close?o-=l.volume??0:l.close>f.close&&(o+=l.volume??0);const u={obv:o};s+=o,c>=t[0]-1&&(u.maObv=s/t[0],s-=r[c-(t[0]-1)].obv??0),r.push(u),a[l.timestamp]=u}),a}},P9={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:n=>{let e=0;return n.reduce((t,s,o)=>{const r={},a=s.close,l=s.volume??1,c=(n[o-1]??s).close;let f=0;const u=c*l;return u!==0&&(f=(a-c)/u),e+=f,r.pvt=e,t[s.timestamp]=r,t},{})}},M9={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0;const r=[],a=[],l={};return n.forEach((c,f)=>{const u={},d=(n[f-1]??c).close,h=c.close-d>0?1:0;r.push(h),s+=h,f>=t[0]-1&&(u.psy=s/t[0]*100,o+=u.psy,f>=t[0]+t[1]-2&&(u.maPsy=o/t[1],o-=a[f-(t[1]-1)].psy??0),s-=r[f-(t[0]-1)]),a.push(u),l[c.timestamp]=u}),l}},N9={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=[],o={};let r=0;return n.forEach((a,l)=>{const c={};if(l>=t[0]-1){const f=a.close,u=(n[l-t[0]]??n[l-(t[0]-1)]).close;u!==0?c.roc=(f-u)/u*100:c.roc=0,r+=c.roc,l>=t[0]-1+t[1]-1&&(c.maRoc=r/t[1],r-=s[l-(t[1]-1)].roc??0)}s.push(c),o[a.timestamp]=c}),o}},A9={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>{const s=t+1;return{key:`rsi${s}`,title:`RSI${s}: `,type:"line"}}),calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[],r=[];return n.reduce((a,l,c)=>{const f={},u=(n[c-1]??l).close,d=l.close-u;return t.forEach((h,m)=>{if(d>0?o[m]=(o[m]??0)+d:r[m]=(r[m]??0)+Math.abs(d),c>=h-1){r[m]!==0?f[s[m].key]=100-100/(1+o[m]/r[m]):f[s[m].key]=0;const g=n[c-(h-1)],w=n[c-h]??g,C=g.close-w.close;C>0?o[m]-=C:r[m]-=Math.abs(C)}}),a[l.timestamp]=f,a},{})}},T9={name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(n,e)=>{const t=e.calcParams;let s=0,o=0;return n.reduce((r,a,l)=>{const c={},f=a.close;return s+=f,l>=t[0]-1&&(l>t[0]-1?o=(f*t[1]+o*(t[0]-t[1]+1))/(t[0]+1):o=s/t[0],c.sma=o),r[a.timestamp]=c,r},{})}},F9={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams,s=[],o={};return n.forEach((r,a)=>{var f,u;const l={},c=r.close;if(a>=t[0]-1){const d=x3(n.slice(a-(t[0]-1),a+1),"high","low"),h=d[0],m=d[1],g=h-m,w=(c-m)/(g===0?1:g)*100;l.k=((t[1]-1)*(((f=s[a-1])==null?void 0:f.k)??50)+w)/t[1],l.d=((t[2]-1)*(((u=s[a-1])==null?void 0:u.d)??50)+l.k)/t[2],l.j=3*l.k-2*l.d}s.push(l),o[r.timestamp]=l}),o}},L9={name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:({data:n,indicator:e,defaultStyles:t})=>{const{current:s}=n,o=(s==null?void 0:s.sar)??Number.MIN_SAFE_INTEGER,r=(((s==null?void 0:s.high)??0)+((s==null?void 0:s.low)??0))/2;return{color:o<r?Ph(e.styles,"circles[0].upColor",t.circles[0].upColor):Ph(e.styles,"circles[0].downColor",t.circles[0].downColor)}}}],calc:(n,e)=>{const t=e.calcParams,s=t[0]/100,o=t[1]/100,r=t[2]/100;let a=s,l=-100,c=!1,f=0;return n.reduce((u,d,h)=>{const m=f,g=d.high,w=d.low;if(c){(l===-100||l<g)&&(l=g,a=Math.min(a+o,r)),f=m+a*(l-m);const C=Math.min(n[Math.max(1,h)-1].low,w);f>d.low?(f=l,a=s,l=-100,c=!c):f>C&&(f=C)}else{(l===-100||l>w)&&(l=w,a=Math.min(a+o,r)),f=m+a*(l-m);const C=Math.max(n[Math.max(1,h)-1].high,g);f<d.high?(f=l,a=0,l=-100,c=!c):f<C&&(f=C)}return u[d.timestamp]={high:g,low:w,sar:f},u},{})}},E9={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0,l=0,c=0,f=0;const u=[],d={};return n.forEach((h,m)=>{const g={},w=h.close;if(s+=w,m>=t[0]-1&&(m>t[0]-1?o=(2*w+(t[0]-1)*o)/(t[0]+1):o=s/t[0],l+=o,m>=t[0]*2-2&&(m>t[0]*2-2?r=(2*o+(t[0]-1)*r)/(t[0]+1):r=l/t[0],c+=r,m>=t[0]*3-3))){let C=0,M=0;m>t[0]*3-3?(C=(2*r+(t[0]-1)*a)/(t[0]+1),M=(C-a)/a*100):C=c/t[0],a=C,g.trix=M,f+=M,m>=t[0]*3+t[1]-4&&(g.maTrix=f/t[1],f-=u[m-(t[1]-1)].trix??0)}u.push(g),d[h.timestamp]=g}),d}};function O6(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{const s=n.current;let o=Ph(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor);return Os(s)&&(s.close>s.open?o=Ph(e.styles,"bars[0].upColor",t.bars[0].upColor):s.close<s.open&&(o=Ph(e.styles,"bars[0].downColor",t.bars[0].downColor))),{color:o}}}}const $9={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},O6()],regenerateFigures:n=>{const e=n.map((t,s)=>({key:`ma${s+1}`,title:`MA${t}: `,type:"line"}));return e.push(O6()),e},calc:(n,e)=>{const{calcParams:t,figures:s}=e,o=[];return n.reduce((r,a,l)=>{const c=a.volume??0,f={volume:c,open:a.open,close:a.close};return t.forEach((u,d)=>{o[d]=(o[d]??0)+c,l>=u-1&&(f[s[d].key]=o[d]/u,o[d]-=n[l-(u-1)].volume??0)}),r[a.timestamp]=f,r},{})}},D9={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(n,e)=>{const t=e.calcParams;let s=0,o=0,r=0,a=0;const l=[],c={};return n.forEach((f,u)=>{const d={},h=f.close,m=(n[u-1]??f).close,g=f.volume??0;if(h>m?s+=g:h<m?o+=g:r+=g,u>=t[0]-1){const w=r/2;o+w===0?d.vr=0:d.vr=(s+w)/(o+w)*100,a+=d.vr,u>=t[0]+t[1]-2&&(d.maVr=a/t[1],a-=l[u-(t[1]-1)].vr??0);const C=n[u-(t[0]-1)],M=n[u-t[0]]??C,P=C.close,T=C.volume??0;P>M.close?s-=T:P<M.close?o-=T:r-=T}l.push(d),c[f.timestamp]=d}),c}},R9={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:n=>n.map((e,t)=>({key:`wr${t+1}`,title:`WR${t+1}: `,type:"line"})),calc:(n,e)=>{const{calcParams:t,figures:s}=e;return n.reduce((o,r,a)=>{const l={},c=r.close;return t.forEach((f,u)=>{const d=f-1;if(a>=d){const h=x3(n.slice(a-d,a+1),"high","low"),m=h[0],g=h[1],w=m-g;l[s[u].key]=w===0?0:(c-m)/w*100}}),o[r.timestamp]=l,o},{})}},Ew={},j9=[u9,d9,f9,m9,h9,v9,g9,_9,y9,b9,x9,w9,k9,S9,C9,I9,P9,M9,N9,A9,T9,F9,L9,E9,$9,D9,R9];j9.forEach(n=>{Ew[n.name]=M2.extend(n)});function Z2(n){Ew[n.name]=M2.extend(n)}function w3(n){return Ew[n]??null}function Ug(n,e){const t=(e==null?void 0:e.ignoreEvent)??!1;return dy(t)?!t:!t.includes(n)}const z6=1,N1=-1,B9="overlay_",F_="overlay_figure_";class N2{constructor(e){$e(this,"id");$e(this,"groupId","");$e(this,"paneId");$e(this,"name");$e(this,"totalStep",1);$e(this,"currentStep",z6);$e(this,"lock",!1);$e(this,"visible",!0);$e(this,"zLevel",0);$e(this,"needDefaultPointFigure",!1);$e(this,"needDefaultXAxisFigure",!1);$e(this,"needDefaultYAxisFigure",!1);$e(this,"mode","normal");$e(this,"modeSensitivity",8);$e(this,"points",[]);$e(this,"extendData");$e(this,"styles",null);$e(this,"createPointFigures",null);$e(this,"createXAxisFigures",null);$e(this,"createYAxisFigures",null);$e(this,"performEventPressedMove",null);$e(this,"performEventMoveForDrawing",null);$e(this,"onDrawStart",null);$e(this,"onDrawing",null);$e(this,"onDrawEnd",null);$e(this,"onClick",null);$e(this,"onDoubleClick",null);$e(this,"onRightClick",null);$e(this,"onPressedMoveStart",null);$e(this,"onPressedMoving",null);$e(this,"onPressedMoveEnd",null);$e(this,"onMouseMove",null);$e(this,"onMouseEnter",null);$e(this,"onMouseLeave",null);$e(this,"onRemoved",null);$e(this,"onSelected",null);$e(this,"onDeselected",null);$e(this,"_prevZLevel",0);$e(this,"_prevOverlay");$e(this,"_prevPressedPoint",null);$e(this,"_prevPressedPoints",[]);this.override(e)}override(e){var c;this._prevOverlay=Q_(this);const{id:t,name:s,currentStep:o,points:r,styles:a,...l}=e;if(nh(this,l),pf(this.name)||(this.name=s??""),!pf(this.id)&&pf(t)&&(this.id=t),Os(a)&&(this.styles??(this.styles={}),nh(this.styles,a)),e0(r)&&r.length>0){let f=0;if(this.points=[...r],r.length>=this.totalStep-1?(this.currentStep=N1,f=this.totalStep-1):(this.currentStep=r.length+1,f=r.length),ng(this.performEventMoveForDrawing))for(let u=0;u<f;u++)this.performEventMoveForDrawing({currentStep:u+2,mode:this.mode,points:this.points,performPointIndex:u,performPoint:this.points[u]});this.currentStep===N1&&((c=this.performEventPressedMove)==null||c.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}))}}getPrevZLevel(){return this._prevZLevel}setPrevZLevel(e){this._prevZLevel=e}shouldUpdate(){const e=this._prevOverlay.zLevel!==this.zLevel,t=e||JSON.stringify(this._prevOverlay.points)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles;return{sort:e,draw:t}}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=N1:this.currentStep++}forceComplete(){this.currentStep=N1}isDrawing(){return this.currentStep!==N1}isStart(){return this.currentStep===z6}eventMoveForDrawing(e){var o;const t=this.currentStep-1,s={};nl(e.timestamp)&&(s.timestamp=e.timestamp),nl(e.dataIndex)&&(s.dataIndex=e.dataIndex),nl(e.value)&&(s.value=e.value),this.points[t]=s,(o=this.performEventMoveForDrawing)==null||o.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:t,performPoint:s})}eventPressedPointMove(e,t){var s;this.points[t].timestamp=e.timestamp,nl(e.value)&&(this.points[t].value=e.value),(s=this.performEventPressedMove)==null||s.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})}startPressedMove(e){this._prevPressedPoint={...e},this._prevPressedPoints=Q_(this.points)}eventPressedOtherMove(e,t){if(this._prevPressedPoint!==null){let s=null;nl(e.dataIndex)&&nl(this._prevPressedPoint.dataIndex)&&(s=e.dataIndex-this._prevPressedPoint.dataIndex);let o=null;nl(e.value)&&nl(this._prevPressedPoint.value)&&(o=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(r=>{nl(r.timestamp)&&(r.dataIndex=t.timestampToDataIndex(r.timestamp));const a={...r};return nl(s)&&nl(r.dataIndex)&&(a.dataIndex=r.dataIndex+s,a.timestamp=t.dataIndexToTimestamp(a.dataIndex)??void 0),nl(o)&&nl(r.value)&&(a.value=r.value+o),a})}}static extend(e){class t extends N2{constructor(){super(e)}}return t}}const O9={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,bounding:t,overlay:s,yAxis:o})=>{var a;const r=s.points;if(e.length>0){let l=0;(o==null?void 0:o.isInCandle())??!0?l=((a=n.getSymbol())==null?void 0:a.pricePrecision)??Wh.PRICE:n.getIndicators({paneId:s.paneId}).forEach(m=>{l=Math.max(l,m.precision)});const c=[],f=[],u=0,d=t.width;if(e.length>1&&nl(r[0].value)&&nl(r[1].value)){const h=[1,.786,.618,.5,.382,.236,0],m=e[0].y-e[1].y,g=r[0].value-r[1].value;h.forEach(w=>{const C=e[1].y+m*w,M=n.getDecimalFold().format(n.getThousandsSeparator().format(((r[1].value??0)+g*w).toFixed(l)));c.push({coordinates:[{x:u,y:C},{x:d,y:C}]}),f.push({x:u,y:C,text:`${M} (${(w*100).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:c},{type:"text",isCheckEvent:!1,attrs:f}]}return[]}},z9={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s={x:0,y:n[0].y};Os(n[1])&&n[0].x<n[1].x&&(s.x=e.width);const o=[n[0],s];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].value=e.value,n[1].value=e.value},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].value=t.value)}},V9={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=[];return n.length===2&&t.push({coordinates:n}),[{type:"line",attrs:t,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:t}]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].value=e.value,n[1].value=e.value},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].value=t.value)}},W9={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=[{x:0,y:n[0].y},{x:e.width,y:n[0].y}];return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]}},eh=(n,e,t,s)=>{if(!t||!t.from&&!t.to)return null;const o=t.from||s,r=t.to||s;if(!o&&!r)return null;const a=Number.isFinite(e.minX)?e.minX:0,l=Number.isFinite(e.maxX)&&e.maxX!==e.minX?e.maxX:a+1,c=Number.isFinite(e.minY)?e.minY:0,f=Number.isFinite(e.maxY)&&e.maxY!==e.minY?e.maxY:c+1,u=String(t.mode||"vertical").toLowerCase();let d;if(u==="horizontal")d=n.createLinearGradient(a,c,l,c);else if(u==="radial"){const h=(a+l)/2,m=(c+f)/2,g=Math.max(l-a,f-c)/2;d=n.createRadialGradient(h,m,0,h,m,Math.max(1,g))}else d=n.createLinearGradient(a,c,a,f);return d.addColorStop(0,o),d.addColorStop(1,r),d};class $w{constructor(){$e(this,"_children",[]);$e(this,"_callbacks",new Map)}registerEvent(e,t){return this._callbacks.set(e,t),this}onEvent(e,t){const s=this._callbacks.get(e);return Os(s)&&this.checkEventOn(t)?s(t):!1}dispatchEventToChildren(e,t){const s=this._children.length-1;if(s>-1){for(let o=s;o>-1;o--)if(this._children[o].dispatchEvent(e,t))return!0}return!1}dispatchEvent(e,t){return this.dispatchEventToChildren(e,t)?!0:this.onEvent(e,t)}addChild(e){return this._children.push(e),this}clear(){this._children=[]}}const H9=8,q9=12;function i1(n){return n.isTouch?q9:H9}class A2 extends $w{constructor(t){super();$e(this,"attrs");$e(this,"styles");this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}setAttrs(t){return this.attrs=t,this}setStyles(t){return this.styles=t,this}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){class s extends A2{checkEventOnImp(r,a,l){return t.checkEventOn(r,a,l)}drawImp(r,a,l){t.draw(r,a,l)}}return s}}function k3(n,e,t){let s=[];s=s.concat(e);const o=i1(n),r=Math.max(0,nl(t==null?void 0:t.size)?t.size:0),a=o+(r>1?r/2:0);for(const l of s){const{coordinates:c}=l;if(c.length>1)for(let f=1;f<c.length;f++){const u=c[f-1],d=c[f];if(u.x===d.x){if(Math.abs(u.y-n.y)+Math.abs(d.y-n.y)-Math.abs(u.y-d.y)<a+a&&Math.abs(n.x-u.x)<a)return!0}else{const h=T2(u,d),m=Dw(h,n),g=Math.abs(m-n.y);if(Math.abs(u.x-n.x)+Math.abs(d.x-n.x)-Math.abs(u.x-d.x)<a+a&&g*g/(h[0]*h[0]+1)<a*a)return!0}}}return!1}function Dw(n,e){return n!==null?e.x*n[0]+n[1]:e.y}function fy(n,e,t){const s=T2(n,e);return Dw(s,t)}function T2(n,e){const t=n.x-e.x;if(t!==0){const s=(n.y-e.y)/t,o=n.y-s*n.x;return[s,o]}return null}function S3(n,e,t){const s=e.length,o=nl(t)?t>0&&t<1?t:0:t?.5:0;if(o>0&&s>2){let r=e[0].x,a=e[0].y;for(let c=1;c<s-1;c++){const f=e[c-1],u=e[c],d=e[c+1],h=u.x-f.x,m=u.y-f.y,g=d.x-u.x,w=d.y-u.y;let C=d.x-f.x,M=d.y-f.y;const P=Math.sqrt(h*h+m*m),T=Math.sqrt(g*g+w*w),N=T/(T+P);let L=u.x+C*o*N,O=u.y+M*o*N;L=Math.min(L,Math.max(d.x,u.x)),O=Math.min(O,Math.max(d.y,u.y)),L=Math.max(L,Math.min(d.x,u.x)),O=Math.max(O,Math.min(d.y,u.y)),C=L-u.x,M=O-u.y;let D=u.x-C*P/T,$=u.y-M*P/T;D=Math.min(D,Math.max(f.x,u.x)),$=Math.min($,Math.max(f.y,u.y)),D=Math.max(D,Math.min(f.x,u.x)),$=Math.max($,Math.min(f.y,u.y)),C=u.x-D,M=u.y-$,L=u.x+C*T/P,O=u.y+M*T/P,n.bezierCurveTo(r,a,D,$,u.x,u.y),r=L,a=O}const l=e[s-1];n.bezierCurveTo(r,a,l.x,l.y,l.x,l.y)}else for(let r=1;r<s;r++)n.lineTo(e[r].x,e[r].y)}function U9(n,e,t){let s=[];s=s.concat(e);const{style:o="solid",smooth:r=!1,size:a=1,color:l="currentColor",gradient:c,dashedValue:f=[2,2]}=t,u=!!(c&&(c.from||c.to));n.lineWidth=a,o==="dashed"?n.setLineDash(f):n.setLineDash([]);const d=a%2===1?.5:0;s.forEach(({coordinates:h})=>{if(h.length>1){if(u){let m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,w=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(const P of h)!Number.isFinite(P.x)||!Number.isFinite(P.y)||(P.x<m&&(m=P.x),P.x>g&&(g=P.x),P.y<w&&(w=P.y),P.y>C&&(C=P.y));const M=eh(n,{minX:Number.isFinite(m)?m:0,maxX:Number.isFinite(g)&&g!==m?g:Number.isFinite(m)?m+1:1,minY:Number.isFinite(w)?w:0,maxY:Number.isFinite(C)&&C!==w?C:Number.isFinite(w)?w+1:1},c,String(l||"#000000"));M?n.strokeStyle=M:n.strokeStyle=l}else n.strokeStyle=l;h.length===2&&(h[0].x===h[1].x||h[0].y===h[1].y)?(n.beginPath(),h[0].x===h[1].x?(n.moveTo(h[0].x+d,h[0].y),n.lineTo(h[1].x+d,h[1].y)):(n.moveTo(h[0].x,h[0].y+d),n.lineTo(h[1].x,h[1].y+d)),n.stroke(),n.closePath()):(n.save(),a%2===1&&n.translate(.5,.5),n.beginPath(),n.moveTo(h[0].x,h[0].y),S3(n,h,r),n.stroke(),n.closePath(),n.restore())}})}const G9={name:"line",checkEventOn:k3,draw:(n,e,t)=>{U9(n,e,t)}};function C3(n,e,t){const s=t??0,o=[];if(n.length>1)if(n[0].x===n[1].x){const a=e.height;if(o.push({coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:a}]}),n.length>2){o.push({coordinates:[{x:n[2].x,y:0},{x:n[2].x,y:a}]});const l=n[0].x-n[2].x;for(let c=0;c<s;c++){const f=l*(c+1);o.push({coordinates:[{x:n[0].x+f,y:0},{x:n[0].x+f,y:a}]})}}}else{const a=e.width,l=T2(n[0],n[1]),c=l[0],f=l[1];if(o.push({coordinates:[{x:0,y:0*c+f},{x:a,y:a*c+f}]}),n.length>2){const u=n[2].y-c*n[2].x;o.push({coordinates:[{x:0,y:0*c+u},{x:a,y:a*c+u}]});const d=f-u;for(let h=0;h<s;h++){const m=f+d*(h+1);o.push({coordinates:[{x:0,y:0*c+m},{x:a,y:a*c+m}]})}}}return o}const Y9={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=C3(n,e);return[{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s}]}},K9={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=C3(n,e,1);return[{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s}]}},X9={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,bounding:t,overlay:s,yAxis:o})=>{var f;let a=0;(o==null?void 0:o.isInCandle())??!0?a=((f=n.getSymbol())==null?void 0:f.pricePrecision)??Wh.PRICE:n.getIndicators({paneId:s.paneId}).forEach(d=>{a=Math.max(a,d.precision)});const{value:l=0}=s.points[0],c=[e[0],{x:t.width,y:e[0].y}];return[{type:"line",attrs:{coordinates:c},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:c}},{type:"text",ignoreEvent:!0,attrs:{x:e[0].x,y:e[0].y,text:n.getDecimalFold().format(n.getThousandsSeparator().format(l.toFixed(a))),baseline:"bottom"}}]}};function Z9(n,e){if(n.length>1){let t={x:0,y:0};return n[0].x===n[1].x&&n[0].y!==n[1].y?n[0].y<n[1].y?t={x:n[0].x,y:e.height}:t={x:n[0].x,y:0}:n[0].x>n[1].x?t={x:0,y:fy(n[0],n[1],{x:0,y:n[0].y})}:t={x:e.width,y:fy(n[0],n[1],{x:e.width,y:n[0].y})},{coordinates:[n[0],t]}}return[]}const J9={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=Z9(n,e);return[{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s}]}},Q9={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]:[]},eI={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length===2){if(n[0].x===n[1].x){const o=[{x:n[0].x,y:0},{x:n[0].x,y:e.height}];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]}const s=[{x:0,y:fy(n[0],n[1],{x:0,y:n[0].y})},{x:e.width,y:fy(n[0],n[1],{x:e.width,y:n[0].y})}];return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]}return[]}},tI={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length===2){const s={x:n[0].x,y:0};n[0].y<n[1].y&&(s.y=e.height);const o=[n[0],s];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]}return[]},performEventPressedMove:({points:n,performPoint:e})=>{n[0].timestamp=e.timestamp,n[0].dataIndex=e.dataIndex,n[1].timestamp=e.timestamp,n[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},nI={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]:[],performEventPressedMove:({points:n,performPoint:e})=>{n[0].timestamp=e.timestamp,n[0].dataIndex=e.dataIndex,n[1].timestamp=e.timestamp,n[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},sI={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{const s=[{x:n[0].x,y:0},{x:n[0].x,y:e.height}];return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]}},oI={name:"simpleAnnotation",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({overlay:n,coordinates:e})=>{let t="";Os(n.extendData)&&(ng(n.extendData)?t=n.extendData(n):t=n.extendData??"");const s=e[0].x,o=e[0].y-6,r=o-50,a=r-5;return[{type:"line",attrs:{coordinates:[{x:s,y:o},{x:s,y:r}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:r},{x:s-4,y:a},{x:s+4,y:a}]},ignoreEvent:!0},{type:"text",attrs:{x:s,y:a,text:t,align:"center",baseline:"bottom"},ignoreEvent:!0}]}},iI={name:"simpleTag",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({bounding:n,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:n.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({chart:n,overlay:e,coordinates:t,bounding:s,yAxis:o})=>{var f;const r=(o==null?void 0:o.isFromZero())??!1;let a="left",l=0;r?(a="left",l=0):(a="right",l=s.width);let c="";return Os(e.extendData)&&(ng(e.extendData)?c=e.extendData(e):c=e.extendData??""),!Os(c)&&nl(e.points[0].value)&&(c=tv(e.points[0].value,((f=n.getSymbol())==null?void 0:f.pricePrecision)??Wh.PRICE)),{type:"text",attrs:{x:l,y:t[0].y,text:c,align:a,baseline:"middle"}}}},Rw={},rI=[O9,z9,V9,W9,Y9,K9,X9,J9,Q9,eI,tI,nI,sI,oI,iI];rI.forEach(n=>{Rw[n.name]=N2.extend(n)});function I3(n){Rw[n.name]=N2.extend(n)}function aI(n){return Rw[n]??null}const lI={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},title:{color:"#76808F"},legend:{color:"#76808F"}}},indicator:{tooltip:{title:{color:"#76808F"},legend:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},ticduty:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#6b7280"},ticduty:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},cI={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},title:{color:"#929AA5"},legend:{color:"#929AA5"}}},indicator:{tooltip:{title:{color:"#929AA5"},legend:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},ticduty:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#9aa0a6"},ticduty:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},uI={light:lI,dark:cI};function dI(n){return uI[n]??null}const ny=30,P3=100,ad={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},V6={MIN:1,MAX:900},fI=10,pI=80,mI=.2,Gx=10,rb=Number.MAX_SAFE_INTEGER,hI=-1e4,Mp=24*60*60*1e3;function J2(n){if(n.length===0)return 0;const e=n.slice().sort((t,s)=>t-s);return e[Math.floor(e.length/2)]}function Q2(n,e){if(n.length===0)return 0;const t=Math.max(0,Math.min(1,e)),s=Math.floor(t*(n.length-1));return n[s]}function vI(n){if(n.length===0)return 0;let e=0,t=0;for(const r of n){const a=2*Math.PI*(r/Mp);e+=Math.sin(a),t+=Math.cos(a)}const s=Math.atan2(e/n.length,t/n.length);return(s<0?s+2*Math.PI:s)/(2*Math.PI)*Mp}function y_(n,e){return Math.floor((n-e)/Mp)*Mp+e}function e1(n){return new Date(n).getUTCDay()}function M3(n,e,t){if(e<=0)return 0;const s=t.reduce((l,c)=>l+(c?1:0),0);if(s<=0)return 0;let r=Math.floor(e/7)*s;const a=e%7;for(let l=0;l<a;l++){const c=(n+1+l)%7;t[c]&&r++}return r}function gI(n,e,t){if(e<=0)return 0;const s=t.reduce((l,c)=>l+(c?1:0),0);if(s<=0)return 0;let r=Math.floor(e/7)*s;const a=e%7;for(let l=0;l<a;l++){const c=(n+7-(1+l)%7)%7;t[c]&&r++}return r}function _I(n){try{if(!Array.isArray(n)||n.length<20)return null;const e=n.slice(Math.max(0,n.length-2500)),t=[];for(const N of e){const L=N==null?void 0:N.timestamp;typeof L=="number"&&isFinite(L)&&t.push(L)}if(t.length<20)return null;t.sort((N,L)=>N-L);const s=[];for(let N=1;N<t.length;N++){const L=t[N]-t[N-1];L>0&&isFinite(L)&&s.push(L)}if(s.length<10)return null;s.sort((N,L)=>N-L);const o=Q2(s,.1)||s[0];if(!o||!isFinite(o)||o<=0)return null;const r=Math.max(o*6,o*3+6e4),a=[];for(let N=1;N<t.length;N++)if(t[N]-t[N-1]>r){const D=((t[N]+t[N-1])/2%Mp+Mp)%Mp;a.push(D)}const l=a.length>=4?vI(a):0,c=new Map;for(const N of t){const L=y_(N,l),O=c.get(L);O?(O.count++,N<O.minTs&&(O.minTs=N),N>O.maxTs&&(O.maxTs=N)):c.set(L,{minTs:N,maxTs:N,count:1})}const f=Array.from(c.keys()).sort((N,L)=>N-L),u=f.slice(Math.max(0,f.length-40)),d=[],h=[],m=new Array(7).fill(!1),g=[];for(const N of u){const L=c.get(N);L!=null&&L.count&&g.push(L.count)}const w=J2(g.filter(N=>N>0)),C=Math.max(2,Math.floor(w*.6));for(const N of u){const L=c.get(N);if(!L)continue;const O=e1(N);m[O]=!0;const D=L.minTs-N,$=L.maxTs-N+o;L.count>=C&&isFinite(D)&&isFinite($)&&D>=0&&$>=0&&D<Mp&&$<=Mp&&$>D&&(d.push(D),h.push($))}let M=0,P=Mp;if(d.length>=5&&h.length>=5)M=J2(d),P=J2(h);else{const N=[];for(const D of t){const $=((D-l)%Mp+Mp)%Mp;N.push($)}N.sort((D,$)=>D-$);const L=Q2(N,.05),O=Q2(N,.95);M=L,P=Math.min(Mp,O+o)}if(M>=0&&P>M&&P<=Mp||(M=0,P=Mp),P-M>Mp*.92&&(M=0,P=Mp),!m.some(Boolean))for(let N=0;N<7;N++)m[N]=!0;return{boundaryOffsetMs:l,openMs:M,closeMs:P,activeWeekdays:m}}catch{return null}}function ex(n,e,t){if(n===e)return 0;let s=1,o=n,r=e;o>r&&(s=-1,o=e,r=n);const{boundaryOffsetMs:a,openMs:l,closeMs:c,activeWeekdays:f}=t,u=Math.max(0,c-l);if(u<=0)return 0;const d=y_(o,a),h=y_(r,a),m=o-d,g=r-h,w=e1(d),C=e1(h);if(d===h){if(!f[w])return 0;const N=Math.max(m,l),L=Math.min(g,c);return s*Math.max(0,L-N)}let M=0;f[w]&&(M+=Math.max(0,c-Math.max(m,l))),f[C]&&(M+=Math.max(0,Math.min(g,c)-l));const P=Math.max(0,Math.round((h-d)/Mp)),T=Math.max(0,P-1);if(T>0){const N=M3(w,T,f);M+=N*u}return s*M}function sy(n,e,t){let s=n,o=e;for(let r=0;r<14;r++)if(s+=Mp,o=(o+1)%7,t[o])return{dayStart:s,weekday:o};return{dayStart:n+Mp,weekday:(e+1)%7}}function oy(n,e,t){let s=n,o=e;for(let r=0;r<14;r++)if(s-=Mp,o=(o+6)%7,t[o])return{dayStart:s,weekday:o};return{dayStart:n-Mp,weekday:(e+6)%7}}function tx(n,e,t){if(e===0||!Number.isFinite(e))return n;const{boundaryOffsetMs:s,openMs:o,closeMs:r,activeWeekdays:a}=t;if(Math.max(0,r-o)<=0)return n;let c=n,f=e;const u=f>0;for(f=Math.abs(f);f>0;){let d=y_(c,s),h=e1(d),m=c-d;if(!a[h]){const g=u?sy(d,h,a):oy(d,h,a);d=g.dayStart,h=g.weekday,m=u?o:r,c=d+m}if(u){if(m<o)m=o,c=d+m;else if(m>=r){const C=sy(d,h,a);d=C.dayStart,h=C.weekday,m=o,c=d+m}const g=Math.max(0,r-m);if(f<g)return c+f;f-=g,c=sy(d,h,a).dayStart+o}else{if(m>r)m=r,c=d+m;else if(m<=o){const C=oy(d,h,a);d=C.dayStart,h=C.weekday,m=r,c=d+m}const g=Math.max(0,m-o);if(f<g)return c-f;f-=g,c=oy(d,h,a).dayStart+r}}return c}function yI(n,e,t){if(n===e)return 0;const{boundaryOffsetMs:s,activeWeekdays:o}=t,r=y_(n,s),a=y_(e,s);if(r===a)return 0;const l=e1(r),c=Math.round((a-r)/Mp);return c>0?M3(l,c,o):-gI(l,Math.abs(c),o)}function bI(n,e,t){if(e===0||!Number.isFinite(e))return n;const{boundaryOffsetMs:s,activeWeekdays:o}=t,r=o.reduce((h,m)=>h+(m?1:0),0);if(r<=0)return n;let a=y_(n,s),l=e1(a),c=n-a;if(!o[l])if(e>0){const h=sy(a,l,o);a=h.dayStart,l=h.weekday}else{const h=oy(a,l,o);a=h.dayStart,l=h.weekday}let f=Math.abs(e);const u=e>0,d=Math.floor(f/r);for(d>0&&(a+=(u?1:-1)*d*7*Mp,f-=d*r);f>0;){const h=u?sy(a,l,o):oy(a,l,o);a=h.dayStart,l=h.weekday,f--}return c=Math.max(0,Math.min(Mp-1,c)),a+c}class xI{constructor(e,t){$e(this,"_chart");$e(this,"_styles",c9());$e(this,"_formatter",{formatDate:({dateTimeFormat:e,timestamp:t,template:s})=>g3(e,t,s),formatBigNumber:_3,formatExtendText:e=>""});$e(this,"_innerFormatter",{formatDate:(e,t,s)=>this._formatter.formatDate({dateTimeFormat:this._dateTimeFormat,timestamp:e,template:t,type:s}),formatBigNumber:e=>this._formatter.formatBigNumber(e),formatExtendText:e=>this._formatter.formatExtendText(e)});$e(this,"_locale","en-US");$e(this,"_thousandsSeparator",{sign:",",format:e=>y3(e,this._thousandsSeparator.sign)});$e(this,"_decimalFold",{threshold:3,format:e=>b3(e,this._decimalFold.threshold)});$e(this,"_symbol",null);$e(this,"_period",null);$e(this,"_sessionCacheKey",null);$e(this,"_sessionCache",null);$e(this,"_sessionBySymbol",new Map);$e(this,"_dataList",[]);$e(this,"_dataLoader",null);$e(this,"_loading",!1);$e(this,"_dataLoadMore",{forward:!1,backward:!1});$e(this,"_dateTimeFormat");$e(this,"_zoomEnabled",!0);$e(this,"_scrollEnabled",!0);$e(this,"_totalBarSpace",0);$e(this,"_barSpace",fI);$e(this,"_gapBarSpace",0);$e(this,"_offsetRightDistance",pI);$e(this,"_lastBarRightSideDiffBarCount");$e(this,"_startLastBarRightSideDiffBarCount",0);$e(this,"_scrollLimitRole","bar_count");$e(this,"_minVisibleBarCount",{left:2,right:2});$e(this,"_maxOffsetDistance",{left:50,right:50});$e(this,"_visibleRange",R6());$e(this,"_visibleRangeDataList",[]);$e(this,"_visibleRangeHighLowPrice",[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}]);$e(this,"_crosshair",{});$e(this,"_actions",new Map);$e(this,"_indicators",new Map);$e(this,"_taskScheduler",new JC);$e(this,"_overlays",new Map);$e(this,"_progressOverlayInfo",null);$e(this,"_lastPriceMarkExtendTextUpdateTimers",[]);$e(this,"_pressedOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});$e(this,"_hoverOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});$e(this,"_clickOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});$e(this,"_layoutRafId",null);$e(this,"_pendingLayoutOptions",{measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1});$e(this,"_overlayRafId",null);$e(this,"_perfScrollCalls",0);$e(this,"_perfZoomCalls",0);$e(this,"_perfLayoutSchedules",0);$e(this,"_perfLastWindowTs",typeof performance<"u"?performance.now():Date.now());this._chart=e,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;const{styles:s,locale:o,timezone:r,formatter:a,thousandsSeparator:l,decimalFold:c}=t??{};Os(s)&&this.setStyles(s),pf(o)&&this.setLocale(o),this.setTimezone(r??""),Os(a)&&this.setFormatter(a),Os(l)&&this.setThousandsSeparator(l),Os(c)&&this.setDecimalFold(c)}setStyles(e){var s,o,r,a,l,c;let t=null;if(pf(e)?t=dI(e):t=e,nh(this._styles,t),e0((r=(o=(s=t==null?void 0:t.candle)==null?void 0:s.tooltip)==null?void 0:o.legend)==null?void 0:r.template)&&(this._styles.candle.tooltip.legend.template=t.candle.tooltip.legend.template),Os((c=(l=(a=t==null?void 0:t.candle)==null?void 0:a.priceMark)==null?void 0:l.last)==null?void 0:c.extendTexts)){this._clearLastPriceMarkExtendTextUpdateTimer();const f=[];this._styles.candle.priceMark.last.extendTexts.forEach(u=>{const d=u.updateInterval;if(u.show&&d>0&&!f.includes(d)){f.push(d);const h=setInterval(()=>{this._chart.updatePane(Ef.Main,ad.CANDLE)},d);this._lastPriceMarkExtendTextUpdateTimers.push(h)}})}}getStyles(){return this._styles}setFormatter(e){nh(this._formatter,e)}getFormatter(){return this._formatter}getInnerFormatter(){return this._innerFormatter}setLocale(e){this._locale=e}getLocale(){return this._locale}setTimezone(e){if(!Os(this._dateTimeFormat)||this.getTimezone()!==e){const t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};e.length>0&&(t.timeZone=e);let s=null;try{s=new Intl.DateTimeFormat("en",t)}catch{}s!==null&&(this._dateTimeFormat=s)}}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getDateTimeFormat(){return this._dateTimeFormat}setThousandsSeparator(e){nh(this._thousandsSeparator,e)}getThousandsSeparator(){return this._thousandsSeparator}setDecimalFold(e){nh(this._decimalFold,e)}getDecimalFold(){return this._decimalFold}setSymbol(e){this.resetData(()=>{this._symbol={pricePrecision:Wh.PRICE,volumePrecision:Wh.VOLUME,...this._symbol,...e},this._synchronizeIndicatorSeriesPrecision()})}getSymbol(){return this._symbol}setPeriod(e){this.resetData(()=>{this._period=e})}getPeriod(){return this._period}_getSessionSymbolKey(){var s,o;const e=(s=this._symbol)==null?void 0:s.ticker;if(!e||typeof e!="string")return"";const t=(o=this._symbol)==null?void 0:o.exchange;return`${typeof t=="string"?t:""}:${e}`}_getInferredSession(){var e,t;try{const s=this._getSessionSymbolKey(),o=this._dataList.length,r=o>0?(e=this._dataList[0])==null?void 0:e.timestamp:0,a=o>0?(t=this._dataList[o-1])==null?void 0:t.timestamp:0,l=`${s}|${o}|${r}|${a}`;if(this._sessionCacheKey===l)return this._sessionCache;let c=_I(this._dataList);return c&&s?this._sessionBySymbol.set(s,c):!c&&s&&(c=this._sessionBySymbol.get(s)??null),this._sessionCacheKey=l,this._sessionCache=c,c}catch{return null}}_refineDataIndexByTimestamp(e,t,s){const o=Math.max(0,Math.min(50,Math.floor(s)));let r=t,a=Number.POSITIVE_INFINITY;for(let l=t-o;l<=t+o;l++){const c=this.dataIndexToTimestamp(l);if(!nl(c))continue;const f=Math.abs(c-e);f<a&&(a=f,r=l)}return r}_inferPeriodFromData(){const e=this._dataList.length;if(e<2)return null;const t=this._dataList[e-2].timestamp,s=this._dataList[e-1].timestamp,o=Math.max(1,s-t),r=1e3,a=60*r,l=60*a,c=24*l,f=7*c,u=30*c,d=365*c,h=[{type:"second",unit:r},{type:"minute",unit:a},{type:"hour",unit:l},{type:"day",unit:c},{type:"week",unit:f},{type:"month",unit:u},{type:"year",unit:d}];let m=null,g=Number.MAX_VALUE;for(const w of h){const C=Math.max(1,Math.round(o/w.unit)),M=C*w.unit,P=Math.abs(M-o);P<g&&(g=P,m={type:w.type,span:C})}return m}getDataList(){return this._dataList}getVisibleRangeDataList(){return this._visibleRangeDataList}getVisibleRangeHighLowPrice(){return this._visibleRangeHighLowPrice}_addData(e,t,s){let o=!1,r=!1,a=0;if(e0(e)){const l={backward:!1,forward:!1};switch(dy(s)?(l.backward=s,l.forward=s):(l.backward=(s==null?void 0:s.backward)??!1,l.forward=(s==null?void 0:s.forward)??!1),a=e.length,t){case"init":{this._clearData(),this._dataList=e,this._dataLoadMore.backward=l.backward,this._dataLoadMore.forward=l.forward,this.setOffsetRightDistance(this._offsetRightDistance),r=!0;break}case"backward":{this._dataList=this._dataList.concat(e),this._dataLoadMore.backward=l.backward,this._lastBarRightSideDiffBarCount-=a,r=a>0;break}case"forward":{this._dataList=e.concat(this._dataList),this._dataLoadMore.forward=l.forward,r=a>0;break}}o=!0}else{const l=this._dataList.length,c=e.timestamp,f=Ph(this._dataList[l-1],"timestamp",0);if(c>f){this._dataList.push(e);let u=this.getLastBarRightSideDiffBarCount();u<0&&this.setLastBarRightSideDiffBarCount(--u),a=1,o=!0,r=!0}else c===f&&(this._dataList[l-1]=e,o=!0,r=!0)}o&&r&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this.getIndicatorsByFilter({}).forEach(c=>{this._addIndicatorCalcTask(c,t)}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}))}setDataLoader(e){this.resetData(()=>{this._dataLoader=e})}_calcOptimalBarSpace(){const t=1-mI*Math.atan(Math.max(4,this._barSpace)-4)/(Math.PI*.5);let s=Math.min(Math.floor(this._barSpace*t),Math.floor(this._barSpace));s%2===0&&s+2>=this._barSpace&&--s,this._gapBarSpace=Math.max(1,s)}_adjustVisibleRange(){const e=this._dataList.length,t=this._totalBarSpace/this._barSpace;let s=0,o=0;this._scrollLimitRole==="distance"?(s=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,o=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(s=this._minVisibleBarCount.left,o=this._minVisibleBarCount.right),s=Math.max(0,s),o=Math.max(0,o);const r=t-Math.min(s,e);this._lastBarRightSideDiffBarCount>r&&(this._lastBarRightSideDiffBarCount=r);const a=-e+Math.min(o,e);this._lastBarRightSideDiffBarCount<a&&(this._lastBarRightSideDiffBarCount=a);let l=Math.round(this._lastBarRightSideDiffBarCount+e+.5);const c=l;l>e&&(l=e);let f=Math.round(l-t)-1;f<0&&(f=0);const u=this._lastBarRightSideDiffBarCount>0?Math.round(e+this._lastBarRightSideDiffBarCount-t)-1:f;this._visibleRange={from:f,to:l,realFrom:u,realTo:c},this.executeAction("onVisibleRangeChange",this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(let d=u;d<c;d++){const h=this._dataList[d],m=this.dataIndexToCoordinate(d);this._visibleRangeDataList.push({dataIndex:d,x:m,data:{prev:this._dataList[d-1]??h,current:h,next:this._dataList[d+1]??h}}),Os(h)&&(this._visibleRangeHighLowPrice[0].price<h.high&&(this._visibleRangeHighLowPrice[0].price=h.high,this._visibleRangeHighLowPrice[0].x=m),this._visibleRangeHighLowPrice[1].price>h.low&&(this._visibleRangeHighLowPrice[1].price=h.low,this._visibleRangeHighLowPrice[1].x=m))}f===0?this._dataLoadMore.forward&&this._processDataLoad("forward"):l===e&&this._dataLoadMore.backward&&this._processDataLoad("backward")}_processDataLoad(e){var t,s;if(!this._loading&&Os(this._dataLoader)&&Os(this._symbol)&&Os(this._period)){this._loading=!0;const o={type:e,symbol:this._symbol,period:this._period,timestamp:null,callback:(r,a)=>{var c,f;this._loading=!1,!(e0(r)&&r.length>0)&&(e==="forward"?this._dataLoadMore.forward=!1:e==="backward"&&(this._dataLoadMore.backward=!1)),this._addData(r,e,a),e==="init"&&((f=(c=this._dataLoader)==null?void 0:c.subscribeBar)==null||f.call(c,{symbol:this._symbol,period:this._period,callback:u=>{this._addData(u,"update")}}))}};switch(e){case"backward":{o.timestamp=((t=this._dataList[this._dataList.length-1])==null?void 0:t.timestamp)??null;break}case"forward":{o.timestamp=((s=this._dataList[0])==null?void 0:s.timestamp)??null;break}}try{this._dataLoader.getBars(o)}catch{this._loading=!1}}}_processDataUnsubscribe(){var e,t;Os(this._dataLoader)&&Os(this._symbol)&&Os(this._period)&&((t=(e=this._dataLoader).unsubscribeBar)==null||t.call(e,{symbol:this._symbol,period:this._period}))}resetData(e){this._processDataUnsubscribe(),e==null||e(),this._loading=!1,this._processDataLoad("init")}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}}setBarSpace(e,t){e<V6.MIN||e>V6.MAX||this._barSpace===e||(this._barSpace=e,this._calcOptimalBarSpace(),t==null||t(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setTotalBarSpace(e){this._totalBarSpace!==e&&(this._totalBarSpace=e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setOffsetRightDistance(e,t){return this._offsetRightDistance=this._scrollLimitRole==="distance"?Math.min(this._maxOffsetDistance.right,e):e,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(t??!1)&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})),this}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)}getLastBarRightSideDiffBarCount(){return this._lastBarRightSideDiffBarCount}setLastBarRightSideDiffBarCount(e){this._lastBarRightSideDiffBarCount=e}setMaxOffsetLeftDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.left=e}setMaxOffsetRightDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.right=e}setLeftMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.left=e}setRightMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.right=e}getVisibleRange(){return this._visibleRange}startScroll(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount}scroll(e){if(!this._scrollEnabled)return;const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfScrollCalls++;const s=e/this._barSpace,o=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-s;const r=Math.round(o-this._lastBarRightSideDiffBarCount*this._barSpace);r!==0&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}),this.executeAction("onScroll",{distance:r}))}getDataByDataIndex(e){return this._dataList[e]??null}coordinateToFloatIndex(e){const t=this._dataList.length,s=(this._totalBarSpace-e)/this._barSpace,o=t+this._lastBarRightSideDiffBarCount-s;return Math.round(o*1e6)/1e6}dataIndexToTimestamp(e){const t=this._dataList.length;if(t===0)return null;const s=this.getDataByDataIndex(e);if(Os(s))return s.timestamp;if(Os(this._period)||this._dataList.length>0){const o=t-1;let r=null,a=0;if(e>o?(r=this._dataList[o].timestamp,a=e-o):e<0&&(r=this._dataList[0].timestamp,a=e),nl(r)){const l=this._period??this._inferPeriodFromData();if(Os(l)){const{type:c,span:f}=l;switch(c){case"second":{const u=this._getInferredSession();return u?tx(r,f*1e3*a,u):r+f*1e3*a}case"minute":{const u=this._getInferredSession();return u?tx(r,f*60*1e3*a,u):r+f*60*1e3*a}case"hour":{const u=this._getInferredSession();return u?tx(r,f*60*60*1e3*a,u):r+f*60*60*1e3*a}case"day":{const u=this._getInferredSession();return u?bI(r,f*a,u):r+f*24*60*60*1e3*a}case"week":return r+f*7*24*60*60*1e3*a;case"month":{const u=new Date(r),d=u.getDate();u.setDate(1),u.setMonth(u.getMonth()+f*a);const h=new Date(u.getFullYear(),u.getMonth()+1,0).getDate();return u.setDate(Math.min(d,h)),u.getTime()}case"year":{const u=new Date(r);return u.setFullYear(u.getFullYear()+f*a),u.getTime()}}}}}return null}timestampToDataIndex(e){const t=this._dataList.length;if(t===0)return 0;if(Os(this._period)||this._dataList.length>0){let s=null,o=0;const r=t-1,a=this._dataList[r].timestamp;e>a&&(s=a,o=r);const l=this._dataList[0].timestamp;if(e<l&&(s=l,o=0),nl(s)){const c=this._period??this._inferPeriodFromData();if(Os(c)){const{type:f,span:u}=c;switch(f){case"second":{const d=this._getInferredSession();if(d){const h=ex(s,e,d),m=u*1e3,g=o+h/m;return Math.round(g*1e6)/1e6}return o+(e-s)/(u*1e3)}case"minute":{const d=this._getInferredSession();if(d){const h=ex(s,e,d),m=u*60*1e3,g=o+h/m;return Math.round(g*1e6)/1e6}return o+(e-s)/(u*60*1e3)}case"hour":{const d=this._getInferredSession();if(d){const h=ex(s,e,d),m=u*60*60*1e3,g=o+h/m;return Math.round(g*1e6)/1e6}return o+(e-s)/(u*60*60*1e3)}case"day":{const d=this._getInferredSession();if(d){const h=yI(s,e,d),m=o+Math.floor(h/u);return this._refineDataIndexByTimestamp(e,m,6)}return o+Math.floor((e-s)/(u*24*60*60*1e3))}case"week":return o+Math.floor((e-s)/(u*7*24*60*60*1e3));case"month":{const d=new Date(s),h=new Date(e),m=d.getFullYear(),g=h.getFullYear(),w=d.getMonth(),C=h.getMonth();return o+Math.floor(((g-m)*12+(C-w))/u)}case"year":{const d=new Date(s).getFullYear(),h=new Date(e).getFullYear();return o+Math.floor((h-d)/u)}}}}}return Ux(this._dataList,"timestamp",e)}dataIndexToCoordinate(e){const s=this._dataList.length+this._lastBarRightSideDiffBarCount-e;return Math.floor(this._totalBarSpace-(s-.5)*this._barSpace+.5)}coordinateToDataIndex(e){return Math.ceil(this.coordinateToFloatIndex(e))-1}zoom(e,t){if(!this._zoomEnabled)return;const s=typeof performance<"u"?performance.now():Date.now();s-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=s),this._perfZoomCalls++;let o=t??null;nl(o==null?void 0:o.x)||(o={x:this._crosshair.x??this._totalBarSpace/2});const r=Number.isFinite(this._totalBarSpace)&&this._totalBarSpace>0?this._totalBarSpace:o.x,a=this.coordinateToFloatIndex(r),l=this._barSpace,c=this._barSpace+e*(this._barSpace/Gx);this.setBarSpace(c,()=>{this._lastBarRightSideDiffBarCount+=a-this.coordinateToFloatIndex(r)});const f=this._barSpace/l;f!==1&&this.executeAction("onZoom",{scale:f})}setZoomEnabled(e){this._zoomEnabled=e}isZoomEnabled(){return this._zoomEnabled}setScrollEnabled(e){this._scrollEnabled=e}isScrollEnabled(){return this._scrollEnabled}setCrosshair(e,t){const{notInvalidate:s,notExecuteAction:o,forceInvalidate:r}=t??{},a=e??{};let l=0,c=0;nl(a.x)?(l=this.coordinateToDataIndex(a.x),l<0?c=0:l>this._dataList.length-1?c=this._dataList.length-1:c=l):(l=this._dataList.length-1,c=l);const f=this._dataList[c],u=this.dataIndexToCoordinate(l),d={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair={...a,realX:u,dutyData:f,realDataIndex:l,dataIndex:c,timestamp:this.dataIndexToTimestamp(l)??void 0},(d.x!==a.x||d.y!==a.y||d.paneId!==a.paneId||(r??!1))&&(Os(f)&&!(o??!1)&&this.hasAction("onCrosshairChange")&&pf(this._crosshair.paneId)&&this.executeAction("onCrosshairChange",e),(s??!1)||this._scheduleOverlayUpdate())}getCrosshair(){return this._crosshair}executeAction(e,t){var s;(s=this._actions.get(e))==null||s.execute(t)}subscribeAction(e,t){var s;this._actions.has(e)||this._actions.set(e,new QC),(s=this._actions.get(e))==null||s.subscribe(t)}unsubscribeAction(e,t){const s=this._actions.get(e);Os(s)&&(s.unsubscribe(t),s.isEmpty()&&this._actions.delete(e))}hasAction(e){const t=this._actions.get(e);return Os(t)&&!t.isEmpty()}_sortIndicators(e){var t;pf(e)?(t=this._indicators.get(e))==null||t.sort((s,o)=>s.zLevel-o.zLevel):this._indicators.forEach(s=>{s.sort((o,r)=>o.zLevel-r.zLevel)})}_addIndicatorCalcTask(e,t){var s;(s=e.onDataStateChange)==null||s.call(e,{state:"loading",type:t,indicator:e}),this._taskScheduler.add({id:j6(e.id),handler:async()=>{typeof performance<"u"?performance.now():Date.now();const o=await e.calcImp(this._dataList).then(r=>r);return typeof performance<"u"?performance.now():Date.now(),o}}).then(o=>{var r;o&&(this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}),(r=e.onDataStateChange)==null||r.call(e,{state:"ready",type:t,indicator:e}))}).catch(o=>{var r;o!=="canceled"&&((r=e.onDataStateChange)==null||r.call(e,{state:"error",type:t,indicator:e}))})}addIndicator(e,t,s){const{name:o}=e;if(this.getIndicatorsByFilter(e).length>0)return!1;let a=this.getIndicatorsByPaneId(t);const l=w3(o),c=new l;return this._synchronizeIndicatorSeriesPrecision(c),c.paneId=t,c.override(e),s||(this.removeIndicator({paneId:t}),a=[]),a.push(c),this._indicators.set(t,a),this._sortIndicators(t),this._addIndicatorCalcTask(c,"init"),!0}getIndicatorsByPaneId(e){return this._indicators.get(e)??[]}getIndicatorsByFilter(e){const{paneId:t,name:s,id:o}=e,r=Os(s)?s.split("(")[0].trim():void 0,a=c=>Os(o)?c.id===o:Os(r)?c.name===r||c.shortName===r:!0;let l=[];return Os(t)?l=l.concat(this.getIndicatorsByPaneId(t).filter(a)):this._indicators.forEach(c=>{l=l.concat(c.filter(a))}),l}removeIndicator(e){let t=!1;return this.getIndicatorsByFilter(e??{}).forEach(o=>{const r=this.getIndicatorsByPaneId(o.paneId),a=r.findIndex(l=>l.id===o.id);a>-1&&(this._taskScheduler.remove(j6(o.id)),r.splice(a,1),t=!0),r.length===0&&this._indicators.delete(o.paneId)}),t}hasIndicators(e){return this._indicators.has(e)}_synchronizeIndicatorSeriesPrecision(e){if(Os(this._symbol)){const{pricePrecision:t=Wh.PRICE,volumePrecision:s=Wh.VOLUME}=this._symbol,o=r=>{switch(r.series){case"price":{r.setSeriesPrecision(t);break}case"volume":{r.setSeriesPrecision(s);break}}};Os(e)?o(e):this._indicators.forEach(r=>{r.forEach(a=>{o(a)})})}}overrideIndicator(e){let t=!1,s=!1;return this.getIndicatorsByFilter(e).forEach(r=>{r.override(e);const{calc:a,draw:l,sort:c}=r.shouldUpdateImp();c&&(s=!0),a?this._addIndicatorCalcTask(r,"update"):l&&(t=!0)}),s&&this._sortIndicators(),t?(this._scheduleLayout({update:!0}),!0):!1}_scheduleLayout(e){this._pendingLayoutOptions.measureWidth=this._pendingLayoutOptions.measureWidth||(e.measureWidth??!1),this._pendingLayoutOptions.update=this._pendingLayoutOptions.update||(e.update??!1),this._pendingLayoutOptions.buildYAxisTick=this._pendingLayoutOptions.buildYAxisTick||(e.buildYAxisTick??!1),this._pendingLayoutOptions.cacheYAxisWidth=this._pendingLayoutOptions.cacheYAxisWidth||(e.cacheYAxisWidth??!1);const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfLayoutSchedules++,this._layoutRafId===null&&(this._layoutRafId=n_(()=>{const s={...this._pendingLayoutOptions};this._pendingLayoutOptions={measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1},this._layoutRafId=null,this._chart.layout(s)}))}_scheduleOverlayUpdate(){this._overlayRafId===null&&(this._overlayRafId=n_(()=>{this._overlayRafId=null,this._chart.updatePane(Ef.Overlay)}))}getOverlaysByFilter(e){var f;const{id:t,groupId:s,paneId:o,name:r}=e,a=u=>Os(t)?u.id===t:Os(s)?u.groupId===s&&(!Os(r)||u.name===r):!Os(r)||u.name===r;let l=[];Os(o)?l=l.concat(this.getOverlaysByPaneId(o).filter(a)):this._overlays.forEach(u=>{l=l.concat(u.filter(a))});const c=(f=this._progressOverlayInfo)==null?void 0:f.overlay;return Os(c)&&a(c)&&l.push(c),l}getOverlaysByPaneId(e){if(!pf(e)){let t=[];return this._overlays.forEach(s=>{t=t.concat(s)}),t}return this._overlays.get(e)??[]}_sortOverlays(e){var t;pf(e)?(t=this._overlays.get(e))==null||t.sort((s,o)=>s.zLevel-o.zLevel):this._overlays.forEach(s=>{s.sort((o,r)=>o.zLevel-r.zLevel)})}addOverlays(e,t){const s=[],o=e.map((r,a)=>{var c,f;if(Os(r.id)){let u=null;for(const d of this._overlays){const m=d[1].find(g=>g.id===r.id);if(Os(m)){u=m;break}}if(Os(u))return r.id}const l=aI(r.name);if(Os(l)){const u=r.id??q1(B9),d=new l,h=r.paneId??ad.CANDLE;r.id=u,r.groupId??(r.groupId=u);const m=this.getOverlaysByPaneId(h).length;if(!Os(r.zLevel)){const g=r.extendData,w=(g==null?void 0:g.origin)==="user";r.zLevel=w?hI+m:m}return d.override(r),s.includes(h)||s.push(h),d.isDrawing()?this._progressOverlayInfo={paneId:h,overlay:d,appointPaneFlag:t[a]}:(this._overlays.has(h)||this._overlays.set(h,[]),(c=this._overlays.get(h))==null||c.push(d)),d.isStart()&&((f=d.onDrawStart)==null||f.call(d,{overlay:d,chart:this._chart})),u}return null});return s.length>0&&(this._sortOverlays(),s.forEach(r=>{this._chart.updatePane(Ef.Overlay,r)}),this._chart.updatePane(Ef.Overlay,ad.X_AXIS)),o}getProgressOverlayInfo(){return this._progressOverlayInfo}progressOverlayComplete(){var e;if(this._progressOverlayInfo!==null){const{overlay:t,paneId:s}=this._progressOverlayInfo;t.isDrawing()||(this._overlays.has(s)||this._overlays.set(s,[]),(e=this._overlays.get(s))==null||e.push(t),this._sortOverlays(s),this._progressOverlayInfo=null)}}updateProgressOverlayInfo(e,t){this._progressOverlayInfo!==null&&(dy(t)&&t&&(this._progressOverlayInfo.appointPaneFlag=t),this._progressOverlayInfo.paneId=e,this._progressOverlayInfo.overlay.override({paneId:e}))}overrideOverlay(e){let t=!1;const s=[];return this.getOverlaysByFilter(e).forEach(r=>{r.override(e);const{sort:a,draw:l}=r.shouldUpdate();a&&(t=!0),(a||l)&&(s.includes(r.paneId)||s.push(r.paneId))}),t&&this._sortOverlays(),s.length>0?(s.forEach(r=>{this._chart.updatePane(Ef.Overlay,r)}),this._chart.updatePane(Ef.Overlay,ad.X_AXIS),!0):!1}removeOverlay(e){const t=[];return this.getOverlaysByFilter(e??{}).forEach(o=>{var l;const r=o.paneId,a=this.getOverlaysByPaneId(o.paneId);if((l=o.onRemoved)==null||l.call(o,{overlay:o,chart:this._chart}),t.includes(r)||t.push(r),o.isDrawing())this._progressOverlayInfo=null;else{const c=a.findIndex(f=>f.id===o.id);c>-1&&a.splice(c,1)}a.length===0&&this._overlays.delete(r)}),t.length>0?(t.forEach(o=>{this._chart.updatePane(Ef.Overlay,o)}),this._chart.updatePane(Ef.Overlay,ad.X_AXIS),!0):!1}setPressedOverlayInfo(e){this._pressedOverlayInfo=e}getPressedOverlayInfo(){return this._pressedOverlayInfo}setHoverOverlayInfo(e,t,s){const{overlay:o,figureType:r,figureIndex:a,figure:l}=this._hoverOverlayInfo,c=e.overlay;if(((o==null?void 0:o.id)!==(c==null?void 0:c.id)||r!==e.figureType||a!==e.figureIndex)&&(this._hoverOverlayInfo=e,(o==null?void 0:o.id)!==(c==null?void 0:c.id))){let f=!1,u=!1;const d=this._clickOverlayInfo.overlay;o!==null&&(o.id!==(d==null?void 0:d.id)&&(o.override({zLevel:o.getPrevZLevel()}),u=!0),s(o,l)&&(f=!0)),c!==null&&(c.id!==(d==null?void 0:d.id)&&(c.zLevel!==rb&&c.setPrevZLevel(c.zLevel),c.override({zLevel:rb}),u=!0),t(c,e.figure)&&(f=!0)),u&&this._sortOverlays(),f||this._chart.updatePane(Ef.Overlay)}}getHoverOverlayInfo(){return this._hoverOverlayInfo}setClickOverlayInfo(e,t,s){const{paneId:o,overlay:r,figureType:a,figure:l,figureIndex:c}=this._clickOverlayInfo,f=e.overlay;if(((r==null?void 0:r.id)!==(f==null?void 0:f.id)||a!==e.figureType||c!==e.figureIndex)&&(this._clickOverlayInfo=e,(r==null?void 0:r.id)!==(f==null?void 0:f.id))){let u=!1;const d=this._hoverOverlayInfo.overlay;Os(r)&&(s(r,l),r.id!==(d==null?void 0:d.id)&&(r.override({zLevel:r.getPrevZLevel()}),u=!0)),Os(f)&&(t(f,e.figure),f.zLevel!==rb&&(f.setPrevZLevel(f.zLevel),f.override({zLevel:rb}),u=!0)),u&&this._sortOverlays(),this._chart.updatePane(Ef.Overlay,e.paneId),o!==e.paneId&&this._chart.updatePane(Ef.Overlay,o),this._chart.updatePane(Ef.Overlay,ad.X_AXIS)}}getClickOverlayInfo(){return this._clickOverlayInfo}isOverlayEmpty(){return this._overlays.size===0&&this._progressOverlayInfo===null}isOverlayDrawing(){var e;return((e=this._progressOverlayInfo)==null?void 0:e.overlay.isDrawing())??!1}_clearLastPriceMarkExtendTextUpdateTimer(){this._lastPriceMarkExtendTextUpdateTimers.forEach(e=>{clearInterval(e)}),this._lastPriceMarkExtendTextUpdateTimers=[]}_clearData(){this._dataLoadMore.backward=!1,this._dataLoadMore.forward=!1,this._loading=!1,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange=R6(),this._crosshair={}}getChart(){return this._chart}destroy(){this._clearData(),this._clearLastPriceMarkExtendTextUpdateTimer(),this._taskScheduler.clear(),this._overlays.clear(),this._indicators.clear(),this._actions.clear()}applyNewData(e,t){this._addData(e,"init",t)}addData(e,t,s){this._addData(e,t,s)}}const ed={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator"},Bb=7;async function wI(){return await new Promise(n=>{const e=new ResizeObserver(t=>{n(t.every(s=>"devicePixelContentBoxSize"in s)),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(()=>!1)}class nx{constructor(e,t){$e(this,"_element");$e(this,"_resizeObserver");$e(this,"_mediaQueryList");$e(this,"_ctx");$e(this,"_listener");$e(this,"_supportedDevicePixelContentBox",!1);$e(this,"_width",0);$e(this,"_height",0);$e(this,"_pixelWidth",0);$e(this,"_pixelHeight",0);$e(this,"_nextPixelWidth",0);$e(this,"_nextPixelHeight",0);$e(this,"_requestAnimationId",G2);$e(this,"_mediaQueryListener",()=>{const e=t_(this._element);this._nextPixelWidth=Math.round(this._element.clientWidth*e),this._nextPixelHeight=Math.round(this._element.clientHeight*e),this._resetPixelRatio()});this._listener=t,this._element=R0("canvas",e),this._ctx=this._element.getContext("2d"),wI().then(s=>{this._supportedDevicePixelContentBox=s,s?(this._resizeObserver=new ResizeObserver(o=>{const r=o.find(l=>l.target===this._element),a=r==null?void 0:r.devicePixelContentBoxSize[0];Os(a)&&(this._nextPixelWidth=a.inlineSize,this._nextPixelHeight=a.blockSize,(this._pixelWidth!==this._nextPixelWidth||this._pixelHeight!==this._nextPixelHeight)&&this._resetPixelRatio())}),this._resizeObserver.observe(this._element,{box:"device-pixel-content-box"})):(this._mediaQueryList=window.matchMedia(`(resolution: ${t_(this._element)}dppx)`),this._mediaQueryList.addListener(this._mediaQueryListener))}).catch(s=>!1)}_resetPixelRatio(){this._executeListener(()=>{const e=this._element.clientWidth,t=this._element.clientHeight;if(this._width=e,this._height=t,this._pixelWidth=this._nextPixelWidth,this._pixelHeight=this._nextPixelHeight,this._element.width=this._nextPixelWidth,this._element.height=this._nextPixelHeight,e<=0||t<=0||this._nextPixelWidth<=0||this._nextPixelHeight<=0)return;const s=this._nextPixelWidth/e,o=this._nextPixelHeight/t;this._ctx.scale(s,o)})}_executeListener(e){this._requestAnimationId===G2&&(this._requestAnimationId=n_(()=>{try{this._ctx.clearRect(0,0,this._width,this._height),e==null||e(),this._listener()}catch(t){console.error("Canvas draw error",t)}finally{this._requestAnimationId=G2}}))}update(e,t){if(this._width!==e||this._height!==t){this._element.style.width=`${e}px`,this._element.style.height=`${t}px`;const s=t_(this._element);this._nextPixelWidth=Math.round(e*s),this._nextPixelHeight=Math.round(t*s),this._resetPixelRatio()}else this._executeListener()}getElement(){return this._element}getContext(){return this._ctx}destroy(){Os(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),Os(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)}}class N3 extends $w{constructor(t,s){super();$e(this,"_rootContainer");$e(this,"_pane");$e(this,"_container");$e(this,"_bounding",i2());$e(this,"_cursor","crosshair");$e(this,"_forceCursor",null);this._pane=s,this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)}setBounding(t){return nh(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}checkEventOn(t){return!0}setCursor(t){pf(this._forceCursor)||t!==this._cursor&&(this._cursor=t,this._container.style.cursor=this._cursor)}setForceCursor(t){t!==this._forceCursor&&(this._forceCursor=t,this._container.style.cursor=this._forceCursor??this._cursor)}getForceCursor(){return this._forceCursor}update(t){this.updateImp(this._container,this._bounding,t??Ef.Drawer)}destroy(){this._rootContainer.removeChild(this._container)}}class jw extends N3{constructor(t,s){super(t,s);$e(this,"_underlayCanvas");$e(this,"_mainCanvas");$e(this,"_overlayCanvas");this._underlayCanvas=new nx({position:"absolute",top:"0",left:"0",zIndex:"1",boxSizing:"border-box"},()=>{this.updateUnderlay(this._underlayCanvas.getContext())}),this._mainCanvas=new nx({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateMain(this._mainCanvas.getContext())}),this._overlayCanvas=new nx({position:"absolute",top:"0",left:"0",zIndex:"3",boxSizing:"border-box"},()=>{this.updateOverlay(this._overlayCanvas.getContext())});const o=this.getContainer();o.appendChild(this._underlayCanvas.getElement()),o.appendChild(this._mainCanvas.getElement()),o.appendChild(this._overlayCanvas.getElement())}createContainer(){return R0("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})}updateImp(t,s,o){const{width:r,height:a,left:l}=s;t.style.left=`${l}px`;let c=o;const f=t.clientWidth,u=t.clientHeight;switch((r!==f||a!==u)&&(t.style.width=`${r}px`,t.style.height=`${a}px`,c=Ef.Drawer),c){case Ef.Main:{this._underlayCanvas.update(r,a),this._mainCanvas.update(r,a);break}case Ef.Overlay:{this._underlayCanvas.update(r,a),this._overlayCanvas.update(r,a);break}case Ef.Drawer:case Ef.All:{this._underlayCanvas.update(r,a),this._mainCanvas.update(r,a),this._overlayCanvas.update(r,a);break}}}destroy(){this._underlayCanvas.destroy(),this._mainCanvas.destroy(),this._overlayCanvas.destroy()}getImage(t){const{width:s,height:o}=this.getBounding(),r=R0("canvas",{width:`${s}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=t_(r);return r.width=s*l,r.height=o*l,a.scale(l,l),t&&a.drawImage(this._underlayCanvas.getElement(),0,0,s,o),a.drawImage(this._mainCanvas.getElement(),0,0,s,o),t&&a.drawImage(this._overlayCanvas.getElement(),0,0,s,o),r}}function A3(n,e){let t=[];t=t.concat(e);const s=i1(n);for(const o of t){const{x:r,y:a,r:l}=o,c=l+s,f=n.x-r,u=n.y-a;if(!(f*f+u*u>c*c))return!0}return!1}function kI(n,e,t){let s=[];s=s.concat(e);const{style:o="fill",color:r="currentColor",gradient:a,borderSize:l=1,borderColor:c="currentColor",borderStyle:f="solid",borderDashedValue:u=[2,2]}=t,d=!!(a&&(a.from||a.to)),h=(o==="fill"||t.style==="stroke_fill")&&(d||!pf(r)||!i_(r));h&&s.forEach(({x:m,y:g,r:w})=>{if(d){const C=eh(n,{minX:m-w,maxX:m+w,minY:g-w,maxY:g+w},a,pf(r)?r:"#000000");C&&(n.fillStyle=C)}else n.fillStyle=r;n.beginPath(),n.arc(m,g,w,0,Math.PI*2),n.closePath(),n.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!i_(c)&&(n.strokeStyle=c,n.lineWidth=l,f==="dashed"?n.setLineDash(u):n.setLineDash([]),s.forEach(({x:m,y:g,r:w})=>{(!h||w>l)&&(n.beginPath(),n.arc(m,g,w,0,Math.PI*2),n.closePath(),n.stroke())}))}const SI={name:"circle",checkEventOn:A3,draw:(n,e,t)=>{kI(n,e,t)}};function T3(n,e){let t=[];t=t.concat(e);const s=i1(n);for(const o of t){let r=!1;const{coordinates:a}=o;for(let l=0,c=a.length-1;l<a.length;c=l++)a[l].y>n.y!=a[c].y>n.y&&n.x<(a[c].x-a[l].x)*(n.y-a[l].y)/(a[c].y-a[l].y)+a[l].x&&(r=!r);if(r)return!0;for(let l=0;l<a.length;l++){const c=a[l],f=a[(l+1)%a.length],u=f.x-c.x,d=f.y-c.y,h=u*u+d*d;let m=0;h>0&&(m=((n.x-c.x)*u+(n.y-c.y)*d)/h,m=Math.max(0,Math.min(1,m)));const g=c.x+m*u,w=c.y+m*d,C=n.x-g,M=n.y-w;if(C*C+M*M<=s*s)return!0}}return!1}function CI(n,e,t){let s=[];s=s.concat(e);const{style:o="fill",color:r="currentColor",gradient:a,borderSize:l=1,borderColor:c="currentColor",borderStyle:f="solid",borderDashedValue:u=[2,2]}=t,d=!!(a&&(a.from||a.to));(o==="fill"||t.style==="stroke_fill")&&(d||!pf(r)||!i_(r))&&s.forEach(({coordinates:h})=>{if(d){let m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,w=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(const P of h)!Number.isFinite(P.x)||!Number.isFinite(P.y)||(P.x<m&&(m=P.x),P.x>g&&(g=P.x),P.y<w&&(w=P.y),P.y>C&&(C=P.y));const M=eh(n,{minX:Number.isFinite(m)?m:0,maxX:Number.isFinite(g)&&g!==m?g:Number.isFinite(m)?m+1:1,minY:Number.isFinite(w)?w:0,maxY:Number.isFinite(C)&&C!==w?C:Number.isFinite(w)?w+1:1},a,pf(r)?r:"#000000");M&&(n.fillStyle=M)}else n.fillStyle=r;n.beginPath(),n.moveTo(h[0].x,h[0].y);for(let m=1;m<h.length;m++)n.lineTo(h[m].x,h[m].y);n.closePath(),n.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!i_(c)&&(n.strokeStyle=c,n.lineWidth=l,f==="dashed"?n.setLineDash(u):n.setLineDash([]),s.forEach(({coordinates:h})=>{n.beginPath(),n.moveTo(h[0].x,h[0].y);for(let m=1;m<h.length;m++)n.lineTo(h[m].x,h[m].y);n.closePath(),n.stroke()}))}const II={name:"polygon",checkEventOn:T3,draw:(n,e,t)=>{CI(n,e,t)}};function Bw(n,e){let t=[];t=t.concat(e);const s=i1(n);for(const o of t){let r=o.x,a=o.width;a<s*2&&(r-=s,a=s*2);let l=o.y,c=o.height;if(c<s*2&&(l-=s,c=s*2),n.x>=r&&n.x<=r+a&&n.y>=l&&n.y<=l+c)return!0}return!1}function F3(n,e,t){let s=[];s=s.concat(e);const{style:o="fill",color:r="transparent",gradient:a,borderSize:l=1,borderColor:c="transparent",borderStyle:f="solid",borderRadius:u=0,borderDashedValue:d=[2,2]}=t,h=n.roundRect??n.rect,m=!!(a&&(a.from||a.to)),g=(o==="fill"||t.style==="stroke_fill")&&(m||!pf(r)||!i_(r));if(g&&s.forEach(({x:w,y:C,width:M,height:P})=>{if(m){const T=eh(n,{minX:w,maxX:w+M,minY:C,maxY:C+P},a,pf(r)?r:"#000000");T&&(n.fillStyle=T)}else n.fillStyle=r;n.beginPath(),h.call(n,w,C,M,P,u),n.closePath(),n.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!i_(c)){n.strokeStyle=c,n.fillStyle=c,n.lineWidth=l,f==="dashed"?n.setLineDash(d):n.setLineDash([]);const w=l%2===1?.5:0,C=Math.round(w*2);s.forEach(({x:M,y:P,width:T,height:N})=>{T>l*2&&N>l*2?(n.beginPath(),h.call(n,M+w,P+w,T-C,N-C,u),n.closePath(),n.stroke()):g||n.fillRect(M,P,T,N)})}}const PI={name:"rect",checkEventOn:Bw,draw:(n,e,t)=>{F3(n,e,t)}};function Ow(n,e){const{size:t=12,paddingLeft:s=0,paddingTop:o=0,paddingRight:r=0,paddingBottom:a=0,weight:l="normal",family:c}=e,{x:f,y:u,text:d,align:h="left",baseline:m="top",width:g,height:w}=n,C=g??s+sh(d,t,l,c)+r,M=w??o+t+a;let P=0;switch(h){case"left":case"start":{P=f;break}case"right":case"end":{P=f-C;break}default:{P=f-C/2;break}}let T=0;switch(m){case"top":case"hanging":{T=u;break}case"bottom":case"ideographic":case"alphabetic":{T=u-M;break}default:{T=u-M/2;break}}return{x:P,y:T,width:C,height:M}}function L3(n,e,t){let s=[];s=s.concat(e);const o=i1(n);for(const r of s){const{x:a,y:l,width:c,height:f}=Ow(r,t);if(n.x>=a-o&&n.x<=a+c+o&&n.y>=l-o&&n.y<=l+f+o)return!0}return!1}function MI(n,e,t){let s=[];s=s.concat(e);const{color:o="currentColor",size:r=12,family:a,weight:l,paddingLeft:c=0,paddingTop:f=0,paddingRight:u=0}=t,d=s.map(h=>Ow(h,t));F3(n,d,{...t,color:t.backgroundColor}),n.textAlign="left",n.textBaseline="top",n.font=E0(r,l,a),n.fillStyle=o,s.forEach((h,m)=>{const g=d[m];n.fillText(h.text,g.x+c,g.y+f,g.width-c-u)})}const NI={name:"text",checkEventOn:L3,draw:(n,e,t)=>{MI(n,e,t)}};function AI(n,e){const t=n.x-e.x,s=n.y-e.y;return Math.sqrt(t*t+s*s)}function E3(n,e){let t=[];t=t.concat(e);const s=i1(n);for(const o of t)if(Math.abs(AI(n,o)-o.r)<s){const{r,startAngle:a,endAngle:l}=o,c=r*Math.cos(a)+o.x,f=r*Math.sin(a)+o.y,u=r*Math.cos(l)+o.x,d=r*Math.sin(l)+o.y;if(n.x<=Math.max(c,u)+s&&n.x>=Math.min(c,u)-s&&n.y<=Math.max(f,d)+s&&n.y>=Math.min(f,d)-s)return!0}return!1}function TI(n,e,t){let s=[];s=s.concat(e);const{style:o="solid",size:r=1,color:a="currentColor",dashedValue:l=[2,2]}=t;n.lineWidth=r,n.strokeStyle=a,o==="dashed"?n.setLineDash(l):n.setLineDash([]),s.forEach(({x:c,y:f,r:u,startAngle:d,endAngle:h})=>{n.beginPath(),n.arc(c,f,u,d,h),n.stroke(),n.closePath()})}const FI={name:"arc",checkEventOn:E3,draw:(n,e,t)=>{TI(n,e,t)}};function W6(n,e,t,s,o,r,a){const[l,c,f,u,d,h,m]=s,g=a?e+h:h+o,w=a?t+m:m+r;LI(e,t,l,c,f,u,d,g,w).forEach(M=>{n.bezierCurveTo(M[0],M[1],M[2],M[3],M[4],M[5])})}function LI(n,e,t,s,o,r,a,l,c){const{cx:f,cy:u,startAngle:d,deltaAngle:h}=EI(n,e,t,s,o,r,a,l,c),m=[],g=Math.ceil(Math.abs(h)/(Math.PI/2));for(let w=0;w<g;w++){const C=d+w*h/g,M=d+(w+1)*h/g,P=$I(f,u,t,s,o,C,M);m.push(P)}return m}function EI(n,e,t,s,o,r,a,l,c){const f=o*Math.PI/180,u=(n-l)/2,d=(e-c)/2,h=Math.cos(f)*u+Math.sin(f)*d,m=-Math.sin(f)*u+Math.cos(f)*d,g=h**2/t**2+m**2/s**2;g>1&&(t*=Math.sqrt(g),s*=Math.sqrt(g));const w=r===a?-1:1,C=t**2*s**2-t**2*m**2-s**2*h**2,M=t**2*m**2+s**2*h**2,P=w*Math.sqrt(Math.abs(C/M))*(t*m/s),T=w*Math.sqrt(Math.abs(C/M))*(-s*h/t),N=Math.cos(f)*P-Math.sin(f)*T+(n+l)/2,L=Math.sin(f)*P+Math.cos(f)*T+(e+c)/2,O=Math.atan2((m-T)/s,(h-P)/t);let D=Math.atan2((-m-T)/s,(-h-P)/t)-O;return D<0&&a===1?D+=2*Math.PI:D>0&&a===0&&(D-=2*Math.PI),{cx:N,cy:L,startAngle:O,deltaAngle:D}}function $I(n,e,t,s,o,r,a){const l=Math.sin(a-r)*(Math.sqrt(4+3*Math.tan((a-r)/2)**2)-1)/3,c=Math.cos(o),f=Math.sin(o),u=n+t*Math.cos(r)*c-s*Math.sin(r)*f,d=e+t*Math.cos(r)*f+s*Math.sin(r)*c,h=n+t*Math.cos(a)*c-s*Math.sin(a)*f,m=e+t*Math.cos(a)*f+s*Math.sin(a)*c,g=u+l*(-t*Math.sin(r)*c-s*Math.cos(r)*f),w=d+l*(-t*Math.sin(r)*f+s*Math.cos(r)*c),C=h-l*(-t*Math.sin(a)*c-s*Math.cos(a)*f),M=m-l*(-t*Math.sin(a)*f+s*Math.cos(a)*c);return[g,w,C,M,h,m]}function DI(n,e,t){let s=[];s=s.concat(e);const{lineWidth:o=1,color:r="currentColor"}=t;n.lineWidth=o,n.strokeStyle=r,n.setLineDash([]),s.forEach(({x:a,y:l,path:c})=>{const f=c.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if(Os(f)){const u=a,d=l;n.beginPath(),f.forEach(h=>{let m=0,g=0,w=0,C=0;const M=h[0],P=h.slice(1).trim().split(/[\s,]+/).map(Number);switch(M){case"M":m=P[0]+u,g=P[1]+d,n.moveTo(m,g),w=m,C=g;break;case"m":m+=P[0],g+=P[1],n.moveTo(m,g),w=m,C=g;break;case"L":m=P[0]+u,g=P[1]+d,n.lineTo(m,g);break;case"l":m+=P[0],g+=P[1],n.lineTo(m,g);break;case"H":m=P[0]+u,n.lineTo(m,g);break;case"h":m+=P[0],n.lineTo(m,g);break;case"V":g=P[0]+d,n.lineTo(m,g);break;case"v":g+=P[0],n.lineTo(m,g);break;case"C":n.bezierCurveTo(P[0]+u,P[1]+d,P[2]+u,P[3]+d,P[4]+u,P[5]+d),m=P[4]+u,g=P[5]+d;break;case"c":n.bezierCurveTo(m+P[0],g+P[1],m+P[2],g+P[3],m+P[4],g+P[5]),m+=P[4],g+=P[5];break;case"S":n.bezierCurveTo(m,g,P[0]+u,P[1]+d,P[2]+u,P[3]+d),m=P[2]+u,g=P[3]+d;break;case"s":n.bezierCurveTo(m,g,m+P[0],g+P[1],m+P[2],g+P[3]),m+=P[2],g+=P[3];break;case"Q":n.quadraticCurveTo(P[0]+u,P[1]+d,P[2]+u,P[3]+d),m=P[2]+u,g=P[3]+d;break;case"q":n.quadraticCurveTo(m+P[0],g+P[1],m+P[2],g+P[3]),m+=P[2],g+=P[3];break;case"T":n.quadraticCurveTo(m,g,P[0]+u,P[1]+d),m=P[0]+u,g=P[1]+d;break;case"t":n.quadraticCurveTo(m,g,m+P[0],g+P[1]),m+=P[0],g+=P[1];break;case"A":W6(n,m,g,P,u,d,!1),m=P[5]+u,g=P[6]+d;break;case"a":W6(n,m,g,P,u,d,!0),m+=P[5],g+=P[6];break;case"Z":case"z":n.closePath(),m=w,g=C;break}}),t.style==="fill"?n.fill():n.stroke()}})}const RI={name:"path",checkEventOn:Bw,draw:(n,e,t)=>{DI(n,e,t)}},jI={name:"image",draw:(n,e)=>{const{x:t,y:s,width:o,height:r,image:a,borderRadius:l=0}=e;if(!(!a||!a.complete||a.naturalWidth===0))if(l&&l>0){n.save();const c=Math.min(l,Math.floor(Math.min(o,r)/2));n.beginPath(),n.moveTo(t+c,s),n.arcTo(t+o,s,t+o,s+r,c),n.arcTo(t+o,s+r,t,s+r,c),n.arcTo(t,s+r,t,s,c),n.arcTo(t,s,t+o,s,c),n.closePath(),n.clip(),n.drawImage(a,t,s,o,r),n.restore()}else n.drawImage(a,t,s,o,r)},checkEventOn:(n,e)=>!1},zw={},BI=[SI,G9,II,PI,NI,FI,RI,jI];BI.forEach(n=>{zw[n.name]=A2.extend(n)});function OI(n){zw[n.name]=A2.extend(n)}function zI(n){return zw[n]??null}class zg extends $w{constructor(t){super();$e(this,"_widget");this._widget=t}getWidget(){return this._widget}createFigure(t,s){const o=zI(t.name);if(o!==null){const r=new o(t);if(Os(s)){for(const a in s)s.hasOwnProperty(a)&&r.registerEvent(a,s[a]);this.addChild(r)}return r}return null}draw(t,...s){this.clear(),this.drawImp(t,s)}checkEventOn(t){return!0}}class VI extends zg{drawImp(e){var c,f;const t=this.getWidget(),s=this.getWidget().getPane(),o=s.getChart(),r=t.getBounding(),a=o.getStyles().grid;if(a.show){e.save(),e.globalCompositeOperation="destination-over";const u=a.horizontal;if(u.show){const w=s.getAxisComponent().getTicks(),C=w.map(M=>({coordinates:[{x:0,y:M.coord},{x:r.width,y:M.coord}]}));if(w.length>=2){const M=[],P=[...w].sort((T,N)=>T.coord-N.coord);for(let T=1;T<P.length;T+=1){const N=P[T].coord-P[T-1].coord;N>0&&M.push(N)}if(M.length>0){M.sort((D,$)=>D-$);const T=Math.floor(M.length/2),N=M.length%2===0?(M[T-1]+M[T])/2:M[T],L=P[0].coord,O=P[P.length-1].coord;if(N>0){let D=L-N;for(;D>=0;)C.push({coordinates:[{x:0,y:D},{x:r.width,y:D}]}),D-=N;let $=O+N;for(;$<=r.height;)C.push({coordinates:[{x:0,y:$},{x:r.width,y:$}]}),$+=N}}}(c=this.createFigure({name:"line",attrs:C,styles:u}))==null||c.draw(e)}const h=a.vertical;if(h.show){const w=o.getXAxisPane().getAxisComponent().getTicks(),C=w.map(M=>({coordinates:[{x:M.coord,y:0},{x:M.coord,y:r.height}]}));if(w.length>=2){const M=[],P=[...w].sort((T,N)=>T.coord-N.coord);for(let T=1;T<P.length;T+=1){const N=P[T].coord-P[T-1].coord;N>0&&M.push(N)}if(M.length>0){M.sort((D,$)=>D-$);const T=Math.floor(M.length/2),N=M.length%2===0?(M[T-1]+M[T])/2:M[T],L=P[0].coord,O=P[P.length-1].coord;if(N>0){let D=L-N;for(;D>=0;)C.push({coordinates:[{x:D,y:0},{x:D,y:r.height}]}),D-=N;let $=O+N;for(;$<=r.width;)C.push({coordinates:[{x:$,y:0},{x:$,y:r.height}]}),$+=N}}}(f=this.createFigure({name:"line",attrs:C,styles:h}))==null||f.draw(e)}e.restore()}}}class $3 extends zg{eachChildren(e){const s=this.getWidget().getPane().getChart().getChartStore(),o=s.getVisibleRangeDataList(),r=s.getBarSpace(),a=o.length;let l=0;for(;l<a;)e(o[l],r,l),++l}}class D3 extends $3{constructor(){super(...arguments);$e(this,"_boundCandleBarClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCandleBarClick",t),!1))}drawImp(t){const s=this.getWidget().getPane(),o=s.getId()===ad.CANDLE,r=s.getChart().getChartStore(),a=this.getCandleBarOptions();if(a!==null){const{type:l,styles:c}=a;let f=0,u=0;if(a.type==="ohlc"){const{gapBar:h}=r.getBarSpace();f=Math.min(Math.max(Math.round(h*.2),1),8),f>2&&f%2===1&&f--,u=Math.floor(f/2)}const d=s.getAxisComponent();this.eachChildren((h,m)=>{const{x:g,data:{current:w,prev:C}}=h;if(Os(w)){const{open:M,high:P,low:T,close:N}=w,L=c.compareRule==="current_open"?M:(C==null?void 0:C.close)??N,D=N===M||N>=L,$=D?c.upGradient:c.downGradient,z=[];D?(z[0]=c.upColor,z[1]=c.upBorderColor,z[2]=c.upWickColor):(z[0]=c.downColor,z[1]=c.downBorderColor,z[2]=c.downWickColor);const te=d.convertToPixel(M),pe=d.convertToPixel(N),J=[te,pe,d.convertToPixel(P),d.convertToPixel(T)];J.sort((he,ge)=>he-ge);const le=m.gapBar%2===0?1:0;let de=[];switch(l){case"candle_solid":{de=this._createSolidBar(g,J,m,z,le,$);break}case"candle_stroke":{de=this._createStrokeBar(g,J,m,z,le);break}case"candle_up_stroke":{N>M?de=this._createStrokeBar(g,J,m,z,le):de=this._createSolidBar(g,J,m,z,le,$);break}case"candle_down_stroke":{M>N?de=this._createStrokeBar(g,J,m,z,le):de=this._createSolidBar(g,J,m,z,le,$);break}case"ohlc":{de=[{name:"rect",attrs:[{x:g-u,y:J[0],width:f,height:J[3]-J[0]},{x:g-m.halfGapBar,y:te+f>J[3]?J[3]-f:te,width:m.halfGapBar-u,height:f},{x:g+u,y:pe+f>J[3]?J[3]-f:pe,width:m.halfGapBar-u,height:f}],styles:{color:z[0]}}];break}}de.forEach(he=>{var ae;let ge=null;o&&(ge={mouseClickEvent:this._boundCandleBarClickEvent(h)}),(ae=this.createFigure(he,ge??void 0))==null||ae.draw(t)})}})}}getCandleBarOptions(){const t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}}_createSolidBar(t,s,o,r,a,l){return[{name:"rect",attrs:{x:t,y:s[0],width:1,height:s[3]-s[0]},styles:{color:r[2]}},{name:"rect",attrs:{x:t-o.halfGapBar,y:s[1],width:o.gapBar+a,height:Math.max(1,s[2]-s[1])},styles:{style:"stroke_fill",color:r[0],gradient:l,borderColor:r[1]}}]}_createStrokeBar(t,s,o,r,a){return[{name:"rect",attrs:[{x:t,y:s[0],width:1,height:s[1]-s[0]},{x:t,y:s[2],width:1,height:s[3]-s[2]}],styles:{color:r[2]}},{name:"rect",attrs:{x:t-o.halfGapBar,y:s[1],width:o.gapBar+a,height:Math.max(1,s[2]-s[1])},styles:{style:"stroke",borderColor:r[1]}}]}}class WI extends D3{getCandleBarOptions(){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const s=e.getChart().getChartStore(),o=s.getIndicatorsByPaneId(e.getId());for(const r of o)if(r.shouldOhlc&&r.visible){const a=r.styles,l=s.getStyles().indicator,c=Ph(a,"ohlc.compareRule",l.ohlc.compareRule),f=Ph(a,"ohlc.upColor",l.ohlc.upColor),u=Ph(a,"ohlc.downColor",l.ohlc.downColor),d=Ph(a,"ohlc.noChangeColor",l.ohlc.noChangeColor);return{type:"ohlc",styles:{compareRule:c,upColor:f,downColor:u,noChangeColor:d,upBorderColor:f,downBorderColor:u,noChangeBorderColor:d,upWickColor:f,downWickColor:u,noChangeWickColor:d}}}}return null}drawImp(e){super.drawImp(e);const t=this.getWidget(),s=t.getPane(),o=s.getChart(),r=t.getBounding(),a=o.getXAxisPane().getAxisComponent(),l=s.getAxisComponent(),c=o.getChartStore(),f=c.getIndicatorsByPaneId(s.getId()),u=c.getStyles().indicator;e.save(),f.forEach(d=>{if(d.visible){d.zLevel<0?e.globalCompositeOperation="destination-over":e.globalCompositeOperation="source-over";let h=!1;if(d.draw!==null&&(e.save(),h=d.draw({ctx:e,chart:o,indicator:d,bounding:r,xAxis:a,yAxis:l}),e.restore()),!h){const m=d.result,g=[];this.eachChildren((w,C)=>{var le,de,he,ge,ae,Ie;const{halfGapBar:M}=C,{dataIndex:P,x:T,data:N}=w,L=a.convertToPixel(P-1),O=a.convertToPixel(P+1),D=m[((le=N.prev)==null?void 0:le.timestamp)??""]??{},$=m[((de=N.current)==null?void 0:de.timestamp)??""]??{},z=m[((he=N.next)==null?void 0:he.timestamp)??""]??{},te={x:L},pe={x:T},J={x:O};d.figures.forEach(({key:ce})=>{const je=D[ce];nl(je)&&(te[ce]=l.convertToPixel(je));const Ve=$[ce];nl(Ve)&&(pe[ce]=l.convertToPixel(Ve));const We=z[ce];nl(We)&&(J[ce]=l.convertToPixel(We))}),Lw(d,{prev:((ge=N.prev)==null?void 0:ge.timestamp)??null,current:((ae=N.current)==null?void 0:ae.timestamp)??null,next:((Ie=N.next)==null?void 0:Ie.timestamp)??null},u,(ce,je,Ve)=>{var We,He;if(Os($[ce.key])){const Ue=pe[ce.key];let et=(We=ce.attrs)==null?void 0:We.call(ce,{data:{prev:D,current:$,next:z},coordinate:{prev:te,current:pe,next:J},bounding:r,barSpace:C,xAxis:a,yAxis:l});if(!Os(et))switch(ce.type){case"circle":{et={x:T,y:Ue,r:Math.max(1,M)};break}case"rect":case"bar":{const it=ce.baseValue??l.getRange().from,Lt=l.convertToPixel(it);let Tt=Math.abs(Lt-Ue);it!==$[ce.key]&&(Tt=Math.max(1,Tt));let Pt=0;Ue>Lt?Pt=Lt:Pt=Ue,et={x:T-M,y:Pt,width:Math.max(1,M*2),height:Tt};break}case"line":{Os(g[Ve])||(g[Ve]=[]),nl(pe[ce.key])&&nl(J[ce.key])&&g[Ve].push({coordinates:[{x:pe.x,y:pe[ce.key]},{x:J.x,y:J[ce.key]}],styles:je});break}}const ft=ce.type;Os(et)&&ft!=="line"&&((He=this.createFigure({name:ft==="bar"?"rect":ft,attrs:et,styles:je}))==null||He.draw(e))}})}),g.forEach(w=>{var C,M,P,T,N,L,O,D,$,z;if(w.length>1){const te=[{coordinates:[w[0].coordinates[0],w[0].coordinates[1]],styles:w[0].styles}];for(let pe=1;pe<w.length;pe++){const J=te[te.length-1],le=w[pe],de=J.coordinates[J.coordinates.length-1];de.x===le.coordinates[0].x&&de.y===le.coordinates[0].y&&J.styles.style===le.styles.style&&J.styles.color===le.styles.color&&((C=J.styles.gradient)==null?void 0:C.from)===((M=le.styles.gradient)==null?void 0:M.from)&&((P=J.styles.gradient)==null?void 0:P.to)===((T=le.styles.gradient)==null?void 0:T.to)&&((N=J.styles.gradient)==null?void 0:N.mode)===((L=le.styles.gradient)==null?void 0:L.mode)&&J.styles.size===le.styles.size&&J.styles.smooth===le.styles.smooth&&((O=J.styles.dashedValue)==null?void 0:O[0])===((D=le.styles.dashedValue)==null?void 0:D[0])&&(($=J.styles.dashedValue)==null?void 0:$[1])===((z=le.styles.dashedValue)==null?void 0:z[1])?J.coordinates.push(le.coordinates[1]):te.push({coordinates:[le.coordinates[0],le.coordinates[1]],styles:le.styles})}te.forEach(({coordinates:pe,styles:J})=>{var le;(le=this.createFigure({name:"line",attrs:{coordinates:pe},styles:J}))==null||le.draw(e)})}})}}}),e.restore()}}class HI extends zg{drawImp(e){const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=t.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=r.getStyles().crosshair;if(pf(a.paneId)&&l.show){if(a.paneId===s.getId()){const f=a.y;this._drawLine(e,[{x:0,y:f},{x:o.width,y:f}],l.horizontal)}const c=a.realX;this._drawLine(e,[{x:c,y:0},{x:c,y:o.height}],l.vertical)}}_drawLine(e,t,s){var o;if(s.show){const r=s.line;r.show&&((o=this.createFigure({name:"line",attrs:{coordinates:t},styles:r}))==null||o.draw(e))}}}class R3 extends zg{constructor(t){super(t);$e(this,"_activeFeatureInfo",null);$e(this,"_featureClickEvent",(t,s)=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction(t,s),!0));$e(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,!0));this.registerEvent("mouseMoveEvent",s=>(this._activeFeatureInfo=null,!1))}drawImp(t){const s=this.getWidget(),r=s.getPane().getChart().getChartStore(),a=r.getCrosshair();if(Os(a.dutyData)){const l=s.getBounding(),{offsetLeft:c,offsetTop:f,offsetRight:u}=r.getStyles().indicator.tooltip;this.drawIndicatorTooltip(t,c,f,l.width-u)}}drawIndicatorTooltip(t,s,o,r){const a=this.getWidget().getPane(),l=a.getChart().getChartStore(),f=l.getStyles().indicator.tooltip;if(this.isDrawTooltip(l.getCrosshair(),f)){const u=l.getIndicatorsByPaneId(a.getId()),d=f.title,h=f.legend;u.forEach(m=>{let g=0;const w={x:s,y:o},{name:C,calcParamsText:M,legends:P,features:T}=this.getIndicatorTooltipData(m),N=C.length>0,L=P.length>0;if(N||L){const O=this.classifyTooltipFeatures(T);if(g=this.drawStandardTooltipFeatures(t,O[0],w,m,s,g,r),N){let D=C;M.length>0&&(D=`${D}${M}`);const $=d.color;g=this.drawStandardTooltipLegends(t,[{title:{text:"",color:$},value:{text:D,color:$}}],w,s,g,r,d)}g=this.drawStandardTooltipFeatures(t,O[1],w,m,s,g,r),L&&(g=this.drawStandardTooltipLegends(t,P,w,s,g,r,h)),g=this.drawStandardTooltipFeatures(t,O[2],w,m,s,g,r),o=w.y+g}})}return o}drawStandardTooltipFeatures(t,s,o,r,a,l,c){if(s.length>0){let f=0,u=0;s.forEach(m=>{const{marginLeft:g=0,marginTop:w=0,marginRight:C=0,marginBottom:M=0,paddingLeft:P=0,paddingTop:T=0,paddingRight:N=0,paddingBottom:L=0,size:O=0,type:D,content:$}=m;let z=0;if(D==="icon_font"){const te=$;t.font=E0(O,"normal",te.family),z=t.measureText(te.code).width}else z=O;f+=g+P+z+N+C,u=Math.max(u,w+T+O+L+M)}),o.x+f>c?(o.x=a,o.y+=l,l=u):l=Math.max(l,u);const h=this.getWidget().getPane().getId();s.forEach(m=>{var ce,je,Ve,We,He;const{marginLeft:g=0,marginTop:w=0,marginRight:C=0,paddingLeft:M=0,paddingTop:P=0,paddingRight:T=0,paddingBottom:N=0,backgroundColor:L,activeBackgroundColor:O,borderRadius:D,size:$=0,color:z,activeColor:te,type:pe,content:J}=m;let le=z,de=L;((ce=this._activeFeatureInfo)==null?void 0:ce.paneId)===h&&((je=this._activeFeatureInfo.indicator)==null?void 0:je.id)===(r==null?void 0:r.id)&&this._activeFeatureInfo.feature.id===m.id&&(le=te??z,de=O??L);let he="onCandleTooltipFeatureClick";const ge={paneId:h,feature:m};Os(r)&&(he="onIndicatorTooltipFeatureClick",ge.indicator=r);const ae={mouseClickEvent:this._featureClickEvent(he,ge),mouseMoveEvent:this._featureMouseMoveEvent(ge)};let Ie=0;if(pe==="icon_font"){const Ue=J;(Ve=this.createFigure({name:"text",attrs:{text:Ue.code,x:o.x+g,y:o.y+w},styles:{paddingLeft:M,paddingTop:P,paddingRight:T,paddingBottom:N,borderRadius:D,size:$,family:Ue.family,color:le,backgroundColor:de}},ae))==null||Ve.draw(t),Ie=t.measureText(Ue.code).width}else{(We=this.createFigure({name:"rect",attrs:{x:o.x+g,y:o.y+w,width:$,height:$},styles:{paddingLeft:M,paddingTop:P,paddingRight:T,paddingBottom:N,color:de}},ae))==null||We.draw(t);const Ue=J;(He=this.createFigure({name:"path",attrs:{path:Ue.path,x:o.x+g+M,y:o.y+w+P,width:$,height:$},styles:{style:Ue.style,lineWidth:Ue.lineWidth,color:le}}))==null||He.draw(t),Ie=$}o.x+=g+M+Ie+T+C})}return l}drawStandardTooltipLegends(t,s,o,r,a,l,c){if(s.length>0){const{marginLeft:f,marginTop:u,marginRight:d,marginBottom:h,size:m,family:g,weight:w}=c;t.font=E0(m,w,g),s.forEach(C=>{var $,z;const M=C.title,P=C.value,T=t.measureText(M.text).width,N=t.measureText(P.text).width,L=M.text.length>0&&P.text.length>0?2:0,O=T+L+N,D=u+m+h;o.x+f+O+d>l?(o.x=r,o.y+=a,a=D):a=Math.max(a,D),M.text.length>0&&(($=this.createFigure({name:"text",attrs:{x:o.x+f,y:o.y+u,text:M.text},styles:{color:M.color,size:m,family:g,weight:w}}))==null||$.draw(t)),(z=this.createFigure({name:"text",attrs:{x:o.x+f+T+L,y:o.y+u,text:P.text},styles:{color:P.color,size:m,family:g,weight:w}}))==null||z.draw(t),o.x+=f+O+d})}return a}isDrawTooltip(t,s){const o=s.showRule;return o==="always"||o==="follow_cross"&&pf(t.paneId)}getIndicatorTooltipData(t){var C;const s=this.getWidget().getPane().getChart().getChartStore(),o=s.getStyles().indicator,r=o.tooltip,a=r.title;let l="",c="";if(a.show&&(a.showName&&(l=t.shortName),a.showParams)){const M=t.calcParams;M.length>0&&(c=`(${M.join(",")})`)}const f={name:l,calcParamsText:c,legends:[],features:r.features},u=s.getCrosshair().dataIndex,d=t.result,h=s.getInnerFormatter(),m=s.getDecimalFold(),g=s.getThousandsSeparator(),w=[];if(t.visible){const M=s.getDataList(),P=M[u]??{},T=M[u-1]??{};let N=d[P.timestamp];!Os(N)&&u===M.length-1&&(N=d[T.timestamp]);const L=r.legend.defaultValue;Lw(t,{prev:T.timestamp,current:P.timestamp,next:(C=M[u])==null?void 0:C.timestamp},o,(O,D)=>{if(pf(O.title)){const $=D.color;let z=N==null?void 0:N[O.key];nl(z)&&(z=tv(z,t.precision),t.shouldFormatBigNumber&&(z=h.formatBigNumber(z)),z=m.format(g.format(z))),w.push({title:{text:O.title,color:$},value:{text:z??L,color:$}})}}),f.legends=w}if(ng(t.createTooltipDataSource)){const M=this.getWidget(),P=M.getPane(),T=P.getChart(),{name:N,calcParamsText:L,legends:O,features:D}=t.createTooltipDataSource({chart:T,indicator:t,crosshair:s.getCrosshair(),bounding:M.getBounding(),xAxis:P.getChart().getXAxisPane().getAxisComponent(),yAxis:P.getAxisComponent()});if(a.show&&(pf(N)&&a.showName&&(f.name=N),pf(L)&&a.showParams&&(f.calcParamsText=L)),Os(D)&&(f.features=D),Os(O)&&t.visible){const $=[],z=o.tooltip.legend.color;O.forEach(te=>{let pe={text:"",color:z};wg(te.title)?pe=te.title:pe.text=te.title;let J={text:"",color:z};wg(te.value)?J=te.value:J.text=te.value,nl(Number(J.text))&&(J.text=m.format(g.format(J.text))),$.push({title:pe,value:J})}),f.legends=$}}return f}classifyTooltipFeatures(t){const s=[],o=[],r=[];return t.forEach(a=>{switch(a.position){case"left":{s.push(a);break}case"middle":{o.push(a);break}case"right":{r.push(a);break}}}),[s,o,r]}}class Yx extends zg{constructor(t,s){super(t);$e(this,"_overlayFilter");this._overlayFilter=s==null?void 0:s.overlayFilter,((s==null?void 0:s.enableBaseEvent)??!0)&&this._initEvent()}_initEvent(){const t=this.getWidget(),s=t.getPane(),o=s.getId(),r=s.getChart(),a=r.getChartStore();this.registerEvent("mouseMoveEvent",l=>{var f;const c=a.getProgressOverlayInfo();if(c!==null){const u=c.overlay;let d=c.paneId;u.isStart()&&(a.updateProgressOverlayInfo(o),d=o);const h=u.points.length-1;if(u.isDrawing()&&d===o){const m=this._coordinateToPoint(u,l);u.eventMoveForDrawing(m),(f=u.onDrawing)==null||f.call(u,{chart:r,overlay:u,...l})}return this._figureMouseMoveEvent(u,"point",h,{key:`${F_}point_${h}`,type:"circle",attrs:{}})(l)}return a.setHoverOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(u,d)=>this._processOverlayMouseEnterEvent(u,d,l),(u,d)=>this._processOverlayMouseLeaveEvent(u,d,l)),t.setForceCursor(null),!1}).registerEvent("mouseClickEvent",l=>{var f,u;const c=a.getProgressOverlayInfo();if(c!==null){const d=c.overlay;let h=c.paneId;d.isStart()&&(a.updateProgressOverlayInfo(o,!0),h=o);const m=d.points.length-1;if(d.isDrawing()&&h===o){const g=this._coordinateToPoint(d,l);d.eventMoveForDrawing(g),(f=d.onDrawing)==null||f.call(d,{chart:r,overlay:d,...l}),d.nextStep(),d.isDrawing()||(a.progressOverlayComplete(),(u=d.onDrawEnd)==null||u.call(d,{chart:r,overlay:d,...l}))}return this._figureMouseClickEvent(d,"point",m,{key:`${F_}point_${m}`,type:"circle",attrs:{}})(l)}return a.setClickOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(d,h)=>this._processOverlaySelectedEvent(d,h,l),(d,h)=>this._processOverlayDeselectedEvent(d,h,l)),!1}).registerEvent("mouseDoubleClickEvent",l=>{var f;const c=a.getProgressOverlayInfo();if(c!==null){const u=c.overlay,d=c.paneId;u.isDrawing()&&d===o&&(u.forceComplete(),u.isDrawing()||(a.progressOverlayComplete(),(f=u.onDrawEnd)==null||f.call(u,{chart:r,overlay:u,...l})));const h=u.points.length-1;return this._figureMouseClickEvent(u,"point",h,{key:`${F_}point_${h}`,type:"circle",attrs:{}})(l)}return!1}).registerEvent("mouseRightClickEvent",l=>{const c=a.getProgressOverlayInfo();if(c!==null){const f=c.overlay;if(f.isDrawing()){const u=f.points.length-1;return this._figureMouseRightClickEvent(f,"point",u,{key:`${F_}point_${u}`,type:"circle",attrs:{}})(l)}}return!1}).registerEvent("mouseUpEvent",l=>{var u;const{overlay:c,figure:f}=a.getPressedOverlayInfo();return c!==null&&Ug("onPressedMoveEnd",f)&&((u=c.onPressedMoveEnd)==null||u.call(c,{chart:r,overlay:c,figure:f??void 0,...l})),a.setPressedOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",l=>{var h;const{overlay:c,figureType:f,figureIndex:u,figure:d}=a.getPressedOverlayInfo();if(c!==null&&Ug("onPressedMoving",d)){if(!c.lock){const m=this._coordinateToPoint(c,l);f==="point"?c.eventPressedPointMove(m,u):c.eventPressedOtherMove(m,this.getWidget().getPane().getChart().getChartStore());let g=!1;(h=c.onPressedMoving)==null||h.call(c,{chart:r,overlay:c,figure:d??void 0,...l,preventDefault:()=>{g=!0}}),g?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return!0}return this.getWidget().setForceCursor(null),!1})}_createFigureEvents(t,s,o,r){return t.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(t,s,o,r),mouseDownEvent:this._figureMouseDownEvent(t,s,o,r),mouseClickEvent:this._figureMouseClickEvent(t,s,o,r),mouseRightClickEvent:this._figureMouseRightClickEvent(t,s,o,r),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,s,o,r)}}_processOverlayMouseEnterEvent(t,s,o){return ng(t.onMouseEnter)&&Ug("onMouseEnter",s)?(t.onMouseEnter({chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_processOverlayMouseLeaveEvent(t,s,o){return ng(t.onMouseLeave)&&Ug("onMouseLeave",s)?(t.onMouseLeave({chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_processOverlaySelectedEvent(t,s,o){var r;return Ug("onSelected",s)?((r=t.onSelected)==null||r.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_processOverlayDeselectedEvent(t,s,o){var r;return Ug("onDeselected",s)?((r=t.onDeselected)==null||r.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:s??void 0,...o}),!0):!1}_figureMouseMoveEvent(t,s,o,r){return a=>{var f;const l=this.getWidget().getPane(),c=!t.isDrawing()&&Ug("onMouseMove",r);if(c){let u=!1;(f=t.onMouseMove)==null||f.call(t,{chart:l.getChart(),overlay:t,figure:r,...a,preventDefault:()=>{u=!0}}),u?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return l.getChart().getChartStore().setHoverOverlayInfo({paneId:l.getId(),overlay:t,figureType:s,figure:r,figureIndex:o},(u,d)=>this._processOverlayMouseEnterEvent(u,d,a),(u,d)=>this._processOverlayMouseLeaveEvent(u,d,a)),c}}_figureMouseDownEvent(t,s,o,r){return a=>{var f;const l=this.getWidget().getPane(),c=l.getId();return t.startPressedMove(this._coordinateToPoint(t,a)),Ug("onPressedMoveStart",r)?((f=t.onPressedMoveStart)==null||f.call(t,{chart:l.getChart(),overlay:t,figure:r,...a}),l.getChart().getChartStore().setPressedOverlayInfo({paneId:c,overlay:t,figureType:s,figureIndex:o,figure:r}),!t.isDrawing()):!1}}_figureMouseClickEvent(t,s,o,r){return a=>{var u;const l=this.getWidget().getPane(),c=l.getId(),f=!t.isDrawing()&&Ug("onClick",r);return f&&((u=t.onClick)==null||u.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...a})),l.getChart().getChartStore().setClickOverlayInfo({paneId:c,overlay:t,figureType:s,figureIndex:o,figure:r},(d,h)=>this._processOverlaySelectedEvent(d,h,a),(d,h)=>this._processOverlayDeselectedEvent(d,h,a)),f}}_figureMouseDoubleClickEvent(t,s,o,r){return a=>{var l;return Ug("onDoubleClick",r)?((l=t.onDoubleClick)==null||l.call(t,{...a,chart:this.getWidget().getPane().getChart(),figure:r,overlay:t}),!t.isDrawing()):!1}}_figureMouseRightClickEvent(t,s,o,r){return a=>{var l;if(Ug("onRightClick",r)){let c=!1;return(l=t.onRightClick)==null||l.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...a,preventDefault:()=>{c=!0}}),c||this.getWidget().getPane().getChart().getChartStore().removeOverlay(t),!t.isDrawing()}return!1}}_coordinateToPoint(t,s){const o={},r=this.getWidget().getPane(),a=r.getChart(),l=r.getId(),c=a.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){const u=a.getXAxisPane().getAxisComponent().convertFromPixel(s.x),d=c.dataIndexToTimestamp(u)??void 0;o.timestamp=d,o.dataIndex=u}if(this.coordinateToPointValueFlag()){const f=r.getAxisComponent();let u=f.convertFromPixel(s.y);if(t.mode!=="normal"&&l===ad.CANDLE&&nl(o.dataIndex)){const d=c.getDataByDataIndex(o.dataIndex);if(d!==null){const h=t.modeSensitivity;if(u>d.high)if(t.mode==="weak_magnet"){const m=f.convertToPixel(d.high),g=f.convertFromPixel(m-h);u<g&&(u=d.high)}else u=d.high;else if(u<d.low)if(t.mode==="weak_magnet"){const m=f.convertToPixel(d.low),g=f.convertFromPixel(m-h);u>g&&(u=d.low)}else u=d.low;else{const m=Math.max(d.open,d.close),g=Math.min(d.open,d.close);u>m?u-m<d.high-u?u=m:u=d.high:u<g?u-d.low<g-u?u=d.low:u=g:m-u<u-g?u=m:u=g}}}o.value=u}return o}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,s){return this.getWidget().getPane().getChart().getChartStore().isOverlayDrawing()?this.onEvent(t,s):super.dispatchEvent(t,s)}drawImp(t){this.getCompleteOverlays().forEach(r=>{r.visible&&this._allowOverlay(r)&&this._drawOverlay(t,r)});const o=this.getProgressOverlay();Os(o)&&o.visible&&this._allowOverlay(o)&&this._drawOverlay(t,o)}_allowOverlay(t){return this._overlayFilter?this._overlayFilter(t):!0}_drawOverlay(t,s){const{points:o}=s,r=this.getWidget().getPane(),a=r.getChart(),l=a.getChartStore(),c=r.getAxisComponent(),f=a.getXAxisPane().getAxisComponent(),d=l.getDataList().length,h=d-1,m=o.map((g,w)=>{let C=null;nl(g.timestamp)?C=l.timestampToDataIndex(g.timestamp):nl(g.dataIndex)?C=g.dataIndex:d>0&&(C=h);const M={x:0,y:0};return nl(C)&&(M.x=f.convertToPixel(C)),nl(g.value)&&(M.y=(c==null?void 0:c.convertToPixel(g.value))??0),M});if(m.length>0){const g=[].concat(this.getFigures(s,m));this.drawFigures(t,s,g)}this.drawDefaultFigures(t,s,m)}drawFigures(t,s,o){const r=this.getWidget().getPane().getChart().getStyles().overlay;o.forEach((a,l)=>{const{type:c,styles:f,attrs:u}=a;[].concat(u).forEach(h=>{var w,C;const m=this._createFigureEvents(s,"other",l,a),g={...r[c],...(w=s.styles)==null?void 0:w[c],...f};(C=this.createFigure({name:c,attrs:h,styles:g},m??void 0))==null||C.draw(t)})})}getCompleteOverlays(){const t=this.getWidget().getPane();return t.getChart().getChartStore().getOverlaysByPaneId(t.getId())}getProgressOverlay(){const t=this.getWidget().getPane(),s=t.getChart().getChartStore().getProgressOverlayInfo();return Os(s)&&s.paneId===t.getId()?s.overlay:null}getFigures(t,s){var u;const o=this.getWidget(),r=o.getPane(),a=r.getChart(),l=r.getAxisComponent(),c=a.getXAxisPane().getAxisComponent(),f=o.getBounding();return((u=t.createPointFigures)==null?void 0:u.call(t,{chart:a,overlay:t,coordinates:s,bounding:f,xAxis:c,yAxis:l}))??[]}drawDefaultFigures(t,s,o){var r,a;if(s.needDefaultPointFigure){const l=this.getWidget().getPane().getChart().getChartStore(),c=l.getHoverOverlayInfo(),f=l.getClickOverlayInfo();if(((r=c.overlay)==null?void 0:r.id)===s.id&&c.figureType!=="none"||((a=f.overlay)==null?void 0:a.id)===s.id&&f.figureType!=="none"){const u=l.getStyles().overlay,d=s.styles,h={...u.point,...d==null?void 0:d.point};o.forEach(({x:m,y:g},w)=>{var N,L,O,D;let C=h.radius,M=h.color,P=h.borderColor,T=h.borderSize;((N=c.overlay)==null?void 0:N.id)===s.id&&c.figureType==="point"&&((L=c.figure)==null?void 0:L.key)===`${F_}point_${w}`&&(C=h.activeRadius,M=h.activeColor,P=h.activeBorderColor,T=h.activeBorderSize),(O=this.createFigure({name:"circle",attrs:{x:m,y:g,r:C+T},styles:{color:P}},this._createFigureEvents(s,"point",w,{key:`${F_}point_${w}`,type:"circle",attrs:{x:m,y:g,r:C+T},styles:{color:P}})??void 0))==null||O.draw(t),(D=this.createFigure({name:"circle",attrs:{x:m,y:g,r:C},styles:{color:M}}))==null||D.draw(t)})}}}}class j3 extends jw{constructor(t,s){super(t,s);$e(this,"_gridView",new VI(this));$e(this,"_indicatorView",new WI(this));$e(this,"_crosshairLineView",new HI(this));$e(this,"_tooltipView",this.createTooltipView());$e(this,"_overlayView",new Yx(this,{overlayFilter:t=>t.isDrawing()||t.zLevel>=0}));$e(this,"_overlayBackgroundView",new Yx(this,{overlayFilter:t=>!t.isDrawing()&&t.zLevel<0,enableBaseEvent:!1}));this.addChild(this._tooltipView),this.addChild(this._overlayBackgroundView),this.addChild(this._overlayView)}getName(){return ed.MAIN}updateMain(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._indicatorView.draw(t))}createTooltipView(){return new R3(this)}updateMainContent(t){}updateOverlayContent(t){}updateUnderlay(t){this.getPane().getOptions().state!=="minimize"&&(this._gridView.draw(t),this._overlayBackgroundView.draw(t))}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}}class qI extends $3{constructor(){super(...arguments);$e(this,"_ripplePoint",this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}));$e(this,"_animationFrameTime",0);$e(this,"_animation",new qx({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const s=this.getWidget().getPane();s.getChart().updatePane(Ef.Main,s.getId())}))}drawImp(t){var C,M,P;const s=this.getWidget(),o=s.getPane(),r=o.getChart(),l=r.getDataList().length-1,c=s.getBounding(),f=o.getAxisComponent(),u=r.getStyles().candle.area,d=[];let h=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER,g=null;if(this.eachChildren(T=>{const N=T.x,{current:L}=T.data,O=L==null?void 0:L[u.value];if(nl(O)){const D=f.convertToPixel(O);m===Number.MIN_SAFE_INTEGER&&(m=N),d.push({x:N,y:D}),h=Math.min(h,D),T.dataIndex===l&&(g={x:N,y:D})}}),d.length>0){(C=this.createFigure({name:"line",attrs:{coordinates:d},styles:{color:u.lineColor,size:u.lineSize,smooth:u.smooth}}))==null||C.draw(t);const T=u.backgroundColor;let N="";if(e0(T)){const L=t.createLinearGradient(0,c.height,0,h);try{T.forEach(({offset:O,color:D})=>{L.addColorStop(O,D)})}catch{}N=L}else N=T;t.fillStyle=N,t.beginPath(),t.moveTo(m,c.height),t.lineTo(d[0].x,d[0].y),S3(t,d,u.smooth),t.lineTo(d[d.length-1].x,c.height),t.closePath(),t.fill()}const w=u.point;if(w.show&&Os(g)){(M=this.createFigure({name:"circle",attrs:{x:g.x,y:g.y,r:w.radius},styles:{style:"fill",color:w.color}}))==null||M.draw(t);let T=w.rippleRadius;w.animation&&(T=w.radius+this._animationFrameTime/w.animationDuration*(w.rippleRadius-w.radius),this._animation.setDuration(w.animationDuration).start()),(P=this._ripplePoint)==null||P.setAttrs({x:g.x,y:g.y,r:T}).setStyles({style:"fill",color:w.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}class UI extends zg{drawImp(e){var c;const s=this.getWidget().getPane(),o=s.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.high,l=r.low;if(r.show&&(a.show||l.show)){const f=o.getVisibleRangeHighLowPrice(),u=((c=o.getSymbol())==null?void 0:c.pricePrecision)??Wh.PRICE,d=s.getAxisComponent(),{price:h,x:m}=f[0],{price:g,x:w}=f[1],C=d.convertToPixel(h),M=d.convertToPixel(g),P=o.getDecimalFold(),T=o.getThousandsSeparator();a.show&&h!==Number.MIN_SAFE_INTEGER&&this._drawMark(e,P.format(T.format(tv(h,u))),{x:m,y:C},C<M?[-2,-5]:[2,5],a),l.show&&g!==Number.MAX_SAFE_INTEGER&&this._drawMark(e,P.format(T.format(tv(g,u))),{x:w,y:M},C<M?[2,5]:[-2,-5],l)}}_drawMark(e,t,s,o,r){var m,g,w;const a=s.x,l=s.y+o[0];(m=this.createFigure({name:"line",attrs:{coordinates:[{x:a-2,y:l+o[0]},{x:a,y:l},{x:a+2,y:l+o[0]}]},styles:{color:r.color}}))==null||m.draw(e);let c=0,f=0,u="left";const{width:d}=this.getWidget().getBounding();a>d/2?(c=a-5,f=c-r.textOffset,u="right"):(c=a+5,u="left",f=c+r.textOffset);const h=l+o[1];(g=this.createFigure({name:"line",attrs:{coordinates:[{x:a,y:l},{x:a,y:h},{x:c,y:h}]},styles:{color:r.color}}))==null||g.draw(e),(w=this.createFigure({name:"text",attrs:{x:f,y:h,text:t,align:u,baseline:"middle"},styles:{color:r.color,size:r.textSize,family:r.textFamily,weight:r.textWeight}}))==null||w.draw(e)}}class GI extends zg{drawImp(e){var f,u;const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=s.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.line;if(a.show&&l.show&&c.show){const d=s.getAxisComponent(),h=r.getDataList(),m=h[h.length-1];if(Os(m)){const{close:g,open:w}=m,C=l.compareRule==="current_open"?w:((f=h[h.length-2])==null?void 0:f.close)??g,M=d.convertToPixel(g);let P="";g>C?P=l.upColor:g<C?P=l.downColor:P=l.noChangeColor,(u=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:M},{x:o.width,y:M}]},styles:{style:c.style,color:P,size:c.size,dashedValue:c.dashedValue}}))==null||u.draw(e)}}}}const B3={second:"HH:mm:ss",minute:"YYYY-MM-DD HH:mm",hour:"YYYY-MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},YI={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅：",second:"秒",minute:"",hour:"小时",day:"天",week:"周",month:"月",year:"年"},KI={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: ",second:"S",minute:"",hour:"H",day:"D",week:"W",month:"M",year:"Y"},XI={"zh-CN":YI,"en-US":KI};function ZI(n,e){return XI[e][n]??n}class JI extends R3{constructor(){super(...arguments);$e(this,"_logoCache",{});$e(this,"_logoSubscribed",{})}drawImp(t){const s=this.getWidget(),o=s.getPane().getChart().getChartStore(),r=o.getCrosshair();if(Os(r.dutyData)){const a=s.getBounding(),l=o.getStyles(),c=l.candle,f=l.indicator;if(c.tooltip.showType==="rect"&&f.tooltip.showType==="rect"){const u=this.isDrawTooltip(r,c.tooltip),d=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,u,d,c.tooltip.offsetTop)}else if(c.tooltip.showType==="standard"&&f.tooltip.showType==="standard"){const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,m=a.width-h,g=this._drawCandleStandardTooltip(t,u,d,m);this.drawIndicatorTooltip(t,u,g,m)}else if(c.tooltip.showType==="rect"&&f.tooltip.showType==="standard"){const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,m=a.width-h,g=this.drawIndicatorTooltip(t,u,d,m),w=this.isDrawTooltip(r,c.tooltip);this._drawRectTooltip(t,w,!1,g)}else{const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,m=a.width-h,g=this._drawCandleStandardTooltip(t,u,d,m),w=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,!1,w,g)}}}_drawCandleStandardTooltip(t,s,o,r){var m;const a=this.getWidget().getPane().getChart().getChartStore(),c=a.getStyles().candle.tooltip,f=c.legend;let u=0;const d={x:s,y:o},h=a.getCrosshair();if(this.isDrawTooltip(h,c)){const g=c.title;if(g.show){const{type:M="",span:P=""}=a.getPeriod()??{},T=a.getSymbol(),N=((T==null?void 0:T.type)||"").toLowerCase(),L=((T==null?void 0:T.exchange)||"").toUpperCase();let O=N;(O==="forex"||O==="crypto")&&(O="");const D={second:"s",minute:"m",hour:"h",day:"d",week:"w",month:"mo",year:"y"},$=(P?`${P}`:"")+(D[M]??"");let z=g.template;!O&&typeof z=="string"&&(z=z.replace(/(?:\s*[·\.]\s*)\{segment\}/i,""));let te=E6(z,{...T,period:$,exchange:L,segment:O});try{if(typeof window<"u"&&window.innerWidth<=768){const he=(T==null?void 0:T.name)||(T==null?void 0:T.ticker)||"",ge=g.marginLeft??0,ae=g.marginRight??0,Ie=20,je=!!(T!=null&&T.logo2)?Ie*2-6+6:Ie+6,Ve=Math.max(0,r-je-ge-ae),We=g.size??14,He=g.family,Ue=g.weight,et="...",ft=sh(et,We,Ue,He);let it=he;if(sh(it,We,Ue,He)>Ve&&Ve>ft){let Tt=0,Pt=it.length;for(;Tt<Pt;){const st=Math.floor((Tt+Pt)/2),xt=it.slice(0,st)+et;sh(xt,We,Ue,He)<=Ve?Tt=st+1:Pt=st}const St=Math.max(1,Tt-1);it=it.slice(0,St)+et}te=it}}catch{}const pe=g.color;let J={...g};try{const de=(T==null?void 0:T.logo)||"",he=(T==null?void 0:T.logo2)||"",ge=20,ae=Math.floor(d.x+(J.marginLeft??0)),Ie=Math.floor(d.y+(J.marginTop??0)+Math.max(0,Math.floor(((J.size??12)-ge)/2))),ce=[de].filter(Boolean);he&&ce.push(he);const je=a.getStyles(),Ve=((m=je==null?void 0:je.pane)==null?void 0:m.backgroundColor)||"#ffffff";let We=255,He=255,Ue=255;if(Ve.startsWith("#")){const Pt=Ve.replace(/^#/,""),St=parseInt(Pt.length===3?Pt.split("").map(st=>st+st).join(""):Pt,16);We=St>>16&255,He=St>>8&255,Ue=St&255}else if(/rgba?\(/i.test(Ve)){const Pt=Ve.match(/rgba?\(([^)]+)\)/i);if(Pt){const St=Pt[1].split(",").map(st=>parseFloat(st.trim()));We=St[0]??We,He=St[1]??He,Ue=St[2]??Ue}}const et=.299*We+.587*He+.114*Ue,ft=et>186?"#CBD5E1":"#4B5563",it=et>186?"rgba(255,255,255,0.7)":"rgba(17,24,39,0.6)",Lt=Pt=>{var ct,Mt;const st=((T==null?void 0:T.shortName)||(T==null?void 0:T.ticker)||(T==null?void 0:T.name)||""||"").toString().trim().charAt(0).toUpperCase(),xt=2,Je=Math.max(8,ge-xt*2),Xe=sh(st,Je,J.weight,J.family),Be=Math.max(0,Math.floor((ge-xt*2-Xe)/2)),Qe=xt;(ct=this.createFigure({name:"rect",attrs:{x:Pt,y:Ie,width:ge,height:ge},styles:{style:"stroke_fill",color:it,borderColor:ft,borderSize:1,borderRadius:ge/2}}))==null||ct.draw(t),(Mt=this.createFigure({name:"text",attrs:{x:Pt+xt,y:Ie+xt,text:st,width:ge-xt*2,height:ge-xt*2},styles:{backgroundColor:it,borderRadius:(ge-xt*2)/2,size:Je,family:J.family,weight:J.weight,color:ft,paddingLeft:Be,paddingTop:Qe,paddingRight:0,paddingBottom:0}}))==null||Mt.draw(t)};let Tt=ge;ce.forEach((Pt,St)=>{var xt,Je;const st=Math.floor(ae+(St===0?0:ge-8));if(Pt){if(!this._logoSubscribed[Pt]){this._logoSubscribed[Pt]=!0;try{GC(Pt,()=>{try{this.getWidget().getPane().getChart().updatePane(Ef.Overlay,ad.CANDLE)}catch{}})}catch{}}Hx(Pt);let Xe=HC(Pt)||this._logoCache[Pt];Xe.complete&&Xe.naturalWidth>0?((xt=this.createFigure({name:"rect",attrs:{x:st,y:Ie,width:ge,height:ge},styles:{style:"stroke_fill",color:it,borderColor:ft,borderSize:1,borderRadius:ge/2}}))==null||xt.draw(t),(Je=this.createFigure({name:"image",attrs:{x:st+2,y:Ie+2,width:ge-4,height:ge-4,image:Xe,borderRadius:(ge-4)/2},styles:{}}))==null||Je.draw(t)):Lt(st)}else Lt(st)}),Tt=ce.length===2?ge*2-8:ge,J.marginLeft=(J.marginLeft??0)+Tt+6}catch{}const le=this.drawStandardTooltipLegends(t,[{title:{text:"",color:pe},value:{text:te,color:pe}}],d,s,0,typeof window<"u"&&window.innerWidth<=768?r-(T!=null&&T.logo2?20*2-6:20):r,J);u=Math.max(u,le)}const w=this._getCandleTooltipLegends(),C=this.classifyTooltipFeatures(c.features);u=this.drawStandardTooltipFeatures(t,C[0],d,null,s,u,r),u=this.drawStandardTooltipFeatures(t,C[1],d,null,s,u,r);try{typeof window<"u"&&window.innerWidth<=768&&(d.x=s,d.y+=u,u=0)}catch{}if(w.length>0){let M={...f};try{if(typeof window<"u"&&window.innerWidth<=768){let N=M.size;const L=M.family,O=M.weight;let D=M.marginLeft??0,$=M.marginRight??0;for(D=Math.min(D,4),$=Math.min($,4),M.marginLeft=D,M.marginRight=$;N>8;){t.font=E0(N,O,L);let z=0;if(w.forEach(te=>{const pe=te.title,J=te.value,le=pe.text.length>0?t.measureText(pe.text).width:0,de=t.measureText(J.text).width,he=pe.text.length>0&&J.text.length>0?2:0;z+=D+le+he+de+$}),d.x+z<=r)break;N-=1}M.size=N}}catch{}const P={...M,marginTop:Math.max(M.marginTop??0,Math.floor((u-M.size)/2))};u=this.drawStandardTooltipLegends(t,w,d,s,u,r,P)}u=this.drawStandardTooltipFeatures(t,C[2],d,null,s,u,r)}return d.y+u}_drawRectTooltip(t,s,o,r){var g;const a=this.getWidget(),l=a.getPane(),c=l.getChart().getChartStore(),f=c.getStyles(),u=f.candle,d=f.indicator,h=u.tooltip,m=d.tooltip;if(s||o){const w=this._getCandleTooltipLegends(),{offsetLeft:C,offsetTop:M,offsetRight:P,offsetBottom:T}=h,{marginLeft:N,marginRight:L,marginTop:O,marginBottom:D,size:$,weight:z,family:te}=h.legend,{position:pe,paddingLeft:J,paddingRight:le,paddingTop:de,paddingBottom:he,offsetLeft:ge,offsetRight:ae,offsetTop:Ie,offsetBottom:ce,borderSize:je,borderRadius:Ve,borderColor:We,color:He}=h.rect;let Ue=0,et=0,ft=0;s&&(t.font=E0($,z,te),w.forEach(Xe=>{const Be=Xe.title,Qe=Xe.value,ct=`${Be.text}${Qe.text}`,Mt=t.measureText(ct).width+N+L;Ue=Math.max(Ue,Mt)}),ft+=(D+O+$)*w.length);const{marginLeft:it,marginRight:Lt,marginTop:Tt,marginBottom:Pt,size:St,weight:st,family:xt}=m.legend,Je=[];if(o){const Xe=c.getIndicatorsByPaneId(l.getId());t.font=E0(St,st,xt),Xe.forEach(Be=>{const Qe=this.getIndicatorTooltipData(Be).legends;Je.push(Qe),Qe.forEach(ct=>{const Mt=ct.title,mt=ct.value,Ce=`${Mt.text}${mt.text}`,Te=t.measureText(Ce).width+it+Lt;Ue=Math.max(Ue,Te),ft+=Tt+Pt+St})})}if(et+=Ue,et!==0&&ft!==0){const Xe=c.getCrosshair(),Be=a.getBounding(),Qe=l.getYAxisWidget().getBounding();et+=je*2+J+le,ft+=je*2+de+he;const ct=Be.width/2,Mt=pe==="pointer"&&Xe.paneId===ad.CANDLE,mt=(Xe.realX??0)>ct;let Ce=0;if(Mt){const Yt=Xe.realX;mt?Ce=Yt-ae-et:Ce=Yt+ge}else{const Yt=this.getWidget().getPane().getAxisComponent();mt?(Ce=ge+C,Yt.inside&&Yt.position==="left"&&(Ce+=Qe.width)):(Ce=Be.width-ae-et-P,Yt.inside&&Yt.position==="right"&&(Ce-=Qe.width))}let Te=r+Ie;Mt&&(Te=Xe.y-ft/2,Te+ft>Be.height-ce-T&&(Te=Be.height-ce-ft-T),Te<r+Ie&&(Te=r+Ie+M)),(g=this.createFigure({name:"rect",attrs:{x:Ce,y:Te,width:et,height:ft},styles:{style:"stroke_fill",color:He,borderColor:We,borderSize:je,borderRadius:Ve}}))==null||g.draw(t);const It=Ce+je+J+N;let $t=Te+je+de;if(s&&w.forEach(Yt=>{var Dn,Wn;$t+=O;const qn=Yt.title;(Dn=this.createFigure({name:"text",attrs:{x:It,y:$t,text:qn.text},styles:{color:qn.color,size:$,family:te,weight:z}}))==null||Dn.draw(t);const Vn=Yt.value;(Wn=this.createFigure({name:"text",attrs:{x:Ce+et-je-L-le,y:$t,text:Vn.text,align:"right"},styles:{color:Vn.color,size:$,family:te,weight:z}}))==null||Wn.draw(t),$t+=$+D}),o){const Yt=Ce+je+J+it;Je.forEach(qn=>{qn.forEach(Vn=>{var pn,gn;$t+=Tt;const Dn=Vn.title,Wn=Vn.value;(pn=this.createFigure({name:"text",attrs:{x:Yt,y:$t,text:Dn.text},styles:{color:Dn.color,size:St,family:xt,weight:st}}))==null||pn.draw(t),(gn=this.createFigure({name:"text",attrs:{x:Ce+et-je-Lt-le,y:$t,text:Wn.text,align:"right"},styles:{color:Wn.color,size:St,family:xt,weight:st}}))==null||gn.draw(t),$t+=St+Pt})})}}}}_getCandleTooltipLegends(){const t=this.getWidget().getPane().getChart().getChartStore(),s=t.getStyles().candle,o=t.getDataList(),r=t.getInnerFormatter(),a=t.getDecimalFold(),l=t.getThousandsSeparator(),c=t.getLocale(),{pricePrecision:f=Wh.PRICE,volumePrecision:u=Wh.VOLUME}=t.getSymbol()??{},d=t.getPeriod(),h=t.getCrosshair().dataIndex??0,m=t.getSymbol(),w=((m==null?void 0:m.type)||"").toLowerCase()==="stock",M=s.tooltip.legend,{color:P,defaultValue:T}=M,N=M.template,L=o[h-1]??null,O=o[h],D=(L==null?void 0:L.close)??O.close,$=O.close-D,z={...O,time:r.formatDate(O.timestamp,B3[(d==null?void 0:d.type)??"day"],"tooltip"),open:a.format(l.format(tv(O.open,f))),high:a.format(l.format(tv(O.high,f))),low:a.format(l.format(tv(O.low,f))),close:a.format(l.format(tv(O.close,f))),volume:a.format(l.format(r.formatBigNumber(tv(O.volume??T,u)))),turnover:a.format(l.format(tv(O.turnover??T,f))),change:D===0?T:`${l.format(tv($/D*100))}%`},te=ng(N)?N({prev:L,current:O,next:o[h+1]??null},s):N;return(w?te:te.filter(J=>{const le=wg(J.title)?J.title.text:J.title,de=wg(J.value)?J.value.text:J.value,he=(le||"").toString().trim().toLowerCase(),ge=(de||"").toString();return!(he==="volume"||/\{volume\}/i.test(ge))})).map(J=>{const{title:le,value:de}=J;let he={text:"",color:P};wg(le)?he=le:he.text=le,he.text=ZI(he.text,c);let ge={text:T,color:P};return wg(de)?ge=de:ge.text=de,Os(/{change}/.exec(ge.text))&&(ge.color=$===0?s.priceMark.last.noChangeColor:$>0?s.priceMark.last.upColor:s.priceMark.last.downColor),ge.text=E6(ge.text,z),{title:he,value:ge}})}}class QI extends zg{constructor(t){super(t);$e(this,"_activeFeatureInfo",null);$e(this,"_featureClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCrosshairFeatureClick",t),!0));$e(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,this.getWidget().setForceCursor("pointer"),!0));this.registerEvent("mouseMoveEvent",s=>(this._activeFeatureInfo=null,this.getWidget().setForceCursor(null),!1))}drawImp(t){var f;const s=this.getWidget(),o=s.getPane(),r=s.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=this.getWidget(),c=l.getPane().getAxisComponent();if(pf(a.paneId)&&a.paneId===o.getId()&&c.isInCandle()){const u=r.getStyles().crosshair,d=u.horizontal.features;if(u.show&&u.horizontal.show&&d.length>0){const h=c.position==="right",m=l.getBounding();let g=0;const w=u.horizontal.text;if(c.inside&&w.show){const P=c.convertFromPixel(a.y),T=c.getRange();let N=c.displayValueToText(c.realValueToDisplayValue(c.valueToRealValue(P,{range:T}),{range:T}),((f=r.getSymbol())==null?void 0:f.pricePrecision)??Wh.PRICE);N=r.getDecimalFold().format(r.getThousandsSeparator().format(N)),g=w.paddingLeft+sh(N,w.size,w.weight,w.family)+w.paddingRight}let C=g;h&&(C=m.width-g);const M=a.y;d.forEach(P=>{var We,He,Ue,et;const{marginLeft:T=0,marginTop:N=0,marginRight:L=0,paddingLeft:O=0,paddingTop:D=0,paddingRight:$=0,paddingBottom:z=0,color:te,activeColor:pe,backgroundColor:J,activeBackgroundColor:le,borderRadius:de,size:he=0,type:ge,content:ae}=P;let Ie=he;if(ge==="icon_font"){const ft=ae;Ie=O+sh(ft.code,he,"normal",ft.family)+$}h?C-=Ie+L:C+=T;let ce=te,je=J;((We=this._activeFeatureInfo)==null?void 0:We.feature.id)===P.id&&(ce=pe??te,je=le??J);const Ve={mouseClickEvent:this._featureClickEvent({crosshair:a,feature:P}),mouseMoveEvent:this._featureMouseMoveEvent({crosshair:a,feature:P})};if(ge==="icon_font"){const ft=ae;(He=this.createFigure({name:"text",attrs:{text:ft.code,x:C,y:M+N,baseline:"middle"},styles:{paddingLeft:O,paddingTop:D,paddingRight:$,paddingBottom:z,borderRadius:de,size:he,family:ft.family,color:ce,backgroundColor:je}},Ve))==null||He.draw(t)}else{(Ue=this.createFigure({name:"rect",attrs:{x:C,y:M+N-he/2,width:he,height:he},styles:{paddingLeft:O,paddingTop:D,paddingRight:$,paddingBottom:z,color:je}},Ve))==null||Ue.draw(t);const ft=ae;(et=this.createFigure({name:"path",attrs:{path:ft.path,x:C,y:M+N+D-he/2,width:he,height:he},styles:{style:ft.style,lineWidth:ft.lineWidth,color:ce}}))==null||et.draw(t)}h?C-=T:C+=Ie+L})}}}}class e7 extends j3{constructor(t,s){super(t,s);$e(this,"_candleBarView",new D3(this));$e(this,"_candleAreaView",new qI(this));$e(this,"_candleHighLowPriceView",new UI(this));$e(this,"_candleLastPriceLineView",new GI(this));$e(this,"_crosshairFeatureView",new QI(this));this.addChild(this._candleBarView),this.addChild(this._crosshairFeatureView)}updateMainContent(t){this.getPane().getChart().getStyles().candle.type!=="area"?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)}updateOverlayContent(t){this._crosshairFeatureView.draw(t)}createTooltipView(){return new JI(this)}}class O3 extends zg{drawImp(e,t){var c,f;const s=this.getWidget(),o=s.getPane(),r=s.getBounding(),a=o.getAxisComponent(),l=this.getAxisStyles(o.getChart().getStyles());if(l.show&&(l.axisLine.show&&((c=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||c.draw(e)),!t[0])){const u=a.getTicks();if(l.ticduty.show&&this.createTicdutys(u,r,l).forEach(h=>{var m;(m=this.createFigure({name:"line",attrs:h,styles:l.ticduty}))==null||m.draw(e)}),l.tickText.show){const d=this.createTickTexts(u,r,l);(f=this.createFigure({name:"text",attrs:d,styles:l.tickText}))==null||f.draw(e)}}}}class t7 extends O3{getAxisStyles(e){return e.yAxis}createAxisLine(e,t){const s=this.getWidget().getPane().getAxisComponent(),o=t.axisLine.size;let r=0;return s.isFromZero()?r=0:r=e.width-o,{coordinates:[{x:r,y:0},{x:r,y:e.height}]}}createTicdutys(e,t,s){const o=this.getWidget().getPane().getAxisComponent(),r=s.axisLine,a=s.ticduty;let l=0,c=0;return o.isFromZero()?(l=0,r.show&&(l+=r.size),c=l+a.length):(l=t.width,r.show&&(l-=r.size),c=l-a.length),e.map(f=>({coordinates:[{x:l,y:f.coord},{x:c,y:f.coord}]}))}createTickTexts(e,t,s){const o=this.getWidget().getPane().getAxisComponent(),r=s.axisLine,a=s.ticduty,l=s.tickText;let c=0;o.isFromZero()?(c=l.marginStart,r.show&&(c+=r.size),a.show&&(c+=a.length)):(c=t.width-l.marginEnd,r.show&&(c-=r.size),a.show&&(c-=a.length));const f=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return e.map(u=>({x:c,y:u.coord,text:u.text,align:f,baseline:"middle"}))}}class n7 extends zg{drawImp(e){var f,u,d,h,m,g;const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=s.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.text;if(a.show&&l.show&&c.show){const w=r.getStyles().yAxis,C=w.axisLine.show?w.axisLine.size:0,M=w.ticduty.show?w.ticduty.length:0,P=w.tickText.marginStart,T=w.tickText.marginEnd,N=1,L=((f=r.getSymbol())==null?void 0:f.pricePrecision)??Wh.PRICE,O=s.getAxisComponent(),D=r.getVisibleRangeDataList(),$=O.position==="right"?D.length-1:0,z=r.getDataList(),te=z[z.length-1];if(Os(te)){const{close:pe,open:J}=te,le=l.compareRule==="current_open"?J:((u=z[z.length-2])==null?void 0:u.close)??pe,de=O.convertToPixel(pe);let he="";pe>le?he=l.upColor:pe<le?he=l.downColor:he=l.noChangeColor;let ge=0,ae="left";const Ie=c.color,ce={...c};if(O.isFromZero())ge=C+N,ae="left",ce.paddingLeft=M+P-N;else{ge=o.width-C-N,ae="right";const ct=o.width-C-N,Mt=o.width-(w.axisLine.show?w.axisLine.size:0)-(w.ticduty.show?w.ticduty.length:0)-T;ce.paddingRight=ct-Mt}const je=[],Ve=O.getRange();let We=O.displayValueToText(O.realValueToDisplayValue(O.valueToRealValue(pe,{range:Ve}),{range:Ve}),L);We=r.getDecimalFold().format(r.getThousandsSeparator().format(We));const{paddingLeft:He,paddingRight:Ue,paddingTop:et,paddingBottom:ft,size:it,family:Lt,weight:Tt}=ce;let Pt=He+sh(We,it,Tt,Lt)+Ue;const St=et+it+ft,st=J0(he,Ie);je.push({name:"text",attrs:{x:ge,y:de,width:Pt,height:St,text:We,align:ae,baseline:"middle"},styles:{...ce,color:st,backgroundColor:he}});const xt=r.getInnerFormatter().formatExtendText,Je=it/2;let Xe=de-Je-et,Be=de+Je+ft;l.extendTexts.forEach((ct,Mt)=>{const mt=xt({type:"last_price",data:te,index:Mt});if(mt.length>0&&ct.show){const Ce=ct.size/2;let Te=0;ct.position==="above_price"?(Xe-=ct.paddingBottom+Ce,Te=Xe,Xe-=Ce+ct.paddingTop):(Be+=ct.paddingTop+Ce,Te=Be,Be+=Ce+ct.paddingBottom),Pt=Math.max(Pt,ct.paddingLeft+sh(mt,ct.size,ct.weight,ct.family)+ct.paddingRight),je.push({name:"text",attrs:{x:ge,y:Te,width:Pt,height:ct.paddingTop+ct.size+ct.paddingBottom,text:mt,align:ae,baseline:"middle"},styles:{...ct,color:J0(he,ct.color??Ie),backgroundColor:he}})}});const Qe=(d=D[$])==null?void 0:d.data.current;if(Os(Qe)&&Qe.timestamp!==te.timestamp){const{close:ct,open:Mt}=Qe,mt=O.position==="right"?(h=D[$-1])==null?void 0:h.data.current:(m=D[$+1])==null?void 0:m.data.current,Ce=l.compareRule==="current_open"?Mt:(mt==null?void 0:mt.close)??((g=z[z.length-2])==null?void 0:g.close)??ct,Te=O.convertToPixel(ct);let It="";ct>Ce?It=l.upColor:ct<Ce?It=l.downColor:It=l.noChangeColor;let $t=O.displayValueToText(O.realValueToDisplayValue(O.valueToRealValue(ct,{range:Ve}),{range:Ve}),L);$t=r.getDecimalFold().format(r.getThousandsSeparator().format($t));let Yt=He+sh($t,it,Tt,Lt)+Ue;const qn=et+it+ft;je.push({name:"text",attrs:{x:ge,y:Te,width:Yt,height:qn,text:$t,align:ae,baseline:"middle"},styles:{...ce,color:J0(It,Ie),backgroundColor:It}});const Vn=it/2;let Dn=Te-Vn-et,Wn=Te+Vn+ft;l.extendTexts.forEach((pn,gn)=>{const Qs=xt({type:"last_price",data:Qe,index:gn});if(Qs.length>0&&pn.show){const Is=pn.size/2;let Cs=0;pn.position==="above_price"?(Dn-=pn.paddingBottom+Is,Cs=Dn,Dn-=Is+pn.paddingTop):(Wn+=pn.paddingTop+Is,Cs=Wn,Wn+=Is+pn.paddingBottom),Yt=Math.max(Yt,pn.paddingLeft+sh(Qs,pn.size,pn.weight,pn.family)+pn.paddingRight),je.push({name:"text",attrs:{x:ge,y:Cs,width:Yt,height:pn.paddingTop+pn.size+pn.paddingBottom,text:Qs,align:ae,baseline:"middle"},styles:{...pn,color:J0(It,pn.color??Ie),backgroundColor:It}})}})}je.forEach(ct=>{var Yt,qn,Vn,Dn;const Mt=ct.attrs,mt=Mt.y,Ce=Mt.height??(((Yt=ct.styles)==null?void 0:Yt.paddingTop)??0)+(((qn=ct.styles)==null?void 0:qn.size)??0)+(((Vn=ct.styles)==null?void 0:Vn.paddingBottom)??0),Te=Ce/2,$t=mt<-Te||mt>o.height+Te?mt:s.placeYAxisLabel(mt,Ce,o.height);$t!==null&&((Dn=this.createFigure({...ct,attrs:{...Mt,y:Mt.y+($t-mt)}}))==null||Dn.draw(e))})}}}}class s7 extends zg{drawImp(e){var f,u;const t=this.getWidget(),s=t.getPane(),o=t.getBounding(),r=s.getChart().getChartStore(),a=r.getStyles().indicator,l=a.lastValueMark,c=l.text;if(l.show){const d=r.getStyles().yAxis,h=d.axisLine.show?d.axisLine.size:0,m=d.ticduty.show?d.ticduty.length:0,g=d.tickText.marginStart,w=d.tickText.marginEnd,C=1,M=s.getAxisComponent(),P=M.getRange(),T=r.getVisibleRangeDataList(),N=M.position==="right"?T.length-1:0,L=r.getDataList(),O=((f=T[N])==null?void 0:f.data.current)??L[L.length-1]??{},D=((u=T[N-(M.position==="right"?1:-1)])==null?void 0:u.data.current)??L[L.length-2]??{},$=r.getIndicatorsByPaneId(s.getId()),z=r.getInnerFormatter(),te=r.getDecimalFold(),pe=r.getThousandsSeparator(),J=[];$.forEach(le=>{var ge;const de=le.result,he=de[O.timestamp]??de[D.timestamp]??{};if(Os(he)&&le.visible){let ae=le.precision;M.isInCandle()&&(ae=((ge=r.getSymbol())==null?void 0:ge.pricePrecision)??Wh.PRICE),Lw(le,{prev:D.timestamp,current:O.timestamp,next:null},a,(Ie,ce)=>{const je=he[Ie.key];if(nl(je)){const Ve=M.convertToPixel(je);let We=M.displayValueToText(M.realValueToDisplayValue(M.valueToRealValue(je,{range:P}),{range:P}),ae);le.shouldFormatBigNumber&&(We=z.formatBigNumber(We)),We=te.format(pe.format(We));let He=0,Ue="left";const et={...c};if(M.isFromZero())He=h+C,Ue="left",et.paddingLeft=m+g-C;else{He=o.width-h-C,Ue="right";const Be=o.width-h-C,Qe=o.width-(d.axisLine.show?d.axisLine.size:0)-(d.ticduty.show?d.ticduty.length:0)-w;et.paddingRight=Be-Qe}const{paddingLeft:ft,paddingRight:it,paddingTop:Lt,paddingBottom:Tt,size:Pt,weight:St,family:st}=et,xt=ft+sh(We,Pt,St,st)+it,Je=Lt+Pt+Tt,Xe=Math.max(xt,o.width-h-C);J.push({desiredY:Ve,x:He,y:Ve,text:We,align:Ue,width:Xe,height:Je,styles:{...et,color:J0(ce.color,et.color),backgroundColor:ce.color}})}})}}),J.length>0&&J.sort((le,de)=>le.desiredY-de.desiredY).forEach(le=>{var ae;const de=le.height/2,ge=le.desiredY<-de||le.desiredY>o.height+de?le.desiredY:s.placeYAxisLabel(le.desiredY,le.height,o.height);ge!==null&&((ae=this.createFigure({name:"text",attrs:{x:le.x,y:ge,text:le.text,width:le.width,height:le.height,align:le.align,baseline:"middle"},styles:le.styles}))==null||ae.draw(e))})}}}class z3 extends Yx{getAxisLabelTextStyle(e){var a,l,c,f;const s=((l=(a=this.getWidget().getPane().getChart().getStyles().overlay)==null?void 0:a.text)==null?void 0:l.backgroundColor)||"#1677FF";let r=String(((f=(c=e.styles)==null?void 0:c.line)==null?void 0:f.color)||s||"").trim()||s;if(!r||i_(r))r=s;else if(r.startsWith("#"))r=$0(r,.7);else{const u=r.match(/^rgba?\(([^)]+)\)$/i);if(u){const d=u[1].split(",").map(h=>h.trim());if(d.length>=3){const h=Number(d[0]),m=Number(d[1]),g=Number(d[2]),w=d.length>=4&&d[3]!==""?Math.max(0,Math.min(1,Number(d[3]))):1;Number.isFinite(h)&&Number.isFinite(m)&&Number.isFinite(g)&&(r=`rgba(${h}, ${m}, ${g}, ${Math.max(.7,w)})`)}}}return{backgroundColor:r,borderColor:r,borderRadius:3,paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3}}coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(e,t,s){this.drawFigures(e,t,this.getDefaultFigures(t,s))}getDefaultFigures(e,t){var c;const s=this.getWidget(),o=s.getPane(),r=o.getChart().getChartStore(),a=r.getClickOverlayInfo(),l=[];if(e.needDefaultYAxisFigure&&e.id===((c=a.overlay)==null?void 0:c.id)&&a.paneId===o.getId()){const f=o.getAxisComponent(),u=s.getBounding();let d=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const m=f.isFromZero(),g=r.getStyles().yAxis,w=g.axisLine,C=g.ticduty,M=g.tickText,P=w.show?w.size:0,T=C.show?C.length:0,N=M.marginStart,L=M.marginEnd,O=1;let D="left",$=0;m?(D="left",$=P+O):(D="right",$=u.width-P-O);const z=r.getDecimalFold(),te=r.getThousandsSeparator();t.forEach((pe,J)=>{var de;const le=e.points[J];if(nl(le.value)){d=Math.min(d,pe.y),h=Math.max(h,pe.y);const he=z.format(te.format(tv(le.value,((de=r.getSymbol())==null?void 0:de.pricePrecision)??Wh.PRICE))),ge={...this.getAxisLabelTextStyle(e)};if(m)ge.paddingLeft=Math.max(2,T+N-O);else{const it=u.width-P-T-L;ge.paddingRight=Math.max(2,$-it)}const{paddingLeft:ae=0,paddingRight:Ie=0,paddingTop:ce=0,paddingBottom:je=0,size:Ve=12,weight:We="normal",family:He}=ge,Ue=ae+sh(he,Ve,We,He)+Ie,et=ce+Ve+je,ft=Math.max(Ue,u.width-P-O);l.push({type:"text",attrs:{x:$,y:pe.y,text:he,align:D,baseline:"middle",width:ft,height:et},styles:ge,ignoreEvent:!0})}}),t.length>1&&l.unshift({type:"rect",attrs:{x:0,y:d,width:u.width,height:h-d},ignoreEvent:!0})}return l}drawFigures(e,t,s){const o=this.getWidget().getPane().getChart().getStyles().overlay,r=this.getWidget().getBounding(),a=this.getWidget().getPane();if(a.getId()===ad.X_AXIS){super.drawFigures(e,t,s);return}const l=s.flatMap(c=>{var h;if(c.type!=="text")return[c];const f=[].concat(c.attrs),u={...o.text,...(h=t.styles)==null?void 0:h.text,...c.styles};typeof u.backgroundColor=="string"&&(u.color=J0(u.backgroundColor,u.color));const d=f.map(m=>{const g=Ow(m,u),w=g.y+g.height/2,C=a.placeYAxisLabel(w,g.height,r.height);return C===null?null:{...m,y:m.y+(C-w)}}).filter(Boolean);return d.length===0?[]:[{...c,attrs:Array.isArray(c.attrs)?d:d[0]}]});super.drawFigures(e,t,l)}getFigures(e,t){var f;const s=this.getWidget(),o=s.getPane(),r=o.getChart(),a=o.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=s.getBounding();return((f=e.createYAxisFigures)==null?void 0:f.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class V3 extends zg{drawImp(e){var a;const t=this.getWidget(),s=t.getPane(),o=t.getPane().getChart().getChartStore(),r=o.getCrosshair();if(pf(r.paneId)&&this.compare(r,s.getId())){const l=o.getStyles().crosshair;if(l.show){const c=this.getDirectionStyles(l),f=c.text;if(c.show&&f.show){const u=t.getBounding(),d=s.getAxisComponent(),h=this.getText(r,o,d),m=o.getStyles().yAxis,g=m.axisLine.show?m.axisLine.size:0,w=m.ticduty.show?m.ticduty.length:0,C=m.tickText.marginStart,M=m.tickText.marginEnd,P=1,T=d,N={...f};if(T.isFromZero())N.paddingLeft=w+C-P;else{const L=u.width-g-P,O=u.width-(m.axisLine.show?m.axisLine.size:0)-(m.ticduty.show?m.ticduty.length:0)-M;N.paddingRight=L-O}e.font=E0(N.size,N.weight,N.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(h,e.measureText(h).width,r,u,d,N),styles:N}))==null||a.draw(e)}}}}compare(e,t){return e.paneId===t}getDirectionStyles(e){return e.horizontal}getText(e,t,s){var u;const o=s,r=s.convertFromPixel(e.y);let a=0,l=!1;o.isInCandle()?a=((u=t.getSymbol())==null?void 0:u.pricePrecision)??Wh.PRICE:t.getIndicatorsByPaneId(e.paneId).forEach(h=>{a=Math.max(h.precision,a),l||(l=h.shouldFormatBigNumber)});const c=o.getRange();let f=o.displayValueToText(o.realValueToDisplayValue(o.valueToRealValue(r,{range:c}),{range:c}),a);return l&&(f=t.getInnerFormatter().formatBigNumber(f)),t.getDecimalFold().format(t.getThousandsSeparator().format(f))}getTextAttrs(e,t,s,o,r,a){const l=r,c=this.getWidget().getPane().getChart().getStyles(),f=c.yAxis.axisLine.show?c.yAxis.axisLine.size:0,u=1;let d=0,h="left";return l.isFromZero()?(d=f+u,h="left"):(d=o.width-f-u,h="right"),{x:d,y:s.y,text:e,align:h,baseline:"middle"}}}class o7 extends jw{constructor(t,s){super(t,s);$e(this,"_yAxisView",new t7(this));$e(this,"_candleLastPriceLabelView",new n7(this));$e(this,"_indicatorLastValueView",new s7(this));$e(this,"_overlayYAxisView",new z3(this));$e(this,"_crosshairHorizontalLabelView",new V3(this));this.setCursor("ns-resize"),this.addChild(this._overlayYAxisView)}getName(){return ed.Y_AXIS}updateMain(t){const s=this.getPane().getOptions().state==="minimize";this.getPane().resetYAxisLabelSlots(),this._yAxisView.draw(t,s),s||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)),s||this.getPane().commitYAxisLabelSlots()}updateUnderlay(t){}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this.getPane().resetYAxisOverlaySlots(),this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))}}const f_=[1,2,2.5,5,10];function i7(n,e,t){return Math.min(Math.max(n,e),t)}function H6(n,e){if(!Number.isFinite(n)||n<=0)return 0;const t=Math.floor(Math.log10(n)),s=Math.pow(10,t),o=n/s;let r=f_[f_.length-1];if(e==="floor")for(let a=f_.length-1;a>=0;a--){const l=f_[a];if(o>=l){r=l;break}}else for(let a=0;a<f_.length;a++){const l=f_[a];if(o<=l){r=l;break}}return r*s}function r7({pixelPerValue:n,targetPx:e=60,minPx:t=45,maxPx:s=75,hysteresis:o=.15,prevInterval:r=null}){const a=Math.max(1e-12,n),l=e/a,c=Math.floor(Math.log10(l));let f=l,u=l*a,d=Number.POSITIVE_INFINITY,h=!1;for(let m=c-6;m<=c+6;m++){const g=Math.pow(10,m);for(const w of f_){const C=w*g,M=C*a;if(!Number.isFinite(M))continue;const P=M>=t&&M<=s,T=Math.abs(M-e);(P&&(!h||T<d)||!h&&T<d)&&(f=C,u=M,d=T,h=P)}}if(u<t?(f=H6(t/a,"ceil"),u=f*a):u>s&&(f=H6(s/a,"floor"),u=f*a),r&&r>0){const m=r*a,g=t*(1-o),w=s*(1+o);if(m>=g&&m<=w)return{interval:r,stepPx:i7(m,0,Number.POSITIVE_INFINITY),changed:!1}}return{interval:f,stepPx:u,changed:!0}}function q6(){return{from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0}}class W3{constructor(e){$e(this,"name");$e(this,"scrollZoomEnabled",!0);$e(this,"createTicks");$e(this,"_parent");$e(this,"_range",q6());$e(this,"_prevRange",q6());$e(this,"_ticks",[]);$e(this,"_autoCalcTickFlag",!0);this._parent=e}getParent(){return this._parent}buildTicks(e){return this._autoCalcTickFlag&&(this._range=this.createRangeImp()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||e?(this._prevRange=this._range,typeof performance<"u"?performance.now():Date.now(),this._ticks=this.createTicksImp(),typeof performance<"u"?performance.now():Date.now(),!0):!1}getTicks(){return this._ticks}setRange(e){this._autoCalcTickFlag=!1,this._range=e}getRange(){return this._range}setAutoCalcTickFlag(e){this._autoCalcTickFlag=e}getAutoCalcTickFlag(){return this._autoCalcTickFlag}}const sx=8;class Y_ extends W3{constructor(t,s){super(t);$e(this,"_gridInterval",null);$e(this,"reverse",!1);$e(this,"inside",!1);$e(this,"position","right");$e(this,"gap",{top:.2,bottom:.1});$e(this,"createRange",t=>t.defaultRange);$e(this,"minSpan",t=>j_(-t));$e(this,"valueToRealValue",t=>t);$e(this,"realValueToDisplayValue",t=>t);$e(this,"displayValueToRealValue",t=>t);$e(this,"realValueToValue",t=>t);$e(this,"displayValueToText",(t,s)=>tv(t,s));this.override(s)}override(t){const{name:s,gap:o,...r}=t;pf(this.name)||(this.name=s),nh(this.gap,o),nh(this,r)}createRangeImp(){var Ve;const t=this.getParent(),s=t.getChart(),o=s.getChartStore(),r=t.getId();let a=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,c=!1,f=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;const h=o.getIndicatorsByPaneId(r);let m=4;const g=this.isInCandle(),w=!g;h.forEach(We=>{c||(c=We.shouldOhlc),d=Math.min(d,We.precision),w&&(nl(We.minValue)&&(f=Math.min(f,We.minValue)),nl(We.maxValue)&&(u=Math.max(u,We.maxValue)))}),g?m=((Ve=o.getSymbol())==null?void 0:Ve.pricePrecision)??Wh.PRICE:d!==Number.MAX_SAFE_INTEGER&&(m=d);const C=o.getVisibleRangeDataList(),M=s.getStyles().candle,P=M.type==="area",T=M.area.value,N=g&&!P||!g&&c;C.forEach(We=>{const He=We.data.current;if(Os(He)){if(N){const Ue=He.low,et=He.high;a=Math.min(a,Ue),l=Math.max(l,et)}if(g&&P){const Ue=He[T];nl(Ue)&&(a=Math.min(a,Ue),l=Math.max(l,Ue))}w&&h.forEach(({result:Ue,figures:et})=>{const ft=Ue[He.timestamp]??{};et.forEach(it=>{const Lt=ft[it.key];nl(Lt)&&(a=Math.min(a,Lt),l=Math.max(l,Lt))})})}}),a!==Number.MAX_SAFE_INTEGER&&l!==Number.MIN_SAFE_INTEGER?(a=Math.min(f,a),l=Math.max(u,l)):(a=0,l=10);const L=l-a,O={from:a,to:l,range:L,realFrom:a,realTo:l,realRange:L,displayFrom:a,displayTo:l,displayRange:L},D=this.createRange({chart:s,paneId:r,defaultRange:O});let $=D.realFrom,z=D.realTo,te=D.realRange;const pe=this.minSpan(m);if($===z||te<pe){const We=f===$,He=u===z,Ue=sx/2;$=We?$:He?$-sx*pe:$-Ue*pe,z=He?z:We?z+sx*pe:z+Ue*pe}const J=this.getEffectiveHeight(),{top:le,bottom:de}=this.gap;let he=le;he>=1&&(he=he/J);let ge=de;ge>=1&&(ge=ge/J),te=z-$,$=$-te*ge,z=z+te*he;const ae=this.realValueToValue($,{range:D}),Ie=this.realValueToValue(z,{range:D}),ce=this.realValueToDisplayValue($,{range:D}),je=this.realValueToDisplayValue(z,{range:D});return{from:ae,to:Ie,range:Ie-ae,realFrom:$,realTo:z,realRange:z-$,displayFrom:ce,displayTo:je,displayRange:je-ce}}isInCandle(){return this.getParent().getId()===ad.CANDLE}isFromZero(){return this.position==="left"&&this.inside||this.position==="right"&&!this.inside}createTicksImp(){var le;const t=this.getRange(),{displayFrom:s,displayTo:o}=t,r=Math.min(s,o),a=Math.max(s,o),l=this.getParent(),c=this.getEffectiveHeight(),f=40,u=50,d=45,h=c/Math.max(1e-12,t.realRange);let g=r7({pixelPerValue:h,targetPx:d,minPx:f,maxPx:u,hysteresis:.15,prevInterval:this._gridInterval}).interval;if(this._gridInterval=g,globalThis.__SMARTCHART_GRID_DEBUG__){const de=g*h;console.log("[grid:y]",{interval:g,stepPx:Math.round(de*100)/100,height:c})}const w=XC(g),C=[];if(g>0){let de=D6(Math.floor(r/g)*g,w);const he=D6(Math.ceil(a/g)*g,w);let ge=0;const ae=Math.ceil(c/Math.max(1,f))+10;for(;de<=he&&ge<ae;){const Ie=de.toFixed(w);C.push({text:Ie,coord:0,value:Ie}),de+=g,ge+=1}}const M=l.getChart().getChartStore(),P=[],T=M.getIndicatorsByPaneId(l.getId()),N=M.getStyles();let L=0,O=!1;this.isInCandle()?L=((le=M.getSymbol())==null?void 0:le.pricePrecision)??Wh.PRICE:T.forEach(de=>{L=Math.max(L,de.precision),O||(O=de.shouldFormatBigNumber)});const D=M.getInnerFormatter(),$=M.getThousandsSeparator(),z=M.getDecimalFold(),te=N.yAxis.tickText.size,pe=Math.max(2,Math.round(te*.35));C.forEach(({value:de})=>{let he=this.displayValueToText(+de,L);const ge=this.convertToPixel(this.realValueToValue(this.displayValueToRealValue(+de,{range:t}),{range:t}));O&&(he=D.formatBigNumber(de)),he=z.format($.format(he)),ge>=-pe&&ge<=c+pe&&P.push({text:he,coord:ge,value:de})});const J=a7({ticks:P,height:c,interval:g,shouldFormatBigNumber:O,formatter:D,thousandsSeparator:$,decimalFold:z,displayValueToText:de=>this.displayValueToText(de,L),valueToRealValue:de=>this.valueToRealValue(de,{range:t}),realValueToDisplayValue:de=>this.realValueToDisplayValue(de,{range:t}),convertFromPixel:de=>this.convertFromPixel(de)});return ng(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:J}):J}getAutoSize(){var w;const t=this.getParent(),o=t.getChart().getChartStore(),r=o.getStyles(),a=r.yAxis,l=a.size;if(l!=="auto")return l;let c=0;if(a.show&&(a.axisLine.show&&(c+=a.axisLine.size),a.ticduty.show&&(c+=a.ticduty.length),a.tickText.show)){let C=0;this.getTicks().forEach(M=>{C=Math.max(C,sh(M.text,a.tickText.size,a.tickText.weight,a.tickText.family))}),c+=a.tickText.marginStart+a.tickText.marginEnd+C}const f=r.candle.priceMark,u=f.show&&f.last.show&&f.last.text.show;let d=0;const h=r.crosshair,m=h.show&&h.horizontal.show&&h.horizontal.text.show;let g=0;if(u||m){const C=((w=o.getSymbol())==null?void 0:w.pricePrecision)??Wh.PRICE,M=this.getRange().displayTo;if(u){const P=o.getDataList(),T=P[P.length-1];if(Os(T)){const{paddingLeft:N,paddingRight:L,size:O,family:D,weight:$}=f.last.text;d=N+sh(tv(T.close,C),O,$,D)+L;const z=o.getInnerFormatter().formatExtendText;f.last.extendTexts.forEach((te,pe)=>{const J=z({type:"last_price",data:T,index:pe});J.length>0&&te.show&&(d=Math.max(d,te.paddingLeft+sh(J,te.size,te.weight,te.family)+te.paddingRight))})}}if(m){const P=o.getIndicatorsByPaneId(t.getId());let T=0,N=!1;P.forEach(D=>{T=Math.max(D.precision,T),N||(N=D.shouldFormatBigNumber)});let L=2;if(this.isInCandle()){const D=r.indicator.lastValueMark;D.show&&D.text.show?L=Math.max(T,C):L=C}else L=T;let O=tv(M,L);N&&(O=o.getInnerFormatter().formatBigNumber(O)),O=o.getDecimalFold().format(O),g+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+h.horizontal.text.borderSize*2+sh(O,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}}return Math.max(c,d,g)}getBounding(){return this.getParent().getYAxisWidget().getBounding()}convertFromPixel(t){const s=this.getEffectiveHeight(),o=this.getRange(),{realFrom:r,realRange:a}=o;if(!Number.isFinite(s)||s<=0||!Number.isFinite(a)||a===0)return this.realValueToValue(r,{range:o});const c=(this.reverse?t/s:1-t/s)*a+r;return this.realValueToValue(c,{range:o})}convertToPixel(t){const s=this.getRange(),o=this.valueToRealValue(t,{range:s}),r=this.getEffectiveHeight(),{realFrom:a,realRange:l}=s;if(!Number.isFinite(r)||r<=0||!Number.isFinite(l)||l===0)return 0;const c=(o-a)/l;return this.reverse?Math.round(c*r):Math.round((1-c)*r)}convertToNicePixel(t){const s=this.getEffectiveHeight(),o=this.convertToPixel(t);return Math.round(Math.max(s*.05,Math.min(o,s*.98)))}getEffectiveHeight(){var o,r;const t=this.getParent(),s=((o=t.getYAxisWidget())==null?void 0:o.getBounding().height)??0;return s>0?s:((r=t.getMainWidget())==null?void 0:r.getBounding().height)??0}static extend(t){class s extends Y_{constructor(r){super(r,t)}}return s}}function a7({ticks:n,height:e,interval:t,shouldFormatBigNumber:s,formatter:o,thousandsSeparator:r,decimalFold:a,displayValueToText:l,valueToRealValue:c,realValueToDisplayValue:f,convertFromPixel:u}){if(n.length<2||e<=0||!Number.isFinite(t))return n;const d=[...n].sort((N,L)=>N.coord-L.coord),h=[];for(let N=1;N<d.length;N+=1){const L=d[N].coord-d[N-1].coord;L>0&&h.push(L)}if(h.length===0)return n;h.sort((N,L)=>N-L);const m=Math.floor(h.length/2),g=h.length%2===0?(h[m-1]+h[m])/2:h[m];if(!Number.isFinite(g)||g<=0)return n;const w=new Set;d.forEach(N=>w.add(Math.round(N.coord)));const C=[],M=N=>{const L=Math.round(N);if(w.has(L)||N<0||N>e)return;const O=u(N),D=f(c(O));let $=l(D);s&&($=o.formatBigNumber(D)),$=a.format(r.format($)),C.push({text:$,coord:N,value:D}),w.add(L)};let P=d[0].coord-g;for(;P>=0;)M(P),P-=g;let T=d[d.length-1].coord+g;for(;T<=e;)M(T),T+=g;return C.length===0?n:[...d,...C].sort((N,L)=>N.coord-L.coord)}const l7={name:"normal"},c7={name:"percentage",minSpan:()=>Math.pow(10,-2),displayValueToText:n=>`${tv(n,2)}%`,valueToRealValue:(n,{range:e})=>(n-e.from)/e.range*e.realRange+e.realFrom,realValueToValue:(n,{range:e})=>(n-e.realFrom)/e.realRange*e.range+e.from,createRange:({chart:n,defaultRange:e})=>{const t=n.getDataList(),s=n.getVisibleRange(),o=t[s.from];if(Os(o)){const{from:r,to:a,range:l}=e,c=(e.from-o.close)/o.close*100,f=(e.to-o.close)/o.close*100,u=f-c;return{from:r,to:a,range:l,realFrom:c,realTo:f,realRange:u,displayFrom:c,displayTo:f,displayRange:u}}return e}},u7={name:"logarithm",minSpan:n=>.05*j_(-n),valueToRealValue:n=>n<0?-H0(Math.abs(n)):H0(n),realValueToDisplayValue:n=>n<0?-j_(Math.abs(n)):j_(n),displayValueToRealValue:n=>n<0?-H0(Math.abs(n)):H0(n),realValueToValue:n=>n<0?-j_(Math.abs(n)):j_(n),createRange:({defaultRange:n})=>{const{from:e,to:t,range:s}=n,o=e<0?-H0(Math.abs(e)):H0(e),r=t<0?-H0(Math.abs(t)):H0(t);return{from:e,to:t,range:s,realFrom:o,realTo:r,realRange:r-o,displayFrom:e,displayTo:t,displayRange:s}}},U6={normal:Y_.extend(l7),percentage:Y_.extend(c7),logarithm:Y_.extend(u7)};function d7(n){return U6[n]??U6.normal}class H3{constructor(e,t){$e(this,"_container");$e(this,"_id");$e(this,"_chart");$e(this,"_bounding",i2());$e(this,"_originalBounding",i2());$e(this,"_visible",!0);this._chart=e,this._id=t,this._container=R0("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._container.classList.add("dutycharts-pane",`dutycharts-pane-${t}`),this._container.setAttribute("data-pane-id",t)}getContainer(){return this._container}setVisible(e){this._visible!==e&&(this._container.style.display=e?"block":"none",this._visible=e)}getVisible(){return this._visible}getId(){return this._id}getChart(){return this._chart}getBounding(){return this._bounding}setOriginalBounding(e){nh(this._originalBounding,e)}getOriginalBounding(){return this._originalBounding}update(e){this._bounding.height!==this._container.clientHeight&&(this._container.style.height=`${this._bounding.height}px`),this.updateImp(e??Ef.Drawer,this._container,this._bounding)}}class q3 extends H3{constructor(t,s,o){super(t,s);$e(this,"_mainWidget");$e(this,"_yAxisWidget",null);$e(this,"_yAxisLabelSlots",[]);$e(this,"_yAxisBaseLabelSlots",[]);$e(this,"_axis");$e(this,"_options",{id:"",minHeight:ny,dragEnabled:!0,order:0,height:P3,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}});const r=this.getContainer();this._mainWidget=this.createMainWidget(r),this._yAxisWidget=this.createYAxisWidget(r),this.setOptions(o)}setOptions(t){var a,l,c;const s=this.getId();if(s===ad.CANDLE||s===ad.X_AXIS){const f=(a=t.axis)==null?void 0:a.name;(!Os(this._axis)||Os(f)&&this._options.axis.name!==f)&&(this._axis=this.createAxisComponent(f??"normal"))}else Os(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof Y_&&this._axis.setAutoCalcTickFlag(!0),nh(this._options,t),this._axis.override({...this._options.axis,name:((l=t.axis)==null?void 0:l.name)??"normal"});let o=null,r="default";return this.getId()===ad.X_AXIS?(o=this.getMainWidget().getContainer(),r="ew-resize"):(o=this.getYAxisWidget().getContainer(),r="ns-resize"),((c=t.axis)==null?void 0:c.scrollZoomEnabled)??!0?o.style.cursor=r:o.style.cursor="default",this}getOptions(){return this._options}getAxisComponent(){return this._axis}setBounding(t,s,o,r){nh(this.getBounding(),t);const a={};Os(t.height)&&(a.height=t.height),Os(t.top)&&(a.top=t.top),this._mainWidget.setBounding(a);const l=Os(s);return l&&this._mainWidget.setBounding(s),Os(this._yAxisWidget)&&(this._yAxisWidget.setBounding(a),this._axis.position==="left"?Os(o)&&this._yAxisWidget.setBounding({...o,left:0}):Os(r)&&(this._yAxisWidget.setBounding(r),l&&this._yAxisWidget.setBounding({left:(s.left??0)+(s.width??0)+(s.right??0)-(r.width??0)}))),this}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}resetYAxisLabelSlots(){this._yAxisLabelSlots=[],this._yAxisBaseLabelSlots=[]}commitYAxisLabelSlots(){this._yAxisBaseLabelSlots=this._yAxisLabelSlots.map(t=>({top:t.top,bottom:t.bottom}))}resetYAxisOverlaySlots(){this._yAxisLabelSlots=this._yAxisBaseLabelSlots.map(t=>({top:t.top,bottom:t.bottom}))}placeYAxisLabel(t,s,o){const r=s/2,a=r,l=o-r;if(!Number.isFinite(a)||!Number.isFinite(l)||a>l)return null;const c=2,f=this._yAxisLabelSlots.map(w=>({start:w.top-c-r,end:w.bottom+c+r})).sort((w,C)=>w.start-C.start),u=[];f.forEach(w=>{const C=Math.max(w.start,a),M=Math.min(w.end,l);if(M<=a||C>=l)return;const P=u[u.length-1];P&&C<=P.end?P.end=Math.max(P.end,M):u.push({start:C,end:M})});const d=[];let h=a;if(u.forEach(w=>{w.start>h&&d.push({start:h,end:w.start}),h=Math.max(h,w.end)}),h<l&&d.push({start:h,end:l}),d.length===0)return null;let m=null,g=Number.POSITIVE_INFINITY;return d.forEach(w=>{let C=t;C<w.start&&(C=w.start),C>w.end&&(C=w.end);const M=Math.abs(C-t);M<g&&(g=M,m=C)}),m===null?null:(this._yAxisLabelSlots.push({top:m-r,bottom:m+r}),m)}updateImp(t){var s;this._mainWidget.update(t),(s=this._yAxisWidget)==null||s.update(t)}destroy(){var t;this._mainWidget.destroy(),(t=this._yAxisWidget)==null||t.destroy()}getImage(t){const{width:s,height:o}=this.getBounding(),r=R0("canvas",{width:`${s}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=t_(r);r.width=s*l,r.height=o*l,a.scale(l,l);const c=this._mainWidget.getBounding();if(a.drawImage(this._mainWidget.getImage(t),c.left,0,c.width,c.height),this._yAxisWidget!==null){const f=this._yAxisWidget.getBounding();a.drawImage(this._yAxisWidget.getImage(t),f.left,0,f.width,f.height)}return r}createYAxisWidget(t){return null}}class U3 extends q3{createAxisComponent(e){const t=d7(e??"default");return new t(this)}createMainWidget(e){return new j3(e,this)}createYAxisWidget(e){return new o7(e,this)}}class f7 extends U3{createMainWidget(e){return new e7(e,this)}}class p7 extends O3{drawImp(e,t){var f,u,d;const s=this.getWidget(),o=s.getPane(),r=s.getBounding(),a=o.getAxisComponent(),l=this.getAxisStyles(o.getChart().getStyles());if(!l.show||(l.axisLine.show&&((f=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||f.draw(e)),t[0]))return;const c=a.getTicks();if(l.ticduty.show&&this.createTicdutys(c,r,l).forEach(m=>{var g;(g=this.createFigure({name:"line",attrs:m,styles:l.ticduty}))==null||g.draw(e)}),l.tickText.show){const h=this.createTickTexts(c,r,l),m=h.filter((w,C)=>{var M;return(M=c[C])==null?void 0:M.isYear}),g=h.filter((w,C)=>{var M;return!((M=c[C])!=null&&M.isYear)});g.length>0&&((u=this.createFigure({name:"text",attrs:g,styles:l.tickText}))==null||u.draw(e)),m.length>0&&((d=this.createFigure({name:"text",attrs:m,styles:{...l.tickText,weight:"600"}}))==null||d.draw(e))}}getAxisStyles(e){return e.xAxis}createAxisLine(e){return{coordinates:[{x:0,y:0},{x:e.width,y:0}]}}createTicdutys(e,t,s){const o=s.ticduty,r=s.axisLine.size;return e.map(a=>({coordinates:[{x:a.coord,y:0},{x:a.coord,y:r+o.length}]}))}createTickTexts(e,t,s){const o=s.tickText,r=s.axisLine.size,a=s.ticduty.length;return e.map(l=>({x:l.coord,y:r+a+o.marginStart+(l.textOffset??0),text:l.text,align:"center",baseline:"top"}))}}class m7 extends z3{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()}getProgressOverlay(){var e;return((e=this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo())==null?void 0:e.overlay)??null}getDefaultFigures(e,t){var c;const s=[],o=this.getWidget(),a=o.getPane().getChart().getChartStore(),l=a.getClickOverlayInfo();if(e.needDefaultXAxisFigure&&e.id===((c=l.overlay)==null?void 0:c.id)){let f=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;t.forEach((d,h)=>{var g,w;f=Math.min(f,d.x),u=Math.max(u,d.x);const m=e.points[h];if(nl(m.timestamp)){const C=a.getInnerFormatter().formatDate(m.timestamp,"YYYY-MM-DD HH:mm","crosshair"),M=o.getBounding().height,P=this.getAxisLabelTextStyle(e),T=((w=(g=e.styles)==null?void 0:g.text)==null?void 0:w.size)??(a.getStyles().overlay.text.size||12),N=Math.max(0,Math.round((M-T)/2));s.push({type:"text",attrs:{x:d.x,y:0,text:C,align:"center",baseline:"top",height:M},styles:{...P,size:T,paddingTop:N,paddingBottom:N},ignoreEvent:!0})}}),t.length>1&&s.unshift({type:"rect",attrs:{x:f,y:0,width:u-f,height:o.getBounding().height},ignoreEvent:!0})}return s}getFigures(e,t){var f;const s=this.getWidget(),o=s.getPane(),r=o.getChart(),a=o.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=s.getBounding();return((f=e.createXAxisFigures)==null?void 0:f.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class h7 extends V3{drawImp(e){var a;const t=this.getWidget(),s=t.getPane().getChart().getChartStore(),o=s.getCrosshair(),r=s.getStyles().crosshair;if(r.show){const l=this.getDirectionStyles(r),c=l.text;if(l.show&&c.show&&this.compare(o)){const f=t.getBounding(),u=t.getPane().getAxisComponent(),d=this.getText(o,s),h=s.getStyles().xAxis.tickText,m={...c,size:h.size,family:h.family,weight:h.weight};e.font=E0(m.size,m.weight,m.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(d,e.measureText(d).width,o,f,u,m),styles:m}))==null||a.draw(e)}}}compare(e){return Os(e.timestamp)}getDirectionStyles(e){return e.vertical}getText(e,t){var o;const s=e.timestamp;return t.getInnerFormatter().formatDate(s,B3[((o=t.getPeriod())==null?void 0:o.type)??"day"],"crosshair")}getTextAttrs(e,t,s,o,r,a){const c=this.getWidget().getPane().getChart().getStyles().xAxis,f=c.axisLine.size,u=c.ticduty.length,d=f+u+c.tickText.marginStart-(a.paddingTop??0),h=s.realX;let m=0,g="center";return h-t/2-a.paddingLeft<0?(m=0,g="left"):h+t/2+a.paddingRight>o.width?(m=o.width,g="right"):m=h,{x:m,y:d,text:e,align:g,baseline:"top"}}}class v7 extends jw{constructor(t,s){super(t,s);$e(this,"_xAxisView",new p7(this));$e(this,"_overlayXAxisView",new m7(this));$e(this,"_crosshairVerticalLabelView",new h7(this));this.setCursor("ew-resize"),this.addChild(this._overlayXAxisView)}getName(){return ed.X_AXIS}updateMain(t){this._xAxisView.draw(t)}updateUnderlay(t){}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}var F0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _y(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var G3={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(F0,function(){var t=1e3,s=6e4,o=36e5,r="millisecond",a="second",l="minute",c="hour",f="day",u="week",d="month",h="quarter",m="year",g="date",w="Invalid Date",C=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,M=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,P={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(de){var he=["th","st","nd","rd"],ge=de%100;return"["+de+(he[(ge-20)%10]||he[ge]||he[0])+"]"}},T=function(de,he,ge){var ae=String(de);return!ae||ae.length>=he?de:""+Array(he+1-ae.length).join(ge)+de},N={s:T,z:function(de){var he=-de.utcOffset(),ge=Math.abs(he),ae=Math.floor(ge/60),Ie=ge%60;return(he<=0?"+":"-")+T(ae,2,"0")+":"+T(Ie,2,"0")},m:function de(he,ge){if(he.date()<ge.date())return-de(ge,he);var ae=12*(ge.year()-he.year())+(ge.month()-he.month()),Ie=he.clone().add(ae,d),ce=ge-Ie<0,je=he.clone().add(ae+(ce?-1:1),d);return+(-(ae+(ge-Ie)/(ce?Ie-je:je-Ie))||0)},a:function(de){return de<0?Math.ceil(de)||0:Math.floor(de)},p:function(de){return{M:d,y:m,w:u,d:f,D:g,h:c,m:l,s:a,ms:r,Q:h}[de]||String(de||"").toLowerCase().replace(/s$/,"")},u:function(de){return de===void 0}},L="en",O={};O[L]=P;var D="$isDayjsObject",$=function(de){return de instanceof J||!(!de||!de[D])},z=function de(he,ge,ae){var Ie;if(!he)return L;if(typeof he=="string"){var ce=he.toLowerCase();O[ce]&&(Ie=ce),ge&&(O[ce]=ge,Ie=ce);var je=he.split("-");if(!Ie&&je.length>1)return de(je[0])}else{var Ve=he.name;O[Ve]=he,Ie=Ve}return!ae&&Ie&&(L=Ie),Ie||!ae&&L},te=function(de,he){if($(de))return de.clone();var ge=typeof he=="object"?he:{};return ge.date=de,ge.args=arguments,new J(ge)},pe=N;pe.l=z,pe.i=$,pe.w=function(de,he){return te(de,{locale:he.$L,utc:he.$u,x:he.$x,$offset:he.$offset})};var J=function(){function de(ge){this.$L=z(ge.locale,null,!0),this.parse(ge),this.$x=this.$x||ge.x||{},this[D]=!0}var he=de.prototype;return he.parse=function(ge){this.$d=function(ae){var Ie=ae.date,ce=ae.utc;if(Ie===null)return new Date(NaN);if(pe.u(Ie))return new Date;if(Ie instanceof Date)return new Date(Ie);if(typeof Ie=="string"&&!/Z$/i.test(Ie)){var je=Ie.match(C);if(je){var Ve=je[2]-1||0,We=(je[7]||"0").substring(0,3);return ce?new Date(Date.UTC(je[1],Ve,je[3]||1,je[4]||0,je[5]||0,je[6]||0,We)):new Date(je[1],Ve,je[3]||1,je[4]||0,je[5]||0,je[6]||0,We)}}return new Date(Ie)}(ge),this.init()},he.init=function(){var ge=this.$d;this.$y=ge.getFullYear(),this.$M=ge.getMonth(),this.$D=ge.getDate(),this.$W=ge.getDay(),this.$H=ge.getHours(),this.$m=ge.getMinutes(),this.$s=ge.getSeconds(),this.$ms=ge.getMilliseconds()},he.$utils=function(){return pe},he.isValid=function(){return this.$d.toString()!==w},he.isSame=function(ge,ae){var Ie=te(ge);return this.startOf(ae)<=Ie&&Ie<=this.endOf(ae)},he.isAfter=function(ge,ae){return te(ge)<this.startOf(ae)},he.isBefore=function(ge,ae){return this.endOf(ae)<te(ge)},he.$g=function(ge,ae,Ie){return pe.u(ge)?this[ae]:this.set(Ie,ge)},he.unix=function(){return Math.floor(this.valueOf()/1e3)},he.valueOf=function(){return this.$d.getTime()},he.startOf=function(ge,ae){var Ie=this,ce=!!pe.u(ae)||ae,je=pe.p(ge),Ve=function(Tt,Pt){var St=pe.w(Ie.$u?Date.UTC(Ie.$y,Pt,Tt):new Date(Ie.$y,Pt,Tt),Ie);return ce?St:St.endOf(f)},We=function(Tt,Pt){return pe.w(Ie.toDate()[Tt].apply(Ie.toDate("s"),(ce?[0,0,0,0]:[23,59,59,999]).slice(Pt)),Ie)},He=this.$W,Ue=this.$M,et=this.$D,ft="set"+(this.$u?"UTC":"");switch(je){case m:return ce?Ve(1,0):Ve(31,11);case d:return ce?Ve(1,Ue):Ve(0,Ue+1);case u:var it=this.$locale().weekStart||0,Lt=(He<it?He+7:He)-it;return Ve(ce?et-Lt:et+(6-Lt),Ue);case f:case g:return We(ft+"Hours",0);case c:return We(ft+"Minutes",1);case l:return We(ft+"Seconds",2);case a:return We(ft+"Milliseconds",3);default:return this.clone()}},he.endOf=function(ge){return this.startOf(ge,!1)},he.$set=function(ge,ae){var Ie,ce=pe.p(ge),je="set"+(this.$u?"UTC":""),Ve=(Ie={},Ie[f]=je+"Date",Ie[g]=je+"Date",Ie[d]=je+"Month",Ie[m]=je+"FullYear",Ie[c]=je+"Hours",Ie[l]=je+"Minutes",Ie[a]=je+"Seconds",Ie[r]=je+"Milliseconds",Ie)[ce],We=ce===f?this.$D+(ae-this.$W):ae;if(ce===d||ce===m){var He=this.clone().set(g,1);He.$d[Ve](We),He.init(),this.$d=He.set(g,Math.min(this.$D,He.daysInMonth())).$d}else Ve&&this.$d[Ve](We);return this.init(),this},he.set=function(ge,ae){return this.clone().$set(ge,ae)},he.get=function(ge){return this[pe.p(ge)]()},he.add=function(ge,ae){var Ie,ce=this;ge=Number(ge);var je=pe.p(ae),Ve=function(Ue){var et=te(ce);return pe.w(et.date(et.date()+Math.round(Ue*ge)),ce)};if(je===d)return this.set(d,this.$M+ge);if(je===m)return this.set(m,this.$y+ge);if(je===f)return Ve(1);if(je===u)return Ve(7);var We=(Ie={},Ie[l]=s,Ie[c]=o,Ie[a]=t,Ie)[je]||1,He=this.$d.getTime()+ge*We;return pe.w(He,this)},he.subtract=function(ge,ae){return this.add(-1*ge,ae)},he.format=function(ge){var ae=this,Ie=this.$locale();if(!this.isValid())return Ie.invalidDate||w;var ce=ge||"YYYY-MM-DDTHH:mm:ssZ",je=pe.z(this),Ve=this.$H,We=this.$m,He=this.$M,Ue=Ie.weekdays,et=Ie.months,ft=Ie.meridiem,it=function(Pt,St,st,xt){return Pt&&(Pt[St]||Pt(ae,ce))||st[St].slice(0,xt)},Lt=function(Pt){return pe.s(Ve%12||12,Pt,"0")},Tt=ft||function(Pt,St,st){var xt=Pt<12?"AM":"PM";return st?xt.toLowerCase():xt};return ce.replace(M,function(Pt,St){return St||function(st){switch(st){case"YY":return String(ae.$y).slice(-2);case"YYYY":return pe.s(ae.$y,4,"0");case"M":return He+1;case"MM":return pe.s(He+1,2,"0");case"MMM":return it(Ie.monthsShort,He,et,3);case"MMMM":return it(et,He);case"D":return ae.$D;case"DD":return pe.s(ae.$D,2,"0");case"d":return String(ae.$W);case"dd":return it(Ie.weekdaysMin,ae.$W,Ue,2);case"ddd":return it(Ie.weekdaysShort,ae.$W,Ue,3);case"dddd":return Ue[ae.$W];case"H":return String(Ve);case"HH":return pe.s(Ve,2,"0");case"h":return Lt(1);case"hh":return Lt(2);case"a":return Tt(Ve,We,!0);case"A":return Tt(Ve,We,!1);case"m":return String(We);case"mm":return pe.s(We,2,"0");case"s":return String(ae.$s);case"ss":return pe.s(ae.$s,2,"0");case"SSS":return pe.s(ae.$ms,3,"0");case"Z":return je}return null}(Pt)||je.replace(":","")})},he.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},he.diff=function(ge,ae,Ie){var ce,je=this,Ve=pe.p(ae),We=te(ge),He=(We.utcOffset()-this.utcOffset())*s,Ue=this-We,et=function(){return pe.m(je,We)};switch(Ve){case m:ce=et()/12;break;case d:ce=et();break;case h:ce=et()/3;break;case u:ce=(Ue-He)/6048e5;break;case f:ce=(Ue-He)/864e5;break;case c:ce=Ue/o;break;case l:ce=Ue/s;break;case a:ce=Ue/t;break;default:ce=Ue}return Ie?ce:pe.a(ce)},he.daysInMonth=function(){return this.endOf(d).$D},he.$locale=function(){return O[this.$L]},he.locale=function(ge,ae){if(!ge)return this.$L;var Ie=this.clone(),ce=z(ge,ae,!0);return ce&&(Ie.$L=ce),Ie},he.clone=function(){return pe.w(this.$d,this)},he.toDate=function(){return new Date(this.valueOf())},he.toJSON=function(){return this.isValid()?this.toISOString():null},he.toISOString=function(){return this.$d.toISOString()},he.toString=function(){return this.$d.toUTCString()},de}(),le=J.prototype;return te.prototype=le,[["$ms",r],["$s",a],["$m",l],["$H",c],["$W",f],["$M",d],["$y",m],["$D",g]].forEach(function(de){le[de[1]]=function(he){return this.$g(he,de[0],de[1])}}),te.extend=function(de,he){return de.$i||(de(he,J,te),de.$i=!0),te},te.locale=z,te.isDayjs=$,te.unix=function(de){return te(1e3*de)},te.en=O[L],te.Ls=O,te.p={},te})})(G3);var g7=G3.exports;const vp=_y(g7);var Y3={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(F0,function(){var t="minute",s=/[+-]\d\d(?::?\d\d)?/g,o=/([+-]|\d\d)/g;return function(r,a,l){var c=a.prototype;l.utc=function(w){var C={date:w,utc:!0,args:arguments};return new a(C)},c.utc=function(w){var C=l(this.toDate(),{locale:this.$L,utc:!0});return w?C.add(this.utcOffset(),t):C},c.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var f=c.parse;c.parse=function(w){w.utc&&(this.$u=!0),this.$utils().u(w.$offset)||(this.$offset=w.$offset),f.call(this,w)};var u=c.init;c.init=function(){if(this.$u){var w=this.$d;this.$y=w.getUTCFullYear(),this.$M=w.getUTCMonth(),this.$D=w.getUTCDate(),this.$W=w.getUTCDay(),this.$H=w.getUTCHours(),this.$m=w.getUTCMinutes(),this.$s=w.getUTCSeconds(),this.$ms=w.getUTCMilliseconds()}else u.call(this)};var d=c.utcOffset;c.utcOffset=function(w,C){var M=this.$utils().u;if(M(w))return this.$u?0:M(this.$offset)?d.call(this):this.$offset;if(typeof w=="string"&&(w=function(L){L===void 0&&(L="");var O=L.match(s);if(!O)return null;var D=(""+O[0]).match(o)||["-",0,0],$=D[0],z=60*+D[1]+ +D[2];return z===0?0:$==="+"?z:-z}(w),w===null))return this;var P=Math.abs(w)<=16?60*w:w,T=this;if(C)return T.$offset=P,T.$u=w===0,T;if(w!==0){var N=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(T=this.local().add(P+N,t)).$offset=P,T.$x.$localOffset=N}else T=this.utc();return T};var h=c.format;c.format=function(w){var C=w||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,C)},c.valueOf=function(){var w=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*w},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var m=c.toDate;c.toDate=function(w){return w==="s"&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():m.call(this)};var g=c.diff;c.diff=function(w,C,M){if(w&&this.$u===w.$u)return g.call(this,w,C,M);var P=this.local(),T=l(w).local();return g.call(P,T,C,M)}}})})(Y3);var _7=Y3.exports;const Vw=_y(_7);var K3={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(F0,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},s={};return function(o,r,a){var l,c=function(h,m,g){g===void 0&&(g={});var w=new Date(h),C=function(M,P){P===void 0&&(P={});var T=P.timeZoneName||"short",N=M+"|"+T,L=s[N];return L||(L=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:M,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:T}),s[N]=L),L}(m,g);return C.formatToParts(w)},f=function(h,m){for(var g=c(h,m),w=[],C=0;C<g.length;C+=1){var M=g[C],P=M.type,T=M.value,N=t[P];N>=0&&(w[N]=parseInt(T,10))}var L=w[3],O=L===24?0:L,D=w[0]+"-"+w[1]+"-"+w[2]+" "+O+":"+w[4]+":"+w[5]+":000",$=+h;return(a.utc(D).valueOf()-($-=$%1e3))/6e4},u=r.prototype;u.tz=function(h,m){h===void 0&&(h=l);var g,w=this.utcOffset(),C=this.toDate(),M=C.toLocaleString("en-US",{timeZone:h}),P=Math.round((C-new Date(M))/1e3/60),T=15*-Math.round(C.getTimezoneOffset()/15)-P;if(!Number(T))g=this.utcOffset(0,m);else if(g=a(M,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(T,!0),m){var N=g.utcOffset();g=g.add(w-N,"minute")}return g.$x.$timezone=h,g},u.offsetName=function(h){var m=this.$x.$timezone||a.tz.guess(),g=c(this.valueOf(),m,{timeZoneName:h}).find(function(w){return w.type.toLowerCase()==="timezonename"});return g&&g.value};var d=u.startOf;u.startOf=function(h,m){if(!this.$x||!this.$x.$timezone)return d.call(this,h,m);var g=a(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return d.call(g,h,m).tz(this.$x.$timezone,!0)},a.tz=function(h,m,g){var w=g&&m,C=g||m||l,M=f(+a(),C);if(typeof h!="string")return a(h).tz(C);var P=function(O,D,$){var z=O-60*D*1e3,te=f(z,$);if(D===te)return[z,D];var pe=f(z-=60*(te-D)*1e3,$);return te===pe?[z,te]:[O-60*Math.min(te,pe)*1e3,Math.max(te,pe)]}(a.utc(h,w).valueOf(),M,C),T=P[0],N=P[1],L=a(T).utcOffset(N);return L.$x.$timezone=C,L},a.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},a.tz.setDefault=function(h){l=h}}})})(K3);var y7=K3.exports;const Ww=_y(y7);vp.extend(Vw);vp.extend(Ww);const r2=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a2=["minute","hour","day","month","year"],Kx={minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,year:365*24*60*60*1e3},G6={minute:[1,2,5,10,15,30],hour:[1,2,3,4,6,8,12],day:[1],month:[1],year:[1]},ab={year:"2024",month:"Sep",day:"30",time:"00:00"};function U1(n){const e=a2.indexOf(n);return e===-1?0:e}function b7(n){return a2.includes(n)?n:"minute"}function x7(n){switch(n){case"hour":return"hour";case"day":case"week":return"day";case"month":return"month";case"year":return"year";case"minute":case"second":default:return"minute"}}function X3(n){const e=Number((n==null?void 0:n.size)??12);return Math.max(6,Math.round(e*.45))}function w7(n,e){const t=n(ab.year,e),s=n(ab.month,e),o=n(ab.day,e),r=n(ab.time,e),a=X3(e);return{padding:a,minLabelPxByUnit:{minute:r+a,hour:r+a,day:Math.max(o,s,t)+a,month:Math.max(s,t)+a,year:t+a}}}function k7(n,e,t,s){const o=s.targetPx,r=s.minPx,a=s.maxPx,l=U1(e);let c=null;for(let d=l;d<a2.length;d++){const h=a2[d],m=G6[h],g=Kx[h],w=Math.max(t[h],r);let C=null,M=Number.POSITIVE_INFINITY,P=!1;if(m.forEach(T=>{const N=g*T*n;if(N<w)return;const L=N>=r&&N<=a,O=Math.abs(N-o);(L&&(!P||O<M)||!P&&O<M)&&(C=T,M=O,P=L)}),C!==null){if(P)return{unit:h,step:C,minLabelPx:w};c||(c={unit:h,step:C,minLabelPx:w})}}if(c)return c;const f="year",u=G6[f];return{unit:f,step:u[u.length-1],minLabelPx:Math.max(t[f],r)}}function S7(n,e,t,s,o,r){if(!n)return e;const a=U1(o);if(U1(n.unit)<a)return e;const l=r.hysteresis,c=n.unit,f=e.unit,u=Kx[c]*n.step*t,d=Kx[f]*e.step*t,h=Math.max(s[c],r.minPx),m=Math.max(s[f],r.minPx),g=U1(c),w=U1(f),C=r.minPx,M=r.maxPx,P=u>=C*(1-l)&&u<=M*(1+l);if(w>g){if(u>=h*(1-l)&&P)return{...n,minLabelPx:h}}else if(w<g){if(d<m*(1+l)&&P)return{...n,minLabelPx:h}}else if(e.step!==n.step&&u>=Math.max(h,C)*(1-l)&&u<=Math.max(h,C)*(1+l))return{...n,minLabelPx:h};return e}function Y6(n){const e=n.date(),t=n.month();return e===1?t===0?String(n.year()):r2[t]:String(e)}function C7(n,e){switch(e){case"year":return{text:String(n.year()),isMajor:!0,isYear:!0};case"month":return n.month()===0?{text:String(n.year()),isMajor:!0,isYear:!0}:{text:r2[n.month()],isMajor:!1,isYear:!1};case"day":{const t=n.date();return t===1?n.month()===0?{text:String(n.year()),isMajor:!0,isYear:!0}:{text:Y6(n),isMajor:!0,isYear:!1}:{text:String(t),isMajor:!1,isYear:!1}}case"hour":case"minute":return n.hour()===0&&n.minute()===0?n.date()===1&&n.month()===0?{text:String(n.year()),isMajor:!0,isYear:!0}:{text:Y6(n),isMajor:!0,isYear:!1}:{text:n.format("HH:mm"),isMajor:!1,isYear:!1};default:return{text:"",isMajor:!1,isYear:!1}}}function I7(n,e,t,s){if(s&&e.isYearBoundary)return{text:String(n.year()),isMajor:!0,isYear:!0,labelType:"year"};if(s&&e.isMonthBoundary)return{text:r2[n.month()],isMajor:!0,isYear:!1,labelType:"month"};if(s&&e.isDayBoundary&&(t.unit==="hour"||t.unit==="minute"))return{text:String(n.date()),isMajor:!0,isYear:!1,labelType:"day"};if(s&&t.unit==="year"&&!e.isYearBoundary)return{text:r2[n.month()],isMajor:!1,isYear:!1,labelType:"fallback-month"};if(s&&t.unit==="month"&&!e.isMonthBoundary)return{text:String(n.date()),isMajor:!1,isYear:!1,labelType:"fallback-day"};const o=C7(n,t.unit);return o.text?{text:o.text,isMajor:o.isMajor,isYear:o.isYear,labelType:t.unit}:{text:"",isMajor:!1,isYear:!1,labelType:""}}function P7(n,e,t){return Number.isFinite(n)?n<-t||n>e+t:!0}function M7({from:n,to:e,width:t,textStyles:s,measureText:o,minUnit:r,prevState:a,gridTargetPx:l=60,gridMinPx:c=45,gridMaxPx:f=75,gridHysteresis:u=.15,pxPerMsOverride:d}){if(!Number.isFinite(n)||!Number.isFinite(e)||!Number.isFinite(t)||t<=0)return{state:a??null,padding:0,pxPerMs:0};const h=Math.min(n,e),m=Math.max(n,e),g=Math.max(1,m-h),w=Number.isFinite(d)?d:t/g,C=b7(r??"minute"),{padding:M,minLabelPxByUnit:P}=w7(o,s),T={targetPx:l,minPx:c,maxPx:f,hysteresis:u},N=k7(w,C,P,T);return{state:S7(a,N,w,P,C,T),padding:M,pxPerMs:w}}function N7({ticks:n,timezone:e,width:t,textStyles:s,measureText:o,state:r,paddingOverride:a}){if(!r||!Array.isArray(n)||n.length===0)return n;const l=e||vp.tz.guess(),c=typeof a=="number"?a:X3(s);n.sort((u,d)=>u.coord-d.coord),n.forEach(u=>{u.text="",u.textOffset=0,u.isMajor=!1,u.isYear=!1});let f=n.some(u=>u.isYearBoundary||u.isMonthBoundary||u.isDayBoundary);if(!f){n.forEach(d=>{d.isYearBoundary=!1,d.isMonthBoundary=!1,d.isDayBoundary=!1});let u=null;n.forEach(d=>{const h=d.value;if(!Number.isFinite(h))return;const m=vp.tz(h,l),g={year:m.year(),month:m.month(),day:m.date()};u&&(g.year!==u.year?(d.isYearBoundary=!0,d.isMonthBoundary=!0,d.isDayBoundary=!0):g.month!==u.month?(d.isMonthBoundary=!0,d.isDayBoundary=!0):g.day!==u.day&&(d.isDayBoundary=!0)),u=g}),f=n.some(d=>d.isYearBoundary||d.isMonthBoundary||d.isDayBoundary)}return n.forEach(u=>{const d=u.value;if(!Number.isFinite(d)||P7(u.coord,t,c))return;const h=vp.tz(d,l),m=I7(h,u,r,f);m.text&&(u.text=m.text,u.textOffset=0,u.isMajor=m.isMajor,u.isYear=m.isYear)}),n}class Hw extends W3{constructor(t,s){super(t);$e(this,"_timeAxisState",null);this.override(s)}override(t){const{name:s,scrollZoomEnabled:o,createTicks:r}=t;pf(this.name)||(this.name=s),this.scrollZoomEnabled=o??this.scrollZoomEnabled,this.createTicks=r??this.createTicks}createRangeImp(){const s=this.getParent().getChart().getChartStore().getVisibleRange(),{realFrom:o,realTo:r}=s,a=o,l=r,c=r-o+1;return{from:a,to:l,range:c,realFrom:a,realTo:l,realRange:c,displayFrom:a,displayTo:l,displayRange:c}}createTicksImp(){const{realFrom:t,realTo:s}=this.getRange(),o=this.getParent().getChart().getChartStore(),r=o.getPeriod(),a=o.getStyles().xAxis.tickText,l=this.getBounding().width,c=o.dataIndexToTimestamp(t),f=o.dataIndexToTimestamp(s);if(!nl(c)||!nl(f)||l<=0)return[];const u=o.getBarSpace().bar,d=A7(r),h=nl(d)&&d>0?u/d:void 0,m=x7(r==null?void 0:r.type),g=60,w=50,C=140,P=M7({from:c,to:f,width:l,textStyles:a,minUnit:m,prevState:this._timeAxisState,gridTargetPx:g,gridMinPx:w,gridMaxPx:C,gridHysteresis:.15,pxPerMsOverride:h,measureText:L=>sh(L,a.size,a.weight,a.family)});this._timeAxisState=P.state;const T=[],N=o.getDateTimeFormat();return T7({ticks:T,barSpace:u,chartStore:o,dateTimeFormat:N,state:P.state,width:l,fromTimestamp:c,toTimestamp:f,gridMinPx:w,gridMaxPx:C}),E7({ticks:T,chartStore:o,barSpace:u,width:l,minSpacingPx:Math.max(50,w),gapThresholdPx:Math.max(90,w*1.6),targetSpacingPx:Math.max(60,g)}),N7({ticks:T,timezone:o.getTimezone(),width:l,textStyles:a,measureText:L=>sh(L,a.size,a.weight,a.family),state:P.state,paddingOverride:P.padding}),ng(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:T}):T}getAutoSize(){const t=this.getParent().getChart().getStyles(),s=t.xAxis,o=s.size;if(o!=="auto")return o;const r=t.crosshair;let a=0;s.show&&(s.axisLine.show&&(a+=s.axisLine.size),s.ticduty.show&&(a+=s.ticduty.length),s.tickText.show&&(a+=s.tickText.marginStart+s.tickText.marginEnd+s.tickText.size));let l=0;return r.show&&r.vertical.show&&r.vertical.text.show&&(l+=r.vertical.text.paddingTop+r.vertical.text.paddingBottom+r.vertical.text.borderSize*2+r.vertical.text.size),Math.max(a,l)}getBounding(){return this.getParent().getMainWidget().getBounding()}convertTimestampFromPixel(t){const s=this.getParent().getChart().getChartStore(),o=s.coordinateToDataIndex(t);return s.dataIndexToTimestamp(o)}convertTimestampToPixel(t){const s=this.getParent().getChart().getChartStore(),o=s.timestampToDataIndex(t);return s.dataIndexToCoordinate(o)}convertFromPixel(t){return this.getParent().getChart().getChartStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(t)}static extend(t){class s extends Hw{constructor(r){super(r,t)}}return s}}function A7(n){if(!n||!nl(n.span))return 0;const e=n.span;switch(n.type){case"second":return e*1e3;case"minute":return e*60*1e3;case"hour":return e*60*60*1e3;case"day":return e*24*60*60*1e3;case"week":return e*7*24*60*60*1e3;case"month":return e*30*24*60*60*1e3;case"year":return e*365*24*60*60*1e3;default:return 0}}function K6(n,e){const t=v3(e,n),s=Number(t.YYYY),o=Number(t.MM),r=Number(t.DD);return{year:Number.isFinite(s)?s:0,month:Number.isFinite(o)?o:0,day:Number.isFinite(r)?r:0}}function qw(n,e,t){const s=n.getDataByDataIndex(e);if(!s||!nl(s.timestamp))return null;const o=K6(s.timestamp,t),r=n.getDataByDataIndex(e-1);let a=!1,l=!1,c=!1;if(r&&nl(r.timestamp)){const f=K6(r.timestamp,t);o.year!==f.year?(a=!0,l=!0,c=!0):o.month!==f.month?(l=!0,c=!0):o.day!==f.day&&(c=!0)}else a=!0,l=!0,c=!0;return{timestamp:s.timestamp,isYearBoundary:a,isMonthBoundary:l,isDayBoundary:c}}vp.extend(Vw);vp.extend(Ww);function T7({ticks:n,barSpace:e,chartStore:t,dateTimeFormat:s,state:o,width:r,fromTimestamp:a,toTimestamp:l,gridMinPx:c,gridMaxPx:f}){var z,te,pe;if(!o)return;const u=t.getDataList();if(!Array.isArray(u)||u.length===0)return;const d=(z=u[0])==null?void 0:z.timestamp,h=(te=u[u.length-1])==null?void 0:te.timestamp,m=Math.min(a,l),g=Math.max(a,l);if(!Number.isFinite(m)||!Number.isFinite(g)||m>g)return;const w=o.unit,C=o.step,M=t.getTimezone()||vp.tz.guess();let P=D7(vp.tz(m,M),w,C);const T=vp.tz(g,M).add(C,w).valueOf(),N=Math.max(50,c),L=Math.max(r,e);let O=null,D=null,$=-1;for(;P.valueOf()<=T;){const J=P.valueOf(),le=J3({boundaryTs:J,dataList:u,firstTs:d,lastTs:h,chartStore:t});if(le){const de=le.index;if(O===null||de!==O){const he=t.dataIndexToCoordinate(de);if(he>=-L&&he<=r+L){const ge=le.fromData?qw(t,de,s):Z3(J,w,M),ae=t.dataIndexToTimestamp(de)??((pe=u[de])==null?void 0:pe.timestamp);if(nl(ae)){const Ie=F7(ge),ce=D===null||Math.abs(he-D)>=N;!ce&&Ie>$?(n.pop(),n.push({coord:he,value:ae,text:"",isYearBoundary:(ge==null?void 0:ge.isYearBoundary)??!1,isMonthBoundary:(ge==null?void 0:ge.isMonthBoundary)??!1,isDayBoundary:(ge==null?void 0:ge.isDayBoundary)??!1,dataIndex:de}),O=de,D=he,$=Ie):ce&&(n.push({coord:he,value:ae,text:"",isYearBoundary:(ge==null?void 0:ge.isYearBoundary)??!1,isMonthBoundary:(ge==null?void 0:ge.isMonthBoundary)??!1,isDayBoundary:(ge==null?void 0:ge.isDayBoundary)??!1,dataIndex:de}),O=de,D=he,$=Ie)}}}}P=P.add(C,w)}L7({ticks:n,primaryUnit:w,chartStore:t,dateTimeFormat:s,timezoneId:M,dataList:u,firstTs:d,lastTs:h,barSpace:e,width:r,minSpacingPx:Math.max(50,c),maxGapPx:Math.max(f,120)})}function F7(n){return n?n.isYearBoundary?3:n.isMonthBoundary?2:n.isDayBoundary?1:0:0}function Z3(n,e,t){const s=vp.tz(n,t),o=s.hour()===0&&s.minute()===0;let r=e==="day",a=e==="month",l=e==="year";return(e==="hour"||e==="minute")&&(r=o),r&&s.date()===1&&(a=!0),a&&s.month()===0&&(l=!0),e==="month"&&(r=!0),e==="year"&&(a=!0,r=!0),{isYearBoundary:l,isMonthBoundary:a,isDayBoundary:r}}function L7({ticks:n,primaryUnit:e,chartStore:t,dateTimeFormat:s,timezoneId:o,dataList:r,firstTs:a,lastTs:l,barSpace:c,width:f,minSpacingPx:u,maxGapPx:d}){var C;const h=e==="year"?"month":e==="month"?"day":null;if(!h||n.length<2)return;const m=[...n].sort((M,P)=>M.coord-P.coord),g=new Set;m.forEach(M=>{Number.isFinite(M.dataIndex)&&g.add(M.dataIndex)});const w=[];for(let M=0;M<m.length-1;M+=1){const P=m[M],T=m[M+1];if(!Number.isFinite(P.value)||!Number.isFinite(T.value))continue;const N=T.coord-P.coord;if(N<=d)continue;const L=vp.tz(P.value,o).startOf(h),O=vp.tz(T.value,o).startOf(h),D=O.diff(L,h);if(D<=1)continue;const $=N/D,z=Math.max(1,Math.ceil(u/$));let te=L.add(z,h),pe=P.coord;for(;te.isBefore(O);){const J=te.valueOf(),le=J3({boundaryTs:J,dataList:r,firstTs:a,lastTs:l,chartStore:t});if(!le||g.has(le.index)){te=te.add(z,h);continue}const de=le.index,he=t.dataIndexToCoordinate(de);if(he<-c||he>f+c){te=te.add(z,h);continue}if(he-pe<u||T.coord-he<u){te=te.add(z,h);continue}const ge=le.fromData?qw(t,de,s):Z3(J,h,o),ae=t.dataIndexToTimestamp(de)??((C=r[de])==null?void 0:C.timestamp);nl(ae)&&(w.push({coord:he,value:ae,text:"",isYearBoundary:(ge==null?void 0:ge.isYearBoundary)??!1,isMonthBoundary:(ge==null?void 0:ge.isMonthBoundary)??!1,isDayBoundary:(ge==null?void 0:ge.isDayBoundary)??!1,dataIndex:de}),g.add(de),pe=he),te=te.add(z,h)}}w.length>0&&n.push(...w)}function E7({ticks:n,chartStore:e,barSpace:t,width:s,minSpacingPx:o,gapThresholdPx:r,targetSpacingPx:a}){if(n.length<2)return;const l=[...n].sort((u,d)=>u.coord-d.coord),c=new Set;l.forEach(u=>{Number.isFinite(u.dataIndex)&&c.add(u.dataIndex)});const f=[];for(let u=0;u<l.length-1;u+=1){const d=l[u],m=l[u+1].coord-d.coord;if(!Number.isFinite(m)||m<=r)continue;let g=Math.max(2,Math.round(m/a)),w=m/g;if(w<o){if(g=Math.floor(m/o),g<2)continue;w=m/g}for(let C=1;C<g;C+=1){const M=d.coord+w*C;if(M<-t||M>s+t)continue;const P=e.coordinateToDataIndex(M);if(c.has(P))continue;const T=e.dataIndexToTimestamp(P);if(!nl(T))continue;const N=qw(e,P,e.getDateTimeFormat());f.push({coord:M,value:T,text:"",isYearBoundary:(N==null?void 0:N.isYearBoundary)??!1,isMonthBoundary:(N==null?void 0:N.isMonthBoundary)??!1,isDayBoundary:(N==null?void 0:N.isDayBoundary)??!1,dataIndex:P}),c.add(P)}}f.length>0&&n.push(...f)}function J3({boundaryTs:n,dataList:e,firstTs:t,lastTs:s,chartStore:o}){if(nl(t)&&nl(s)&&n>=t&&n<=s){const a=$7(e,n);if(a!==null)return{index:a,fromData:!0}}const r=o.timestampToDataIndex(n);return Number.isFinite(r)?{index:Math.ceil(r),fromData:!1}:null}function $7(n,e){var r;let t=0,s=n.length-1,o=n.length;for(;t<=s;){const a=Math.floor((t+s)/2),l=(r=n[a])==null?void 0:r.timestamp;if(!nl(l))return null;l>=e?(o=a,s=a-1):t=a+1}return o>=n.length?null:o}function D7(n,e,t){let s=n.startOf(e);switch(e){case"year":{const o=s.year(),r=o-o%t;s=s.year(r).startOf("year");break}case"month":{const o=s.month(),r=o-o%t;s=s.month(r).startOf("month");break}case"day":{const o=s.date(),r=o-(o-1)%t;s=s.date(r).startOf("day");break}case"hour":{const o=s.hour(),r=o-o%t;s=s.hour(r).startOf("hour");break}case"minute":{const o=s.minute(),r=o-o%t;s=s.minute(r).startOf("minute");break}}return s}const R7={name:"normal"},X6={normal:Hw.extend(R7)};function j7(n){return X6[n]??X6.normal}class B7 extends q3{createAxisComponent(e){const t=j7(e);return new t(this)}createMainWidget(e){return new v7(e,this)}}function O7(n,e){let t=0;return function(){const s=Date.now();s-t>e&&(n.apply(this,arguments),t=s)}}class z7 extends N3{constructor(t,s){super(t,s);$e(this,"_dragFlag",!1);$e(this,"_dragStartY",0);$e(this,"_topPaneHeight",0);$e(this,"_bottomPaneHeight",0);$e(this,"_topPane",null);$e(this,"_bottomPane",null);$e(this,"_pressedMouseMoveEvent",O7(this._pressedTouchMouseMoveEvent,20));this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return ed.SEPARATOR}_mouseDownEvent(t){this._dragFlag=!0,this._dragStartY=t.pageY;const s=this.getPane(),o=s.getChart();this._topPane=s.getTopPane(),this._bottomPane=s.getBottomPane();const r=o.getDrawPanes();if(this._topPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._topPane)==null?void 0:c.getId())});for(let l=a-1;l>-1;l--){const c=r[l];if(c.getOptions().state!=="minimize"){this._topPane=c;break}}}if(this._bottomPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._bottomPane)==null?void 0:c.getId())});for(let l=a+1;l<r.length;l++){const c=r[l];if(c.getOptions().state!=="minimize"){this._bottomPane=c;break}}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0}_mouseUpEvent(){this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0;try{this.getPane().getChart().layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}catch{}return this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const s=t.pageY-this._dragStartY,o=s<0;if(Os(this._topPane)&&Os(this._bottomPane)){const r=this._bottomPane.getOptions();if(this._topPane.getOptions().state!=="minimize"&&r.state!=="minimize"&&r.dragEnabled){let a=null,l=null,c=0,f=0;o?(a=this._topPane,l=this._bottomPane,c=this._topPaneHeight,f=this._bottomPaneHeight):(a=this._bottomPane,l=this._topPane,c=this._bottomPaneHeight,f=this._topPaneHeight);const u=a.getOptions().minHeight;if(c>u){const d=Math.max(c-Math.abs(s),u),h=c-d;a.setBounding({height:d}),l.setBounding({height:f+h});const m=this.getPane(),g=m.getChart();g.getChartStore().executeAction("onPaneDrag",{paneId:m.getId()}),g.layout({measureHeight:!0,update:!0,cacheYAxisWidth:!0})}}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getBottomPane().getOptions().dragEnabled){const r=t.getChart().getStyles().separator;return this.getContainer().style.background=r.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return this._dragFlag?!1:(this.getContainer().style.background="transparent",!0)}createContainer(){const t=R0("div",{width:"100%",height:`${Bb}px`,margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize",touchAction:"none"});return t.classList.add("dutycharts-pane-separator"),t}updateImp(t,s,o){if(o===Ef.All||o===Ef.Separator){const r=this.getPane().getChart().getStyles().separator;t.style.top=`${-Math.floor((Bb-r.size)/2)}px`,t.style.height=`${Bb}px`}}}class V7 extends H3{constructor(t,s,o,r){super(t,s);$e(this,"_topPane");$e(this,"_bottomPane");$e(this,"_separatorWidget");this.getContainer().style.overflow="",this._topPane=o,this._bottomPane=r,this._separatorWidget=new z7(this.getContainer(),this)}setBounding(t){return nh(this.getBounding(),t),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getWidget(){return this._separatorWidget}getImage(t){const{width:s,height:o}=this.getBounding(),r=this.getChart().getStyles().separator,a=R0("canvas",{width:`${s}px`,height:`${o}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=t_(a);return a.width=s*c,a.height=o*c,l.scale(c,c),l.fillStyle=r.color,l.fillRect(0,0,s,o),a}updateImp(t,s,o){if(t===Ef.All||t===Ef.Separator){const r=this.getChart().getStyles().separator;s.style.backgroundColor=r.color,s.style.height=`${o.height}px`,s.style.marginLeft=`${o.left}px`,s.style.width=`${o.width}px`,this._separatorWidget.update(t)}}}function Z6(){return typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes("firefox")}function ox(){return typeof window>"u"?!1:/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}const lb={ResetClick:500,LongTap:500,PreventFiresTouchEvents:500},L_={CancelClick:5,CancelTap:5,DoubleClick:5,DoubleTap:30},A1={Left:0,Middle:1,Right:2},W7=10;class H7{constructor(e,t,s){$e(this,"_target");$e(this,"_handler");$e(this,"_options");$e(this,"_clickCount",0);$e(this,"_clickTimeoutId",null);$e(this,"_clickCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});$e(this,"_tapCount",0);$e(this,"_tapTimeoutId",null);$e(this,"_tapCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});$e(this,"_longTapTimeoutId",null);$e(this,"_longTapActive",!1);$e(this,"_mouseMoveStartCoordinate",null);$e(this,"_touchMoveStartCoordinate",null);$e(this,"_touchMoveExceededManhattanDistance",!1);$e(this,"_cancelClick",!1);$e(this,"_cancelTap",!1);$e(this,"_unsubscribeOutsideMouseEvents",null);$e(this,"_unsubscribeOutsideTouchEvents",null);$e(this,"_unsubscribeMobileSafariEvents",null);$e(this,"_unsubscribeMousemove",null);$e(this,"_unsubscribeMouseWheel",null);$e(this,"_unsubscribeContextMenu",null);$e(this,"_unsubscribeRootMouseEvents",null);$e(this,"_unsubscribeRootTouchEvents",null);$e(this,"_startPinchMiddleCoordinate",null);$e(this,"_startPinchDistance",0);$e(this,"_pinchPrevented",!1);$e(this,"_preventTouchDragProcess",!1);$e(this,"_mousePressed",!1);$e(this,"_lastTouchEventTimeStamp",0);$e(this,"_activeTouchId",null);$e(this,"_acceptMouseLeave",!ox());$e(this,"_onFirefoxOutsideMouseUp",e=>{this._mouseUpHandler(e)});$e(this,"_onMobileSafariDoubleClick",e=>{if(this._firesTouchEvents(e)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<L_.DoubleTap&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(e),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);t<L_.DoubleClick&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}});this._target=e,this._handler=t,this._options=s,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){var r,a,l;(r=this._unsubscribeMousemove)==null||r.call(this),(a=this._unsubscribeMouseWheel)==null||a.call(this),(l=this._unsubscribeContextMenu)==null||l.call(this);const t=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t);const s=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",s)},this._target.addEventListener("wheel",s,{passive:!1});const o=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",o)},this._target.addEventListener("contextmenu",o,{passive:!1}),!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(!Os(this._handler.mouseWheelHortEvent)||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(!Os(this._handler.mouseWheelVertEvent))return;let t=-(e.deltaY/100);if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:{t*=120;break}case e.DOM_DELTA_LINE:{t*=32;break}}if(t!==0){const s=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),s)}}}_contextMenuHandler(e){this._preventDefault(e)}_touchMoveHandler(e){const t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const s=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),{xOffset:o,yOffset:r,manhattanDistance:a}=s;if(!(!this._touchMoveExceededManhattanDistance&&a<L_.CancelTap)){if(!this._touchMoveExceededManhattanDistance){const l=o*.5,c=r>=l&&!this._options.treatVertDragAsPageScroll(),f=l>r&&!this._options.treatHorzDragAsPageScroll();!c&&!f&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(e){if(e.button!==A1.Left)return;const t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),{manhattanDistance:s}=t;s>=L_.CancelClick&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(e,t){const s=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),r=s+o;return{xOffset:s,yOffset:o,manhattanDistance:r}}_touchEndHandler(e){let t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const s=this._makeCompatEvent(e,t);if(this._processEvent(s,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:o}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);o<L_.DoubleTap&&!this._cancelTap&&this._processEvent(s,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(s,this._handler.tapEvent),Os(this._handler.tapEvent)&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}_mouseUpHandler(e){if(e.button!==A1.Left)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Z6()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);s<L_.DoubleClick&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(this._activeTouchId!==null)return;const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);const s=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const o=this._touchMoveHandler.bind(this),r=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{s.removeEventListener("touchmove",o),s.removeEventListener("touchend",r)},s.addEventListener("touchmove",o,{passive:!1}),s.addEventListener("touchend",r,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),lb.LongTap)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),lb.ResetClick),this._tapCoordinate=this._getCoordinate(t))}_mouseDownHandler(e){if(e.button===A1.Right){this._preventDefault(e),this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);return}if(e.button!==A1.Left)return;const t=this._target.ownerDocument.documentElement;Z6()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const s=this._mouseMoveWithDownHandler.bind(this),o=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",s),t.removeEventListener("mouseup",o)},t.addEventListener("mousemove",s),t.addEventListener("mouseup",o)}this._mousePressed=!0,!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),lb.ResetClick),this._clickCoordinate=this._getCoordinate(e)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const e=this._target.ownerDocument,t=s=>{this._handler.mouseDownOutsideEvent!=null&&(s.composed&&this._target.contains(s.composedPath()[0])||s.target!==null&&this._target.contains(s.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",t)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",t)},e.addEventListener("mousedown",t),e.addEventListener("touchstart",t,{passive:!0})}ox()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",e=>{if(e.button===A1.Middle)return e.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){!Os(this._handler.pinchStartEvent)&&!Os(this._handler.pinchEvent)&&!Os(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",e=>{this._checkPinchState(e.touches)},{passive:!0}),this._target.addEventListener("touchmove",e=>{if(!(e.touches.length!==2||this._startPinchMiddleCoordinate===null)&&Os(this._handler.pinchEvent)){const s=this._getTouchDistance(e.touches[0],e.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},s),this._preventDefault(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{this._checkPinchState(e.touches)}))}_checkPinchState(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){const t=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),Os(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,Os(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(e){var t,s,o;(t=this._unsubscribeMousemove)==null||t.call(this),(s=this._unsubscribeMouseWheel)==null||s.call(this),(o=this._unsubscribeContextMenu)==null||o.call(this),!this._firesTouchEvents(e)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!ox())}_longTapHandler(e){const t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(e){var t;return Os((t=e.sourceCapabilities)==null?void 0:t.firesTouchEvents)?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+lb.PreventFiresTouchEvents}_processEvent(e,t){t==null||t.call(this._handler,e)}_makeCompatEvent(e,t){const s=t??e,o=this._target.getBoundingClientRect();return{x:s.clientX-o.left,y:s.clientY-o.top,pageX:s.pageX,pageY:s.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click"&&e.type!=="wheel",preventDefault:()=>{e.type!=="touchstart"&&this._preventDefault(e)}}}_getTouchDistance(e,t){const s=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(s*s+o*o)}_preventDefault(e){e.cancelable&&e.preventDefault()}_getCoordinate(e){return{x:e.pageX,y:e.pageY}}_eventTimeStamp(e){return e.timeStamp??performance.now()}_touchWithId(e,t){for(let s=0;s<e.length;++s)if(e[s].identifier===t)return e[s];return null}}class q7{constructor(e,t){$e(this,"_container");$e(this,"_chart");$e(this,"_event");$e(this,"_flingStartTime",new Date().getTime());$e(this,"_flingScrollRequestId",null);$e(this,"_startScrollCoordinate",null);$e(this,"_touchCoordinate",null);$e(this,"_touchCancelCrosshair",!1);$e(this,"_touchZoomed",!1);$e(this,"_pinchScale",1);$e(this,"_mouseDownWidget",null);$e(this,"_prevYAxisRange",null);$e(this,"_xAxisStartScaleCoordinate",null);$e(this,"_xAxisStartScaleDistance",0);$e(this,"_xAxisScale",1);$e(this,"_yAxisStartScaleDistance",0);$e(this,"_mouseMoveTriggerWidgetInfo",{pane:null,widget:null});$e(this,"_wheelScrollAccum",0);$e(this,"_wheelScrollRafId",null);$e(this,"_wheelZoomAccum",0);$e(this,"_wheelZoomRafId",null);$e(this,"_wheelZoomLastCoord",null);$e(this,"_overlayUpdateRafId",null);$e(this,"_yAxisScaleLayoutTimer",null);$e(this,"_boundKeyBoardDownEvent",e=>{if(e.shiftKey)switch(e.code){case"Equal":{this._chart.getChartStore().zoom(.5);break}case"Minus":{this._chart.getChartStore().zoom(-.5);break}case"ArrowLeft":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}});this._container=e,this._chart=t,this._event=new H7(e,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(e,t){const{pane:s,widget:o}=this._findWidgetByEvent(e);if((s==null?void 0:s.getId())!==ad.X_AXIS&&(o==null?void 0:o.getName())===ed.MAIN){const r=this._makeWidgetEvent(e,o),a=(t-this._pinchScale)*5;return this._pinchScale=t,this._chart.getChartStore().zoom(a,{x:r.x,y:r.y}),!0}return!1}mouseWheelHortEvent(e,t){if(this._wheelScrollAccum+=t,this._wheelScrollRafId===null){const s=this._chart.getChartStore();this._wheelScrollRafId=n_(()=>{const o=this._wheelScrollAccum;this._wheelScrollAccum=0,this._wheelScrollRafId=null,s.startScroll(),s.scroll(o)})}return!0}mouseWheelVertEvent(e,t){const{widget:s}=this._findWidgetByEvent(e),o=this._makeWidgetEvent(e,s);return(s==null?void 0:s.getName())===ed.MAIN?(this._wheelZoomAccum+=t,this._wheelZoomLastCoord={x:o.x,y:o.y},this._wheelZoomRafId===null&&(this._wheelZoomRafId=n_(()=>{const a=this._wheelZoomAccum,l=this._wheelZoomLastCoord??{x:o.x,y:o.y};this._wheelZoomAccum=0,this._wheelZoomLastCoord=null,this._wheelZoomRafId=null,this._chart.getChartStore().zoom(a,l)})),!0):!1}mouseDownEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);if(this._mouseDownWidget=s,s!==null){const o=this._makeWidgetEvent(e,s);switch(s.getName()){case ed.SEPARATOR:return s.dispatchEvent("mouseDownEvent",o);case ed.MAIN:{const a=t.getAxisComponent();if(!a.getAutoCalcTickFlag()){const l=a.getRange();this._prevYAxisRange={...l}}return this._startScrollCoordinate={x:o.x,y:o.y},this._chart.getChartStore().startScroll(),s.dispatchEvent("mouseDownEvent",o)}case ed.X_AXIS:return this._processXAxisScrollStartEvent(s,o);case ed.Y_AXIS:return this._processYAxisScaleStartEvent(s,o)}}return!1}mouseMoveEvent(e){var r,a,l;const{pane:t,widget:s}=this._findWidgetByEvent(e),o=this._makeWidgetEvent(e,s);if((((r=this._mouseMoveTriggerWidgetInfo.pane)==null?void 0:r.getId())!==(t==null?void 0:t.getId())||((a=this._mouseMoveTriggerWidgetInfo.widget)==null?void 0:a.getName())!==(s==null?void 0:s.getName()))&&(s==null||s.dispatchEvent("mouseEnterEvent",o),(l=this._mouseMoveTriggerWidgetInfo.widget)==null||l.dispatchEvent("mouseLeaveEvent",o),this._mouseMoveTriggerWidgetInfo={pane:t,widget:s}),s!==null){const c=s.getName();switch(c){case ed.MAIN:{const f=s.dispatchEvent("mouseMoveEvent",o);let u={x:o.x,y:o.y,paneId:t==null?void 0:t.getId()};return f?(s.getForceCursor()!=="pointer"&&(u=void 0),s.setCursor("pointer")):s.setCursor("crosshair"),this._chart.getChartStore().setCrosshair(u),f}case ed.SEPARATOR:case ed.X_AXIS:case ed.Y_AXIS:{const f=s.dispatchEvent("mouseMoveEvent",o);return c===ed.X_AXIS?this._chart.getChartStore().setCrosshair({x:o.x,paneId:t==null?void 0:t.getId()}):this._chart.getChartStore().setCrosshair(),f}}}return!1}pressedMouseMoveEvent(e){var o,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===ed.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null&&((o=this._mouseDownWidget)==null?void 0:o.getPane().getId())===(t==null?void 0:t.getId())&&((r=this._mouseDownWidget)==null?void 0:r.getName())===s.getName()){const a=this._makeWidgetEvent(e,s);switch(s.getName()){case ed.MAIN:{let c;const f=s.dispatchEvent("pressedMouseMoveEvent",a);return f||this._processMainScrollingEvent(s,a),(!f||s.getForceCursor()==="pointer")&&(c={x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}),this._chart.getChartStore().setCrosshair(c,{forceInvalidate:!0}),f}case ed.X_AXIS:return this._processXAxisScrollingEvent(s,a);case ed.Y_AXIS:return this._processYAxisScalingEvent(s,a)}}return!1}mouseUpEvent(e){const{widget:t}=this._findWidgetByEvent(e),s=this._mouseDownWidget??t;let o=!1;if(s!==null){const r=this._makeWidgetEvent(e,s);switch(s.getName()){case ed.MAIN:case ed.SEPARATOR:case ed.X_AXIS:case ed.Y_AXIS:{o=s.dispatchEvent("mouseUpEvent",r);break}}o&&this._scheduleOverlayUpdate()}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout(),o}mouseClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const s=this._makeWidgetEvent(e,t);return t.dispatchEvent("mouseClickEvent",s)}return!1}mouseRightClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);let s=!1;if(t!==null){const o=this._makeWidgetEvent(e,t);switch(t.getName()){case ed.MAIN:case ed.X_AXIS:case ed.Y_AXIS:{s=t.dispatchEvent("mouseRightClickEvent",o);break}}s&&this._scheduleOverlayUpdate()}return!1}mouseDoubleClickEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null)switch(s.getName()){case ed.MAIN:{const r=this._makeWidgetEvent(e,s);return s.dispatchEvent("mouseDoubleClickEvent",r)}case ed.Y_AXIS:{const r=t.getAxisComponent();if(!r.getAutoCalcTickFlag())return r.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().setCrosshair(),!0}touchStartEvent(e){var o;const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null){const r=this._makeWidgetEvent(e,s);switch((o=r.preventDefault)==null||o.call(r),s.getName()){case ed.SEPARATOR:return this._flingScrollRequestId!==null&&(Y2(this._flingScrollRequestId),this._flingScrollRequestId=null),this._mouseDownWidget=s,s.dispatchEvent("touchStartEvent",r);case ed.MAIN:{const l=this._chart.getChartStore();if(s.dispatchEvent("mouseDownEvent",r))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(Ef.Overlay),!0;this._flingScrollRequestId!==null&&(Y2(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime();const c=t.getAxisComponent();if(!c.getAutoCalcTickFlag()){const f=c.getRange();this._prevYAxisRange={...f}}if(this._startScrollCoordinate={x:r.x,y:r.y},l.startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const f=r.x-this._touchCoordinate.x,u=r.y-this._touchCoordinate.y;Math.sqrt(f*f+u*u)<W7?(this._touchCoordinate={x:r.x,y:r.y},l.setCrosshair({x:r.x,y:r.y,paneId:t==null?void 0:t.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,l.setCrosshair())}return!0}case ed.X_AXIS:return this._processXAxisScrollStartEvent(s,r);case ed.Y_AXIS:return this._processYAxisScaleStartEvent(s,r)}}return!1}touchMoveEvent(e){var o,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===ed.SEPARATOR){const a=this._makeWidgetEvent(e,this._mouseDownWidget);return(o=a.preventDefault)==null||o.call(a),this._mouseDownWidget.dispatchEvent("touchMoveEvent",a)}const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null){const a=this._makeWidgetEvent(e,s);(r=a.preventDefault)==null||r.call(a);const l=s.getName(),c=this._chart.getChartStore();switch(l){case ed.MAIN:return s.dispatchEvent("pressedMouseMoveEvent",a)?(c.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(Ef.Overlay),!0):(this._touchCoordinate!==null?c.setCrosshair({x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}):this._processMainScrollingEvent(s,a),!0);case ed.X_AXIS:return this._processXAxisScrollingEvent(s,a);case ed.Y_AXIS:return this._processYAxisScalingEvent(s,a);case ed.SEPARATOR:return s.dispatchEvent("touchMoveEvent",a)}}return!1}touchEndEvent(e){if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===ed.SEPARATOR){const s=this._makeWidgetEvent(e,this._mouseDownWidget),o=this._mouseDownWidget.dispatchEvent("touchEndEvent",s);return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout(),o}const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const s=this._makeWidgetEvent(e,t);switch(t.getName()){case ed.MAIN:{if(t.dispatchEvent("mouseUpEvent",s),this._startScrollCoordinate!==null){const r=new Date().getTime()-this._flingStartTime;let l=(s.x-this._startScrollCoordinate.x)/(r>0?r:1)*20;if(r<200&&Math.abs(l)>0){const c=this._chart.getChartStore(),f=()=>{this._flingScrollRequestId=n_(()=>{c.startScroll(),c.scroll(l),l=l*(1-.025),Math.abs(l)<1?this._flingScrollRequestId!==null&&(Y2(this._flingScrollRequestId),this._flingScrollRequestId=null):f()})};f()}}return!0}case ed.X_AXIS:case ed.Y_AXIS:{t.dispatchEvent("mouseUpEvent",s)&&this._chart.updatePane(Ef.Overlay);break}case ed.SEPARATOR:{t.dispatchEvent("touchEndEvent",s);break}}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout()}return!1}tapEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);let o=!1;if(s!==null){const r=this._makeWidgetEvent(e,s),a=s.dispatchEvent("mouseClickEvent",r);if(s.getName()===ed.MAIN){const l=this._makeWidgetEvent(e,s),c=this._chart.getChartStore();a?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,{notInvalidate:!0}),o=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},c.setCrosshair({x:l.x,y:l.y,paneId:t==null?void 0:t.getId()},{notInvalidate:!0}),o=!0),this._touchCancelCrosshair=!1)}(o||a)&&this._scheduleOverlayUpdate()}return o}doubleTapEvent(e){return this.mouseDoubleClickEvent(e)}longTapEvent(e){const{pane:t,widget:s}=this._findWidgetByEvent(e);if(s!==null&&s.getName()===ed.MAIN){const o=this._makeWidgetEvent(e,s);return this._touchCoordinate={x:o.x,y:o.y},this._chart.getChartStore().setCrosshair({x:o.x,y:o.y,paneId:t==null?void 0:t.getId()}),!0}return!1}_processMainScrollingEvent(e,t){if(this._startScrollCoordinate!==null){const s=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&!s.getAutoCalcTickFlag()&&s.scrollZoomEnabled){const{from:r,to:a,range:l}=this._prevYAxisRange;let c=0;s.reverse?c=this._startScrollCoordinate.y-t.y:c=t.y-this._startScrollCoordinate.y;const f=e.getBounding(),u=c/f.height,d=l*u,h=r+d,m=a+d,g=s.valueToRealValue(h,{range:this._prevYAxisRange}),w=s.valueToRealValue(m,{range:this._prevYAxisRange}),C=s.realValueToDisplayValue(g,{range:this._prevYAxisRange}),M=s.realValueToDisplayValue(w,{range:this._prevYAxisRange});s.setRange({from:h,to:m,range:m-h,realFrom:g,realTo:w,realRange:w-g,displayFrom:C,displayTo:M,displayRange:M-C}),s.buildTicks(!0),this._chart.updatePane(Ef.All,e.getPane().getId())}const o=t.x-this._startScrollCoordinate.x;o!==0&&this._chart.getChartStore().scroll(o)}}_processXAxisScrollStartEvent(e,t){const s=e.dispatchEvent("mouseDownEvent",t);return s&&this._scheduleOverlayUpdate(),this._xAxisStartScaleCoordinate={x:t.x,y:t.y},this._xAxisStartScaleDistance=t.pageX,s}_processXAxisScrollingEvent(e,t){const s=e.dispatchEvent("pressedMouseMoveEvent",t);if(s)this._scheduleOverlayUpdate();else if(e.getPane().getAxisComponent().scrollZoomEnabled&&this._xAxisStartScaleDistance!==0){const r=this._xAxisStartScaleDistance/t.pageX;if(Number.isFinite(r)){const a=(r-this._xAxisScale)*10;this._xAxisScale=r,this._chart.getChartStore().zoom(a,this._xAxisStartScaleCoordinate??void 0)}}return s}_processYAxisScaleStartEvent(e,t){const s=e.dispatchEvent("mouseDownEvent",t);s&&this._scheduleOverlayUpdate();const o=e.getPane().getAxisComponent().getRange();return this._prevYAxisRange={...o},this._yAxisStartScaleDistance=t.pageY,s}_processYAxisScalingEvent(e,t){const s=e.dispatchEvent("pressedMouseMoveEvent",t);if(s)this._chart.updatePane(Ef.Overlay);else{const o=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&o.scrollZoomEnabled&&this._yAxisStartScaleDistance!==0){const{from:r,to:a,range:l}=this._prevYAxisRange,c=t.pageY/this._yAxisStartScaleDistance,f=Number.isFinite(c)?Math.min(5,Math.max(.2,c)):1,u=l*f,d=(u-l)/2,h=r-d,m=a+d,g=o.valueToRealValue(h,{range:this._prevYAxisRange}),w=o.valueToRealValue(m,{range:this._prevYAxisRange}),C=o.realValueToDisplayValue(g,{range:this._prevYAxisRange}),M=o.realValueToDisplayValue(w,{range:this._prevYAxisRange});o.setRange({from:h,to:m,range:u,realFrom:g,realTo:w,realRange:w-g,displayFrom:C,displayTo:M,displayRange:M-C}),o.buildTicks(!0),this._chart.updatePane(Ef.All,e.getPane().getId()),this._scheduleYAxisScaleLayout()}}return s}_findWidgetByEvent(e){const{x:t,y:s}=e,o=this._chart.getSeparatorPanes(),r=this._chart.getStyles().separator.size,a=Bb,l=e.isTouch?Math.max(a,r+14):Math.max(a,r+6);for(const d of o){const h=d[1],m=h.getBounding(),g=m.top-Math.round((l-r)/2);if(t>=m.left&&t<=m.left+m.width&&s>=g&&s<=g+l)return{pane:h,widget:h.getWidget()}}const c=this._chart.getDrawPanes();let f=null;for(const d of c){const h=d.getBounding();if(t>=h.left&&t<=h.left+h.width&&s>=h.top&&s<=h.top+h.height){f=d;break}}let u=null;if(f!==null){if(!Os(u)){const d=f.getMainWidget(),h=d.getBounding();t>=h.left&&t<=h.left+h.width&&s>=h.top&&s<=h.top+h.height&&(u=d)}if(!Os(u)){const d=f.getYAxisWidget();if(d!==null){const h=d.getBounding();t>=h.left&&t<=h.left+h.width&&s>=h.top&&s<=h.top+h.height&&(u=d)}}}return{pane:f,widget:u}}_makeWidgetEvent(e,t){const s=(t==null?void 0:t.getBounding())??null;return{...e,x:e.x-((s==null?void 0:s.left)??0),y:e.y-((s==null?void 0:s.top)??0)}}_scheduleYAxisScaleLayout(){this._yAxisScaleLayoutTimer!==null&&clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=window.setTimeout(()=>{this._yAxisScaleLayoutTimer=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})},60)}_finalizeYAxisScaleLayout(){this._yAxisScaleLayoutTimer!==null&&(clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}))}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._yAxisScaleLayoutTimer!==null&&(clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=null),this._event.destroy()}}class U7{constructor(e,t){$e(this,"id");$e(this,"_container");$e(this,"_chartContainer");$e(this,"_chartBounding",i2());$e(this,"_chartEvent");$e(this,"_chartStore");$e(this,"_drawPanes",[]);$e(this,"_candlePane");$e(this,"_xAxisPane");$e(this,"_separatorPanes",new Map);$e(this,"_layoutOptions",{sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1});$e(this,"_layoutPending",!1);$e(this,"_cacheYAxisWidth",{left:0,right:0});this.id=q1("chart"),this._initContainer(e),this._chartEvent=new q7(this._chartContainer,this),this._chartStore=new xI(this,t),this._initPanes(t),this._layout()}_initContainer(e){this._container=e,this._chartContainer=R0("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer),this._cacheChartBounding()}_cacheChartBounding(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)}_initPanes(e){const t=(e==null?void 0:e.layout)??[{type:"candle"}],s=r=>{if(!Os(this._candlePane)){const a=r.options??{};nh(a,{id:ad.CANDLE}),this._candlePane=this._createPane(f7,ad.CANDLE,a),(r.content??[]).forEach(c=>{this.createIndicator(c,!0,a)})}},o=r=>{if(!Os(this._xAxisPane)){const a=this._createPane(B7,ad.X_AXIS,r??{});this._xAxisPane=a}};t.forEach(r=>{var a;switch(r.type){case"candle":{s(r);break}case"indicator":{const l=r.content??[];if(l.length>0){let c=((a=r.options)==null?void 0:a.id)??null;Os(c)&&(c=q1(ad.INDICATOR));const f={...r.options,id:c};l.forEach(u=>{this.createIndicator(u,!0,f)})}break}case"xAxis":{o(r.options);break}}}),s({type:"candle"}),o({order:Number.MAX_SAFE_INTEGER})}_createPane(e,t,s){const o=new e(this,t,s??{});return this._drawPanes.push(o),o}_recalculatePaneHeight(e,t,s){if(s===0)return!1;const o=this._drawPanes.filter(a=>{const l=a.getId();return a.getOptions().state==="normal"&&l!==e.getId()&&l!==ad.X_AXIS}),r=o.length;if(r===0)return!1;if(e.getId()!==ad.CANDLE&&Os(this._candlePane)&&this._candlePane.getOptions().state==="normal"){const a=this._candlePane.getBounding().height;if(a>0){const l=this._candlePane.getOptions().minHeight;let c=a+s;c<l&&(c=l,t-=a+s-c),this._candlePane.setBounding({height:c})}}else{let a=s;const l=Math.floor(s/r);o.forEach((c,f)=>{const u=c.getBounding().height;let d=0;f===r-1?d=u+a:d=u+l,d<c.getOptions().minHeight&&(d=c.getOptions().minHeight),c.setBounding({height:d}),a-=d-u}),Math.abs(a)>0&&(t-=a)}return e.setBounding({height:t}),!0}getDrawPaneById(e){return e===ad.CANDLE?this._candlePane:e===ad.X_AXIS?this._xAxisPane:this._drawPanes.find(s=>s.getId()===e)??null}getContainer(){return this._container}getChartStore(){return this._chartStore}getXAxisPane(){return this._xAxisPane}getDrawPanes(){return this._drawPanes}getSeparatorPanes(){return this._separatorPanes}layout(e){(e.sort??!1)&&(this._layoutOptions.sort=e.sort),(e.measureHeight??!1)&&(this._layoutOptions.measureHeight=e.measureHeight),(e.measureWidth??!1)&&(this._layoutOptions.measureWidth=e.measureWidth),(e.update??!1)&&(this._layoutOptions.update=e.update),(e.buildYAxisTick??!1)&&(this._layoutOptions.buildYAxisTick=e.buildYAxisTick),(e.cacheYAxisWidth??!1)&&(this._layoutOptions.cacheYAxisWidth=e.cacheYAxisWidth),(e.buildYAxisTick??!1)&&(this._layoutOptions.forceBuildYAxisTick=e.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(t=>{try{this._layout()}finally{this._layoutPending=!1}}).catch(t=>{}))}_layout(){const{sort:e,measureHeight:t,measureWidth:s,update:o,buildYAxisTick:r,cacheYAxisWidth:a,forceBuildYAxisTick:l}=this._layoutOptions;if(typeof performance<"u"?performance.now():Date.now(),e){for(;Os(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort((u,d)=>u.getOptions().order-d.getOptions().order);let f=null;this._drawPanes.forEach(u=>{if(u.getId()!==ad.X_AXIS){if(Os(f)){const d=new V7(this,"",f,u);this._chartContainer.appendChild(d.getContainer()),this._separatorPanes.set(u,d)}f=u}this._chartContainer.appendChild(u.getContainer())})}if(t){const f=this._chartBounding.height,u=this.getStyles().separator.size,d=this._xAxisPane.getAxisComponent().getAutoSize();let h=f-d;h<0&&(h=0),this._drawPanes.forEach(g=>{const w=g.getId();if(Os(this._separatorPanes.get(g))&&(h-=u),w!==ad.X_AXIS&&w!==ad.CANDLE&&g.getVisible()){let C=g.getBounding().height;C>h?(C=h,h=0):h-=C,g.setBounding({height:C})}}),this._candlePane.setBounding({height:Math.max(h,0)}),this._xAxisPane.setBounding({height:d});let m=0;this._drawPanes.forEach(g=>{const w=this._separatorPanes.get(g);Os(w)&&(w.setBounding({height:u,top:m}),m+=u),g.setBounding({top:m}),m+=g.getBounding().height})}let c=s;if((r||l)&&this._drawPanes.forEach(f=>{const u=f.getAxisComponent().buildTicks(l);c||(c=u)}),c){const f=this._chartBounding.width,u=this.getStyles();let d=0,h=!0,m=0,g=!0;this._drawPanes.forEach($=>{if($.getId()!==ad.X_AXIS&&$.getVisible()){const z=$.getAxisComponent(),te=z.inside,pe=z.getAutoSize();z.position==="left"?(d=Math.max(d,pe),te&&(h=!1)):(m=Math.max(m,pe),te&&(g=!1))}}),a&&(d=Math.max(this._cacheYAxisWidth.left,d),m=Math.max(this._cacheYAxisWidth.right,m)),this._cacheYAxisWidth.left=d,this._cacheYAxisWidth.right=m;let w=f,C=0,M=0;h&&(w-=d,C=d),g&&(w-=m,M=m),this._chartStore.setTotalBarSpace(w);const P={width:f},T={width:w,left:C,right:M},N={width:d},L={width:m},O=u.separator.fill;let D={};O?D=P:D=T,this._drawPanes.forEach($=>{var z;(z=this._separatorPanes.get($))==null||z.setBounding(D),$.setBounding(P,T,N,L)})}o&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(Ef.All)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1},typeof performance<"u"?performance.now():Date.now()}updatePane(e,t){if(Os(t)){const s=this.getDrawPaneById(t);s==null||s.update(e)}else this._drawPanes.forEach(s=>{var o;s.update(e),(o=this._separatorPanes.get(s))==null||o.update(e)})}getDom(e,t){var s;if(Os(e)){const o=this.getDrawPaneById(e);if(Os(o))switch(t??"root"){case"root":return o.getContainer();case"main":return o.getMainWidget().getContainer();case"yAxis":return((s=o.getYAxisWidget())==null?void 0:s.getContainer())??null}}else return this._chartContainer;return null}getSize(e,t){var s;if(Os(e)){const o=this.getDrawPaneById(e);if(Os(o))switch(t??"root"){case"root":return o.getBounding();case"main":return o.getMainWidget().getBounding();case"yAxis":return((s=o.getYAxisWidget())==null?void 0:s.getBounding())??null}}else return this._chartBounding;return null}_resetYAxisAutoCalcTickFlag(){this._drawPanes.forEach(e=>{e.getAxisComponent().setAutoCalcTickFlag(!0)})}setSymbol(e){e!==this.getSymbol()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setSymbol(e))}getSymbol(){return this._chartStore.getSymbol()}setPeriod(e){e!==this.getPeriod()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setPeriod(e))}getPeriod(){return this._chartStore.getPeriod()}setStyles(e){this._setOptions(()=>{this._chartStore.setStyles(e)})}getStyles(){return this._chartStore.getStyles()}setFormatter(e){this._setOptions(()=>{this._chartStore.setFormatter(e)})}getFormatter(){return this._chartStore.getFormatter()}setLocale(e){this._setOptions(()=>{this._chartStore.setLocale(e)})}getLocale(){return this._chartStore.getLocale()}setTimezone(e){this._setOptions(()=>{this._chartStore.setTimezone(e)})}getTimezone(){return this._chartStore.getTimezone()}setThousandsSeparator(e){this._setOptions(()=>{this._chartStore.setThousandsSeparator(e)})}getThousandsSeparator(){return this._chartStore.getThousandsSeparator()}setDecimalFold(e){this._setOptions(()=>{this._chartStore.setDecimalFold(e)})}getDecimalFold(){return this._chartStore.getDecimalFold()}_setOptions(e){e(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}setOffsetRightDistance(e){this._chartStore.setOffsetRightDistance(e,!0)}getOffsetRightDistance(){return this._chartStore.getOffsetRightDistance()}setMaxOffsetLeftDistance(e){e<0||this._chartStore.setMaxOffsetLeftDistance(e)}setMaxOffsetRightDistance(e){e<0||this._chartStore.setMaxOffsetRightDistance(e)}setLeftMinVisibleBarCount(e){e<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(e))}setRightMinVisibleBarCount(e){e<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(e))}setBarSpace(e){this._chartStore.setBarSpace(e)}getBarSpace(){return this._chartStore.getBarSpace()}getVisibleRange(){return this._chartStore.getVisibleRange()}resetData(){this._chartStore.resetData()}applyNewData(e,t){this._chartStore.applyNewData(e,t)}addData(e,t,s){this._chartStore.addData(e,t,s)}getDataList(){return this._chartStore.getDataList()}setDataLoader(e){this._resetYAxisAutoCalcTickFlag(),this._chartStore.setDataLoader(e)}createIndicator(e,t,s){const o=pf(e)?{name:e}:e;if(w3(o.name)===null)return null;const r=s??{};if(pf(r.id)||(r.id=q1(ad.INDICATOR)),pf(o.id)||(o.id=q1(o.name)),this._chartStore.addIndicator(o,r.id,t??!1)){let l=!1;return Os(this.getDrawPaneById(r.id))||(this._createPane(U3,r.id,r),r.height??(r.height=P3),l=!0),this.setPaneOptions(r),this.layout({sort:l,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),o.id}return null}overrideIndicator(e){return this._chartStore.overrideIndicator(e)}getIndicators(e){return this._chartStore.getIndicatorsByFilter(e??{})}removeIndicator(e){let t=this._chartStore.removeIndicator(e??{});if(!t&&e){const{name:s,id:o}=e,r=typeof s=="string"?s.split("(")[0].trim():void 0;if(o||r){const a={};o&&(a.id=o),r&&(a.name=r),t=this._chartStore.removeIndicator(a),!t&&r&&(t=this._chartStore.removeIndicator({name:r}))}}if(t){let s=!1;const o=[];this._drawPanes.forEach(r=>{const a=r.getId();a!==ad.CANDLE&&a!==ad.X_AXIS&&o.push(a)}),o.forEach(r=>{if(!this._chartStore.hasIndicators(r)){const a=this._drawPanes.findIndex(c=>c.getId()===r),l=this._drawPanes[a];Os(l)&&(s=!0,this._recalculatePaneHeight(l,0,l.getBounding().height),this._drawPanes.splice(a,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:s,measureHeight:s,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return t}createOverlay(e){const t=[],s=[],o=a=>{!Os(a.paneId)||this.getDrawPaneById(a.paneId)===null?(a.paneId=ad.CANDLE,s.push(!1)):s.push(!0),t.push(a)};pf(e)?o({name:e}):e0(e)?e.forEach(a=>{let l=null;pf(a)?l={name:a}:l=a,o(l)}):o(e);const r=this._chartStore.addOverlays(t,s);return e0(e)?r:r[0]}getOverlays(e){return this._chartStore.getOverlaysByFilter(e??{})}overrideOverlay(e){return this._chartStore.overrideOverlay(e)}removeOverlay(e){return this._chartStore.removeOverlay(e??{})}setPaneOptions(e){let t=!1,s=!1;const o=Os(e.id);for(const r of this._drawPanes){const a=r.getId();if(o&&e.id===a||!o){if(a!==ad.X_AXIS){if(nl(e.height)&&e.height>0){const c=Math.max(e.minHeight??r.getOptions().minHeight,0),f=Math.max(c,e.height);s=!0,t=!0,r.setOriginalBounding({height:f}),this._recalculatePaneHeight(r,f,-f)}if(Os(e.state)&&r.getOptions().state!==e.state){t=!0,s=!0;const c=e.state;switch(c){case"maximize":{const f=this._drawPanes.find(u=>{const d=u.getId();return u.getOptions().state==="maximize"&&d!==ad.X_AXIS});if(!Os(f)){r.getOptions().state==="normal"&&r.setOriginalBounding({height:r.getBounding().height}),r.setOptions({state:c});const u=this._chartBounding.height;r.setBounding({height:u-this._xAxisPane.getBounding().height}),this._drawPanes.forEach(d=>{var h;d.getId()!==ad.X_AXIS&&d.getId()!==a&&(d.setBounding({height:d.getOriginalBounding().height}),d.setVisible(!1),(h=this._separatorPanes.get(d))==null||h.setVisible(!1))})}break}case"minimize":{const f=r.getBounding().height,u=r.getOptions().state;let d=f-ny;u==="maximize"&&(d=r.getOriginalBounding().height-ny),this._recalculatePaneHeight(r,ny,d)&&(u==="normal"&&r.setOriginalBounding({height:f}),r.setOptions({state:c})),this._drawPanes.forEach(h=>{var m;h.getId()!==ad.X_AXIS&&(h.setVisible(!0),(m=this._separatorPanes.get(h))==null||m.setVisible(!0))});break}default:{const f=r.getOriginalBounding().height;r.getOptions().state==="maximize"?(r.setOptions({state:c}),this._drawPanes.forEach(d=>{var h;d.getId()!==ad.X_AXIS&&(d.setBounding({height:d.getOriginalBounding().height}),d.setVisible(!0),(h=this._separatorPanes.get(d))==null||h.setVisible(!0))})):this._recalculatePaneHeight(r,f,r.getBounding().height-f)&&(r.setOptions({state:c}),this._drawPanes.forEach(d=>{var h;d.getId()!==ad.X_AXIS&&(d.setVisible(!0),(h=this._separatorPanes.get(d))==null||h.setVisible(!0))}));break}}}}Os(e.axis)&&(s=!0);const l={...e};if(delete l.state,r.setOptions(l),a===e.id)break}}s&&this.layout({measureHeight:t,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}getPaneOptions(e){if(Os(e)){const t=this.getDrawPaneById(e);return(t==null?void 0:t.getOptions())??null}return this._drawPanes.map(t=>t.getOptions())}setZoomEnabled(e){this._chartStore.setZoomEnabled(e)}isZoomEnabled(){return this._chartStore.isZoomEnabled()}setScrollEnabled(e){this._chartStore.setScrollEnabled(e)}isScrollEnabled(){return this._chartStore.isScrollEnabled()}scrollByDistance(e,t){const s=nl(t)&&t>0?t:0;if(this._chartStore.startScroll(),s>0){const o=new qx({duration:s});o.doFrame(r=>{const a=e*(r/s);this._chartStore.scroll(a)}),o.start()}else this._chartStore.scroll(e)}scrollToRealTime(e){const{bar:t}=this._chartStore.getBarSpace(),o=(this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/t)*t;this.scrollByDistance(o,e)}scrollToDataIndex(e,t){const s=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-e))*this._chartStore.getBarSpace().bar;this.scrollByDistance(s,t)}scrollToTimestamp(e,t){const s=Ux(this.getDataList(),"timestamp",e);this.scrollToDataIndex(s,t)}zoomAtCoordinate(e,t,s){const o=nl(s)&&s>0?s:0,{bar:r}=this._chartStore.getBarSpace(),l=r*e-r;if(o>0){let c=0;const f=new qx({duration:o});f.doFrame(u=>{const d=l*(u/o),h=(d-c)/this._chartStore.getBarSpace().bar*Gx;this._chartStore.zoom(h,t),c=d}),f.start()}else this._chartStore.zoom(l/r*Gx,t)}zoomAtDataIndex(e,t,s){const o=this._chartStore.dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:o,y:0},s)}zoomAtTimestamp(e,t,s){const o=Ux(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,o,s)}convertToPixel(e,t){const{paneId:s=ad.CANDLE,absolute:o=!1}=t??{};let r=[];if(s!==ad.X_AXIS){const a=this.getDrawPaneById(s);if(a!==null){const l=a.getBounding(),c=[].concat(e),f=this._xAxisPane.getAxisComponent(),u=a.getAxisComponent();r=c.map(d=>{const h={};let m=d.dataIndex;if(nl(d.timestamp)&&(m=this._chartStore.timestampToDataIndex(d.timestamp)),nl(m)&&(h.x=f.convertToPixel(m)),nl(d.value)){const g=u.convertToPixel(d.value);h.y=o?l.top+g:g}return h})}}return e0(e)?r:r[0]??{}}convertFromPixel(e,t){const{paneId:s=ad.CANDLE,absolute:o=!1}=t??{};let r=[];if(s!==ad.X_AXIS){const a=this.getDrawPaneById(s);if(a!==null){const l=a.getBounding(),c=[].concat(e),f=this._xAxisPane.getAxisComponent(),u=a.getAxisComponent();r=c.map(d=>{const h={};if(nl(d.x)){const m=f.convertFromPixel(d.x);h.dataIndex=m,h.timestamp=this._chartStore.dataIndexToTimestamp(m)??void 0}if(nl(d.y)){const m=o?d.y-l.top:d.y;h.value=u.convertFromPixel(m)}return h})}}return e0(e)?r:r[0]??{}}executeAction(e,t){switch(e){case"onCrosshairChange":{const s={...t};s.paneId??(s.paneId=ad.CANDLE),this._chartStore.setCrosshair(s,{notExecuteAction:!0});break}}}subscribeAction(e,t){this._chartStore.subscribeAction(e,t)}unsubscribeAction(e,t){this._chartStore.unsubscribeAction(e,t)}getConvertPictureUrl(e,t,s){const{width:o,height:r}=this._chartBounding,a=R0("canvas",{width:`${o}px`,height:`${r}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=t_(a);a.width=o*c,a.height=r*c,l.scale(c,c),l.fillStyle=s??"#FFFFFF",l.fillRect(0,0,o,r);const f=e??!1;return this._drawPanes.forEach(u=>{const d=this._separatorPanes.get(u);if(Os(d)){const m=d.getBounding();l.drawImage(d.getImage(f),m.left,m.top,m.width,m.height)}const h=u.getBounding();l.drawImage(u.getImage(f),0,h.top,o,h.height)}),a.toDataURL(`image/${t??"jpeg"}`)}resize(){this._cacheChartBounding(),!(this._chartBounding.width<=0||this._chartBounding.height<=0)&&this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}destroy(){this._chartEvent.destroy(),this._drawPanes.forEach(e=>{e.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._chartStore.destroy(),this._container.removeChild(this._chartContainer)}}const ix={Main:0,Overlay:1,Separator:2,Drawer:3,All:4},J6=new Map;let G7=1;function Y7(n,e){let t=null;if(pf(n)?t=document.getElementById(n):t=n,t===null)return null;let s=J6.get(t.id);if(Os(s))return s;const o=`k_line_chart_${G7++}`;return s=new U7(t,e),s.id=o,t.setAttribute("duty-chart-id",o),J6.set(o,s),s}const Jv={clone:Q_,merge:nh,isString:pf,isNumber:nl,isValid:Os,isObject:wg,isArray:e0,isFunction:ng,isBoolean:dy,formatValue:Ph,formatPrecision:tv,formatBigNumber:_3,formatDate:g3,formatThousands:y3,formatFoldDecimal:b3,calcTextWidth:sh,getLinearSlopeIntercept:T2,getLinearYFromSlopeIntercept:Dw,getLinearYFromCoordinates:fy,checkCoordinateOnArc:E3,checkCoordinateOnCircle:A3,checkCoordinateOnLine:k3,checkCoordinateOnPolygon:T3,checkCoordinateOnRect:Bw,checkCoordinateOnText:L3},vt={Solid:"solid",Dashed:"dashed"},B_={Fill:"fill",Stroke:"stroke",StrokeFill:"stroke_fill"},Zg={OnZoom:"onZoom",OnScroll:"onScroll",OnVisibleRangeChange:"onVisibleRangeChange",OnCandleTooltipFeatureClick:"onCandleTooltipFeatureClick",OnIndicatorTooltipFeatureClick:"onIndicatorTooltipFeatureClick",OnCrosshairFeatureClick:"onCrosshairFeatureClick",OnCrosshairChange:"onCrosshairChange",OnCandleBarClick:"onCandleBarClick",OnPaneDrag:"onPaneDrag"},K7={Normal:"normal",WeakMagnet:"weak_magnet",StrongMagnet:"strong_magnet"},X7={Left:"left",Middle:"middle",Right:"right"},Q6={Always:"always",FollowCross:"follow_cross",None:"none"},Z7={CandleSolid:"candle_solid",CandleStroke:"candle_stroke",CandleUpStroke:"candle_up_stroke",CandleDownStroke:"candle_down_stroke",Ohlc:"ohlc",Area:"area"},J7={Tooltip:"tooltip",Crosshair:"crosshair",XAxis:"xAxis"};var rx={local:{},session:{}};function Q7(n){return n==="local"?localStorage:sessionStorage}function Uw(n,e,t){var s,o,r,a,l,c,f,u;const d=(s=void 0)!=null?s:JSON,h=(o=void 0)!=null?o:"local",m=(r=void 0)!=null?r:!0,g=(l=(a=void 0)!=null?a:void 0)!=null?l:O=>console.error(`Error when writing value from persisted store "${n}" to ${h}`,O),w=(c=void 0)!=null?c:(O,D)=>console.error(`Error when parsing ${O?'"'+O+'"':"value"} from persisted store "${n}"`,D),C=(f=void 0)!=null?f:O=>O,M=(u=void 0)!=null?u:O=>O,P=typeof window<"u"&&typeof document<"u",T=P?Q7(h):null;function N(O,D){const $=M(D);try{T==null||T.setItem(O,d.stringify($))}catch(z){g(z)}}function L(){function O(te){try{return d.parse(te)}catch(pe){w(te,pe)}}const D=T==null?void 0:T.getItem(n);if(D==null)return e;const $=O(D);return $==null?e:C($)}if(!rx[h][n]){const O=L(),D=Fm(O,te=>{if(P&&h=="local"&&m){const pe=J=>{if(J.key===n&&J.newValue){let le;try{le=d.parse(J.newValue)}catch(he){w(J.newValue,he);return}const de=C(le);te(de)}};return window.addEventListener("storage",pe),()=>window.removeEventListener("storage",pe)}}),{subscribe:$,set:z}=D;rx[h][n]={set(te){z(te),N(n,te)},update(te){return D.update(pe=>{const J=te(pe);return N(n,J),J})},reset(){this.set(e)},subscribe:$}}return rx[h][n]}const T1=J7,Dg=Jv.formatDate;let Gw=!0,Yw="UTC";vp.extend(Ww);vp.extend(Vw);vp.tz.setDefault("UTC");const Xx=60,Zx=Xx*60,py=Zx*24,ek=py*7,tk=py*30,nk=py*365,eP={"Africa/Abidjan":"utc","Pacific/Honolulu":"honolulu","America/Juneau":"juneau","America/Los_Angeles":"los_angeles","America/Chicago":"chicago","America/Toronto":"toronto","America/Sao_Paulo":"sao_paulo","Europe/London":"london","Europe/Berlin":"berlin","Asia/Bahrain":"bahrain","Asia/Dubai":"dubai","Asia/Ashkhabad":"ashkhabad","Asia/Almaty":"almaty","Asia/Dhaka":"dhaka","Asia/Bangkok":"bangkok","Asia/Shanghai":"shanghai","Asia/Tokyo":"tokyo","Australia/Sydney":"sydney","Pacific/Guadalcanal":"guadalcanal","Pacific/Auckland":"auckland"};function tP(){return vp().valueOf()}function sk(n){if(!n)return 0;n=n.trim();const e=/^\d+$/.test(n);let t=null;if(e){const s=n.length;if(s==4){const o=new Date().getFullYear();t=vp(`${o}${n}`,"YYYYMMDD")}else if(s==6){const o=parseInt(n.substring(0,2)),r=o>50?1900+o:2e3+o,a=n.substring(2);t=vp(`${r}${a}`,"YYYYMMDD")}else if(s==8)t=vp(n,"YYYYMMDD");else if(s==10)t=vp.unix(parseInt(n));else if(s==12)t=vp(n,"YYYYMMDDHHmm");else if(s==13)t=vp(parseInt(n));else if(s==14)t=vp(n,"YYYYMMDDHHmmss");else return console.error("invalid date format:",n),0}else t=vp(n,["YYYY/MM/DD","YYYY/MM/DD HH:mm","YYYY/MM/DD HH:mm:ss","YYYY-MM-DD","YYYY-MM-DD HH:mm","YYYY-MM-DD HH:mm:ss"],!0);return!t||!t.isValid()?(console.error("Invalid date format or value:",n),0):(Gw||console.error("local timezone not applied"),t=t.tz(Yw,!0),t.valueOf())}function ok(n,e="YYYY-MM-DD HH:mm:ss",t=void 0){if(!n)return"--";let s=null;return n>1e12?s=vp(n):s=vp.unix(n),s=s.tz(t||Yw,!0),Gw||console.error("local timezone not applied"),s.format(e)}function nP(n,e,t){let s=e,o=s;switch(n.timespan){case"minute":{s=s-s%(60*1e3),o=s-t*n.multiplier*60*1e3;break}case"hour":{s=s-s%(60*60*1e3),o=s-t*n.multiplier*60*60*1e3;break}case"day":{s=s-s%(60*60*1e3),o=s-t*n.multiplier*24*60*60*1e3;break}case"week":{const a=new Date(s).getDay(),l=a===0?6:a-1;s=s-l*60*60*24;const c=new Date(s);s=new Date(`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`).getTime(),o=t*n.multiplier*7*24*60*60*1e3;break}case"month":{const r=new Date(s),a=r.getFullYear(),l=r.getMonth()+1;s=new Date(`${a}-${l}-01`).getTime(),o=t*n.multiplier*30*24*60*60*1e3;const c=new Date(o);o=new Date(`${c.getFullYear()}-${c.getMonth()+1}-01`).getTime();break}}return[o,s]}function mp(n){if(!n)return 0;const e=n.substring(n.length-1),t=parseInt(n.substring(0,n.length-1));let s=0;if(e=="y")s=31536e3;else if(e=="M")s=2592e3;else if(e=="w")s=604800;else if(e=="d")s=86400;else if(e=="h")s=3600;else if(e=="m")s=60;else if(e=="s")s=1;else throw Error(`unsupport timeframe: ${n}`);return s*t}function sP(n){return n>nk?`${Math.floor(n/nk)}y`:n>tk?`${Math.floor(n/tk)}M`:n>ek?`${Math.floor(n/ek)}w`:n>py?`${Math.floor(n/py)}d`:n>Zx?`${Math.floor(n/Zx)}h`:n>Xx?`${Math.floor(n/Xx)}m`:`${Math.floor(n)}s`}function Jx(n){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};n!==void 0&&(e.timeZone=n);let t=null;try{t=new Intl.DateTimeFormat("en",e)}catch{console.error("","","Timezone is error!!!")}return t}const oP=Jx()||new Intl.DateTimeFormat("en");let Gv=oP;function ik(n){function e(t,s,o){if(!t||isNaN(t)||t<=0)return new Date().toISOString().slice(0,19).replace("T"," ");switch(n){case"second":return o===T1.XAxis?Dg(Gv,t,"HH:mm:ss"):Dg(Gv,t,"YYYY-MM-DD HH:mm:ss");case"minute":return o===T1.XAxis?Dg(Gv,t,"HH:mm"):Dg(Gv,t,"YYYY-MM-DD HH:mm");case"hour":return o===T1.XAxis?Dg(Gv,t,"MM-DD HH:mm"):Dg(Gv,t,"YYYY-MM-DD HH:mm");case"day":case"week":return Dg(Gv,t,"YYYY-MM-DD");case"month":return o===T1.XAxis?Dg(Gv,t,"YYYY-MM"):Dg(Gv,t,"YYYY-MM-DD");case"year":return o===T1.XAxis?Dg(Gv,t,"YYYY"):Dg(Gv,t,"YYYY-MM-DD")}return Dg(Gv,t,"YYYY-MM-DD HH:mm")}return e}async function rk(n){let e=(n||"").trim();if(e&&(e==="Africa/Abidjan"||e.toLowerCase().indexOf("utc")>=0)&&(e="UTC"),!e)try{e=vp.tz.guess()}catch{try{e=Intl.DateTimeFormat().resolvedOptions().timeZone}catch{}}e||(e="UTC"),vp.tz.setDefault(e),Yw=e,Gw=!0;const t=Jx(e)||Jx()||Gv;t&&(Gv=t)}function iP(){return Object.entries(eP).map(([n,e])=>({key:n,text:e}))}const rP=()=>"Time",aP=()=>"时间",lP=(n={},e={})=>({en:rP,"zh-CN":aP})[e.languageTag??lo()](),cP=()=>"O",uP=()=>"开",dP=(n={},e={})=>({en:cP,"zh-CN":uP})[e.languageTag??lo()](),fP=()=>"H",pP=()=>"高",mP=(n={},e={})=>({en:fP,"zh-CN":pP})[e.languageTag??lo()](),hP=()=>"L",vP=()=>"低",gP=(n={},e={})=>({en:hP,"zh-CN":vP})[e.languageTag??lo()](),_P=()=>"C",yP=()=>"收",bP=(n={},e={})=>({en:_P,"zh-CN":yP})[e.languageTag??lo()](),xP=()=>"vol",wP=()=>"量",kP=(n={},e={})=>({en:xP,"zh-CN":wP})[e.languageTag??lo()](),SP=()=>"Chg",CP=()=>"涨跌",IP=(n={},e={})=>({en:SP,"zh-CN":CP})[e.languageTag??lo()](),PP=()=>"Timeframe",MP=()=>"周期",Q3=(n={},e={})=>({en:PP,"zh-CN":MP})[e.languageTag??lo()](),NP=()=>"No Data",AP=()=>"数据为空",TP=(n={},e={})=>({en:NP,"zh-CN":AP})[e.languageTag??lo()](),FP=()=>"Indicator",LP=()=>"指标",Kw=(n={},e={})=>({en:FP,"zh-CN":LP})[e.languageTag??lo()](),EP=()=>"Timezone",$P=()=>"时区",e4=(n={},e={})=>({en:EP,"zh-CN":$P})[e.languageTag??lo()](),DP=()=>"Setting",RP=()=>"设置",jP=(n={},e={})=>({en:DP,"zh-CN":RP})[e.languageTag??lo()](),BP=()=>"Confirm",OP=()=>"确认",zP=(n={},e={})=>({en:BP,"zh-CN":OP})[e.languageTag??lo()](),VP=()=>"Cancel",WP=()=>"取消",HP=(n={},e={})=>({en:VP,"zh-CN":WP})[e.languageTag??lo()](),qP=()=>"Search Symbol",UP=()=>"搜索品种",t4=(n={},e={})=>({en:qP,"zh-CN":UP})[e.languageTag??lo()](),GP=()=>"This indicator has no parameters",YP=()=>"该指标没有参数",n4=(n={},e={})=>({en:GP,"zh-CN":YP})[e.languageTag??lo()](),KP=()=>"Search",XP=()=>"搜索",s4=(n={},e={})=>({en:KP,"zh-CN":XP})[e.languageTag??lo()](),ZP=()=>"Settings",JP=()=>"设置",o4=(n={},e={})=>({en:ZP,"zh-CN":JP})[e.languageTag??lo()](),QP=()=>"Screenshot",eM=()=>"截图",tM=(n={},e={})=>({en:QP,"zh-CN":eM})[e.languageTag??lo()](),nM=()=>"Grid Show",sM=()=>"显示网格",oM=(n={},e={})=>({en:nM,"zh-CN":sM})[e.languageTag??lo()](),iM=()=>"Restore",rM=()=>"恢复",aM=(n={},e={})=>({en:iM,"zh-CN":rM})[e.languageTag??lo()](),lM=()=>"Reset",cM=()=>"重置",uM=(n={},e={})=>({en:lM,"zh-CN":cM})[e.languageTag??lo()](),dM=()=>"Candlestick Type",fM=()=>"蜡烛图类型",pM=(n={},e={})=>({en:dM,"zh-CN":fM})[e.languageTag??lo()](),mM=()=>"Candlestick",hM=()=>"全实心",vM=(n={},e={})=>({en:mM,"zh-CN":hM})[e.languageTag??lo()](),gM=()=>"Hollow",_M=()=>"全空心",yM=(n={},e={})=>({en:gM,"zh-CN":_M})[e.languageTag??lo()](),bM=()=>"Up Hollow",xM=()=>"涨空心",wM=(n={},e={})=>({en:bM,"zh-CN":xM})[e.languageTag??lo()](),kM=()=>"Down Hollow",SM=()=>"跌空心",CM=(n={},e={})=>({en:kM,"zh-CN":SM})[e.languageTag??lo()](),IM=()=>"OHLC",PM=()=>"OHLC",MM=(n={},e={})=>({en:IM,"zh-CN":PM})[e.languageTag??lo()](),NM=()=>"Area",AM=()=>"面积图",TM=(n={},e={})=>({en:NM,"zh-CN":AM})[e.languageTag??lo()](),FM=()=>"Price Axis Type",LM=()=>"价格轴类型",EM=(n={},e={})=>({en:FM,"zh-CN":LM})[e.languageTag??lo()](),$M=()=>"Reverse Coordinate",DM=()=>"反转坐标",RM=(n={},e={})=>({en:$M,"zh-CN":DM})[e.languageTag??lo()](),jM=()=>"Show Last Price",BM=()=>"显示最新价",OM=(n={},e={})=>({en:jM,"zh-CN":BM})[e.languageTag??lo()](),zM=()=>"Show High Price",VM=()=>"显示最高价",WM=(n={},e={})=>({en:zM,"zh-CN":VM})[e.languageTag??lo()](),HM=()=>"Show Low Price",qM=()=>"显示最低价",UM=(n={},e={})=>({en:HM,"zh-CN":qM})[e.languageTag??lo()](),GM=()=>"Show Indicator Last Value",YM=()=>"显示指标最新值",KM=(n={},e={})=>({en:GM,"zh-CN":YM})[e.languageTag??lo()](),XM=()=>"Param ",ZM=()=>"参数",i4=(n={},e={})=>({en:XM,"zh-CN":ZM})[e.languageTag??lo()](),JM=()=>"Period",QM=()=>"周期",Qx=(n={},e={})=>({en:JM,"zh-CN":QM})[e.languageTag??lo()](),eN=()=>"StdDev",tN=()=>"标准差",r4=(n={},e={})=>({en:eN,"zh-CN":tN})[e.languageTag??lo()](),nN=()=>"Normal",sN=()=>"正常",oN=(n={},e={})=>({en:nN,"zh-CN":sN})[e.languageTag??lo()](),iN=()=>"Percentage",rN=()=>"百分比",aN=(n={},e={})=>({en:iN,"zh-CN":rN})[e.languageTag??lo()](),lN=()=>"Log",cN=()=>"对数",uN=(n={},e={})=>({en:lN,"zh-CN":cN})[e.languageTag??lo()](),dN=()=>" Bars",fN=()=>"根",a4=(n={},e={})=>({en:dN,"zh-CN":fN})[e.languageTag??lo()](),pN=()=>"days",mN=()=>"天",l4=(n={},e={})=>({en:pN,"zh-CN":mN})[e.languageTag??lo()](),hN=()=>"hours",vN=()=>"时",c4=(n={},e={})=>({en:hN,"zh-CN":vN})[e.languageTag??lo()](),gN=()=>"mins",_N=()=>"分",ew=(n={},e={})=>({en:gN,"zh-CN":_N})[e.languageTag??lo()](),yN=()=>"Minutes",bN=()=>"分钟",u4=(n={},e={})=>({en:yN,"zh-CN":bN})[e.languageTag??lo()](),xN=()=>"Hours",wN=()=>"小时",d4=(n={},e={})=>({en:xN,"zh-CN":wN})[e.languageTag??lo()](),kN=()=>"Days",SN=()=>"日",f4=(n={},e={})=>({en:kN,"zh-CN":SN})[e.languageTag??lo()](),CN=()=>"Weeks",IN=()=>"周",p4=(n={},e={})=>({en:CN,"zh-CN":IN})[e.languageTag??lo()](),PN=()=>"Months",MN=()=>"月",m4=(n={},e={})=>({en:PN,"zh-CN":MN})[e.languageTag??lo()](),NN=()=>"Horizontal Straight Line",AN=()=>"水平直线",TN=(n={},e={})=>({en:NN,"zh-CN":AN})[e.languageTag??lo()](),FN=()=>"Horizontal Ray Line",LN=()=>"水平射线",EN=(n={},e={})=>({en:FN,"zh-CN":LN})[e.languageTag??lo()](),$N=()=>"Horizontal Segment",DN=()=>"水平线段",RN=(n={},e={})=>({en:$N,"zh-CN":DN})[e.languageTag??lo()](),jN=()=>"Vertical Straight Line",BN=()=>"垂直直线",ON=(n={},e={})=>({en:jN,"zh-CN":BN})[e.languageTag??lo()](),zN=()=>"Vertical Ray Line",VN=()=>"垂直射线",WN=(n={},e={})=>({en:zN,"zh-CN":VN})[e.languageTag??lo()](),HN=()=>"Vertical Segment",qN=()=>"垂直线段",UN=(n={},e={})=>({en:HN,"zh-CN":qN})[e.languageTag??lo()](),GN=()=>"Straight Line",YN=()=>"直线",KN=(n={},e={})=>({en:GN,"zh-CN":YN})[e.languageTag??lo()](),XN=()=>"Ray Line",ZN=()=>"射线",JN=(n={},e={})=>({en:XN,"zh-CN":ZN})[e.languageTag??lo()](),QN=()=>"Segment",eA=()=>"线段",tA=(n={},e={})=>({en:QN,"zh-CN":eA})[e.languageTag??lo()](),nA=()=>"Arrow",sA=()=>"箭头",oA=(n={},e={})=>({en:nA,"zh-CN":sA})[e.languageTag??lo()](),iA=()=>"Price Line",rA=()=>"价格线",aA=(n={},e={})=>({en:iA,"zh-CN":rA})[e.languageTag??lo()](),lA=()=>"Price Channel Line",cA=()=>"价格通道线",uA=(n={},e={})=>({en:lA,"zh-CN":cA})[e.languageTag??lo()](),dA=()=>"Parallel Straight Line",fA=()=>"平行直线",pA=(n={},e={})=>({en:dA,"zh-CN":fA})[e.languageTag??lo()](),mA=()=>"Fibonacci Retracement Segment",hA=()=>"斐波那契回调线段",vA=(n={},e={})=>({en:mA,"zh-CN":hA})[e.languageTag??lo()](),gA=()=>"Fibonacci Circle",_A=()=>"斐波那契圆环",yA=(n={},e={})=>({en:gA,"zh-CN":_A})[e.languageTag??lo()](),bA=()=>"Fibonacci Spiral",xA=()=>"斐波那契螺旋",wA=(n={},e={})=>({en:bA,"zh-CN":xA})[e.languageTag??lo()](),kA=()=>"Fibonacci Speed Resistance Fan",SA=()=>"斐波那契速度阻力扇",CA=(n={},e={})=>({en:kA,"zh-CN":SA})[e.languageTag??lo()](),IA=()=>"Fibonacci Extension",PA=()=>"斐波那契趋势扩展",MA=(n={},e={})=>({en:IA,"zh-CN":PA})[e.languageTag??lo()](),NA=()=>"Gann Box",AA=()=>"江恩箱",TA=(n={},e={})=>({en:NA,"zh-CN":AA})[e.languageTag??lo()](),FA=()=>"Rectangle",LA=()=>"矩形",EA=(n={},e={})=>({en:FA,"zh-CN":LA})[e.languageTag??lo()](),$A=()=>"Parallelogram",DA=()=>"平行四边形",RA=(n={},e={})=>({en:$A,"zh-CN":DA})[e.languageTag??lo()](),jA=()=>"Circle",BA=()=>"圆",OA=(n={},e={})=>({en:jA,"zh-CN":BA})[e.languageTag??lo()](),zA=()=>"Triangle",VA=()=>"三角形",WA=(n={},e={})=>({en:zA,"zh-CN":VA})[e.languageTag??lo()](),HA=()=>"Three Waves",qA=()=>"三浪",UA=(n={},e={})=>({en:HA,"zh-CN":qA})[e.languageTag??lo()](),GA=()=>"Five Waves",YA=()=>"五浪",KA=(n={},e={})=>({en:GA,"zh-CN":YA})[e.languageTag??lo()](),XA=()=>"Eight Waves",ZA=()=>"八浪",JA=(n={},e={})=>({en:XA,"zh-CN":ZA})[e.languageTag??lo()](),QA=()=>"Any Waves",eT=()=>"任意浪",tT=(n={},e={})=>({en:QA,"zh-CN":eT})[e.languageTag??lo()](),nT=()=>"ABCD Pattern",sT=()=>"ABCD形态",oT=(n={},e={})=>({en:nT,"zh-CN":sT})[e.languageTag??lo()](),iT=()=>"XABCD Pattern",rT=()=>"XABCD形态",aT=(n={},e={})=>({en:iT,"zh-CN":rT})[e.languageTag??lo()](),lT=()=>"Weak Magnet Mode",cT=()=>"弱磁模式",uT=(n={},e={})=>({en:lT,"zh-CN":cT})[e.languageTag??lo()](),dT=()=>"Strong Magnet Mode",fT=()=>"强磁模式",pT=(n={},e={})=>({en:dT,"zh-CN":fT})[e.languageTag??lo()](),mT=()=>"Moving Average",hT=()=>"移动平均",vT=(n={},e={})=>({en:mT,"zh-CN":hT})[e.languageTag??lo()](),gT=()=>"Exponential Moving Average",_T=()=>"指数移动平均",yT=(n={},e={})=>({en:gT,"zh-CN":_T})[e.languageTag??lo()](),bT=()=>"Simple Moving Average",xT=()=>"简单移动平均",wT=(n={},e={})=>({en:bT,"zh-CN":xT})[e.languageTag??lo()](),kT=()=>"Bollinger Bands",ST=()=>"布林线",CT=(n={},e={})=>({en:kT,"zh-CN":ST})[e.languageTag??lo()](),IT=()=>"Parabolic SAR",PT=()=>"抛物线转向",MT=(n={},e={})=>({en:IT,"zh-CN":PT})[e.languageTag??lo()](),NT=()=>"Bull and Bear Index",AT=()=>"多空指标",TT=(n={},e={})=>({en:NT,"zh-CN":AT})[e.languageTag??lo()](),FT=()=>"Volume",LT=()=>"成交量",ET=(n={},e={})=>({en:FT,"zh-CN":LT})[e.languageTag??lo()](),$T=()=>"Moving Average Convergence Divergence",DT=()=>"平滑异同移动平均线",RT=(n={},e={})=>({en:$T,"zh-CN":DT})[e.languageTag??lo()](),jT=()=>"KDJ Index",BT=()=>"随机指标",OT=(n={},e={})=>({en:jT,"zh-CN":BT})[e.languageTag??lo()](),zT=()=>"Relative Strength Index",VT=()=>"相对强弱指数",WT=(n={},e={})=>({en:zT,"zh-CN":VT})[e.languageTag??lo()](),HT=()=>"Bias",qT=()=>"乖离率",UT=(n={},e={})=>({en:HT,"zh-CN":qT})[e.languageTag??lo()](),GT=()=>"Bull and Bear Ratio",YT=()=>"人气意愿指标",KT=(n={},e={})=>({en:GT,"zh-CN":YT})[e.languageTag??lo()](),XT=()=>"Commodity Channel Index",ZT=()=>"顺势指标",JT=(n={},e={})=>({en:XT,"zh-CN":ZT})[e.languageTag??lo()](),QT=()=>"Energy",eF=()=>"能量指标",tF=(n={},e={})=>({en:QT,"zh-CN":eF})[e.languageTag??lo()](),nF=()=>"Psychological Line",sF=()=>"心理线",oF=(n={},e={})=>({en:nF,"zh-CN":sF})[e.languageTag??lo()](),iF=()=>"Parallel Line Difference",rF=()=>"平行线差指标",aF=(n={},e={})=>({en:iF,"zh-CN":rF})[e.languageTag??lo()](),lF=()=>"Triple Exponential Moving Average",cF=()=>"三重指数平滑移动平均线",uF=(n={},e={})=>({en:lF,"zh-CN":cF})[e.languageTag??lo()](),dF=()=>"On Balance Volume",fF=()=>"能量潮",pF=(n={},e={})=>({en:dF,"zh-CN":fF})[e.languageTag??lo()](),mF=()=>"Volume Variation Rate",hF=()=>"成交量变异率",vF=(n={},e={})=>({en:mF,"zh-CN":hF})[e.languageTag??lo()](),gF=()=>"Williams Percentage Range",_F=()=>"威廉指标",yF=(n={},e={})=>({en:gF,"zh-CN":_F})[e.languageTag??lo()](),bF=()=>"Momentum",xF=()=>"动量指标",wF=(n={},e={})=>({en:bF,"zh-CN":xF})[e.languageTag??lo()](),kF=()=>"Ease of Movement",SF=()=>"简易波动指标",CF=(n={},e={})=>({en:kF,"zh-CN":SF})[e.languageTag??lo()](),IF=()=>"Rate of Change",PF=()=>"变动率指标",MF=(n={},e={})=>({en:IF,"zh-CN":PF})[e.languageTag??lo()](),NF=()=>"Price Volume Trend",AF=()=>"量价趋势",TF=(n={},e={})=>({en:NF,"zh-CN":AF})[e.languageTag??lo()](),FF=()=>"Awesome Oscillator",LF=()=>"震荡指标",EF=(n={},e={})=>({en:FF,"zh-CN":LF})[e.languageTag??lo()](),$F=()=>"Directional Movement Index",DF=()=>"趋向指标",RF=(n={},e={})=>({en:$F,"zh-CN":DF})[e.languageTag??lo()](),jF=()=>"Coordinated Universal Time (UTC)",BF=()=>"世界统一时间",OF=(n={},e={})=>({en:jF,"zh-CN":BF})[e.languageTag??lo()](),zF=()=>"(UTC-10) Honolulu",VF=()=>"(UTC-10) 檀香山",WF=(n={},e={})=>({en:zF,"zh-CN":VF})[e.languageTag??lo()](),HF=()=>"(UTC-8) Juneau",qF=()=>"(UTC-8) 朱诺",UF=(n={},e={})=>({en:HF,"zh-CN":qF})[e.languageTag??lo()](),GF=()=>"(UTC-7) Los Angeles",YF=()=>"(UTC-7) 洛杉矶",KF=(n={},e={})=>({en:GF,"zh-CN":YF})[e.languageTag??lo()](),XF=()=>"(UTC-5) Chicago",ZF=()=>"(UTC-5) 芝加哥",JF=(n={},e={})=>({en:XF,"zh-CN":ZF})[e.languageTag??lo()](),QF=()=>"(UTC-4) Toronto",eL=()=>"(UTC-4) 多伦多",tL=(n={},e={})=>({en:QF,"zh-CN":eL})[e.languageTag??lo()](),nL=()=>"(UTC-3) São Paulo",sL=()=>"(UTC-3) 圣保罗",oL=(n={},e={})=>({en:nL,"zh-CN":sL})[e.languageTag??lo()](),iL=()=>"(UTC+1) London",rL=()=>"(UTC+1) 伦敦",aL=(n={},e={})=>({en:iL,"zh-CN":rL})[e.languageTag??lo()](),lL=()=>"(UTC+2) Berlin",cL=()=>"(UTC+2) 柏林",uL=(n={},e={})=>({en:lL,"zh-CN":cL})[e.languageTag??lo()](),dL=()=>"(UTC+3) Bahrain",fL=()=>"(UTC+3) 巴林",pL=(n={},e={})=>({en:dL,"zh-CN":fL})[e.languageTag??lo()](),mL=()=>"(UTC+4) Dubai",hL=()=>"(UTC+4) 迪拜",vL=(n={},e={})=>({en:mL,"zh-CN":hL})[e.languageTag??lo()](),gL=()=>"(UTC+5) Ashkhabad",_L=()=>"(UTC+5) 阿什哈巴德",yL=(n={},e={})=>({en:gL,"zh-CN":_L})[e.languageTag??lo()](),bL=()=>"(UTC+5) Almaty",xL=()=>"(UTC+5) 阿拉木图",wL=(n={},e={})=>({en:bL,"zh-CN":xL})[e.languageTag??lo()](),kL=()=>"(UTC+6) Dhaka",SL=()=>"(UTC+6) 达卡",CL=(n={},e={})=>({en:kL,"zh-CN":SL})[e.languageTag??lo()](),IL=()=>"(UTC+7) Bangkok",PL=()=>"(UTC+7) 曼谷",ML=(n={},e={})=>({en:IL,"zh-CN":PL})[e.languageTag??lo()](),NL=()=>"(UTC+8) Shanghai",AL=()=>"(UTC+8) 上海",TL=(n={},e={})=>({en:NL,"zh-CN":AL})[e.languageTag??lo()](),FL=()=>"(UTC+9) Tokyo",LL=()=>"(UTC+9) 东京",EL=(n={},e={})=>({en:FL,"zh-CN":LL})[e.languageTag??lo()](),$L=()=>"(UTC+10) Sydney",DL=()=>"(UTC+10) 悉尼",RL=(n={},e={})=>({en:$L,"zh-CN":DL})[e.languageTag??lo()](),jL=()=>"(UTC+11) Solomon Islands",BL=()=>"(UTC+11) 所罗门群岛",OL=(n={},e={})=>({en:jL,"zh-CN":BL})[e.languageTag??lo()](),zL=()=>"(UTC+12) Auckland",VL=()=>"(UTC+12) 奥克兰",WL=(n={},e={})=>({en:zL,"zh-CN":VL})[e.languageTag??lo()](),Bg=Object.freeze(Object.defineProperty({__proto__:null,AO:EF,BBI:TT,BIAS:UT,BOLL:CT,BRAR:KT,CCI:JT,CR:tF,DMA:aF,DMI:RF,EMA:yT,EMV:CF,KDJ:OT,MA:vT,MACD:RT,MTM:wF,OBV:pF,PSY:oF,PVT:TF,ROC:MF,RSI:WT,SAR:MT,SMA:wT,TRIX:uF,VOL:ET,VR:vF,WR:yF,abcd:oT,almaty:wL,any_waves:tT,area:TM,arrow:oA,ashkhabad:yL,auckland:WL,bahrain:pL,bangkok:ML,berlin:uL,cancel:HP,candle_down_stroke:CM,candle_solid:vM,candle_stroke:yM,candle_type:pM,candle_up_stroke:wM,change_:IP,chicago:JF,circle:OA,close_:bP,confirm:zP,day:f4,days:l4,dhaka:CL,dubai:vL,eight_waves:JA,fibonacci_circle:yA,fibonacci_extension:MA,fibonacci_segment:vA,fibonacci_speed_resistance_fan:CA,fibonacci_spiral:wA,five_waves:KA,gann_box:TA,grid_show:oM,guadalcanal:OL,high_:mP,high_price_show:WM,honolulu:WF,horizontal_ray_line:EN,horizontal_segment:RN,horizontal_straight_line:TN,hour:d4,hours:c4,indicator:Kw,indicator_last_value_show:KM,juneau:UF,last_price_show:OM,log:uN,london:aL,los_angeles:KF,low_:gP,low_price_show:UM,mins:ew,minute:u4,month:m4,no_data:TP,no_ind_params:n4,normal:oN,num_bar:a4,ohlc:MM,open_:dP,parallel_straight_line:pA,parallelogram:RA,param:i4,percentage:aN,period:Qx,price_axis_type:EM,price_channel_line:uA,price_line:aA,ray_line:JN,rect:EA,reset:uM,restore:aM,reverse_coordinate:RM,sao_paulo:oL,screenshot:tM,search:s4,segment:tA,setting:jP,settings:o4,shanghai:TL,standard_deviation:r4,straight_line:KN,strongMagnet:pT,sydney:RL,symbol_search:t4,three_waves:UA,time_:lP,timeframe:Q3,timezone:e4,tokyo:EL,toronto:tL,triangle:WA,utc:OF,vertical_ray_line:WN,vertical_segment:UN,vertical_straight_line:ON,volume_:kP,weakMagnet:uT,week:p4,xabcd:aT},Symbol.toStringTag,{value:"Module"})),HL=["MA","EMA","SMA","BOLL","SAR","BBI"],qL=["VOL","MACD","KDJ","RSI","BIAS","BRAR","CCI","DMI","CR","PSY","TRIX","OBV","VR","WR","MTM","EMV","ROC","PVT","AO"];class h4{constructor(){$e(this,"editPaneId");$e(this,"editIndName");$e(this,"modalIndCfg");$e(this,"fireOhlcv");$e(this,"dutyLoaded");$e(this,"cloudIndLoaded");$e(this,"initDone");$e(this,"clickChart");$e(this,"loadingDuty");$e(this,"loadingPairs");$e(this,"timeStart");$e(this,"timeEnd");$e(this,"allInds");$e(this,"isApplyingManualStyles");$e(this,"applyCanvasColors");$e(this,"clearCciGroups");$e(this,"clearEmvGroups");$e(this,"clearMtmGroups");$e(this,"clearObvGroups");$e(this,"clearPsyGroups");$e(this,"clearPvtGroups");$e(this,"clearRocGroups");$e(this,"clearVolGroups");$e(this,"clearWrGroups");this.editPaneId="",this.editIndName="",this.modalIndCfg=!1,this.fireOhlcv=0,this.dutyLoaded=0,this.cloudIndLoaded=0,this.initDone=0,this.clickChart=0,this.loadingDuty=!1,this.loadingPairs=!1,this.timeStart=0,this.timeEnd=0,this.allInds=[],this.isApplyingManualStyles=!1,this.clearCciGroups=0,this.clearEmvGroups=0,this.clearMtmGroups=0,this.clearObvGroups=0,this.clearPsyGroups=0,this.clearPvtGroups=0,this.clearRocGroups=0,this.clearVolGroups=0,this.clearWrGroups=0;for(let e of HL){const t=`${e} (${Bg[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!0})}for(let e of qL){const t=`${e} (${Bg[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!1})}}}class Ob{constructor(){$e(this,"showDrawBar");$e(this,"showSidebar");$e(this,"period");$e(this,"symbol");$e(this,"dateStart");$e(this,"dateEnd");$e(this,"timezone");$e(this,"curSymbols");$e(this,"allSymbols");$e(this,"allExgs");$e(this,"colorLong");$e(this,"colorShort");$e(this,"saveInds");$e(this,"key");$e(this,"theme");$e(this,"styles");$e(this,"options");this.showDrawBar=!0,this.showSidebar=!0,this.symbol={name:"Grameen Phone Limited",ticker:"GP",market:"stock",exchange:"DSEBD",type:"stock",priceCurrency:"BDT"},this.period={multiplier:1,timespan:"day",timeframe:"1d",secs:86400};const e=tP();this.dateEnd=ok(e,"YYYYMMDD");const t=e-this.period.secs*1e3*500;this.dateStart=ok(t,"YYYYMMDD"),this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,this.curSymbols=[],this.allSymbols=[],this.allExgs=new Set,this.colorLong="#0000FF",this.colorShort="#FF0000",this.saveInds={},this.key="",this.theme="dark",this.styles={pane:{backgroundColor:"#0A0F1A"},candle:{pane:{backgroundColor:"#0A0F1A"},type:"candle_solid",bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",upBorderColor:"#26A69A",downBorderColor:"#EF5350",noChangeBorderColor:"#888888",upWickColor:"#26A69A",downWickColor:"#EF5350",noChangeWickColor:"#888888"},renko:{method:"ATR",atrLength:14,source:"close",wick:!1},pnf:{boxSizeMode:"absolute",boxSize:1,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}},grid:{horizontal:{color:"#111B2B"},vertical:{color:"#111B2B"}}},this.options={enableRealtime:!1,datafeed:{sessionMode:"regular",adjustMode:"none"}}}}function tw(n,e){const t=e.x>n.x?0:1,s=Jv.getLinearSlopeIntercept(n,e);let o;s?o=Math.atan(s[0])+Math.PI*t:e.y>n.y?o=Math.PI/2:o=Math.PI/2*3;const r=iy({x:e.x-8,y:e.y+4},e,o),a=iy({x:e.x-8,y:e.y-4},e,o);return[{type:"line",attrs:{coordinates:[n,e]}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[r,e,a]}}]}function iy(n,e,t){const s=(n.x-e.x)*Math.cos(t)-(n.y-e.y)*Math.sin(t)+e.x,o=(n.x-e.x)*Math.sin(t)+(n.y-e.y)*Math.cos(t)+e.y;return{x:s,y:o}}function nw(n,e){if(n.length>1){let t;const s=n[0],o=n[1];return s.x===o.x&&s.y!==o.y?s.y<o.y?t={x:s.x,y:e.height}:t={x:s.x,y:0}:s.x>o.x?t={x:0,y:Jv.getLinearYFromCoordinates(s,o,{x:0,y:s.y})}:t={x:e.width,y:Jv.getLinearYFromCoordinates(s,o,{x:e.width,y:s.y})},{coordinates:[s,t]}}return[]}function v4(n,e){const t=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y);return Math.sqrt(t*t+s*s)}function Xw(n,e,t){let s=2;try{(t==null?void 0:t.isInCandle())??!0?s=2:s=4}catch{s=2}return s}const g4={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length>1?tw(n[0],n[1]):[]},_4={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:n})=>{if(n.length>1){const e=v4(n[0],n[1]),t=[];return t.push({type:"circle",attrs:{...n[0],r:e+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),t.push({type:"circle",attrs:{...n[0],r:e},styles:{style:"stroke_fill"}}),t}return[]}},y4={name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n})=>{if(n.length>1){const e=[],s=[{x:n[0].x-30,y:n[0].y-30},{x:n[1].x+30,y:n[0].y-30},{x:n[1].x+30,y:n[1].y+30},{x:n[0].x-30,y:n[1].y+30}];return e.push({type:"polygon",attrs:{coordinates:s},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),e.push({type:"polygon",attrs:{coordinates:[n[0],{x:n[1].x,y:n[0].y},n[1],{x:n[0].x,y:n[1].y}]},styles:{style:"stroke_fill"}}),e}return[]}},b4={name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n})=>{if(n.length===2)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:n}}];if(n.length===3){const e={x:n[0].x+(n[2].x-n[1].x),y:n[2].y};return[{type:"polygon",attrs:{coordinates:[n[0],n[1],n[2],e]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:({points:n,performPointIndex:e,performPoint:t})=>{e<2&&(n[0].price=t.price,n[1].price=t.price)},performEventMoveForDrawing:({currentStep:n,points:e,performPoint:t})=>{n===2&&(e[0].price=t.price)}},x4={name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n})=>[{type:"polygon",attrs:{coordinates:n},styles:{style:"stroke_fill"}}]},w4={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{var t,s,o,r;if(n.length>1){const a=Math.abs(n[0].x-n[1].x),l=Math.abs(n[0].y-n[1].y),c=Math.sqrt(a*a+l*l),f=[.236,.382,.5,.618,.786,1],u=[],d=[];return f.forEach(h=>{const m=c*h;u.push({...n[0],r:m}),d.push({x:n[0].x,y:n[0].y+m+6,text:`${(h*100).toFixed(1)}%`})}),[{type:"circle",attrs:u,styles:{style:"stroke",borderSize:((s=(t=e.styles)==null?void 0:t.line)==null?void 0:s.size)??2}},{type:"text",ignoreEvent:!0,attrs:d,styles:{color:((r=(o=e.styles)==null?void 0:o.line)==null?void 0:r.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}return[]}},UL=[{value:0,color:"#FF6B6B",visible:!0},{value:.236,color:"#4ECDC4",visible:!0},{value:.382,color:"#45B7D1",visible:!0},{value:.5,color:"#96CEB4",visible:!0},{value:.618,color:"#FFEAA7",visible:!0},{value:1,color:"#98D8C8",visible:!0},{value:1.618,color:"#85C1E9",visible:!0}],GL=15;function k4(n){return typeof n!="number"||Number.isNaN(n)?GL:Math.max(0,Math.min(100,n))}function YL(n){const e=(n||"").trim();if(!e)return null;if(/^#([0-9a-f]{6})$/i.test(e))return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(e)){const s=e[1],o=e[2],r=e[3];return{r:parseInt(s+s,16),g:parseInt(o+o,16),b:parseInt(r+r,16)}}const t=e.match(/^rgba?\(([^)]+)\)$/i);if(t){const s=t[1].split(",").map(o=>parseFloat(o.trim()));if(s.length>=3&&s.every(o=>!Number.isNaN(o)))return{r:Math.round(s[0]),g:Math.round(s[1]),b:Math.round(s[2])}}return null}function KL(n,e){const t=YL(n);if(!t)return n;const s=k4(e)/100;return`rgba(${t.r}, ${t.g}, ${t.b}, ${s})`}const S4={name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{line:{size:1,color:"#1e88e5"},polygon:{color:"rgba(30, 136, 229, 0.1)"}},createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:s})=>{var a,l,c,f,u,d,h,m,g,w,C,M,P;const o=Xw(n,t,s),r=[];if(e.length>1){const T=t.points,N=(a=T[0])==null?void 0:a.value,L=(l=T[1])==null?void 0:l.value;if(N===void 0||L===void 0)return r;const O=L-N,D=e[0].y,$=e[1].y,z=$-D,pe=(((c=t.extendData)==null?void 0:c.fibonacciLevels)||t.fibonacciLevels||UL).filter(He=>He.visible);for(let He=0;He<pe.length-1;He++){const Ue=pe[He],et=pe[He+1],ft=$-z*Ue.value,it=$-z*et.value,Lt=k4(Ue.opacity);r.push({type:"polygon",attrs:{coordinates:[{x:e[0].x,y:ft},{x:e[1].x,y:ft},{x:e[1].x,y:it},{x:e[0].x,y:it}]},styles:{style:"fill",color:KL(Ue.color,Lt)}})}const J=[],le=[],de=t.extendData||{},he=String(de.labelSide??de.labelPosition??"left").trim().toLowerCase(),ge=de.labelGap??de.labelOffset??12,ae=typeof ge=="number"&&Number.isFinite(ge)?Math.max(0,ge):12,Ie=String(de.labelAlign||"").trim().toLowerCase(),ce=Math.min(e[0].x,e[1].x),je=Math.max(e[0].x,e[1].x),Ve=he==="right"?je+ae:ce-ae,We=Ie==="left"||Ie==="center"||Ie==="right"?Ie:he==="right"?"left":"right";pe.forEach(He=>{const Ue=$-z*He.value,et=(L-O*He.value).toFixed(o);J.push({coordinates:[{x:e[0].x,y:Ue},{x:e[1].x,y:Ue}]}),le.push({x:Ve,y:Ue,text:`${(He.value*100).toFixed(1)}% (${et})`,baseline:"middle",align:We})}),r.push({type:"line",attrs:J,styles:{size:24,color:"transparent"}}),r.push({type:"line",attrs:J,styles:{size:((u=(f=t.styles)==null?void 0:f.line)==null?void 0:u.size)||1,color:((h=(d=t.styles)==null?void 0:d.line)==null?void 0:h.color)||"#1e88e5"}}),r.push({type:"text",ignoreEvent:!0,attrs:le,styles:{color:((g=(m=t.styles)==null?void 0:m.text)==null?void 0:g.color)||"#666666",backgroundColor:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"solid",size:24,color:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"dashed",size:((C=(w=t.styles)==null?void 0:w.line)==null?void 0:C.size)||1,color:((P=(M=t.styles)==null?void 0:M.line)==null?void 0:P.color)||"#1e88e5"}})}return r}},C4={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e})=>{if(n.length>1){const t=v4(n[0],n[1])/Math.sqrt(24),s=n[1].x>n[0].x?0:1,o=Jv.getLinearSlopeIntercept(n[0],n[1]);let r;o?r=Math.atan(o[0])+Math.PI*s:n[1].y>n[0].y?r=Math.PI/2:r=Math.PI/2*3;const a=iy({x:n[0].x-t,y:n[0].y},n[0],r),l=iy({x:n[0].x-t,y:n[0].y-t},n[0],r),c=[{...a,r:t,startAngle:r,endAngle:r+Math.PI/2},{...l,r:t*2,startAngle:r+Math.PI/2,endAngle:r+Math.PI}];let f=n[0].x-t,u=n[0].y-t;for(let d=2;d<9;d++){const h=c[d-2].r+c[d-1].r;let m=0;switch(d%4){case 0:{m=r,f-=c[d-2].r;break}case 1:{m=r+Math.PI/2,u-=c[d-2].r;break}case 2:{m=r+Math.PI,f+=c[d-2].r;break}case 3:{m=r+Math.PI/2*3,u+=c[d-2].r;break}}const g=m+Math.PI/2,w=iy({x:f,y:u},n[0],r);c.push({...w,r:h,startAngle:m,endAngle:g})}return[{type:"arc",attrs:c,styles:{size:2}},{type:"line",attrs:nw(n,e),styles:{size:2}}]}return[]}},I4={name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:e,overlay:t})=>{var a,l,c,f,u,d;const s=[];let o=[];const r=[];if(n.length>1){const h=n[1].x>n[0].x?-38:4,m=n[1].y>n[0].y?-2:20,g=n[1].x-n[0].x,w=n[1].y-n[0].y;[1,.75,.618,.5,.382,.25,0].forEach(M=>{const P=n[1].x-g*M,T=n[1].y-w*M;s.push({coordinates:[{x:P,y:n[0].y},{x:P,y:n[1].y}]}),s.push({coordinates:[{x:n[0].x,y:T},{x:n[1].x,y:T}]}),o=o.concat(nw([n[0],{x:P,y:n[1].y}],e)),o=o.concat(nw([n[0],{x:n[1].x,y:T}],e)),r.unshift({x:n[0].x+h,y:T+10,text:`${M.toFixed(3)}`}),r.unshift({x:P-18,y:n[0].y+m,text:`${M.toFixed(3)}`})})}return[{type:"line",attrs:s,styles:{size:((l=(a=t.styles)==null?void 0:a.line)==null?void 0:l.size)??2}},{type:"line",attrs:o,styles:{size:((f=(c=t.styles)==null?void 0:c.line)==null?void 0:f.size)??2}},{type:"text",ignoreEvent:!0,attrs:r,styles:{color:((d=(u=t.styles)==null?void 0:u.line)==null?void 0:d.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},P4={name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:s})=>{var l,c,f,u,d,h;const o=Xw(n,t,s),r=[],a=[];if(e.length>2){const m=t.points,g=m[1].value-m[0].value,w=e[1].y-e[0].y,C=[0,.236,.382,.5,.618,.786,1,1.618,2.618],P=Math.min(e[1].x,e[2].x)-16;C.forEach(T=>{const N=e[2].y+w*T,L=(m[2].value+g*T).toFixed(o);r.push({coordinates:[{x:e[1].x,y:N},{x:e[2].x,y:N}]}),a.push({x:P,y:N,text:`${L} (${(T*100).toFixed(1)}%)`,baseline:"middle",align:"right"})})}return[{type:"line",attrs:{coordinates:e},styles:{style:"dashed",size:((c=(l=t.styles)==null?void 0:l.line)==null?void 0:c.size)??2}},{type:"line",attrs:r,styles:{size:((u=(f=t.styles)==null?void 0:f.line)==null?void 0:u.size)??2}},{type:"text",ignoreEvent:!0,attrs:a,styles:{color:((h=(d=t.styles)==null?void 0:d.line)==null?void 0:h.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},M4={name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n,overlay:e})=>{var t,s,o,r;if(n.length>1){const a=(n[1].y-n[0].y)/4,l=n[1].x-n[0].x,c=[{coordinates:[n[0],{x:n[1].x,y:n[1].y-a}]},{coordinates:[n[0],{x:n[1].x,y:n[1].y-a*2}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y+a}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y+a*2}]},{coordinates:[{...n[0]},{x:n[0].x+l*.236,y:n[1].y}]},{coordinates:[{...n[0]},{x:n[0].x+l*.5,y:n[1].y}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[0].x+l*.236,y:n[0].y}]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[0].x+l*.5,y:n[0].y}]}],f=[{coordinates:[n[0],n[1]]},{coordinates:[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[0].y}]}];return[{type:"line",attrs:[{coordinates:[n[0],{x:n[1].x,y:n[0].y}]},{coordinates:[{x:n[1].x,y:n[0].y},n[1]]},{coordinates:[n[1],{x:n[0].x,y:n[1].y}]},{coordinates:[{x:n[0].x,y:n[1].y},n[0]]}]},{type:"polygon",attrs:{coordinates:[n[0],{x:n[1].x,y:n[0].y},n[1],{x:n[0].x,y:n[1].y}]},styles:{style:"fill"}},{type:"line",attrs:c,styles:{style:"dashed",size:((s=(t=e.styles)==null?void 0:t.line)==null?void 0:s.size)??1}},{type:"line",attrs:f,styles:{size:((r=(o=e.styles)==null?void 0:o.line)==null?void 0:r.size)??1}}]}return[]}},N4={name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},A4={name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},T4={name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},F4={name:"anyWaves",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=n.map((s,o)=>({...s,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"text",ignoreEvent:!0,attrs:t}]}},L4={name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{let t=[],s=[];const o=["A","B","C","D"],r=n.map((a,l)=>({...a,baseline:"bottom",text:`(${o[l]})`}));return n.length>2&&(t=[n[0],n[2]],n.length>3&&(s=[n[1],n[3]])),[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:[{coordinates:t},{coordinates:s}],styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"line",attrs:[{coordinates:t},{coordinates:s}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:r}]}},E4={name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.1)"}},createPointFigures:({coordinates:n,overlay:e})=>{const s=[],o=[],r=["X","A","B","C","D"],a=n.map((l,c)=>({...l,baseline:"bottom",text:`(${r[c]})`}));return n.length>2&&(s.push({coordinates:[n[0],n[2]]}),o.push({coordinates:[n[0],n[1],n[2]]}),n.length>3&&(s.push({coordinates:[n[1],n[3]]}),n.length>4&&(s.push({coordinates:[n[2],n[4]]}),o.push({coordinates:[n[2],n[3],n[4]]})))),[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:s,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}},{type:"line",attrs:s,styles:{style:"dashed"}},{type:"polygon",attrs:o},{type:"text",ignoreEvent:!0,attrs:a}]}};function XL(n,e,t,s){const o=e==="bottom"?1:-1,r=n.x,a=r+200,l=n.y+3*o,c=l+50*o,f=c+5*o,u=s?{color:s}:{},d=s?{backgroundColor:s,borderColor:s}:{};return[{type:"line",attrs:{coordinates:[{x:r,y:l},{x:r,y:c}]},ignoreEvent:!0},{type:"line",attrs:{coordinates:[{x:r,y:n.y},{x:a,y:n.y}]},ignoreEvent:!0,styles:{...u}},{type:"polygon",attrs:{coordinates:[{x:r,y:c},{x:r-4,y:f},{x:r+4,y:f}]},ignoreEvent:!0,styles:u},{type:"rectText",attrs:{x:r,y:f,text:t??"",align:"center",baseline:"bottom"},ignoreEvent:!0,styles:d}]}const $4={name:"barSignal",totalStep:2,createPointFigures:({overlay:n,coordinates:e})=>{let{postion:t,text:s,bgColor:o}=n.extendData,r=[];return e.forEach(a=>{r.push(...XL(a,t,s,o))}),r}};function ZL(n){let o=[];if(n>86400){const r=Math.floor(n/86400);o.push(r.toString(),l4()),n=n%86400}if(n>3600){const r=Math.floor(n/3600);o.push(r.toString(),c4()),n=n%3600}if(n>60){const r=Math.floor(n/60);o.push(r.toString(),ew()),n=n%60}return n>0&&o.push("1",ew()),o.join("")}const D4={name:"ruler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},onDeselected:n=>{var e;return(e=n.chart)==null||e.removeOverlay({id:n.overlay.id}),!0},createPointFigures:({chart:n,coordinates:e,overlay:t,yAxis:s})=>{const o=Xw(n,t,s);if(e.length>1){const r=e[0],a=e[1],l=(r.x+a.x)/2,c=(r.y+a.y)/2,f=tw({x:l,y:r.y},{x:l,y:a.y}),u=tw({x:r.x,y:c},{x:a.x,y:c}),d=r.y>a.y?"#F7525F":"#2962FF",h={color:"#ffffff",backgroundColor:d,borderColor:d,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},m=t.points,g=m[0].value-m[1].value,w=g.toFixed(o),C=(g/m[0].value*100).toFixed(2),M=m[1].dataIndex-m[0].dataIndex,P=(m[1].timestamp-m[0].timestamp)/1e3,T=`${w} (${C}%)
${M}${a4()}, ${ZL(P)}`;let N=a.y+10,L="top";r.y>a.y&&(N=a.y-10,L="bottom");const O=[],D=30,$=[{x:r.x-D,y:r.y-D},{x:a.x+D,y:r.y-D},{x:a.x+D,y:a.y+D},{x:r.x-D,y:a.y+D}];return O.push({type:"polygon",attrs:{coordinates:$},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),O.push({type:"polygon",attrs:{coordinates:[r,{x:a.x,y:r.y},a,{x:r.x,y:a.y}]},styles:{style:"stroke_fill"}}),O.push({type:"textBox",attrs:{x:l,y:N,text:T,align:"center",baseline:L},ignoreEvent:!0,styles:h}),O.push(...f),O.push(...u),O}return[]}},F1=(n,e)=>{try{const t=typeof window<"u"?window.drawBarRef:null,s=t==null?void 0:t[n];typeof s=="function"&&s(e)}catch{}},ak=n=>{try{typeof document<"u"&&(document.body.style.cursor=n)}catch{}},lk=n=>{try{typeof window<"u"&&(window.__overlayHover=n)}catch{}},ck={color:"#ffffff",paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},R4={name:"trade",lock:!1,zLevel:90,totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{if(n.length<=1)return[];const t=e.extendData,s=n[0],o=n[1],r={size:.5};t&&t.line_color&&(r.color=t.line_color);const a=[],l={type:"line",attrs:{coordinates:[s,o]},styles:{color:"transparent",size:40},ignoreEvent:!1};a.push(l);const c={type:"line",attrs:{coordinates:[s,o]},styles:r};if(a.push(c),!t.active&&!t.selected)return a;const f=t.distance??15;let u="bottom",d=s.y-f,h="top",m=o.y+f;s.y>o.y&&(u="top",d=s.y+f,h="bottom",m=o.y-f);const g={type:"textBox",attrs:{x:s.x,y:d,text:t.in_text,align:"center",baseline:u},ignoreEvent:!0,styles:{...ck,backgroundColor:t.in_color,borderColor:t.in_color}},w={type:"textBox",attrs:{x:o.x,y:m,text:t.out_text,align:"center",baseline:h},ignoreEvent:!0,styles:{...ck,backgroundColor:t.out_color,borderColor:t.out_color}},C={type:"line",attrs:{coordinates:[s,{x:s.x,y:d}]},ignoreEvent:!0,styles:r},M={type:"line",attrs:{coordinates:[o,{x:o.x,y:m}]},ignoreEvent:!0,styles:r};return[l,c,g,w,C,M]},onSelected:n=>{const e=n.overlay.extendData;return e.selected=!0,F1("externalSelectOverlay",n.overlay),!0},onClick:n=>{const e=n.overlay.extendData;return e.selected=!0,F1("externalSelectOverlay",n.overlay),!0},onDeselected:n=>{const e=n.overlay.extendData;return e.selected=!1,F1("externalDeselectOverlay",n.overlay),!0},onMouseEnter:n=>{const e=n.overlay.extendData;return e.active=!0,lk(!0),ak("pointer"),!0},onMouseLeave:n=>{const e=n.overlay.extendData;return e.active=!1,lk(!1),ak(""),!0},onPressedMoveEnd:n=>(F1("externalSyncOverlay",n.overlay),!0),onRemoved:n=>(F1("externalRemoved",n.overlay.id),!0)},L1={color:"#ffffff",size:12,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},ax=(n,e)=>{try{const t=n.extendData||{};t.selected=e,n.extendData=t}catch{}},E1=(n,e)=>{try{const t=typeof window<"u"?window.drawBarRef:null,s=t==null?void 0:t[n];typeof s=="function"&&s(e)}catch{}},uk=n=>{try{typeof document<"u"&&(document.body.style.cursor=n)}catch{}},dk=n=>{try{typeof window<"u"&&(window.__overlayHover=n)}catch{}},j4={name:"note",lock:!1,zLevel:100,totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,overlay:e})=>{if(n.length==0)return[];const t=e.extendData,s=n[0],o={size:.5};t&&t.line_color&&(o.color=t.line_color);const r=t.distance??15,a=typeof t.offsetX=="number"?t.offsetX:0,l=typeof t.offsetY=="number"?t.offsetY:0;let c="bottom",f=s.y-r+l;const u=t.align||(a>0?"left":a<0?"right":"center"),d=(t==null?void 0:t.in_text)??"",h={type:"textBox",attrs:{x:s.x+a,y:f,text:d,align:u,baseline:c},ignoreEvent:!1,styles:{...L1,backgroundColor:t.in_color,borderColor:t.in_color}},m=12,g=Math.round(m*1.4),w=Jv.calcTextWidth(d,m),C=Math.max(36,w+(L1.paddingLeft+L1.paddingRight)+12),M=Math.max(18,g+(L1.paddingTop+L1.paddingBottom)),P=u==="left"?s.x+a:u==="right"?s.x+a-C:s.x+a-C/2,T=c==="top"?f:c==="bottom"?f-M:f-M/2,N={type:"rect",attrs:{x:P,y:T,width:C,height:M},ignoreEvent:!1,styles:{style:"fill",color:"transparent"}},L={type:"line",attrs:{coordinates:[s,{x:s.x+a,y:f}]},ignoreEvent:!0,styles:o};return[N,h,L]},onSelected:n=>{var e;return ax(n.overlay,!0),(e=n.chart)==null||e.overrideOverlay({id:n.overlay.id,extendData:n.overlay.extendData}),E1("externalSelectOverlay",n.overlay),!0},onClick:n=>{var e;return ax(n.overlay,!0),(e=n.chart)==null||e.overrideOverlay({id:n.overlay.id,extendData:n.overlay.extendData}),E1("externalSelectOverlay",n.overlay),!0},onDeselected:n=>{var e;return ax(n.overlay,!1),(e=n.chart)==null||e.overrideOverlay({id:n.overlay.id,extendData:n.overlay.extendData}),E1("externalDeselectOverlay",n.overlay),!0},onPressedMoveEnd:n=>(E1("externalSyncOverlay",n.overlay),!0),onRemoved:n=>(E1("externalRemoved",n.overlay.id),!0),onMouseEnter:()=>(dk(!0),uk("pointer"),!0),onMouseLeave:()=>(dk(!1),uk(""),!0)},B4={name:"emoji",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},createPointFigures:({coordinates:n,overlay:e})=>{if(n.length===0)return[];const t=e.extendData;if(!t||!t.emoji)return[];const s=n[0],o=t.size||24;t.rotation;const r=t.selected||!1;t.active;const a=[],l=e.styles||{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},c={type:"text",attrs:{x:s.x,y:s.y,text:t.emoji,align:"center",baseline:"middle"},styles:{size:o,family:"Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif",weight:"normal",backgroundColor:"transparent"}};if(a.push(c),r){const f=o/2,u=4,d={type:"rect",attrs:{x:s.x-f-u,y:s.y-f-u,width:o+u*2,height:o+u*2},styles:{stroke:l.box.stroke,strokeWidth:l.box.width,fill:"transparent",backgroundColor:"transparent"}};a.push(d);const h=l.handles.size,m=f+u;[{x:s.x-m-h/2,y:s.y-m-h/2},{x:s.x+m-h/2,y:s.y-m-h/2},{x:s.x-m-h/2,y:s.y+m-h/2},{x:s.x+m-h/2,y:s.y+m-h/2}].forEach(w=>{const C={type:"rect",attrs:{x:w.x,y:w.y,width:h,height:h},styles:{fill:l.handles.fill,stroke:l.handles.stroke,strokeWidth:1,backgroundColor:"transparent"}};a.push(C)})}return a},onDrawStart:n=>!0,onDrawing:n=>!0,onDrawEnd:n=>!0,onPressedMoveStart:n=>!0,onPressedMoving:n=>!0,onPressedMoveEnd:n=>!0,onSelected:n=>{const e=n.overlay.extendData;return e&&(e.selected=!0),!1},onDeselected:n=>{const e=n.overlay.extendData;return e&&(e.selected=!1),!1},onMouseEnter:n=>{const e=n.overlay.extendData;return e&&(e.active=!0),!1},onMouseLeave:n=>{const e=n.overlay.extendData;return e&&(e.active=!1),!1}},c_="Add text";class JL{constructor(){$e(this,"editor",null);$e(this,"chart",null);$e(this,"overlay",null);$e(this,"pos",{x:0,y:0});$e(this,"raf",null);$e(this,"lastCommitted","");$e(this,"boundPointerHandler",null);$e(this,"boundKeydownShield",null);$e(this,"placeholderCssInjected",!1)}startEditing(e,t){var s;this.chart=e,this.overlay=t,this.lastCommitted=((s=t.extendData)==null?void 0:s.text)??"",this.ensureEditor(),this.updateOverlayEditing(!0),this.syncPosition(),this.addOutsideListeners(),this.addKeydownShield(),setTimeout(()=>{var a,l;(a=this.editor)==null||a.focus();const o=((l=t.extendData)==null?void 0:l.text)??"",r=!o||o===c_;this.editor&&(this.editor.innerText=r?"":o,this.editor.setAttribute("data-placeholder",c_),this.editor.classList.add("kc-inline-text-editor"),this.injectPlaceholderCss());try{const c=window.getSelection();if(c&&this.editor){const f=this.editor.innerText.length;this.editor.firstChild&&c.collapse(this.editor.firstChild,Math.min(f,(this.editor.firstChild.textContent||"").length))}}catch{}},0),this.loop()}reEdit(e,t){this.startEditing(e,t)}updateEditorStyle(e){e&&(this.overlay=e),this.applyStylesFromOverlay()}ensureEditor(){if(this.editor)return;const e=document.createElement("div");e.contentEditable="true",e.style.position="fixed",e.style.zIndex="10000",e.style.outline="none",e.style.padding="8px",e.style.whiteSpace="pre-wrap",e.style.wordBreak="break-word",e.style.userSelect="text",e.style.transform="translate(0, -50%)",e.style.boxSizing="border-box",e.addEventListener("keydown",t=>this.onKeyDown(t)),e.addEventListener("input",()=>this.onInput()),e.addEventListener("blur",()=>this.commit()),document.body.appendChild(e),this.editor=e,this.applyStylesFromOverlay()}applyStylesFromOverlay(){var c;if(!this.editor||!this.overlay)return;const e=this.overlay.extendData||{},t=((c=this.overlay.styles)==null?void 0:c.text)||{},s=e.fontSize??t.size??32,o=e.fontWeight??t.weight??"bold",r=e.textColor??t.color??"#FFFFFF",a=e.backgroundColor??t.backgroundColor??"#00000033",l=e.fontFamily??t.family??'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif';this.editor.style.fontSize=`${s}px`,this.editor.style.lineHeight=`${Math.round(s*1.4)}px`,this.editor.style.fontWeight=o,this.editor.style.color=r,this.editor.style.background=a,this.editor.style.border="none",this.editor.style.fontFamily=l,this.editor.style.minWidth="0px",this.editor.style.minHeight=`${Math.round(s*1.4)}px`}loop(){this.raf&&cancelAnimationFrame(this.raf);const e=()=>{this.syncPosition(),this.raf=requestAnimationFrame(e)};this.raf=requestAnimationFrame(e)}syncPosition(){var s;if(!this.chart||!this.overlay||!((s=this.overlay.points)!=null&&s.length))return;const e=this.overlay.paneId||"candle_pane",t=this.chart.convertToPixel(this.overlay.points[0],{paneId:e});t&&typeof t.x=="number"&&typeof t.y=="number"&&(this.pos={x:t.x,y:t.y},this.editor&&(this.editor.style.left=`${this.pos.x}px`,this.editor.style.top=`${this.pos.y}px`))}addOutsideListeners(){if(this.boundPointerHandler)return;const e=t=>{const s=t.target;if(!this.editor||s&&this.editor.contains(s))return;const o=s;o&&(o.closest(".context-menu-container")||o.closest(".premium-submenu"))||this.finishFromOutside()};this.boundPointerHandler=e,document.addEventListener("pointerdown",e,{capture:!0}),document.addEventListener("touchstart",e,{capture:!0}),document.addEventListener("mousedown",e,{capture:!0})}removeOutsideListeners(){this.boundPointerHandler&&(document.removeEventListener("pointerdown",this.boundPointerHandler,{capture:!0}),document.removeEventListener("touchstart",this.boundPointerHandler,{capture:!0}),document.removeEventListener("mousedown",this.boundPointerHandler,{capture:!0}),this.boundPointerHandler=null)}addKeydownShield(){if(this.boundKeydownShield)return;const e=t=>{if(!this.editor)return;const s=t.target;s&&(s===this.editor||this.editor.contains(s))&&t.stopPropagation()};this.boundKeydownShield=e,document.addEventListener("keydown",e,{capture:!0})}removeKeydownShield(){this.boundKeydownShield&&(document.removeEventListener("keydown",this.boundKeydownShield,{capture:!0}),this.boundKeydownShield=null)}finishFromOutside(){if(!this.editor)return;const e=this.editor.innerText||"";try{this.editor.blur()}catch{}!e||e===c_?this.deleteOverlay():this.commit()}onKeyDown(e){var t;if(e.stopPropagation(),e.key==="Escape"){e.preventDefault();const s=(((t=this.editor)==null?void 0:t.innerText)||"").trim();!s||s===c_?this.deleteOverlay():this.revert()}e.key==="Backspace"||e.key==="Delete"||e.key}onInput(){if(!this.editor||!this.chart||!this.overlay)return;this.editor.innerText.length>0?this.editor.setAttribute("data-placeholder",c_):this.editor.setAttribute("data-placeholder",c_);const e=Math.max(12,this.editor.scrollWidth),t=Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)),s=getComputedStyle(this.editor),o=parseFloat(s.paddingLeft||"0")+parseFloat(s.paddingRight||"0"),r=parseFloat(s.paddingTop||"0")+parseFloat(s.paddingBottom||"0"),a=Math.max(0,e-o),l=Math.max(0,t-r),c={...this.overlay.extendData||{},text:this.editor.innerText,boxWidth:e,boxHeight:t,contentWidth:a,contentHeight:l};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:c})}catch{}}updateOverlayEditing(e){if(!this.chart||!this.overlay)return;const t={...this.overlay.extendData||{},editing:e};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:t})}catch{}}commit(){var c;if(!this.chart||!this.overlay){this.cleanup();return}const e=((c=this.editor)==null?void 0:c.innerText)||"";if(!e||e===c_){this.deleteOverlay();return}this.lastCommitted=e;const t=this.editor?Math.max(12,this.editor.scrollWidth):void 0,s=this.editor?Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)):void 0,o=this.editor?getComputedStyle(this.editor):null,r=o?parseFloat(o.paddingLeft||"0")+parseFloat(o.paddingRight||"0"):0,a=o?parseFloat(o.paddingTop||"0")+parseFloat(o.paddingBottom||"0"):0,l={...this.overlay.extendData||{},text:e,editing:!1,...t?{boxWidth:t}:{},...s?{boxHeight:s}:{},...t?{contentWidth:Math.max(0,t-r)}:{},...s?{contentHeight:Math.max(0,s-a)}:{}};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:l})}catch{}this.cleanup()}revert(){if(!this.chart||!this.overlay){this.cleanup();return}const e={...this.overlay.extendData||{},text:this.lastCommitted,editing:!1};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:e})}catch{}this.cleanup()}deleteOverlay(){var e;if(!this.chart||!this.overlay){this.cleanup();return}try{(e=this.editor)==null||e.blur()}catch{}try{this.chart.removeOverlay({id:this.overlay.id})}catch{}this.cleanup()}cleanup(){if(this.raf&&cancelAnimationFrame(this.raf),this.raf=null,this.overlay=null,this.removeOutsideListeners(),this.removeKeydownShield(),this.editor)try{this.editor.remove()}catch{}this.editor=null}getEditorRect(){try{return this.editor?this.editor.getBoundingClientRect():null}catch{return null}}injectPlaceholderCss(){if(!this.placeholderCssInjected)try{const e="kc-inline-text-editor-placeholder-style";if(document.getElementById(e)){this.placeholderCssInjected=!0;return}const t=document.createElement("style");t.id=e,t.textContent=`
        .kc-inline-text-editor:empty::before {
          content: attr(data-placeholder);
          color: rgba(255,255,255,0.6);
        }
      `,document.head.appendChild(t),this.placeholderCssInjected=!0}catch{}}}const A0=new JL,fk="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif",cb=new Map,QL=4,O4={name:"text",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,zLevel:100,styles:{text:{color:"#FFFFFF",backgroundColor:"#00000033",borderColor:"#1677FF",size:32,weight:"bold",family:fk,paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:8,borderSize:1},box:{stroke:"#1677FF",width:1,fill:"transparent"},handles:{size:6,fill:"#1677FF",stroke:"#1677FF"}},createPointFigures:({coordinates:n,overlay:e})=>{var he,ge,ae,Ie,ce,je,Ve,We,He,Ue,et,ft,it,Lt,Tt,Pt,St,st;if(n.length===0)return[];const t=n[0],s=e.extendData||{},o=!!s.editing,r=s.text??"",a=s.fontSize??((ge=(he=e.styles)==null?void 0:he.text)==null?void 0:ge.size)??32,l=s.fontWeight??((Ie=(ae=e.styles)==null?void 0:ae.text)==null?void 0:Ie.weight)??"bold",c=s.fontFamily??((je=(ce=e.styles)==null?void 0:ce.text)==null?void 0:je.family)??fk,f=s.textColor??((We=(Ve=e.styles)==null?void 0:Ve.text)==null?void 0:We.color)??"#FFFFFF",u=s.backgroundColor??((Ue=(He=e.styles)==null?void 0:He.text)==null?void 0:Ue.backgroundColor)??"#00000033",d=((ft=(et=e.styles)==null?void 0:et.text)==null?void 0:ft.paddingLeft)??8,h=((Lt=(it=e.styles)==null?void 0:it.text)==null?void 0:Lt.paddingRight)??8,m=((Pt=(Tt=e.styles)==null?void 0:Tt.text)==null?void 0:Pt.paddingTop)??4,g=((st=(St=e.styles)==null?void 0:St.text)==null?void 0:st.paddingBottom)??4;if(o)return[];if(!(r&&r.length>0&&r!=="Add text"))return[];const C=Math.round(a*1.4),M=String(r).split(/\r?\n/),P=M.map(xt=>Jv.calcTextWidth(xt,a,l,c)),N=P.length?Math.max(...P):Jv.calcTextWidth(r,a,l,c),L=(M.length||1)*C,O=N+d+h,D=L+m+g,$=O,z=D,te=t.x,pe=t.y-Math.round(z/2),J=[];J.push({type:"rect",attrs:{x:te,y:pe,width:$,height:z},styles:{style:B_.Fill,color:u,borderColor:"transparent",borderSize:0}});const le=te+Math.round($/2),de=pe+m+Math.round(C/2);return M.forEach((xt,Je)=>{const Xe=de+Je*C;J.push({type:"text",attrs:{x:le,y:Xe,text:xt,align:"center",baseline:"middle"},styles:{size:a,family:c,weight:l,color:f,backgroundColor:"transparent"}})}),J},onSelected:n=>{var t;const e=n.overlay.extendData||{};e.selected=!0,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e});try{typeof navigator<"u"&&(navigator.maxTouchPoints||0)>0&&n.chart&&A0.startEditing(n.chart,n.overlay)}catch{}return!0},onClick:n=>{var t;const e=n.overlay.extendData||{};return e.editing||n.overlay.lock||(e.selected=!0,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e}),n.chart&&A0.startEditing(n.chart,n.overlay)),!0},onDeselected:n=>{var t;const e=n.overlay.extendData||{};return e.selected=!1,(t=n.chart)==null||t.overrideOverlay({id:n.overlay.id,extendData:e}),!0},onPressedMoveStart:n=>{var o;const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=(o=n.overlay)==null?void 0:o.id;t&&typeof n.x=="number"&&typeof n.y=="number"&&cb.set(t,{x:n.x,y:n.y,moved:!1});const s=n.overlay.paneId;try{const r=n.chart.convertToPixel(n.overlay.points[0],{paneId:s});r&&typeof n.x=="number"&&typeof n.y=="number"&&(e.__dragOffX=n.x-(r.x||0),e.__dragOffY=n.y-(r.y||0),n.chart.overrideOverlay({id:n.overlay.id,extendData:e}))}catch{}return!0},onPressedMoving:n=>{var f;const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=(f=n.overlay)==null?void 0:f.id,s=t?cb.get(t):null;if(s&&!s.moved&&typeof n.x=="number"&&typeof n.y=="number"){const u=n.x-s.x,d=n.y-s.y;Math.hypot(u,d)>QL&&(s.moved=!0)}const o=e.__dragOffX||0,r=e.__dragOffY||0,a=n.overlay.paneId;if(typeof n.x!="number"||typeof n.y!="number")return!0;const l=n.x-o,c=n.y-r;try{const u=n.chart.convertFromPixel([{x:l,y:c}],{paneId:a}),d=Array.isArray(u)?u[0]:u;d&&n.chart.overrideOverlay({id:n.overlay.id,points:[{timestamp:d.timestamp,value:d.value}]})}catch{}return!0},onPressedMoveEnd:n=>{var o;const e=n.overlay.extendData||{};if(e.editing||n.overlay.lock)return!1;const t=(o=n.overlay)==null?void 0:o.id,s=t?cb.get(t):null;if(t&&cb.delete(t),"__dragOffX"in e||"__dragOffY"in e){delete e.__dragOffX,delete e.__dragOffY;try{n.chart.overrideOverlay({id:n.overlay.id,extendData:e})}catch{}}return s&&!s.moved&&n.chart&&n.overlay&&A0.startEditing(n.chart,n.overlay),!0}};function eE(n,e){if(n.length>0){const t=n[0].y;return{coordinates:[{x:0,y:t},{x:e.width,y:t}]}}return{coordinates:[]}}function tE(n,e){if(n.length>1){const t=n[0].y,s=n[0],o=n[1];return s.x>o.x?{coordinates:[{x:0,y:t},s]}:{coordinates:[s,{x:e.width,y:t}]}}return{coordinates:[]}}const z4={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:n,overlay:e,bounding:t})=>{var l,c,f;if(n.length<1)return[];console.log("horizontalStraightLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const s=e.extendData,o=s.interactive!==!1,r=[],a=eE(n,t);if(a.coordinates.length>0){r.push({type:"line",attrs:a,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!o}),r.push({type:"line",attrs:a,ignoreEvent:!o});const u=e.selected===!0;if(s.showDot||u){const d=t.width/2,h=n[0].y,m=((c=(l=e.styles)==null?void 0:l.line)==null?void 0:c.color)||((f=e.styles)==null?void 0:f.color)||"#1677FF";console.log("Drawing dot for horizontalStraightLine:",{x:d,y:h,showDot:s.showDot,selected:u,color:m}),r.push({type:"circle",attrs:{x:d,y:h,r:6},styles:{style:"fill",color:m}}),r.push({type:"circle",attrs:{x:d,y:h,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return r},createYAxisFigures:({chart:n,overlay:e,coordinates:t,yAxis:s,bounding:o})=>{var O,D,$,z,te,pe;if(t.length<1||!e.points||e.points.length<1)return[];const r=(O=e.points[0])==null?void 0:O.value;if(r===void 0)return[];const a=n.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,f=l.ticduty.show?l.ticduty.length:0,u=l.tickText.marginStart,d=l.tickText.marginEnd,h=1,g={...a.crosshair.horizontal.text};let w=0,C="left";if((D=s==null?void 0:s.isFromZero)!=null&&D.call(s))w=c+h,C="left",g.paddingLeft=f+u-h;else{w=((o==null?void 0:o.width)??0)-c-h,C="right";const J=((o==null?void 0:o.width)??0)-c-h,le=((o==null?void 0:o.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.ticduty.show?l.ticduty.length:0)-d;g.paddingRight=J-le}const M=s.getRange();let P=s.displayValueToText(s.realValueToDisplayValue(s.valueToRealValue(r,{range:M}),{range:M}),(($=n.getSymbol())==null?void 0:$.pricePrecision)??2);P=n.getDecimalFold().format(n.getThousandsSeparator().format(P));const T=((te=(z=e.styles)==null?void 0:z.line)==null?void 0:te.color)||((pe=e.styles)==null?void 0:pe.color)||"#1677FF",N=J0(T,g.color),L=t[0].y;return typeof(o==null?void 0:o.height)=="number"&&(L<0||L>o.height)?[]:[{type:"text",attrs:{x:w,y:L,text:P,align:C,baseline:"middle"},styles:{...g,color:N,backgroundColor:T},ignoreEvent:!0}]},onClick:n=>{console.log("🟢 horizontalStraightLine onClick called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onSelected:n=>{console.log("🟢 horizontalStraightLine onSelected called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onDeselected:n=>{console.log("🔴 horizontalStraightLine onDeselected called"),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!1,n.chart&&n.chart.overrideOverlay({id:n.overlay.id,extendData:e}),!0}},V4={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:n,overlay:e,bounding:t})=>{var a,l,c;if(n.length<2)return[];console.log("horizontalRayLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const s=e.extendData,o=[],r=tE(n,t);if(r.coordinates.length>0){o.push({type:"line",attrs:r,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),o.push({type:"line",attrs:r});const f=e.selected===!0;if(s.showDot||f){const u=n[0].x,d=n[0].y,h=((l=(a=e.styles)==null?void 0:a.line)==null?void 0:l.color)||((c=e.styles)==null?void 0:c.color)||"#1677FF";console.log("Drawing dot for horizontalRayLine:",{x:u,y:d,showDot:s.showDot,selected:f,color:h}),o.push({type:"circle",attrs:{x:u,y:d,r:6},styles:{style:"fill",color:h}}),o.push({type:"circle",attrs:{x:u,y:d,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return o},createYAxisFigures:({chart:n,overlay:e,coordinates:t,yAxis:s,bounding:o})=>{var O,D,$,z,te,pe;if(t.length<1||!e.points||e.points.length<1)return[];const r=(O=e.points[0])==null?void 0:O.value;if(r===void 0)return[];const a=n.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,f=l.ticduty.show?l.ticduty.length:0,u=l.tickText.marginStart,d=l.tickText.marginEnd,h=1,g={...a.crosshair.horizontal.text};let w=0,C="left";if((D=s==null?void 0:s.isFromZero)!=null&&D.call(s))w=c+h,C="left",g.paddingLeft=f+u-h;else{w=((o==null?void 0:o.width)??0)-c-h,C="right";const J=((o==null?void 0:o.width)??0)-c-h,le=((o==null?void 0:o.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.ticduty.show?l.ticduty.length:0)-d;g.paddingRight=J-le}const M=s.getRange();let P=s.displayValueToText(s.realValueToDisplayValue(s.valueToRealValue(r,{range:M}),{range:M}),(($=n.getSymbol())==null?void 0:$.pricePrecision)??2);P=n.getDecimalFold().format(n.getThousandsSeparator().format(P));const T=((te=(z=e.styles)==null?void 0:z.line)==null?void 0:te.color)||((pe=e.styles)==null?void 0:pe.color)||"#1677FF",N=J0(T,g.color),L=t[0].y;return typeof(o==null?void 0:o.height)=="number"&&(L<0||L>o.height)?[]:[{type:"text",attrs:{x:w,y:L,text:P,align:C,baseline:"middle"},styles:{...g,color:N,backgroundColor:T},ignoreEvent:!0}]},onClick:n=>{console.log("🟢 horizontalRayLine onClick called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onSelected:n=>{console.log("🟢 horizontalRayLine onSelected called",{overlayId:n.overlay.id,overlayName:n.overlay.name,hasExtendData:!!n.overlay.extendData,extendData:n.overlay.extendData}),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",n.overlay),n.chart&&(console.log("Attempting to override overlay to force redraw..."),n.chart.overrideOverlay({id:n.overlay.id,extendData:e})),!0},onDeselected:n=>{console.log("🔴 horizontalRayLine onDeselected called"),!n.overlay.extendData||typeof n.overlay.extendData!="object"?n.overlay.extendData={showDot:!1}:"showDot"in n.overlay.extendData||(n.overlay.extendData.showDot=!1);const e=n.overlay.extendData;return e.showDot=!1,n.chart&&n.chart.overrideOverlay({id:n.overlay.id,extendData:e}),!0}};function nE(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(e-l,t-c),n.lineTo(e+l,t+c),n.moveTo(e+l,t-c),n.lineTo(e-l,t+c),n.stroke(),n.restore()}function sE(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.beginPath(),n.ellipse(e,t,l,c,0,0,Math.PI*2),n.stroke(),n.restore()}const W4={name:"pointAndFigure",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:()=>[],draw:n=>{var M,P,T;const{ctx:e,chart:t,bounding:s,xAxis:o,yAxis:r,overlay:a}=n;if(!t||!e||!(o!=null&&o.convertToPixel)||!(r!=null&&r.convertToPixel))return[];const l=(M=t.getVisibleRange)==null?void 0:M.call(t);if(!l)return[];const c=((P=t.getDataList)==null?void 0:P.call(t))||[];if(c.length===0)return[];const f=o.convertToPixel(0),u=o.convertToPixel(1),d=Math.max(1,Math.abs(u-f));let h=d;for(let N=l.from;N<=l.to&&N<c.length;N++){const L=(T=c[N])==null?void 0:T._pnf;if(L!=null&&L.boxes&&L.boxes.length>=2){const O=r.convertToPixel(L.boxes[0].price),D=r.convertToPixel(L.boxes[1].price);if(O!==void 0&&D!==void 0&&!isNaN(O)&&!isNaN(D)){const $=Math.abs(O-D);if($>0){h=$;break}}}}const m=d*.85,g=h*.85,w=(m+g)/2,C=Math.max(.8,w*.08);for(let N=l.from;N<=l.to&&N<c.length;N++){const L=c[N];if(!L)continue;const O=L==null?void 0:L._pnf;if(!O||!O.boxes)continue;const{direction:D,boxes:$,upColor:z="#00E6D8",downColor:te="#FF4D4D"}=O,pe=o.convertToPixel(N);if(!(pe==null||isNaN(pe)))for(const J of $){const le=r.convertToPixel(J.price);le==null||isNaN(le)||(D==="up"?nE(e,pe,le,m,g,z,C):sE(e,pe,le,m,g,te,C))}}return[]}},H4={name:"script-layer",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{},createPointFigures:()=>[]},oE=[g4,_4,y4,x4,b4,w4,S4,C4,I4,P4,M4,N4,A4,T4,F4,L4,E4,$4,D4,R4,j4,B4,O4,z4,V4,W4,H4],$1={arrow:g4,circle:_4,rect:y4,triangle:x4,parallelogram:b4,fibonacciCircle:w4,fibonacciSegment:S4,fibonacciSpiral:C4,fibonacciSpeedResistanceFan:I4,fibonacciExtension:P4,gannBox:M4,threeWaves:N4,fiveWaves:A4,eightWaves:T4,anyWaves:F4,abcd:L4,xabcd:E4,barSignal:$4,ruler:D4,trade:R4,note:j4,emoji:B4,text:O4,horizontalStraightLine:z4,horizontalRayLine:V4,pointAndFigure:W4,scriptLayer:H4};function q4(n,e,t){const{size:s=12,paddingLeft:o=0,paddingTop:r=0,paddingRight:a=0,paddingBottom:l=0}=e,{x:c,y:f,text:u,align:d="left",baseline:h="top"}=n;t=t??s*u.length;let m;switch(d){case"left":case"start":{m=c;break}case"right":case"end":{m=c-a-t-o;break}default:{m=c-t/2-o;break}}return m}function U4(n,e,t,s,o){const{size:r=12,paddingLeft:a=0,paddingTop:l=0,paddingRight:c=0,paddingBottom:f=0}=e,{x:u,y:d,text:h,align:m="left",baseline:g="top"}=n,w=h.length;t=t??r*w,s=s??1,o=o??1.5;const C=r*s*o-(o-1)*r,M=q4(n,e,t);let P;switch(g){case"top":case"hanging":{P=d;break}case"bottom":case"ideographic":case"alphabetic":{P=d-C-l-f;break}default:{P=d-C/2-l;break}}return{x:M,y:P,width:a+t+c,height:l+C+f}}const G4=Jv.calcTextWidth;function iE(n,e,t){return`${e??"normal"} ${n??12}px ${t??"Helvetica Neue"}`}function rE(n){return typeof n=="string"}function pk(n){return n==="transparent"||n==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(n)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(n)}function aE(n,e,t){let s=[];s=s.concat(e);const{style:o=B_.Fill,color:r="transparent",borderSize:a=1,borderColor:l="transparent",borderStyle:c=vt.Solid,borderRadius:f=0,borderDashedValue:u=[2,2]}=t,d=n.roundRect??n.rect,h=(o===B_.Fill||t.style===B_.StrokeFill)&&(!rE(r)||!pk(r));if(h&&(n.fillStyle=r,s.forEach(({x:m,y:g,width:w,height:C})=>{n.beginPath(),d.call(n,m,g,w,C,f),n.closePath(),n.fill()})),(o===B_.Stroke||t.style===B_.StrokeFill)&&a>0&&!pk(l)){n.strokeStyle=l,n.fillStyle=l,n.lineWidth=a,c===vt.Dashed?n.setLineDash(u):n.setLineDash([]);const m=a%2===1?.5:0,g=Math.round(m*2);s.forEach(({x:w,y:C,width:M,height:P})=>{M>a*2&&P>a*2?(n.beginPath(),d.call(n,w+m,C+m,M-g,P-g,f),n.closePath(),n.stroke()):h||n.fillRect(w,C,M,P)})}}function lE(n,e,t){const{text:s}=e,{size:o=12,family:r,weight:a,paddingLeft:l=0,paddingTop:c=0,paddingRight:f=0}=t,u=s.split(`
`),d=u.map(M=>G4(M,o,a,r)),h=1.5,m=o*h,g=Math.max(...d),w=U4(e,t,g,u.length,h);aE(n,w,{...t,color:t.backgroundColor});let C=w.y+c;u.forEach((M,P)=>{const T=q4(e,t,d[P])+l;n.textAlign="left",n.textBaseline="top",n.font=iE(o,a,r),n.fillStyle=t.color||"currentColor",n.fillText(M,T,C,w.width-l-f),C+=m})}function cE(n,e,t){const{size:s=12,family:o,weight:r,paddingLeft:a=0,paddingTop:l=0}=t,c=e.text.split(`
`),f=c.map(C=>G4(C,s,r,o)),u=1.5,d=Math.max(...f),{x:h,y:m,width:g,height:w}=U4(e,t,d,c.length,u);return n.x>=h&&n.x<=h+g&&n.y>=m&&n.y<=m+w}const uE={name:"textBox",checkEventOn:(n,e,t)=>cE(n,e,t),draw:(n,e,t)=>{lE(n,e,t)}},dE=[uE],fE={name:"BIAS",shortName:"BIAS",precision:2,calcParams:[6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"bias",title:"BIAS: ",type:"line"}],styles:{lines:[{color:"#2196F3",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||6;return n.reduce((s,o,r)=>{if(r>=t-1){let a=0;for(let c=r-t+1;c<=r;c++)a+=n[c].close;const l=a/t;s[o.timestamp]={bias:(o.close-l)/l*100}}else s[o.timestamp]={};return s},{})}},pE={name:"CCI",shortName:"CCI",precision:2,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cci",title:"CCI: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s]=t;return n.reduce((o,r,a)=>(o[r.timestamp]={cci:mE(n,a,s)},o),{})}};function mE(n,e,t){if(e<t-1)return null;const s=[];for(let f=e-t+1;f<=e;f++){const u=n[f],d=(u.high+u.low+u.close)/3;s.push(d)}const o=s.reduce((f,u)=>f+u,0)/t,r=s.reduce((f,u)=>f+Math.abs(u-o),0)/t;if(r===0)return 0;const a=n[e];return((a.high+a.low+a.close)/3-o)/(.015*r)}const hE={name:"ICHIMOKU",shortName:"ICHIMOKU",precision:4,calcParams:[9,26,52],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"tenkan",title:"Tenkan: ",type:"line"},{key:"kijun",title:"Kijun: ",type:"line"},{key:"senkouA",title:"Senkou A: ",type:"line"},{key:"senkouB",title:"Senkou B: ",type:"line"},{key:"chikou",title:"Chikou: ",type:"line"}],styles:{lines:[{color:"#FF6B6B",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4ECDC4",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#45B7D1",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#FFA07A",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#9B59B6",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||9,s=e.calcParams[1]||26,o=e.calcParams[2]||52,r=s,a=[],l=(f,u)=>{let d=-1/0,h=1/0;for(let m=f;m<f+u&&m<n.length;m++)n[m].high>d&&(d=n[m].high),n[m].low<h&&(h=n[m].low);return{high:d,low:h}};for(let f=0;f<n.length;f++){const u={};if(f>=t-1){const{high:d,low:h}=l(f-t+1,t);u.tenkan=(d+h)/2}if(f>=s-1){const{high:d,low:h}=l(f-s+1,s);u.kijun=(d+h)/2}if(f>=s-1){const d=f,h=f;if(d>=t-1&&h>=s-1){const{high:m,low:g}=l(d-t+1,t),{high:w,low:C}=l(h-s+1,s),M=(m+g)/2,P=(w+C)/2;u.senkouA=(M+P)/2}}if(f>=o-1){const{high:d,low:h}=l(f-o+1,o);u.senkouB=(d+h)/2}u.chikou=n[f].close,a.push(u)}const c=a.map((f,u)=>{var h,m,g;const d={...f};return u>=r?(d.senkouA=(h=a[u-r])==null?void 0:h.senkouA,d.senkouB=(m=a[u-r])==null?void 0:m.senkouB):(d.senkouA=void 0,d.senkouB=void 0),u+r<a.length?d.chikou=(g=n[u+r])==null?void 0:g.close:d.chikou=void 0,d});return n.reduce((f,u,d)=>(f[u.timestamp]=c[d],f),{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var h;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l,u=t.result;n.save();const d=[];for(let m=c;m<f;m++){const g=(h=a[m])==null?void 0:h.timestamp,w=u[g];if(w&&w.senkouA!==void 0&&w.senkouB!==void 0){const C=o.convertToPixel(m),M=r.convertToPixel(w.senkouA),P=r.convertToPixel(w.senkouB);d.push({x:C,yA:M,yB:P})}}if(d.length>1){n.globalAlpha=.2;const m=d[0].yA<d[0].yB;n.fillStyle=m?"#4CAF50":"#F44336",n.beginPath(),n.moveTo(d[0].x,Math.min(d[0].yA,d[0].yB));for(let g=1;g<d.length;g++)n.lineTo(d[g].x,Math.min(d[g].yA,d[g].yB));for(let g=d.length-1;g>=0;g--)n.lineTo(d[g].x,Math.max(d[g].yA,d[g].yB));n.closePath(),n.fill()}return n.restore(),!1}},vE={name:"PVT",shortName:"PVT",precision:2,calcParams:[],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"pvt",title:"PVT: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t={};if(n.length===0)return t;let s=0;for(let o=0;o<n.length;o++){const r=n[o];if(o===0){t[r.timestamp]={pvt:0};continue}const a=n[o-1];if(r.close==null||a.close==null||r.volume==null||r.close<=0||a.close<=0){t[r.timestamp]={};continue}const l=(r.close-a.close)/a.close,c=s+(r.volume||0)*l;t[r.timestamp]={pvt:c},s=c}return t}},Qh=new Map,zb=n=>({id:n,period:14,lineColor:"#8B5CF6",lineThickness:2,lineStyle:"solid",overboughtLevel:70,oversoldLevel:30,middleLevel:50,overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",overboughtFillColor:"#EF4444",oversoldFillColor:"#22C55E",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed",fillOpacity:.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:70,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"70",visible:!0},{id:"middle",value:50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"50",visible:!0},{id:"oversold",value:30,color:"#22C55E",lineStyle:"dashed",thickness:1,label:"30",visible:!0}]}),gE=(n,e)=>{const t=[];if(n.length<e+1)return n.map(()=>NaN);let s=[],o=[];for(let f=1;f<=e;f++){const u=n[f].close-n[f-1].close;s.push(u>0?u:0),o.push(u<0?Math.abs(u):0)}let r=s.reduce((f,u)=>f+u,0)/e,a=o.reduce((f,u)=>f+u,0)/e;for(let f=0;f<e;f++)t.push(NaN);let l=r/(a||1e-4),c=100-100/(1+l);t.push(c);for(let f=e+1;f<n.length;f++){const u=n[f].close-n[f-1].close,d=u>0?u:0,h=u<0?Math.abs(u):0;r=(r*(e-1)+d)/e,a=(a*(e-1)+h)/e,l=r/(a||1e-4),c=100-100/(1+l),t.push(c)}return t};function _E(n){if(!n)return null;const e=n.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i);if(e)return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)};const t=n.match(/^#?([a-f\d])([a-f\d])([a-f\d])$/i);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16)};const s=n.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*[\d.]+\s*)?\)/i);return s?{r:parseInt(s[1],10),g:parseInt(s[2],10),b:parseInt(s[3],10)}:null}function ub(n,e,t,s,o){if(e<=o&&s>=o||e>=o&&s<=o){if(e===s)return null;const r=(o-e)/(s-e);return{x:n+r*(t-n),y:o}}return null}const Y4={name:"RSI",shortName:"RSI",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"rsi",title:"RSI: ",type:"line"}],styles:{lines:[{color:"#8B5CF6",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,s=gE(n,t);return n.reduce((o,r,a)=>{const l=s[a];return o[r.timestamp]={rsi:isNaN(l)?null:l},o},{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var g,w,C,M;const a=t.paneId||"default";let l=Qh.get(a);l||(l=zb(a),Qh.set(a,l));const{left:c,width:f}=s,u=e.getVisibleRange(),d=e.getDataList();n.save();const h=r.convertToPixel(l.overboughtLevel),m=r.convertToPixel(l.oversoldLevel);if(l.showFill){const P=[],T=[];let N=!1,L=!1;for(let O=u.from;O<=u.to;O++){const D=(g=d[O])==null?void 0:g.timestamp,$=t.result[D];if(!$||$.rsi===null||$.rsi===void 0)continue;const z=o.convertToPixel(O),te=r.convertToPixel($.rsi);if(z===null||te===null)continue;const pe=(w=d[O-1])==null?void 0:w.timestamp,J=O>0?t.result[pe]:null,le=J==null?void 0:J.rsi,de=O>0?o.convertToPixel(O-1):null,he=le!=null?r.convertToPixel(le):null;if($.rsi>l.overboughtLevel){if(!N&&(N=!0,de!==null&&he!==null&&le!==null&&le!==void 0&&le<=l.overboughtLevel)){const ge=ub(de,he,z,te,h);ge&&(P.push({x:ge.x,y:h}),ge.x)}P.push({x:z,y:te})}else if(N){if(de!==null&&he!==null&&le!==null&&le!==void 0){const ge=ub(de,he,z,te,h);ge&&P.push({x:ge.x,y:h})}P.length>=2&&db(n,P,h,l.overboughtFillColor,l.fillOpacity,"above"),P.length=0,N=!1}if($.rsi<l.oversoldLevel){if(!L&&(L=!0,de!==null&&he!==null&&le!==null&&le!==void 0&&le>=l.oversoldLevel)){const ge=ub(de,he,z,te,m);ge&&(T.push({x:ge.x,y:m}),ge.x)}T.push({x:z,y:te})}else if(L){if(de!==null&&he!==null&&le!==null&&le!==void 0){const ge=ub(de,he,z,te,m);ge&&T.push({x:ge.x,y:m})}T.length>=2&&db(n,T,m,l.oversoldFillColor,l.fillOpacity,"below"),T.length=0,L=!1}}N&&P.length>=2&&db(n,P,h,l.overboughtFillColor,l.fillOpacity,"above"),L&&T.length>=2&&db(n,T,m,l.oversoldFillColor,l.fillOpacity,"below")}l.showLevels&&l.levels.forEach(P=>{if(!P.visible)return;const T=r.convertToPixel(P.value);if(T===null)return;n.save(),n.strokeStyle=P.color;let N=1,L="dashed";P.id==="overbought"?(N=l.overboughtThickness??1,L=l.overboughtLineStyle??"dashed"):P.id==="oversold"?(N=l.oversoldThickness??1,L=l.oversoldLineStyle??"dashed"):P.id==="middle"&&(N=l.middleLineThickness??1,L=l.middleLineStyle??"dashed"),N=Math.max(1,Math.round(N)),n.lineWidth=N;const O=N%2===1?Math.floor(T)+.5:Math.round(T);L==="dashed"?n.setLineDash([6*N,4*N]):L==="dotted"?n.setLineDash([N,N*2]):n.setLineDash([]),n.beginPath(),n.moveTo(Math.floor(c),O),n.lineTo(Math.floor(c+f),O),n.stroke(),n.restore()}),n.lineCap="round",n.lineJoin="round";for(let P=u.from;P<u.to;P++){const T=(C=d[P])==null?void 0:C.timestamp,N=(M=d[P+1])==null?void 0:M.timestamp,L=t.result[T],O=t.result[N];if(!L||!O||L.rsi===null||L.rsi===void 0||O.rsi===null||O.rsi===void 0)continue;const D=o.convertToPixel(P),$=o.convertToPixel(P+1),z=r.convertToPixel(L.rsi),te=r.convertToPixel(O.rsi);if(D===null||$===null||z===null||te===null)continue;let pe=l.lineColor;L.rsi>l.overboughtLevel?pe=l.overboughtColor:L.rsi<l.oversoldLevel&&(pe=l.oversoldColor),n.strokeStyle=pe,n.lineWidth=l.lineThickness,l.lineStyle==="dashed"?n.setLineDash([6,4]):l.lineStyle==="dotted"?n.setLineDash([2,2]):n.setLineDash([]),n.beginPath(),n.moveTo(D,z),n.lineTo($,te),n.stroke()}return n.restore(),!0}};function db(n,e,t,s,o,r){if(e.length<2)return;n.save();let a=_E(s);a||(a=r==="above"?{r:239,g:68,b:68}:{r:34,g:197,b:94});const l=Math.min(...e.map(u=>u.y)),c=Math.max(...e.map(u=>u.y));let f;r==="above"?(f=n.createLinearGradient(0,t,0,l),f.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),f.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${o*.5})`),f.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${o})`)):(f=n.createLinearGradient(0,t,0,c),f.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),f.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${o*.5})`),f.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${o})`)),n.fillStyle=f,n.beginPath(),n.moveTo(e[0].x,e[0].y);for(let u=1;u<e.length;u++)n.lineTo(e[u].x,e[u].y);n.lineTo(e[e.length-1].x,t),n.lineTo(e[0].x,t),n.closePath(),n.fill(),n.restore()}const m0={createInstance:(n,e)=>{const t=zb(n);return e&&(e.levels&&(t.levels=e.levels),Object.keys(e).forEach(s=>{s!=="levels"&&e[s]!==void 0&&(t[s]=e[s])})),Qh.set(n,t),t},getInstance:n=>Qh.get(n),getInstanceConfig:n=>Qh.get(n)||null,updateInstance:(n,e)=>{const t=Qh.get(n);if(!t){const s=zb(n);return Object.assign(s,e),Qh.set(n,s),!0}return e.levels&&(t.levels=e.levels),Object.keys(e).forEach(s=>{s!=="levels"&&e[s]!==void 0&&(t[s]=e[s])}),Qh.set(n,t),!0},deleteInstance:n=>Qh.delete(n),getAllInstances:()=>new Map(Qh),clearAllInstances:()=>{Qh.clear()},resetInstance:n=>{const e=zb(n);Qh.set(n,e)},exportInstanceConfig:n=>Qh.get(n)||null,importInstanceConfig:n=>{try{if(!n||!n.id)return!1;const e={id:n.id,period:n.period??14,lineColor:n.lineColor??"#8B5CF6",lineThickness:n.lineThickness??2,lineStyle:n.lineStyle??"solid",overboughtLevel:n.overboughtLevel??70,oversoldLevel:n.oversoldLevel??30,middleLevel:n.middleLevel??50,overboughtColor:n.overboughtColor??"#EF4444",overboughtThickness:n.overboughtThickness??1,overboughtLineStyle:n.overboughtLineStyle??"dashed",oversoldColor:n.oversoldColor??"#22C55E",oversoldThickness:n.oversoldThickness??1,oversoldLineStyle:n.oversoldLineStyle??"dashed",overboughtFillColor:n.overboughtFillColor??n.overboughtColor??"#EF4444",oversoldFillColor:n.oversoldFillColor??n.oversoldColor??"#22C55E",middleLineColor:n.middleLineColor??"#6B7280",middleLineThickness:n.middleLineThickness??1,middleLineStyle:n.middleLineStyle??"dashed",fillOpacity:n.fillOpacity??.15,showLevels:n.showLevels??!0,showFill:n.showFill??!0,levels:n.levels??[{id:"overbought",value:n.overboughtLevel??70,color:n.overboughtColor??"#EF4444",lineStyle:n.overboughtLineStyle??"dashed",thickness:n.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:n.middleLevel??50,color:n.middleLineColor??"#6B7280",lineStyle:n.middleLineStyle??"dashed",thickness:n.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:n.oversoldLevel??30,color:n.oversoldColor??"#22C55E",lineStyle:n.oversoldLineStyle??"dashed",thickness:n.oversoldThickness??1,label:"30",visible:!0}]};return Qh.set(n.id,e),!0}catch(e){return console.error("Failed to import RSI instance config:",e),!1}},updateLevel:(n,e,t)=>{const s=Qh.get(n);if(!s)return!1;const o=s.levels.find(r=>r.id===e);return o?(Object.assign(o,t),e==="overbought"&&t.value!==void 0?s.overboughtLevel=t.value:e==="oversold"&&t.value!==void 0?s.oversoldLevel=t.value:e==="middle"&&t.value!==void 0&&(s.middleLevel=t.value),!0):!1},addLevel:(n,e)=>{const t=Qh.get(n);if(!t)throw new Error(`RSI instance ${n} not found`);const s=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...e,id:s,value:Math.max(0,Math.min(100,e.value))};return t.levels.push(o),s},removeLevel:(n,e)=>{const t=Qh.get(n);if(!t)return!1;const s=t.levels.findIndex(o=>o.id===e);return s===-1?!1:(t.levels.splice(s,1),!0)}},mk=Object.freeze(Object.defineProperty({__proto__:null,RSIManager:m0,rsi:Y4},Symbol.toStringTag,{value:"Module"})),yE={name:"SAR",shortName:"SAR",precision:4,calcParams:[.02,.02,.2],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sar",title:"SAR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||.02,s=e.calcParams[1]||.02,o=e.calcParams[2]||.2,r={};if(n.length<2)return n.map(()=>({}));let a=!0,l=t,c=n[0].high,f=n[0].low;r[n[0].timestamp]={sar:f};for(let u=1;u<n.length;u++){const d=n[u],h=n[u-1];a?(f=f+l*(c-f),f=Math.min(f,d.low,h.low),d.low<=f?(a=!1,f=c,c=d.low,l=t):d.high>c&&(c=d.high,l=Math.min(l+s,o))):(f=f-l*(f-c),f=Math.max(f,d.high,h.high),d.high>=f?(a=!0,f=c,c=d.high,l=t):d.low<c&&(c=d.low,l=Math.min(l+s,o))),r[n[u].timestamp]={sar:f}}return r},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var h,m,g;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;n.save();const u=((m=(h=t.styles)==null?void 0:h.lines)==null?void 0:m[0])||{color:"#2563eb",size:1},d=u.size||1;for(let w=c;w<=f;w++){const C=(g=a[w])==null?void 0:g.timestamp,M=t.result[C];if(!M||typeof M.sar!="number")continue;const P=o.convertToPixel(w),T=r.convertToPixel(M.sar);P>=s.left&&P<=s.left+s.width&&T>=s.top&&T<=s.top+s.height&&(n.beginPath(),n.arc(P,T,d,0,2*Math.PI),n.fillStyle=u.color,n.fill(),n.strokeStyle=u.color,n.lineWidth=1,n.stroke())}return n.restore(),!0}},Ih=new Map,sw=n=>({id:n,period:14,lineColor:"#2563eb",lineThickness:1,lineStyle:"solid",showLevels:!0,showZones:!0,yAxisSync:!0,enableDynamicColoring:!0,overboughtColor:"#EF4444",oversoldColor:"#10B981",overboughtThreshold:-20,oversoldThreshold:-80,levels:[{id:"overbought",value:-20,color:"#EF4444",lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"middle",value:-50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"Middle",visible:!0},{id:"oversold",value:-80,color:"#10B981",lineStyle:"solid",thickness:1,label:"Oversold",visible:!0}],zones:[{id:"overbought_zone",topLevel:0,bottomLevel:-20,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:-80,bottomLevel:-100,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),bE=(n,e)=>{const t=[];if(n.length<e)return n.map(()=>NaN);for(let s=0;s<n.length;s++){if(s<e-1){t.push(NaN);continue}let o=n[s-e+1].high,r=n[s-e+1].low;for(let c=s-e+2;c<=s;c++)n[c].high>o&&(o=n[c].high),n[c].low<r&&(r=n[c].low);const a=n[s].close,l=(o-a)/(o-r)*-100;t.push(isNaN(l)?0:l)}return t},xE={name:"WR",shortName:"WR",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:-100,maxValue:0,figures:[{key:"wr",title:"WR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,s=bE(n,t);return n.reduce((o,r,a)=>{const l=s[a];return o[r.timestamp]={wr:isNaN(l)?null:l},o},{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var m,g;const a=t.paneId||"default";let l=Ih.get(a);l||(l=sw(a),Ih.set(a,l));const{left:c,top:f,width:u,height:d}=s,h=e.getVisibleRange();if(n.save(),l.showZones&&l.zones.forEach(w=>{if(!w.visible)return;const C=r.convertToPixel(w.topLevel),M=r.convertToPixel(w.bottomLevel);if(C!==null&&M!==null){n.save();const P=Math.abs(C-M),T=Math.min(C,M),N=n.createLinearGradient(c,T,c,T+P),O=w.fillColor.match(/\w\w/g);if(O){const D=parseInt(O[0],16),$=parseInt(O[1],16),z=parseInt(O[2],16);N.addColorStop(0,`rgba(${D}, ${$}, ${z}, ${w.fillOpacity*.8})`),N.addColorStop(.3,`rgba(${D}, ${$}, ${z}, ${w.fillOpacity*.6})`),N.addColorStop(.7,`rgba(${D}, ${$}, ${z}, ${w.fillOpacity*.3})`),N.addColorStop(1,`rgba(${D}, ${$}, ${z}, ${w.fillOpacity*.1})`)}else N.addColorStop(0,w.fillColor+Math.floor(w.fillOpacity*255).toString(16).padStart(2,"0")),N.addColorStop(.5,w.fillColor+Math.floor(w.fillOpacity*128).toString(16).padStart(2,"0")),N.addColorStop(1,w.fillColor+Math.floor(w.fillOpacity*32).toString(16).padStart(2,"0"));n.fillStyle=N,n.fillRect(c,T,u,P),n.strokeStyle=w.fillColor+"40",n.lineWidth=.5,n.strokeRect(c,T,u,P),n.restore()}}),l.showLevels&&l.levels.forEach(w=>{if(!w.visible)return;const C=r.convertToPixel(w.value);C!==null&&(n.save(),n.strokeStyle=w.color,n.lineWidth=w.thickness,w.lineStyle==="dashed"?n.setLineDash([4,4]):w.lineStyle==="dotted"?n.setLineDash([2,2]):n.setLineDash([]),n.beginPath(),n.moveTo(c,C),n.lineTo(c+u,C),n.stroke(),l.yAxisSync&&(n.font="11px Arial",n.textAlign="left",n.fillStyle=w.color,n.fillText(`WR ${w.value}`,c+u+5,C+4)),n.restore())}),l.enableDynamicColoring&&t.result){const{from:w,to:C}=h,M=e.getDataList();for(let P=w;P<C;P++){const T=(m=M[P])==null?void 0:m.timestamp,N=(g=t.result[T])==null?void 0:g.wr;if(N!=null){const L=o.convertToPixel(P),O=r.convertToPixel(N);if(L!==null&&O!==null){n.save();let D=l.lineColor;N>l.overboughtThreshold?D=l.overboughtColor:N<l.oversoldThreshold&&(D=l.oversoldColor),n.fillStyle=D,n.beginPath(),n.arc(L,O,1,0,2*Math.PI),n.fill(),n.restore()}}}}return n.restore(),!1}},lx={createInstance:(n,e)=>{const t=sw(n);return e&&Object.assign(t,e),Ih.set(n,t),t},getInstance:n=>Ih.get(n),updateInstance:(n,e)=>{const t=Ih.get(n);return t?(Object.assign(t,e),Ih.set(n,t),!0):!1},deleteInstance:n=>Ih.delete(n),addLevel:(n,e)=>{const t=Ih.get(n);if(!t)throw new Error(`WR instance ${n} not found`);const s=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...e,id:s,value:Math.max(-100,Math.min(0,e.value))};return t.levels.push(o),s},removeLevel:(n,e)=>{const t=Ih.get(n);if(!t)return!1;const s=t.levels.findIndex(o=>o.id===e);return s===-1?!1:(t.levels.splice(s,1),!0)},updateLevel:(n,e,t)=>{const s=Ih.get(n);if(!s)return!1;const o=s.levels.find(r=>r.id===e);return o?(t.value!==void 0&&(t.value=Math.max(-100,Math.min(0,t.value))),t.thickness!==void 0&&(t.thickness=Math.max(1,Math.min(5,t.thickness))),Object.assign(o,t),!0):!1},addZone:(n,e)=>{const t=Ih.get(n);if(!t)throw new Error(`WR instance ${n} not found`);const s=Math.max(-100,Math.min(0,Math.max(e.topLevel,e.bottomLevel))),o=Math.max(-100,Math.min(0,Math.min(e.topLevel,e.bottomLevel))),r=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={...e,id:r,topLevel:s,bottomLevel:o,fillOpacity:Math.max(0,Math.min(1,e.fillOpacity||.15))};return t.zones.push(a),r},removeZone:(n,e)=>{const t=Ih.get(n);if(!t)return!1;const s=t.zones.findIndex(o=>o.id===e);return s===-1?!1:(t.zones.splice(s,1),!0)},updateZone:(n,e,t)=>{const s=Ih.get(n);if(!s)return!1;const o=s.zones.find(r=>r.id===e);if(!o)return!1;if(t.topLevel!==void 0&&(t.topLevel=Math.max(-100,Math.min(0,t.topLevel))),t.bottomLevel!==void 0&&(t.bottomLevel=Math.max(-100,Math.min(0,t.bottomLevel))),t.fillOpacity!==void 0&&(t.fillOpacity=Math.max(0,Math.min(1,t.fillOpacity))),Object.assign(o,t),o.topLevel<o.bottomLevel){const r=o.topLevel;o.topLevel=o.bottomLevel,o.bottomLevel=r}return!0},getInstanceConfig:n=>Ih.get(n)||null,resetInstance:n=>{const e=sw(n);Ih.set(n,e)},exportInstanceConfig:n=>{const e=Ih.get(n);return e?{id:n,period:e.period,lineColor:e.lineColor,lineThickness:e.lineThickness,lineStyle:e.lineStyle,showLevels:e.showLevels,showZones:e.showZones,yAxisSync:e.yAxisSync,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:n=>{try{const e={id:n.id,period:n.period||14,lineColor:n.lineColor||"#FF6B35",lineThickness:n.lineThickness||2,lineStyle:n.lineStyle||"solid",showLevels:n.showLevels??!0,showZones:n.showZones??!0,yAxisSync:n.yAxisSync??!0,enableDynamicColoring:n.enableDynamicColoring??!0,overboughtColor:n.overboughtColor||"#EF4444",oversoldColor:n.oversoldColor||"#10B981",overboughtThreshold:n.overboughtThreshold||-20,oversoldThreshold:n.oversoldThreshold||-80,levels:n.levels||[],zones:n.zones||[]};return Ih.set(n.id,e),!0}catch(e){return console.error("Failed to import WR instance config:",e),!1}},getAllInstances:()=>new Map(Ih),clearAllInstances:()=>{Ih.clear()}},wE={name:"VR",shortName:"VR",precision:2,calcParams:[26,6,12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:100-1e-9,maxValue:100+1e-9,figures:[{key:"vr",title:"VR: ",type:"line"},{key:"vrShort",title:"VR Short: ",type:"line"},{key:"vrLong",title:"VR Long: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4CAF50",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||26,s=e.calcParams[1]||6,o=e.calcParams[2]||12,r={};if(n.length<Math.max(t,s,o)+1)return n.reduce((l,c)=>(l[c.timestamp]={},l),{});const a=(l,c)=>{if(l<c)return 100;let f=0,u=0,d=0;for(let g=l-c+1;g<=l;g++){if(g===0)continue;const w=n[g],C=n[g-1];w.close>C.close?f+=w.volume||0:w.close<C.close?u+=w.volume||0:d+=w.volume||0}const h=f+d/2,m=u+d/2;return m===0?100:h/m*100};for(let l=0;l<n.length;l++){const c=a(l,t),f=a(l,s),u=a(l,o);r[n[l].timestamp]={vr:c,vrShort:f,vrLong:u}}return r},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{e.getVisibleRange(),n.save(),n.lineWidth=1,n.setLineDash([2,2]),n.strokeStyle="rgba(107, 114, 128, 0.6)",n.beginPath();const a=r.convertToPixel(100);n.moveTo(s.left,a),n.lineTo(s.left+s.width,a),n.stroke(),n.strokeStyle="rgba(239, 68, 68, 0.6)",n.beginPath();const l=r.convertToPixel(150);n.moveTo(s.left,l),n.lineTo(s.left+s.width,l),n.stroke(),n.strokeStyle="rgba(34, 197, 94, 0.6)",n.beginPath();const c=r.convertToPixel(70);return n.moveTo(s.left,c),n.lineTo(s.left+s.width,c),n.stroke(),n.restore(),!1}},kE={name:"ROC",shortName:"ROC",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"roc",title:"ROC: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#FF6B6B",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s]=t;return n.reduce((o,r,a)=>(o[r.timestamp]={roc:SE(n,a,s)},o),{})}};function SE(n,e,t){if(e<t)return null;const s=n[e].close,o=n[e-t].close;return o===0?null:(s-o)/o*100}const CE={name:"PSY",shortName:"PSY",precision:2,calcParams:[12,6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"mapsy",title:"MAPSY: ",type:"line"}],minValue:0,maxValue:100,styles:{lines:[{color:"#2563eb",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s,o]=t;return n.reduce((r,a,l)=>(r[a.timestamp]={psy:K4(n,l,s),mapsy:IE(n,l,s,o)},r),{})}};function K4(n,e,t){if(e<t)return null;let s=0;for(let o=e-t+1;o<=e;o++)o>0&&n[o].close>n[o-1].close&&s++;return s/t*100}function IE(n,e,t,s){if(e<t+s-1)return null;let o=0,r=0;for(let a=e-s+1;a<=e;a++){const l=K4(n,a,t);l!==null&&(o+=l,r++)}return r>0?o/r:null}const PE={name:"OBV",shortName:"OBV",precision:0,calcParams:[30,10],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maobv",title:"MAOBV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[1]||10,s={};if(n.length===0)return s;let o=0;const r=[];for(let a=0;a<n.length;a++){const l=n[a];if(a===0)o=0;else{const f=n[a-1],u=l.volume||0;l.close>f.close?o+=u:l.close<f.close&&(o-=u)}r.push(o);let c;if(a>=t-1){let f=0;for(let u=a-t+1;u<=a;u++)f+=r[u];c=f/t}s[l.timestamp]={obv:o,maobv:c}}return s}},ME={name:"ZIGZAG",shortName:"ZIGZAG",precision:2,calcParams:[5,5],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:1,extendData:void 0,figures:[],styles:{lines:[{color:"#2962FF",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}],circles:[{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888"}]},calc:(n,e)=>{const t=(e.calcParams[0]||5)/100,s=e.calcParams[1]||5,o=[];if(n.length<s*2)return n.map(()=>({}));let r=0,a=n[0].high,l="high",c=!1;for(let f=0;f<n.length;f++)o.push({});o[0]={zigzag:n[0].close};for(let f=s;f<n.length;f++){const u=n[f].high,d=n[f].low,h=Math.abs(u-a)/a,m=Math.abs(d-a)/a;if(h>=t){r=f,a=u,l="high",c=!1,o[f]={zigzag:u,isHigh:!0};break}else if(m>=t){r=f,a=d,l="low",c=!0,o[f]={zigzag:d,isLow:!0};break}}for(let f=r+s;f<n.length;f++){const u=n[f].high,d=n[f].low;c?(u-a)/a>=t?(r=f,a=u,l="high",c=!1,o[f]={zigzag:u,isHigh:!0}):l==="low"&&d<a&&(o[r]={},r=f,a=d,o[f]={zigzag:d,isLow:!0}):(a-d)/a>=t?(r=f,a=d,l="low",c=!0,o[f]={zigzag:d,isLow:!0}):l==="high"&&u>a&&(o[r]={},r=f,a=u,o[f]={zigzag:u,isHigh:!0})}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var m,g,w,C;if(!t.result||t.result.length===0)return!1;const a=e.getVisibleRange(),{from:l,to:c}=a,f=t.result;n.save();const u=((g=(m=t.styles)==null?void 0:m.lines)==null?void 0:g[0])||{color:"#2962FF",size:2,style:vt.Solid,dashedValue:[2,2]},d=((C=(w=t.styles)==null?void 0:w.circles)==null?void 0:C[0])||{upColor:"#26A69A",downColor:"#EF5350"},h=[];for(let M=Math.max(0,l-50);M<Math.min(c+1,f.length);M++){const P=f[M];P&&typeof P.zigzag=="number"&&h.push({index:M,price:P.zigzag,isHigh:P.isHigh||!1,isLow:P.isLow||!1})}if(n.strokeStyle=u.color||"#2962FF",n.lineWidth=u.size||2,u.style===vt.Dashed){const M=Array.isArray(u.dashedValue)?u.dashedValue:[4,4];n.setLineDash(M)}else n.setLineDash([]);for(let M=0;M<h.length-1;M++){const P=h[M],T=h[M+1],N=o.convertToPixel(P.index),L=r.convertToPixel(P.price),O=o.convertToPixel(T.index),D=r.convertToPixel(T.price);n.beginPath(),n.moveTo(N,L),n.lineTo(O,D),n.stroke()}return h.forEach(M=>{if(M.index<l||M.index>=c)return;const P=o.convertToPixel(M.index),T=r.convertToPixel(M.price);P>=s.left&&P<=s.left+s.width&&T>=s.top&&T<=s.top+s.height&&(n.beginPath(),n.arc(P,T,4,0,2*Math.PI),M.isHigh?n.fillStyle=d.downColor:M.isLow?n.fillStyle=d.upColor:n.fillStyle=u.color,n.fill(),n.strokeStyle="#FFFFFF",n.lineWidth=1.5,n.stroke())}),n.restore(),!0}},NE={name:"Custom Momentum",shortName:"CM",calcParams:[12,26],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{lines:[{color:"#26a69a",size:2,style:"solid"}],bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid"}]},figures:[{key:"momentum",title:"Momentum: ",type:"line",baseValue:0},{key:"histogram",title:"Histogram: ",type:"bar",baseValue:0,styles:{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575"}}],calc:(n,e)=>{const t=e.calcParams[0]||12,s=e.calcParams[1]||26,o=[];for(let r=0;r<n.length;r++){const l=n[r].close;if(r>=s-1){let c=0;if(r===s-1){let h=0;for(let m=r-t+1;m<=r;m++)h+=n[m].close;c=h/t}else{const h=2/(t+1);c=l*h+(o[r-1].momentum||0)*(1-h)}let f=0;if(r===s-1){let h=0;for(let m=r-s+1;m<=r;m++)h+=n[m].close;f=h/s}else{const h=2/(s+1);f=l*h+(o[r-1].momentum||0)*(1-h)}const u=c-f,d=u;o.push({momentum:u,histogram:d})}else o.push({})}return o}},AE={name:"AO",shortName:"AO",calcParams:[5,34],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",reverseColor:"#c4c4c4",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid",fillColor:"#26a69a",strokeColor:"#26a69a"}]},figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:n,indicator:e,defaultStyles:t})=>{var h,m,g,w,C,M;const{prev:s,current:o}=n,r=typeof(s==null?void 0:s.ao)=="number"?s.ao:null,a=typeof(o==null?void 0:o.ao)=="number"?o.ao:null,l=Jv.formatValue(e.styles,"bars[0].upColor",((m=(h=t==null?void 0:t.bars)==null?void 0:h[0])==null?void 0:m.upColor)??"#26a69a"),c=Jv.formatValue(e.styles,"bars[0].downColor",((w=(g=t==null?void 0:t.bars)==null?void 0:g[0])==null?void 0:w.downColor)??"#ef5350"),f=Jv.formatValue(e.styles,"bars[0].noChangeColor",((M=(C=t==null?void 0:t.bars)==null?void 0:C[0])==null?void 0:M.noChangeColor)??"#757575"),u=Jv.formatValue(e.styles,"bars[0].reverseColor",f);let d=u;return a!==null&&(a>=0?r===null||a>=r?d=l:d=u:r===null||a<=r?d=c:d=u),{color:d,style:"fill",borderColor:d}}}],calc:(n,e)=>{const t=e.calcParams[0]||5,s=e.calcParams[1]||34,o={};for(let r=0;r<n.length;r++){const a=n[r].timestamp;if(r>=s-1){const l=[],c=[];for(let h=r-t+1;h<=r;h++){const m=(n[h].high+n[h].low)/2;l.push(m)}for(let h=r-s+1;h<=r;h++){const m=(n[h].high+n[h].low)/2;c.push(m)}const f=l.reduce((h,m)=>h+m,0)/t,u=c.reduce((h,m)=>h+m,0)/s,d=f-u;o[a]={ao:d}}else o[a]={}}return o}},TE={name:"BOLL",shortName:"BOLL",precision:2,calcParams:[20,2],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"upper",title:"Upper: ",type:"line"},{key:"middle",title:"Middle: ",type:"line"},{key:"lower",title:"Lower: ",type:"line"}],styles:{lines:[{color:"#f23645",size:1,style:vt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#2962ff",size:1,style:vt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#089981",size:1,style:vt.Solid,smooth:!1,dashedValue:[0,0]}],fill:{color:"#2196F3",opacity:.05}},calc:(n,e)=>{const t=e.calcParams[0]||20,s=e.calcParams[1]||2,o={};for(let r=0;r<n.length;r++){const a=n[r].timestamp;if(r<t-1){o[a]={};continue}let l=0;for(let m=r-t+1;m<=r;m++)l+=n[m].close;const c=l/t;let f=0;for(let m=r-t+1;m<=r;m++)f+=Math.pow(n[m].close-c,2);const u=Math.sqrt(f/t),d=c+s*u,h=c-s*u;o[a]={upper:d,middle:c,lower:h}}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var w,C,M,P,T,N,L,O,D,$,z,te,pe,J,le,de,he,ge,ae,Ie,ce,je,Ve,We,He,Ue,et,ft,it,Lt,Tt,Pt,St,st,xt,Je;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(l.from,0),f=Math.min(l.to,a.length-1);n.save();const u={color:((M=(C=(w=t.styles)==null?void 0:w.lines)==null?void 0:C[0])==null?void 0:M.color)||"#2196F3",size:((N=(T=(P=t.styles)==null?void 0:P.lines)==null?void 0:T[0])==null?void 0:N.size)||1,style:((D=(O=(L=t.styles)==null?void 0:L.lines)==null?void 0:O[0])==null?void 0:D.style)||vt.Solid},d={color:((te=(z=($=t.styles)==null?void 0:$.lines)==null?void 0:z[1])==null?void 0:te.color)||"#FF9800",size:((le=(J=(pe=t.styles)==null?void 0:pe.lines)==null?void 0:J[1])==null?void 0:le.size)||1,style:((ge=(he=(de=t.styles)==null?void 0:de.lines)==null?void 0:he[1])==null?void 0:ge.style)||vt.Solid},h={color:((ce=(Ie=(ae=t.styles)==null?void 0:ae.lines)==null?void 0:Ie[2])==null?void 0:ce.color)||"#2196F3",size:((We=(Ve=(je=t.styles)==null?void 0:je.lines)==null?void 0:Ve[2])==null?void 0:We.size)||1,style:((et=(Ue=(He=t.styles)==null?void 0:He.lines)==null?void 0:Ue[2])==null?void 0:et.style)||vt.Solid},m={color:((it=(ft=t.styles)==null?void 0:ft.fill)==null?void 0:it.color)||"rgba(33, 150, 243, 0.1)",opacity:((Tt=(Lt=t.styles)==null?void 0:Lt.fill)==null?void 0:Tt.opacity)||.1};n.beginPath();let g=!0;for(let Xe=c;Xe<=f;Xe++){const Be=(Pt=a[Xe])==null?void 0:Pt.timestamp,Qe=t.result[Be];if(!Qe||typeof Qe.upper!="number")continue;const ct=o.convertToPixel(Xe),Mt=r.convertToPixel(Qe.upper);g?(n.moveTo(ct,Mt),g=!1):n.lineTo(ct,Mt)}for(let Xe=f;Xe>=c;Xe--){const Be=(St=a[Xe])==null?void 0:St.timestamp,Qe=t.result[Be];if(!Qe||typeof Qe.lower!="number")continue;const ct=o.convertToPixel(Xe),Mt=r.convertToPixel(Qe.lower);n.lineTo(ct,Mt)}n.closePath(),n.globalAlpha=m.opacity,n.fillStyle=m.color,n.fill(),n.globalAlpha=1,n.beginPath(),g=!0;for(let Xe=c;Xe<=f;Xe++){const Be=(st=a[Xe])==null?void 0:st.timestamp,Qe=t.result[Be];if(!Qe||typeof Qe.upper!="number")continue;const ct=o.convertToPixel(Xe),Mt=r.convertToPixel(Qe.upper);g?(n.moveTo(ct,Mt),g=!1):n.lineTo(ct,Mt)}n.strokeStyle=u.color,n.lineWidth=u.size,n.setLineDash(u.style===vt.Dashed?[4,4]:[]),n.stroke(),n.beginPath(),g=!0;for(let Xe=c;Xe<=f;Xe++){const Be=(xt=a[Xe])==null?void 0:xt.timestamp,Qe=t.result[Be];if(!Qe||typeof Qe.lower!="number")continue;const ct=o.convertToPixel(Xe),Mt=r.convertToPixel(Qe.lower);g?(n.moveTo(ct,Mt),g=!1):n.lineTo(ct,Mt)}n.strokeStyle=h.color,n.lineWidth=h.size,n.setLineDash(h.style===vt.Dashed?[4,4]:[]),n.stroke(),n.beginPath(),g=!0;for(let Xe=c;Xe<=f;Xe++){const Be=(Je=a[Xe])==null?void 0:Je.timestamp,Qe=t.result[Be];if(!Qe||typeof Qe.middle!="number")continue;const ct=o.convertToPixel(Xe),Mt=r.convertToPixel(Qe.middle);g?(n.moveTo(ct,Mt),g=!1):n.lineTo(ct,Mt)}return n.strokeStyle=d.color,n.lineWidth=d.size,n.setLineDash(d.style===vt.Dashed?[4,4]:[]),n.stroke(),n.restore(),!0}};function FE(n,e){const t=e.calcParams||[26,10,20,40,60],[s,o,r,a,l]=t,c={};if(n.length<s+1)return n.reduce((u,d,h)=>(u[d.timestamp]={},u),{});const f=[];for(let u=1;u<n.length;u++){n[u];const d=n[u-1];(d.high+d.low+d.close)/3;let h=0,m=0;const g=Math.max(0,u-s+1);for(let N=g;N<=u;N++){const L=n[N],O=N>0?n[N-1]:L,D=(O.high+O.low+O.close)/3,$=L.high-D,z=D-L.low;$>0&&(h+=$),z>0&&(m+=z)}const w=m!==0?h/m*100:100;f.push(w);const C=fb(f,o),M=fb(f,r),P=fb(f,a),T=fb(f,l);c[n[u].timestamp]={cr:w,ma1:C!==null?C:void 0,ma2:M!==null?M:void 0,ma3:P!==null?P:void 0,ma4:T!==null?T:void 0}}return c}function fb(n,e){return n.length<e?null:n.slice(-e).reduce((s,o)=>s+o,0)/e}const LE={name:"CR",shortName:"CR",precision:2,calcParams:[26,10,20,40,60],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:FE,regenerateFigures:n=>{const[,e,t,s,o]=n;return[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:`MA${e}: `,type:"line"},{key:"ma2",title:`MA${t}: `,type:"line"},{key:"ma3",title:`MA${s}: `,type:"line"},{key:"ma4",title:`MA${o}: `,type:"line"}]},styles:{lines:[{color:"#FF6B35",size:2,style:vt.Solid},{color:"#2196F3",size:1,style:vt.Solid},{color:"#4CAF50",size:1,style:vt.Solid},{color:"#FF9800",size:1,style:vt.Solid},{color:"#9C27B0",size:1,style:vt.Solid}]}},EE={name:"EMV",shortName:"EMV",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{e.calcParams[0];const t=e.calcParams[1]||9,s={};if(n.length<2)return n.reduce((r,a)=>(r[a.timestamp]={},r),{});const o=[];for(let r=0;r<n.length;r++){const a=n[r];if(r===0){s[a.timestamp]={};continue}const l=n[r-1],c=(a.high+a.low)/2,f=(l.high+l.low)/2,u=c-f,d=a.high-a.low,h=a.volume||0;let m=0;if(d>0&&h>0){const w=h/d;m=u/w}o.push(m);let g;if(o.length>=t){let w=0;for(let C=o.length-t;C<o.length;C++)w+=o[C];g=w/t}s[a.timestamp]={emv:m,maEmv:g}}return s},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{e.getVisibleRange(),n.save(),n.lineWidth=1,n.setLineDash([2,2]),n.strokeStyle="rgba(107, 114, 128, 0.6)",n.beginPath();const a=r.convertToPixel(0);return n.moveTo(s.left,a),n.lineTo(s.left+s.width,a),n.stroke(),n.restore(),!1}},$E={name:"MTM",shortName:"MTM",precision:4,calcParams:[12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"mtm",title:"MTM: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||12;return n.reduce((s,o,r)=>{if(r>=t){const a=o.close,l=n[r-t].close;s[o.timestamp]={mtm:a-l}}else s[o.timestamp]={};return s},{})}},DE={name:"TRIX",shortName:"TRIX",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"signal",title:"Signal: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const{calcParams:t}=e,[s,o]=t,r=RE(n,s),a=Vb(r,o);return n.reduce((l,c,f)=>(l[c.timestamp]={trix:r[f],signal:a[f]},l),{})}};function RE(n,e){const t=n.map(l=>l.close),s=Vb(t,e),o=Vb(s,e),r=Vb(o,e),a=[];for(let l=0;l<r.length;l++)if(l===0||r[l]===null||r[l-1]===null||r[l-1]===0)a.push(null);else{const c=(r[l]-r[l-1])/r[l-1]*1e4;a.push(c)}return a}function Vb(n,e){const t=[],s=2/(e+1);let o=null;for(let r=0;r<n.length;r++){if(n[r]===null){t.push(null);continue}if(o===null){if(r>=e-1){let a=0,l=0;for(let c=r-e+1;c<=r;c++)n[c]!==null&&(a+=n[c],l++);o=l>0?a/l:null}}else o=n[r]*s+o*(1-s);t.push(o)}return t}const jE={name:"VOL",shortName:"VOL",precision:10,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:-1,extendData:void 0,figures:[],styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{var r,a;const s=e.calcParams[0]||20,o={};for(let l=0;l<n.length;l++){const c=n[l],f=c.volume||0;let u=0;if(l===0)u=f;else{const d=2/(s+1),h=(r=n[l-1])==null?void 0:r.timestamp,m=(h!=null?(a=o[h])==null?void 0:a.ema:void 0)??f;u=f*d+m*(1-d)}o[c.timestamp]={volume:f,ema:u}}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o})=>{var N,L,O,D,$,z,te,pe,J,le,de,he,ge,ae,Ie,ce,je,Ve,We,He,Ue,et,ft,it,Lt,Tt,Pt,St,st,xt;if(!t.result||Object.keys(t.result).length===0)return!1;const r=e.getVisibleRange();if(!r)return!1;const{from:a,to:l}=r,c=e.getDataList();if(!c||c.length===0)return!1;const f=((O=(L=(N=t.styles)==null?void 0:N.bars)==null?void 0:L[0])==null?void 0:O.upColor)||"#26a69a",u=((z=($=(D=t.styles)==null?void 0:D.bars)==null?void 0:$[0])==null?void 0:z.downColor)||"#ef5350",d=((J=(pe=(te=t.styles)==null?void 0:te.bars)==null?void 0:pe[0])==null?void 0:J.noChangeColor)||"#26a69a",h=((he=(de=(le=t.styles)==null?void 0:le.lines)==null?void 0:de[0])==null?void 0:he.color)||"#8B5CF6";n.save();let m=0;for(let Je=a;Je<=l&&Je<c.length;Je++){const Xe=(ge=c[Je])==null?void 0:ge.timestamp,Be=Xe!=null?t.result[Xe]:void 0;Be&&(Be.volume!=null&&Be.volume>m&&(m=Be.volume),Be.ema!=null&&Be.ema>m&&(m=Math.max(m,Be.ema)))}if(m<=0)return n.restore(),!0;const w=Math.max(10,Math.floor(s.height*.22)),C=s.top+s.height-1,P=Math.max(1,Math.floor(w*.56));for(let Je=a;Je<=l&&Je<c.length;Je++){const Xe=(ae=c[Je])==null?void 0:ae.timestamp,Be=Xe!=null?t.result[Xe]:void 0;if(!Be||Be.volume==null)continue;const Qe=c[Je],ct=Je>0&&Je-1<c.length?c[Je-1]:null;let Mt=d;ct&&Qe&&typeof Qe.close=="number"&&typeof ct.close=="number"&&(Qe.close>ct.close?Mt=f:Qe.close<ct.close&&(Mt=u));const mt=o.convertToPixel(Je),Ce=Math.min(1,Be.volume/m),Te=Math.max(1,Math.floor(Ce*P)),It=C-Te,$t=Math.max(1,(o.convertToPixel(1)-o.convertToPixel(0))*.8),Yt=(je=(ce=(Ie=t==null?void 0:t.styles)==null?void 0:Ie.bars)==null?void 0:ce[0])==null?void 0:je.opacity;let qn=typeof Yt=="number"?Yt:void 0;if(qn==null){const Vn=(Mt||"").toString().match(/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+(?:\s*,\s*([0-9]*\.?[0-9]+))?\s*\)$/i);if(Vn){const Dn=Vn[1]!=null?parseFloat(Vn[1]):1;qn=isNaN(Dn)?.7:Dn}else qn=.7}n.globalAlpha=Math.max(0,Math.min(1,qn)),n.fillStyle=Mt,n.fillRect(mt-$t/2,It,$t,Te)}if(n.globalAlpha=1,((He=(We=(Ve=t==null?void 0:t.styles)==null?void 0:Ve.lines)==null?void 0:We[0])==null?void 0:He.visible)===!0){const Je=((ft=(et=(Ue=t.styles)==null?void 0:Ue.lines)==null?void 0:et[0])==null?void 0:ft.style)||vt.Solid,Xe=((Tt=(Lt=(it=t.styles)==null?void 0:it.lines)==null?void 0:Lt[0])==null?void 0:Tt.size)||1,Be=((st=(St=(Pt=t.styles)==null?void 0:Pt.lines)==null?void 0:St[0])==null?void 0:st.dashedValue)||[2,2];n.lineWidth=Xe,n.strokeStyle=h,Je===vt.Dashed?n.setLineDash(Be):n.setLineDash([]);const Qe=[];for(let ct=a;ct<=l&&ct<c.length;ct++){const Mt=(xt=c[ct])==null?void 0:xt.timestamp,mt=Mt!=null?t.result[Mt]:void 0;if(!mt||mt.ema==null)continue;const Ce=o.convertToPixel(ct),Te=Math.min(1,mt.ema/m),It=C-Math.floor(Te*P);Qe.push({x:Ce,y:It})}if(Qe.length>1){n.save(),n.beginPath(),n.moveTo(Qe[0].x,C);for(const ct of Qe)n.lineTo(ct.x,ct.y);n.lineTo(Qe[Qe.length-1].x,C),n.closePath(),n.globalAlpha=.25,n.fillStyle=h,n.fill(),n.globalAlpha=1,n.restore(),n.beginPath(),n.moveTo(Qe[0].x,Qe[0].y);for(let ct=1;ct<Qe.length;ct++)n.lineTo(Qe[ct].x,Qe[ct].y);n.stroke()}}return n.restore(),!0}},BE={name:"SMA",shortName:"SMA",precision:2,calcParams:[20],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sma",title:"SMA: ",type:"line"}],styles:{lines:[{color:"#FF6C37",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams[0]||20,s={};for(let o=0;o<n.length;o++){const r=n[o].timestamp;if(o<t-1){s[r]={};continue}let a=0;for(let c=o-t+1;c<=o;c++)a+=n[c].close;const l=a/t;s[r]={sma:l}}return s},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var h,m,g,w,C,M,P,T,N,L;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;n.save();const u={color:((g=(m=(h=t.styles)==null?void 0:h.lines)==null?void 0:m[0])==null?void 0:g.color)??"#FF6C37",size:((M=(C=(w=t.styles)==null?void 0:w.lines)==null?void 0:C[0])==null?void 0:M.size)??2,style:((N=(T=(P=t.styles)==null?void 0:P.lines)==null?void 0:T[0])==null?void 0:N.style)??vt.Solid};n.beginPath();let d=!0;for(let O=c;O<=f;O++){const D=(L=a[O])==null?void 0:L.timestamp,$=t.result[D];if(!$||typeof $.sma!="number")continue;const z=o.convertToPixel(O),te=r.convertToPixel($.sma);d?(n.moveTo(z,te),d=!1):n.lineTo(z,te)}return n.strokeStyle=u.color,n.lineWidth=u.size,u.style===vt.Dashed?n.setLineDash([8,4]):n.setLineDash([]),n.stroke(),n.restore(),!0}},Vh=new Map,G1=n=>({id:n,kPeriod:14,dPeriod:3,dutyColor:"#1E90FF",dutyThickness:2,dutyStyle:"solid",dLineColor:"#FF1493",dLineThickness:2,dLineStyle:"dashed",showLevels:!0,showZones:!0,overboughtLevel:80,oversoldLevel:20,midlineLevel:50,showOverbought:!0,showOversold:!0,showMidline:!1,levels:[{id:"overbought",value:80,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:20,color:"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:50,color:"#6B7280",lineStyle:"dotted",thickness:1,label:"Midline",visible:!1}],zones:[{id:"overbought_zone",topLevel:100,bottomLevel:80,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:20,bottomLevel:0,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),OE=(n,e,t)=>{const s=[],o=[];if(n.length<e)return{k:n.map(()=>NaN),d:n.map(()=>NaN)};for(let r=0;r<n.length;r++){if(r<e-1){s.push(NaN);continue}let a=n[r-e+1].high,l=n[r-e+1].low;for(let u=r-e+2;u<=r;u++)n[u].high>a&&(a=n[u].high),n[u].low<l&&(l=n[u].low);const c=n[r].close,f=a-l;if(f===0)s.push(50);else{const u=100*((c-l)/f);s.push(u)}}for(let r=0;r<s.length;r++){if(r<e-1+t-1){o.push(NaN);continue}let a=0,l=0;for(let c=r-t+1;c<=r;c++)isNaN(s[c])||(a+=s[c],l++);l===0?o.push(NaN):o.push(a/l)}return{k:s,d:o}},zE={name:"STOCH",shortName:"Stoch",precision:2,calcParams:[14,3],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"k",title:"%K: ",type:"line"},{key:"d",title:"%D: ",type:"line"}],styles:{lines:[{color:"#1E90FF",size:2,style:vt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#FF1493",size:2,style:vt.Dashed,smooth:!1,dashedValue:[4,4]}]},calc:(n,e)=>{const t=e.calcParams[0]||14,s=e.calcParams[1]||3,{k:o,d:r}=OE(n,t,s);return n.reduce((a,l,c)=>{const f=o[c],u=r[c];return a[l.timestamp]={k:isNaN(f)?null:f,d:isNaN(u)?null:u},a},{})},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{const a=t.paneId||"default";let l=Vh.get(a);l||(l=G1(a),Vh.set(a,l));const{left:c,top:f,width:u,height:d}=s;return e.getVisibleRange(),n.save(),l.showZones&&l.zones.forEach(h=>{if(!h.visible)return;const m=r.convertToPixel(h.topLevel),g=r.convertToPixel(h.bottomLevel);if(m!==null&&g!==null&&isFinite(m)&&isFinite(g)&&isFinite(c)&&isFinite(u)){n.save();const w=Math.abs(m-g),C=Math.min(m,g);if(!isFinite(w)||!isFinite(C)||w===0){n.restore();return}const M=n.createLinearGradient(c,C,c,C+w),T=h.fillColor.match(/\w\w/g);if(T){const N=parseInt(T[0],16),L=parseInt(T[1],16),O=parseInt(T[2],16);M.addColorStop(0,`rgba(${N}, ${L}, ${O}, ${h.fillOpacity*.8})`),M.addColorStop(.3,`rgba(${N}, ${L}, ${O}, ${h.fillOpacity*.6})`),M.addColorStop(.7,`rgba(${N}, ${L}, ${O}, ${h.fillOpacity*.3})`),M.addColorStop(1,`rgba(${N}, ${L}, ${O}, ${h.fillOpacity*.1})`)}else M.addColorStop(0,h.fillColor+Math.floor(h.fillOpacity*255).toString(16).padStart(2,"0")),M.addColorStop(.5,h.fillColor+Math.floor(h.fillOpacity*128).toString(16).padStart(2,"0")),M.addColorStop(1,h.fillColor+Math.floor(h.fillOpacity*32).toString(16).padStart(2,"0"));n.fillStyle=M,n.fillRect(c,C,u,w),n.strokeStyle=h.fillColor+"40",n.lineWidth=.5,n.strokeRect(c,C,u,w),n.restore()}}),l.showLevels&&l.levels.forEach(h=>{if(!h.visible)return;const m=r.convertToPixel(h.value);m!==null&&isFinite(m)&&m>=f&&m<=f+d&&isFinite(c)&&isFinite(u)&&(n.save(),n.strokeStyle=h.color,n.lineWidth=h.thickness,h.lineStyle==="dashed"?n.setLineDash([4,4]):h.lineStyle==="dotted"?n.setLineDash([2,6]):n.setLineDash([]),n.beginPath(),n.moveTo(c,m),n.lineTo(c+u,m),n.stroke(),n.fillStyle=h.color,n.font="10px Arial",n.textAlign="left",n.fillText(`${h.value}`,c+5,m-3),n.restore())}),n.restore(),!1}},pb={createInstance:(n,e)=>{const t={...G1(n),...e};return Vh.set(n,t),t},getInstance:n=>Vh.get(n),updateInstance:(n,e)=>{const t=Vh.get(n);return t?(Object.assign(t,e),!0):!1},deleteInstance:n=>Vh.delete(n),addLevel:(n,e)=>{const t=Vh.get(n);if(t){const s=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:s,...e};return t.levels.push(o),s}throw new Error(`Stochastic instance ${n} not found`)},removeLevel:(n,e)=>{const t=Vh.get(n);if(t){const s=t.levels.findIndex(o=>o.id===e);if(s!==-1)return t.levels.splice(s,1),!0}return!1},updateLevel:(n,e,t)=>{const s=Vh.get(n);if(s){const o=s.levels.find(r=>r.id===e);if(o)return Object.assign(o,t),e==="overbought"?s.overboughtLevel=o.value:e==="oversold"?s.oversoldLevel=o.value:e==="midline"&&(s.midlineLevel=o.value),!0}return!1},addZone:(n,e)=>{const t=Vh.get(n);if(t){const s=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:s,...e};return t.zones.push(o),s}throw new Error(`Stochastic instance ${n} not found`)},removeZone:(n,e)=>{const t=Vh.get(n);if(t){const s=t.zones.findIndex(o=>o.id===e);if(s!==-1)return t.zones.splice(s,1),!0}return!1},updateZone:(n,e,t)=>{const s=Vh.get(n);if(s){const o=s.zones.find(r=>r.id===e);if(o)return Object.assign(o,t),!0}return!1},getInstanceConfig:n=>Vh.get(n)||null,resetInstance:n=>{const e=G1(n);Vh.set(n,e)},exportInstanceConfig:n=>{const e=Vh.get(n);return e?{id:e.id,kPeriod:e.kPeriod,dPeriod:e.dPeriod,dutyColor:e.dutyColor,dutyThickness:e.dutyThickness,dutyStyle:e.dutyStyle,dLineColor:e.dLineColor,dLineThickness:e.dLineThickness,dLineStyle:e.dLineStyle,showLevels:e.showLevels,showZones:e.showZones,overboughtLevel:e.overboughtLevel,oversoldLevel:e.oversoldLevel,midlineLevel:e.midlineLevel,showOverbought:e.showOverbought,showOversold:e.showOversold,showMidline:e.showMidline,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:n=>{try{const e={id:n.id,kPeriod:n.kPeriod||14,dPeriod:n.dPeriod||3,dutyColor:n.dutyColor||"#1E90FF",dutyThickness:n.dutyThickness||2,dutyStyle:n.dutyStyle||"solid",dLineColor:n.dLineColor||"#FF1493",dLineThickness:n.dLineThickness||2,dLineStyle:n.dLineStyle||"dashed",showLevels:n.showLevels!==!1,showZones:n.showZones!==!1,overboughtLevel:n.overboughtLevel||80,oversoldLevel:n.oversoldLevel||20,midlineLevel:n.midlineLevel||50,showOverbought:n.showOverbought!==!1,showOversold:n.showOversold!==!1,showMidline:n.showMidline||!1,levels:n.levels||G1(n.id).levels,zones:n.zones||G1(n.id).zones};return Vh.set(n.id,e),!0}catch(e){return console.error("Failed to import Stochastic instance config:",e),!1}},getAllInstances:()=>new Map(Vh),clearAllInstances:()=>{Vh.clear()}},VE={name:"SMARTTREND",shortName:"Smart Trend",precision:2,calcParams:[10,3],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,extendData:{showLabels:!0},figures:[{key:"superTrend",title:"Smart Trend: ",type:"line"}],styles:{lines:[{color:"#00FF00",size:2,style:vt.Solid,smooth:!1,dashedValue:[0,0]}]},calc:(n,e)=>{var g;const t=e.calcParams[0]||10,s=e.calcParams[1]||3,o={},r=(w,C)=>{if(!C)return w.high-w.low;const M=w.high-w.low,P=Math.abs(w.high-C.close),T=Math.abs(w.low-C.close);return Math.max(M,P,T)},a=w=>{if(w<t-1)return 0;let C=0;for(let M=w-t+1;M<=w;M++){const P=n[M],T=M>0?n[M-1]:void 0;C+=r(P,T)}return C/t};let l=1,c=0,f=0,u=-1,d,h=-1,m;for(let w=0;w<n.length;w++){const C=n[w].timestamp;if(w<t-1){o[C]={};continue}const M=n[w],P=w>0?n[w-1]:M,T=a(w),N=(M.high+M.low)/2,L=N+s*T,O=N-s*T;if(w===t-1)c=L,f=O;else{o[w-1];const ae=P.close;(L<c||ae>c)&&(c=L),(O>f||ae<f)&&(f=O)}let D=l,$=0,z,te,pe,J,le,de,he,ge;if(w>t-1){const ae=n[w-1].timestamp;if((g=o[ae])!=null&&g.superTrend,l===1&&M.close<=f?D=-1:l===-1&&M.close>=c&&(D=1),D!==l){if(D===1){if(z=f,pe=M.close,u=w,d=M.close,m!==void 0&&h>=0){de=M.close,ge=m-de;const Ie=n[h].timestamp,ce=o[Ie];ce.sellExit=de,ce.sellProfit=ge,m=void 0,h=-1}}else if(te=c,J=M.close,h=w,m=M.close,d!==void 0&&u>=0){le=M.close,he=le-d;const Ie=n[u].timestamp,ce=o[Ie];ce.buyExit=le,ce.buyProfit=he,d=void 0,u=-1}}}D===1?$=f:$=c,o[C]={superTrend:$,trend:D,buySignal:z,sellSignal:te,buyEntry:pe,sellEntry:J,buyExit:le,sellExit:de,buyProfit:he,sellProfit:ge},l=D}return o},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var $,z,te,pe,J,le,de;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;n.save();const u=(he,ge,ae,Ie,ce,je)=>{const Ve=Math.min(je,Ie/2,ce/2);he.beginPath(),he.moveTo(ge+Ve,ae),he.arcTo(ge+Ie,ae,ge+Ie,ae+ce,Ve),he.arcTo(ge+Ie,ae+ce,ge,ae+ce,Ve),he.arcTo(ge,ae+ce,ge,ae,Ve),he.arcTo(ge,ae,ge+Ie,ae,Ve),he.closePath()},d=(he,ge)=>{if(!he)return`rgba(0,0,0,${ge})`;if(he.startsWith("rgb"))return he.startsWith("rgba")?he.replace(/rgba\(([^)]+)\)/,(Ve,We)=>{const He=We.split(",").map(Ue=>Ue.trim());return`rgba(${He[0]}, ${He[1]}, ${He[2]}, ${ge})`}):he.replace(/rgb\(([^)]+)\)/,(Ve,We)=>`rgba(${We}, ${ge})`);const ae=he.replace("#",""),Ie=parseInt(ae.substring(0,2),16),ce=parseInt(ae.substring(2,4),16),je=parseInt(ae.substring(4,6),16);return`rgba(${Ie}, ${ce}, ${je}, ${ge})`},h=(he,ge,ae,Ie)=>{const ce="bold 10px Arial";n.font=ce;const je=n.measureText(ae),Ve=je.actualBoundingBoxAscent&&je.actualBoundingBoxDescent?je.actualBoundingBoxAscent+je.actualBoundingBoxDescent:10,We=6,He=4,Ue=Math.ceil(je.width)+We*2,et=Math.ceil(Ve)+He*2,ft=Math.round(he-Ue/2),it=Math.round(ge-et/2),Lt=typeof performance<"u"?performance.now():Date.now(),Tt=.35+.25*Math.sin(Lt/450);n.save(),n.shadowColor=d(Ie,Math.max(0,Tt)),n.shadowBlur=12,n.fillStyle=d(Ie,.14),u(n,ft,it,Ue,et,6),n.fill(),n.restore(),n.lineWidth=1,n.strokeStyle=d(Ie,.9),u(n,ft,it,Ue,et,6),n.stroke(),n.fillStyle=d(Ie,.95),n.textAlign="center",n.textBaseline="middle",n.font=ce,n.fillText(ae,he,ge+.5)},m=t.extendData,g=(m==null?void 0:m.showLabels)!==!1,w=(m==null?void 0:m.uptrendColor)||"#00FF00",C=(m==null?void 0:m.downtrendColor)||"#FF0000",M=(m==null?void 0:m.uptrendThickness)??2,P=(m==null?void 0:m.downtrendThickness)??2,T=(m==null?void 0:m.uptrendLineStyle)||"solid",N=(m==null?void 0:m.downtrendLineStyle)||"solid";let L=[],O=c,D=((z=t.result[($=a[c])==null?void 0:$.timestamp])==null?void 0:z.trend)||1;for(let he=c+1;he<=f;he++){const ge=(te=a[he])==null?void 0:te.timestamp,ae=t.result[ge],Ie=(ae==null?void 0:ae.trend)??D,ce=he===f;if(Ie!==D||ce){const je=ce&&Ie===D?he:he-1;L.push({start:O,end:je,trend:D}),O=he,D=Ie}}if(L.forEach(he=>{var Ve,We;const ge=he.trend===1,ae=ge?w:C,Ie=ge?M:P,ce=ge?T:N;n.strokeStyle=ae,n.lineWidth=Number(Ie)||2,n.lineCap="round",n.lineJoin="round",ce==="dashed"?n.setLineDash([4,4]):ce==="dotted"?n.setLineDash([2,6]):n.setLineDash([]),n.beginPath();let je=!0;for(let He=he.start;He<=he.end;He++){const Ue=(Ve=a[He])==null?void 0:Ve.timestamp,et=t.result[Ue];if(et&&typeof et.superTrend=="number"){const ft=o.convertToPixel(He),it=r.convertToPixel(et.superTrend);je?(n.moveTo(ft,it),je=!1):n.lineTo(ft,it)}}if(n.stroke(),g){const He=(We=a[he.end])==null?void 0:We.timestamp,Ue=t.result[He];if(Ue&&typeof Ue.superTrend=="number"){const ft=he===L[L.length-1]?"HOLD":"EXIT",it=o.convertToPixel(he.end),Lt=r.convertToPixel(Ue.superTrend);h(it,Lt+(ge?22:-22),ft,ae)}}}),g){let he=0;try{const ae=(pe=e==null?void 0:e.getDataList)==null?void 0:pe.call(e);if(ae&&ae.length>0)he=((J=ae[ae.length-1])==null?void 0:J.close)??0;else{const Ie=(le=a[f])==null?void 0:le.timestamp,ce=t.result[Ie];he=(ce==null?void 0:ce.superTrend)??0}}catch{}const ge=(t==null?void 0:t.precision)??2;for(let ae=c;ae<=f;ae++){const Ie=(de=a[ae])==null?void 0:de.timestamp,ce=t.result[Ie];if(!ce)continue;const je=o.convertToPixel(ae);if(ce.buySignal!==void 0){const Ve=r.convertToPixel(ce.buySignal);n.fillStyle="#00FF00",n.beginPath(),n.arc(je,Ve-10,4,0,2*Math.PI),n.fill();const We=ce.buyEntry??ce.buySignal,He=ce.buyExit!==void 0?ce.buyExit-We:he?he-We:0,Ue=`${He>=0?"+":""}${Number(He).toFixed(ge)}`;h(je,Ve+22,`BUY ${Ue}`,"#10B981")}if(ce.sellSignal!==void 0){const Ve=r.convertToPixel(ce.sellSignal);n.fillStyle="#FF0000",n.beginPath(),n.arc(je,Ve+10,4,0,2*Math.PI),n.fill();const We=ce.sellEntry??ce.sellSignal,He=ce.sellExit!==void 0?We-ce.sellExit:he?We-he:0,Ue=`${He>=0?"+":""}${Number(He).toFixed(ge)}`;h(je,Ve-22,`SELL ${Ue}`,"#EF4444")}}}return n.restore(),!0}},WE={name:"MACD",shortName:"MACD",calcParams:[12,26,9],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:4,minValue:-1e-9,maxValue:1e-9,styles:{lines:[{color:"#2563eb",size:1,style:vt.Solid,dashedValue:[2,2]},{color:"#dc2626",size:1,style:vt.Solid,dashedValue:[2,2]}],bars:[{upColor:"#2563eb",downColor:"#ef4444",noChangeColor:"#2563eb",reverseColor:"#c4c4c4"}]},figures:[{key:"macd",title:"MACD: ",type:"line",baseValue:0},{key:"signal",title:"Signal: ",type:"line",baseValue:0},{key:"hist",title:"Hist: ",type:"bar",baseValue:0}],calc:(n,e)=>{var h,m,g;const t=((h=e.calcParams)==null?void 0:h[0])||12,s=((m=e.calcParams)==null?void 0:m[1])||26,o=((g=e.calcParams)==null?void 0:g[2])||9,r=(w,C)=>{const M=2/(w+1),P=[];let T;for(let N=0;N<C.length;N++){const L=C[N];T===void 0?T=L:T=L*M+T*(1-M),P.push(T)}return P},a=n.map(w=>w.close),l=r(t,a),c=r(s,a),f=a.map((w,C)=>(l[C]??NaN)-(c[C]??NaN)),u=r(o,f.map(w=>Number.isFinite(w)?w:0)),d={};for(let w=0;w<n.length;w++){const C=n[w].timestamp;if(!Number.isFinite(f[w])||!Number.isFinite(u[w])){d[C]={};continue}const M=f[w],P=u[w],T=M-P;d[C]={macd:M,signal:P,hist:T}}return d},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{var w,C,M,P,T,N,L,O,D,$;const r=e.getDataList();if(!t.result||r.length===0)return!1;const a=t.styles||{},l=((C=(w=a==null?void 0:a.bars)==null?void 0:w[0])==null?void 0:C.upColor)||"#2563eb",c=((P=(M=a==null?void 0:a.bars)==null?void 0:M[0])==null?void 0:P.downColor)||"#ef4444",f=((N=(T=a==null?void 0:a.bars)==null?void 0:T[0])==null?void 0:N.reverseColor)||((O=(L=a==null?void 0:a.bars)==null?void 0:L[0])==null?void 0:O.noChangeColor)||"#c4c4c4",u=(a==null?void 0:a.lines)||[],d=e.getVisibleRange(),h=Math.max(d.from,0),m=Math.min(d.to,r.length-1);n.save();for(let z=h;z<=m;z++){const te=(D=r[z])==null?void 0:D.timestamp,pe=t.result[te];if(!pe||typeof pe.hist!="number")continue;const J=s.convertToPixel(z),le=o.convertToPixel(0),de=o.convertToPixel(pe.hist),he=s.convertToPixel(1)-s.convertToPixel(0),ge=Math.max(1,Math.floor(he*.8)),ae=Math.min(le,de),Ie=Math.abs(le-de);let ce=f;const je=($=r[z-1])==null?void 0:$.timestamp,Ve=je!=null?t.result[je]:void 0,We=Ve&&typeof Ve.hist=="number"?Ve.hist:null;pe.hist>=0?We===null||pe.hist>=We?ce=l:ce=f:We===null||pe.hist<=We?ce=c:ce=f,n.fillStyle=ce;const He=Math.round(J-ge/2),Ue=Math.round(ae),et=Math.max(1,Math.round(Ie));n.fillRect(He,Ue,ge,et)}n.restore();const g=(z,te)=>{var de;n.save(),n.beginPath(),n.lineWidth=(te==null?void 0:te.size)??1,(te==null?void 0:te.style)===vt.Dashed?n.setLineDash((te==null?void 0:te.dashedValue)??[4,4]):n.setLineDash([]),n.strokeStyle=(te==null?void 0:te.color)||"#ffffff";const J=n.lineWidth%2?.5:0;n.lineCap="butt",n.lineJoin="miter";let le=!0;for(let he=h;he<=m;he++){const ge=(de=r[he])==null?void 0:de.timestamp,ae=t.result[ge];if(!ae||typeof ae[z]!="number")continue;const Ie=Math.round(s.convertToPixel(he))+J,ce=Math.round(o.convertToPixel(ae[z]))+J;le?(n.moveTo(Ie,ce),le=!1):n.lineTo(Ie,ce)}n.stroke(),n.restore()};return g("macd",u[0]),g("signal",u[1]),!0}};function l0(n,e,t){return Math.max(e,Math.min(t,n))}function HE(n,e){const t=new Array(n.length).fill(0);if(e<=1){for(let o=0;o<n.length;o++)t[o]=n[o]??0;return t}let s=0;for(let o=0;o<n.length;o++)s+=n[o]??0,o>=e&&(s-=n[o-e]??0),t[o]=o>=e-1?s/e:0;return t}function qE(n,e,t){const s=Math.max(0,e-t);let o=-1/0;for(let r=s;r<e;r++)n[r]&&n[r].high>o&&(o=n[r].high);return o===-1/0?0:o}function UE(n,e,t){const s=Math.max(0,e-t);let o=1/0;for(let r=s;r<e;r++)n[r]&&n[r].low<o&&(o=n[r].low);return o===1/0?0:o}function mb(n){const e=Math.max(0,(n.high??0)-(n.low??0)),t=Math.abs((n.close??0)-(n.open??0)),s=Math.max(0,(n.high??0)-Math.max(n.open??0,n.close??0)),o=Math.max(0,Math.min(n.open??0,n.close??0)-(n.low??0)),r=e>0?s/e:0,a=e>0?o/e:0;return{range:e,body:t,upperWick:s,lowerWick:o,upperWickRatio:r,lowerWickRatio:a}}const GE={name:"TRAP_HUNTER",shortName:"TRAP",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(n,e)=>{var L,O;const t=e.calcParams||[],s=t[0]??20,o=t[1]??20,r=Math.max(1,t[2]??3),a=Math.max(1,t[3]??5),l=Math.max(1,t[4]??20),c=t[5]??1.3,f=t[6]??7e-4,u=t[7]??.35,d=t[8]??.5,h=(t[9]??1)>0?1:0,m=Math.max(1,t[10]??5),g=n.map(D=>(D==null?void 0:D.volume)??0),w=HE(g,l),C=new Array(n.length).fill(null).map(()=>({}));let M=-1e3,P=-1e3,T=-1e3,N=-1e3;for(let D=0;D<n.length;D++){const $=n[D];if(!$||D===0)continue;const z=qE(n,D,s),te=UE(n,D,o);if(z===0||te===0)continue;const pe=w[D]||0,J=pe>0?($.volume??0)/pe:0,{range:le,upperWickRatio:de,lowerWickRatio:he}=mb($),ge=le>0?($.high-$.close)/le<.4:!1,ae=le>0?($.close-$.low)/le<.4:!1,Ie=($.high??0)>=z*(1+f),ce=($.close??0)>($.open??0)||ge,je=J>=c;if(Ie&&ce&&je){let ft=-1;($.close??0)<z&&(ft=D);const it=Math.min(n.length-1,D+r);if(ft===-1){for(let Lt=D+1;Lt<=it;Lt++)if((((L=n[Lt])==null?void 0:L.close)??0)<z){ft=Lt;break}}if(ft!==-1){const Lt=Math.min(ft,D+a);let Tt=de,Pt=!1;for(let Qe=D;Qe<=Lt;Qe++){const ct=mb(n[Qe]);ct.upperWickRatio>Tt&&(Tt=ct.upperWickRatio),(n[Qe].close??0)<(n[Qe].open??0)&&(ct.range>0&&ct.body/ct.range>=.45)&&(Pt=!0)}const St=l0(($.high-z)/Math.max(1e-8,z)/(f*3),0,1),st=l0(J/(c*2),0,1),xt=l0(Tt,0,1),Je=l0(($.high-(n[ft].close??0))/Math.max(1e-8,$.high),0,1),Xe=l0(.3*St+.3*st+.2*xt+.2*Je,0,1);(Tt>=u||Pt)&&Xe>=d&&ft-M>=2&&(M=ft,T=ft,C[ft]={...C[ft],bullTrap:!0,type:"bull",score:Xe,breakoutLevel:z,reversalClose:n[ft].close,time:n[ft].timestamp})}}const Ve=f*.85,We=c*.9,He=($.low??0)<=te*(1-Ve),Ue=($.close??0)<($.open??0)||ae||he>=u,et=J>=We;if(He&&Ue&&et){const ft=Math.min(n.length-1,D+r);let it=-1;if(($.close??0)>te&&(it=D),it===-1){for(let Lt=D+1;Lt<=ft;Lt++)if((((O=n[Lt])==null?void 0:O.close)??0)>te){it=Lt;break}}if(it!==-1){const Lt=Math.min(it,D+a);let Tt=he,Pt=!1;for(let Qe=D;Qe<=Lt;Qe++){const ct=mb(n[Qe]);ct.lowerWickRatio>Tt&&(Tt=ct.lowerWickRatio),(n[Qe].close??0)>(n[Qe].open??0)&&(ct.range>0&&ct.body/ct.range>=.45)&&(Pt=!0)}const St=l0((te-$.low)/Math.max(1e-8,te)/(Ve*3),0,1),st=l0(J/(We*2),0,1),xt=l0(Tt,0,1),Je=l0(((n[it].close??0)-$.low)/Math.max(1e-8,n[it].close??0),0,1),Xe=l0(.3*St+.3*st+.2*xt+.2*Je,0,1);(Tt>=u||Pt)&&Xe>=d&&it-P>=2&&(P=it,T=it,C[it]={...C[it],bearTrap:!0,type:"bear",score:Xe,breakoutLevel:te,reversalClose:n[it].close,time:n[it].timestamp})}}if(h){const ft=w[D]>0?($.volume??0)/w[D]:0,{upperWickRatio:it,lowerWickRatio:Lt}=mb($),Tt=Math.max(.1,u*.8),Pt=Math.max(1,c*.85),St=($.close??0)<=z*(1+f*.5)&&($.close??0)>=te*(1-f*.5),st=ft<=Pt&&it<=Tt&&Lt<=Tt&&St,xt=D-T,Je=D-N,Xe=Math.max(8,m);st&&xt>=m&&Je>=Xe&&(N=D,C[D]={...C[D],normal:!0,time:n[D].timestamp})}}return C},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(r.length-1,l.to);function u(m,g,w,C){n.save(),n.fillStyle=w,n.strokeStyle=w,n.lineWidth=1,C==="normal"?(n.beginPath(),n.arc(m,g,3.5,0,2*Math.PI),n.fill()):(n.beginPath(),C==="bull"?(n.moveTo(m,g-6),n.lineTo(m-5,g+4),n.lineTo(m+5,g+4)):(n.moveTo(m,g+6),n.lineTo(m-5,g-4),n.lineTo(m+5,g-4)),n.closePath(),n.fill()),n.restore()}function d(m,g,w,C){n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle=C,n.strokeStyle="rgba(0,0,0,0.2)";const M=6,P=n.measureText(w),T=Math.ceil(P.width)+M*2,N=16,L=4,O=m-T/2,D=g-N/2;n.beginPath(),n.moveTo(O+L,D),n.lineTo(O+T-L,D),n.quadraticCurveTo(O+T,D,O+T,D+L),n.lineTo(O+T,D+N-L),n.quadraticCurveTo(O+T,D+N,O+T-L,D+N),n.lineTo(O+L,D+N),n.quadraticCurveTo(O,D+N,O,D+N-L),n.lineTo(O,D+L),n.quadraticCurveTo(O,D,O+L,D),n.closePath(),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.fillStyle=C,n.fillText(w,m,g+.5),n.restore()}function h(m,g,w){n.save(),n.strokeStyle=w,n.lineWidth=1,n.setLineDash([4,3]),n.beginPath(),n.moveTo(m-10,g),n.lineTo(m+10,g),n.stroke(),n.setLineDash([]),n.restore()}for(let m=c;m<=f;m++){const g=r[m];if(!g||!g.bullTrap&&!g.bearTrap&&!g.normal)continue;const w=s.convertToPixel(m),C=a[m];if(C){if(g.bullTrap){const M=o.convertToPixel(C.high)-12;u(w,M,"#EF4444","bull");const T=M-16,N=`Bull Trap ${((g.score??0)*100).toFixed(0)}%`;if(d(w,T,N,"#F59E0B"),g.breakoutLevel){const L=o.convertToPixel(g.breakoutLevel);h(w,L,"#F59E0B")}}if(g.bearTrap){const M=o.convertToPixel(C.low)+12;u(w,M,"#10B981","bear");const T=M+16,N=`Bear Trap ${((g.score??0)*100).toFixed(0)}%`;if(d(w,T,N,"#34D399"),g.breakoutLevel){const L=o.convertToPixel(g.breakoutLevel);h(w,L,"#34D399")}}if(g.normal){const M=(C.high+C.low)/2,P=o.convertToPixel(M);u(w,P,"#3B82F6","normal"),d(w,P-16,"Stable","#60A5FA")}}}return!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{var c;const s=(c=e.result)==null?void 0:c[n];if(!s||!s.bullTrap&&!s.bearTrap&&!s.normal)return{values:[]};const o=s.normal?"Stable":s.bullTrap?"Bull Trap":"Bear Trap",r=s.score!==void 0?Number(s.score).toFixed(2):"—",a=s.breakoutLevel!==void 0?Number(s.breakoutLevel).toFixed(e.precision??2):"—",l=s.reversalClose!==void 0?Number(s.reversalClose).toFixed(e.precision??2):"—";return{styles:t,values:[{title:"Trap",value:o},...s.normal?[]:[{title:"Score",value:r},{title:"Level",value:a},{title:"Reversal",value:l}]]}}};function P0(n,e,t){return Math.max(e,Math.min(t,n))}function X4(n,e){const t=n.length,s=new Array(t).fill(0);if(e<=1){for(let r=0;r<t;r++)s[r]=n[r]??0;return s}let o=0;for(let r=0;r<t;r++)o+=n[r]??0,r>=e&&(o-=n[r-e]??0),s[r]=r>=e-1?o/e:0;return s}function YE(n,e){var o,r,a;const t=n.length,s=new Array(t).fill(0);for(let l=0;l<t;l++){const c=((o=n[l])==null?void 0:o.high)??0,f=((r=n[l])==null?void 0:r.low)??0;if(l===0)s[l]=Math.max(0,c-f);else{const u=((a=n[l-1])==null?void 0:a.close)??0;s[l]=Math.max(c-f,Math.abs(c-u),Math.abs(f-u))}}return X4(s,Math.max(1,e))}function KE(n){var o,r,a;const e=n.length,t=new Array(e).fill(0);let s=0;for(let l=0;l<e;l++){if(l===0)s=0;else{const c=((o=n[l])==null?void 0:o.close)??0,f=((r=n[l-1])==null?void 0:r.close)??0,u=((a=n[l])==null?void 0:a.volume)??0;c>f?s+=u:c<f&&(s-=u)}t[l]=s}return t}function cx(n,e,t){let s=0,o=0;for(let r=e;r<=t;r++)s+=n[r]??0,o++;return o>0?s/o:0}function XE(n,e,t,s){if(t<=e)return 0;const o=(n[t]-n[e])/(t-e),r=s>0?o/(s*5):0;return P0(r,-1,1)}function ZE(n,e,t){var l,c;const s=Math.max(0,e-t),o=Math.max(0,e-1),r=((l=n[s])==null?void 0:l.close)??0,a=((c=n[o])==null?void 0:c.close)??0;return r<=0?0:(a-r)/r}function hk(n,e,t,s,o,r,a){var We,He,Ue,et,ft,it,Lt,Tt,Pt;const l=[],c=[],f=[];for(let St=o;St<=r;St++)l.push(((We=n[St])==null?void 0:We.high)??0),c.push(((He=n[St])==null?void 0:He.low)??0),f.push(((Ue=n[St])==null?void 0:Ue.close)??0);const u=Math.max(...l),d=Math.min(...c),h=(u+d)/2,m=u-d;if(h<=0)return null;const g=m/h;if(!isFinite(g)||g<=0||g>a.maxZoneWidthPct)return null;const w=cx(s,o,r);if(!(w>=a.minVolumeFactor))return null;const C=[];for(let St=o;St<=r;St++)C.push((((et=n[St])==null?void 0:et.high)??0)-(((ft=n[St])==null?void 0:ft.low)??0));const M=C.length?C.reduce((St,st)=>St+st,0)/C.length:0,P=cx(t,o,r);if(P>0&&M/P>1.8)return null;let T=0;for(let St=o;St<=r;St++){const st=((it=n[St])==null?void 0:it.close)??0;(Lt=n[St])==null||Lt.open;const xt=m>0?P0((st-d)/m,0,1):.5;T+=xt}const N=T/Math.max(1,r-o+1)||.5,L=ZE(n,o,a.priorTrendLookback),O=L<=-.05,D=L>=.05,$=O?P0(Math.abs(L)/.15,0,1):0,z=D?P0(Math.abs(L)/.15,0,1):0,te=cx(n.map(St=>(St==null?void 0:St.volume)??0),o,r),pe=XE(e,o,r,te),J=P0((N-.5)/.3+.5,0,1),le=P0((w-a.minVolumeFactor)/Math.max(1e-6,a.minVolumeFactor),0,1),de=.3,he=.3,ge=.2,ae=.2,Ie=de*$+he*P0((pe-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+ge*J+ae*le,ce=de*z+he*P0((-pe-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+ge*(1-J)+ae*le,je=P0(Math.max(Ie,ce),0,1);if(je<a.minZoneScore)return null;const Ve=Ie>ce?"accumulation":"distribution";return{startIndex:o,endIndex:r,startTime:((Tt=n[o])==null?void 0:Tt.timestamp)??0,endTime:((Pt=n[r])==null?void 0:Pt.timestamp)??0,low:d,high:u,type:Ve,score:je,priorReturn:L,avgVolumeFactor:w,obvTrendScore:pe}}function vk(n,e){if(!e.mergeNearbyZones||n.length<=1)return n.slice(0,e.maxZonesDisplayed);const t=n.slice().sort((l,c)=>l.startIndex-c.startIndex),s=[],o=Math.max(2,Math.floor(e.minZoneBars/2)),r=Math.max(.01,e.maxZoneWidthPct*1.5);function a(l,c){const f=(l.low+l.high)/2,u=(c.low+c.high)/2;return f<=0||u<=0?!1:Math.abs(f-u)/((f+u)/2)<=r}for(const l of t){if(s.length===0){s.push(l);continue}const c=s[s.length-1];if(l.startIndex<=c.endIndex+o&&l.type===c.type&&a(c,l)){const u=Math.min(c.low,l.low),d=Math.max(c.high,l.high);s[s.length-1]={startIndex:Math.min(c.startIndex,l.startIndex),endIndex:Math.max(c.endIndex,l.endIndex),startTime:Math.min(c.startTime,l.startTime),endTime:Math.max(c.endTime,l.endTime),low:u,high:d,type:c.type,score:Math.max(c.score,l.score),priorReturn:Math.abs(l.score)>=Math.abs(c.score)?l.priorReturn:c.priorReturn,avgVolumeFactor:(c.avgVolumeFactor+l.avgVolumeFactor)/2,obvTrendScore:(c.obvTrendScore+l.obvTrendScore)/2}}else s.push(l)}return s.sort((l,c)=>c.score-l.score).slice(0,e.maxZonesDisplayed).sort((l,c)=>l.startIndex-c.startIndex)}const JE={name:"SMART_MONEY",shortName:"SMF",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{},calc:(n,e)=>{const t=e.calcParams||[],s={zoneLookbackBars:Math.max(10,t[0]??40),minZoneBars:Math.max(3,t[1]??5),maxZoneBars:Math.max(5,t[2]??25),atrPeriod:Math.max(1,t[3]??14),volumeMAPeriod:Math.max(1,t[4]??20),minVolumeFactor:t[5]??1.2,maxZoneWidthPct:t[6]??.03,priorTrendLookback:Math.max(1,t[7]??20),minOBVTrendStrength:t[8]??.2,minZoneScore:t[9]??.6,mergeNearbyZones:(t[10]??1)>0,maxZonesDisplayed:Math.max(1,t[11]??20),showLabels:(t[12]??1)>0},o=n.length,r=new Array(o).fill({});if(o===0)return e.zones=[],e.cfg=s,r;const a=YE(n,s.atrPeriod),l=n.map(m=>(m==null?void 0:m.volume)??0),c=X4(l,s.volumeMAPeriod),f=l.map((m,g)=>{const w=c[g]||0;return w>0?m/w:0}),u=KE(n);let d=[];for(let m=0;m<o;m++){const g=m,w=Math.min(s.zoneLookbackBars,g+1),C=[],M=s.minZoneBars,P=Math.min(s.maxZoneBars,w);if(P>=M){const T=Math.floor((M+P)/2);C.push(M),T!==M&&T!==P&&C.push(T),P!==M&&C.push(P)}for(const T of C){const N=g-T+1;if(N<0)continue;const L=hk(n,u,a,f,N,g,s);L&&d.push(L)}}let h=vk(d,s);if(h.length===0&&o>=Math.max(60,s.minZoneBars*4)){const m={...s,maxZoneWidthPct:s.maxZoneWidthPct*2,minVolumeFactor:Math.min(s.minVolumeFactor,.9),minOBVTrendStrength:Math.max(.05,s.minOBVTrendStrength*.5),minZoneScore:Math.max(.4,s.minZoneScore-.15)};d=[];for(let g=0;g<o;g++){const w=g,C=Math.min(m.zoneLookbackBars,w+1),M=[],P=m.minZoneBars,T=Math.min(m.maxZoneBars,C);if(T>=P){const N=Math.floor((P+T)/2);M.push(P),N!==P&&N!==T&&M.push(N),T!==P&&M.push(T)}for(const N of M){const L=w-N+1;if(L<0)continue;const O=hk(n,u,a,f,L,w,m);O&&d.push(O)}}h=vk(d,m)}return e.zones=h,e.cfg=s,r},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{const r=t.zones||[];if(!r.length)return!1;const a=t.cfg||{},l=e.getVisibleRange(),c=Math.max(0,l.from),f=l.to,u="rgba(16, 185, 129, 0.28)",d="rgba(16, 185, 129, 0.7)",h="rgba(239, 68, 68, 0.28)",m="rgba(239, 68, 68, 0.7)";n.save();for(const g of r){if(g.endIndex<c||g.startIndex>f)continue;const w=s.convertToPixel(g.startIndex),C=s.convertToPixel(g.endIndex),M=o.convertToPixel(g.high),P=o.convertToPixel(g.low);if(!isFinite(w)||!isFinite(C)||M==null||P==null)continue;const T=Math.min(w,C),N=Math.max(1,Math.abs(C-w)),L=Math.min(M,P),O=Math.abs(M-P);n.fillStyle=g.type==="accumulation"?u:h;const D=n.roundRect??n.rect;n.beginPath();try{D.call(n,T,L,N,O,4)}catch{n.rect(T,L,N,O)}if(n.closePath(),n.fill(),n.strokeStyle=g.type==="accumulation"?d:m,n.lineWidth=1.5,n.setLineDash([]),n.stroke(),a.showLabels){const $=`${g.type==="accumulation"?"Accumulation":"Distribution"} (${g.score.toFixed(2)})`,z=T+N+6,te=L+O/2;n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="left",n.textBaseline="middle";const pe=g.type==="accumulation"?"#10B981":"#EF4444",J="rgba(0,0,0,0.55)",le=6,de=n.measureText($),he=Math.ceil(de.width)+le*2,ge=16,ae=4,Ie=z,ce=te-ge/2;n.beginPath(),n.moveTo(Ie+ae,ce),n.lineTo(Ie+he-ae,ce),n.quadraticCurveTo(Ie+he,ce,Ie+he,ce+ae),n.lineTo(Ie+he,ce+ge-ae),n.quadraticCurveTo(Ie+he,ce+ge,Ie+he-ae,ce+ge),n.lineTo(Ie+ae,ce+ge),n.quadraticCurveTo(Ie,ce+ge,Ie,ce+ge-ae),n.lineTo(Ie,ce+ae),n.quadraticCurveTo(Ie,ce,Ie+ae,ce),n.closePath(),n.fillStyle=J,n.fill(),n.fillStyle=pe,n.fillText($,Ie+le,te+.5),n.restore()}}return n.restore(),!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{const o=(e.zones||[]).find(l=>n>=l.startIndex&&n<=l.endIndex);if(!o)return{values:[]};const r=o.type==="accumulation"?"Accumulation":"Distribution",a=o.endIndex-o.startIndex+1;return{styles:t,values:[{title:"Footprint",value:r},{title:"Score",value:o.score.toFixed(2)},{title:"Price",value:`${o.low.toFixed(e.precision??2)}–${o.high.toFixed(e.precision??2)}`},{title:"Duration",value:`${a} bars`},{title:"Prior Trend",value:`${(o.priorReturn*100).toFixed(1)}%`},{title:"Avg Volume x",value:o.avgVolumeFactor.toFixed(2)},{title:"OBV Trend",value:o.obvTrendScore>.05?"Up":o.obvTrendScore<-.05?"Down":"Flat"}]}}},Fd={bbPeriod:16,bbStdDev:2,atrPeriod:14,volMAPeriod:20,lookbackForNorm:60,pressureSMA:2,minPressureForAlert:.55,eruptionConfirmBars:1,minVolExpansion:1,minRangeExpansion:1,minBreakoutBodyPct:.5,breakoutLookback:10,w1:.5,w2:.3,w3:.2,minBarsBetweenEruptions:1,trendEMAPeriod:30,requireTrendAlign:0,breakoutBufferPct:7e-4,requireBBBandBreak:0,retestWindow:1};function Wb(n,e,t){return Math.max(e,Math.min(t,n))}function ux(n,e){const t=new Array(n.length).fill(0);if(e<=1){for(let o=0;o<n.length;o++)t[o]=n[o]??0;return t}let s=0;for(let o=0;o<n.length;o++)s+=n[o]??0,o>=e&&(s-=n[o-e]??0),t[o]=o>=e-1?s/e:NaN;return t}function QE(n,e){const t=new Array(n.length).fill(NaN);if(e<=1)return n.map(()=>0);for(let s=0;s<n.length;s++){if(s<e-1)continue;let o=0;for(let l=s-e+1;l<=s;l++)o+=n[l]??0;const r=o/e;let a=0;for(let l=s-e+1;l<=s;l++){const c=(n[l]??0)-r;a+=c*c}t[s]=Math.sqrt(a/e)}return t}function e$(n,e){const t=new Array(n.length).fill(NaN);if(e<=1)return n.slice();const s=2/(e+1);let o=NaN;for(let r=0;r<n.length;r++){const a=n[r]??0;if(Number.isFinite(o))o=a*s+o*(1-s),t[r]=o;else if(r>=e-1){let l=0;for(let c=r-e+1;c<=r;c++)l+=n[c]??0;o=l/e,t[r]=o}}return t}function Z4(n,e){if(!n)return 0;const t=n.high??0,s=n.low??0,o=(e==null?void 0:e.close)??n.close??0;return Math.max(t-s,Math.abs(t-o),Math.abs(s-o))}function t$(n,e){const t=n.map((r,a)=>Z4(r,a>0?n[a-1]:void 0)),s=new Array(n.length).fill(NaN);if(e<=1)return t;let o=0;for(let r=0;r<t.length;r++)o+=t[r]??0,r===e-1?s[r]=o/e:r>=e&&(s[r]=((s[r-1]??0)*(e-1)+(t[r]??0))/e);return s}function gk(n,e){const t=new Array(n.length).fill(NaN);for(let s=0;s<n.length;s++){const o=Math.max(0,s-e+1);let r=1/0;for(let a=o;a<=s;a++)Number.isFinite(n[a])&&n[a]<r&&(r=n[a]);t[s]=r===1/0?NaN:r}return t}function _k(n,e){const t=new Array(n.length).fill(NaN);for(let s=0;s<n.length;s++){const o=Math.max(0,s-e+1);let r=-1/0;for(let a=o;a<=s;a++)Number.isFinite(n[a])&&n[a]>r&&(r=n[a]);t[s]=r===-1/0?NaN:r}return t}function yk(n,e,t){return!Number.isFinite(e)||!Number.isFinite(t)||t===e?.5:Wb((n-e)/(t-e),0,1)}function n$(n,e,t){const s=Math.max(0,e-t);let o=-1/0;for(let r=s;r<e;r++)n[r]&&(n[r].high??-1/0)>o&&(o=n[r].high);return o===-1/0?NaN:o}function s$(n,e,t){const s=Math.max(0,e-t);let o=1/0;for(let r=s;r<e;r++)n[r]&&(n[r].low??1/0)<o&&(o=n[r].low);return o===1/0?NaN:o}function J4(n,e){const t={...Fd,...e},s=n.length,o=n.map(ce=>(ce==null?void 0:ce.close)??0),r=n.map(ce=>(ce==null?void 0:ce.volume)??0);if(s===0)return{pressure:[],pressureSmoothed:[],eruptions:[]};const a=ux(o,t.bbPeriod),l=QE(o,t.bbPeriod),c=new Array(s).fill(NaN),f=new Array(s).fill(NaN),u=new Array(s).fill(NaN);for(let ce=0;ce<s;ce++)if(Number.isFinite(a[ce])&&Number.isFinite(l[ce])){c[ce]=a[ce]+t.bbStdDev*l[ce],f[ce]=a[ce]-t.bbStdDev*l[ce];const je=c[ce]-f[ce],Ve=o[ce]||1;u[ce]=Ve!==0?je/Math.abs(Ve):0}const d=Math.max(2,t.trendEMAPeriod??50),h=e$(o,d),m=t$(n,t.atrPeriod),g=m.map((ce,je)=>{const Ve=o[je]||1;return Ve!==0?(ce??0)/Math.abs(Ve):0}),w=ux(r,t.volMAPeriod),C=r.map((ce,je)=>{const Ve=w[je]??0;return Ve>0?ce/Ve:0}),M=Math.max(10,t.lookbackForNorm),P=gk(u,M),T=_k(u,M),N=gk(g,M),L=_k(g,M),O=new Array(s).fill(0),D=new Array(s).fill(0),$=new Array(s).fill(0);for(let ce=0;ce<s;ce++){const je=yk(u[ce]??0,P[ce],T[ce]),Ve=yk(g[ce]??0,N[ce],L[ce]);O[ce]=1-je,D[ce]=1-Ve;const We=Math.max(C[ce]??0,1e-8),He=Wb(1/We,0,2);$[ce]=Wb(He/2,0,1)}const z=t.w1??.5,te=t.w2??.3,pe=t.w3??.2,J=new Array(s).fill(0);for(let ce=0;ce<s;ce++){const je=z*O[ce]+te*D[ce]+pe*$[ce];J[ce]=Wb(je,0,1)}const le=ux(J,Math.max(1,t.pressureSMA)).map(ce=>Number.isFinite(ce)?ce:0),de=[],he=Math.max(1,t.minBarsBetweenEruptions??8);let ge=-1e4,ae=!1,Ie=-1;for(let ce=0;ce<s;ce++){const je=le[ce]??0;if(je>=t.minPressureForAlert?ae||(ae=!0,Ie=ce):ae=!1,!(ae||Ie>=0&&ce-Ie<=t.eruptionConfirmBars+2)||ce-ge<he)continue;const We=Z4(n[ce],ce>0?n[ce-1]:void 0),He=m[ce]??We,Ue=He>0?We/He:0;if(Ue<t.minRangeExpansion)continue;const et=C[ce]??0;if(et<t.minVolExpansion)continue;const ft=n[ce],it=Math.max(0,(ft.high??0)-(ft.low??0)),Lt=Math.abs((ft.close??0)-(ft.open??0));if((it>0?Lt/it:0)<t.minBreakoutBodyPct)continue;const Pt=n$(n,ce,t.breakoutLookback),St=s$(n,ce,t.breakoutLookback),st=Math.max(0,t.breakoutBufferPct??.001),xt=(t.requireBBBandBreak??1)>0,Je=(t.requireTrendAlign??1)>0,Xe=h[ce],Be=ce>0?h[ce-1]:Xe,Qe=Number.isFinite(Xe)&&Number.isFinite(Be)&&(ft.close??0)>Xe&&Xe>=Be,ct=Number.isFinite(Xe)&&Number.isFinite(Be)&&(ft.close??0)<Xe&&Xe<=Be,Mt=c[ce],mt=f[ce];let Ce=Number.isFinite(Pt)&&(ft.close??0)>Pt*(1+st),Te=Number.isFinite(St)&&(ft.close??0)<St*(1-st);if(xt&&(Ce=Ce&&Number.isFinite(Mt)&&(ft.close??0)>Mt,Te=Te&&Number.isFinite(mt)&&(ft.close??0)<mt),Je&&(Ce=Ce&&Qe,Te=Te&&ct),!Ce&&!Te)continue;const It=ce,$t=Math.min(s-1,It+Math.max(1,t.eruptionConfirmBars));let Yt=0,qn=!0;const Vn=Math.max(1,t.retestWindow??2);if(Ce)for(let Wn=It;Wn<=$t;Wn++){const pn=n[Wn];(pn.close??0)>=(ft.high??0)&&Yt++,Wn<=It+Vn&&Number.isFinite(Pt)&&(pn.close??0)<Pt&&(qn=!1)}else if(Te)for(let Wn=It;Wn<=$t;Wn++){const pn=n[Wn];(pn.close??0)<=(ft.low??0)&&Yt++,Wn<=It+Vn&&Number.isFinite(St)&&(pn.close??0)>St&&(qn=!1)}const Dn=Math.ceil(($t-It+1)/2);if(qn&&Yt>=Dn){const Wn=Ce?"bullish":"bearish",pn=Ce?Pt:St;de.push({index:It,time:ft.timestamp??0,direction:Wn,pressureAtSignal:je,rangeExpansion:Ue,volumeFactor:et,breakoutLevel:pn}),ge=It}}return{pressure:J,pressureSmoothed:le,eruptions:de}}const o$={name:"VOLCANIC",shortName:"VOLC",precision:2,shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,minValue:0,maxValue:1,figures:[{key:"pressure",title:"Pressure: ",type:"line"}],styles:{lines:[{color:"#60A5FA",size:2,style:vt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(n,e)=>{const t=e.calcParams,s={bbPeriod:(t==null?void 0:t[0])??Fd.bbPeriod,bbStdDev:(t==null?void 0:t[1])??Fd.bbStdDev,atrPeriod:(t==null?void 0:t[2])??Fd.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??Fd.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??Fd.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??Fd.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??Fd.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??Fd.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??Fd.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??Fd.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??Fd.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??Fd.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??Fd.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??Fd.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??Fd.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??Fd.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??Fd.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??Fd.retestWindow??1},{pressureSmoothed:o}=J4(n,s);return o.map(r=>({pressure:Number.isFinite(r)?r:null}))},draw:({ctx:n,chart:e,indicator:t,bounding:s,xAxis:o,yAxis:r})=>{var T,N,L,O,D,$,z;const a=t.result;if(!a||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(a.length-1,l.to),u=t.calcParams,d=(u==null?void 0:u[6])??Fd.minPressureForAlert,h=((L=(N=(T=t.styles)==null?void 0:T.lines)==null?void 0:N[0])==null?void 0:L.color)||"#60A5FA",m="#F59E0B",g=(($=(D=(O=t.styles)==null?void 0:O.lines)==null?void 0:D[0])==null?void 0:$.size)||2;n.save(),n.lineCap="round",n.lineJoin="round";const w=r.convertToPixel(d);w!==null&&(n.strokeStyle="#9CA3AF",n.lineWidth=1,n.setLineDash([4,4]),n.beginPath(),n.moveTo(s.left,w),n.lineTo(s.left+s.width,w),n.stroke(),n.setLineDash([]));let C=null,M=null,P=null;for(let te=c;te<=f;te++){const pe=((z=a[te])==null?void 0:z.pressure)??null;if(pe==null){C=M=P=null;continue}const J=o.convertToPixel(te),le=r.convertToPixel(pe);if(J===null||le===null){C=M=P=null;continue}if(C!==null&&M!==null&&P!==null){const de=(P+pe)/2;n.strokeStyle=de>=d?m:h,n.lineWidth=g,n.beginPath(),n.moveTo(C,M),n.lineTo(J,le),n.stroke()}C=J,M=le,P=pe}return n.restore(),!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{const s=e.result[n];if(!s)return{values:[]};const o=e.calcParams,r=(o==null?void 0:o[6])??Fd.minPressureForAlert,a=s.pressure!==null&&s.pressure!==void 0?Number(s.pressure).toFixed(2):"—";return{styles:t,values:[{title:"Pressure",value:a},{title:"Alert ≥",value:Number(r).toFixed(2)}]}}},i$={name:"VOLCANIC_SIG",shortName:"VOLCSIG",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(n,e)=>{const t=e.calcParams,s={bbPeriod:(t==null?void 0:t[0])??Fd.bbPeriod,bbStdDev:(t==null?void 0:t[1])??Fd.bbStdDev,atrPeriod:(t==null?void 0:t[2])??Fd.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??Fd.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??Fd.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??Fd.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??Fd.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??Fd.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??Fd.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??Fd.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??Fd.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??Fd.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??Fd.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??Fd.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??Fd.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??Fd.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??Fd.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??Fd.retestWindow??1},{eruptions:o}=J4(n,s),r=new Array(n.length).fill(null).map(()=>({}));return o.forEach(a=>{const l=r[a.index]||{};a.direction==="bullish"&&(l.bull=!0),a.direction==="bearish"&&(l.bear=!0),l.pressure=a.pressureAtSignal,l.rangeExpansion=a.rangeExpansion,l.volumeFactor=a.volumeFactor,l.breakoutLevel=a.breakoutLevel,r[a.index]=l}),r},draw:({ctx:n,chart:e,indicator:t,xAxis:s,yAxis:o})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(r.length-1,l.to);function u(h,m,g,w){n.save(),n.fillStyle=g,n.beginPath(),w?(n.moveTo(h,m+6),n.lineTo(h-5,m-4),n.lineTo(h+5,m-4)):(n.moveTo(h,m-6),n.lineTo(h-5,m+4),n.lineTo(h+5,m+4)),n.closePath(),n.fill(),n.restore()}function d(h,m,g,w){n.save(),n.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",n.textAlign="center",n.textBaseline="middle";const C=6,M=16,P=n.measureText(g),T=Math.ceil(P.width)+C*2,N=4,L=h-T/2,O=m-M/2;n.fillStyle="rgba(0,0,0,0.6)",n.beginPath(),n.moveTo(L+N,O),n.lineTo(L+T-N,O),n.quadraticCurveTo(L+T,O,L+T,O+N),n.lineTo(L+T,O+M-N),n.quadraticCurveTo(L+T,O+M,L+T-N,O+M),n.lineTo(L+N,O+M),n.quadraticCurveTo(L,O+M,L,O+M-N),n.lineTo(L,O+N),n.quadraticCurveTo(L,O,L+N,O),n.closePath(),n.fill(),n.fillStyle=w,n.fillText(g,h,m+.5),n.restore()}for(let h=c;h<=f;h++){const m=r[h];if(!m||!m.bull&&!m.bear)continue;const g=s.convertToPixel(h),w=a[h];if(w){if(m.bull){const C=o.convertToPixel(w.low)+12;u(g,C,"#F59E0B",!0),d(g,C+16,"Volcanic Move (Bullish)","#F59E0B")}if(m.bear){const C=o.convertToPixel(w.high)-12;u(g,C,"#EF4444",!1),d(g,C-16,"Volcanic Move (Bearish)","#EF4444")}}}return!0},createTooltipDataSource:({dataIndex:n,indicator:e,defaultStyles:t})=>{var c;const s=(c=e.result)==null?void 0:c[n];if(!s||!s.bull&&!s.bear)return{values:[]};const o=s.bull?"Bullish":"Bearish",r=s.pressure!==void 0?Number(s.pressure).toFixed(2):"—",a=s.rangeExpansion!==void 0?Number(s.rangeExpansion).toFixed(2):"—",l=s.volumeFactor!==void 0?Number(s.volumeFactor).toFixed(2):"—";return{styles:t,values:[{title:"Eruption",value:o},{title:"Pressure",value:r},{title:"Range x",value:a},{title:"Volume x",value:l}]}}};function r$(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(e-l,t-c),n.lineTo(e+l,t+c),n.moveTo(e+l,t-c),n.lineTo(e-l,t+c),n.stroke(),n.restore()}function a$(n,e,t,s,o,r,a){const l=s*.4,c=o*.4;n.save(),n.strokeStyle=r,n.lineWidth=a,n.lineCap="round",n.beginPath(),n.ellipse(e,t,l,c,0,0,Math.PI*2),n.stroke(),n.restore()}const l$={name:"PNF",shortName:"P&F",calcParams:[],figures:[],calc:(n,e)=>n.map(t=>{const s=t==null?void 0:t._pnf;return s?{direction:s.direction,boxes:s.boxes,upColor:s.upColor,downColor:s.downColor,boxSize:s.boxSize}:{}}),draw:n=>{var M,P;const{ctx:e,visibleRange:t,indicator:s,xAxis:o,yAxis:r}=n,a=s.result||[];if(!(o!=null&&o.convertToPixel)||!(r!=null&&r.convertToPixel))return!1;const l=o.convertToPixel(0),c=o.convertToPixel(1),f=Math.max(1,Math.abs(c-l));let u=f;for(const T of a)if(T!=null&&T.boxes&&T.boxes.length>=2&&(r!=null&&r.convertToPixel)){const N=T.boxes[0],L=T.boxes[1],O=r.convertToPixel(N.price),D=r.convertToPixel(L.price);if(O!==void 0&&D!==void 0&&!isNaN(O)&&!isNaN(D)){const $=Math.abs(O-D);if($>0){u=$;break}}}if(u===f){const T=a.find(N=>(N==null?void 0:N.boxSize)&&N.boxSize>0);if(T!=null&&T.boxSize){const N=((P=(M=T.boxes)==null?void 0:M[0])==null?void 0:P.price)||100,L=r.convertToPixel(N),O=r.convertToPixel(N+T.boxSize);if(L!==void 0&&O!==void 0&&!isNaN(L)&&!isNaN(O)){const D=Math.abs(L-O);D>0&&(u=D)}}}const d=f*.85,h=u*.85,m=(d+h)/2,g=Math.max(.8,m*.08),w=(t==null?void 0:t.from)||0,C=(t==null?void 0:t.to)||a.length;for(let T=w;T<C;T++){const N=a[T];if(!N||!N.boxes||!Array.isArray(N.boxes))continue;const{direction:L,boxes:O,upColor:D="#00E6D8",downColor:$="#FF4D4D"}=N,z=o.convertToPixel(T);if(!(z===void 0||isNaN(z)))for(const te of O){const pe=r.convertToPixel(te.price);pe===void 0||isNaN(pe)||(L==="up"?r$(e,z,pe,d,h,D,g):a$(e,z,pe,d,h,$,g))}}return!1}},c$=[fE,pE,hE,vE,Y4,yE,xE,wE,kE,CE,PE,ME,NE,AE,TE,LE,EE,$E,DE,jE,BE,zE,VE,WE,GE,JE,o$,i$,l$];function u$(n,e){e?console.log(n,e):console.log(n)}function D1(){return Date.now()}function hb(n,e){const t=n.country||"__";return`${n.ticker}_${t}_${e}`}function vb(n){return{key:n.key,symbol:n.symbol.ticker,timeframe:n.timeframe,candles:n.candles,oldestTimestampLoaded:n.oldest,newestTimestampLoaded:n.newest,isComplete:n.isComplete,isRunning:n.isRunning,pipelineStarts:n.starts,apiCalls:n.apiCalls,lastUpdatedAt:n.lastUpdatedAt,error:n.error}}function d$(n,e){var o;let t=0,s=n.length;for(;t<s;){const r=t+s>>>1;(((o=n[r])==null?void 0:o.timestamp)??0)>=e?s=r:t=r+1}return t}function bk(n,e){return n<=0?Promise.resolve():new Promise((t,s)=>{const o=setTimeout(t,n);if(!e)return;const r=()=>{clearTimeout(o),s(new DOMException("Aborted","AbortError"))};if(e.aborted)return r();e.addEventListener("abort",r,{once:!0})})}class f${constructor(e,t={}){$e(this,"entries",new Map);$e(this,"fetchPage");$e(this,"opt");this.fetchPage=e,this.opt={maxKeys:t.maxKeys??16,ttlMs:t.ttlMs??20*6e4,initialLimit:t.initialLimit??600,pageLimit:t.pageLimit??800,pageDelayMs:t.pageDelayMs??75,maxRetries:t.maxRetries??2,retryBaseDelayMs:t.retryBaseDelayMs??400,log:t.log??u$}}start(e,t){const s=hb(e,t),o=this.getOrCreate(e,t);return this.touch(o),this.ensureRunning(o),{key:s,getSnapshot:()=>this.getSnapshot(e,t),subscribe:r=>this.subscribe(e,t,r)}}getSnapshot(e,t){const s=hb(e,t),o=this.entries.get(s);return o?(this.touch(o),vb(o)):{key:s,symbol:e.ticker,timeframe:t,candles:[],oldestTimestampLoaded:null,newestTimestampLoaded:null,isComplete:!1,isRunning:!1,pipelineStarts:0,apiCalls:0,lastUpdatedAt:0,error:null}}async waitForInitial(e,t){const s=this.getOrCreate(e,t);return this.touch(s),this.ensureRunning(s),await this.ensureInitialLoaded(s,s.generation),vb(s)}requestVisibleRange(e){const t=this.entries.get(hb(e.symbol,e.timeframe));if(!t||t.candles.length===0)return[];this.touch(t);const s=d$(t.candles,e.beforeTimestamp),o=Math.max(0,s-Math.max(1,e.limit));return t.candles.slice(o,s)}stopSymbol(e){for(const t of this.entries.values())t.symbol.ticker===e&&this.stopEntry(t)}stopAll(){for(const e of this.entries.values())this.stopEntry(e)}clear(){this.stopAll(),this.entries.clear()}subscribe(e,t,s){const o=this.getOrCreate(e,t);this.touch(o),o.subs.add(s);try{s(vb(o))}catch{}return()=>{o.subs.delete(s)}}getMetrics(){const e=[];for(const t of this.entries.values())e.push({key:t.key,pipelineStarts:t.starts,apiCalls:t.apiCalls,isRunning:t.isRunning,isComplete:t.isComplete,error:t.error});return e}emit(e){const t=vb(e);for(const s of e.subs)try{s(t)}catch{}}touch(e){e.lastAccessAt=D1(),this.entries.get(e.key)===e&&(this.entries.delete(e.key),this.entries.set(e.key,e)),this.evictIfNeeded()}evictIfNeeded(){const e=D1()-this.opt.ttlMs;for(;;){const t=this.entries.keys().next().value;if(!t)break;const s=this.entries.get(t);if(!s){this.entries.delete(t);continue}if(s.lastAccessAt>=e)break;this.stopEntry(s),this.entries.delete(t)}for(;this.entries.size>this.opt.maxKeys;){const t=this.entries.keys().next().value;if(!t)break;const s=this.entries.get(t);if(!s){this.entries.delete(t);continue}this.stopEntry(s),this.entries.delete(t)}}getOrCreate(e,t){const s=hb(e,t),o=this.entries.get(s);if(o)return o;const r={key:s,symbol:e,timeframe:t,candles:[],ts:new Set,oldest:null,newest:null,isComplete:!1,isRunning:!1,starts:0,apiCalls:0,lastUpdatedAt:0,lastAccessAt:D1(),error:null,nextSkip:0,generation:0,initialPromise:null,runPromise:null,abort:null,subs:new Set};return this.entries.set(s,r),r}ensureRunning(e){if(e.isComplete||e.runPromise)return;e.isRunning=!0,e.error=null,e.generation+=1,e.starts+=1,e.abort||(e.abort=new AbortController);const t=e.generation;this.opt.log("📡 [pipeline:start]",{key:e.key,gen:t});const s=this.runLoop(e,t).finally(()=>{e.runPromise===s&&(e.runPromise=null),e.isRunning=!1,e.abort=null,this.emit(e),this.opt.log("⏹️ [pipeline:stop]",{key:e.key,gen:t,complete:e.isComplete})});e.runPromise=s}stopEntry(e){var t;e.generation+=1,e.isRunning=!1,e.initialPromise=null;try{(t=e.abort)==null||t.abort()}catch{}e.abort=null}async ensureInitialLoaded(e,t){e.candles.length>0||e.isComplete||(e.initialPromise||(e.initialPromise=(async()=>{const s=e.abort??new AbortController;e.abort=s;const o=e.nextSkip,r=this.opt.initialLimit;try{const a=await this.fetchPageWithRetry(e,{skip:o,limit:r,gen:t,signal:s.signal});if(e.generation!==t)return;const l=this.mergePage(e,a);e.nextSkip=o+a.length,(!a||a.length===0||l===0)&&(e.isComplete=!0),this.emit(e)}finally{e.initialPromise=null}})()),await e.initialPromise.catch(()=>{}))}async runLoop(e,t){for(await this.ensureInitialLoaded(e,t);e.isRunning&&!e.isComplete&&e.generation===t;){const s=e.abort??new AbortController;e.abort=s;const o=e.nextSkip,r=this.opt.pageLimit;let a=[];try{a=await this.fetchPageWithRetry(e,{skip:o,limit:r,gen:t,signal:s.signal})}catch(c){if(e.generation!==t||c instanceof DOMException&&c.name==="AbortError")return;e.error=c instanceof Error?c.message:"Fetch failed",this.emit(e);return}if(e.generation!==t)return;if(!a||a.length===0){e.isComplete=!0,this.emit(e);return}const l=this.mergePage(e,a);if(e.nextSkip=o+a.length,this.emit(e),l===0){e.isComplete=!0,this.emit(e);return}await bk(this.opt.pageDelayMs,s.signal).catch(()=>{})}}async fetchPageWithRetry(e,t){let s=0;for(;;)try{e.apiCalls+=1,this.opt.log("🌐 [pipeline:page]",{key:e.key,skip:t.skip,limit:t.limit,calls:e.apiCalls});const o=await this.fetchPage({symbol:e.symbol,timeframe:e.timeframe,skip:t.skip,limit:t.limit,signal:t.signal});return e.lastUpdatedAt=D1(),e.error=null,Array.isArray(o)?o:[]}catch(o){if(o instanceof DOMException&&o.name==="AbortError"||e.generation!==t.gen||s>=this.opt.maxRetries)throw o;const r=this.opt.retryBaseDelayMs*Math.pow(2,s);s+=1,await bk(r,t.signal)}}mergePage(e,t){if(!Array.isArray(t)||t.length===0)return 0;const s=[];for(const o of t){const r=o==null?void 0:o.timestamp;typeof r=="number"&&(e.ts.has(r)||(e.ts.add(r),s.push(o),(e.oldest==null||r<e.oldest)&&(e.oldest=r),(e.newest==null||r>e.newest)&&(e.newest=r)))}if(s.length>0){if(s.sort((o,r)=>o.timestamp-r.timestamp),e.candles.length===0)e.candles=s;else{const o=new Array(e.candles.length+s.length);let r=0,a=0,l=0;for(;r<e.candles.length&&a<s.length;)e.candles[r].timestamp<=s[a].timestamp?o[l++]=e.candles[r++]:o[l++]=s[a++];for(;r<e.candles.length;)o[l++]=e.candles[r++];for(;a<s.length;)o[l++]=s[a++];o.length=l,e.candles=o}e.lastUpdatedAt=D1()}return s.length}}const Q4=n=>{if(n==null)return 0;if(typeof n=="number")return Number.isFinite(n)?n<1e11?n*1e3:n:0;const e=String(n).trim();if(!e)return 0;const t=Number(e);if(Number.isFinite(t))return t<1e11?t*1e3:t;const s=Date.parse(e);return Number.isFinite(s)?s:0},xk=n=>{if(!Number.isFinite(n))return 1;const e=Number(n);return e>0?e:1};function p$(n){if(!Array.isArray(n)||n.length===0)return[];const e=[];for(const t of n){const s=(t==null?void 0:t.type)??"adjustment",o=Q4(t==null?void 0:t.date);if(!o)continue;let r=1,a=1,l=0;if(s==="split"){let c=Number(t==null?void 0:t.ratio);if(!Number.isFinite(c)||c<=0){const f=Number(t==null?void 0:t.numerator),u=Number(t==null?void 0:t.denominator);Number.isFinite(f)&&Number.isFinite(u)&&u!==0&&(c=f/u)}Number.isFinite(t==null?void 0:t.factor)&&Number(t.factor)>0?r=xk(Number(t.factor)):Number.isFinite(c)&&c>0&&(r=1/c),a=r>0?1/r:1}else s==="dividend"?l=Number((t==null?void 0:t.cash)??0)||0:r=xk(Number(t==null?void 0:t.factor));e.push({type:s,ts:o,priceFactor:r,volumeFactor:a,cash:l})}return e.sort((t,s)=>t.ts-s.ts),e}function m$(n,e,t){if(!Array.isArray(n)||n.length===0||!e||e.length===0)return n;const s=t||"none";if(s==="none")return n;const o=p$(e);return o.length?n.map(r=>{const a=Q4((r==null?void 0:r.timestamp)??(r==null?void 0:r.time));if(!a)return r;let l=r.open,c=r.high,f=r.low,u=r.close,d=r.volume;for(const h of o)if(!(a>=h.ts)){if(h.type==="split"&&(s==="split"||s==="all")){const m=h.priceFactor,g=h.volumeFactor;Number.isFinite(l)&&(l=Number(l)*m),Number.isFinite(c)&&(c=Number(c)*m),Number.isFinite(f)&&(f=Number(f)*m),Number.isFinite(u)&&(u=Number(u)*m),Number.isFinite(d)&&(d=Number(d)*g)}else if(h.type==="dividend"&&(s==="dividend"||s==="all")){const m=h.cash;Number.isFinite(m)&&m!==0&&(Number.isFinite(l)&&(l=Number(l)-m),Number.isFinite(c)&&(c=Number(c)-m),Number.isFinite(f)&&(f=Number(f)-m),Number.isFinite(u)&&(u=Number(u)-m))}else if(h.type==="adjustment"&&s==="all"){const m=h.priceFactor;Number.isFinite(l)&&(l=Number(l)*m),Number.isFinite(c)&&(c=Number(c)*m),Number.isFinite(f)&&(f=Number(f)*m),Number.isFinite(u)&&(u=Number(u)*m)}}return{...r,open:l,high:c,low:f,close:u,volume:d}}):n}const h$={BD:{timezone:"Asia/Dhaka",regular:"1000-1430"},US:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},GB:{timezone:"Europe/London",regular:"0800-1630"},JP:{timezone:"Asia/Tokyo",regular:"0900-1500"},SG:{timezone:"Asia/Singapore",regular:"0900-1700"},HK:{timezone:"Asia/Hong_Kong",regular:"0930-1600"}},v$={DSEBD:{timezone:"Asia/Dhaka",regular:"1000-1430"},NYSE:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},NASDAQ:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},LSE:{timezone:"Europe/London",regular:"0800-1630"},TSE:{timezone:"Asia/Tokyo",regular:"0900-1500"},HKEX:{timezone:"Asia/Hong_Kong",regular:"0930-1600"}},wk=n=>{const e=n.trim();if(!e)return null;const t=e.match(/^(\d{1,2}):?(\d{2})$/);if(!t)return null;const s=Math.max(0,Math.min(23,Number(t[1]))),o=Math.max(0,Math.min(59,Number(t[2])));return`${String(s).padStart(2,"0")}${String(o).padStart(2,"0")}`};function t1(n){const e=String(n??"").trim();if(!e)return;if(e.toLowerCase()==="24x7"||e==="0000-2359")return"24x7";const t=e.split(/[;,]/).map(o=>o.trim()).filter(Boolean),s=[];for(const o of t){const r=o.match(/(\d{1,2}:?\d{2})\s*-\s*(\d{1,2}:?\d{2})/);if(!r)continue;const a=wk(r[1]),l=wk(r[2]);!a||!l||s.push(`${a}-${l}`)}if(s.length)return s.join(";")}function eS(n){const e=n.exchange?v$[String(n.exchange).toUpperCase()]:void 0;if(e)return e;const t=n.country?h$[String(n.country).toUpperCase()]:void 0;return t||{}}function R1(n,e){return n.timezone||n.sessionTimezone||e||"UTC"}function g$(n,e){const t=t1(n.session),s=t1(n.sessionExtended);return e==="all"?"24x7":e==="extended"?s||t||"24x7":t||"24x7"}const j1=n=>n>="0"&&n<="9",kk=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_"||n==="$";class _${constructor(e){$e(this,"pos",0);this.input=e}next(){const e=this.input,t=e.length;for(;this.pos<t&&/\s/.test(e[this.pos]??"");)this.pos++;if(this.pos>=t)return{type:"eof",start:this.pos,end:this.pos};const s=e[this.pos],o=this.pos;if(s==='"'||s==="'"){const r=s;this.pos++;let a="",l=!1;for(;this.pos<t;){const c=e[this.pos];if(this.pos++,l){switch(c){case"n":a+=`
`;break;case"t":a+="	";break;case"r":a+="\r";break;case"\\":case"'":case'"':a+=c;break;default:a+=c;break}l=!1;continue}if(c==="\\"){l=!0;continue}if(c===r)break;a+=c}return{type:"string",value:a,start:o,end:this.pos}}if(j1(s)||s==="."&&j1(e[this.pos+1]??"")){let r=s===".";for(this.pos++;this.pos<t;){const a=e[this.pos];if(j1(a))this.pos++;else if(a==="."&&!r)r=!0,this.pos++;else break}if(e[this.pos]==="e"||e[this.pos]==="E"){let l=this.pos+1;(e[l]==="+"||e[l]==="-")&&l++;const c=l;for(;l<t&&j1(e[l]);)l++;l>c&&(this.pos=l)}return{type:"number",value:e.slice(o,this.pos),start:o,end:this.pos}}if(kk(s)){for(this.pos++;this.pos<t;){const l=e[this.pos];if(kk(l)||j1(l))this.pos++;else break}const r=e.slice(o,this.pos),a=r.toLowerCase();return a==="and"?{type:"and",start:o,end:this.pos}:a==="or"?{type:"or",start:o,end:this.pos}:a==="not"?{type:"not",start:o,end:this.pos}:a==="true"||a==="false"?{type:"boolean",value:a,start:o,end:this.pos}:{type:"identifier",value:r,start:o,end:this.pos}}switch(this.pos++,s){case".":return{type:"dot",start:o,end:this.pos};case">":return e[this.pos]==="="?(this.pos++,{type:"gte",start:o,end:this.pos}):{type:"gt",start:o,end:this.pos};case"<":return e[this.pos]==="="?(this.pos++,{type:"lte",start:o,end:this.pos}):{type:"lt",start:o,end:this.pos};case"=":if(e[this.pos]==="=")return this.pos++,{type:"eq",start:o,end:this.pos};throw new Error(`Unexpected '=' at position ${o}`);case"!":if(e[this.pos]==="=")return this.pos++,{type:"neq",start:o,end:this.pos};throw new Error(`Unexpected '!' at position ${o}`);case"+":return{type:"plus",start:o,end:this.pos};case"-":return{type:"minus",start:o,end:this.pos};case"*":return{type:"star",start:o,end:this.pos};case"/":return{type:"slash",start:o,end:this.pos};case"%":return{type:"percent",start:o,end:this.pos};case"(":return{type:"lparen",start:o,end:this.pos};case")":return{type:"rparen",start:o,end:this.pos};case",":return{type:"comma",start:o,end:this.pos};case"?":return{type:"qmark",start:o,end:this.pos};case":":return{type:"colon",start:o,end:this.pos};case"[":return{type:"lbracket",start:o,end:this.pos};case"]":return{type:"rbracket",start:o,end:this.pos};default:throw new Error(`Unexpected character "${s}" at position ${o}`)}}}class Qv extends Error{constructor(e,t){super(e),this.position=t,this.name="ParseError"}}class y${constructor(e){$e(this,"current");this.tokenizer=e,this.current=e.next()}eat(e){if(this.current.type!==e)throw new Qv(`Expected ${e} but found ${this.current.type}`,this.current.start);const t=this.current;return this.current=this.tokenizer.next(),t}match(e){return this.current.type===e?(this.current=this.tokenizer.next(),!0):!1}parseExpression(){return this.parseTernary()}parseTernary(){const e=this.parseOr();if(this.current.type==="qmark"){this.current=this.tokenizer.next();const t=this.parseExpression();this.eat("colon");const s=this.parseExpression();return{kind:"CallExpression",callee:"iff",args:[e,t,s]}}return e}parseOr(){let e=this.parseAnd();for(;this.current.type==="or";){this.current=this.tokenizer.next();const t=this.parseAnd();e={kind:"BinaryExpression",operator:"or",left:e,right:t}}return e}parseAnd(){let e=this.parseComparison();for(;this.current.type==="and";){this.current=this.tokenizer.next();const t=this.parseComparison();e={kind:"BinaryExpression",operator:"and",left:e,right:t}}return e}parseComparison(){let e=this.parseAddSub();for(;this.current.type==="gt"||this.current.type==="lt"||this.current.type==="gte"||this.current.type==="lte"||this.current.type==="eq"||this.current.type==="neq";){const t=this.current;this.current=this.tokenizer.next();const s=this.parseAddSub();let o="==";t.type==="gt"?o=">":t.type==="lt"?o="<":t.type==="gte"?o=">=":t.type==="lte"?o="<=":t.type==="neq"&&(o="!="),e={kind:"BinaryExpression",operator:o,left:e,right:s}}return e}parseAddSub(){let e=this.parseTerm();for(;this.current.type==="plus"||this.current.type==="minus";){const t=this.current;this.current=this.tokenizer.next();const s=this.parseTerm();e={kind:"BinaryExpression",operator:t.type==="plus"?"+":"-",left:e,right:s}}return e}parseTerm(){let e=this.parseFactor();for(;this.current.type==="star"||this.current.type==="slash"||this.current.type==="percent";){const t=this.current;this.current=this.tokenizer.next();const s=this.parseFactor();e={kind:"BinaryExpression",operator:t.type==="star"?"*":t.type==="slash"?"/":"%",left:e,right:s}}return e}parseFactor(){if(this.current.type==="not")return this.current=this.tokenizer.next(),{kind:"UnaryExpression",operator:"not",expr:this.parseFactor()};if(this.current.type==="plus"||this.current.type==="minus"){const e=this.current.type==="minus";this.current=this.tokenizer.next();const t=this.parseFactor();return e?{kind:"BinaryExpression",operator:"*",left:{kind:"NumberLiteral",value:-1},right:t}:t}return this.parsePostfix(this.parsePrimary())}parsePostfix(e){var s;let t=e;for(;;){if(this.current.type==="dot"){if(this.current=this.tokenizer.next(),this.current.type!=="identifier")throw new Qv("Expected identifier after '.'",this.current.start);const o=((s=this.current.value)==null?void 0:s.toString())??"";this.current=this.tokenizer.next(),t={kind:"MemberExpression",object:t,property:{kind:"Identifier",name:o}};continue}if(this.current.type==="lbracket"){this.current=this.tokenizer.next();const o=this.parseExpression();this.eat("rbracket"),t={kind:"IndexExpression",object:t,index:o};continue}break}return t}parsePrimary(){const e=this.current;switch(e.type){case"number":{this.current=this.tokenizer.next();const t=Number(e.value);if(!Number.isFinite(t))throw new Qv("Invalid number literal",e.start);return{kind:"NumberLiteral",value:t}}case"string":return this.current=this.tokenizer.next(),{kind:"StringLiteral",value:String(e.value??"")};case"boolean":return this.current=this.tokenizer.next(),{kind:"NumberLiteral",value:String(e.value||"").toLowerCase()==="true"?1:0};case"identifier":{this.current=this.tokenizer.next();const t=(e.value||"").toString();if(this.current.type==="lparen"){this.eat("lparen");const s=[];if(this.current.type!=="rparen")for(;s.push(this.parseExpression()),!!this.match("comma"););return this.eat("rparen"),{kind:"CallExpression",callee:t,args:s}}return{kind:"Identifier",name:t}}case"lparen":{this.eat("lparen");const t=this.parseExpression();return this.eat("rparen"),t}default:throw new Qv(`Unexpected token ${e.type}`,e.start)}}}function Ap(n){const e=new y$(new _$(n)),t=e.parseExpression();if(e.current.type!=="eof")throw new Qv("Unexpected input after end of expression",e.current.start);return t}function b_(n,e){const t=[];let s=0;for(let o=0;o<n.length;o++){const r=n[o];s+=r??0,o>=e&&(s-=n[o-e]??0),t.push(o>=e-1?s/e:void 0)}return t}function b$(n,e){const t=[],s=e*(e+1)/2;for(let o=0;o<n.length;o++){if(o<e-1){t.push(void 0);continue}let r=0;for(let a=0;a<e;a++)r+=(n[o-a]??0)*(e-a);t.push(r/s)}return t}function x$(n,e){const t=[];let s,o=0;for(let r=0;r<n.length;r++){const a=n[r];if(a==null){t.push(void 0);continue}if(s===void 0){if(o+=a,r<e-1){t.push(void 0);continue}s=o/e,t.push(s);continue}s=(s*(e-1)+a)/e,t.push(s)}return t}function t0(n,e){const t=[],s=2/(e+1);let o;for(let r=0;r<n.length;r++){const a=n[r];if(a==null){t.push(void 0);continue}o=o===void 0?a:a*s+o*(1-s),t.push(o)}return t}function w$(n,e){const t=[];let s,o=0,r=0,a=!1;const l=[],c=[];for(let f=0;f<n.length;f++){const u=n[f];if(u==null){t.push(void 0);continue}if(s===void 0){s=u,t.push(void 0);continue}const d=u-s;s=u;const h=d>0?d:0,m=d<0?-d:0;if(a)o=(o*(e-1)+h)/e,r=(r*(e-1)+m)/e;else{if(l.push(h),c.push(m),l.length<e){t.push(void 0);continue}o=l.reduce((g,w)=>g+w,0)/e,r=c.reduce((g,w)=>g+w,0)/e,a=!0}if(r===0)t.push(100);else{const g=o/r;t.push(100-100/(1+g))}}return t}function l2(n,e,t,s){const o=t.length,r=new Array(o).fill(0);let a;for(let f=0;f<o;f++){const u=n[f]??t[f]??NaN,d=e[f]??t[f]??NaN,h=t[f]??NaN;let m=Math.max(0,u-d);a!==void 0&&(m=Math.max(m,Math.abs(u-a),Math.abs(d-a))),r[f]=m,a=h}const l=new Array(o);let c=0;for(let f=0;f<o;f++)c+=r[f],f===s-1?l[f]=c/s:f>=s?l[f]=(l[f-1]*(s-1)+r[f])/s:l[f]=void 0;return l}function tS(n,e){const t=new Array(n.length);let s=0,o;for(let r=0;r<n.length;r++){const a=n[r],l=e[r]??0;if(o===void 0||a===void 0){t[r]=void 0,o=a;continue}a>o?s+=l:a<o&&(s-=l),t[r]=s,o=a}return t}function nS(n,e,t,s){const o=t.length,r=new Array(o);for(let c=0;c<o;c++)r[c]=((n[c]??t[c]??0)+(e[c]??t[c]??0)+(t[c]??0))/3;const a=b_(r.map(c=>c),s).map(c=>c),l=new Array(o);for(let c=0;c<o;c++){if(c<s-1){l[c]=void 0;continue}let f=0;for(let d=c-s+1;d<=c;d++)f+=Math.abs(r[d]-a[c]);f=f/s;const u=.015*f;l[c]=u===0?void 0:(r[c]-a[c])/u}return l}function sS(n,e,t,s,o){const r=t.length,a=new Array(r),l=new Array(r);for(let f=0;f<r;f++)l[f]=((n[f]??t[f]??0)+(e[f]??t[f]??0)+(t[f]??0))/3;const c=new Array(r);for(let f=0;f<r;f++)c[f]=l[f]*(s[f]??0);for(let f=0;f<r;f++){if(f<o){a[f]=void 0;continue}let u=0,d=0;for(let m=f-o+1;m<=f;m++)l[m]>=l[m-1]?u+=c[m]:d+=c[m];const h=d===0?1/0:u/d;a[f]=100-100/(1+h)}return a}function k$(n,e){const t=n.map((a,l)=>((a??0)+(e[l]??0))/2),s=b_(t,5),o=b_(t,34),r=new Array(t.length);for(let a=0;a<t.length;a++){const l=s[a],c=o[a];r[a]=l===void 0||c===void 0?void 0:l-c}return r}function S$(n,e){const t=t0(n,e).map(a=>a??NaN),s=t0(t,e).map(a=>a??NaN),o=t0(s,e).map(a=>a??NaN),r=new Array(n.length);for(let a=1;a<n.length;a++){const l=o[a-1],c=o[a];r[a]=l===void 0||c===void 0||l===0?void 0:(c/l-1)*100}return r[0]=void 0,r}function Sk(n,e){const t=new Array(n.length);let s=0,o=0;for(let r=0;r<n.length;r++){const a=n[r],l=e[r]??0;if(a===void 0){t[r]=void 0;continue}s+=a*l,o+=l,t[r]=o===0?void 0:s/o}return t}function C$(n,e,t){const s=new Array(n.length);let o=0,r=0;for(let a=0;a<n.length;a++){const l=n[a],c=e[a]??0;if(l!==void 0&&(o+=l*c,r+=c),a>=t){const f=n[a-t],u=e[a-t]??0;f!==void 0&&(o-=f*u,r-=u)}s[a]=a>=t-1&&r!==0?o/r:void 0}return s}function ow(n,e,t){const s=n.map(c=>c??NaN),o=b_(s,e),r=[];for(let c=0;c<s.length;c++){if(c<e-1){r.push(void 0);continue}let f=0;for(let h=c-e+1;h<=c;h++)f+=s[h];const u=f/e;let d=0;for(let h=c-e+1;h<=c;h++){const m=s[h]-u;d+=m*m}r.push(Math.sqrt(d/e))}const a=new Array(s.length),l=new Array(s.length);for(let c=0;c<s.length;c++){const f=o[c],u=r[c];a[c]=f===void 0||u===void 0?void 0:f+t*u,l[c]=f===void 0||u===void 0?void 0:f-t*u}return{mid:o,upper:a,lower:l}}function I$(n,e,t,s,o){const r=t.length,a=l2(n,e,t,s).map(m=>m??NaN),l=new Array(r),c=new Array(r);for(let m=0;m<r;m++){const g=((n[m]??t[m]??0)+(e[m]??t[m]??0))/2,w=a[m];l[m]=g+o*w,c[m]=g-o*w}const f=new Array(r);let u=NaN,d=NaN,h=!0;for(let m=0;m<r;m++){u=Number.isFinite(u)?Math.min(l[m],u):l[m],d=Number.isFinite(d)?Math.max(c[m],d):c[m];const g=t[m]??NaN;if(!Number.isFinite(g)){f[m]=void 0;continue}h?(g<d&&(h=!1,u=l[m]),f[m]=d):(g>u&&(h=!0,d=c[m]),f[m]=u)}return f}function P$(n,e,t,s,o){const r=t0(t,s).map(u=>u??NaN),a=l2(n,e,t,s).map(u=>u??NaN),l=t.length,c=new Array(l),f=new Array(l);for(let u=0;u<l;u++){const d=r[u],h=a[u];c[u]=Number.isFinite(d)&&Number.isFinite(h)?d+o*h:void 0,f[u]=Number.isFinite(d)&&Number.isFinite(h)?d-o*h:void 0}return{mid:r,upper:c,lower:f}}function M$(n,e,t){const s=n.length,o=new Array(s),r=new Array(s),a=new Array(s);for(let l=0;l<s;l++){if(l<t-1){o[l]=void 0,r[l]=void 0,a[l]=void 0;continue}let c=-1/0,f=1/0;for(let u=l-t+1;u<=l;u++){const d=n[u]??e[u]??NaN,h=e[u]??n[u]??NaN;Number.isFinite(d)&&d>c&&(c=d),Number.isFinite(h)&&h<f&&(f=h)}o[l]=c,r[l]=f,a[l]=Number.isFinite(c)&&Number.isFinite(f)?(c+f)/2:void 0}return{upper:o,lower:r,mid:a}}function oS(n,e){const t=n.length,s=new Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=void 0;continue}let r=0;for(let u=o-e+1;u<=o;u++)r+=n[u]??0;const a=r/e;let l=0;for(let u=o-e+1;u<=o;u++){const d=(n[u]??0)-a;l+=d*d}const c=Math.sqrt(l/e),f=n[o]??NaN;s[o]=Number.isFinite(c)&&c!==0?(f-a)/c:void 0}return s}function Ck(n,e){const t=n.length,s=new Array(t);let o=n[0];for(let r=0;r<t;r++){const a=n[r],l=e[r]??0;if(a==null){s[r]=void 0;continue}const c=a>=(o??a)?1:-1;s[r]=c*l,o=a}return s}function N$(n){const e=n.length,t=new Array(e);let s=0;for(let o=0;o<e;o++){const r=n[o];if(r==null){t[o]=void 0;continue}s+=r,t[o]=s}return t}function A$(n,e){const t=n.length,s=new Array(t),o=new Array(t),r=new Array(t);for(let a=0;a<t;a++){if(a<e-1){s[a]=void 0,o[a]=void 0,r[a]=void 0;continue}let l=0,c=0,f=0,u=0,d=0;for(let T=a-e+1;T<=a;T++){const N=T-(a-e+1),L=n[T]??NaN;Number.isFinite(L)&&(l+=N,c+=L,f+=N*N,u+=N*L,d++)}const h=d*f-l*l;if(h===0||d===0){s[a]=void 0,o[a]=void 0,r[a]=void 0;continue}const m=(d*u-l*c)/h,g=(c-m*l)/d,w=e-1,C=m*w+g;s[a]=C;const M=oS(n.slice(a-e+1,a+1).map(T=>T??NaN),e).pop(),P=Number(M)*(n[a]??0?1:0);o[a]=Number.isFinite(C)?C+Math.abs(P||0):void 0,r[a]=Number.isFinite(C)?C-Math.abs(P||0):void 0}return{mid:s,upper:o,lower:r}}function iS(n,e,t){const s=n.length,o=new Array(s);let r=0;for(let a=0;a<s;a++){const l=n[a],c=e[a]??0;if(l==null){o[a]=void 0;continue}const f=c/Math.max(1,e[a-1]??c);r=(r*(t-1)+l*f)/t,o[a]=r}return o}function gv(n){if(!n)return 0;let e=2166136261;for(let s=0;s<n.length;s++)e^=n.charCodeAt(s),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function yy(n){return Number.isFinite(n)?n.toFixed(2):""}function iw(n,e){if(!Number.isFinite(n))return"";if(!e)return yy(n);const t=String(e),s=t.includes("%"),o=t.split(".");let r=0;o.length>1&&(r=o[1].replace(/[^0-9#]/g,"").length);const a=s?n*100:n,l=r>0?a.toFixed(r):String(Math.round(a));return s?`${l}%`:l}class kt extends Error{constructor(e){super(e),this.name="ExpressionEngineError"}}function Zv(n,e){const t=n.length,s=new Float32Array(t);let o=0;for(let r=0;r<t;r++){const a=n[r];if(Number.isFinite(a)&&(o+=a),r>=e){const l=n[r-e];Number.isFinite(l)&&(o-=l)}s[r]=r>=e-1?o:NaN}return s}function rS(n,e,t){const s=n.length,o=new Float32Array(s),r=e-1,a=t==="rising";for(let l=0;l<s;l++){if(l<r){o[l]=NaN;continue}let c=!0,f=!0;const u=l-r;for(let d=u;d<=l;d++){const h=n[d];if(!Number.isFinite(h)){f=!1;break}if(d===u)continue;const m=n[d-1];if(!Number.isFinite(m)){f=!1;break}(a?!(h>m):!(h<m))&&(c=!1)}o[l]=f?c?1:0:NaN}return o}function aS(n,e,t){let s=-1/0;for(let o=e;o<=t;o++){const r=n[o];Number.isFinite(r)&&r>s&&(s=r)}return s}function lS(n,e,t){let s=1/0;for(let o=e;o<=t;o++){const r=n[o];Number.isFinite(r)&&r<s&&(s=r)}return s}function T$(n,e){const t=n.length,s=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=n[r],c=a>=0?n[a]:NaN;s[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return s}function Y1(n,e){const t=n.length,s=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=n[r],c=a>=0?n[a]:NaN;!Number.isFinite(l)||!Number.isFinite(c)||c===0?s[r]=NaN:s[r]=(l-c)/c*100}return s}function F$(n,e){const t=n.length,s=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=n[r],c=a>=0?n[a]:NaN;s[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return s}function _g(n){const e=new Array(n.length);for(let t=0;t<n.length;t++){const s=n[t];e[t]=Number.isFinite(s)?s:void 0}return e}function g0(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;t++){const s=n[t];e[t]=s==null||!Number.isFinite(s)?NaN:s}return e}function L$(n,e,t,s){const o=_g(n),r=t0(o,e),a=t0(o,t),l=new Array(o.length);for(let u=0;u<o.length;u++){const d=r[u],h=a[u];l[u]=d==null||h==null?void 0:d-h}const c=t0(l,s),f=new Array(o.length);for(let u=0;u<o.length;u++){const d=l[u],h=c[u];f[u]=d==null||h==null?void 0:d-h}return{line:g0(l),signal:g0(c),hist:g0(f)}}function E$(n,e,t,s,o){const r=t.length,a=new Array(r);for(let u=0;u<r;u++){const d=Math.max(0,u-s+1);let h=-1/0,m=1/0;for(let C=d;C<=u;C++){const M=Number.isFinite(n[C])?n[C]:t[C],P=Number.isFinite(e[C])?e[C]:t[C];Number.isFinite(M)&&M>h&&(h=M),Number.isFinite(P)&&P<m&&(m=P)}const g=t[u],w=h-m;!Number.isFinite(g)||!Number.isFinite(h)||!Number.isFinite(m)||w===0?a[u]=void 0:a[u]=100*((g-m)/w)}const l=a.map(u=>u??NaN),c=b_(l,o),f=new Array(r);for(let u=0;u<r;u++){const d=c[u];f[u]=Number.isFinite(d)?d:void 0}return{k:g0(a),d:g0(f)}}function cS(n,e,t,s){const o=t.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=Math.max(0,a-s+1);let c=-1/0,f=1/0,u=!1;for(let m=l;m<=a;m++){const g=Number.isFinite(n[m])?n[m]:t[m],w=Number.isFinite(e[m])?e[m]:t[m];Number.isFinite(g)&&(g>c&&(c=g),u=!0),Number.isFinite(w)&&(w<f&&(f=w),u=!0)}const d=t[a],h=c-f;if(!u||!Number.isFinite(d)||!Number.isFinite(c)||!Number.isFinite(f)||h===0){r[a]=NaN;continue}r[a]=-100*((c-d)/h)}return r}function c2(n,e,t){const s=GS(n,t),o=YS(e,t),r=n.length,a=new Float32Array(r),l=new Float32Array(r);for(let c=0;c<r;c++){const f=s[c],u=o[c];if(!Number.isFinite(f)||!Number.isFinite(u)){a[c]=NaN,l[c]=NaN;continue}a[c]=100*((t-f)/t),l[c]=100*((t-u)/t)}return{up:a,down:l}}function $$(n,e,t){const{up:s,down:o}=c2(n,e,t),r=s.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?c-f:NaN}return a}function K0(n,e,t,s,o){const r=t.length,a=new Float32Array(r),l=new Float32Array(r),c=new Float32Array(r);for(let C=0;C<r;C++){const M=n[C],P=e[C],T=t[C];if(!Number.isFinite(M)||!Number.isFinite(P)||!Number.isFinite(T)){a[C]=NaN,l[C]=NaN,c[C]=NaN;continue}if(C===0){a[C]=Math.max(0,M-P),l[C]=0,c[C]=0;continue}const N=n[C-1],L=e[C-1],O=t[C-1];if(!Number.isFinite(N)||!Number.isFinite(L)||!Number.isFinite(O)){a[C]=NaN,l[C]=NaN,c[C]=NaN;continue}const D=M-N,$=L-P;l[C]=D>$&&D>0?D:0,c[C]=$>D&&$>0?$:0;const z=M-P,te=Math.abs(M-O),pe=Math.abs(P-O);a[C]=Math.max(0,z,te,pe)}const f=z_(a,s),u=z_(l,s),d=z_(c,s),h=new Float32Array(r),m=new Float32Array(r),g=new Float32Array(r);for(let C=0;C<r;C++){const M=f[C],P=u[C],T=d[C];if(!Number.isFinite(M)||M===0||!Number.isFinite(P)||!Number.isFinite(T)){h[C]=NaN,m[C]=NaN,g[C]=NaN;continue}h[C]=100*(P/M),m[C]=100*(T/M);const N=h[C]+m[C];g[C]=N===0?NaN:100*(Math.abs(h[C]-m[C])/N)}const w=z_(g,o);return{plus:h,minus:m,adx:w}}function uS(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){const r=n[o],a=e[o],l=r+a;s[o]=Number.isFinite(r)&&Number.isFinite(a)&&l!==0?100*(Math.abs(r-a)/l):NaN}return s}function dS(n,e,t,s){const o=n.length,r=new Float32Array(o),a=Math.max(1,t+1),l=new Array(a);let c=0,f=0;const u=s||(d=>Number.isFinite(d)&&d!==0);for(let d=0;d<o;d++){const h=n[d];if(u(h)&&(l[f]=d,f=(f+1)%a,c<a&&(c+=1)),c>t){const m=l[(f-1-t+a)%a],g=e[m];r[d]=Number.isFinite(g)?g:NaN}else r[d]=NaN}return r}function fS(n,e){if(!Number.isFinite(n)||!Number.isFinite(e)||!Number.isInteger(n)||!Number.isInteger(e)||n<1||e<1)throw new kt("pivot left/right must be positive integers");return{left:n,right:e}}function D$(n,e,t,s){const o=n.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=a-t;if(l-e<0){r[a]=NaN;continue}const c=n[l];if(!Number.isFinite(c)){r[a]=NaN;continue}const f=l-e,u=l+t;let d=!0;for(let h=f;h<=u;h++){const m=n[h];if(!Number.isFinite(m)){d=!1;break}if(s==="high"){if(m>c){d=!1;break}}else if(m<c){d=!1;break}}r[a]=d?c:NaN}return r}const pS="time function args must be integers",mS="timestamp month out of range";function rw(n){return Number.isFinite(n)?(new Date(n).getUTCDay()+6)%7+1:NaN}function aw(n,e){if(!Number.isFinite(n))return NaN;const t=new Date(n);switch(e){case"year":return t.getUTCFullYear();case"month":return t.getUTCMonth()+1;case"hour":return t.getUTCHours();case"minute":return t.getUTCMinutes();default:return t.getUTCSeconds()}}function Y0(n){if(!Number.isFinite(n)||!Number.isInteger(n))throw new kt(pS)}function Ik(n){for(let e=0;e<n.length;e++){const t=n[e];if(Number.isFinite(t)&&!Number.isInteger(t))throw new kt(pS)}}function hS(n,e,t,s,o,r){if(Y0(n),Y0(e),Y0(t),Y0(s),Y0(o),Y0(r),e<1||e>12)throw new kt(mS);return Date.UTC(n,e-1,t,s,o,r)}function vS(n){var s,o;const e=(s=n.scalars)==null?void 0:s.__bardurationms;if(Number.isFinite(e)&&e>0)return e;const t=(o=n.series)==null?void 0:o.time;if(t&&t.length>1)for(let r=t.length-1;r>0;r--){const a=t[r],l=t[r-1];if(!Number.isFinite(a)||!Number.isFinite(l))continue;const c=a-l;if(Number.isFinite(c)&&c>0)return c}return 0}function gS(n){var t;const e=(t=n.scalars)==null?void 0:t.__nowms;return Number.isFinite(e)?e:Date.now()}const u2="session.isin session must be in HHMM-HHMM",lw="session.isin time must be a number",Pk=new Map;function _S(n){const e=String(n||"").trim(),t=Pk.get(e);if(t)return t;const s=e.match(/^(\d{2})(\d{2})-(\d{2})(\d{2})$/);if(!s)throw new kt(u2);const o=Number(s[1]),r=Number(s[2]),a=Number(s[3]),l=Number(s[4]);if(![o,r,a,l].every(Number.isFinite)||o<0||o>23||a<0||a>23||r<0||r>59||l<0||l>59)throw new kt(u2);const c=o*60+r,f=a*60+l,u={start:c,end:f};return Pk.set(e,u),u}function cw(n){const e=new Date(n);return e.getUTCHours()*60+e.getUTCMinutes()}function uw(n,e,t){return e<=t?n>=e&&n<=t:n>=e||n<=t}function Us(n,e){if(n.kind==="series")return n.value;const t=new Float32Array(e.length);return t.fill(n.value),t}function ii(n){if(n.kind==="scalar")return n.value;const e=n.value;return e.length?e[e.length-1]:NaN}function B1(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++)s[o]=e(n[o]);return s}function gb(n,e,t){const s=n.length,o=new Float32Array(s);for(let r=0;r<s;r++)o[r]=t(n[r],e[r]);return o}const R$="unsafe division: divisor is 0/na",s_="math domain error: sqrt/log/pow/asin/acos",yS="ternary branches must both be numeric or both non-numeric",ry="history index must be integer >= 0",bS="array index must be integer >= 0",j$="array index must be an integer",B$="Negative array index not allowed",O$="array.set index must be within array size",xS="array.push value must be a string",z$="condition is na; treated as false",d2="condition must be bool or number",V$="math.mod divisor is 0/na",W$="math.fmod divisor is 0/na",H$="atr length must be integer >= 1",wS="williamsr length must be integer >= 1",kS="aroon length must be integer >= 1",SS="dmi length must be integer >= 1",CS="dmi smoothing must be integer >= 1",IS="adx length must be integer >= 1",PS="plus_di length must be integer >= 1",MS="minus_di length must be integer >= 1",NS="dx length must be integer >= 1",AS="aroonosc length must be integer >= 1",TS="highest length must be integer >= 1",FS="lowest length must be integer >= 1",LS="sum length must be integer >= 1",ES="rising length must be integer >= 1",$S="falling length must be integer >= 1",f2="valuewhen occurrence must be integer >= 0",q$=new Set(["syminfo","strategy","barstate","timeframe"]),k_=n=>{const e=[];let t=n;for(;t.kind==="MemberExpression";)e.unshift(t.property.name),t=t.object;if(t.kind!=="Identifier")return null;const s=t.name.toLowerCase();return q$.has(s)?[s,...e].join("_"):null},r_=n=>Number.isFinite(n)?n===0?0:1:NaN,dw=n=>{const e=r_(n);return Number.isFinite(e)?e===0?1:0:NaN},K_=(n,e)=>{const t=r_(n);if(t===0)return 0;const s=r_(e);return t===1?s:s===0?0:Number.isFinite(s)?NaN:NaN},X_=(n,e)=>{const t=r_(n);if(t===1)return 1;const s=r_(e);return t===0?s:s===1?1:Number.isFinite(s)?NaN:NaN},y0=(n,e,t)=>Number.isFinite(n)?n!==0:(e&&t&&e.emitOnce(t,z$),!1),fw=(n,e,t)=>y0(n,e==null?void 0:e.diagnostics,t),Cd=(n,e,t)=>{var s;(s=n==null?void 0:n.diagnostics)==null||s.emitOnce(e,t)},U$=n=>Number.isFinite(n)&&Math.floor(n)===n,F2=n=>n===">"||n==="<"||n===">="||n==="<="||n==="=="||n==="!=",x_=(n,e,t,s)=>t?Number.isFinite(n)?!Number.isFinite(e)||e===0?(Cd(s,"div_zero",R$),NaN):n/e:NaN:e===0?NaN:n/e,DS=(n,e,t,s)=>t&&(!Number.isFinite(n)||!Number.isFinite(e)||e===0)?(Cd(s,"fmod_div_zero",W$),NaN):n%e,RS=(n,e,t,s)=>t&&(!Number.isFinite(n)||!Number.isFinite(e)||e===0)?(Cd(s,"mod_div_zero",V$),NaN):(n%e+e)%e,pw=(n,e,t,s)=>{if(!t)return Math.pow(n,e);if(!Number.isFinite(n)||!Number.isFinite(e))return Cd(s,"math_domain",s_),NaN;if(n<0&&!U$(e))return Cd(s,"math_domain",s_),NaN;const o=Math.pow(n,e);return Number.isFinite(o)?o:(Cd(s,"math_domain",s_),NaN)},jS=(n,e,t)=>e&&(!Number.isFinite(n)||n<0)?(Cd(t,"math_domain",s_),NaN):Math.sqrt(n),BS=(n,e,t)=>{if(!e)return Math.log(n);if(!Number.isFinite(n)||n<=0)return Cd(t,"math_domain",s_),NaN;const s=Math.log(n);return Number.isFinite(s)?s:NaN},OS=(n,e,t)=>{if(!e)return Math.log10(n);if(!Number.isFinite(n)||n<=0)return Cd(t,"math_domain",s_),NaN;const s=Math.log10(n);return Number.isFinite(s)?s:NaN},zS=(n,e,t)=>e&&(!Number.isFinite(n)||n<-1||n>1)?(Cd(t,"math_domain",s_),NaN):Math.asin(n),VS=(n,e,t)=>e&&(!Number.isFinite(n)||n<-1||n>1)?(Cd(t,"math_domain",s_),NaN):Math.acos(n),WS=(n,e)=>{if(!e)return Math.tan(n);if(!Number.isFinite(n))return NaN;const t=Math.tan(n);return Number.isFinite(t)?t:NaN},HS=(n,e)=>{if(!e)return Math.exp(n);if(!Number.isFinite(n))return NaN;const t=Math.exp(n);return Number.isFinite(t)?t:NaN},X0=(n,e,t,s)=>!Number.isFinite(n)||!Number.isInteger(n)||n<0?(Cd(s,e,t),NaN):n,p2=(n,e,t)=>!Number.isFinite(n)||!Number.isInteger(n)?(Cd(t,`${e}:int`,j$),NaN):n<0?(Cd(t,`${e}:neg`,B$),NaN):n,mw=(n,e,t,s)=>{const o=p2(n,t,s);return!Number.isFinite(o)||!Number.isFinite(e)?0:o>=e?(Cd(s,`${t}:oob`,O$),0):1},Gp=(n,e,t,s)=>!Number.isFinite(n)||!Number.isInteger(n)||n<1?(Cd(s,e,t),NaN):n,Uv=n=>{const e=new Float32Array(n);return e.fill(NaN),e},G$=new Set(["tostring","format","upper","lower","trim","replace","replace_all","contains","startswith","endswith","length","substring","repeat"]),Y$=new Set(["tostring","format","upper","lower","trim","replace","replace_all","substring","repeat"]),Mk=new WeakMap,Sd=n=>{const e=Mk.get(n);if(e)return e;let t="";switch(n.kind){case"NumberLiteral":t=`n:${n.value}`;break;case"StringLiteral":t=`s:${n.value}`;break;case"Identifier":t=`id:${n.name}`;break;case"UnaryExpression":t=`u:${n.operator}:${Sd(n.expr)}`;break;case"BinaryExpression":t=`b:${n.operator}:${Sd(n.left)}:${Sd(n.right)}`;break;case"CallExpression":t=`c:${n.callee}:${n.args.map(Sd).join(",")}`;break;case"MemberExpression":t=`m:${Sd(n.object)}:${n.property.name}`;break;case"IndexExpression":t=`i:${Sd(n.object)}:${Sd(n.index)}`;break;default:t="expr"}return Mk.set(n,t),t},M0=n=>{switch(n.kind){case"Identifier":return n.name;case"NumberLiteral":return Number.isFinite(n.value)?String(n.value):"na";case"StringLiteral":return JSON.stringify(n.value);case"MemberExpression":return`${M0(n.object)}.${n.property.name}`;case"IndexExpression":return`${M0(n.object)}[${M0(n.index)}]`;case"CallExpression":return`${n.callee}(${n.args.map(M0).join(", ")})`;case"UnaryExpression":return`${n.operator} ${M0(n.expr)}`;case"BinaryExpression":return`${M0(n.left)} ${n.operator} ${M0(n.right)}`;default:return"expr"}},Zw=(n,e)=>{Cd(n,`member:${Sd(e)}`,`Unsupported member access: ${M0(e)}`)},Jw=(n,e)=>{Cd(n,`index:${Sd(e)}`,`Unsupported indexing: ${M0(e)}`)},Nk=new WeakMap,s0=n=>{const e=Nk.get(n);if(e!=null)return e;let t=!1;switch(n.kind){case"StringLiteral":t=!0;break;case"CallExpression":{const s=n.callee.toLowerCase();if(Y$.has(s)){t=!0;break}(s==="iff"||s==="iif"||s==="if")&&n.args.length===3&&(t=s0(n.args[1])||s0(n.args[2]));break}default:t=!1}return Nk.set(n,t),t},Q0=(n,e,t)=>`cond:${e!=null&&e.selfKey?e.selfKey:"cond"}:${Sd(n)}:${t}`,K$=(n,e)=>{let t=!1;const s=o=>{if(!t)switch(o.kind){case"Identifier":{const r=o.name.replace(/\s+/g,"_").toLowerCase();e.series[r]&&(t=!0);return}case"MemberExpression":{const r=k_(o);if(r){const a=r.replace(/\s+/g,"_").toLowerCase();e.series[a]&&(t=!0);return}s(o.object);return}case"IndexExpression":s(o.object),s(o.index);return;case"UnaryExpression":s(o.expr);return;case"BinaryExpression":s(o.left),s(o.right);return;case"CallExpression":o.args.forEach(r=>s(r));return;default:return}};return s(n),t},n1=n=>{switch(n.kind){case"StringLiteral":return"nonNumeric";case"NumberLiteral":return"numeric";case"Identifier":{const e=n.name.replace(/\s+/g,"_").toLowerCase();return e==="true"||e==="false"?"nonNumeric":"numeric"}case"MemberExpression":{const e=k_(n);if(e){const t=e.replace(/\s+/g,"_").toLowerCase();if(t==="true"||t==="false")return"nonNumeric"}return"numeric"}case"IndexExpression":return"numeric";case"UnaryExpression":return n.operator==="not"?"nonNumeric":"numeric";case"BinaryExpression":return F2(n.operator)||n.operator==="and"||n.operator==="or"?"nonNumeric":"numeric";case"CallExpression":{const e=n.callee.toLowerCase();if((e==="iff"||e==="iif"||e==="if")&&n.args.length===3){const t=n1(n.args[1]),s=n1(n.args[2]);return t===s?t:"numeric"}return G$.has(e)?"nonNumeric":"numeric"}default:return"numeric"}};function qS(n,e,t,s){var m;const o=e.kind==="series",r=t.kind==="series",a=((m=s.scalars)==null?void 0:m.__pinev2)===1,l=a&&F2(n),c=g=>Number.isFinite(g)&&g!==0;if(!o&&!r){const g=e.value,w=t.value;if(l&&(!Number.isFinite(g)||!Number.isFinite(w)))return{kind:"scalar",value:NaN};switch(n){case"+":return{kind:"scalar",value:g+w};case"-":return{kind:"scalar",value:g-w};case"*":return{kind:"scalar",value:g*w};case"/":return{kind:"scalar",value:x_(g,w,a,s)};case"%":return{kind:"scalar",value:w===0?NaN:g%w};case">":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g>w?1:0};case"<":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g<w?1:0};case">=":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g>=w?1:0};case"<=":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&g<=w?1:0};case"==":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&Math.abs(g-w)<1e-9?1:0};case"!=":return{kind:"scalar",value:Number.isFinite(g)&&Number.isFinite(w)&&Math.abs(g-w)>=1e-9?1:0};case"and":return{kind:"scalar",value:a?K_(g,w):c(g)&&c(w)?1:0};case"or":return{kind:"scalar",value:a?X_(g,w):c(g)||c(w)?1:0}}}const f=Us(e,s),u=Us(t,s),d=s.length,h=new Float32Array(d);for(let g=0;g<d;g++){const w=f[g],C=u[g];if(l&&(!Number.isFinite(w)||!Number.isFinite(C))){h[g]=NaN;continue}switch(n){case"+":h[g]=w+C;break;case"-":h[g]=w-C;break;case"*":h[g]=w*C;break;case"/":h[g]=x_(w,C,a,s);break;case"%":h[g]=C===0?NaN:w%C;break;case">":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w>C?1:0;break;case"<":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w<C?1:0;break;case">=":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w>=C?1:0;break;case"<=":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&w<=C?1:0;break;case"==":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&Math.abs(w-C)<1e-9?1:0;break;case"!=":h[g]=Number.isFinite(w)&&Number.isFinite(C)&&Math.abs(w-C)>=1e-9?1:0;break;case"and":h[g]=a?K_(w,C):c(w)&&c(C)?1:0;break;case"or":h[g]=a?X_(w,C):c(w)||c(C)?1:0;break}}return{kind:"series",value:h}}function X$(n,e){var f;if(!(((f=e.scalars)==null?void 0:f.__pinev2)===1)||n.operator!=="and"&&n.operator!=="or")return qS(n.operator,n0(n.left,e),n0(n.right,e),e);const s=n0(n.left,e),o=n.operator;if(s.kind==="scalar"){const u=r_(s.value);if(o==="and"&&u===0)return{kind:"scalar",value:0};if(o==="or"&&u===1)return{kind:"scalar",value:1};const d=n0(n.right,e);if(d.kind==="scalar")return{kind:"scalar",value:o==="and"?K_(u,d.value):X_(u,d.value)};const h=Us(d,e),m=new Float32Array(h.length);for(let g=0;g<h.length;g++){const w=h[g];m[g]=o==="and"?K_(u,w):X_(u,w)}return{kind:"series",value:m}}const r=Us(s,e),a=r.length,l=new Float32Array(a),c={series:e.series,scalars:e.scalars,strings:e.strings,draw:e.draw,diagnostics:e.diagnostics,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime,length:a,index:0};for(let u=0;u<a;u++){const d=r[u],h=r_(d);if(o==="and"&&h===0){l[u]=0;continue}if(o==="or"&&h===1){l[u]=1;continue}c.index=u;const m=ir(n.right,c);l[u]=o==="and"?K_(d,m):X_(d,m)}return{kind:"series",value:l}}function hv(n,e){const t=n.length,s=new Float32Array(t);let o=0,r=0;for(let a=0;a<t;a++){const l=n[a];if(Number.isFinite(l)&&(o+=l,r+=1),a>=e){const c=n[a-e];Number.isFinite(c)&&(o-=c,r-=1)}a>=e-1?s[a]=r>0?o/r:NaN:s[a]=NaN}return s}function hm(n,e){const t=n.length,s=new Float32Array(t),o=2/(e+1);let r;for(let a=0;a<t;a++){const l=n[a];if(!Number.isFinite(l)){s[a]=r===void 0?NaN:r;continue}if(r===void 0||!Number.isFinite(r)){r=l,s[a]=l;continue}r=l*o+r*(1-o),s[a]=r}return s}function Qw(n,e,t){const s=n.length,o=new Float32Array(s);let r=NaN;for(let a=0;a<s;a++){const l=n[a],c=e[a],f=t[a];let u=Math.max(0,l-c);Number.isFinite(r)&&(u=Math.max(u,Math.abs(l-r),Math.abs(c-r))),o[a]=u,r=f}return o}function z_(n,e){const t=n.length,s=new Float32Array(t);let o,r=0,a=0;for(let l=0;l<t;l++){const c=n[l];if(o===void 0){if(Number.isFinite(c)&&(r+=c,a+=1),a<e){s[l]=NaN;continue}o=r/e,s[l]=o;continue}Number.isFinite(c)&&(o=(o*(e-1)+c)/e),s[l]=o}return s}function US(n,e){const t=n.length,s=new Float32Array(t);let o,r=0,a=0,l=!1;const c=[],f=[];for(let u=0;u<t;u++){const d=n[u];if(!Number.isFinite(d)){s[u]=NaN;continue}if(o===void 0){o=d,s[u]=NaN;continue}if(!Number.isFinite(o)){o=d,s[u]=NaN;continue}const h=d-o;o=d;const m=h>0?h:0,g=h<0?-h:0;if(l)r=(r*(e-1)+m)/e,a=(a*(e-1)+g)/e;else{c.push(m),f.push(g);const w=c.length,C=Math.max(1,Math.min(e,w));r=c.reduce((M,P)=>M+P,0)/C,a=f.reduce((M,P)=>M+P,0)/C,w>=e&&(l=!0)}if(a===0)s[u]=100;else{const w=r/a;s[u]=100-100/(1+w)}}return s}function e6(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0;for(let f=o-e+1;f<=o;f++){const u=n[f];Number.isFinite(u)&&(r+=u,a+=1)}if(a<2){s[o]=NaN;continue}const l=r/a;let c=0;for(let f=o-e+1;f<=o;f++){const u=n[f];if(!Number.isFinite(u))continue;const d=u-l;c+=d*d}s[o]=Math.sqrt(c/a)}return s}function Hb(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=n[o-l],f=e-l;Number.isFinite(c)&&(r+=c*f,a+=f)}s[o]=a>0?r/a:NaN}return s}function Z$(n,e){const t=hm(n,e),s=hm(t,e),o=n.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=t[a],c=s[a];r[a]=Number.isFinite(l)&&Number.isFinite(c)?2*l-c:NaN}return r}function J$(n,e){const t=hm(n,e),s=hm(t,e),o=hm(s,e),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=t[l],f=s[l],u=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&Number.isFinite(u)?3*c-3*f+u:NaN}return a}function Q$(n,e){const t=Math.ceil((e+1)/2),s=Math.floor((e+1)/2);return hv(hv(n,t),s)}function eD(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=n[o-l];if(!Number.isFinite(c))continue;const f=Math.min(l+1,e-l);r+=c*f,a+=f}s[o]=a>0?r/a:NaN}return s}function tD(n,e){const t=Math.max(1,Math.floor(e/2)),s=Math.max(1,Math.round(Math.sqrt(e))),o=Hb(n,t),r=Hb(n,e),a=n.length,l=new Float32Array(a);for(let c=0;c<a;c++){const f=o[c],u=r[c];l[c]=Number.isFinite(f)&&Number.isFinite(u)?2*f-u:NaN}return Hb(l,s)}function nD(n,e,t,s){const o=n.length,r=new Float32Array(o),a=2/(t+1),l=2/(s+1);let c=NaN;for(let f=0;f<o;f++){const u=n[f];if(!Number.isFinite(u)||f<e){r[f]=NaN;continue}const d=n[f-e];if(!Number.isFinite(d)){r[f]=NaN;continue}let h=0,m=!0;for(let M=f-e+1;M<=f;M++){const P=n[M],T=n[M-1];if(!Number.isFinite(P)||!Number.isFinite(T)){m=!1;break}h+=Math.abs(P-T)}if(!m||h===0){r[f]=NaN;continue}const w=Math.abs(u-d)/h,C=Math.pow(w*(a-l)+l,2);Number.isFinite(c)||(c=u),c=c+C*(u-c),r[f]=c}return r}function sD(n,e,t,s){const o=n.length,r=new Float32Array(o),a=t*(e-1),l=e/s,c=[];for(let f=0;f<e;f++){const u=Math.exp(-((f-a)*(f-a))/(2*l*l));c.push(u)}for(let f=0;f<o;f++){if(f<e-1){r[f]=NaN;continue}let u=0,d=0;for(let h=0;h<e;h++){const m=n[f-e+1+h];if(!Number.isFinite(m))continue;const g=c[h];u+=m*g,d+=g}r[f]=d>0?u/d:NaN}return r}function oD(n,e,t){const s=hm(n,e),o=hm(s,e),r=hm(o,e),a=hm(r,e),l=hm(a,e),c=hm(l,e),f=t,u=f*f,d=u*f,h=-d,m=3*u+3*d,g=-6*u-3*f-3*d,w=1+3*f+d+3*u,C=n.length,M=new Float32Array(C);for(let P=0;P<C;P++){const T=r[P],N=l[P],L=c[P],O=a[P];M[P]=Number.isFinite(T)&&Number.isFinite(O)&&Number.isFinite(N)&&Number.isFinite(L)?h*L+m*N+g*O+w*T:NaN}return M}function t6(n,e,t,s){const o=Qw(n,e,t),r=o.length,a=new Float32Array(r);let l=0;for(let c=0;c<r;c++)l+=o[c],c===s-1?a[c]=l/s:c>=s?a[c]=(a[c-1]*(s-1)+o[c])/s:a[c]=NaN;return a}function iD(n,e,t,s){const o=t6(n,e,t,s),r=o.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=o[l],f=t[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&f!==0?c/f*100:NaN}return a}function rD(n,e){const t=n.length,s=new Float32Array(t),o=[],r=[];for(let a=0;a<t;a++){const l=n[a],c=a>0?n[a-1]:NaN;if(!Number.isFinite(l)||!Number.isFinite(c))o.push(0),r.push(0);else{const h=l-c;o.push(h>0?h:0),r.push(h<0?-h:0)}if(a<e){s[a]=NaN;continue}let f=0,u=0;for(let h=a-e+1;h<=a;h++)f+=o[h],u+=r[h];const d=f+u;s[a]=d===0?NaN:100*(f-u)/d}return s}function aD(n,e,t){const s=n.length,o=new Float32Array(s);for(let d=0;d<s;d++){const h=n[d],m=d>0?n[d-1]:NaN;o[d]=Number.isFinite(h)&&Number.isFinite(m)?h-m:NaN}const r=hm(o,e),a=hm(r,t),l=new Float32Array(s);for(let d=0;d<s;d++)l[d]=Math.abs(o[d]);const c=hm(l,e),f=hm(c,t),u=new Float32Array(s);for(let d=0;d<s;d++){const h=a[d],m=f[d];u[d]=Number.isFinite(h)&&Number.isFinite(m)&&m!==0?100*h/m:NaN}return u}function lD(n,e,t,s){const o=US(n,e),r=s1(o,e),a=o1(o,e),l=n.length,c=new Float32Array(l);for(let u=0;u<l;u++){const d=o[u],h=r[u],m=a[u],g=h-m;c[u]=Number.isFinite(d)&&Number.isFinite(g)&&g!==0?(d-m)/g*100:NaN}let f=c;return t&&t>1&&(f=hv(f,t)),s&&s>1&&(f=hv(f,s)),f}function cD(n,e,t){const s=hm(n,e),o=hm(n,t),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&f!==0?(c-f)/f*100:NaN}return a}function uD(n,e){const t=n.length,s=new Float32Array(t);for(let l=0;l<t;l++)s[l]=(n[l]+e[l])/2;const o=hv(s,5),r=hv(s,34),a=new Float32Array(t);for(let l=0;l<t;l++){const c=o[l],f=r[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?c-f:NaN}return a}function dD(n,e){const t=hm(n,e),s=hm(t,e),o=hm(s,e),r=n.length,a=new Float32Array(r);a[0]=NaN;for(let l=1;l<r;l++){const c=o[l-1],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&c!==0?(f/c-1)*100:NaN}return a}function fD(n,e){const t=hv(n,e),s=e6(n,e),o=n.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=t[a],c=s[a],f=n[a];r[a]=Number.isFinite(f)&&Number.isFinite(l)&&Number.isFinite(c)&&c!==0?(f-l)/c:NaN}return r}function pD(n,e,t,s){const o=t.length,r=new Float32Array(o);let a=0;for(let l=0;l<o;l++){const c=n[l],f=e[l],u=t[l],d=s[l];if(!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)){r[l]=NaN;continue}const h=c-f,m=Number.isFinite(h)&&h!==0?(2*u-c-f)/h:0;Number.isFinite(d)&&(a+=m*d),r[l]=a}return r}function mD(n,e,t,s,o){const r=t.length,a=new Float32Array(r);for(let u=0;u<r;u++){const d=n[u],h=e[u],m=t[u],g=s[u];if(!Number.isFinite(d)||!Number.isFinite(h)||!Number.isFinite(m)){a[u]=NaN;continue}const w=d-h,C=Number.isFinite(w)&&w!==0?(2*m-d-h)/w:0;a[u]=Number.isFinite(g)?C*g:NaN}const l=Zv(a,o),c=Zv(s,o),f=new Float32Array(r);for(let u=0;u<r;u++){const d=l[u],h=c[u];f[u]=Number.isFinite(d)&&Number.isFinite(h)&&h!==0?d/h:NaN}return f}function hD(n,e,t,s,o){const r=t.length,a=t6(n,e,t,s),l=new Float32Array(r),c=new Float32Array(r);let f=NaN,u=NaN,d=!0;for(let h=0;h<r;h++){const m=n[h],g=e[h],w=t[h],C=a[h];if(!Number.isFinite(m)||!Number.isFinite(g)||!Number.isFinite(C)){l[h]=NaN,c[h]=NaN;continue}const M=(m+g)/2,P=M+o*C,T=M-o*C;if(f=Number.isFinite(f)?Math.min(P,f):P,u=Number.isFinite(u)?Math.max(T,u):T,!Number.isFinite(w)){l[h]=NaN,c[h]=NaN;continue}d?w<u?(d=!1,f=P,l[h]=f,c[h]=-1):(l[h]=u,c[h]=1):w>f?(d=!0,u=T,l[h]=u,c[h]=1):(l[h]=f,c[h]=-1)}return{line:l,dir:c}}function vD(n,e,t,s,o){const r=hm(t,s),a=t6(n,e,t,s),l=t.length,c=new Float32Array(l),f=new Float32Array(l);for(let u=0;u<l;u++){const d=r[u],h=a[u];c[u]=Number.isFinite(d)&&Number.isFinite(h)?d+o*h:NaN,f[u]=Number.isFinite(d)&&Number.isFinite(h)?d-o*h:NaN}return{mid:r,upper:c,lower:f}}function gD(n,e,t){const s=s1(n,t),o=o1(e,t),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?(c+f)/2:NaN}return{upper:s,lower:o,mid:a}}function _D(n,e,t,s,o){const r=n.length,a=new Float32Array(r);if(!r)return a;let l=!0;r>1&&Number.isFinite(n[1])&&Number.isFinite(n[0])&&(l=n[1]>=n[0]);let c=t,f=l?n[0]:e[0],u=l?e[0]:n[0];a[0]=u;for(let d=1;d<r;d++){const h=n[d],m=e[d];if(!Number.isFinite(h)||!Number.isFinite(m)){a[d]=NaN;continue}if(u=u+c*(f-u),l){const g=e[d-1],w=d>1?e[d-2]:g;Number.isFinite(g)&&(u=Math.min(u,g)),Number.isFinite(w)&&(u=Math.min(u,w)),m<u?(l=!1,u=f,f=m,c=t):h>f&&(f=h,c=Math.min(c+s,o))}else{const g=n[d-1],w=d>1?n[d-2]:g;Number.isFinite(g)&&(u=Math.max(u,g)),Number.isFinite(w)&&(u=Math.max(u,w)),h>u?(l=!0,u=f,f=h,c=t):m<f&&(f=m,c=Math.min(c+s,o))}a[d]=u}return a}function yD(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0,l=!0;for(let c=0;c<e;c++){const f=n[o-c];if(!Number.isFinite(f)){l=!1;break}const u=c+1;r+=f,a+=f*u}if(!l||r===0){s[o]=NaN;continue}s[o]=-(a/r)+(e+1)/2}return s}function bD(n,e,t,s,o,r){const a=s1(n,s),l=o1(e,s),c=t.length,f=new Float32Array(c);for(let m=0;m<c;m++){const g=t[m],w=a[m],C=l[m],M=w-C;f[m]=Number.isFinite(g)&&Number.isFinite(w)&&Number.isFinite(C)&&M!==0?(g-C)/M*100:NaN}const u=hv(f,o),d=hv(u,r),h=new Float32Array(c);for(let m=0;m<c;m++){const g=u[m],w=d[m];h[m]=Number.isFinite(g)&&Number.isFinite(w)?3*g-2*w:NaN}return{k:u,d,j:h}}function xD(n,e,t,s,o,r,a,l,c,f){const u=Y1(n,e),d=Y1(n,t),h=Y1(n,s),m=Y1(n,o),g=hv(u,r),w=hv(d,a),C=hv(h,l),M=hv(m,c),P=n.length,T=new Float32Array(P);for(let L=0;L<P;L++){const O=g[L],D=w[L],$=C[L],z=M[L];T[L]=Number.isFinite(O)&&Number.isFinite(D)&&Number.isFinite($)&&Number.isFinite(z)?O+2*D+3*$+4*z:NaN}const N=hv(T,f);return{kst:T,signal:N}}function wD(n,e,t,s,o,r){const a=t.length,l=new Float32Array(a),c=new Float32Array(a);let f=NaN;for(let M=0;M<a;M++){const P=n[M],T=e[M],N=t[M];if(!Number.isFinite(P)||!Number.isFinite(T)||!Number.isFinite(N)){l[M]=NaN,c[M]=NaN,f=N;continue}const L=Math.min(T,Number.isFinite(f)?f:T),O=Math.max(P,Number.isFinite(f)?f:P);l[M]=N-L,c[M]=O-L,f=N}const u=Zv(l,s),d=Zv(l,o),h=Zv(l,r),m=Zv(c,s),g=Zv(c,o),w=Zv(c,r),C=new Float32Array(a);for(let M=0;M<a;M++){const P=u[M],T=d[M],N=h[M],L=m[M],O=g[M],D=w[M];if(!Number.isFinite(P)||!Number.isFinite(T)||!Number.isFinite(N)||!Number.isFinite(L)||!Number.isFinite(O)||!Number.isFinite(D)||L===0||O===0||D===0){C[M]=NaN;continue}const $=P/L,z=T/O,te=N/D;C[M]=100*(4*$+2*z+te)/7}return C}function kD(n,e,t){const s=hv(n,e),o=e6(n,e),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=s[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&c!==0?2*t*f/c:NaN}return a}function SD(n,e,t){const s=n.length,o=new Float32Array(s);let r=t;o[0]=r;for(let a=1;a<s;a++){const l=n[a],c=n[a-1],f=e[a],u=e[a-1];if(!Number.isFinite(l)||!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)||c===0){o[a]=r;continue}f>u&&(r=r+(l-c)/c*r),o[a]=r}return o}function CD(n,e,t){const s=n.length,o=new Float32Array(s);let r=t;o[0]=r;for(let a=1;a<s;a++){const l=n[a],c=n[a-1],f=e[a],u=e[a-1];if(!Number.isFinite(l)||!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)||c===0){o[a]=r;continue}f<u&&(r=r+(l-c)/c*r),o[a]=r}return o}function ID(n,e,t,s){const o=t.length,r=new Float32Array(o),a=new Float32Array(o);for(let m=0;m<o;m++){if(m===0){r[m]=NaN,a[m]=NaN;continue}const g=n[m],w=e[m],C=n[m-1],M=e[m-1];r[m]=Number.isFinite(g)&&Number.isFinite(M)?Math.abs(g-M):NaN,a[m]=Number.isFinite(w)&&Number.isFinite(C)?Math.abs(w-C):NaN}const l=Qw(n,e,t),c=Zv(r,s),f=Zv(a,s),u=Zv(l,s),d=new Float32Array(o),h=new Float32Array(o);for(let m=0;m<o;m++){const g=c[m],w=f[m],C=u[m];d[m]=Number.isFinite(g)&&Number.isFinite(C)&&C!==0?g/C:NaN,h[m]=Number.isFinite(w)&&Number.isFinite(C)&&C!==0?w/C:NaN}return{plus:d,minus:h}}function s1(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){let r=-1/0,a=!1;const l=Math.max(0,o-e+1);for(let c=l;c<=o;c++){const f=n[c];Number.isFinite(f)&&(a=!0,f>r&&(r=f))}s[o]=a?r:NaN}return s}function o1(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){let r=1/0,a=!1;const l=Math.max(0,o-e+1);for(let c=l;c<=o;c++){const f=n[c];Number.isFinite(f)&&(a=!0,f<r&&(r=f))}s[o]=a?r:NaN}return s}function GS(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=-1/0,a=NaN;for(let l=0;l<e;l++){const c=o-l,f=n[c];Number.isFinite(f)&&f>r&&(r=f,a=l)}s[o]=Number.isFinite(a)?a:NaN}return s}function YS(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=1/0,a=NaN;for(let l=0;l<e;l++){const c=o-l,f=n[c];Number.isFinite(f)&&f<r&&(r=f,a=l)}s[o]=Number.isFinite(a)?a:NaN}return s}function PD(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){s[o]=NaN;continue}let r=0,a=0,l=0;const c=o-e+1;for(let d=c;d<=o;d++){const h=n[d];Number.isFinite(h)&&(r+=h,a+=h*h,l+=1)}if(l<2){s[o]=NaN;continue}const f=r/l,u=a/l-f*f;s[o]=Number.isFinite(u)?u:NaN}return s}function MD(n,e,t){const s=n.length,o=new Float32Array(s);for(let r=0;r<s;r++){if(r<t-1){o[r]=NaN;continue}let a=0,l=0,c=0,f=0,u=0,d=0;const h=r-t+1;for(let T=h;T<=r;T++){const N=n[T],L=e[T];!Number.isFinite(N)||!Number.isFinite(L)||(a+=N,l+=L,c+=N*N,f+=L*L,u+=N*L,d+=1)}if(d<2){o[r]=NaN;continue}const m=a/d,g=l/d,w=u/d-m*g,C=c/d-m*m,M=f/d-g*g,P=Math.sqrt(C*M);o[r]=P>0?w/P:NaN}return o}function ND(n,e,t){const s=n.length,o=new Float32Array(s),r=Math.max(1,Math.floor(e)),a=Math.floor(t),l=(r-1)*r/2,c=(r-1)*r*(2*r-1)/6,f=r*c-l*l;for(let u=0;u<s;u++){if(u<r-1||f===0){o[u]=NaN;continue}let d=0,h=0,m=0;for(let M=0;M<r;M++){const P=u-(r-1-M),T=n[P];Number.isFinite(T)&&(d+=T,h+=T*M,m+=1)}if(m<2){o[u]=NaN;continue}const g=(r*h-l*d)/f,w=(d-g*l)/r,C=r-1+a;o[u]=w+g*C}return o}function KS(n,e){var f;const t=e.funcRuntime;if(t){const u=t.funcs.get(n.callee.toLowerCase());if(u){const d=e.length,h=new Float32Array(d),m={series:e.series,scalars:e.scalars,strings:e.strings,diagnostics:e.diagnostics,draw:e.draw,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime,length:d,index:0};for(let g=0;g<d;g++)m.index=g,h[g]=ZS(u,n,m);return{kind:"series",value:h}}}const s=((f=e.scalars)==null?void 0:f.__pinev2)===1,o=o6(n.callee.toLowerCase(),s),r=s6(o);if(r){if(!e.draw)return{kind:"scalar",value:NaN};const u=n.args[0];let d="";if(u&&u.kind==="Identifier"&&(d=u.name),u&&u.kind==="StringLiteral"&&(d=u.value),!d)return{kind:"scalar",value:NaN};const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=e.draw.get(r.kind,r.prop,d,g);typeof w=="string"?m[g]=gv(w):typeof w=="number"&&Number.isFinite(w)?m[g]=w:m[g]=NaN}return{kind:"series",value:m}}const a=n.args.map(u=>n0(u,e)),l=JS(o);if(l){if(!e.strategy)return{kind:"scalar",value:NaN};if(!a.length)throw new kt(`${n.callee} expects (index)`);const u=Us(a[0],e),d=e.length,h=new Float32Array(d);for(let m=0;m<d;m++){const g=u[m],w=Number.isFinite(g)?Math.floor(g):NaN;if(!Number.isFinite(w)){h[m]=NaN;continue}h[m]=QS(e,l.kind,l.prop,m,w)}return{kind:"series",value:h}}const c=()=>{if(a.length!==2)throw new kt(`${o} expects (series, period)`);const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1])));return[u,d]};switch(o){case"__hist_index":case"__arr_index":{if(a.length!==1)throw new kt(`${n.callee} expects (index)`);const u=a[0];if(!s)return u;const d=o==="__hist_index"?"history_index":"array_index",h=o==="__hist_index"?ry:bS;if(u.kind==="scalar")return{kind:"scalar",value:X0(u.value,d,h,e)};const m=Us(u,e),g=new Float32Array(e.length);for(let w=0;w<g.length;w++)g[w]=X0(m[w],d,h,e);return{kind:"series",value:g}}case"__arr_index_str":{if(a.length!==1)throw new kt(`${n.callee} expects (index)`);const u=a[0];if(!s)return u;const d=`arr_idx_str:${Sd(n)}`;if(u.kind==="scalar")return{kind:"scalar",value:p2(u.value,d,e)};const h=Us(u,e),m=new Float32Array(e.length);for(let g=0;g<m.length;g++)m[g]=p2(h[g],d,e);return{kind:"series",value:m}}case"__arr_set_guard":{if(a.length!==2)throw new kt(`${n.callee} expects (index, size)`);if(!s)return{kind:"scalar",value:1};const u=a[0],d=a[1],h=`arr_set_guard:${Sd(n)}`;if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:mw(u.value,d.value,h,e)};const m=Us(u,e),g=Us(d,e),w=new Float32Array(e.length);for(let C=0;C<w.length;C++)w[C]=mw(m[C],g[C],h,e);return{kind:"series",value:w}}case"__arr_str_valid":{if(a.length!==1)throw new kt(`${n.callee} expects (value)`);if(!s)return{kind:"scalar",value:1};const u=s0(n.args[0]);return u||Cd(e,`arr_str_val:${Sd(n)}`,xS),{kind:"scalar",value:u?1:0}}case"__str_num":{if(a.length!==1)throw new kt(`${n.callee} expects (value)`);return a[0]}case"iff":case"iif":case"if":{if(a.length!==3)throw new kt(`${n.callee} expects (cond, a, b)`);const u=a[0],d=a[1],h=a[2],m=n.args[0];if(s){const $=n1(n.args[1]),z=n1(n.args[2]);if($!==z){if(Cd(e,"ternary_type",yS),u.kind==="scalar"&&d.kind==="scalar"&&h.kind==="scalar")return{kind:"scalar",value:NaN};const te=new Float32Array(e.length);return te.fill(NaN),{kind:"series",value:te}}}const g=s&&s0(m),w=s?Q0(m,e,"na"):void 0;g&&Cd(e,Q0(m,e,"type"),d2);const C=u.kind==="series",M=d.kind==="series",P=h.kind==="series";if(!C&&!M&&!P){const $=u.value;return g?{kind:"scalar",value:h.value}:{kind:"scalar",value:fw($,e,w)?d.value:h.value}}const T=Us(u,e),N=Us(d,e),L=Us(h,e),O=e.length,D=new Float32Array(O);for(let $=0;$<O;$++){if(g){D[$]=L[$];continue}const z=T[$],te=fw(z,e,w);D[$]=te?N[$]:L[$]}return{kind:"series",value:D}}case"nz":{if(a.length<1||a.length>2)throw new kt("nz expects (series[, fallback])");const u=a[0],d=a[1]??{kind:"scalar",value:0};if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Number.isFinite(u.value)?u.value:d.value};const h=Us(u,e),m=Us(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++){const M=h[C];w[C]=Number.isFinite(M)?M:m[C]}return{kind:"series",value:w}}case"between":{if(a.length!==3)throw new kt("between expects (x, a, b)");const u=Us(a[0],e),d=Us(a[1],e),h=Us(a[2],e),m=e.length,g=new Float32Array(m);for(let w=0;w<m;w++){const C=u[w],M=d[w],P=h[w];if(!Number.isFinite(C)||!Number.isFinite(M)||!Number.isFinite(P)){g[w]=s?NaN:0;continue}const T=Math.min(M,P),N=Math.max(M,P);g[w]=C>=T&&C<=N?1:0}return{kind:"series",value:g}}case"above":case"below":{if(a.length<2||a.length>3)throw new kt(`${o} expects (a, b[, tol])`);const u=Us(a[0],e),d=Us(a[1],e),h=a[2]?Us(a[2],e):null,m=e.length,g=new Float32Array(m);for(let w=0;w<m;w++){const C=u[w],M=d[w],P=h?h[w]:0,T=Number.isFinite(P)?Math.max(0,P):0;if(!Number.isFinite(C)||!Number.isFinite(M)){g[w]=s?NaN:0;continue}g[w]=o==="above"?C>M+T?1:0:C<M-T?1:0}return{kind:"series",value:g}}case"higherhigh":{const u=a.length?Math.max(1,Math.floor(ii(a[0]))):1,d=e.series.high;if(!d)throw new kt("higherhigh requires high series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}const C=Math.max(0,g-u),M=aS(d,C,Math.max(0,g-1));m[g]=w>M?1:0}return{kind:"series",value:m}}case"lowerlow":{const u=a.length?Math.max(1,Math.floor(ii(a[0]))):1,d=e.series.low;if(!d)throw new kt("lowerlow requires low series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}const C=Math.max(0,g-u),M=lS(d,C,Math.max(0,g-1));m[g]=w<M?1:0}return{kind:"series",value:m}}case"swinghigh":{const u=a.length?Math.max(1,Math.floor(ii(a[0]))):3,d=e.series.high;if(!d)throw new kt("swinghigh requires high series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}let C=!0;for(let M=g-u;M<=g+u;M++){if(M===g||M<0||M>=h)continue;const P=d[M];if(Number.isFinite(P)&&P>=w){C=!1;break}}m[g]=C?1:0}return{kind:"series",value:m}}case"swinglow":{const u=a.length?Math.max(1,Math.floor(ii(a[0]))):3,d=e.series.low;if(!d)throw new kt("swinglow requires low series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++){const w=d[g];if(!Number.isFinite(w)){m[g]=s?NaN:0;continue}let C=!0;for(let M=g-u;M<=g+u;M++){if(M===g||M<0||M>=h)continue;const P=d[M];if(Number.isFinite(P)&&P<=w){C=!1;break}}m[g]=C?1:0}return{kind:"series",value:m}}case"volspike":{const u=a.length?Math.max(1,ii(a[0])):1,d=e.series.volume;if(!d)throw new kt("volspike requires volume series");const h=e.length,m=new Float32Array(h),g=20;for(let w=0;w<h;w++){const C=d[w];if(!Number.isFinite(C)){m[w]=s?NaN:0;continue}const M=Math.max(0,w-g+1);let P=0,T=0;for(let L=M;L<=w;L++){const O=d[L];Number.isFinite(O)&&(P+=O,T+=1)}const N=T?P/T:NaN;m[w]=Number.isFinite(N)&&C>u*N?1:0}return{kind:"series",value:m}}case"atrspike":{const u=a.length?Math.max(1,ii(a[0])):1,d=e.series.high,h=e.series.low,m=e.series.close;if(!d||!h||!m)throw new kt("atrspike requires high/low/close series");const g=e.length,w=new Float32Array(g),C=14,M=P=>{const T=d[P],N=h[P],L=P>0?m[P-1]:NaN;let O=Number.isFinite(T)&&Number.isFinite(N)?Math.max(0,T-N):NaN;return Number.isFinite(L)&&(O=Math.max(O,Math.abs(T-L),Math.abs(N-L))),O};for(let P=0;P<g;P++){let T=NaN,N=0;for(let $=0;$<=P;$++){const z=M($);N+=Number.isFinite(z)?z:0,$===C-1?T=N/C:$>=C&&(T=(T*(C-1)+z)/C)}let L=NaN,O=0,D=0;for(let $=Math.max(0,P-C+1);$<=P;$++){const z=M($);Number.isFinite(z)&&(O+=z,D+=1)}D&&(L=O/D),w[P]=Number.isFinite(T)&&Number.isFinite(L)&&T>u*L?1:0}return{kind:"series",value:w}}case"trend":{const u=n.args[0],d=u&&u.kind==="StringLiteral"?u.value:u&&u.kind==="Identifier"?u.name:"",h=String(d||"").toLowerCase()||"up",m=e.series.close;if(!m)throw new kt("trend requires close series");const g=e.length,w=new Float32Array(g),C=10;for(let M=0;M<g;M++){const P=Math.max(0,M-C+1);let T=0,N=0,L=0,O=0,D=0;for(let te=P;te<=M;te++){const pe=te-P,J=m[te];Number.isFinite(J)&&(T+=pe,N+=J,L+=pe*pe,O+=pe*J,D+=1)}const $=D*L-T*T,z=$===0||D===0?0:(D*O-T*N)/$;w[M]=h==="up"?z>0?1:0:z<0?1:0}return{kind:"series",value:w}}case"add":case"sub":case"mul":case"div":{if(a.length!==2)throw new kt(`${o} expects 2 arguments`);const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar"){const C=u.value,M=d.value;return o==="add"?{kind:"scalar",value:C+M}:o==="sub"?{kind:"scalar",value:C-M}:o==="mul"?{kind:"scalar",value:C*M}:{kind:"scalar",value:x_(C,M,s,e)}}const h=Us(u,e),m=Us(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++){const M=h[C],P=m[C];o==="add"?w[C]=M+P:o==="sub"?w[C]=M-P:o==="mul"?w[C]=M*P:w[C]=x_(M,P,s,e)}return{kind:"series",value:w}}case"mod":case"fmod":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new kt(`${n.callee} expects 2 arguments`);const u=a[0],d=a[1],h=o==="mod"?RS:DS;if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:h(u.value,d.value,!0,e)};const m=Us(u,e),g=Us(d,e);return{kind:"series",value:gb(m,g,(w,C)=>h(w,C,!0,e))}}case"pow":{if(a.length!==2)throw new kt("pow expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:pw(u.value,d.value,s,e)};const h=Us(u,e),m=Us(d,e);return{kind:"series",value:gb(h,m,(g,w)=>pw(g,w,s,e))}}case"sqrt":case"log":case"ln":case"log10":case"exp":case"floor":case"ceil":case"round":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"sign":{if(a.length!==1)throw new kt(`${o} expects 1 argument`);const u=o==="sqrt"?h=>jS(h,s,e):o==="log"||o==="ln"?h=>BS(h,s,e):o==="log10"?h=>OS(h,s,e):o==="exp"?h=>HS(h,s):o==="floor"?Math.floor:o==="ceil"?Math.ceil:o==="round"?Math.round:o==="sin"?Math.sin:o==="cos"?Math.cos:o==="tan"?h=>WS(h,s):o==="asin"?h=>zS(h,s,e):o==="acos"?h=>VS(h,s,e):o==="atan"?Math.atan:Math.sign,d=a[0];return d.kind==="scalar"?{kind:"scalar",value:u(d.value)}:{kind:"series",value:B1(Us(d,e),u)}}case"todegrees":case"toradians":{if(a.length!==1)throw new kt(`${o} expects 1 argument`);const u=a[0],d=o==="todegrees"?180/Math.PI:Math.PI/180;return u.kind==="scalar"?{kind:"scalar",value:u.value*d}:{kind:"series",value:B1(Us(u,e),h=>h*d)}}case"atan2":{if(a.length!==2)throw new kt("atan2 expects (y, x)");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.atan2(u.value,d.value)};const h=Us(u,e),m=Us(d,e);return{kind:"series",value:gb(h,m,(g,w)=>Math.atan2(g,w))}}case"avg":{if(a.length!==2)throw new kt("avg expects (a, b)");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:(u.value+d.value)/2};const h=Us(u,e),m=Us(d,e);return{kind:"series",value:gb(h,m,(g,w)=>(g+w)/2)}}case"clamp":{if(a.length!==3)throw new kt("clamp expects (x, min, max)");const u=a[0],d=a[1],h=a[2],m=(T,N,L)=>Math.min(L,Math.max(N,T));if(u.kind==="scalar"&&d.kind==="scalar"&&h.kind==="scalar")return{kind:"scalar",value:m(u.value,d.value,h.value)};const g=Us(u,e),w=Us(d,e),C=Us(h,e),M=e.length,P=new Float32Array(M);for(let T=0;T<M;T++)P[T]=m(g[T],w[T],C[T]);return{kind:"series",value:P}}case"cum":case"cumsum":{if(a.length!==1)throw new kt(`${o} expects 1 argument`);const u=Us(a[0],e),d=e.length,h=new Float32Array(d);let m=0;for(let g=0;g<d;g++){const w=u[g];Number.isFinite(w)&&(m+=w),h[g]=m}return{kind:"series",value:h}}case"barssince":{if(a.length!==1)throw new kt("barssince expects (condition)");const u=Us(a[0],e),d=e.length,h=new Float32Array(d);let m=NaN;for(let g=0;g<d;g++){const w=u[g];Number.isFinite(w)&&w!==0?(m=0,h[g]=0):Number.isFinite(m)?(m+=1,h[g]=m):h[g]=NaN}return{kind:"series",value:h}}case"sma":{const[u,d]=c();return{kind:"series",value:hv(u,d)}}case"wma":{const[u,d]=c();return{kind:"series",value:Hb(u,d)}}case"ema":{const[u,d]=c();return{kind:"series",value:hm(u,d)}}case"smma":{const[u,d]=c();return{kind:"series",value:z_(u,d)}}case"rsi":{const[u,d]=c();return{kind:"series",value:US(u,d)}}case"rma":{const[u,d]=c();return{kind:"series",value:z_(u,d)}}case"dema":{const[u,d]=c();return{kind:"series",value:Z$(u,d)}}case"tema":{const[u,d]=c();return{kind:"series",value:J$(u,d)}}case"trima":{const[u,d]=c();return{kind:"series",value:Q$(u,d)}}case"swma":{const[u,d]=c();return{kind:"series",value:eD(u,d)}}case"hma":{const[u,d]=c();return{kind:"series",value:tD(u,d)}}case"kama":{if(a.length<2||a.length>4)throw new kt("kama expects (series, period[, fast, slow])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=a[2]?Math.max(1,Math.floor(ii(a[2]))):2,m=a[3]?Math.max(1,Math.floor(ii(a[3]))):30;return{kind:"series",value:nD(u,d,h,m)}}case"alma":{if(a.length<2||a.length>4)throw new kt("alma expects (series, period[, offset, sigma])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=a[2]?ii(a[2]):.85,m=a[3]?Math.max(.1,ii(a[3])):6;return{kind:"series",value:sD(u,d,h,m)}}case"t3":{if(a.length<2||a.length>3)throw new kt("t3 expects (series, period[, factor])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=a[2]?ii(a[2]):.7;return{kind:"series",value:oD(u,d,h)}}case"cmo":{const[u,d]=c();return{kind:"series",value:rD(u,d)}}case"tsi":{if(a.length!==3)throw new kt("tsi expects (series, long, short)");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=Math.max(1,Math.floor(ii(a[2])));return{kind:"series",value:aD(u,d,h)}}case"stochrsi":{if(a.length<2||a.length>4)throw new kt("stochrsi expects (series, length[, smoothK, smoothD])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=a[2]?Math.max(1,Math.floor(ii(a[2]))):0,m=a[3]?Math.max(1,Math.floor(ii(a[3]))):0;return{kind:"series",value:lD(u,d,h||void 0,m||void 0)}}case"ppo":{if(a.length!==3)throw new kt("ppo expects (series, fast, slow)");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=Math.max(1,Math.floor(ii(a[2])));return{kind:"series",value:cD(u,d,h)}}case"cog":{if(a.length!==1&&a.length!==2)throw new kt("cog expects (length) or (series, length)");const u=a.length===1?e.series.close:Us(a[0],e);if(!u)throw new kt("cog requires a source series");const d=Math.max(1,Math.floor(ii(a[a.length===1?0:1])));return{kind:"series",value:bg(e,`cog:${d}:${Sd(n)}`,()=>yD(u,d))}}case"bbw":{if(a.length!==2&&a.length!==3)throw new kt("bbw expects (length, mult) or (series, length, mult)");const u=a.length===2?e.series.close:Us(a[0],e);if(!u)throw new kt("bbw requires a source series");const d=Math.max(1,Math.floor(ii(a[a.length===2?0:1]))),h=ii(a[a.length===2?1:2]);return{kind:"series",value:bg(e,`bbw:${d}:${Sd(n)}`,()=>kD(u,d,h))}}case"uo":{if(a.length!==3&&a.length!==6)throw new kt("uo expects (len1, len2, len3) or (high, low, close, len1, len2, len3)");const u=a.length===6?Us(a[0],e):e.series.high,d=a.length===6?Us(a[1],e):e.series.low,h=a.length===6?Us(a[2],e):e.series.close;if(!u||!d||!h)throw new kt("uo requires high/low/close series");const m=Math.max(1,Math.floor(ii(a[a.length===6?3:0]))),g=Math.max(1,Math.floor(ii(a[a.length===6?4:1]))),w=Math.max(1,Math.floor(ii(a[a.length===6?5:2])));return{kind:"series",value:bg(e,`uo:${m}:${g}:${w}:${Sd(n)}`,()=>wD(u,d,h,m,g,w))}}case"pvi":case"nvi":{if(a.length!==0&&a.length!==2&&a.length!==3)throw new kt(`${n.callee} expects () or (close, volume[, start])`);const u=a.length?Us(a[0],e):e.series.close,d=a.length?Us(a[1],e):e.series.volume,h=a.length===3?ii(a[2]):1e3;if(!u||!d)throw new kt(`${n.callee} requires close/volume series`);const m=`${o}:${Sd(n)}`;return{kind:"series",value:bg(e,m,()=>o==="pvi"?SD(u,d,h):CD(u,d,h))}}case"kdj":{const u=a.length===6||a.length===7,d=a.length===3||a.length===4;if(!u&&!d)throw new kt("kdj expects (len, smoothK, smoothD[, output]) or (high, low, close, len, smoothK, smoothD[, output])");const h=u,m=h?Us(a[0],e):e.series.high,g=h?Us(a[1],e):e.series.low,w=h?Us(a[2],e):e.series.close;if(!m||!g||!w)throw new kt("kdj requires high/low/close series");const C=h?3:0,M=Math.max(1,Math.floor(ii(a[C+0]))),P=Math.max(1,Math.floor(ii(a[C+1]))),T=Math.max(1,Math.floor(ii(a[C+2]))),N=a[C+3]?Math.floor(ii(a[C+3])):0;if(!Number.isFinite(N)||N<0||N>2)throw new kt("kdj output must be 0, 1, or 2");const L=`kdj:${M}:${P}:${T}:${Sd(n)}`,O=qb(e,L,()=>{const $=bD(m,g,w,M,P,T);return{a:$.k,b:$.d,c:$.j}});return{kind:"series",value:N===0?O.a:N===1?O.b:O.c}}case"kst":{if(a.length<9||a.length>11)throw new kt("kst expects (src, r1, r2, r3, r4, n1, n2, n3, n4[, signal, output])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=Math.max(1,Math.floor(ii(a[2]))),m=Math.max(1,Math.floor(ii(a[3]))),g=Math.max(1,Math.floor(ii(a[4]))),w=Math.max(1,Math.floor(ii(a[5]))),C=Math.max(1,Math.floor(ii(a[6]))),M=Math.max(1,Math.floor(ii(a[7]))),P=Math.max(1,Math.floor(ii(a[8]))),T=a[9]?Math.max(1,Math.floor(ii(a[9]))):9,N=a[10]?Math.floor(ii(a[10])):0;if(!Number.isFinite(N)||N<0||N>1)throw new kt("kst output must be 0 or 1");const L=`kst:${d}:${h}:${m}:${g}:${w}:${C}:${M}:${P}:${T}:${Sd(n)}`,O=m2(e,L,()=>{const D=xD(u,d,h,m,g,w,C,M,P,T);return{a:D.kst,b:D.signal}});return{kind:"series",value:N===0?O.a:O.b}}case"vortex":{const u=a.length===4||a.length===5,d=a.length===1||a.length===2;if(!u&&!d)throw new kt("vortex expects (length[, output]) or (high, low, close, length[, output])");const h=u,m=h?Us(a[0],e):e.series.high,g=h?Us(a[1],e):e.series.low,w=h?Us(a[2],e):e.series.close;if(!m||!g||!w)throw new kt("vortex requires high/low/close series");const C=h?3:0,M=Math.max(1,Math.floor(ii(a[C]))),P=a[C+1]?Math.floor(ii(a[C+1])):0;if(!Number.isFinite(P)||P<0||P>1)throw new kt("vortex output must be 0 or 1");const T=`vortex:${M}:${Sd(n)}`,N=m2(e,T,()=>{const L=ID(m,g,w,M);return{a:L.plus,b:L.minus}});return{kind:"series",value:P===0?N.a:N.b}}case"linreg":{if(a.length<2||a.length>3)throw new kt("linreg expects (series, period[, offset])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=a[2]?Math.floor(ii(a[2])):0;return{kind:"series",value:ND(u,d,h)}}case"tr":case"trange":case"true_range":{if(a.length!==0&&a.length!==3)throw new kt("tr expects () or (high, low, close)");const u=a.length===3?Us(a[0],e):e.series.high,d=a.length===3?Us(a[1],e):e.series.low,h=a.length===3?Us(a[2],e):e.series.close;if(!u||!d||!h)throw new kt("tr requires high/low/close series");const m=e.length,g=new Float32Array(m);let w=NaN;for(let C=0;C<m;C++){const M=u[C],P=d[C],T=h[C];let N=Math.max(0,M-P);Number.isFinite(w)&&(N=Math.max(N,Math.abs(M-w),Math.abs(P-w))),g[C]=N,w=T}return{kind:"series",value:g}}case"atr":{if(a.length!==1&&a.length!==4)throw new kt("atr expects (length) or (high, low, close, length)");const u=ii(a[a.length===1?0:3]),d=s?Gp(u,`atr_len:${Sd(n)}`,H$,e):Math.max(1,Math.floor(u));if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=a.length===1?e.series.high:Us(a[0],e),m=a.length===1?e.series.low:Us(a[1],e),g=a.length===1?e.series.close:Us(a[2],e);if(!h||!m||!g)throw new kt("atr requires high/low/close series");const w=e.length,C=Qw(h,m,g),M=new Float32Array(w);let P=0;for(let T=0;T<w;T++)P+=C[T],T===d-1?M[T]=P/d:T>=d?M[T]=(M[T-1]*(d-1)+C[T])/d:M[T]=NaN;return{kind:"series",value:M}}case"atrp":case"natr":{if(a.length!==1&&a.length!==4)throw new kt(`${n.callee} expects (length) or (high, low, close, length)`);const u=ii(a[a.length===1?0:3]),d=Math.max(1,Math.floor(u));if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=a.length===1?e.series.high:Us(a[0],e),m=a.length===1?e.series.low:Us(a[1],e),g=a.length===1?e.series.close:Us(a[2],e);if(!h||!m||!g)throw new kt(`${n.callee} requires high/low/close series`);return{kind:"series",value:iD(h,m,g,d)}}case"stdev":case"stddev":case"dev":{const[u,d]=c();return{kind:"series",value:e6(u,d)}}case"variance":case"var":{const[u,d]=c();return{kind:"series",value:PD(u,d)}}case"zscore":{const[u,d]=c();return{kind:"series",value:fD(u,d)}}case"correlation":case"corr":{if(a.length!==3)throw new kt(`${n.callee} expects (a, b, period)`);const u=Us(a[0],e),d=Us(a[1],e),h=Math.max(1,Math.floor(ii(a[2])));return{kind:"series",value:MD(u,d,h)}}case"highest":{if(!s){const[m,g]=c();return{kind:"series",value:s1(m,g)}}if(a.length!==2)throw new kt("highest expects (series, period)");const u=Us(a[0],e),d=ii(a[1]),h=Gp(d,`highest_len:${Sd(n)}`,TS,e);return Number.isFinite(h)?{kind:"series",value:s1(u,h)}:{kind:"series",value:Uv(e.length)}}case"highestbars":{const[u,d]=c();return{kind:"series",value:GS(u,d)}}case"lowest":{if(!s){const[m,g]=c();return{kind:"series",value:o1(m,g)}}if(a.length!==2)throw new kt("lowest expects (series, period)");const u=Us(a[0],e),d=ii(a[1]),h=Gp(d,`lowest_len:${Sd(n)}`,FS,e);return Number.isFinite(h)?{kind:"series",value:o1(u,h)}:{kind:"series",value:Uv(e.length)}}case"lowestbars":{const[u,d]=c();return{kind:"series",value:YS(u,d)}}case"sum":{if(!s){const[m,g]=c();return{kind:"series",value:Zv(m,g)}}if(a.length!==2)throw new kt("sum expects (series, period)");const u=Us(a[0],e),d=ii(a[1]),h=Gp(d,`sum_len:${Sd(n)}`,LS,e);if(!Number.isFinite(h)){const m=new Float32Array(e.length);return m.fill(NaN),{kind:"series",value:m}}return{kind:"series",value:Zv(u,h)}}case"rising":case"falling":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new kt(`${n.callee} expects (series, length)`);const u=Us(a[0],e),d=ii(a[1]),h=`${o}_len:${Sd(n)}`,g=Gp(d,h,o==="rising"?ES:$S,e);if(!Number.isFinite(g)){const w=new Float32Array(e.length);return w.fill(NaN),{kind:"series",value:w}}return{kind:"series",value:rS(u,g,o)}}case"lag":{if(a.length!==2)throw new kt("lag expects (series, n)");const u=Us(a[0],e),d=ii(a[1]);if(s){const m=X0(d,"history_index",ry,e);if(!Number.isFinite(m)){const g=new Float32Array(e.length);return g.fill(NaN),{kind:"series",value:g}}return{kind:"series",value:yb(u,m)}}const h=Math.max(1,Math.floor(d));return{kind:"series",value:yb(u,h)}}case"prev":{if(a.length<1||a.length>2)throw new kt("prev expects (series[, n])");const u=Us(a[0],e),d=ii(a[1]??{kind:"scalar",value:1});if(s){const m=X0(d,"history_index",ry,e);if(!Number.isFinite(m)){const g=new Float32Array(e.length);return g.fill(NaN),{kind:"series",value:g}}return{kind:"series",value:yb(u,m)}}const h=Math.max(1,Math.floor(d));return{kind:"series",value:yb(u,h)}}case"change":{if(a.length<1||a.length>2)throw new kt("change expects (series[, n])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:T$(u,d)}}case"roc":{if(a.length<1||a.length>2)throw new kt("roc expects (series[, n])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:Y1(u,d)}}case"mom":case"momentum":{if(a.length<1||a.length>2)throw new kt("mom expects (series[, n])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:F$(u,d)}}case"crossover":case"crossunder":{if(a.length<2||a.length>3)throw new kt(`${n.callee} expects (series, series[, tol])`);const u=Us(a[0],e),d=a[1],h=d.kind==="series",m=Us(d,e),g=a[2]?Math.max(0,ii(a[2])):0,w=e.length,C=new Float32Array(w);C[0]=0;for(let M=1;M<w;M++){const P=u[M-1],T=u[M],N=h?m[M-1]:m[0],L=h?m[M]:m[0];if(![P,T,N,L].every(Number.isFinite)){C[M]=0;continue}o==="crossover"?C[M]=P<=N+g&&T>L+g?1:0:C[M]=P>=N-g&&T<L-g?1:0}return{kind:"series",value:C}}case"hl2":{if(a.length!==0)throw new kt("hl2 expects no arguments");const u=e.series.high,d=e.series.low;if(!u||!d)throw new kt("hl2 requires high/low series");const h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++)m[g]=(u[g]+d[g])/2;return{kind:"series",value:m}}case"hlc3":{if(a.length!==0)throw new kt("hlc3 expects no arguments");const u=e.series.high,d=e.series.low,h=e.series.close;if(!u||!d||!h)throw new kt("hlc3 requires high/low/close series");const m=e.length,g=new Float32Array(m);for(let w=0;w<m;w++)g[w]=(u[w]+d[w]+h[w])/3;return{kind:"series",value:g}}case"ohlc4":{if(a.length!==0)throw new kt("ohlc4 expects no arguments");const u=e.series.open,d=e.series.high,h=e.series.low,m=e.series.close;if(!u||!d||!h||!m)throw new kt("ohlc4 requires open/high/low/close series");const g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++)w[C]=(u[C]+d[C]+h[C]+m[C])/4;return{kind:"series",value:w}}case"vwap":{if(a.length!==0&&a.length!==2)throw new kt("vwap expects () or (close, volume)");const u=a.length===0?e.series.close:Us(a[0],e),d=a.length===0?e.series.volume:Us(a[1],e);if(!u||!d)throw new kt("vwap requires close/volume series");const h=a.length===0?e.series.high:void 0,m=a.length===0?e.series.low:void 0,g=a.length===0?e.series.time:void 0;if(a.length===0&&(!h||!m))throw new kt("vwap requires high/low/close series");const w=e.length,C=new Float32Array(w);let M=0,P=0,T=Number.NaN;for(let N=0;N<w;N++){if(a.length===0&&g){const D=g[N];if(Number.isFinite(D)){const $=Math.floor(D/864e5);(!Number.isFinite(T)||$!==T)&&(M=0,P=0,T=$)}}const L=d[N],O=a.length===0?(h[N]+m[N]+u[N])/3:u[N];if(!Number.isFinite(O)||!Number.isFinite(L)){C[N]=NaN;continue}M+=O*L,P+=L,C[N]=P===0?NaN:M/P}return{kind:"series",value:C}}case"vwma":{if(a.length!==3)throw new kt("vwma expects (close, volume, period)");const u=Us(a[0],e),d=Us(a[1],e),h=Math.max(1,Math.floor(ii(a[2]))),m=e.length,g=new Float32Array(m);let w=0,C=0;for(let M=0;M<m;M++){const P=u[M],T=d[M];if(Number.isFinite(P)&&Number.isFinite(T)&&(w+=P*T,C+=T),M>=h){const N=u[M-h],L=d[M-h];Number.isFinite(N)&&Number.isFinite(L)&&(w-=N*L,C-=L)}g[M]=M>=h-1&&C!==0?w/C:NaN}return{kind:"series",value:g}}case"evwma":{if(a.length!==3)throw new kt("evwma expects (close, volume, period)");const u=Us(a[0],e),d=Us(a[1],e),h=Math.max(1,Math.floor(ii(a[2]))),m=iS(_g(u),_g(d),h);return{kind:"series",value:g0(m)}}case"bbands":case"bollinger":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length<3||a.length>4)throw new kt("bbands expects (series, period, mult[, output])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=ii(a[2]),m=a[3]?Math.floor(ii(a[3])):0;if(!Number.isFinite(m)||m<0||m>2)throw new kt("bbands output must be 0, 1, or 2");const g=ow(_g(u),d,h),w=m===0?g.mid:m===1?g.upper:g.lower;return{kind:"series",value:g0(w)}}case"keltner":case"kc":{if(a.length<2||a.length>6)throw new kt("keltner expects (period, mult[, output]) or (high, low, close, period, mult[, output])");let u,d,h,m=0,g=1,w=2;if(a.length>=5?(u=Us(a[0],e),d=Us(a[1],e),h=Us(a[2],e),m=3,g=4,w=5):(u=e.series.high,d=e.series.low,h=e.series.close),!u||!d||!h)throw new kt("keltner requires high/low/close series");const C=Math.max(1,Math.floor(ii(a[m]))),M=ii(a[g]),P=a[w]?Math.floor(ii(a[w])):0;if(!Number.isFinite(P)||P<0||P>2)throw new kt("keltner output must be 0, 1, or 2");const T=vD(u,d,h,C,M);return{kind:"series",value:P===0?T.mid:P===1?T.upper:T.lower}}case"donchian":{if(a.length<1||a.length>4)throw new kt("donchian expects (period[, output]) or (high, low, period[, output])");let u,d,h=0,m=1;if(a.length>=3?(u=Us(a[0],e),d=Us(a[1],e),h=2,m=3):(u=e.series.high,d=e.series.low),!u||!d)throw new kt("donchian requires high/low series");const g=Math.max(1,Math.floor(ii(a[h]))),w=a[m]?Math.floor(ii(a[m])):0;if(!Number.isFinite(w)||w<0||w>2)throw new kt("donchian output must be 0, 1, or 2");const C=gD(u,d,g);return{kind:"series",value:w===0?C.upper:w===1?C.lower:C.mid}}case"supertrend":{if(a.length<2||a.length>3)throw new kt("supertrend expects (factor, period[, output])");const u=ii(a[0]),d=Math.max(1,Math.floor(ii(a[1]))),h=a[2]?Math.floor(ii(a[2])):0;if(!Number.isFinite(h)||h<0||h>1)throw new kt("supertrend output must be 0 or 1");const m=e.series.high,g=e.series.low,w=e.series.close;if(!m||!g||!w)throw new kt("supertrend requires high/low/close series");const C=hD(m,g,w,d,u);return{kind:"series",value:h===0?C.line:C.dir}}case"sar":{if(a.length!==0&&a.length!==3)throw new kt("sar expects () or (start, increment, maximum)");const u=a.length===3?ii(a[0]):.02,d=a.length===3?ii(a[1]):.02,h=a.length===3?ii(a[2]):.2,m=e.series.high,g=e.series.low;if(!m||!g)throw new kt("sar requires high/low series");return{kind:"series",value:_D(m,g,u,d,h)}}case"macd":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length<4||a.length>5)throw new kt("macd expects (series, fast, slow, signal[, output])");const u=Us(a[0],e),d=Math.max(1,Math.floor(ii(a[1]))),h=Math.max(1,Math.floor(ii(a[2]))),m=Math.max(1,Math.floor(ii(a[3]))),g=a[4]?Math.floor(ii(a[4])):0;if(!Number.isFinite(g)||g<0||g>2)throw new kt("macd output must be 0, 1, or 2");const w=L$(u,d,h,m);return{kind:"series",value:g===0?w.line:g===1?w.signal:w.hist}}case"stoch":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length<5||a.length>6)throw new kt("stoch expects (high, low, close, k, d[, output])");const u=Us(a[0],e),d=Us(a[1],e),h=Us(a[2],e),m=Math.max(1,Math.floor(ii(a[3]))),g=Math.max(1,Math.floor(ii(a[4]))),w=a[5]?Math.floor(ii(a[5])):0;if(!Number.isFinite(w)||w<0||w>1)throw new kt("stoch output must be 0 or 1");const C=E$(u,d,h,m,g);return{kind:"series",value:w===0?C.k:C.d}}case"ao":{if(a.length!==0&&a.length!==2)throw new kt("ao expects () or (high, low)");const u=a.length===2?Us(a[0],e):e.series.high,d=a.length===2?Us(a[1],e):e.series.low;if(!u||!d)throw new kt("ao requires high/low series");return{kind:"series",value:uD(u,d)}}case"trix":{const[u,d]=c();return{kind:"series",value:dD(u,d)}}case"williamsr":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1&&a.length!==4)throw new kt("williamsr expects (length) or (high, low, close, length)");const u=a.length===1?ii(a[0]):ii(a[3]),d=Gp(u,"williamsr_len",wS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=a.length===1?e.series.high:Us(a[0],e),m=a.length===1?e.series.low:Us(a[1],e),g=a.length===1?e.series.close:Us(a[2],e);if(!h||!m||!g)throw new kt("williamsr requires high/low/close series");return{kind:"series",value:cS(h,m,g,d)}}case"aroon":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length<1||a.length>2)throw new kt("aroon expects (length[, output])");const u=ii(a[0]),d=Gp(u,"aroon_len",kS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=a[1]?Math.floor(ii(a[1])):0;if(!Number.isFinite(h)||h<0||h>1)throw new kt("aroon output must be 0 or 1");const m=e.series.high,g=e.series.low;if(!m||!g)throw new kt("aroon requires high/low series");const w=c2(m,g,d);return{kind:"series",value:h===0?w.up:w.down}}case"aroonosc":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new kt("aroonosc expects (length)");const u=ii(a[0]),d=Gp(u,"aroonosc_len",AS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=e.series.high,m=e.series.low;if(!h||!m)throw new kt("aroonosc requires high/low series");return{kind:"series",value:$$(h,m,d)}}case"dmi":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length<2||a.length>3)throw new kt("dmi expects (length, smoothing[, output])");const u=ii(a[0]),d=ii(a[1]),h=Gp(u,"dmi_len",SS,e),m=Gp(d,"dmi_smooth",CS,e);if(!Number.isFinite(h)||!Number.isFinite(m))return{kind:"series",value:Uv(e.length)};const g=a[2]?Math.floor(ii(a[2])):0;if(!Number.isFinite(g)||g<0||g>2)throw new kt("dmi output must be 0, 1, or 2");const w=e.series.high,C=e.series.low,M=e.series.close;if(!w||!C||!M)throw new kt("dmi requires high/low/close series");const P=K0(w,C,M,h,m);return{kind:"series",value:g===0?P.plus:g===1?P.minus:P.adx}}case"plus_di":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new kt("plus_di expects (length)");const u=ii(a[0]),d=Gp(u,"plus_di_len",PS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new kt("plus_di requires high/low/close series");return{kind:"series",value:K0(h,m,g,d,d).plus}}case"minus_di":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new kt("minus_di expects (length)");const u=ii(a[0]),d=Gp(u,"minus_di_len",MS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new kt("minus_di requires high/low/close series");return{kind:"series",value:K0(h,m,g,d,d).minus}}case"dx":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new kt("dx expects (length)");const u=ii(a[0]),d=Gp(u,"dx_len",NS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new kt("dx requires high/low/close series");const w=K0(h,m,g,d,d);return{kind:"series",value:uS(w.plus,w.minus)}}case"adx":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new kt("adx expects (length)");const u=ii(a[0]),d=Gp(u,"adx_len",IS,e);if(!Number.isFinite(d))return{kind:"series",value:Uv(e.length)};const h=e.series.high,m=e.series.low,g=e.series.close;if(!h||!m||!g)throw new kt("adx requires high/low/close series");return{kind:"series",value:K0(h,m,g,d,d).adx}}case"valuewhen":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==3)throw new kt("valuewhen expects (condition, source, occurrence)");const u=n.args[0],d=s0(u);d&&Cd(e,Q0(u,e,"type"),d2);const h=`valuewhen_occ:${Sd(n)}`;if(a[2].kind!=="scalar")return Cd(e,h,f2),{kind:"series",value:Uv(e.length)};const m=X0(a[2].value,h,f2,e);if(!Number.isFinite(m)||d)return{kind:"series",value:Uv(e.length)};const g=Us(a[0],e),w=Us(a[1],e),C=Q0(u,e,"na");return{kind:"series",value:dS(g,w,m,T=>y0(T,e.diagnostics,C))}}case"pivothigh":case"pivotlow":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==3)throw new kt(`${n.callee} expects (source, left, right)`);const u=ii(a[1]),d=ii(a[2]),{left:h,right:m}=fS(u,d),g=Us(a[0],e);return{kind:"series",value:D$(g,h,m,o==="pivothigh"?"high":"low")}}case"year":case"month":case"dayofweek":case"hour":case"minute":case"second":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1)throw new kt(`${n.callee} expects (time)`);const u=a[0];if(u.kind==="scalar"){if(Y0(u.value),o==="dayofweek")return{kind:"scalar",value:rw(u.value)};const m=o==="year"||o==="month"?o:o==="hour"?"hour":o==="minute"?"minute":"second";return{kind:"scalar",value:aw(u.value,m)}}const d=Us(u,e);if(Ik(d),o==="dayofweek")return{kind:"series",value:B1(d,rw)};const h=o==="year"||o==="month"?o:o==="hour"?"hour":o==="minute"?"minute":"second";return{kind:"series",value:B1(d,m=>aw(m,h))}}case"timestamp":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length<5||a.length>6)throw new kt("timestamp expects (year, month, day, hour, minute[, second])");const u=a.length===6?a[5]:{kind:"scalar",value:0};if([a[0],a[1],a[2],a[3],a[4],u].every(N=>(N==null?void 0:N.kind)==="scalar")){const N=a[0].value,L=a[1].value,O=a[2].value,D=a[3].value,$=a[4].value,z=u.value;return{kind:"scalar",value:hS(N,L,O,D,$,z)}}const h=Us(a[0],e),m=Us(a[1],e),g=Us(a[2],e),w=Us(a[3],e),C=Us(a[4],e),M=Us(u,e);[h,m,g,w,C,M].forEach(Ik);const P=e.length,T=new Float32Array(P);for(let N=0;N<P;N++){const L=h[N],O=m[N],D=g[N],$=w[N],z=C[N],te=M[N];if(![L,O,D,$,z,te].every(Number.isFinite)){T[N]=NaN;continue}if(O<1||O>12)throw new kt(mS);T[N]=Date.UTC(L,O-1,D,$,z,te)}return{kind:"series",value:T}}case"timenow":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==0)throw new kt("timenow expects ()");return{kind:"scalar",value:gS(e)}}case"time_close":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==0)throw new kt("time_close expects ()");const u=e.series.time;if(!u)throw new kt("time_close requires time series");const d=vS(e);return{kind:"series",value:B1(u,h=>Number.isFinite(h)?h+d:NaN)}}case"isin":case"session_isin":case"session.isin":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new kt("session.isin expects (time, session)");const u=n.args[1];if(!u||u.kind!=="StringLiteral")throw new kt(u2);const{start:d,end:h}=_S(u.value),m=a[0];if(m.kind==="scalar"){const C=m.value;if(!Number.isFinite(C))throw new kt(lw);const M=cw(C);return{kind:"scalar",value:uw(M,d,h)?1:0}}const g=Us(m,e),w=new Float32Array(g.length);for(let C=0;C<g.length;C++){const M=g[C];if(!Number.isFinite(M))throw new kt(lw);const P=cw(M);w[C]=uw(P,d,h)?1:0}return{kind:"series",value:w}}case"cci":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==4)throw new kt("cci expects (high, low, close, period)");const u=Us(a[0],e),d=Us(a[1],e),h=Us(a[2],e),m=Math.max(1,Math.floor(ii(a[3]))),g=nS(_g(u),_g(d),_g(h),m);return{kind:"series",value:g0(g)}}case"mfi":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==5)throw new kt("mfi expects (high, low, close, volume, period)");const u=Us(a[0],e),d=Us(a[1],e),h=Us(a[2],e),m=Us(a[3],e),g=Math.max(1,Math.floor(ii(a[4]))),w=sS(_g(u),_g(d),_g(h),_g(m),g);return{kind:"series",value:g0(w)}}case"obv":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==2)throw new kt("obv expects (close, volume)");const u=Us(a[0],e),d=Us(a[1],e),h=tS(_g(u),_g(d));return{kind:"series",value:g0(h)}}case"ad":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==0&&a.length!==4)throw new kt("ad expects () or (high, low, close, volume)");const u=a.length===4?Us(a[0],e):e.series.high,d=a.length===4?Us(a[1],e):e.series.low,h=a.length===4?Us(a[2],e):e.series.close,m=a.length===4?Us(a[3],e):e.series.volume;if(!u||!d||!h||!m)throw new kt("ad requires high/low/close/volume series");return{kind:"series",value:pD(u,d,h,m)}}case"cmf":{if(!s)throw new kt(`Unknown function "${n.callee}"`);if(a.length!==1&&a.length!==5)throw new kt("cmf expects (length) or (high, low, close, volume, length)");const u=Math.max(1,Math.floor(ii(a[a.length===1?0:4]))),d=a.length===5?Us(a[0],e):e.series.high,h=a.length===5?Us(a[1],e):e.series.low,m=a.length===5?Us(a[2],e):e.series.close,g=a.length===5?Us(a[3],e):e.series.volume;if(!d||!h||!m||!g)throw new kt("cmf requires high/low/close/volume series");return{kind:"series",value:mD(d,h,m,g,u)}}case"min":{if(a.length!==2)throw new kt("min expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.min(u.value,d.value)};const h=Us(u,e),m=Us(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++)w[C]=Math.min(h[C],m[C]);return{kind:"series",value:w}}case"max":{if(a.length!==2)throw new kt("max expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.max(u.value,d.value)};const h=Us(u,e),m=Us(d,e),g=e.length,w=new Float32Array(g);for(let C=0;C<g;C++)w[C]=Math.max(h[C],m[C]);return{kind:"series",value:w}}case"abs":{if(a.length!==1)throw new kt("abs expects 1 argument");const u=a[0];if(u.kind==="scalar")return{kind:"scalar",value:Math.abs(u.value)};const d=u.value,h=e.length,m=new Float32Array(h);for(let g=0;g<h;g++)m[g]=Math.abs(d[g]);return{kind:"series",value:m}}default:throw new kt(`Unknown function "${n.callee}"`)}}function n0(n,e){var t,s;switch(n.kind){case"NumberLiteral":return{kind:"scalar",value:n.value};case"StringLiteral":return{kind:"scalar",value:gv(n.value)};case"Identifier":{const o=n.name.replace(/\s+/g,"_").toLowerCase();if(o==="na"||o==="nan")return{kind:"scalar",value:NaN};if(o==="pi")return{kind:"scalar",value:Math.PI};if(o==="e")return{kind:"scalar",value:Math.E};const r=e.series[o];if(r)return{kind:"series",value:r};const a=(t=e.scalars)==null?void 0:t[o];if(typeof a=="number"&&Number.isFinite(a))return{kind:"scalar",value:a};throw e.seriesNames.has(o)?new kt(`Series "${n.name}" is used before it is defined (circular or forward reference)`):new kt(`Unknown identifier "${n.name}"`)}case"MemberExpression":{const o=k_(n);return o?n0({kind:"Identifier",name:o},e):(Zw(e,n),{kind:"scalar",value:NaN})}case"IndexExpression":return Jw(e,n),{kind:"scalar",value:NaN};case"UnaryExpression":{const o=n0(n.expr,e);if(n.operator==="not"){const r=((s=e.scalars)==null?void 0:s.__pinev2)===1;if(o.kind==="scalar"){const c=o.value;return{kind:"scalar",value:r?dw(c):Number.isFinite(c)&&c!==0?0:1}}const a=o.value,l=new Float32Array(a.length);for(let c=0;c<a.length;c++){const f=a[c];l[c]=r?dw(f):Number.isFinite(f)&&f!==0?0:1}return{kind:"series",value:l}}throw new kt("Unsupported unary operator")}case"BinaryExpression":return n.operator==="and"||n.operator==="or"?X$(n,e):qS(n.operator,n0(n.left,e),n0(n.right,e),e);case"CallExpression":return KS(n,e);default:throw new kt("Unsupported expression node")}}function g_(n,e,t,s,o,r){var $;const a=new Set;for(const z of n){const te=z.name.replace(/\s+/g,"_").toLowerCase();a.add(te)}const l=Object.entries(e),c=(($=l[0])==null?void 0:$[1].length)??0;for(const[,z]of l)if(z.length!==c)throw new kt("All base series must have the same length");const f=n.map(z=>{try{const te=Ap(z.expr);return{name:z.name.replace(/\s+/g,"_").toLowerCase(),expr:z.expr,ast:te}}catch(te){throw te instanceof Qv?new kt(`Syntax error in series "${z.name}" at position ${te.position}: ${te.message}`):te}}),u=(()=>{if(!t||typeof t!="object")return;const z={};return Object.entries(t).forEach(([te,pe])=>{const J=te.replace(/\s+/g,"_").toLowerCase();if(typeof pe=="number"&&Number.isFinite(pe)){z[J]=pe;return}if(typeof pe=="string"){const le=Number(pe);z[J]=Number.isFinite(le)?le:gv(pe)}}),Object.keys(z).length?z:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const z={};return Object.entries(t).forEach(([te,pe])=>{typeof pe=="string"&&(z[te.replace(/\s+/g,"_").toLowerCase()]=pe)}),Object.keys(z).length?z:void 0})(),h=L2(r==null?void 0:r.loopPlans,u,!!(r!=null&&r.userFunctions)),m=E2(r==null?void 0:r.userFunctions),g={length:c,series:{...e},seriesNames:a,scalars:u,diagnostics:o,strategy:s,strings:d,loopRuntime:h,funcRuntime:m},w={},C=z=>{const te=new Set,pe=J=>{switch(J.kind){case"Identifier":{const le=J.name.replace(/\s+/g,"_").toLowerCase();te.add(le);break}case"MemberExpression":{const le=k_(J);if(le){const de=le.replace(/\s+/g,"_").toLowerCase();te.add(de);break}pe(J.object);break}case"IndexExpression":pe(J.object),pe(J.index);break;case"BinaryExpression":pe(J.left),pe(J.right);break;case"UnaryExpression":pe(J.expr);break;case"CallExpression":J.args.forEach(le=>pe(le));break}};return pe(z),te},M=new Set(f.map(z=>z.name)),P={},T={};f.forEach(z=>{P[z.name]=new Set,T[z.name]=new Set}),f.forEach(z=>{C(z.ast).forEach(pe=>{M.has(pe)&&pe!==z.name&&(P[z.name].add(pe),T[pe].add(z.name))})});const N={};Object.keys(P).forEach(z=>{var te;N[z]=((te=P[z])==null?void 0:te.size)??0});const L=Object.keys(N).filter(z=>(N[z]||0)===0),O=[];for(;L.length;){const z=L.shift();O.push(z);for(const te of T[z]||[])N[te]=(N[te]||0)-1,N[te]===0&&L.push(te)}if(O.length!==f.length){const z=f.map(te=>te.name).filter(te=>!O.includes(te));throw new kt(`Circular dependency detected among series: ${z.join(" -> ")}`)}const D={};f.forEach(z=>{D[z.name]=z});for(const z of O){const te=D[z];if(g.series[te.name])throw new kt(`Series name "${te.name}" conflicts with an existing base series`);const pe=n0(te.ast,g),J=Us(pe,g);g.series[te.name]=J,w[te.name]=J}return w}const bg=(n,e,t)=>{if(!n.memo)return t();const s=n.memo.get(e);if(s)return s;const o=t();return n.memo.set(e,o),o},q0=(n,e)=>{if(n.kind==="Identifier"){const t=n.name.replace(/\s+/g,"_").toLowerCase();return e.series[t]??null}if(n.kind==="MemberExpression"){const t=k_(n);if(!t)return null;const s=t.replace(/\s+/g,"_").toLowerCase();return e.series[s]??null}if(n.kind==="NumberLiteral")return bg(e,`const:${n.value}`,()=>{const t=new Float32Array(e.length);return t.fill(n.value),t});if(n.kind==="StringLiteral"){const t=gv(n.value);return bg(e,`const_str:${n.value}`,()=>{const s=new Float32Array(e.length);return s.fill(t),s})}return null},m2=(n,e,t)=>{if(!n.memo)return t();const s=`${e}:a`,o=n.memo.get(s);if(o)return{a:o,b:n.memo.get(`${e}:b`)};const r=t();return n.memo.set(s,r.a),n.memo.set(`${e}:b`,r.b),r},qb=(n,e,t)=>{if(!n.memo)return t();const s=`${e}:a`,o=n.memo.get(s);if(o)return{a:o,b:n.memo.get(`${e}:b`),c:n.memo.get(`${e}:c`)};const r=t();return n.memo.set(s,r.a),n.memo.set(`${e}:b`,r.b),n.memo.set(`${e}:c`,r.c),r};function Ak(n,e){var r;const t=n.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.locals&&Object.prototype.hasOwnProperty.call(e.locals,t))return e.locals[t];if(e.selfKey&&e.selfOut&&t===e.selfKey){if(e.selfMode==="current"){const l=e.selfOut[e.index];if(Number.isFinite(l))return l}const a=e.index-1;return a>=0?e.selfOut[a]:NaN}const s=e.series[t];if(s)return s[e.index]??NaN;const o=(r=e.scalars)==null?void 0:r[t];if(typeof o=="number"&&Number.isFinite(o))return o;throw new kt(`Unknown identifier "${n}"`)}const n6=1e3,AD=1e6,XS=(n,e,t)=>{if(!Number.isFinite(n)||!Number.isFinite(e)||!Number.isFinite(t)||t===0)return null;if(t>0){if(n>e)return 0;const s=(e-n)/t;return Math.floor(s+1+1e-12)}if(t<0){if(n<e)return 0;const s=(n-e)/Math.abs(t);return Math.floor(s+1+1e-12)}return null},nv=(n,e)=>{try{return Ap(n)}catch(t){throw t instanceof Qv?new kt(`Syntax error in ${e} at position ${t.position}: ${t.message}`):t}},Ub=n=>n.map(e=>e.kind==="assign"?{kind:"assign",name:e.name,expr:nv(e.expr,`loop assignment "${e.name}"`),lineNo:e.lineNo}:e.kind==="if"?{kind:"if",lineNo:e.lineNo,branches:e.branches.map(t=>({cond:t.cond?nv(t.cond,"loop if condition"):void 0,body:Ub(t.body),lineNo:t.lineNo}))}:e.kind==="for"?{kind:"for",lineNo:e.lineNo,varName:e.varName,startExpr:nv(e.startExpr,"loop for start"),endExpr:nv(e.endExpr,"loop for end"),stepExpr:nv(e.stepExpr,"loop for step"),body:Ub(e.body)}:e.kind==="while"?{kind:"while",lineNo:e.lineNo,condExpr:nv(e.condExpr,"loop while condition"),body:Ub(e.body)}:{kind:e.kind,lineNo:e.lineNo}),hw=(n,e)=>{for(const t of n){if(t.kind==="assign"){e.add(t.name);continue}if(t.kind==="if"){t.branches.forEach(s=>hw(s.body,e));continue}(t.kind==="for"||t.kind==="while")&&hw(t.body,e)}},TD=n=>{const e=Ub(n.body||[]),t=new Set;return hw(e,t),{id:n.id,kind:n.kind,lineNo:n.lineNo,varName:n.varName,startExpr:n.startExpr?nv(n.startExpr,"loop start"):void 0,endExpr:n.endExpr?nv(n.endExpr,"loop end"):void 0,stepExpr:n.stepExpr?nv(n.stepExpr,"loop step"):void 0,condExpr:n.condExpr?nv(n.condExpr,"loop condition"):void 0,body:e,targets:Array.from(t)}},L2=(n,e,t)=>{if((!n||!n.length)&&!t)return;const s=e==null?void 0:e.__loop_max_iters,o=typeof s=="number"&&Number.isFinite(s),r=o&&s<=0?Number.POSITIVE_INFINITY:o?Math.min(AD,Math.max(1,Math.floor(s))):n6,a=new Map;return(n||[]).forEach(l=>{if(!l||typeof l!="object")return;const c=String(l.id||"").trim();c&&a.set(c,TD(l))}),{plans:a,maxIters:r,hasCustomMax:o,running:new Set}},Gb=n=>n.map(e=>e.kind==="assign"?{kind:"assign",name:e.name,op:e.op,decl:e.decl,expr:nv(e.expr,`function assignment "${e.name}"`),lineNo:e.lineNo}:e.kind==="return"?{kind:"return",expr:nv(e.expr,"function return"),lineNo:e.lineNo}:e.kind==="if"?{kind:"if",lineNo:e.lineNo,branches:e.branches.map(t=>({cond:t.cond?nv(t.cond,"function if condition"):void 0,body:Gb(t.body),lineNo:t.lineNo}))}:e.kind==="for"?{kind:"for",lineNo:e.lineNo,varName:e.varName,startExpr:nv(e.startExpr,"function for start"),endExpr:nv(e.endExpr,"function for end"),stepExpr:nv(e.stepExpr,"function for step"),body:Gb(e.body)}:e.kind==="while"?{kind:"while",lineNo:e.lineNo,condExpr:nv(e.condExpr,"function while condition"),body:Gb(e.body)}:{kind:e.kind,lineNo:e.lineNo}),vw=(n,e)=>{for(const t of n){if(t.kind==="assign"){if(t.decl==="var"||t.decl==="varip"){const s=t.name.replace(/\s+/g,"_").toLowerCase();e.add(s)}continue}if(t.kind==="if"){t.branches.forEach(s=>vw(s.body,e));continue}(t.kind==="for"||t.kind==="while")&&vw(t.body,e)}},FD=n=>{const e=Gb(n.body||[]),t=new Set;return vw(e,t),{name:n.name,args:n.args||[],lineNo:n.lineNo,body:e,statefulVars:t}},E2=n=>{if(!n||!n.length)return;const e=new Map;return n.forEach(t=>{if(!t||typeof t!="object")return;const s=String(t.name||"").trim();if(s)try{e.set(s.toLowerCase(),FD(t))}catch{}}),{funcs:e,callState:new WeakMap,running:new Set}},V_=(n,e,t,s,o)=>ir(n,{...e,locals:t,selfKey:s,selfOut:o,selfMode:"current"}),gw=(n,e,t)=>{for(const s of n){if(s.kind==="assign"){const o=s.name.replace(/\s+/g,"_").toLowerCase();let r=e.series[o];r||(r=new Float32Array(e.length),r.fill(NaN),e.series[o]=r);const a=V_(s.expr,e,t,o,r);r[e.index]=a;continue}if(s.kind==="break")return"break";if(s.kind==="continue")return"continue";if(s.kind==="if"){let o=!1;for(const r of s.branches){if(o)break;if(r.cond){const l=V_(r.cond,e,t);if(!y0(l,e.diagnostics,`loop_cond_na:${s.lineNo}`))continue}o=!0;const a=gw(r.body,e,t);if(a!=="none")return a}continue}if(s.kind==="for"){h2({kind:"for",varName:s.varName,startExpr:s.startExpr,endExpr:s.endExpr,stepExpr:s.stepExpr,body:s.body,lineNo:s.lineNo},e,t);continue}if(s.kind==="while"){h2({kind:"while",condExpr:s.condExpr,body:s.body,lineNo:s.lineNo},e,t);continue}}return"none"},h2=(n,e,t)=>{const s=e.loopRuntime,o=(s==null?void 0:s.maxIters)??n6,r=(s==null?void 0:s.hasCustomMax)??!1,a=`loop_max:${n.lineNo}`,l=`Loop exceeded max iterations (${o})`;if(n.kind==="for"){const u=Object.prototype.hasOwnProperty.call(t,n.varName)?t[n.varName]:void 0,d=V_(n.startExpr,e,t),h=V_(n.endExpr,e,t),m=V_(n.stepExpr,e,t);if(!Number.isFinite(m)||m===0){Cd(e,`loop_step_zero:${n.lineNo}`,"for-loop step must not be 0");return}const g=XS(d,h,m),w=Number.isFinite(o)?o:null;let C=null,M=!1;r&&w!=null?g==null?(C=w,M=!0):(C=Math.min(w,g),M=g>w):g!=null&&(C=g);const P=m>0;let T=d,N=0;for(;(C==null||N<C)&&!(!Number.isFinite(T)||!Number.isFinite(h)||P&&T>h+1e-12||!P&&T<h-1e-12);){t[n.varName]=T;const L=gw(n.body,e,t);if(L==="break")break;T+=m,N+=1}M&&C!=null&&N>=C&&Cd(e,a,l),u===void 0?delete t[n.varName]:t[n.varName]=u;return}let c=0;const f=Number.isFinite(o)?o:null;for(;f==null||c<f;){const u=V_(n.condExpr,e,t);if(!y0(u,e.diagnostics,`loop_cond_na:${n.lineNo}`))break;const h=gw(n.body,e,t);if(h==="break")break;c+=1}f!=null&&c>=f&&Cd(e,a,l)},LD=(n,e)=>{const t=e.locals?{...e.locals}:{},s=e.scalars??{};n.targets.forEach(r=>{const a=r.replace(/\s+/g,"_").toLowerCase();let l=e.series[a];l||(l=new Float32Array(e.length),l.fill(NaN),e.series[a]=l);const c=l[e.index];if(Number.isFinite(c))return;const f=s[a];if(typeof f=="number"&&Number.isFinite(f)){l[e.index]=f;return}if(e.index>0){const u=l[e.index-1];Number.isFinite(u)&&(l[e.index]=u)}}),n.kind==="for"?n.varName&&n.startExpr&&n.endExpr&&n.stepExpr&&h2({kind:"for",varName:n.varName,startExpr:n.startExpr,endExpr:n.endExpr,stepExpr:n.stepExpr,body:n.body,lineNo:n.lineNo??0},{...e,locals:t},t):n.condExpr&&h2({kind:"while",condExpr:n.condExpr,body:n.body,lineNo:n.lineNo??0},{...e,locals:t},t);const o={};return n.targets.forEach(r=>{const a=r.replace(/\s+/g,"_").toLowerCase(),l=e.series[a];o[a]=l?l[e.index]??NaN:NaN}),o},v_=(n,e,t)=>ir(n,{...e,locals:t,selfMode:"current"}),v2=(n,e,t,s,o,r)=>{const a=(l,c)=>Cd(e,l,c);for(const l of n){if(l.kind==="assign"){const c=l.name.replace(/\s+/g,"_").toLowerCase(),f=v_(l.expr,e,t);l.decl==="var"||l.decl==="varip"||o.has(c)?l.decl&&l.op==="="?(s.inited.has(c)||(s.vars[c]=f,s.inited.add(c)),t[c]=s.vars[c]??NaN):(!s.inited.has(c)&&l.op===":="&&a(`fn_var_uninit:${c}`,`Function var "${l.name}" is used before initialization`),s.vars[c]=f,s.inited.add(c),t[c]=f):(l.op===":="&&!Object.prototype.hasOwnProperty.call(t,c)&&a(`fn_local_uninit:${c}`,`Function local "${l.name}" is used before initialization`),t[c]=f);continue}if(l.kind==="return")return{kind:"return",value:v_(l.expr,e,t)};if(l.kind==="break"){if(!r){a(`fn_break_outside:${l.lineNo}`,"break used outside of a loop");continue}return{kind:"break"}}if(l.kind==="continue"){if(!r){a(`fn_continue_outside:${l.lineNo}`,"continue used outside of a loop");continue}return{kind:"continue"}}if(l.kind==="if"){let c=!1;for(const f of l.branches){if(c)break;if(f.cond){const d=v_(f.cond,e,t);if(!y0(d,e.diagnostics,`fn_cond_na:${l.lineNo}`))continue}c=!0;const u=v2(f.body,e,t,s,o,r);if(u.kind!=="none")return u}continue}if(l.kind==="for"){const c=Tk({kind:"for",varName:l.varName,startExpr:l.startExpr,endExpr:l.endExpr,stepExpr:l.stepExpr,body:l.body,lineNo:l.lineNo},e,t,s,o);if(c.kind==="return")return c;continue}if(l.kind==="while"){const c=Tk({kind:"while",condExpr:l.condExpr,body:l.body,lineNo:l.lineNo},e,t,s,o);if(c.kind==="return")return c;continue}}return{kind:"none"}},Tk=(n,e,t,s,o)=>{const r=e.loopRuntime,a=(r==null?void 0:r.maxIters)??n6,l=(r==null?void 0:r.hasCustomMax)??!1,c=`fn_loop_max:${n.lineNo}`,f=`Loop exceeded max iterations (${a})`;if(n.kind==="for"){const h=n.varName.replace(/\s+/g,"_").toLowerCase(),m=Object.prototype.hasOwnProperty.call(t,h),g=t[h],w=v_(n.startExpr,e,t),C=v_(n.endExpr,e,t),M=v_(n.stepExpr,e,t);if(!Number.isFinite(M)||M===0)return Cd(e,`fn_loop_step_zero:${n.lineNo}`,"for-loop step must not be 0"),{kind:"none"};const P=XS(w,C,M),T=Number.isFinite(a)?a:null;let N=null,L=!1;l&&T!=null?P==null?(N=T,L=!0):(N=Math.min(T,P),L=P>T):P!=null&&(N=P);const O=M>0;let D=w,$=0;for(;(N==null||$<N)&&!(!Number.isFinite(D)||!Number.isFinite(C)||O&&D>C+1e-12||!O&&D<C-1e-12);){t[h]=D;const z=v2(n.body,e,t,s,o,!0);if(z.kind==="return")return z;if(z.kind==="break")break;D+=M,$+=1,z.kind}return L&&N!=null&&$>=N&&Cd(e,c,f),m?t[h]=g:delete t[h],{kind:"none"}}let u=0;const d=Number.isFinite(a)?a:null;for(;d==null||u<d;){const h=v_(n.condExpr,e,t);if(!y0(h,e.diagnostics,`fn_loop_cond_na:${n.lineNo}`))break;const g=v2(n.body,e,t,s,o,!0);if(g.kind==="return")return g;if(g.kind==="break")break;u+=1,g.kind}return d!=null&&u>=d&&Cd(e,c,f),{kind:"none"}},ZS=(n,e,t)=>{const s=t.funcRuntime;if(!s)return NaN;const o=s.callState.get(e)??(()=>{const f={vars:{},inited:new Set};return s.callState.set(e,f),f})();if(o.lastIndex===t.index)return o.lastValue??NaN;const r=n.name.toLowerCase();if(s.running.has(r))return Cd(t,`fn_recursion:${r}`,`Function "${n.name}" is recursive`),NaN;s.running.add(r);const a={};n.args.forEach((f,u)=>{const d=f.replace(/\s+/g,"_").toLowerCase(),h=e.args[u];a[d]=h?ir(h,t):NaN}),n.statefulVars.forEach(f=>{Object.prototype.hasOwnProperty.call(o.vars,f)&&(a[f]=o.vars[f])});const l=v2(n.body,t,a,o,n.statefulVars,!1);s.running.delete(r);const c=l.kind==="return"?l.value:NaN;return o.lastIndex=t.index,o.lastValue=c,c};function s6(n){const e=n.match(/^(line|label|box|table)_get_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function JS(n){const e=n.match(/^strategy_(closedtrades|opentrades)_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function o6(n,e){return e?n==="session.isin"?"session_isin":n.startsWith("ta_")?n.slice(3):n.startsWith("math_")?n.slice(5):n:n}const ED={profit_pct:"profit_percent",pnl:"profit",net_pnl:"net_profit",net_pnl_pct:"net_profit_percent",net_pnl_percent:"net_profit_percent",fee:"fees",max_profit:"max_runup",max_profit_pct:"max_runup_percent",max_profit_percent:"max_runup_percent",max_runup_pct:"max_runup_percent",max_drawdown_pct:"max_drawdown_percent",max_loss:"max_drawdown",max_loss_pct:"max_drawdown_percent",max_loss_percent:"max_drawdown_percent"};function $D(n){const e=n.toLowerCase();return ED[e]??e}function QS(n,e,t,s,o){const r=$D(t),a=n.strategy;if(!a)return NaN;if(o<0)return NaN;if(e==="closedtrades"){const te=a.closedTrades||[];if(!te.length)return 0;const pe=n.series.strategy_closedtrades,J=pe?pe[s]:NaN,de=(typeof J=="number"&&Number.isFinite(J)?Math.floor(J):0)-1-o;if(de<0||de>=te.length)return 0;const he=te[de],ge=Number.isFinite(he.entryPrice)&&Number.isFinite(he.qty)&&he.entryPrice>0&&he.qty>0?he.entryPrice*he.qty:NaN,ae=Number.isFinite(he.netPnl)?he.netPnl:Number.isFinite(he.pnl)?he.pnl-(he.fees??0):NaN,Ie=Number.isFinite(ge)&&ge!==0?ae/ge*100:NaN;switch(r){case"entry_price":return he.entryPrice;case"entry_time":return he.entryTimestamp;case"entry_bar_index":return he.entryIndex;case"exit_price":return he.exitPrice;case"exit_time":return he.exitTimestamp;case"exit_bar_index":return he.exitIndex;case"size":return he.qty;case"profit":return Number.isFinite(he.pnl)?he.pnl:0;case"profit_percent":return Number.isFinite(he.pnlPct)?he.pnlPct:0;case"net_profit":return Number.isFinite(ae)?ae:0;case"net_profit_percent":return Number.isFinite(Ie)?Ie:0;case"fees":return Number.isFinite(he.fees)?he.fees:0;case"entry_fee":return Number.isFinite(he.entryFee)?he.entryFee:0;case"exit_fee":return Number.isFinite(he.exitFee)?he.exitFee:0;case"max_runup":return typeof he.mfePct!="number"||!Number.isFinite(he.mfePct)?0:he.mfePct/100*he.entryPrice*he.qty;case"max_runup_percent":return typeof he.mfePct=="number"&&Number.isFinite(he.mfePct)?he.mfePct:0;case"max_drawdown":return typeof he.maePct!="number"||!Number.isFinite(he.maePct)?0:he.maePct/100*he.entryPrice*he.qty;case"max_drawdown_percent":return typeof he.maePct=="number"&&Number.isFinite(he.maePct)?he.maePct:0;case"is_long":return he.side==="long"?1:0;case"is_short":return he.side==="short"?1:0;case"entry_id":return gv(String(he.entryOrderId??he.entrySignalId??""));case"exit_id":return gv(String(he.exitOrderId??he.exitSignalId??""));default:return 0}}const l=a.openTradesByBar||[];if(s<0||s>=l.length)return 0;const c=l[s]||[];if(o>=c.length)return 0;const f=c[o],u=n.series.close,d=u&&Number.isFinite(u[s])?u[s]:NaN,h=f.qty,m=f.entryPrice,g=m>0&&h>0?m*h:NaN,w=typeof f.entryFee=="number"&&Number.isFinite(f.entryFee)?f.entryFee:0,C=Number.isFinite(d)&&Number.isFinite(m)?f.side==="long"?(d-m)*h:(m-d)*h:NaN,M=Number.isFinite(g)&&g!==0?C/g*100:NaN,P=Number.isFinite(C)&&Number.isFinite(w)?C-w:NaN,T=Number.isFinite(g)&&g!==0?P/g*100:NaN,N=f.maxFav,L=f.maxAdv,O=Number.isFinite(m)&&Number.isFinite(h)&&Number.isFinite(N)?f.side==="long"?(N-m)*h:(m-N)*h:NaN,D=Number.isFinite(m)&&m>0&&Number.isFinite(N)?f.side==="long"?(N-m)/m*100:(m-N)/m*100:NaN,$=Number.isFinite(m)&&Number.isFinite(h)&&Number.isFinite(L)?f.side==="long"?(L-m)*h:(m-L)*h:NaN,z=Number.isFinite(m)&&m>0&&Number.isFinite(L)?f.side==="long"?(L-m)/m*100:(m-L)/m*100:NaN;switch(r){case"entry_price":return m;case"entry_time":return f.entryTimestamp;case"entry_bar_index":return f.entryIndex;case"size":return h;case"profit":return Number.isFinite(C)?C:0;case"profit_percent":return Number.isFinite(M)?M:0;case"net_profit":return Number.isFinite(P)?P:0;case"net_profit_percent":return Number.isFinite(T)?T:0;case"fees":return Number.isFinite(w)?w:0;case"entry_fee":return Number.isFinite(w)?w:0;case"max_runup":return Number.isFinite(O)?O:0;case"max_runup_percent":return Number.isFinite(D)?D:0;case"max_drawdown":return Number.isFinite($)?$:0;case"max_drawdown_percent":return Number.isFinite(z)?z:0;case"is_long":return f.side==="long"?1:0;case"is_short":return f.side==="short"?1:0;case"entry_id":return gv(String(f.entryOrderId??f.entrySignalId??""));default:return 0}}function ir(n,e){var s,o,r,a,l,c,f,u,d,h;const t=((s=e.scalars)==null?void 0:s.__pinev2)===1;switch(n.kind){case"NumberLiteral":return n.value;case"StringLiteral":return gv(n.value);case"Identifier":return Ak(n.name,e);case"MemberExpression":{const m=k_(n);return m?Ak(m,e):(Zw(e,n),NaN)}case"IndexExpression":return Jw(e,n),NaN;case"UnaryExpression":{if(n.operator==="not"){const m=ir(n.expr,e);return t?dw(m):Number.isFinite(m)&&m!==0?0:1}return NaN}case"BinaryExpression":{if(n.operator==="and"||n.operator==="or"){if(t){const M=ir(n.left,e),P=r_(M);if(n.operator==="and"){if(P===0)return 0;const N=ir(n.right,e);return K_(M,N)}if(P===1)return 1;const T=ir(n.right,e);return X_(M,T)}const w=ir(n.left,e),C=ir(n.right,e);return n.operator==="and"?Number.isFinite(w)&&w!==0&&Number.isFinite(C)&&C!==0?1:0:Number.isFinite(w)&&w!==0||Number.isFinite(C)&&C!==0?1:0}const m=ir(n.left,e),g=ir(n.right,e);if(t&&F2(n.operator)&&(!Number.isFinite(m)||!Number.isFinite(g)))return NaN;switch(n.operator){case"+":return m+g;case"-":return m-g;case"*":return m*g;case"/":return x_(m,g,t,e);case"%":return g===0?NaN:m%g;case">":return Number.isFinite(m)&&Number.isFinite(g)&&m>g?1:0;case"<":return Number.isFinite(m)&&Number.isFinite(g)&&m<g?1:0;case">=":return Number.isFinite(m)&&Number.isFinite(g)&&m>=g?1:0;case"<=":return Number.isFinite(m)&&Number.isFinite(g)&&m<=g?1:0;case"==":return Number.isFinite(m)&&Number.isFinite(g)&&Math.abs(m-g)<1e-9?1:0;case"!=":return Number.isFinite(m)&&Number.isFinite(g)&&Math.abs(m-g)>=1e-9?1:0;default:return NaN}}case"CallExpression":{const m=e.funcRuntime;if(m){const N=m.funcs.get(n.callee.toLowerCase());if(N)return ZS(N,n,e)}const g=o6(n.callee.toLowerCase(),t);if(g==="__loop_exec"){const N=te=>te?te.kind==="StringLiteral"?te.value:te.kind==="Identifier"?te.name:null:null,L=N(n.args[0]);if(!L)return Cd(e,`loop_exec_missing:${Sd(n)}`,"__loop_exec requires loop id"),NaN;const O=e.loopRuntime;if(!O)return Cd(e,`loop_runtime_missing:${L}`,"Loop runtime not configured"),NaN;const D=O.plans.get(L);if(!D)return Cd(e,`loop_missing:${L}`,`Unknown loop "${L}"`),NaN;if(D.lastIndex!==e.index){if(O.running.has(L))return Cd(e,`loop_recursion:${L}`,`Loop "${L}" is recursive`),NaN;O.running.add(L);const te=LD(D,e);D.lastIndex=e.index,D.lastValues=te,O.running.delete(L)}const $=N(n.args[1]);if(!$)return 0;const z=$.replace(/\s+/g,"_").toLowerCase();return((o=D.lastValues)==null?void 0:o[z])??NaN}const w=s6(g);if(w&&e.draw){const N=n.args[0];let L="";if(N&&N.kind==="Identifier"&&(L=N.name),N&&N.kind==="StringLiteral"&&(L=N.value),!L)return NaN;const O=e.draw.get(w.kind,w.prop,L,e.index);return typeof O=="string"?gv(O):typeof O=="number"&&Number.isFinite(O)?O:NaN}const C=JS(g);if(C){if(!e.strategy)return NaN;if(!n.args.length)throw new kt(`${n.callee} expects (index)`);const N=ir(n.args[0],e),L=Number.isFinite(N)?Math.floor(N):NaN;return Number.isFinite(L)?QS(e,C.kind,C.prop,e.index,L):NaN}const M=n.args[0],P=n.args[1];if(g==="__hist_index"||g==="__arr_index"){if(n.args.length!==1)throw new kt(`${n.callee} expects (index)`);const N=ir(M,e);return t?X0(N,g==="__hist_index"?"history_index":"array_index",g==="__hist_index"?ry:bS,e):N}if(g==="__arr_index_str"){if(n.args.length!==1)throw new kt(`${n.callee} expects (index)`);const N=ir(M,e);if(!t)return N;const L=`arr_idx_str:${Sd(n)}`;return p2(N,L,e)}if(g==="__arr_set_guard"){if(n.args.length!==2)throw new kt(`${n.callee} expects (index, size)`);if(!t)return 1;const N=ir(M,e),L=ir(P,e),O=`arr_set_guard:${Sd(n)}`;return mw(N,L,O,e)}if(g==="__arr_str_valid"){if(n.args.length!==1)throw new kt(`${n.callee} expects (value)`);if(!t)return 1;const N=s0(n.args[0]);return N||Cd(e,`arr_str_val:${Sd(n)}`,xS),N?1:0}if(g==="__str_num"){if(n.args.length!==1)throw new kt(`${n.callee} expects (value)`);return ir(M,e)}if(g==="nz"){if(n.args.length<1||n.args.length>2)throw new kt("nz expects (x[, fallback])");const N=ir(M,e);return Number.isFinite(N)?N:n.args.length===2?ir(P,e):0}if(g==="between"){if(n.args.length!==3)throw new kt("between expects (x, a, b)");const N=ir(M,e),L=ir(P,e),O=ir(n.args[2],e);if(!Number.isFinite(N)||!Number.isFinite(L)||!Number.isFinite(O))return t?NaN:0;const D=Math.min(L,O),$=Math.max(L,O);return N>=D&&N<=$?1:0}if(g==="above"||g==="below"){if(n.args.length<2||n.args.length>3)throw new kt(`${n.callee} expects (a, b[, tol])`);const N=ir(M,e),L=ir(P,e),O=n.args.length===3?ir(n.args[2],e):0,D=Number.isFinite(O)?Math.max(0,O):0;return!Number.isFinite(N)||!Number.isFinite(L)?t?NaN:0:g==="above"?N>L+D?1:0:N<L-D?1:0}if(g==="higherhigh"){const N=n.args.length>=1?Math.max(1,Math.floor(ir(n.args[0],e))):1,L=e.series.high;if(!L)throw new kt("higherhigh requires high series");const O=L[e.index];if(!Number.isFinite(O))return t?NaN:0;const D=Math.max(0,e.index-N),$=aS(L,D,Math.max(0,e.index-1));return O>$?1:0}if(g==="lowerlow"){const N=n.args.length>=1?Math.max(1,Math.floor(ir(n.args[0],e))):1,L=e.series.low;if(!L)throw new kt("lowerlow requires low series");const O=L[e.index];if(!Number.isFinite(O))return t?NaN:0;const D=Math.max(0,e.index-N),$=lS(L,D,Math.max(0,e.index-1));return O<$?1:0}if(g==="swinghigh"){const N=n.args.length>=1?Math.max(1,Math.floor(ir(n.args[0],e))):3,L=e.series.high;if(!L)throw new kt("swinghigh requires high series");const O=L[e.index];if(!Number.isFinite(O))return t?NaN:0;for(let D=e.index-N;D<=e.index+N;D++){if(D===e.index||D<0||D>=L.length)continue;const $=L[D];if(Number.isFinite($)&&$>=O)return 0}return 1}if(g==="swinglow"){const N=n.args.length>=1?Math.max(1,Math.floor(ir(n.args[0],e))):3,L=e.series.low;if(!L)throw new kt("swinglow requires low series");const O=L[e.index];if(!Number.isFinite(O))return t?NaN:0;for(let D=e.index-N;D<=e.index+N;D++){if(D===e.index||D<0||D>=L.length)continue;const $=L[D];if(Number.isFinite($)&&$<=O)return 0}return 1}if(g==="volspike"){const N=n.args.length>=1?Math.max(1,ir(n.args[0],e)):1,L=e.series.volume;if(!L)throw new kt("volspike requires volume series");const O=L[e.index];if(!Number.isFinite(O))return t?NaN:0;const $=Math.max(0,e.index-20+1);let z=0,te=0;for(let J=$;J<=e.index;J++){const le=L[J];Number.isFinite(le)&&(z+=le,te+=1)}const pe=te?z/te:NaN;return Number.isFinite(pe)&&O>N*pe?1:0}if(g==="atrspike"){const N=n.args.length>=1?Math.max(1,ir(n.args[0],e)):1,L=e.series.high,O=e.series.low,D=e.series.close;if(!L||!O||!D)throw new kt("atrspike requires high/low/close series");const $=de=>{const he=L[de],ge=O[de],ae=de>0?D[de-1]:NaN;let Ie=Number.isFinite(he)&&Number.isFinite(ge)?Math.max(0,he-ge):NaN;return Number.isFinite(ae)&&(Ie=Math.max(Ie,Math.abs(he-ae),Math.abs(ge-ae))),Ie};let z=NaN,te=0;for(let de=0;de<=e.index;de++){const he=$(de);te+=Number.isFinite(he)?he:0,de===13?z=te/14:de>=14&&(z=(z*13+he)/14)}let pe=NaN,J=0,le=0;for(let de=Math.max(0,e.index-13);de<=e.index;de++){const he=$(de);Number.isFinite(he)&&(J+=he,le+=1)}return le&&(pe=J/le),Number.isFinite(z)&&Number.isFinite(pe)&&z>N*pe?1:0}if(g==="trend"){const N=n.args[0],L=N&&N.kind==="StringLiteral"?N.value:N&&N.kind==="Identifier"?N.name:"",O=String(L||"").toLowerCase()||"up",D=e.series.close;if(!D)throw new kt("trend requires close series");const z=Math.max(0,e.index-10+1);let te=0,pe=0,J=0,le=0,de=0;for(let ae=z;ae<=e.index;ae++){const Ie=ae-z,ce=D[ae];Number.isFinite(ce)&&(te+=Ie,pe+=ce,J+=Ie*Ie,le+=Ie*ce,de+=1)}const he=de*J-te*te,ge=he===0||de===0?0:(de*le-te*pe)/he;return O==="up"?ge>0?1:0:ge<0?1:0}if(g==="iff"||g==="iif"||g==="if"){if(n.args.length!==3)throw new kt(`${n.callee} expects (cond, a, b)`);if(t){const pe=n1(n.args[1]),J=n1(n.args[2]);if(pe!==J)return Cd(e,"ternary_type",yS),NaN}const N=n.args[0],L=t&&s0(N),O=t?Q0(N,e,"na"):void 0;L&&Cd(e,Q0(N,e,"type"),d2);const D=ir(M,e),$=L?!1:fw(D,e,O),z=ir(n.args[1],e),te=ir(n.args[2],e);return $?z:te}if(g==="tostring"||g==="format"||g==="upper"||g==="lower"||g==="trim"||g==="replace"||g==="replace_all"||g==="contains"||g==="startswith"||g==="endswith"||g==="length"||g==="substring"||g==="repeat"){const N=D=>Number.isFinite(D)?String(D):"",L=D=>gv(D),O=D=>{var te;const $=n.args[D];if(!$)return"";if($.kind==="StringLiteral")return $.value;if($.kind==="Identifier"){const pe=$.name.replace(/\s+/g,"_").toLowerCase(),J=(te=e.strings)==null?void 0:te[pe];if(typeof J=="string")return J}const z=ir($,e);return N(z)};if(g==="tostring"){if(n.args.length<1||n.args.length>2)throw new kt("tostring expects (x[, format])");const D=ir(n.args[0],e),$=n.args[1];let z="";if($){if($.kind==="StringLiteral")z=$.value;else if($.kind==="Identifier"){const pe=$.name.replace(/\s+/g,"_").toLowerCase(),J=(r=e.strings)==null?void 0:r[pe];typeof J=="string"&&(z=J)}}const te=iw(D,z||void 0);return L(te)}if(g==="format"){if(n.args.length<1)throw new kt("format expects (fmt, ...)");const D=O(0),$=n.args.slice(1).map(te=>yy(ir(te,e))),z=D.replace(/\{(\d+)\}/g,(te,pe)=>$[Number(pe)]??"");return L(z.replace(/{{/g,"{").replace(/}}/g,"}"))}if(g==="upper")return L(O(0).toUpperCase());if(g==="lower")return L(O(0).toLowerCase());if(g==="trim")return L(O(0).trim());if(g==="replace"||g==="replace_all"){if(n.args.length<3)throw new kt("replace expects (s, from, to)");const D=O(0),$=O(1),z=O(2);return L(D.split($).join(z))}if(g==="contains"){if(n.args.length<2)throw new kt("contains expects (s, sub)");const D=O(0),$=O(1);return D.includes($)?1:0}if(g==="startswith"){if(n.args.length<2)throw new kt("startswith expects (s, sub)");const D=O(0),$=O(1);return D.startsWith($)?1:0}if(g==="endswith"){if(n.args.length<2)throw new kt("endswith expects (s, sub)");const D=O(0),$=O(1);return D.endsWith($)?1:0}if(g==="length"){if(n.args.length!==1)throw new kt("length expects (s)");return O(0).length}if(g==="substring"){if(n.args.length<2)throw new kt("substring expects (s, from[, to])");const D=O(0),$=ir(n.args[1],e),z=n.args.length>2?ir(n.args[2],e):NaN,te=Math.max(0,Math.floor($)),pe=Number.isFinite(z)?Math.max(te,Math.floor(z)):void 0;return L(pe==null?D.slice(te):D.slice(te,pe))}if(g==="repeat"){if(n.args.length<2)throw new kt("repeat expects (s, count)");const D=O(0),$=Math.max(0,Math.floor(ir(n.args[1],e)));return L(D.repeat($))}}if(g==="add"||g==="sub"||g==="mul"||g==="div"){if(n.args.length!==2)throw new kt(`${n.callee} expects 2 arguments`);const N=ir(M,e),L=ir(P,e);return g==="add"?N+L:g==="sub"?N-L:g==="mul"?N*L:x_(N,L,t,e)}if(g==="mod"||g==="fmod"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==2)throw new kt(`${n.callee} expects 2 arguments`);const N=ir(M,e),L=ir(P,e);return g==="mod"?RS(N,L,!0,e):DS(N,L,!0,e)}if(g==="min"||g==="max"){if(n.args.length!==2)throw new kt(`${n.callee} expects 2 arguments`);const N=ir(M,e),L=ir(P,e);return g==="min"?Math.min(N,L):Math.max(N,L)}if(g==="abs"){if(n.args.length!==1)throw new kt("abs expects 1 argument");return Math.abs(ir(M,e))}if(g==="pow"){if(n.args.length!==2)throw new kt("pow expects 2 arguments");const N=ir(M,e),L=ir(P,e);return pw(N,L,t,e)}if(g==="sqrt"||g==="log"||g==="ln"||g==="log10"||g==="exp"||g==="floor"||g==="ceil"||g==="round"||g==="sin"||g==="cos"||g==="tan"||g==="asin"||g==="acos"||g==="atan"||g==="sign"){if(n.args.length!==1)throw new kt(`${n.callee} expects 1 argument`);const N=ir(M,e);switch(g){case"sqrt":return jS(N,t,e);case"log":case"ln":return BS(N,t,e);case"log10":return OS(N,t,e);case"exp":return HS(N,t);case"floor":return Math.floor(N);case"ceil":return Math.ceil(N);case"round":return Math.round(N);case"sin":return Math.sin(N);case"cos":return Math.cos(N);case"tan":return WS(N,t);case"asin":return zS(N,t,e);case"acos":return VS(N,t,e);case"atan":return Math.atan(N);default:return Math.sign(N)}}if(g==="cum"||g==="cumsum"){if(n.args.length!==1)throw new kt(`${n.callee} expects 1 argument`);const N=M;if(N.kind!=="Identifier")throw new kt(`${n.callee} expects a series identifier`);const L=N.name.replace(/\s+/g,"_").toLowerCase(),O=e.series[L];if(!O)throw new kt(`Unknown identifier "${N.name}"`);let D=0;for(let $=0;$<=e.index;$++){const z=O[$];Number.isFinite(z)&&(D+=z)}return D}if(g==="barssince"){if(n.args.length!==1)throw new kt("barssince expects (condition)");const N=M;if(N.kind!=="Identifier")throw new kt("barssince expects a series identifier");const L=N.name.replace(/\s+/g,"_").toLowerCase(),O=e.series[L];if(!O)throw new kt(`Unknown identifier "${N.name}"`);for(let D=e.index;D>=0;D--){const $=O[D];if(Number.isFinite($)&&$!==0)return e.index-D}return NaN}if(g==="tr"){if(n.args.length!==0&&n.args.length!==3)throw new kt("tr expects () or (high, low, close)");const N=(J,le)=>{if(!J){const ge=e.series[le];if(!ge)throw new kt(`Unknown identifier "${le}"`);return ge}if(J.kind!=="Identifier")throw new kt("tr expects series identifiers");const de=J.name.replace(/\s+/g,"_").toLowerCase(),he=e.series[de];if(!he)throw new kt(`Unknown identifier "${J.name}"`);return he},L=N(n.args[0],"high"),O=N(n.args[1],"low"),D=N(n.args[2],"close"),$=L[e.index],z=O[e.index],te=e.index>0?D[e.index-1]:NaN;let pe=Math.max(0,$-z);return Number.isFinite(te)&&(pe=Math.max(pe,Math.abs($-te),Math.abs(z-te))),pe}if(g==="prev"||g==="lag"||g==="change"){if(n.args.length!==2)throw new kt(`${n.callee} expects (series, n)`);const N=M;if(N.kind!=="Identifier")throw new kt(`${n.callee} expects first argument to be a series identifier`);const L=N.name.replace(/\s+/g,"_").toLowerCase(),O=ir(P,e),D=t?X0(O,"history_index",ry,e):Math.max(1,Math.floor(O));if(!Number.isFinite(D))return NaN;const $=e.index-D,z=J=>{if(J<0)return NaN;if(e.selfKey&&e.selfOut&&L===e.selfKey)return e.selfOut[J]??NaN;const le=e.series[L];if(!le)throw new kt(`Unknown identifier "${N.name}"`);return le[J]??NaN};if(g==="prev"||g==="lag")return z($);const te=z(e.index),pe=z($);return Number.isFinite(te)&&Number.isFinite(pe)?te-pe:NaN}if(g==="sum"){if(n.args.length!==2)throw new kt("sum expects (series, period)");const N=q0(M,e);if(!N)throw new kt("sum expects first argument to be a series identifier");const L=ir(P,e),O=t?Gp(L,`sum_len:${Sd(n)}`,LS,e):Math.max(1,Math.floor(L));return Number.isFinite(O)?bg(e,`sum:${O}:${Sd(M)}`,()=>Zv(N,O))[e.index]??NaN:NaN}if(g==="highest"||g==="lowest"){if(n.args.length!==2)throw new kt(`${n.callee} expects (series, period)`);const N=q0(M,e);if(!N)throw new kt(`${n.callee} expects first argument to be a series identifier`);const L=ir(P,e),O=`${g}_len:${Sd(n)}`,$=t?Gp(L,O,g==="highest"?TS:FS,e):Math.max(1,Math.floor(L));return Number.isFinite($)?bg(e,`${g}:${$}:${Sd(M)}`,()=>g==="highest"?s1(N,$):o1(N,$))[e.index]??NaN:NaN}if(g==="rising"||g==="falling"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==2)throw new kt(`${n.callee} expects (series, length)`);const N=q0(M,e);if(!N)throw new kt(`${n.callee} expects first argument to be a series identifier`);const L=ir(P,e),O=`${g}_len:${Sd(n)}`,$=Gp(L,O,g==="rising"?ES:$S,e);return Number.isFinite($)?bg(e,`${g}:${$}:${Sd(M)}`,()=>rS(N,$,g))[e.index]??NaN:NaN}if(g==="crossover"||g==="crossunder"){if(n.args.length<2||n.args.length>3)throw new kt(`${n.callee} expects (series, series[, tol])`);const N=M;if(N.kind!=="Identifier")throw new kt(`${n.callee} expects first argument to be a series identifier`);const L=N.name.replace(/\s+/g,"_").toLowerCase(),O=e.series[L];if(!O)throw new kt(`Unknown identifier "${N.name}"`);const D=n.args[1];let $=null,z=NaN;if(D.kind==="Identifier"){const he=D.name.replace(/\s+/g,"_").toLowerCase();if($=e.series[he]||null,!$){const ge=Number(D.name);z=Number.isFinite(ge)?ge:NaN}}else z=ir(D,e);const te=n.args[2]?Math.max(0,ir(n.args[2],e)):0;if(e.index<=0)return 0;const pe=O[e.index-1],J=O[e.index],le=$?$[e.index-1]:z,de=$?$[e.index]:z;return[pe,J,le,de].every(Number.isFinite)?g==="crossover"?pe<=le+te&&J>de+te?1:0:pe>=le-te&&J<de-te?1:0:0}if(g==="williamsr"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==1&&n.args.length!==4)throw new kt("williamsr expects (length) or (high, low, close, length)");const N=n.args.length===1?ir(n.args[0],e):ir(n.args[3],e),L=Gp(N,"williamsr_len",wS,e);if(!Number.isFinite(L))return NaN;const O=n.args.length===1?e.series.high:q0(n.args[0],e),D=n.args.length===1?e.series.low:q0(n.args[1],e),$=n.args.length===1?e.series.close:q0(n.args[2],e);if(!O||!D||!$)throw new kt("williamsr requires high/low/close series");const z=n.args.length===1?`williamsr:${L}`:`williamsr:${L}:${n.args.map(pe=>pe.kind==="Identifier"?pe.name:pe.kind==="NumberLiteral"||pe.kind==="StringLiteral"?pe.value:"expr").join("|")}`;return bg(e,z,()=>cS(O,D,$,L))[e.index]??NaN}if(g==="aroon"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length<1||n.args.length>2)throw new kt("aroon expects (length[, output])");const N=ir(n.args[0],e),L=Gp(N,"aroon_len",kS,e);if(!Number.isFinite(L))return NaN;const O=n.args[1]?Math.floor(ir(n.args[1],e)):0;if(!Number.isFinite(O)||O<0||O>1)throw new kt("aroon output must be 0 or 1");const D=e.series.high,$=e.series.low;if(!D||!$)throw new kt("aroon requires high/low series");const z=`aroon:${L}`,te=m2(e,z,()=>{const J=c2(D,$,L);return{a:J.up,b:J.down}});return(O===0?te.a:te.b)[e.index]??NaN}if(g==="aroonosc"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new kt("aroonosc expects (length)");const N=ir(n.args[0],e),L=Gp(N,"aroonosc_len",AS,e);if(!Number.isFinite(L))return NaN;const O=e.series.high,D=e.series.low;if(!O||!D)throw new kt("aroonosc requires high/low series");const $=`aroon:${L}`,z=m2(e,$,()=>{const J=c2(O,D,L);return{a:J.up,b:J.down}}),te=z.a[e.index],pe=z.b[e.index];return Number.isFinite(te)&&Number.isFinite(pe)?te-pe:NaN}if(g==="dmi"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length<2||n.args.length>3)throw new kt("dmi expects (length, smoothing[, output])");const N=ir(n.args[0],e),L=ir(n.args[1],e),O=Gp(N,"dmi_len",SS,e),D=Gp(L,"dmi_smooth",CS,e);if(!Number.isFinite(O)||!Number.isFinite(D))return NaN;const $=n.args[2]?Math.floor(ir(n.args[2],e)):0;if(!Number.isFinite($)||$<0||$>2)throw new kt("dmi output must be 0, 1, or 2");const z=e.series.high,te=e.series.low,pe=e.series.close;if(!z||!te||!pe)throw new kt("dmi requires high/low/close series");const J=`dmi:${O}:${D}`,le=qb(e,J,()=>{const he=K0(z,te,pe,O,D);return{a:he.plus,b:he.minus,c:he.adx}});return($===0?le.a:$===1?le.b:le.c)[e.index]??NaN}if(g==="plus_di"||g==="minus_di"||g==="dx"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new kt(`${n.callee} expects (length)`);const N=ir(n.args[0],e),D=Gp(N,g==="plus_di"?"plus_di_len":g==="minus_di"?"minus_di_len":"dx_len",g==="plus_di"?PS:g==="minus_di"?MS:NS,e);if(!Number.isFinite(D))return NaN;const $=e.series.high,z=e.series.low,te=e.series.close;if(!$||!z||!te)throw new kt(`${g} requires high/low/close series`);const pe=`dmi:${D}:${D}`,J=qb(e,pe,()=>{const de=K0($,z,te,D,D);return{a:de.plus,b:de.minus,c:de.adx}});return g==="plus_di"?J.a[e.index]??NaN:g==="minus_di"?J.b[e.index]??NaN:bg(e,`dx:${D}`,()=>uS(J.a,J.b))[e.index]??NaN}if(g==="adx"){if(!t)throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new kt("adx expects (length)");const N=ir(n.args[0],e),L=Gp(N,"adx_len",IS,e);if(!Number.isFinite(L))return NaN;const O=e.series.high,D=e.series.low,$=e.series.close;if(!O||!D||!$)throw new kt("adx requires high/low/close series");const z=`dmi:${L}:${L}`;return qb(e,z,()=>{const pe=K0(O,D,$,L,L);return{a:pe.plus,b:pe.minus,c:pe.adx}}).c[e.index]??NaN}if(g==="valuewhen"){if(!(((a=e.scalars)==null?void 0:a.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==3)throw new kt("valuewhen expects (condition, source, occurrence)");const L=n.args[0],O=s0(L);O&&Cd(e,Q0(L,e,"type"),d2);const D=n.args[2],$=`valuewhen_occ:${Sd(n)}`;if(K$(D,e))return Cd(e,$,f2),NaN;const z=ir(D,e),te=X0(z,$,f2,e);if(!Number.isFinite(te)||O)return NaN;const pe=Q0(L,e,"na"),J=ge=>y0(ge,e.diagnostics,pe),le=q0(L,e),de=q0(n.args[1],e);if(le&&de)return bg(e,`valuewhen:${te}:${Sd(L)}:${Sd(n.args[1])}`,()=>dS(le,de,te,J))[e.index]??NaN;let he=0;for(let ge=e.index;ge>=0;ge--){const ae={...e,index:ge},Ie=ir(L,ae);if(J(Ie)){if(he===te)return ir(n.args[1],ae);he+=1}}return NaN}if(g==="pivothigh"||g==="pivotlow"){if(!(((l=e.scalars)==null?void 0:l.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==3)throw new kt(`${n.callee} expects (source, left, right)`);const L=ir(n.args[1],e),O=ir(n.args[2],e),{left:D,right:$}=fS(L,O),z=e.index-$;if(z-D<0)return NaN;const te=he=>ir(n.args[0],{...e,index:he}),pe=te(z);if(!Number.isFinite(pe))return NaN;const J=z-D,le=z+$,de=g==="pivothigh";for(let he=J;he<=le;he++){const ge=te(he);if(!Number.isFinite(ge))return NaN;if(de){if(ge>pe)return NaN}else if(ge<pe)return NaN}return pe}if(g==="isin"||g==="session_isin"||g==="session.isin"){if(!(((c=e.scalars)==null?void 0:c.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==2)throw new kt("session.isin expects (time, session)");const L=n.args[1];if(!L||L.kind!=="StringLiteral")throw new kt(u2);const{start:O,end:D}=_S(L.value),$=ir(n.args[0],e);if(!Number.isFinite($))throw new kt(lw);const z=cw($);return uw(z,O,D)?1:0}if(g==="year"||g==="month"||g==="dayofweek"||g==="hour"||g==="minute"||g==="second"){if(!(((f=e.scalars)==null?void 0:f.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==1)throw new kt(`${n.callee} expects (time)`);const L=ir(n.args[0],e);return Y0(L),g==="dayofweek"?rw(L):aw(L,g==="year"||g==="month"?g:g==="hour"?"hour":g==="minute"?"minute":"second")}if(g==="timestamp"){if(!(((u=e.scalars)==null?void 0:u.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length<5||n.args.length>6)throw new kt("timestamp expects (year, month, day, hour, minute[, second])");const L=ir(n.args[0],e),O=ir(n.args[1],e),D=ir(n.args[2],e),$=ir(n.args[3],e),z=ir(n.args[4],e),te=n.args[5]?ir(n.args[5],e):0;return hS(L,O,D,$,z,te)}if(g==="timenow"){if(!(((d=e.scalars)==null?void 0:d.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==0)throw new kt("timenow expects ()");return gS(e)}if(g==="time_close"){if(!(((h=e.scalars)==null?void 0:h.__pinev2)===1))throw new kt(`Unknown function "${n.callee}"`);if(n.args.length!==0)throw new kt("time_close expects ()");const L=e.series.time;if(!L)throw new kt("time_close requires time series");const O=vS(e),D=L[e.index];return Number.isFinite(D)?D+O:NaN}const T={length:e.length,series:e.series,seriesNames:new Set(Object.keys(e.series)),scalars:e.scalars,strings:e.strings,diagnostics:e.diagnostics,draw:e.draw,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime};try{const N=`call:${Sd(n)}`;return bg(e,N,()=>{const O=KS(n,T);if(O.kind==="series")return O.value;const D=new Float32Array(e.length);return D.fill(O.value),D})[e.index]??NaN}catch(N){if(N instanceof kt)throw N}throw new kt(`Unknown function "${n.callee}"`)}default:return NaN}}function Fk(n,e,t,s,o){var M;const r=Object.entries(e),a=((M=r[0])==null?void 0:M[1].length)??0;for(const[,P]of r)if(P.length!==a)throw new kt("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const P={};return Object.entries(t).forEach(([T,N])=>{const L=T.replace(/\s+/g,"_").toLowerCase();if(typeof N=="number"&&Number.isFinite(N)){P[L]=N;return}if(typeof N=="string"){const O=Number(N);P[L]=Number.isFinite(O)?O:gv(N)}}),Object.keys(P).length?P:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const P={};return Object.entries(t).forEach(([T,N])=>{typeof N=="string"&&(P[T.replace(/\s+/g,"_").toLowerCase()]=N)}),Object.keys(P).length?P:void 0})(),f=n.map(P=>{const T=P.name.replace(/\s+/g,"_").toLowerCase();try{const N=P.initExpr?Ap(P.initExpr):null,L=Ap(P.updateExpr);return{name:T,initAst:N,updateAst:L,initExpr:P.initExpr,updateExpr:P.updateExpr,selfMode:P.selfMode}}catch(N){throw N instanceof Qv?new kt(`Syntax error in series "${P.name}" at position ${N.position}: ${N.message}`):N}}),u=(()=>{if(!(o!=null&&o.autoSort)||f.length<=1)return f;const P=new Set(f.map(de=>de.name)),T={},N={},L=new Map;f.forEach((de,he)=>{T[de.name]=new Set,N[de.name]=new Set,L.set(de.name,he)});const O=de=>de.replace(/\s+/g,"_").toLowerCase(),D=de=>{const he=new Set,ge=(ae,Ie)=>{switch(ae.kind){case"Identifier":{const ce=O(ae.name);Ie||he.add(ce);break}case"BinaryExpression":ge(ae.left,Ie),ge(ae.right,Ie);break;case"UnaryExpression":ge(ae.expr,Ie);break;case"CallExpression":{const ce=String(ae.callee||"").toLowerCase(),je=ce==="prev"||ce==="lag";ae.args.forEach((Ve,We)=>{ge(Ve,Ie||je&&We===0)});break}}};return de&&ge(de,!1),{direct:he}},$=(de,he)=>{if(!he)return;const{direct:ge}=D(he);ge.forEach(ae=>{!P.has(ae)||ae===de||(T[de].add(ae),N[ae].add(de))})};f.forEach(de=>{$(de.name,de.updateAst),$(de.name,de.initAst)});const z={};Object.keys(T).forEach(de=>{var he;z[de]=((he=T[de])==null?void 0:he.size)??0});const te=Object.keys(z).filter(de=>(z[de]||0)===0);te.sort((de,he)=>(L.get(de)??0)-(L.get(he)??0));const pe=[],J=de=>{const he=te.findIndex(ge=>(L.get(ge)??0)>(L.get(de)??0));he===-1?te.push(de):te.splice(he,0,de)};for(;te.length;){const de=te.shift();pe.push(de);const he=Array.from(N[de]||[]).sort((ge,ae)=>(L.get(ge)??0)-(L.get(ae)??0));for(const ge of he)z[ge]=(z[ge]||0)-1,z[ge]===0&&J(ge)}if(pe.length!==f.length){const de=f.map(he=>he.name).filter(he=>!pe.includes(he));throw new kt(`Circular dependency detected among state series: ${de.join(" -> ")}`)}const le={};return f.forEach(de=>{le[de.name]=de}),pe.map(de=>le[de])})(),d={},h={...e},m=new Set(Object.keys(e));for(const P of f){if(m.has(P.name))throw new kt(`Series name "${P.name}" conflicts with an existing base series`);if(h[P.name])d[P.name]||(d[P.name]=h[P.name]);else{const T=new Float32Array(a);T.fill(NaN),h[P.name]=T,d[P.name]=T}}const g=o==null?void 0:o.diagnostics,w=L2(o==null?void 0:o.loopPlans,l,!!(o!=null&&o.userFunctions)),C=E2(o==null?void 0:o.userFunctions);for(let P=0;P<a;P++)for(const T of u){const N=d[T.name],L={series:h,scalars:l,strings:c,diagnostics:g,length:a,index:P,selfKey:T.name,selfOut:N,selfMode:T.selfMode,strategy:s,loopRuntime:w,funcRuntime:C},O=P===0&&T.initAst?T.initAst:T.updateAst,D=ir(O,L);N[P]=D}return d}function _b(n,e,t,s,o,r){var w;const a=Object.entries(e),l=((w=a[0])==null?void 0:w[1].length)??0;for(const[,C]of a)if(C.length!==l)throw new kt("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([M,P])=>{const T=M.replace(/\s+/g,"_").toLowerCase();if(typeof P=="number"&&Number.isFinite(P)){C[T]=P;return}if(typeof P=="string"){const N=Number(P);C[T]=Number.isFinite(N)?N:gv(P)}}),Object.keys(C).length?C:void 0})(),f=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([M,P])=>{typeof P=="string"&&(C[M.replace(/\s+/g,"_").toLowerCase()]=P)}),Object.keys(C).length?C:void 0})(),u=L2(r==null?void 0:r.loopPlans,c,!!(r!=null&&r.userFunctions)),d=E2(r==null?void 0:r.userFunctions);let h;try{h=Ap(n)}catch(C){throw C instanceof Qv?new kt(`Syntax error at position ${C.position}: ${C.message}`):C}const m=new Float32Array(l),g=new Map;for(let C=0;C<l;C++){const M={series:e,scalars:c,strings:f,diagnostics:o,memo:g,length:l,index:C,strategy:s,loopRuntime:u,funcRuntime:d};m[C]=ir(h,M)}return m}function DD(n,e,t,s,o,r,a,l){var M;const c=Object.entries(e),f=((M=c[0])==null?void 0:M[1].length)??0;if(s<0||s>=f)return NaN;for(const[,P]of c)if(P.length!==f)throw new kt("All base series must have the same length");const u=(()=>{if(!t||typeof t!="object")return;const P={};return Object.entries(t).forEach(([T,N])=>{const L=T.replace(/\s+/g,"_").toLowerCase();if(typeof N=="number"&&Number.isFinite(N)){P[L]=N;return}if(typeof N=="string"){const O=Number(N);P[L]=Number.isFinite(O)?O:gv(N)}}),Object.keys(P).length?P:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const P={};return Object.entries(t).forEach(([T,N])=>{typeof N=="string"&&(P[T.replace(/\s+/g,"_").toLowerCase()]=N)}),Object.keys(P).length?P:void 0})(),h=L2(l==null?void 0:l.loopPlans,u,!!(l!=null&&l.userFunctions)),m=E2(l==null?void 0:l.userFunctions);let g;if(typeof n=="string")try{g=Ap(n)}catch(P){throw P instanceof Qv?new kt(`Syntax error at position ${P.position}: ${P.message}`):P}else g=n;return ir(g,{series:e,scalars:u,strings:d,diagnostics:a,memo:new Map,length:f,index:s,draw:o,strategy:r,loopRuntime:h,funcRuntime:m})}function Lk(n,e){var a,l;const t=n.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.locals&&Object.prototype.hasOwnProperty.call(e.locals,t))return e.locals[t];const s=e.series[t];if(s)return s[e.index]??NaN;const o=(a=e.strings)==null?void 0:a[t];if(typeof o=="string")return o;const r=(l=e.scalars)==null?void 0:l[t];if(typeof r=="number"&&Number.isFinite(r))return r;throw new kt(`Unknown identifier "${n}"`)}function lp(n,e,t,s){var f;const o=((f=t.scalars)==null?void 0:f.__pinev2)===1,r=u=>typeof u=="number"?u:gv(u),a=u=>typeof u=="string"?u:Number.isFinite(u)?String(u):"",l=(u,d)=>typeof u=="string"?u:iw(u,d),c=u=>{let d=s.get(u);return d||(d=n0(u,t),s.set(u,d)),d.kind==="scalar"?d.value:d.value[e.index]??NaN};switch(n.kind){case"NumberLiteral":return n.value;case"StringLiteral":return n.value;case"Identifier":return Lk(n.name,e);case"MemberExpression":{const u=k_(n);return u?Lk(u,e):(Zw(t,n),NaN)}case"IndexExpression":return Jw(t,n),NaN;case"UnaryExpression":{if(n.operator==="not"){const u=r(lp(n.expr,e,t,s));return Number.isFinite(u)&&u!==0?0:1}return NaN}case"BinaryExpression":{const u=lp(n.left,e,t,s),d=lp(n.right,e,t,s);if(n.operator==="+")return typeof u=="string"||typeof d=="string"?`${a(u)}${a(d)}`:r(u)+r(d);const h=r(u),m=r(d);if(o&&F2(n.operator)&&(!Number.isFinite(h)||!Number.isFinite(m)))return NaN;switch(n.operator){case"-":return h-m;case"*":return h*m;case"/":return x_(h,m,o,t);case"%":return m===0?NaN:h%m;case">":return Number.isFinite(h)&&Number.isFinite(m)&&h>m?1:0;case"<":return Number.isFinite(h)&&Number.isFinite(m)&&h<m?1:0;case">=":return Number.isFinite(h)&&Number.isFinite(m)&&h>=m?1:0;case"<=":return Number.isFinite(h)&&Number.isFinite(m)&&h<=m?1:0;case"==":return Number.isFinite(h)&&Number.isFinite(m)&&Math.abs(h-m)<1e-9?1:0;case"!=":return Number.isFinite(h)&&Number.isFinite(m)&&Math.abs(h-m)>=1e-9?1:0;case"and":return Number.isFinite(h)&&h!==0&&Number.isFinite(m)&&m!==0?1:0;case"or":return Number.isFinite(h)&&h!==0||Number.isFinite(m)&&m!==0?1:0;default:return NaN}}case"CallExpression":{const u=o6(n.callee.toLowerCase(),o),d=s6(u);if(d&&e.draw){const h=n.args[0];let m="";if(h&&h.kind==="Identifier"&&(m=h.name),h&&h.kind==="StringLiteral"&&(m=h.value),!m)return"";const g=e.draw.get(d.kind,d.prop,m,e.index);return g??""}if(u==="iff"||u==="iif"||u==="if"){if(n.args.length!==3)throw new kt(`${n.callee} expects (cond, a, b)`);const h=r(lp(n.args[0],e,t,s)),m=o?Number.isFinite(h)&&h!==0:h!==0;return lp(m?n.args[1]:n.args[2],e,t,s)}if(u==="tostring"){if(n.args.length<1||n.args.length>2)throw new kt("tostring expects (x[, format])");const h=lp(n.args[0],e,t,s);let m;if(n.args[1]){const g=lp(n.args[1],e,t,s);m=typeof g=="string"?g:String(g)}return l(h,m)}if(u==="format"){if(n.args.length<1)throw new kt("format expects (fmt, ...)");const h=lp(n.args[0],e,t,s),m=a(h),g=n.args.slice(1).map(C=>lp(C,e,t,s));return m.replace(/\{(\d+)(?:,([^,}]+))?(?:,([^}]+))?\}/g,(C,M,P,T)=>{const N=Number(M),L=g[N];return L==null?"":typeof L=="number"?P&&String(P).trim().toLowerCase()==="number"?iw(L,String(T??"")):yy(L):String(L)}).replace(/{{/g,"{").replace(/}}/g,"}")}if(u==="upper")return a(lp(n.args[0],e,t,s)).toUpperCase();if(u==="lower")return a(lp(n.args[0],e,t,s)).toLowerCase();if(u==="trim")return a(lp(n.args[0],e,t,s)).trim();if(u==="replace"||u==="replace_all"){if(n.args.length<3)throw new kt("replace expects (s, from, to)");const h=a(lp(n.args[0],e,t,s)),m=a(lp(n.args[1],e,t,s)),g=a(lp(n.args[2],e,t,s));return h.split(m).join(g)}if(u==="contains"){if(n.args.length<2)throw new kt("contains expects (s, sub)");const h=a(lp(n.args[0],e,t,s)),m=a(lp(n.args[1],e,t,s));return h.includes(m)?1:0}if(u==="startswith"){if(n.args.length<2)throw new kt("startswith expects (s, sub)");const h=a(lp(n.args[0],e,t,s)),m=a(lp(n.args[1],e,t,s));return h.startsWith(m)?1:0}if(u==="endswith"){if(n.args.length<2)throw new kt("endswith expects (s, sub)");const h=a(lp(n.args[0],e,t,s)),m=a(lp(n.args[1],e,t,s));return h.endsWith(m)?1:0}if(u==="length"){if(n.args.length!==1)throw new kt("length expects (s)");return a(lp(n.args[0],e,t,s)).length}if(u==="substring"){if(n.args.length<2)throw new kt("substring expects (s, from[, to])");const h=a(lp(n.args[0],e,t,s)),m=r(lp(n.args[1],e,t,s)),g=n.args.length>2?r(lp(n.args[2],e,t,s)):NaN,w=Math.max(0,Math.floor(m)),C=Number.isFinite(g)?Math.max(w,Math.floor(g)):void 0;return C==null?h.slice(w):h.slice(w,C)}if(u==="repeat"){if(n.args.length<2)throw new kt("repeat expects (s, count)");const h=a(lp(n.args[0],e,t,s)),m=r(lp(n.args[1],e,t,s)),g=Math.max(0,Math.floor(m));return h.repeat(g)}return c(n)}default:return c(n)}}function Ek(n,e,t,s,o){var m;const r=Object.entries(e),a=((m=r[0])==null?void 0:m[1].length)??0;for(const[,g]of r)if(g.length!==a)throw new kt("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const g={};return Object.entries(t).forEach(([w,C])=>{const M=w.replace(/\s+/g,"_").toLowerCase();if(typeof C=="number"&&Number.isFinite(C)){g[M]=C;return}if(typeof C=="string"){const P=Number(C);g[M]=Number.isFinite(P)?P:gv(C)}}),Object.keys(g).length?g:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const g={};return Object.entries(t).forEach(([w,C])=>{typeof C=="string"&&(g[w.replace(/\s+/g,"_").toLowerCase()]=C)}),Object.keys(g).length?g:void 0})();let f;try{f=Ap(n)}catch(g){throw g instanceof Qv?new kt(`Syntax error at position ${g.position}: ${g.message}`):g}const u={length:a,series:e,seriesNames:new Set(Object.keys(e)),scalars:l,diagnostics:o,strategy:s},d=new WeakMap,h=new Array(a);for(let g=0;g<a;g++){const C=lp(f,{series:e,scalars:l,strings:c,length:a,index:g,strategy:s},u,d);typeof C=="string"?h[g]=C:h[g]=yy(C)}return h}function RD(n,e,t,s,o,r){var w;const a=Object.entries(e),l=((w=a[0])==null?void 0:w[1].length)??0;if(s<0||s>=l)return"";for(const[,C]of a)if(C.length!==l)throw new kt("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([M,P])=>{const T=M.replace(/\s+/g,"_").toLowerCase();if(typeof P=="number"&&Number.isFinite(P)){C[T]=P;return}if(typeof P=="string"){const N=Number(P);C[T]=Number.isFinite(N)?N:gv(P)}}),Object.keys(C).length?C:void 0})(),f=(()=>{if(!t||typeof t!="object")return;const C={};return Object.entries(t).forEach(([M,P])=>{typeof P=="string"&&(C[M.replace(/\s+/g,"_").toLowerCase()]=P)}),Object.keys(C).length?C:void 0})();let u;if(typeof n=="string")try{u=Ap(n)}catch(C){throw C instanceof Qv?new kt(`Syntax error at position ${C.position}: ${C.message}`):C}else u=n;const d={length:l,series:e,seriesNames:new Set(Object.keys(e)),scalars:c,strategy:r},g=lp(u,{series:e,scalars:c,strings:f,length:l,index:s,draw:o,strategy:r},d,new WeakMap);return typeof g=="string"?g:yy(g)}function yb(n,e){const t=n.length,s=new Float32Array(t);for(let o=0;o<t;o++){const r=o-e;s[o]=r>=0?n[r]:NaN}return s}const Yb=n=>/[A-Za-z_$]/.test(n),Kb=n=>/[A-Za-z0-9_$]/.test(n);function jD(n){return String(n||"").replace(/\u00A0/g," ")}function i6(n){const e=String(n||"");let t="",s=null,o=!1;for(let r=0;r<e.length;r++){const a=e[r],l=e[r+1];if(s){if(t+=a,o){o=!1;continue}if(a==="\\"){o=!0;continue}a===s&&(s=null);continue}if(a==="'"||a==='"'){s=a,t+=a;continue}if(a==="/"&&l==="/"){for(r+=1;r+1<e.length;){const c=e[r+1];if(c===`
`||c==="\r")break;r+=1}continue}t+=a}return t}function BD(n,e){const t=String(n||""),s=t.length;let o="",r=null,a=0;for(;a<s;){const l=t[a];if(r){o+=l,l===r&&t[a-1]!=="\\"&&(r=null),a+=1;continue}if(l==="'"||l==='"'){r=l,o+=l,a+=1;continue}if(Yb(l)){let c=a+1;for(;c<s&&Kb(t[c]);)c+=1;const f=t.slice(a,c),u=f.toLowerCase();let d=c;for(;d<s&&/\s/.test(t[d]);)d+=1;if(t[d]==="."){let h=d+1;for(;h<s&&/\s/.test(t[h]);)h+=1;if(h<s&&Yb(t[h])){let m=h+1;for(;m<s&&Kb(t[m]);)m+=1;const g=t.slice(h,m),w=g.toLowerCase();if(u==="strategy"&&(w==="closedtrades"||w==="opentrades")){let M=m;for(;M<s&&/\s/.test(t[M]);)M+=1;if(t[M]==="."){let P=M+1;for(;P<s&&/\s/.test(t[P]);)P+=1;if(P<s&&Yb(t[P])){let T=P+1;for(;T<s&&Kb(t[T]);)T+=1;const N=t.slice(P,T);o+=`strategy_${w}_${N}`,a=T;continue}}}if(u==="barstate"||u==="timeframe"||u==="syminfo"||u==="strategy"){o+=`${u}_${g}`,a=m;continue}if(e){if(u==="ta"||u==="math"||u==="session"||u==="color"){o+=`${u}_${g}`,a=m;continue}}else if(u==="ta"||u==="math"){o+=g,a=m;continue}}}o+=f,a=c;continue}o+=l,a+=1}return o}function OD(n,e){const t=String(n||"");let s="",o=null,r=0;for(;r<t.length;){const a=t[r];if(o){s+=a,a===o&&t[r-1]!=="\\"&&(o=null),r+=1;continue}if(a==="'"||a==='"'){o=a,s+=a,r+=1;continue}if(Yb(a)){let l=r+1;for(;l<t.length&&Kb(t[l]);)l+=1;const c=t.slice(r,l);let f=r-1;for(;f>=0&&/\s/.test(t[f]);)f-=1;if(f>=0&&t[f]==="."){s+=c,r=l;continue}let u=l;for(;u<t.length&&/\s/.test(t[u]);)u+=1;if(t[u]==="["&&e){let d=0,h=u,m=null;for(;h<t.length;h++){const g=t[h];if(m){g===m&&t[h-1]!=="\\"&&(m=null);continue}if(g==="'"||g==='"'){m=g;continue}if(g==="[")d+=1;else if(g==="]"&&(d-=1,d===0))break}if(h<t.length&&d===0){const g=t.slice(u+1,h).trim();if(g){s+=`prev(${c}, __hist_index(${g}))`,r=h+1;continue}}}else if(t[u]==="["){let d=u+1;for(;d<t.length&&/\s/.test(t[d]);)d+=1;let h=1;t[d]==="-"&&(h=-1,d+=1);let m=d;for(;m<t.length&&/[0-9]/.test(t[m]);)m+=1;const g=t.slice(d,m);for(;m<t.length&&/\s/.test(t[m]);)m+=1;if(g&&t[m]==="]"){const w=h*Number(g);if(Number.isFinite(w)&&w>=1){s+=`prev(${c}, ${Math.floor(w)})`,r=m+1;continue}if(Number.isFinite(w)&&w===0){s+=c,r=m+1;continue}}}s+=c,r=l;continue}s+=a,r+=1}return s}function zD(n){if(!n)return 0;let e=2166136261;for(let s=0;s<n.length;s++)e^=n.charCodeAt(s),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function VD(n){const e=String(n||"");let t="",s=0;for(;s<e.length;){const o=e[s];if(o==='"'||o==="'"){const r=o;s+=1;let a="",l=!1;for(;s<e.length;){const c=e[s];if(l){a+=c,l=!1,s+=1;continue}if(c==="\\"){l=!0,s+=1;continue}if(c===r){s+=1;break}a+=c,s+=1}t+=String(zD(a));continue}t+=o,s+=1}return t}function Z_(n,e){const t=!!(e!=null&&e.pineV2);let s=jD(String(n||""));return s=i6(s),s=BD(s,t),t||(s=VD(s)),s=OD(s,t),{expr:s}}function N0(n){return!Number.isFinite(n)||n<=0?0:n<1e11?n*1e3:n}function WD(n){const e=new Date(n);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)}function HD(n){const e=new Date(n);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1,0,0,0,0)}function qD(n){const e=String(n||"").trim(),t=e.toUpperCase();if(!t)return null;if(t==="D"||t==="1D")return{kind:"calendar",unit:"D"};if(t==="W"||t==="1W")return{kind:"calendar",unit:"W"};if(e==="M"||e==="1M")return{kind:"calendar",unit:"M"};if(/^\d+$/.test(t))return{kind:"fixed",ms:Math.max(1,Number(t))*60*1e3};const s=t.match(/^(\d+)\s*([A-Z]+)$/);if(s){const o=Math.max(1,Number(s[1])),r=s[2];if(r==="S"||r==="SEC"||r==="SECS"||r==="SECOND"||r==="SECONDS")return{kind:"fixed",ms:o*1e3};if(r==="H"||r==="HR"||r==="HRS")return{kind:"fixed",ms:o*60*60*1e3};if(r==="MIN"||r==="MINS")return{kind:"fixed",ms:o*60*1e3};if(r==="M"&&e.toLowerCase().endsWith("m"))return{kind:"fixed",ms:o*60*1e3};if(r==="D"||r==="DAY"||r==="DAYS")return{kind:"fixed",ms:o*24*60*60*1e3};if(r==="W"||r==="WK"||r==="WEEK"||r==="WEEKS")return{kind:"fixed",ms:o*7*24*60*60*1e3}}return null}const $k=new Map,Dk=new Map;function UD(n){const e=n||"UTC",t=$k.get(e);if(t)return t;const s=new Intl.DateTimeFormat("en-GB",{timeZone:e,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return $k.set(e,s),s}function GD(n){const e=n||"UTC",t=Dk.get(e);if(t)return t;const s=new Intl.DateTimeFormat("en-GB",{timeZone:e,weekday:"short"});return Dk.set(e,s),s}function $2(n,e){if(!Number.isFinite(n))return null;const s=UD(e).formatToParts(new Date(n)),o={};for(const d of s)(d.type==="year"||d.type==="month"||d.type==="day"||d.type==="hour"||d.type==="minute"||d.type==="second")&&(o[d.type]=d.value);const r=Number(o.year),a=Number(o.month),l=Number(o.day),c=Number(o.hour),f=Number(o.minute),u=Number(o.second);return[r,a,l,c,f,u].every(d=>Number.isFinite(d))?{y:r,m:a,d:l,h:c,min:f,s:u}:null}function YD(n,e){const s=GD(e).format(new Date(n));return{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}[s]??null}function g2(n,e){const t=$2(n,e);return t?Date.UTC(t.y,t.m-1,t.d,t.h,t.min,t.s,0)-n:0}function e8(n,e){const t=$2(n,e);if(!t)return WD(n);let s=Date.UTC(t.y,t.m-1,t.d,0,0,0,0);const o=g2(s,e);s=s-o;const r=g2(s,e);return s-r}function KD(n,e){const t=e8(n,e),s=YD(n,e);return t-(typeof s=="number"?s:0)*24*60*60*1e3}function XD(n,e){const t=$2(n,e);if(!t)return HD(n);let s=Date.UTC(t.y,t.m-1,1,0,0,0,0);const o=g2(s,e);s=s-o;const r=g2(s,e);return s-r}function O1(n,e,t){if(!e)return n;if(e.kind==="fixed")return Math.floor(n/e.ms)*e.ms;const s=t||"UTC";return e.unit==="D"?e8(n,s):e.unit==="W"?KD(n,s):XD(n,s)}function ZD(n){const e=String(n||"").trim();if(!e)return[];if(e.toLowerCase()==="24x7"||e==="0000-2359")return[];const t=e.split(/[;,]/).map(o=>o.trim()).filter(Boolean),s=[];for(const o of t){const r=o.match(/(\d{1,2}):?(\d{2})\s*-\s*(\d{1,2}):?(\d{2})/);if(!r)continue;const a=Number(r[1]),l=Number(r[2]),c=Number(r[3]),f=Number(r[4]);if([a,l,c,f].some(h=>!Number.isFinite(h)))continue;const u=a*60+l,d=c*60+f;s.push({start:u,end:d})}return s}function Xb(n,e,t){const s=ZD(e);if(!s.length)return!0;const r=$2(n,t||"UTC");if(!r)return!0;const a=r.h*60+r.min;for(const l of s)if(l.start<=l.end){if(a>=l.start&&a<=l.end)return!0}else if(a>=l.start||a<=l.end)return!0;return!1}function Rk(n){const e=[];let t=null;for(let s=0;s<n.length;s++){const o=N0(n[s]??0);if(o){if(t!=null){const r=o-t;r>0&&Number.isFinite(r)&&e.push(r)}if(t=o,e.length>=200)break}}return e.length<3?null:(e.sort((s,o)=>s-o),e[Math.floor(e.length/2)]??null)}function JD(n,e){let t=0,s=n.length;for(;t<s;){const o=t+s>>>1;n[o]>e?s=o:t=o+1}return t}function QD(n){const e=n.length,t=new Float32Array(e),s=new Float32Array(e),o=new Float32Array(e),r=new Float32Array(e),a=new Float32Array(e),l=new Float32Array(e);for(let c=0;c<e;c++){const f=n[c],u=N0((f==null?void 0:f.timestamp)??(f==null?void 0:f.time)??(f==null?void 0:f.t)??0),d=Number(f==null?void 0:f.close),h=Number(f==null?void 0:f.open),m=Number(f==null?void 0:f.high),g=Number(f==null?void 0:f.low);t[c]=Number.isFinite(h)?h:Number.isFinite(d)?d:NaN,r[c]=Number.isFinite(d)?d:NaN,s[c]=Number.isFinite(m)?m:Number.isFinite(d)?d:t[c],o[c]=Number.isFinite(g)?g:Number.isFinite(d)?d:t[c];const w=Number(f==null?void 0:f.volume);a[c]=Number.isFinite(w)?w:0,l[c]=u||0}return{open:t,high:s,low:o,close:r,volume:a,time:l}}function eR(n){var z,te,pe,J;const e=n.timestamps.length,t=n.lookahead||"off",s=n.gaps||"off",o=String(n.timeframe||"").trim(),r=((z=n.scalars)==null?void 0:z.__pinev2)===1,a=String(n.expr||"close"),l=le=>r?Z_(le,{pineV2:!0}).expr:String(le??"");if(/\b(?:request\.)?security(?:_lower_tf)?\s*\(/i.test(a))throw new Error("request.security: nested request.security inside security expression is not supported");if(!o||o.toLowerCase()==="current"||o==="__CURRENT__"){const le={open:new Float32Array(e),high:new Float32Array(e),low:new Float32Array(e),close:new Float32Array(e),volume:new Float32Array(e),time:new Float32Array(e)};for(let ae=0;ae<e;ae++)le.open[ae]=n.open[ae]??NaN,le.high[ae]=n.high[ae]??NaN,le.low[ae]=n.low[ae]??NaN,le.close[ae]=n.close[ae]??NaN,le.volume[ae]=((te=n.volume)==null?void 0:te[ae])??0,le.time[ae]=N0(n.timestamps[ae]??0);const he=g_([{name:"__out",expr:l(a)}],le,n.scalars,void 0,void 0,{userFunctions:n.userFunctions}).__out||new Float32Array(e),ge=new Array(e);for(let ae=0;ae<e;ae++){const Ie=he[ae],ce=N0(n.timestamps[ae]??0);if(s==="on"&&!Xb(ce,n.session,n.timezone)){ge[ae]=void 0;continue}ge[ae]=Number.isFinite(Ie)?Ie:void 0}return ge}const c=qD(o);if(!c)throw new Error(`request.security: invalid timeframe "${o}"`);if(n.sourceCandles&&n.sourceCandles.length>1){const le=n.sourceCandles,de=le.length,he=QD(le),ae=g_([{name:"__out",expr:l(a)}],he,n.scalars,void 0,void 0,{userFunctions:n.userFunctions}).__out||new Float32Array(de),Ie=he.time,ce=Rk(n.timestamps),je=new Array(e);for(let He=0;He<e;He++){const Ue=N0(n.timestamps[He]??0);if(!Ue){je[He]=-1;continue}let et=Ue;if(He+1<e){const it=N0(n.timestamps[He+1]??0);it&&it>Ue&&(et=it-1)}else ce!=null&&ce>0&&(et=Ue+ce-1);const ft=JD(Ie,et);je[He]=ft-1}const Ve=new Array(e);for(let He=0;He<e;He++){const Ue=je[He],et=He+1<e?je[He+1]:Ue;Ve[He]=Ue>=0&&He+1<e&&Ue!==et}const We=new Array(e);for(let He=0;He<e;He++){const Ue=je[He];if(Ue<0||Ue>=de){We[He]=void 0;continue}const et=N0(n.timestamps[He]??0);if(s==="on"&&!Xb(et,n.session,n.timezone)){We[He]=void 0;continue}const ft=t==="on"||Ve[He]?ae[Ue]:Ue>0?ae[Ue-1]:NaN;let it=Number.isFinite(ft)?ft:void 0;if(s==="on"){const Lt=O1(et,c,n.timezone),Tt=O1(Ie[Ue]??0,c,n.timezone);Lt!==Tt&&(it=void 0)}We[He]=it}return We}const f=Rk(n.timestamps);if(c.kind==="fixed"&&f!=null&&c.ms<f)throw new Error(`request.security: lower timeframe "${o}" is not available from current chart data (base ~${Math.round(f/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`);const u=new Array(e),d=new Array(e),h=[],m=[],g=[],w=[],C=[],M=[];let P=NaN,T=-1;for(let le=0;le<e;le++){const de=N0(n.timestamps[le]??0);if(!de){u[le]=-1;continue}const he=O1(de,c,n.timezone);if(!Number.isFinite(P)||he!==P){P=he,T+=1,M[T]=he,h[T]=n.open[le]??n.close[le]??NaN;const ge=n.close[le]??NaN;m[T]=n.high[le]??ge,g[T]=n.low[le]??ge,w[T]=n.close[le]??NaN,C[T]=((pe=n.volume)==null?void 0:pe[le])??0}else{const ge=n.high[le],ae=n.low[le],Ie=n.close[le];ge!=null&&Number.isFinite(ge)&&(m[T]=Math.max(m[T],ge)),ae!=null&&Number.isFinite(ae)&&(g[T]=Math.min(g[T],ae)),Ie!=null&&Number.isFinite(Ie)&&(w[T]=Ie);const ce=(J=n.volume)==null?void 0:J[le];ce!=null&&Number.isFinite(ce)&&(C[T]+=ce)}u[le]=T}for(let le=0;le<e;le++){const de=u[le],he=le+1<e?u[le+1]:de;d[le]=de>=0&&le+1<e&&de!==he}const N=T+1;if(N<=0)return new Array(e);const L={open:new Float32Array(N),high:new Float32Array(N),low:new Float32Array(N),close:new Float32Array(N),volume:new Float32Array(N),time:new Float32Array(N)};for(let le=0;le<N;le++)L.open[le]=h[le]??NaN,L.high[le]=m[le]??NaN,L.low[le]=g[le]??NaN,L.close[le]=w[le]??NaN,L.volume[le]=C[le]??0,L.time[le]=M[le]??0;const D=g_([{name:"__out",expr:l(a)}],L,n.scalars,void 0,void 0,{userFunctions:n.userFunctions}).__out||new Float32Array(N),$=new Array(e);for(let le=0;le<e;le++){const de=u[le];if(de<0){$[le]=void 0;continue}const he=N0(n.timestamps[le]??0);if(s==="on"&&!Xb(he,n.session,n.timezone)){$[le]=void 0;continue}const ge=t==="on"||d[le]?D[de]:de>0?D[de-1]:NaN,ae=Number.isFinite(ge)?ge:void 0;if(s==="on"){const Ie=O1(he,c,n.timezone),ce=O1(M[de]??0,c,n.timezone);$[le]=Ie===ce?ae:void 0}else $[le]=ae}return $}const jk=n=>`https://noti.dutyai.app${n}`,Bk=n=>{const e=typeof n=="number"?n:Number(n);return!Number.isFinite(e)||e<=0?null:e<1e11?e*1e3:e},tR=n=>{if(!n)return null;if(Array.isArray(n)){if(n.length<5)return null;let e,t,s,o,r,a;if(n.length>=6){const c=Number(n[0]),f=Number(n[n.length-1]),u=Number.isFinite(c)&&Math.abs(c)>1e10,d=Number.isFinite(f)&&Math.abs(f)>1e10;u&&!d?(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],a=n[5]):!u&&d?(t=n[0],s=n[1],o=n[2],r=n[3],a=n[4],e=n[5]):(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],a=n[5])}else e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],a=0;const l=Bk(e);return l?{timestamp:l,open:Number(t)||0,high:Number(s)||0,low:Number(o)||0,close:Number(r)||0,volume:Number(a)||0}:null}if(typeof n=="object"){const e=Bk(n.timestamp??n.time??n.t??n.ts??n.date);return e?{timestamp:e,open:Number(n.open??n.o)||0,high:Number(n.high??n.h)||0,low:Number(n.low??n.l)||0,close:Number(n.close??n.c)||0,volume:Number(n.volume??n.v)||0}:null}return null};class nR{constructor(){$e(this,"_prevSymbol");$e(this,"_ws");$e(this,"listens",{});$e(this,"polygonApiKey","k2hPDhLy8gIpP4lMCU0gwo92xNRxE2XI");$e(this,"currentPriceCache",new Map);$e(this,"pipeline");$e(this,"corporateActionsCache",new Map);$e(this,"corporateActionsInflight",new Map);$e(this,"dataOptions",{sessionMode:"regular",adjustMode:"none",timezone:"UTC"});this.pipeline=new f$(this.fetchHistoryPage.bind(this),{initialLimit:800,pageLimit:1e3,pageDelayMs:60,maxKeys:24,ttlMs:25*6e4})}async getHistoryDutyData({symbol:e,period:t,from:s,to:o,strategy:r,sessionMode:a,adjustMode:l,timezone:c}){const f=(t==null?void 0:t.timeframe)||"1m",u=this.normalizeSessionMode(a||e.sessionMode||this.dataOptions.sessionMode),d=this.normalizeAdjustMode(l||e.adjustMode||this.dataOptions.adjustMode),h=R1(e,c||this.dataOptions.timezone);this.dataOptions={sessionMode:u,adjustMode:d,timezone:h};const m=await this.pipeline.waitForInitial(e,f);await this.ensureCorporateActions(e);const g=this.applyTransforms(m.candles.slice(),e,u,d,h,f);if(g.length>0){const w=g[g.length-1].close;this.currentPriceCache.set(e.ticker,w)}return{data:g.slice(),lays:[]}}startBackgroundPrefetch(e,t){this.pipeline.start(e,t.timeframe)}hasMoreServerHistory(e,t){return!this.pipeline.getSnapshot(e,t.timeframe).isComplete}async loadMoreHistoricalData(e,t,s,o=2){const a=this.pipeline.requestVisibleRange({symbol:e,timeframe:t.timeframe,beforeTimestamp:s,limit:350}),l=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),c=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),f=R1(e,this.dataOptions.timezone);return await this.ensureCorporateActions(e),{data:this.applyTransforms(a.slice(),e,l,c,f,t.timeframe),lays:[]}}removeDuplicateData(e){const t=new Set;return e.filter(s=>t.has(s[0])?!1:(t.add(s[0]),!0))}getTimeframeInMs(e){return e.endsWith("m")?parseInt(e.slice(0,-1))*60*1e3:e.endsWith("h")?parseInt(e.slice(0,-1))*60*60*1e3:e.endsWith("d")?parseInt(e.slice(0,-1))*24*60*60*1e3:e.endsWith("w")?parseInt(e.slice(0,-1))*7*24*60*60*1e3:60*1e3}shouldFilterBySession(e){const t=String(e||"").trim();if(!t)return!0;const s=t.slice(-1);return!(s==="d"||s==="D"||s==="w"||s==="W"||s==="M"||s==="y"||s==="Y")}canLoadMoreData(e,t){const s=this.pipeline.getSnapshot(e,t.timeframe);return s.candles.length>0&&!s.isComplete}convertResolutionForStockNow(e){return e==="1d"?"1D":e==="1w"?"1W":e==="1M"?"1M":e.endsWith("m")?e.slice(0,-1):e.endsWith("h")?(parseInt(e.slice(0,-1))*60).toString():e.endsWith("d")?(parseInt(e.slice(0,-1))*24*60).toString():e.endsWith("w")?(parseInt(e.slice(0,-1))*7*24*60).toString():e}async fetchHistoryPage(e){const t=this.convertResolutionForStockNow(e.timeframe),s=encodeURIComponent(e.symbol.ticker),o=e.symbol.country||"BD",r=`/finance/get/chart/${s}/${t}?skip=${e.skip}&limit=${e.limit}&country=${o}`,a=jk(r),l=await fetch(a,{signal:e.signal});if(!l.ok)return[];const c=await l.text();if(!c||c.trim()==="")return[];try{const f=JSON.parse(c),u=Array.isArray(f)?f:Array.isArray(f==null?void 0:f.data)?f.data:Array.isArray(f==null?void 0:f.candles)?f.candles:Array.isArray(f==null?void 0:f.result)?f.result:[],d=Array.isArray(u)?u:[];if(!d.length)return[];const h=[];for(const m of d){const g=tR(m);g&&h.push(g)}return h}catch{return[]}}async getSymbols(){console.log("🚀 getSymbols() method called");try{console.log("🌐 Fetching symbols from API...");const t=await fetch(jk("/finance/get/stock/list/latest"));if(!t.ok)return console.warn(`⚠️ API request failed with status: ${t.status}`),[];let s=await t.json();const o=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.symbols)?s.symbols:null;if(!o||!Array.isArray(o))return console.warn("⚠️ API response is not an array, using fallback symbols"),[];o.push({ticker:"DSEX",name:"Dhaka Stock Exchange",shortName:"DSEX",market:"stock",exchange:"DSEBD",priceCurrency:"BDT",type:"stock",logo:"",country:"BD"}),console.log(`📊 Received ${o.length} symbols from API`);const a=o.map(l=>{const c={ticker:l.symbol||l.ticker||"",name:l.description||l.fullName||l.name||l.symbol||l.ticker||"",shortName:l.name||l.symbol||l.ticker||"",market:l.market||"stock",country:l.country||"BD",exchange:l.exchange||"UNKNOWN",priceCurrency:l.currency||(l.country==="US"?"USD":"BDT"),type:l.type||"stock",logo:l.logo?l.logo.trim():l.symbol||l.ticker?`https://s3-api.bayah.app/cdn/symbol/logo/${l.symbol||l.ticker}.svg`:"",logo2:l.logo2,pricePrecision:l.pricePrecision,volumePrecision:l.volumePrecision,tickSize:l.tickSize??l.minTick??l.priceStep,lotSize:l.lotSize,contractSize:l.contractSize,minOrderSize:l.minOrderSize,corporateActions:Array.isArray(l.corporateActions)?l.corporateActions:Array.isArray(l.corporate_actions)?l.corporate_actions:void 0,corporateActionsUrl:l.corporateActionsUrl||l.corporate_actions_url||l.corporateActionsURL,adjustMode:l.adjustMode||l.adjust_mode},f=eS(c),u=t1(l.sessionRegular||l.session||f.regular)||void 0,d=t1(l.sessionExtended||l.extendedSession||f.extended)||void 0;return{...c,timezone:l.timezone||l.exchangeTimezone||f.timezone,session:u,sessionExtended:d,sessionTimezone:l.sessionTimezone||l.timezone}}).filter(l=>l.ticker&&l.ticker.trim()!=="");return console.log(`✅ Successfully processed ${a.length} valid symbols`),console.log("📋 Sample symbols:",a.slice(0,5)),a.length>0?a:[]}catch(e){return console.error("❌ Error fetching symbols from API:",e),console.log("🔄 Falling back to hardcoded symbols"),[]}}watch(e,t){var s;this._ws&&((s=this._ws)==null||s.send(JSON.stringify({action:"watch",key:e})),this.listens[e]=t)}subscribe(e,t){var o;if(((o=this._prevSymbol)==null?void 0:o.ticker)===e.ticker)return;this._prevSymbol=e,this.unsubscribe(),console.log(`Subscribing to real-time updates for ${e.ticker}`);const s=setInterval(()=>{const r=this.currentPriceCache.get(e.ticker)||Math.random()*100+10,a=(Math.random()-.5)*2,l=r+a;this.currentPriceCache.set(e.ticker,l);const f=[Date.now(),r,Math.max(r,l)+Math.random()*.5,Math.min(r,l)-Math.random()*.5,l,Math.random()*1e3];t({bars:[f],secs:1})},2e3);this.listens[e.ticker]=s}unsubscribe(e){this._ws&&(this._ws.close(),this._ws=void 0),Object.values(this.listens).forEach(s=>{typeof s=="number"&&clearInterval(s)}),this.listens={};const t=e==null?void 0:e.ticker;t&&this.pipeline.stopSymbol(t)}getCurrentPrice(e){return this.currentPriceCache.get(e)||null}clearCache(){this.pipeline.clear(),this.currentPriceCache.clear()}getPipelineMetrics(){return this.pipeline.getMetrics()}stopSymbolPipelines(e){this.pipeline.stopSymbol(e)}stopAllPipelines(){this.pipeline.stopAll()}getHistorySnapshot(e,t){const s=this.pipeline.getSnapshot(e,t);if(!s.candles.length)return s;const o=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),r=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),a=R1(e,this.dataOptions.timezone),l=this.applyTransforms(s.candles.slice(),e,o,r,a,t);return{...s,candles:l}}async ensureHistoryBefore(e,t,s,o=2500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const r=l=>{const c=l.oldestTimestampLoaded;return typeof s!="number"||!Number.isFinite(s)||s<=0?l.candles.length>0:c!=null&&c<=s},a=this.pipeline.getSnapshot(e,t);return r(a)||a.isComplete?a:await new Promise(l=>{let c=!1,f=null,u=null;const d=h=>{if(c)return;c=!0;try{f&&clearTimeout(f)}catch{}try{u==null||u()}catch{}const m=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),g=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),w=R1(e,this.dataOptions.timezone),C=this.applyTransforms(h.candles.slice(),e,m,g,w,t);l({...h,candles:C})};u=this.pipeline.subscribe(e,t,h=>{(r(h)||h.isComplete||h.error)&&d(h)}),f=setTimeout(()=>{d(this.pipeline.getSnapshot(e,t))},Math.max(100,o))})}async ensureHistoryCovers(e,t,s,o,r=3500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const a=c=>{const f=c.oldestTimestampLoaded,u=c.newestTimestampLoaded;return typeof s!="number"||!Number.isFinite(s)||s<=0||typeof o!="number"||!Number.isFinite(o)||o<=0?c.candles.length>0:f!=null&&u!=null&&f<=s&&u>=o},l=this.pipeline.getSnapshot(e,t);return a(l)||l.isComplete?l:await new Promise(c=>{let f=!1,u=null,d=null;const h=m=>{if(f)return;f=!0;try{u&&clearTimeout(u)}catch{}try{d==null||d()}catch{}const g=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),w=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),C=R1(e,this.dataOptions.timezone),M=this.applyTransforms(m.candles.slice(),e,g,w,C,t);c({...m,candles:M})};d=this.pipeline.subscribe(e,t,m=>{(a(m)||m.isComplete||m.error)&&h(m)}),u=setTimeout(()=>{h(this.pipeline.getSnapshot(e,t))},Math.max(100,r))})}normalizeSessionMode(e){const t=String(e||"").toLowerCase();return t==="extended"?"extended":t==="all"?"all":"regular"}normalizeAdjustMode(e){const t=String(e||"").toLowerCase();return t==="split"?"split":t==="dividend"?"dividend":t==="all"||t==="split_dividend"||t==="split+dividend"?"all":"none"}async ensureCorporateActions(e){const t=`${e.ticker}@${e.exchange||e.market||""}`,s=this.corporateActionsCache.get(t);if(s)return s;if(Array.isArray(e.corporateActions))return this.corporateActionsCache.set(t,e.corporateActions),e.corporateActions;if(this.corporateActionsInflight.has(t))return await this.corporateActionsInflight.get(t);const o=e.corporateActionsUrl;if(!o)return this.corporateActionsCache.set(t,[]),[];const r=(async()=>{try{const a=await fetch(o);if(!a.ok)return[];const l=await a.json(),c=Array.isArray(l)?l:Array.isArray(l==null?void 0:l.actions)?l.actions:Array.isArray(l==null?void 0:l.corporateActions)?l.corporateActions:[],f=Array.isArray(c)?c:[];return this.corporateActionsCache.set(t,f),f}catch{return this.corporateActionsCache.set(t,[]),[]}finally{this.corporateActionsInflight.delete(t)}})();return this.corporateActionsInflight.set(t,r),await r}applyTransforms(e,t,s,o,r,a){if(!e.length)return e;const l=g$(t,s);let c=e;this.shouldFilterBySession(a)&&s!=="all"&&l&&l!=="24x7"&&(c=this.filterBySession(c,l,r));const f=`${t.ticker}@${t.exchange||t.market||""}`,u=this.corporateActionsCache.get(f)||t.corporateActions;return u&&u.length&&o!=="none"&&(c=m$(c,u,o)),c}filterBySession(e,t,s){const o=[];for(const r of e){const a=(r==null?void 0:r.timestamp)??(r==null?void 0:r.time)??0,l=typeof a=="number"?a:Number(a),c=Number.isFinite(l)?l<1e11?l*1e3:l:0;c&&Xb(c,t,s)&&o.push(r)}return o}}function Ok(n){const{xVal:e,xloc:t,len:s,timeSeriesMs:o,tsIndex:r,config:a,warn:l,meta:c}=n;if(!Number.isFinite(e))return null;const f=!!(a!=null&&a.strictXloc),u=!!(a!=null&&a.allowFloatIndex),d=f&&t==="time"?0:Math.max(0,Number((a==null?void 0:a.futureBars)||0));if(t!=="time"){if(f&&!Number.isInteger(e))return null;const de=f||!u?Math.round(e):e;return!Number.isFinite(de)||de<0?null:de>s-1&&de<=s-1+d||de>=0&&de<s?de:null}const h=e<1e12?Math.floor(e*1e3):Math.floor(e),m=o.length;if(!m)return null;const g=f?0:Math.max(0,Number((a==null?void 0:a.toleranceBars)||0)),w=f?0:Math.max(0,Number((a==null?void 0:a.toleranceMs)||0)),C=Math.max(0,Number((a==null?void 0:a.avgIntervalMs)||0)),M=C>0?g*C:0,P=Math.max(w,M),T=o[m-1];o[0];const N=de=>{if(!l)return;const he=["[ScriptStudio] time anchor miss",c!=null&&c.kind?`kind=${c.kind}`:"",(c==null?void 0:c.id)!=null?`id=${c.id}`:"",`ts=${h}`,`mode=${(a==null?void 0:a.mode)||"nearest"}`,`tolBars=${g}`,`tolMs=${w}`,`reason=${de}`].filter(Boolean);l(he.join(" "))};if(h>T&&d>0){const de=h-T,he=C>0?Math.max(1,Math.round(de/C)):1;return he<=d?s-1+he:(N("future_out_of_range"),null)}let L=0,O=m;for(;L<O;){const de=L+O>>1;o[de]<h?L=de+1:O=de}const D=L<m?L:null,$=L-1>=0?L-1:null;let z=null;const te=f?"prev":(a==null?void 0:a.mode)||"nearest";if(te==="prev")z=$??D;else if(te==="next")z=D??$;else{const de=$!=null?Math.abs(o[$]-h):Number.POSITIVE_INFINITY,he=D!=null?Math.abs(o[D]-h):Number.POSITIVE_INFINITY;de<=he?z=$:z=D}if(z==null)return N("no_match"),null;const pe=o[z],J=Math.abs(pe-h),le=C>0?J/C:Math.abs(z-(L<m?L:m-1));return P>0&&J>P?(N("beyond_tolerance_ms"),null):g>0&&le>g?(N("beyond_tolerance_bars"),null):z}function dx(n,e,t){if(!Array.isArray(n)||n.length<=2)return n||[];const s=Math.max(1,Math.floor(t||1)),o=[];let r=null,a=null;for(let l=0;l<n.length;l++){const c=n[l];if(!c)continue;const{x:f,y:u}=e(c)||{};if(!Number.isFinite(f)||!Number.isFinite(u))continue;if(o.length===0){o.push(c),r={x:f,y:u};continue}const d=f-r.x,h=u-r.y,m=d!==0?h/d:null,g=Math.abs(d)>=s||Math.abs(h)>=s,w=m!=null&&a!=null?m*a<0:!1;(g||w||l===n.length-1)&&(o.push(c),r={x:f,y:u},a=m??a)}return o[o.length-1]!==n[n.length-1]&&o.push(n[n.length-1]),o}function zk(n){const{baseLeft:e,baseRight:t,extend:s,vpLeft:o,vpRight:r,lastIndex:a}=n||{};if(!Number.isFinite(e)||!Number.isFinite(t))return null;const l=Number.isFinite(a)?Math.max(0,a):Math.max(e,t),c=g=>Math.max(0,Math.min(l,g)),f=Number.isFinite(o)?c(o):c(e),u=Number.isFinite(r)?c(r):c(t),d=String(s||"none").toLowerCase();let h=e,m=t;return d==="both"?(h=f,m=u):d==="left"?h=f:d==="right"&&(m=u),{leftExt:c(h),rightExt:c(m)}}function bb(n){const{startIndex:e,endIndex:t,startValue:s,endValue:o,slope:r,intercept:a,extend:l,fromIndex:c,toIndex:f,yRange:u,toX:d,toY:h}=n||{};if(!Number.isFinite(e)||!Number.isFinite(t)||!Number.isFinite(s)||!Number.isFinite(o))return null;const m=String(l||"none").toLowerCase(),g={x1:e,y1:s,x2:t,y2:o},w=e===t,C=Number.isFinite(c)?c:e,M=Number.isFinite(f)?f:t;let P=r,T=a;!w&&(!Number.isFinite(P)||!Number.isFinite(T))&&(P=(o-s)/(t-e),T=s-P*e);let N={...g};if(m!=="none"){if(w){const D=Number(u==null?void 0:u.from),$=Number(u==null?void 0:u.to),z=Number.isFinite(D)&&Number.isFinite($)?Math.min(D,$):Math.min(s,o),te=Number.isFinite(D)&&Number.isFinite($)?Math.max(D,$):Math.max(s,o);N={x1:e,y1:te,x2:e,y2:z}}else if(Number.isFinite(P)&&Number.isFinite(T)){let D=e,$=t;m==="left"?D=C:m==="right"?$=M:m==="both"&&(D=C,$=M),N={x1:D,y1:P*D+T,x2:$,y2:P*$+T}}}const L={x1:d(g.x1),y1:h(g.y1),x2:d(g.x2),y2:h(g.y2)},O={x1:d(N.x1),y1:h(N.y1),x2:d(N.x2),y2:h(N.y2)};return!Number.isFinite(L.x1)||!Number.isFinite(L.y1)||!Number.isFinite(L.x2)||!Number.isFinite(L.y2)||!Number.isFinite(O.x1)||!Number.isFinite(O.y1)||!Number.isFinite(O.x2)||!Number.isFinite(O.y2)?null:{mode:m,vertical:w,base:L,extended:O,baseData:g,extendedData:N}}function Vk(n,e){const t=String(n||"solid").toLowerCase(),s=Number(e),o=Number.isFinite(s)&&s>=3;return t==="dashed"?o?[8,5]:[6,4]:t==="dotted"?o?[3,5]:[2,4]:[]}const Wk=new Map,fx=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function xb(n,e){return fx?(fx.font=e,fx.measureText(n).width):n.length*8}function K1(n){const e=n.text??"",t=n.font||'12px "Inter", system-ui, sans-serif',s=Number.isFinite(n.maxWidth)?Math.max(0,Number(n.maxWidth)):0,o=n.wrap===!0,r=(()=>{const w=t.match(/(\d+(?:\.\d+)?)px/),C=w?Number(w[1]):12;return Math.max(C+2,C*1.2)})(),a=Number.isFinite(n.lineHeight)?Number(n.lineHeight):r,l=`${t}|${s}|${o?"w":"n"}|${a}|${e}`,c=Wk.get(l);if(c)return c;const f=String(e).split(/\n/),u=[],d=w=>{if(!o||s<=0){u.push(w);return}const C=w.split(/\s+/).filter(Boolean);let M="";const P=()=>{M&&(u.push(M),M="")},T=N=>{if(!N)return;if(xb(N,t)>s&&s>4){P();let D="";for(const $ of N){const z=D+$;xb(z,t)>s&&D?(u.push(D),D=$):D=z}D&&u.push(D);return}const O=M?`${M} ${N}`:N;xb(O,t)>s&&M?(P(),M=N):M=O};for(const N of C)T(N);P()};f.forEach(w=>d(w)),u.length||u.push("");let h=0;for(const w of u)h=Math.max(h,xb(w,t));const m=u.length*a,g={lines:u,width:h,height:m,lineHeight:a};return Wk.set(l,g),g}const sR=1200,p_=new Map,oR=()=>{if(typeof window>"u")return 1;const n=window.devicePixelRatio||1;return Number.isFinite(n)&&n>0?n:1},iR=(n,e,t)=>JSON.stringify([n,e.font,e.color,e.strokeColor??"",Number.isFinite(e.strokeWidth)?e.strokeWidth:0,Number.isFinite(e.maxWidth)?e.maxWidth:"",e.wrap?1:0,Number.isFinite(e.lineHeight)?e.lineHeight:"",e.align||"left",t]),Hk=(n,e)=>{if(p_.has(n)&&p_.delete(n),p_.set(n,e),p_.size<=sR)return;const t=p_.keys().next().value;t&&p_.delete(t)},wb=(n,e)=>{if(typeof document>"u")return null;const t=String(n??"");if(!t)return{canvas:document.createElement("canvas"),width:0,height:0,lineHeight:Number.isFinite(e.lineHeight)?Number(e.lineHeight):14,lines:[],dpr:1};const s=oR(),o=iR(t,e,s),r=p_.get(o);if(r)return Hk(o,r),r;const a=K1({text:t,font:e.font,maxWidth:e.maxWidth,wrap:e.wrap===!0,lineHeight:e.lineHeight}),l=Math.max(1,Math.ceil(a.width)),c=Math.max(1,Math.ceil(a.height)),f=document.createElement("canvas");f.width=Math.ceil(l*s),f.height=Math.ceil(c*s);const u=f.getContext("2d");if(!u)return null;u.scale(s,s),u.font=e.font,u.textBaseline="top";const d=e.align||"left";u.textAlign=d,u.fillStyle=e.color,e.strokeWidth&&e.strokeWidth>0&&(u.lineWidth=e.strokeWidth,u.strokeStyle=e.strokeColor||"rgba(0,0,0,0.45)");const h=d==="center"?l/2:d==="right"?l:0;let m=0;for(const w of a.lines)e.strokeWidth&&e.strokeWidth>0&&u.strokeText(w,h,m),u.fillText(w,h,m),m+=a.lineHeight;const g={canvas:f,width:l,height:c,lineHeight:a.lineHeight,lines:a.lines,dpr:s};return Hk(o,g),g},t8=Object.freeze({interactionV2:!0,heatmapRasterV1:!0,webglRuntimeDrawV1:!0}),rR=t8,aR=n=>{},ev=n=>{const e=rR[n]??!1;return aR()??e},r6=new Map;function L0(n,e){n&&r6.set(n,e)}function o_(n){if(n)return r6.get(n)}function qk(n){n&&r6.delete(n)}const px=6,Nv=n=>typeof n=="number"&&Number.isFinite(n),z1=(n,e,t)=>n>=t.x&&e>=t.y&&n<=t.x+t.width&&e<=t.y+t.height,lR=n=>{if(!n)return null;const e=n.width,t=n.height;if(!Nv(e)||!Nv(t))return null;let s=n.x,o=n.y;const r=n.align||"center",a=n.valign||"middle";return r==="center"?s-=e/2:r==="right"&&(s-=e),a==="middle"?o-=t/2:a==="bottom"&&(o-=t),{x:s,y:o,width:e,height:t}},cR=n=>{if(!n||n.length<3)return null;let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const r of n)!Nv(r.x)||!Nv(r.y)||(r.x<e&&(e=r.x),r.x>s&&(s=r.x),r.y<t&&(t=r.y),r.y>o&&(o=r.y));return!Nv(e)||!Nv(t)||!Nv(s)||!Nv(o)?null:{x:e,y:t,width:s-e,height:o-t}},uR=(n,e)=>{let t=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const r=e[s],a=e[o];if(!r||!a)continue;r.y>n.y!=a.y>n.y&&n.x<(a.x-r.x)*(n.y-r.y)/(a.y-r.y+1e-7)+r.x&&(t=!t)}return t},mx=(n,e,t)=>{const s=t.x-e.x,o=t.y-e.y;if(s===0&&o===0)return Math.hypot(n.x-e.x,n.y-e.y);const r=((n.x-e.x)*s+(n.y-e.y)*o)/(s*s+o*o),a=Math.max(0,Math.min(1,r)),l=e.x+a*s,c=e.y+a*o;return Math.hypot(n.x-l,n.y-c)};function dR(n,e){return n.zIndex!==e.zIndex?e.zIndex-n.zIndex:n.createdAt!==e.createdAt?e.createdAt-n.createdAt:n.id<e.id?-1:n.id>e.id?1:0}function fR(n){return!Array.isArray(n)||n.length===0?null:n.reduce((e,t)=>e?dR(t,e)<0?t:e:t,null)}function n8(n,e,t){if(!Array.isArray(n)||!Nv(e)||!Nv(t))return null;const s=[],o={x:e,y:t};for(const r of n){if(!r||!Nv(r.zIndex)||!Nv(r.createdAt))continue;const a=r.id,l=r.type;if(l==="handle"){if(!r.rect)continue;z1(e,t,r.rect)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="label"){const c=r.rect??lR(r.anchor);if(!c)continue;z1(e,t,c)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="box"){if(!r.rect)continue;z1(e,t,r.rect)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="line"||l==="lineSegment"){if(!r.segment)continue;const c=mx(o,r.segment.a,r.segment.b),f=Nv(r.tolerance)?r.tolerance:px;c<=f&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:c});continue}if(l==="polyline"||l==="path"){const c=r.segments||[];if(!c.length){r.rect&&z1(e,t,r.rect)&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}const f=Nv(r.tolerance)?r.tolerance:px;let u=1/0;for(const d of c){const h=mx(o,d.a,d.b);if(h<u&&(u=h),u<=f)break}u<=f&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:u});continue}if(l==="polygon"){const c=r.polygon||[];if(c.length<3)continue;const f=r.rect??cR(c);if(f&&!z1(e,t,f))continue;if(uR(o,c)){s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}const u=Nv(r.tolerance)?r.tolerance:px;let d=1/0;for(let h=0;h<c.length;h++){const m=c[h],g=c[(h+1)%c.length];if(!m||!g)continue;const w=mx(o,m,g);if(w<d&&(d=w),d<=u)break}d<=u&&s.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:d});continue}}return fR(s)}const Uk=n=>typeof n=="number"&&Number.isFinite(n),W_=(n,e)=>!Uk(n)||!Uk(e)||e<=0?n:Math.round(n/e)*e;function Gk(n){return{snapOff:!!(n!=null&&n.altKey),axisLock:!!(n!=null&&n.shiftKey),strong:!1}}function Yk(n,e,t){return!e||t.snapOff?{time:n.time,price:n.price}:{time:W_(n.time,e.timeStep),price:W_(n.price,e.priceStep)}}function Kk(n,e,t){return!e||t.snapOff?{leftTime:n.leftTime,rightTime:n.rightTime,top:n.top,bottom:n.bottom}:{leftTime:W_(n.leftTime,e.timeStep),rightTime:W_(n.rightTime,e.timeStep),top:W_(n.top,e.priceStep),bottom:W_(n.bottom,e.priceStep)}}const pR=new Set(["box","label","line","lineSegment","polyline","polygon","path"]),s8=new Set(["n","s","e","w","ne","nw","se","sw"]);let Uc=null,Ou=null;const mR={snapOff:!1,axisLock:!1,strong:!1},cp=n=>typeof n=="number"&&Number.isFinite(n),Xk=n=>!!(n&&typeof n.toIndex=="function"&&typeof n.toValue=="function"&&typeof n.toX=="function"&&typeof n.toY=="function"),_2=n=>!!(n&&cp(n.leftIndex)&&cp(n.rightIndex)&&cp(n.topValue)&&cp(n.bottomValue)),_w=n=>!!(n&&cp(n.index)&&cp(n.value)),y2=(n,e,t)=>({x:n-t.x,y:e-t.y}),Zb=n=>n==="n"||n==="s"?"ns-resize":n==="e"||n==="w"?"ew-resize":n==="ne"||n==="sw"?"nesw-resize":"nwse-resize",hR=n=>n??mR,Zk=(n,e,t)=>t.axisLock?Math.abs(n)>=Math.abs(e)?{lockX:!1,lockY:!0}:{lockX:!0,lockY:!1}:{lockX:!1,lockY:!1},kb=(n,e,t)=>n?{timeStep:e?n.timeStep:Number.NaN,priceStep:t?n.priceStep:Number.NaN}:null;function Jk(n,e,t,s){var a;if(!ev("interactionV2"))return{};const o=hR(s);if(Ou){const l=y2(n,e,Ou.offset);let c=l.x-Ou.startX,f=l.y-Ou.startY;const u=Ou.handle.includes("e")||Ou.handle.includes("w"),d=Ou.handle.includes("n")||Ou.handle.includes("s");u||(c=0),d||(f=0);const{lockX:h,lockY:m}=Zk(c,f,o);h&&(c=0),m&&(f=0);let g=Ou.basePx.left,w=Ou.basePx.right,C=Ou.basePx.top,M=Ou.basePx.bottom;Ou.handle.includes("w")&&(g+=c),Ou.handle.includes("e")&&(w+=c),Ou.handle.includes("n")&&(C+=f),Ou.handle.includes("s")&&(M+=f);const P=Ou.axis.toIndex(g),T=Ou.axis.toIndex(w),N=Ou.axis.toValue(C),L=Ou.axis.toValue(M);if(!cp(P)||!cp(T)||!cp(N)||!cp(L))return{hoverId:Ou.targetId,resizingId:Ou.targetId,cursor:Zb(Ou.handle)};const O=kb(Ou.snap,u&&!h,d&&!m),D=Kk({leftTime:P,rightTime:T,top:N,bottom:L},O,o);let $=D.leftTime,z=D.rightTime,te=D.top,pe=D.bottom;const J=Math.max(2,Ou.minWidthIndex),le=Math.max(0,Ou.minHeightValue);z-$<J&&(Ou.handle.includes("w")?$=z-J:z=$+J),te-pe<le&&(Ou.handle.includes("n")?te=pe+le:pe=te-le);const de=o_(Ou.targetId);return L0(Ou.targetId,{box:{leftIndex:$,rightIndex:z,topValue:te,bottomValue:pe},hidden:de==null?void 0:de.hidden}),{hoverId:Ou.targetId,resizingId:Ou.targetId,cursor:Zb(Ou.handle)}}if(Uc){const l=y2(n,e,Uc.offset);let c=l.x-Uc.startX,f=l.y-Uc.startY;const{lockX:u,lockY:d}=Zk(c,f,o);u&&(c=0),d&&(f=0);const h=o_(Uc.id);if(Uc.type==="box"&&Uc.baseBox&&Uc.basePx){const m=Uc.axis.toIndex(Uc.basePx.left+c),g=Uc.axis.toIndex(Uc.basePx.right+c),w=Uc.axis.toValue(Uc.basePx.top+f),C=Uc.axis.toValue(Uc.basePx.bottom+f);if(cp(m)&&cp(g)&&cp(w)&&cp(C)){const M=kb(Uc.snap,!u,!d),P=Kk({leftTime:m,rightTime:g,top:w,bottom:C},M,o);L0(Uc.id,{box:{leftIndex:P.leftTime,rightIndex:P.rightTime,topValue:P.top,bottomValue:P.bottom},hidden:h==null?void 0:h.hidden})}}else if(Uc.type==="label"&&Uc.baseLabel&&Uc.baseAnchorPx){const m=Uc.axis.toIndex(Uc.baseAnchorPx.x+c),g=Uc.axis.toValue(Uc.baseAnchorPx.y+f);if(cp(m)&&cp(g)){const w=kb(Uc.snap,!u,!d),C=Yk({time:m,price:g},w,o);L0(Uc.id,{label:{index:C.time,value:C.price},hidden:h==null?void 0:h.hidden})}}else if(Uc.type==="shape"){const m=Uc.baseIndex,g=Uc.baseValue;if(cp(m)&&cp(g)){let w=Uc.axis.toIndex(l.x),C=Uc.axis.toValue(l.y);if(u&&(w=m),d&&(C=g),cp(w)&&cp(C)){const M=kb(Uc.snap,!u,!d),P=Yk({time:w,price:C},M,o),T=P.time-m,N=P.price-g,L=Uc.baseTranslate||{dxIndex:0,dyValue:0};L0(Uc.id,{translate:{dxIndex:L.dxIndex+T,dyValue:L.dyValue+N},hidden:h==null?void 0:h.hidden})}}}return{hoverId:Uc.id,draggingId:Uc.id,cursor:"grabbing"}}const r=n8(t,n,e);if(!r)return{};if(r.type==="handle"){const l=t.find(f=>f.id===r.id&&f.type===r.type),c=(a=l==null?void 0:l.handle)==null?void 0:a.position;if(c&&s8.has(c))return{hoverId:r.id,cursor:Zb(c)}}return{hoverId:r.id}}function vR(n,e,t){if(!ev("interactionV2"))return{};const s=n8(t,n,e);if(!s)return Uc=null,Ou=null,{};if(Uc=null,Ou=null,s.type==="handle"){const r=t.find(l=>l.id===s.id&&l.type===s.type),a=r==null?void 0:r.handle;if(a&&s8.has(a.position)){const l=t.find(w=>w.id===a.targetId&&w.type==="box"),c=l==null?void 0:l.axis,f=(l==null?void 0:l.offset)??{x:0,y:0},u=l==null?void 0:l.box,d=(l==null?void 0:l.snap)??null;if(!l||!Xk(c)||!_2(u))return{};const h=y2(n,e,f),m=o_(a.targetId),g=a.boundsPx;return Ou={targetId:a.targetId,handle:a.position,startX:h.x,startY:h.y,offset:f,axis:c,baseBounds:{...u},basePx:{left:g.left,right:g.right,top:g.top,bottom:g.bottom},minWidthIndex:Number(a.minWidthIndex)||2,minHeightValue:Number(a.minHeightValue)||0,originalEdit:m?{...m}:void 0,snap:d},{selectedId:a.targetId,resizingId:a.targetId,cursor:Zb(a.position)}}}const o=t.find(r=>r.id===s.id&&r.type===s.type);if(o&&pR.has(s.type)){const r=o.axis,a=o.offset??{x:0,y:0};if(!Xk(r))return{selectedId:s.id};const l=y2(n,e,a);if(s.type==="box"&&_2(o.box)){const c=r.toX(o.box.leftIndex),f=r.toX(o.box.rightIndex),u=r.toY(o.box.topValue),d=r.toY(o.box.bottomValue);cp(c)&&cp(f)&&cp(u)&&cp(d)&&(Uc={id:s.id,type:"box",startX:l.x,startY:l.y,offset:a,axis:r,baseBox:{...o.box},basePx:{left:c,right:f,top:u,bottom:d},snap:o.snap??null})}else if(s.type==="label"&&_w(o.label)){const c=r.toX(o.label.index),f=r.toY(o.label.value);cp(c)&&cp(f)&&(Uc={id:s.id,type:"label",startX:l.x,startY:l.y,offset:a,axis:r,baseLabel:{...o.label},baseAnchorPx:{x:c,y:f},snap:o.snap??null})}else{const c=r.toIndex(l.x),f=r.toValue(l.y);if(cp(c)&&cp(f)){const u=o_(s.id);Uc={id:s.id,type:"shape",startX:l.x,startY:l.y,offset:a,axis:r,baseIndex:c,baseValue:f,baseTranslate:u!=null&&u.translate?{...u.translate}:{dxIndex:0,dyValue:0},snap:o.snap??null}}}Ou=null}else Uc=null,Ou=null;return{selectedId:s.id,draggingId:Uc==null?void 0:Uc.id}}function yw(){if(!ev("interactionV2"))return{};if(Ou){const e=Ou.targetId;return Ou=null,{endedId:e}}if(!Uc)return{};const n=Uc.id;return Uc=null,{endedId:n}}function gR(n){if(ev("interactionV2")){if(Ou){const e=Ou.targetId;Ou.originalEdit?L0(e,Ou.originalEdit):qk(e),Ou=null;return}Uc&&(qk(Uc.id),Uc=null)}}function _R(n,e,t){if(!ev("interactionV2"))return{};if(!n||!n.id)return{};if(!cp(e)||!cp(t))return{};if(e===0&&t===0)return{};const s=o_(n.id),o=s!=null&&s.box&&_2(s.box)?s.box:n.box,r=s!=null&&s.label&&_w(s.label)?s.label:n.label;if(n.type==="box"&&_2(o))return L0(n.id,{box:{leftIndex:o.leftIndex+e,rightIndex:o.rightIndex+e,topValue:o.topValue+t,bottomValue:o.bottomValue+t},hidden:s==null?void 0:s.hidden}),{nudgedId:n.id};if(n.type==="label"&&_w(r))return L0(n.id,{label:{index:r.index+e,value:r.value+t},hidden:s==null?void 0:s.hidden}),{nudgedId:n.id};if(n.type==="line"||n.type==="lineSegment"||n.type==="polyline"||n.type==="polygon"||n.type==="path"){const a=(s==null?void 0:s.translate)??{dxIndex:0,dyValue:0};return L0(n.id,{translate:{dxIndex:a.dxIndex+e,dyValue:a.dyValue+t},hidden:s==null?void 0:s.hidden}),{nudgedId:n.id}}return{}}var yR=ta('<path d="M12.41465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L12.41465,12C12.20873,12.5826,11.65311,13,11,13C10.34689,13,9.79127,12.5826,9.58535,12L3.5,12C3.223857,12,3,11.77614,3,11.5C3,11.22386,3.223857,11,3.5,11L9.58535,11C9.79127,10.417404,10.34689,10,11,10C11.65311,10,12.20873,10.417404,12.41465,11Z" stroke-opacity="0" stroke="none"></path>'),bR=ta('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M2 9.75a1.5 1.5 0 0 0-1.5 1.5v5.5a1.5 1.5 0 0 0 1.5 1.5h24a1.5 1.5 0 0 0 1.5-1.5v-5.5a1.5 1.5 0 0 0-1.5-1.5zm0 1h3v2.5h1v-2.5h3.25v3.9h1v-3.9h3.25v2.5h1v-2.5h3.25v3.9h1v-3.9H22v2.5h1v-2.5h3a.5.5 0 0 1 .5.5v5.5a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-5.5a.5.5 0 0 1 .5-.5z" transform="rotate(-45 14 14)"></path></g>'),xR=ta('<path d="M21,5.5C21,6.32843,20.3284,7,19.5,7C19.4136,7,19.3289,6.99269,19.2465,6.97866L15.6257,15.5086C15.8587,15.7729,16,16.119999999999997,16,16.5C16,17.328400000000002,15.3284,18,14.5,18C13.8469,18,13.2913,17.5826,13.0854,17L3.91465,17C3.70873,17.5826,3.15311,18,2.5,18C1.671573,18,1,17.328400000000002,1,16.5C1,15.6716,1.671573,15,2.5,15C2.5840199999999998,15,2.66643,15.0069,2.74668,15.0202L6.36934,6.48574C6.13933,6.22213,6,5.87733,6,5.5C6,4.671573,6.67157,4,7.5,4C8.15311,4,8.70873,4.417404,8.91465,5L18.0854,5C18.2913,4.417404,18.8469,4,19.5,4C20.3284,4,21,4.671573,21,5.5ZM18.0854,6L8.91465,6C8.892579999999999,6.06243,8.8665,6.12296,8.83672,6.18128L13.9814,15.0921C14.143,15.0325,14.3177,15,14.5,15C14.584,15,14.6664,15.0069,14.7467,15.0202L18.3693,6.48574C18.2462,6.3446,18.149,6.1802,18.0854,6ZM13.2036,15.745L8.0861,6.8811800000000005C7.90605,6.95768,7.70797,7,7.5,7C7.41359,7,7.32888,6.99269,7.24647,6.97866L3.62571,15.5086C3.7512,15.651,3.8501,15.8174,3.91465,16L13.0854,16C13.1169,15.9108,13.1566,15.8255,13.2036,15.745Z" stroke-opacity="0" stroke="none"></path>'),wR=ta('<path d="M9.474616630859375,7.494615087890625L8.844736630859375,7.494615087890625L8.844736630859375,4.149892087890625L8.000006630859374,4.634915087890625L8.004896630859374,4.005035087890625L9.020516630859376,3.414215087890625L9.474616630859375,3.414215087890625L9.474616630859375,7.494615087890625ZM18.529296630859378,4.8318550878906255Q18.307996630859375,5.028795087890625,18.122396630859377,5.385245087890625Q17.868496630859376,5.019035087890625,17.629196630859376,4.8269750878906255Q17.389996630859375,4.634915087890625,17.168596630859376,4.634915087890625Q16.794296630859375,4.634915087890625,16.522496630859376,4.976715087890625Q16.252296630859377,5.3168850878906255,16.252296630859377,5.7856350878906255Q16.252296630859377,6.218575087890625,16.502896630859375,6.521315087890625Q16.755196630859373,6.822415087890625,17.114896630859377,6.822415087890625Q17.368796630859375,6.822415087890625,17.588596630859374,6.625475087890624Q17.809896630859377,6.428535087890625,17.998696630859374,6.0688350878906245Q18.249396630859373,6.439935087890625,18.488596630859377,6.631985087890625Q18.727896630859377,6.822415087890625,18.952496630859375,6.822415087890625Q19.326796630859373,6.822415087890625,19.596996630859376,6.482245087890625Q19.868796630859375,6.140455087890626,19.868796630859375,5.671705087890626Q19.868796630859375,5.238755087890625,19.618196630859376,4.937655087890625Q19.367496630859375,4.634915087890625,19.006196630859375,4.634915087890625Q18.750696630859377,4.634915087890625,18.529296630859378,4.8318550878906255ZM18.337296630859377,5.674955087890625L18.278696630859375,5.596835087890625Q18.449596630859375,5.272935087890625,18.622096630859374,5.1101750878906245Q18.794596630859374,4.947415087890625,18.967096630859373,4.947415087890625Q19.194996630859375,4.947415087890625,19.346396630859374,5.1345950878906255Q19.497696630859377,5.320135087890625,19.497696630859377,5.598455087890625Q19.497696630859377,5.8914250878906245,19.360996630859376,6.096505087890625Q19.224296630859374,6.301585087890626,19.027396630859375,6.301585087890626Q18.915096630859374,6.301585087890626,18.742496630859375,6.146965087890624Q18.569996630859375,5.992335087890625,18.337296630859377,5.674955087890625ZM17.785496630859377,5.779125087890625L17.842496630859372,5.857245087890625Q17.668296630859373,6.186025087890625,17.495796630859374,6.348785087890625Q17.324896630859374,6.509915087890625,17.153996630859375,6.509915087890625Q16.926096630859377,6.509915087890625,16.774796630859377,6.324375087890624Q16.623396630859375,6.137195087890625,16.623396630859375,5.858875087890625Q16.623396630859375,5.565905087890625,16.761696630859376,5.360825087890625Q16.900096630859373,5.1557550878906255,17.095396630859376,5.1557550878906255Q17.228896630859374,5.1557550878906255,17.365596630859375,5.2778250878906245Q17.502296630859377,5.399895087890625,17.785496630859377,5.779125087890625ZM10.710296630859375,10.634915087890626C10.710296630859375,11.024655087890626,10.561656630859375,11.379685087890625,10.317976630859375,11.646395087890625L12.879196630859376,15.171615087890626C12.985696630859374,15.147615087890625,13.096496630859376,15.134915087890626,13.210296630859375,15.134915087890626C13.306796630859376,15.134915087890626,13.401096630859374,15.144015087890624,13.492596630859374,15.161415087890624L16.819096630859377,11.196955087890625C16.748996630859374,11.023375087890624,16.710296630859375,10.833655087890625,16.710296630859375,10.634915087890626C16.710296630859375,9.806495087890625,17.381896630859373,9.134915087890626,18.210296630859375,9.134915087890626C19.038696630859373,9.134915087890626,19.710296630859375,9.806495087890625,19.710296630859375,10.634915087890626C19.710296630859375,11.463345087890625,19.038696630859373,12.134915087890626,18.210296630859375,12.134915087890626C17.949796630859375,12.134915087890626,17.704796630859377,12.068505087890625,17.491296630859374,11.951675087890624L14.364996630859375,15.677415087890624C14.580596630859375,15.937215087890625,14.710296630859375,16.270915087890625,14.710296630859375,16.634915087890626C14.710296630859375,17.463315087890624,14.038696630859375,18.134915087890626,13.210296630859375,18.134915087890626C12.381866630859374,18.134915087890626,11.710296630859375,17.463315087890624,11.710296630859375,16.634915087890626C11.710296630859375,16.284415087890626,11.830486630859374,15.962015087890626,12.031896630859375,15.706715087890625L9.425686630859374,12.119565087890624C9.355346630859376,12.129685087890625,9.283436630859375,12.134915087890626,9.210296630859375,12.134915087890626C8.872396630859374,12.134915087890626,8.560596630859376,12.023195087890626,8.309816630859375,11.834665087890626L5.215876630859375,15.521915087890624C5.519506630859375,15.796415087890624,5.710296630859375,16.193415087890624,5.710296630859375,16.634915087890626C5.710296630859375,17.463315087890624,5.038726630859375,18.134915087890626,4.210296630859375,18.134915087890626C3.381869630859375,18.134915087890626,2.710296630859375,17.463315087890624,2.710296630859375,16.634915087890626C2.710296630859375,15.806515087890626,3.381869630859375,15.134915087890626,4.210296630859375,15.134915087890626C4.218546630859375,15.134915087890626,4.226776630859375,15.135015087890626,4.234996630859375,15.135115087890625L7.744116630859375,10.953115087890625C7.721966630859375,10.850565087890626,7.710296630859375,10.744105087890624,7.710296630859375,10.634915087890626C7.710296630859375,9.806495087890625,8.381866630859374,9.134915087890626,9.210296630859375,9.134915087890626C10.038726630859376,9.134915087890626,10.710296630859375,9.806495087890625,10.710296630859375,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),kR=ta('<path d="M17.0643,7.033864912109375L18,3.585784912109375L14.5078,4.509695912109375L15.3537,5.344934912109375L6.02026,14.560584912109375C5.87635,14.517484912109374,5.72366,14.494284912109375,5.5655,14.494284912109375C4.7009,14.494284912109375,4,15.186384912109375,4,16.040084912109375C4,16.893784912109375,4.7009,17.585784912109375,5.5655,17.585784912109375C6.43011,17.585784912109375,7.13101,16.893784912109375,7.13101,16.040084912109375C7.13101,15.722284912109375,7.03392,15.426984912109376,6.86744,15.181384912109374L16.0917,6.073604912109375L17.0643,7.033864912109375Z" stroke-opacity="0" stroke="none"></path>'),SR=ta('<g transform="scale(0.7857142857)" fill="none"><path stroke="currentColor" d="M16 14a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4.5 14a9.5 9.5 0 0 1 18.7-2.37 2.5 2.5 0 0 0 0 4.74A9.5 9.5 0 0 1 4.5 14Zm19.7 2.5a10.5 10.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path><path fill="currentColor" d="M22.5 14a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></g>'),CR=ta('<path d="M18.8532,7.020985087890625Q19.0257,6.734525087890625,19.0257,6.369945087890625Q19.0257,6.020005087890625,18.8499,5.754705087890625Q18.6758,5.489415087890626,18.3649,5.339675087890625Q18.5944,5.209465087890625,18.7214,4.994615087890625Q18.8499,4.779775087890625,18.8499,4.5193550878906255Q18.8499,4.2003480878906245,18.7002,3.951324087890625Q18.5505,3.700673087890625,18.277,3.557444087890625Q18.0052,3.414215087890625,17.6455,3.414215087890625Q17.285800000000002,3.414215087890625,17.0107,3.557444087890625Q16.7357,3.700673087890625,16.5843,3.951324087890625Q16.4346,4.2003480878906245,16.4346,4.5193550878906255Q16.4346,4.779775087890625,16.561500000000002,4.994615087890625Q16.6901,5.209465087890625,16.919600000000003,5.339675087890625Q16.6055,5.489415087890626,16.4297,5.757965087890625Q16.255499999999998,6.024895087890625,16.255499999999998,6.369945087890625Q16.255499999999998,6.734525087890625,16.4297,7.020985087890625Q16.6055,7.305815087890625,16.919600000000003,7.465325087890625Q17.2354,7.624825087890625,17.6455,7.624825087890625Q18.0557,7.624825087890625,18.3682,7.465325087890625Q18.6807,7.305815087890625,18.8532,7.020985087890625ZM8.76432,7.559725087890625L8.13444,7.559725087890625L8.13444,4.214996087890625L7.28971,4.700025087890625L7.2946,4.070139087890625L8.310220000000001,3.479319087890625L8.76432,3.479319087890625L8.76432,7.559725087890625ZM17.1816,4.955555087890625Q17.0042,4.784655087890625,17.0042,4.5095950878906255Q17.0042,4.229645087890625,17.18,4.057119087890625Q17.355800000000002,3.884592087890625,17.6455,3.884592087890625Q17.935200000000002,3.884592087890625,18.1077,4.057119087890625Q18.2803,4.229645087890625,18.2803,4.5095950878906255Q18.2803,4.784655087890625,18.1045,4.955555087890625Q17.930300000000003,5.124825087890625,17.6455,5.124825087890625Q17.3607,5.124825087890625,17.1816,4.955555087890625ZM18.2217,5.7953950878906255Q18.4398,6.005365087890625,18.4398,6.3552950878906245Q18.4398,6.705235087890625,18.2217,6.915195087890625Q18.0052,7.125155087890625,17.6455,7.125155087890625Q17.285800000000002,7.125155087890625,17.067700000000002,6.915195087890625Q16.849600000000002,6.705235087890625,16.849600000000002,6.3552950878906245Q16.849600000000002,6.005365087890625,17.064500000000002,5.7953950878906255Q17.2793,5.585435087890625,17.6455,5.585435087890625Q18.0052,5.585435087890625,18.2217,5.7953950878906255ZM9.60768,11.711495087890626C9.85136,11.444785087890626,10,11.089765087890626,10,10.700025087890625C10,9.871595087890626,9.32843,9.200025087890625,8.5,9.200025087890625C7.67157,9.200025087890625,7,9.871595087890626,7,10.700025087890625C7,10.809205087890625,7.01167,10.915665087890625,7.03382,11.018215087890624L3.5247,15.200215087890625C3.51648,15.200115087890625,3.5082500000000003,15.200015087890625,3.5,15.200015087890625C2.671573,15.200015087890625,2,15.871615087890625,2,16.700015087890627C2,17.528415087890625,2.671573,18.200015087890627,3.5,18.200015087890627C4.32843,18.200015087890627,5,17.528415087890625,5,16.700015087890627C5,16.258515087890625,4.80921,15.861515087890625,4.50558,15.587015087890626L7.59952,11.899765087890625C7.8503,12.088295087890625,8.162099999999999,12.200025087890625,8.5,12.200025087890625C8.57314,12.200025087890625,8.645050000000001,12.194785087890626,8.71539,12.184675087890625L11.3216,15.771815087890625C11.12019,16.027215087890625,11,16.349515087890623,11,16.700015087890627C11,17.528415087890625,11.67157,18.200015087890627,12.5,18.200015087890627C13.3284,18.200015087890627,14,17.528415087890625,14,16.700015087890627C14,16.336015087890623,13.8703,16.002315087890626,13.6547,15.742515087890625L16.781,12.016775087890625C16.994500000000002,12.133605087890626,17.2395,12.200025087890625,17.5,12.200025087890625C18.3284,12.200025087890625,19,11.528445087890624,19,10.700025087890625C19,9.871595087890626,18.3284,9.200025087890625,17.5,9.200025087890625C16.671599999999998,9.200025087890625,16,9.871595087890626,16,10.700025087890625C16,10.898765087890624,16.0387,11.088475087890625,16.108800000000002,11.262055087890625L12.7823,15.226515087890625C12.6908,15.209115087890625,12.5965,15.200015087890625,12.5,15.200015087890625C12.3862,15.200015087890625,12.2754,15.212715087890626,12.1689,15.236715087890625L9.60768,11.711495087890626Z" stroke-opacity="0" stroke="none"></path>'),IR=ta('<ellipse cx="10.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="17.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="10.5" cy="11.5" rx="7" ry="7" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse>',1),PR=ta('<path d="M17,4.5C17,5.32843,16.328400000000002,6,15.5,6C15.0931,6,14.7241,5.83802,14.4539,5.57503L5.98992,8.32515C5.99658,8.38251,6,8.440850000000001,6,8.5C6,9.15311,5.582599999999999,9.70873,5,9.91465L5,11.08535C5.42621,11.236,5.763999999999999,11.57379,5.91465,12L19.5,12C19.7761,12,20,12.22386,20,12.5C20,12.77614,19.7761,13,19.5,13L5.91465,13C5.70873,13.5826,5.15311,14,4.5,14C3.671573,14,3,13.3284,3,12.5C3,11.84689,3.417404,11.29127,4,11.08535L4,9.91465C3.417404,9.70873,3,9.15311,3,8.5C3,7.67157,3.671573,7,4.5,7C4.90411,7,5.2709,7.15981,5.5406200000000005,7.41967L14.0093,4.66802C14.0032,4.6128599999999995,14,4.5568,14,4.5C14,3.671573,14.6716,3,15.5,3C16.328400000000002,3,17,3.671573,17,4.5ZM4,15.5C4,15.2239,4.22386,15,4.5,15L19.5,15C19.7761,15,20,15.2239,20,15.5C20,15.7761,19.7761,16,19.5,16L4.5,16C4.22386,16,4,15.7761,4,15.5ZM4,18.5C4,18.2239,4.22386,18,4.5,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L4.5,19C4.22386,19,4,18.7761,4,18.5Z" stroke-opacity="0" stroke="none"></path>'),MR=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M21 15H3a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2Zm-2-3a2.99 2.99 0 0 1-2.816-2H3a1 1 0 0 1 0-2h13.184A2.995 2.995 0 1 1 19 12Zm0-4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm2-3H3a1 1 0 0 1 0-2h18a1 1 0 1 1 0 2ZM5 16a2.99 2.99 0 0 1 2.816 2H21a1 1 0 0 1 0 2H7.816A2.995 2.995 0 1 1 5 16Zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"></path></g>'),NR=ta('<path d="M4,17.0854L4,3.5C4,3.223858,4.22386,3,4.5,3C4.77614,3,5,3.223858,5,3.5L5,10L7.57584,10L9.8127,4.46359C9.91614,4.20756,10.20756,4.08386,10.46359,4.1873000000000005C10.71963,4.29075,10.84333,4.58216,10.73988,4.8382000000000005L8.65438,10L11.08535,10C11.29127,9.4174,11.84689,9,12.5,9C12.65154,9,12.79784,9.02247,12.93573,9.06427L16.6464,5.35355C16.8417,5.15829,17.1583,5.15829,17.3536,5.35355C17.5488,5.54882,17.5488,5.8654,17.3536,6.06066L13.7475,9.66675C13.907,9.90508,14,10.19168,14,10.5C14,11.15311,13.5826,11.70873,13,11.91465L13,14.3638L18.3714,12.1936C18.6274,12.09015,18.918799999999997,12.21385,19.0222,12.46989C19.1257,12.72592,19.002,13.0173,18.746000000000002,13.1208L13,15.4423L13,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L5.91465,19C5.70873,19.5826,5.15311,20,4.5,20C3.671573,20,3,19.3284,3,18.5C3,17.846899999999998,3.417404,17.2913,4,17.0854ZM6.3729499999999994,17.0413L12,14.7678L12,11.91465C11.88136,11.87271,11.76956,11.81627,11.66675,11.74746L6.3729499999999994,17.0413ZM12,15.8463L6.6694700000000005,18L12,18L12,15.8463ZM6.38629,15.6137L8.250350000000001,11L11,11L6.38629,15.6137ZM5,11L7.17182,11L5,16.3754L5,11Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),AR=ta('<path d="M3,7.32468C5.90649,3.3893050000000002,11.49833,2.81306,14.6674,6.31944C14.9056,6.1554199999999994,15.192,6.05979,15.5,6.05979C15.845,6.05979,16.1628,6.17974,16.4162,6.381349999999999L18.4509,4.23827L19,4.816615L16.8945,7.03429C16.962600000000002,7.21075,17,7.40319,17,7.60463C17,8.45782,16.328400000000002,9.14947,15.5,9.14947C14.6716,9.14947,14,8.45782,14,7.60463C14,7.36402,14.0534,7.13625,14.1487,6.93322C11.32695,3.748365,6.25159,4.253956,3.612785,7.82695L3,7.32468ZM14.09,15.4717C15.7427,13.78985,16.244500000000002,11.524740000000001,15.5633,9.30134L15.5618,9.30134L16.3012,9.0502C17.072400000000002,11.56646,16.497700000000002,14.158,14.6282,16.0599C12.28737,18.442,8.62386,18.6988,6.41348,16.4501C4.5526,14.5572,4.52076,11.19671,6.36766,9.3177C7.89069,7.76754,10.07544,7.706189999999999,11.56741,9.22363C11.95453,9.61742,12.24817,10.08363,12.43369,10.57677L14.1451,8.77421L14.6942,9.35256L12.64982,11.50582C12.65827,11.59712,12.66295,11.68839,12.66378,11.77936C12.87398,12.04523,13,12.38451,13,12.7541C13,13.60729,12.32843,14.2989,11.5,14.2989C10.67157,14.2989,10,13.60729,10,12.7541C10,11.90091,10.67157,11.20926,11.5,11.20926C11.60387,11.20926,11.70528,11.220130000000001,11.8032,11.240829999999999L11.81763,11.22564C11.69858,10.71874,11.42858,10.21929,11.0284,9.81179C9.844000000000001,8.60765,8.136890000000001,8.65592,6.90822,9.90586C5.37975,11.460930000000001,5.40693,14.288,6.95404,15.8619C8.84598,17.7867,12.03496,17.5626,14.09,15.4717Z" stroke-opacity="0" stroke="none"></path>'),TR=ta('<path d="M8.13444,7.494615087890625L8.76432,7.494615087890625L8.76432,3.414215087890625L8.310220000000001,3.414215087890625L7.2946,4.005035087890625L7.28971,4.634915087890625L8.13444,4.149892087890625L8.13444,7.494615087890625ZM18.832,6.929835087890625Q19.0046,6.635245087890625,19.0046,6.2543850878906255Q19.0046,5.889805087890625,18.8451,5.5952050878906245Q18.6855,5.3006050878906255,18.3975,5.132965087890625Q18.1094,4.9653250878906245,17.7399,4.9653250878906245Q17.435499999999998,4.9653250878906245,17.1556,5.149245087890625L17.2793,3.939931087890625L18.8304,3.939931087890625L18.8304,3.414215087890625L16.7406,3.414215087890625L16.5094,5.665195087890625L17.0156,5.795405087890625Q17.095399999999998,5.655425087890626,17.2516,5.570795087890625Q17.4095,5.484525087890625,17.6357,5.484525087890625Q17.9694,5.484525087890625,18.1842,5.697745087890625Q18.4007,5.909335087890625,18.4007,6.2543850878906255Q18.4007,6.604315087890625,18.1842,6.822415087890625Q17.9694,7.0405150878906255,17.6292,7.0405150878906255Q17.3298,7.0405150878906255,17.119799999999998,6.890775087890625Q16.9098,6.739415087890626,16.825200000000002,6.474115087890625L16.3597,6.749175087890626Q16.470399999999998,7.110505087890624,16.807299999999998,7.335115087890625Q17.144199999999998,7.559725087890625,17.6292,7.559725087890625Q18.0296,7.559725087890625,18.3438,7.392075087890625Q18.6595,7.224435087890625,18.832,6.929835087890625ZM10,10.634915087890626C10,11.024655087890626,9.85136,11.379685087890625,9.60768,11.646395087890625L12.1689,15.171615087890626C12.2754,15.147615087890625,12.3862,15.134915087890626,12.5,15.134915087890626C12.5965,15.134915087890626,12.6908,15.144015087890624,12.7823,15.161415087890624L16.108800000000002,11.196955087890625C16.0387,11.023375087890624,16,10.833655087890625,16,10.634915087890626C16,9.806495087890625,16.671599999999998,9.134915087890626,17.5,9.134915087890626C18.3284,9.134915087890626,19,9.806495087890625,19,10.634915087890626C19,11.463345087890625,18.3284,12.134915087890626,17.5,12.134915087890626C17.2395,12.134915087890626,16.994500000000002,12.068505087890625,16.781,11.951675087890624L13.6547,15.677415087890624C13.8703,15.937215087890625,14,16.270915087890625,14,16.634915087890626C14,17.463315087890624,13.3284,18.134915087890626,12.5,18.134915087890626C11.67157,18.134915087890626,11,17.463315087890624,11,16.634915087890626C11,16.284415087890626,11.12019,15.962015087890626,11.3216,15.706715087890625L8.71539,12.119565087890624C8.645050000000001,12.129685087890625,8.57314,12.134915087890626,8.5,12.134915087890626C8.162099999999999,12.134915087890626,7.8503,12.023195087890626,7.59952,11.834665087890626L4.50558,15.521915087890624C4.80921,15.796415087890624,5,16.193415087890624,5,16.634915087890626C5,17.463315087890624,4.32843,18.134915087890626,3.5,18.134915087890626C2.671573,18.134915087890626,2,17.463315087890624,2,16.634915087890626C2,15.806515087890626,2.671573,15.134915087890626,3.5,15.134915087890626C3.5082500000000003,15.134915087890626,3.51648,15.135015087890626,3.5247,15.135115087890625L7.03382,10.953115087890625C7.01167,10.850565087890626,7,10.744105087890624,7,10.634915087890626C7,9.806495087890625,7.67157,9.134915087890626,8.5,9.134915087890626C9.32843,9.134915087890626,10,9.806495087890625,10,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),FR=ta('<path d="M20,3.5C20,4.15311,19.5826,4.70873,19,4.91465L19,18.5C19,18.7761,18.7761,19,18.5,19L4.91465,19C4.70873,19.5826,4.15311,20,3.5,20C2.671573,20,2,19.3284,2,18.5C2,17.846899999999998,2.417404,17.2913,3,17.0854L3,3.5C3,3.22386,3.22386,3,3.5,3L17.0854,3C17.2913,2.417404,17.846899999999998,2,18.5,2C19.3284,2,20,2.671573,20,3.5ZM17.0854,4C17.236,4.42621,17.5738,4.763999999999999,18,4.91465L18,8L14,8L14,4L17.0854,4ZM13,4L13,8L9,8L9,4L13,4ZM13,9L9,9L9,13L13,13L13,9ZM13,14L9,14L9,18L13,18L13,14ZM14,18L14,14L18,14L18,18L14,18ZM18,13L14,13L14,9L18,9L18,13ZM4.91465,18C4.763999999999999,17.5738,4.42621,17.236,4,17.0854L4,14L8,14L8,18L4.91465,18ZM4,8L4,4L8,4L8,8L4,8ZM8,9L8,13L4,13L4,9L8,9Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),LR=ta('<path d="M6.91465,11L11.08535,11C11.29127,10.417404,11.84689,10,12.5,10C13.15311,10,13.70873,10.417404,13.91465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L13.91465,12C13.70873,12.5826,13.15311,13,12.5,13C11.84689,13,11.29127,12.5826,11.08535,12L6.91465,12C6.70873,12.5826,6.15311,13,5.5,13C4.671573,13,4,12.32843,4,11.5C4,10.671573,4.671573,10,5.5,10C6.15311,10,6.70873,10.417404,6.91465,11Z" stroke-opacity="0" stroke="none"></path>'),ER=ta('<path d="M6.91465,12.5C6.70873,13.0826,6.15311,13.5,5.5,13.5C4.671573,13.5,4,12.82843,4,12C4,11.171573,4.671573,10.5,5.5,10.5C6.15311,10.5,6.70873,10.917404,6.91465,11.5L16.0853,11.5C16.2913,10.917404,16.846899999999998,10.5,17.5,10.5C18.328400000000002,10.5,19,11.171573,19,12C19,12.82843,18.328400000000002,13.5,17.5,13.5C16.846899999999998,13.5,16.2913,13.0826,16.0853,12.5L6.91465,12.5Z" stroke-opacity="0" stroke="none"></path>'),$R=ta('<path d="M5.80417,14.9887L4.62563,16.167299999999997C4.43037,16.3625,4.43037,16.6791,4.62563,16.8744C4.82089,17.0696,5.13748,17.0696,5.332739999999999,16.8744L6.62638,15.5807C7.75595,16.290100000000002,9.19328,16.7929,11,16.7929C16.165399999999998,16.7929,18.3323,12.64289,18.8866,11.36789C19.0378,10.99289,19.0378,10.59289,18.8866,10.21789C18.5549,9.45486,17.6456,7.66212,15.8617,6.34545L17.3536,4.853553C17.5488,4.658291,17.5488,4.341709,17.3536,4.146447C17.1583,3.9511845,16.8417,3.9511845,16.6464,4.146447L15.0014,5.7915399999999995C13.9314,5.1969,12.61166,4.792893,11,4.792893C5.80945,4.792893,3.667717,8.94289,3.113386,10.21789C2.9622049,10.59289,2.9622049,10.99289,3.113386,11.36789C3.424435,12.08333,4.2353000000000005,13.70399,5.80417,14.9887ZM7.36012,14.847C8.32327,15.4074,9.52286,15.7929,11,15.7929C15.5606,15.7929,17.4756,12.11789,17.9543,10.99289C18.0047,10.86789,18.0047,10.74289,17.9543,10.61789C17.659,9.90846,16.8171,8.23812,15.1447,7.06241L12.96929,9.23782C13.3134,9.66543,13.5197,10.20642,13.5197,10.79289C13.5197,12.16789,12.38583,13.29289,11,13.29289C10.41596,13.29289,9.87667,13.09308,9.44815,12.75896L7.36012,14.847ZM8.794609999999999,11.99829L6.520099999999999,14.2728C5.06905,13.12119,4.32057,11.628250000000001,4.04567,10.96789C3.995275,10.84289,3.995275,10.71789,4.04567,10.59289C4.52441,9.46789,6.43937,5.79289,11,5.79289C12.28868,5.79289,13.3661,6.086320000000001,14.2596,6.53329L12.19759,8.5953C11.84086,8.40257,11.43271,8.29289,11,8.29289C9.61417,8.29289,8.480319999999999,9.41789,8.480319999999999,10.79289C8.480319999999999,11.22918,8.594470000000001,11.64029,8.794609999999999,11.99829ZM10.16528,12.04183C10.404869999999999,12.20032,10.692070000000001,12.29289,11,12.29289C11.8315,12.29289,12.51181,11.61789,12.51181,10.79289C12.51181,10.48318,12.41593,10.194600000000001,12.25216,9.95494L10.16528,12.04183ZM11.43602,9.35687L9.55616,11.236740000000001C9.512,11.09633,9.48819,10.94724,9.48819,10.79289C9.48819,9.96789,10.1685,9.29289,11,9.29289C11.15142,9.29289,11.29782,9.31528,11.43602,9.35687Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),DR=ta('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),RR=ta('<defs><clipPath id="master_svg0_151_625"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_625)"><path d="M14.5385,9.76923L15.6538,9.76923C16.6538,9.76923,17.4615,10.576920000000001,17.4615,11.576920000000001L17.4615,17.1923C17.4615,18.1923,16.6538,19,15.6538,19L5.80769,19C4.807692,19,4,18.1923,4,17.1923L4,11.576920000000001C4,10.576920000000001,4.807692,9.76923,5.80769,9.76923L7.23077,9.76923L7.23077,7.576919999999999C7.23077,5.61538,8.88462,4,10.88462,4C12.88462,4,14.5385,5.61538,14.5385,7.576919999999999L14.5385,9.76923ZM10.88461,5.15385C9.5,5.15385,8.38461,6.23077,8.38461,7.576919999999999L8.38461,9.76923L13.38462,9.76923L13.38462,7.576919999999999C13.38462,6.23077,12.26923,5.15385,10.88461,5.15385ZM15.6538,17.8462C16,17.8462,16.3077,17.5385,16.3077,17.1923L16.3077,11.576920000000001C16.3077,11.23077,16,10.923079999999999,15.6538,10.923079999999999L5.80769,10.923079999999999C5.46154,10.923079999999999,5.15385,11.23077,5.15385,11.576920000000001L5.15385,17.1923C5.15385,17.5385,5.46154,17.8462,5.80769,17.8462L15.6538,17.8462ZM10.153839999999999,12.65385C10.153839999999999,12.34615,10.42307,12.07692,10.73076,12.07692C11.038450000000001,12.07692,11.307680000000001,12.34615,11.307680000000001,12.65385L11.307680000000001,14.5769C11.307680000000001,14.8846,11.038450000000001,15.1538,10.73076,15.1538C10.42307,15.1538,10.153839999999999,14.8846,10.153839999999999,14.5769L10.153839999999999,12.65385Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),jR=ta('<path d="M19.6401,7.99355C20.4028,7.92291,21,7.2811900000000005,21,6.5C21,5.671573,20.3284,5,19.5,5C18.8469,5,18.2913,5.417404,18.0854,6L7.62067,6C7.34453,6,7.12067,6.22386,7.12067,6.5C7.12067,6.5479,7.12741,6.59423,7.13999,6.63809L3.2294099999999997,15.0243C2.530138,15.1517,2,15.764,2,16.5C2,17.328400000000002,2.671573,18,3.5,18C4.15311,18,4.70873,17.5826,4.91465,17L14.5963,17C14.6456,17.076,14.7162,17.1396,14.8044,17.1807C15.0546,17.2974,15.3521,17.1891,15.4688,16.9388L19.6401,7.99355ZM14.7896,16.0293L18.6551,7.739599999999999C18.3942,7.56144,18.1925,7.30307,18.0854,7L8.0746,7L4.25044,15.2009C4.55701,15.3784,4.79493,15.6613,4.91465,16L14.6207,16C14.68,16,14.7368,16.0103,14.7896,16.0293Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),BR=ta('<path d="M3.3367688759765626,12.63173C3.5320318759765623,12.82699,3.8486138759765627,12.82699,4.043876875976562,12.63173L11.822052875976562,4.853553C12.017312875976563,4.658291,12.017312875976563,4.341708,11.822052875976562,4.146446C11.626792875976562,3.9511843,11.310202875976563,3.9511843,11.114942875976563,4.146446L3.3367688759765626,11.92462C3.1415071759765625,12.11988,3.1415071759765625,12.43647,3.3367688759765626,12.63173ZM5.001492875976562,17.0351C4.806232875976562,16.8399,4.806232875976562,16.5233,5.001492875976562,16.328L7.304532875976562,14.025C7.210822875976563,13.82916,7.158352875976563,13.60984,7.158352875976563,13.37827C7.158352875976563,12.54984,7.829922875976562,11.87827,8.658352875976561,11.87827C8.889922875976563,11.87827,9.109232875976563,11.93075,9.305052875976562,12.02446L11.304532875976562,10.02498C11.210822875976563,9.82916,11.158352875976561,9.60984,11.158352875976561,9.37827C11.158352875976561,8.54984,11.829922875976562,7.8782700000000006,12.658352875976563,7.8782700000000006C12.889922875976563,7.8782700000000006,13.109232875976563,7.93075,13.305022875976562,8.024460000000001L15.608122875976562,5.72142C15.803322875976562,5.5261499999999995,16.119922875976563,5.5261499999999995,16.315222875976563,5.72142C16.510422875976563,5.9166799999999995,16.510422875976563,6.23326,16.315222875976563,6.42852L14.012122875976562,8.73156C14.105822875976562,8.92738,14.158322875976562,9.1467,14.158322875976562,9.37827C14.158322875976562,10.2067,13.486822875976562,10.87827,12.658352875976563,10.87827C12.426772875976562,10.87827,12.207452875976562,10.82579,12.011642875976563,10.73209L10.012162875976562,12.73156C10.105872875976562,12.92738,10.158352875976561,13.1467,10.158352875976561,13.37827C10.158352875976561,14.2067,9.486772875976563,14.8783,8.658352875976561,14.8783C8.426772875976562,14.8783,8.207452875976562,14.8258,8.011642875976563,14.7321L5.708602875976562,17.0351C5.513342875976562,17.2304,5.196752875976562,17.2304,5.001492875976562,17.0351ZM10.415712875976563,18.328C10.220452875976562,18.5233,9.903862875976563,18.5233,9.708602875976563,18.328C9.513342875976562,18.1328,9.513342875976562,17.816200000000002,9.708602875976563,17.6209L12.304532875976562,15.025C12.210822875976563,14.8292,12.158352875976563,14.6098,12.158352875976563,14.3783C12.158352875976563,13.54984,12.829922875976562,12.87827,13.658322875976562,12.87827C13.889922875976563,12.87827,14.109222875976563,12.93075,14.305022875976562,13.02446L17.486822875976564,9.84274C17.682022875976564,9.64747,17.99862287597656,9.64747,18.19392287597656,9.84274C18.38912287597656,10.038,18.38912287597656,10.35458,18.19392287597656,10.54984L15.012122875976562,13.73156C15.105822875976562,13.92738,15.158322875976562,14.1467,15.158322875976562,14.3783C15.158322875976562,15.2067,14.486822875976562,15.8783,13.658322875976562,15.8783C13.426822875976562,15.8783,13.207422875976562,15.8258,13.011642875976563,15.7321L10.415712875976563,18.328Z" stroke-opacity="0" stroke="none"></path>'),OR=ta('<path d="M3.146447,14.178126025390625C2.9511847,13.982826025390626,2.9511847,13.666226025390625,3.146447,13.470926025390625L7.39146,9.225966025390626C7.35417,9.095106025390624,7.33421,8.956946025390625,7.33421,8.814116025390625C7.33421,7.985696025390625,8.00578,7.314116025390625,8.834209999999999,7.314116025390625C8.97703,7.314116025390625,9.11519,7.334086025390625,9.24605,7.371366025390625L13.753,2.864373025390625C13.9483,2.669110325390625,14.2649,2.669110325390625,14.4602,2.864373025390625C14.6554,3.059635025390625,14.6554,3.376217025390625,14.4602,3.571479025390625L10.06916,7.962476025390625C10.23631,8.204386025390626,10.334209999999999,8.497826025390625,10.334209999999999,8.814116025390625C10.334209999999999,9.642546025390626,9.66264,10.314116025390625,8.834209999999999,10.314116025390625C8.51791,10.314116025390625,8.22448,10.216226025390625,7.98256,10.049076025390626L3.853554,14.178126025390625C3.658291,14.373326025390625,3.341709,14.373326025390625,3.146447,14.178126025390625ZM7.67736,19.188526025390626C7.4821,18.993226025390626,7.4821,18.676626025390625,7.67736,18.481426025390626L9.9804,16.178326025390625C9.88669,15.982526025390625,9.834209999999999,15.763226025390624,9.834209999999999,15.531626025390626C9.834209999999999,14.703226025390626,10.50578,14.031626025390626,11.33421,14.031626025390626C11.56579,14.031626025390626,11.78511,14.084126025390624,11.98093,14.177826025390624L13.9804,12.178356025390626C13.8867,11.982536025390624,13.8342,11.763216025390625,13.8342,11.531636025390625C13.8342,10.703206025390624,14.5058,10.031636025390625,15.3342,10.031636025390625C15.5658,10.031636025390625,15.7851,10.084116025390625,15.9809,10.177826025390626L18.284,7.874796025390625C18.4792,7.679536025390625,18.7958,7.679536025390625,18.9911,7.874796025390625C19.1863,8.070056025390624,19.1863,8.386636025390626,18.9911,8.581906025390625L16.688000000000002,10.884936025390624C16.7817,11.080756025390626,16.8342,11.300066025390626,16.8342,11.531636025390625C16.8342,12.360066025390624,16.162599999999998,13.031626025390626,15.3342,13.031626025390626C15.1026,13.031626025390626,14.8833,12.979126025390626,14.6875,12.885426025390625L12.68803,14.884926025390625C12.78174,15.080726025390625,12.83421,15.300026025390626,12.83421,15.531626025390626C12.83421,16.360026025390624,12.16264,17.031626025390626,11.33421,17.031626025390626C11.10264,17.031626025390626,10.88333,16.979126025390627,10.68751,16.885426025390625L8.38446,19.188526025390626C8.1892,19.383726025390626,7.87262,19.383726025390626,7.67736,19.188526025390626Z" stroke-opacity="0" stroke="none"></path>'),zR=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="m2.285 10.333 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382Zm10 10 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382ZM19 8a2.966 2.966 0 0 1-1.308-.312l-10 10c.202.408.307.857.308 1.312a3.03 3.03 0 1 1-1.693-2.689l10-10A2.993 2.993 0 1 1 19 8ZM5 18a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM19 4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),VR=ta('<path d="M6.91465,13.00505L18.5,13.00505C18.7761,13.00505,19,13.228909999999999,19,13.50505C19,13.781189999999999,18.7761,14.00505,18.5,14.00505L6.91465,14.00505C6.70873,14.58765,6.15311,15.00505,5.5,15.00505C4.671573,15.00505,4,14.33348,4,13.50505C4,12.67662,4.671573,12.00505,5.5,12.00505C6.15311,12.00505,6.70873,12.422450000000001,6.91465,13.00505ZM7.81404,11.625L10.48591,11.625L10.48591,10.90625L9.65193,10.90625L9.65193,7.125L8.997630000000001,7.125C8.71443,7.306641,8.415600000000001,7.419922,7.96443,7.498047L7.96443,8.05078L8.77497,8.05078L8.77497,10.90625L7.81404,10.90625L7.81404,11.625ZM11.081620000000001,11.625L14.0562,11.625L14.0562,10.88281L13.09724,10.88281C12.8863,10.88281,12.59333,10.90625,12.36482,10.93555C13.17537,10.11328,13.84724,9.2207,13.84724,8.39062C13.84724,7.541016,13.28865,7,12.4488,7C11.84333,7,11.446850000000001,7.234375,11.03279,7.679688L11.52497,8.16797C11.747630000000001,7.914062,12.0113,7.697266,12.33552,7.697266C12.7613,7.697266,13.00154,7.982422,13.00154,8.43359C13.00154,9.14648,12.29255,10.00781,11.081620000000001,11.11523L11.081620000000001,11.625ZM15.9605,11.75C16.8121,11.75,17.526899999999998,11.2832,17.526899999999998,10.4375C17.526899999999998,9.82031,17.142200000000003,9.43945,16.6441,9.30078L16.6441,9.27148C17.1129,9.08594,17.3824,8.7207,17.3824,8.21289C17.3824,7.421875,16.8004,7,15.9429,7C15.4215,7,14.9957,7.210938,14.6109,7.541016L15.066,8.11133C15.3258,7.849609,15.5836,7.697266,15.9019,7.697266C16.2789,7.697266,16.4957,7.914062,16.4957,8.28125C16.4957,8.70898,16.2301,9,15.4215,9L15.4215,9.63672C16.3804,9.63672,16.6383,9.91992,16.6383,10.38086C16.6383,10.79688,16.3336,11.03125,15.8824,11.03125C15.4742,11.03125,15.1578,10.82227,14.8922,10.55078L14.4781,11.13281C14.7906,11.486329999999999,15.2652,11.75,15.9605,11.75Z" stroke-opacity="0" stroke="none"></path>'),WR=ta('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero"><path d="M8.354 20.354l5-5-.707-.707-5 5z"></path><path d="M16.354 12.354l8-8-.707-.707-8 8z"></path><path d="M14.5 15c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),HR=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3 6C3 7.30622 3.83481 8.41746 5 8.82929V15.1707C3.83481 15.5825 3 16.6938 3 18C3 19.6569 4.34315 21 6 21C7.30622 21 8.41746 20.1652 8.82929 19H15.1707C15.5825 20.1652 16.6938 21 18 21C19.6569 21 21 19.6569 21 18C21 16.6938 20.1652 15.5825 19 15.1707V8.82929C20.1652 8.41746 21 7.30622 21 6C21 4.34315 19.6569 3 18 3C16.6938 3 15.5825 3.83481 15.1707 5H8.82929C8.41746 3.83481 7.30622 3 6 3C4.34315 3 3 4.34315 3 6ZM6 7C6.55228 7 7 6.55228 7 6C7 5.44772 6.55228 5 6 5C5.44772 5 5 5.44772 5 6C5 6.55228 5.44772 7 6 7ZM17 15.1707V8.82929C16.1476 8.52801 15.472 7.85242 15.1707 7H8.82929C8.52801 7.85241 7.85241 8.52801 7 8.82929V15.1707C7.85241 15.472 8.52801 16.1476 8.82929 17H15.1707C15.472 16.1476 16.1476 15.472 17 15.1707ZM18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5C17.4477 5 17 5.44772 17 6C17 6.55228 17.4477 7 18 7ZM7 18C7 18.5523 6.55228 19 6 19C5.44772 19 5 18.5523 5 18C5 17.4477 5.44772 17 6 17C6.55228 17 7 17.4477 7 18ZM19 18C19 18.5523 18.5523 19 18 19C17.4477 19 17 18.5523 17 18C17 17.4477 17.4477 17 18 17C18.5523 17 19 17.4477 19 18Z"></path></g>'),qR=ta('<path d="M16.966900000000003,8.67144C16.6669,8.67144,16.4247,8.91558,16.4247,9.21802L16.4247,16.631500000000003C16.4247,17.322,16.007199999999997,17.9068,15.5139,17.9068L13.93072,17.9068L13.93072,9.2162C13.93072,8.91741,13.68675,8.67144,13.38855,8.67144C13.09036,8.67144,12.84639,8.91741,12.84639,9.21802L12.84639,17.9068L10.151810000000001,17.9068L10.151810000000001,9.21802C10.151810000000001,8.91741,9.90783,8.67144,9.609639999999999,8.67144C9.31145,8.67144,9.06747,8.91741,9.06747,9.219850000000001L9.06747,17.9068L7.48614,17.9068C6.99277,17.9068,6.5753,17.322,6.5753,16.631500000000003L6.5753,9.21802C6.5753,8.91558,6.333130000000001,8.67144,6.03313,8.67144C5.73313,8.67144,5.49096,8.91558,5.49096,9.21802L5.49096,16.631500000000003C5.49096,17.9378,6.385540000000001,19,7.48614,19L15.512,19C16.6127,19,17.509,17.9378,17.509,16.631500000000003L17.509,9.21802C17.509,8.91558,17.2669,8.67144,16.966900000000003,8.67144ZM18.4578,6.21183L4.542169,6.21183C4.243976,6.21183,4,6.45779,4,6.75841C4,7.05903,4.243976,7.30499,4.542169,7.30499L18.4578,7.30499C18.756,7.30499,19,7.05903,19,6.75841C19,6.45779,18.756,6.21183,18.4578,6.21183ZM8.68072,5.10045L14.3193,5.10045C14.6175,5.10045,14.8614,4.852666,14.8614,4.550225C14.8614,4.247783,14.6175,4,14.3193,4L8.68072,4C8.38253,4,8.13855,4.247783,8.13855,4.550225C8.13855,4.852666,8.38253,5.10045,8.68072,5.10045Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),UR=ta('<circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="1.5"></circle><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><circle cx="13.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M7.5 13.5 Q11 16.5 14.5 13.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>',1),GR=ta('<g fill="currentColor"><path d="M5 5h12v2h-5v10h-2V7H5z"></path></g>'),YR=ta('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M19.054 7.988a2.988 2.988 0 0 1-1.31-.312l-10 10a3.027 3.027 0 1 1-1.38-1.381l10-10a2.994 2.994 0 1 1 2.69 1.693Zm-14 10a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm14-14a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),KR=ta('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none"></path>'),XR=ta('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L19,12L16,15L12,11L8,15L4.5,18.5L3,20Z" stroke-opacity="0" stroke="none"></path>'),ZR=ta('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L21,20L3,20Z" stroke-opacity="0" stroke="none"></path>'),JR=ta('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none" fill="currentColor"></path>'),QR=ta('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),ej=ta('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect>',1),tj=ta('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),nj=ta('<path d="M6,4L6,20M12,2L12,22M18,3L18,21" stroke="currentColor" stroke-width="0.5"></path><path d="M4,8L6,8M6,16L8,16M10,6L12,6M12,16L14,16M16,7L18,7M18,13L20,13" stroke="currentColor" stroke-width="0.5"></path>',1),sj=ta('<g stroke-width="1.2" fill="none"><g stroke="#00E6D8"><line x1="3" y1="13" x2="6" y2="16"></line><line x1="6" y1="13" x2="3" y2="16"></line><line x1="3" y1="9" x2="6" y2="12"></line><line x1="6" y1="9" x2="3" y2="12"></line><line x1="3" y1="5" x2="6" y2="8"></line><line x1="6" y1="5" x2="3" y2="8"></line></g><g stroke="#FF4D4D"><circle cx="10.5" cy="10.5" r="1.8"></circle><circle cx="10.5" cy="14.5" r="1.8"></circle><circle cx="10.5" cy="18.5" r="1.8"></circle></g><g stroke="#00E6D8"><line x1="15" y1="9" x2="18" y2="12"></line><line x1="18" y1="9" x2="15" y2="12"></line><line x1="15" y1="5" x2="18" y2="8"></line><line x1="18" y1="5" x2="15" y2="8"></line></g></g>'),oj=ta('<path d="M5.146447,15.753C4.9511845,15.9483,4.9511845,16.2649,5.146447,16.4602C5.341709,16.6554,5.658291,16.6554,5.853554,16.4602L8.156600000000001,14.15711C8.352409999999999,14.25082,8.57173,14.3033,8.8033,14.3033C9.631730000000001,14.3033,10.3033,13.63172,10.3033,12.80329C10.3033,12.57172,10.250820000000001,12.352409999999999,10.157119999999999,12.15659L12.156600000000001,10.15711C12.352409999999999,10.250820000000001,12.571729999999999,10.30329,12.8033,10.30329C13.63173,10.30329,14.3033,9.63172,14.3033,8.80329C14.3033,8.57172,14.25082,8.352409999999999,14.15712,8.15659L16.4602,5.853553C16.6554,5.658291,16.6554,5.341709,16.4602,5.146447C16.2649,4.9511843,15.9483,4.9511843,15.753,5.146447L13.45001,7.449479999999999C13.25419,7.35577,13.03487,7.3032900000000005,12.8033,7.3032900000000005C11.97487,7.3032900000000005,11.3033,7.97487,11.3033,8.80329C11.3033,9.03487,11.35578,9.254190000000001,11.44949,9.450009999999999L9.450009999999999,11.449480000000001C9.254190000000001,11.35577,9.03487,11.30329,8.8033,11.30329C7.97487,11.30329,7.3033,11.97487,7.3033,12.80329C7.3033,13.03487,7.35578,13.25419,7.44949,13.45001L5.146447,15.753Z" stroke-opacity="0" stroke="none"></path>'),ij=ta('<defs><clipPath id="master_svg0_151_615"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_615)"><path d="M19.672,3.0673368C19.4417,2.9354008,19.1463,3.00292252,18.9994,3.2210900000000002L17.4588,5.50622L16.743299999999998,3.781253L13.9915,7.4662L13.9618,7.51108C13.8339,7.72862,13.8936,8.005659999999999,14.1004,8.15391L14.1462,8.183430000000001C14.3683,8.308720000000001,14.6511,8.25001,14.8022,8.047229999999999L16.4907,5.78571L17.246299999999998,7.60713L19.8374,3.7635389999999997L19.8651,3.717088C19.9871,3.484615,19.9023,3.199273,19.672,3.0673368ZM4.79974,8.462530000000001L10.117740000000001,3.252975C10.31381,3.0610145,10.63152,3.0610145,10.82759,3.252975L13.4115,5.78453C13.6076,5.976710000000001,13.6076,6.28833,13.4115,6.4805L8.093869999999999,11.69045C7.48847,12.28368,7.51659,13.3308,8.151309999999999,13.9528C8.786439999999999,14.5755,9.85421,14.6027,10.45961,14.0087L15.7768,8.79831C15.9729,8.60609,16.2909,8.60609,16.487099999999998,8.79831L19.0705,11.33026C19.2667,11.52244,19.2667,11.83406,19.0705,12.02623L13.7533,17.2366C11.32572,19.6158,7.30328,19.578,4.85679,17.1807C2.410298,14.7834,2.371331,10.84174,4.79974,8.462530000000001ZM12.3461,6.1325199999999995L10.47246,4.29654L5.51079,9.15889C3.477674,11.15076,3.510214,14.4688,5.56784,16.4847C7.62506,18.500999999999998,11.01117,18.5325,13.0439,16.540599999999998L15.6842,13.9529L14.2908,12.58718L15.0011,11.89161L16.394399999999997,13.2569L18.0056,11.67786L16.1323,9.84188L11.16985,14.7046C10.18764,15.6679,8.540980000000001,15.6494,7.51498,14.7184L7.44107,14.6487C6.4219,13.65,6.37771,11.98096,7.38362,10.994869999999999L10.02485,8.40693L8.624939999999999,7.03516L9.335180000000001,6.33919L10.73512,7.71099L12.3461,6.1325199999999995Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),rj=ta('<path d="M8.134443814697265,7.494615087890625L8.764323814697265,7.494615087890625L8.764323814697265,3.414215087890625L8.310223814697267,3.414215087890625L7.294603814697266,4.005035087890625L7.289713814697266,4.634915087890625L8.134443814697265,4.149892087890625L8.134443814697265,7.494615087890625ZM18.832003814697266,6.933095087890624Q19.004603814697266,6.635245087890625,19.004603814697266,6.2543850878906255Q19.004603814697266,5.884915087890625,18.845103814697264,5.593575087890625Q18.685503814697267,5.3006050878906255,18.399103814697266,5.136225087890625Q18.114303814697266,4.9702050878906245,17.754603814697266,4.9653250878906245L18.820603814697265,3.840647087890625L18.820603814697265,3.414215087890625L16.519203814697264,3.414215087890625L16.519203814697264,3.939931087890625L18.050803814697264,3.939931087890625L16.719403814697266,5.334785087890625L17.074203814697263,5.7205350878906245Q17.254903814697265,5.484525087890625,17.619503814697268,5.484525087890625Q17.980803814697268,5.484525087890625,18.187503814697266,5.689605087890625Q18.394203814697267,5.894685087890625,18.394203814697267,6.2543850878906255Q18.394203814697267,6.604315087890625,18.187503814697266,6.822415087890625Q17.980803814697268,7.0405150878906255,17.640603814697265,7.0405150878906255Q17.334603814697267,7.0405150878906255,17.124703814697266,6.890775087890625Q16.914703814697265,6.739415087890626,16.820303814697265,6.469225087890624L16.354803814697263,6.744295087890626Q16.480103814697266,7.125155087890625,16.821903814697265,7.341625087890625Q17.165403814697264,7.559725087890625,17.640603814697265,7.559725087890625Q18.039403814697266,7.559725087890625,18.348603814697267,7.393705087890625Q18.659503814697267,7.229315087890625,18.832003814697266,6.933095087890624ZM10.000003814697266,10.634915087890626C10.000003814697266,11.024655087890626,9.851363814697265,11.379685087890625,9.607683814697266,11.646395087890625L12.168903814697266,15.171615087890626C12.275403814697265,15.147615087890625,12.386203814697266,15.134915087890626,12.500003814697266,15.134915087890626C12.596503814697266,15.134915087890626,12.690803814697265,15.144015087890624,12.782303814697265,15.161415087890624L16.108803814697268,11.196955087890625C16.038703814697264,11.023375087890624,16.000003814697266,10.833655087890625,16.000003814697266,10.634915087890626C16.000003814697266,9.806495087890625,16.671603814697264,9.134915087890626,17.500003814697266,9.134915087890626C18.328403814697264,9.134915087890626,19.000003814697266,9.806495087890625,19.000003814697266,10.634915087890626C19.000003814697266,11.463345087890625,18.328403814697264,12.134915087890626,17.500003814697266,12.134915087890626C17.239503814697265,12.134915087890626,16.994503814697268,12.068495087890625,16.781003814697264,11.951675087890624L13.654703814697266,15.677415087890624C13.870303814697266,15.937215087890625,14.000003814697266,16.270915087890625,14.000003814697266,16.634915087890626C14.000003814697266,17.463315087890624,13.328403814697266,18.134915087890626,12.500003814697266,18.134915087890626C11.671573814697265,18.134915087890626,11.000003814697266,17.463315087890624,11.000003814697266,16.634915087890626C11.000003814697266,16.284415087890626,11.120193814697265,15.962015087890626,11.321603814697266,15.706715087890625L8.715393814697265,12.119565087890624C8.645053814697267,12.129685087890625,8.573143814697266,12.134915087890626,8.500003814697266,12.134915087890626C8.162103814697264,12.134915087890626,7.8503038146972655,12.023195087890626,7.599523814697266,11.834665087890626L4.505583814697266,15.521915087890624C4.809213814697266,15.796415087890624,5.000003814697266,16.193415087890624,5.000003814697266,16.634915087890626C5.000003814697266,17.463315087890624,4.328433814697266,18.134915087890626,3.5000038146972656,18.134915087890626C2.6715768146972656,18.134915087890626,2.0000038146972656,17.463315087890624,2.0000038146972656,16.634915087890626C2.0000038146972656,15.806515087890626,2.6715768146972656,15.134915087890626,3.5000038146972656,15.134915087890626C3.508253814697266,15.134915087890626,3.5164838146972657,15.135015087890626,3.524703814697266,15.135115087890625L7.033823814697266,10.953115087890625C7.011673814697265,10.850565087890626,7.000003814697266,10.744105087890624,7.000003814697266,10.634915087890626C7.000003814697266,9.806495087890625,7.671573814697266,9.134915087890626,8.500003814697266,9.134915087890626C9.328433814697267,9.134915087890626,10.000003814697266,9.806495087890625,10.000003814697266,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),aj=ta('<path d="M11.57625,6.9981C11.55099,6.999359999999999,11.52557,7,11.5,7C11.34,7,11.18584,6.97495,11.04125,6.9285499999999995L5.55401,16.4327C5.713760000000001,16.5905,5.83826,16.7839,5.91465,17L16.0854,17C16.2187,16.622700000000002,16.4987,16.314700000000002,16.8569,16.1445L11.57625,6.9981ZM12.50759,6.611219999999999C12.81005,6.336790000000001,13,5.94058,13,5.5C13,4.671573,12.32843,4,11.5,4C10.67157,4,10,4.671573,10,5.5C10,5.80059,10.08841,6.08052,10.24066,6.31522L4.64514,16.0069C4.59738,16.002299999999998,4.54896,16,4.5,16C3.671573,16,3,16.671599999999998,3,17.5C3,18.328400000000002,3.671573,19,4.5,19C5.15311,19,5.70873,18.5826,5.91465,18L16.0854,18C16.2913,18.5826,16.846899999999998,19,17.5,19C18.328400000000002,19,19,18.328400000000002,19,17.5C19,16.8365,18.5691,16.2735,17.971899999999998,16.075699999999998L12.50759,6.611219999999999Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),lj=ta('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" fill-rule="evenodd" d="M14 6a3 3 0 0 0-3 3v3h8.5a2.5 2.5 0 0 1 2.5 2.5v7a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 6 21.5v-7A2.5 2.5 0 0 1 8.5 12H10V9a4 4 0 0 1 8 0h-1a3 3 0 0 0-3-3zm-1 11a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6-2.5c0-.83.67-1.5 1.5-1.5h11c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 7 21.5v-7z"></path></g>'),cj=ta('<path d="M11.66558837890625,19C10.83716137890625,19,10.16558837890625,18.328400000000002,10.16558837890625,17.5C10.16558837890625,16.846899999999998,10.58298437890625,16.2913,11.16557337890625,16.0854L11.16557337890625,11.91464C10.58298437890625,11.70872,10.16558837890625,11.1531,10.16558837890625,10.5C10.16558837890625,9.8469,10.58298437890625,9.29128,11.16557337890625,9.08536L11.16557337890625,4.5C11.16557337890625,4.223857,11.38942837890625,4,11.66556837890625,4C11.94171837890625,4,12.16556837890625,4.223857,12.16556837890625,4.5L12.16556837890625,9.08535C12.74817837890625,9.291260000000001,13.16558837890625,9.846879999999999,13.16558837890625,10.5C13.16558837890625,11.153120000000001,12.74817837890625,11.708739999999999,12.16556837890625,11.91465L12.16556837890625,16.0854C12.74817837890625,16.2913,13.16558837890625,16.846899999999998,13.16558837890625,17.5C13.16558837890625,18.328400000000002,12.49401837890625,19,11.66558837890625,19Z" stroke-opacity="0" stroke="none"></path>'),uj=ta('<path d="M11.165603637695312,6.91465C11.748203637695312,6.70873,12.165603637695312,6.15311,12.165603637695312,5.5C12.165603637695312,4.671573,11.494033637695313,4,10.665603637695312,4C9.837176637695313,4,9.165603637695312,4.671573,9.165603637695312,5.5C9.165603637695312,6.15311,9.583007637695312,6.70873,10.165603637695312,6.91465L10.165603637695312,16.0854C9.583007637695312,16.2913,9.165603637695312,16.846899999999998,9.165603637695312,17.5C9.165603637695312,18.328400000000002,9.837176637695313,19,10.665603637695312,19C11.494033637695313,19,12.165603637695312,18.328400000000002,12.165603637695312,17.5C12.165603637695312,16.846899999999998,11.748203637695312,16.2913,11.165603637695312,16.0854L11.165603637695312,6.91465Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),dj=ta('<path d="M11,12.41465L11,18.5C11,18.7761,11.22386,19,11.5,19C11.77614,19,12,18.7761,12,18.5L12,12.41465C12.5826,12.20873,13,11.65311,13,11C13,10.34689,12.5826,9.79127,12,9.58535L12,3.5C12,3.223857,11.77614,3,11.5,3C11.22386,3,11,3.223857,11,3.5L11,9.58535C10.417404,9.79127,10,10.34689,10,11C10,11.65311,10.417404,12.20873,11,12.41465Z" stroke-opacity="0" stroke="none"></path>'),fj=ta('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" stroke-opacity="0" fill-opacity="1"></path>'),pj=ta('<path d="M4.727219638671875,8.007996215820313L9.973849638671876,2.7629472158203123C10.167279638671875,2.5696791158203123,10.480729638671875,2.5696791158203123,10.674169638671875,2.7629472158203123L13.223329638671874,5.311756215820313C13.416929638671874,5.505236215820313,13.416929638671874,5.8189862158203125,13.223329638671874,6.012466215820313L7.977129638671875,11.257906215820313C7.379859638671875,11.855176215820313,7.407609638671875,12.909396215820312,8.033809638671876,13.535596215820313C8.660409638671876,14.162596215820313,9.713849638671874,14.189996215820312,10.311129638671876,13.591896215820313L15.556929638671875,8.346066215820311C15.750429638671875,8.152526215820313,16.064229638671875,8.152526215820313,16.257629638671872,8.346066215820311L18.806529638671876,10.895266215820312C19.000029638671876,11.088746215820313,19.000029638671876,11.402496215820312,18.806529638671876,11.595976215820313L13.560629638671875,16.841796215820313C11.165619638671876,19.237196215820312,7.197149638671875,19.19919621582031,4.783499638671875,16.785496215820313C2.3698426386718747,14.371896215820312,2.331397638671875,10.403416215820313,4.727219638671875,8.007996215820313ZM12.172299638671875,5.662106215820312L10.323809638671875,3.8136162158203124L5.4287196386718755,8.709096215820313C3.422893638671875,10.714536215820312,3.4549956386718748,14.055196215820313,5.484999638671875,16.08479621582031C7.514609638671875,18.114796215820313,10.855289638671875,18.146496215820314,12.860719638671876,16.141096215820312L15.465629638671874,13.535796215820312L14.090929638671875,12.160756215820312L14.791629638671875,11.460436215820312L16.166229638671876,12.834996215820313L17.755829638671877,11.245226215820313L15.907729638671874,9.396736215820312L11.011839638671875,14.292596215820312C10.042809638671875,15.262396215820312,8.418249638671874,15.243796215820312,7.406019638671875,14.306496215820312L7.333099638671875,14.236296215820312C6.327599638671876,13.230796215820313,6.284009638671876,11.550396215820312,7.276419638671875,10.557586215820312L9.882199638671874,7.952026215820313L8.501079638671875,6.570906215820313L9.201789638671876,5.870186215820313L10.582939638671874,7.251336215820312L12.172299638671875,5.662106215820312Z" fill-rule="evenodd" fill-opacity="1" stroke="currentColor" stroke-width="0.5"></path>'),mj=ta('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero" stroke="currentColor" stroke-width="1"><path d="M20.449 8.505l2.103 9.112.974-.225-2.103-9.112zM13.943 14.011l7.631 4.856.537-.844-7.631-4.856zM14.379 11.716l4.812-3.609-.6-.8-4.812 3.609zM10.96 13.828l-4.721 6.744.819.573 4.721-6.744zM6.331 20.67l2.31-13.088-.985-.174-2.31 13.088zM9.041 7.454l1.995 3.492.868-.496-1.995-3.492z"></path><path d="M8.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM12.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),hj=ta('<path d="m19.45,17.57l-3.78,-9.16a0.92,0.92 0 0 0 -1.71,0l-3.78,9.16a0.92,0.92 0 1 0 1.71,0.71l0.77,-1.86l4.31,0l0.77,1.86a0.92,0.92 0 0 0 0.85,0.57a0.92,0.92 0 0 0 0.85,-1.28l0,0zm-6.03,-3.01l1.39,-3.37l1.39,3.37l-2.79,0zm-2.81,-0.8a0.92,0.92 0 0 0 -0.21,-1.29c-0.01,-0.01 -0.63,-0.47 -1.53,-1.46c1.67,-2.25 2.61,-4.82 2.99,-6.03l1.36,0a0.92,0.92 0 0 0 0,-1.85l-4.87,0l0,-0.84a0.92,0.92 0 0 0 -1.85,0l0,0.84l-4.87,0a0.92,0.92 0 0 0 0,1.85l8.28,0c-0.4,1.13 -1.14,2.92 -2.26,4.55c-1.32,-1.75 -1.81,-2.88 -1.81,-2.89a0.92,0.92 0 0 0 -1.7,0.71c0.02,0.06 0.61,1.44 2.22,3.53c0.04,0.05 0.08,0.1 0.12,0.15c-1.65,1.86 -3.27,3.02 -3.94,3.39a0.92,0.92 0 1 0 0.88,1.62c0.09,-0.05 2.04,-1.13 4.27,-3.59c0.95,1.01 1.6,1.49 1.64,1.52a0.92,0.92 0 0 0 1.29,-0.21l0,0z" id="svg_1"></path>'),vj=ta('<g id="svg_7"><path d="m10.02,1.07c-4.98,0 -9.28,4.05 -9.02,9.02c0.35,6.79 8.26,2.87 8.97,8.2a0.9,0.9 0 0 0 0.99,0.77a9.02,9.02 0 0 0 -0.94,-18zm1.77,16.4a0.51,0.51 0 0 1 -0.62,-0.35a4.51,4.51 0 0 0 -1.61,-2.3c-1.03,-0.78 -2.27,-1.08 -3.46,-1.38c-2.39,-0.59 -3.55,-0.99 -3.67,-3.43c-0.1,-1.87 0.58,-3.67 1.93,-5.08a7.84,7.84 0 0 1 5.66,-2.43a7.59,7.59 0 0 1 1.77,14.97z" id="svg_1"></path><path d="m13.04,14.42m-1.38,0a1.38,1.38 0 1 0 2.77,0a1.38,1.38 0 1 0 -2.77,0z" id="svg_2"></path><path d="m15.28,9.07m-1.13,0a1.13,1.13 0 1 0 2.26,0a1.13,1.13 0 1 0 -2.26,0z" id="svg_3"></path><path d="m14.23,6.93a1.13,1.13 0 1 0 -1.58,-0.19a1.13,1.13 0 0 0 1.58,0.19z" id="svg_4"></path><path d="m10.29,4.73m-0.97,0.58a1.13,1.13 0 1 0 1.93,-1.16a1.13,1.13 0 1 0 -1.93,1.16z" id="svg_5"></path><path d="m6.47,4.66a1.13,1.13 0 1 0 1.49,0.58a1.13,1.13 0 0 0 -1.49,-0.58z" id="svg_6"></path></g>'),gj=ta('<path d="m15.1,6.75c0,-2.31 -1.89,-4.18 -4.21,-4.18c-2.33,0 -4.21,1.87 -4.21,4.18c0,2.31 1.89,4.18 4.21,4.18c2.33,0 4.21,-1.87 4.21,-4.18m5.9,13.26c0.03,0.09 0.05,0.18 0.05,0.28c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98l0,0l-0.03,0c-0.26,-4.12 -3.69,-7.39 -7.9,-7.39c-4.21,0 -7.65,3.27 -7.91,7.39l-0.02,0l0,0c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98c0,-0.09 0.02,-0.18 0.04,-0.27c0.29,-3.74 2.66,-6.9 5.98,-8.3c-1.54,-1.12 -2.55,-2.92 -2.55,-4.97c0,-3.4 2.77,-6.15 6.19,-6.15c3.42,0 6.19,2.75 6.19,6.15a6.12,6.12 0 0 1 -2.39,4.85c3.48,1.33 6,4.56 6.31,8.41" fill="#515151" id="svg_1"></path>'),_j=ta('<g transform="scale(0.047 0.047)"><path d="M387.6 2.6C385.5 4.7 385 6.2 385 10C385 13.8 385.5 15.3 387.6 17.4L390.3 20H410.9H431.5L382.5 69L333.5 118L314.5 99C304.1 88.6 294.2 79.6 292.6 79C291 78.4 288.3 78.2 286.6 78.6C284.2 79 263.1 99.5 192.7 169.8C142.7 219.7 101.2 261.7 100.4 263.2C98.1 267.5 98.7 271.6 101.9 275.2C104.4 278 105.5 278.5 109.4 278.5H114L201.5 191L289 103.5L308.8 123.3L328.6 143H333.5H338.5L392.2 89.3L446 35.5V52.8C446 71.1 446.7 74.7 450.9 77C453.9 78.6 460.3 78.2 462.6 76.2C466.8 72.8 467 71.3 467 39C467 6.7 466.8 5.2 462.6 1.8C460.7 0.199996 457.1 -4.14997e-06 425.4 -4.14997e-06H390.3L387.6 2.6Z" fill="currentColor"></path><path d="M382.8 147.4C373.9 149.8 366 158.1 364.1 167.1C363.3 170.5 363 222 363 332V492H335.5H308L307.8 400.1L307.5 308.2L303.8 302.9C295.9 291.6 290.4 290.1 256.9 290C244 290 230.7 290.5 227.5 291.1C218.2 292.8 211 298.4 207.1 307C205.1 311.4 205 313.1 205 401.7V492H177.5H150V444.7C150 391.6 150 391.7 143 383.7C140.7 381.2 136.8 378.3 133.8 376.9C128.6 374.5 128 374.5 98 374.5H67.5L61.8 377.3C55.4 380.4 51.7 384.3 48.6 391C46.6 395.3 46.5 397.2 46.2 443.8L45.9 492H32.9C18.2 492 15.9 492.8 14 498.6C12.5 502.9 14.1 508.2 17.5 510.4C19.7 511.8 42.4 512 256 512C469.6 512 492.3 511.8 494.5 510.4C497.9 508.2 499.5 502.9 498 498.6C496.1 492.9 493.7 492 479.5 492H467V331.2C467 150.8 467.5 163.8 459.7 155.3C451.9 146.8 450.7 146.5 417 146.3C395.4 146.1 386.3 146.4 382.8 147.4ZM443.4 169.1L446 171.1V331.6V492H415H384V332V171.9L386.5 169.5L388.9 167H414.8C439.5 167 440.9 167.1 443.4 169.1ZM282.8 312.1C284.8 312.8 286.2 314.2 286.9 316.2C287.7 318.3 288 346.8 288 405.6V492H257H226V403.7C226 320.8 226.1 315.2 227.8 313.8C228.7 312.9 230.2 312 231 311.7C233.9 310.7 279.6 311 282.8 312.1ZM127.1 397.9C128.9 400.1 129 402.4 129 446.1V492H98H67L67.1 446.7C67.1 421.9 67.5 400.7 67.9 399.6C69.6 395.4 72.1 395 99.3 395.3C125.2 395.5 125.2 395.5 127.1 397.9Z" fill="currentColor"></path><path d="M69.2 295.5C65.3 298.7 64.4 302.7 66.4 307.4C69.3 314.4 78.6 315.6 83.5 309.8C91.5 300.3 78.6 287.5 69.2 295.5Z" fill="currentColor"></path><circle cx="2" cy="18" r="1" fill="currentColor"></circle></g>'),yj=ta('<g id="svg_4" transform="translate(-0.1 -0.1) scale(1.00914 1.00914) translate(0.1 0.1) scale(1.09 1.09) matrix(0.995 0 0 0.995 0 0)"><path d="m18.54,9.09c-0.21,-2.47 -1.25,-4.77 -2.96,-6.45c-1.73,-1.69 -3.96,-2.64 -6.3,-2.64c-1.25,0 -2.46,0.27 -3.61,0.78c-0.01,0 -0.01,0.02 -0.02,0.02c-0.02,0 -0.02,0.01 -0.03,0.01c-1.09,0.5 -2.06,1.21 -2.91,2.12c-0.86,0.92 -1.52,1.98 -1.99,3.18c-0.47,1.23 -0.72,2.54 -0.72,3.89c0,0.87 0.11,1.72 0.31,2.54c0,0.02 0.01,0.05 0.02,0.07c0.41,1.62 1.18,3.11 2.3,4.35c1.44,1.59 3.3,2.6 5.3,2.91c0.03,0 0.04,0.02 0.06,0.02c0.33,0.05 0.67,0.08 1.01,0.08l0.21,0c0.4,0 1.17,-0.03 1.8,-0.27c0.16,-0.07 0.29,-0.19 0.36,-0.36c0.07,-0.16 0.09,-0.35 0.03,-0.53c-0.1,-0.27 -0.34,-0.46 -0.61,-0.46c-0.07,0 -0.16,0.01 -0.23,0.03c-0.47,0.18 -1.1,0.21 -1.36,0.21l-0.1,0c0.1,-0.32 0.14,-0.67 0.05,-1.04c-0.15,-0.66 -0.64,-1.21 -1.57,-1.75l-0.39,-0.23c-0.62,-0.36 -0.96,-0.54 -1.16,-0.84c-0.2,-0.29 -0.34,-0.74 -0.51,-1.75c-0.13,-0.68 -0.47,-1.21 -1.01,-1.52c-0.37,-0.2 -0.8,-0.31 -1.32,-0.31c-0.36,0 -0.76,0.05 -1.18,0.15c-0.21,0.05 -0.41,0.11 -0.59,0.16c-0.08,-0.48 -0.12,-0.98 -0.12,-1.49c0,-3.04 1.47,-5.7 3.69,-7.24c0.01,0.28 0.07,0.57 0.19,0.84c0.3,0.7 0.92,1.14 1.84,1.33c0.05,0.01 0.08,0.01 0.12,0.01l0.04,0c0.09,0 0.39,0.01 0.71,0.14c0.43,0.19 0.68,0.51 0.76,1c0.2,1.56 0.42,4.38 0.14,5.29c-0.02,0.07 -0.03,0.15 -0.03,0.23c0,0.37 0.29,0.69 0.64,0.69c0.18,0 0.34,-0.08 0.46,-0.2c0.12,-0.13 2.76,-3.01 3.46,-3.97c0.08,-0.11 0.17,-0.21 0.26,-0.32c0.34,-0.43 0.69,-0.86 0.82,-1.51c0.15,-0.69 0,-1.46 -0.46,-2.41c-0.32,-0.68 -0.38,-0.98 -0.4,-1.1c0.02,-0.01 0.04,-0.02 0.06,-0.04c2.02,1.39 3.42,3.73 3.65,6.48c0.04,0.37 0.31,0.63 0.65,0.63l0.06,0c0.35,-0.01 0.61,-0.34 0.58,-0.73zm-15.35,3.47c0.3,0 0.53,0.05 0.71,0.15c0.18,0.12 0.29,0.28 0.34,0.56c0.2,1.07 0.37,1.79 0.76,2.34c0.38,0.53 0.86,0.79 1.58,1.21l0.03,0.01c0.1,0.06 0.23,0.13 0.35,0.2c0.74,0.43 0.9,0.72 0.94,0.86c0.03,0.14 -0.05,0.34 -0.15,0.54c-2.83,-0.58 -5.1,-2.74 -6.01,-5.6c0.42,-0.13 0.97,-0.27 1.45,-0.27zm9.6,-8.04c0.64,1.31 0.36,1.67 -0.21,2.37c-0.09,0.12 -0.19,0.23 -0.28,0.36c-0.35,0.48 -1.28,1.53 -2.09,2.43c0,-0.44 -0.02,-0.94 -0.06,-1.49c-0.08,-1.23 -0.22,-2.28 -0.22,-2.32l0,-0.04c-0.18,-0.99 -0.73,-1.71 -1.61,-2.07c-0.49,-0.2 -0.95,-0.22 -1.13,-0.22c-0.45,-0.11 -0.73,-0.3 -0.85,-0.55c-0.14,-0.3 -0.05,-0.74 0.04,-1.02c0.91,-0.38 1.88,-0.59 2.9,-0.59c1.11,0 2.16,0.24 3.13,0.67c-0.07,0.13 -0.13,0.3 -0.16,0.5c-0.04,0.49 0.12,1.1 0.54,1.97z" id="svg_1"></path><path d="m15.22,9.72c-2.63,0 -4.77,2.3 -4.77,5.14c0,2.84 2.13,5.14 4.77,5.14c2.64,0 4.78,-2.3 4.78,-5.14c0,-2.84 -2.15,-5.14 -4.78,-5.14zm0,8.88c-1.91,0 -3.48,-1.68 -3.48,-3.75c0,-2.07 1.56,-3.75 3.48,-3.75c1.93,0 3.49,1.68 3.49,3.75c0,2.07 -1.57,3.75 -3.49,3.75z" id="svg_2"></path><path d="m15.69,15.05l0,-2.37c0,-0.38 -0.29,-0.7 -0.64,-0.7c-0.36,0 -0.65,0.32 -0.65,0.7l0,2.66c0,0.19 0.07,0.35 0.19,0.49l1.16,1.27c0.12,0.12 0.28,0.2 0.46,0.2c0.17,0 0.33,-0.08 0.46,-0.2c0.11,-0.13 0.18,-0.31 0.18,-0.5c0,-0.19 -0.07,-0.36 -0.18,-0.49l-0.98,-1.06z" id="svg_3"></path></g>'),bj=ta('<path d="M8 5v14l11-7z" fill="currentColor"></path>'),xj=ta('<rect x="6" y="6" width="10" height="10" fill="currentColor"></rect>'),wj=ta('<path d="m21.62,13.73l-1.7,-1.37c0.08,-0.46 0.12,-0.94 0.12,-1.41c0,-0.47 -0.04,-0.94 -0.12,-1.41l1.7,-1.37c0.25,-0.21 0.35,-0.55 0.24,-0.85l-0.03,-0.07c-0.46,-1.24 -1.15,-2.38 -2.06,-3.37l-0.04,-0.05c-0.22,-0.24 -0.58,-0.34 -0.91,-0.23l-2.09,0.71c-0.78,-0.6 -1.64,-1.08 -2.57,-1.41l-0.41,-2.08c-0.07,-0.32 -0.33,-0.57 -0.67,-0.62l-0.08,-0.01c-1.34,-0.23 -2.76,-0.23 -4.1,0l-0.08,0.01c-0.34,0.05 -0.6,0.31 -0.67,0.62l-0.41,2.09c-0.93,0.33 -1.78,0.8 -2.55,1.4l-2.11,-0.71c-0.33,-0.11 -0.69,-0.02 -0.91,0.23l-0.04,0.05c-0.91,1.01 -1.6,2.14 -2.06,3.37l-0.03,0.07c-0.11,0.3 -0.01,0.65 0.24,0.85l1.72,1.38c-0.09,0.46 -0.12,0.93 -0.12,1.4c0,0.47 0.03,0.94 0.12,1.39l-1.72,1.39c-0.25,0.21 -0.35,0.55 -0.24,0.85l0.03,0.07c0.46,1.24 1.15,2.37 2.06,3.37l0.04,0.05c0.22,0.24 0.58,0.34 0.91,0.23l2.11,-0.71c0.77,0.6 1.62,1.07 2.55,1.4l0.41,2.09c0.07,0.32 0.33,0.57 0.67,0.62l0.08,0.01c0.67,0.12 1.36,0.18 2.05,0.18c0.69,0 1.38,-0.05 2.05,-0.18l0.08,-0.01c0.34,-0.05 0.6,-0.31 0.67,-0.62l0.41,-2.08c0.93,-0.33 1.8,-0.81 2.57,-1.41l2.09,0.71c0.33,0.11 0.69,0.01 0.91,-0.23l0.04,-0.05c0.91,-1.01 1.6,-2.14 2.06,-3.37l0.03,-0.07c0.11,-0.3 0.01,-0.64 -0.24,-0.85zm-3.53,-3.91c0.07,0.37 0.1,0.76 0.1,1.13c0,0.38 -0.03,0.77 -0.1,1.13l-0.18,0.99l1.93,1.55c-0.28,0.65 -0.66,1.25 -1.09,1.81l-2.4,-0.81l-0.81,0.64c-0.61,0.48 -1.3,0.85 -2.05,1.12l-0.99,0.35l-0.46,2.38c-0.72,0.08 -1.47,0.08 -2.19,0l-0.47,-2.38l-0.97,-0.36c-0.73,-0.26 -1.41,-0.64 -2.03,-1.12l-0.81,-0.64l-2.42,0.82c-0.44,-0.57 -0.8,-1.17 -1.09,-1.81l1.95,-1.58l-0.16,-0.97c-0.07,-0.36 -0.1,-0.74 -0.1,-1.12c0,-0.37 0.03,-0.74 0.1,-1.11l0.16,-0.97l-1.95,-1.58c0.3,-0.65 0.66,-1.25 1.09,-1.81l2.42,0.81l0.81,-0.62c0.61,-0.48 1.29,-0.85 2.03,-1.12l0.99,-0.35l0.46,-2.38c0.72,-0.09 1.47,-0.09 2.19,0l0.46,2.37l0.99,0.35c0.74,0.26 1.43,0.65 2.05,1.12l0.81,0.64l2.4,-0.81c0.44,0.57 0.81,1.17 1.11,1.81l-1.94,1.55l0.18,0.97zm-7.14,-3.42c-2.51,0 -4.54,1.93 -4.54,4.3c0,2.38 2.04,4.3 4.54,4.3c2.51,0 4.54,-1.93 4.54,-4.3c0,-2.38 -2.04,-4.3 -4.54,-4.3zm2.05,6.24c-0.55,0.51 -1.27,0.8 -2.05,0.8c-0.77,0 -1.5,-0.28 -2.05,-0.8c-0.54,-0.51 -0.84,-1.2 -0.84,-1.94c0,-0.73 0.31,-1.41 0.84,-1.94c0.55,-0.51 1.28,-0.8 2.05,-0.8c0.78,0 1.5,0.28 2.05,0.8c0.55,0.53 0.84,1.2 0.84,1.94c0,0.73 -0.3,1.42 -0.84,1.94z" id="svg_1"></path>'),kj=ta('<path d="m7.13,1l7.64,0c0.16,0 0.31,0.12 0.34,0.28l0.25,1.38c0.12,0.67 0.68,1.15 1.35,1.15l2.45,0c1.51,0 2.74,1.26 2.74,2.81l0,11.27c0,1.55 -1.23,2.81 -2.74,2.81l-16.43,0c-1.51,0 -2.74,-1.26 -2.74,-2.81l0,-11.27c0,-1.55 1.23,-2.81 2.74,-2.81l2.45,0c0.67,0 1.23,-0.48 1.35,-1.15l0.25,-1.38c0.03,-0.16 0.18,-0.28 0.34,-0.28zm9.58,4.23c-1.32,0 -2.45,-0.96 -2.69,-2.3l-0.1,-0.51l-5.93,0l-0.1,0.51c-0.24,1.34 -1.37,2.3 -2.69,2.3l-2.45,0c-0.76,0 -1.37,0.62 -1.37,1.4l0,11.27c0,0.78 0.61,1.4 1.37,1.4l16.43,0c0.76,0 1.37,-0.62 1.37,-1.4l0,-11.27c0,-0.78 -0.61,-1.4 -1.37,-1.4l-2.45,0zm-11.91,2.11l-1.37,0c-0.38,0 -0.69,-0.32 -0.69,-0.71c0,-0.38 0.31,-0.7 0.69,-0.7l1.37,0c0.37,0 0.68,0.32 0.68,0.7c0,0.39 -0.31,0.71 -0.68,0.71zm6.15,-0.71c-3.21,0 -5.81,2.68 -5.81,5.99c0,3.3 2.61,5.98 5.81,5.98c3.21,0 5.81,-2.68 5.81,-5.98c0,-3.31 -2.61,-5.99 -5.81,-5.99zm0,1.41c1.19,0 2.31,0.47 3.14,1.34c0.84,0.87 1.3,2.01 1.3,3.24c0,1.22 -0.46,2.37 -1.3,3.23c-0.83,0.87 -1.95,1.35 -3.14,1.35c-1.19,0 -2.31,-0.48 -3.14,-1.35c-0.84,-0.87 -1.3,-2.01 -1.3,-3.23c0,-1.23 0.46,-2.38 1.3,-3.24c0.83,-0.87 1.95,-1.34 3.14,-1.34zm0,2.46c-1.14,0 -2.05,0.94 -2.05,2.11c0,1.16 0.91,2.11 2.05,2.11c1.14,0 2.06,-0.95 2.06,-2.11c0,-1.17 -0.92,-2.11 -2.06,-2.11zm0,1.4c0.37,0 0.69,0.32 0.69,0.71c0,0.38 -0.32,0.7 -0.69,0.7c-0.37,0 -0.68,-0.32 -0.68,-0.7c0,-0.39 0.31,-0.71 0.68,-0.71z" id="svg_1"></path>'),Sj=ta('<path d="m1.08,0l-1.08,1.08l4.19,4.2l-1.64,1.64l4.36,0l0,-4.36l-1.62,1.62l-4.21,-4.18zm14.73,5.28l4.19,-4.2l-1.08,-1.08l-4.21,4.18l-1.62,-1.62l0,4.36l4.36,0l-1.64,-1.64zm-11.64,9.42l-4.09,4.11l1.08,1.19l4.11,-4.2l1.64,1.64l0,-4.36l-4.36,0l1.62,1.62zm13.28,-1.62l-4.36,0l0,4.36l1.64,-1.64l4.11,4.2l1.08,-1.19l-4.09,-4.11l1.62,-1.62z" id="svg_1" transform="scale(1.09 1.09)"></path>'),Cj=ta('<path d="m2.93,1.77l4.65,4.64l-1.19,1.19l-4.62,-4.67l-1.77,1.77l0,-4.7l4.7,0l-1.77,1.77zm3.48,10.63l-4.64,4.64l-1.77,-1.76l0,4.7l4.7,0l-1.77,-1.77l4.65,-4.64l-1.17,-1.17zm8.87,-12.4l1.76,1.77l-4.64,4.64l1.19,1.19l4.64,-4.64l1.77,1.76l0,-4.72l-4.72,0zm-1.71,12.4l-1.19,1.19l4.64,4.64l-1.77,1.77l4.73,0l0,-4.72l-1.77,1.76l-4.64,-4.64z" id="svg_1" transform="scale(1.095 1.095)"></path>'),Ij=ta('<path d="m12.24,4.81c2.72,0 4.93,2.2 4.93,4.92c0,0.01 0,0.03 0,0.05c-0.01,0.03 -0.01,0.07 -0.01,0.11l-0.02,0.75l0.75,0c1.81,0.01 3.27,1.48 3.27,3.28c0,1.8 -1.46,3.27 -3.26,3.28l-0.16,0l-13.36,0c-2.01,0 -3.65,-1.64 -3.65,-3.64c0,-1.56 0.99,-2.94 2.47,-3.45l0.41,-0.14l0.07,-0.42c0.18,-1.06 1.09,-1.83 2.16,-1.83c0.34,0 0.67,0.08 0.98,0.24l0.67,0.34l0.31,-0.68c0.82,-1.7 2.56,-2.81 4.44,-2.81l0,0.01zm0,-0.73c-2.24,0 -4.19,1.31 -5.1,3.22c-0.39,-0.2 -0.83,-0.31 -1.31,-0.31c-1.44,0 -2.64,1.05 -2.87,2.43c-1.72,0.59 -2.96,2.22 -2.96,4.14c0,2.42 1.96,4.37 4.37,4.37l13.52,0c2.2,-0.01 3.99,-1.8 3.99,-4.01c0,-2.21 -1.79,-4.01 -4,-4.01c0.01,-0.06 0.01,-0.12 0.01,-0.18c0,-3.12 -2.53,-5.65 -5.66,-5.65l0,0z" fill="#000000" id="svg_1"></path>'),Pj=ta('<path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path>'),Mj=ta('<g transform="scale(-1,1) translate(-24,0)"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path></g>'),Nj=ta('<g transform="scale(0.9166666667)"><path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M20 13H15.874C15.5122 14.4056 14.4056 15.5122 13 15.874V20C13 20.2652 12.8946 20.5196 12.7071 20.7071C12.5196 20.8946 12.2652 21 12 21C11.7348 21 11.4804 20.8946 11.2929 20.7071C11.1054 20.5196 11 20.2652 11 20V15.874C9.59439 15.5122 8.4878 14.4056 8.12602 13H4C3.73478 13 3.48043 12.8946 3.29289 12.7071C3.10536 12.5196 3 12.2652 3 12C3 11.7348 3.10536 11.4804 3.29289 11.2929C3.48043 11.1054 3.73478 11 4 11H8.12602C8.4878 9.59439 9.59439 8.4878 11 8.12602V4C11 3.73478 11.1054 3.48043 11.2929 3.29289C11.4804 3.10536 11.7348 3 12 3C12.2652 3 12.5196 3.10536 12.7071 3.29289C12.8946 3.48043 13 3.73478 13 4V8.12602C14.4056 8.4878 15.5122 9.59439 15.874 11H20C20.2652 11 20.5196 11.1054 20.7071 11.2929C20.8946 11.4804 21 11.7348 21 12C21 12.2652 20.8946 12.5196 20.7071 12.7071C20.5196 12.8946 20.2652 13 20 13ZM12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10Z"></path></g>'),Aj=ta('<rect x="3" y="4" width="16" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="0.5"></rect><rect x="13" y="4" width="6" height="14" rx="1" fill="currentColor" fill-opacity="0.3"></rect><line x1="13" y1="4" x2="13" y2="18" stroke="currentColor" stroke-width="0.5"></line>',1),Tj=ta('<div class="icon-fallback"> </div>'),Fj=ta('<svg class="icon-overlay fill-current svelte-19kzeyz" viewBox="0 0 22 22"><!></svg>');function Kv(n,e){let t=pi(e,"name",3,"none"),s=pi(e,"active",3,!1),o=pi(e,"size",3,32);var r=Fj(),a=y(r);Ye(a,()=>t()=="horizontalStraightLine",l=>{var c=yR();Y(l,c)},l=>{var c=Yn(),f=tn(c);Ye(f,()=>t()=="ruler",u=>{var d=bR();Y(u,d)},u=>{var d=Yn(),h=tn(d);Ye(h,()=>t()=="abcd",m=>{var g=xR();Y(m,g)},m=>{var g=Yn(),w=tn(g);Ye(w,()=>t()=="anyWaves",C=>{var M=wR();Y(C,M)},C=>{var M=Yn(),P=tn(M);Ye(P,()=>t()=="arrow",T=>{var N=kR();Y(T,N)},T=>{var N=Yn(),L=tn(N);Ye(L,()=>t()=="circle",O=>{var D=SR();Y(O,D)},O=>{var D=Yn(),$=tn(D);Ye($,()=>t()=="eightWaves",z=>{var te=CR();Y(z,te)},z=>{var te=Yn(),pe=tn(te);Ye(pe,()=>t()=="fibonacciCircle",J=>{var le=IR();Di(4),Y(J,le)},J=>{var le=Yn(),de=tn(le);Ye(de,()=>t()=="fibonacciExtension",he=>{var ge=PR();Y(he,ge)},he=>{var ge=Yn(),ae=tn(ge);Ye(ae,()=>t()=="fibonacciSegment",Ie=>{var ce=MR();Y(Ie,ce)},Ie=>{var ce=Yn(),je=tn(ce);Ye(je,()=>t()=="fibonacciSpeedResistanceFan",Ve=>{var We=NR();Y(Ve,We)},Ve=>{var We=Yn(),He=tn(We);Ye(He,()=>t()=="fibonacciSpiral",Ue=>{var et=AR();Y(Ue,et)},Ue=>{var et=Yn(),ft=tn(et);Ye(ft,()=>t()=="fiveWaves",it=>{var Lt=TR();Y(it,Lt)},it=>{var Lt=Yn(),Tt=tn(Lt);Ye(Tt,()=>t()=="gannBox",Pt=>{var St=FR();Y(Pt,St)},Pt=>{var St=Yn(),st=tn(St);Ye(st,()=>t()=="horizontalRayLine",xt=>{var Je=LR();Y(xt,Je)},xt=>{var Je=Yn(),Xe=tn(Je);Ye(Xe,()=>t()=="horizontalSegment",Be=>{var Qe=ER();Y(Be,Qe)},Be=>{var Qe=Yn(),ct=tn(Qe);Ye(ct,()=>t()=="invisible",Mt=>{var mt=$R();Y(Mt,mt)},Mt=>{var mt=Yn(),Ce=tn(mt);Ye(Ce,()=>t()=="visible",Te=>{var It=DR();Y(Te,It)},Te=>{var It=Yn(),$t=tn(It);Ye($t,()=>t()=="lock",Yt=>{var qn=RR();Di(),Y(Yt,qn)},Yt=>{var qn=Yn(),Vn=tn(qn);Ye(Vn,()=>t()=="parallelogram",Dn=>{var Wn=jR();Y(Dn,Wn)},Dn=>{var Wn=Yn(),pn=tn(Wn);Ye(pn,()=>t()=="parallelStraightLine",gn=>{var Qs=BR();Y(gn,Qs)},gn=>{var Qs=Yn(),Is=tn(Qs);Ye(Is,()=>t()=="priceChannelLine",Cs=>{var ro=OR();Y(Cs,ro)},Cs=>{var ro=Yn(),bs=tn(ro);Ye(bs,()=>t()=="priceChannelLineNew",zt=>{var Qt=zR();Y(zt,Qt)},zt=>{var Qt=Yn(),ho=tn(Qt);Ye(ho,()=>t()=="priceLine",ri=>{var jo=VR();Y(ri,jo)},ri=>{var jo=Yn(),Na=tn(jo);Ye(Na,()=>t()=="rayLine",ar=>{var Aa=WR();Y(ar,Aa)},ar=>{var Aa=Yn(),nr=tn(Aa);Ye(nr,()=>t()=="rect",hi=>{var Gc=HR();Y(hi,Gc)},hi=>{var Gc=Yn(),Pu=tn(Gc);Ye(Pu,()=>t()=="remove",wc=>{var cc=qR();Y(wc,cc)},wc=>{var cc=Yn(),ou=tn(cc);Ye(ou,()=>t()=="emoji",zu=>{var ja=UR();Di(3),Y(zu,ja)},zu=>{var ja=Yn(),nc=tn(ja);Ye(nc,()=>t()=="text",Bc=>{var Vu=GR();Y(Bc,Vu)},Bc=>{var Vu=Yn(),rf=tn(Vu);Ye(rf,()=>t()=="segment",co=>{var ll=YR();Y(co,ll)},co=>{var ll=Yn(),va=tn(ll);Ye(va,()=>t()=="candle",Vl=>{var kr=KR();Y(Vl,kr)},Vl=>{var kr=Yn(),Wr=tn(kr);Ye(Wr,()=>t()=="line",jl=>{var Xl=XR();Y(jl,Xl)},jl=>{var Xl=Yn(),Mu=tn(Xl);Ye(Mu,()=>t()=="area",Zu=>{var xo=ZR();Y(Zu,xo)},Zu=>{var xo=Yn(),Sr=tn(xo);Ye(Sr,()=>t()=="candle_solid",ql=>{var $f=JR();Y(ql,$f)},ql=>{var $f=Yn(),Cf=tn($f);Ye(Cf,()=>t()=="candle_stroke",tp=>{var mf=QR();Di(2),Y(tp,mf)},tp=>{var mf=Yn(),sc=tn(mf);Ye(sc,()=>t()=="candle_up_stroke",yd=>{var If=ej();Di(2),Y(yd,If)},yd=>{var If=Yn(),En=tn(If);Ye(En,()=>t()=="candle_down_stroke",ms=>{var js=tj();Di(2),Y(ms,js)},ms=>{var js=Yn(),Nn=tn(js);Ye(Nn,()=>t()=="ohlc",Io=>{var fo=nj();Di(),Y(Io,fo)},Io=>{var fo=Yn(),Ji=tn(fo);Ye(Ji,()=>t()=="point_and_figure",Gi=>{var Al=sj();Y(Gi,Al)},Gi=>{var Al=Yn(),Ii=tn(Al);Ye(Ii,()=>t()=="straightLine",Wo=>{var To=oj();Y(Wo,To)},Wo=>{var To=Yn(),Ba=tn(To);Ye(Ba,()=>t()=="strongMagnet",Pi=>{var qs=ij();Di(),Y(Pi,qs)},Pi=>{var qs=Yn(),mi=tn(qs);Ye(mi,()=>t()=="threeWaves",Er=>{var Za=rj();Y(Er,Za)},Er=>{var Za=Yn(),vi=tn(Za);Ye(vi,()=>t()=="triangle",$r=>{var Il=aj();Y($r,Il)},$r=>{var Il=Yn(),cl=tn(Il);Ye(cl,()=>t()=="unlock",kc=>{var uc=lj();Y(kc,uc)},kc=>{var uc=Yn(),Tl=tn(uc);Ye(Tl,()=>t()=="verticalRayLine",ur=>{var la=cj();Y(ur,la)},ur=>{var la=Yn(),Fl=tn(la);Ye(Fl,()=>t()=="verticalSegment",Oa=>{var ni=uj();Y(Oa,ni)},Oa=>{var ni=Yn(),vc=tn(ni);Ye(vc,()=>t()=="verticalStraightLine",gl=>{var za=dj();Y(gl,za)},gl=>{var za=Yn(),sl=tn(za);Ye(sl,()=>t()=="visiable",Oc=>{var Va=fj();Y(Oc,Va)},Oc=>{var Va=Yn(),Wa=tn(Va);Ye(Wa,()=>t()=="weakMagnet",uu=>{var ud=pj();Y(uu,ud)},uu=>{var ud=Yn(),Ll=tn(ud);Ye(Ll,()=>t()=="xabcd",vu=>{var Sc=mj();Y(vu,Sc)},vu=>{var Sc=Yn(),Ja=tn(Sc);Ye(Ja,()=>t()=="lang",ga=>{var Wu=hj();Y(ga,Wu)},ga=>{var Wu=Yn(),zc=tn(Wu);Ye(zc,()=>t()=="theme",eu=>{var Ud=vj();Y(eu,Ud)},eu=>{var Ud=Yn(),qf=tn(Ud);Ye(qf,()=>t()=="user",Uf=>{var dd=gj();Y(Uf,dd)},Uf=>{var dd=Yn(),Id=tn(dd);Ye(Id,()=>t()=="indicator",dc=>{var Gf=_j();Y(dc,Gf)},dc=>{var Gf=Yn(),Pd=tn(Gf);Ye(Pd,()=>t()=="timezone",af=>{var ol=yj();Y(af,ol)},af=>{var ol=Yn(),du=tn(ol);Ye(du,()=>t()=="play",Nu=>{var hf=bj();Y(Nu,hf)},Nu=>{var hf=Yn(),td=tn(hf);Ye(td,()=>t()=="stop",Cc=>{var Gd=xj();Y(Cc,Gd)},Cc=>{var Gd=Yn(),tu=tn(Gd);Ye(tu,()=>t()=="setting",Vc=>{var Yd=wj();Y(Vc,Yd)},Vc=>{var Yd=Yn(),Md=tn(Yd);Ye(Md,()=>t()=="screenShot",Au=>{var Kd=kj();Y(Au,Kd)},Au=>{var Kd=Yn(),Hu=tn(Kd);Ye(Hu,()=>t()=="exitFullScreen",Tu=>{var bd=Sj();Y(Tu,bd)},Tu=>{var bd=Yn(),gc=tn(bd);Ye(gc,()=>t()=="fullScreen",qu=>{var $d=Cj();Y(qu,$d)},qu=>{var $d=Yn(),np=tn($d);Ye(np,()=>t()=="cloud",Pf=>{var oe=Ij();Y(Pf,oe)},Pf=>{var oe=Yn(),we=tn(oe);Ye(we,()=>t()=="undo",K=>{var re=Pj();Y(K,re)},K=>{var re=Yn(),ke=tn(re);Ye(ke,()=>t()=="redo",ee=>{var Ee=Mj();Y(ee,Ee)},ee=>{var Ee=Yn(),ht=tn(Ee);Ye(ht,()=>t()=="crosshair",pt=>{var Nt=Nj();Y(pt,Nt)},pt=>{var Nt=Yn(),E=tn(Nt);Ye(E,()=>t()=="sidebar",I=>{var W=Aj();Di(2),Y(I,W)},I=>{var W=Tj(),Z=y(W,!0);_(W),Ne(()=>tt(Z,t())),Y(I,W)},!0),Y(pt,Nt)},!0),Y(ee,Ee)},!0),Y(K,re)},!0),Y(Pf,oe)},!0),Y(qu,$d)},!0),Y(Tu,bd)},!0),Y(Au,Kd)},!0),Y(Vc,Yd)},!0),Y(Cc,Gd)},!0),Y(Nu,hf)},!0),Y(af,ol)},!0),Y(dc,Gf)},!0),Y(Uf,dd)},!0),Y(eu,Ud)},!0),Y(ga,Wu)},!0),Y(vu,Sc)},!0),Y(uu,ud)},!0),Y(Oc,Va)},!0),Y(gl,za)},!0),Y(Oa,ni)},!0),Y(ur,la)},!0),Y(kc,uc)},!0),Y($r,Il)},!0),Y(Er,Za)},!0),Y(Pi,qs)},!0),Y(Wo,To)},!0),Y(Gi,Al)},!0),Y(Io,fo)},!0),Y(ms,js)},!0),Y(yd,If)},!0),Y(tp,mf)},!0),Y(ql,$f)},!0),Y(Zu,xo)},!0),Y(jl,Xl)},!0),Y(Vl,kr)},!0),Y(co,ll)},!0),Y(Bc,Vu)},!0),Y(zu,ja)},!0),Y(wc,cc)},!0),Y(hi,Gc)},!0),Y(ar,Aa)},!0),Y(ri,jo)},!0),Y(zt,Qt)},!0),Y(Cs,ro)},!0),Y(gn,Qs)},!0),Y(Dn,Wn)},!0),Y(Yt,qn)},!0),Y(Te,It)},!0),Y(Mt,mt)},!0),Y(Be,Qe)},!0),Y(xt,Je)},!0),Y(Pt,St)},!0),Y(it,Lt)},!0),Y(Ue,et)},!0),Y(Ve,We)},!0),Y(Ie,ce)},!0),Y(he,ge)},!0),Y(J,le)},!0),Y(z,te)},!0),Y(O,D)},!0),Y(T,N)},!0),Y(C,M)},!0),Y(m,g)},!0),Y(u,d)},!0),Y(l,c)}),_(r),Ne(()=>{Dt(r,"style",`width: ${o()??""}px; height: ${o()??""}px;`),rr(r,"active",s())}),Y(n,r)}var b2={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */b2.exports;(function(n,e){(function(){var t,s="4.17.21",o=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",f=500,u="__lodash_placeholder__",d=1,h=2,m=4,g=1,w=2,C=1,M=2,P=4,T=8,N=16,L=32,O=64,D=128,$=256,z=512,te=30,pe="...",J=800,le=16,de=1,he=2,ge=3,ae=1/0,Ie=9007199254740991,ce=17976931348623157e292,je=NaN,Ve=4294967295,We=Ve-1,He=Ve>>>1,Ue=[["ary",D],["bind",C],["bindKey",M],["curry",T],["curryRight",N],["flip",z],["partial",L],["partialRight",O],["rearg",$]],et="[object Arguments]",ft="[object Array]",it="[object AsyncFunction]",Lt="[object Boolean]",Tt="[object Date]",Pt="[object DOMException]",St="[object Error]",st="[object Function]",xt="[object GeneratorFunction]",Je="[object Map]",Xe="[object Number]",Be="[object Null]",Qe="[object Object]",ct="[object Promise]",Mt="[object Proxy]",mt="[object RegExp]",Ce="[object Set]",Te="[object String]",It="[object Symbol]",$t="[object Undefined]",Yt="[object WeakMap]",qn="[object WeakSet]",Vn="[object ArrayBuffer]",Dn="[object DataView]",Wn="[object Float32Array]",pn="[object Float64Array]",gn="[object Int8Array]",Qs="[object Int16Array]",Is="[object Int32Array]",Cs="[object Uint8Array]",ro="[object Uint8ClampedArray]",bs="[object Uint16Array]",zt="[object Uint32Array]",Qt=/\b__p \+= '';/g,ho=/\b(__p \+=) '' \+/g,ri=/(__e\(.*?\)|\b__t\)) \+\n'';/g,jo=/&(?:amp|lt|gt|quot|#39);/g,Na=/[&<>"']/g,ar=RegExp(jo.source),Aa=RegExp(Na.source),nr=/<%-([\s\S]+?)%>/g,hi=/<%([\s\S]+?)%>/g,Gc=/<%=([\s\S]+?)%>/g,Pu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wc=/^\w*$/,cc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ou=/[\\^$.*+?()[\]{}|]/g,zu=RegExp(ou.source),ja=/^\s+/,nc=/\s/,Bc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Vu=/\{\n\/\* \[wrapped with (.+)\] \*/,rf=/,? & /,co=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ll=/[()=,{}\[\]\/\s]/,va=/\\(\\)?/g,Vl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,kr=/\w*$/,Wr=/^[-+]0x[0-9a-f]+$/i,jl=/^0b[01]+$/i,Xl=/^\[object .+?Constructor\]$/,Mu=/^0o[0-7]+$/i,Zu=/^(?:0|[1-9]\d*)$/,xo=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Sr=/($^)/,ql=/['\n\r\u2028\u2029\\]/g,$f="\\ud800-\\udfff",Cf="\\u0300-\\u036f",tp="\\ufe20-\\ufe2f",mf="\\u20d0-\\u20ff",sc=Cf+tp+mf,yd="\\u2700-\\u27bf",If="a-z\\xdf-\\xf6\\xf8-\\xff",En="\\xac\\xb1\\xd7\\xf7",ms="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",js="\\u2000-\\u206f",Nn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Io="A-Z\\xc0-\\xd6\\xd8-\\xde",fo="\\ufe0e\\ufe0f",Ji=En+ms+js+Nn,Gi="['’]",Al="["+$f+"]",Ii="["+Ji+"]",Wo="["+sc+"]",To="\\d+",Ba="["+yd+"]",Pi="["+If+"]",qs="[^"+$f+Ji+To+yd+If+Io+"]",mi="\\ud83c[\\udffb-\\udfff]",Er="(?:"+Wo+"|"+mi+")",Za="[^"+$f+"]",vi="(?:\\ud83c[\\udde6-\\uddff]){2}",$r="[\\ud800-\\udbff][\\udc00-\\udfff]",Il="["+Io+"]",cl="\\u200d",kc="(?:"+Pi+"|"+qs+")",uc="(?:"+Il+"|"+qs+")",Tl="(?:"+Gi+"(?:d|ll|m|re|s|t|ve))?",ur="(?:"+Gi+"(?:D|LL|M|RE|S|T|VE))?",la=Er+"?",Fl="["+fo+"]?",Oa="(?:"+cl+"(?:"+[Za,vi,$r].join("|")+")"+Fl+la+")*",ni="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",gl=Fl+la+Oa,za="(?:"+[Ba,vi,$r].join("|")+")"+gl,sl="(?:"+[Za+Wo+"?",Wo,vi,$r,Al].join("|")+")",Oc=RegExp(Gi,"g"),Va=RegExp(Wo,"g"),Wa=RegExp(mi+"(?="+mi+")|"+sl+gl,"g"),uu=RegExp([Il+"?"+Pi+"+"+Tl+"(?="+[Ii,Il,"$"].join("|")+")",uc+"+"+ur+"(?="+[Ii,Il+kc,"$"].join("|")+")",Il+"?"+kc+"+"+Tl,Il+"+"+ur,vc,ni,To,za].join("|"),"g"),ud=RegExp("["+cl+$f+sc+fo+"]"),Ll=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,vu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Sc=-1,Ja={};Ja[Wn]=Ja[pn]=Ja[gn]=Ja[Qs]=Ja[Is]=Ja[Cs]=Ja[ro]=Ja[bs]=Ja[zt]=!0,Ja[et]=Ja[ft]=Ja[Vn]=Ja[Lt]=Ja[Dn]=Ja[Tt]=Ja[St]=Ja[st]=Ja[Je]=Ja[Xe]=Ja[Qe]=Ja[mt]=Ja[Ce]=Ja[Te]=Ja[Yt]=!1;var ga={};ga[et]=ga[ft]=ga[Vn]=ga[Dn]=ga[Lt]=ga[Tt]=ga[Wn]=ga[pn]=ga[gn]=ga[Qs]=ga[Is]=ga[Je]=ga[Xe]=ga[Qe]=ga[mt]=ga[Ce]=ga[Te]=ga[It]=ga[Cs]=ga[ro]=ga[bs]=ga[zt]=!0,ga[St]=ga[st]=ga[Yt]=!1;var Wu={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},zc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},eu={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ud={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qf=parseFloat,Uf=parseInt,dd=typeof F0=="object"&&F0&&F0.Object===Object&&F0,Id=typeof self=="object"&&self&&self.Object===Object&&self,dc=dd||Id||Function("return this")(),Gf=e&&!e.nodeType&&e,Pd=Gf&&!0&&n&&!n.nodeType&&n,af=Pd&&Pd.exports===Gf,ol=af&&dd.process,du=function(){try{var Jt=Pd&&Pd.require&&Pd.require("util").types;return Jt||ol&&ol.binding&&ol.binding("util")}catch{}}(),Nu=du&&du.isArrayBuffer,hf=du&&du.isDate,td=du&&du.isMap,Cc=du&&du.isRegExp,Gd=du&&du.isSet,tu=du&&du.isTypedArray;function Vc(Jt,rn,dn){switch(dn.length){case 0:return Jt.call(rn);case 1:return Jt.call(rn,dn[0]);case 2:return Jt.call(rn,dn[0],dn[1]);case 3:return Jt.call(rn,dn[0],dn[1],dn[2])}return Jt.apply(rn,dn)}function Yd(Jt,rn,dn,uo){for(var zs=-1,Hr=Jt==null?0:Jt.length;++zs<Hr;){var Ul=Jt[zs];rn(uo,Ul,dn(Ul),Jt)}return uo}function Md(Jt,rn){for(var dn=-1,uo=Jt==null?0:Jt.length;++dn<uo&&rn(Jt[dn],dn,Jt)!==!1;);return Jt}function Au(Jt,rn){for(var dn=Jt==null?0:Jt.length;dn--&&rn(Jt[dn],dn,Jt)!==!1;);return Jt}function Kd(Jt,rn){for(var dn=-1,uo=Jt==null?0:Jt.length;++dn<uo;)if(!rn(Jt[dn],dn,Jt))return!1;return!0}function Hu(Jt,rn){for(var dn=-1,uo=Jt==null?0:Jt.length,zs=0,Hr=[];++dn<uo;){var Ul=Jt[dn];rn(Ul,dn,Jt)&&(Hr[zs++]=Ul)}return Hr}function Tu(Jt,rn){var dn=Jt==null?0:Jt.length;return!!dn&&ee(Jt,rn,0)>-1}function bd(Jt,rn,dn){for(var uo=-1,zs=Jt==null?0:Jt.length;++uo<zs;)if(dn(rn,Jt[uo]))return!0;return!1}function gc(Jt,rn){for(var dn=-1,uo=Jt==null?0:Jt.length,zs=Array(uo);++dn<uo;)zs[dn]=rn(Jt[dn],dn,Jt);return zs}function qu(Jt,rn){for(var dn=-1,uo=rn.length,zs=Jt.length;++dn<uo;)Jt[zs+dn]=rn[dn];return Jt}function $d(Jt,rn,dn,uo){var zs=-1,Hr=Jt==null?0:Jt.length;for(uo&&Hr&&(dn=Jt[++zs]);++zs<Hr;)dn=rn(dn,Jt[zs],zs,Jt);return dn}function np(Jt,rn,dn,uo){var zs=Jt==null?0:Jt.length;for(uo&&zs&&(dn=Jt[--zs]);zs--;)dn=rn(dn,Jt[zs],zs,Jt);return dn}function Pf(Jt,rn){for(var dn=-1,uo=Jt==null?0:Jt.length;++dn<uo;)if(rn(Jt[dn],dn,Jt))return!0;return!1}var oe=Nt("length");function we(Jt){return Jt.split("")}function K(Jt){return Jt.match(co)||[]}function re(Jt,rn,dn){var uo;return dn(Jt,function(zs,Hr,Ul){if(rn(zs,Hr,Ul))return uo=Hr,!1}),uo}function ke(Jt,rn,dn,uo){for(var zs=Jt.length,Hr=dn+(uo?1:-1);uo?Hr--:++Hr<zs;)if(rn(Jt[Hr],Hr,Jt))return Hr;return-1}function ee(Jt,rn,dn){return rn===rn?Uu(Jt,rn,dn):ke(Jt,ht,dn)}function Ee(Jt,rn,dn,uo){for(var zs=dn-1,Hr=Jt.length;++zs<Hr;)if(uo(Jt[zs],rn))return zs;return-1}function ht(Jt){return Jt!==Jt}function pt(Jt,rn){var dn=Jt==null?0:Jt.length;return dn?Z(Jt,rn)/dn:je}function Nt(Jt){return function(rn){return rn==null?t:rn[Jt]}}function E(Jt){return function(rn){return Jt==null?t:Jt[rn]}}function I(Jt,rn,dn,uo,zs){return zs(Jt,function(Hr,Ul,Oi){dn=uo?(uo=!1,Hr):rn(dn,Hr,Ul,Oi)}),dn}function W(Jt,rn){var dn=Jt.length;for(Jt.sort(rn);dn--;)Jt[dn]=Jt[dn].value;return Jt}function Z(Jt,rn){for(var dn,uo=-1,zs=Jt.length;++uo<zs;){var Hr=rn(Jt[uo]);Hr!==t&&(dn=dn===t?Hr:dn+Hr)}return dn}function _e(Jt,rn){for(var dn=-1,uo=Array(Jt);++dn<Jt;)uo[dn]=rn(dn);return uo}function me(Jt,rn){return gc(rn,function(dn){return[dn,Jt[dn]]})}function Le(Jt){return Jt&&Jt.slice(0,Fu(Jt)+1).replace(ja,"")}function ye(Jt){return function(rn){return Jt(rn)}}function Se(Jt,rn){return gc(rn,function(dn){return Jt[dn]})}function Ge(Jt,rn){return Jt.has(rn)}function Ae(Jt,rn){for(var dn=-1,uo=Jt.length;++dn<uo&&ee(rn,Jt[dn],0)>-1;);return dn}function Rt(Jt,rn){for(var dn=Jt.length;dn--&&ee(rn,Jt[dn],0)>-1;);return dn}function nn(Jt,rn){for(var dn=Jt.length,uo=0;dn--;)Jt[dn]===rn&&++uo;return uo}var Xn=E(Wu),hn=E(zc);function is(Jt){return"\\"+Ud[Jt]}function Gs(Jt,rn){return Jt==null?t:Jt[rn]}function es(Jt){return ud.test(Jt)}function Mi(Jt){return Ll.test(Jt)}function Kn(Jt){for(var rn,dn=[];!(rn=Jt.next()).done;)dn.push(rn.value);return dn}function Es(Jt){var rn=-1,dn=Array(Jt.size);return Jt.forEach(function(uo,zs){dn[++rn]=[zs,uo]}),dn}function Qo(Jt,rn){return function(dn){return Jt(rn(dn))}}function sr(Jt,rn){for(var dn=-1,uo=Jt.length,zs=0,Hr=[];++dn<uo;){var Ul=Jt[dn];(Ul===rn||Ul===u)&&(Jt[dn]=u,Hr[zs++]=dn)}return Hr}function na(Jt){var rn=-1,dn=Array(Jt.size);return Jt.forEach(function(uo){dn[++rn]=uo}),dn}function Xr(Jt){var rn=-1,dn=Array(Jt.size);return Jt.forEach(function(uo){dn[++rn]=[uo,uo]}),dn}function Uu(Jt,rn,dn){for(var uo=dn-1,zs=Jt.length;++uo<zs;)if(Jt[uo]===rn)return uo;return-1}function xd(Jt,rn,dn){for(var uo=dn+1;uo--;)if(Jt[uo]===rn)return uo;return uo}function ul(Jt){return es(Jt)?Dr(Jt):oe(Jt)}function dr(Jt){return es(Jt)?Yi(Jt):we(Jt)}function Fu(Jt){for(var rn=Jt.length;rn--&&nc.test(Jt.charAt(rn)););return rn}var gi=E(eu);function Dr(Jt){for(var rn=Wa.lastIndex=0;Wa.test(Jt);)++rn;return rn}function Yi(Jt){return Jt.match(Wa)||[]}function Ki(Jt){return Jt.match(uu)||[]}var Xi=function Jt(rn){rn=rn==null?dc:ca.defaults(dc.Object(),rn,ca.pick(dc,vu));var dn=rn.Array,uo=rn.Date,zs=rn.Error,Hr=rn.Function,Ul=rn.Math,Oi=rn.Object,Nd=rn.RegExp,hr=rn.String,vr=rn.TypeError,_l=dn.prototype,ia=Hr.prototype,Zl=Oi.prototype,Bo=rn["__core-js_shared__"],Mf=ia.toString,Yc=Zl.hasOwnProperty,Lu=0,Ju=function(){var p=/[^.]+$/.exec(Bo&&Bo.keys&&Bo.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),Dd=Zl.toString,oc=Mf.call(Oi),Rd=dc._,Jl=Nd("^"+Mf.call(Yc).replace(ou,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Yf=af?rn.Buffer:t,An=rn.Symbol,yt=rn.Uint8Array,Rn=Yf?Yf.allocUnsafe:t,_n=Qo(Oi.getPrototypeOf,Oi),Vs=Oi.create,Ms=Zl.propertyIsEnumerable,$s=_l.splice,wo=An?An.isConcatSpreadable:t,Zo=An?An.iterator:t,ao=An?An.toStringTag:t,Ho=function(){try{var p=jn(Oi,"defineProperty");return p({},"",{}),p}catch{}}(),so=rn.clearTimeout!==dc.clearTimeout&&rn.clearTimeout,Wi=uo&&uo.now!==dc.Date.now&&uo.now,_c=rn.setTimeout!==dc.setTimeout&&rn.setTimeout,gu=Ul.ceil,El=Ul.floor,fu=Oi.getOwnPropertySymbols,Cr=Yf?Yf.isBuffer:t,ba=rn.isFinite,Pl=_l.join,_u=Qo(Oi.keys,Oi),Zr=Ul.max,Qi=Ul.min,os=uo.now,mo=rn.parseInt,er=Ul.random,gr=_l.reverse,fr=jn(rn,"DataView"),pr=jn(rn,"Map"),yu=jn(rn,"Promise"),Kc=jn(rn,"Set"),fd=jn(rn,"WeakMap"),Rr=jn(Oi,"create"),ic=fd&&new fd,Lc={},Ad=_p(fr),Gu=_p(pr),lf=_p(yu),pd=_p(Kc),Df=_p(fd),Li=An?An.prototype:t,nm=Li?Li.valueOf:t,Nf=Li?Li.toString:t;function nt(p){if(Si(p)&&!_o(p)&&!(p instanceof pu)){if(p instanceof Fp)return p;if(Yc.call(p,"__wrapped__"))return _f(p)}return new Fp(p)}var yv=function(){function p(){}return function(b){if(!no(b))return{};if(Vs)return Vs(b);p.prototype=b;var F=new p;return p.prototype=t,F}}();function Tv(){}function Fp(p,b){this.__wrapped__=p,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=t}nt.templateSettings={escape:nr,evaluate:hi,interpolate:Gc,variable:"",imports:{_:nt}},nt.prototype=Tv.prototype,nt.prototype.constructor=nt,Fp.prototype=yv(Tv.prototype),Fp.prototype.constructor=Fp;function pu(p){this.__wrapped__=p,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ve,this.__views__=[]}function Em(){var p=new pu(this.__wrapped__);return p.__actions__=Ip(this.__actions__),p.__dir__=this.__dir__,p.__filtered__=this.__filtered__,p.__iteratees__=Ip(this.__iteratees__),p.__takeCount__=this.__takeCount__,p.__views__=Ip(this.__views__),p}function Vg(){if(this.__filtered__){var p=new pu(this);p.__dir__=-1,p.__filtered__=!0}else p=this.clone(),p.__dir__*=-1;return p}function kg(){var p=this.__wrapped__.value(),b=this.__dir__,F=_o(p),H=b<0,be=F?p.length:0,Pe=rs(0,be,this.__views__),Ze=Pe.start,Ke=Pe.end,ut=Ke-Ze,Gt=H?Ke:Ze-1,fn=this.__iteratees__,$n=fn.length,cn=0,eo=Qi(ut,this.__takeCount__);if(!F||!H&&be==ut&&eo==ut)return Kh(p,this.__actions__);var Js=[];e:for(;ut--&&cn<eo;){Gt+=b;for(var Co=-1,ws=p[Gt];++Co<$n;){var Zn=fn[Co],Ss=Zn.iteratee,Fr=Zn.type,Ra=Ss(ws);if(Fr==he)ws=Ra;else if(!Ra){if(Fr==de)continue e;break e}}Js[cn++]=ws}return Js}pu.prototype=yv(Tv.prototype),pu.prototype.constructor=pu;function Fv(p){var b=-1,F=p==null?0:p.length;for(this.clear();++b<F;){var H=p[b];this.set(H[0],H[1])}}function Op(){this.__data__=Rr?Rr(null):{},this.size=0}function bu(p){var b=this.has(p)&&delete this.__data__[p];return this.size-=b?1:0,b}function ov(p){var b=this.__data__;if(Rr){var F=b[p];return F===c?t:F}return Yc.call(b,p)?b[p]:t}function $m(p){var b=this.__data__;return Rr?b[p]!==t:Yc.call(b,p)}function og(p,b){var F=this.__data__;return this.size+=this.has(p)?0:1,F[p]=Rr&&b===t?c:b,this}Fv.prototype.clear=Op,Fv.prototype.delete=bu,Fv.prototype.get=ov,Fv.prototype.has=$m,Fv.prototype.set=og;function sm(p){var b=-1,F=p==null?0:p.length;for(this.clear();++b<F;){var H=p[b];this.set(H[0],H[1])}}function vf(){this.__data__=[],this.size=0}function Dm(p){var b=this.__data__,F=Ln(b,p);if(F<0)return!1;var H=b.length-1;return F==H?b.pop():$s.call(b,F,1),--this.size,!0}function Rm(p){var b=this.__data__,F=Ln(b,p);return F<0?t:b[F][1]}function Nh(p){return Ln(this.__data__,p)>-1}function qh(p,b){var F=this.__data__,H=Ln(F,p);return H<0?(++this.size,F.push([p,b])):F[H][1]=b,this}sm.prototype.clear=vf,sm.prototype.delete=Dm,sm.prototype.get=Rm,sm.prototype.has=Nh,sm.prototype.set=qh;function ah(p){var b=-1,F=p==null?0:p.length;for(this.clear();++b<F;){var H=p[b];this.set(H[0],H[1])}}function Lv(){this.size=0,this.__data__={hash:new Fv,map:new(pr||sm),string:new Fv}}function x0(p){var b=Hs(this,p).delete(p);return this.size-=b?1:0,b}function Sg(p){return Hs(this,p).get(p)}function Ev(p){return Hs(this,p).has(p)}function bv(p,b){var F=Hs(this,p),H=F.size;return F.set(p,b),this.size+=F.size==H?0:1,this}ah.prototype.clear=Lv,ah.prototype.delete=x0,ah.prototype.get=Sg,ah.prototype.has=Ev,ah.prototype.set=bv;function lh(p){var b=-1,F=p==null?0:p.length;for(this.__data__=new ah;++b<F;)this.add(p[b])}function ch(p){return this.__data__.set(p,c),this}function ig(p){return this.__data__.has(p)}lh.prototype.add=lh.prototype.push=ch,lh.prototype.has=ig;function uh(p){var b=this.__data__=new sm(p);this.size=b.size}function rg(){this.__data__=new sm,this.size=0}function sp(p){var b=this.__data__,F=b.delete(p);return this.size=b.size,F}function O0(p){return this.__data__.get(p)}function Cg(p){return this.__data__.has(p)}function ne(p,b){var F=this.__data__;if(F instanceof sm){var H=F.__data__;if(!pr||H.length<o-1)return H.push([p,b]),this.size=++F.size,this;F=this.__data__=new ah(H)}return F.set(p,b),this.size=F.size,this}uh.prototype.clear=rg,uh.prototype.delete=sp,uh.prototype.get=O0,uh.prototype.has=Cg,uh.prototype.set=ne;function fe(p,b){var F=_o(p),H=!F&&tl(p),be=!F&&!H&&ti(p),Pe=!F&&!H&&!be&&Ca(p),Ze=F||H||be||Pe,Ke=Ze?_e(p.length,hr):[],ut=Ke.length;for(var Gt in p)(b||Yc.call(p,Gt))&&!(Ze&&(Gt=="length"||be&&(Gt=="offset"||Gt=="parent")||Pe&&(Gt=="buffer"||Gt=="byteLength"||Gt=="byteOffset")||Go(Gt,ut)))&&Ke.push(Gt);return Ke}function qe(p){var b=p.length;return b?p[rm(0,b-1)]:t}function ot(p,b){return Sm(Ip(p),_i(b,0,p.length))}function Wt(p){return Sm(Ip(p))}function Ct(p,b,F){(F!==t&&!$i(p[b],F)||F===t&&!(b in p))&&Ts(p,b,F)}function un(p,b,F){var H=p[b];(!(Yc.call(p,b)&&$i(H,F))||F===t&&!(b in p))&&Ts(p,b,F)}function Ln(p,b){for(var F=p.length;F--;)if($i(p[F][0],b))return F;return-1}function Un(p,b,F,H){return Ml(p,function(be,Pe,Ze){b(H,be,F(be),Ze)}),H}function Ws(p,b){return p&&Vp(b,Vd(b),p)}function bo(p,b){return p&&Vp(b,ju(b),p)}function Ts(p,b,F){b=="__proto__"&&Ho?Ho(p,b,{configurable:!0,enumerable:!0,value:F,writable:!0}):p[b]=F}function Oo(p,b){for(var F=-1,H=b.length,be=dn(H),Pe=p==null;++F<H;)be[F]=Pe?t:xp(p,b[F]);return be}function _i(p,b,F){return p===p&&(F!==t&&(p=p<=F?p:F),b!==t&&(p=p>=b?p:b)),p}function to(p,b,F,H,be,Pe){var Ze,Ke=b&d,ut=b&h,Gt=b&m;if(F&&(Ze=be?F(p,H,be,Pe):F(p)),Ze!==t)return Ze;if(!no(p))return p;var fn=_o(p);if(fn){if(Ze=Ni(p),!Ke)return Ip(p,Ze)}else{var $n=an(p),cn=$n==st||$n==xt;if(ti(p))return lv(p,Ke);if($n==Qe||$n==et||cn&&!be){if(Ze=ut||cn?{}:Qn(p),!Ke)return ut?cv(p,bo(Ze,p)):$h(p,Ws(Ze,p))}else{if(!ga[$n])return be?p:{};Ze=Fo(p,$n,Ke)}}Pe||(Pe=new uh);var eo=Pe.get(p);if(eo)return eo;Pe.set(p,Ze),ru(p)?p.forEach(function(ws){Ze.add(to(ws,b,F,ws,p,Pe))}):ka(p)&&p.forEach(function(ws,Zn){Ze.set(Zn,to(ws,b,F,Zn,p,Pe))});var Js=Gt?ut?Pn:Vt:ut?ju:Vd,Co=fn?t:Js(p);return Md(Co||p,function(ws,Zn){Co&&(Zn=ws,ws=p[Zn]),un(Ze,Zn,to(ws,b,F,Zn,p,Pe))}),Ze}function Ha(p){var b=Vd(p);return function(F){return Ta(F,p,b)}}function Ta(p,b,F){var H=F.length;if(p==null)return!H;for(p=Oi(p);H--;){var be=F[H],Pe=b[be],Ze=p[be];if(Ze===t&&!(be in p)||!Pe(Ze))return!1}return!0}function dl(p,b,F){if(typeof p!="function")throw new vr(a);return _d(function(){p.apply(t,F)},b)}function yl(p,b,F,H){var be=-1,Pe=Tu,Ze=!0,Ke=p.length,ut=[],Gt=b.length;if(!Ke)return ut;F&&(b=gc(b,ye(F))),H?(Pe=bd,Ze=!1):b.length>=o&&(Pe=Ge,Ze=!1,b=new lh(b));e:for(;++be<Ke;){var fn=p[be],$n=F==null?fn:F(fn);if(fn=H||fn!==0?fn:0,Ze&&$n===$n){for(var cn=Gt;cn--;)if(b[cn]===$n)continue e;ut.push(fn)}else Pe(b,$n,H)||ut.push(fn)}return ut}var Ml=Ov(go),Gl=Ov(yi,!0);function wd(p,b){var F=!0;return Ml(p,function(H,be,Pe){return F=!!b(H,be,Pe),F}),F}function fc(p,b,F){for(var H=-1,be=p.length;++H<be;){var Pe=p[H],Ze=b(Pe);if(Ze!=null&&(Ke===t?Ze===Ze&&!Hc(Ze):F(Ze,Ke)))var Ke=Ze,ut=Pe}return ut}function md(p,b,F,H){var be=p.length;for(F=Ia(F),F<0&&(F=-F>be?0:be+F),H=H===t||H>be?be:Ia(H),H<0&&(H+=be),H=F>H?0:Kf(H);F<H;)p[F++]=b;return p}function Yp(p,b){var F=[];return Ml(p,function(H,be,Pe){b(H,be,Pe)&&F.push(H)}),F}function xu(p,b,F,H,be){var Pe=-1,Ze=p.length;for(F||(F=Po),be||(be=[]);++Pe<Ze;){var Ke=p[Pe];b>0&&F(Ke)?b>1?xu(Ke,b-1,F,H,be):qu(be,Ke):H||(be[be.length]=Ke)}return be}var Xd=Rh(),vo=Rh(!0);function go(p,b){return p&&Xd(p,b,Vd)}function yi(p,b){return p&&vo(p,b,Vd)}function Jr(p,b){return Hu(b,function(F){return ea(p[F])})}function Yl(p,b){b=lm(b,p);for(var F=0,H=b.length;p!=null&&F<H;)p=p[Dp(b[F++])];return F&&F==H?p:t}function Eu(p,b,F){var H=b(p);return _o(p)?H:qu(H,F(p))}function nd(p){return p==null?p===t?$t:Be:ao&&ao in Oi(p)?Jn(p):sd(p)}function dp(p,b){return p>b}function Ic(p,b){return p!=null&&Yc.call(p,b)}function zp(p,b){return p!=null&&b in Oi(p)}function nu(p,b,F){return p>=Qi(b,F)&&p<Zr(b,F)}function zi(p,b,F){for(var H=F?bd:Tu,be=p[0].length,Pe=p.length,Ze=Pe,Ke=dn(Pe),ut=1/0,Gt=[];Ze--;){var fn=p[Ze];Ze&&b&&(fn=gc(fn,ye(b))),ut=Qi(fn.length,ut),Ke[Ze]=!F&&(b||be>=120&&fn.length>=120)?new lh(Ze&&fn):t}fn=p[0];var $n=-1,cn=Ke[0];e:for(;++$n<be&&Gt.length<ut;){var eo=fn[$n],Js=b?b(eo):eo;if(eo=F||eo!==0?eo:0,!(cn?Ge(cn,Js):H(Gt,Js,F))){for(Ze=Pe;--Ze;){var Co=Ke[Ze];if(!(Co?Ge(Co,Js):H(p[Ze],Js,F)))continue e}cn&&cn.push(Js),Gt.push(eo)}}return Gt}function jm(p,b,F,H){return go(p,function(be,Pe,Ze){b(H,F(be),Pe,Ze)}),H}function op(p,b,F){b=lm(b,p),p=Sp(p,b);var H=p==null?p:p[Dp(hs(b))];return H==null?t:Vc(H,p,F)}function _m(p){return Si(p)&&nd(p)==et}function dh(p){return Si(p)&&nd(p)==Vn}function Kp(p){return Si(p)&&nd(p)==Tt}function Xp(p,b,F,H,be){return p===b?!0:p==null||b==null||!Si(p)&&!Si(b)?p!==p&&b!==b:ym(p,b,F,H,Xp,be)}function ym(p,b,F,H,be,Pe){var Ze=_o(p),Ke=_o(b),ut=Ze?ft:an(p),Gt=Ke?ft:an(b);ut=ut==et?Qe:ut,Gt=Gt==et?Qe:Gt;var fn=ut==Qe,$n=Gt==Qe,cn=ut==Gt;if(cn&&ti(p)){if(!ti(b))return!1;Ze=!0,fn=!1}if(cn&&!fn)return Pe||(Pe=new uh),Ze||Ca(p)?as(p,b,F,H,be,Pe):Ls(p,b,ut,F,H,be,Pe);if(!(F&g)){var eo=fn&&Yc.call(p,"__wrapped__"),Js=$n&&Yc.call(b,"__wrapped__");if(eo||Js){var Co=eo?p.value():p,ws=Js?b.value():b;return Pe||(Pe=new uh),be(Co,ws,F,H,Pe)}}return cn?(Pe||(Pe=new uh),Ys(p,b,F,H,be,Pe)):!1}function Ah(p){return Si(p)&&an(p)==Je}function Rf(p,b,F,H){var be=F.length,Pe=be,Ze=!H;if(p==null)return!Pe;for(p=Oi(p);be--;){var Ke=F[be];if(Ze&&Ke[2]?Ke[1]!==p[Ke[0]]:!(Ke[0]in p))return!1}for(;++be<Pe;){Ke=F[be];var ut=Ke[0],Gt=p[ut],fn=Ke[1];if(Ze&&Ke[2]){if(Gt===t&&!(ut in p))return!1}else{var $n=new uh;if(H)var cn=H(Gt,fn,ut,p,b,$n);if(!(cn===t?Xp(fn,Gt,g|w,H,$n):cn))return!1}}return!0}function Bm(p){if(!no(p)||yc(p))return!1;var b=ea(p)?Jl:Xl;return b.test(_p(p))}function Om(p){return Si(p)&&nd(p)==mt}function Uh(p){return Si(p)&&an(p)==Ce}function om(p){return Si(p)&&Ko(p.length)&&!!Ja[nd(p)]}function bm(p){return typeof p=="function"?p:p==null?Zf:typeof p=="object"?_o(p)?Vm(p[0],p[1]):$v(p):r1(p)}function zm(p){if(!rc(p))return _u(p);var b=[];for(var F in Oi(p))Yc.call(p,F)&&F!="constructor"&&b.push(F);return b}function fp(p){if(!no(p))return $u(p);var b=rc(p),F=[];for(var H in p)H=="constructor"&&(b||!Yc.call(p,H))||F.push(H);return F}function Td(p,b){return p<b}function iv(p,b){var F=-1,H=br(p)?dn(p.length):[];return Ml(p,function(be,Pe,Ze){H[++F]=b(be,Pe,Ze)}),H}function $v(p){var b=Xt(p);return b.length==1&&b[0][2]?$c(b[0][0],b[0][1]):function(F){return F===p||Rf(F,p,b)}}function Vm(p,b){return Ns(p)&&Mc(b)?$c(Dp(p),b):function(F){var H=xp(F,p);return H===t&&H===b?Ym(F,p):Xp(b,H,g|w)}}function fh(p,b,F,H,be){p!==b&&Xd(b,function(Pe,Ze){if(be||(be=new uh),no(Pe))Gh(p,b,Ze,F,fh,H,be);else{var Ke=H?H(xl(p,Ze),Pe,Ze+"",p,b,be):t;Ke===t&&(Ke=Pe),Ct(p,Ze,Ke)}},ju)}function Gh(p,b,F,H,be,Pe,Ze){var Ke=xl(p,F),ut=xl(b,F),Gt=Ze.get(ut);if(Gt){Ct(p,F,Gt);return}var fn=Pe?Pe(Ke,ut,F+"",p,b,Ze):t,$n=fn===t;if($n){var cn=_o(ut),eo=!cn&&ti(ut),Js=!cn&&!eo&&Ca(ut);fn=ut,cn||eo||Js?_o(Ke)?fn=Ke:di(Ke)?fn=Ip(Ke):eo?($n=!1,fn=lv(ut,!0)):Js?($n=!1,fn=gd(ut,!0)):fn=[]:Kl(ut)||tl(ut)?(fn=Ke,tl(Ke)?fn=Of(Ke):(!no(Ke)||ea(Ke))&&(fn=Qn(ut))):$n=!1}$n&&(Ze.set(ut,fn),be(fn,ut,H,Pe,Ze),Ze.delete(ut)),Ct(p,F,fn)}function wu(p,b){var F=p.length;if(F)return b+=b<0?F:0,Go(b,F)?p[b]:t}function Lp(p,b,F){b.length?b=gc(b,function(Pe){return _o(Pe)?function(Ze){return Yl(Ze,Pe.length===1?Pe[0]:Pe)}:Pe}):b=[Zf];var H=-1;b=gc(b,ye(In()));var be=iv(p,function(Pe,Ze,Ke){var ut=gc(b,function(Gt){return Gt(Pe)});return{criteria:ut,index:++H,value:Pe}});return W(be,function(Pe,Ze){return gh(Pe,Ze,F)})}function ph(p,b){return im(p,b,function(F,H){return Ym(p,H)})}function im(p,b,F){for(var H=-1,be=b.length,Pe={};++H<be;){var Ze=b[H],Ke=Yl(p,Ze);F(Ke,Ze)&&Zp(Pe,lm(Ze,p),Ke)}return Pe}function Wm(p){return function(b){return Yl(b,p)}}function Af(p,b,F,H){var be=H?Ee:ee,Pe=-1,Ze=b.length,Ke=p;for(p===b&&(b=Ip(b)),F&&(Ke=gc(p,ye(F)));++Pe<Ze;)for(var ut=0,Gt=b[Pe],fn=F?F(Gt):Gt;(ut=be(Ke,fn,ut,H))>-1;)Ke!==p&&$s.call(Ke,ut,1),$s.call(p,ut,1);return p}function xm(p,b){for(var F=p?b.length:0,H=F-1;F--;){var be=b[F];if(F==H||be!==Pe){var Pe=be;Go(be)?$s.call(p,be,1):Dv(p,be)}}return p}function rm(p,b){return p+El(er()*(b-p+1))}function mh(p,b,F,H){for(var be=-1,Pe=Zr(gu((b-p)/(F||1)),0),Ze=dn(Pe);Pe--;)Ze[H?Pe:++be]=p,p+=F;return Ze}function Hm(p,b){var F="";if(!p||b<1||b>Ie)return F;do b%2&&(F+=p),b=El(b/2),b&&(p+=p);while(b);return F}function $l(p,b){return yh(Bl(p,b,Zf),p+"")}function am(p){return qe(ys(p))}function hh(p,b){var F=ys(p);return Sm(F,_i(b,0,F.length))}function Zp(p,b,F,H){if(!no(p))return p;b=lm(b,p);for(var be=-1,Pe=b.length,Ze=Pe-1,Ke=p;Ke!=null&&++be<Pe;){var ut=Dp(b[be]),Gt=F;if(ut==="__proto__"||ut==="constructor"||ut==="prototype")return p;if(be!=Ze){var fn=Ke[ut];Gt=H?H(fn,ut,Ke):t,Gt===t&&(Gt=no(fn)?fn:Go(b[be+1])?[]:{})}un(Ke,ut,Gt),Ke=Ke[ut]}return p}var Th=ic?function(p,b){return ic.set(p,b),p}:Zf,xv=Ho?function(p,b){return Ho(p,"toString",{configurable:!0,enumerable:!1,value:pv(b),writable:!0})}:Zf;function ag(p){return Sm(ys(p))}function Ep(p,b,F){var H=-1,be=p.length;b<0&&(b=-b>be?0:be+b),F=F>be?be:F,F<0&&(F+=be),be=b>F?0:F-b>>>0,b>>>=0;for(var Pe=dn(be);++H<be;)Pe[H]=p[H+b];return Pe}function $p(p,b){var F;return Ml(p,function(H,be,Pe){return F=b(H,be,Pe),!F}),!!F}function qm(p,b,F){var H=0,be=p==null?H:p.length;if(typeof b=="number"&&b===b&&be<=He){for(;H<be;){var Pe=H+be>>>1,Ze=p[Pe];Ze!==null&&!Hc(Ze)&&(F?Ze<=b:Ze<b)?H=Pe+1:be=Pe}return be}return Fh(p,b,Zf,F)}function Fh(p,b,F,H){var be=0,Pe=p==null?0:p.length;if(Pe===0)return 0;b=F(b);for(var Ze=b!==b,Ke=b===null,ut=Hc(b),Gt=b===t;be<Pe;){var fn=El((be+Pe)/2),$n=F(p[fn]),cn=$n!==t,eo=$n===null,Js=$n===$n,Co=Hc($n);if(Ze)var ws=H||Js;else Gt?ws=Js&&(H||cn):Ke?ws=Js&&cn&&(H||!eo):ut?ws=Js&&cn&&!eo&&(H||!Co):eo||Co?ws=!1:ws=H?$n<=b:$n<b;ws?be=fn+1:Pe=fn}return Qi(Pe,We)}function Yh(p,b){for(var F=-1,H=p.length,be=0,Pe=[];++F<H;){var Ze=p[F],Ke=b?b(Ze):Ze;if(!F||!$i(Ke,ut)){var ut=Ke;Pe[be++]=Ze===0?0:Ze}}return Pe}function lg(p){return typeof p=="number"?p:Hc(p)?je:+p}function gf(p){if(typeof p=="string")return p;if(_o(p))return gc(p,gf)+"";if(Hc(p))return Nf?Nf.call(p):"";var b=p+"";return b=="0"&&1/p==-ae?"-0":b}function wm(p,b,F){var H=-1,be=Tu,Pe=p.length,Ze=!0,Ke=[],ut=Ke;if(F)Ze=!1,be=bd;else if(Pe>=o){var Gt=b?null:wt(p);if(Gt)return na(Gt);Ze=!1,be=Ge,ut=new lh}else ut=b?[]:Ke;e:for(;++H<Pe;){var fn=p[H],$n=b?b(fn):fn;if(fn=F||fn!==0?fn:0,Ze&&$n===$n){for(var cn=ut.length;cn--;)if(ut[cn]===$n)continue e;b&&ut.push($n),Ke.push(fn)}else be(ut,$n,F)||(ut!==Ke&&ut.push($n),Ke.push(fn))}return Ke}function Dv(p,b){return b=lm(b,p),p=Sp(p,b),p==null||delete p[Dp(hs(b))]}function Rv(p,b,F,H){return Zp(p,b,F(Yl(p,b)),H)}function Um(p,b,F,H){for(var be=p.length,Pe=H?be:-1;(H?Pe--:++Pe<be)&&b(p[Pe],Pe,p););return F?Ep(p,H?0:Pe,H?Pe+1:be):Ep(p,H?Pe+1:0,H?be:Pe)}function Kh(p,b){var F=p;return F instanceof pu&&(F=F.value()),$d(b,function(H,be){return be.func.apply(be.thisArg,qu([H],be.args))},F)}function wv(p,b,F){var H=p.length;if(H<2)return H?wm(p[0]):[];for(var be=-1,Pe=dn(H);++be<H;)for(var Ze=p[be],Ke=-1;++Ke<H;)Ke!=be&&(Pe[be]=yl(Pe[be]||Ze,p[Ke],b,F));return wm(xu(Pe,1),b,F)}function cg(p,b,F){for(var H=-1,be=p.length,Pe=b.length,Ze={};++H<be;){var Ke=H<Pe?b[H]:t;F(Ze,p[H],Ke)}return Ze}function rv(p){return di(p)?p:[]}function vh(p){return typeof p=="function"?p:Zf}function lm(p,b){return _o(p)?p:Ns(p,b)?[p]:Pp(Rl(p))}var Ig=$l;function cm(p,b,F){var H=p.length;return F=F===t?H:F,!b&&F>=H?p:Ep(p,b,F)}var av=so||function(p){return dc.clearTimeout(p)};function lv(p,b){if(b)return p.slice();var F=p.length,H=Rn?Rn(F):new p.constructor(F);return p.copy(H),H}function jv(p){var b=new p.constructor(p.byteLength);return new yt(b).set(new yt(p)),b}function jf(p,b){var F=b?jv(p.buffer):p.buffer;return new p.constructor(F,p.byteOffset,p.byteLength)}function Wl(p){var b=new p.constructor(p.source,kr.exec(p));return b.lastIndex=p.lastIndex,b}function Dl(p){return nm?Oi(nm.call(p)):{}}function gd(p,b){var F=b?jv(p.buffer):p.buffer;return new p.constructor(F,p.byteOffset,p.length)}function Lh(p,b){if(p!==b){var F=p!==t,H=p===null,be=p===p,Pe=Hc(p),Ze=b!==t,Ke=b===null,ut=b===b,Gt=Hc(b);if(!Ke&&!Gt&&!Pe&&p>b||Pe&&Ze&&ut&&!Ke&&!Gt||H&&Ze&&ut||!F&&ut||!be)return 1;if(!H&&!Pe&&!Gt&&p<b||Gt&&F&&be&&!H&&!Pe||Ke&&F&&be||!Ze&&be||!ut)return-1}return 0}function gh(p,b,F){for(var H=-1,be=p.criteria,Pe=b.criteria,Ze=be.length,Ke=F.length;++H<Ze;){var ut=Lh(be[H],Pe[H]);if(ut){if(H>=Ke)return ut;var Gt=F[H];return ut*(Gt=="desc"?-1:1)}}return p.index-b.index}function Bv(p,b,F,H){for(var be=-1,Pe=p.length,Ze=F.length,Ke=-1,ut=b.length,Gt=Zr(Pe-Ze,0),fn=dn(ut+Gt),$n=!H;++Ke<ut;)fn[Ke]=b[Ke];for(;++be<Ze;)($n||be<Pe)&&(fn[F[be]]=p[be]);for(;Gt--;)fn[Ke++]=p[be++];return fn}function Eh(p,b,F,H){for(var be=-1,Pe=p.length,Ze=-1,Ke=F.length,ut=-1,Gt=b.length,fn=Zr(Pe-Ke,0),$n=dn(fn+Gt),cn=!H;++be<fn;)$n[be]=p[be];for(var eo=be;++ut<Gt;)$n[eo+ut]=b[ut];for(;++Ze<Ke;)(cn||be<Pe)&&($n[eo+F[Ze]]=p[be++]);return $n}function Ip(p,b){var F=-1,H=p.length;for(b||(b=dn(H));++F<H;)b[F]=p[F];return b}function Vp(p,b,F,H){var be=!F;F||(F={});for(var Pe=-1,Ze=b.length;++Pe<Ze;){var Ke=b[Pe],ut=H?H(F[Ke],p[Ke],Ke,F,p):t;ut===t&&(ut=p[Ke]),be?Ts(F,Ke,ut):un(F,Ke,ut)}return F}function $h(p,b){return Vp(p,Kt(p),b)}function cv(p,b){return Vp(p,Zt(p),b)}function Dh(p,b){return function(F,H){var be=_o(F)?Yd:Un,Pe=b?b():{};return be(F,p,In(H,2),Pe)}}function um(p){return $l(function(b,F){var H=-1,be=F.length,Pe=be>1?F[be-1]:t,Ze=be>2?F[2]:t;for(Pe=p.length>3&&typeof Pe=="function"?(be--,Pe):t,Ze&&Ps(F[0],F[1],Ze)&&(Pe=be<3?t:Pe,be=1),b=Oi(b);++H<be;){var Ke=F[H];Ke&&p(b,Ke,H,Pe)}return b})}function Ov(p,b){return function(F,H){if(F==null)return F;if(!br(F))return p(F,H);for(var be=F.length,Pe=b?be:-1,Ze=Oi(F);(b?Pe--:++Pe<be)&&H(Ze[Pe],Pe,Ze)!==!1;);return F}}function Rh(p){return function(b,F,H){for(var be=-1,Pe=Oi(b),Ze=H(b),Ke=Ze.length;Ke--;){var ut=Ze[p?Ke:++be];if(F(Pe[ut],ut,Pe)===!1)break}return b}}function zv(p,b,F){var H=b&C,be=km(p);function Pe(){var Ze=this&&this!==dc&&this instanceof Pe?be:p;return Ze.apply(H?F:this,arguments)}return Pe}function kv(p){return function(b){b=Rl(b);var F=es(b)?dr(b):t,H=F?F[0]:b.charAt(0),be=F?cm(F,1).join(""):b.slice(1);return H[p]()+be}}function _h(p){return function(b){return $d(Tg(oo(b).replace(Oc,"")),p,"")}}function km(p){return function(){var b=arguments;switch(b.length){case 0:return new p;case 1:return new p(b[0]);case 2:return new p(b[0],b[1]);case 3:return new p(b[0],b[1],b[2]);case 4:return new p(b[0],b[1],b[2],b[3]);case 5:return new p(b[0],b[1],b[2],b[3],b[4]);case 6:return new p(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new p(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var F=yv(p.prototype),H=p.apply(F,b);return no(H)?H:F}}function uv(p,b,F){var H=km(p);function be(){for(var Pe=arguments.length,Ze=dn(Pe),Ke=Pe,ut=bn(be);Ke--;)Ze[Ke]=arguments[Ke];var Gt=Pe<3&&Ze[0]!==ut&&Ze[Pe-1]!==ut?[]:sr(Ze,ut);if(Pe-=Gt.length,Pe<F)return ze(p,b,Wv,be.placeholder,t,Ze,Gt,t,t,F-Pe);var fn=this&&this!==dc&&this instanceof be?H:p;return Vc(fn,this,Ze)}return be}function Vv(p){return function(b,F,H){var be=Oi(b);if(!br(b)){var Pe=In(F,3);b=Vd(b),F=function(Ke){return Pe(be[Ke],Ke,be)}}var Ze=p(b,F,H);return Ze>-1?be[Pe?b[Ze]:Ze]:t}}function ug(p){return yn(function(b){var F=b.length,H=F,be=Fp.prototype.thru;for(p&&b.reverse();H--;){var Pe=b[H];if(typeof Pe!="function")throw new vr(a);if(be&&!Ze&&Tn(Pe)=="wrapper")var Ze=new Fp([],!0)}for(H=Ze?H:F;++H<F;){Pe=b[H];var Ke=Tn(Pe),ut=Ke=="wrapper"?Hn(Pe):t;ut&&Ec(ut[0])&&ut[1]==(D|T|L|$)&&!ut[4].length&&ut[9]==1?Ze=Ze[Tn(ut[0])].apply(Ze,ut[3]):Ze=Pe.length==1&&Ec(Pe)?Ze[Ke]():Ze.thru(Pe)}return function(){var Gt=arguments,fn=Gt[0];if(Ze&&Gt.length==1&&_o(fn))return Ze.plant(fn).value();for(var $n=0,cn=F?b[$n].apply(this,Gt):fn;++$n<F;)cn=b[$n].call(this,cn);return cn}})}function Wv(p,b,F,H,be,Pe,Ze,Ke,ut,Gt){var fn=b&D,$n=b&C,cn=b&M,eo=b&(T|N),Js=b&z,Co=cn?t:km(p);function ws(){for(var Zn=arguments.length,Ss=dn(Zn),Fr=Zn;Fr--;)Ss[Fr]=arguments[Fr];if(eo)var Ra=bn(ws),xc=nn(Ss,Ra);if(H&&(Ss=Bv(Ss,H,be,eo)),Pe&&(Ss=Eh(Ss,Pe,Ze,eo)),Zn-=xc,eo&&Zn<Gt){var Nl=sr(Ss,Ra);return ze(p,b,Wv,ws.placeholder,F,Ss,Nl,Ke,ut,Gt-Zn)}var Qc=$n?F:this,al=cn?Qc[p]:p;return Zn=Ss.length,Ke?Ss=Xc(Ss,Ke):Js&&Zn>1&&Ss.reverse(),fn&&ut<Zn&&(Ss.length=ut),this&&this!==dc&&this instanceof ws&&(al=Co||km(al)),al.apply(Qc,Ss)}return ws}function dg(p,b){return function(F,H){return jm(F,p,b(H),{})}}function S(p,b){return function(F,H){var be;if(F===t&&H===t)return b;if(F!==t&&(be=F),H!==t){if(be===t)return H;typeof F=="string"||typeof H=="string"?(F=gf(F),H=gf(H)):(F=lg(F),H=lg(H)),be=p(F,H)}return be}}function j(p){return yn(function(b){return b=gc(b,ye(In())),$l(function(F){var H=this;return p(b,function(be){return Vc(be,H,F)})})})}function Q(p,b){b=b===t?" ":gf(b);var F=b.length;if(F<2)return F?Hm(b,p):b;var H=Hm(b,gu(p/ul(b)));return es(b)?cm(dr(H),0,p).join(""):H.slice(0,p)}function ue(p,b,F,H){var be=b&C,Pe=km(p);function Ze(){for(var Ke=-1,ut=arguments.length,Gt=-1,fn=H.length,$n=dn(fn+ut),cn=this&&this!==dc&&this instanceof Ze?Pe:p;++Gt<fn;)$n[Gt]=H[Gt];for(;ut--;)$n[Gt++]=arguments[++Ke];return Vc(cn,be?F:this,$n)}return Ze}function ie(p){return function(b,F,H){return H&&typeof H!="number"&&Ps(b,F,H)&&(F=H=t),b=lu(b),F===t?(F=b,b=0):F=lu(F),H=H===t?b<F?1:-1:lu(H),mh(b,F,H,p)}}function De(p){return function(b,F){return typeof b=="string"&&typeof F=="string"||(b=Vr(b),F=Vr(F)),p(b,F)}}function ze(p,b,F,H,be,Pe,Ze,Ke,ut,Gt){var fn=b&T,$n=fn?Ze:t,cn=fn?t:Ze,eo=fn?Pe:t,Js=fn?t:Pe;b|=fn?L:O,b&=~(fn?O:L),b&P||(b&=~(C|M));var Co=[p,b,be,eo,$n,Js,cn,Ke,ut,Gt],ws=F.apply(t,Co);return Ec(p)&&Du(ws,Co),ws.placeholder=H,jh(ws,p,b)}function lt(p){var b=Ul[p];return function(F,H){if(F=Vr(F),H=H==null?0:Qi(Ia(H),292),H&&ba(F)){var be=(Rl(F)+"e").split("e"),Pe=b(be[0]+"e"+(+be[1]+H));return be=(Rl(Pe)+"e").split("e"),+(be[0]+"e"+(+be[1]-H))}return b(F)}}var wt=Kc&&1/na(new Kc([,-0]))[1]==ae?function(p){return new Kc(p)}:I_;function qt(p){return function(b){var F=an(b);return F==Je?Es(b):F==Ce?Xr(b):me(b,p(b))}}function sn(p,b,F,H,be,Pe,Ze,Ke){var ut=b&M;if(!ut&&typeof p!="function")throw new vr(a);var Gt=H?H.length:0;if(Gt||(b&=~(L|O),H=be=t),Ze=Ze===t?Ze:Zr(Ia(Ze),0),Ke=Ke===t?Ke:Ia(Ke),Gt-=be?be.length:0,b&O){var fn=H,$n=be;H=be=t}var cn=ut?t:Hn(p),eo=[p,b,F,H,be,fn,$n,Pe,Ze,Ke];if(cn&&fl(eo,cn),p=eo[0],b=eo[1],F=eo[2],H=eo[3],be=eo[4],Ke=eo[9]=eo[9]===t?ut?0:p.length:Zr(eo[9]-Gt,0),!Ke&&b&(T|N)&&(b&=~(T|N)),!b||b==C)var Js=zv(p,b,F);else b==T||b==N?Js=uv(p,b,Ke):(b==L||b==(C|L))&&!be.length?Js=ue(p,b,F,H):Js=Wv.apply(t,eo);var Co=cn?Th:Du;return jh(Co(Js,eo),p,b)}function Ot(p,b,F,H){return p===t||$i(p,Zl[F])&&!Yc.call(H,F)?b:p}function vn(p,b,F,H,be,Pe){return no(p)&&no(b)&&(Pe.set(b,p),fh(p,b,t,vn,Pe),Pe.delete(b)),p}function kn(p){return Kl(p)?t:p}function as(p,b,F,H,be,Pe){var Ze=F&g,Ke=p.length,ut=b.length;if(Ke!=ut&&!(Ze&&ut>Ke))return!1;var Gt=Pe.get(p),fn=Pe.get(b);if(Gt&&fn)return Gt==b&&fn==p;var $n=-1,cn=!0,eo=F&w?new lh:t;for(Pe.set(p,b),Pe.set(b,p);++$n<Ke;){var Js=p[$n],Co=b[$n];if(H)var ws=Ze?H(Co,Js,$n,b,p,Pe):H(Js,Co,$n,p,b,Pe);if(ws!==t){if(ws)continue;cn=!1;break}if(eo){if(!Pf(b,function(Zn,Ss){if(!Ge(eo,Ss)&&(Js===Zn||be(Js,Zn,F,H,Pe)))return eo.push(Ss)})){cn=!1;break}}else if(!(Js===Co||be(Js,Co,F,H,Pe))){cn=!1;break}}return Pe.delete(p),Pe.delete(b),cn}function Ls(p,b,F,H,be,Pe,Ze){switch(F){case Dn:if(p.byteLength!=b.byteLength||p.byteOffset!=b.byteOffset)return!1;p=p.buffer,b=b.buffer;case Vn:return!(p.byteLength!=b.byteLength||!Pe(new yt(p),new yt(b)));case Lt:case Tt:case Xe:return $i(+p,+b);case St:return p.name==b.name&&p.message==b.message;case mt:case Te:return p==b+"";case Je:var Ke=Es;case Ce:var ut=H&g;if(Ke||(Ke=na),p.size!=b.size&&!ut)return!1;var Gt=Ze.get(p);if(Gt)return Gt==b;H|=w,Ze.set(p,b);var fn=as(Ke(p),Ke(b),H,be,Pe,Ze);return Ze.delete(p),fn;case It:if(nm)return nm.call(p)==nm.call(b)}return!1}function Ys(p,b,F,H,be,Pe){var Ze=F&g,Ke=Vt(p),ut=Ke.length,Gt=Vt(b),fn=Gt.length;if(ut!=fn&&!Ze)return!1;for(var $n=ut;$n--;){var cn=Ke[$n];if(!(Ze?cn in b:Yc.call(b,cn)))return!1}var eo=Pe.get(p),Js=Pe.get(b);if(eo&&Js)return eo==b&&Js==p;var Co=!0;Pe.set(p,b),Pe.set(b,p);for(var ws=Ze;++$n<ut;){cn=Ke[$n];var Zn=p[cn],Ss=b[cn];if(H)var Fr=Ze?H(Ss,Zn,cn,b,p,Pe):H(Zn,Ss,cn,p,b,Pe);if(!(Fr===t?Zn===Ss||be(Zn,Ss,F,H,Pe):Fr)){Co=!1;break}ws||(ws=cn=="constructor")}if(Co&&!ws){var Ra=p.constructor,xc=b.constructor;Ra!=xc&&"constructor"in p&&"constructor"in b&&!(typeof Ra=="function"&&Ra instanceof Ra&&typeof xc=="function"&&xc instanceof xc)&&(Co=!1)}return Pe.delete(p),Pe.delete(b),Co}function yn(p){return yh(Bl(p,t,Sv),p+"")}function Vt(p){return Eu(p,Vd,Kt)}function Pn(p){return Eu(p,ju,Zt)}var Hn=ic?function(p){return ic.get(p)}:I_;function Tn(p){for(var b=p.name+"",F=Lc[b],H=Yc.call(Lc,b)?F.length:0;H--;){var be=F[H],Pe=be.func;if(Pe==null||Pe==p)return be.name}return b}function bn(p){var b=Yc.call(nt,"placeholder")?nt:p;return b.placeholder}function In(){var p=nt.iteratee||hg;return p=p===hg?bm:p,arguments.length?p(arguments[0],arguments[1]):p}function Hs(p,b){var F=p.__data__;return si(b)?F[typeof b=="string"?"string":"hash"]:F.map}function Xt(p){for(var b=Vd(p),F=b.length;F--;){var H=b[F],be=p[H];b[F]=[H,be,Mc(be)]}return b}function jn(p,b){var F=Gs(p,b);return Bm(F)?F:t}function Jn(p){var b=Yc.call(p,ao),F=p[ao];try{p[ao]=t;var H=!0}catch{}var be=Dd.call(p);return H&&(b?p[ao]=F:delete p[ao]),be}var Kt=fu?function(p){return p==null?[]:(p=Oi(p),Hu(fu(p),function(b){return Ms.call(p,b)}))}:P_,Zt=fu?function(p){for(var b=[];p;)qu(b,Kt(p)),p=_n(p);return b}:P_,an=nd;(fr&&an(new fr(new ArrayBuffer(1)))!=Dn||pr&&an(new pr)!=Je||yu&&an(yu.resolve())!=ct||Kc&&an(new Kc)!=Ce||fd&&an(new fd)!=Yt)&&(an=function(p){var b=nd(p),F=b==Qe?p.constructor:t,H=F?_p(F):"";if(H)switch(H){case Ad:return Dn;case Gu:return Je;case lf:return ct;case pd:return Ce;case Df:return Yt}return b});function rs(p,b,F){for(var H=-1,be=F.length;++H<be;){var Pe=F[H],Ze=Pe.size;switch(Pe.type){case"drop":p+=Ze;break;case"dropRight":b-=Ze;break;case"take":b=Qi(b,p+Ze);break;case"takeRight":p=Zr(p,b-Ze);break}}return{start:p,end:b}}function Sn(p){var b=p.match(Vu);return b?b[1].split(rf):[]}function Xs(p,b,F){b=lm(b,p);for(var H=-1,be=b.length,Pe=!1;++H<be;){var Ze=Dp(b[H]);if(!(Pe=p!=null&&F(p,Ze)))break;p=p[Ze]}return Pe||++H!=be?Pe:(be=p==null?0:p.length,!!be&&Ko(be)&&Go(Ze,be)&&(_o(p)||tl(p)))}function Ni(p){var b=p.length,F=new p.constructor(b);return b&&typeof p[0]=="string"&&Yc.call(p,"index")&&(F.index=p.index,F.input=p.input),F}function Qn(p){return typeof p.constructor=="function"&&!rc(p)?yv(_n(p)):{}}function Fo(p,b,F){var H=p.constructor;switch(b){case Vn:return jv(p);case Lt:case Tt:return new H(+p);case Dn:return jf(p,F);case Wn:case pn:case gn:case Qs:case Is:case Cs:case ro:case bs:case zt:return gd(p,F);case Je:return new H;case Xe:case Te:return new H(p);case mt:return Wl(p);case Ce:return new H;case It:return Dl(p)}}function ps(p,b){var F=b.length;if(!F)return p;var H=F-1;return b[H]=(F>1?"& ":"")+b[H],b=b.join(F>2?", ":" "),p.replace(Bc,`{
/* [wrapped with `+b+`] */
`)}function Po(p){return _o(p)||tl(p)||!!(wo&&p&&p[wo])}function Go(p,b){var F=typeof p;return b=b??Ie,!!b&&(F=="number"||F!="symbol"&&Zu.test(p))&&p>-1&&p%1==0&&p<b}function Ps(p,b,F){if(!no(F))return!1;var H=typeof b;return(H=="number"?br(F)&&Go(b,F.length):H=="string"&&b in F)?$i(F[b],p):!1}function Ns(p,b){if(_o(p))return!1;var F=typeof p;return F=="number"||F=="symbol"||F=="boolean"||p==null||Hc(p)?!0:wc.test(p)||!Pu.test(p)||b!=null&&p in Oi(b)}function si(p){var b=typeof p;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?p!=="__proto__":p===null}function Ec(p){var b=Tn(p),F=nt[b];if(typeof F!="function"||!(b in pu.prototype))return!1;if(p===F)return!0;var H=Hn(F);return!!H&&p===H[0]}function yc(p){return!!Ju&&Ju in p}var Pc=Bo?ea:M_;function rc(p){var b=p&&p.constructor,F=typeof b=="function"&&b.prototype||Zl;return p===F}function Mc(p){return p===p&&!no(p)}function $c(p,b){return function(F){return F==null?!1:F[p]===b&&(b!==t||p in Oi(F))}}function bl(p){var b=fa(p,function(H){return F.size===f&&F.clear(),H}),F=b.cache;return b}function fl(p,b){var F=p[1],H=b[1],be=F|H,Pe=be<(C|M|D),Ze=H==D&&F==T||H==D&&F==$&&p[7].length<=b[8]||H==(D|$)&&b[7].length<=b[8]&&F==T;if(!(Pe||Ze))return p;H&C&&(p[2]=b[2],be|=F&C?0:P);var Ke=b[3];if(Ke){var ut=p[3];p[3]=ut?Bv(ut,Ke,b[4]):Ke,p[4]=ut?sr(p[3],u):b[4]}return Ke=b[5],Ke&&(ut=p[5],p[5]=ut?Eh(ut,Ke,b[6]):Ke,p[6]=ut?sr(p[5],u):b[6]),Ke=b[7],Ke&&(p[7]=Ke),H&D&&(p[8]=p[8]==null?b[8]:Qi(p[8],b[8])),p[9]==null&&(p[9]=b[9]),p[0]=b[0],p[1]=be,p}function $u(p){var b=[];if(p!=null)for(var F in Oi(p))b.push(F);return b}function sd(p){return Dd.call(p)}function Bl(p,b,F){return b=Zr(b===t?p.length-1:b,0),function(){for(var H=arguments,be=-1,Pe=Zr(H.length-b,0),Ze=dn(Pe);++be<Pe;)Ze[be]=H[b+be];be=-1;for(var Ke=dn(b+1);++be<b;)Ke[be]=H[be];return Ke[b]=F(Ze),Vc(p,this,Ke)}}function Sp(p,b){return b.length<2?p:Yl(p,Ep(b,0,-1))}function Xc(p,b){for(var F=p.length,H=Qi(b.length,F),be=Ip(p);H--;){var Pe=b[H];p[H]=Go(Pe,F)?be[Pe]:t}return p}function xl(p,b){if(!(b==="constructor"&&typeof p[b]=="function")&&b!="__proto__")return p[b]}var Du=gp(Th),_d=_c||function(p,b){return dc.setTimeout(p,b)},yh=gp(xv);function jh(p,b,F){var H=b+"";return yh(p,ps(H,Wg(Sn(H),F)))}function gp(p){var b=0,F=0;return function(){var H=os(),be=le-(H-F);if(F=H,be>0){if(++b>=J)return arguments[0]}else b=0;return p.apply(t,arguments)}}function Sm(p,b){var F=-1,H=p.length,be=H-1;for(b=b===t?H:b;++F<b;){var Pe=rm(F,be),Ze=p[Pe];p[Pe]=p[F],p[F]=Ze}return p.length=b,p}var Pp=bl(function(p){var b=[];return p.charCodeAt(0)===46&&b.push(""),p.replace(cc,function(F,H,be,Pe){b.push(be?Pe.replace(va,"$1"):H||F)}),b});function Dp(p){if(typeof p=="string"||Hc(p))return p;var b=p+"";return b=="0"&&1/p==-ae?"-0":b}function _p(p){if(p!=null){try{return Mf.call(p)}catch{}try{return p+""}catch{}}return""}function Wg(p,b){return Md(Ue,function(F){var H="_."+F[0];b&F[1]&&!Tu(p,H)&&p.push(H)}),p.sort()}function _f(p){if(p instanceof pu)return p.clone();var b=new Fp(p.__wrapped__,p.__chain__);return b.__actions__=Ip(p.__actions__),b.__index__=p.__index__,b.__values__=p.__values__,b}function Ql(p,b,F){(F?Ps(p,b,F):b===t)?b=1:b=Zr(Ia(b),0);var H=p==null?0:p.length;if(!H||b<1)return[];for(var be=0,Pe=0,Ze=dn(gu(H/b));be<H;)Ze[Pe++]=Ep(p,be,be+=b);return Ze}function Ir(p){for(var b=-1,F=p==null?0:p.length,H=0,be=[];++b<F;){var Pe=p[b];Pe&&(be[H++]=Pe)}return be}function kd(){var p=arguments.length;if(!p)return[];for(var b=dn(p-1),F=arguments[0],H=p;H--;)b[H-1]=arguments[H];return qu(_o(F)?Ip(F):[F],xu(b,1))}var Rp=$l(function(p,b){return di(p)?yl(p,xu(b,1,di,!0)):[]}),Jp=$l(function(p,b){var F=hs(b);return di(F)&&(F=t),di(p)?yl(p,xu(b,1,di,!0),In(F,2)):[]}),dv=$l(function(p,b){var F=hs(b);return di(F)&&(F=t),di(p)?yl(p,xu(b,1,di,!0),t,F):[]});function yp(p,b,F){var H=p==null?0:p.length;return H?(b=F||b===t?1:Ia(b),Ep(p,b<0?0:b,H)):[]}function Hv(p,b,F){var H=p==null?0:p.length;return H?(b=F||b===t?1:Ia(b),b=H-b,Ep(p,0,b<0?0:b)):[]}function Pg(p,b){return p&&p.length?Um(p,In(b,3),!0,!0):[]}function Mg(p,b){return p&&p.length?Um(p,In(b,3),!0):[]}function Ng(p,b,F,H){var be=p==null?0:p.length;return be?(F&&typeof F!="number"&&Ps(p,b,F)&&(F=0,H=be),md(p,b,F,H)):[]}function fg(p,b,F){var H=p==null?0:p.length;if(!H)return-1;var be=F==null?0:Ia(F);return be<0&&(be=Zr(H+be,0)),ke(p,In(b,3),be)}function bh(p,b,F){var H=p==null?0:p.length;if(!H)return-1;var be=H-1;return F!==t&&(be=Ia(F),be=F<0?Zr(H+be,0):Qi(be,H-1)),ke(p,In(b,3),be,!0)}function Sv(p){var b=p==null?0:p.length;return b?xu(p,1):[]}function Ag(p){var b=p==null?0:p.length;return b?xu(p,ae):[]}function Cv(p,b){var F=p==null?0:p.length;return F?(b=b===t?1:Ia(b),xu(p,b)):[]}function Gm(p){for(var b=-1,F=p==null?0:p.length,H={};++b<F;){var be=p[b];H[be[0]]=be[1]}return H}function Hi(p){return p&&p.length?p[0]:t}function Pr(p,b,F){var H=p==null?0:p.length;if(!H)return-1;var be=F==null?0:Ia(F);return be<0&&(be=Zr(H+be,0)),ee(p,b,be)}function iu(p){var b=p==null?0:p.length;return b?Ep(p,0,-1):[]}var hd=$l(function(p){var b=gc(p,rv);return b.length&&b[0]===p[0]?zi(b):[]}),yf=$l(function(p){var b=hs(p),F=gc(p,rv);return b===hs(F)?b=t:F.pop(),F.length&&F[0]===p[0]?zi(F,In(b,2)):[]}),Zd=$l(function(p){var b=hs(p),F=gc(p,rv);return b=typeof b=="function"?b:t,b&&F.pop(),F.length&&F[0]===p[0]?zi(F,t,b):[]});function Et(p,b){return p==null?"":Pl.call(p,b)}function hs(p){var b=p==null?0:p.length;return b?p[b-1]:t}function Lo(p,b,F){var H=p==null?0:p.length;if(!H)return-1;var be=H;return F!==t&&(be=Ia(F),be=be<0?Zr(H+be,0):Qi(be,H-1)),b===b?xd(p,b,be):ke(p,ht,be,!0)}function So(p,b){return p&&p.length?wu(p,Ia(b)):t}var qa=$l(Zc);function Zc(p,b){return p&&p.length&&b&&b.length?Af(p,b):p}function Eo(p,b,F){return p&&p.length&&b&&b.length?Af(p,b,In(F,2)):p}function Fa(p,b,F){return p&&p.length&&b&&b.length?Af(p,b,t,F):p}var il=yn(function(p,b){var F=p==null?0:p.length,H=Oo(p,b);return xm(p,gc(b,function(be){return Go(be,F)?+be:be}).sort(Lh)),H});function Hl(p,b){var F=[];if(!(p&&p.length))return F;var H=-1,be=[],Pe=p.length;for(b=In(b,3);++H<Pe;){var Ze=p[H];b(Ze,H,p)&&(F.push(Ze),be.push(H))}return xm(p,be),F}function Bf(p){return p==null?p:gr.call(p)}function ai(p,b,F){var H=p==null?0:p.length;return H?(F&&typeof F!="number"&&Ps(p,b,F)?(b=0,F=H):(b=b==null?0:Ia(b),F=F===t?H:Ia(F)),Ep(p,b,F)):[]}function Bs(p,b){return qm(p,b)}function Fn(p,b,F){return Fh(p,b,In(F,2))}function ks(p,b){var F=p==null?0:p.length;if(F){var H=qm(p,b);if(H<F&&$i(p[H],b))return H}return-1}function vs(p,b){return qm(p,b,!0)}function li(p,b,F){return Fh(p,b,In(F,2),!0)}function ra(p,b){var F=p==null?0:p.length;if(F){var H=qm(p,b,!0)-1;if($i(p[H],b))return H}return-1}function jr(p){return p&&p.length?Yh(p):[]}function Mr(p,b){return p&&p.length?Yh(p,In(b,2)):[]}function mr(p){var b=p==null?0:p.length;return b?Ep(p,1,b):[]}function Mo(p,b,F){return p&&p.length?(b=F||b===t?1:Ia(b),Ep(p,0,b<0?0:b)):[]}function La(p,b,F){var H=p==null?0:p.length;return H?(b=F||b===t?1:Ia(b),b=H-b,Ep(p,b<0?0:b,H)):[]}function k(p,b){return p&&p.length?Um(p,In(b,3),!1,!0):[]}function A(p,b){return p&&p.length?Um(p,In(b,3)):[]}var B=$l(function(p){return wm(xu(p,1,di,!0))}),R=$l(function(p){var b=hs(p);return di(b)&&(b=t),wm(xu(p,1,di,!0),In(b,2))}),U=$l(function(p){var b=hs(p);return b=typeof b=="function"?b:t,wm(xu(p,1,di,!0),t,b)});function q(p){return p&&p.length?wm(p):[]}function ve(p,b){return p&&p.length?wm(p,In(b,2)):[]}function Re(p,b){return b=typeof b=="function"?b:t,p&&p.length?wm(p,t,b):[]}function rt(p){if(!(p&&p.length))return[];var b=0;return p=Hu(p,function(F){if(di(F))return b=Zr(F.length,b),!0}),_e(b,function(F){return gc(p,Nt(F))})}function Ut(p,b){if(!(p&&p.length))return[];var F=rt(p);return b==null?F:gc(F,function(H){return Vc(b,t,H)})}var ls=$l(function(p,b){return di(p)?yl(p,b):[]}),ns=$l(function(p){return wv(Hu(p,di))}),Mn=$l(function(p){var b=hs(p);return di(b)&&(b=t),wv(Hu(p,di),In(b,2))}),qo=$l(function(p){var b=hs(p);return b=typeof b=="function"?b:t,wv(Hu(p,di),t,b)}),Yo=$l(rt);function Nc(p,b){return cg(p||[],b||[],un)}function jd(p,b){return cg(p||[],b||[],Zp)}var cf=$l(function(p){var b=p.length,F=b>1?p[b-1]:t;return F=typeof F=="function"?(p.pop(),F):t,Ut(p,F)});function bf(p){var b=nt(p);return b.__chain__=!0,b}function ip(p,b){return b(p),p}function Bd(p,b){return b(p)}var xf=yn(function(p){var b=p.length,F=b?p[0]:0,H=this.__wrapped__,be=function(Pe){return Oo(Pe,p)};return b>1||this.__actions__.length||!(H instanceof pu)||!Go(F)?this.thru(be):(H=H.slice(F,+F+(b?1:0)),H.__actions__.push({func:Bd,args:[be],thisArg:t}),new Fp(H,this.__chain__).thru(function(Pe){return b&&!Pe.length&&Pe.push(t),Pe}))});function Jd(){return bf(this)}function Od(){return new Fp(this.value(),this.__chain__)}function wf(){this.__values__===t&&(this.__values__=id(this.value()));var p=this.__index__>=this.__values__.length,b=p?t:this.__values__[this.__index__++];return{done:p,value:b}}function kf(){return this}function Ri(p){for(var b,F=this;F instanceof Tv;){var H=_f(F);H.__index__=0,H.__values__=t,b?be.__wrapped__=H:b=H;var be=H;F=F.__wrapped__}return be.__wrapped__=p,b}function _r(){var p=this.__wrapped__;if(p instanceof pu){var b=p;return this.__actions__.length&&(b=new pu(this)),b=b.reverse(),b.__actions__.push({func:Bd,args:[Bf],thisArg:t}),new Fp(b,this.__chain__)}return this.thru(Bf)}function ua(){return Kh(this.__wrapped__,this.__actions__)}var Vi=Dh(function(p,b,F){Yc.call(p,F)?++p[F]:Ts(p,F,1)});function xa(p,b,F){var H=_o(p)?Kd:wd;return F&&Ps(p,b,F)&&(b=t),H(p,In(b,3))}function Jc(p,b){var F=_o(p)?Hu:Yp;return F(p,In(b,3))}var Ua=Vv(fg),ku=Vv(bh);function Su(p,b){return xu(aa(p,b),1)}function sa(p,b){return xu(aa(p,b),ae)}function Ol(p,b,F){return F=F===t?1:Ia(F),xu(aa(p,b),F)}function od(p,b){var F=_o(p)?Md:Ml;return F(p,In(b,3))}function G(p,b){var F=_o(p)?Au:Gl;return F(p,In(b,3))}var Bt=Dh(function(p,b,F){Yc.call(p,F)?p[F].push(b):Ts(p,F,[b])});function Ks(p,b,F,H){p=br(p)?p:ys(p),F=F&&!H?Ia(F):0;var be=p.length;return F<0&&(F=Zr(be+F,0)),Wc(p)?F<=be&&p.indexOf(b,F)>-1:!!be&&ee(p,b,F)>-1}var cs=$l(function(p,b,F){var H=-1,be=typeof b=="function",Pe=br(p)?dn(p.length):[];return Ml(p,function(Ze){Pe[++H]=be?Vc(b,Ze,F):op(Ze,b,F)}),Pe}),ts=Dh(function(p,b,F){Ts(p,F,b)});function aa(p,b){var F=_o(p)?gc:iv;return F(p,In(b,3))}function ko(p,b,F,H){return p==null?[]:(_o(b)||(b=b==null?[]:[b]),F=H?t:F,_o(F)||(F=F==null?[]:[F]),Lp(p,b,F))}var or=Dh(function(p,b,F){p[F?0:1].push(b)},function(){return[[],[]]});function pl(p,b,F){var H=_o(p)?$d:I,be=arguments.length<3;return H(p,In(b,4),F,be,Ml)}function Nr(p,b,F){var H=_o(p)?np:I,be=arguments.length<3;return H(p,In(b,4),F,be,Gl)}function qr(p,b){var F=_o(p)?Hu:Yp;return F(p,yr(In(b,3)))}function ec(p){var b=_o(p)?qe:am;return b(p)}function da(p,b,F){(F?Ps(p,b,F):b===t)?b=1:b=Ia(b);var H=_o(p)?ot:hh;return H(p,b)}function Uo(p){var b=_o(p)?Wt:ag;return b(p)}function Qa(p){if(p==null)return 0;if(br(p))return Wc(p)?ul(p):p.length;var b=an(p);return b==Je||b==Ce?p.size:zm(p).length}function Bn(p,b,F){var H=_o(p)?Pf:$p;return F&&Ps(p,b,F)&&(b=t),H(p,In(b,3))}var bi=$l(function(p,b){if(p==null)return[];var F=b.length;return F>1&&Ps(p,b[0],b[1])?b=[]:F>2&&Ps(b[0],b[1],b[2])&&(b=[b[0]]),Lp(p,xu(b,1),[])}),No=Wi||function(){return dc.Date.now()};function yo(p,b){if(typeof b!="function")throw new vr(a);return p=Ia(p),function(){if(--p<1)return b.apply(this,arguments)}}function _a(p,b,F){return b=F?t:b,b=p&&b==null?p.length:b,sn(p,D,t,t,t,t,b)}function xi(p,b){var F;if(typeof b!="function")throw new vr(a);return p=Ia(p),function(){return--p>0&&(F=b.apply(this,arguments)),p<=1&&(b=t),F}}var lr=$l(function(p,b,F){var H=C;if(F.length){var be=sr(F,bn(lr));H|=L}return sn(p,H,b,F,be)}),Ai=$l(function(p,b,F){var H=C|M;if(F.length){var be=sr(F,bn(Ai));H|=L}return sn(b,H,p,F,be)});function $o(p,b,F){b=F?t:b;var H=sn(p,T,t,t,t,t,t,b);return H.placeholder=$o.placeholder,H}function Br(p,b,F){b=F?t:b;var H=sn(p,N,t,t,t,t,t,b);return H.placeholder=Br.placeholder,H}function oa(p,b,F){var H,be,Pe,Ze,Ke,ut,Gt=0,fn=!1,$n=!1,cn=!0;if(typeof p!="function")throw new vr(a);b=Vr(b)||0,no(F)&&(fn=!!F.leading,$n="maxWait"in F,Pe=$n?Zr(Vr(F.maxWait)||0,b):Pe,cn="trailing"in F?!!F.trailing:cn);function eo(Nl){var Qc=H,al=be;return H=be=t,Gt=Nl,Ze=p.apply(al,Qc),Ze}function Js(Nl){return Gt=Nl,Ke=_d(Zn,b),fn?eo(Nl):Ze}function Co(Nl){var Qc=Nl-ut,al=Nl-Gt,Hd=b-Qc;return $n?Qi(Hd,Pe-al):Hd}function ws(Nl){var Qc=Nl-ut,al=Nl-Gt;return ut===t||Qc>=b||Qc<0||$n&&al>=Pe}function Zn(){var Nl=No();if(ws(Nl))return Ss(Nl);Ke=_d(Zn,Co(Nl))}function Ss(Nl){return Ke=t,cn&&H?eo(Nl):(H=be=t,Ze)}function Fr(){Ke!==t&&av(Ke),Gt=0,H=ut=be=Ke=t}function Ra(){return Ke===t?Ze:Ss(No())}function xc(){var Nl=No(),Qc=ws(Nl);if(H=arguments,be=this,ut=Nl,Qc){if(Ke===t)return Js(ut);if($n)return av(Ke),Ke=_d(Zn,b),eo(ut)}return Ke===t&&(Ke=_d(Zn,b)),Ze}return xc.cancel=Fr,xc.flush=Ra,xc}var zl=$l(function(p,b){return dl(p,1,b)}),ci=$l(function(p,b,F){return dl(p,Vr(b)||0,F)});function Ur(p){return sn(p,z)}function fa(p,b){if(typeof p!="function"||b!=null&&typeof b!="function")throw new vr(a);var F=function(){var H=arguments,be=b?b.apply(this,H):H[0],Pe=F.cache;if(Pe.has(be))return Pe.get(be);var Ze=p.apply(this,H);return F.cache=Pe.set(be,Ze)||Pe,Ze};return F.cache=new(fa.Cache||ah),F}fa.Cache=ah;function yr(p){if(typeof p!="function")throw new vr(a);return function(){var b=arguments;switch(b.length){case 0:return!p.call(this);case 1:return!p.call(this,b[0]);case 2:return!p.call(this,b[0],b[1]);case 3:return!p.call(this,b[0],b[1],b[2])}return!p.apply(this,b)}}function Ea(p){return xi(2,p)}var Zs=Ig(function(p,b){b=b.length==1&&_o(b[0])?gc(b[0],ye(In())):gc(xu(b,1),ye(In()));var F=b.length;return $l(function(H){for(var be=-1,Pe=Qi(H.length,F);++be<Pe;)H[be]=b[be].call(this,H[be]);return Vc(p,this,H)})}),us=$l(function(p,b){var F=sr(b,bn(us));return sn(p,L,t,b,F)}),gs=$l(function(p,b){var F=sr(b,bn(gs));return sn(p,O,t,b,F)}),ui=yn(function(p,b){return sn(p,$,t,t,t,b)});function Gr(p,b){if(typeof p!="function")throw new vr(a);return b=b===t?b:Ia(b),$l(p,b)}function wa(p,b){if(typeof p!="function")throw new vr(a);return b=b==null?0:Zr(Ia(b),0),$l(function(F){var H=F[b],be=cm(F,0,b);return H&&qu(be,H),Vc(p,this,be)})}function el(p,b,F){var H=!0,be=!0;if(typeof p!="function")throw new vr(a);return no(F)&&(H="leading"in F?!!F.leading:H,be="trailing"in F?!!F.trailing:be),oa(p,b,{leading:H,maxWait:b,trailing:be})}function ei(p){return _a(p,1)}function ji(p,b){return us(vh(b),p)}function Ti(){if(!arguments.length)return[];var p=arguments[0];return _o(p)?p:[p]}function Bi(p){return to(p,m)}function qi(p,b){return b=typeof b=="function"?b:t,to(p,m,b)}function oi(p){return to(p,d|m)}function Jo(p,b){return b=typeof b=="function"?b:t,to(p,d|m,b)}function Ar(p,b){return b==null||Ta(p,b,Vd(b))}function $i(p,b){return p===b||p!==p&&b!==b}var Ui=De(dp),wi=De(function(p,b){return p>=b}),tl=_m(function(){return arguments}())?_m:function(p){return Si(p)&&Yc.call(p,"callee")&&!Ms.call(p,"callee")},_o=dn.isArray,rl=Nu?ye(Nu):dh;function br(p){return p!=null&&Ko(p.length)&&!ea(p)}function di(p){return Si(p)&&br(p)}function $a(p){return p===!0||p===!1||Si(p)&&nd(p)==Lt}var ti=Cr||M_,ki=hf?ye(hf):Kp;function Or(p){return Si(p)&&p.nodeType===1&&!Kl(p)}function Qr(p){if(p==null)return!0;if(br(p)&&(_o(p)||typeof p=="string"||typeof p.splice=="function"||ti(p)||Ca(p)||tl(p)))return!p.length;var b=an(p);if(b==Je||b==Ce)return!p.size;if(rc(p))return!zm(p).length;for(var F in p)if(Yc.call(p,F))return!1;return!0}function cr(p,b){return Xp(p,b)}function ya(p,b,F){F=typeof F=="function"?F:t;var H=F?F(p,b):t;return H===t?Xp(p,b,t,F):!!H}function Ga(p){if(!Si(p))return!1;var b=nd(p);return b==St||b==Pt||typeof p.message=="string"&&typeof p.name=="string"&&!Kl(p)}function zr(p){return typeof p=="number"&&ba(p)}function ea(p){if(!no(p))return!1;var b=nd(p);return b==st||b==xt||b==it||b==Mt}function pa(p){return typeof p=="number"&&p==Ia(p)}function Ko(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=Ie}function no(p){var b=typeof p;return p!=null&&(b=="object"||b=="function")}function Si(p){return p!=null&&typeof p=="object"}var ka=td?ye(td):Ah;function Xo(p,b){return p===b||Rf(p,b,Xt(b))}function Sa(p,b,F){return F=typeof F=="function"?F:t,Rf(p,b,Xt(b),F)}function tr(p){return wl(p)&&p!=+p}function Ya(p){if(Pc(p))throw new zs(r);return Bm(p)}function ac(p){return p===null}function ml(p){return p==null}function wl(p){return typeof p=="number"||Si(p)&&nd(p)==Xe}function Kl(p){if(!Si(p)||nd(p)!=Qe)return!1;var b=_n(p);if(b===null)return!0;var F=Yc.call(b,"constructor")&&b.constructor;return typeof F=="function"&&F instanceof F&&Mf.call(F)==oc}var Dc=Cc?ye(Cc):Om;function pc(p){return pa(p)&&p>=-Ie&&p<=Ie}var ru=Gd?ye(Gd):Uh;function Wc(p){return typeof p=="string"||!_o(p)&&Si(p)&&nd(p)==Te}function Hc(p){return typeof p=="symbol"||Si(p)&&nd(p)==It}var Ca=tu?ye(tu):om;function au(p){return p===t}function zd(p){return Si(p)&&an(p)==Yt}function uf(p){return Si(p)&&nd(p)==qn}var mu=De(Td),hu=De(function(p,b){return p<=b});function id(p){if(!p)return[];if(br(p))return Wc(p)?dr(p):Ip(p);if(Zo&&p[Zo])return Kn(p[Zo]());var b=an(p),F=b==Je?Es:b==Ce?na:ys;return F(p)}function lu(p){if(!p)return p===0?p:0;if(p=Vr(p),p===ae||p===-ae){var b=p<0?-1:1;return b*ce}return p===p?p:0}function Ia(p){var b=lu(p),F=b%1;return b===b?F?b-F:b:0}function Kf(p){return p?_i(Ia(p),0,Ve):0}function Vr(p){if(typeof p=="number")return p;if(Hc(p))return je;if(no(p)){var b=typeof p.valueOf=="function"?p.valueOf():p;p=no(b)?b+"":b}if(typeof p!="string")return p===0?p:+p;p=Le(p);var F=jl.test(p);return F||Mu.test(p)?Uf(p.slice(2),F?2:8):Wr.test(p)?je:+p}function Of(p){return Vp(p,ju(p))}function Tf(p){return p?_i(Ia(p),-Ie,Ie):p===0?p:0}function Rl(p){return p==null?"":gf(p)}var Ff=um(function(p,b){if(rc(b)||br(b)){Vp(b,Vd(b),p);return}for(var F in b)Yc.call(b,F)&&un(p,F,b[F])}),df=um(function(p,b){Vp(b,ju(b),p)}),Qd=um(function(p,b,F,H){Vp(b,ju(b),p,H)}),Yu=um(function(p,b,F,H){Vp(b,Vd(b),p,H)}),nf=yn(Oo);function pp(p,b){var F=yv(p);return b==null?F:Ws(F,b)}var Ka=$l(function(p,b){p=Oi(p);var F=-1,H=b.length,be=H>2?b[2]:t;for(be&&Ps(b[0],b[1],be)&&(H=1);++F<H;)for(var Pe=b[F],Ze=ju(Pe),Ke=-1,ut=Ze.length;++Ke<ut;){var Gt=Ze[Ke],fn=p[Gt];(fn===t||$i(fn,Zl[Gt])&&!Yc.call(p,Gt))&&(p[Gt]=Pe[Gt])}return p}),Ru=$l(function(p){return p.push(t,vn),Vc(Ft,t,p)});function Xf(p,b){return re(p,In(b,3),go)}function zf(p,b){return re(p,In(b,3),yi)}function Qp(p,b){return p==null?p:Xd(p,In(b,3),ju)}function bp(p,b){return p==null?p:vo(p,In(b,3),ju)}function Cm(p,b){return p&&go(p,In(b,3))}function mc(p,b){return p&&yi(p,In(b,3))}function Ku(p){return p==null?[]:Jr(p,Vd(p))}function Xh(p){return p==null?[]:Jr(p,ju(p))}function xp(p,b,F){var H=p==null?t:Yl(p,b);return H===t?F:H}function Im(p,b){return p!=null&&Xs(p,b,Ic)}function Ym(p,b){return p!=null&&Xs(p,b,zp)}var Bh=dg(function(p,b,F){b!=null&&typeof b.toString!="function"&&(b=Dd.call(b)),p[b]=F},pv(Zf)),Oh=dg(function(p,b,F){b!=null&&typeof b.toString!="function"&&(b=Dd.call(b)),Yc.call(p,b)?p[b].push(F):p[b]=[F]},In),Iv=$l(op);function Vd(p){return br(p)?fe(p):zm(p)}function ju(p){return br(p)?fe(p,!0):fp(p)}function Wp(p,b){var F={};return b=In(b,3),go(p,function(H,be,Pe){Ts(F,b(H,be,Pe),H)}),F}function fv(p,b){var F={};return b=In(b,3),go(p,function(H,be,Pe){Ts(F,be,b(H,be,Pe))}),F}var se=um(function(p,b,F){fh(p,b,F)}),Ft=um(function(p,b,F,H){fh(p,b,F,H)}),dt=yn(function(p,b){var F={};if(p==null)return F;var H=!1;b=gc(b,function(Pe){return Pe=lm(Pe,p),H||(H=Pe.length>1),Pe}),Vp(p,Pn(p),F),H&&(F=to(F,d|h|m,kn));for(var be=b.length;be--;)Dv(F,b[be]);return F});function on(p,b){return _s(p,yr(In(b)))}var bt=yn(function(p,b){return p==null?{}:ph(p,b)});function _s(p,b){if(p==null)return{};var F=gc(Pn(p),function(H){return[H]});return b=In(b),im(p,F,function(H,be){return b(H,be[0])})}function zn(p,b,F){b=lm(b,p);var H=-1,be=b.length;for(be||(be=1,p=t);++H<be;){var Pe=p==null?t:p[Dp(b[H])];Pe===t&&(H=be,Pe=F),p=ea(Pe)?Pe.call(p):Pe}return p}function On(p,b,F){return p==null?p:Zp(p,b,F)}function ss(p,b,F,H){return H=typeof H=="function"?H:t,p==null?p:Zp(p,b,F,H)}var Cn=qt(Vd),Ht=qt(ju);function Fs(p,b,F){var H=_o(p),be=H||ti(p)||Ca(p);if(b=In(b,4),F==null){var Pe=p&&p.constructor;be?F=H?new Pe:[]:no(p)?F=ea(Pe)?yv(_n(p)):{}:F={}}return(be?Md:go)(p,function(Ze,Ke,ut){return b(F,Ze,Ke,ut)}),F}function Ds(p,b){return p==null?!0:Dv(p,b)}function xs(p,b,F){return p==null?p:Rv(p,b,vh(F))}function Rs(p,b,F,H){return H=typeof H=="function"?H:t,p==null?p:Rv(p,b,vh(F),H)}function ys(p){return p==null?[]:Se(p,Vd(p))}function ds(p){return p==null?[]:Se(p,ju(p))}function Gn(p,b,F){return F===t&&(F=b,b=t),F!==t&&(F=Vr(F),F=F===F?F:0),b!==t&&(b=Vr(b),b=b===b?b:0),_i(Vr(p),b,F)}function xn(p,b,F){return b=lu(b),F===t?(F=b,b=0):F=lu(F),p=Vr(p),nu(p,b,F)}function Ei(p,b,F){if(F&&typeof F!="boolean"&&Ps(p,b,F)&&(b=F=t),F===t&&(typeof b=="boolean"?(F=b,b=t):typeof p=="boolean"&&(F=p,p=t)),p===t&&b===t?(p=0,b=1):(p=lu(p),b===t?(b=p,p=0):b=lu(b)),p>b){var H=p;p=b,b=H}if(F||p%1||b%1){var be=er();return Qi(p+be*(b-p+qf("1e-"+((be+"").length-1))),b)}return rm(p,b)}var kl=_h(function(p,b,F){return b=b.toLowerCase(),p+(F?Do(b):b)});function Do(p){return pg(Rl(p).toLowerCase())}function oo(p){return p=Rl(p),p&&p.replace(xo,Xn).replace(Va,"")}function ma(p,b,F){p=Rl(p),b=gf(b);var H=p.length;F=F===t?H:_i(Ia(F),0,H);var be=F;return F-=b.length,F>=0&&p.slice(F,be)==b}function Xa(p){return p=Rl(p),p&&Aa.test(p)?p.replace(Na,hn):p}function bc(p){return p=Rl(p),p&&zu.test(p)?p.replace(ou,"\\$&"):p}var Da=_h(function(p,b,F){return p+(F?"-":"")+b.toLowerCase()}),Vf=_h(function(p,b,F){return p+(F?" ":"")+b.toLowerCase()}),Tr=kv("toLowerCase");function zo(p,b,F){p=Rl(p),b=Ia(b);var H=b?ul(p):0;if(!b||H>=b)return p;var be=(b-H)/2;return Q(El(be),F)+p+Q(gu(be),F)}function ha(p,b,F){p=Rl(p),b=Ia(b);var H=b?ul(p):0;return b&&H<b?p+Q(b-H,F):p}function Yr(p,b,F){p=Rl(p),b=Ia(b);var H=b?ul(p):0;return b&&H<b?Q(b-H,F)+p:p}function Pa(p,b,F){return F||b==null?b=0:b&&(b=+b),mo(Rl(p).replace(ja,""),b||0)}function Bu(p,b,F){return(F?Ps(p,b,F):b===t)?b=1:b=Ia(b),Hm(Rl(p),b)}function ef(){var p=arguments,b=Rl(p[0]);return p.length<3?b:b.replace(p[1],p[2])}var wp=_h(function(p,b,F){return p+(F?"_":"")+b.toLowerCase()});function Hp(p,b,F){return F&&typeof F!="number"&&Ps(p,b,F)&&(b=F=t),F=F===t?Ve:F>>>0,F?(p=Rl(p),p&&(typeof b=="string"||b!=null&&!Dc(b))&&(b=gf(b),!b&&es(p))?cm(dr(p),0,F):p.split(b,F)):[]}var Wd=_h(function(p,b,F){return p+(F?" ":"")+pg(b)});function jp(p,b,F){return p=Rl(p),F=F==null?0:_i(Ia(F),0,p.length),b=gf(b),p.slice(F,F+b.length)==b}function Zh(p,b,F){var H=nt.templateSettings;F&&Ps(p,b,F)&&(b=t),p=Rl(p),b=Qd({},b,H,Ot);var be=Qd({},b.imports,H.imports,Ot),Pe=Vd(be),Ze=Se(be,Pe),Ke,ut,Gt=0,fn=b.interpolate||Sr,$n="__p += '",cn=Nd((b.escape||Sr).source+"|"+fn.source+"|"+(fn===Gc?Vl:Sr).source+"|"+(b.evaluate||Sr).source+"|$","g"),eo="//# sourceURL="+(Yc.call(b,"sourceURL")?(b.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Sc+"]")+`
`;p.replace(cn,function(ws,Zn,Ss,Fr,Ra,xc){return Ss||(Ss=Fr),$n+=p.slice(Gt,xc).replace(ql,is),Zn&&(Ke=!0,$n+=`' +
__e(`+Zn+`) +
'`),Ra&&(ut=!0,$n+=`';
`+Ra+`;
__p += '`),Ss&&($n+=`' +
((__t = (`+Ss+`)) == null ? '' : __t) +
'`),Gt=xc+ws.length,ws}),$n+=`';
`;var Js=Yc.call(b,"variable")&&b.variable;if(!Js)$n=`with (obj) {
`+$n+`
}
`;else if(ll.test(Js))throw new zs(l);$n=(ut?$n.replace(Qt,""):$n).replace(ho,"$1").replace(ri,"$1;"),$n="function("+(Js||"obj")+`) {
`+(Js?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ke?", __e = _.escape":"")+(ut?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$n+`return __p
}`;var Co=mg(function(){return Hr(Pe,eo+"return "+$n).apply(t,Ze)});if(Co.source=$n,Ga(Co))throw Co;return Co}function kp(p){return Rl(p).toLowerCase()}function Pv(p){return Rl(p).toUpperCase()}function xh(p,b,F){if(p=Rl(p),p&&(F||b===t))return Le(p);if(!p||!(b=gf(b)))return p;var H=dr(p),be=dr(b),Pe=Ae(H,be),Ze=Rt(H,be)+1;return cm(H,Pe,Ze).join("")}function dm(p,b,F){if(p=Rl(p),p&&(F||b===t))return p.slice(0,Fu(p)+1);if(!p||!(b=gf(b)))return p;var H=dr(p),be=Rt(H,dr(b))+1;return cm(H,0,be).join("")}function Bp(p,b,F){if(p=Rl(p),p&&(F||b===t))return p.replace(ja,"");if(!p||!(b=gf(b)))return p;var H=dr(p),be=Ae(H,dr(b));return cm(H,be).join("")}function wh(p,b){var F=te,H=pe;if(no(b)){var be="separator"in b?b.separator:be;F="length"in b?Ia(b.length):F,H="omission"in b?gf(b.omission):H}p=Rl(p);var Pe=p.length;if(es(p)){var Ze=dr(p);Pe=Ze.length}if(F>=Pe)return p;var Ke=F-ul(H);if(Ke<1)return H;var ut=Ze?cm(Ze,0,Ke).join(""):p.slice(0,Ke);if(be===t)return ut+H;if(Ze&&(Ke+=ut.length-Ke),Dc(be)){if(p.slice(Ke).search(be)){var Gt,fn=ut;for(be.global||(be=Nd(be.source,Rl(kr.exec(be))+"g")),be.lastIndex=0;Gt=be.exec(fn);)var $n=Gt.index;ut=ut.slice(0,$n===t?Ke:$n)}}else if(p.indexOf(gf(be),Ke)!=Ke){var cn=ut.lastIndexOf(be);cn>-1&&(ut=ut.slice(0,cn))}return ut+H}function Pm(p){return p=Rl(p),p&&ar.test(p)?p.replace(jo,gi):p}var Km=_h(function(p,b,F){return p+(F?" ":"")+b.toUpperCase()}),pg=kv("toUpperCase");function Tg(p,b,F){return p=Rl(p),b=F?t:b,b===t?Mi(p)?Ki(p):K(p):p.match(b)||[]}var mg=$l(function(p,b){try{return Vc(p,t,b)}catch(F){return Ga(F)?F:new zs(F)}}),o0=yn(function(p,b){return Md(b,function(F){F=Dp(F),Ts(p,F,lr(p[F],p))}),p});function Hg(p){var b=p==null?0:p.length,F=In();return p=b?gc(p,function(H){if(typeof H[1]!="function")throw new vr(a);return[F(H[0]),H[1]]}):[],$l(function(H){for(var be=-1;++be<b;){var Pe=p[be];if(Vc(Pe[0],this,H))return Vc(Pe[1],this,H)}})}function i0(p){return Ha(to(p,d))}function pv(p){return function(){return p}}function Fg(p,b){return p==null||p!==p?b:p}var mv=ug(),Mm=ug(!0);function Zf(p){return p}function hg(p){return bm(typeof p=="function"?p:to(p,d))}function w0(p){return $v(to(p,d))}function S_(p,b){return Vm(p,to(b,d))}var Cy=$l(function(p,b){return function(F){return op(F,p,b)}}),Iy=$l(function(p,b){return function(F){return op(p,F,b)}});function C_(p,b,F){var H=Vd(b),be=Jr(b,H);F==null&&!(no(b)&&(be.length||!H.length))&&(F=b,b=p,p=this,be=Jr(b,Vd(b)));var Pe=!(no(F)&&"chain"in F)||!!F.chain,Ze=ea(p);return Md(be,function(Ke){var ut=b[Ke];p[Ke]=ut,Ze&&(p.prototype[Ke]=function(){var Gt=this.__chain__;if(Pe||Gt){var fn=p(this.__wrapped__),$n=fn.__actions__=Ip(this.__actions__);return $n.push({func:ut,args:arguments,thisArg:p}),fn.__chain__=Gt,fn}return ut.apply(p,qu([this.value()],arguments))})}),p}function Py(){return dc._===this&&(dc._=Rd),this}function I_(){}function My(p){return p=Ia(p),$l(function(b){return wu(b,p)})}var Ny=j(gc),Ay=j(Kd),Ty=j(Pf);function r1(p){return Ns(p)?Nt(Dp(p)):Wm(p)}function Fy(p){return function(b){return p==null?t:Yl(p,b)}}var Ly=ie(),Ey=ie(!0);function P_(){return[]}function M_(){return!1}function $y(){return{}}function Dy(){return""}function N_(){return!0}function Ry(p,b){if(p=Ia(p),p<1||p>Ie)return[];var F=Ve,H=Qi(p,Ve);b=In(b),p-=Ve;for(var be=_e(H,b);++F<p;)b(F);return be}function A_(p){return _o(p)?gc(p,Dp):Hc(p)?[p]:Ip(Pp(Rl(p)))}function jy(p){var b=++Lu;return Rl(p)+b}var By=S(function(p,b){return p+b},0),Oy=lt("ceil"),zy=S(function(p,b){return p/b},1),Vy=lt("floor");function Wy(p){return p&&p.length?fc(p,Zf,dp):t}function Hy(p,b){return p&&p.length?fc(p,In(b,2),dp):t}function qy(p){return pt(p,Zf)}function Uy(p,b){return pt(p,In(b,2))}function Gy(p){return p&&p.length?fc(p,Zf,Td):t}function Yy(p,b){return p&&p.length?fc(p,In(b,2),Td):t}var Ky=S(function(p,b){return p*b},1),Xy=lt("round"),at=S(function(p,b){return p-b},0);function Oe(p){return p&&p.length?Z(p,Zf):0}function _t(p,b){return p&&p.length?Z(p,In(b,2)):0}return nt.after=yo,nt.ary=_a,nt.assign=Ff,nt.assignIn=df,nt.assignInWith=Qd,nt.assignWith=Yu,nt.at=nf,nt.before=xi,nt.bind=lr,nt.bindAll=o0,nt.bindKey=Ai,nt.castArray=Ti,nt.chain=bf,nt.chunk=Ql,nt.compact=Ir,nt.concat=kd,nt.cond=Hg,nt.conforms=i0,nt.constant=pv,nt.countBy=Vi,nt.create=pp,nt.curry=$o,nt.curryRight=Br,nt.debounce=oa,nt.defaults=Ka,nt.defaultsDeep=Ru,nt.defer=zl,nt.delay=ci,nt.difference=Rp,nt.differenceBy=Jp,nt.differenceWith=dv,nt.drop=yp,nt.dropRight=Hv,nt.dropRightWhile=Pg,nt.dropWhile=Mg,nt.fill=Ng,nt.filter=Jc,nt.flatMap=Su,nt.flatMapDeep=sa,nt.flatMapDepth=Ol,nt.flatten=Sv,nt.flattenDeep=Ag,nt.flattenDepth=Cv,nt.flip=Ur,nt.flow=mv,nt.flowRight=Mm,nt.fromPairs=Gm,nt.functions=Ku,nt.functionsIn=Xh,nt.groupBy=Bt,nt.initial=iu,nt.intersection=hd,nt.intersectionBy=yf,nt.intersectionWith=Zd,nt.invert=Bh,nt.invertBy=Oh,nt.invokeMap=cs,nt.iteratee=hg,nt.keyBy=ts,nt.keys=Vd,nt.keysIn=ju,nt.map=aa,nt.mapKeys=Wp,nt.mapValues=fv,nt.matches=w0,nt.matchesProperty=S_,nt.memoize=fa,nt.merge=se,nt.mergeWith=Ft,nt.method=Cy,nt.methodOf=Iy,nt.mixin=C_,nt.negate=yr,nt.nthArg=My,nt.omit=dt,nt.omitBy=on,nt.once=Ea,nt.orderBy=ko,nt.over=Ny,nt.overArgs=Zs,nt.overEvery=Ay,nt.overSome=Ty,nt.partial=us,nt.partialRight=gs,nt.partition=or,nt.pick=bt,nt.pickBy=_s,nt.property=r1,nt.propertyOf=Fy,nt.pull=qa,nt.pullAll=Zc,nt.pullAllBy=Eo,nt.pullAllWith=Fa,nt.pullAt=il,nt.range=Ly,nt.rangeRight=Ey,nt.rearg=ui,nt.reject=qr,nt.remove=Hl,nt.rest=Gr,nt.reverse=Bf,nt.sampleSize=da,nt.set=On,nt.setWith=ss,nt.shuffle=Uo,nt.slice=ai,nt.sortBy=bi,nt.sortedUniq=jr,nt.sortedUniqBy=Mr,nt.split=Hp,nt.spread=wa,nt.tail=mr,nt.take=Mo,nt.takeRight=La,nt.takeRightWhile=k,nt.takeWhile=A,nt.tap=ip,nt.throttle=el,nt.thru=Bd,nt.toArray=id,nt.toPairs=Cn,nt.toPairsIn=Ht,nt.toPath=A_,nt.toPlainObject=Of,nt.transform=Fs,nt.unary=ei,nt.union=B,nt.unionBy=R,nt.unionWith=U,nt.uniq=q,nt.uniqBy=ve,nt.uniqWith=Re,nt.unset=Ds,nt.unzip=rt,nt.unzipWith=Ut,nt.update=xs,nt.updateWith=Rs,nt.values=ys,nt.valuesIn=ds,nt.without=ls,nt.words=Tg,nt.wrap=ji,nt.xor=ns,nt.xorBy=Mn,nt.xorWith=qo,nt.zip=Yo,nt.zipObject=Nc,nt.zipObjectDeep=jd,nt.zipWith=cf,nt.entries=Cn,nt.entriesIn=Ht,nt.extend=df,nt.extendWith=Qd,C_(nt,nt),nt.add=By,nt.attempt=mg,nt.camelCase=kl,nt.capitalize=Do,nt.ceil=Oy,nt.clamp=Gn,nt.clone=Bi,nt.cloneDeep=oi,nt.cloneDeepWith=Jo,nt.cloneWith=qi,nt.conformsTo=Ar,nt.deburr=oo,nt.defaultTo=Fg,nt.divide=zy,nt.endsWith=ma,nt.eq=$i,nt.escape=Xa,nt.escapeRegExp=bc,nt.every=xa,nt.find=Ua,nt.findIndex=fg,nt.findKey=Xf,nt.findLast=ku,nt.findLastIndex=bh,nt.findLastKey=zf,nt.floor=Vy,nt.forEach=od,nt.forEachRight=G,nt.forIn=Qp,nt.forInRight=bp,nt.forOwn=Cm,nt.forOwnRight=mc,nt.get=xp,nt.gt=Ui,nt.gte=wi,nt.has=Im,nt.hasIn=Ym,nt.head=Hi,nt.identity=Zf,nt.includes=Ks,nt.indexOf=Pr,nt.inRange=xn,nt.invoke=Iv,nt.isArguments=tl,nt.isArray=_o,nt.isArrayBuffer=rl,nt.isArrayLike=br,nt.isArrayLikeObject=di,nt.isBoolean=$a,nt.isBuffer=ti,nt.isDate=ki,nt.isElement=Or,nt.isEmpty=Qr,nt.isEqual=cr,nt.isEqualWith=ya,nt.isError=Ga,nt.isFinite=zr,nt.isFunction=ea,nt.isInteger=pa,nt.isLength=Ko,nt.isMap=ka,nt.isMatch=Xo,nt.isMatchWith=Sa,nt.isNaN=tr,nt.isNative=Ya,nt.isNil=ml,nt.isNull=ac,nt.isNumber=wl,nt.isObject=no,nt.isObjectLike=Si,nt.isPlainObject=Kl,nt.isRegExp=Dc,nt.isSafeInteger=pc,nt.isSet=ru,nt.isString=Wc,nt.isSymbol=Hc,nt.isTypedArray=Ca,nt.isUndefined=au,nt.isWeakMap=zd,nt.isWeakSet=uf,nt.join=Et,nt.kebabCase=Da,nt.last=hs,nt.lastIndexOf=Lo,nt.lowerCase=Vf,nt.lowerFirst=Tr,nt.lt=mu,nt.lte=hu,nt.max=Wy,nt.maxBy=Hy,nt.mean=qy,nt.meanBy=Uy,nt.min=Gy,nt.minBy=Yy,nt.stubArray=P_,nt.stubFalse=M_,nt.stubObject=$y,nt.stubString=Dy,nt.stubTrue=N_,nt.multiply=Ky,nt.nth=So,nt.noConflict=Py,nt.noop=I_,nt.now=No,nt.pad=zo,nt.padEnd=ha,nt.padStart=Yr,nt.parseInt=Pa,nt.random=Ei,nt.reduce=pl,nt.reduceRight=Nr,nt.repeat=Bu,nt.replace=ef,nt.result=zn,nt.round=Xy,nt.runInContext=Jt,nt.sample=ec,nt.size=Qa,nt.snakeCase=wp,nt.some=Bn,nt.sortedIndex=Bs,nt.sortedIndexBy=Fn,nt.sortedIndexOf=ks,nt.sortedLastIndex=vs,nt.sortedLastIndexBy=li,nt.sortedLastIndexOf=ra,nt.startCase=Wd,nt.startsWith=jp,nt.subtract=at,nt.sum=Oe,nt.sumBy=_t,nt.template=Zh,nt.times=Ry,nt.toFinite=lu,nt.toInteger=Ia,nt.toLength=Kf,nt.toLower=kp,nt.toNumber=Vr,nt.toSafeInteger=Tf,nt.toString=Rl,nt.toUpper=Pv,nt.trim=xh,nt.trimEnd=dm,nt.trimStart=Bp,nt.truncate=wh,nt.unescape=Pm,nt.uniqueId=jy,nt.upperCase=Km,nt.upperFirst=pg,nt.each=od,nt.eachRight=G,nt.first=Hi,C_(nt,function(){var p={};return go(nt,function(b,F){Yc.call(nt.prototype,F)||(p[F]=b)}),p}(),{chain:!1}),nt.VERSION=s,Md(["bind","bindKey","curry","curryRight","partial","partialRight"],function(p){nt[p].placeholder=nt}),Md(["drop","take"],function(p,b){pu.prototype[p]=function(F){F=F===t?1:Zr(Ia(F),0);var H=this.__filtered__&&!b?new pu(this):this.clone();return H.__filtered__?H.__takeCount__=Qi(F,H.__takeCount__):H.__views__.push({size:Qi(F,Ve),type:p+(H.__dir__<0?"Right":"")}),H},pu.prototype[p+"Right"]=function(F){return this.reverse()[p](F).reverse()}}),Md(["filter","map","takeWhile"],function(p,b){var F=b+1,H=F==de||F==ge;pu.prototype[p]=function(be){var Pe=this.clone();return Pe.__iteratees__.push({iteratee:In(be,3),type:F}),Pe.__filtered__=Pe.__filtered__||H,Pe}}),Md(["head","last"],function(p,b){var F="take"+(b?"Right":"");pu.prototype[p]=function(){return this[F](1).value()[0]}}),Md(["initial","tail"],function(p,b){var F="drop"+(b?"":"Right");pu.prototype[p]=function(){return this.__filtered__?new pu(this):this[F](1)}}),pu.prototype.compact=function(){return this.filter(Zf)},pu.prototype.find=function(p){return this.filter(p).head()},pu.prototype.findLast=function(p){return this.reverse().find(p)},pu.prototype.invokeMap=$l(function(p,b){return typeof p=="function"?new pu(this):this.map(function(F){return op(F,p,b)})}),pu.prototype.reject=function(p){return this.filter(yr(In(p)))},pu.prototype.slice=function(p,b){p=Ia(p);var F=this;return F.__filtered__&&(p>0||b<0)?new pu(F):(p<0?F=F.takeRight(-p):p&&(F=F.drop(p)),b!==t&&(b=Ia(b),F=b<0?F.dropRight(-b):F.take(b-p)),F)},pu.prototype.takeRightWhile=function(p){return this.reverse().takeWhile(p).reverse()},pu.prototype.toArray=function(){return this.take(Ve)},go(pu.prototype,function(p,b){var F=/^(?:filter|find|map|reject)|While$/.test(b),H=/^(?:head|last)$/.test(b),be=nt[H?"take"+(b=="last"?"Right":""):b],Pe=H||/^find/.test(b);be&&(nt.prototype[b]=function(){var Ze=this.__wrapped__,Ke=H?[1]:arguments,ut=Ze instanceof pu,Gt=Ke[0],fn=ut||_o(Ze),$n=function(Zn){var Ss=be.apply(nt,qu([Zn],Ke));return H&&cn?Ss[0]:Ss};fn&&F&&typeof Gt=="function"&&Gt.length!=1&&(ut=fn=!1);var cn=this.__chain__,eo=!!this.__actions__.length,Js=Pe&&!cn,Co=ut&&!eo;if(!Pe&&fn){Ze=Co?Ze:new pu(this);var ws=p.apply(Ze,Ke);return ws.__actions__.push({func:Bd,args:[$n],thisArg:t}),new Fp(ws,cn)}return Js&&Co?p.apply(this,Ke):(ws=this.thru($n),Js?H?ws.value()[0]:ws.value():ws)})}),Md(["pop","push","shift","sort","splice","unshift"],function(p){var b=_l[p],F=/^(?:push|sort|unshift)$/.test(p)?"tap":"thru",H=/^(?:pop|shift)$/.test(p);nt.prototype[p]=function(){var be=arguments;if(H&&!this.__chain__){var Pe=this.value();return b.apply(_o(Pe)?Pe:[],be)}return this[F](function(Ze){return b.apply(_o(Ze)?Ze:[],be)})}}),go(pu.prototype,function(p,b){var F=nt[b];if(F){var H=F.name+"";Yc.call(Lc,H)||(Lc[H]=[]),Lc[H].push({name:b,func:F})}}),Lc[Wv(t,M).name]=[{name:"wrapper",func:t}],pu.prototype.clone=Em,pu.prototype.reverse=Vg,pu.prototype.value=kg,nt.prototype.at=xf,nt.prototype.chain=Jd,nt.prototype.commit=Od,nt.prototype.next=wf,nt.prototype.plant=Ri,nt.prototype.reverse=_r,nt.prototype.toJSON=nt.prototype.valueOf=nt.prototype.value=ua,nt.prototype.first=nt.prototype.head,Zo&&(nt.prototype[Zo]=kf),nt},ca=Xi();Pd?((Pd.exports=ca)._=ca,Gf._=ca):dc._=ca}).call(F0)})(b2,b2.exports);var Lj=b2.exports;const wn=_y(Lj),H_="userId",bw="__smartchartUserId",o8=["userId","userID","user_id","userid","uid","clerkId"];let O_=null;function D2(n){if(typeof n!="string")return null;const e=n.trim();return e.length>0?e:null}function Qk(n){try{return D2(n())}catch{return null}}function Ej(n){const e=D2(n);O_=e;let t=!1;if(typeof window>"u")return{userId:e,persisted:t};if(e){window[bw]=e;try{localStorage.setItem(H_,e),t=!0}catch{}try{sessionStorage.setItem(H_,e),t=!0}catch{}return{userId:e,persisted:t}}try{localStorage.removeItem(H_)}catch{}try{sessionStorage.removeItem(H_)}catch{}try{delete window[bw]}catch{}return{userId:null,persisted:t}}function Og(){if(O_)return O_;if(typeof window>"u")return null;const n=D2(window[bw]);if(n)return O_=n,n;const e=Qk(()=>localStorage.getItem(H_));if(e)return O_=e,e;const t=Qk(()=>sessionStorage.getItem(H_));return t?(O_=t,t):null}function $j(n){if(typeof window>"u")return{userId:null,fromUrl:!1,persisted:!1};const e=n??new URL(window.location.href);for(const t of o8){const s=D2(e.searchParams.get(t));if(s){const o=Ej(s);return{userId:o.userId,fromUrl:!0,persisted:o.persisted}}}return{userId:Og(),fromUrl:!1,persisted:!1}}const Dj=["#b45309","#111827","#334155","#64748b","#16a34a","#2563eb","#7c3aed","#ef4444"],ay="smartchart.quickColors",a6=30,w_=Fm(Dj);let e5=!1;function i8(){if(typeof localStorage>"u")return ay;const n=Og();return n?`${ay}.${n}`:ay}function Rj(n){return Array.isArray(n)?n.filter(e=>typeof e=="string"&&e.trim().length>0).slice(0,a6):[]}function hx(){if(typeof localStorage>"u")return;const n=i8();let e=localStorage.getItem(n);if(!e&&Og()){const s=localStorage.getItem(ay);s&&(e=s,localStorage.setItem(n,s))}if(e)try{const t=JSON.parse(e);w_.set(Rj(t))}catch{}}function r8(n){if(typeof localStorage>"u")return;const e=Array.isArray(n)?n:mm(w_);try{localStorage.setItem(i8(),JSON.stringify(e))}catch{}}function jj(){e5||typeof window>"u"||(e5=!0,hx(),window.addEventListener("storage",n=>{if(n.key==="userId"){hx();return}n.key&&n.key.startsWith(ay)&&hx()}))}function Bj(n){if(!n)return;const e=mm(w_);if(e.includes(n)||e.length>=a6)return;const t=[...e,n];w_.set(t),r8(t)}function Oj(n){if(!n)return;const e=mm(w_).filter(t=>t!==n);w_.set(e),r8(e)}function zj(n,e,t){const s=n.target;e(parseInt(s.value)),t("opacityChange",e())}function Vj(n,e){n.stopPropagation(),x(e,!0)}function Wj(n,e,t,s,o,r,a,l){if(/^#[0-9A-F]{6}$/i.test(i(e))){const c=t(i(e));x(s,c.h),x(o,c.s),x(r,c.l),a(i(e)),l("colorChange",i(e))}}function Hj(n,e,t,s,o){i(e)&&/^#[0-9A-Fa-f]{6}$/.test(i(e))&&(t(i(e)),s("colorChange",i(e)),o(i(e)))}var qj=(n,e)=>{n.stopPropagation(),e()},Uj=(n,e)=>e(!1),Gj=(n,e,t)=>e(i(t)),Yj=Me("<button></button>"),Kj=Me('<div class="flex gap-[2px]"></div>'),Xj=(n,e,t)=>e(i(t)),Zj=(n,e,t)=>e(n,i(t)),Jj=(n,e,t)=>e(n,i(t)),Qj=Me("<button></button>"),eB=Me(`<button class="w-4 h-4 rounded-[2px] border border-dashed border-gray-300 dark:border-white/20 bg-white/60 dark:bg-white/5
                     flex items-center justify-center text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.25" d="M12 4v16m8-8H4"></path></svg></button>`),tB=n=>n.stopPropagation(),nB=(n,e,t)=>e(i(t).color),sB=Me('<div class="absolute z-10"><button class="flex items-center gap-2 px-3 py-2 rounded-md bg-[#1E2329] text-white text-xs border border-white/10 shadow-lg"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-1 12a2 2 0 01-2 2H8a2 2 0 01-2-2L5 7m3 0h8m-6 0V5a1 1 0 011-1h2a1 1 0 011 1v2"></path></svg> <span>Remove color</span></button></div>'),oB=Me('<div class="inline-flex flex-col items-stretch"><div class="flex items-center justify-between mb-3"><div class="flex items-center gap-2"><div class="w-7 h-7 rounded-md border border-gray-200/80 dark:border-white/10 shadow-inner"></div> <div class="leading-tight"><div class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Selected</div> <div class="text-sm font-semibold text-gray-900 dark:text-gray-100"> </div></div></div> <button class="px-3 py-1 rounded-md text-xs font-semibold bg-gray-900 text-white dark:bg-white dark:text-[#111827] hover:opacity-90 transition-opacity">Done</button></div> <div class="h-px bg-gray-200/80 dark:bg-white/10 mb-3"></div> <div class="mb-3 flex flex-col gap-[2px] border border-gray-300 dark:border-[#2E313A] bg-white dark:bg-[#111318] p-[2px] w-full"></div> <div class="mb-3"><div class="flex items-center justify-between mb-2"><span class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Quick</span> <span class="text-[10px] text-gray-400 dark:text-gray-500">Shortcuts</span></div> <div class="grid grid-cols-10 gap-[2px] p-[2px] border border-transparent"><!> <!></div></div> <div><div class="flex items-center justify-between mb-2"><span class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Opacity</span> <span class="text-xs font-semibold text-gray-900 dark:text-gray-100"> </span></div> <div class="relative"><div class="relative h-3 rounded-[2px] border border-gray-300 dark:border-[#2E313A] overflow-hidden" style="background-image: repeating-conic-gradient(#7a7a7a 0% 25%, #2b2b2b 0% 50%); background-size: 6px 6px; background-position: 0 0;"><div class="absolute inset-0"></div> <input type="range" min="0" max="100" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"></div> <div class="absolute top-1/2 w-3.5 h-3.5 bg-white dark:bg-[#1B1D23] border border-gray-300 dark:border-[#2E313A] rounded-full transform -translate-y-1/2 pointer-events-none"></div></div></div> <!></div>'),iB=(n,e)=>e(!1),rB=(n,e)=>x(e,!1),aB=Me('<div class="mb-3 flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-7 h-7 rounded-md border border-gray-200/80 dark:border-white/10 shadow-inner"></div> <div class="leading-tight"><div class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Custom</div> <div class="text-sm font-semibold text-gray-900 dark:text-gray-100"> </div></div></div> <div class="flex items-center gap-2"><button class="px-3 py-1 rounded-md text-xs font-semibold bg-gray-900 text-white dark:bg-white dark:text-[#111827] hover:opacity-90 transition-opacity">Done</button> <button class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button></div></div> <div class="h-px bg-gray-200/80 dark:bg-white/10 mb-3"></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Hex</label> <input type="text" class="w-full px-3 py-2 bg-white/80 dark:bg-[#1A1A1A] border border-gray-200/80 dark:border-[#2E313A] rounded-lg text-gray-900 dark:text-white text-sm focus:border-gray-900/30 dark:focus:border-white/30 focus:outline-none" placeholder="#000000"></div> <div class="mb-3"><div class="w-full h-7 rounded-lg border border-gray-200/80 dark:border-[#2E313A] shadow-inner"></div></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Picker</label> <div class="relative w-full h-24 rounded-xl border border-gray-200/80 dark:border-[#2E313A] cursor-crosshair overflow-hidden"><div class="absolute w-3 h-3 border-2 border-white rounded-full transform -translate-x-1/2 -translate-y-1/2 pointer-events-none shadow-sm"></div></div></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Hue</label> <div class="relative"><div class="relative h-3 rounded-full overflow-hidden border border-gray-200/80 dark:border-white/10"><div class="absolute inset-0" style="background: linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);"></div> <input type="range" min="0" max="360" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"></div> <div class="absolute top-1/2 w-4 h-4 bg-white dark:bg-[#1B1D23] border border-gray-300 dark:border-white/10 rounded-full transform -translate-y-1/2 pointer-events-none shadow-md"></div></div></div> <button class="w-full py-2 rounded-lg bg-gradient-to-r from-gray-900 to-gray-700 text-white text-sm font-semibold shadow-sm hover:opacity-95 transition-opacity">Add Color</button>',1),lB=Me(`<div class="color-picker-container fixed z-[360000] bg-white dark:bg-[#1B1D23] border border-gray-200 dark:border-[#2E313A] rounded-lg shadow-[0_8px_20px_rgba(0,0,0,0.22)] p-4 transition-colors duration-150" style="
      left: 50%; 
      top: 50%; 
      transform: translate(-50%, -50%); 
      max-height: 90vh; 
      max-width: 90vw;
      overflow-y: auto;
    "><!></div>`);function Yv(n,e){Ld(e,!1);const t=tm(),s=()=>vl(w_,"$quickColors",t),o=Hh();let r=pi(e,"selectedColor",12,"#1677FF"),a=pi(e,"show",12,!1),l=pi(e,"opacity",12,100),c=vd(),f=vd(),u=!1,d=vd(!1),h=vd({visible:!1,x:0,y:0,color:""}),m=null,g=vd(r()),w=vd(r()),C=vd("#000000"),M=vd(0),P=vd(100),T=vd(50);const N=de(),L=10,te=L*16+(L-1)*2+2*2+1*2;function pe(st){r(st),o("colorChange",st),he()}function J(st){Bj(st),x(d,!1)}function le(st,xt,Je){Je/=100;const Xe=xt*Math.min(Je,1-Je)/100,Be=Qe=>{const ct=(Qe+st/30)%12,Mt=Je-Xe*Math.max(Math.min(ct-3,9-ct,1),-1);return Math.round(255*Mt).toString(16).padStart(2,"0")};return`#${Be(0)}${Be(8)}${Be(4)}`}function de(){const st=["#ffffff","#e6e6e6","#cccccc","#b3b3b3","#999999","#808080","#666666","#4d4d4d","#333333","#000000"],xt=[0,15,30,45,60,120,180,210,240,300],Je=[50,88,78,68,58,42,28],Xe=90,Be=Je.map(Qe=>xt.map(ct=>le(ct,Xe,Qe)));return[st,...Be]}function he(){x(h,{visible:!1,x:0,y:0,color:""})}function ge(st,xt,Je){let Qe=st,ct=xt;if(i(c)){const{width:Mt,height:mt}=i(c).getBoundingClientRect();Qe+140>Mt&&(Qe=Math.max(8,Mt-140-8)),ct+36>mt&&(ct=Math.max(8,mt-36-8))}x(h,{visible:!0,x:Qe,y:ct,color:Je})}function ae(st,xt){if(st.preventDefault(),st.stopPropagation(),!i(c))return;const Je=i(c).getBoundingClientRect();ge(st.clientX-Je.left,st.clientY-Je.top,xt)}function Ie(st){Oj(st),he()}function ce(st,xt){if(st.pointerType==="mouse")return;m&&clearTimeout(m);const Je=st.currentTarget;if(!Je||!i(c))return;const Xe=i(c).getBoundingClientRect(),Be=Je.getBoundingClientRect();m=setTimeout(()=>{const Qe=Be.right-Xe.left+8,ct=Be.top-Xe.top;ge(Qe,ct,xt)},450)}function je(){m&&(clearTimeout(m),m=null)}function Ve(st){const xt=(st||"").trim();if(!xt)return null;if(/^#([0-9a-f]{6})$/i.test(xt))return{r:parseInt(xt.slice(1,3),16),g:parseInt(xt.slice(3,5),16),b:parseInt(xt.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(xt)){const Xe=xt[1],Be=xt[2],Qe=xt[3];return{r:parseInt(Xe+Xe,16),g:parseInt(Be+Be,16),b:parseInt(Qe+Qe,16)}}const Je=xt.match(/^rgba?\(([^)]+)\)$/i);if(Je){const Xe=Je[1].split(",").map(Be=>parseFloat(Be.trim()));if(Xe.length>=3&&Xe.every(Be=>!Number.isNaN(Be)))return{r:Math.round(Xe[0]),g:Math.round(Xe[1]),b:Math.round(Xe[2])}}return null}function We(st,xt){const Je=Ve(st);if(!Je)return null;const Xe=Math.max(0,Math.min(1,xt));return`rgba(${Je.r}, ${Je.g}, ${Je.b}, ${Xe})`}function He(st){const xt=parseInt(st.slice(1,3),16)/255,Je=parseInt(st.slice(3,5),16)/255,Xe=parseInt(st.slice(5,7),16)/255,Be=Math.max(xt,Je,Xe),Qe=Math.min(xt,Je,Xe);let ct=0,Mt=0,mt=(Be+Qe)/2;if(Be!==Qe){const Ce=Be-Qe;switch(Mt=mt>.5?Ce/(2-Be-Qe):Ce/(Be+Qe),Be){case xt:ct=(Je-Xe)/Ce+(Je<Xe?6:0);break;case Je:ct=(Xe-xt)/Ce+2;break;case Xe:ct=(xt-Je)/Ce+4;break}ct/=6}return{h:ct*360,s:Mt*100,l:mt*100}}function Ue(){x(C,le(i(M),i(P),i(T))),r(i(C)),o("colorChange",i(C))}function et(st){u=!0,Lt(st),document.addEventListener("mousemove",ft),document.addEventListener("mouseup",it),st.preventDefault()}function ft(st){u&&i(f)&&Lt(st)}function it(){u=!1,document.removeEventListener("mousemove",ft),document.removeEventListener("mouseup",it)}function Lt(st){if(!i(f))return;const xt=i(f).getBoundingClientRect(),Je=Math.max(0,Math.min(1,(st.clientX-xt.left)/xt.width)),Xe=Math.max(0,Math.min(1,(st.clientY-xt.top)/xt.height));x(P,Je*100),x(T,(1-Xe)*100),Ue()}function Tt(st){const xt=st.target;i(c)&&!i(c).contains(xt)&&(a(!1),x(d,!1),o("close"))}Mh(()=>{jj()}),b0(()=>{typeof document<"u"&&document.removeEventListener("click",Tt,!0)}),vm(()=>(th(r()),th(l())),()=>{x(g,We(r(),l()/100)||r())}),vm(()=>th(r()),()=>{x(w,We(r(),.6)||r())}),vm(()=>th(a()),()=>{a()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("click",Tt,!0)},0)}),vm(()=>th(a()),()=>{!a()&&typeof document<"u"&&document.removeEventListener("click",Tt,!0)}),j0(),_v();var Pt=Yn(),St=tn(Pt);Ye(St,a,st=>{var xt=lB();xt.__click=[qj,he];var Je=y(xt);Ye(Je,()=>!i(d),Xe=>{var Be=oB();Dt(Be,"style",`width: ${te}px;`);var Qe=y(Be),ct=y(Qe),Mt=y(ct),mt=v(Mt,2),Ce=v(y(mt),2),Te=y(Ce,!0);_(Ce),_(mt),_(ct);var It=v(ct,2);It.__click=[Uj,a],_(Qe);var $t=v(Qe,4);Ro($t,5,()=>N,fi,(ho,ri)=>{var jo=Kj();Ro(jo,5,()=>i(ri),fi,(Na,ar)=>{var Aa=Yj();Aa.__click=[Gj,pe,ar],Ne(()=>{Fi(Aa,`w-4 h-4 rounded-[2px] focus:outline-none
                         ${(r()===i(ar)?"shadow-[inset_0_0_0_2px_rgba(0,0,0,0.65)] dark:shadow-[inset_0_0_0_2px_rgba(255,255,255,0.95)]":"")??""}`),Dt(Aa,"style",`background-color: ${i(ar)??""};`)}),Y(Na,Aa)}),_(jo),Y(ho,jo)}),_($t);var Yt=v($t,2),qn=v(y(Yt),2);Dt(qn,"style",`width: ${te}px;`);var Vn=y(qn);Ro(Vn,1,s,fi,(ho,ri)=>{var jo=Qj();jo.__click=[Xj,pe,ri],jo.__contextmenu=[Zj,ae,ri],jo.__pointerdown=[Jj,ce,ri],jo.__pointerup=je,Ne(()=>{Fi(jo,`w-4 h-4 rounded-[2px] transition-colors focus:outline-none
                     ${(r()===i(ri)?"shadow-[inset_0_0_0_2px_rgba(0,0,0,0.65)] dark:shadow-[inset_0_0_0_2px_rgba(255,255,255,0.95)]":"")??""}`),Dt(jo,"style",`background-color: ${i(ri)??""};`)}),ld("pointerleave",jo,je),ld("pointercancel",jo,je),Y(ho,jo)});var Dn=v(Vn,2);Ye(Dn,()=>s().length<a6,ho=>{var ri=eB();ri.__click=[Vj,d],Y(ho,ri)}),_(qn),_(Yt);var Wn=v(Yt,2),pn=y(Wn),gn=v(y(pn),2),Qs=y(gn);_(gn),_(pn);var Is=v(pn,2),Cs=y(Is),ro=y(Cs),bs=v(ro,2);mn(bs),bs.__input=[zj,l,o],_(Cs);var zt=v(Cs,2);_(Is),_(Wn);var Qt=v(Wn,2);Ye(Qt,()=>i(h).visible,ho=>{var ri=sB();ri.__click=[tB];var jo=y(ri);jo.__click=[nB,Ie,h],_(ri),Ne(()=>Dt(ri,"style",`left: ${i(h).x??""}px; top: ${i(h).y??""}px;`)),Y(ho,ri)}),_(Be),Ne(()=>{Dt(Mt,"style",`background-color: ${r()??""};`),tt(Te,r()),tt(Qs,`${l()??""}%`),Dt(ro,"style",`background: linear-gradient(to right, rgba(0,0,0,0), ${i(g)??""});`),Dt(zt,"style",`left: calc(${l()??""}% - 7px); box-shadow: 0 0 0 1px rgba(0,0,0,0.25), 0 0 8px ${i(w)??""};`)}),As(bs,l),Y(Xe,Be)},Xe=>{var Be=aB(),Qe=tn(Be),ct=y(Qe),Mt=y(ct),mt=v(Mt,2),Ce=v(y(mt),2),Te=y(Ce,!0);_(Ce),_(mt),_(ct);var It=v(ct,2),$t=y(It);$t.__click=[iB,a];var Yt=v($t,2);Yt.__click=[rB,d],_(It),_(Qe);var qn=v(Qe,4),Vn=v(y(qn),2);mn(Vn),Vn.__input=[Wj,C,He,M,P,T,r,o],_(qn);var Dn=v(qn,2),Wn=y(Dn);_(Dn);var pn=v(Dn,2),gn=v(y(pn),2);gn.__mousedown=et;var Qs=y(gn);_(gn),ep(gn,ho=>x(f,ho),()=>i(f)),_(pn);var Is=v(pn,2),Cs=v(y(Is),2),ro=y(Cs),bs=v(y(ro),2);mn(bs),bs.__input=Ue,_(ro);var zt=v(ro,2);_(Cs),_(Is);var Qt=v(Is,2);Qt.__click=[Hj,C,r,o,J],Ne(()=>{Dt(Mt,"style",`background-color: ${i(C)??""};`),tt(Te,i(C)),Dt(Wn,"style",`background-color: ${i(C)??""};`),Dt(gn,"style",`background: linear-gradient(to bottom, transparent, black), linear-gradient(to right, white, hsl(${i(M)??""}, 100%, 50%));`),Dt(Qs,"style",`left: ${i(P)??""}%; top: ${100-i(T)}%;`),Dt(zt,"style",`left: calc(${i(M)/360*100}% - 8px);`)}),As(Vn,()=>i(C),ho=>x(C,ho)),As(bs,()=>i(M),ho=>x(M,ho)),Y(Xe,Be)}),_(xt),ep(xt,Xe=>x(c,Xe),()=>i(c)),Ne(()=>{rr(xt,"w-fit",!i(d)),rr(xt,"w-80",i(d))}),Y(st,xt)}),Y(n,Pt),Ed()}Tp(["click","contextmenu","pointerdown","pointerup","input","mousedown"]);const cB={data:null,loading:!1,error:null},B0=Fm(cB);async function uB(n,e){const s=`${fB()}/auth/user/preference/${n}${e?"?isFree=true":""}`,o=await pB(s,{},8e3);if(!o.ok){const a=new Error(o.status===404?"User not found":`Failed to fetch user preferences: ${o.statusText}`);throw a.status=o.status,a}return await o.json()}async function dB(n,e,t={}){const s=Math.max(1,t.retries??3),o=Math.max(0,t.baseDelayMs??350),r=Math.max(o,t.maxDelayMs??1500),a=t.bootstrapMissing??!0;let l=0,c,f=!1;for(;l<s;)try{return await uB(n,e)}catch(u){c=u,l+=1;const d=u==null?void 0:u.status,h=typeof u=="object"&&u!==null&&"name"in u&&u.name==="AbortError",m=d===404||d===429||typeof d=="number"&&d>=500||d===void 0||h;if(d===404&&a&&!f){f=!0;try{await a8(n,"Light")}catch{}}if(!m||l>=s)break;const g=Math.min(r,o*Math.pow(2,l-1));await new Promise(w=>setTimeout(w,g))}throw c instanceof Error?c:new Error("Failed to fetch user preferences")}function fB(){var e,t;const n=(t=(e=import.meta)==null?void 0:e.env)==null?void 0:t.VITE_USER_PREFS_BASE_URL;return typeof n=="string"&&n.trim()?n.trim():"https://noti.dutyai.app"}async function pB(n,e={},t=8e3){const s=new AbortController,o=setTimeout(()=>s.abort(),t);try{return await fetch(n,{...e,signal:s.signal})}finally{clearTimeout(o)}}function mB(n){return{id:n,clerkId:n,theme:"Light",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isUserExists:!0,isPremium:!1,isTrial:!1}}function t5(n){B0.set({data:n,loading:!1,error:null})}function hB(n){B0.update(e=>({...e,loading:n}))}async function a8(n,e){const t="https://noti.dutyai.app/auth/user/preference";try{const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clerkId:n,theme:e})});if(!s.ok)throw new Error(`Failed to save theme preference: ${s.statusText}`);console.log("✅ Theme preference saved successfully:",{clerkId:n,theme:e})}catch(s){console.error("❌ Failed to save theme preference:",s)}}const n5=Fm(null),xw=Fm(null),vB=X7,Sb={},gB=[{tfsecs:604800,origin:345600,date:"1970-01-05"}];function _B(n){if(n=Math.abs(n),n>=1)return 0;let e=0;for(;n<1;)n=n*10,e+=1;return e}function yg(n){if(Sb[n])return Sb[n];const e=n.length-1,t=n.substring(e),s=n.substring(0,e),o=parseInt(s);let r="minute";if(t=="w")r="week";else if(t=="d")r="day";else if(t=="h")r="hour";else if(t=="m")r="minute";else if(t=="s")r="second";else throw new Error(`unsupport period: ${n}`);const a=mp(n);return Sb[n]={multiplier:o,timespan:r,timeframe:n,secs:a},Sb[n]}yg("1m"),yg("5m"),yg("15m"),yg("30m"),yg("1h"),yg("2h"),yg("4h"),yg("8h"),yg("12h"),yg("1d"),yg("3d"),yg("1w");function Cb(n,e,t){return{id:n,position:vB.Middle,marginLeft:8,marginTop:2,marginRight:0,marginBottom:0,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,icon:e,fontFamily:"icomoon",size:14,color:t,activeColor:t,backgroundColor:"transparent",activeBackgroundColor:"rgba(22, 119, 255, 0.15)"}}function up(n){let e=n==="dark"?"#929AA5":"#76808F",t=n==="dark"?"#555555":"#dddddd";const s=n==="dark"?"#111B2B":"#F3F3F3",o=n==="dark"?"#0A0F1A":"#ffffff",r=n==="dark"?"#b3b3b3":e,a=n==="dark"?"#FFFFFF":"#333333";try{if(typeof window<"u"){const m=document.querySelector(".menu-container")||document.documentElement,g=window.getComputedStyle(m),w=P=>(g.getPropertyValue(P)||"").trim(),C=w("--menu-text"),M=w("--menu-btn-border")||w("--menu-border");C&&(e=C),M&&(t=M)}}catch{}const l=typeof window<"u"&&window.innerWidth<=768,c=typeof window<"u"&&window.innerWidth<=480,f=c?10:l?11:12,u=c?10:l?11:12,d=c?2:l?3:4,h=c?2:l?3:4;return{pane:{backgroundColor:o},candle:{pane:{backgroundColor:o},type:Z7.CandleSolid,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",upBorderColor:"#26A69A",downBorderColor:"#EF5350",noChangeBorderColor:"#888888",upWickColor:"#26A69A",downWickColor:"#EF5350",noChangeWickColor:"#888888"},priceMark:{last:{show:!0},high:{show:!0},low:{show:!0}},tooltip:{showRule:Q6.Always,text:{style:{fontSize:32,fontWeight:"bold",color:"#FFFFFF"}},title:{show:!0,size:18,family:"Helvetica Neue",weight:"normal",color:a,template:"{name} · {period} · {exchange} · {segment}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:e,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:({current:m,prev:g},w)=>{var te,pe;const C=(w==null?void 0:w.bar)||{},M=((pe=(te=w==null?void 0:w.tooltip)==null?void 0:te.legend)==null?void 0:pe.color)??e,P=(m==null?void 0:m.open)??0,T=(m==null?void 0:m.close)??0,L=(C.compareRule||"current_open")==="current_open"?P:(g==null?void 0:g.close)??T,D=P===T||T>=L?C.upBorderColor||M:C.downBorderColor||M,$=J=>({text:J,color:D});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:$("{open}")},{title:"H",value:$("{high}")},{title:"L",value:$("{low}")},{title:"C",value:$("{close}")},{title:"V",value:$("{volume}")}]:[{title:"O",value:$("{open}")},{title:"H",value:$("{high}")},{title:"L",value:$("{low}")},{title:"C",value:$("{close}")},{title:"V",value:$("{volume}")}]}}}},indicator:{lastValueMark:{show:!0},tooltip:{showRule:Q6.Always,icons:[Cb("visible","",e),Cb("invisible","",e),Cb("setting","",e),Cb("close","",e)]}},grid:{show:!0,horizontal:{show:!0,color:s,style:vt.Solid,size:1},vertical:{show:!0,color:s,style:vt.Solid,size:1}},xAxis:{show:!0,axisLine:{show:!0,color:t,size:5},ticduty:{show:!0,color:t},tickText:{show:!0,style:{fontSize:f,color:r,fontFamily:"Arial, sans-serif"},margin:d}},yAxis:{type:"normal",reverse:!1,show:!0,axisLine:{show:!0,color:t,size:4},ticduty:{show:!0,color:t},tickText:{show:!0,style:{fontSize:u,color:r,fontFamily:"Arial, sans-serif"},margin:h}},separator:{size:1,color:n==="dark"?"rgba(85, 85, 85, 0.3)":"rgba(221, 221, 221, 0.3)",fill:!0,activeBackgroundColor:n==="dark"?"rgba(85, 85, 85, 0.1)":"rgba(221, 221, 221, 0.1)"}}}const ap=i4(),x2={AO:[{title:"Short Period",precision:0,min:1,default:5},{title:"Long Period",precision:0,min:1,default:34},{title:"Increasing Color",type:"color",styleKey:"bars[0].upColor",default:"#26A69A"},{title:"Decreasing Color",type:"color",styleKey:"bars[0].downColor",default:"#EF5350"},{title:"Reverse Color",type:"color",styleKey:"bars[0].reverseColor",default:"#c4c4c4"}],BIAS:[{title:Qx(),precision:0,min:1,default:6}],BOLL:[{title:Qx(),precision:0,min:1,default:20},{title:r4(),precision:2,min:1,default:2}],BBI:[{title:ap+"1",precision:0,min:1,default:3},{title:ap+"2",precision:0,min:1,default:6},{title:ap+"3",precision:0,min:1,default:12},{title:ap+"4",precision:0,min:1,default:24}],CCI:[{title:ap+"1",precision:0,min:1,default:20}],CR:[{title:ap+"1",precision:0,min:1,default:26},{title:ap+"2",precision:0,min:1,default:10},{title:ap+"3",precision:0,min:1,default:20},{title:ap+"4",precision:0,min:1,default:40},{title:ap+"5",precision:0,min:1,default:60}],DMI:[{title:"DI Period",precision:0,min:1,default:14},{title:"ADX Period",precision:0,min:1,default:6}],EMV:[{title:ap+"1",precision:0,min:1,default:14},{title:ap+"2",precision:0,min:1,default:9}],EMA:[{title:"Period",precision:0,min:1,default:20},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],ICHIMOKU:[{title:"Tenkan Period",precision:0,min:1,default:9},{title:"Kijun Period",precision:0,min:1,default:26},{title:"Senkou B Period",precision:0,min:1,default:52}],MTM:[{title:ap+"1",precision:0,min:1,default:12},{title:ap+"2",precision:0,min:1,default:6}],MA:[{title:"MA1",precision:0,min:1,styleKey:"lines[0].color",default:5},{title:"MA2",precision:0,min:1,styleKey:"lines[1].color",default:10},{title:"MA3",precision:0,min:1,styleKey:"lines[2].color",default:30}],MACD:[{title:"Fast Period",precision:0,min:1,default:12},{title:"Slow Period",precision:0,min:1,default:26},{title:"Signal Period",precision:0,min:1,default:9}],OBV:[{title:ap+"1",precision:0,min:1,default:30},{title:ap+"2",precision:0,min:1,default:10}],PVT:[],PSY:[{title:ap+"1",precision:0,min:1,default:12},{title:ap+"2",precision:0,min:1,default:6}],ROC:[{title:ap+"1",precision:0,min:1,default:12},{title:ap+"2",precision:0,min:1,default:6}],RSI:[{title:"Period",precision:0,min:1,default:14},{title:"Overbought",precision:0,min:50,max:100,default:70},{title:"Middle",precision:0,min:30,max:70,default:50},{title:"Oversold",precision:0,min:0,max:50,default:30},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#FF6B35"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],SMA:[{title:ap+"1",precision:0,min:1,default:12},{title:ap+"2",precision:0,min:1,default:2}],SMARTTREND:[{title:"Period",precision:0,min:1,default:10},{title:"Multiplier",precision:1,min:.1,max:10,default:3},{title:"Uptrend Color",type:"color",styleKey:"lines[0].color",default:"#10B981"},{title:"Downtrend Color",type:"color",styleKey:"lines[1].color",default:"#EF4444"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],KDJ:[{title:ap+"1",precision:0,min:1,default:9},{title:ap+"2",precision:0,min:1,default:3},{title:ap+"3",precision:0,min:1,default:3}],SAR:[{title:"Start",precision:3,min:.001,max:.1,default:.02},{title:"Increment",precision:3,min:.001,max:.1,default:.02},{title:"Max value",precision:2,min:.1,max:1,default:.2}],TRIX:[{title:ap+"1",precision:0,min:1,default:12},{title:ap+"2",precision:0,min:1,default:9}],VOL:[{title:"MA1",precision:0,min:1,default:5},{title:"MA2",precision:0,min:1,default:10},{title:"MA3",precision:0,min:1,default:20}],VR:[{title:ap+"1",precision:0,min:1,default:26},{title:ap+"2",precision:0,min:1,default:6},{title:ap+"3",precision:0,min:1,default:12}],WR:[{title:"Period",precision:0,min:1,default:14},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],TRAP_HUNTER:[{title:"Resistance Lookback",precision:0,min:1,default:20},{title:"Support Lookback",precision:0,min:1,default:20},{title:"Confirmation Bars",precision:0,min:1,default:4},{title:"Max Trap Bars",precision:0,min:1,default:6},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Spike",precision:2,min:.1,default:1.2},{title:"Min Breakout Factor",precision:4,min:0,default:5e-4},{title:"Min Wick Ratio",precision:2,min:0,max:1,default:.35},{title:"Min Trap Score",precision:2,min:0,max:1,default:.5},{title:"Enable Normal Signal (0/1)",precision:0,min:0,max:1,default:1},{title:"Normal Quiet Bars",precision:0,min:1,default:5}],SMART_MONEY:[{title:"Zone Lookback Bars",precision:0,min:10,default:40},{title:"Min Zone Bars",precision:0,min:3,default:5},{title:"Max Zone Bars",precision:0,min:5,default:25},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Factor",precision:2,min:.1,default:1.2},{title:"Max Zone Width %",precision:3,min:.001,default:.03},{title:"Prior Trend Lookback",precision:0,min:1,default:20},{title:"Min OBV Trend Strength",precision:2,min:0,default:.2},{title:"Min Zone Score",precision:2,min:0,max:1,default:.6},{title:"Merge Nearby Zones (0/1)",precision:0,min:0,max:1,default:1},{title:"Max Zones Displayed",precision:0,min:1,default:20},{title:"Show Labels (0/1)",precision:0,min:0,max:1,default:1}],VOLCANIC:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],VOLCANIC_SIG:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],ZIGZAG:[{title:"Deviation %",precision:1,min:1,max:50,default:5},{title:"Depth",precision:0,min:1,max:50,default:5}]};function yB(n,e){if(n>1e12)throw Error("10 digit timestamp is require for align_tfsecs");let t=0;for(const s of gB){if(e<s.tfsecs)break;if(e%s.tfsecs==0){t=s.origin;break}}return t?Math.floor((n-t)/e)*e+t:Math.floor(n/e)*e}function s5(n,e){if((!n||isNaN(n)||n<=0)&&(console.warn("Invalid timestamp in align_tfmsecs:",n),n=Date.now()),n<1e12&&(console.warn("13 digit timestamp is require for align_tfmsecs, got:",n),n<1e9?n=n*1e3:n=Date.now()),e<1e3)throw Error("milliseconds tf_msecs is require for align_tfmsecs");const t=Math.floor(n/1e3),s=Math.floor(e/1e3);return yB(t,s)*1e3}function bB(n,e,t,s=null){if(n=n.map((a,l)=>{const c=a[0];return(!c||isNaN(c)||c<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs at index ${l}:`,c),a[0]=Date.now()),a}),s&&((!s[0]||isNaN(s[0])||s[0]<=0)&&(console.warn("Invalid timestamp in last_bar:",s[0]),s[0]=Date.now()),s[0]=s5(s[0],t)),e==t)return s&&n.length>0&&n[0][0]>s[0]&&n.splice(0,0,s),n;const o=s?[s]:[];let r=o.length-1;return n.forEach((a,l)=>{if((!a[0]||isNaN(a[0])||a[0]<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs forEach at index ${l}:`,a[0]),a[0]=Date.now()),a[0]=s5(a[0],t),r<0||a[0]>o[r][0])o.push(a),r+=1;else{const c=o[r];c[2]=Math.max(c[2],a[2]),c[3]=Math.min(c[3],a[3]),c[4]=a[4],c[5]+=a[5]}}),o}function qd(n){var o,r,a,l,c,f,u,d;const e=n,t=wn.cloneDeep(e),s=(o=t.candle)==null?void 0:o.type;if(s&&(t._originalChartType=s),t.candle&&t.candle.type==="area"&&!t.candle._isLineChart){t.candle.area||(t.candle.area={});const h=((r=t.candle.bar)==null?void 0:r.upColor)||((a=t.candle.bar)==null?void 0:a.downColor)||((f=(c=(l=t.candle.priceMark)==null?void 0:l.last)==null?void 0:c.text)==null?void 0:f.color)||((d=(u=t.candle.tooltip)==null?void 0:u.text)==null?void 0:d.color)||"#2196F3";t.candle.area={...t.candle.area,backgroundColor:[{offset:0,color:h+"60"},{offset:1,color:h+"10"}]}}if(e.yAxis&&(t.yAxis={...t.yAxis||{},...e.yAxis||{}}),e.xAxis&&(t.xAxis={...t.xAxis||{},...e.xAxis||{}}),e.grid&&(t.grid={...t.grid||{},...e.grid||{}}),e.indicator&&(t.indicator={...t.indicator||{},...e.indicator||{}}),t.candle&&t.candle.type==="heikin_ashi"&&(t.candle.type="candle_solid"),t.candle&&t.candle.type==="renko_atr"&&(t.candle.type="candle_solid"),t.candle&&!t.candle.bar&&(t.candle.bar={}),t.candle&&t.candle.type==="point_and_figure"){t.candle.type="candle_solid";const h="rgba(0,0,0,0)";t.candle.bar={...t.candle.bar,upColor:h,downColor:h,noChangeColor:h,upBorderColor:h,downBorderColor:h,noChangeBorderColor:h,upWickColor:h,downWickColor:h,noChangeWickColor:h},t.candle.priceMark||(t.candle.priceMark={}),t.candle.priceMark.high={show:!1},t.candle.priceMark.low={show:!1}}else if(t.candle&&t.candle.bar){const h=t.candle.bar,m=M=>!M||M==="transparent"||M==="rgba(0,0,0,0)",g="#26A69A",w="#EF5350",C="#888888";m(h.upColor)&&(h.upColor=g),m(h.downColor)&&(h.downColor=w),m(h.noChangeColor)&&(h.noChangeColor=C),m(h.upBorderColor)&&(h.upBorderColor=g),m(h.downBorderColor)&&(h.downBorderColor=w),m(h.noChangeBorderColor)&&(h.noChangeBorderColor=C),m(h.upWickColor)&&(h.upWickColor=g),m(h.downWickColor)&&(h.downWickColor=w),m(h.noChangeWickColor)&&(h.noChangeWickColor=C),t.candle.bar=h}return t}function vx(n,e){var t,s;return(t=e==null?void 0:e.candle)!=null&&t.type?(console.log("✅ Using chart type from $save.styles:",e.candle.type),e.candle.type):n!=null&&n._originalChartType?(console.log("✅ Using original chart type from marker:",n._originalChartType),n._originalChartType):(s=n==null?void 0:n.candle)!=null&&s.type?(console.log("⚠️ Using chart type from chart.getStyles() (might be converted):",n.candle.type),n.candle.type):(console.log("⚠️ No chart type found, defaulting to candle_solid"),"candle_solid")}function Ib(n){if(!n||n.length===0)return n;const e=[];let t=0,s=0;for(let o=0;o<n.length;o++){const r=n[o],a=(r.open+r.high+r.low+r.close)/4;let l;o===0?l=(r.open+r.close)/2:l=(t+s)/2;const c=Math.max(r.high,l,a),f=Math.min(r.low,l,a),u={...r,open:l,high:c,low:f,close:a};e.push(u),t=l,s=a}return e}function Pb(n,e){if(!Array.isArray(n)||n.length===0)return n;const t=(e==null?void 0:e.method)||"ATR",s=Math.max(1,((e==null?void 0:e.atrLength)??14)|0),o=(e==null?void 0:e.source)||"close",r=!!(e!=null&&e.wick),a=le=>{const de=Number(le==null?void 0:le.open),he=Number(le==null?void 0:le.high),ge=Number(le==null?void 0:le.low),ae=Number(le==null?void 0:le.close);return!Number.isFinite(de)||!Number.isFinite(he)||!Number.isFinite(ge)||!Number.isFinite(ae)?null:{...le,open:de,high:he,low:ge,close:ae,volume:Number.isFinite(Number(le==null?void 0:le.volume))?Number(le.volume):le==null?void 0:le.volume}},l=n.map(a).filter(Boolean);if(l.length===0)return[];const c=le=>{switch(o){case"open":return le.open;case"high":return le.high;case"low":return le.low;default:return le.close}},f=[];let u=null,d=1/0,h=-1/0,m=0;for(let le=0;le<l.length;le++){const de=l[le];d=Math.min(d,de.low),h=Math.max(h,de.high),m+=de.close;const he=u==null?Math.max(0,de.high-de.low):Math.max(de.high-de.low,Math.abs(de.high-u),Math.abs(de.low-u));f.push(Math.max(0,he)),u=de.close}const g=new Array(f.length).fill(0);let w=0;for(let le=0;le<f.length;le++)w+=f[le],le===s-1?g[le]=w/s:le>=s?g[le]=(g[le-1]*(s-1)+f[le])/s:g[le]=f[le];const C=m/Math.max(1,l.length),M=Number.isFinite(h-d)?Math.max(0,h-d):0,P=g[Math.min(g.length-1,Math.max(0,s-1))]||f.reduce((le,de)=>le+de,0)/Math.max(1,f.length);let T=t==="ATR"&&g[g.length-1]||P;if(!Number.isFinite(T)||T<=0){const le=M>0?M/Math.max(50,l.length):Math.abs(C)*.001;T=le>0?le:1}const N=M>0?M/5e3:0,L=Number.isFinite(C)&&C!==0?Math.abs(C)*1e-6:0;T=Math.max(1e-12,T,N,L);const O=200,D=2e4,$=le=>{if(!Number.isFinite(le)||le<=0)return 0;let de=0,he=c(l[0]);for(let ge=1;ge<l.length;ge++){const ae=c(l[ge]);if(!Number.isFinite(ae))continue;const Ie=ae-he,ce=Math.floor(Math.abs(Ie)/le);if(ce<=0)continue;const je=Math.min(ce,O);if(de+=je,he+=Math.sign(Ie)*je*le,de>D*4)return de}return de};let z=$(T);for(let le=0;le<3&&z>D;le++){const de=Math.max(1.2,z/D);T*=de,z=$(T)}const te=[];let pe=c(l[0]),J=l[0]&&typeof l[0].timestamp=="number"&&Number.isFinite(l[0].timestamp)?l[0].timestamp:Date.now();for(let le=1;le<l.length;le++){const de=l[le],he=c(de);if(!Number.isFinite(he))continue;const ge=he-pe,ae=ge>0?1:ge<0?-1:0;if(ae===0)continue;let Ie=Math.floor(Math.abs(ge)/T);if(!(Ie<=0)){Ie=Math.min(Ie,O);for(let ce=0;ce<Ie;ce++){const je=pe,Ve=pe+ae*T,We=Math.max(je,Ve),He=Math.min(je,Ve),Ue=ce===Ie-1,et=r&&Ue&&ae>0?Math.max(We,de.high):We,ft=r&&Ue&&ae<0?Math.min(He,de.low):He,it=typeof de.timestamp=="number"&&Number.isFinite(de.timestamp)?de.timestamp:J;J=Math.max(it,J+1),te.push({timestamp:J,open:je,high:et,low:ft,close:Ve,volume:de.volume??0}),pe=Ve}}}if(te.length===0){const le=l[l.length-1],de=le.open,he=le.close,ge=r?le.high:Math.max(de,he),ae=r?le.low:Math.min(de,he);te.push({timestamp:typeof le.timestamp=="number"&&Number.isFinite(le.timestamp)?le.timestamp:J||Date.now(),open:de,high:ge,low:ae,close:he,volume:le.volume??0})}return te}const xB={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};function Mb(n,e){if(!Array.isArray(n)||n.length===0)return n;const t={...xB,...e};let s;if(t.boxSizeMode==="ATR"){const M=Math.max(1,t.atrLength||14),P=[];let T=null;for(let D=0;D<n.length;D++){const $=n[D],z=T==null?Math.max(0,$.high-$.low):Math.max($.high-$.low,Math.abs($.high-T),Math.abs($.low-T));P.push(Math.max(0,z)),T=$.close}const N=new Array(P.length).fill(0);let L=0;for(let D=0;D<P.length;D++)L+=P[D],D===M-1?N[D]=L/M:D>=M?N[D]=(N[D-1]*(M-1)+P[D])/M:N[D]=P[D];const O=N[N.length-1]||P.reduce((D,$)=>D+$,0)/Math.max(1,P.length);s=Math.max(1e-4,O)}else if(t.boxSizeMode==="percent"){const M=n.reduce((P,T)=>P+T.close,0)/n.length;s=Math.max(1e-4,M*t.boxSize/100)}else s=Math.max(1e-4,t.boxSize);const o=s*t.reversalBoxes,r=n[0];let a=r.close>=r.open?"up":"down",l=Math.floor(r.high/s)*s,c=Math.ceil(r.low/s)*s;const f=[];let u=0,d={columnIndex:0,direction:a,boxes:[],highPrice:l,lowPrice:c,startTime:r.timestamp||Date.now(),endTime:r.timestamp||Date.now()};const h=Math.max(1,Math.round((l-c)/s));for(let M=0;M<=h;M++){const P=c+M*s;d.boxes.push({columnIndex:0,direction:a,boxIndex:M,price:P,startTime:d.startTime,endTime:d.endTime})}const m=500;for(let M=1;M<n.length;M++){const P=n[M],T=P.timestamp||Date.now();if(d.endTime=T,a==="up"){const N=Math.floor(P.high/s)*s;if(N>l){let L=Math.round((N-l)/s);L=Math.min(L,m-d.boxes.length);for(let O=1;O<=L;O++){const D=l+O*s;d.boxes.push({columnIndex:u,direction:"up",boxIndex:d.boxes.length,price:D,startTime:T,endTime:T})}l=N,d.highPrice=l}if(l-P.low>=o){const L=Math.ceil(P.low/s)*s;f.push(d),u++,a="down",c=L,d={columnIndex:u,direction:"down",boxes:[],highPrice:l-s,lowPrice:c,startTime:T,endTime:T};let O=Math.round((d.highPrice-c)/s);O=Math.min(O,m);for(let D=0;D<=O;D++){const $=d.highPrice-D*s;d.boxes.push({columnIndex:u,direction:"down",boxIndex:D,price:$,startTime:T,endTime:T})}l=d.highPrice}}else{const N=Math.ceil(P.low/s)*s;if(N<c){let L=Math.round((c-N)/s);L=Math.min(L,m-d.boxes.length);for(let O=1;O<=L;O++){const D=c-O*s;d.boxes.push({columnIndex:u,direction:"down",boxIndex:d.boxes.length,price:D,startTime:T,endTime:T})}c=N,d.lowPrice=c}if(P.high-c>=o){const L=Math.floor(P.high/s)*s;f.push(d),u++,a="up",l=L,d={columnIndex:u,direction:"up",boxes:[],highPrice:l,lowPrice:c+s,startTime:T,endTime:T};let O=Math.round((l-d.lowPrice)/s);O=Math.min(O,m);for(let D=0;D<=O;D++){const $=d.lowPrice+D*s;d.boxes.push({columnIndex:u,direction:"up",boxIndex:D,price:$,startTime:T,endTime:T})}c=d.lowPrice}}}if(d.boxes.length>0&&f.push(d),f.length===0)return n;const g=[],w=Date.now(),C=6e4;for(const M of f){const P=M.startTime||w+M.columnIndex*C;g.push({timestamp:P,open:M.direction==="up"?M.lowPrice:M.highPrice,high:M.highPrice,low:M.lowPrice,close:M.direction==="up"?M.highPrice:M.lowPrice,volume:M.boxes.length,_pnf:{columnIndex:M.columnIndex,direction:M.direction,boxes:M.boxes,boxCount:M.boxes.length,boxSize:s,upColor:t.upColor,downColor:t.downColor}})}return g}function D0(n){return n.exchange&&n.ticker?`${n.exchange.toUpperCase()}:${n.ticker.toUpperCase()}`:(n.ticker||n.name||"UNKNOWN").toUpperCase()}function wB(n,e){var r,a,l,c;const t=[];if(e)try{const f=((r=e.getChartStore)==null?void 0:r.call(e))||e;f&&typeof f.getPanes=="function"?f.getPanes().forEach((d,h)=>{t.push({id:d.id||`pane_${h}`,height:d.height,minHeight:d.minHeight,position:h,visible:d.visible!==!1})}):t.push({id:"candle_pane",height:400,position:0,visible:!0})}catch(f){console.warn("Error collecting pane configurations:",f),t.push({id:"candle_pane",height:400,position:0,visible:!0})}const s=[],o=new Map;if(Object.entries(n.saveInds).forEach(([f,u])=>{var w,C,M,P,T,N,L,O,D,$,z,te;const d={};u.params&&Array.isArray(u.params)&&u.params.forEach((pe,J)=>{d[`param_${J}`]=pe});const h={};u.styles&&Array.isArray(u.styles)?u.styles.forEach((pe,J)=>{h[`style_${J}`]=pe}):u.styles&&typeof u.styles=="object"&&Object.assign(h,u.styles);const m={id:f,type:u.name,params:d,styles:h,paneId:u.pane_id,visible:!0,...Object.fromEntries(Object.entries(u).filter(([pe])=>!["name","pane_id","params","styles"].includes(pe)))};if(m.type==="RSI"){const pe=m;if(!pe.rsiGroups||pe.rsiGroups.length===0){const J=m.paneId||"pane_RSI",le=m0.getInstance(J)||m0.getInstanceConfig(J);if(le){const de=le.overboughtThreshold??((M=(C=(w=le.levels)==null?void 0:w.find)==null?void 0:C.call(w,ae=>ae.id==="overbought"))==null?void 0:M.value)??70,he=((N=(T=(P=le.levels)==null?void 0:P.find)==null?void 0:T.call(P,ae=>ae.id==="middle"))==null?void 0:N.value)??50,ge=le.oversoldThreshold??((D=(O=(L=le.levels)==null?void 0:L.find)==null?void 0:O.call(L,ae=>ae.id==="oversold"))==null?void 0:D.value)??30;pe.rsiGroups=[{period:le.period??14,overboughtLevel:de,middleLevel:he,oversoldLevel:ge,styles:{rsi:{color:le.lineColor??"#8B5CF6",thickness:le.lineThickness??2,lineStyle:le.lineStyle??"solid"},overboughtColor:le.overboughtColor??"#EF4444",oversoldColor:le.oversoldColor??"#10B981",middleLineColor:((te=(z=($=le.levels)==null?void 0:$.find)==null?void 0:z.call($,ae=>ae.id==="middle"))==null?void 0:te.color)??"#6B7280"}}]}}}const g=`${u.name}_${u.pane_id||"candle_pane"}`;o.set(g,m)}),e)try{const f=((a=e.getIndicators)==null?void 0:a.call(e))??[];console.log("📊 Collecting indicators from chart:",f.length,"found"),f.forEach(u=>{if(!u.name)return;const d=u.paneId||"candle_pane",h=`${u.name}_${d}`;if(o.has(h)){console.log(`✅ Indicator ${u.name} (${d}) already in saveInds`);return}console.log(`⚠️ Indicator ${u.name} (${d}) on chart but not in saveInds`);let m=null,g=null;for(const[w,C]of Object.entries(n.saveInds))if(C.name===u.name&&(C.pane_id===d||!C.pane_id&&d==="candle_pane")){m=C,g=w;break}if(m&&g){console.log(`✅ Found matching saveInd for ${u.name} with key: ${g}`);const w={};m.params&&Array.isArray(m.params)&&m.params.forEach((P,T)=>{w[`param_${T}`]=P});const C={};m.styles&&Array.isArray(m.styles)?m.styles.forEach((P,T)=>{C[`style_${T}`]=P}):m.styles&&typeof m.styles=="object"&&Object.assign(C,m.styles);const M={id:g,type:m.name,params:w,styles:C,paneId:m.pane_id||d,visible:!0,...Object.fromEntries(Object.entries(m).filter(([P])=>!["name","pane_id","params","styles"].includes(P)))};o.set(h,M)}else{if(u.name==="RSI"){console.log(`♻️ Skipping fallback SavedIndicator creation for RSI on pane ${d} (no matching saveInd)`);return}console.log(`⚠️ No matching saveInd found for ${u.name}, creating basic entry`);const C={id:`${d}_${u.name}`,type:u.name,params:{},styles:{},paneId:d,visible:!0};o.set(h,C)}})}catch(f){console.warn("⚠️ Failed to get indicators from chart, using saveInds only:",f)}return s.push(...Array.from(o.values())),console.log(`✅ Collected ${s.length} indicators for saving (${Object.keys(n.saveInds).length} from saveInds, ${s.length-Object.keys(n.saveInds).length} from chart)`),{timezone:n.timezone,interval:n.period.timeframe,chartType:((c=(l=n.styles)==null?void 0:l.candle)==null?void 0:c.type)||"candle_solid",theme:n.theme,panes:t,indicators:s,styles:n.styles||{},options:n.options||{}}}async function kB(n,e,t){var s,o,r,a,l,c,f,u,d,h,m,g,w,C,M,P,T,N,L,O,D,$,z,te,pe,J,le,de,he,ge,ae,Ie,ce,je;try{if(console.log("🔄 Applying global state:",n),t){try{t.removeIndicator({}),console.log("🧹 Removed all existing indicators before applying new layout")}catch(it){console.warn("Failed to clear existing indicators before applying layout:",it)}try{const{RSIManager:it}=await Rg(async()=>{const{RSIManager:Lt}=await Promise.resolve().then(()=>mk);return{RSIManager:Lt}},void 0,import.meta.url);it.clearAllInstances()}catch{}}const Ve={},We=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],He=(s=mm(B0))==null?void 0:s.data,Ue=He&&(He.isPremium===!0||He.isTrial===!0),et=[],ft=new Set;if(n.indicators.forEach(it=>{if(it.type==="RSI"){const Lt=it.rsiGroups,Tt=Array.isArray(Lt)&&Lt.length>0&&(Lt[0].actualPaneId||Lt[0].paneId)||it.paneId;if(Tt){if(ft.has(Tt)){console.log("♻️ Skipping duplicate RSI indicator for pane:",Tt);return}ft.add(Tt),it.paneId=Tt,it.id=`${Tt}_RSI`,Array.isArray(Lt)&&Lt.length>0&&(Lt[0].paneId=Tt,Lt[0].actualPaneId=Tt)}}et.push(it)}),et.forEach(it=>{if(!Ue&&it.type&&We.includes(it.type)){console.log(`🔒 Skipping AI indicator ${it.type} - user does not have premium access`);return}const Lt=[];it.params&&typeof it.params=="object"&&Object.entries(it.params).forEach(([St,st])=>{if(St.startsWith("param_")){const xt=parseInt(St.replace("param_",""));Lt[xt]=st}});const Tt=[];it.styles&&typeof it.styles=="object"&&Object.entries(it.styles).forEach(([St,st])=>{if(St.startsWith("style_")&&typeof st=="object"){const xt=parseInt(St.replace("style_",""));Tt[xt]=st}});const Pt={name:it.type,pane_id:it.paneId,params:Lt.length>0?Lt:void 0,styles:Tt.length>0?Tt:void 0,...Object.fromEntries(Object.entries(it).filter(([St])=>!["id","type","paneId","params","styles","visible"].includes(St)))};Ve[it.id]=Pt}),e.update(it=>{it.timezone=n.timezone,it.period={...it.period,timeframe:n.interval};const Lt=n.styles&&typeof n.styles=="object"?{...n.styles}:{},Tt=it.theme||n.theme||"dark";if((n.theme||Tt)!==Tt)try{const St=up(Tt),st=wn.merge({},St,Lt);delete st.backgroundColor,delete st.backgroundOpacity,delete st.backgroundType,delete st.backgroundGradient,delete st.gridColor,delete st.gridOpacity,delete st.gridType,delete st.gridGradient,it.styles=st}catch{it.styles=Lt}else it.styles=Lt;return it.styles.candle||(it.styles.candle={}),it.styles.candle.type=n.chartType,it.options=n.options&&typeof n.options=="object"?{...n.options}:{},it.saveInds=Ve,it}),t)try{const it=mm(e);t.setStyles&&it.styles&&(t.setStyles(it.styles),console.log("🎨 Applied saved styles to chart"))}catch(it){console.warn("Failed to apply saved styles to chart:",it)}if(t&&et.length>0){console.log("Creating indicators on chart:",et.length);for(const it of et)try{const Lt=[];it.params&&typeof it.params=="object"&&Object.entries(it.params).forEach(([xt,Je])=>{if(xt.startsWith("param_")){const Xe=parseInt(xt.replace("param_",""));Lt[Xe]=Je}});const Tt=[];it.styles&&typeof it.styles=="object"&&Object.entries(it.styles).forEach(([xt,Je])=>{if(xt.startsWith("style_")&&typeof Je=="object"){const Xe=parseInt(xt.replace("style_",""));Tt[Xe]=Je}});const Pt={name:it.type,calcParams:Lt.length>0?Lt:void 0,visible:it.visible!==!1};if(Tt.length>0&&(Pt.styles={lines:Tt.map(xt=>{const Je=xt.lineStyle==="dashed"||xt.lineStyle==="dotted",Xe=xt.lineStyle==="dotted"?[2,2]:[4,4];return{color:xt.color,size:xt.thickness??1,style:Je?vt.Dashed:vt.Solid,dashedValue:Je?Xe:[2,2]}})}),it.type==="SMARTTREND"){const xt=it.superTrendGroup,Je=xt?{showLabels:!!xt.showLabels,uptrendColor:((r=(o=xt.styles)==null?void 0:o.uptrend)==null?void 0:r.color)??"#00FF00",downtrendColor:((l=(a=xt.styles)==null?void 0:a.downtrend)==null?void 0:l.color)??"#FF0000",uptrendThickness:((f=(c=xt.styles)==null?void 0:c.uptrend)==null?void 0:f.thickness)??1,downtrendThickness:((d=(u=xt.styles)==null?void 0:u.downtrend)==null?void 0:d.thickness)??1,uptrendLineStyle:((m=(h=xt.styles)==null?void 0:h.uptrend)==null?void 0:m.lineStyle)??"dashed",downtrendLineStyle:((w=(g=xt.styles)==null?void 0:g.downtrend)==null?void 0:w.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"};if(Pt.extendData=Je,!Pt.styles){const Xe=Je.uptrendLineStyle==="dotted"||Je.uptrendLineStyle==="dashed";Pt.styles={lines:[{color:Je.uptrendColor,size:Je.uptrendThickness,style:Xe?vt.Dashed:vt.Solid,dashedValue:Je.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}if(it.type==="RSI"){const xt=it.rsiGroups||[],Je=it.paneId;if(Array.isArray(xt)&&xt.length>0){const Xe=xt[0],Be=((C=Xe.styles)==null?void 0:C.overboughtColor)??"#EF4444",Qe=((M=Xe.styles)==null?void 0:M.oversoldColor)??"#22C55E",ct=((P=Xe.styles)==null?void 0:P.middleLineColor)??"#6B7280",Mt=Xe.fillOpacity??.15,mt=((T=Xe.styles)==null?void 0:T.overboughtThickness)??1,Ce=((N=Xe.styles)==null?void 0:N.oversoldThickness)??1,Te=((L=Xe.styles)==null?void 0:L.middleLineThickness)??1,It=((O=Xe.styles)==null?void 0:O.overboughtLineStyle)??"dashed",$t=((D=Xe.styles)==null?void 0:D.oversoldLineStyle)??"dashed",Yt=(($=Xe.styles)==null?void 0:$.middleLineStyle)??"dashed",qn={id:Je,period:Xe.period??14,lineColor:((te=(z=Xe.styles)==null?void 0:z.rsi)==null?void 0:te.color)??"#8B5CF6",lineThickness:((J=(pe=Xe.styles)==null?void 0:pe.rsi)==null?void 0:J.thickness)??2,lineStyle:((de=(le=Xe.styles)==null?void 0:le.rsi)==null?void 0:de.lineStyle)??"solid",overboughtLevel:Xe.overboughtLevel??70,oversoldLevel:Xe.oversoldLevel??30,middleLevel:Xe.middleLevel??50,overboughtColor:Be,overboughtThickness:mt,overboughtLineStyle:It,oversoldColor:Qe,oversoldThickness:Ce,oversoldLineStyle:$t,overboughtFillColor:Be,oversoldFillColor:Qe,middleLineColor:ct,middleLineThickness:Te,middleLineStyle:Yt,fillOpacity:Mt,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:Xe.overboughtLevel??70,color:Be,lineStyle:It,thickness:mt,label:String(Xe.overboughtLevel??70),visible:!0},{id:"middle",value:Xe.middleLevel??50,color:ct,lineStyle:Yt,thickness:Te,label:String(Xe.middleLevel??50),visible:!0},{id:"oversold",value:Xe.oversoldLevel??30,color:Qe,lineStyle:$t,thickness:Ce,label:String(Xe.oversoldLevel??30),visible:!0}]};try{const{RSIManager:Wn}=await Rg(async()=>{const{RSIManager:pn}=await Promise.resolve().then(()=>mk);return{RSIManager:pn}},void 0,import.meta.url);Wn.importInstanceConfig(qn)}catch{}Pt.calcParams=[Xe.period??14];const Vn={color:((ge=(he=Xe.styles)==null?void 0:he.rsi)==null?void 0:ge.color)??"#8B5CF6",size:((Ie=(ae=Xe.styles)==null?void 0:ae.rsi)==null?void 0:Ie.thickness)??2,style:vt.Solid,dashedValue:[2,2]},Dn=(je=(ce=Xe.styles)==null?void 0:ce.rsi)==null?void 0:je.lineStyle;Dn==="dashed"?(Vn.style=vt.Dashed,Vn.dashedValue=[6,4]):Dn==="dotted"&&(Vn.style=vt.Dashed,Vn.dashedValue=[2,2]),Pt.styles={lines:[Vn]}}}const St=it.paneId==="candle_pane",st=t.createIndicator(Pt,St,{id:it.paneId});console.log(`Created indicator ${it.type} with ID:`,st)}catch(Lt){console.error(`Failed to create indicator ${it.type}:`,Lt)}}console.log("Applied global state:",{timezone:n.timezone,interval:n.interval,chartType:n.chartType,theme:n.theme,indicatorCount:et.length,indicatorsCreated:t?et.length:0})}catch(Ve){throw console.error("Error applying global state:",Ve),Ve}}function o5(n){return D0(n.symbol)}class SB{constructor(e){$e(this,"chart");$e(this,"persistenceKey");$e(this,"currentSymbol",null);$e(this,"ephemeralMode",!0);$e(this,"drawingsBySymbol",new Map);$e(this,"renderedDrawingIds",new Set);$e(this,"onDrawingCreated");$e(this,"onDrawingRemoved");$e(this,"onSymbolChanged");$e(this,"symbolChangeCallbacks",new Set);this.chart=e.chart,this.persistenceKey=e.persistenceKey,this.onDrawingCreated=e.onDrawingCreated,this.onDrawingRemoved=e.onDrawingRemoved,this.onSymbolChanged=e.onSymbolChanged,this.ephemeralMode||this.loadFromStorage(),console.log("✅ DrawingManager initialized with key:",this.persistenceKey)}setCurrentSymbol(e){var o;const t=typeof e=="string"?e:D0(e);if(this.currentSymbol===t){console.log("🔄 Symbol unchanged, skipping reload:",t);return}const s=this.currentSymbol;this.currentSymbol=t,console.log(`🔄 Symbol changed: ${s} → ${t}`),this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol(),s&&((o=this.onSymbolChanged)==null||o.call(this,s,t),this.symbolChangeCallbacks.forEach(r=>r(t)))}getCurrentSymbol(){return this.currentSymbol}addDrawing(e){var o;if(!e.symbolKey)throw console.error("❌ Cannot add drawing without symbolKey:",e),new Error("Drawing must have a symbolKey");let t=this.drawingsBySymbol.get(e.symbolKey);t||(t=[],this.drawingsBySymbol.set(e.symbolKey,t));const s=t.findIndex(r=>r.id===e.id);s>=0?(t[s]=e,console.log("🔄 Updated drawing:",e.id,"for symbol:",e.symbolKey)):(t.push(e),console.log("➕ Added drawing:",e.id,"for symbol:",e.symbolKey)),this.saveToStorage(),e.symbolKey===this.currentSymbol&&e.visible!==!1&&this.renderDrawing(e),(o=this.onDrawingCreated)==null||o.call(this,e)}removeDrawing(e){var o,r;let t=!1,s=null;for(const[a,l]of this.drawingsBySymbol.entries()){const c=l.findIndex(f=>f.id===e);if(c>=0){l.splice(c,1),t=!0,s=a,console.log("🗑️ Removed drawing:",e,"from symbol:",a);break}}return t&&(s&&((o=this.drawingsBySymbol.get(s))==null?void 0:o.length)===0&&this.drawingsBySymbol.delete(s),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),s&&((r=this.onDrawingRemoved)==null||r.call(this,e,s))),t}removeDrawingForSymbol(e,t){var r;const s=this.drawingsBySymbol.get(t);if(!s)return!1;const o=s.findIndex(a=>a.id===e);return o<0?!1:(s.splice(o,1),s.length===0&&this.drawingsBySymbol.delete(t),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),(r=this.onDrawingRemoved)==null||r.call(this,e,t),!0)}getDrawingsForSymbol(e){return this.drawingsBySymbol.get(e)||[]}getCurrentSymbolDrawings(){return this.currentSymbol?this.getDrawingsForSymbol(this.currentSymbol):[]}getAllDrawings(){return new Map(this.drawingsBySymbol)}clearDrawingsForSymbol(e){const t=this.drawingsBySymbol.get(e);t&&(e===this.currentSymbol&&t.forEach(s=>{this.renderedDrawingIds.has(s.id)&&(this.chart.removeOverlay({id:s.id}),this.renderedDrawingIds.delete(s.id))}),this.drawingsBySymbol.delete(e),this.saveToStorage(),console.log("🗑️ Cleared all drawings for symbol:",e))}clearCurrentSymbolDrawings(){this.currentSymbol&&this.clearDrawingsForSymbol(this.currentSymbol)}clearRenderedDrawings(){this.renderedDrawingIds.forEach(e=>{try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Failed to remove overlay:",e,t)}}),this.renderedDrawingIds.clear(),console.log("🧹 Cleared rendered drawings from chart")}hideRenderedDrawings(){this.clearRenderedDrawings()}renderDrawingsForCurrentSymbol(){if(!this.currentSymbol){console.log("⚠️ No current symbol, skipping render");return}const e=this.getDrawingsForSymbol(this.currentSymbol);console.log(`🎨 Rendering ${e.length} drawings for symbol:`,this.currentSymbol),e.forEach(t=>{t.visible!==!1&&this.renderDrawing(t)})}renderCurrentSymbolDrawings(){this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()}renderDrawing(e){if(e.symbolKey!==this.currentSymbol){console.warn("⛔ Drawing symbolKey mismatch, skipping render:",{drawingSymbol:e.symbolKey,currentSymbol:this.currentSymbol});return}try{const t={id:e.id,groupId:"drawing_tools",name:e.type,points:e.points.map(o=>({timestamp:o.time,value:o.price,t:o.time,p:o.price})),styles:e.styles,lock:e.locked,visible:e.visible,onSelected:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalSelectOverlay&&r.externalSelectOverlay(o.overlay)}catch{}return!0},onDeselected:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalDeselectOverlay&&r.externalDeselectOverlay(o.overlay)}catch{}return!0},onPressedMoveEnd:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalSyncOverlay&&r.externalSyncOverlay(o.overlay)}catch{}return!0},onRemoved:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalRemoved&&r.externalRemoved(o.overlay.id)}catch{}return!0},...Object.fromEntries(Object.entries(e).filter(([o])=>!["id","symbolKey","type","points","styles","locked","visible","seriesId"].includes(o)))};this.chart.createOverlay(t)&&(this.renderedDrawingIds.add(e.id),console.log("✅ Rendered drawing:",e.id,"for symbol:",e.symbolKey))}catch(t){console.error("❌ Failed to render drawing:",e.id,t)}}updateDrawing(e,t){for(const[s,o]of this.drawingsBySymbol.entries()){const r=o.findIndex(a=>a.id===e);if(r>=0){const a=o[r];return o[r]={...a,...t,symbolKey:a.symbolKey},this.saveToStorage(),console.log("🔄 Updated drawing:",e),!0}}return!1}loadDrawingsForSymbol(e,t){const s=t.filter(o=>o.symbolKey!==e?(console.warn("⚠️ Drawing symbolKey mismatch during bulk load:",{expected:e,actual:o.symbolKey,drawingId:o.id}),!1):!0);this.drawingsBySymbol.set(e,s),this.saveToStorage(),e===this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log(`📥 Loaded ${s.length} drawings for symbol:`,e)}loadAllDrawings(e){this.drawingsBySymbol.clear(),Object.entries(e).forEach(([t,s])=>{const o=s.filter(r=>(r.symbolKey||(console.warn("⚠️ Drawing missing symbolKey, assigning:",t),r.symbolKey=t),!0));this.drawingsBySymbol.set(t,o)}),this.saveToStorage(),this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log("📥 Loaded drawings for",this.drawingsBySymbol.size,"symbols")}saveToStorage(){if(!this.ephemeralMode)try{const e={drawingsBySymbol:Object.fromEntries(this.drawingsBySymbol),version:1};localStorage.setItem(this.persistenceKey,JSON.stringify(e))}catch(e){console.error("❌ Failed to save drawings to storage:",e)}}clearPersistedStorage(){try{localStorage.removeItem(this.persistenceKey),console.log("🧹 Cleared persisted drawing storage for key:",this.persistenceKey)}catch(e){console.warn("Failed to clear persisted drawing storage:",e)}}loadFromStorage(){if(!this.ephemeralMode)try{const e=localStorage.getItem(this.persistenceKey);if(!e){console.log("📭 No stored drawings found");return}const t=JSON.parse(e);if(!t.version){console.log("🔄 Migrating legacy drawing storage..."),this.migrateLegacyStorage(t);return}Object.entries(t.drawingsBySymbol||{}).forEach(([s,o])=>{const r=o.map(a=>(a.symbolKey||(a.symbolKey=s),a));this.drawingsBySymbol.set(s,r)}),console.log("📂 Loaded drawings from storage:",this.drawingsBySymbol.size,"symbols")}catch(e){console.error("❌ Failed to load drawings from storage:",e),this.drawingsBySymbol.clear()}}migrateLegacyStorage(e){if(console.log("🔄 Starting migration of legacy overlay format..."),typeof e=="object"&&!e.drawingsBySymbol){const t={};Object.entries(e).forEach(([s,o])=>{try{const r=s.split("_");if(r.length<3){console.warn("⚠️ Invalid legacy key format:",s);return}const a=r[r.length-1],l=r[r.length-2],f=r.slice(0,-2).join("_").toUpperCase(),u=this.convertLegacyOverlayToDrawing(a,o,f);u&&(t[f]||(t[f]=[]),t[f].push(u))}catch(r){console.warn("⚠️ Failed to migrate legacy overlay:",s,r)}}),Object.entries(t).forEach(([s,o])=>{this.drawingsBySymbol.set(s,o)}),this.saveToStorage(),console.log("✅ Migration complete:",this.drawingsBySymbol.size,"symbols migrated")}}convertLegacyOverlayToDrawing(e,t,s){try{const o=[];return t.points&&Array.isArray(t.points)&&t.points.forEach(r=>{r&&typeof r=="object"&&(r.timestamp&&r.value!==void 0?o.push({time:r.timestamp,price:r.value}):r.time&&r.price!==void 0?o.push({time:r.time,price:r.price}):r.t&&r.p!==void 0&&o.push({time:r.t,price:r.p}))}),o.length===0?(console.warn("Legacy overlay has no valid data coordinates:",e),null):{id:e,symbolKey:s,type:t.name||"unknown",points:o,styles:t.styles||{},locked:!!t.lock,visible:t.visible!==!1,...Object.fromEntries(Object.entries(t).filter(([r])=>!["name","points","styles","lock","visible"].includes(r)))}}catch(o){return console.warn("Error converting legacy overlay to drawing:",e,o),null}}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}exportDrawings(){return Object.fromEntries(this.drawingsBySymbol)}getStats(){let e=0;return this.drawingsBySymbol.forEach(t=>{e+=t.length}),{totalSymbols:this.drawingsBySymbol.size,totalDrawings:e,currentSymbolDrawings:this.getCurrentSymbolDrawings().length,renderedDrawings:this.renderedDrawingIds.size}}destroy(){this.clearRenderedDrawings(),this.symbolChangeCallbacks.clear(),this.drawingsBySymbol.clear(),console.log("🗑️ DrawingManager destroyed")}}let X1=null;function CB(n){return X1&&(console.warn("⚠️ DrawingManager already initialized, destroying old instance"),X1.destroy()),X1=new SB(n),X1}function Qg(){return X1}class IB{constructor(){$e(this,"state",Fm({undoStack:[],redoStack:[],maxHistorySize:50}));$e(this,"chart",null);$e(this,"saveStore",null);$e(this,"overlaysStore",null)}init({chart:e,saveStore:t,overlaysStore:s}){this.chart=e,this.saveStore=t,this.overlaysStore=s}addAction(e){this.state.update(t=>(t.redoStack=[],t.undoStack.push(e),t.undoStack.length>t.maxHistorySize&&t.undoStack.shift(),t))}recordAddIndicator(e,t,s,o){const r={type:"ADD_INDICATOR",data:{name:e,paneId:t,params:s,saveKey:o},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordRemoveIndicator(e,t,s,o){const r={type:"REMOVE_INDICATOR",data:{name:e,paneId:t,params:s,saveKey:o},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordAddOverlay(e,t,s){const o={type:"ADD_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:s},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(o)}recordRemoveOverlay(e,t,s){const o={type:"REMOVE_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:s},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(o)}recordModifyOverlay(e,t,s,o){const r={type:"MODIFY_OVERLAY",data:{overlayId:e,prevData:t,nextData:s,overlayKey:o},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(r)}undo(){const e=mm(this.state);if(e.undoStack.length===0)return!1;const t=e.undoStack[e.undoStack.length-1],s=this.executeUndo(t);return s&&this.state.update(o=>{const r=o.undoStack.pop();return r&&o.redoStack.push(r),o}),s}redo(){const e=mm(this.state);if(e.redoStack.length===0)return!1;const t=e.redoStack[e.redoStack.length-1],s=this.executeRedo(t);return s&&this.state.update(o=>{const r=o.redoStack.pop();return r&&o.undoStack.push(r),o}),s}executeUndo(e){var t,s,o,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(f=>(delete f.saveInds[e.data.saveKey],f));break;case"REMOVE_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(f=>(f.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},f));break;case"ADD_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(f=>(delete f[e.data.overlayKey],f));try{const f=Qg();f&&f.removeDrawing(e.data.overlayId)}catch{}break;case"REMOVE_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.overlayData,f));try{const f=Qg();if(f){const u=mm(this.saveStore),d=D0(u.symbol),h=e.data.overlayData,m=Array.isArray(h==null?void 0:h.points)?h.points.map(g=>({time:(g==null?void 0:g.timestamp)??(g==null?void 0:g.t)??0,price:(g==null?void 0:g.value)??(g==null?void 0:g.p)??0})):[];if(m.length>0){const g={id:e.data.overlayId,symbolKey:d,type:(h==null?void 0:h.name)||"unknown",points:m,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};f.addDrawing(g)}}}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.prevData)==null?void 0:t.styles,extendData:(s=e.data.prevData)==null?void 0:s.extendData,points:(o=e.data.prevData)==null?void 0:o.points,lock:(r=e.data.prevData)==null?void 0:r.lock,visible:(a=e.data.prevData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.prevData,f));try{const f=Qg();if(f){const u=e.data.prevData,d=Array.isArray(u==null?void 0:u.points)?u.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];f.updateDrawing(e.data.overlayId,{points:d,styles:(u==null?void 0:u.styles)||{},extendData:u==null?void 0:u.extendData,locked:!!(u!=null&&u.lock),visible:(u==null?void 0:u.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing undo:",l),!1}}executeRedo(e){var t,s,o,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(f=>(f.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},f));break;case"REMOVE_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(f=>(delete f.saveInds[e.data.saveKey],f));break;case"ADD_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.overlayData,f));try{const f=Qg();if(f){const u=mm(this.saveStore),d=D0(u.symbol),h=e.data.overlayData,m=Array.isArray(h==null?void 0:h.points)?h.points.map(g=>({time:(g==null?void 0:g.timestamp)??(g==null?void 0:g.t)??0,price:(g==null?void 0:g.value)??(g==null?void 0:g.p)??0})):[];if(m.length>0){const g={id:e.data.overlayId,symbolKey:d,type:(h==null?void 0:h.name)||"unknown",points:m,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};f.addDrawing(g)}}}catch{}break;case"REMOVE_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(f=>(delete f[e.data.overlayKey],f));try{const f=Qg();f&&f.removeDrawing(e.data.overlayId)}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.nextData)==null?void 0:t.styles,extendData:(s=e.data.nextData)==null?void 0:s.extendData,points:(o=e.data.nextData)==null?void 0:o.points,lock:(r=e.data.nextData)==null?void 0:r.lock,visible:(a=e.data.nextData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.nextData,f));try{const f=Qg();if(f){const u=e.data.nextData,d=Array.isArray(u==null?void 0:u.points)?u.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];f.updateDrawing(e.data.overlayId,{points:d,styles:(u==null?void 0:u.styles)||{},extendData:u==null?void 0:u.extendData,locked:!!(u!=null&&u.lock),visible:(u==null?void 0:u.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing redo:",l),!1}}canUndo(){return mm(this.state).undoStack.length>0}canRedo(){return mm(this.state).redoStack.length>0}getState(){return this.state}clearHistory(){this.state.update(e=>({...e,undoStack:[],redoStack:[]}))}}const Np=new IB,PB={"😀":{name:"grinning face",slug:"grinning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😃":{name:"grinning face with big eyes",slug:"grinning_face_with_big_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😄":{name:"grinning face with smiling eyes",slug:"grinning_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😁":{name:"beaming face with smiling eyes",slug:"beaming_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😆":{name:"grinning squinting face",slug:"grinning_squinting_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😅":{name:"grinning face with sweat",slug:"grinning_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤣":{name:"rolling on the floor laughing",slug:"rolling_on_the_floor_laughing",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😂":{name:"face with tears of joy",slug:"face_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙂":{name:"slightly smiling face",slug:"slightly_smiling_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙃":{name:"upside-down face",slug:"upside_down_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫠":{name:"melting face",slug:"melting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😉":{name:"winking face",slug:"winking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😊":{name:"smiling face with smiling eyes",slug:"smiling_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😇":{name:"smiling face with halo",slug:"smiling_face_with_halo",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥰":{name:"smiling face with hearts",slug:"smiling_face_with_hearts",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😍":{name:"smiling face with heart-eyes",slug:"smiling_face_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤩":{name:"star-struck",slug:"star_struck",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😘":{name:"face blowing a kiss",slug:"face_blowing_a_kiss",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😗":{name:"kissing face",slug:"kissing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☺️":{name:"smiling face",slug:"smiling_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😚":{name:"kissing face with closed eyes",slug:"kissing_face_with_closed_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😙":{name:"kissing face with smiling eyes",slug:"kissing_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥲":{name:"smiling face with tear",slug:"smiling_face_with_tear",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😋":{name:"face savoring food",slug:"face_savoring_food",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😛":{name:"face with tongue",slug:"face_with_tongue",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😜":{name:"winking face with tongue",slug:"winking_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤪":{name:"zany face",slug:"zany_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😝":{name:"squinting face with tongue",slug:"squinting_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤑":{name:"money-mouth face",slug:"money_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤗":{name:"smiling face with open hands",slug:"smiling_face_with_open_hands",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤭":{name:"face with hand over mouth",slug:"face_with_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫢":{name:"face with open eyes and hand over mouth",slug:"face_with_open_eyes_and_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🫣":{name:"face with peeking eye",slug:"face_with_peeking_eye",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤫":{name:"shushing face",slug:"shushing_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤔":{name:"thinking face",slug:"thinking_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫡":{name:"saluting face",slug:"saluting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤐":{name:"zipper-mouth face",slug:"zipper_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤨":{name:"face with raised eyebrow",slug:"face_with_raised_eyebrow",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😐":{name:"neutral face",slug:"neutral_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😑":{name:"expressionless face",slug:"expressionless_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😶":{name:"face without mouth",slug:"face_without_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫥":{name:"dotted line face",slug:"dotted_line_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😶‍🌫️":{name:"face in clouds",slug:"face_in_clouds",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"😏":{name:"smirking face",slug:"smirking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😒":{name:"unamused face",slug:"unamused_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙄":{name:"face with rolling eyes",slug:"face_with_rolling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😬":{name:"grimacing face",slug:"grimacing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😮‍💨":{name:"face exhaling",slug:"face_exhaling",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤥":{name:"lying face",slug:"lying_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫨":{name:"shaking face",slug:"shaking_face",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🙂‍↔️":{name:"head shaking horizontally",slug:"head_shaking_horizontally",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🙂‍↕️":{name:"head shaking vertically",slug:"head_shaking_vertically",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"😌":{name:"relieved face",slug:"relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😔":{name:"pensive face",slug:"pensive_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😪":{name:"sleepy face",slug:"sleepy_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤤":{name:"drooling face",slug:"drooling_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😴":{name:"sleeping face",slug:"sleeping_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫩":{name:"face with bags under eyes",slug:"face_with_bags_under_eyes",group:"Smileys & Emotion",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"😷":{name:"face with medical mask",slug:"face_with_medical_mask",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤒":{name:"face with thermometer",slug:"face_with_thermometer",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤕":{name:"face with head-bandage",slug:"face_with_head_bandage",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤢":{name:"nauseated face",slug:"nauseated_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤮":{name:"face vomiting",slug:"face_vomiting",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤧":{name:"sneezing face",slug:"sneezing_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥵":{name:"hot face",slug:"hot_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥶":{name:"cold face",slug:"cold_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥴":{name:"woozy face",slug:"woozy_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😵":{name:"face with crossed-out eyes",slug:"face_with_crossed_out_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😵‍💫":{name:"face with spiral eyes",slug:"face_with_spiral_eyes",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤯":{name:"exploding head",slug:"exploding_head",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤠":{name:"cowboy hat face",slug:"cowboy_hat_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥳":{name:"partying face",slug:"partying_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥸":{name:"disguised face",slug:"disguised_face",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😎":{name:"smiling face with sunglasses",slug:"smiling_face_with_sunglasses",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤓":{name:"nerd face",slug:"nerd_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧐":{name:"face with monocle",slug:"face_with_monocle",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😕":{name:"confused face",slug:"confused_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫤":{name:"face with diagonal mouth",slug:"face_with_diagonal_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😟":{name:"worried face",slug:"worried_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙁":{name:"slightly frowning face",slug:"slightly_frowning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☹️":{name:"frowning face",slug:"frowning_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😮":{name:"face with open mouth",slug:"face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😯":{name:"hushed face",slug:"hushed_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😲":{name:"astonished face",slug:"astonished_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😳":{name:"flushed face",slug:"flushed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥺":{name:"pleading face",slug:"pleading_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥹":{name:"face holding back tears",slug:"face_holding_back_tears",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😦":{name:"frowning face with open mouth",slug:"frowning_face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😧":{name:"anguished face",slug:"anguished_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😨":{name:"fearful face",slug:"fearful_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😰":{name:"anxious face with sweat",slug:"anxious_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😥":{name:"sad but relieved face",slug:"sad_but_relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😢":{name:"crying face",slug:"crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😭":{name:"loudly crying face",slug:"loudly_crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😱":{name:"face screaming in fear",slug:"face_screaming_in_fear",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😖":{name:"confounded face",slug:"confounded_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😣":{name:"persevering face",slug:"persevering_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😞":{name:"disappointed face",slug:"disappointed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😓":{name:"downcast face with sweat",slug:"downcast_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😩":{name:"weary face",slug:"weary_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😫":{name:"tired face",slug:"tired_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥱":{name:"yawning face",slug:"yawning_face",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"😤":{name:"face with steam from nose",slug:"face_with_steam_from_nose",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😡":{name:"enraged face",slug:"enraged_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😠":{name:"angry face",slug:"angry_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤬":{name:"face with symbols on mouth",slug:"face_with_symbols_on_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😈":{name:"smiling face with horns",slug:"smiling_face_with_horns",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"👿":{name:"angry face with horns",slug:"angry_face_with_horns",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💀":{name:"skull",slug:"skull",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☠️":{name:"skull and crossbones",slug:"skull_and_crossbones",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💩":{name:"pile of poo",slug:"pile_of_poo",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤡":{name:"clown face",slug:"clown_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"👹":{name:"ogre",slug:"ogre",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👺":{name:"goblin",slug:"goblin",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👻":{name:"ghost",slug:"ghost",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👽":{name:"alien",slug:"alien",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👾":{name:"alien monster",slug:"alien_monster",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤖":{name:"robot",slug:"robot",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😺":{name:"grinning cat",slug:"grinning_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😸":{name:"grinning cat with smiling eyes",slug:"grinning_cat_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😹":{name:"cat with tears of joy",slug:"cat_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😻":{name:"smiling cat with heart-eyes",slug:"smiling_cat_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😼":{name:"cat with wry smile",slug:"cat_with_wry_smile",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😽":{name:"kissing cat",slug:"kissing_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙀":{name:"weary cat",slug:"weary_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😿":{name:"crying cat",slug:"crying_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😾":{name:"pouting cat",slug:"pouting_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙈":{name:"see-no-evil monkey",slug:"see_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙉":{name:"hear-no-evil monkey",slug:"hear_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙊":{name:"speak-no-evil monkey",slug:"speak_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💌":{name:"love letter",slug:"love_letter",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💘":{name:"heart with arrow",slug:"heart_with_arrow",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💝":{name:"heart with ribbon",slug:"heart_with_ribbon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💖":{name:"sparkling heart",slug:"sparkling_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💗":{name:"growing heart",slug:"growing_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💓":{name:"beating heart",slug:"beating_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💞":{name:"revolving hearts",slug:"revolving_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💕":{name:"two hearts",slug:"two_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💟":{name:"heart decoration",slug:"heart_decoration",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❣️":{name:"heart exclamation",slug:"heart_exclamation",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💔":{name:"broken heart",slug:"broken_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❤️‍🔥":{name:"heart on fire",slug:"heart_on_fire",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️‍🩹":{name:"mending heart",slug:"mending_heart",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️":{name:"red heart",slug:"red_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩷":{name:"pink heart",slug:"pink_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🧡":{name:"orange heart",slug:"orange_heart",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"💛":{name:"yellow heart",slug:"yellow_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💚":{name:"green heart",slug:"green_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💙":{name:"blue heart",slug:"blue_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩵":{name:"light blue heart",slug:"light_blue_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"💜":{name:"purple heart",slug:"purple_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤎":{name:"brown heart",slug:"brown_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🖤":{name:"black heart",slug:"black_heart",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🩶":{name:"grey heart",slug:"grey_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🤍":{name:"white heart",slug:"white_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💋":{name:"kiss mark",slug:"kiss_mark",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💯":{name:"hundred points",slug:"hundred_points",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💢":{name:"anger symbol",slug:"anger_symbol",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💥":{name:"collision",slug:"collision",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💫":{name:"dizzy",slug:"dizzy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💦":{name:"sweat droplets",slug:"sweat_droplets",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💨":{name:"dashing away",slug:"dashing_away",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕳️":{name:"hole",slug:"hole",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💬":{name:"speech balloon",slug:"speech_balloon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️‍🗨️":{name:"eye in speech bubble",slug:"eye_in_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗨️":{name:"left speech bubble",slug:"left_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗯️":{name:"right anger bubble",slug:"right_anger_bubble",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💭":{name:"thought balloon",slug:"thought_balloon",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💤":{name:"ZZZ",slug:"zzz",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👋":{name:"waving hand",slug:"waving_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤚":{name:"raised back of hand",slug:"raised_back_of_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🖐️":{name:"hand with fingers splayed",slug:"hand_with_fingers_splayed",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✋":{name:"raised hand",slug:"raised_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖖":{name:"vulcan salute",slug:"vulcan_salute",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫱":{name:"rightwards hand",slug:"rightwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫲":{name:"leftwards hand",slug:"leftwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫳":{name:"palm down hand",slug:"palm_down_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫴":{name:"palm up hand",slug:"palm_up_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫷":{name:"leftwards pushing hand",slug:"leftwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"🫸":{name:"rightwards pushing hand",slug:"rightwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"👌":{name:"OK hand",slug:"ok_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤌":{name:"pinched fingers",slug:"pinched_fingers",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤏":{name:"pinching hand",slug:"pinching_hand",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"✌️":{name:"victory hand",slug:"victory_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤞":{name:"crossed fingers",slug:"crossed_fingers",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫰":{name:"hand with index finger and thumb crossed",slug:"hand_with_index_finger_and_thumb_crossed",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤟":{name:"love-you gesture",slug:"love_you_gesture",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤘":{name:"sign of the horns",slug:"sign_of_the_horns",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤙":{name:"call me hand",slug:"call_me_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👈":{name:"backhand index pointing left",slug:"backhand_index_pointing_left",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👉":{name:"backhand index pointing right",slug:"backhand_index_pointing_right",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👆":{name:"backhand index pointing up",slug:"backhand_index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖕":{name:"middle finger",slug:"middle_finger",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👇":{name:"backhand index pointing down",slug:"backhand_index_pointing_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"☝️":{name:"index pointing up",slug:"index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫵":{name:"index pointing at the viewer",slug:"index_pointing_at_the_viewer",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👍":{name:"thumbs up",slug:"thumbs_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👎":{name:"thumbs down",slug:"thumbs_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✊":{name:"raised fist",slug:"raised_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👊":{name:"oncoming fist",slug:"oncoming_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤛":{name:"left-facing fist",slug:"left_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤜":{name:"right-facing fist",slug:"right_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👏":{name:"clapping hands",slug:"clapping_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙌":{name:"raising hands",slug:"raising_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫶":{name:"heart hands",slug:"heart_hands",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👐":{name:"open hands",slug:"open_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤲":{name:"palms up together",slug:"palms_up_together",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤝":{name:"handshake",slug:"handshake",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🙏":{name:"folded hands",slug:"folded_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✍️":{name:"writing hand",slug:"writing_hand",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💅":{name:"nail polish",slug:"nail_polish",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤳":{name:"selfie",slug:"selfie",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"💪":{name:"flexed biceps",slug:"flexed_biceps",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦾":{name:"mechanical arm",slug:"mechanical_arm",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦿":{name:"mechanical leg",slug:"mechanical_leg",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦵":{name:"leg",slug:"leg",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦶":{name:"foot",slug:"foot",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👂":{name:"ear",slug:"ear",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦻":{name:"ear with hearing aid",slug:"ear_with_hearing_aid",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👃":{name:"nose",slug:"nose",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧠":{name:"brain",slug:"brain",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫀":{name:"anatomical heart",slug:"anatomical_heart",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🫁":{name:"lungs",slug:"lungs",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦷":{name:"tooth",slug:"tooth",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦴":{name:"bone",slug:"bone",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👀":{name:"eyes",slug:"eyes",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️":{name:"eye",slug:"eye",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👅":{name:"tongue",slug:"tongue",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👄":{name:"mouth",slug:"mouth",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫦":{name:"biting lip",slug:"biting_lip",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"👶":{name:"baby",slug:"baby",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧒":{name:"child",slug:"child",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👦":{name:"boy",slug:"boy",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👧":{name:"girl",slug:"girl",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧑":{name:"person",slug:"person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👱":{name:"person blond hair",slug:"person_blond_hair",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👨":{name:"man",slug:"man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧔":{name:"person beard",slug:"person_beard",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧔‍♂️":{name:"man beard",slug:"man_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"🧔‍♀️":{name:"woman beard",slug:"woman_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍🦰":{name:"man red hair",slug:"man_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦱":{name:"man curly hair",slug:"man_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦳":{name:"man white hair",slug:"man_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦲":{name:"man bald",slug:"man_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👩":{name:"woman",slug:"woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👩‍🦰":{name:"woman red hair",slug:"woman_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦰":{name:"person red hair",slug:"person_red_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦱":{name:"woman curly hair",slug:"woman_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦱":{name:"person curly hair",slug:"person_curly_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦳":{name:"woman white hair",slug:"woman_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦳":{name:"person white hair",slug:"person_white_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦲":{name:"woman bald",slug:"woman_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦲":{name:"person bald",slug:"person_bald",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👱‍♀️":{name:"woman blond hair",slug:"woman_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👱‍♂️":{name:"man blond hair",slug:"man_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧓":{name:"older person",slug:"older_person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👴":{name:"old man",slug:"old_man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👵":{name:"old woman",slug:"old_woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍":{name:"person frowning",slug:"person_frowning",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍‍♂️":{name:"man frowning",slug:"man_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙍‍♀️":{name:"woman frowning",slug:"woman_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎":{name:"person pouting",slug:"person_pouting",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙎‍♂️":{name:"man pouting",slug:"man_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎‍♀️":{name:"woman pouting",slug:"woman_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅":{name:"person gesturing NO",slug:"person_gesturing_no",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙅‍♂️":{name:"man gesturing NO",slug:"man_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅‍♀️":{name:"woman gesturing NO",slug:"woman_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆":{name:"person gesturing OK",slug:"person_gesturing_ok",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙆‍♂️":{name:"man gesturing OK",slug:"man_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆‍♀️":{name:"woman gesturing OK",slug:"woman_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁":{name:"person tipping hand",slug:"person_tipping_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💁‍♂️":{name:"man tipping hand",slug:"man_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁‍♀️":{name:"woman tipping hand",slug:"woman_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋":{name:"person raising hand",slug:"person_raising_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙋‍♂️":{name:"man raising hand",slug:"man_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋‍♀️":{name:"woman raising hand",slug:"woman_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧏":{name:"deaf person",slug:"deaf_person",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♂️":{name:"deaf man",slug:"deaf_man",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♀️":{name:"deaf woman",slug:"deaf_woman",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🙇":{name:"person bowing",slug:"person_bowing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙇‍♂️":{name:"man bowing",slug:"man_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙇‍♀️":{name:"woman bowing",slug:"woman_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦":{name:"person facepalming",slug:"person_facepalming",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤦‍♂️":{name:"man facepalming",slug:"man_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦‍♀️":{name:"woman facepalming",slug:"woman_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷":{name:"person shrugging",slug:"person_shrugging",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤷‍♂️":{name:"man shrugging",slug:"man_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷‍♀️":{name:"woman shrugging",slug:"woman_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚕️":{name:"health worker",slug:"health_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚕️":{name:"man health worker",slug:"man_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚕️":{name:"woman health worker",slug:"woman_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎓":{name:"student",slug:"student",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎓":{name:"man student",slug:"man_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎓":{name:"woman student",slug:"woman_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏫":{name:"teacher",slug:"teacher",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏫":{name:"man teacher",slug:"man_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏫":{name:"woman teacher",slug:"woman_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚖️":{name:"judge",slug:"judge",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚖️":{name:"man judge",slug:"man_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚖️":{name:"woman judge",slug:"woman_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🌾":{name:"farmer",slug:"farmer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🌾":{name:"man farmer",slug:"man_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🌾":{name:"woman farmer",slug:"woman_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🍳":{name:"cook",slug:"cook",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🍳":{name:"man cook",slug:"man_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🍳":{name:"woman cook",slug:"woman_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔧":{name:"mechanic",slug:"mechanic",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔧":{name:"man mechanic",slug:"man_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔧":{name:"woman mechanic",slug:"woman_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏭":{name:"factory worker",slug:"factory_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏭":{name:"man factory worker",slug:"man_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏭":{name:"woman factory worker",slug:"woman_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💼":{name:"office worker",slug:"office_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💼":{name:"man office worker",slug:"man_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💼":{name:"woman office worker",slug:"woman_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔬":{name:"scientist",slug:"scientist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔬":{name:"man scientist",slug:"man_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔬":{name:"woman scientist",slug:"woman_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💻":{name:"technologist",slug:"technologist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💻":{name:"man technologist",slug:"man_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💻":{name:"woman technologist",slug:"woman_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎤":{name:"singer",slug:"singer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎤":{name:"man singer",slug:"man_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎤":{name:"woman singer",slug:"woman_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎨":{name:"artist",slug:"artist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎨":{name:"man artist",slug:"man_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎨":{name:"woman artist",slug:"woman_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍✈️":{name:"pilot",slug:"pilot",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍✈️":{name:"man pilot",slug:"man_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍✈️":{name:"woman pilot",slug:"woman_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚀":{name:"astronaut",slug:"astronaut",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚀":{name:"man astronaut",slug:"man_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚀":{name:"woman astronaut",slug:"woman_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚒":{name:"firefighter",slug:"firefighter",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚒":{name:"man firefighter",slug:"man_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚒":{name:"woman firefighter",slug:"woman_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮":{name:"police officer",slug:"police_officer",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👮‍♂️":{name:"man police officer",slug:"man_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮‍♀️":{name:"woman police officer",slug:"woman_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️":{name:"detective",slug:"detective",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🕵️‍♂️":{name:"man detective",slug:"man_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️‍♀️":{name:"woman detective",slug:"woman_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂":{name:"guard",slug:"guard",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💂‍♂️":{name:"man guard",slug:"man_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂‍♀️":{name:"woman guard",slug:"woman_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🥷":{name:"ninja",slug:"ninja",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👷":{name:"construction worker",slug:"construction_worker",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👷‍♂️":{name:"man construction worker",slug:"man_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👷‍♀️":{name:"woman construction worker",slug:"woman_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🫅":{name:"person with crown",slug:"person_with_crown",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤴":{name:"prince",slug:"prince",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👸":{name:"princess",slug:"princess",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳":{name:"person wearing turban",slug:"person_wearing_turban",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳‍♂️":{name:"man wearing turban",slug:"man_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👳‍♀️":{name:"woman wearing turban",slug:"woman_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👲":{name:"person with skullcap",slug:"person_with_skullcap",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧕":{name:"woman with headscarf",slug:"woman_with_headscarf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤵":{name:"person in tuxedo",slug:"person_in_tuxedo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤵‍♂️":{name:"man in tuxedo",slug:"man_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤵‍♀️":{name:"woman in tuxedo",slug:"woman_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰":{name:"person with veil",slug:"person_with_veil",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👰‍♂️":{name:"man with veil",slug:"man_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰‍♀️":{name:"woman with veil",slug:"woman_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤰":{name:"pregnant woman",slug:"pregnant_woman",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫃":{name:"pregnant man",slug:"pregnant_man",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫄":{name:"pregnant person",slug:"pregnant_person",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤱":{name:"breast-feeding",slug:"breast_feeding",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👩‍🍼":{name:"woman feeding baby",slug:"woman_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👨‍🍼":{name:"man feeding baby",slug:"man_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🧑‍🍼":{name:"person feeding baby",slug:"person_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👼":{name:"baby angel",slug:"baby_angel",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🎅":{name:"Santa Claus",slug:"santa_claus",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤶":{name:"Mrs. Claus",slug:"mrs_claus",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🧑‍🎄":{name:"Mx Claus",slug:"mx_claus",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🦸":{name:"superhero",slug:"superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♂️":{name:"man superhero",slug:"man_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♀️":{name:"woman superhero",slug:"woman_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹":{name:"supervillain",slug:"supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♂️":{name:"man supervillain",slug:"man_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♀️":{name:"woman supervillain",slug:"woman_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧙":{name:"mage",slug:"mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♂️":{name:"man mage",slug:"man_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♀️":{name:"woman mage",slug:"woman_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚":{name:"fairy",slug:"fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♂️":{name:"man fairy",slug:"man_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♀️":{name:"woman fairy",slug:"woman_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛":{name:"vampire",slug:"vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♂️":{name:"man vampire",slug:"man_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♀️":{name:"woman vampire",slug:"woman_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜":{name:"merperson",slug:"merperson",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♂️":{name:"merman",slug:"merman",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♀️":{name:"mermaid",slug:"mermaid",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝":{name:"elf",slug:"elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♂️":{name:"man elf",slug:"man_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♀️":{name:"woman elf",slug:"woman_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧞":{name:"genie",slug:"genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♂️":{name:"man genie",slug:"man_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♀️":{name:"woman genie",slug:"woman_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟":{name:"zombie",slug:"zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♂️":{name:"man zombie",slug:"man_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♀️":{name:"woman zombie",slug:"woman_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧌":{name:"troll",slug:"troll",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"💆":{name:"person getting massage",slug:"person_getting_massage",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💆‍♂️":{name:"man getting massage",slug:"man_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💆‍♀️":{name:"woman getting massage",slug:"woman_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇":{name:"person getting haircut",slug:"person_getting_haircut",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💇‍♂️":{name:"man getting haircut",slug:"man_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇‍♀️":{name:"woman getting haircut",slug:"woman_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶":{name:"person walking",slug:"person_walking",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚶‍♂️":{name:"man walking",slug:"man_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍♀️":{name:"woman walking",slug:"woman_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍➡️":{name:"person walking facing right",slug:"person_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♀️‍➡️":{name:"woman walking facing right",slug:"woman_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♂️‍➡️":{name:"man walking facing right",slug:"man_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧍":{name:"person standing",slug:"person_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♂️":{name:"man standing",slug:"man_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♀️":{name:"woman standing",slug:"woman_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎":{name:"person kneeling",slug:"person_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♂️":{name:"man kneeling",slug:"man_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♀️":{name:"woman kneeling",slug:"woman_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍➡️":{name:"person kneeling facing right",slug:"person_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♀️‍➡️":{name:"woman kneeling facing right",slug:"woman_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♂️‍➡️":{name:"man kneeling facing right",slug:"man_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦯":{name:"person with white cane",slug:"person_with_white_cane",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦯‍➡️":{name:"person with white cane facing right",slug:"person_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦯":{name:"man with white cane",slug:"man_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦯‍➡️":{name:"man with white cane facing right",slug:"man_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦯":{name:"woman with white cane",slug:"woman_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦯‍➡️":{name:"woman with white cane facing right",slug:"woman_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦼":{name:"person in motorized wheelchair",slug:"person_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦼‍➡️":{name:"person in motorized wheelchair facing right",slug:"person_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦼":{name:"man in motorized wheelchair",slug:"man_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦼‍➡️":{name:"man in motorized wheelchair facing right",slug:"man_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦼":{name:"woman in motorized wheelchair",slug:"woman_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦼‍➡️":{name:"woman in motorized wheelchair facing right",slug:"woman_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦽":{name:"person in manual wheelchair",slug:"person_in_manual_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦽‍➡️":{name:"person in manual wheelchair facing right",slug:"person_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦽":{name:"man in manual wheelchair",slug:"man_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦽‍➡️":{name:"man in manual wheelchair facing right",slug:"man_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦽":{name:"woman in manual wheelchair",slug:"woman_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦽‍➡️":{name:"woman in manual wheelchair facing right",slug:"woman_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃":{name:"person running",slug:"person_running",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏃‍♂️":{name:"man running",slug:"man_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍♀️":{name:"woman running",slug:"woman_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍➡️":{name:"person running facing right",slug:"person_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♀️‍➡️":{name:"woman running facing right",slug:"woman_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♂️‍➡️":{name:"man running facing right",slug:"man_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"💃":{name:"woman dancing",slug:"woman_dancing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🕺":{name:"man dancing",slug:"man_dancing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🕴️":{name:"person in suit levitating",slug:"person_in_suit_levitating",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👯":{name:"people with bunny ears",slug:"people_with_bunny_ears",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👯‍♂️":{name:"men with bunny ears",slug:"men_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👯‍♀️":{name:"women with bunny ears",slug:"women_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🧖":{name:"person in steamy room",slug:"person_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♂️":{name:"man in steamy room",slug:"man_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♀️":{name:"woman in steamy room",slug:"woman_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗":{name:"person climbing",slug:"person_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♂️":{name:"man climbing",slug:"man_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♀️":{name:"woman climbing",slug:"woman_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤺":{name:"person fencing",slug:"person_fencing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🏇":{name:"horse racing",slug:"horse_racing",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"⛷️":{name:"skier",slug:"skier",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏂":{name:"snowboarder",slug:"snowboarder",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏌️":{name:"person golfing",slug:"person_golfing",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♂️":{name:"man golfing",slug:"man_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♀️":{name:"woman golfing",slug:"woman_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄":{name:"person surfing",slug:"person_surfing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏄‍♂️":{name:"man surfing",slug:"man_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄‍♀️":{name:"woman surfing",slug:"woman_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣":{name:"person rowing boat",slug:"person_rowing_boat",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚣‍♂️":{name:"man rowing boat",slug:"man_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣‍♀️":{name:"woman rowing boat",slug:"woman_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊":{name:"person swimming",slug:"person_swimming",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏊‍♂️":{name:"man swimming",slug:"man_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊‍♀️":{name:"woman swimming",slug:"woman_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️":{name:"person bouncing ball",slug:"person_bouncing_ball",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"⛹️‍♂️":{name:"man bouncing ball",slug:"man_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️‍♀️":{name:"woman bouncing ball",slug:"woman_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️":{name:"person lifting weights",slug:"person_lifting_weights",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🏋️‍♂️":{name:"man lifting weights",slug:"man_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️‍♀️":{name:"woman lifting weights",slug:"woman_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴":{name:"person biking",slug:"person_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚴‍♂️":{name:"man biking",slug:"man_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴‍♀️":{name:"woman biking",slug:"woman_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵":{name:"person mountain biking",slug:"person_mountain_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚵‍♂️":{name:"man mountain biking",slug:"man_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵‍♀️":{name:"woman mountain biking",slug:"woman_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸":{name:"person cartwheeling",slug:"person_cartwheeling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤸‍♂️":{name:"man cartwheeling",slug:"man_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸‍♀️":{name:"woman cartwheeling",slug:"woman_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤼":{name:"people wrestling",slug:"people_wrestling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤼‍♂️":{name:"men wrestling",slug:"men_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤼‍♀️":{name:"women wrestling",slug:"women_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤽":{name:"person playing water polo",slug:"person_playing_water_polo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤽‍♂️":{name:"man playing water polo",slug:"man_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤽‍♀️":{name:"woman playing water polo",slug:"woman_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾":{name:"person playing handball",slug:"person_playing_handball",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤾‍♂️":{name:"man playing handball",slug:"man_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾‍♀️":{name:"woman playing handball",slug:"woman_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹":{name:"person juggling",slug:"person_juggling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤹‍♂️":{name:"man juggling",slug:"man_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹‍♀️":{name:"woman juggling",slug:"woman_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧘":{name:"person in lotus position",slug:"person_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♂️":{name:"man in lotus position",slug:"man_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♀️":{name:"woman in lotus position",slug:"woman_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🛀":{name:"person taking bath",slug:"person_taking_bath",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🛌":{name:"person in bed",slug:"person_in_bed",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🤝‍🧑":{name:"people holding hands",slug:"people_holding_hands",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👭":{name:"women holding hands",slug:"women_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👫":{name:"woman and man holding hands",slug:"woman_and_man_holding_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👬":{name:"men holding hands",slug:"men_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"💏":{name:"kiss",slug:"kiss",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👨":{name:"kiss woman, man",slug:"kiss_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍💋‍👨":{name:"kiss man, man",slug:"kiss_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👩":{name:"kiss woman, woman",slug:"kiss_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"💑":{name:"couple with heart",slug:"couple_with_heart",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👨":{name:"couple with heart woman, man",slug:"couple_with_heart_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍👨":{name:"couple with heart man, man",slug:"couple_with_heart_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👩":{name:"couple with heart woman, woman",slug:"couple_with_heart_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍👩‍👦":{name:"family man, woman, boy",slug:"family_man_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧":{name:"family man, woman, girl",slug:"family_man_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👦":{name:"family man, woman, girl, boy",slug:"family_man_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👦‍👦":{name:"family man, woman, boy, boy",slug:"family_man_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👧":{name:"family man, woman, girl, girl",slug:"family_man_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦":{name:"family man, man, boy",slug:"family_man_man_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧":{name:"family man, man, girl",slug:"family_man_man_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👦":{name:"family man, man, girl, boy",slug:"family_man_man_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦‍👦":{name:"family man, man, boy, boy",slug:"family_man_man_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👧":{name:"family man, man, girl, girl",slug:"family_man_man_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦":{name:"family woman, woman, boy",slug:"family_woman_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧":{name:"family woman, woman, girl",slug:"family_woman_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👦":{name:"family woman, woman, girl, boy",slug:"family_woman_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦‍👦":{name:"family woman, woman, boy, boy",slug:"family_woman_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👧":{name:"family woman, woman, girl, girl",slug:"family_woman_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👦":{name:"family man, boy",slug:"family_man_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👦‍👦":{name:"family man, boy, boy",slug:"family_man_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧":{name:"family man, girl",slug:"family_man_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👦":{name:"family man, girl, boy",slug:"family_man_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👧":{name:"family man, girl, girl",slug:"family_man_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦":{name:"family woman, boy",slug:"family_woman_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦‍👦":{name:"family woman, boy, boy",slug:"family_woman_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧":{name:"family woman, girl",slug:"family_woman_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👦":{name:"family woman, girl, boy",slug:"family_woman_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👧":{name:"family woman, girl, girl",slug:"family_woman_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🗣️":{name:"speaking head",slug:"speaking_head",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👤":{name:"bust in silhouette",slug:"bust_in_silhouette",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👥":{name:"busts in silhouette",slug:"busts_in_silhouette",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫂":{name:"people hugging",slug:"people_hugging",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👪":{name:"family",slug:"family",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧑‍🧑‍🧒":{name:"family adult, adult, child",slug:"family_adult_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧑‍🧒‍🧒":{name:"family adult, adult, child, child",slug:"family_adult_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒":{name:"family adult, child",slug:"family_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒‍🧒":{name:"family adult, child, child",slug:"family_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"👣":{name:"footprints",slug:"footprints",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫆":{name:"fingerprint",slug:"fingerprint",group:"People & Body",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🐵":{name:"monkey face",slug:"monkey_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐒":{name:"monkey",slug:"monkey",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦍":{name:"gorilla",slug:"gorilla",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦧":{name:"orangutan",slug:"orangutan",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐶":{name:"dog face",slug:"dog_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐕":{name:"dog",slug:"dog",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦮":{name:"guide dog",slug:"guide_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐕‍🦺":{name:"service dog",slug:"service_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐩":{name:"poodle",slug:"poodle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐺":{name:"wolf",slug:"wolf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦊":{name:"fox",slug:"fox",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦝":{name:"raccoon",slug:"raccoon",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐱":{name:"cat face",slug:"cat_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐈":{name:"cat",slug:"cat",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🐈‍⬛":{name:"black cat",slug:"black_cat",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦁":{name:"lion",slug:"lion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐯":{name:"tiger face",slug:"tiger_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐅":{name:"tiger",slug:"tiger",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐆":{name:"leopard",slug:"leopard",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐴":{name:"horse face",slug:"horse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫎":{name:"moose",slug:"moose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫏":{name:"donkey",slug:"donkey",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐎":{name:"horse",slug:"horse",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦄":{name:"unicorn",slug:"unicorn",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦓":{name:"zebra",slug:"zebra",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦌":{name:"deer",slug:"deer",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦬":{name:"bison",slug:"bison",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐮":{name:"cow face",slug:"cow_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐂":{name:"ox",slug:"ox",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐃":{name:"water buffalo",slug:"water_buffalo",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐄":{name:"cow",slug:"cow",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐷":{name:"pig face",slug:"pig_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐖":{name:"pig",slug:"pig",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐗":{name:"boar",slug:"boar",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐽":{name:"pig nose",slug:"pig_nose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐏":{name:"ram",slug:"ram",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐑":{name:"ewe",slug:"ewe",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐐":{name:"goat",slug:"goat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐪":{name:"camel",slug:"camel",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐫":{name:"two-hump camel",slug:"two_hump_camel",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦙":{name:"llama",slug:"llama",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦒":{name:"giraffe",slug:"giraffe",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐘":{name:"elephant",slug:"elephant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦣":{name:"mammoth",slug:"mammoth",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦏":{name:"rhinoceros",slug:"rhinoceros",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦛":{name:"hippopotamus",slug:"hippopotamus",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐭":{name:"mouse face",slug:"mouse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐁":{name:"mouse",slug:"mouse",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐀":{name:"rat",slug:"rat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐹":{name:"hamster",slug:"hamster",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐰":{name:"rabbit face",slug:"rabbit_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐇":{name:"rabbit",slug:"rabbit",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐿️":{name:"chipmunk",slug:"chipmunk",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦫":{name:"beaver",slug:"beaver",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦔":{name:"hedgehog",slug:"hedgehog",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦇":{name:"bat",slug:"bat",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐻":{name:"bear",slug:"bear",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐻‍❄️":{name:"polar bear",slug:"polar_bear",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐨":{name:"koala",slug:"koala",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐼":{name:"panda",slug:"panda",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦥":{name:"sloth",slug:"sloth",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦦":{name:"otter",slug:"otter",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦨":{name:"skunk",slug:"skunk",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦘":{name:"kangaroo",slug:"kangaroo",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦡":{name:"badger",slug:"badger",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐾":{name:"paw prints",slug:"paw_prints",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦃":{name:"turkey",slug:"turkey",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐔":{name:"chicken",slug:"chicken",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐓":{name:"rooster",slug:"rooster",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐣":{name:"hatching chick",slug:"hatching_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐤":{name:"baby chick",slug:"baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐥":{name:"front-facing baby chick",slug:"front_facing_baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐦":{name:"bird",slug:"bird",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐧":{name:"penguin",slug:"penguin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕊️":{name:"dove",slug:"dove",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦅":{name:"eagle",slug:"eagle",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦆":{name:"duck",slug:"duck",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦢":{name:"swan",slug:"swan",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦉":{name:"owl",slug:"owl",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦤":{name:"dodo",slug:"dodo",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪶":{name:"feather",slug:"feather",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦩":{name:"flamingo",slug:"flamingo",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦚":{name:"peacock",slug:"peacock",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦜":{name:"parrot",slug:"parrot",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪽":{name:"wing",slug:"wing",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍⬛":{name:"black bird",slug:"black_bird",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪿":{name:"goose",slug:"goose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍🔥":{name:"phoenix",slug:"phoenix",group:"Animals & Nature",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🐸":{name:"frog",slug:"frog",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐊":{name:"crocodile",slug:"crocodile",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐢":{name:"turtle",slug:"turtle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦎":{name:"lizard",slug:"lizard",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐍":{name:"snake",slug:"snake",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐲":{name:"dragon face",slug:"dragon_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐉":{name:"dragon",slug:"dragon",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦕":{name:"sauropod",slug:"sauropod",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦖":{name:"T-Rex",slug:"t_rex",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐳":{name:"spouting whale",slug:"spouting_whale",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐋":{name:"whale",slug:"whale",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐬":{name:"dolphin",slug:"dolphin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦭":{name:"seal",slug:"seal",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐟":{name:"fish",slug:"fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐠":{name:"tropical fish",slug:"tropical_fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐡":{name:"blowfish",slug:"blowfish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦈":{name:"shark",slug:"shark",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐙":{name:"octopus",slug:"octopus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐚":{name:"spiral shell",slug:"spiral_shell",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪸":{name:"coral",slug:"coral",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪼":{name:"jellyfish",slug:"jellyfish",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🦀":{name:"crab",slug:"crab",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦞":{name:"lobster",slug:"lobster",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦐":{name:"shrimp",slug:"shrimp",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦑":{name:"squid",slug:"squid",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦪":{name:"oyster",slug:"oyster",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐌":{name:"snail",slug:"snail",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦋":{name:"butterfly",slug:"butterfly",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐛":{name:"bug",slug:"bug",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐜":{name:"ant",slug:"ant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐝":{name:"honeybee",slug:"honeybee",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪲":{name:"beetle",slug:"beetle",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐞":{name:"lady beetle",slug:"lady_beetle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦗":{name:"cricket",slug:"cricket",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪳":{name:"cockroach",slug:"cockroach",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🕷️":{name:"spider",slug:"spider",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕸️":{name:"spider web",slug:"spider_web",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦂":{name:"scorpion",slug:"scorpion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦟":{name:"mosquito",slug:"mosquito",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪰":{name:"fly",slug:"fly",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪱":{name:"worm",slug:"worm",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦠":{name:"microbe",slug:"microbe",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💐":{name:"bouquet",slug:"bouquet",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌸":{name:"cherry blossom",slug:"cherry_blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💮":{name:"white flower",slug:"white_flower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪷":{name:"lotus",slug:"lotus",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏵️":{name:"rosette",slug:"rosette",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌹":{name:"rose",slug:"rose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥀":{name:"wilted flower",slug:"wilted_flower",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌺":{name:"hibiscus",slug:"hibiscus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌻":{name:"sunflower",slug:"sunflower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌼":{name:"blossom",slug:"blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌷":{name:"tulip",slug:"tulip",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪻":{name:"hyacinth",slug:"hyacinth",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🌱":{name:"seedling",slug:"seedling",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪴":{name:"potted plant",slug:"potted_plant",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🌲":{name:"evergreen tree",slug:"evergreen_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌳":{name:"deciduous tree",slug:"deciduous_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌴":{name:"palm tree",slug:"palm_tree",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌵":{name:"cactus",slug:"cactus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌾":{name:"sheaf of rice",slug:"sheaf_of_rice",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌿":{name:"herb",slug:"herb",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☘️":{name:"shamrock",slug:"shamrock",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍀":{name:"four leaf clover",slug:"four_leaf_clover",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍁":{name:"maple leaf",slug:"maple_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍂":{name:"fallen leaf",slug:"fallen_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍃":{name:"leaf fluttering in wind",slug:"leaf_fluttering_in_wind",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪹":{name:"empty nest",slug:"empty_nest",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪺":{name:"nest with eggs",slug:"nest_with_eggs",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🍄":{name:"mushroom",slug:"mushroom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪾":{name:"leafless tree",slug:"leafless_tree",group:"Animals & Nature",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍇":{name:"grapes",slug:"grapes",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍈":{name:"melon",slug:"melon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍉":{name:"watermelon",slug:"watermelon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍊":{name:"tangerine",slug:"tangerine",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍋":{name:"lemon",slug:"lemon",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍋‍🟩":{name:"lime",slug:"lime",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🍌":{name:"banana",slug:"banana",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍍":{name:"pineapple",slug:"pineapple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥭":{name:"mango",slug:"mango",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍎":{name:"red apple",slug:"red_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍏":{name:"green apple",slug:"green_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍐":{name:"pear",slug:"pear",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍑":{name:"peach",slug:"peach",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍒":{name:"cherries",slug:"cherries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍓":{name:"strawberry",slug:"strawberry",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫐":{name:"blueberries",slug:"blueberries",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥝":{name:"kiwi fruit",slug:"kiwi_fruit",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍅":{name:"tomato",slug:"tomato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫒":{name:"olive",slug:"olive",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥥":{name:"coconut",slug:"coconut",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥑":{name:"avocado",slug:"avocado",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍆":{name:"eggplant",slug:"eggplant",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥔":{name:"potato",slug:"potato",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥕":{name:"carrot",slug:"carrot",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌽":{name:"ear of corn",slug:"ear_of_corn",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌶️":{name:"hot pepper",slug:"hot_pepper",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🫑":{name:"bell pepper",slug:"bell_pepper",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥒":{name:"cucumber",slug:"cucumber",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥬":{name:"leafy green",slug:"leafy_green",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥦":{name:"broccoli",slug:"broccoli",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧄":{name:"garlic",slug:"garlic",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧅":{name:"onion",slug:"onion",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥜":{name:"peanuts",slug:"peanuts",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫘":{name:"beans",slug:"beans",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🌰":{name:"chestnut",slug:"chestnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫚":{name:"ginger root",slug:"ginger_root",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫛":{name:"pea pod",slug:"pea_pod",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🍄‍🟫":{name:"brown mushroom",slug:"brown_mushroom",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🫜":{name:"root vegetable",slug:"root_vegetable",group:"Food & Drink",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍞":{name:"bread",slug:"bread",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥐":{name:"croissant",slug:"croissant",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥖":{name:"baguette bread",slug:"baguette_bread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫓":{name:"flatbread",slug:"flatbread",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥨":{name:"pretzel",slug:"pretzel",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥯":{name:"bagel",slug:"bagel",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥞":{name:"pancakes",slug:"pancakes",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧇":{name:"waffle",slug:"waffle",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧀":{name:"cheese wedge",slug:"cheese_wedge",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍖":{name:"meat on bone",slug:"meat_on_bone",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍗":{name:"poultry leg",slug:"poultry_leg",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥩":{name:"cut of meat",slug:"cut_of_meat",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥓":{name:"bacon",slug:"bacon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍔":{name:"hamburger",slug:"hamburger",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍟":{name:"french fries",slug:"french_fries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍕":{name:"pizza",slug:"pizza",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌭":{name:"hot dog",slug:"hot_dog",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥪":{name:"sandwich",slug:"sandwich",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🌮":{name:"taco",slug:"taco",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌯":{name:"burrito",slug:"burrito",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫔":{name:"tamale",slug:"tamale",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥙":{name:"stuffed flatbread",slug:"stuffed_flatbread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧆":{name:"falafel",slug:"falafel",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥚":{name:"egg",slug:"egg",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍳":{name:"cooking",slug:"cooking",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥘":{name:"shallow pan of food",slug:"shallow_pan_of_food",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍲":{name:"pot of food",slug:"pot_of_food",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫕":{name:"fondue",slug:"fondue",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥣":{name:"bowl with spoon",slug:"bowl_with_spoon",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥗":{name:"green salad",slug:"green_salad",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍿":{name:"popcorn",slug:"popcorn",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧈":{name:"butter",slug:"butter",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧂":{name:"salt",slug:"salt",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥫":{name:"canned food",slug:"canned_food",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍱":{name:"bento box",slug:"bento_box",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍘":{name:"rice cracker",slug:"rice_cracker",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍙":{name:"rice ball",slug:"rice_ball",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍚":{name:"cooked rice",slug:"cooked_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍛":{name:"curry rice",slug:"curry_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍜":{name:"steaming bowl",slug:"steaming_bowl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍝":{name:"spaghetti",slug:"spaghetti",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍠":{name:"roasted sweet potato",slug:"roasted_sweet_potato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍢":{name:"oden",slug:"oden",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍣":{name:"sushi",slug:"sushi",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍤":{name:"fried shrimp",slug:"fried_shrimp",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍥":{name:"fish cake with swirl",slug:"fish_cake_with_swirl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥮":{name:"moon cake",slug:"moon_cake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍡":{name:"dango",slug:"dango",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥟":{name:"dumpling",slug:"dumpling",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥠":{name:"fortune cookie",slug:"fortune_cookie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥡":{name:"takeout box",slug:"takeout_box",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍦":{name:"soft ice cream",slug:"soft_ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍧":{name:"shaved ice",slug:"shaved_ice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍨":{name:"ice cream",slug:"ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍩":{name:"doughnut",slug:"doughnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍪":{name:"cookie",slug:"cookie",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎂":{name:"birthday cake",slug:"birthday_cake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍰":{name:"shortcake",slug:"shortcake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧁":{name:"cupcake",slug:"cupcake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥧":{name:"pie",slug:"pie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍫":{name:"chocolate bar",slug:"chocolate_bar",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍬":{name:"candy",slug:"candy",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍭":{name:"lollipop",slug:"lollipop",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍮":{name:"custard",slug:"custard",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍯":{name:"honey pot",slug:"honey_pot",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍼":{name:"baby bottle",slug:"baby_bottle",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥛":{name:"glass of milk",slug:"glass_of_milk",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"☕":{name:"hot beverage",slug:"hot_beverage",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫖":{name:"teapot",slug:"teapot",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🍵":{name:"teacup without handle",slug:"teacup_without_handle",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍶":{name:"sake",slug:"sake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍾":{name:"bottle with popping cork",slug:"bottle_with_popping_cork",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍷":{name:"wine glass",slug:"wine_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍸":{name:"cocktail glass",slug:"cocktail_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍹":{name:"tropical drink",slug:"tropical_drink",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍺":{name:"beer mug",slug:"beer_mug",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍻":{name:"clinking beer mugs",slug:"clinking_beer_mugs",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥂":{name:"clinking glasses",slug:"clinking_glasses",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥃":{name:"tumbler glass",slug:"tumbler_glass",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫗":{name:"pouring liquid",slug:"pouring_liquid",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🥤":{name:"cup with straw",slug:"cup_with_straw",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧋":{name:"bubble tea",slug:"bubble_tea",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧃":{name:"beverage box",slug:"beverage_box",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧉":{name:"mate",slug:"mate",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧊":{name:"ice",slug:"ice",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥢":{name:"chopsticks",slug:"chopsticks",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍽️":{name:"fork and knife with plate",slug:"fork_and_knife_with_plate",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🍴":{name:"fork and knife",slug:"fork_and_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥄":{name:"spoon",slug:"spoon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🔪":{name:"kitchen knife",slug:"kitchen_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫙":{name:"jar",slug:"jar",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏺":{name:"amphora",slug:"amphora",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌍":{name:"globe showing Europe-Africa",slug:"globe_showing_europe_africa",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌎":{name:"globe showing Americas",slug:"globe_showing_americas",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌏":{name:"globe showing Asia-Australia",slug:"globe_showing_asia_australia",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌐":{name:"globe with meridians",slug:"globe_with_meridians",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗺️":{name:"world map",slug:"world_map",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗾":{name:"map of Japan",slug:"map_of_japan",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧭":{name:"compass",slug:"compass",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏔️":{name:"snow-capped mountain",slug:"snow_capped_mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛰️":{name:"mountain",slug:"mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌋":{name:"volcano",slug:"volcano",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗻":{name:"mount fuji",slug:"mount_fuji",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏕️":{name:"camping",slug:"camping",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏖️":{name:"beach with umbrella",slug:"beach_with_umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏜️":{name:"desert",slug:"desert",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏝️":{name:"desert island",slug:"desert_island",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏞️":{name:"national park",slug:"national_park",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏟️":{name:"stadium",slug:"stadium",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏛️":{name:"classical building",slug:"classical_building",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏗️":{name:"building construction",slug:"building_construction",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧱":{name:"brick",slug:"brick",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪨":{name:"rock",slug:"rock",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪵":{name:"wood",slug:"wood",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛖":{name:"hut",slug:"hut",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏘️":{name:"houses",slug:"houses",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏚️":{name:"derelict house",slug:"derelict_house",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏠":{name:"house",slug:"house",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏡":{name:"house with garden",slug:"house_with_garden",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏢":{name:"office building",slug:"office_building",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏣":{name:"Japanese post office",slug:"japanese_post_office",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏤":{name:"post office",slug:"post_office",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏥":{name:"hospital",slug:"hospital",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏦":{name:"bank",slug:"bank",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏨":{name:"hotel",slug:"hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏩":{name:"love hotel",slug:"love_hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏪":{name:"convenience store",slug:"convenience_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏫":{name:"school",slug:"school",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏬":{name:"department store",slug:"department_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏭":{name:"factory",slug:"factory",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏯":{name:"Japanese castle",slug:"japanese_castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏰":{name:"castle",slug:"castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💒":{name:"wedding",slug:"wedding",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗼":{name:"Tokyo tower",slug:"tokyo_tower",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗽":{name:"Statue of Liberty",slug:"statue_of_liberty",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛪":{name:"church",slug:"church",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕌":{name:"mosque",slug:"mosque",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛕":{name:"hindu temple",slug:"hindu_temple",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🕍":{name:"synagogue",slug:"synagogue",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛩️":{name:"shinto shrine",slug:"shinto_shrine",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕋":{name:"kaaba",slug:"kaaba",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛲":{name:"fountain",slug:"fountain",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛺":{name:"tent",slug:"tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌁":{name:"foggy",slug:"foggy",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌃":{name:"night with stars",slug:"night_with_stars",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏙️":{name:"cityscape",slug:"cityscape",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌄":{name:"sunrise over mountains",slug:"sunrise_over_mountains",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌅":{name:"sunrise",slug:"sunrise",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌆":{name:"cityscape at dusk",slug:"cityscape_at_dusk",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌇":{name:"sunset",slug:"sunset",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌉":{name:"bridge at night",slug:"bridge_at_night",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♨️":{name:"hot springs",slug:"hot_springs",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎠":{name:"carousel horse",slug:"carousel_horse",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛝":{name:"playground slide",slug:"playground_slide",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🎡":{name:"ferris wheel",slug:"ferris_wheel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎢":{name:"roller coaster",slug:"roller_coaster",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💈":{name:"barber pole",slug:"barber_pole",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎪":{name:"circus tent",slug:"circus_tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚂":{name:"locomotive",slug:"locomotive",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚃":{name:"railway car",slug:"railway_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚄":{name:"high-speed train",slug:"high_speed_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚅":{name:"bullet train",slug:"bullet_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚆":{name:"train",slug:"train",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚇":{name:"metro",slug:"metro",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚈":{name:"light rail",slug:"light_rail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚉":{name:"station",slug:"station",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚊":{name:"tram",slug:"tram",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚝":{name:"monorail",slug:"monorail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚞":{name:"mountain railway",slug:"mountain_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚋":{name:"tram car",slug:"tram_car",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚌":{name:"bus",slug:"bus",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚍":{name:"oncoming bus",slug:"oncoming_bus",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚎":{name:"trolleybus",slug:"trolleybus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚐":{name:"minibus",slug:"minibus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚑":{name:"ambulance",slug:"ambulance",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚒":{name:"fire engine",slug:"fire_engine",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚓":{name:"police car",slug:"police_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚔":{name:"oncoming police car",slug:"oncoming_police_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚕":{name:"taxi",slug:"taxi",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚖":{name:"oncoming taxi",slug:"oncoming_taxi",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚗":{name:"automobile",slug:"automobile",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚘":{name:"oncoming automobile",slug:"oncoming_automobile",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚙":{name:"sport utility vehicle",slug:"sport_utility_vehicle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛻":{name:"pickup truck",slug:"pickup_truck",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚚":{name:"delivery truck",slug:"delivery_truck",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚛":{name:"articulated lorry",slug:"articulated_lorry",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚜":{name:"tractor",slug:"tractor",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏎️":{name:"racing car",slug:"racing_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏍️":{name:"motorcycle",slug:"motorcycle",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛵":{name:"motor scooter",slug:"motor_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦽":{name:"manual wheelchair",slug:"manual_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦼":{name:"motorized wheelchair",slug:"motorized_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🛺":{name:"auto rickshaw",slug:"auto_rickshaw",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚲":{name:"bicycle",slug:"bicycle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛴":{name:"kick scooter",slug:"kick_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🛹":{name:"skateboard",slug:"skateboard",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛼":{name:"roller skate",slug:"roller_skate",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚏":{name:"bus stop",slug:"bus_stop",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛣️":{name:"motorway",slug:"motorway",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛤️":{name:"railway track",slug:"railway_track",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛢️":{name:"oil drum",slug:"oil_drum",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛽":{name:"fuel pump",slug:"fuel_pump",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛞":{name:"wheel",slug:"wheel",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚨":{name:"police car light",slug:"police_car_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚥":{name:"horizontal traffic light",slug:"horizontal_traffic_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚦":{name:"vertical traffic light",slug:"vertical_traffic_light",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛑":{name:"stop sign",slug:"stop_sign",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚧":{name:"construction",slug:"construction",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚓":{name:"anchor",slug:"anchor",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛟":{name:"ring buoy",slug:"ring_buoy",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"⛵":{name:"sailboat",slug:"sailboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛶":{name:"canoe",slug:"canoe",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚤":{name:"speedboat",slug:"speedboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛳️":{name:"passenger ship",slug:"passenger_ship",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛴️":{name:"ferry",slug:"ferry",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛥️":{name:"motor boat",slug:"motor_boat",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚢":{name:"ship",slug:"ship",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✈️":{name:"airplane",slug:"airplane",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛩️":{name:"small airplane",slug:"small_airplane",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛫":{name:"airplane departure",slug:"airplane_departure",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛬":{name:"airplane arrival",slug:"airplane_arrival",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪂":{name:"parachute",slug:"parachute",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💺":{name:"seat",slug:"seat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚁":{name:"helicopter",slug:"helicopter",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚟":{name:"suspension railway",slug:"suspension_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚠":{name:"mountain cableway",slug:"mountain_cableway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚡":{name:"aerial tramway",slug:"aerial_tramway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛰️":{name:"satellite",slug:"satellite",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚀":{name:"rocket",slug:"rocket",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛸":{name:"flying saucer",slug:"flying_saucer",group:"Travel & Places",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🛎️":{name:"bellhop bell",slug:"bellhop_bell",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧳":{name:"luggage",slug:"luggage",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"⌛":{name:"hourglass done",slug:"hourglass_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏳":{name:"hourglass not done",slug:"hourglass_not_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⌚":{name:"watch",slug:"watch",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏰":{name:"alarm clock",slug:"alarm_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏱️":{name:"stopwatch",slug:"stopwatch",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⏲️":{name:"timer clock",slug:"timer_clock",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕰️":{name:"mantelpiece clock",slug:"mantelpiece_clock",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕛":{name:"twelve o’clock",slug:"twelve_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕧":{name:"twelve-thirty",slug:"twelve_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕐":{name:"one o’clock",slug:"one_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕜":{name:"one-thirty",slug:"one_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕑":{name:"two o’clock",slug:"two_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕝":{name:"two-thirty",slug:"two_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕒":{name:"three o’clock",slug:"three_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕞":{name:"three-thirty",slug:"three_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕓":{name:"four o’clock",slug:"four_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕟":{name:"four-thirty",slug:"four_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕔":{name:"five o’clock",slug:"five_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕠":{name:"five-thirty",slug:"five_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕕":{name:"six o’clock",slug:"six_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕡":{name:"six-thirty",slug:"six_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕖":{name:"seven o’clock",slug:"seven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕢":{name:"seven-thirty",slug:"seven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕗":{name:"eight o’clock",slug:"eight_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕣":{name:"eight-thirty",slug:"eight_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕘":{name:"nine o’clock",slug:"nine_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕤":{name:"nine-thirty",slug:"nine_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕙":{name:"ten o’clock",slug:"ten_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕥":{name:"ten-thirty",slug:"ten_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕚":{name:"eleven o’clock",slug:"eleven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕦":{name:"eleven-thirty",slug:"eleven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌑":{name:"new moon",slug:"new_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌒":{name:"waxing crescent moon",slug:"waxing_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌓":{name:"first quarter moon",slug:"first_quarter_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌔":{name:"waxing gibbous moon",slug:"waxing_gibbous_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌕":{name:"full moon",slug:"full_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌖":{name:"waning gibbous moon",slug:"waning_gibbous_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌗":{name:"last quarter moon",slug:"last_quarter_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌘":{name:"waning crescent moon",slug:"waning_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌙":{name:"crescent moon",slug:"crescent_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌚":{name:"new moon face",slug:"new_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌛":{name:"first quarter moon face",slug:"first_quarter_moon_face",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌜":{name:"last quarter moon face",slug:"last_quarter_moon_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌡️":{name:"thermometer",slug:"thermometer",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☀️":{name:"sun",slug:"sun",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌝":{name:"full moon face",slug:"full_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌞":{name:"sun with face",slug:"sun_with_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪐":{name:"ringed planet",slug:"ringed_planet",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⭐":{name:"star",slug:"star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌟":{name:"glowing star",slug:"glowing_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌠":{name:"shooting star",slug:"shooting_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌌":{name:"milky way",slug:"milky_way",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☁️":{name:"cloud",slug:"cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛅":{name:"sun behind cloud",slug:"sun_behind_cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛈️":{name:"cloud with lightning and rain",slug:"cloud_with_lightning_and_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌤️":{name:"sun behind small cloud",slug:"sun_behind_small_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌥️":{name:"sun behind large cloud",slug:"sun_behind_large_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌦️":{name:"sun behind rain cloud",slug:"sun_behind_rain_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌧️":{name:"cloud with rain",slug:"cloud_with_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌨️":{name:"cloud with snow",slug:"cloud_with_snow",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌩️":{name:"cloud with lightning",slug:"cloud_with_lightning",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌪️":{name:"tornado",slug:"tornado",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌫️":{name:"fog",slug:"fog",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌬️":{name:"wind face",slug:"wind_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌀":{name:"cyclone",slug:"cyclone",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌈":{name:"rainbow",slug:"rainbow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌂":{name:"closed umbrella",slug:"closed_umbrella",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☂️":{name:"umbrella",slug:"umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☔":{name:"umbrella with rain drops",slug:"umbrella_with_rain_drops",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛱️":{name:"umbrella on ground",slug:"umbrella_on_ground",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚡":{name:"high voltage",slug:"high_voltage",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❄️":{name:"snowflake",slug:"snowflake",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☃️":{name:"snowman",slug:"snowman",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛄":{name:"snowman without snow",slug:"snowman_without_snow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☄️":{name:"comet",slug:"comet",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔥":{name:"fire",slug:"fire",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💧":{name:"droplet",slug:"droplet",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌊":{name:"water wave",slug:"water_wave",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎃":{name:"jack-o-lantern",slug:"jack_o_lantern",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎄":{name:"Christmas tree",slug:"christmas_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎆":{name:"fireworks",slug:"fireworks",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎇":{name:"sparkler",slug:"sparkler",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧨":{name:"firecracker",slug:"firecracker",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"✨":{name:"sparkles",slug:"sparkles",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎈":{name:"balloon",slug:"balloon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎉":{name:"party popper",slug:"party_popper",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎊":{name:"confetti ball",slug:"confetti_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎋":{name:"tanabata tree",slug:"tanabata_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎍":{name:"pine decoration",slug:"pine_decoration",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎎":{name:"Japanese dolls",slug:"japanese_dolls",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎏":{name:"carp streamer",slug:"carp_streamer",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎐":{name:"wind chime",slug:"wind_chime",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎑":{name:"moon viewing ceremony",slug:"moon_viewing_ceremony",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧧":{name:"red envelope",slug:"red_envelope",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎀":{name:"ribbon",slug:"ribbon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎁":{name:"wrapped gift",slug:"wrapped_gift",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎗️":{name:"reminder ribbon",slug:"reminder_ribbon",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎟️":{name:"admission tickets",slug:"admission_tickets",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎫":{name:"ticket",slug:"ticket",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎖️":{name:"military medal",slug:"military_medal",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏆":{name:"trophy",slug:"trophy",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏅":{name:"sports medal",slug:"sports_medal",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥇":{name:"1st place medal",slug:"1st_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥈":{name:"2nd place medal",slug:"2nd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥉":{name:"3rd place medal",slug:"3rd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⚽":{name:"soccer ball",slug:"soccer_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚾":{name:"baseball",slug:"baseball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥎":{name:"softball",slug:"softball",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏀":{name:"basketball",slug:"basketball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏐":{name:"volleyball",slug:"volleyball",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏈":{name:"american football",slug:"american_football",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏉":{name:"rugby football",slug:"rugby_football",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎾":{name:"tennis",slug:"tennis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥏":{name:"flying disc",slug:"flying_disc",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎳":{name:"bowling",slug:"bowling",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏏":{name:"cricket game",slug:"cricket_game",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏑":{name:"field hockey",slug:"field_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏒":{name:"ice hockey",slug:"ice_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥍":{name:"lacrosse",slug:"lacrosse",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏓":{name:"ping pong",slug:"ping_pong",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏸":{name:"badminton",slug:"badminton",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥊":{name:"boxing glove",slug:"boxing_glove",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥋":{name:"martial arts uniform",slug:"martial_arts_uniform",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥅":{name:"goal net",slug:"goal_net",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⛳":{name:"flag in hole",slug:"flag_in_hole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛸️":{name:"ice skate",slug:"ice_skate",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎣":{name:"fishing pole",slug:"fishing_pole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤿":{name:"diving mask",slug:"diving_mask",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🎽":{name:"running shirt",slug:"running_shirt",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎿":{name:"skis",slug:"skis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛷":{name:"sled",slug:"sled",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥌":{name:"curling stone",slug:"curling_stone",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🎯":{name:"bullseye",slug:"bullseye",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪀":{name:"yo-yo",slug:"yo_yo",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🪁":{name:"kite",slug:"kite",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔫":{name:"water pistol",slug:"water_pistol",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎱":{name:"pool 8 ball",slug:"pool_8_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔮":{name:"crystal ball",slug:"crystal_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪄":{name:"magic wand",slug:"magic_wand",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎮":{name:"video game",slug:"video_game",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕹️":{name:"joystick",slug:"joystick",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎰":{name:"slot machine",slug:"slot_machine",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎲":{name:"game die",slug:"game_die",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧩":{name:"puzzle piece",slug:"puzzle_piece",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧸":{name:"teddy bear",slug:"teddy_bear",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪅":{name:"piñata",slug:"pinata",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪩":{name:"mirror ball",slug:"mirror_ball",group:"Activities",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪆":{name:"nesting dolls",slug:"nesting_dolls",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"♠️":{name:"spade suit",slug:"spade_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♥️":{name:"heart suit",slug:"heart_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♦️":{name:"diamond suit",slug:"diamond_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♣️":{name:"club suit",slug:"club_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♟️":{name:"chess pawn",slug:"chess_pawn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🃏":{name:"joker",slug:"joker",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🀄":{name:"mahjong red dragon",slug:"mahjong_red_dragon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎴":{name:"flower playing cards",slug:"flower_playing_cards",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎭":{name:"performing arts",slug:"performing_arts",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖼️":{name:"framed picture",slug:"framed_picture",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎨":{name:"artist palette",slug:"artist_palette",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧵":{name:"thread",slug:"thread",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪡":{name:"sewing needle",slug:"sewing_needle",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧶":{name:"yarn",slug:"yarn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪢":{name:"knot",slug:"knot",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👓":{name:"glasses",slug:"glasses",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕶️":{name:"sunglasses",slug:"sunglasses",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🥽":{name:"goggles",slug:"goggles",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥼":{name:"lab coat",slug:"lab_coat",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦺":{name:"safety vest",slug:"safety_vest",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👔":{name:"necktie",slug:"necktie",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👕":{name:"t-shirt",slug:"t_shirt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👖":{name:"jeans",slug:"jeans",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧣":{name:"scarf",slug:"scarf",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧤":{name:"gloves",slug:"gloves",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧥":{name:"coat",slug:"coat",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧦":{name:"socks",slug:"socks",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"👗":{name:"dress",slug:"dress",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👘":{name:"kimono",slug:"kimono",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥻":{name:"sari",slug:"sari",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩱":{name:"one-piece swimsuit",slug:"one_piece_swimsuit",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩲":{name:"briefs",slug:"briefs",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩳":{name:"shorts",slug:"shorts",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👙":{name:"bikini",slug:"bikini",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👚":{name:"woman’s clothes",slug:"woman_s_clothes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪭":{name:"folding hand fan",slug:"folding_hand_fan",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👛":{name:"purse",slug:"purse",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👜":{name:"handbag",slug:"handbag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👝":{name:"clutch bag",slug:"clutch_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛍️":{name:"shopping bags",slug:"shopping_bags",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎒":{name:"backpack",slug:"backpack",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩴":{name:"thong sandal",slug:"thong_sandal",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👞":{name:"man’s shoe",slug:"man_s_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👟":{name:"running shoe",slug:"running_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥾":{name:"hiking boot",slug:"hiking_boot",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥿":{name:"flat shoe",slug:"flat_shoe",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👠":{name:"high-heeled shoe",slug:"high_heeled_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👡":{name:"woman’s sandal",slug:"woman_s_sandal",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩰":{name:"ballet shoes",slug:"ballet_shoes",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👢":{name:"woman’s boot",slug:"woman_s_boot",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪮":{name:"hair pick",slug:"hair_pick",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👑":{name:"crown",slug:"crown",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👒":{name:"woman’s hat",slug:"woman_s_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎩":{name:"top hat",slug:"top_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎓":{name:"graduation cap",slug:"graduation_cap",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧢":{name:"billed cap",slug:"billed_cap",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪖":{name:"military helmet",slug:"military_helmet",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⛑️":{name:"rescue worker’s helmet",slug:"rescue_worker_s_helmet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📿":{name:"prayer beads",slug:"prayer_beads",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💄":{name:"lipstick",slug:"lipstick",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💍":{name:"ring",slug:"ring",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💎":{name:"gem stone",slug:"gem_stone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔇":{name:"muted speaker",slug:"muted_speaker",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔈":{name:"speaker low volume",slug:"speaker_low_volume",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔉":{name:"speaker medium volume",slug:"speaker_medium_volume",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔊":{name:"speaker high volume",slug:"speaker_high_volume",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📢":{name:"loudspeaker",slug:"loudspeaker",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📣":{name:"megaphone",slug:"megaphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📯":{name:"postal horn",slug:"postal_horn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔔":{name:"bell",slug:"bell",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔕":{name:"bell with slash",slug:"bell_with_slash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎼":{name:"musical score",slug:"musical_score",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎵":{name:"musical note",slug:"musical_note",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎶":{name:"musical notes",slug:"musical_notes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎙️":{name:"studio microphone",slug:"studio_microphone",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎚️":{name:"level slider",slug:"level_slider",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎛️":{name:"control knobs",slug:"control_knobs",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎤":{name:"microphone",slug:"microphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎧":{name:"headphone",slug:"headphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📻":{name:"radio",slug:"radio",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎷":{name:"saxophone",slug:"saxophone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪗":{name:"accordion",slug:"accordion",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎸":{name:"guitar",slug:"guitar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎹":{name:"musical keyboard",slug:"musical_keyboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎺":{name:"trumpet",slug:"trumpet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎻":{name:"violin",slug:"violin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪕":{name:"banjo",slug:"banjo",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥁":{name:"drum",slug:"drum",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🪘":{name:"long drum",slug:"long_drum",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪇":{name:"maracas",slug:"maracas",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪈":{name:"flute",slug:"flute",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪉":{name:"harp",slug:"harp",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"📱":{name:"mobile phone",slug:"mobile_phone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📲":{name:"mobile phone with arrow",slug:"mobile_phone_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☎️":{name:"telephone",slug:"telephone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📞":{name:"telephone receiver",slug:"telephone_receiver",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📟":{name:"pager",slug:"pager",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📠":{name:"fax machine",slug:"fax_machine",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔋":{name:"battery",slug:"battery",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪫":{name:"low battery",slug:"low_battery",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🔌":{name:"electric plug",slug:"electric_plug",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💻":{name:"laptop",slug:"laptop",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖥️":{name:"desktop computer",slug:"desktop_computer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖨️":{name:"printer",slug:"printer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⌨️":{name:"keyboard",slug:"keyboard",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🖱️":{name:"computer mouse",slug:"computer_mouse",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖲️":{name:"trackball",slug:"trackball",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💽":{name:"computer disk",slug:"computer_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💾":{name:"floppy disk",slug:"floppy_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💿":{name:"optical disk",slug:"optical_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📀":{name:"dvd",slug:"dvd",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧮":{name:"abacus",slug:"abacus",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎥":{name:"movie camera",slug:"movie_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎞️":{name:"film frames",slug:"film_frames",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📽️":{name:"film projector",slug:"film_projector",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎬":{name:"clapper board",slug:"clapper_board",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📺":{name:"television",slug:"television",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📷":{name:"camera",slug:"camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📸":{name:"camera with flash",slug:"camera_with_flash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📹":{name:"video camera",slug:"video_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📼":{name:"videocassette",slug:"videocassette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔍":{name:"magnifying glass tilted left",slug:"magnifying_glass_tilted_left",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔎":{name:"magnifying glass tilted right",slug:"magnifying_glass_tilted_right",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕯️":{name:"candle",slug:"candle",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💡":{name:"light bulb",slug:"light_bulb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔦":{name:"flashlight",slug:"flashlight",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏮":{name:"red paper lantern",slug:"red_paper_lantern",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪔":{name:"diya lamp",slug:"diya_lamp",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"📔":{name:"notebook with decorative cover",slug:"notebook_with_decorative_cover",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📕":{name:"closed book",slug:"closed_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📖":{name:"open book",slug:"open_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📗":{name:"green book",slug:"green_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📘":{name:"blue book",slug:"blue_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📙":{name:"orange book",slug:"orange_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📚":{name:"books",slug:"books",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📓":{name:"notebook",slug:"notebook",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📒":{name:"ledger",slug:"ledger",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📃":{name:"page with curl",slug:"page_with_curl",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📜":{name:"scroll",slug:"scroll",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📄":{name:"page facing up",slug:"page_facing_up",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📰":{name:"newspaper",slug:"newspaper",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗞️":{name:"rolled-up newspaper",slug:"rolled_up_newspaper",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📑":{name:"bookmark tabs",slug:"bookmark_tabs",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔖":{name:"bookmark",slug:"bookmark",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏷️":{name:"label",slug:"label",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💰":{name:"money bag",slug:"money_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪙":{name:"coin",slug:"coin",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"💴":{name:"yen banknote",slug:"yen_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💵":{name:"dollar banknote",slug:"dollar_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💶":{name:"euro banknote",slug:"euro_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💷":{name:"pound banknote",slug:"pound_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💸":{name:"money with wings",slug:"money_with_wings",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💳":{name:"credit card",slug:"credit_card",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧾":{name:"receipt",slug:"receipt",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💹":{name:"chart increasing with yen",slug:"chart_increasing_with_yen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✉️":{name:"envelope",slug:"envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📧":{name:"e-mail",slug:"e_mail",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📨":{name:"incoming envelope",slug:"incoming_envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📩":{name:"envelope with arrow",slug:"envelope_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📤":{name:"outbox tray",slug:"outbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📥":{name:"inbox tray",slug:"inbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📦":{name:"package",slug:"package",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📫":{name:"closed mailbox with raised flag",slug:"closed_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📪":{name:"closed mailbox with lowered flag",slug:"closed_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📬":{name:"open mailbox with raised flag",slug:"open_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📭":{name:"open mailbox with lowered flag",slug:"open_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📮":{name:"postbox",slug:"postbox",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗳️":{name:"ballot box with ballot",slug:"ballot_box_with_ballot",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✏️":{name:"pencil",slug:"pencil",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✒️":{name:"black nib",slug:"black_nib",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖋️":{name:"fountain pen",slug:"fountain_pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖊️":{name:"pen",slug:"pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖌️":{name:"paintbrush",slug:"paintbrush",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖍️":{name:"crayon",slug:"crayon",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📝":{name:"memo",slug:"memo",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💼":{name:"briefcase",slug:"briefcase",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📁":{name:"file folder",slug:"file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📂":{name:"open file folder",slug:"open_file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗂️":{name:"card index dividers",slug:"card_index_dividers",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📅":{name:"calendar",slug:"calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📆":{name:"tear-off calendar",slug:"tear_off_calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗒️":{name:"spiral notepad",slug:"spiral_notepad",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗓️":{name:"spiral calendar",slug:"spiral_calendar",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📇":{name:"card index",slug:"card_index",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📈":{name:"chart increasing",slug:"chart_increasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📉":{name:"chart decreasing",slug:"chart_decreasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📊":{name:"bar chart",slug:"bar_chart",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📋":{name:"clipboard",slug:"clipboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📌":{name:"pushpin",slug:"pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📍":{name:"round pushpin",slug:"round_pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📎":{name:"paperclip",slug:"paperclip",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖇️":{name:"linked paperclips",slug:"linked_paperclips",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📏":{name:"straight ruler",slug:"straight_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📐":{name:"triangular ruler",slug:"triangular_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✂️":{name:"scissors",slug:"scissors",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗃️":{name:"card file box",slug:"card_file_box",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗄️":{name:"file cabinet",slug:"file_cabinet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗑️":{name:"wastebasket",slug:"wastebasket",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔒":{name:"locked",slug:"locked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔓":{name:"unlocked",slug:"unlocked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔏":{name:"locked with pen",slug:"locked_with_pen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔐":{name:"locked with key",slug:"locked_with_key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔑":{name:"key",slug:"key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗝️":{name:"old key",slug:"old_key",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔨":{name:"hammer",slug:"hammer",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪓":{name:"axe",slug:"axe",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⛏️":{name:"pick",slug:"pick",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚒️":{name:"hammer and pick",slug:"hammer_and_pick",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛠️":{name:"hammer and wrench",slug:"hammer_and_wrench",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗡️":{name:"dagger",slug:"dagger",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚔️":{name:"crossed swords",slug:"crossed_swords",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💣":{name:"bomb",slug:"bomb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪃":{name:"boomerang",slug:"boomerang",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏹":{name:"bow and arrow",slug:"bow_and_arrow",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛡️":{name:"shield",slug:"shield",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪚":{name:"carpentry saw",slug:"carpentry_saw",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔧":{name:"wrench",slug:"wrench",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪛":{name:"screwdriver",slug:"screwdriver",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔩":{name:"nut and bolt",slug:"nut_and_bolt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚙️":{name:"gear",slug:"gear",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗜️":{name:"clamp",slug:"clamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚖️":{name:"balance scale",slug:"balance_scale",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦯":{name:"white cane",slug:"white_cane",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔗":{name:"link",slug:"link",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛓️‍💥":{name:"broken chain",slug:"broken_chain",group:"Objects",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"⛓️":{name:"chains",slug:"chains",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪝":{name:"hook",slug:"hook",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧰":{name:"toolbox",slug:"toolbox",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧲":{name:"magnet",slug:"magnet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪜":{name:"ladder",slug:"ladder",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪏":{name:"shovel",slug:"shovel",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"⚗️":{name:"alembic",slug:"alembic",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧪":{name:"test tube",slug:"test_tube",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧫":{name:"petri dish",slug:"petri_dish",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧬":{name:"dna",slug:"dna",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🔬":{name:"microscope",slug:"microscope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔭":{name:"telescope",slug:"telescope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📡":{name:"satellite antenna",slug:"satellite_antenna",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💉":{name:"syringe",slug:"syringe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩸":{name:"drop of blood",slug:"drop_of_blood",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💊":{name:"pill",slug:"pill",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩹":{name:"adhesive bandage",slug:"adhesive_bandage",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩼":{name:"crutch",slug:"crutch",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🩺":{name:"stethoscope",slug:"stethoscope",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩻":{name:"x-ray",slug:"x_ray",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚪":{name:"door",slug:"door",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛗":{name:"elevator",slug:"elevator",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪞":{name:"mirror",slug:"mirror",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪟":{name:"window",slug:"window",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛏️":{name:"bed",slug:"bed",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛋️":{name:"couch and lamp",slug:"couch_and_lamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪑":{name:"chair",slug:"chair",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚽":{name:"toilet",slug:"toilet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪠":{name:"plunger",slug:"plunger",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚿":{name:"shower",slug:"shower",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛁":{name:"bathtub",slug:"bathtub",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪤":{name:"mouse trap",slug:"mouse_trap",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪒":{name:"razor",slug:"razor",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧴":{name:"lotion bottle",slug:"lotion_bottle",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧷":{name:"safety pin",slug:"safety_pin",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧹":{name:"broom",slug:"broom",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧺":{name:"basket",slug:"basket",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧻":{name:"roll of paper",slug:"roll_of_paper",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪣":{name:"bucket",slug:"bucket",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧼":{name:"soap",slug:"soap",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🫧":{name:"bubbles",slug:"bubbles",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪥":{name:"toothbrush",slug:"toothbrush",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧽":{name:"sponge",slug:"sponge",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧯":{name:"fire extinguisher",slug:"fire_extinguisher",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛒":{name:"shopping cart",slug:"shopping_cart",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚬":{name:"cigarette",slug:"cigarette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚰️":{name:"coffin",slug:"coffin",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪦":{name:"headstone",slug:"headstone",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⚱️":{name:"funeral urn",slug:"funeral_urn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧿":{name:"nazar amulet",slug:"nazar_amulet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪬":{name:"hamsa",slug:"hamsa",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🗿":{name:"moai",slug:"moai",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪧":{name:"placard",slug:"placard",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪪":{name:"identification card",slug:"identification_card",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏧":{name:"ATM sign",slug:"atm_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚮":{name:"litter in bin sign",slug:"litter_in_bin_sign",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚰":{name:"potable water",slug:"potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"♿":{name:"wheelchair symbol",slug:"wheelchair_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚹":{name:"men’s room",slug:"men_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚺":{name:"women’s room",slug:"women_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚻":{name:"restroom",slug:"restroom",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚼":{name:"baby symbol",slug:"baby_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚾":{name:"water closet",slug:"water_closet",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛂":{name:"passport control",slug:"passport_control",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛃":{name:"customs",slug:"customs",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛄":{name:"baggage claim",slug:"baggage_claim",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛅":{name:"left luggage",slug:"left_luggage",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚠️":{name:"warning",slug:"warning",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚸":{name:"children crossing",slug:"children_crossing",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛔":{name:"no entry",slug:"no_entry",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚫":{name:"prohibited",slug:"prohibited",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚳":{name:"no bicycles",slug:"no_bicycles",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚭":{name:"no smoking",slug:"no_smoking",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚯":{name:"no littering",slug:"no_littering",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚱":{name:"non-potable water",slug:"non_potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚷":{name:"no pedestrians",slug:"no_pedestrians",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📵":{name:"no mobile phones",slug:"no_mobile_phones",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔞":{name:"no one under eighteen",slug:"no_one_under_eighteen",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☢️":{name:"radioactive",slug:"radioactive",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☣️":{name:"biohazard",slug:"biohazard",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⬆️":{name:"up arrow",slug:"up_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↗️":{name:"up-right arrow",slug:"up_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➡️":{name:"right arrow",slug:"right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↘️":{name:"down-right arrow",slug:"down_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬇️":{name:"down arrow",slug:"down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↙️":{name:"down-left arrow",slug:"down_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬅️":{name:"left arrow",slug:"left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↖️":{name:"up-left arrow",slug:"up_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↕️":{name:"up-down arrow",slug:"up_down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↔️":{name:"left-right arrow",slug:"left_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↩️":{name:"right arrow curving left",slug:"right_arrow_curving_left",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↪️":{name:"left arrow curving right",slug:"left_arrow_curving_right",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤴️":{name:"right arrow curving up",slug:"right_arrow_curving_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤵️":{name:"right arrow curving down",slug:"right_arrow_curving_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔃":{name:"clockwise vertical arrows",slug:"clockwise_vertical_arrows",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔄":{name:"counterclockwise arrows button",slug:"counterclockwise_arrows_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔙":{name:"BACK arrow",slug:"back_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔚":{name:"END arrow",slug:"end_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔛":{name:"ON! arrow",slug:"on_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔜":{name:"SOON arrow",slug:"soon_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔝":{name:"TOP arrow",slug:"top_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛐":{name:"place of worship",slug:"place_of_worship",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚛️":{name:"atom symbol",slug:"atom_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕉️":{name:"om",slug:"om",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✡️":{name:"star of David",slug:"star_of_david",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☸️":{name:"wheel of dharma",slug:"wheel_of_dharma",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☯️":{name:"yin yang",slug:"yin_yang",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✝️":{name:"latin cross",slug:"latin_cross",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☦️":{name:"orthodox cross",slug:"orthodox_cross",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☪️":{name:"star and crescent",slug:"star_and_crescent",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☮️":{name:"peace symbol",slug:"peace_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕎":{name:"menorah",slug:"menorah",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔯":{name:"dotted six-pointed star",slug:"dotted_six_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪯":{name:"khanda",slug:"khanda",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"♈":{name:"Aries",slug:"aries",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♉":{name:"Taurus",slug:"taurus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♊":{name:"Gemini",slug:"gemini",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♋":{name:"Cancer",slug:"cancer",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♌":{name:"Leo",slug:"leo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♍":{name:"Virgo",slug:"virgo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♎":{name:"Libra",slug:"libra",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♏":{name:"Scorpio",slug:"scorpio",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♐":{name:"Sagittarius",slug:"sagittarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♑":{name:"Capricorn",slug:"capricorn",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♒":{name:"Aquarius",slug:"aquarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♓":{name:"Pisces",slug:"pisces",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛎":{name:"Ophiuchus",slug:"ophiuchus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔀":{name:"shuffle tracks button",slug:"shuffle_tracks_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔁":{name:"repeat button",slug:"repeat_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔂":{name:"repeat single button",slug:"repeat_single_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"▶️":{name:"play button",slug:"play_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏩":{name:"fast-forward button",slug:"fast_forward_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏭️":{name:"next track button",slug:"next_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏯️":{name:"play or pause button",slug:"play_or_pause_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"◀️":{name:"reverse button",slug:"reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏪":{name:"fast reverse button",slug:"fast_reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏮️":{name:"last track button",slug:"last_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔼":{name:"upwards button",slug:"upwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏫":{name:"fast up button",slug:"fast_up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔽":{name:"downwards button",slug:"downwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏬":{name:"fast down button",slug:"fast_down_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏸️":{name:"pause button",slug:"pause_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏹️":{name:"stop button",slug:"stop_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏺️":{name:"record button",slug:"record_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏏️":{name:"eject button",slug:"eject_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎦":{name:"cinema",slug:"cinema",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔅":{name:"dim button",slug:"dim_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔆":{name:"bright button",slug:"bright_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📶":{name:"antenna bars",slug:"antenna_bars",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛜":{name:"wireless",slug:"wireless",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"📳":{name:"vibration mode",slug:"vibration_mode",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📴":{name:"mobile phone off",slug:"mobile_phone_off",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♀️":{name:"female sign",slug:"female_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♂️":{name:"male sign",slug:"male_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"⚧️":{name:"transgender symbol",slug:"transgender_symbol",group:"Symbols",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"✖️":{name:"multiply",slug:"multiply",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➕":{name:"plus",slug:"plus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➖":{name:"minus",slug:"minus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➗":{name:"divide",slug:"divide",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟰":{name:"heavy equals sign",slug:"heavy_equals_sign",group:"Symbols",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"♾️":{name:"infinity",slug:"infinity",group:"Symbols",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"‼️":{name:"double exclamation mark",slug:"double_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⁉️":{name:"exclamation question mark",slug:"exclamation_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❓":{name:"red question mark",slug:"red_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❔":{name:"white question mark",slug:"white_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❕":{name:"white exclamation mark",slug:"white_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❗":{name:"red exclamation mark",slug:"red_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"〰️":{name:"wavy dash",slug:"wavy_dash",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💱":{name:"currency exchange",slug:"currency_exchange",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💲":{name:"heavy dollar sign",slug:"heavy_dollar_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚕️":{name:"medical symbol",slug:"medical_symbol",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♻️":{name:"recycling symbol",slug:"recycling_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚜️":{name:"fleur-de-lis",slug:"fleur_de_lis",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔱":{name:"trident emblem",slug:"trident_emblem",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📛":{name:"name badge",slug:"name_badge",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔰":{name:"Japanese symbol for beginner",slug:"japanese_symbol_for_beginner",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⭕":{name:"hollow red circle",slug:"hollow_red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✅":{name:"check mark button",slug:"check_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☑️":{name:"check box with check",slug:"check_box_with_check",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✔️":{name:"check mark",slug:"check_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❌":{name:"cross mark",slug:"cross_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❎":{name:"cross mark button",slug:"cross_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➰":{name:"curly loop",slug:"curly_loop",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➿":{name:"double curly loop",slug:"double_curly_loop",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"〽️":{name:"part alternation mark",slug:"part_alternation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✳️":{name:"eight-spoked asterisk",slug:"eight_spoked_asterisk",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✴️":{name:"eight-pointed star",slug:"eight_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❇️":{name:"sparkle",slug:"sparkle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"©️":{name:"copyright",slug:"copyright",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"®️":{name:"registered",slug:"registered",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"™️":{name:"trade mark",slug:"trade_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫟":{name:"splatter",slug:"splatter",group:"Symbols",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"#️⃣":{name:"keycap #",slug:"keycap_number_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"*️⃣":{name:"keycap *",slug:"keycap_asterisk",group:"Symbols",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"0️⃣":{name:"keycap 0",slug:"keycap_0",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"1️⃣":{name:"keycap 1",slug:"keycap_1",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"2️⃣":{name:"keycap 2",slug:"keycap_2",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"3️⃣":{name:"keycap 3",slug:"keycap_3",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"4️⃣":{name:"keycap 4",slug:"keycap_4",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"5️⃣":{name:"keycap 5",slug:"keycap_5",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"6️⃣":{name:"keycap 6",slug:"keycap_6",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"7️⃣":{name:"keycap 7",slug:"keycap_7",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"8️⃣":{name:"keycap 8",slug:"keycap_8",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"9️⃣":{name:"keycap 9",slug:"keycap_9",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔟":{name:"keycap 10",slug:"keycap_10",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔠":{name:"input latin uppercase",slug:"input_latin_uppercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔡":{name:"input latin lowercase",slug:"input_latin_lowercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔢":{name:"input numbers",slug:"input_numbers",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔣":{name:"input symbols",slug:"input_symbols",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔤":{name:"input latin letters",slug:"input_latin_letters",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅰️":{name:"A button (blood type)",slug:"a_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆎":{name:"AB button (blood type)",slug:"ab_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅱️":{name:"B button (blood type)",slug:"b_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆑":{name:"CL button",slug:"cl_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆒":{name:"COOL button",slug:"cool_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆓":{name:"FREE button",slug:"free_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"ℹ️":{name:"information",slug:"information",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆔":{name:"ID button",slug:"id_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"Ⓜ️":{name:"circled M",slug:"circled_m",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆕":{name:"NEW button",slug:"new_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆖":{name:"NG button",slug:"ng_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅾️":{name:"O button (blood type)",slug:"o_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆗":{name:"OK button",slug:"ok_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅿️":{name:"P button",slug:"p_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆘":{name:"SOS button",slug:"sos_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆙":{name:"UP! button",slug:"up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆚":{name:"VS button",slug:"vs_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈁":{name:"Japanese “here” button",slug:"japanese_here_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈂️":{name:"Japanese “service charge” button",slug:"japanese_service_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈷️":{name:"Japanese “monthly amount” button",slug:"japanese_monthly_amount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈶":{name:"Japanese “not free of charge” button",slug:"japanese_not_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈯":{name:"Japanese “reserved” button",slug:"japanese_reserved_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉐":{name:"Japanese “bargain” button",slug:"japanese_bargain_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈹":{name:"Japanese “discount” button",slug:"japanese_discount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈚":{name:"Japanese “free of charge” button",slug:"japanese_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈲":{name:"Japanese “prohibited” button",slug:"japanese_prohibited_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉑":{name:"Japanese “acceptable” button",slug:"japanese_acceptable_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈸":{name:"Japanese “application” button",slug:"japanese_application_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈴":{name:"Japanese “passing grade” button",slug:"japanese_passing_grade_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈳":{name:"Japanese “vacancy” button",slug:"japanese_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊗️":{name:"Japanese “congratulations” button",slug:"japanese_congratulations_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊙️":{name:"Japanese “secret” button",slug:"japanese_secret_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈺":{name:"Japanese “open for business” button",slug:"japanese_open_for_business_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈵":{name:"Japanese “no vacancy” button",slug:"japanese_no_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔴":{name:"red circle",slug:"red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟠":{name:"orange circle",slug:"orange_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟡":{name:"yellow circle",slug:"yellow_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟢":{name:"green circle",slug:"green_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔵":{name:"blue circle",slug:"blue_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟣":{name:"purple circle",slug:"purple_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟤":{name:"brown circle",slug:"brown_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⚫":{name:"black circle",slug:"black_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚪":{name:"white circle",slug:"white_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟥":{name:"red square",slug:"red_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟧":{name:"orange square",slug:"orange_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟨":{name:"yellow square",slug:"yellow_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟩":{name:"green square",slug:"green_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟦":{name:"blue square",slug:"blue_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟪":{name:"purple square",slug:"purple_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟫":{name:"brown square",slug:"brown_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⬛":{name:"black large square",slug:"black_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬜":{name:"white large square",slug:"white_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◼️":{name:"black medium square",slug:"black_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◻️":{name:"white medium square",slug:"white_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◾":{name:"black medium-small square",slug:"black_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◽":{name:"white medium-small square",slug:"white_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▪️":{name:"black small square",slug:"black_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▫️":{name:"white small square",slug:"white_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔶":{name:"large orange diamond",slug:"large_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔷":{name:"large blue diamond",slug:"large_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔸":{name:"small orange diamond",slug:"small_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔹":{name:"small blue diamond",slug:"small_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔺":{name:"red triangle pointed up",slug:"red_triangle_pointed_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔻":{name:"red triangle pointed down",slug:"red_triangle_pointed_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💠":{name:"diamond with a dot",slug:"diamond_with_a_dot",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔘":{name:"radio button",slug:"radio_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔳":{name:"white square button",slug:"white_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔲":{name:"black square button",slug:"black_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏁":{name:"chequered flag",slug:"chequered_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚩":{name:"triangular flag",slug:"triangular_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎌":{name:"crossed flags",slug:"crossed_flags",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏴":{name:"black flag",slug:"black_flag",group:"Flags",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏳️":{name:"white flag",slug:"white_flag",group:"Flags",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏳️‍🌈":{name:"rainbow flag",slug:"rainbow_flag",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🏳️‍⚧️":{name:"transgender flag",slug:"transgender_flag",group:"Flags",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏴‍☠️":{name:"pirate flag",slug:"pirate_flag",group:"Flags",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🇦🇨":{name:"flag Ascension Island",slug:"flag_ascension_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇩":{name:"flag Andorra",slug:"flag_andorra",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇪":{name:"flag United Arab Emirates",slug:"flag_united_arab_emirates",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇫":{name:"flag Afghanistan",slug:"flag_afghanistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇬":{name:"flag Antigua & Barbuda",slug:"flag_antigua_barbuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇮":{name:"flag Anguilla",slug:"flag_anguilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇱":{name:"flag Albania",slug:"flag_albania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇲":{name:"flag Armenia",slug:"flag_armenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇴":{name:"flag Angola",slug:"flag_angola",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇶":{name:"flag Antarctica",slug:"flag_antarctica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇷":{name:"flag Argentina",slug:"flag_argentina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇸":{name:"flag American Samoa",slug:"flag_american_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇹":{name:"flag Austria",slug:"flag_austria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇺":{name:"flag Australia",slug:"flag_australia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇼":{name:"flag Aruba",slug:"flag_aruba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇽":{name:"flag Åland Islands",slug:"flag_aland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇿":{name:"flag Azerbaijan",slug:"flag_azerbaijan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇦":{name:"flag Bosnia & Herzegovina",slug:"flag_bosnia_herzegovina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇧":{name:"flag Barbados",slug:"flag_barbados",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇩":{name:"flag Bangladesh",slug:"flag_bangladesh",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇪":{name:"flag Belgium",slug:"flag_belgium",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇫":{name:"flag Burkina Faso",slug:"flag_burkina_faso",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇬":{name:"flag Bulgaria",slug:"flag_bulgaria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇭":{name:"flag Bahrain",slug:"flag_bahrain",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇮":{name:"flag Burundi",slug:"flag_burundi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇯":{name:"flag Benin",slug:"flag_benin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇱":{name:"flag St. Barthélemy",slug:"flag_st_barthelemy",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇲":{name:"flag Bermuda",slug:"flag_bermuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇳":{name:"flag Brunei",slug:"flag_brunei",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇴":{name:"flag Bolivia",slug:"flag_bolivia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇶":{name:"flag Caribbean Netherlands",slug:"flag_caribbean_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇷":{name:"flag Brazil",slug:"flag_brazil",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇸":{name:"flag Bahamas",slug:"flag_bahamas",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇹":{name:"flag Bhutan",slug:"flag_bhutan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇻":{name:"flag Bouvet Island",slug:"flag_bouvet_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇼":{name:"flag Botswana",slug:"flag_botswana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇾":{name:"flag Belarus",slug:"flag_belarus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇿":{name:"flag Belize",slug:"flag_belize",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇦":{name:"flag Canada",slug:"flag_canada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇨":{name:"flag Cocos (Keeling) Islands",slug:"flag_cocos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇩":{name:"flag Congo - Kinshasa",slug:"flag_congo_kinshasa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇫":{name:"flag Central African Republic",slug:"flag_central_african_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇬":{name:"flag Congo - Brazzaville",slug:"flag_congo_brazzaville",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇭":{name:"flag Switzerland",slug:"flag_switzerland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇮":{name:"flag Côte d’Ivoire",slug:"flag_cote_d_ivoire",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇰":{name:"flag Cook Islands",slug:"flag_cook_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇱":{name:"flag Chile",slug:"flag_chile",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇲":{name:"flag Cameroon",slug:"flag_cameroon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇳":{name:"flag China",slug:"flag_china",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇨🇴":{name:"flag Colombia",slug:"flag_colombia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇵":{name:"flag Clipperton Island",slug:"flag_clipperton_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇶":{name:"flag Sark",slug:"flag_sark",group:"Flags",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🇨🇷":{name:"flag Costa Rica",slug:"flag_costa_rica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇺":{name:"flag Cuba",slug:"flag_cuba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇻":{name:"flag Cape Verde",slug:"flag_cape_verde",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇼":{name:"flag Curaçao",slug:"flag_curacao",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇽":{name:"flag Christmas Island",slug:"flag_christmas_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇾":{name:"flag Cyprus",slug:"flag_cyprus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇿":{name:"flag Czechia",slug:"flag_czechia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇪":{name:"flag Germany",slug:"flag_germany",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇩🇬":{name:"flag Diego Garcia",slug:"flag_diego_garcia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇯":{name:"flag Djibouti",slug:"flag_djibouti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇰":{name:"flag Denmark",slug:"flag_denmark",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇲":{name:"flag Dominica",slug:"flag_dominica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇴":{name:"flag Dominican Republic",slug:"flag_dominican_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇿":{name:"flag Algeria",slug:"flag_algeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇦":{name:"flag Ceuta & Melilla",slug:"flag_ceuta_melilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇨":{name:"flag Ecuador",slug:"flag_ecuador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇪":{name:"flag Estonia",slug:"flag_estonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇬":{name:"flag Egypt",slug:"flag_egypt",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇭":{name:"flag Western Sahara",slug:"flag_western_sahara",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇷":{name:"flag Eritrea",slug:"flag_eritrea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇸":{name:"flag Spain",slug:"flag_spain",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇪🇹":{name:"flag Ethiopia",slug:"flag_ethiopia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇺":{name:"flag European Union",slug:"flag_european_union",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇮":{name:"flag Finland",slug:"flag_finland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇯":{name:"flag Fiji",slug:"flag_fiji",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇰":{name:"flag Falkland Islands",slug:"flag_falkland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇲":{name:"flag Micronesia",slug:"flag_micronesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇴":{name:"flag Faroe Islands",slug:"flag_faroe_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇷":{name:"flag France",slug:"flag_france",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇦":{name:"flag Gabon",slug:"flag_gabon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇧":{name:"flag United Kingdom",slug:"flag_united_kingdom",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇩":{name:"flag Grenada",slug:"flag_grenada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇪":{name:"flag Georgia",slug:"flag_georgia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇫":{name:"flag French Guiana",slug:"flag_french_guiana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇬":{name:"flag Guernsey",slug:"flag_guernsey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇭":{name:"flag Ghana",slug:"flag_ghana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇮":{name:"flag Gibraltar",slug:"flag_gibraltar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇱":{name:"flag Greenland",slug:"flag_greenland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇲":{name:"flag Gambia",slug:"flag_gambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇳":{name:"flag Guinea",slug:"flag_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇵":{name:"flag Guadeloupe",slug:"flag_guadeloupe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇶":{name:"flag Equatorial Guinea",slug:"flag_equatorial_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇷":{name:"flag Greece",slug:"flag_greece",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇸":{name:"flag South Georgia & South Sandwich Islands",slug:"flag_south_georgia_south_sandwich_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇹":{name:"flag Guatemala",slug:"flag_guatemala",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇺":{name:"flag Guam",slug:"flag_guam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇼":{name:"flag Guinea-Bissau",slug:"flag_guinea_bissau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇾":{name:"flag Guyana",slug:"flag_guyana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇰":{name:"flag Hong Kong SAR China",slug:"flag_hong_kong_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇲":{name:"flag Heard & McDonald Islands",slug:"flag_heard_mcdonald_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇳":{name:"flag Honduras",slug:"flag_honduras",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇷":{name:"flag Croatia",slug:"flag_croatia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇹":{name:"flag Haiti",slug:"flag_haiti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇺":{name:"flag Hungary",slug:"flag_hungary",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇨":{name:"flag Canary Islands",slug:"flag_canary_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇩":{name:"flag Indonesia",slug:"flag_indonesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇪":{name:"flag Ireland",slug:"flag_ireland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇱":{name:"flag Israel",slug:"flag_israel",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇲":{name:"flag Isle of Man",slug:"flag_isle_of_man",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇳":{name:"flag India",slug:"flag_india",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇴":{name:"flag British Indian Ocean Territory",slug:"flag_british_indian_ocean_territory",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇶":{name:"flag Iraq",slug:"flag_iraq",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇷":{name:"flag Iran",slug:"flag_iran",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇸":{name:"flag Iceland",slug:"flag_iceland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇹":{name:"flag Italy",slug:"flag_italy",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇯🇪":{name:"flag Jersey",slug:"flag_jersey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇲":{name:"flag Jamaica",slug:"flag_jamaica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇴":{name:"flag Jordan",slug:"flag_jordan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇵":{name:"flag Japan",slug:"flag_japan",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇪":{name:"flag Kenya",slug:"flag_kenya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇬":{name:"flag Kyrgyzstan",slug:"flag_kyrgyzstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇭":{name:"flag Cambodia",slug:"flag_cambodia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇮":{name:"flag Kiribati",slug:"flag_kiribati",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇲":{name:"flag Comoros",slug:"flag_comoros",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇳":{name:"flag St. Kitts & Nevis",slug:"flag_st_kitts_nevis",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇵":{name:"flag North Korea",slug:"flag_north_korea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇷":{name:"flag South Korea",slug:"flag_south_korea",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇼":{name:"flag Kuwait",slug:"flag_kuwait",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇾":{name:"flag Cayman Islands",slug:"flag_cayman_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇿":{name:"flag Kazakhstan",slug:"flag_kazakhstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇦":{name:"flag Laos",slug:"flag_laos",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇧":{name:"flag Lebanon",slug:"flag_lebanon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇨":{name:"flag St. Lucia",slug:"flag_st_lucia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇮":{name:"flag Liechtenstein",slug:"flag_liechtenstein",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇰":{name:"flag Sri Lanka",slug:"flag_sri_lanka",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇷":{name:"flag Liberia",slug:"flag_liberia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇸":{name:"flag Lesotho",slug:"flag_lesotho",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇹":{name:"flag Lithuania",slug:"flag_lithuania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇺":{name:"flag Luxembourg",slug:"flag_luxembourg",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇻":{name:"flag Latvia",slug:"flag_latvia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇾":{name:"flag Libya",slug:"flag_libya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇦":{name:"flag Morocco",slug:"flag_morocco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇨":{name:"flag Monaco",slug:"flag_monaco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇩":{name:"flag Moldova",slug:"flag_moldova",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇪":{name:"flag Montenegro",slug:"flag_montenegro",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇫":{name:"flag St. Martin",slug:"flag_st_martin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇬":{name:"flag Madagascar",slug:"flag_madagascar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇭":{name:"flag Marshall Islands",slug:"flag_marshall_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇰":{name:"flag North Macedonia",slug:"flag_north_macedonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇱":{name:"flag Mali",slug:"flag_mali",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇲":{name:"flag Myanmar (Burma)",slug:"flag_myanmar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇳":{name:"flag Mongolia",slug:"flag_mongolia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇴":{name:"flag Macao SAR China",slug:"flag_macao_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇵":{name:"flag Northern Mariana Islands",slug:"flag_northern_mariana_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇶":{name:"flag Martinique",slug:"flag_martinique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇷":{name:"flag Mauritania",slug:"flag_mauritania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇸":{name:"flag Montserrat",slug:"flag_montserrat",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇹":{name:"flag Malta",slug:"flag_malta",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇺":{name:"flag Mauritius",slug:"flag_mauritius",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇻":{name:"flag Maldives",slug:"flag_maldives",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇼":{name:"flag Malawi",slug:"flag_malawi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇽":{name:"flag Mexico",slug:"flag_mexico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇾":{name:"flag Malaysia",slug:"flag_malaysia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇿":{name:"flag Mozambique",slug:"flag_mozambique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇦":{name:"flag Namibia",slug:"flag_namibia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇨":{name:"flag New Caledonia",slug:"flag_new_caledonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇪":{name:"flag Niger",slug:"flag_niger",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇫":{name:"flag Norfolk Island",slug:"flag_norfolk_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇬":{name:"flag Nigeria",slug:"flag_nigeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇮":{name:"flag Nicaragua",slug:"flag_nicaragua",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇱":{name:"flag Netherlands",slug:"flag_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇴":{name:"flag Norway",slug:"flag_norway",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇵":{name:"flag Nepal",slug:"flag_nepal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇷":{name:"flag Nauru",slug:"flag_nauru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇺":{name:"flag Niue",slug:"flag_niue",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇿":{name:"flag New Zealand",slug:"flag_new_zealand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇴🇲":{name:"flag Oman",slug:"flag_oman",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇦":{name:"flag Panama",slug:"flag_panama",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇪":{name:"flag Peru",slug:"flag_peru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇫":{name:"flag French Polynesia",slug:"flag_french_polynesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇬":{name:"flag Papua New Guinea",slug:"flag_papua_new_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇭":{name:"flag Philippines",slug:"flag_philippines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇰":{name:"flag Pakistan",slug:"flag_pakistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇱":{name:"flag Poland",slug:"flag_poland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇲":{name:"flag St. Pierre & Miquelon",slug:"flag_st_pierre_miquelon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇳":{name:"flag Pitcairn Islands",slug:"flag_pitcairn_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇷":{name:"flag Puerto Rico",slug:"flag_puerto_rico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇸":{name:"flag Palestinian Territories",slug:"flag_palestinian_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇹":{name:"flag Portugal",slug:"flag_portugal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇼":{name:"flag Palau",slug:"flag_palau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇾":{name:"flag Paraguay",slug:"flag_paraguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇶🇦":{name:"flag Qatar",slug:"flag_qatar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇪":{name:"flag Réunion",slug:"flag_reunion",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇴":{name:"flag Romania",slug:"flag_romania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇸":{name:"flag Serbia",slug:"flag_serbia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇺":{name:"flag Russia",slug:"flag_russia",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇷🇼":{name:"flag Rwanda",slug:"flag_rwanda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇦":{name:"flag Saudi Arabia",slug:"flag_saudi_arabia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇧":{name:"flag Solomon Islands",slug:"flag_solomon_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇨":{name:"flag Seychelles",slug:"flag_seychelles",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇩":{name:"flag Sudan",slug:"flag_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇪":{name:"flag Sweden",slug:"flag_sweden",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇬":{name:"flag Singapore",slug:"flag_singapore",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇭":{name:"flag St. Helena",slug:"flag_st_helena",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇮":{name:"flag Slovenia",slug:"flag_slovenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇯":{name:"flag Svalbard & Jan Mayen",slug:"flag_svalbard_jan_mayen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇰":{name:"flag Slovakia",slug:"flag_slovakia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇱":{name:"flag Sierra Leone",slug:"flag_sierra_leone",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇲":{name:"flag San Marino",slug:"flag_san_marino",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇳":{name:"flag Senegal",slug:"flag_senegal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇴":{name:"flag Somalia",slug:"flag_somalia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇷":{name:"flag Suriname",slug:"flag_suriname",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇸":{name:"flag South Sudan",slug:"flag_south_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇹":{name:"flag São Tomé & Príncipe",slug:"flag_sao_tome_principe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇻":{name:"flag El Salvador",slug:"flag_el_salvador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇽":{name:"flag Sint Maarten",slug:"flag_sint_maarten",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇾":{name:"flag Syria",slug:"flag_syria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇿":{name:"flag Eswatini",slug:"flag_eswatini",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇦":{name:"flag Tristan da Cunha",slug:"flag_tristan_da_cunha",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇨":{name:"flag Turks & Caicos Islands",slug:"flag_turks_caicos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇩":{name:"flag Chad",slug:"flag_chad",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇫":{name:"flag French Southern Territories",slug:"flag_french_southern_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇬":{name:"flag Togo",slug:"flag_togo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇭":{name:"flag Thailand",slug:"flag_thailand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇯":{name:"flag Tajikistan",slug:"flag_tajikistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇰":{name:"flag Tokelau",slug:"flag_tokelau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇱":{name:"flag Timor-Leste",slug:"flag_timor_leste",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇲":{name:"flag Turkmenistan",slug:"flag_turkmenistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇳":{name:"flag Tunisia",slug:"flag_tunisia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇴":{name:"flag Tonga",slug:"flag_tonga",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇷":{name:"flag Türkiye",slug:"flag_turkiye",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇹":{name:"flag Trinidad & Tobago",slug:"flag_trinidad_tobago",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇻":{name:"flag Tuvalu",slug:"flag_tuvalu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇼":{name:"flag Taiwan",slug:"flag_taiwan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇿":{name:"flag Tanzania",slug:"flag_tanzania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇦":{name:"flag Ukraine",slug:"flag_ukraine",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇬":{name:"flag Uganda",slug:"flag_uganda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇲":{name:"flag U.S. Outlying Islands",slug:"flag_u_s_outlying_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇳":{name:"flag United Nations",slug:"flag_united_nations",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🇺🇸":{name:"flag United States",slug:"flag_united_states",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇺🇾":{name:"flag Uruguay",slug:"flag_uruguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇿":{name:"flag Uzbekistan",slug:"flag_uzbekistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇦":{name:"flag Vatican City",slug:"flag_vatican_city",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇨":{name:"flag St. Vincent & Grenadines",slug:"flag_st_vincent_grenadines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇪":{name:"flag Venezuela",slug:"flag_venezuela",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇬":{name:"flag British Virgin Islands",slug:"flag_british_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇮":{name:"flag U.S. Virgin Islands",slug:"flag_u_s_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇳":{name:"flag Vietnam",slug:"flag_vietnam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇺":{name:"flag Vanuatu",slug:"flag_vanuatu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇫":{name:"flag Wallis & Futuna",slug:"flag_wallis_futuna",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇸":{name:"flag Samoa",slug:"flag_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇽🇰":{name:"flag Kosovo",slug:"flag_kosovo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇪":{name:"flag Yemen",slug:"flag_yemen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇹":{name:"flag Mayotte",slug:"flag_mayotte",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇦":{name:"flag South Africa",slug:"flag_south_africa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇲":{name:"flag Zambia",slug:"flag_zambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇼":{name:"flag Zimbabwe",slug:"flag_zimbabwe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🏴󠁧󠁢󠁥󠁮󠁧󠁿":{name:"flag England",slug:"flag_england",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁳󠁣󠁴󠁿":{name:"flag Scotland",slug:"flag_scotland",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁷󠁬󠁳󠁿":{name:"flag Wales",slug:"flag_wales",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1}};function MB(n,e){const t=n.target;x(e,V(t.value))}var NB=(n,e)=>e("recent"),AB=Me("<button>Recent</button>"),TB=(n,e,t)=>e(t()),FB=Me("<button> </button>"),LB=Me('<div class="flex border-b border-base-content/20 overflow-x-auto"><!> <!></div>'),EB=(n,e,t)=>e(i(t).emoji),$B=Me('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),DB=(n,e,t)=>e(i(t)),RB=Me('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),jB=(n,e,t)=>e(i(t).emoji),BB=Me('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),OB=Me('<div class="text-center text-base-content/60 py-8">No emojis found</div>'),zB=Me('<div class="emoji-picker fixed z-50 bg-base-100 border border-base-content/20 rounded-lg shadow-lg svelte-hsh18a"><div class="p-3 border-b border-base-content/20"><input type="text" placeholder="Search emojis..." class="input input-sm w-full bg-base-200"></div> <!> <div class="p-2 overflow-y-auto" style="height: calc(100% - 120px);"><div class="grid grid-cols-8 gap-1"><!></div> <!></div></div>');function VB(n,e){Ld(e,!0);const t=tm(),s=()=>vl(l,"$recentlyUsed",t),o=Hh();let r=pi(e,"show",15,!1),a=pi(e,"position",27,()=>V({x:0,y:0}));const l=Uw("emoji-recently-used",[]);let c=xe(""),f=xe("smileys");const d=(()=>{const P={smileys:{name:"Smileys & Emotion",emojis:[]},people:{name:"People & Body",emojis:[]},animals:{name:"Animals & Nature",emojis:[]},food:{name:"Food & Drink",emojis:[]},activities:{name:"Activities",emojis:[]},travel:{name:"Travel & Places",emojis:[]},objects:{name:"Objects",emojis:[]},symbols:{name:"Symbols",emojis:[]},flags:{name:"Flags",emojis:[]}};return Object.entries(PB).forEach(([T,N])=>{var $;if(!T||!N.name)return;const L={emoji:T,name:N.name,keywords:N.keywords||[]},O=(($=N.group)==null?void 0:$.toLowerCase())||"",D=N.name.toLowerCase();O.includes("smileys")||O.includes("emotion")||D.includes("face")||D.includes("smile")||D.includes("laugh")||D.includes("cry")?P.smileys.emojis.push(L):O.includes("people")||O.includes("body")||D.includes("hand")||D.includes("body")||D.includes("person")||D.includes("man")||D.includes("woman")?P.people.emojis.push(L):O.includes("animals")||O.includes("nature")||D.includes("animal")||D.includes("cat")||D.includes("dog")||D.includes("bird")||D.includes("plant")||D.includes("tree")?P.animals.emojis.push(L):O.includes("food")||O.includes("drink")||D.includes("food")||D.includes("fruit")||D.includes("drink")||D.includes("coffee")||D.includes("pizza")?P.food.emojis.push(L):O.includes("activities")||O.includes("sport")||D.includes("sport")||D.includes("ball")||D.includes("game")?P.activities.emojis.push(L):O.includes("travel")||O.includes("places")||D.includes("car")||D.includes("plane")||D.includes("train")||D.includes("building")?P.travel.emojis.push(L):O.includes("objects")||D.includes("phone")||D.includes("computer")||D.includes("book")||D.includes("tool")?P.objects.emojis.push(L):O.includes("flags")||D.includes("flag")?P.flags.emojis.push(L):P.symbols.emojis.push(L)}),P})(),h=At(()=>{var P;return i(c)?Object.values(d).flatMap(T=>T.emojis).filter(T=>T.emoji.includes(i(c))||T.name.toLowerCase().includes(i(c).toLowerCase())||T.keywords.some(N=>N.toLowerCase().includes(i(c).toLowerCase()))):((P=d[i(f)])==null?void 0:P.emojis)||[]});function m(P){l.update(T=>{const N=T.filter(L=>L!==P);return[P,...N].slice(0,20)}),o("select",{emoji:P}),r(!1)}function g(P){x(f,V(P)),x(c,"")}function w(P){P.target.closest(".emoji-picker")||r(!1)}Mh(()=>{if(typeof document<"u")return document.addEventListener("click",w),()=>{document.removeEventListener("click",w)}});var C=Yn(),M=tn(C);Ye(M,r,P=>{var T=zB(),N=y(T),L=y(N);mn(L),L.__input=[MB,c],_(N);var O=v(N,2);Ye(O,()=>!i(c),pe=>{var J=LB(),le=y(J);Ye(le,()=>s().length>0,he=>{var ge=AB();ge.__click=[NB,g],Ne(()=>Fi(ge,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(i(f)==="recent"?"border-primary text-primary":"border-transparent hover:text-primary")??""}`)),Y(he,ge)});var de=v(le,2);Ro(de,17,()=>Object.entries(d),fi,(he,ge)=>{let ae=()=>i(ge)[0],Ie=()=>i(ge)[1];var ce=FB();ce.__click=[TB,g,ae];var je=y(ce,!0);_(ce),Ne(()=>{Fi(ce,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(i(f)===ae()?"border-primary text-primary":"border-transparent hover:text-primary")??""}`),tt(je,Ie().name)}),Y(he,ce)}),_(J),Y(pe,J)});var D=v(O,2),$=y(D),z=y($);Ye(z,()=>i(c),pe=>{var J=Yn(),le=tn(J);Ro(le,17,()=>i(h),fi,(de,he)=>{var ge=$B();ge.__click=[EB,m,he];var ae=y(ge,!0);_(ge),Ne(()=>{Dt(ge,"title",i(he).name),tt(ae,i(he).emoji)}),Y(de,ge)}),Y(pe,J)},pe=>{var J=Yn(),le=tn(J);Ye(le,()=>i(f)==="recent"&&s().length>0,de=>{var he=Yn(),ge=tn(he);Ro(ge,1,s,fi,(ae,Ie)=>{var ce=RB();ce.__click=[DB,m,Ie];var je=y(ce,!0);_(ce),Ne(()=>{Dt(ce,"title",i(Ie)),tt(je,i(Ie))}),Y(ae,ce)}),Y(de,he)},de=>{var he=Yn(),ge=tn(he);Ro(ge,17,()=>i(h),fi,(ae,Ie)=>{var ce=BB();ce.__click=[jB,m,Ie];var je=y(ce,!0);_(ce),Ne(()=>{Dt(ce,"title",i(Ie).name),tt(je,i(Ie).emoji)}),Y(ae,ce)}),Y(de,he)},!0),Y(pe,J)}),_($);var te=v($,2);Ye(te,()=>i(c)&&i(h).length===0,pe=>{var J=OB();Y(pe,J)}),_(D),_(T),Ne(()=>{Dt(T,"style",`left: ${a().x??""}px; top: ${a().y??""}px; width: 320px; height: 400px;`),Hf(L,i(c))}),Y(P,T)}),Y(n,C),Ed()}Tp(["input","click"]);function WB(n,e){e("reset")}function HB(n,e){e("confirm")}function qB(n,e){n.target.classList.contains("modal-backdrop")&&e()}var UB=n=>n.stopPropagation(),GB=Me(`<div><input type="checkbox" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2
                       sm:w-4 sm:h-4 touch-manipulation"> <input type="number" step="0.001" min="0" max="10"> <button class="w-10 h-10 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors
                       sm:w-8 sm:h-8 touch-manipulation" title="Change color"></button> <span> </span></div>`),YB=Me(`<div class="fixed inset-0 bg-transparent flex items-center justify-center z-[9999] modal-backdrop"><div><div><h3>Fibonacci Settings</h3> <button title="Close"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 max-h-[60vh] overflow-y-auto svelte-ah2kky"><div class="space-y-3"></div></div> <div><button>🔁 Reset</button> <div class="flex gap-3 w-full sm:w-auto sm:gap-2"><button>❌ Cancel</button> <button class="px-6 py-3 text-sm rounded bg-blue-600 hover:bg-blue-700 text-white transition-colors
                   touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]">✅ Confirm</button></div></div></div></div>`),KB=Me('<div class="fixed z-[10000]"><!></div>'),XB=Me("<!> <!>",1);function ZB(n,e){Ld(e,!1);let t=pi(e,"visible",8,!1),s=pi(e,"levels",24,()=>[]),o=pi(e,"theme",8,"dark");const r=Hh();let a=vd(!1),l=vd(-1),c=vd({x:0,y:0});function f(P,T,N){r("levelChange",{index:P,field:T,value:N})}function u(P,T){x(l,T),x(c,{x:P.clientX,y:P.clientY}),x(a,!0)}function d(P){i(l)>=0&&f(i(l),"color",P.detail)}function h(P){i(l)>=0&&f(i(l),"opacity",P.detail)}function m(){x(a,!1),x(l,-1)}function g(){r("cancel")}vm(()=>th(t()),()=>{t()||(x(a,!1),x(l,-1))}),vm(()=>i(a),()=>{i(a)||x(l,-1)}),j0(),_v();var w=XB(),C=tn(w);Ye(C,t,P=>{var T=YB();T.__click=[qB,g];var N=y(T);N.__click=[UB];var L=y(N),O=y(L),D=v(O,2);D.__click=g;var $=y(D);_(D),_(L);var z=v(L,2),te=y(z);Ro(te,5,s,fi,(ge,ae,Ie)=>{var ce=GB(),je=y(ce);mn(je),je.__change=()=>f(Ie,"visible",i(ae).visible);var Ve=v(je,2);mn(Ve),Ve.__change=()=>f(Ie,"value",i(ae).value);var We=v(Ve,2);We.__click=et=>u(et,Ie);var He=v(We,2),Ue=y(He,!0);Ne(()=>tt(Ue,i(ae).value===0?"Start":i(ae).value===1?"End":`${(i(ae).value*100).toFixed(1)}%`)),_(He),_(ce),Ne(()=>{Fi(ce,`flex items-center gap-3 p-3 rounded-lg ${(o()==="dark"?"bg-[#2a2a2a]":"bg-gray-50")??""}
                        sm:gap-4 sm:p-4`),Fi(Ve,`w-24 px-3 py-2 text-sm rounded border touch-manipulation
                       sm:w-20 sm:px-2 sm:py-1
                       ${(o()==="dark"?"bg-[#3a3a3a] border-[#555] text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500")??""} 
                       focus:outline-none focus:ring-1 focus:ring-blue-500`),Dt(We,"style",`background-color: ${i(ae).color??""}`),Fi(He,`text-sm ${(o()==="dark"?"text-gray-300":"text-gray-700")??""} flex-1
                           sm:text-sm`)}),jg(je,()=>i(ae).visible,et=>(i(ae).visible=et,M6(()=>s()))),As(Ve,()=>i(ae).value,et=>(i(ae).value=et,M6(()=>s()))),Y(ge,ce)}),_(te),_(z);var pe=v(z,2),J=y(pe);J.__click=[WB,r];var le=v(J,2),de=y(le);de.__click=g;var he=v(de,2);he.__click=[HB,r],_(le),_(pe),_(N),_(T),Ne(()=>{Fi(N,`relative ${(o()==="dark"?"bg-[#1a1a1a] border-[#404040]":"bg-white border-gray-200")??""} 
             rounded-lg shadow-xl border max-w-md w-full mx-4 max-h-[80vh] overflow-hidden
             sm:max-w-lg md:max-w-xl lg:max-w-2xl svelte-ah2kky`),Fi(L,`flex items-center justify-between p-4 border-b ${(o()==="dark"?"border-[#404040]":"border-gray-200")??""}`),Fi(O,`text-lg font-semibold ${(o()==="dark"?"text-white":"text-gray-900")??""}`),Fi(D,`w-8 h-8 rounded-full ${(o()==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} 
                 flex items-center justify-center transition-colors`),ey($,`w-5 h-5 ${(o()==="dark"?"text-gray-400":"text-gray-600")??""}`),Fi(pe,`flex items-center justify-between p-4 border-t ${(o()==="dark"?"border-[#404040]":"border-gray-200")??""}
                  sm:flex-row flex-col gap-3 sm:gap-0`),Fi(J,`px-6 py-3 text-sm rounded ${(o()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                 transition-colors touch-manipulation min-h-[44px] w-full sm:w-auto
                 sm:px-4 sm:py-2 sm:min-h-[36px]`),Fi(de,`px-6 py-3 text-sm rounded ${(o()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                   transition-colors touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]`)}),Y(P,T)});var M=v(C,2);Ye(M,()=>i(a),P=>{var T=KB(),N=y(T),L=sv(()=>{var D;return((D=s()[i(l)])==null?void 0:D.color)||"#FF6B6B"}),O=sv(()=>{var D;return((D=s()[i(l)])==null?void 0:D.opacity)??15});Yv(N,{get show(){return i(a)},set show(D){x(a,D)},get selectedColor(){return i(L)},get opacity(){return i(O)},$$events:{colorChange:d,opacityChange:h,close:m},$$legacy:!0}),_(T),Ne(()=>Dt(T,"style",`left: ${i(c).x??""}px; top: ${i(c).y??""}px;`)),Y(P,T)}),Y(n,w),Ed()}Tp(["click","change"]);const l6=Fm(!1);function vv(){l6.set(!0)}function gx(){l6.set(!1)}function _x(){return mm(l6)===!0}function JB(n,e,t,s,o,r){var d,h,m;if(!i(e)||!t())return;const l=!(((h=(d=i(e))==null?void 0:d.extendData)==null?void 0:h.manualLock)===!0),c=l?!0:!!i(o),f={...i(e).extendData||{},manualLock:l};(m=t())==null||m.overrideOverlay({id:i(e).id,lock:c,extendData:f});const u={...i(e),lock:c,extendData:f};x(e,V(u)),r(u)}function QB(n,e,t){i(e).fontWeight=i(e).fontWeight==="bold"?"normal":"bold",t()}function eO(n,e){e(n)}function tO(n,e,t,s,o,r,a){n.stopPropagation();const l=n.target.getBoundingClientRect();x(e,"line"),x(t,V(s.color)),x(o,V(s.opacity)),x(r,V({x:Math.max(10,Math.min(l.left,window.innerWidth-320)),y:Math.max(10,Math.min(l.bottom+5,window.innerHeight-400))})),x(a,!0)}function nO(n,e,t,s,o,r,a){x(e,"textColor"),x(t,V(i(s).textColor)),x(o,V(i(r))),x(a,!0)}function sO(n,e,t,s,o,r,a){x(e,"textBg"),x(t,V(i(s).backgroundColor)),x(o,V(i(r))),x(a,!0)}function oO(n,e){n.preventDefault(),n.stopPropagation(),e()}var iO=Me('<div class="pro-active-indicator absolute bottom-[3px] left-1/2 transform -translate-x-1/2 w-[4px] h-[4px] rounded-full svelte-ue8k6c" style="background: var(--menu-accent);"></div>'),rO=(n,e,t)=>e(i(t)),aO=Me('<div class="submenu-portal svelte-ue8k6c"></div>'),lO=Me(`<div class="pro-submenu-arrow flex items-center justify-center absolute top-1/2 right-0 transform -translate-y-1/2
               w-5 h-5 opacity-0 group-hover:opacity-100 hover:opacity-100 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1)
               bg-[var(--menu-btn-bg)] border border-[var(--menu-btn-border)] rounded-full
               hover:bg-[var(--menu-hover-bg)] hover:border-[var(--menu-btn-hover-border)] cursor-pointer z-20 svelte-ue8k6c" style="box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><svg class="w-2.5 h-2.5 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1) text-[var(--menu-text)] svelte-ue8k6c" viewBox="0 0 8 12" fill="currentColor"><path d="M1.705 0.295C1.315 -0.095 0.685 -0.095 0.295 0.295C-0.095 0.685 -0.095 1.315 0.295 1.705L5.59 7L0.295 12.295C-0.095 12.685 -0.095 13.315 0.295 13.705C0.685 14.095 1.315 14.095 1.705 13.705L7.705 7.705C8.095 7.315 8.095 6.685 7.705 6.295L1.705 0.295Z" class="svelte-ue8k6c"></path></svg></div> <!>`,1),cO=Me(`<div class="group flex flex-row items-center justify-center relative w-full mt-2 cursor-pointer transition-all duration-200 ease-out svelte-ue8k6c"><div class="pro-draw-button w-[36px] h-[36px] rounded-[8px] flex items-center justify-center relative overflow-hidden transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)
             isolation-isolate svelte-ue8k6c" style="background: var(--menu-btn-bg); border: 1px solid var(--menu-btn-border); backdrop-filter: blur(16px) saturate(160%); -webkit-backdrop-filter: blur(16px) saturate(160%);"><div class="button-hover-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-[8px] svelte-ue8k6c" style="background: var(--menu-hover-bg);"></div> <!> <!></div> <!></div>`),uO=Me('<div class="w-full h-[2px] mt-3 mb-2 opacity-90 svelte-ue8k6c" style="background: linear-gradient(to right, transparent, var(--menu-accent), transparent); box-shadow: 0 0 10px var(--menu-glow);"></div>'),dO=n=>n.stopPropagation(),fO=Me("<!> <!>",1),pO=n=>n.preventDefault(),mO=Me('<button class="drawbar-scroll-arrow svelte-ue8k6c" title="Scroll to see more tools" aria-label="Scroll down" type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-ue8k6c"><polyline points="6 9 12 15 18 9"></polyline></svg></button>'),hO=(n,e,t,s,o,r)=>i(e)==="mode"?t(i(s).key):o(r.findIndex(a=>a.key===i(e)),i(s).key),vO=Me(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                   text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-ue8k6c"><!> <span class="text-sm font-medium"> </span></li>`),gO=Me(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
                bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-ue8k6c"></ul>`),_O=(n,e,t)=>e(i(t).key),yO=Me(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                 text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-ue8k6c"><!> <span class="text-sm font-medium"> </span></li>`),bO=Me(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
              bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-ue8k6c"></ul>`),xO=Me("<!> <!>",1),wO=n=>n.stopPropagation(),kO=Me("<option> </option>"),SO=Me(`<select title="Font size"><option>8</option><option>10</option><option>11</option><option>12</option><option>14</option><option>16</option><option>18</option><option>20</option><option>22</option><option>24</option><option>32</option><option>40</option><option>52</option></select> <button title="Bold"><span class="text-xs font-bold">B</span></button> <div class="flex items-center gap-1 svelte-ue8k6c"><div class="flex items-center gap-1"><button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-ue8k6c" title="Text color"><!></button> <button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-ue8k6c" title="Background color"><!></button></div> <select title="Font family"></select></div>`,1),CO=Me(`<button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                 cursor-pointer hover:scale-105 transition-transform touch-manipulation svelte-ue8k6c" title="Choose color"></button> <select title="Line thickness"><option>1px</option><option>2px</option><option>3px</option><option>4px</option><option>5px</option><option>6px</option><option>7px</option><option>8px</option></select> <select title="Line style"><option>Line</option><option>Dash</option><option>Dot</option></select>`,1),IO=Me('<div title="Drag to move"><div class="flex flex-col gap-0.5"><div class="flex gap-0.5"><div></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div></div></div> <!>',1),PO=(n,e)=>{var t;return e(((t=n.target)==null?void 0:t.value)||"24")},MO=Me('<div class="flex items-center gap-3 svelte-ue8k6c"><div class="flex items-center justify-center w-8 h-8 text-lg"> </div> <div class="flex items-center gap-1 sm:gap-2 min-w-[100px] sm:min-w-[120px]"><span class="text-xs text-gray-500 dark:text-gray-400 hidden sm:inline">Size:</span> <input type="range" min="16" max="64" class="flex-1 h-2 sm:h-1 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer slider touch-manipulation svelte-ue8k6c"> <span class="text-xs text-gray-500 dark:text-gray-400 w-6 text-right"> </span></div></div>'),NO=(n,e)=>{e()},AO=Me('<button title="Fibonacci Settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>'),TO=(n,e)=>x(e,!i(e)),FO=n=>n.stopPropagation(),LO=(n,e,t)=>{e(),x(t,!1)},EO=(n,e,t)=>{e(),x(t,!1)},$O=(n,e,t)=>{e(),x(t,!1)},DO=Me("<button>Paste</button>"),RO=Me("<div><button>Clone</button> <button>Copy</button> <!></div>"),jO=(n,e,t,s)=>{e(),x(t,!1),x(s,null)},BO=Me('<div><!> <!> <button><!></button> <div class="relative svelte-ue8k6c"><button title="More" aria-haspopup="true"><svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="12" cy="19" r="2"></circle></svg></button> <!></div> <button title="Delete"><svg fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),OO=Me('<div class="fixed z-[200001] bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer shadow-lg transition-all duration-200" title="Delete selected drawing"><svg class="w-4 h-4" fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></div>'),zO=Me('<div class="drawbar-wrapper svelte-ue8k6c"><div class="drawbar-container h-full box-border border-r border-l-0 transition-all duration-200 ease-in-out overflow-y-auto scrollbar-hidden svelte-ue8k6c" style="background: var(--menu-bg); box-shadow: var(--menu-shadow); border-left: none;"><!> <!> <!> <!> <!> <!> <!> <!></div> <!></div> <!> <!> <!> <!>  <!> <!>',1);function VO(n,e){Ld(e,!0);const t=tm(),s=()=>vl(Yt,"$chart",t),o=()=>vl(It,"$save",t),r=()=>vl(jl,"$undoRedoState",t),a=(E,I=m_,W=m_,Z,_e,me,Le)=>{let ye=sv(()=>sb(Z==null?void 0:Z(),"")),Se=sv(()=>sb(_e==null?void 0:_e(),()=>[],!0)),Ge=sv(()=>sb(me==null?void 0:me(),!1)),Ae=sv(()=>sb(Le==null?void 0:Le(),!1));var Rt=cO(),nn=y(Rt);nn.__click=function(...Mi){var Kn;(Kn=I())==null||Kn.apply(this,Mi)};var Xn=v(y(nn),2),hn=At(()=>Gi(W())),is=At(()=>i(ye)==="mode"&&i(u)===i(f)||i(ye)==="lock"&&i(d));Kv(Xn,{get name(){return i(hn)},get active(){return i(is)},size:24,class:"relative z-10 transition-all duration-200 group-hover:scale-[1.05]"});var Gs=v(Xn,2);Ye(Gs,()=>i(ye)==="mode"&&i(u)===i(f)||i(ye)==="lock"&&i(d)||i(ye)&&i(ye)===i(c),Mi=>{var Kn=iO();Y(Mi,Kn)}),_(nn);var es=v(nn,2);Ye(es,()=>i(Se).length>0,Mi=>{var Kn=lO(),Es=tn(Kn);Es.__click=[rO,If,ye];var Qo=y(Es);_(Es);var sr=v(Es,2);Ye(sr,()=>i(ye)===i(c),na=>{var Xr=aO();Y(na,Xr)}),Ne(()=>rr(Qo,"rotate-180",i(c)===i(ye))),Y(Mi,Kn)}),_(Rt),Ne(()=>{Dt(Rt,"style",`margin-top: ${(i(Ge)||i(Ae)?"12px":"")??""}`),Dt(nn,"title",i(ye)||W()),Dt(nn,"aria-label",i(ye)||W()),rr(nn,"active-btn",i(ye)==="mode"&&i(u)===i(f)||i(ye)==="lock"&&i(d)||i(ye)&&i(ye)===i(c))}),Y(E,Rt)},l=E=>{var I=uO();Y(E,I)};let c=xe(""),f=xe("weakMagnet"),u=xe("normal"),d=xe(!1),h=xe(!0),m=V([]),g=xe(""),w=xe(null),C=xe(null),M=xe(!1),P=xe(!1),T=xe(null),N=V({thickness:"1",style:"solid",color:"#1677FF",opacity:100}),L=xe(!1),O=V({x:0,y:0}),D=xe(null),$=xe(0),z=xe(null),te=xe(!1),pe=xe(!1);const J="__SMARTCHART_OVERLAY__:";let le=xe(null),de=0,he=xe(!1),ge=xe("line"),ae=xe("#1677FF"),Ie=xe(100),ce=xe(!1),je=xe(V({x:0,y:0})),Ve=xe(V({x:0,y:0}));const We="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif";let He=xe(V({fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",backgroundColor:"#A00000",fontFamily:We})),Ue=xe(100),et=xe(20),ft=xe(!1),it=xe(void 0);function Lt(E){const I=E.replace("#",""),W=parseInt(I.slice(0,2),16),Z=parseInt(I.slice(2,4),16),_e=parseInt(I.slice(4,6),16);return{r:W,g:Z,b:_e}}function Tt(E){if(!E||typeof E!="string"||!E.startsWith("#"))return"#000000";const I=E.length===9?E.slice(0,7):E,{r:W,g:Z,b:_e}=Lt(I);return .2126*W+.7152*Z+.0722*_e>128?"#000000":"#FFFFFF"}const Pt=[{label:"System",value:We},{label:"Arial",value:"Arial, Helvetica, sans-serif"},{label:"Helvetica",value:"'Helvetica Neue', Arial, sans-serif"},{label:"Segoe UI",value:"'Segoe UI', Tahoma, Geneva, sans-serif"},{label:"Roboto",value:"Roboto, system-ui, -apple-system, 'Segoe UI', Arial, sans-serif"},{label:"Times New Roman",value:"'Times New Roman', Times, serif"},{label:"Georgia",value:"Georgia, 'Times New Roman', serif"},{label:"Garamond",value:"Garamond, 'Times New Roman', serif"},{label:"Palatino",value:"'Palatino Linotype', 'Book Antiqua', Palatino, serif"},{label:"Verdana",value:"Verdana, Geneva, sans-serif"},{label:"Tahoma",value:"Tahoma, Geneva, sans-serif"},{label:"Trebuchet MS",value:"'Trebuchet MS', 'Lucida Grande', sans-serif"},{label:"Impact",value:"Impact, Charcoal, sans-serif"},{label:"Lucida Sans",value:"'Lucida Sans Unicode', 'Lucida Grande', sans-serif"},{label:"Century Gothic",value:"'Century Gothic', AppleGothic, sans-serif"},{label:"Optima",value:"Optima, 'Segoe', 'Segoe UI', sans-serif"},{label:"Comic Sans MS",value:"'Comic Sans MS', 'Comic Sans', cursive, sans-serif"},{label:"Avenir",value:"'Avenir Next', Avenir, sans-serif"},{label:"Futura",value:"Futura, 'Trebuchet MS', Arial, sans-serif"},{label:"Menlo",value:"Menlo, Monaco, Consolas, 'Courier New', monospace"},{label:"Consolas",value:"Consolas, 'Liberation Mono', Menlo, Monaco, monospace"},{label:"Courier New",value:"'Courier New', Courier, monospace"}];let St=null;function st(){var W;St||(St=document.querySelector(".chart-container")||document.querySelector("[data-chart-container]")||document.querySelector(".duty-chart")||document.querySelector("#chart")||((W=document.querySelector("canvas"))==null?void 0:W.parentElement)||document.body);const E=St==null?void 0:St.getBoundingClientRect();if(!E||E.width<60||E.height<60)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};const I=10;return{left:E.left+I,top:E.top+I,width:E.width-I*2,height:E.height-I*2}}function xt(){const E=typeof window<"u"&&window.innerWidth<=768,I=E?Math.min(300,window.innerWidth-40):300;return{isMobile:E,width:I,height:E?48:60}}function Je(E){if(!E||typeof window>"u")return null;const{isMobile:I,width:W,height:Z}=xt(),_e=st(),me=_e.left+(I?4:8),Le=_e.top+(I?4:8),ye=_e.left+_e.width-W-(I?4:8),Se=_e.top+_e.height-Z-(I?4:8),Ge=Number(E.x),Ae=Number(E.y);return!Number.isFinite(Ge)||!Number.isFinite(Ae)?null:{x:Math.max(me,Math.min(Ge,ye)),y:Math.max(Le,Math.min(Ae,Se))}}function Xe(E){const I=Qe(E);return Je(i(le))||I}function Be(E){try{const I=st();St&&(St.style.cursor=E??"default")}catch{}}function Qe(E){var Uu,xd,ul,dr,Fu;if(!E||!E.points||E.points.length===0||!s())return null;const I=E.points[0],W=E.paneId||"candle_pane",Z=(Uu=s())==null?void 0:Uu.convertToPixel(I,{paneId:W}),_e=(St||document.body).getBoundingClientRect();if(!Z||typeof Z.x!="number"||typeof Z.y!="number"||!_e)return null;const me=st(),Le=window.innerWidth<=768,ye=Le?Math.min(300,window.innerWidth-40):300,Se=Le?48:60,Ge=Le?32:24,Ae=(xd=E.extendData)!=null&&xd.editing?A0.getEditorRect():null,Rt=Ae?Ae.width:((ul=E.extendData)==null?void 0:ul.boxWidth)??160,nn=Ae?Ae.height:((dr=E.extendData)==null?void 0:dr.boxHeight)??Math.round((((Fu=E.extendData)==null?void 0:Fu.fontSize)??32)*1.4)+8,Xn=Z.x-Rt/2,hn=Z.x+Rt/2,is=Z.y-Math.round(nn/2),Gs=Ae?Ae.left:_e.left+Xn,es=Ae?Ae.right:_e.left+hn,Mi=Ae?Ae.top:_e.top+is,Kn=Ae?Ae.bottom:Mi+nn;let Es=[{x:es+Ge,y:Mi},{x:Gs,y:Kn+Ge},{x:Gs-ye-Ge,y:Mi},{x:Gs,y:Mi-Se-Ge}];Le&&(Es=[{x:Gs,y:Kn+Ge},{x:Gs,y:Mi-Se-Ge},{x:es+Ge,y:Mi},{x:Gs-ye-Ge,y:Mi}]);const Qo=_e.left+(Le?4:8),sr=_e.top+(Le?4:8),na=_e.left+me.width-ye-(Le?4:8),Xr=_e.top+me.height-Se-(Le?4:8);for(const gi of Es){let Dr=Math.max(Qo,Math.min(gi.x,na)),Yi=Math.max(sr,Math.min(gi.y,Xr));const Ki=Yi<Kn&&Yi+Se>Mi,Xi=Dr<es&&Dr+ye>Gs;if(!(Ki&&Xi))return{x:Dr,y:Yi}}if(Le){let gi=Math.max(Qo,Math.min(Gs,na)),Dr=Math.max(sr,Math.min(Kn+Ge,Xr));return{x:gi,y:Dr}}else{let gi=Math.max(Qo,Math.min(es+Ge,na)),Dr=Math.max(sr,Math.min(Mi,Xr));return{x:gi,y:Dr}}}function ct(E){function I(Z){const _e=E.scrollTop>0,me=E.scrollTop<E.scrollHeight-E.clientHeight;(Z.deltaY<0&&!_e||Z.deltaY>0&&!me)&&Z.preventDefault(),Z.stopPropagation()}function W(Z){Z.preventDefault(),Z.stopPropagation()}return E.addEventListener("wheel",I,{passive:!1,capture:!0}),E.addEventListener("touchmove",W,{passive:!1,capture:!0}),{destroy(){E.removeEventListener("wheel",I,{capture:!0}),E.removeEventListener("touchmove",W,{capture:!0})}}}function Mt(){var E,I;if(i(P)&&i(T)&&i(D)&&!(i(T).name==="text"&&((E=i(T).extendData)!=null&&E.editing))&&i(T).points&&i(T).points.length>0){const W=i(T).points[0],Z=(I=s())==null?void 0:I.convertToPixel(W,{paneId:"candle_pane"});if(Z&&typeof Z=="object"&&"x"in Z&&"y"in Z&&Z.x!==void 0&&Z.y!==void 0){const Le=Math.max(10,Math.min(Z.x-80,window.innerWidth-300)),ye=Math.max(10,Math.min(Z.y-30,window.innerHeight-200));x(D,V({x:Le,y:ye}))}}i(he)&&x(Ve,V({x:Math.max(10,Math.min(i(Ve).x,window.innerWidth-320)),y:Math.max(10,Math.min(i(Ve).y,window.innerHeight-400))}))}function mt(){if(typeof localStorage<"u"){const E=localStorage.getItem("contextMenuPosition");if(E)try{x(le,V(JSON.parse(E)))}catch(I){console.log("Error loading saved position:",I)}}}function Ce(E){typeof localStorage<"u"&&(localStorage.setItem("contextMenuPosition",JSON.stringify(E)),x(le,V(E)))}const Te="drawing_tools",It=cd("save"),$t=cd("ctx"),Yt=cd("chart"),qn=Fm({}),Vn=cd("drawingManager"),Dn=15,Wn="smartchart.drawingDefaults",pn="smartchart.fibonacciLevels",gn={thickness:"1",style:"solid",color:"#1677FF",opacity:100},Qs={rect:{opacity:10},triangle:{opacity:10},parallelogram:{opacity:10},gannBox:{opacity:10},xabcd:{opacity:10}},Is={fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",textOpacity:100,backgroundColor:"#A00000",backgroundOpacity:20,fontFamily:We},Cs=[{value:0,visible:!0,color:"#FF6B6B",opacity:Dn},{value:.236,visible:!0,color:"#4ECDC4",opacity:Dn},{value:.382,visible:!0,color:"#45B7D1",opacity:Dn},{value:.5,visible:!0,color:"#96CEB4",opacity:Dn},{value:.618,visible:!0,color:"#FFEAA7",opacity:Dn},{value:1,visible:!0,color:"#98D8C8",opacity:Dn},{value:1.618,visible:!0,color:"#85C1E9",opacity:Dn},{value:.786,visible:!1,color:"#DDA0DD",opacity:Dn},{value:1.272,visible:!1,color:"#F7DC6F",opacity:Dn},{value:1.414,visible:!1,color:"#BB8FCE",opacity:Dn},{value:2,visible:!1,color:"#FFB6C1",opacity:Dn},{value:2.272,visible:!1,color:"#98FB98",opacity:Dn},{value:2.414,visible:!1,color:"#F0E68C",opacity:Dn},{value:2.618,visible:!1,color:"#F8C471",opacity:Dn},{value:3,visible:!1,color:"#DEB887",opacity:Dn},{value:3.618,visible:!1,color:"#CD853F",opacity:Dn},{value:4,visible:!1,color:"#D2691E",opacity:Dn},{value:4.236,visible:!1,color:"#A0522D",opacity:Dn},{value:4.272,visible:!1,color:"#8B4513",opacity:Dn},{value:4.618,visible:!1,color:"#654321",opacity:Dn}];function ro(E){return E.map(I=>({...I}))}function bs(E){if(!Array.isArray(E))return ro(Cs);const I=E.map((W,Z)=>{const _e=Cs[Z]||Cs[Cs.length-1],me=typeof(W==null?void 0:W.value)=="number"?W.value:_e.value,Le=typeof(W==null?void 0:W.visible)=="boolean"?W.visible:_e.visible,ye=typeof(W==null?void 0:W.color)=="string"?W.color:_e.color,Se=typeof(W==null?void 0:W.opacity)=="number"?W.opacity:_e.opacity,Ge=Math.max(0,Math.min(100,Se??Dn));return{value:me,visible:Le,color:ye,opacity:Ge}});return I.length?I:ro(Cs)}function zt(){if(typeof localStorage>"u")return Wn;const E=Og();return E?`${Wn}.${E}`:Wn}function Qt(){if(typeof localStorage>"u")return null;try{const E=localStorage.getItem(zt());if(E)return JSON.parse(E);const I=localStorage.getItem(ri());if(I){const Z={fibonacciLevels:JSON.parse(I)};return ho(Z),Z}return null}catch{return null}}function ho(E){if(!(typeof localStorage>"u"))try{localStorage.setItem(zt(),JSON.stringify(E))}catch{}}function ri(){if(typeof localStorage>"u")return pn;const E=Og();return E?`${pn}.${E}`:pn}function jo(E){const I=(E||"").trim();if(!I)return null;if(/^#([0-9a-f]{8})$/i.test(I))return{r:parseInt(I.slice(1,3),16),g:parseInt(I.slice(3,5),16),b:parseInt(I.slice(5,7),16),a:parseInt(I.slice(7,9),16)/255};if(/^#([0-9a-f]{6})$/i.test(I))return{r:parseInt(I.slice(1,3),16),g:parseInt(I.slice(3,5),16),b:parseInt(I.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(I)){const Z=I[1],_e=I[2],me=I[3];return{r:parseInt(Z+Z,16),g:parseInt(_e+_e,16),b:parseInt(me+me,16)}}const W=I.match(/^rgba?\(([^)]+)\)$/i);if(W){const Z=W[1].split(",").map(_e=>parseFloat(_e.trim()));if(Z.length>=3&&Z.every(_e=>!Number.isNaN(_e)))return{r:Math.round(Z[0]),g:Math.round(Z[1]),b:Math.round(Z[2]),a:Z.length>=4?Math.max(0,Math.min(1,Z[3])):void 0}}return null}function Na(E){const I=W=>Math.max(0,Math.min(255,Math.round(W))).toString(16).padStart(2,"0");return`#${I(E.r)}${I(E.g)}${I(E.b)}`}function ar(E,I){const W=jo(E);return W?Na(W):I}function Aa(E,I,W){const Z=jo(E)||jo(W);if(!Z)return W;const _e=Math.max(0,Math.min(100,I))/100;return`rgba(${Z.r}, ${Z.g}, ${Z.b}, ${_e})`}function nr(E){const I=(E==null?void 0:E.style)==="dashed"||(E==null?void 0:E.style)==="dotted"?E.style:"solid",W=typeof(E==null?void 0:E.opacity)=="number"?Math.max(0,Math.min(100,E.opacity)):gn.opacity,Z=(E==null?void 0:E.thickness)??gn.thickness,_e=String(Z),me=ar((E==null?void 0:E.color)||gn.color,gn.color);return{thickness:_e,style:I,color:me,opacity:W}}function hi(E){return E.thickness===gn.thickness&&E.style===gn.style&&E.opacity===gn.opacity&&E.color.toLowerCase()===gn.color.toLowerCase()}function Gc(E){return{fontSize:String((E==null?void 0:E.fontSize)??Is.fontSize),fontWeight:(E==null?void 0:E.fontWeight)==="normal"?"normal":Is.fontWeight,textColor:ar((E==null?void 0:E.textColor)||Is.textColor,Is.textColor),textOpacity:typeof(E==null?void 0:E.textOpacity)=="number"?Math.max(0,Math.min(100,E.textOpacity)):Is.textOpacity,backgroundColor:ar((E==null?void 0:E.backgroundColor)||Is.backgroundColor,Is.backgroundColor),backgroundOpacity:typeof(E==null?void 0:E.backgroundOpacity)=="number"?Math.max(0,Math.min(100,E.backgroundOpacity)):Is.backgroundOpacity,fontFamily:String((E==null?void 0:E.fontFamily)||Is.fontFamily)}}function Pu(E){x(He,V({fontSize:E.fontSize,fontWeight:E.fontWeight,textColor:E.textColor,backgroundColor:E.backgroundColor,fontFamily:E.fontFamily})),x(Ue,V(E.textOpacity)),x(et,V(E.backgroundOpacity))}function wc(E){var I;return((I=E==null?void 0:E.extendData)==null?void 0:I.origin)==="user"||(E==null?void 0:E.groupId)===Te}function cc(){return wn.get(o().options,"drawingDefaults")||{}}function ou(E,I){return{lineByTool:{...I.lineByTool||{},...E.lineByTool||{}},text:E.text||I.text,fibonacciLevels:E.fibonacciLevels||I.fibonacciLevels}}function zu(){const E=cc(),I=Qt()||{};return ou(E,I)}function ja(E,I){const W=nr(I);It.update(me=>{me.options||(me.options={}),me.options.drawingDefaults||(me.options.drawingDefaults={});const Le=me.options.drawingDefaults;return Le.lineByTool||(Le.lineByTool={}),Le.lineByTool[E]=W,me});const Z=Qt()||{},_e={...Z,lineByTool:{...Z.lineByTool||{},[E]:W}};ho(_e),vv()}function nc(E){var _e;const W=(_e=zu().lineByTool)==null?void 0:_e[E],Z=Qs[E];if(W){const me=nr(W);return Z&&hi(me)?nr({...gn,...Z}):me}return nr(Z?{...gn,...Z}:gn)}function Bc(E){const I=Gc(E);It.update(_e=>(_e.options||(_e.options={}),_e.options.drawingDefaults||(_e.options.drawingDefaults={}),_e.options.drawingDefaults.text=I,_e));const Z={...Qt()||{},text:I};ho(Z),vv()}function Vu(){const E=zu();return Gc(E.text)}function rf(E){if(!E)return{color:gn.color,opacity:gn.opacity};const I=E.trim();if(/^#([0-9a-f]{8})$/i.test(I)){const Z=`#${I.slice(1,7)}`,_e=parseInt(I.slice(7,9),16),me=Math.round(_e/255*100);return{color:Z,opacity:me}}const W=jo(I);if(W){const Z=typeof W.a=="number"?Math.round(W.a*100):100;return{color:Na(W),opacity:Z}}return{color:gn.color,opacity:gn.opacity}}function co(E){var Z;const I=(Z=E==null?void 0:E.styles)==null?void 0:Z.line;if(!I)return;const W=rf(I.color||gn.color);if(N.thickness=String(I.size||gn.thickness),N.color=W.color,N.opacity=W.opacity,I.style===vt.Dashed){const _e=I.dashedValue;_e&&_e[0]===2&&(_e[1]===6||_e[1]===8)?N.style="dotted":N.style="dashed"}else N.style="solid"}function ll(){const E=wn.get(o().options,"drawingDefaults.fibonacciLevels");if(E)return bs(E);const I=Qt();return I!=null&&I.fibonacciLevels?bs(I.fibonacciLevels):ro(Cs)}function va(E){It.update(Z=>(Z.options||(Z.options={}),Z.options.drawingDefaults||(Z.options.drawingDefaults={}),Z.options.drawingDefaults.fibonacciLevels=ro(E),Z));const W={...Qt()||{},fibonacciLevels:ro(E)};ho(W),vv()}let Vl=xe(!1),kr=xe(V(ll())),Wr=xe(V(ro(i(kr))));const jl=Np.getState();let Xl=xe(!1),Mu=xe(!1);wr(()=>{const E=r();x(Xl,E.undoStack.length>0),x(Mu,E.redoStack.length>0)}),wr(()=>{s()&&Np.init({chart:s(),saveStore:It,overlaysStore:qn})});let Zu=!1;wr(()=>{s()&&!Zu&&(Zu=!0,setTimeout(()=>{js()},0))});function xo(E){const I=o().symbol;return`${I.shortName??I.name??I.ticker}_${o().period.timeframe}_${E}`}let Sr={};const sc=V([{key:"single-line",icon:"segment",list:[{key:"segment",text:"segment"},{key:"arrow",text:"arrow"},{key:"rayLine",text:"ray_line"},{key:"straightLine",text:"straight_line"},{key:"priceLine",text:"price_line"},{key:"horizontalStraightLine",text:"horizontal_straight_line"},{key:"horizontalRayLine",text:"horizontal_ray_line"},{key:"horizontalSegment",text:"horizontal_segment"},{key:"verticalStraightLine",text:"vertical_straight_line"},{key:"verticalRayLine",text:"vertical_ray_line"},{key:"verticalSegment",text:"vertical_segment"}]},{key:"more-line",icon:"priceChannelLine",list:[{key:"priceChannelLine",text:"price_channel_line"},{key:"parallelStraightLine",text:"parallel_straight_line"}]},{key:"polygon",icon:"rect",list:[{key:"circle",text:"circle"},{key:"rect",text:"rect"},{key:"parallelogram",text:"parallelogram"},{key:"triangle",text:"triangle"}]},{key:"fibonacci",icon:"fibonacciSegment",list:[{key:"fibonacciSegment",text:"fibonacci_segment"},{key:"fibonacciCircle",text:"fibonacci_circle"},{key:"fibonacciSpiral",text:"fibonacci_spiral"},{key:"fibonacciSpeedResistanceFan",text:"fibonacci_speed_resistance_fan"},{key:"fibonacciExtension",text:"fibonacci_extension"},{key:"gannBox",text:"gann_box"}]},{key:"wave",icon:"xabcd",list:[{key:"xabcd",text:"xabcd"},{key:"abcd",text:"abcd"},{key:"threeWaves",text:"three_waves"},{key:"fiveWaves",text:"five_waves"},{key:"eightWaves",text:"eight_waves"},{key:"anyWaves",text:"any_waves"}]},{key:"emoji",icon:"emoji",list:[]},{key:"text",icon:"text",list:[]}]),yd=V([{key:"weakMagnet",text:"weakMagnet"},{key:"strongMagnet",text:"strongMagnet"}]);function If(E){i(c)==E?x(c,""):x(c,V(E))}function En(E){if(!s()||!(E!=null&&E.id))return E;try{const I=s().getOverlays({id:E.id});if(I&&I[0])return I[0]}catch{}return E}function ms(E,I={}){const W=E?$1[E]??{}:{};let Z=!1;const _e={onMouseEnter:me=>{var Le;W.onMouseEnter&&W.onMouseEnter(me);try{window.__overlayHover=!0,window.__overlayHoverId=((Le=me.overlay)==null?void 0:Le.id)??null}catch{}return Be("pointer"),!0},onMouseLeave:me=>{W.onMouseLeave&&W.onMouseLeave(me);try{window.__overlayHover=!1,window.__overlayHoverId=null}catch{}return Be(null),!0},onRightClick:me=>{var Le;W.onRightClick&&W.onRightClick(me);try{const ye=((Le=me.overlay)==null?void 0:Le.id)??null;window.__overlayHover=!0,window.__overlayHoverId=ye,window.__overlayRightClickId=ye,window.__overlayRightClickAt=Date.now()}catch{}return!0},onDoubleClick:me=>(W.onDoubleClick&&W.onDoubleClick(me),!0),onPressedMoving:me=>{var Le;W.onPressedMoving&&W.onPressedMoving(me),Z=!0;try{if(s()&&((Le=me.overlay)!=null&&Le.id)&&!Sr[me.overlay.id]){const ye=s().getOverlays({id:me.overlay.id});ye&&ye[0]&&(Sr[me.overlay.id]=JSON.parse(JSON.stringify(ye[0])))}}catch{}return!1},onPressedMoveEnd:me=>{var Le;if(!Z)return!0;Z=!1,zc(me.overlay);try{const ye=Sr[me.overlay.id],Se=me.overlay;if(ye&&Se){const Ge=xo(me.overlay.id);Np.recordModifyOverlay(me.overlay.id,ye,Se,Ge)}}catch{}if(delete Sr[me.overlay.id],i(g)===me.overlay.id&&me.overlay.points&&me.overlay.points.length>0){const ye=me.overlay.points[0],Se=me.overlay.paneId||"candle_pane",Ge=(Le=s())==null?void 0:Le.convertToPixel(ye,{paneId:Se});Ge&&typeof Ge=="object"&&"x"in Ge&&"y"in Ge&&Ge.x!==void 0&&Ge.y!==void 0&&x(C,V({x:Ge.x-80,y:Ge.y-30}))}return!0},onSelected:me=>{W.onSelected&&W.onSelected(me),de=Date.now();const Le=En(me.overlay);if(x(g,V(Le.id)),x(T,V(Le)),co(Le),(Le==null?void 0:Le.name)==="text"&&Il(Le),Le.points&&Le.points.length>0){const ye=Xe(Le);ye&&(x(D,V({...ye})),x(C,V({x:ye.x,y:ye.y})),x(P,!0),x(M,!1),co(Le))}return!0},onDeselected:me=>{var Le,ye;W.onDeselected&&W.onDeselected(me);try{s()&&((Le=me.overlay)!=null&&Le.id)&&s().overrideOverlay({id:me.overlay.id,selected:!1,extendData:{...(ye=me.overlay)==null?void 0:ye.extendData,selected:!1,editing:!1}})}catch{}return x(g,""),x(M,!1),x(P,!1),x(pe,!1),x(C,null),x(T,null),!0},onRemoved:me=>{W.onRemoved&&W.onRemoved(me),qn.update(ye=>(delete ye[xo(me.overlay.id)],ye));const Le=Vn.get();if(Le)try{Le.removeDrawing(me.overlay.id),console.log("🗑️ Removed drawing from DrawingManager:",me.overlay.id),vv()}catch(ye){console.error("Error removing drawing from DrawingManager:",ye)}return!0}};return I.includeDrawEnd&&(_e.onDrawEnd=me=>{W.onDrawEnd&&W.onDrawEnd(me),zc(me.overlay);const Le=xo(me.overlay.id);if(Np.recordAddOverlay(me.overlay.id,me.overlay,Le),i(w)===me.overlay.id&&x(w,null),me.overlay.name==="text")try{x(T,V(me.overlay)),x(g,V(me.overlay.id));const ye=Xe(me.overlay);ye&&(x(D,V({...ye})),x(C,V({x:ye.x,y:ye.y})),x(P,!0),x(M,!1)),s()&&A0.startEditing(s(),me.overlay)}catch{}return!0}),_e}function js(){var E,I;if(s())try{(((I=(E=s()).getOverlays)==null?void 0:I.call(E))||[]).forEach(Z=>{const _e=(Z==null?void 0:Z.name)||(Z==null?void 0:Z.type),me=(Z==null?void 0:Z.groupId)===Te||_e&&$1[String(_e)];if(!(Z!=null&&Z.id)||!_e||!me)return;const Le=ms(String(_e),{includeDrawEnd:!0});try{s().overrideOverlay({id:Z.id,groupId:Te,...Le})}catch{}})}catch{}}function Nn(){var E,I,W,Z,_e,me;if(!s())return null;try{const Le=(I=(E=s()).getChartStore)==null?void 0:I.call(E),ye=(Z=(W=Le==null?void 0:Le.getClickOverlayInfo)==null?void 0:W.call(Le))==null?void 0:Z.overlay;return ye&&((ye==null?void 0:ye.groupId)===Te||ye!=null&&ye.name&&$1[String(ye.name)])?ye:(((me=(_e=s()).getOverlays)==null?void 0:me.call(_e))||[]).find(Ae=>{var Rt,nn;return((Ae==null?void 0:Ae.groupId)===Te||(Ae==null?void 0:Ae.name)&&$1[String(Ae.name)])&&((Ae==null?void 0:Ae.selected)===!0||((Rt=Ae==null?void 0:Ae.extendData)==null?void 0:Rt.selected)===!0||((nn=Ae==null?void 0:Ae.extendData)==null?void 0:nn.editing)===!0)})||null}catch{}return null}function Io(E){var Z;const I={groupId:Te,...ms(E==null?void 0:E.name,{includeDrawEnd:!0})},W=(Z=s())==null?void 0:Z.createOverlay(wn.mergeWith({},I,E,(_e,me,Le)=>{if(Le.startsWith("on")&&_e&&me)return ye=>(me(ye),_e(ye))}));return W&&(Array.isArray(W)?(m.push(...W),W.length>0&&x(w,V(W[0]))):(m.push(W),x(w,V(W)))),W}function fo(E){E==="text"&&Be("text"),i(d)&&(x(d,!1),To(!1,{preserveManualLock:!0}));const I=nc(E);let W=vt.Solid,Z=[8,4];I.style==="dashed"?(W=vt.Dashed,Z=[8,4]):I.style==="dotted"&&(W=vt.Dashed,Z=[2,6]);const _e=Number(I.thickness)||1,me=Aa(I.color,I.opacity,gn.color),Le={line:{size:_e,color:me,style:W,dashedValue:Z},text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF"},polygon:{color:me}},ye={origin:"user"};if(E==="text"){const Se=Vu(),Ge=Aa(Se.textColor,Se.textOpacity,Is.textColor),Ae=Aa(Se.backgroundColor,Se.backgroundOpacity,Is.backgroundColor);ye.text=$r,ye.fontSize=Number(Se.fontSize)||32,ye.fontWeight=Se.fontWeight,ye.textColor=Se.textColor,ye.backgroundColor=Ae,ye.fontFamily=Se.fontFamily,ye.textOpacity=Se.textOpacity,ye.textBgOpacity=Se.backgroundOpacity,Le.text={...Le.text,size:Number(Se.fontSize)||32,weight:Se.fontWeight,family:Se.fontFamily,color:Ge,backgroundColor:Ae}}E==="fibonacciSegment"&&(ye.fibonacciLevels=ro(ll())),Io({name:E,visible:i(h),lock:i(d),mode:i(u),styles:Le,extendData:ye})}function Ji(E,I){sc[E].icon=I,fo(I),x(c,"")}function Gi(E){return E==="priceChannelLine"?"priceChannelLineNew":E}function Al(){var I;let E=i(f);i(u)!=="normal"&&(E="normal"),x(u,V(E)),(I=s())==null||I.overrideOverlay({mode:E})}function Ii(E){var I;x(f,V(E)),x(u,V(E)),x(c,""),(I=s())==null||I.overrideOverlay({mode:E})}function Wo(E){let W=0;return E==="crosshair"?W=0:sc.find(Z=>Z.key===E)?W=1+sc.findIndex(Z=>Z.key===E):E==="ruler"?W=1+sc.length+1:E==="mode"?W=1+sc.length+2:E==="lock"?W=1+sc.length+3:E==="visible"?W=1+sc.length+4:E==="remove"&&(W=1+sc.length+5),W*52}function To(E,I={}){var W,Z;if(s())try{(((Z=(W=s()).getOverlays)==null?void 0:Z.call(W))||[]).forEach(me=>{var Se,Ge;const Le=(me==null?void 0:me.name)||(me==null?void 0:me.type),ye=(me==null?void 0:me.groupId)===Te||Le&&$1[String(Le)];!(me!=null&&me.id)||!ye||!E&&I.preserveManualLock&&((Se=me==null?void 0:me.extendData)==null?void 0:Se.manualLock)===!0||(Ge=s())==null||Ge.overrideOverlay({id:me.id,lock:E})})}catch(_e){console.warn("setOverlayLock failed:",_e)}}function Ba(){x(d,!i(d)),i(d)?To(!0):To(!1,{preserveManualLock:!0})}function Pi(E){var I,W;if(!s()||!E)return null;try{const Z=(I=s().getOverlays({id:E}))==null?void 0:I[0];return Z?{lock:!!Z.lock,manualLock:((W=Z==null?void 0:Z.extendData)==null?void 0:W.manualLock)===!0}:null}catch(Z){return console.warn("getOverlayLockInfo failed:",Z),null}}function qs(E){var I,W,Z;if(!(!s()||!E))try{const _e=(I=s().getOverlays({id:E}))==null?void 0:I[0];if(!_e)return;const Le=!(((W=_e==null?void 0:_e.extendData)==null?void 0:W.manualLock)===!0),ye=Le?!0:!!i(d),Se={..._e.extendData||{},manualLock:Le};s().overrideOverlay({id:E,lock:ye,extendData:Se});const Ge={..._e,lock:ye,extendData:Se};((Z=i(T))==null?void 0:Z.id)===E&&x(T,V(Ge)),zc(Ge)}catch(_e){console.warn("toggleOverlayManualLockById failed:",_e)}}function mi(){var E;x(h,!i(h)),(E=s())==null||E.overrideOverlay({visible:i(h)})}function Er(){var E,I;if(x(u,"normal"),x(f,"weakMagnet"),Be(null),i(w)){(E=s())==null||E.removeOverlay({id:i(w)});const W=m.indexOf(i(w));W>-1&&m.splice(W,1),x(w,null)}(I=s())==null||I.overrideOverlay({mode:K7.Normal}),x(c,""),x(P,!1),x(M,!1),x(pe,!1),x(C,null),x(T,null),x(g,"")}function Za(){var W;let E={groupId:Te},I=null;if(i(g))E.id=i(g),I=i(T);else if(m.length>0){const Z=m.pop();if(E.id=Z,Z&&s()){const _e=s().getOverlays({id:Z});_e&&_e.length>0&&(I=_e[0])}}if(I){const Z=xo(I.id);Np.recordRemoveOverlay(I.id,I,Z)}(W=s())==null||W.removeOverlay(E),x(P,!1),x(M,!1),x(pe,!1),x(C,null),x(T,null)}function vi(){var ye;if(!i(T)||!s())return;const E=xo(i(T).id),I=JSON.parse(JSON.stringify(i(T))),W=Number(N.thickness)||1;let Z=vt.Solid,_e=[8,4];N.style==="dashed"?(Z=vt.Dashed,_e=[8,4]):N.style==="dotted"&&(Z=vt.Dashed,_e=[2,6]);const me=Aa(N.color,N.opacity,gn.color),Le={line:{size:W,color:me,style:Z,dashedValue:_e},text:{color:"#FFFFFF",backgroundColor:"rgba(0, 100, 255, 0.7)",borderColor:"#FFFFFF"},polygon:{color:me}};try{s().overrideOverlay({id:i(T).id,styles:Le})}catch(Se){console.log("Error updating overlay styles:",Se)}zc({...i(T),styles:{...i(T).styles,...Le}}),wc(i(T))&&((ye=i(T))!=null&&ye.name)&&ja(i(T).name,{thickness:N.thickness,style:N.style,color:N.color,opacity:N.opacity});try{const Se={...i(T),styles:{...i(T).styles,...Le}};Np.recordModifyOverlay(i(T).id,I,Se,E)}catch{}}const $r="Add text";function Il(E){const I=E.extendData||{},Z=(E.styles||{}).text||{},_e=I.backgroundColor||Z.backgroundColor||"#A0000020";let me=_e;if(typeof _e=="string"&&_e.startsWith("#")&&_e.length===9){me=_e.slice(0,7);try{x(et,V(Math.round(parseInt(_e.slice(7,9),16)/255*100)))}catch{}}typeof I.textBgOpacity=="number"&&x(et,V(Math.max(0,Math.min(100,I.textBgOpacity))));const Le=I.textColor||Z.color||"#FFFFFF";let ye=Le;if(typeof Le=="string"&&Le.startsWith("#")&&Le.length===9){ye=Le.slice(0,7);try{x(Ue,V(Math.round(parseInt(Le.slice(7,9),16)/255*100)))}catch{}}typeof I.textOpacity=="number"&&x(Ue,V(Math.max(0,Math.min(100,I.textOpacity)))),i(He).fontSize=String(I.fontSize||Z.size||32),i(He).fontWeight=I.fontWeight||Z.weight||"bold",i(He).textColor=ar(ye,Is.textColor),i(He).backgroundColor=ar(me,Is.backgroundColor),i(He).fontFamily=I.fontFamily||Z.family||We}function cl(){var hn,is,Gs,es,Mi,Kn,Es;if(!i(T)||!s()||i(T).name!=="text")return;const E=xo(i(T).id),I=JSON.parse(JSON.stringify(i(T))),W=Number(i(He).fontSize)||12,Z=i(He).backgroundColor||Is.backgroundColor,_e=i(He).textColor||Is.textColor,me=Aa(Z,i(et),Is.backgroundColor),Le=Aa(_e,i(Ue),Is.textColor),ye=((hn=i(T).styles)==null?void 0:hn.text)||{},Se=ye.size??((is=i(T).extendData)==null?void 0:is.fontSize),Ge=ye.weight??((Gs=i(T).extendData)==null?void 0:Gs.fontWeight),Ae=ye.family??((es=i(T).extendData)==null?void 0:es.fontFamily),Rt=Se!==W||Ge!==i(He).fontWeight||Ae!==i(He).fontFamily,nn={...i(T).extendData||{},fontSize:W,fontWeight:i(He).fontWeight,textColor:i(He).textColor,backgroundColor:me,fontFamily:i(He).fontFamily,...Rt?{boxWidth:0,boxHeight:0}:{}},Xn={...i(T).styles||{},text:{...((Mi=i(T).styles)==null?void 0:Mi.text)||{},size:W,color:Le,backgroundColor:me,family:i(He).fontFamily,weight:i(He).fontWeight,paddingLeft:8,paddingRight:8,paddingTop:4,paddingBottom:4,borderSize:0,borderColor:"transparent"},box:{...((Kn=i(T).styles)==null?void 0:Kn.box)||{},stroke:"#3b82f6",width:1,fill:"transparent"},handles:{...((Es=i(T).styles)==null?void 0:Es.handles)||{},size:6,fill:"#3b82f6",stroke:"#3b82f6"}};try{if(s().overrideOverlay({id:i(T).id,styles:Xn,extendData:{...nn,textColor:_e,backgroundColor:me,textOpacity:i(Ue),textBgOpacity:i(et)}}),(i(T).extendData||{}).editing)try{A0.updateEditorStyle(i(T))}catch{}}catch(Qo){console.log("Error updating text overlay styles:",Qo)}x(T,V({...i(T),styles:Xn,extendData:nn})),zc(i(T)),wc(i(T))&&Bc({fontSize:i(He).fontSize,fontWeight:i(He).fontWeight,textColor:i(He).textColor,textOpacity:i(Ue),backgroundColor:i(He).backgroundColor,backgroundOpacity:i(et),fontFamily:i(He).fontFamily});try{const Qo=JSON.parse(JSON.stringify(i(T)));Np.recordModifyOverlay(i(T).id,I,Qo,E)}catch{}}function kc(E){var me;x(L,!0),x($,V(Date.now()));const I=E instanceof MouseEvent?E.clientX:E.touches[0].clientX,W=E instanceof MouseEvent?E.clientY:E.touches[0].clientY,Z=(me=E.target.closest(".context-menu-container"))==null?void 0:me.getBoundingClientRect();Z?(O.x=I-Z.left,O.y=W-Z.top):i(D)&&(O.x=I-i(D).x,O.y=W-i(D).y);const _e=E;typeof _e.preventDefault=="function"&&_e.preventDefault(),typeof _e.stopPropagation=="function"&&_e.stopPropagation()}function uc(E){if(i(L)&&i(D)){x($,V(Date.now()));const I=E instanceof MouseEvent?E.clientX:E.touches[0].clientX,W=E instanceof MouseEvent?E.clientY:E.touches[0].clientY,Z=window.innerWidth<=768,_e=Z?Math.min(250,window.innerWidth-40):300,me=Z?40:60,Le=Z?5:10,ye=St==null?void 0:St.getBoundingClientRect();let Se=I-O.x,Ge=W-O.y;const Ae=((ye==null?void 0:ye.left)||0)+Le,Rt=(ye?ye.right:window.innerWidth)-_e-Le,nn=((ye==null?void 0:ye.top)||0)+Le,Xn=(ye?ye.bottom:window.innerHeight)-me-Le;i(D).x=Math.max(Ae,Math.min(Se,Rt)),i(D).y=Math.max(nn,Math.min(Ge,Xn))}}function Tl(){i(L)&&i(D)&&Ce(i(D)),x(L,!1),x($,V(Date.now()))}function ur(E){uc(E)}function la(){Tl()}function Fl(E){const I=E.detail;i(ge)==="line"?(N.color=I,vi()):i(ge)==="textColor"?(i(He).textColor=I,cl()):i(ge)==="textBg"&&(i(He).backgroundColor=I,cl())}function Oa(E){const I=E.detail;i(ge)==="line"?(N.opacity=I,x(Ie,V(I)),vi()):i(ge)==="textColor"?(x(Ue,V(I)),x(Ie,V(I)),cl()):i(ge)==="textBg"&&(x(et,V(I)),x(Ie,V(I)),cl())}function ni(){x(he,!1)}function vc(){const E=Np.undo();console.log(E?"Undo successful":"Nothing to undo")}function gl(){const E=Np.redo();console.log(E?"Redo successful":"Nothing to redo")}function za(E){(E.ctrlKey||E.metaKey)&&E.key==="z"&&!E.shiftKey?(E.preventDefault(),vc()):(E.ctrlKey||E.metaKey)&&E.key==="y"||(E.ctrlKey||E.metaKey)&&E.shiftKey&&E.key==="z"?(E.preventDefault(),gl()):(E.key==="Delete"||E.key==="Backspace")&&i(g)?(E.preventDefault(),Za()):(E.ctrlKey||E.metaKey)&&E.key==="c"&&i(T)?(E.preventDefault(),Oc()):(E.ctrlKey||E.metaKey)&&E.key==="v"&&i(z)&&(E.preventDefault(),Sc(E))}function sl(){if(!(!i(T)||!s())){x(te,!0);try{const E=JSON.parse(JSON.stringify(i(T))),I=Date.now();E.id=`${i(T).name}_clone_${I}`,E.points&&Array.isArray(E.points)&&(E.points=E.points.map(Z=>Z&&typeof Z=="object"?{...Z,timestamp:Z.timestamp?Z.timestamp+1e3*60*5:Z.timestamp,value:Z.value?Z.value*1.002:Z.value}:Z));const W=Io(E);if(W){const Z=Array.isArray(W)?W[0]:W;if(Z){const _e=xo(Z);Np.recordAddOverlay(Z,E,_e),setTimeout(()=>{var Le;const me=s().getOverlays({id:Z})[0];if(me&&(vu(Z,me),x(g,V(Z)),x(T,V(me)),co(me),(me==null?void 0:me.name)==="text"&&Il(me),me.points&&me.points.length>0)){const ye=me.points[0],Se=(Le=s())==null?void 0:Le.convertToPixel(ye,{paneId:"candle_pane"});if(Se&&typeof Se=="object"&&"x"in Se&&"y"in Se&&Se.x!==void 0&&Se.y!==void 0){x(C,V({x:Se.x-80,y:Se.y-30}));const Ge=Xe(me)||{x:Se.x-80,y:Se.y-30};x(D,V({...Ge})),x(P,!0),x(M,!1),x(pe,!1)}}},100)}console.log("Overlay cloned successfully")}}catch(E){console.error("Error cloning overlay:",E)}finally{x(te,!1)}}}function Oc(){var E;if(i(T))try{x(z,V(JSON.parse(JSON.stringify(i(T))))),console.log("Overlay copied to clipboard");try{(E=navigator==null?void 0:navigator.clipboard)!=null&&E.writeText&&navigator.clipboard.writeText(`${J}${JSON.stringify(i(z))}`).catch(()=>{})}catch{}x(P,!1),setTimeout(()=>{console.log("Copy operation completed")},100)}catch(I){console.error("Error copying overlay:",I)}}function Va(E){if(!s()||!E)return null;const I=s().getOverlays({id:E})||[];if(!I.length)return null;const W=En(I[0]);return x(g,V(W.id)),x(T,V(W)),co(W),(W==null?void 0:W.name)==="text"&&Il(W),W}function Wa(E){Va(E)&&sl()}function uu(E){Va(E)&&Oc()}function ud(E){Va(E)&&Za()}function Ll(){return!!i(z)}function vu(E,I){var me,Le,ye,Se,Ge,Ae,Rt;if(!s()||!E)return;let W=0,Z=0;try{const nn=(I==null?void 0:I.paneId)||"candle_pane",Xn=(me=I==null?void 0:I.points)==null?void 0:me[0],hn=Xn?(Le=s())==null?void 0:Le.convertToPixel(Xn,{paneId:nn}):null;hn&&typeof hn=="object"&&(typeof hn.x=="number"&&(W=hn.x),typeof hn.y=="number"&&(Z=hn.y))}catch{}const _e=(ye=i(T))==null?void 0:ye.id;if(_e&&_e!==E)try{const nn={...((Se=i(T))==null?void 0:Se.extendData)||{},selected:!1};s().overrideOverlay({id:_e,selected:!1,extendData:nn})}catch{}try{const nn={...(I==null?void 0:I.extendData)||{},selected:!0};s().overrideOverlay({id:E,selected:!0,extendData:nn})}catch{}try{const nn=(Ae=(Ge=s())==null?void 0:Ge.getChartStore)==null?void 0:Ae.call(Ge);if(nn!=null&&nn.setClickOverlayInfo){const Xn=((Rt=I==null?void 0:I.points)==null?void 0:Rt.length)>0?"overlay_figure_point_0":void 0,hn=Xn!==void 0?{key:Xn,type:"circle",attrs:{}}:null;nn.setClickOverlayInfo({paneId:(I==null?void 0:I.paneId)||"candle_pane",overlay:I,figureType:hn?"point":"other",figureIndex:-1,figure:hn},(is,Gs)=>{var es;return(es=is==null?void 0:is.onSelected)==null||es.call(is,{chart:s(),overlay:is,figure:Gs,x:W,y:Z}),!0},(is,Gs)=>{var es;return(es=is==null?void 0:is.onDeselected)==null||es.call(is,{chart:s(),overlay:is,figure:Gs,x:W,y:Z}),!0})}}catch{}}function Sc(E,I){if(!(!i(z)||!s()))try{const W=JSON.parse(JSON.stringify(i(z))),Z=Date.now();if(W.id=`${i(z).name}_paste_${Z}`,I&&W.points&&Array.isArray(W.points)){const me=W.points[0]||{},Le=Number(me.timestamp),ye=Number(me.value);if(Number.isFinite(Le)&&Number.isFinite(ye)){const Se=I.timestamp-Le,Ge=I.value-ye;W.points=W.points.map(Ae=>Ae&&typeof Ae=="object"?{...Ae,timestamp:typeof Ae.timestamp=="number"?Ae.timestamp+Se:Ae.timestamp,value:typeof Ae.value=="number"?Ae.value+Ge:Ae.value}:Ae)}}else E&&W.points&&Array.isArray(W.points)&&(W.points=W.points.map(me=>me&&typeof me=="object"?{...me,timestamp:me.timestamp?me.timestamp+1e3*60*10:me.timestamp,value:me.value?me.value*1.005:me.value}:me));const _e=Io(W);if(_e){const me=Array.isArray(_e)?_e[0]:_e;if(me){const Le=xo(me);Np.recordAddOverlay(me,W,Le),setTimeout(()=>{var Se;const ye=s().getOverlays({id:me})[0];if(ye&&(vu(me,ye),x(g,V(me)),x(T,V(ye)),co(ye),(ye==null?void 0:ye.name)==="text"&&Il(ye),ye.points&&ye.points.length>0)){const Ge=ye.points[0],Ae=(Se=s())==null?void 0:Se.convertToPixel(Ge,{paneId:"candle_pane"});if(Ae&&typeof Ae=="object"&&"x"in Ae&&"y"in Ae&&Ae.x!==void 0&&Ae.y!==void 0){x(C,V({x:Ae.x-80,y:Ae.y-30}));const Rt=Xe(ye)||{x:Ae.x-80,y:Ae.y-30};x(D,V({...Rt})),x(P,!0),x(M,!1),x(pe,!1)}}},100)}console.log("Overlay pasted successfully")}}catch(W){console.error("Error pasting overlay:",W)}}function Ja(E){if(!(!i(z)||!s())){if(!E||!Number.isFinite(E.x)||!Number.isFinite(E.y)){Sc();return}try{const I=E.paneId||"candle_pane",W=s().convertFromPixel([{x:E.x,y:E.y}],{paneId:I,absolute:!0}),Z=Array.isArray(W)?W[0]:null;Z&&typeof Z.timestamp=="number"&&typeof Z.value=="number"?Sc(void 0,{timestamp:Z.timestamp,value:Z.value}):Sc()}catch{Sc()}}}function ga(E,I){const W=String(E||"");if(!W.startsWith(J))return;const Z=W.slice(J.length);try{const _e=JSON.parse(Z);x(z,V(_e)),Ja(I)}catch(_e){console.warn("Failed to parse overlay clipboard payload:",_e)}}function Wu(E,I){if(!s())return;const W=String(E||"").trim();if(!W||!I||!Number.isFinite(I.x)||!Number.isFinite(I.y))return;const Z=I.paneId||"candle_pane";let _e=null;try{const nn=s().convertFromPixel([{x:I.x,y:I.y}],{paneId:Z,absolute:!0});_e=Array.isArray(nn)?nn[0]:null}catch{}if(!_e||typeof _e.timestamp!="number"||typeof _e.value!="number")return;const me=Vu(),Le=Number(me.fontSize)||32,ye=Aa(me.textColor,me.textOpacity,Is.textColor),Se=Aa(me.backgroundColor,me.backgroundOpacity,Is.backgroundColor),Ge={name:"text",visible:i(h),lock:i(d),mode:i(u),paneId:Z,points:[{timestamp:_e.timestamp,value:_e.value}],styles:{text:{color:ye,backgroundColor:Se,borderColor:"#1677FF",size:Le,weight:me.fontWeight,family:me.fontFamily}},extendData:{text:W,fontSize:Le,fontWeight:me.fontWeight,textColor:me.textColor,textOpacity:me.textOpacity,backgroundColor:Se,textBgOpacity:me.backgroundOpacity,fontFamily:me.fontFamily}},Ae=Io(Ge),Rt=Array.isArray(Ae)?Ae[0]:Ae;if(Rt){const nn=xo(Rt);Np.recordAddOverlay(Rt,Ge,nn),setTimeout(()=>{const Xn=s().getOverlays({id:Rt})[0];Xn&&(vu(Rt,Xn),x(g,V(Rt)),x(T,V(Xn)),co(Xn),Il(Xn),A0.startEditing(s(),Xn))},0)}}function zc(E){if(E.groupId!==Te)return;const I=["extendData","groupId","id","lock","mode","name","paneId","points","styles","totalStep","visible","zLevel"],W=xo(E.id);qn.update(_e=>(_e[W]=Object.fromEntries(I.map(me=>[me,E[me]])),_e));const Z=Vn.get();if(Z&&E.points&&E.points.length>0)try{const _e=D0(o().symbol),me={id:E.id,symbolKey:_e,type:E.name||"unknown",points:E.points.map(Le=>({time:Le.timestamp||Le.t||0,price:Le.value||Le.p||0})),styles:E.styles||{},...E.extendData?{extendData:E.extendData}:{},locked:!!E.lock,visible:E.visible!==!1};Z.addDrawing(me),vv()}catch(_e){console.error("Error syncing overlay to DrawingManager:",_e)}}function eu(){if(x(ce,!i(ce)),i(ce)){const E=st();x(je,V({x:E.left+60,y:E.top+100}))}}function Ud(E){const{emoji:I}=E.detail;console.log("Selected emoji:",I),x(ce,!1),Io({name:"emoji",visible:i(h),lock:i(d),mode:i(u),extendData:{emoji:I,size:24},styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}}})}function qf(E){if(!i(T)||i(T).name!=="emoji")return;const I=xo(i(T).id),W=JSON.parse(JSON.stringify(i(T))),Z=parseInt(E);if(!(isNaN(Z)||Z<16||Z>64)&&(i(T).extendData&&(i(T).extendData.size=Z),s()&&i(T).id)){s().overrideOverlay({id:i(T).id,extendData:i(T).extendData}),zc(i(T));try{const _e=JSON.parse(JSON.stringify(i(T)));Np.recordModifyOverlay(i(T).id,W,_e,I)}catch{}}}function Uf(){var E,I;if(((E=i(T))==null?void 0:E.name)==="fibonacciSegment"){const W=((I=i(T).extendData)==null?void 0:I.fibonacciLevels)||i(T).fibonacciLevels;W?x(kr,V(bs(W))):x(kr,V(ll())),x(Wr,V(ro(i(kr)))),x(Vl,!0)}}function dd(){x(kr,V(ro(Cs))),Gf()}function Id(){Gf(),x(Vl,!1)}function dc(){x(kr,V(ro(i(Wr)))),Gf(),x(Vl,!1)}function Gf(){if(!i(T)||i(T).name!=="fibonacciSegment"||!s())return;const E=xo(i(T).id),I=JSON.parse(JSON.stringify(i(T))),W=ro(i(kr));s().overrideOverlay({id:i(T).id,extendData:{...i(T).extendData,fibonacciLevels:W}}),i(T).extendData={...i(T).extendData||{},fibonacciLevels:W},i(T).fibonacciLevels=W,zc(i(T)),va(W);try{const Z=JSON.parse(JSON.stringify(i(T)));Np.recordModifyOverlay(i(T).id,I,Z,E)}catch{}}function Pd(E,I,W){E>=0&&E<i(kr).length&&(i(kr)[E]={...i(kr)[E],[I]:W},Gf())}hp($t,E=>E.clickChart).subscribe(()=>{x(c,""),Date.now()-de>150&&!i(L)&&requestAnimationFrame(()=>{var Z,_e,me,Le,ye,Se;const I=(_e=(Z=s())==null?void 0:Z.getChartStore)==null?void 0:_e.call(Z),W=Nn();if(W){(!i(T)||i(T).id!==W.id)&&(js(),Nu(W));return}if((me=i(T))!=null&&me.id)try{const Ge={...i(T).extendData||{},selected:!1};(ye=(Le=s())==null?void 0:Le.overrideOverlay)==null||ye.call(Le,{id:i(T).id,selected:!1,extendData:Ge})}catch{}if(I!=null&&I.setClickOverlayInfo)try{I.setClickOverlayInfo({paneId:((Se=i(T))==null?void 0:Se.paneId)||"candle_pane",overlay:null,figureType:"none",figureIndex:-1,figure:null},()=>!0,()=>!0)}catch{}x(g,""),x(T,null),x(P,!1),x(M,!1),x(pe,!1),x(C,null)})}),Mh(()=>{if(mt(),Pu(Vu()),typeof document<"u"&&(document.addEventListener("mousemove",uc),document.addEventListener("mouseup",Tl),document.addEventListener("touchmove",ur,{passive:!1}),document.addEventListener("touchend",la),document.addEventListener("touchcancel",la)),typeof window<"u"){window.addEventListener("resize",Mt);const E=I=>{if(s()&&i(T)&&i(T).name==="text"){const W=Xe(i(T));W&&(x(D,V({...W})),x(C,V({x:W.x,y:W.y})),x(P,!0),x(M,!1)),A0.startEditing(s(),i(T))}};window.addEventListener("dblclick",E)}}),Mh(()=>{typeof document<"u"&&document.addEventListener("keydown",za)});function ol(){if(!i(it))return;const{scrollHeight:E,clientHeight:I,scrollTop:W}=i(it),Z=E>I,_e=W+I>=E-5;x(ft,V(Z&&!_e))}function du(E){if(E&&(E.preventDefault(),E.stopPropagation()),!i(it))return;const{scrollTop:I,clientHeight:W,scrollHeight:Z}=i(it),_e=W*.7,me=Math.min(I+_e,Z-W);i(it).scrollTo({top:me,behavior:"smooth"})}Mh(()=>{ol();const E=()=>{ol()},I=()=>{ol()};return i(it)&&i(it).addEventListener("scroll",E),typeof window<"u"&&window.addEventListener("resize",I),setTimeout(ol,500),()=>{i(it)&&i(it).removeEventListener("scroll",E),typeof window<"u"&&window.removeEventListener("resize",I)}}),b0(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",uc),document.removeEventListener("mouseup",Tl),document.removeEventListener("keydown",za),document.removeEventListener("touchmove",ur),document.removeEventListener("touchend",la),document.removeEventListener("touchcancel",la)),typeof window<"u"&&window.removeEventListener("resize",Mt)});function Nu(E){try{de=Date.now();const I=En(E);if(x(g,V(I.id)),x(T,V(I)),co(I),(I==null?void 0:I.name)==="text"&&Il(I),I.points&&I.points.length>0){const W=Xe(I);W&&(x(D,V({...W})),x(C,V({x:W.x,y:W.y})),x(P,!0),x(M,!1))}}catch(I){console.warn("externalSelectOverlay failed:",I)}}function hf(E){var I,W,Z;try{if(i(g)===E.id||((I=i(T))==null?void 0:I.id)===E.id){try{(Z=(W=s())==null?void 0:W.overrideOverlay)==null||Z.call(W,{id:E.id,selected:!1,extendData:{...(E==null?void 0:E.extendData)||{},selected:!1,editing:!1}})}catch{}x(g,""),x(M,!1),x(P,!1),x(pe,!1),x(C,null),x(T,null)}}catch(_e){console.warn("externalDeselectOverlay failed:",_e)}}function td(E){try{zc(E)}catch(I){console.warn("externalSyncOverlay failed:",I)}}function Cc(E){try{i(g)===E&&(x(g,""),x(M,!1),x(P,!1),x(pe,!1),x(C,null),x(T,null))}catch(I){console.warn("externalRemoved failed:",I)}}function Gd(E={}){fo("text"),Io({name:"text",visible:i(h),lock:i(d),mode:i(u),styles:{text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF",size:E.fontSize??32,weight:E.fontWeight??"bold",family:E.fontFamily??We}},extendData:{text:E.text??$r,fontSize:E.fontSize??32,fontWeight:E.fontWeight??"bold",textColor:E.textColor??"#FFFFFF",backgroundColor:E.backgroundColor??"#A0000020",fontFamily:E.fontFamily??We}})}function tu(E,I){s()&&s().overrideOverlay({id:E,...I})}function Vc(E){s()&&s().removeOverlay({id:E})}function Yd(E){x(g,V(E||""))}function Md(E){var W;if(!s())return;const I=(W=s().getOverlays({id:E}))==null?void 0:W[0];I&&I.name==="text"&&A0.startEditing(s(),I)}function Au(E){}var Kd=zO(),Hu=tn(Kd),Tu=y(Hu);Tu.__click=[dO];var bd=y(Tu);a(bd,()=>Er,()=>"crosshair",()=>"",()=>[],()=>!0);var gc=v(bd,2);Ro(gc,17,()=>sc,fi,(E,I)=>{var W=fO(),Z=tn(W),_e=sv(()=>()=>i(I).key==="emoji"?eu():fo(i(I).icon));a(Z,()=>i(_e),()=>i(I).icon,()=>i(I).key,()=>i(I).list,()=>!0);var me=v(Z,2);Ye(me,()=>i(I).key==="emoji",Le=>{l(Le)}),Y(E,W)});var qu=v(gc,2),$d=sv(()=>()=>fo("ruler"));a(qu,()=>i($d),()=>"ruler");var np=v(qu,2);a(np,()=>Al,()=>i(f),()=>"mode",()=>yd,()=>!1,()=>!0);var Pf=v(np,2);a(Pf,()=>Ba,()=>i(d)?"lock":"unlock",()=>"lock",()=>[],()=>!1,()=>!0);var oe=v(Pf,2);a(oe,()=>mi,()=>i(h)?"visible":"invisible",()=>"",()=>[],()=>!1,()=>!0);var we=v(oe,2);l(we);var K=v(we,2);a(K,()=>Za,()=>"remove"),_(Tu),ep(Tu,E=>x(it,E),()=>i(it));var re=v(Tu,2);Ye(re,()=>i(ft),E=>{var I=mO();I.__click=du,I.__touchstart=[oO,du],I.__touchend=[pO],Y(E,I)}),_(Hu);var ke=v(Hu,2);Ye(ke,()=>i(c),E=>{var I=xO(),W=tn(I);Ro(W,17,()=>sc,fi,(_e,me)=>{var Le=Yn(),ye=tn(Le);Ye(ye,()=>i(me).key===i(c)&&i(me).list.length>0,Se=>{var Ge=gO();const Ae=At(()=>`left: 60px; top: ${Wo(i(c))??""}px;`);Ro(Ge,21,()=>i(me).list,fi,(Rt,nn)=>{var Xn=vO();Xn.__click=[hO,c,Ii,nn,Ji,sc];var hn=y(Xn),is=At(()=>Gi(i(nn).key));Kv(hn,{get name(){return i(is)},class:"w-4 h-4"});var Gs=v(hn,2),es=y(Gs,!0);Ne(()=>tt(es,Bg[i(nn).text]())),_(Gs),_(Xn),ld("mouseenter",Xn,Mi=>Mi.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),ld("mouseleave",Xn,Mi=>Mi.currentTarget.style.backgroundColor="transparent"),Y(Rt,Xn)}),_(Ge),A6(Ge,Rt=>ct(Rt)),Ne(()=>Dt(Ge,"style",i(Ae))),Y(Se,Ge)}),Y(_e,Le)});var Z=v(W,2);Ye(Z,()=>i(c)==="mode",_e=>{var me=bO();const Le=At(()=>`left: 60px; top: ${Wo("mode")??""}px;`);Ro(me,21,()=>yd,fi,(ye,Se)=>{var Ge=yO();Ge.__click=[_O,Ii,Se];var Ae=y(Ge),Rt=At(()=>Gi(i(Se).key));Kv(Ae,{get name(){return i(Rt)},class:"w-4 h-4"});var nn=v(Ae,2),Xn=y(nn,!0);Ne(()=>tt(Xn,Bg[i(Se).text]())),_(nn),_(Ge),ld("mouseenter",Ge,hn=>hn.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),ld("mouseleave",Ge,hn=>hn.currentTarget.style.backgroundColor="transparent"),Y(ye,Ge)}),_(me),A6(me,ye=>ct(ye)),Ne(()=>Dt(me,"style",i(Le))),Y(_e,me)}),Y(E,I)});var ee=v(ke,2);Ye(ee,()=>i(P)&&i(D),E=>{var I=BO();I.__click=[wO];var W=y(I);Ye(W,()=>{var hn;return((hn=i(T))==null?void 0:hn.name)!=="emoji"},hn=>{var is=IO(),Gs=tn(is);Gs.__mousedown=kc,Gs.__touchstart=[eO,kc];var es=y(Gs),Mi=y(es),Kn=y(Mi);Di(2),_(Mi),Di(4),_(es),_(Gs);var Es=v(Gs,2);Ye(Es,()=>{var Qo;return((Qo=i(T))==null?void 0:Qo.name)==="text"},Qo=>{var sr=SO(),na=tn(sr);na.__change=cl;var Xr=y(na);Xr.value=(Xr.__value="8")==null?"":"8";var Uu=v(Xr);Uu.value=(Uu.__value="10")==null?"":"10";var xd=v(Uu);xd.value=(xd.__value="11")==null?"":"11";var ul=v(xd);ul.value=(ul.__value="12")==null?"":"12";var dr=v(ul);dr.value=(dr.__value="14")==null?"":"14";var Fu=v(dr);Fu.value=(Fu.__value="16")==null?"":"16";var gi=v(Fu);gi.value=(gi.__value="18")==null?"":"18";var Dr=v(gi);Dr.value=(Dr.__value="20")==null?"":"20";var Yi=v(Dr);Yi.value=(Yi.__value="22")==null?"":"22";var Ki=v(Yi);Ki.value=(Ki.__value="24")==null?"":"24";var Xi=v(Ki);Xi.value=(Xi.__value="32")==null?"":"32";var ca=v(Xi);ca.value=(ca.__value="40")==null?"":"40";var Jt=v(ca);Jt.value=(Jt.__value="52")==null?"":"52",_(na);var rn=v(na,2);rn.__click=[QB,He,cl];var dn=v(rn,2),uo=y(dn),zs=y(uo);const Hr=At(()=>`background-color: ${i(He).textColor??""}; color: ${Tt(i(He).textColor)??""};`);zs.__click=[nO,ge,ae,He,Ie,Ue,he];var Ul=y(zs);Kv(Ul,{name:"text",size:12}),_(zs);var Oi=v(zs,2);const Nd=At(()=>`background-color: ${i(He).backgroundColor??""}; color: ${Tt(i(He).backgroundColor)??""};`);Oi.__click=[sO,ge,ae,He,Ie,et,he];var hr=y(Oi);Kv(hr,{name:"rect",size:12}),_(Oi),_(uo);var vr=v(uo,2);vr.__change=cl,Ro(vr,21,()=>Pt,fi,(_l,ia)=>{var Zl=kO(),Bo={},Mf=y(Zl,!0);_(Zl),Ne(()=>{Bo!==(Bo=i(ia).value)&&(Zl.value=(Zl.__value=i(ia).value)==null?"":i(ia).value),tt(Mf,i(ia).label)}),Y(_l,Zl)}),_(vr),_(dn),Ne(()=>{Fi(na,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-ue8k6c`),Fi(rn,`w-8 h-8 rounded flex items-center justify-center ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors svelte-ue8k6c`),Dt(zs,"style",i(Hr)),Dt(Oi,"style",i(Nd)),Fi(vr,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n max-w-[120px] svelte-ue8k6c`)}),po(na,()=>i(He).fontSize,_l=>i(He).fontSize=_l),po(vr,()=>i(He).fontFamily,_l=>i(He).fontFamily=_l),Y(Qo,sr)},Qo=>{var sr=CO(),na=tn(sr);na.__click=[tO,ge,ae,N,Ie,Ve,he];var Xr=v(na,2);Xr.__change=vi;var Uu=y(Xr);Uu.value=(Uu.__value="1")==null?"":"1";var xd=v(Uu);xd.value=(xd.__value="2")==null?"":"2";var ul=v(xd);ul.value=(ul.__value="3")==null?"":"3";var dr=v(ul);dr.value=(dr.__value="4")==null?"":"4";var Fu=v(dr);Fu.value=(Fu.__value="5")==null?"":"5";var gi=v(Fu);gi.value=(gi.__value="6")==null?"":"6";var Dr=v(gi);Dr.value=(Dr.__value="7")==null?"":"7";var Yi=v(Dr);Yi.value=(Yi.__value="8")==null?"":"8",_(Xr);var Ki=v(Xr,2);Ki.__change=vi;var Xi=y(Ki);Xi.value=(Xi.__value="solid")==null?"":"solid";var ca=v(Xi);ca.value=(ca.__value="dashed")==null?"":"dashed";var Jt=v(ca);Jt.value=(Jt.__value="dotted")==null?"":"dotted",_(Ki),Ne(()=>{Dt(na,"style",`background-color: ${N.color??""};`),Fi(Xr,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[64px] h-[28px] svelte-ue8k6c`),Fi(Ki,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-ue8k6c`)}),po(Xr,()=>N.thickness,rn=>N.thickness=rn),po(Ki,()=>N.style,rn=>N.style=rn),Y(Qo,sr)}),Ne(()=>{Fi(Gs,`drag-handle cursor-grab hover:cursor-grabbing flex items-center justify-center
                 w-6 h-6 rounded ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors
                 touch-manipulation svelte-ue8k6c`),Fi(Kn,`w-0.5 h-0.5 ${(o().theme==="dark"?"bg-gray-500":"bg-gray-400")??""} rounded-full`)}),Y(hn,is)},hn=>{var is=MO(),Gs=y(is),es=y(Gs,!0);_(Gs);var Mi=v(Gs,2),Kn=v(y(Mi),2);mn(Kn),Kn.__input=[PO,qf];var Es=v(Kn,2),Qo=y(Es,!0);_(Es),_(Mi),_(is),Ne(()=>{var sr,na,Xr,Uu,xd,ul,dr,Fu;tt(es,((na=(sr=i(T))==null?void 0:sr.extendData)==null?void 0:na.emoji)||"😀"),Hf(Kn,((Uu=(Xr=i(T))==null?void 0:Xr.extendData)==null?void 0:Uu.size)||24),Dt(Kn,"title",`Emoji size: ${(((ul=(xd=i(T))==null?void 0:xd.extendData)==null?void 0:ul.size)||24)??""}px`),tt(Qo,((Fu=(dr=i(T))==null?void 0:dr.extendData)==null?void 0:Fu.size)||24)}),Y(hn,is)});var Z=v(W,2);Ye(Z,()=>{var hn;return((hn=i(T))==null?void 0:hn.name)==="fibonacciSegment"},hn=>{var is=AO();is.__click=[NO,Uf];var Gs=y(is);_(is),Ne(()=>{Fi(is,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-blue-900":"hover:bg-blue-100")??""} transition-colors duration-200
                 flex items-center justify-center svelte-ue8k6c`),ey(Gs,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-blue-500`)}),Y(hn,is)});var _e=v(Z,2);_e.__click=[JB,T,s,Yt,d,zc];var me=y(_e),Le=At(()=>{var hn,is;return(is=(hn=i(T))==null?void 0:hn.extendData)!=null&&is.manualLock?"lock":"unlock"}),ye=At(()=>`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""}`);Kv(me,{get name(){return i(Le)},get class(){return i(ye)}}),_(_e);var Se=v(_e,2),Ge=y(Se);Ge.__click=[TO,pe];var Ae=y(Ge);_(Ge);var Rt=v(Ge,2);Ye(Rt,()=>i(pe),hn=>{var is=RO();is.__click=[FO];var Gs=y(is);Gs.__click=[LO,sl,pe];var es=v(Gs,2);es.__click=[EO,Oc,pe];var Mi=v(es,2);Ye(Mi,()=>i(z),Kn=>{var Es=DO();Es.__click=[$O,Sc,pe],Ne(()=>Fi(Es,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-ue8k6c`)),Y(Kn,Es)}),_(is),Ne(()=>{Fi(is,`absolute right-0 top-full mt-1 min-w-[140px] rounded-md shadow-lg border ${(o().theme==="dark"?"bg-[#2B2B2B] border-[#3F3F3F]":"bg-white border-gray-200")??""} z-[200002]`),Fi(Gs,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-ue8k6c`),Fi(es,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-ue8k6c`)}),Y(hn,is)}),_(Se);var nn=v(Se,2);nn.__click=[jO,Za,P,C];var Xn=y(nn);_(nn),_(I),Ne(()=>{var hn,is,Gs,es;Fi(I,`context-menu-container fixed z-[200001] rounded-md shadow-lg flex items-center gap-1 space-x-1\\n ${(o().theme==="dark"?"bg-[#2B2B2B] border border-[#3F3F3F]":"bg-white border border-gray-200")??""} ${(i(L)?"cursor-grabbing":"")??""}\\n px-2 py-1 sm:px-3 sm:py-1\\n max-w-[85vw] sm:max-w-none svelte-ue8k6c`),Dt(I,"data-theme",o().theme),Dt(I,"style",`left: ${i(D).x??""}px; 
           top: ${i(D).y??""}px;`),Fi(_e,`w-8 h-8 rounded transition-colors duration-200 flex items-center justify-center
        ${((is=(hn=i(T))==null?void 0:hn.extendData)!=null&&is.manualLock?o().theme==="dark"?"bg-blue-900":"bg-blue-100":o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} svelte-ue8k6c`),Dt(_e,"title",(es=(Gs=i(T))==null?void 0:Gs.extendData)!=null&&es.manualLock?"Unlock selected drawing":"Lock selected drawing"),Fi(Ge,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors duration-200 flex items-center justify-center svelte-ue8k6c`),Dt(Ge,"aria-expanded",i(pe)),ey(Ae,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""}`),Fi(nn,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-red-900":"hover:bg-red-100")??""} transition-colors duration-200
               flex items-center justify-center svelte-ue8k6c`),ey(Xn,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-red-500`)}),Y(E,I)});var Ee=v(ee,2);Ye(Ee,()=>i(M)&&i(C),E=>{var I=OO();I.__click=Za,Ne(()=>Dt(I,"style",`left: ${i(C).x??""}px; top: ${i(C).y??""}px;`)),Y(E,I)});var ht=v(Ee,2);Yv(ht,{get selectedColor(){return i(ae)},set selectedColor(E){x(ae,V(E))},get opacity(){return i(Ie)},set opacity(E){x(Ie,V(E))},get show(){return i(he)},set show(E){x(he,V(E))},$$events:{colorChange:Fl,opacityChange:Oa,close:ni}});var pt=v(ht,2);VB(pt,{get show(){return i(ce)},set show(E){x(ce,V(E))},get position(){return i(je)},set position(E){x(je,V(E))},$$events:{select:Ud}});var Nt=v(pt,2);return ZB(Nt,{get visible(){return i(Vl)},set visible(E){x(Vl,V(E))},get levels(){return i(kr)},set levels(E){x(kr,V(E))},get theme(){return o().theme},$$events:{levelChange:E=>Pd(E.detail.index,E.detail.field,E.detail.value),reset:dd,confirm:Id,cancel:dc}}),Y(n,Kd),Ed({addOverlay:Io,getOverlayLockInfo:Pi,toggleOverlayManualLockById:qs,clickRemove:Za,cloneOverlayById:Wa,copyOverlayById:uu,removeOverlayById:ud,hasCopiedOverlay:Ll,pasteOverlayAtPixel:Ja,pasteOverlayFromClipboard:ga,pasteTextAtPixel:Wu,externalSelectOverlay:Nu,externalDeselectOverlay:hf,externalSyncOverlay:td,externalRemoved:Cc,createTextDrawing:Gd,updateTextDrawing:tu,deleteTextDrawing:Vc,setSelectedDrawing:Yd,enterEditMode:Md,exitEditMode:Au})}Tp(["click","touchstart","touchend","mousedown","change","input"]);const l8={mode:"none",playing:!1,speed:1,replayFrom:null,replayTo:null,replayActive:!1,depositAmount:1e5,leverage:null,currency:"USD",balance:1e5,positions:[],history:[],sidebarOpen:!1,pendingOrders:[],onboardingDone:!1},ih=Fm(l8);function c6(){ih.set(l8)}function c8(n){var t;const e=n.priceCurrency||((t=n.exchange)!=null&&t.toUpperCase().includes("DSE")?"BDT":"USD");ih.update(s=>({...s,currency:e}))}function u8(n){ih.update(e=>({...e,currency:n}))}function d8(n){ih.update(e=>({...e,depositAmount:n,balance:n}))}function f8(n){ih.update(e=>({...e,leverage:n}))}function p8(n){ih.update(e=>({...e,onboardingDone:n}))}function w2(n){ih.update(e=>({...e,mode:n}))}function Xv(n){ih.update(e=>({...e,playing:n}))}function m8(n,e){const t=Number.isFinite(n)&&Number.isFinite(e);ih.update(s=>({...s,replayFrom:t?Number(n):null,replayTo:t?Number(e):null,replayActive:t}))}function WO(){ih.update(n=>({...n,replayFrom:null,replayTo:null,replayActive:!1}))}function u6(n){if(ih.update(e=>({...e,speed:n})),typeof window<"u"&&window.setPlaybackSpeed)try{window.setPlaybackSpeed(n)}catch{}}function h8(n){ih.update(e=>({...e,positions:[...e.positions,n],balance:e.balance-n.avgCost*n.quantity}))}function HO(n,e,t){ih.update(s=>{const o=s.positions.findIndex(d=>d.id===n);if(o===-1)return s;const r=s.positions[o],a=Math.min(e,r.quantity),l=(t-r.avgCost)*a*(r.leverage||1),c=r.quantity-a,f=[...s.positions];c>0?f[o]={...r,quantity:c}:f.splice(o,1);const u={id:n,symbol:r.symbol,quantity:a,avgCost:r.avgCost,closedAvg:t,pnl:l,closedAt:Date.now()};return{...s,positions:f,history:[u,...s.history],balance:s.balance+t*a+l}})}function qO(n){ih.update(e=>({...e,pendingOrders:[...e.pendingOrders||[],n]}))}function yx(n){ih.update(e=>({...e,pendingOrders:(e.pendingOrders||[]).filter(t=>t.id!==n)}))}function i5(n,e,t){e(!1),n.stopPropagation(),t.click&&t.click("close")}var UO=n=>n.stopPropagation(),GO=(n,e,t)=>e(i(t)),YO=Me("<button> </button>"),KO=Me('<div class="modal-action px-4 sm:px-6 py-4 sm:py-5 border-t modal-footer svelte-1a6y34w"><div class="flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end w-full"></div></div>'),XO=Me('<div class="fixed inset-0 z-[350000] flex items-center justify-center px-3 sm:px-4 md:px-6 animate-in fade-in duration-200 modal-overlay svelte-1a6y34w"><div><div class="relative px-4 sm:px-6 py-4 sm:py-5 border-b modal-header svelte-1a6y34w"><div class="flex justify-between items-center gap-4"><div class="flex items-center gap-3 min-w-0 flex-1"><div class="icon-badge svelte-1a6y34w"><svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div> <h3 class="font-bold text-lg sm:text-xl md:text-2xl tracking-tight text-base-content truncate"> </h3></div> <button class="close-btn flex-shrink-0 svelte-1a6y34w" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div><!></div> <!></div></div>');function sg(n,e){Ld(e,!0);let t=pi(e,"width",3,600),s=pi(e,"maxWidth",3,"min(600px, 95vw)"),o=pi(e,"maxHeight",3,"90vh"),r=pi(e,"title",3,""),a=pi(e,"buttons",19,()=>["confirm"]),l=pi(e,"show",15,!1),c=pi(e,"center",3,!1),f=pi(e,"class",3,""),u=pi(e,"theme",3,"dark");function d(w){w==="close"&&l(!1),e.click&&e.click(w)}function h(w){switch(w){case"confirm":return"btn-primary";case"cancel":return"btn-ghost";default:return"btn-secondary"}}var m=Yn(),g=tn(m);Ye(g,l,w=>{var C=XO();C.__click=[i5,l,e];var M=y(C);M.__click=[UO];var P=y(M),T=y(P),N=y(T),L=v(y(N),2),O=y(L,!0);_(L),_(N);var D=v(N,2);D.__click=[i5,l,e],_(T),_(P);var $=v(P,2),z=y($);Ye(z,()=>e.children,pe=>{var J=Yn(),le=tn(J);TC(le,()=>e.children),Y(pe,J)}),_($);var te=v($,2);Ye(te,()=>a().length>0,pe=>{var J=KO(),le=y(J);Ro(le,21,a,fi,(de,he)=>{var ge=YO();const ae=At(()=>`btn-premium ${h(i(he))??""} w-full sm:w-auto sm:min-w-[120px] svelte-1a6y34w`);ge.__click=[GO,d,he];var Ie=y(ge,!0);Ne(()=>tt(Ie,Bg[i(he)]())),_(ge),Ne(()=>Fi(ge,i(ae))),Y(de,ge)}),_(le),_(J),Y(pe,J)}),_(M),_(C),Ne(()=>{Fi(M,`relative rounded-3xl shadow-luxury animate-in zoom-in-95 duration-300 overflow-hidden flex flex-col modal-container ${f()??""} svelte-1a6y34w`),Dt(M,"data-theme",u()),Dt(M,"style",`width: ${(typeof t()=="string"?t():t()+"px")??""}; max-width: ${s()??""}; max-height: ${o()??""};`),tt(O,r()),Fi($,`flex-1 overflow-y-auto premium-scrollbar ${(c()?"flex justify-center items-center":"")??""} px-4 sm:px-6 py-4 sm:py-5 svelte-1a6y34w`)}),Y(w,C)}),Y(n,m),Ed()}Tp(["click"]);const ZO="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let v8=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=ZO[t[n]&63];return e};/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const JO={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var QO=ta("<svg><!><!></svg>");function rh(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]),s=gm(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ld(e,!1);let o=pi(e,"name",8,void 0),r=pi(e,"color",8,"currentColor"),a=pi(e,"size",8,24),l=pi(e,"strokeWidth",8,2),c=pi(e,"absoluteStrokeWidth",8,!1),f=pi(e,"iconNode",24,()=>[]);const u=(...P)=>P.filter((T,N,L)=>!!T&&L.indexOf(T)===N).join(" "),d=a_(),[h,m]=d;_v();var g=QO();let w;var C=y(g);Ro(C,1,f,fi,(P,T)=>{let N=()=>i(T)[0],L=()=>i(T)[1];var O=Yn(),D=tn(O);const $=sv(()=>`${N()}`=="button"?m({...L()},[{attribute_name:"formaction"}]):`${N()}`=="form"?m({...L()},[{attribute_name:"action"}]):`${N()}`=="a"?m({...L()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...L()});RC(D,N,!0,(z,te)=>{let pe;Ne(()=>pe=N6(z,pe,{...i($)},void 0,z.namespaceURI===u3,z.nodeName.includes("-")))}),Y(P,O)});var M=v(C);Lm(M,e,"default",{}),_(g),Ne(()=>w=N6(g,w,{...JO,...s,width:a(),height:a(),stroke:r(),"stroke-width":c()?Number(l())*24/Number(a()):l(),class:u("lucide-icon","lucide",o()?`lucide-${o()}`:"",t.class)},void 0,!0)),Y(n,g),Ed()}function ez(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"activity"},()=>t,{iconNode:[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function tz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"banknote"},()=>t,{iconNode:[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2"}],["circle",{cx:"12",cy:"12",r:"2"}],["path",{d:"M6 12h.01M18 12h.01"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function nz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"camera"},()=>t,{iconNode:[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function sz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"clock"},()=>t,{iconNode:[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function oz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"code-xml"},()=>t,{iconNode:[["path",{d:"m18 16 4-4-4-4"}],["path",{d:"m6 8-4 4 4 4"}],["path",{d:"m14.5 4-5 16"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function iz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"download"},()=>t,{iconNode:[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function rz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"flask-conical"},()=>t,{iconNode:[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2"}],["path",{d:"M6.453 15h11.094"}],["path",{d:"M8.5 2h7"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function az(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"gauge"},()=>t,{iconNode:[["path",{d:"m12 14 4-4"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function lz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"log-out"},()=>t,{iconNode:[["path",{d:"m16 17 5-5-5-5"}],["path",{d:"M21 12H9"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function cz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"maximize"},()=>t,{iconNode:[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function uz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"minimize"},()=>t,{iconNode:[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function dz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"moon"},()=>t,{iconNode:[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function fz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"pause"},()=>t,{iconNode:[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function pz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"play"},()=>t,{iconNode:[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function mz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"save"},()=>t,{iconNode:[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function hz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"search"},()=>t,{iconNode:[["path",{d:"m21 21-4.34-4.34"}],["circle",{cx:"11",cy:"11",r:"8"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function vz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"settings"},()=>t,{iconNode:[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function gz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"sun"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function _z(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"trending-up"},()=>t,{iconNode:[["path",{d:"M16 7h6v6"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function yz(n,e){const t=gm(e,["children","$$slots","$$events","$$legacy"]);rh(n,oh({name:"wallet"},()=>t,{iconNode:[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"}]],children:(o,r)=>{var a=Yn(),l=tn(a);Lm(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}const g8=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VES","VND","VUV","WST","XAF","XCD","XOF","XPF","YER","ZAR","ZMW","ZWL"],_8="smartchart.alerts.v1",E_={rules:{},logs:[],delivery:{},options:{backfill:!1,maxLogs:500},lastFired:{},firedOnce:{}},bz=()=>{if(typeof window>"u"||!window.localStorage)return{...E_};try{const n=localStorage.getItem(_8);if(!n)return{...E_};const e=JSON.parse(n);return{...E_,...e,options:{...E_.options,...e.options||{}},delivery:{...E_.delivery,...e.delivery||{}},rules:e.rules||{},logs:Array.isArray(e.logs)?e.logs:[],lastFired:e.lastFired||{},firedOnce:e.firedOnce||{}}}catch(n){return console.warn("Failed to load alerts state:",n),{...E_}}},xz=n=>{if(!(typeof window>"u"||!window.localStorage))try{localStorage.setItem(_8,JSON.stringify(n))}catch(e){console.warn("Failed to persist alerts state:",e)}},tg=Fm(bz());tg.subscribe(n=>xz(n));const my=Fm(!1),k2=n=>({id:n,enabled:!0,frequency:"once_per_bar",channels:{app:!0,webhook:!1,email:!1,push:!1}}),wz=n=>{tg.update(e=>{const t={...e.rules};for(const s of n){const o=t[s.id];t[s.id]={...o||k2(s.id),...s,channels:{...(o==null?void 0:o.channels)||k2(s.id).channels,...s.channels||{}},enabled:s.enabled??(o==null?void 0:o.enabled)??!0,frequency:s.frequency||(o==null?void 0:o.frequency)||"once_per_bar"}}return e.rules=t,e})},R2=(n,e)=>{tg.update(t=>{const s=t.rules[n]||k2(n);return t.rules={...t.rules,[n]:{...s,...e,channels:{...s.channels,...e.channels||{}}}},t})},by=n=>{tg.update(e=>(e.delivery={...e.delivery,...n},e))},y8=n=>{tg.update(e=>(e.options={...e.options,...n},e))},bx=()=>{tg.update(n=>(n.logs=[],n.lastFired={},n.firedOnce={},n))},kz=()=>{tg.update(n=>(n.lastFired={},n.firedOnce={},n))},Sz=(n,e,t,s)=>{if(!e.enabled||!n.options.backfill&&t<s)return!1;if(e.frequency==="once")return!n.firedOnce[e.id];const o=n.lastFired[e.id];return!(o&&o.index===t)},Cz=(n,e,t,s)=>{n.lastFired[e.id]={index:t,timestamp:s},e.frequency==="once"&&(n.firedOnce[e.id]=!0)},Iz=(n,e,t)=>`${n}_${t}_${e}_${Math.random().toString(36).slice(2,8)}`,b8=n=>{tg.update(e=>{const t=[...n,...e.logs],s=e.options.maxLogs;return e.logs=s>0?t.slice(0,s):t,e})},Pz=async n=>{const e=mm(tg),{events:t,context:s}=n;if(!t.length)return[];const o=[];for(const r of t){const a=String(r.signalId||r.title||r.message||"alert"),l=e.rules[a]||k2(a),c={...l,id:a,title:l.title??r.title,message:l.message??r.message,frequency:r.frequency||l.frequency};if(!Sz(e,c,r.index,s.latestIndex))continue;Cz(e,c,r.index,r.timestamp);const f=[];Object.keys(c.channels).forEach(u=>{const d=c.channels[u];f.push({channel:u,status:d?"pending":"skipped"})}),o.push({id:Iz(a,r.timestamp,r.index),ruleId:a,timestamp:r.timestamp,barIndex:r.index,symbol:s.symbol,timeframe:s.timeframe,title:c.title,message:c.message,price:s.price,deliveries:f})}return o.length?(tg.set(e),b8(o),o):(tg.set(e),[])},x8=async n=>{var s;const e=mm(tg),t=Object.keys(((s=e.rules[n.ruleId])==null?void 0:s.channels)||{}).filter(o=>{var r,a;return(a=(r=e.rules[n.ruleId])==null?void 0:r.channels)==null?void 0:a[o]});if(!t.length)return[];try{const o=await fetch("/api/alerts/deliver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:n,delivery:e.delivery,channels:t})});if(!o.ok)return t.map(a=>({channel:a,status:"failed",detail:`HTTP ${o.status}`}));const r=await o.json();return Array.isArray(r==null?void 0:r.deliveries)?r.deliveries:[]}catch(o){return t.map(r=>({channel:r,status:"failed",detail:(o==null?void 0:o.message)||"Delivery failed"}))}},w8=(n,e)=>{tg.update(t=>(t.logs=t.logs.map(s=>s.id!==n?s:{...s,deliveries:e.length?e:s.deliveries}),t))};function Mz(){my.set(!0)}function Nz(n,e,t,s){u8(i(e)),d8(Math.max(0,Number(i(t))||0)),x(s,2)}function Az(){var n;try{(n=window.predictNextCandle)==null||n.call(window)}catch{}Xv(!0)}function Tz(n){u6(parseFloat(n.target.value))}function Fz(n,e,t,s,o){var c,f;if(!(typeof window<"u"?window.confirm("Exit simulator?"):!0))return;e();const a=t().positions;for(const u of a){try{u.lineOverlayId&&((c=s())==null||c.removeOverlay({id:u.lineOverlayId}))}catch{}try{u.noteOverlayId&&((f=s())==null||f.removeOverlay({id:u.noteOverlayId}))}catch{}}c6();const l=window.sidebarHostRef;l&&l.closeSidebar&&l.closeSidebar()}function Lz(n,e,t,s,o,r,a,l){x(e,!0),x(t,"instant"),x(s,1),x(o,null),x(r,1),x(a,null),x(l,null)}function Ez(n,e,t,s,o,r,a,l,c,f,u,d,h){var L,O;x(e,null);const m=i(t),g=Math.max(0,Number(i(s))||0);if(g<=0||m<=0){x(e,"Invalid quantity");return}if(!o(g,m)){x(e,"Quantity exceeds balance");return}r();const w=v8(),C=a(),M=(L=l())==null?void 0:L.createOverlay({name:"horizontalStraightLine",points:[{value:m}],styles:{line:{style:vt.Dashed,size:1}}}),P=(O=l())==null?void 0:O.createOverlay({name:"note",points:[{timestamp:C,value:m}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),T=Array.isArray(M)?M[0]??void 0:M??void 0,N=Array.isArray(P)?P[0]??void 0:P??void 0;h8({id:w,symbol:f().symbol,quantity:g,avgCost:m,leverage:d().leverage,openedAt:Date.now(),lineOverlayId:T,noteOverlayId:N}),x(h,!1)}function $z(n,e,t,s,o,r,a,l,c,f,u,d,h){var L,O;x(e,null);const m=Math.max(0,Number(i(t))||0),g=Math.max(0,Number(i(s))||0);if(g<=0||m<=0){x(e,"Quantity exceeds balance or invalid price");return}if(!o(g,m)){x(e,"Quantity exceeds balance or invalid price");return}const w=v8(),C=m>=i(r),M=(L=a())==null?void 0:L.createOverlay({name:"horizontalStraightLine",points:[{value:m}],styles:{line:{style:vt.Dashed,size:1}}}),P=(O=a())==null?void 0:O.createOverlay({name:"note",points:[{timestamp:c(),value:m}],extendData:{in_text:"PENDING",in_color:"#f59e0b",line_color:"#f59e0b"}}),T=Array.isArray(M)?M[0]??void 0:M??void 0,N=Array.isArray(P)?P[0]??void 0:P??void 0;qO({id:w,symbol:f().symbol,quantity:g,price:m,leverage:d().leverage,createdAt:Date.now(),triggerUp:C,lineOverlayId:T,noteOverlayId:N}),x(h,!1)}var Dz=Me("<option> </option>"),Rz=Me('<div class="grid grid-cols-1 sm:grid-cols-3 gap-2 items-end w-full"><div class="flex flex-col gap-1"><div class="text-xs opacity-80">Currency</div> <select class="select select-bordered select-sm"></select></div> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm Deposit</button></div>'),jz=(n,e)=>x(e,!0),Bz=(n,e)=>x(e,!1),Oz=Me('<div class="flex items-center gap-2 w-full"><select class="select select-bordered select-sm"><option>1:50</option><option>1:100</option><option>1:200</option><option>1:400</option><option>1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm</button></div>'),zz=(n,e,t)=>{x(e,null),t()},Vz=Me('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm</button>'),Wz=Me('<div class="space-y-2 w-full"><div class="text-sm">Take leverage?</div> <div class="flex items-center gap-2 w-full"><label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">Yes</span></label> <label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">No</span></label></div> <!></div>'),Hz=Me('<span class="text-success"> </span>'),qz=Me('<span class="text-error"> </span>'),Uz=Me("<span>No trades</span>"),Gz=Me('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button"><!></button>'),Yz=Me('<button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button"><!></button>'),Kz=(n,e)=>u6(e),Xz=Me('<button type="button"> </button>'),Zz=(n,e)=>x(e,"portfolio"),Jz=(n,e)=>x(e,"history"),Qz=(n,e,t)=>e(i(t)),eV=Me('<div class="flex items-center justify-between text-sm mt-2 gap-2"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><button class="btn btn-sm btn-premium-ghost svelte-112gz12" type="button">Cancel</button></div></div>'),tV=Me('<div class="card lux-card shadow w-full mb-3 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="text-sm font-semibold">Pending Orders</div> <!></div></div>'),nV=(n,e,t)=>{x(e,""),x(t,0)},sV=Me('<button class="btn btn-xs btn-premium-ghost svelte-112gz12" type="button">Cancel</button>'),oV=(n,e,t)=>e(i(t).id),iV=Me('<button class="btn btn-xs btn-premium-outline svelte-112gz12" type="button">Sell</button>'),rV=(n,e)=>e(!0),aV=(n,e)=>e(!1),lV=Me('<div class="sell-panel w-full mt-2 space-y-3 svelte-112gz12"><div class="sell-section svelte-112gz12"><div class="flex items-center justify-between"><div class="text-xs opacity-70"> </div> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Close All</button></div></div> <div class="sell-section svelte-112gz12"><div class="text-xs opacity-70 mb-2">Close partial position</div> <div class="flex items-center gap-2"><input class="input input-bordered input-sm flex-1" type="number" min="0" placeholder="Partial qty"> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm Partial</button></div> <div class="mt-2 text-xs opacity-70 flex items-center justify-between"><span> </span> <span> </span></div></div></div>'),cV=Me('<div class="card lux-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><div> </div> <!></div></div> <!></div></div>'),uV=Me("<!> <!>",1),dV=Me('<div class="card trade-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 text-sm min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div></div> <div> </div></div> <div class="mt-1 truncate"> </div></div></div>'),fV=Me('<div class="card history-summary-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="grid grid-cols-3 gap-2 items-stretch"><div class="summary-tile win svelte-112gz12"><div class="summary-title svelte-112gz12">Winning</div> <div class="summary-values svelte-112gz12"><div class="badge badge-success text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div class="summary-tile loss svelte-112gz12"><div class="summary-title svelte-112gz12">Losing</div> <div class="summary-values svelte-112gz12"><div class="badge badge-error text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div><div class="summary-title svelte-112gz12">Net</div> <div class="summary-values svelte-112gz12"><div class="summary-amount svelte-112gz12"> </div></div></div></div></div></div> <!>',1),pV=Me('<div class="exit-bar svelte-112gz12"><div class="exit-copy svelte-112gz12">Practice live trading. Check your predictions and improve.</div> <button class="btn btn-sm btn-premium-danger exit-cta svelte-112gz12" type="button"><!> Exit</button></div> <div class="mini-stack grid grid-cols-1 gap-2 w-full svelte-112gz12"><div class="card glass lux-card shadow overflow-hidden mini-tile deposit-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Deposit</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile investment-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Investment <span class="badge badge-outline text-[9px] ml-1"> </span></div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"><!></div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile available-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Available</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div></div> <div class="card speed-card w-full svelte-112gz12"><div class="card-body p-4"><div class="speed-header flex items-center justify-between svelte-112gz12"><div class="flex items-center gap-2"><div class="speed-icon svelte-112gz12"><!></div> <div class="speed-title svelte-112gz12">Playback Speed</div></div> <div class="speed-badge svelte-112gz12"> </div></div> <div class="mt-3 flex items-center gap-3"><input type="range" min="0.5" max="10" step="0.5" class="speed-range flex-1 svelte-112gz12"> <!></div> <div class="mt-2 speed-chips svelte-112gz12"></div></div></div> <div class="card trade-action-card w-full overflow-hidden svelte-112gz12"><div class="card-body p-4 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="badge badge-success badge-outline">LIVE</div></div> <div class="mt-3"><button class="btn btn-premium-primary w-full svelte-112gz12" type="button">Buy Stock</button></div></div></div> <div class="card lux-card shadow w-full svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Alerts</div> <div class="text-sm font-semibold">Script Alerts Center</div></div> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Open</button></div></div></div> <div class="tabs tabs-boxed w-full mt-3 gap-3 svelte-112gz12"><button type="button">Portfolio</button> <button type="button">History</button></div> <!>',1),mV=(n,e)=>x(e,"instant"),hV=(n,e)=>x(e,"pending"),vV=Me('<div class="text-error text-xs mt-1"> </div>'),gV=Me('<div class="space-y-2"><div class="card buy-card svelte-112gz12"><div class="card-body p-3"><div class="flex items-center justify-between"><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-bold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 items-end mt-2"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Confirm Buy</button></div> <!></div></div></div>'),_V=Me('<div class="text-error text-xs"> </div>'),yV=Me('<div class="space-y-2"><div class="grid grid-cols-2 gap-2 items-end"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Custom Price"> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"></div> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Place Pending Buy</button> <!></div>'),bV=Me('<div class="space-y-3"><div class="flex items-center gap-2"><div class="badge badge-outline">Mode</div> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Instant</span></label> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Pending</span></label></div> <!></div>'),xV=Me('<div class="p-4 space-y-4 w-full box-border"><!></div> <!>',1);function wV(n,e){Ld(e,!0);const t=tm(),s=()=>vl(ih,"$simulator",t),o=()=>vl(l,"$save",t),r=()=>vl(a,"$chart",t),a=cd("chart"),l=cd("save");let c=xe(V(s().depositAmount)),f=xe(V(s().currency||o().symbol.priceCurrency||"USD")),u=xe(!1),d=xe(null),h=xe(V(s().onboardingDone?3:1)),m=xe(0),g=null,w=xe(0),C=xe(""),M=xe("portfolio"),P=xe(!1),T=xe("instant"),N=xe(null),L=xe(1),O=xe(1),D=xe(null),$=xe(null);const z=At(()=>(s().positions||[]).length>0),te=At(()=>(s().positions||[]).reduce((Je,Xe)=>Je+(i(m)-Xe.avgCost)*Xe.quantity*(Xe.leverage||1),0)),pe=At(()=>s().history||[]),J=At(()=>i(pe).filter(Je=>Number(Je.pnl)>0).length),le=At(()=>i(pe).filter(Je=>Number(Je.pnl)<0).length),de=At(()=>i(pe).reduce((Je,Xe)=>{const Be=Number(Xe.pnl);return Je+(Number.isFinite(Be)&&Be>0?Be:0)},0)),he=At(()=>i(pe).reduce((Je,Xe)=>{const Be=Number(Xe.pnl);return Je+(Number.isFinite(Be)&&Be<0?Math.abs(Be):0)},0)),ge=At(()=>i(pe).reduce((Je,Xe)=>{const Be=Number(Xe.pnl);return Je+(Number.isFinite(Be)?Be:0)},0)),ae=At(()=>i(ge)+i(te)),Ie=At(()=>((s().speed||.5)-.5)/9.5*100);function ce(){var Xe;const Je=((Xe=r())==null?void 0:Xe.getDataList())||[];return Je.length===0?0:Je[Je.length-1].close}function je(){var Xe;const Je=((Xe=r())==null?void 0:Xe.getDataList())||[];return Je.length===0?Date.now():Je[Je.length-1].timestamp}function Ve(){f8(i(u)?i(d)||100:null),x(h,3),p8(!0)}function We(){var Je;try{(Je=window.stopPrediction)==null||Je.call(window)}catch{}Xv(!1)}function He(){g||(g=setInterval(()=>{var mt,Ce,Te,It,$t;const Je=((mt=r())==null?void 0:mt.getDataList())||[],Xe=Je.length>0?Je[Je.length-1]:null,Be=Xe?Xe.close??0:0,Qe=Xe?Xe.high??Be:Be,ct=Xe?Xe.low??Be:Be;x(m,V(Be));const Mt=[...s().pendingOrders||[]];for(const Yt of Mt)if(Yt.triggerUp?Qe>=Yt.price:ct<=Yt.price){const Vn=s().leverage||1;if(Yt.price*Yt.quantity/Vn<=s().balance){if(Yt.lineOverlayId)try{(Ce=r())==null||Ce.removeOverlay({id:Yt.lineOverlayId})}catch{}if(Yt.noteOverlayId)try{(Te=r())==null||Te.removeOverlay({id:Yt.noteOverlayId})}catch{}yx(Yt.id);const Wn=je(),pn=(It=r())==null?void 0:It.createOverlay({name:"horizontalStraightLine",points:[{value:Yt.price}],styles:{line:{style:vt.Dashed,size:1}}}),gn=($t=r())==null?void 0:$t.createOverlay({name:"note",points:[{timestamp:Wn,value:Yt.price}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),Qs=Array.isArray(pn)?pn[0]??void 0:pn??void 0,Is=Array.isArray(gn)?gn[0]??void 0:gn??void 0;h8({id:Yt.id,symbol:Yt.symbol,quantity:Yt.quantity,avgCost:Yt.price,leverage:Yt.leverage,openedAt:Date.now(),lineOverlayId:Qs,noteOverlayId:Is})}else yx(Yt.id)}},300))}function Ue(){g&&(clearInterval(g),g=null)}Mh(()=>{x(m,V(ce()))}),wr(()=>{s().playing?He():Ue()});function et(Je,Xe){const Be=s().leverage||1;return Xe*Je/Be<=s().balance}function ft(Je){var Xe,Be;try{Je.lineOverlayId&&((Xe=r())==null||Xe.removeOverlay({id:Je.lineOverlayId}))}catch{}try{Je.noteOverlayId&&((Be=r())==null||Be.removeOverlay({id:Je.noteOverlayId}))}catch{}yx(Je.id)}function it(Je){x(C,V(Je)),x(w,0),x(M,"portfolio")}function Lt(Je){var ct,Mt;const Xe=s().positions.find(mt=>mt.id===i(C));if(!Xe)return;const Be=ce(),Qe=Je?Xe.quantity:Math.min(Xe.quantity,Math.max(0,Number(i(w))||0));if(!(Qe<=0)){if(HO(Xe.id,Qe,Be),Qe===Xe.quantity){try{Xe.lineOverlayId&&((ct=r())==null||ct.removeOverlay({id:Xe.lineOverlayId}))}catch{}try{Xe.noteOverlayId&&((Mt=r())==null||Mt.removeOverlay({id:Xe.noteOverlayId}))}catch{}}x(C,""),x(w,0)}}function Tt(Je){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s().currency||"USD",maximumFractionDigits:2}).format(Je)}catch{return`${Je.toFixed(2)} ${s().currency||""}`}}var Pt=xV(),St=tn(Pt),st=y(St);Ye(st,()=>i(h)===1,Je=>{var Xe=Rz(),Be=y(Xe),Qe=v(y(Be),2);Ro(Qe,21,()=>g8,fi,(mt,Ce)=>{var Te=Dz(),It={},$t=y(Te,!0);_(Te),Ne(()=>{It!==(It=i(Ce))&&(Te.value=(Te.__value=i(Ce))==null?"":i(Ce)),tt($t,i(Ce))}),Y(mt,Te)}),_(Qe),_(Be);var ct=v(Be,2);mn(ct);var Mt=v(ct,2);Mt.__click=[Nz,f,c,h],_(Xe),po(Qe,()=>i(f),mt=>x(f,mt)),As(ct,()=>i(c),mt=>x(c,mt)),Y(Je,Xe)},Je=>{var Xe=Yn(),Be=tn(Xe);Ye(Be,()=>i(h)===2,Qe=>{var ct=Wz(),Mt=v(y(ct),2),mt=y(Mt),Ce=y(mt);mn(Ce),Ce.__click=[jz,u],Di(2),_(mt);var Te=v(mt,2),It=y(Te);mn(It),It.__click=[Bz,u],Di(2),_(Te),_(Mt);var $t=v(Mt,2);Ye($t,()=>i(u),Yt=>{var qn=Oz(),Vn=y(qn),Dn=y(Vn);Dn.value=(Dn.__value=50)==null?"":50;var Wn=v(Dn);Wn.value=(Wn.__value=100)==null?"":100;var pn=v(Wn);pn.value=(pn.__value=200)==null?"":200;var gn=v(pn);gn.value=(gn.__value=400)==null?"":400;var Qs=v(gn);Qs.value=(Qs.__value=500)==null?"":500,_(Vn);var Is=v(Vn,2);Is.__click=Ve,_(qn),po(Vn,()=>i(d),Cs=>x(d,Cs)),Y(Yt,qn)},Yt=>{var qn=Vz();qn.__click=[zz,d,Ve],Y(Yt,qn)}),_(ct),Ne(()=>{Av(Ce,i(u)),Av(It,!i(u))}),Y(Qe,ct)},Qe=>{var ct=pV(),Mt=tn(ct),mt=v(y(Mt),2);mt.__click=[Fz,We,s,r,a];var Ce=y(mt);lz(Ce,{size:16}),Di(),_(mt),_(Mt);var Te=v(Mt,2),It=y(Te),$t=y(It),Yt=y($t),qn=y(Yt),Vn=y(qn),Dn=y(Vn);yz(Dn,{size:14}),_(Vn),_(qn);var Wn=v(qn,2),pn=v(y(Wn),2);Ne(()=>Dt(pn,"title",Tt(s().depositAmount)));var gn=y(pn,!0);Ne(()=>tt(gn,Tt(s().depositAmount))),_(pn);var Qs=v(pn,2),Is=y(Qs);Ne(()=>tt(Is,`${Tt(s().depositAmount)??""} • ${s().currency??""}`)),_(Qs),_(Wn),_(Yt),_($t),_(It);var Cs=v(It,2),ro=y(Cs),bs=y(ro),zt=y(bs),Qt=y(zt),ho=y(Qt);_z(ho,{size:14}),_(Qt),_(zt);var ri=v(zt,2),jo=y(ri),Na=v(y(jo)),ar=y(Na);_(Na),_(jo);var Aa=v(jo,2);Ne(()=>Dt(Aa,"title",Tt((s().positions||[]).reduce((Ii,Wo)=>Ii+Wo.avgCost*Wo.quantity,0))));var nr=y(Aa,!0);Ne(()=>tt(nr,Tt((s().positions||[]).reduce((Ii,Wo)=>Ii+Wo.avgCost*Wo.quantity,0)))),_(Aa);var hi=v(Aa,2),Gc=y(hi);Ye(Gc,()=>(s().positions||[]).length>0,Ii=>{var Wo=Yn(),To=tn(Wo);Ye(To,()=>(s().positions||[]).reduce((Ba,Pi)=>Ba+(i(m)-Pi.avgCost)*Pi.quantity*(Pi.leverage||1),0)>=0,Ba=>{var Pi=Hz(),qs=y(Pi);Ne(()=>tt(qs,`+${Tt((s().positions||[]).reduce((mi,Er)=>mi+(i(m)-Er.avgCost)*Er.quantity*(Er.leverage||1),0))??""}`)),_(Pi),Y(Ba,Pi)},Ba=>{var Pi=qz(),qs=y(Pi);Ne(()=>tt(qs,`-${Tt(Math.abs((s().positions||[]).reduce((mi,Er)=>mi+(i(m)-Er.avgCost)*Er.quantity*(Er.leverage||1),0)))??""}`)),_(Pi),Y(Ba,Pi)}),Y(Ii,Wo)},Ii=>{var Wo=Uz();Y(Ii,Wo)}),_(hi),_(ri),_(bs),_(ro),_(Cs);var Pu=v(Cs,2),wc=y(Pu),cc=y(wc),ou=y(cc),zu=y(ou),ja=y(zu);tz(ja,{size:14}),_(zu),_(ou);var nc=v(ou,2),Bc=v(y(nc),2);Ne(()=>Dt(Bc,"title",Tt(s().balance*(s().leverage||1))));var Vu=y(Bc,!0);Ne(()=>tt(Vu,Tt(s().balance*(s().leverage||1)))),_(Bc);var rf=v(Bc,2),co=y(rf);_(rf),_(nc),_(cc),_(wc),_(Pu),_(Te);var ll=v(Te,2),va=y(ll),Vl=y(va),kr=y(Vl),Wr=y(kr),jl=y(Wr);az(jl,{size:16}),_(Wr),Di(2),_(kr);var Xl=v(kr,2),Mu=y(Xl);_(Xl),_(Vl);var Zu=v(Vl,2),xo=y(Zu);mn(xo),xo.__input=[Tz];var Sr=v(xo,2);Ye(Sr,()=>s().playing,Ii=>{var Wo=Gz();Wo.__click=We;var To=y(Wo);fz(To,{size:16}),_(Wo),Y(Ii,Wo)},Ii=>{var Wo=Yz();Wo.__click=[Az];var To=y(Wo);pz(To,{size:16}),_(Wo),Y(Ii,Wo)}),_(Zu);var ql=v(Zu,2);Ro(ql,20,()=>[.5,1,2,5,10],fi,(Ii,Wo)=>{var To=Xz();To.__click=[Kz,Wo];var Ba=y(To);_(To),Ne(()=>{Fi(To,`speed-chip ${(s().speed===Wo?"active":"")??""} svelte-112gz12`),tt(Ba,`${Wo??""}x`)}),Y(Ii,To)}),_(ql),_(va),_(ll);var $f=v(ll,2),Cf=y($f),tp=y(Cf),mf=y(tp),sc=v(y(mf),2);Ne(()=>Dt(sc,"title",i(m).toFixed(2)));var yd=y(sc,!0);Ne(()=>tt(yd,i(m).toFixed(2))),_(sc),_(mf),Di(2),_(tp);var If=v(tp,2),En=y(If);En.__click=[Lz,P,T,L,N,O,D,$],_(If),_(Cf),_($f);var ms=v($f,2),js=y(ms),Nn=y(js),Io=v(y(Nn),2);Io.__click=[Mz],_(Nn),_(js),_(ms);var fo=v(ms,2),Ji=y(fo);Ji.__click=[Zz,M];var Gi=v(Ji,2);Gi.__click=[Jz,M],_(fo);var Al=v(fo,2);Ye(Al,()=>i(M)==="portfolio",Ii=>{var Wo=uV(),To=tn(Wo);Ye(To,()=>(s().pendingOrders||[]).length>0,Pi=>{var qs=tV(),mi=y(qs),Er=v(y(mi),2);Ro(Er,1,()=>s().pendingOrders,fi,(Za,vi)=>{var $r=eV(),Il=y($r),cl=y(Il),kc=y(cl,!0);_(cl);var uc=v(cl,2),Tl=y(uc);_(uc);var ur=v(uc,2),la=y(ur);Ne(()=>tt(la,`Price ${i(vi).price.toFixed(2)??""}`)),_(ur),_(Il);var Fl=v(Il,2),Oa=y(Fl);Oa.__click=[Qz,ft,vi],_(Fl),_($r),Ne(()=>{tt(kc,i(vi).symbol.ticker),tt(Tl,`Qty ${i(vi).quantity??""}`)}),Y(Za,$r)}),_(mi),_(qs),Y(Pi,qs)});var Ba=v(To,2);Ro(Ba,1,()=>s().positions,fi,(Pi,qs)=>{var mi=cV(),Er=y(mi),Za=y(Er),vi=y(Za),$r=y(vi),Il=y($r,!0);_($r);var cl=v($r,2),kc=y(cl);_(cl);var uc=v(cl,2),Tl=y(uc);Ne(()=>tt(Tl,`Avg ${i(qs).avgCost.toFixed(2)??""}`)),_(uc);var ur=v(uc,2),la=y(ur);_(ur),_(vi);var Fl=v(vi,2),Oa=y(Fl),ni=y(Oa);Ne(()=>tt(ni,`${((i(m)-i(qs).avgCost)*i(qs).quantity*(i(qs).leverage||1)>=0?"+":"")??""}${((i(m)-i(qs).avgCost)*i(qs).quantity*(i(qs).leverage||1)).toFixed(2)??""}`)),_(Oa);var vc=v(Oa,2);Ye(vc,()=>i(C)===i(qs).id,za=>{var sl=sV();sl.__click=[nV,C,w],Y(za,sl)},za=>{var sl=iV();sl.__click=[oV,it,qs],Y(za,sl)}),_(Fl),_(Za);var gl=v(Za,2);Ye(gl,()=>i(C)===i(qs).id,za=>{var sl=lV(),Oc=y(sl),Va=y(Oc),Wa=y(Va),uu=y(Wa);_(Wa);var ud=v(Wa,2);ud.__click=[rV,Lt],_(Va),_(Oc);var Ll=v(Oc,2),vu=v(y(Ll),2),Sc=y(vu);mn(Sc);var Ja=v(Sc,2);Ja.__click=[aV,Lt],Ne(()=>Ja.disabled=!i(w)||Number(i(w))<=0||Number(i(w))>i(qs).quantity),_(vu);var ga=v(vu,2),Wu=y(ga),zc=y(Wu);_(Wu);var eu=v(Wu,2),Ud=y(eu);Ne(()=>tt(Ud,`Est. PnL: ${((i(m)-i(qs).avgCost)*(Number(i(w))||0)*(i(qs).leverage||1)).toFixed(2)??""}`)),_(eu),_(ga),_(Ll),_(sl),Ne(()=>{tt(uu,`Close entire position (${i(qs).quantity??""})`),Dt(Sc,"max",i(qs).quantity),tt(zc,`Available: ${i(qs).quantity??""}`)}),As(Sc,()=>i(w),qf=>x(w,qf)),Y(za,sl)}),_(Er),_(mi),Ne(()=>{tt(Il,i(qs).symbol.ticker),tt(kc,`Qty ${i(qs).quantity??""}`),tt(la,`Lev ${(i(qs).leverage||1)??""}x`),Fi(Oa,`badge ${((i(m)-i(qs).avgCost)*i(qs).quantity*(i(qs).leverage||1)>=0?"badge-success":"badge-error")??""}`)}),Y(Pi,mi)}),Y(Ii,Wo)},Ii=>{var Wo=fV(),To=tn(Wo),Ba=y(To),Pi=y(Ba),qs=y(Pi),mi=v(y(qs),2),Er=y(mi),Za=y(Er,!0);_(Er);var vi=v(Er,2);Ne(()=>Dt(vi,"title",Tt(i(de))));var $r=y(vi,!0);Ne(()=>tt($r,Tt(i(de)))),_(vi),_(mi),_(qs);var Il=v(qs,2),cl=v(y(Il),2),kc=y(cl),uc=y(kc,!0);_(kc);var Tl=v(kc,2);Ne(()=>Dt(Tl,"title",Tt(i(he))));var ur=y(Tl,!0);Ne(()=>tt(ur,Tt(i(he)))),_(Tl),_(cl),_(Il);var la=v(Il,2),Fl=v(y(la),2),Oa=y(Fl);Ne(()=>Dt(Oa,"title",Tt(i(ae))));var ni=y(Oa);Ne(()=>tt(ni,`${(i(ae)>=0?"+":"")??""}${Tt(i(ae))??""}`)),_(Oa),_(Fl),_(la),_(Pi),_(Ba),_(To);var vc=v(To,2);Ro(vc,1,()=>s().history,fi,(gl,za)=>{var sl=dV(),Oc=y(sl),Va=y(Oc),Wa=y(Va),uu=y(Wa),ud=y(uu,!0);_(uu);var Ll=v(uu,2),vu=y(Ll);_(Ll),_(Wa);var Sc=v(Wa,2),Ja=y(Sc);Ne(()=>tt(Ja,`${(i(za).pnl>=0?"+":"")??""}${i(za).pnl.toFixed(2)??""}`)),_(Sc),_(Va);var ga=v(Va,2);const Wu=At(()=>i(za).avgCost.toFixed(2)??""),zc=At(()=>i(za).closedAvg.toFixed(2)??"");var eu=y(ga);Ne(()=>tt(eu,`Buy ${i(Wu)} • Sell ${i(zc)}`)),_(ga),_(Oc),_(sl),Ne(()=>{tt(ud,i(za).symbol.ticker),tt(vu,`Qty ${i(za).quantity??""}`),Fi(Sc,`badge ${(i(za).pnl>=0?"badge-success":"badge-error")??""}`)}),Y(gl,sl)}),Ne(()=>{tt(Za,i(J)),tt(uc,i(le)),Fi(la,`summary-tile net ${(i(ae)>=0?"pos":"neg")??""} svelte-112gz12`)}),Y(Ii,Wo)}),Ne(()=>{rr(Cs,"pos",i(z)&&i(te)>=0),rr(Cs,"neg",i(z)&&i(te)<0),tt(ar,`Open ${(s().positions||[]).length??""}`),tt(co,`Leverage ${(s().leverage||1)??""}x`),tt(Mu,`${s().speed??""}x`),Hf(xo,s().speed),Dt(xo,"style",`background: linear-gradient(to right, var(--menu-active-bg) ${i(Ie)}%, var(--menu-btn-bg) ${i(Ie)}%);`),Fi(Ji,`tab ${(i(M)==="portfolio"?"tab-active":"")??""} svelte-112gz12`),Fi(Gi,`tab ${(i(M)==="history"?"tab-active":"")??""} svelte-112gz12`)}),Y(Qe,ct)},!0),Y(Je,Xe)}),_(St);var xt=v(St,2);Ye(xt,()=>i(P),Je=>{sg(Je,{title:"Place Buy Order",buttons:[],get show(){return i(P)},set show(Xe){x(P,V(Xe))},get theme(){return o().theme},children:(Xe,Be)=>{var Qe=bV(),ct=y(Qe),Mt=v(y(ct),2),mt=y(Mt);mn(mt),mt.__click=[mV,T],Di(2),_(Mt);var Ce=v(Mt,2),Te=y(Ce);mn(Te),Te.__click=[hV,T],Di(2),_(Ce),_(ct);var It=v(ct,2);Ye(It,()=>i(T)==="instant",$t=>{var Yt=gV(),qn=y(Yt),Vn=y(qn),Dn=y(Vn),Wn=v(y(Dn),2);Ne(()=>Dt(Wn,"title",i(m).toFixed(2)));var pn=y(Wn,!0);Ne(()=>tt(pn,i(m).toFixed(2))),_(Wn),_(Dn);var gn=v(Dn,2),Qs=y(gn);mn(Qs);var Is=v(Qs,2);Is.__click=[Ez,D,m,L,et,We,je,r,a,o,l,s,P],_(gn);var Cs=v(gn,2);Ye(Cs,()=>i(D),ro=>{var bs=vV(),zt=y(bs,!0);_(bs),Ne(()=>tt(zt,i(D))),Y(ro,bs)}),_(Vn),_(qn),_(Yt),As(Qs,()=>i(L),ro=>x(L,ro)),Y($t,Yt)},$t=>{var Yt=yV(),qn=y(Yt),Vn=y(qn);mn(Vn);var Dn=v(Vn,2);mn(Dn),_(qn);var Wn=v(qn,2);Wn.__click=[$z,$,N,O,et,m,r,a,je,o,l,s,P];var pn=v(Wn,2);Ye(pn,()=>i($),gn=>{var Qs=_V(),Is=y(Qs,!0);_(Qs),Ne(()=>tt(Is,i($))),Y(gn,Qs)}),_(Yt),As(Vn,()=>i(N),gn=>x(N,gn)),As(Dn,()=>i(O),gn=>x(O,gn)),Y($t,Yt)}),_(Qe),Ne(()=>{Av(mt,i(T)==="instant"),Av(Te,i(T)==="pending")}),Y(Xe,Qe)},$$slots:{default:!0}})}),Y(n,Pt),Ed()}Tp(["click","input"]);var kV=Me('<div class="top-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Watch List"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M8 6H21M8 12H21M8 18H21M3 6H3.01M3 12H3.01M3 18H3.01" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Watch</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Alerts"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M18 8A6 6 0 0 0 6 8C6 15 3 17 3 17H21S18 15 18 8Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M13.73 21A2 2 0 0 1 10.27 21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Alerts</span></button> <button class="sidebar-icon ask-ai-btn svelte-3gnxyq" title="Ask AI"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" fill="currentColor" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Ask AI</span></button></div></div> <div class="bottom-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Calendar"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></line></svg> <span class="sidebar-label svelte-3gnxyq">Calendar</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Portfolio"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="2" y="7" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><path d="M16 21V5A2 2 0 0 0 14 3H10A2 2 0 0 0 8 5V21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Portfolio</span></button></div></div>',1),SV=Me("<div><!></div>");function CV(n,e){Ld(e,!1);const t=tm(),s=()=>vl(a,"$save",t),o=()=>vl(ih,"$simulator",t);let r=pi(e,"className",8,"");const a=cd("save");_v();var l=SV(),c=y(l);Ye(c,()=>o().mode==="strategy",f=>{wV(f,{})},f=>{var u=kV(),d=tn(u),h=y(d),m=v(y(h),2);Di(2),_(h),_(d),Di(2),ld("click",m,()=>my.set(!0)),Y(f,u)}),_(l),Ne(()=>{Fi(l,`right-sidebar hidden md:flex ${r()??""} svelte-3gnxyq`),Dt(l,"data-theme",s().theme)}),Y(n,l),Ed()}function IV(n,e){n.preventDefault(),n.stopPropagation(),e("double-click")}var PV=Me('<div role="separator" aria-orientation="vertical" aria-label="Resize sidebar" tabindex="0"><div class="resize-indicator svelte-uwsrre"><div class="resize-dots svelte-uwsrre"><div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div></div></div></div>');function MV(n,e){Ld(e,!0);let t=pi(e,"className",3,"");const s=Hh();let o=xe(!1),r=0,a=0,l;const c=180,f=480,u=12;function d(T){if(T.button!==0)return;T.preventDefault(),T.stopPropagation(),x(o,!0),r=T.clientX;const N=l.closest(".sidebar-container");N&&(a=N.offsetWidth),l.setPointerCapture(T.pointerId),document.body.style.userSelect="none",document.body.style.pointerEvents="none",l.style.pointerEvents="auto",s("resize:start",{widthPx:a})}function h(T){if(!i(o))return;T.preventDefault(),T.stopPropagation();const N=T.clientX-r,L=Math.max(c,Math.min(f,a-N));requestAnimationFrame(()=>{s("resize:move",{widthPx:L})})}function m(T){if(!i(o))return;T.preventDefault(),T.stopPropagation(),x(o,!1),l.releasePointerCapture(T.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="";const N=T.clientX-r,L=Math.max(c,Math.min(f,a-N));s("resize:end",{widthPx:L})}function g(T){i(o)&&(x(o,!1),l.releasePointerCapture(T.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="",s("resize:end",{widthPx:a}))}function w(T){if(!["ArrowLeft","ArrowRight"].includes(T.key))return;T.preventDefault(),T.stopPropagation();const N=l.closest(".sidebar-container");if(!N)return;const L=N.offsetWidth;let O=L;T.key==="ArrowLeft"?O=Math.min(f,L+u):T.key==="ArrowRight"&&(O=Math.max(c,L-u)),O!==L&&(s("resize:start",{widthPx:L}),s("resize:move",{widthPx:O}),s("resize:end",{widthPx:O}))}function C(){}function M(){}var P=PV();P.__pointerdown=d,P.__pointermove=h,P.__pointerup=m,P.__dblclick=[IV,s],P.__keydown=w,ep(P,T=>l=T,()=>l),Ne(()=>{Fi(P,`sidebar-resize-handle ${t()??""} svelte-uwsrre`),rr(P,"dragging",i(o))}),ld("pointercancel",P,g),ld("focus",P,C),ld("blur",P,M),Y(n,P),Ed()}Tp(["pointerdown","pointermove","pointerup","dblclick","keydown"]);const xy=180,j2=480,hy=280;function k8(n,e=xy,t=j2,s=hy){return isNaN(n)||n<e||n>t?s:n}function S8(){return typeof window<"u"&&window.__sidebarBootstrap?window.__sidebarBootstrap:{visible:!1,widthPx:0,transitionsEnabled:!1}}function d6(n){if(typeof window<"u"){window.__sidebarBootstrap||(window.__sidebarBootstrap=S8()),window.__sidebarBootstrap={...window.__sidebarBootstrap,...n};const e=document.documentElement,t=window.__sidebarBootstrap,s=t.visible?t.widthPx+"px":"0px",o=t.visible?"1":"0";e.style.setProperty("--sidebar-width",s),e.style.setProperty("--sidebar-visible",o),e.style.setProperty("--chart-sidebar-width",s),e.style.setProperty("--chart-sidebar-visible",o)}}function NV(n,e){if(typeof window<"u"&&window.localStorage)try{if(localStorage.setItem("dutyai.chart.sidebar.visible","false"),n){const t=k8(e,xy,j2,hy);localStorage.setItem("dutyai.chart.sidebar.widthPx",String(t))}}catch(t){console.warn("Failed to persist sidebar state:",t)}}function AV(){if(typeof window>"u")return!0;const n=window.innerWidth,s=xy+80+300;return n>=s}function r5(){d6({transitionsEnabled:!0})}function TV(){d6({transitionsEnabled:!1})}function Nb(n,e){const t=e!==void 0?e:n?hy:0;d6({visible:n,widthPx:n?k8(t,xy,j2,hy):0}),NV(n,t)}const FV={MIN_WIDTH:xy,MAX_WIDTH:j2,DEFAULT_WIDTH:hy,PRICE_SCALE_WIDTH:80};class LV{constructor(){$e(this,"pending",!1);$e(this,"callbacks",[]);$e(this,"keyedCallbacks",new Map);$e(this,"rafId",null)}request(e){this.callbacks.push(e),this.schedule()}requestKey(e,t){this.keyedCallbacks.set(e,t),this.schedule()}schedule(){this.pending||(this.pending=!0,this.rafId=requestAnimationFrame(()=>{this.flush()}))}async flush(){this.pending=!1,this.rafId=null;const e=this.callbacks;this.callbacks=[];const t=Array.from(this.keyedCallbacks.values());this.keyedCallbacks.clear();for(const s of e)try{await s()}catch(o){console.error("RenderScheduler: Error executing callback",o)}for(const s of t)try{await s()}catch(o){console.error("RenderScheduler: Error executing callback",o)}}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.callbacks=[],this.keyedCallbacks.clear()}isPending(){return this.pending}immediate(e){requestAnimationFrame(async()=>{try{await e()}catch(t){console.error("RenderScheduler: Error executing immediate callback",t)}})}}let xx=null;function B2(){return xx||(xx=new LV),xx}class EV{constructor(){$e(this,"scheduler",B2());$e(this,"inProgress",!1);$e(this,"queue",[])}async run(e){if(this.inProgress){this.queue.push(e);return}this.inProgress=!0;try{await this.executeTransaction(e)}finally{if(this.inProgress=!1,this.queue.length>0){const t=this.queue.shift();this.run(t)}}}async executeTransaction(e){const{reason:t,chart:s,mutateState:o,measure:r,compute:a,draw:l,commit:c,cleanup:f,skipTransitions:u}=e;console.log(`🔄 RenderTransaction [${t}] starting...`);const d=performance.now();this.scheduler.request(async()=>{try{o&&await o(),r&&await r(),a&&await a(),l&&s&&await l(s),c&&await c();const h=performance.now()-d;console.log(`✅ RenderTransaction [${t}] completed in ${h.toFixed(2)}ms`)}catch(h){console.error(`❌ RenderTransaction [${t}] failed:`,h)}finally{f&&f()}})}async batch(e){if(e.length===0)return;const t={reason:e[0].reason,chart:e[0].chart,mutateState:async()=>{for(const s of e)s.mutateState&&await s.mutateState()},measure:async()=>{for(const s of e)s.measure&&await s.measure()},compute:async()=>{for(const s of e)s.compute&&await s.compute()},draw:async s=>{for(const o of e)o.draw&&await o.draw(s)},commit:async()=>{for(const s of e)s.commit&&await s.commit()},cleanup:()=>{for(const s of e)s.cleanup&&s.cleanup()}};await this.run(t)}isInProgress(){return this.inProgress}getQueueLength(){return this.queue.length}}let wx=null;function $V(){return wx||(wx=new EV),wx}class DV{constructor(){$e(this,"states",new Map);$e(this,"transitionProperty","transition")}register(e,t){this.states.set(e,{enabled:!1,element:t})}disable(e){const t=this.states.get(e);t&&(t.enabled=!1,t.element&&this.applyTransitionStyle(t.element,"none"))}enable(e){const t=this.states.get(e);t&&(t.enabled=!0,t.element&&this.applyTransitionStyle(t.element,""))}withoutTransitions(e,t){this.disable(e);const s=t();return requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})}),s}applyLayout(e,t,s=!0){this.disable(e),t(),s&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})})}isEnabled(e){var t;return((t=this.states.get(e))==null?void 0:t.enabled)??!1}updateElement(e,t){const s=this.states.get(e);s?(s.element=t,s.enabled?this.applyTransitionStyle(t,""):this.applyTransitionStyle(t,"none")):this.register(e,t)}applyTransitionStyle(e,t){e.style.setProperty(this.transitionProperty,t)}clear(){this.states.clear()}getKeys(){return Array.from(this.states.keys())}}let kx=null;function C8(){return kx||(kx=new DV),kx}class RV{constructor(){$e(this,"rafId",null);$e(this,"pending",!1);$e(this,"lastArgs",null)}throttle(e,...t){this.lastArgs=t,!this.pending&&(this.pending=!0,this.rafId=requestAnimationFrame(async()=>{this.pending=!1,this.rafId=null;const s=this.lastArgs;this.lastArgs=null;try{await e(...s)}catch(o){console.error("Throttler: Error executing function",o)}}))}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.lastArgs=null}isPending(){return this.pending}}class jV{constructor(){$e(this,"transaction",$V());$e(this,"layoutManager",C8());$e(this,"scheduler",B2());$e(this,"applyCanvasColorsFn",null)}async waitIndicatorReady(e,t,s,o=800){var a;const r=Date.now();for(;Date.now()-r<o;){try{const l=((a=e.getIndicators)==null?void 0:a.call(e,{name:t,paneId:s}))??[];if(l.length>0&&l.some(f=>f&&f.result&&Object.keys(f.result).length>0))return}catch{}await new Promise(l=>setTimeout(l,16))}}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e}reapplyCanvasColors(){this.applyCanvasColorsFn&&this.applyCanvasColorsFn()}async addIndicator(e){let t=null;return await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{t=e.chart.createIndicator({name:e.name,calcParams:e.params},e.isMain??!1,e.paneId?{id:e.paneId}:void 0)},compute:async()=>{await this.waitIndicatorReady(e.chart,e.name,e.paneId)},commit:()=>{console.log(`✅ Indicator added: ${e.name} (${t})`),this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}}),t}async removeIndicator(e){await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{e.chart.removeIndicator({paneId:e.paneId,name:e.name})},commit:()=>{console.log(`✅ Indicator removed: ${e.name}`)}})}async changeTimeframe(e){let t=null;try{t=Promise.resolve(e.loadDataFn()).catch(s=>{throw console.error("❌ Timeframe load failed:",s),s})}catch(s){console.error("❌ Timeframe load failed to start:",s),t=Promise.reject(s)}await this.transaction.run({reason:"timeframe",chart:e.chart,compute:async()=>{t&&await t},commit:()=>{console.log("✅ Timeframe changed"),e.skipCanvasReapply||this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}})}async switchChartType(e){await this.transaction.run({reason:"type",chart:e.chart,mutateState:()=>{},compute:async()=>{await e.reloadDataFn()},commit:()=>{console.log(`✅ Chart type switched to: ${e.newType}`),this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}})}async sidebarOperation(e){const t="sidebar";this.layoutManager.register(t),await this.transaction.run({reason:"sidebar",chart:e.chart,skipTransitions:!0,mutateState:()=>{this.layoutManager.disable(t)},measure:()=>{},commit:()=>{this.scheduler.requestKey("sidebar:resize",()=>{e.chart.resize(),this.reapplyCanvasColors(),requestAnimationFrame(()=>{this.layoutManager.enable(t)})})}})}async changeTheme(e,t){await this.transaction.run({reason:"theme",chart:e,mutateState:()=>{t()},commit:()=>{console.log("✅ Theme changed")}})}resizeChart(e){this.scheduler.requestKey("chart:resize",()=>{e.resize()})}async batchIndicatorOperations(e){const t=e.map(s=>({reason:"indicator",chart:s.operation.chart,mutateState:()=>{s.type==="add"?s.operation.chart.createIndicator({name:s.operation.name,calcParams:s.operation.params},s.operation.isMain??!1,s.operation.paneId?{id:s.operation.paneId}:void 0):s.operation.chart.removeIndicator({paneId:s.operation.paneId,name:s.operation.name})}}));await this.transaction.batch(t)}}let Sx=null;function f6(){return Sx||(Sx=new jV),Sx}var BV=Me('<div class="sidebar-container svelte-1chwdug"><!> <!></div>'),OV=Me("<div><!></div>");function zV(n,e){Ld(e,!0);const t=tm(),s=()=>vl(c,"$chart",t),o=()=>vl(w,"$sidebarWidth",t),r=()=>vl(C,"$sidebarState",t),a=()=>vl(f,"$save",t);let l=pi(e,"className",3,"");const c=cd("chart"),f=cd("save"),{MIN_WIDTH:u,MAX_WIDTH:d,DEFAULT_WIDTH:h,PRICE_SCALE_WIDTH:m}=FV,g=S8(),w=Fm(g.widthPx);f.update(Ue=>(Ue.showSidebar=g.visible,Ue));const C=hp([f,w],([Ue,et])=>({visible:Ue.showSidebar,widthPx:et})),M=Hh();let P=xe(!1);f6();const T=B2(),N=C8(),L=new RV;N.register("sidebar");function O(){var Ue;if(!AV())return!1;if(typeof window<"u"){const et=(Ue=window.matchMedia)==null?void 0:Ue.call(window,"(min-width: 768px)");if(et&&!et.matches)return!1}return!0}function D(){s()&&T.requestKey("sidebar:resize",()=>{var Ue;(Ue=s())==null||Ue.resize()})}function $(){s()&&L.throttle(()=>{T.requestKey("sidebar:resize",()=>{var Ue;(Ue=s())==null||Ue.resize()})})}function z(){if(!O()){f.update(et=>(et.showSidebar=!1,et)),Nb(!1,0),M("sidebar:toggle",{visible:!1});return}if(!s())return;const Ue=o()||h;N.enable("sidebar"),f.update(et=>(et.showSidebar=!0,et)),w.set(Ue),Nb(!0,Ue),M("sidebar:toggle",{visible:!0}),requestAnimationFrame(()=>{D(),setTimeout(()=>{D()},100),setTimeout(()=>{D()},250)})}function te(){f.update(Ue=>(Ue.showSidebar=!1,Ue)),Nb(!1,0),M("sidebar:toggle",{visible:!1}),s()&&(N.enable("sidebar"),requestAnimationFrame(()=>{D(),setTimeout(()=>{D()},100),setTimeout(()=>{D()},250)}))}function pe(){if(!O()){te();return}r().visible?te():z()}function J(Ue){const et=Math.max(u,Math.min(d,Ue));w.set(et),a().showSidebar&&Nb(!0,et),M("sidebar:resize:move",{widthPx:et}),$()}function le(){return r()}function de(Ue){N.disable("sidebar"),TV(),M("sidebar:resize:start",{widthPx:o()})}function he(Ue){const et=Ue.detail.widthPx;J(et)}function ge(Ue){i(P)&&(N.enable("sidebar"),r5()),M("sidebar:resize:end",{widthPx:o()})}function ae(){J(h)}function Ie(){!O()&&a().showSidebar&&te()}function ce(Ue){if(Ue.key==="S"&&!Ue.ctrlKey&&!Ue.metaKey&&!Ue.altKey){const et=Ue.target;et.tagName!=="INPUT"&&et.tagName!=="TEXTAREA"&&!et.isContentEditable&&(Ue.preventDefault(),pe())}}Mh(()=>{(async()=>(N.disable("sidebar"),await o2(),Ie(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(P,!0),N.enable("sidebar"),r5(),console.log("✨ Sidebar transitions enabled"),s()&&D()})})))();const Ue=()=>{Ie()};return window.addEventListener("resize",Ue),window.addEventListener("keydown",ce),()=>{window.removeEventListener("resize",Ue),window.removeEventListener("keydown",ce),L.cancel()}});const je=At(()=>()=>{const Ue=r().visible?`${o()}px`:"0px";return{"--sidebar-width":Ue,"--sidebar-visible":r().visible?"1":"0","--sidebar-transitions":i(P)?"width 200ms cubic-bezier(0.4, 0, 0.2, 1)":"none",width:Ue}});var Ve=OV();const We=At(()=>Object.entries(i(je)).map(([Ue,et])=>`${Ue}: ${et}`).join("; "));var He=y(Ve);return Ye(He,()=>r().visible,Ue=>{var et=BV(),ft=y(et);CV(ft,{});var it=v(ft,2);MV(it,{$$events:{"resize:start":de,"resize:move":he,"resize:end":ge,"double-click":ae}}),_(et),Ne(()=>Dt(et,"style",`width: ${o()??""}px;`)),Y(Ue,et)}),_(Ve),Ne(()=>{Fi(Ve,`sidebar-host ${l()??""} svelte-1chwdug`),Dt(Ve,"style",i(We))}),Y(n,Ve),Ed({openSidebar:z,closeSidebar:te,toggleSidebar:pe,setSidebarWidth:J,getSidebarState:le})}var VV=(n,e)=>x(e,"rules"),WV=(n,e)=>x(e,"delivery"),HV=(n,e)=>x(e,"logs"),qV=Me('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alert rules found</div> <div class="desc svelte-kd3mpt">Add alertcondition() or alert() in JS/Pine to populate rules.</div></div>'),UV=(n,e)=>R2(i(e).id,{enabled:n.target.checked}),GV=(n,e)=>R2(i(e).id,{frequency:n.target.value}),YV=Me("<option> </option>"),KV=(n,e)=>R2(i(e).id,{message:n.target.value}),XV=(n,e,t)=>R2(i(e).id,{channels:{[i(t)]:n.target.checked}}),ZV=Me('<label class="channel svelte-kd3mpt"><input type="checkbox"> <span> </span></label>'),JV=(n,e,t)=>e(i(t)),QV=Me('<div class="rule-card svelte-kd3mpt"><div class="rule-head svelte-kd3mpt"><div><div class="rule-title svelte-kd3mpt"> </div> <div class="rule-message svelte-kd3mpt"> </div></div> <label class="switch svelte-kd3mpt"><input type="checkbox" class="svelte-kd3mpt"> <span class="slider svelte-kd3mpt"></span></label></div> <div class="rule-row svelte-kd3mpt"><label>Frequency</label> <select class="svelte-kd3mpt"></select></div> <div class="rule-row svelte-kd3mpt"><label>Message</label> <input type="text" placeholder="Alert message" class="svelte-kd3mpt"></div> <div class="channels svelte-kd3mpt"></div> <button class="btn-test svelte-kd3mpt">Test alert</button></div>'),eW=Me('<div class="rules-grid svelte-kd3mpt"></div>'),tW=Me('<div class="alerts-panel svelte-kd3mpt"><!></div>'),nW=n=>by({webhookUrl:n.target.value}),sW=n=>by({emailEndpoint:n.target.value}),oW=n=>by({emailTo:n.target.value}),iW=n=>by({pushEndpoint:n.target.value}),rW=n=>by({pushTarget:n.target.value}),aW=n=>y8({backfill:n.target.checked}),lW=n=>y8({maxLogs:Number(n.target.value)||500}),cW=Me('<div class="alerts-panel svelte-kd3mpt"><div class="delivery-grid svelte-kd3mpt"><div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Webhook</div> <input type="text" placeholder="https://your-webhook-url" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Email (HTTP endpoint)</div> <input type="text" placeholder="https://email-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="to@example.com" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Push (HTTP endpoint)</div> <input type="text" placeholder="https://push-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="push target / token" class="svelte-kd3mpt"></div></div> <div class="options-row svelte-kd3mpt"><label class="option svelte-kd3mpt"><input type="checkbox"> <span>Backfill historical alerts</span></label> <label class="option svelte-kd3mpt"><span>Max logs</span> <input type="number" min="50" max="2000" class="svelte-kd3mpt"></label></div></div>'),uW=Me('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alerts yet</div> <div class="desc svelte-kd3mpt">Triggered alerts will appear here.</div></div>'),dW=Me("<span> </span>"),fW=Me('<div class="log-item svelte-kd3mpt"><div class="log-main"><div class="log-title svelte-kd3mpt"> </div> <div class="log-meta svelte-kd3mpt"> </div> <div class="log-message svelte-kd3mpt"> </div></div> <div class="log-deliveries svelte-kd3mpt"></div></div>'),pW=Me('<div class="logs-list svelte-kd3mpt"></div>'),mW=Me('<div class="alerts-panel logs-panel svelte-kd3mpt"><div class="logs-header svelte-kd3mpt"><div class="logs-title svelte-kd3mpt">Alert Logs</div> <button class="btn-clear svelte-kd3mpt">Clear</button></div> <!></div>'),hW=Me('<div class="alerts-shell svelte-kd3mpt"><div class="alerts-tabs svelte-kd3mpt"><button class="svelte-kd3mpt">Rules</button> <button class="svelte-kd3mpt">Delivery</button> <button class="svelte-kd3mpt">Logs</button></div> <!></div>');function vW(n,e){Ld(e,!0);const t=tm(),s=()=>vl(my,"$alertCenterUi",t),o=()=>vl(a,"$save",t),r=()=>vl(tg,"$alertCenter",t),a=cd("save");let l=xe(!1),c=xe("rules");wr(()=>{x(l,V(s()))}),wr(()=>{s()!==i(l)&&my.set(i(l))});const f={once_per_bar:"Once per bar",once_per_bar_close:"Once per bar close",once:"Once only"},u={app:"App",webhook:"Webhook",email:"Email",push:"Push"},d=g=>!g||!Number.isFinite(g)?"-":new Date(g).toLocaleString(),h=g=>g.title||g.id,m=async g=>{var P,T,N,L,O,D;const w=Date.now(),C={id:`${g.id}_${w}`,ruleId:g.id,timestamp:w,barIndex:void 0,symbol:((T=(P=o())==null?void 0:P.symbol)==null?void 0:T.ticker)||((L=(N=o())==null?void 0:N.symbol)==null?void 0:L.name),timeframe:(D=(O=o())==null?void 0:O.period)==null?void 0:D.timeframe,title:g.title||g.id,message:g.message||"Test alert",price:void 0,deliveries:Object.keys(g.channels||{}).map($=>({channel:$,status:g.channels[$]?"pending":"skipped"}))};b8([C]);const M=await x8(C);w8(C.id,M)};sg(n,{title:"Alerts Center",width:"min(980px, 96vw)",maxHeight:"90vh",get show(){return i(l)},set show(g){x(l,V(g))},get theme(){return o().theme},buttons:[],class:"alerts-center",children:(g,w)=>{var C=hW(),M=y(C),P=y(M);P.__click=[VV,c];var T=v(P,2);T.__click=[WV,c];var N=v(T,2);N.__click=[HV,c],_(M);var L=v(M,2);Ye(L,()=>i(c)==="rules",O=>{var D=tW(),$=y(D);Ye($,()=>Object.keys(r().rules).length===0,z=>{var te=qV();Y(z,te)},z=>{var te=eW();Ro(te,5,()=>Object.values(r().rules),pe=>pe.id,(pe,J)=>{var le=QV(),de=y(le),he=y(de),ge=y(he),ae=y(ge,!0);Ne(()=>tt(ae,h(i(J)))),_(ge);var Ie=v(ge,2),ce=y(Ie,!0);_(Ie),_(he);var je=v(he,2),Ve=y(je);mn(Ve),Ve.__change=[UV,J],Di(2),_(je),_(de);var We=v(de,2),He=v(y(We),2);e_(He,()=>i(J).frequency);var Ue;He.__change=[GV,J],Ro(He,21,()=>Object.entries(f),fi,(Tt,Pt)=>{let St=()=>i(Pt)[0],st=()=>i(Pt)[1];var xt=YV(),Je={},Xe=y(xt,!0);_(xt),Ne(()=>{Je!==(Je=St())&&(xt.value=(xt.__value=St())==null?"":St()),tt(Xe,st())}),Y(Tt,xt)}),_(He),_(We);var et=v(We,2),ft=v(y(et),2);mn(ft),ft.__change=[KV,J],_(et);var it=v(et,2);Ro(it,21,()=>Object.keys(u),fi,(Tt,Pt)=>{var St=ZV(),st=y(St);mn(st),st.__change=[XV,J,Pt];var xt=v(st,2),Je=y(xt,!0);_(xt),_(St),Ne(()=>{var Xe;Av(st,(Xe=i(J).channels)==null?void 0:Xe[i(Pt)]),tt(Je,u[i(Pt)])}),Y(Tt,St)}),_(it);var Lt=v(it,2);Lt.__click=[JV,m,J],_(le),Ne(()=>{tt(ce,i(J).message||"No message"),Av(Ve,i(J).enabled),Ue!==(Ue=i(J).frequency)&&(He.value=(He.__value=i(J).frequency)==null?"":i(J).frequency,_0(He,i(J).frequency)),Hf(ft,i(J).message||"")}),Y(pe,le)}),_(te),Y(z,te)}),_(D),Y(O,D)},O=>{var D=Yn(),$=tn(D);Ye($,()=>i(c)==="delivery",z=>{var te=cW(),pe=y(te),J=y(pe),le=v(y(J),2);mn(le),le.__change=[nW],_(J);var de=v(J,2),he=v(y(de),2);mn(he),he.__change=[sW];var ge=v(he,2);mn(ge),ge.__change=[oW],_(de);var ae=v(de,2),Ie=v(y(ae),2);mn(Ie),Ie.__change=[iW];var ce=v(Ie,2);mn(ce),ce.__change=[rW],_(ae),_(pe);var je=v(pe,2),Ve=y(je),We=y(Ve);mn(We),We.__change=[aW],Di(2),_(Ve);var He=v(Ve,2),Ue=v(y(He),2);mn(Ue),Ue.__change=[lW],_(He),_(je),_(te),Ne(()=>{Hf(le,r().delivery.webhookUrl||""),Hf(he,r().delivery.emailEndpoint||""),Hf(ge,r().delivery.emailTo||""),Hf(Ie,r().delivery.pushEndpoint||""),Hf(ce,r().delivery.pushTarget||""),Av(We,r().options.backfill),Hf(Ue,r().options.maxLogs)}),Y(z,te)},z=>{var te=mW(),pe=y(te),J=v(y(pe),2);J.__click=function(...de){bx==null||bx.apply(this,de)},_(pe);var le=v(pe,2);Ye(le,()=>r().logs.length===0,de=>{var he=uW();Y(de,he)},de=>{var he=pW();Ro(he,5,()=>r().logs,ge=>ge.id,(ge,ae)=>{var Ie=fW(),ce=y(Ie),je=y(ce),Ve=y(je,!0);_(je);var We=v(je,2),He=y(We);Ne(()=>tt(He,`${d(i(ae).timestamp)??""} · ${(i(ae).symbol||"-")??""} · ${(i(ae).timeframe||"-")??""}`)),_(We);var Ue=v(We,2),et=y(Ue,!0);_(Ue),_(ce);var ft=v(ce,2);Ro(ft,21,()=>i(ae).deliveries,fi,(it,Lt)=>{var Tt=dW(),Pt=y(Tt);_(Tt),Ne(()=>{Fi(Tt,`${`chip chip-${i(Lt).status}`??""} svelte-kd3mpt`),tt(Pt,`${i(Lt).channel??""}:${i(Lt).status??""}`)}),Y(it,Tt)}),_(ft),_(Ie),Ne(()=>{tt(Ve,i(ae).title||i(ae).ruleId),tt(et,i(ae).message||"-")}),Y(ge,Ie)}),_(he),Y(de,he)}),_(te),Y(z,te)},!0),Y(O,D)}),_(C),Ne(()=>{rr(P,"active",i(c)==="rules"),rr(T,"active",i(c)==="delivery"),rr(N,"active",i(c)==="logs")}),Y(g,C)},$$slots:{default:!0}}),Ed()}Tp(["click","change"]);const gW=["XAU","XAG","XPT","XPD","CNH"],a5=new Set(["USD","EUR","GBP","JPY","CHF","CAD","AUD","NZD","SEK","NOK","DKK","SGD","HKD","CNY","INR","KRW","THB","MYR","IDR","PHP","MXN","BRL","ZAR","TRY","PLN","CZK","HUF","RON","ILS","RUB","AED","SAR","QAR","KWD",...gW]),_W=["USDT","USDC","BUSD","DAI","TUSD","FDUSD","USD","BTC","ETH","BNB","SOL","XBT"],yW=["BINANCE","COINBASE","KRAKEN","BYBIT","OKX","BITFINEX","KUCOIN","GATE","MEXC","BITGET"],bW=["OANDA","FXCM","FOREX","FX","DUKASCOPY","PEPPERSTONE","ICMARKETS","IG"];function ly(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"){const e=Number(n.trim());if(Number.isFinite(e))return e}}function Cx(n){return typeof n=="number"&&Number.isFinite(n)}function c0(n,e,t){return Math.min(t,Math.max(e,Math.trunc(n)))}function I8(n){const e=typeof n.exchange=="string"?n.exchange.trim():"",t=typeof n.ticker=="string"?n.ticker.trim():"";if(!e&&t.includes(":")){const s=t.indexOf(":"),o=t.slice(0,s).trim(),r=t.slice(s+1).trim();return{exchange:o?o.toUpperCase():void 0,ticker:r.toUpperCase()}}return{exchange:e?e.toUpperCase():void 0,ticker:t.toUpperCase()}}function P8(n){return(n||"").replace(/[^A-Z]/gi,"").toUpperCase()}function M8(n){const e=(n.market??n.type??"").toString().toLowerCase();if(e.includes("forex")||e==="fx")return"forex";if(e.includes("crypto")||e.includes("coin"))return"crypto";const{exchange:t,ticker:s}=I8(n),o=(t||"").toUpperCase();if(yW.some(a=>o.includes(a)))return"crypto";if(bW.some(a=>o.includes(a)))return"forex";const r=P8(s);if(r.length>=6){const a=r.slice(0,3),l=r.slice(3,6);if(a5.has(a)&&a5.has(l))return"forex"}return _W.some(a=>r.endsWith(a))?"crypto":e.includes("stock")||e.includes("equity")||e.includes("index")?"stock":"unknown"}function Ab(n){return M8(n)}function xW(n){const{ticker:e}=I8(n),t=P8(e),s=t.slice(0,3),o=t.slice(3,6);return s==="XAU"||s==="XAG"||s==="XPT"||s==="XPD"||o==="JPY"?3:5}function N8(n,e){if(!Number.isFinite(n))return 0;try{const t=n.toFixed(e).replace(/\.?0+$/,""),s=t.indexOf(".");return s===-1?0:t.length-s-1}catch{return 0}}function Ix(n){if(!Array.isArray(n)||n.length===0)return;const e=n.slice(Math.max(0,n.length-200));let t=0;for(const s of e){const o=[s.open,s.high,s.low,s.close];for(const r of o){const a=ly(r);if(a!=null&&(t=Math.max(t,N8(a,12)),t>=12))return 12}}return t}function wW(n){var e;if(!(!Array.isArray(n)||n.length===0))for(let t=n.length-1;t>=0;t--){const s=(e=n[t])==null?void 0:e.close,o=ly(s);if(o!=null)return o}}function $_(n,e){const t=(n==null?void 0:n.tickSize)??(n==null?void 0:n.minTick)??(n==null?void 0:n.priceStep),s=ly(t),o=s!=null&&s>0?N8(s,12):void 0,r=M8(n);if(r==="forex"){const f=xW(n),u=ly(n==null?void 0:n.pricePrecision),d=e?Ix(e):void 0,h=Math.max(f,o??0,u??0,Cx(d)?d:0);return c0(h,0,12)}const a=n==null?void 0:n.pricePrecision,l=ly(a);if(r==="stock")return o!=null?c0(o,0,12):l!=null?c0(l,0,12):2;const c=e?Ix(e):void 0;if(Cx(c))return c0(c,2,12);if(r==="crypto"){const f=e?Ix(e):void 0,u=Cx(f)?f:l??6,d=Math.abs(wW(e)??NaN);return Number.isFinite(d)?d>=1e3?c0(u,2,2):d>=1?c0(u,2,4):d>=.01?c0(u,4,8):c0(u,6,12):c0(u,2,12)}return l!=null?c0(l,0,12):2}var A8={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,e){(function(t,s){n.exports=s()})(F0,function t(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},o=!s.document&&!!s.postMessage,r=s.IS_PAPA_WORKER||!1,a={},l=0,c={parse:function($,z){var te=(z=z||{}).dynamicTyping||!1;if(D(te)&&(z.dynamicTypingFunction=te,te={}),z.dynamicTyping=te,z.transform=!!D(z.transform)&&z.transform,z.worker&&c.WORKERS_SUPPORTED){var pe=function(){if(!c.WORKERS_SUPPORTED)return!1;var le=(he=s.URL||s.webkitURL||null,ge=t.toString(),c.BLOB_URL||(c.BLOB_URL=he.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",ge,")();"],{type:"text/javascript"})))),de=new s.Worker(le),he,ge;return de.onmessage=P,de.id=l++,a[de.id]=de}();return pe.userStep=z.step,pe.userChunk=z.chunk,pe.userComplete=z.complete,pe.userError=z.error,z.step=D(z.step),z.chunk=D(z.chunk),z.complete=D(z.complete),z.error=D(z.error),delete z.worker,void pe.postMessage({input:$,config:z,workerId:pe.id})}var J=null;return c.NODE_STREAM_INPUT,typeof $=="string"?($=function(le){return le.charCodeAt(0)===65279?le.slice(1):le}($),J=z.download?new d(z):new m(z)):$.readable===!0&&D($.read)&&D($.on)?J=new g(z):(s.File&&$ instanceof File||$ instanceof Object)&&(J=new h(z)),J.stream($)},unparse:function($,z){var te=!1,pe=!0,J=",",le=`\r
`,de='"',he=de+de,ge=!1,ae=null,Ie=!1;(function(){if(typeof z=="object"){if(typeof z.delimiter!="string"||c.BAD_DELIMITERS.filter(function(We){return z.delimiter.indexOf(We)!==-1}).length||(J=z.delimiter),(typeof z.quotes=="boolean"||typeof z.quotes=="function"||Array.isArray(z.quotes))&&(te=z.quotes),typeof z.skipEmptyLines!="boolean"&&typeof z.skipEmptyLines!="string"||(ge=z.skipEmptyLines),typeof z.newline=="string"&&(le=z.newline),typeof z.quoteChar=="string"&&(de=z.quoteChar),typeof z.header=="boolean"&&(pe=z.header),Array.isArray(z.columns)){if(z.columns.length===0)throw new Error("Option columns is empty");ae=z.columns}z.escapeChar!==void 0&&(he=z.escapeChar+de),(typeof z.escapeFormulae=="boolean"||z.escapeFormulae instanceof RegExp)&&(Ie=z.escapeFormulae instanceof RegExp?z.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var ce=new RegExp(C(de),"g");if(typeof $=="string"&&($=JSON.parse($)),Array.isArray($)){if(!$.length||Array.isArray($[0]))return je(null,$,ge);if(typeof $[0]=="object")return je(ae||Object.keys($[0]),$,ge)}else if(typeof $=="object")return typeof $.data=="string"&&($.data=JSON.parse($.data)),Array.isArray($.data)&&($.fields||($.fields=$.meta&&$.meta.fields||ae),$.fields||($.fields=Array.isArray($.data[0])?$.fields:typeof $.data[0]=="object"?Object.keys($.data[0]):[]),Array.isArray($.data[0])||typeof $.data[0]=="object"||($.data=[$.data])),je($.fields||[],$.data||[],ge);throw new Error("Unable to serialize unrecognized input");function je(We,He,Ue){var et="";typeof We=="string"&&(We=JSON.parse(We)),typeof He=="string"&&(He=JSON.parse(He));var ft=Array.isArray(We)&&0<We.length,it=!Array.isArray(He[0]);if(ft&&pe){for(var Lt=0;Lt<We.length;Lt++)0<Lt&&(et+=J),et+=Ve(We[Lt],Lt);0<He.length&&(et+=le)}for(var Tt=0;Tt<He.length;Tt++){var Pt=ft?We.length:He[Tt].length,St=!1,st=ft?Object.keys(He[Tt]).length===0:He[Tt].length===0;if(Ue&&!ft&&(St=Ue==="greedy"?He[Tt].join("").trim()==="":He[Tt].length===1&&He[Tt][0].length===0),Ue==="greedy"&&ft){for(var xt=[],Je=0;Je<Pt;Je++){var Xe=it?We[Je]:Je;xt.push(He[Tt][Xe])}St=xt.join("").trim()===""}if(!St){for(var Be=0;Be<Pt;Be++){0<Be&&!st&&(et+=J);var Qe=ft&&it?We[Be]:Be;et+=Ve(He[Tt][Qe],Be)}Tt<He.length-1&&(!Ue||0<Pt&&!st)&&(et+=le)}}return et}function Ve(We,He){if(We==null)return"";if(We.constructor===Date)return JSON.stringify(We).slice(1,25);var Ue=!1;Ie&&typeof We=="string"&&Ie.test(We)&&(We="'"+We,Ue=!0);var et=We.toString().replace(ce,he);return(Ue=Ue||te===!0||typeof te=="function"&&te(We,He)||Array.isArray(te)&&te[He]||function(ft,it){for(var Lt=0;Lt<it.length;Lt++)if(-1<ft.indexOf(it[Lt]))return!0;return!1}(et,c.BAD_DELIMITERS)||-1<et.indexOf(J)||et.charAt(0)===" "||et.charAt(et.length-1)===" ")?de+et+de:et}}};if(c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!o&&!!s.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=M,c.ParserHandle=w,c.NetworkStreamer=d,c.FileStreamer=h,c.StringStreamer=m,c.ReadableStreamStreamer=g,s.jQuery){var f=s.jQuery;f.fn.parse=function($){var z=$.config||{},te=[];return this.each(function(le){if(!(f(this).prop("tagName").toUpperCase()==="INPUT"&&f(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var de=0;de<this.files.length;de++)te.push({file:this.files[de],inputElem:this,instanceConfig:f.extend({},z)})}),pe(),this;function pe(){if(te.length!==0){var le,de,he,ge,ae=te[0];if(D($.before)){var Ie=$.before(ae.file,ae.inputElem);if(typeof Ie=="object"){if(Ie.action==="abort")return le="AbortError",de=ae.file,he=ae.inputElem,ge=Ie.reason,void(D($.error)&&$.error({name:le},de,he,ge));if(Ie.action==="skip")return void J();typeof Ie.config=="object"&&(ae.instanceConfig=f.extend(ae.instanceConfig,Ie.config))}else if(Ie==="skip")return void J()}var ce=ae.instanceConfig.complete;ae.instanceConfig.complete=function(je){D(ce)&&ce(je,ae.file,ae.inputElem),J()},c.parse(ae.file,ae.instanceConfig)}else D($.complete)&&$.complete()}function J(){te.splice(0,1),pe()}}}function u($){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(z){var te=L(z);te.chunkSize=parseInt(te.chunkSize),z.step||z.chunk||(te.chunkSize=null),this._handle=new w(te),(this._handle.streamer=this)._config=te}).call(this,$),this.parseChunk=function(z,te){if(this.isFirstChunk&&D(this._config.beforeFirstChunk)){var pe=this._config.beforeFirstChunk(z);pe!==void 0&&(z=pe)}this.isFirstChunk=!1,this._halted=!1;var J=this._partialLine+z;this._partialLine="";var le=this._handle.parse(J,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var de=le.meta.cursor;this._finished||(this._partialLine=J.substring(de-this._baseIndex),this._baseIndex=de),le&&le.data&&(this._rowCount+=le.data.length);var he=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)s.postMessage({results:le,workerId:c.WORKER_ID,finished:he});else if(D(this._config.chunk)&&!te){if(this._config.chunk(le,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);le=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(le.data),this._completeResults.errors=this._completeResults.errors.concat(le.errors),this._completeResults.meta=le.meta),this._completed||!he||!D(this._config.complete)||le&&le.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),he||le&&le.meta.paused||this._nextChunk(),le}this._halted=!0},this._sendError=function(z){D(this._config.error)?this._config.error(z):r&&this._config.error&&s.postMessage({workerId:c.WORKER_ID,error:z,finished:!1})}}function d($){var z;($=$||{}).chunkSize||($.chunkSize=c.RemoteChunkSize),u.call(this,$),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(te){this._input=te,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(z=new XMLHttpRequest,this._config.withCredentials&&(z.withCredentials=this._config.withCredentials),o||(z.onload=O(this._chunkLoaded,this),z.onerror=O(this._chunkError,this)),z.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var te=this._config.downloadRequestHeaders;for(var pe in te)z.setRequestHeader(pe,te[pe])}if(this._config.chunkSize){var J=this._start+this._config.chunkSize-1;z.setRequestHeader("Range","bytes="+this._start+"-"+J)}try{z.send(this._config.downloadRequestBody)}catch(le){this._chunkError(le.message)}o&&z.status===0&&this._chunkError()}},this._chunkLoaded=function(){z.readyState===4&&(z.status<200||400<=z.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:z.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(te){var pe=te.getResponseHeader("Content-Range");return pe===null?-1:parseInt(pe.substring(pe.lastIndexOf("/")+1))}(z),this.parseChunk(z.responseText)))},this._chunkError=function(te){var pe=z.statusText||te;this._sendError(new Error(pe))}}function h($){var z,te;($=$||{}).chunkSize||($.chunkSize=c.LocalChunkSize),u.call(this,$);var pe=typeof FileReader<"u";this.stream=function(J){this._input=J,te=J.slice||J.webkitSlice||J.mozSlice,pe?((z=new FileReader).onload=O(this._chunkLoaded,this),z.onerror=O(this._chunkError,this)):z=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var J=this._input;if(this._config.chunkSize){var le=Math.min(this._start+this._config.chunkSize,this._input.size);J=te.call(J,this._start,le)}var de=z.readAsText(J,this._config.encoding);pe||this._chunkLoaded({target:{result:de}})},this._chunkLoaded=function(J){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(J.target.result)},this._chunkError=function(){this._sendError(z.error)}}function m($){var z;u.call(this,$=$||{}),this.stream=function(te){return z=te,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var te,pe=this._config.chunkSize;return pe?(te=z.substring(0,pe),z=z.substring(pe)):(te=z,z=""),this._finished=!z,this.parseChunk(te)}}}function g($){u.call(this,$=$||{});var z=[],te=!0,pe=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(J){this._input=J,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){pe&&z.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),z.length?this.parseChunk(z.shift()):te=!0},this._streamData=O(function(J){try{z.push(typeof J=="string"?J:J.toString(this._config.encoding)),te&&(te=!1,this._checkIsFinished(),this.parseChunk(z.shift()))}catch(le){this._streamError(le)}},this),this._streamError=O(function(J){this._streamCleanUp(),this._sendError(J)},this),this._streamEnd=O(function(){this._streamCleanUp(),pe=!0,this._streamData("")},this),this._streamCleanUp=O(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function w($){var z,te,pe,J=Math.pow(2,53),le=-J,de=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,he=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,ge=this,ae=0,Ie=0,ce=!1,je=!1,Ve=[],We={data:[],errors:[],meta:{}};if(D($.step)){var He=$.step;$.step=function(Tt){if(We=Tt,ft())et();else{if(et(),We.data.length===0)return;ae+=Tt.data.length,$.preview&&ae>$.preview?te.abort():(We.data=We.data[0],He(We,ge))}}}function Ue(Tt){return $.skipEmptyLines==="greedy"?Tt.join("").trim()==="":Tt.length===1&&Tt[0].length===0}function et(){return We&&pe&&(Lt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),pe=!1),$.skipEmptyLines&&(We.data=We.data.filter(function(Tt){return!Ue(Tt)})),ft()&&function(){if(!We)return;function Tt(St,st){D($.transformHeader)&&(St=$.transformHeader(St,st)),Ve.push(St)}if(Array.isArray(We.data[0])){for(var Pt=0;ft()&&Pt<We.data.length;Pt++)We.data[Pt].forEach(Tt);We.data.splice(0,1)}else We.data.forEach(Tt)}(),function(){if(!We||!$.header&&!$.dynamicTyping&&!$.transform)return We;function Tt(St,st){var xt,Je=$.header?{}:[];for(xt=0;xt<St.length;xt++){var Xe=xt,Be=St[xt];$.header&&(Xe=xt>=Ve.length?"__parsed_extra":Ve[xt]),$.transform&&(Be=$.transform(Be,Xe)),Be=it(Xe,Be),Xe==="__parsed_extra"?(Je[Xe]=Je[Xe]||[],Je[Xe].push(Be)):Je[Xe]=Be}return $.header&&(xt>Ve.length?Lt("FieldMismatch","TooManyFields","Too many fields: expected "+Ve.length+" fields but parsed "+xt,Ie+st):xt<Ve.length&&Lt("FieldMismatch","TooFewFields","Too few fields: expected "+Ve.length+" fields but parsed "+xt,Ie+st)),Je}var Pt=1;return!We.data.length||Array.isArray(We.data[0])?(We.data=We.data.map(Tt),Pt=We.data.length):We.data=Tt(We.data,0),$.header&&We.meta&&(We.meta.fields=Ve),Ie+=Pt,We}()}function ft(){return $.header&&Ve.length===0}function it(Tt,Pt){return St=Tt,$.dynamicTypingFunction&&$.dynamicTyping[St]===void 0&&($.dynamicTyping[St]=$.dynamicTypingFunction(St)),($.dynamicTyping[St]||$.dynamicTyping)===!0?Pt==="true"||Pt==="TRUE"||Pt!=="false"&&Pt!=="FALSE"&&(function(st){if(de.test(st)){var xt=parseFloat(st);if(le<xt&&xt<J)return!0}return!1}(Pt)?parseFloat(Pt):he.test(Pt)?new Date(Pt):Pt===""?null:Pt):Pt;var St}function Lt(Tt,Pt,St,st){var xt={type:Tt,code:Pt,message:St};st!==void 0&&(xt.row=st),We.errors.push(xt)}this.parse=function(Tt,Pt,St){var st=$.quoteChar||'"';if($.newline||($.newline=function(Xe,Be){Xe=Xe.substring(0,1048576);var Qe=new RegExp(C(Be)+"([^]*?)"+C(Be),"gm"),ct=(Xe=Xe.replace(Qe,"")).split("\r"),Mt=Xe.split(`
`),mt=1<Mt.length&&Mt[0].length<ct[0].length;if(ct.length===1||mt)return`
`;for(var Ce=0,Te=0;Te<ct.length;Te++)ct[Te][0]===`
`&&Ce++;return Ce>=ct.length/2?`\r
`:"\r"}(Tt,st)),pe=!1,$.delimiter)D($.delimiter)&&($.delimiter=$.delimiter(Tt),We.meta.delimiter=$.delimiter);else{var xt=function(Xe,Be,Qe,ct,Mt){var mt,Ce,Te,It;Mt=Mt||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var $t=0;$t<Mt.length;$t++){var Yt=Mt[$t],qn=0,Vn=0,Dn=0;Te=void 0;for(var Wn=new M({comments:ct,delimiter:Yt,newline:Be,preview:10}).parse(Xe),pn=0;pn<Wn.data.length;pn++)if(Qe&&Ue(Wn.data[pn]))Dn++;else{var gn=Wn.data[pn].length;Vn+=gn,Te!==void 0?0<gn&&(qn+=Math.abs(gn-Te),Te=gn):Te=gn}0<Wn.data.length&&(Vn/=Wn.data.length-Dn),(Ce===void 0||qn<=Ce)&&(It===void 0||It<Vn)&&1.99<Vn&&(Ce=qn,mt=Yt,It=Vn)}return{successful:!!($.delimiter=mt),bestDelimiter:mt}}(Tt,$.newline,$.skipEmptyLines,$.comments,$.delimitersToGuess);xt.successful?$.delimiter=xt.bestDelimiter:(pe=!0,$.delimiter=c.DefaultDelimiter),We.meta.delimiter=$.delimiter}var Je=L($);return $.preview&&$.header&&Je.preview++,z=Tt,te=new M(Je),We=te.parse(z,Pt,St),et(),ce?{meta:{paused:!0}}:We||{meta:{paused:!1}}},this.paused=function(){return ce},this.pause=function(){ce=!0,te.abort(),z=D($.chunk)?"":z.substring(te.getCharIndex())},this.resume=function(){ge.streamer._halted?(ce=!1,ge.streamer.parseChunk(z,!0)):setTimeout(ge.resume,3)},this.aborted=function(){return je},this.abort=function(){je=!0,te.abort(),We.meta.aborted=!0,D($.complete)&&$.complete(We),z=""}}function C($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function M($){var z,te=($=$||{}).delimiter,pe=$.newline,J=$.comments,le=$.step,de=$.preview,he=$.fastMode,ge=z=$.quoteChar===void 0||$.quoteChar===null?'"':$.quoteChar;if($.escapeChar!==void 0&&(ge=$.escapeChar),(typeof te!="string"||-1<c.BAD_DELIMITERS.indexOf(te))&&(te=","),J===te)throw new Error("Comment character same as delimiter");J===!0?J="#":(typeof J!="string"||-1<c.BAD_DELIMITERS.indexOf(J))&&(J=!1),pe!==`
`&&pe!=="\r"&&pe!==`\r
`&&(pe=`
`);var ae=0,Ie=!1;this.parse=function(ce,je,Ve){if(typeof ce!="string")throw new Error("Input must be a string");var We=ce.length,He=te.length,Ue=pe.length,et=J.length,ft=D(le),it=[],Lt=[],Tt=[],Pt=ae=0;if(!ce)return Qs();if($.header&&!je){var St=ce.split(pe)[0].split(te),st=[],xt={},Je=!1;for(var Xe in St){var Be=St[Xe];D($.transformHeader)&&(Be=$.transformHeader(Be,Xe));var Qe=Be,ct=xt[Be]||0;for(0<ct&&(Je=!0,Qe=Be+"_"+ct),xt[Be]=ct+1;st.includes(Qe);)Qe=Qe+"_"+ct;st.push(Qe)}if(Je){var Mt=ce.split(pe);Mt[0]=st.join(te),ce=Mt.join(pe)}}if(he||he!==!1&&ce.indexOf(z)===-1){for(var mt=ce.split(pe),Ce=0;Ce<mt.length;Ce++){if(Tt=mt[Ce],ae+=Tt.length,Ce!==mt.length-1)ae+=pe.length;else if(Ve)return Qs();if(!J||Tt.substring(0,et)!==J){if(ft){if(it=[],Dn(Tt.split(te)),Is(),Ie)return Qs()}else Dn(Tt.split(te));if(de&&de<=Ce)return it=it.slice(0,de),Qs(!0)}}return Qs()}for(var Te=ce.indexOf(te,ae),It=ce.indexOf(pe,ae),$t=new RegExp(C(ge)+C(z),"g"),Yt=ce.indexOf(z,ae);;)if(ce[ae]!==z)if(J&&Tt.length===0&&ce.substring(ae,ae+et)===J){if(It===-1)return Qs();ae=It+Ue,It=ce.indexOf(pe,ae),Te=ce.indexOf(te,ae)}else if(Te!==-1&&(Te<It||It===-1))Tt.push(ce.substring(ae,Te)),ae=Te+He,Te=ce.indexOf(te,ae);else{if(It===-1)break;if(Tt.push(ce.substring(ae,It)),gn(It+Ue),ft&&(Is(),Ie))return Qs();if(de&&it.length>=de)return Qs(!0)}else for(Yt=ae,ae++;;){if((Yt=ce.indexOf(z,Yt+1))===-1)return Ve||Lt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:it.length,index:ae}),pn();if(Yt===We-1)return pn(ce.substring(ae,Yt).replace($t,z));if(z!==ge||ce[Yt+1]!==ge){if(z===ge||Yt===0||ce[Yt-1]!==ge){Te!==-1&&Te<Yt+1&&(Te=ce.indexOf(te,Yt+1)),It!==-1&&It<Yt+1&&(It=ce.indexOf(pe,Yt+1));var qn=Wn(It===-1?Te:Math.min(Te,It));if(ce.substr(Yt+1+qn,He)===te){Tt.push(ce.substring(ae,Yt).replace($t,z)),ce[ae=Yt+1+qn+He]!==z&&(Yt=ce.indexOf(z,ae)),Te=ce.indexOf(te,ae),It=ce.indexOf(pe,ae);break}var Vn=Wn(It);if(ce.substring(Yt+1+Vn,Yt+1+Vn+Ue)===pe){if(Tt.push(ce.substring(ae,Yt).replace($t,z)),gn(Yt+1+Vn+Ue),Te=ce.indexOf(te,ae),Yt=ce.indexOf(z,ae),ft&&(Is(),Ie))return Qs();if(de&&it.length>=de)return Qs(!0);break}Lt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:it.length,index:ae}),Yt++}}else Yt++}return pn();function Dn(Cs){it.push(Cs),Pt=ae}function Wn(Cs){var ro=0;if(Cs!==-1){var bs=ce.substring(Yt+1,Cs);bs&&bs.trim()===""&&(ro=bs.length)}return ro}function pn(Cs){return Ve||(Cs===void 0&&(Cs=ce.substring(ae)),Tt.push(Cs),ae=We,Dn(Tt),ft&&Is()),Qs()}function gn(Cs){ae=Cs,Dn(Tt),Tt=[],It=ce.indexOf(pe,ae)}function Qs(Cs){return{data:it,errors:Lt,meta:{delimiter:te,linebreak:pe,aborted:Ie,truncated:!!Cs,cursor:Pt+(je||0)}}}function Is(){le(Qs()),it=[],Lt=[]}},this.abort=function(){Ie=!0},this.getCharIndex=function(){return ae}}function P($){var z=$.data,te=a[z.workerId],pe=!1;if(z.error)te.userError(z.error,z.file);else if(z.results&&z.results.data){var J={abort:function(){pe=!0,T(z.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:N,resume:N};if(D(te.userStep)){for(var le=0;le<z.results.data.length&&(te.userStep({data:z.results.data[le],errors:z.results.errors,meta:z.results.meta},J),!pe);le++);delete z.results}else D(te.userChunk)&&(te.userChunk(z.results,J,z.file),delete z.results)}z.finished&&!pe&&T(z.workerId,z.results)}function T($,z){var te=a[$];D(te.userComplete)&&te.userComplete(z),te.terminate(),delete a[$]}function N(){throw new Error("Not implemented.")}function L($){if(typeof $!="object"||$===null)return $;var z=Array.isArray($)?[]:{};for(var te in $)z[te]=L($[te]);return z}function O($,z){return function(){$.apply(z,arguments)}}function D($){return typeof $=="function"}return r&&(s.onmessage=function($){var z=$.data;if(c.WORKER_ID===void 0&&z&&(c.WORKER_ID=z.workerId),typeof z.input=="string")s.postMessage({workerId:c.WORKER_ID,results:c.parse(z.input,z.config),finished:!0});else if(s.File&&z.input instanceof File||z.input instanceof Object){var te=c.parse(z.input,z.config);te&&s.postMessage({workerId:c.WORKER_ID,results:te,finished:!0})}}),(d.prototype=Object.create(u.prototype)).constructor=d,(h.prototype=Object.create(u.prototype)).constructor=h,(m.prototype=Object.create(m.prototype)).constructor=m,(g.prototype=Object.create(u.prototype)).constructor=g,c})})(A8);var kW=A8.exports;const SW=_y(kW);function CW(n,e,t,s,o){if(!(!e()||i(t).length===0))switch(n.key){case"ArrowDown":n.preventDefault(),x(s,V(Math.min(i(s)+1,i(t).length-1)));break;case"ArrowUp":n.preventDefault(),x(s,V(Math.max(i(s)-1,-1)));break;case"Enter":n.preventDefault(),i(s)>=0&&i(s)<i(t).length&&o(i(t)[i(s)]);break;case"Escape":n.preventDefault(),e(!1);break}}var IW=Me('<div class="flex justify-center py-16"><div class="relative"><div class="w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-12 h-12 border-4 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div></div>'),PW=Me('<div class="flex flex-col items-center justify-center py-16 text-center"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4"><svg class="w-8 h-8 text-base-content/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2">No symbols found</p> <p class="text-sm text-base-content/40">Try a different search term</p></div>'),MW=(n,e,t)=>e(i(t)),NW=Me('<div class="absolute top-0 left-0 w-5 h-5 rounded-full overflow-hidden bg-base-200 ring-2 ring-base-100 z-10"><img class="w-full h-full object-cover"></div> <div class="absolute bottom-0 right-0 w-5 h-5 rounded-full overflow-hidden bg-base-200"><img class="w-full h-full object-cover"></div>',1),AW=Me('<div class="relative w-full h-full rounded-lg overflow-hidden bg-base-200/50"><img class="w-full h-full object-cover"> <div class="absolute inset-0 bg-base-200 flex items-center justify-center hidden"><span class="text-xs font-medium text-base-content/60"> </span></div></div>'),TW=Me('<span class="text-xs px-1.5 py-0.5 rounded bg-base-200/60 border border-base-300/40 text-base-content/60"> </span>'),FW=Me('<p class="text-sm text-base-content/60 truncate mt-0.5"> </p>'),LW=Me('<div class="flex-shrink-0"><svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg></div>'),EW=Me('<div><div class="relative w-8 h-8 flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><h3 class="font-medium text-base"> </h3> <span class="text-xs text-base-content/50"> </span> <!></div> <!></div> <!></div>'),$W=Me('<div class="flex items-center justify-center py-4"><div class="flex items-center gap-3 text-base-content/60"><div class="relative"><div class="w-6 h-6 border-2 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-6 h-6 border-2 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div> <span class="text-sm">Loading more symbols…</span></div></div>'),DW=Me('<div class="divide-y divide-base-300/20"><!> <!></div>'),RW=Me('<div class="flex flex-col gap-6"><div class="relative"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-base-content/50 pointer-events-none"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <input type="text" class="w-full pl-12 pr-4 py-3 text-sm bg-base-100 border border-base-300/50 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200 placeholder:text-base-content/50" placeholder="Search symbols..."></div> <div class="relative rounded-lg overflow-hidden bg-base-100 border border-base-300/30"><div class="h-96 overflow-y-auto luxury-scrollbar svelte-1r1pdks"><!></div></div> <div class="flex justify-center items-center py-2 mt-1"><div class="group relative cursor-pointer"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse" style="animation-delay: 0.5s;"></div></div></div></div></div>'),jW=Me("<div><!></div>");function BW(n,e){Ld(e,!0);const t=tm(),s=()=>vl(T,"$save",t),o=()=>vl(c,"$keyword",t),r=()=>vl(P,"$ctx",t);let a=pi(e,"show",15);const l=t4();let c=Fm(""),f=xe(V([]));const u=50;let d=xe(u),h=xe(!1),m,g=null,w=xe(V([])),C=xe(-1),M=!1;const P=cd("ctx"),T=cd("save"),N=cd("datafeed"),L=6,O=new Set;wr(()=>{if(a()){if(console.log("🔍 Modal opened! Available symbols:",s().allSymbols.length),console.log("🔍 Current symbol:",s().symbol),x(f,V(s().allSymbols)),x(d,u),x(C,-1),!M){M=!0;const ce=s().symbol.shortName||s().symbol.ticker||"";c.set(ce),o2().then(()=>{g&&(g.focus(),g.select())})}}else M=!1}),wr(()=>{x(w,V(i(f).slice(0,i(d))))}),wr(()=>{if(!a())return;const ce=i(w).slice(0,L);if(ce.length)for(const je of ce)de(je)}),typeof window<"u"&&(window.testSymbolChange=()=>{if(s().allSymbols.length>0){const ce=s().allSymbols[1];console.log("🧪 Testing symbol change to:",ce),le(ce)}else console.log("🧪 No symbols available for testing")});function D(ce){return ce.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim()}function $(ce){return D(ce).split(/\s+/).filter(Boolean).map(Ve=>Ve[0]).join("")}function z(ce,je){const Ve=ce.length,We=je.length;if(Ve===0)return We;if(We===0)return Ve;const He=new Array(We+1);for(let Ue=0;Ue<=We;(Ue+=1)-1)He[Ue]=Ue;for(let Ue=1;Ue<=Ve;(Ue+=1)-1){let et=Ue-1;He[0]=Ue;for(let ft=1;ft<=We;(ft+=1)-1){const it=He[ft],Lt=ce[Ue-1]===je[ft-1]?0:1;He[ft]=Math.min(He[ft]+1,He[ft-1]+1,et+Lt),et=it}}return He[We]}function te(ce,je){const Ve=Math.max(ce.length,je.length);return Ve===0?1:1-z(ce,je)/Ve}function pe(ce,je){if(!je||!je.trim())return ce;const We=D(je).split(/\s+/).filter(Boolean);return ce.map(Ue=>{const et=Ue.ticker.toLowerCase(),ft=Ue.shortName||"";ft.toLowerCase();const it=D(ft),Lt=it.split(/\s+/).filter(Boolean),Tt=(Ue.exchange||"").toLowerCase(),Pt=$(ft);let St=0,st=0;for(const xt of We){let Je=0;et===xt?Je+=1200:et.startsWith(xt)?Je+=800:et.includes(xt)?Je+=600:Pt===xt||Pt.startsWith(xt)?Je+=450:it.startsWith(xt)?Je+=500:it.includes(xt)?Je+=300:Tt.includes(xt)?Je+=80:J(et,xt)?Je+=60:J(it,xt)&&(Je+=40);const Xe=te(et,xt);Xe>.5&&(Je+=Math.floor(Xe*300));let Be=0;for(const Qe of Lt){const ct=te(Qe,xt);if(ct>Be&&(Be=ct),Be>=.92)break}Be>.5&&(Je+=Math.floor(Be*200)),Je>0&&(st+=1),St+=Je}return st===We.length?St+=100:St+=st*50,St>0&&et.length<=5&&(St+=20),{symbol:Ue,score:St}}).filter(Ue=>Ue.score>0).sort((Ue,et)=>et.score!==Ue.score?et.score-Ue.score:Ue.symbol.ticker.localeCompare(et.symbol.ticker)).map(Ue=>Ue.symbol)}function J(ce,je){let Ve=0;for(let We=0;We<ce.length&&Ve<je.length;(We+=1)-1)ce[We]===je[Ve]&&(Ve+=1);return Ve===je.length}c.subscribe(ce=>{if(!ce||!ce.trim()){x(f,V(s().allSymbols)),x(d,u),x(C,-1);return}x(f,V(pe(s().allSymbols,ce))),x(d,u),x(C,-1)});function le(ce){try{de(ce)}catch{}try{h3({logo:ce.logo,logo2:ce.logo2})}catch{}Fc(T,Ao(s).symbol=ce,Ao(s)),a(!1)}function de(ce){var We,He,Ue,et,ft,it,Lt,Tt;if(!N||!(ce!=null&&ce.ticker))return;const je=((He=(We=s())==null?void 0:We.period)==null?void 0:He.timeframe)||"1m",Ve=`${ce.ticker}|${je}`;if(!O.has(Ve)){O.add(Ve);try{(Ue=N.startBackgroundPrefetch)==null||Ue.call(N,ce,{timeframe:je})}catch{}try{const Pt=Number(((ft=(et=s())==null?void 0:et.period)==null?void 0:ft.secs)||60)*1e3,St=Date.now()-Pt*600;(Tt=(Lt=(it=N.ensureHistoryBefore)==null?void 0:it.call(N,ce,je,St))==null?void 0:Lt.catch)==null||Tt.call(Lt,()=>{})}catch{}}}async function he(){i(h)||i(d)>=i(f).length||(x(h,!0),await new Promise(ce=>setTimeout(ce,250)),x(d,V(Math.min(i(d)+u,i(f).length))),x(h,!1))}function ge(ce){const je=ce.currentTarget;je.scrollTop+je.clientHeight>=je.scrollHeight-24&&he()}var ae=jW();ae.__keydown=[CW,a,w,C,le];var Ie=y(ae);sg(Ie,{title:l,width:650,maxHeight:"85vh",get show(){return a()},set show(ce){a(ce)},get theme(){return s().theme},buttons:[],children:(ce,je)=>{var Ve=RW(),We=y(Ve),He=v(y(We),2);mn(He),n3(He,!0),ep(He,it=>g=it,()=>g),_(We);var Ue=v(We,2),et=y(Ue),ft=y(et);Ye(ft,()=>r().loadingPairs,it=>{var Lt=IW();Y(it,Lt)},it=>{var Lt=Yn(),Tt=tn(Lt);Ye(Tt,()=>i(f).length===0,Pt=>{var St=PW();Y(Pt,St)},Pt=>{var St=DW(),st=y(St);Ro(st,17,()=>i(w),fi,(Je,Xe,Be)=>{var Qe=EW();Qe.__click=[MW,le,Xe];var ct=y(Qe),Mt=y(ct);Ye(Mt,()=>i(Xe).logo2,Wn=>{var pn=NW(),gn=tn(pn),Qs=y(gn);_(gn);var Is=v(gn,2),Cs=y(Is);_(Is),Ne(()=>{Dt(Qs,"src",`${i(Xe).logo}`),Dt(Qs,"alt",i(Xe).ticker),Dt(Cs,"src",`${i(Xe).logo2}`),Dt(Cs,"alt",i(Xe).ticker)}),ld("error",Qs,ro=>{ro.target.style.display="none"}),W2(Qs),ld("error",Cs,ro=>{ro.target.style.display="none"}),W2(Cs),Y(Wn,pn)},Wn=>{var pn=AW(),gn=y(pn),Qs=v(gn,2),Is=y(Qs),Cs=y(Is,!0);Ne(()=>tt(Cs,i(Xe).ticker.charAt(0))),_(Is),_(Qs),_(pn),Ne(()=>{Dt(gn,"src",`${i(Xe).logo}`),Dt(gn,"alt",i(Xe).ticker)}),ld("error",gn,ro=>{const bs=ro.target;if(bs){bs.style.display="none";const zt=bs.nextElementSibling;zt&&(zt.style.display="flex")}}),W2(gn),Y(Wn,pn)}),_(ct);var mt=v(ct,2),Ce=y(mt),Te=y(Ce),It=y(Te,!0);_(Te);var $t=v(Te,2),Yt=y($t,!0);_($t);var qn=v($t,2);Ye(qn,()=>i(Xe).type,Wn=>{var pn=TW(),gn=y(pn,!0);_(pn),Ne(()=>tt(gn,i(Xe).type)),Y(Wn,pn)}),_(Ce);var Vn=v(Ce,2);Ye(Vn,()=>i(Xe).shortName&&i(Xe).shortName!==i(Xe).ticker,Wn=>{var pn=FW(),gn=y(pn,!0);_(pn),Ne(()=>tt(gn,i(Xe).shortName)),Y(Wn,pn)}),_(mt);var Dn=v(mt,2);Ye(Dn,()=>i(C)===Be,Wn=>{var pn=LW();Y(Wn,pn)}),_(Qe),Ne(()=>{Fi(Qe,`group flex items-center gap-3 px-4 py-3 cursor-pointer transition-all duration-200
                         ${(i(C)===Be?"bg-primary/10 text-primary border-l-2 border-primary":"hover:bg-base-200/50 text-base-content")??""}`),tt(It,i(Xe).ticker),tt(Yt,i(Xe).exchange)}),ld("mouseenter",Qe,()=>de(i(Xe))),Y(Je,Qe)});var xt=v(st,2);Ye(xt,()=>i(h),Je=>{var Xe=$W();Y(Je,Xe)}),_(St),Y(Pt,St)},!0),Y(it,Lt)}),_(et),ep(et,it=>m=it,()=>m),_(Ue),Di(2),_(Ve),As(He,o,it=>s3(c,it)),ld("scroll",et,ge),Y(ce,Ve)},$$slots:{default:!0}}),_(ae),Y(n,ae),Ed()}Tp(["keydown","click"]);var OW=(n,e,t)=>e(i(t)),zW=Me('<li class="w-[140px] h-[85px] flex items-center justify-center cursor-pointer rounded-lg svelte-18wwyns"><span> </span></li>'),VW=Me('<div class="p-2"><ul class="flex flex-wrap justify-center gap-2"></ul></div>');function WW(n,e){Ld(e,!0);const t=tm(),s=()=>vl(l,"$save",t),o=()=>vl(c,"$isRenkoActive",t);let r=pi(e,"show",15);const a=Q3(),l=cd("save"),c=hp(l,h=>{var m,g;return((g=(m=h.styles)==null?void 0:m.candle)==null?void 0:g.type)==="renko_atr"}),f=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600},{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400},{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}];function u(h){var m;Fc(l,Ao(s).period=h,Ao(s));try{const g=(m=s())!=null&&m.key&&typeof s().key=="string"?s().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${g}.lastTimeframe`,(h==null?void 0:h.timeframe)||"")}catch{}try{xw.set(h)}catch{}r(!1)}function d(h){switch(h){case"minute":return u4();case"hour":return d4();case"day":return f4();case"week":return p4();case"month":return m4();default:return h}}sg(n,{title:a,width:500,get show(){return r()},set show(h){r(h)},get theme(){return s().theme},buttons:[],children:(h,m)=>{var g=VW(),w=y(g);Ro(w,21,()=>f,fi,(C,M)=>{var P=Yn(),T=tn(P);Ye(T,()=>!(o()&&i(M).timeframe==="4h"),N=>{var L=zW();L.__click=[OW,u,M];var O=y(L),D=y(O);Ne(()=>tt(D,`${i(M).multiplier??""} ${d(i(M).timespan)??""}`)),_(O),_(L),Ne(()=>{var $,z,te;rr(L,"hover:bg-base-200",i(M).timeframe!==(($=s().period)==null?void 0:$.timeframe)),rr(L,"bg-primary",i(M).timeframe===((z=s().period)==null?void 0:z.timeframe)),rr(L,"text-primary-content",i(M).timeframe===((te=s().period)==null?void 0:te.timeframe))}),Y(N,L)}),Y(C,P)}),_(w),_(g),Y(h,g)},$$slots:{default:!0}}),Ed()}Tp(["click"]);const HW=n=>n;function T8(n){const e=n-1;return e*e*e+1}function l5(n){const e=typeof n=="string"&&n.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[n,"px"]}function __(n,{delay:e=0,duration:t=400,easing:s=HW}={}){const o=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:s,css:r=>`opacity: ${r*o}`}}function vy(n,{delay:e=0,duration:t=400,easing:s=T8,x:o=0,y:r=0,opacity:a=0}={}){const l=getComputedStyle(n),c=+l.opacity,f=l.transform==="none"?"":l.transform,u=c*(1-a),[d,h]=l5(o),[m,g]=l5(r);return{delay:e,duration:t,easing:s,css:(w,C)=>`
			transform: ${f} translate(${(1-w)*d}${h}, ${(1-w)*m}${g});
			opacity: ${c-u*C}`}}function qW(n,{delay:e=0,duration:t=400,easing:s=T8,axis:o="y"}={}){const r=getComputedStyle(n),a=+r.opacity,l=o==="y"?"height":"width",c=parseFloat(r[l]),f=o==="y"?["top","bottom"]:["left","right"],u=f.map(M=>`${M[0].toUpperCase()}${M.slice(1)}`),d=parseFloat(r[`padding${u[0]}`]),h=parseFloat(r[`padding${u[1]}`]),m=parseFloat(r[`margin${u[0]}`]),g=parseFloat(r[`margin${u[1]}`]),w=parseFloat(r[`border${u[0]}Width`]),C=parseFloat(r[`border${u[1]}Width`]);return{delay:e,duration:t,easing:s,css:M=>`overflow: hidden;opacity: ${Math.min(M*20,1)*a};${l}: ${M*c}px;padding-${f[0]}: ${M*d}px;padding-${f[1]}: ${M*h}px;margin-${f[0]}: ${M*m}px;margin-${f[1]}: ${M*g}px;border-${f[0]}-width: ${M*w}px;border-${f[1]}-width: ${M*C}px;`}}function ww(n){const e=n-1;return e*e*e+1}const Px={CURRENT_VERSION:1,DEFAULT_FUTURE_MARGIN_MS:30*60*1e3,MAX_FUTURE_MARGIN_MS:24*60*60*1e3,MIN_FUTURE_MARGIN_MS:5*60*1e3,DEFAULT_FUTURE_MARGIN_PERCENT:.2,TIMESTAMP_PRECISION:1,PRICE_PRECISION:1e-6};function S2(n,e){try{const{chart:t,paneId:s="candle_pane"}=e,o={timestamp:n.t,value:n.p},r=t.convertToPixel(o,{paneId:s,absolute:!0});if(!r||typeof r!="object")return null;const a=Array.isArray(r)?r[0]:r;return!a||typeof a!="object"||typeof a.x!="number"||typeof a.y!="number"||!isFinite(a.x)||!isFinite(a.y)?null:{x:a.x,y:a.y}}catch(t){return console.error("Error converting data-space to screen-space:",t),null}}function UW(n,e,t){try{const{chart:s,paneId:o="candle_pane"}=e,r=s.convertFromPixel([n],{paneId:o});if(!r||!Array.isArray(r)||r.length===0||!r[0])return null;const a=r[0];return typeof a.timestamp!="number"||typeof a.value!="number"||!isFinite(a.timestamp)||!isFinite(a.value)?null:{id:t||GW(),t:Math.round(a.timestamp),p:a.value}}catch(s){return console.error("Error converting screen-space to data-space:",s),null}}function F8(n,e){const t=[];let s=!0,o=!0;for(const r of n){const a=S2(r,e);if(!a){o=!1,t.push({x:0,y:0});continue}t.push(a),(a.x<-100||a.x>1e4||a.y<-100||a.y>1e4)&&(s=!1)}return{screenPoints:t,isVisible:s,isValid:o}}function c5(n,e,t={}){var s,o,r,a,l;try{const c={minMarginMs:Px.MIN_FUTURE_MARGIN_MS,maxMarginMs:Px.MAX_FUTURE_MARGIN_MS,defaultMarginPercent:Px.DEFAULT_FUTURE_MARGIN_PERCENT,...t},f=e.getDataList();if(!f||f.length===0)return;const u=f[f.length-1],d=typeof(u==null?void 0:u.timestamp)=="number"?u.timestamp:null;if(!d||!isFinite(d))return;let h=Number.NEGATIVE_INFINITY;for(const de of n)typeof de.t=="number"&&isFinite(de.t)&&de.t>h&&(h=de.t);if(!Number.isFinite(h)||h<=d)return;const m=Math.max(0,h-d);if(m<=0)return;const g=e.getVisibleRange();let w=0;if(g&&f.length>1){const de=(s=f[Math.max(0,Math.min(f.length-1,g.from))])==null?void 0:s.timestamp,he=(o=f[Math.max(0,Math.min(f.length-1,g.to))])==null?void 0:o.timestamp;typeof de=="number"&&typeof he=="number"&&isFinite(de)&&isFinite(he)&&(w=Math.max(0,he-de))}const C=w>0?Math.floor(w*c.defaultMarginPercent):Math.floor(m*c.defaultMarginPercent),M=Math.min(Math.max(c.minMarginMs,C),c.maxMarginMs),P=Math.min(m+M,c.maxMarginMs),T=d+P,N=u.timestamp;if(N>=T)return;const L=[];for(let de=Math.max(0,f.length-10);de<f.length-1;de++){const he=(r=f[de])==null?void 0:r.timestamp,ge=(a=f[de+1])==null?void 0:a.timestamp;if(typeof he=="number"&&typeof ge=="number"){const ae=ge-he;isFinite(ae)&&ae>0&&L.push(ae)}}const O=L.length?L.sort((de,he)=>de-he)[Math.floor(L.length/2)]:6e4;if(!O||!isFinite(O)||O<=0)return;const D=Math.max(0,Math.ceil((T-N)/O));if(D<=0)return;const $=typeof(u==null?void 0:u.close)=="number"?u.close:typeof(u==null?void 0:u.open)=="number"?u.open:0,z=[];for(let de=1;de<=D;de++){const he=N+de*O;z.push({timestamp:he,open:$,high:$,low:$,close:$,volume:0})}const te=e.getVisibleRange(),pe=te?te.to>=f.length-2:!0,J=[...f,...z];e.applyNewData(J,!1);try{(J??[]).length>0&&(window.hasFirstDataLoaded=!0)}catch{}const le=pe?J.length-1:te?te.to:J.length-1;try{e.scrollToDataIndex(le)}catch{const de=(l=J[le])==null?void 0:l.timestamp;if(typeof de=="number")try{e.scrollToTimestamp(de)}catch{}}}catch{}}function GW(){return`point_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}class YW{constructor(e){$e(this,"chart");$e(this,"context");this.chart=e,this.context={chart:e}}enhanceTemplate(e){const t={...e,originalTemplate:e,createPointFigures:s=>{var a,l;const{overlay:o,coordinates:r}=s;if(this.isDataSpaceOverlay(o)){const c=o,f=F8(c.points,this.context);return f.isValid?t.createDataSpaceFigures?t.createDataSpaceFigures({overlay:c,chart:this.chart,projectionResult:f,screenCoordinates:f.screenPoints}):((a=e.createPointFigures)==null?void 0:a.call(e,{...s,coordinates:f.screenPoints}))||[]:[]}if(t.createDataSpaceFigures){const c={screenPoints:r||[],isVisible:!0,isValid:Array.isArray(r)&&r.length>0};return t.createDataSpaceFigures({overlay:o,chart:this.chart,projectionResult:c,screenCoordinates:c.screenPoints})}return((l=e.createPointFigures)==null?void 0:l.call(e,s))||[]}};return t}createDataSpaceTemplate(e,t){const s={name:e,totalStep:t.totalStep,needDefaultPointFigure:t.needDefaultPointFigure??!0,needDefaultXAxisFigure:t.needDefaultXAxisFigure??!0,needDefaultYAxisFigure:t.needDefaultYAxisFigure??!0,styles:t.styles,onDrawStart:t.onDrawStart,onDrawing:t.onDrawing,onDrawEnd:t.onDrawEnd,onClick:t.onClick,onDoubleClick:t.onDoubleClick,onRightClick:t.onRightClick,onPressedMoveStart:t.onPressedMoveStart,onPressedMoving:t.onPressedMoving,onPressedMoveEnd:t.onPressedMoveEnd,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,onSelected:t.onSelected,onDeselected:t.onDeselected};return this.enhanceTemplate({...s,createDataSpaceFigures:t.createDataSpaceFigures})}isDataSpaceOverlay(e){return e&&typeof e=="object"&&"points"in e&&Array.isArray(e.points)&&e.points.length>0&&e.points.every(t=>t&&typeof t=="object"&&"t"in t&&"p"in t&&"id"in t&&typeof t.t=="number"&&typeof t.p=="number"&&typeof t.id=="string")}screenToDataSpace(e){return[]}updateChart(e){this.chart=e,this.context={chart:e}}}let u5=null;function L8(n){return u5=new YW(n),u5}const cy={windowBars:120,horizons:[5,10,20],topK:200,stride:1,distance:"cosine",halfLifeBars:500,atrLen:14,rsiLen:14,adxLen:14,avwapAnchors:["sessionOpen","prevHigh","prevLow","swingHi","swingLo"],candidateSL:[.6,.8,1,1.25,1.5],useSwingStop:!1,minMatches:100,winsor:.98,bandAlpha:.22,showTable:!0,showBothDirections:!0},E8="npo_mae_settings_v1";function KW(){try{const n=localStorage.getItem(E8);if(!n)return{...cy};const e=JSON.parse(n);return{...cy,...e}}catch{return{...cy}}}function d5(n){try{localStorage.setItem(E8,JSON.stringify(n))}catch{}}function XW(n,e){const t=e.windowBars;if(n.length<t)return new Float32Array;const s=n.length-t,o=n.slice(s),r=T=>{const N=[];for(let L=T;L<o.length;L++){const O=(o[L].close-o[L-T].close)/Math.max(1e-8,o[L-T].close);N.push(O)}return N},a=r(1),l=r(2),c=r(3),f=r(5),u=[];for(let T=0;T<o.length;T++){const N=e.atrLen,L=Math.max(0,T-N+1);let O=0,D=0;for(let $=L;$<=T;$++){const z=o[$].high,te=o[$].low;O+=Math.max(0,z-te),D++}u.push(O/Math.max(1,D))}const h=((T,N)=>{const L=[];for(let O=0;O<T.length;O++){const D=Math.max(0,O-N+1),$=T[D],z=T[O];L.push(z-$)}return L})(u,5),m=[];for(let T=0;T<o.length;T++){const N=o[T],L=Math.max(1e-8,N.high-N.low),O=Math.abs(N.close-N.open);m.push(O/L)}const g=[...a,...l,...c,...f,...u,...h,...m],w=g.reduce((T,N)=>T+N,0)/Math.max(1,g.length),C=Math.sqrt(g.reduce((T,N)=>T+Math.pow(N-w,2),0)/Math.max(1,g.length)),P=g.map(T=>(T-w)/(C>1e-8?C:1)).map(T=>Math.max(-5,Math.min(5,T)));return new Float32Array(P)}function kw(n){const e=n.getDataList();if(!e||e.length===0)return null;const t=e[e.length-1];return{timestamp:t.timestamp,price:t.close}}function ZW(n,e,t,s="candle_pane"){try{const o=n.convertToPixel({timestamp:e,value:t},{paneId:s}),r=Array.isArray(o)?o[0]:o;return(r==null?void 0:r.y)??null}catch{return null}}function JW(n){try{const e=n.getSize(),t=n.getVisibleRange();if(!e||!t)return 4;const s=Math.max(1,t.to-t.from+1);return e.width/s}catch{return 4}}function QW(n){try{const e=n.getDataList();if(!e||e.length<2)return 0;const t=Math.min(10,e.length-1);let s=0;for(let r=e.length-t;r<e.length-1;r++){const a=e[r],l=e[r+1],c=Math.max(0,((l==null?void 0:l.timestamp)??0)-((a==null?void 0:a.timestamp)??0));s+=c}const o=s/Math.max(1,t);return isFinite(o)&&o>0?o:0}catch{return 0}}function eH(n){return L8(n).createDataSpaceTemplate("NearestPatternOutcomeMaeStop",{totalStep:1,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createDataSpaceFigures:({overlay:s,screenCoordinates:o,chart:r})=>{var pe,J,le,de,he,ge;const a=[];if(o.length<1)return a;const l=o[0],c=s.extendData;if(!c)return a;const f=JW(r),u=kw(r);if(!u)return a;const d=u.timestamp,h=u.price,m=c.forwardPathMedianR||[],g=c.forwardPathP10R||[],w=c.forwardPathP90R||[],C=m.map(ae=>h+ae),M=g.map(ae=>h+ae),P=w.map(ae=>h+ae),T=c.bandAlpha??cy.bandAlpha,N=ae=>ZW(r,d,ae),L=QW(r),O=(ae,Ie)=>{const ce=d+(L>0?ae*L:0);try{const je=r.convertToPixel({timestamp:ce,value:Ie},{paneId:"candle_pane"}),Ve=Array.isArray(je)?je[0]:je,We=(Ve==null?void 0:Ve.y)??N(Ie);return{x:(Ve==null?void 0:Ve.x)??l.x+ae*f,y:We??l.y}}catch{const je=N(Ie);return{x:l.x+ae*f,y:je??l.y}}};if(C.length>0){const ae=c.styles&&c.styles.median||{},Ie=typeof ae.size=="number"?ae.size:1,ce=typeof ae.style=="string"?ae.style:"solid";for(let je=0;je<C.length-1;je++){const Ve=O(je,C[je]),We=O(je+1,C[je+1]);a.push({type:"line",attrs:{coordinates:[Ve,We]},styles:{color:((pe=c.colors)==null?void 0:pe.median)||"#66c2a5",size:Ie,style:ce}})}}if(M.length>0&&P.length>0&&c.showOutcomeBand!==!1){const ae=[];for(let ce=0;ce<P.length;ce++)ae.push(O(ce,P[ce]));for(let ce=M.length-1;ce>=0;ce--)ae.push(O(ce,M[ce]));const Ie=c.colors&&c.colors.band||`rgba(102, 194, 165, ${T})`;a.push({type:"polygon",attrs:{coordinates:ae},styles:{color:Ie}})}const D=c.selectedSL,$=c.lastAtr,z=D&&typeof $=="number"?h-D*$:void 0;if(c.showStopLines!==!1&&typeof z=="number"){const ae=N(z);if(ae!=null){const Ie=r.getSize(),ce=(Ie==null?void 0:Ie.width)??0,je=c.styles&&c.styles.slLong||{},Ve=typeof je.size=="number"?je.size:1,We=typeof je.style=="string"?je.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:ae},{x:ce,y:ae}]},styles:{color:((J=c.colors)==null?void 0:J.slLong)||"#e67e22",style:We,size:Ve}});const He=(z??0).toFixed(2);a.push({type:"text",attrs:{x:ce-4,y:ae,text:`SL L ${He}`},styles:{color:((le=c.colors)==null?void 0:le.slLong)||"#e67e22",backgroundColor:"transparent",align:"right",size:11}})}}const te=D&&typeof $=="number"?h+D*$:void 0;if(c.showStopLines!==!1&&typeof te=="number"){const ae=N(te);if(ae!=null){const Ie=r.getSize(),ce=(Ie==null?void 0:Ie.width)??0,je=c.styles&&c.styles.slShort||{},Ve=typeof je.size=="number"?je.size:1,We=typeof je.style=="string"?je.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:ae},{x:ce,y:ae}]},styles:{color:((de=c.colors)==null?void 0:de.slShort)||"#c0392b",style:We,size:Ve}});const He=(te??0).toFixed(2);a.push({type:"text",attrs:{x:ce-4,y:ae,text:`SL S ${He}`},styles:{color:((he=c.colors)==null?void 0:he.slShort)||"#c0392b",backgroundColor:"transparent",align:"right",size:11}})}}if(c.showTable&&Array.isArray(c.evTable)){const ae=r.getSize(),Ie=(ae==null?void 0:ae.width)??0,ce=240,je=10,Ve=10,We=18,He=Math.min(c.evTable.length,6),Ue=20,et=Ve*2+Ue+He*We,ft=12,Lt=Math.max(ft,Ie-ce-ft-80),Tt=10,Pt=typeof document<"u"&&((ge=document==null?void 0:document.documentElement)==null?void 0:ge.getAttribute("data-theme"))||"",St=String(Pt).toLowerCase().includes("dark"),st=St?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)",xt=St?"rgba(140,160,220,0.35)":"rgba(80,100,160,0.35)",Je=St?"rgba(28,34,50,0.90)":"rgba(232,236,250,0.90)",Xe=St?"#a7b3d8":"#415277",Be=St?"#cfd6ee":"#1f2937";a.push({type:"rect",attrs:{x:Lt,y:Tt,width:ce,height:et},styles:{style:"fill",color:st}}),a.push({type:"rect",attrs:{x:Lt,y:Tt,width:ce,height:et},styles:{style:"stroke",color:xt,borderSize:1,borderStyle:"solid"}});const Qe=ce-je*2,ct=Te=>Math.min(Lt+ce-je-4,Te),Mt={mark:ct(Lt+je),side:ct(Lt+je+12),mult:ct(Lt+je+Qe*.1),ev:ct(Lt+je+Qe*.35),pwin:ct(Lt+je+Qe*.55),winr:ct(Lt+je+Qe*.72),lossr:ct(Lt+je+Qe*.88)};let mt=Tt+Ve+2;a.push({type:"rect",attrs:{x:Lt+1,y:Tt+1,width:ce-2,height:Ue},styles:{style:"fill",color:Je}}),a.push({type:"text",attrs:{x:Mt.mult,y:mt,text:"SL"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.ev,y:mt,text:"EV"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.pwin,y:mt,text:"pWin"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.winr,y:mt,text:"winR"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.lossr,y:mt,text:"lossR"},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),mt+=Ue-6;for(let Te=0;Te<He;Te++){const It=c.evTable[Te],$t=c.selectedSL===It.mult;a.push({type:"text",attrs:{x:Mt.mark,y:mt,text:$t?"▶":"•"},styles:{color:Be,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.side,y:mt,text:It.side==="long"?"L":"S"},styles:{color:Be,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.mult,y:mt,text:`${It.mult.toFixed(2)}×`},styles:{color:Be,size:12,backgroundColor:"transparent"}});const Yt=`${It.ev>=0?"+":""}${It.ev.toFixed(2)}`;a.push({type:"text",attrs:{x:Mt.ev,y:mt,text:Yt},styles:{color:Be,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.pwin,y:mt,text:`${Math.round(It.pWin*100)}%`},styles:{color:Be,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.winr,y:mt,text:It.avgWinR.toFixed(2)},styles:{color:Be,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:Mt.lossr,y:mt,text:It.avgLossR.toFixed(2)},styles:{color:Be,size:12,backgroundColor:"transparent"}}),mt+=We}const Ce=(()=>{const Te=c.selectedSide;return c.evTable.find($t=>$t.mult===c.selectedSL&&(!Te||$t.side===Te))||c.evTable.find($t=>$t.mult===c.selectedSL)||null})();if(Ce){const It=Tt+et+6,$t=86,Yt=Ce.side==="long"?"Long":"Short",qn=`${Ce.mult.toFixed(2)}× ATR`,Vn=h.toFixed(2),Dn=(Ce.side==="long"?h-Ce.mult*($??0):h+Ce.mult*($??0)).toFixed(2),Wn=Math.round((Ce.pWin??0)*100);a.push({type:"rect",attrs:{x:Lt,y:It,width:ce,height:$t},styles:{style:"fill",color:St?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)"}}),a.push({type:"rect",attrs:{x:Lt,y:It,width:ce,height:$t},styles:{style:"stroke",color:xt,borderSize:1,borderStyle:"solid"}});let pn=It+8+2;a.push({type:"text",attrs:{x:Lt+8,y:pn,text:`Active: ${Yt}`},styles:{color:Xe,size:12,backgroundColor:"transparent"}}),pn+=18,a.push({type:"text",attrs:{x:Lt+8,y:pn,text:`Anchor: ${Vn}`},styles:{color:Be,size:12,backgroundColor:"transparent"}}),pn+=18,a.push({type:"text",attrs:{x:Lt+8,y:pn,text:`Stop: ${Dn} (${qn})`},styles:{color:Be,size:12,backgroundColor:"transparent"}}),pn+=18,a.push({type:"text",attrs:{x:Lt+8,y:pn,text:`pWin ${Wn}% • winR ${Ce.avgWinR.toFixed(2)} • lossR ${Ce.avgLossR.toFixed(2)}`},styles:{color:Be,size:12,backgroundColor:"transparent"}});const gn=Math.abs(h-(Ce.side==="long"?h-Ce.mult*($??0):h+Ce.mult*($??0))),Qs=w.length&&g.length?Math.max(0,(w[0]??0)-(g[0]??0)):0,Is=Qs<=1,Cs=Qs>=2,ro=Ce.side==="long"&&(Ce.ev??0)>=.15&&(Ce.pWin??0)>=.52&&!Cs,bs=Ce.side==="short"&&(Ce.ev??0)>=.1&&(Ce.pWin??0)>=.5&&!Cs,zt=ro?"BUY":bs?"SELL":"WAIT",Qt=ro?"#10b981":bs?"#ef4444":St?"#f59e0b":"#b45309",ho=It+$t+6,ri=74,jo=St?"rgba(20,24,32,0.85)":"rgba(240,244,255,0.95)";a.push({type:"rect",attrs:{x:Lt,y:ho,width:ce,height:ri},styles:{style:"fill",color:jo}}),a.push({type:"rect",attrs:{x:Lt,y:ho,width:ce,height:ri},styles:{style:"stroke",color:xt,borderSize:1,borderStyle:"solid"}});let Na=ho+8+2;a.push({type:"text",attrs:{x:Lt+8,y:Na,text:`Action: ${zt}`},styles:{color:Qt,size:13,backgroundColor:"transparent"}}),Na+=18;const ar=Is?"Band: Narrow":Cs?"Band: Wide":"Band: Normal",Aa=`1R: ${gn.toFixed(2)}`,nr=ro?"EV≥0.30, pWin≥55%":bs?"EV≥0.20, pWin≥50%":"Low EV / Wide band / Low pWin";a.push({type:"text",attrs:{x:Lt+8,y:Na,text:`${ar} • ${Aa}`},styles:{color:Be,size:12,backgroundColor:"transparent"}}),Na+=18,a.push({type:"text",attrs:{x:Lt+8,y:Na,text:nr},styles:{color:Xe,size:12,backgroundColor:"transparent"}})}}return a},onClick:s=>{var c;const o=s.overlay.extendData;if(!o||!Array.isArray(o.evTable))return!0;const a=(o.evTable.findIndex(f=>f.mult===o.selectedSL)+1)%o.evTable.length,l=o.evTable[a];return l&&(o.selectedSL=l.mult,o.selectedSide=l.side,(c=s.chart)==null||c.overrideOverlay({id:s.overlay.id,extendData:o})),!0}})}function tH(){return new Worker(new URL(""+new URL("../workers/npoMae.worker-DaGdsbjp.js",import.meta.url).href,import.meta.url),{type:"module"})}function nH(n,e){const t=eH(n);I3(t);let s={...KW()},o=null,r=!0,a=tH(),l=0,c=-1,f=0,u=!0,d=!0;function h(){var N;if(!o){const L=kw(n),O=L?[{timestamp:L.timestamp,value:L.price}]:[],D=n.createOverlay({name:"NearestPatternOutcomeMaeStop",points:O});o=Array.isArray(D)?(D==null?void 0:D[0])??null:D,m();try{const $=Qg(),z=((N=$==null?void 0:$.getCurrentSymbol)==null?void 0:N.call($))||null;$&&z&&o&&$.addDrawing({id:o,symbolKey:z,type:"NearestPatternOutcomeMaeStop",points:L?[{time:L.timestamp,price:L.price}]:[],styles:{},visible:!0})}catch{}}}function m(){var L,O;if(!o)return;const N=kw(n);if(N)try{const D=(L=n.getOverlays)==null?void 0:L.call(n,{id:o}),$=Array.isArray(D)&&D.length>0?D[0]:null,z=(O=$==null?void 0:$.points)==null?void 0:O[0],te=(z==null?void 0:z.timestamp)??(z==null?void 0:z.time)??(z==null?void 0:z.t),pe=(z==null?void 0:z.value)??(z==null?void 0:z.price)??(z==null?void 0:z.p);if(typeof te!="number"||typeof pe!="number"||te!==N.timestamp||Math.abs(pe-N.price)>1e-6){n.overrideOverlay({id:o,points:[{timestamp:N.timestamp,value:N.price}]});try{const le=Qg();le&&o&&le.updateDrawing(o,{points:[{time:N.timestamp,price:N.price}]})}catch{}}}catch{}}function g(N){if(!o)return;const L={...N,bandAlpha:s.bandAlpha,showTable:s.showTable,showStopLines:d,showOutcomeBand:u};f&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{n.overrideOverlay({id:o,extendData:L});try{const O=Qg();O&&o&&O.updateDrawing(o,{extendData:L})}catch{}})}function w(){if(!r||!a)return;m();const N=n.getDataList();if(!N||N.length<Math.max(s.windowBars+Math.max(...s.horizons),10)){g({forwardPathMedian:[],forwardPathP10:[],forwardPathP90:[],evTable:[],suggestedSL:null});return}const L=N.map(z=>({time:z.timestamp,open:z.open,high:z.high,low:z.low,close:z.close,volume:z.volume})),O=XW(L,s),D=++l;c=D;const $={id:D,settings:s,features:O,bars:L};a.postMessage($,[O.buffer])}function C(N){var te,pe;const L=N.data;if(!L||L.id!==c)return;const O=Math.max(...s.horizons),D=L.byHorizon[O];if(!D)return;const $=L.slSuggest||{},z=sH(n,s.atrLen);g({forwardPathMedianR:D.forwardPathMedian,forwardPathP10R:D.forwardPathP10,forwardPathP90R:D.forwardPathP90,evTable:$.evTable||[],selectedSL:((te=$.long)==null?void 0:te.mult)??((pe=$.short)==null?void 0:pe.mult),selectedSide:$.long?"long":$.short?"short":void 0,lastAtr:z})}a&&(a.onmessage=C),h(),w();const M=window.setInterval(()=>{h(),w()},500),P=N=>{N.key==="O"||N.key==="o"?(u=!u,g({})):(N.key==="S"||N.key==="s")&&(d=!d,g({}))};return window.addEventListener("keydown",P,{capture:!0}),{setEnabled(N){r=N,r&&w()},updateSettings(N){s={...s,...N},d5(s),w()},setShowOutcomeBand(N){u=N,g({})},setShowStopLines(N){d=N,g({})},setColors(N){g({colors:N})},setStyles(N){g({styles:N})},resetSettings(){s={...cy},d5(s),w()},getOverlayId(){return o},dispose(){if(window.removeEventListener("keydown",P,{capture:!0}),window.clearInterval(M),a&&(a.terminate(),a=null),o)try{n.removeOverlay({id:o})}catch{}}}}function sH(n,e){const t=n.getDataList();if(!t||t.length===0)return 1;const s=Math.min(e,t.length);let o=0;for(let r=t.length-s;r<t.length;r++){const a=t[r].high,l=t[r].low;o+=Math.max(0,a-l)}return o/Math.max(1,s)}var oH=(n,e)=>x(e,""),iH=Me('<button class="absolute right-4 top-1/2 transform -translate-y-1/2 hover:scale-110 transition-all duration-300 z-10 clear-search-btn svelte-e5btcs" title="Clear search"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button>'),rH=(n,e,t,s)=>!i(e)&&t(i(s).is_main,i(s).name),aH=(n,e)=>{n.stopPropagation(),x(e,!0)},lH=Me('<button class="w-8 h-8 rounded-full ml-2 opacity-0 group-hover:opacity-100 hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm info-btn svelte-e5btcs" title="How it works"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></button>'),cH=(n,e,t)=>{n.stopPropagation(),e(i(t).name)},uH=(n,e,t)=>{n.stopPropagation(),e(i(t).name)},dH=Me('<div class="flex items-center gap-2 ml-4 opacity-100 transition-all duration-300 svelte-e5btcs"><button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm edit-btn svelte-e5btcs" title="Edit Parameters"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" class="svelte-e5btcs"></path></svg></button> <button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm delete-btn svelte-e5btcs" title="Remove Indicator"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button></div>'),fH=Me('<div><div></div> <div class="flex-1 min-w-0 svelte-e5btcs"><span> </span></div> <!> <!></div>'),pH=Me('<div class="flex flex-col items-center justify-center py-16 text-center svelte-e5btcs"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4 svelte-e5btcs"><svg class="w-8 h-8 text-base-content/40 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2 svelte-e5btcs">No indicators found</p> <p class="text-sm text-base-content/40 svelte-e5btcs">Try a different search term</p></div>'),mH=Me(`<div class="flex flex-col gap-6 svelte-e5btcs"><div><div class="absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none z-10 transition-all duration-300 search-icon svelte-e5btcs"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <input type="text" class="w-full pl-12 pr-12 py-3.5 text-[15px] font-medium tracking-wide backdrop-blur-sm rounded-2xl
               focus:outline-none transition-all duration-500 ease-out
               placeholder:font-normal search-input svelte-e5btcs"> <!></div> <div class="relative rounded-2xl overflow-hidden backdrop-blur-sm indicator-list-container svelte-e5btcs"><div class="indicator-scroll ultra-minimal-scrollbar svelte-e5btcs"><!> <!></div></div> <div class="flex justify-center items-center py-2 mt-1 svelte-e5btcs"><div class="group relative cursor-pointer svelte-e5btcs"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl svelte-e5btcs"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out svelte-e5btcs"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse svelte-e5btcs"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300 svelte-e5btcs">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500 svelte-e5btcs">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse svelte-e5btcs" style="animation-delay: 0.5s;"></div></div></div></div></div>`),hH=(n,e)=>x(e,!1),vH=(n,e)=>x(e,"bn"),gH=(n,e)=>x(e,"en"),_H=(n,e)=>x(e,!1),yH=Me(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">খুব সহজ ব্যাখ্যা</div> <p class="text-sm text-base-content/70 svelte-e5btcs">মনে করুন আপনি আগের দিনের ছবি দেখে আজকের দিনের কথা অনুমান করছেন।
                এই ইন্ডিকেটরটি ঠিক তেমনই করে—এখনকার দামের সঙ্গে খুব মিল‑থাকা
                আগের প্যাটার্ন খুঁজে নেয়, তাদের পথ ধরে সামনে কী হতে পারে তা
                অনুমান করে, আর অতীতে কতটা উল্টো দিকে গেছে সেটাকে ধরে নিরাপদ
                থামার জায়গা (স্টপ‑লস) বলে দেয়।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">উদাহরণ: ধরুন আজকের দামের গতি অনেকটা গত মাসের ১৫ তারিখের মতো।
                ইন্ডিকেটরটি তখন গত মাসের ১৫ তারিখের পরের দিনগুলো কী হয়েছিল সেটা
                দেখে আজকের পরের দিনগুলোর জন্য অনুমান করে।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">চার্টে রঙের ব্যান্ডটি P10–P90 প্রত্যাশিত রেঞ্জ বোঝায়—মানে ১০০‑এর
                মধ্যে ৮০ বার দাম এই সীমার মধ্যে থাকতে পারে। মাঝের রেখাটি মাঝের
                রাস্তা (মিডিয়ান পথ)—দাম সাধারণত এই পথ ধরে চলতে পারে। আর ড্যাশড
                লাইনগুলো লং/শর্টের স্টপ—এগুলোতে পৌঁছালে থামার সংকেত।</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">চার্ট উপাদান</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">মাঝের রাস্তা: দাম সাধারণত কোন পথে যেতে পারে তার মাঝের লাইন।</li> <li class="svelte-e5btcs">রঙের ব্যান্ড: সম্ভাব্য ওঠা‑নামার এলাকা (P10–P90)। সরু মানে
                  পরিষ্কার পথ, প্রশস্ত মানে বেশি অনিশ্চয়তা।</li> <li class="svelte-e5btcs">স্টপের দাগ: লং/শর্টের প্রস্তাবিত স্টপ‑লসের ড্যাশড লাইন।</li> <li class="svelte-e5btcs">ইভি টেবিল: কোন স্টপ নিলে মোটের উপর লাভ‑ক্ষতি কেমন হতে পারে তা
                  দেখায়।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ওভারলে প্যানেলগুলো</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">তথ্য প্যানেল</span>: <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (বর্তমান
                  দাম), <span class="font-medium svelte-e5btcs">Stop</span> (SL মূল্য ও ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span> দেখায়—সিদ্ধান্তের জন্য দ্রুত
                  প্রেক্ষাপট দেয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">সিদ্ধান্ত প্যানেল</span>: বড় অক্ষরে <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> দেখায়। সঙ্গে <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> দূরত্ব ও <span class="font-medium svelte-e5btcs">শর্তের সারাংশ</span> দেখায়। <br class="svelte-e5btcs">BUY (লং): EV ≥ 0.30 ও pWin ≥ 55%, ব্যান্ড Wide না হলে। <br class="svelte-e5btcs">SELL (শর্ট): EV ≥ 0.20 ও pWin ≥ 50%, ব্যান্ড Wide না
                  হলে। <br class="svelte-e5btcs">অন্যথা: WAIT।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ইভি টেবিল (উদাহরণ)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">পজিশন</th><th class="svelte-e5btcs">এসএল (×এটিআর)</th><th class="svelte-e5btcs">ইভি (আর)</th><th class="svelte-e5btcs">জেতার সম্ভাবনা (%)</th><th class="svelte-e5btcs">উইন R</th><th class="svelte-e5btcs">লস R</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি: মোটের উপর গড় প্রত্যাশা। জেতা‑হারা দুটো মিলিয়ে ফল কেমন
                  হবে।</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা (%): ১০০‑এর মধ্যে সংখ্যা। যত বেশি, জেতার
                  সম্ভাবনা তত বেশি।</li> <li class="svelte-e5btcs">উইন R ও লস R: জিতলে আনুমানিক কত, হারলে আনুমানিক কত। ভারসাম্য
                  দেখুন।</li> <li class="svelte-e5btcs">ইভি ≥ 0 হলে সারি বিবেচনা করুন; ইভি যত বেশি, মোট প্রত্যাশা তত
                  ভালো।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টেবিলের ▶ চিহ্ন (অ্যারো) কীভাবে কাজ করে</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">টেবিলের সারিতে ▶ দেখায় কোন এসএল মাল্টিপ্লায়ার এখন সক্রিয়।
                  ভেতরে ক্লিক করলে ▶ পরের সারিতে যায়।</li> <li class="svelte-e5btcs">▶ যে সারিতে থাকে, সেই সারির <span class="font-medium svelte-e5btcs">SL (×ATR)</span> অনুযায়ী চার্টের ড্যাশড স্টপ‑লাইন আপডেট হয়।</li> <li class="svelte-e5btcs">▶ যদি লং সারিতে থাকে: সিদ্ধান্ত লং বায়াসে ভাবুন; স্টপ সাধারণত
                  বর্তমান দামের নিচে (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">▶ যদি শর্ট সারিতে থাকে: সিদ্ধান্ত শর্ট বায়াসে ভাবুন; স্টপ
                  সাধারণত বর্তমান দামের উপরে (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">সেরা নির্বাচন: ▶ কে এমন সারিতে রাখুন যেখানে <span class="font-medium svelte-e5btcs">EV পজিটিভ</span>, <span class="font-medium svelte-e5btcs">pWin বেশি</span>, আর <span class="font-medium svelte-e5btcs">lossR নিয়ন্ত্রণে</span> থাকে।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (শর্ট)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ শর্ট সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1.5 × ATR</span> উপরে। দূর স্টপ → কম
                    স্টপ‑হিট; কিন্তু রিস্ক ইউনিট বড় হয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> মানে জিতলে গড় লাভ <span class="font-medium svelte-e5btcs">1.71R</span>। যদি 1R = 100 টাকা
                    রিস্ক ধরেন, জিতলে গড়ে 171 টাকা।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> মানে হারলে গড়
                    ক্ষতি <span class="font-medium svelte-e5btcs">1.46R</span> ≈ 146 টাকা।</li> <li class="svelte-e5btcs">সিদ্ধান্ত: pWin যদি ~55% হয়, তাহলে <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → গ্রহণযোগ্য।</li> <li class="svelte-e5btcs">যদি pWin 45%‑এর নিচে নামে বা lossR বেশি হয়, ▶ অন্য সারিতে
                    সরান (কম SL বা ভালো EV)।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (লং)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ লং সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1 × ATR</span> নিচে। কাছের স্টপ → ঝুঁকি
                    ছোট; কিন্তু স্টপ‑হিট হতে পারে বেশি।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> মানে জিতলে গড় লাভ
                    1.40R।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> মানে হারলে গড় ক্ষতি
                    0.90R।</li> <li class="svelte-e5btcs">pWin যদি ~60% হয়, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → শক্ত সিদ্ধান্ত।</li> <li class="svelte-e5btcs">যদি ব্যান্ড খুব প্রশস্ত বা pWin কম হয়, ▶ কে এমন সারিতে নিন
                    যেখানে EV পজিটিভ ও lossR নিয়ন্ত্রিত।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ব্যান্ড ভিত্তিক সিদ্ধান্ত</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ব্যান্ড সরু: পথ পরিষ্কার—আত্মবিশ্বাস একটু বাড়ানো যেতে পারে।</li> <li class="svelte-e5btcs">ব্যান্ড প্রশস্ত: অনিশ্চয়তা বেশি—সাইজ কমান বা একটু অপেক্ষা
                  করুন।</li> <li class="svelte-e5btcs">ব্যান্ড যদি বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে যায়: সতর্ক
                  থাকুন, স্টপ দূরে রাখুন।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">উদাহরণ</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">লং বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা উপরে দিকে। ইভি +0.30→+0.60, জেতার সম্ভাবনা
                    55–65%। এসএল 1.0×–1.25× নিলে সাধারণত জেতার সম্ভাবনা ও লস
                    R‑এর মধ্যে ভালো ভারসাম্য থাকে।</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">শর্ট বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা নিচের দিকে। শর্ট ইভি +0.20→+0.45। ব্যান্ড যদি
                    আগের নিচু জায়গার সঙ্গে মিলে যায়, এসএল 0.8×–1.0× নিলে সতর্ক
                    এন্ট্রির জন্য ভালো হয়।</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন কিনবেন/বিক্রি করবেন</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">কিনবেন কখন (লং)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">ইভি +0.30 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 55% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে (পরিষ্কার পথ)</li> <li class="svelte-e5btcs">মাঝের রাস্তা উপরের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 1.0×–1.25× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.45, pWin 62%, ব্যান্ড সরু → কিনুন</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">বিক্রি করবেন কখন (শর্ট)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">শর্ট ইভি +0.20 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 50% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে</li> <li class="svelte-e5btcs">মাঝের রাস্তা নিচের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 0.8×–1.0× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.25, pWin 54%, ব্যান্ড সরু → বিক্রি করুন</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন অপেক্ষা করবেন</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি নেগেটিভ হলে (−0.10 বা তার কম)</li> <li class="svelte-e5btcs">ব্যান্ড খুব প্রশস্ত হলে (অনিশ্চয়তা বেশি)</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 45% এর কম হলে</li> <li class="svelte-e5btcs">ব্যান্ড বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে গেলে</li> <li class="svelte-e5btcs">winR/lossR ভারসাম্য খারাপ হলে (winR ≤ 1.0 বা lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">উদাহরণ: ইভি −0.15, pWin 42%, ব্যান্ড প্রশস্ত → অপেক্ষা করুন</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টিপস</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">এডিট পপআপে গিয়ে ব্যান্ডের রং, অপাসিটি ও লাইনের স্টাইল বদলাতে
                  পারেন।</li> <li class="svelte-e5btcs">ইভি টেবিলে ক্লিক করলে স্টপ পাল্টায়; চার্টের ড্যাশড লাইনও সাথে
                  সাথে বদলে যায়।</li> <li class="svelte-e5btcs">ট্রেন্ড ফিল্টার বা ভলিউমের সঙ্গে জোড়া দিলে সিদ্ধান্ত আরও শক্ত
                  হয়।</li> <li class="svelte-e5btcs">রিস্ক ম্যানেজমেন্ট: এক ট্রেডে 1–2% এর বেশি রিস্ক নেবেন না</li> <li class="svelte-e5btcs">কনফার্মেশন: ক্যান্ডেলস্টিক প্যাটার্ন বা ইন্ডিকেটর কনফার্মেশন
                  নিন</li></ul></div>`,1),bH=Me(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Simple Explanation</div> <p class="text-sm text-base-content/70 svelte-e5btcs">Think of it like looking at old pictures to guess today’s story.
                The indicator finds past patterns that look very similar to now,
                follows their path to estimate what might happen next, and uses
                historical MAE to suggest a safe place to stop (stop‑loss). The
                colored band is the expected range (P10–P90), the middle line is
                the median path, and the dashed lines are suggested long/short
                stops.</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Chart Elements</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Middle road: the central line showing the likely path.</li> <li class="svelte-e5btcs">Colored band: the area where price may move (P10–P90). Narrow
                  means clearer path; wide means more uncertainty.</li> <li class="svelte-e5btcs">Stop marks: dashed lines for suggested long/short stops.</li> <li class="svelte-e5btcs">EV table: shows overall gain‑loss balance for different stops.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Overlay Panels</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Info Panel</span>: shows <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (current
                  price), <span class="font-medium svelte-e5btcs">Stop</span> (SL price and
                  ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span>—quick context for
                  decisions.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Decision Panel</span>: prominently
                  displays <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> with <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> distance, and <span class="font-medium svelte-e5btcs">criteria summary</span>. <br class="svelte-e5btcs">BUY (Long): EV ≥ 0.30 and pWin ≥ 55%, band not Wide. <br class="svelte-e5btcs">SELL (Short): EV ≥ 0.20 and pWin ≥ 50%, band not Wide. <br class="svelte-e5btcs">Otherwise: WAIT.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">EV Table (Example)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">Side</th><th class="svelte-e5btcs">SL (×ATR)</th><th class="svelte-e5btcs">EV (R)</th><th class="svelte-e5btcs">pWin (%)</th><th class="svelte-e5btcs">winR</th><th class="svelte-e5btcs">lossR</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV: the overall expectancy—combines win and loss outcomes.</li> <li class="svelte-e5btcs">pWin (%): out of 100. Higher means better chance to win.</li> <li class="svelte-e5btcs">winR and lossR: how much you might win or lose. Balance them.</li> <li class="svelte-e5btcs">If EV ≥ 0, consider the row; higher EV means better overall
                  expectancy.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">How the ▶ arrow works</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">The ▶ in the table marks the <span class="font-medium svelte-e5btcs">active SL multiplier</span>. Click inside the table to move it to the next row.</li> <li class="svelte-e5btcs">Where ▶ sits, the chart’s dashed stop‑lines update using that
                  row’s <span class="font-medium svelte-e5btcs">SL (×ATR)</span>.</li> <li class="svelte-e5btcs">If ▶ is on a Long row: think with a long bias; the stop is
                  usually below current price (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">If ▶ is on a Short row: think with a short bias; the stop is
                  usually above current price (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">Best practice: place ▶ on rows with <span class="font-medium svelte-e5btcs">positive EV</span>, <span class="font-medium svelte-e5btcs">higher pWin</span>, and <span class="font-medium svelte-e5btcs">controlled lossR</span>.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Short)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Short row with <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1.5 × ATR</span> above
                    anchor. Far stop → fewer stop‑hits; risk unit is larger.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> means average win
                    is <span class="font-medium svelte-e5btcs">1.71R</span>. If 1R = 100 units
                    risk, average win ≈ 171.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> means average
                    loss is <span class="font-medium svelte-e5btcs">1.46R</span>.</li> <li class="svelte-e5btcs">Decision: if pWin ≈ 55%, <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → acceptable.</li> <li class="svelte-e5btcs">If pWin drops below ~45% or lossR rises, move ▶ to a better
                    row (smaller SL or higher EV).</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Long)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Long row with <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1 × ATR</span> below anchor.
                    Closer stop → smaller risk; may get hit more often.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> means average win
                    is 1.40R.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> means average loss
                    is 0.90R.</li> <li class="svelte-e5btcs">If pWin ≈ 60%, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → strong setup.</li> <li class="svelte-e5btcs">If band is very wide or pWin is low, move ▶ to rows with
                    positive EV and controlled lossR.</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Band‑Based Decisions</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Narrow band: clearer path—slightly increase conviction if
                  suitable.</li> <li class="svelte-e5btcs">Wide band: more uncertainty—reduce size or wait for clarity.</li> <li class="svelte-e5btcs">If band overlaps major support/resistance: be cautious; use a
                  safer stop.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Examples</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Long Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is upward. EV +0.30→+0.60, pWin 55–65%. SL
                    1.0×–1.25× often gives a good balance between win chance and
                    lossR.</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Short Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is downward. Short EV +0.20→+0.45. If the band
                    overlaps prior lows, SL 0.8×–1.0× is a careful choice.</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Buy/Sell</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Buy When (Long)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">EV +0.30 or higher</li> <li class="svelte-e5btcs">pWin 55% or higher</li> <li class="svelte-e5btcs">Band is narrow (clear path)</li> <li class="svelte-e5btcs">Middle road is upward</li> <li class="svelte-e5btcs">Stop-loss 1.0×–1.25× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.45, pWin 62%, narrow band → Buy</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Sell When (Short)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">Short EV +0.20 or higher</li> <li class="svelte-e5btcs">pWin 50% or higher</li> <li class="svelte-e5btcs">Band is narrow</li> <li class="svelte-e5btcs">Middle road is downward</li> <li class="svelte-e5btcs">Stop-loss 0.8×–1.0× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.25, pWin 54%, narrow band → Sell</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Wait</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV is negative (−0.10 or worse)</li> <li class="svelte-e5btcs">Band is very wide (high uncertainty)</li> <li class="svelte-e5btcs">pWin below 45%</li> <li class="svelte-e5btcs">Band overlaps major support/resistance</li> <li class="svelte-e5btcs">Poor winR/lossR balance (winR ≤ 1.0 or lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">Example: EV −0.15, pWin 42%, wide band → Wait</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Tips</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Use the edit popup to change band opacity, colors, and line
                  styles.</li> <li class="svelte-e5btcs">Click inside the EV table to change stops; dashed lines update
                  instantly.</li> <li class="svelte-e5btcs">Pair with trend filters or volume to make decisions more
                  robust.</li> <li class="svelte-e5btcs">Risk management: Don't risk more than 1–2% per trade</li> <li class="svelte-e5btcs">Confirmation: Wait for candlestick pattern or indicator
                  confirmation</li></ul></div>`,1),xH=Me('<div class="fixed inset-0 z-[60] svelte-e5btcs"><div class="absolute inset-0 bg-base-200/20 svelte-e5btcs"></div> <div class="absolute inset-0 flex items-center justify-center p-4 svelte-e5btcs"><div class="w-full max-w-3xl rounded-xl shadow-2xl border border-base-300 bg-base-100 overflow-hidden svelte-e5btcs"><div class="flex items-center justify-between px-5 py-4 border-b border-base-300 bg-base-50 svelte-e5btcs"><div class="flex items-center gap-3 svelte-e5btcs"><div class="w-8 h-8 rounded-lg flex items-center justify-center bg-primary/10 text-primary svelte-e5btcs"><svg class="w-5 h-5 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></div> <div class="svelte-e5btcs"><div class="text-base font-semibold text-base-content svelte-e5btcs"> </div> <div class="text-xs text-base-content/60 svelte-e5btcs"> </div></div></div> <div class="flex items-center gap-2 svelte-e5btcs"><button>বাংলা</button> <button>English</button></div> <button class="btn btn-xs btn-ghost svelte-e5btcs" aria-label="Close"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button></div> <div class="px-5 py-4 space-y-5 max-h-[70vh] overflow-y-auto svelte-e5btcs"><!></div></div></div></div>'),wH=(n,e)=>x(e,!1),kH=(n,e)=>x(e,!1),SH=Me(`<div class="premium-modal-backdrop svelte-e5btcs" role="presentation"></div> <div class="premium-modal-container svelte-e5btcs" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-e5btcs"><div class="premium-orb premium-orb-1 svelte-e5btcs"></div> <div class="premium-orb premium-orb-2 svelte-e5btcs"></div></div> <div class="premium-content svelte-e5btcs"><button class="premium-close-btn svelte-e5btcs" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button> <div class="premium-icon-wrapper svelte-e5btcs"><div class="premium-icon svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-e5btcs"></path><path d="M2 17l10 5 10-5" class="svelte-e5btcs"></path><path d="M2 12l10 5 10-5" class="svelte-e5btcs"></path></svg> <div class="premium-icon-glow svelte-e5btcs"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-e5btcs">Premium Feature</h2> <p class="premium-message svelte-e5btcs">Smart Trend is an exclusive premium indicator. Upgrade to Premium to
        unlock this advanced trend-following tool and enhance your trading
        strategy.</p> <div class="premium-features svelte-e5btcs"><div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">Smart Trend Indicator</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">AI Indicators (Smart Money, Trap Hunter, Volcanic)</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">More premium features coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-e5btcs"><span class="svelte-e5btcs">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="5" y1="12" x2="19" y2="12" class="svelte-e5btcs"></line><polyline points="12 5 19 12 12 19" class="svelte-e5btcs"></polyline></svg></a></div></div>`,1),CH=Me("<!> <!> <!>",1);function IH(n,e){Ld(e,!0);const t=tm(),s=()=>vl(u,"$chart",t),o=()=>vl(f,"$save",t),r=()=>vl(c,"$ctx",t),a=()=>vl(B0,"$userPreferences",t);let l=pi(e,"show",15);const c=cd("ctx"),f=cd("save"),u=cd("chart"),d=f6(),h=[{name:"BBI",title:"BBI (Bull and Bear Index)",is_main:!1},{name:"BOLL",title:"BOLL (Bollinger Bands)",is_main:!0},{name:"EMA",title:"EMA (Exponential Moving Average)",is_main:!0},{name:"ICHIMOKU",title:"ICHIMOKU (Ichimoku Kinko Hyo)",is_main:!0},{name:"MA",title:"MA (Moving Average)",is_main:!0},{name:"SAR",title:"SAR (Parabolic SAR)",is_main:!0},{name:"SMA",title:"SMA (Simple Moving Average)",is_main:!0},{name:"SMARTTREND",title:"Smart Trend",is_main:!0},{name:"ZIGZAG",title:"ZigZag (Trend Reversal Indicator)",is_main:!0},{name:"AO",title:"Awesome Oscillator",is_main:!1},{name:"BIAS",title:"BIAS (Bias)",is_main:!1},{name:"CCI",title:"CCI (Commodity Channel Index)",is_main:!1},{name:"CR",title:"CR (Energy)",is_main:!1},{name:"DMI",title:"DMI (Directional Movement Index)",is_main:!1},{name:"EMV",title:"EMV (Ease of Movement)",is_main:!1},{name:"KDJ",title:"KDJ (KDJ Index)",is_main:!1},{name:"MACD",title:"MACD (Moving Average Convergence Divergence)",is_main:!1},{name:"MTM",title:"MTM (Momentum)",is_main:!1},{name:"OBV",title:"OBV (On Balance Volume)",is_main:!1},{name:"PSY",title:"PSY (Psychological Line)",is_main:!1},{name:"PVT",title:"PVT (Price Volume Trend)",is_main:!1},{name:"ROC",title:"ROC (Rate of Change)",is_main:!1},{name:"RSI",title:"RSI (Relative Strength Index)",is_main:!1},{name:"STOCH",title:"STOCH (Stochastic Oscillator)",is_main:!1},{name:"TRIX",title:"TRIX (Triple Exponential Moving Average)",is_main:!1},{name:"VOL",title:"VOL (Volume)",is_main:!0},{name:"VR",title:"VR (Volume Variation Rate)",is_main:!1},{name:"WR",title:"WR (Williams Percentage Range)",is_main:!1}];h.push({name:"NPO_MAE",title:"Nearest‑Pattern Outcome + MAE‑Stop",is_main:!0});const m=h.slice().sort((Be,Qe)=>Be.name.localeCompare(Qe.name));function g(Be){const Qe=h.find(ct=>ct.name===Be);return Qe?Qe.title:Be}function w(Be,Qe){const ct=new Set;if(!(Be!=null&&Be.getIndicators))return ct;try{Be.getIndicators().forEach(mt=>{(mt==null?void 0:mt.name)===Qe&&(mt!=null&&mt.paneId)&&ct.add(mt.paneId)})}catch(Mt){console.warn(`⚠️ Failed to read ${Qe} pane IDs from chart:`,Mt)}return ct}function C(Be,Qe){if(!Qe.has(Be))return Be;let ct=2;for(;Qe.has(`${Be}_${ct}`)&&ct<1e3;)ct+=1;if(!Qe.has(`${Be}_${ct}`))return`${Be}_${ct}`;let Mt=`${Be}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;Qe.has(Mt);)Mt=`${Be}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return Mt}function M(Be,Qe,ct,Mt){const mt=w(Be,Qe);for(const Ce of mt)if(!ct.has(Ce))return Ce;return Mt}let P=xe(V(new Set));function T(){var ct,Mt,mt,Ce,Te,It;const Be=new Set;if(s())try{const $t=((Mt=(ct=s()).getIndicators)==null?void 0:Mt.call(ct))??[];$t.forEach(Vn=>{Vn&&Vn.name&&Be.add(Vn.name)}),console.log("📊 Indicator list - from chart.getIndicators:",$t.map(Vn=>Vn.name));const Yt=((Ce=(mt=s()).getOverlays)==null?void 0:Ce.call(mt))??[];(Yt==null?void 0:Yt.some(Vn=>(Vn==null?void 0:Vn.name)==="NearestPatternOutcomeMaeStop"))&&Be.add("NPO_MAE")}catch($t){console.warn("⚠️ Indicator list - getIndicators failed, falling back to saveInds",$t)}if(Be.size===0&&o()&&o().saveInds){Object.values(o().saveInds).forEach($t=>{$t&&$t.name&&Be.add($t.name)}),console.log("📊 Indicator list - from saveInds (fallback):",Array.from(Be));try{(((It=(Te=s())==null?void 0:Te.getOverlays)==null?void 0:It.call(Te))??[]).some(Yt=>(Yt==null?void 0:Yt.name)==="NearestPatternOutcomeMaeStop")||Be.delete("NPO_MAE")}catch{}}const Qe=Array.from(Be).map($t=>g($t));console.log("🔄 selectedIndicators updated:",Qe),x(P,V(Be))}wr(()=>{var Be;l(),s(),(Be=o())==null||Be.saveInds,T()}),Mh(()=>{console.log("modalIndSearch mounted"),console.log("Available ActionTypes:",Object.keys(Zg)),console.log("ActionType values:",Object.values(Zg)),console.log("🔍 localStorage content:");for(let Be=0;Be<localStorage.length;(Be+=1)-1){const Qe=localStorage.key(Be);Qe&&console.log(`🔍 ${Qe}:`,localStorage.getItem(Qe))}window.debugChart=()=>{const Be=JSON.parse(localStorage.getItem("chart")||"{}");return console.log("🔍 localStorage chart data:",Be),console.log("🔍 saveInds keys:",Object.keys(Be.saveInds||{})),console.log("🔍 Current $save.saveInds keys:",Object.keys(o().saveInds)),console.log("🔍 Chart available:",s()?"Yes":"No chart"),{localStorage:Be,currentSave:o().saveInds}},setTimeout(()=>{console.log("🚀 Auto-debug on page load:"),window.debugChart()},2e3),console.log("🔍 Debug function added: window.debugChart()")});let N=xe(""),L=xe(!1),O=xe(V(new Set)),D=xe(!1),$=xe(!1),z=xe(!0),te=xe(0),pe,J=xe(!1),le=xe("bn"),de=xe(!1);wr(()=>{i(J)&&l()?(x(de,!0),l(!1)):!i(J)&&!l()&&i(de)&&(x(de,!1),l(!0))}),wr(()=>{!r().modalIndCfg&&i(L)&&(x(L,!1),setTimeout(()=>{l(!0)},100))});let he=At(()=>{let Be=m;if(i(N)){const Qe=i(N).toLowerCase();Be=Be.filter(ct=>ct.name.toLowerCase().includes(Qe)||ct.title.toLowerCase().includes(Qe)).sort((ct,Mt)=>ct.name.localeCompare(Mt.name))}if(l()&&i(O).size>0){const Qe=Be.filter(Mt=>i(O).has(Mt.name)),ct=Be.filter(Mt=>!i(O).has(Mt.name));return[...Qe,...ct]}return Be});wr(()=>{var Be,Qe;if(l()!==i(D)){if(l()){const ct=new Set;if((Qe=(Be=i(P)).forEach)==null||Qe.call(Be,Mt=>ct.add(Mt)),ct.size===0&&i(P)&&i(P).size>0)for(const Mt of i(P).values())ct.add(Mt);x(O,V(ct))}else x(O,V(new Set));x(D,V(l()))}});function ge(){var Qe;const Be=(Qe=a())==null?void 0:Qe.data;return Be?Be.isPremium===!0||Be.isTrial===!0:!1}async function ae(Be,Qe,ct,Mt=800){var Ce;const mt=Date.now();for(;Date.now()-mt<Mt;){try{const Te=((Ce=Be.getIndicators)==null?void 0:Ce.call(Be,{name:Qe,paneId:ct}))??[];if(Te.length>0&&Te.some($t=>($t==null?void 0:$t.result)&&Object.keys($t.result).length>0))return}catch{}await new Promise(Te=>setTimeout(Te,16))}}async function Ie(Be,Qe){var ct,Mt,mt,Ce,Te,It,$t,Yt,qn,Vn,Dn,Wn,pn,gn,Qs,Is,Cs,ro;if(Qe==="SMARTTREND"&&!ge()){console.log("🔒 Premium access required for Smart Trend indicator"),x($,!0);return}if(Qe==="BBI")We(Qe,[3,6,12,24],!0,{id:"pane_BBI"});else if(Qe==="EMA")We(Qe,[20],!0,{id:"candle_pane"});else if(Qe==="MA"){const bs="candle_pane",zt=s();if(zt){const Qt=zt.createIndicator({name:"MA",calcParams:[20],styles:{lines:[{color:"#2563eb",size:1,style:vt.Solid}]},createTooltipDataSource:({indicator:ho})=>{const ri=[ho.visible?1:0,2,3],jo=zt.getStyles().indicator.tooltip;return{icons:ri.map(ar=>jo.features[ar])}}},!0,{id:bs});if(await ae(zt,"MA",bs),Qt){const ho={name:"MA",pane_id:bs,params:[20],styles:[{color:"#2563eb",thickness:1,lineStyle:"solid"}]},ri=`${bs}_MA`;f.update(jo=>(jo.saveInds[ri]=ho,jo))}}}else if(Qe==="SMARTTREND"){const bs="candle_pane",zt=s();if(zt){const Qt=zt.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:vt.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},createTooltipDataSource:({indicator:ho})=>{const ri=[ho.visible?1:0,2,3],jo=zt.getStyles().indicator.tooltip;return{icons:ri.map(ar=>jo.features[ar])}}},!0,{id:bs});if(await ae(zt,"SMARTTREND",bs),Qt){const ho={name:"SMARTTREND",pane_id:bs,params:[10,3],superTrendGroups:[{id:"st_default",period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]},ri=`${bs}_SMARTTREND`;f.update(jo=>(jo.saveInds[ri]=ho,jo))}}}else if(Qe==="SMA"){const bs="candle_pane",zt=s();if(zt){const Qt=zt.createIndicator({name:"SMA",calcParams:[20],styles:{lines:[{color:"#FF6C37",size:2,style:vt.Solid}]},createTooltipDataSource:({indicator:ho})=>{const ri=[ho.visible?1:0,2,3],jo=zt.getStyles().indicator.tooltip;return{icons:ri.map(ar=>jo.features[ar])}}},!0,{id:bs});if(await ae(zt,"SMA",bs),Qt){const ho={name:"SMA",pane_id:bs,params:[20],styles:[{color:"#FF6C37",thickness:2,lineStyle:"solid"}]},ri=`${bs}_SMA`;f.update(jo=>(jo.saveInds[ri]=ho,jo))}}}else if(Qe==="RSI"){const bs=s();if(!bs)return;let zt=[];try{const hi=localStorage.getItem("rsiGroups");hi&&(zt=JSON.parse(hi))}catch(hi){console.warn("Failed to load saved RSI groups:",hi)}zt.length===0&&(zt=[{id:"rsi_default",period:14,overbought:70,middle:50,oversold:30,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",middleLineColor:"#6B7280"}}]);const Qt=zt[0],ho=Qt.overboughtLevel??Qt.overbought??70,ri=Qt.middleLevel??Qt.middle??50,jo=Qt.oversoldLevel??Qt.oversold??30,Na=w(bs,"RSI"),ar=new Set(Na);Object.values(o().saveInds).forEach(hi=>{(hi==null?void 0:hi.name)==="RSI"&&(hi!=null&&hi.pane_id)&&ar.add(hi.pane_id)});const Aa=C("pane_RSI",ar),nr=bs.createIndicator({name:"RSI",calcParams:[Qt.period],styles:{lines:[{color:((Mt=(ct=Qt.styles)==null?void 0:ct.rsi)==null?void 0:Mt.color)||"#8B5CF6",size:((Ce=(mt=Qt.styles)==null?void 0:mt.rsi)==null?void 0:Ce.thickness)??2,style:((It=(Te=Qt.styles)==null?void 0:Te.rsi)==null?void 0:It.lineStyle)==="dashed"||((Yt=($t=Qt.styles)==null?void 0:$t.rsi)==null?void 0:Yt.lineStyle)==="dotted"?vt.Dashed:vt.Solid}]}},!1,{id:Aa,axis:{gap:{bottom:2}}});if(await ae(bs,"RSI",Aa),nr){const hi=M(bs,"RSI",Na,Aa),Gc={id:Qt.id||`rsi_${Date.now()}`,period:Qt.period,overboughtLevel:ho,middleLevel:ri,oversoldLevel:jo,paneId:hi,actualPaneId:hi,styles:{rsi:{color:((Vn=(qn=Qt.styles)==null?void 0:qn.rsi)==null?void 0:Vn.color)||"#8B5CF6",thickness:((Wn=(Dn=Qt.styles)==null?void 0:Dn.rsi)==null?void 0:Wn.thickness)??2,lineStyle:((gn=(pn=Qt.styles)==null?void 0:pn.rsi)==null?void 0:gn.lineStyle)||"solid"},overboughtColor:((Qs=Qt.styles)==null?void 0:Qs.overboughtColor)||"#EF4444",oversoldColor:((Is=Qt.styles)==null?void 0:Is.oversoldColor)||"#10B981",middleLineColor:((Cs=Qt.styles)==null?void 0:Cs.middleLineColor)||"#6B7280"}},Pu={name:"RSI",pane_id:hi,params:[Qt.period],rsiGroups:[Gc]},wc=`${hi}_RSI`;f.update(cc=>(cc.saveInds[wc]=Pu,cc))}}else if(Qe==="STOCH"){const bs="pane_STOCH";let zt=[];try{const ri=localStorage.getItem("stochasticGroups");ri&&(zt=JSON.parse(ri))}catch(ri){console.warn("Failed to load saved Stochastic groups:",ri)}zt.length===0&&(zt=[{id:"stochastic_default",kPeriod:14,dPeriod:3,overbought:80,mid:50,oversold:20,styles:{k:{color:"#3B82F6",thickness:2,lineStyle:"solid"},d:{color:"#EF4444",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midColor:"#6B7280"}}]);const Qt=zt[0],ho=s();if(ho&&ho.createIndicator({name:"STOCH",calcParams:[Qt.kPeriod,Qt.dPeriod],styles:{lines:[{color:Qt.styles.k.color,size:Qt.styles.k.thickness,style:Qt.styles.k.lineStyle==="dashed"||Qt.styles.k.lineStyle==="dotted"?vt.Dashed:vt.Solid},{color:Qt.styles.d.color,size:Qt.styles.d.thickness,style:Qt.styles.d.lineStyle==="dashed"||Qt.styles.d.lineStyle==="dotted"?vt.Dashed:vt.Solid}]}},!0,{id:bs})){const jo={name:"STOCH",pane_id:bs,params:[Qt.kPeriod,Qt.dPeriod]},Na=`${bs}_STOCH`;f.update(ar=>(ar.saveInds[Na]=jo,ar))}}else if(Qe==="NPO_MAE"){const bs=s();if(!bs)return;if(!(((ro=bs.getOverlays)==null?void 0:ro.call(bs))??[]).some(Qt=>(Qt==null?void 0:Qt.name)==="NearestPatternOutcomeMaeStop")){const Qt=nH(bs);window.__npoMaeApi=Qt,f.update(ho=>{const ri="candle_pane_NPO_MAE";return ho.saveInds[ri]={name:"NPO_MAE",pane_id:"candle_pane"},ho})}}else{const bs=Be?"candle_pane":"pane_"+Qe;We(Qe,void 0,!0,{id:bs})}}function ce(Be){var ct,Mt;let Qe=Object.entries(o().saveInds).find(([mt,Ce])=>Ce.name===Be);if(!Qe&&s())try{const Ce=(((Mt=(ct=s()).getIndicators)==null?void 0:Mt.call(ct))??[]).find(Te=>Te&&Te.name===Be);if(Ce){Fc(c,Ao(r).editIndName=Be,Ao(r)),Fc(c,Ao(r).editPaneId=Ce.paneId||r().editPaneId||"candle_pane",Ao(r)),Fc(c,Ao(r).modalIndCfg=!0,Ao(r)),x(L,!0),l(!1);return}}catch(mt){console.warn("⚠️ Failed to locate indicator on chart for edit:",mt)}if(Qe){const[,mt]=Qe;Fc(c,Ao(r).editIndName=Be,Ao(r)),Fc(c,Ao(r).editPaneId=mt.pane_id,Ao(r)),Fc(c,Ao(r).modalIndCfg=!0,Ao(r)),x(L,!0),l(!1)}}function je(Be){var Mt;const Qe=new Set,ct=[];if(Object.entries(o().saveInds).forEach(([mt,Ce])=>{(Ce==null?void 0:Ce.name)===Be&&(Ce!=null&&Ce.pane_id?Qe.add(Ce.pane_id):ct.push(mt))}),w(s(),Be).forEach(mt=>{Qe.add(mt)}),(Mt=s())!=null&&Mt.getIndicators)try{s().getIndicators().forEach(Ce=>{if(!(!Ce||Ce.name!==Be)){if(Ce.paneId)Qe.add(Ce.paneId);else if(Ce.id)try{s().removeIndicator({id:Ce.id})}catch{}}})}catch{}Qe.forEach(mt=>{He(mt,Be)}),ct.length>0&&(f.update(mt=>(ct.forEach(Ce=>{delete mt.saveInds[Ce]}),mt)),vv())}function Ve(Be){var Qe,ct,Mt;if(Be==="NPO_MAE"){const mt=s();if(mt)try{(((Qe=mt.getOverlays)==null?void 0:Qe.call(mt))??[]).forEach(Te=>{if((Te==null?void 0:Te.name)==="NearestPatternOutcomeMaeStop")try{mt.removeOverlay({id:Te.id})}catch{}})}catch{}try{(Mt=(ct=window.__npoMaeApi)==null?void 0:ct.dispose)==null||Mt.call(ct),window.__npoMaeApi=null}catch{}f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{var It;((It=Ce.saveInds[Te])==null?void 0:It.name)==="NPO_MAE"&&delete Ce.saveInds[Te]}),Ce));return}if(Be==="MACD")Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="MACD").forEach(([Ce,Te])=>{He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="MACD"&&delete Ce.saveInds[Te]}),Ce));else if(Be==="RSI")Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="RSI").forEach(([Ce,Te])=>{He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="RSI"&&delete Ce.saveInds[Te]}),Ce));else if(Be==="STOCH")Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="STOCH").forEach(([Ce,Te])=>{He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="STOCH"&&delete Ce.saveInds[Te]}),Ce));else if(Be==="BBI")Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="BBI").forEach(([Ce,Te])=>{He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="BBI"&&delete Ce.saveInds[Te]}),Ce));else if(Be==="AO"){if(console.log("🗑️ Starting bulk AO deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="AO");console.log("📊 Found AO indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing AO indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"AO"})}),console.log("✅ All AO indicators removed from chart")}catch(Ce){console.error("❌ Error removing AO indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="AO");console.log("🗑️ Deleting AO saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="AO"&&(console.log("🗑️ Clearing AO saved data:",Te),delete Ce.saveInds[Te])}),Ce)),console.log("✅ Bulk AO deletion completed")}else if(Be==="DMI"){if(console.log("🗑️ Starting bulk DMI deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="DMI");console.log("📊 Found DMI indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing DMI indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"DMI"})}),console.log("✅ All DMI indicators removed from chart")}catch(Ce){console.error("❌ Error removing DMI indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="DMI");console.log("🗑️ Deleting DMI saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="DMI"&&(console.log("🗑️ Clearing DMI saved data:",Te),delete Ce.saveInds[Te])}),Ce)),console.log("✅ Bulk DMI deletion completed")}else if(Be==="SAR"){if(console.log("🗑️ Starting bulk SAR deletion..."),s())try{const Ce=s().getIndicators().filter(Te=>Te.name==="SAR");console.log("📊 Found SAR indicators on chart:",Ce.length),Ce.forEach(Te=>{console.log("🗑️ Removing SAR from pane:",Te.paneId),s().removeIndicator({paneId:Te.paneId,name:"SAR"})})}catch(mt){console.error("❌ Error removing SAR indicators from chart:",mt);try{s().removeIndicator({paneId:"candle_pane",name:"SAR"})}catch{}try{s().removeIndicator({paneId:r().editPaneId,name:"SAR"})}catch{}}f.update(mt=>(Object.keys(mt.saveInds).forEach(Ce=>{mt.saveInds[Ce].name==="SAR"&&delete mt.saveInds[Ce]}),mt)),c.update(mt=>(mt.editIndName==="SAR"&&(mt.editIndName="",mt.editPaneId="",mt.modalIndCfg=!1),mt)),console.log("✅ Bulk SAR deletion completed")}else if(Be==="SMARTTREND"){if(console.log("🗑️ Starting bulk Smart Trend deletion..."),s())try{const Ce=s().getIndicators().filter(Te=>Te.name==="SMARTTREND");console.log("📊 Found Smart Trend indicators on chart:",Ce.length),Ce.forEach(Te=>{console.log("🗑️ Removing Smart Trend from pane:",Te.paneId),s().removeIndicator({paneId:Te.paneId,name:"SMARTTREND"})})}catch(mt){console.error("❌ Error removing Smart Trend indicators from chart:",mt);try{s().removeIndicator({paneId:"candle_pane",name:"SMARTTREND"})}catch{}try{s().removeIndicator({paneId:r().editPaneId,name:"SMARTTREND"})}catch{}}f.update(mt=>(Object.keys(mt.saveInds).forEach(Ce=>{mt.saveInds[Ce].name==="SMARTTREND"&&delete mt.saveInds[Ce]}),mt)),console.log("✅ Bulk Smart Trend deletion completed")}else if(Be==="CR"){if(console.log("🗑️ Starting bulk CR deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="CR");console.log("📊 Found CR indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing CR indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"CR"})}),console.log("✅ All CR indicators removed from chart")}catch(Ce){console.error("❌ Error removing CR indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="CR");console.log("🗑️ Deleting CR saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="CR"&&(console.log("🗑️ Clearing CR saved data:",Te),delete Ce.saveInds[Te])}),Ce)),console.log("✅ Bulk CR deletion completed")}else if(Be==="WR"){if(console.log("🗑️ Starting bulk WR deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="WR");console.log("📊 Found WR indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing WR indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"WR"})}),console.log("✅ All WR indicators removed from chart")}catch(Ce){console.error("❌ Error removing WR indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="WR");console.log("🗑️ Deleting WR saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="WR"&&(console.log("🗑️ Clearing WR saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearWrGroups+=1,Ce)),console.log("✅ Bulk WR deletion completed")}else if(Be==="KDJ"){const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="KDJ");console.log("🗑️ Deleting KDJ entries:",mt),mt.forEach(([Ce,Te])=>{console.log("🗑️ Deleting KDJ from pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="KDJ"&&(console.log("🗑️ Clearing KDJ saved data:",Te),delete Ce.saveInds[Te])}),Ce))}else if(Be==="OBV"){const mt=Object.entries(o().saveInds).filter(([Te,It])=>It.name==="OBV");console.log("🗑️ Deleting OBV entries from saveInds:",mt),mt.forEach(([Te,It])=>{console.log("🗑️ Deleting OBV from pane (saveInds):",It.pane_id),It.pane_id&&He(It.pane_id,Be)});const Ce=[r().editPaneId,"pane_OBV_1","pane_OBV_2","pane_OBV_3","pane_OBV_4","pane_OBV_5","main","sub1","sub2","sub3","sub4"];console.log("🗑️ Attempting to remove OBV from common pane locations..."),Ce.forEach(Te=>{var It;if(Te)try{console.log("🗑️ Trying to remove OBV from pane:",Te),(It=s())==null||It.removeIndicator({paneId:Te,name:"OBV"})}catch{}}),f.update(Te=>(Object.keys(Te.saveInds).forEach(It=>{Te.saveInds[It].name==="OBV"&&(console.log("🗑️ Clearing OBV saved data:",It),delete Te.saveInds[It])}),Te)),c.update(Te=>(Te.clearObvGroups+=1,Te))}else if(Be==="CCI"){if(console.log("🗑️ Starting bulk CCI deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="CCI");console.log("📊 Found CCI indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing CCI indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"CCI"})}),console.log("✅ All CCI indicators removed from chart")}catch(Ce){console.error("❌ Error removing CCI indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="CCI");console.log("🗑️ Deleting CCI saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="CCI"&&(console.log("🗑️ Clearing CCI saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearCciGroups+=1,Ce)),console.log("✅ Bulk CCI deletion completed")}else if(Be==="EMV"){const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="EMV");console.log("🗑️ Deleting EMV entries:",mt),mt.forEach(([Ce,Te])=>{console.log("🗑️ Deleting EMV from pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="EMV"&&(console.log("🗑️ Clearing EMV saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearEmvGroups+=1,Ce))}else if(Be==="MTM"){const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="MTM");console.log("🗑️ Deleting MTM entries:",mt),mt.forEach(([Ce,Te])=>{console.log("🗑️ Deleting MTM from pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="MTM"&&(console.log("🗑️ Clearing MTM saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearMtmGroups+=1,Ce))}else if(Be==="PSY"){const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="PSY");console.log("🗑️ Deleting PSY entries:",mt),mt.forEach(([Ce,Te])=>{console.log("🗑️ Deleting PSY from pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="PSY"&&(console.log("🗑️ Clearing PSY saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearPsyGroups+=1,Ce))}else if(Be==="PVT"){if(console.log("🗑️ Starting bulk PVT deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="PVT");console.log("📊 Found PVT indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing PVT indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"PVT"})}),console.log("✅ All PVT indicators removed from chart")}catch(Ce){console.error("❌ Error removing PVT indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="PVT");console.log("🗑️ Deleting PVT saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="PVT"&&(console.log("🗑️ Clearing PVT saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearPvtGroups+=1,Ce)),console.log("✅ Bulk PVT deletion completed")}else if(Be==="ROC"){if(console.log("🗑️ Starting bulk ROC deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="ROC");console.log("📊 Found ROC indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing ROC indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"ROC"})}),console.log("✅ All ROC indicators removed from chart")}catch(Ce){console.error("❌ Error removing ROC indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="ROC");console.log("🗑️ Deleting ROC saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="ROC"&&(console.log("🗑️ Clearing ROC saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearRocGroups+=1,Ce)),console.log("✅ Bulk ROC deletion completed")}else if(Be==="VR"){if(console.log("🗑️ Starting bulk VR deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="VR");console.log("📊 Found VR indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing VR indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"VR"})}),console.log("✅ All VR indicators removed from chart")}catch(Ce){console.error("❌ Error removing VR indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="VR");console.log("🗑️ Deleting VR saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="VR"&&(console.log("🗑️ Clearing VR saved data:",Te),delete Ce.saveInds[Te])}),Ce)),console.log("✅ Bulk VR deletion completed")}else if(Be==="VOL"){if(console.log("🗑️ Starting bulk VOL deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="VOL");console.log("📊 Found VOL indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing VOL indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"VOL"})}),console.log("✅ All VOL indicators removed from chart")}catch(Ce){console.error("❌ Error removing VOL indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="VOL");console.log("🗑️ Deleting VOL saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="VOL"&&(console.log("🗑️ Clearing VOL saved data:",Te),delete Ce.saveInds[Te])}),Ce)),c.update(Ce=>(Ce.clearVolGroups+=1,Ce)),console.log("✅ Bulk VOL deletion completed")}else if(Be==="BIAS"){if(console.log("🗑️ Starting bulk BIAS deletion..."),s())try{const Te=s().getIndicators().filter(It=>It.name==="BIAS");console.log("📊 Found BIAS indicators on chart:",Te.length),Te.forEach(It=>{console.log("🗑️ Removing BIAS indicator from pane:",It.paneId),s().removeIndicator({paneId:It.paneId,name:"BIAS"})}),console.log("✅ All BIAS indicators removed from chart")}catch(Ce){console.error("❌ Error removing BIAS indicators from chart:",Ce)}const mt=Object.entries(o().saveInds).filter(([Ce,Te])=>Te.name==="BIAS");console.log("🗑️ Deleting BIAS saved entries:",mt.length),mt.forEach(([Ce,Te])=>{console.log("🗑️ Cleaning saved entry:",Ce,"pane:",Te.pane_id),Te.pane_id&&He(Te.pane_id,Be)}),f.update(Ce=>(Object.keys(Ce.saveInds).forEach(Te=>{Ce.saveInds[Te].name==="BIAS"&&(console.log("🗑️ Clearing BIAS saved data:",Te),delete Ce.saveInds[Te])}),Ce)),console.log("✅ Bulk BIAS deletion completed")}else je(Be)}async function We(Be,Qe,ct,Mt){const mt=s();if(!mt)return null;let Ce=Qe,Te={};if(Be==="VOL"){if((!(Mt!=null&&Mt.id)||Mt.id!=="candle_pane")&&(Mt={axis:{gap:{bottom:2}},...Mt}),!Qe||Qe.length===0){Ce=[20];const Dn=(Wn=>{switch(Wn){case"dashed":return{style:vt.Dashed,dashedValue:[4,4]};case"dotted":return{style:vt.Dashed,dashedValue:[2,2]};default:return{style:vt.Solid,dashedValue:[2,2]}}})("dotted");Te={bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:Dn.style,dashedValue:Dn.dashedValue,smooth:!1}]}}}else Be==="EMV"&&((!(Mt!=null&&Mt.id)||Mt.id!=="candle_pane")&&(Mt={axis:{gap:{bottom:2}},...Mt}),(!Qe||Qe.length===0)&&(Ce=(x2[Be]||[]).filter(Dn=>Dn.type!=="color").map(Dn=>Dn.default)));if(!Ce||Ce.length===0){const Vn=x2[Be]||[];Vn.length>0&&Be!=="VOL"&&(Ce=Vn.filter(Wn=>Wn.type!=="color").map(Wn=>Wn.default),Vn.filter(Wn=>Wn.styleKey&&Wn.type==="color").forEach(Wn=>{const pn=Wn.styleKey,gn=Wn.default,Qs=pn.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(Qs){const[,Is,Cs,ro]=Qs;Te[Is]||(Te[Is]=[]),Te[Is][parseInt(Cs)]||(Te[Is][parseInt(Cs)]={}),Te[Is][parseInt(Cs)][ro]=gn}}))}const It=(Mt==null?void 0:Mt.id)??"",$t=`${It}_${Be}`,Yt=mt.createIndicator({name:Be,calcParams:Ce,styles:Object.keys(Te).length>0?Te:void 0,createTooltipDataSource:({indicator:Vn})=>{const Dn=[Vn.visible?1:0,2,3],Wn=mt.getStyles().indicator.tooltip;return{icons:Dn.map(gn=>Wn.features[gn])}}},ct,Mt);if(await ae(mt,Be,Mt==null?void 0:Mt.id),!Yt)return null;const qn={name:Be,pane_id:It,params:Ce};return f.update(Vn=>(Vn.saveInds[$t]=qn,Vn)),vv(),Np.recordAddIndicator(Be,It,Ce||[],$t),qn}async function He(Be,Qe){var Te;if(console.log("🗑️ delInd called:",{paneId:Be,name:Qe,chart:!!s()}),!s()){console.log("❌ No chart available");return}const ct=s(),Mt=`${Be}_${Qe}`,mt=o().saveInds[Mt];mt&&Np.recordRemoveIndicator(Qe,Be,mt.params||[],Mt),console.log("🔥 Attempting to remove indicator with correct API: removeIndicator(paneId, name)");try{ct.removeIndicator({paneId:Be,name:Qe}),console.log("✅ removeIndicator successful")}catch(It){console.log("❌ removeIndicator failed:",It);try{console.log("🔄 Trying fallback: remove indicator by name directly"),console.log("Attempting to remove indicator:",Qe,"from pane:",Be),console.log("Direct removal attempt for:",Qe),[].forEach(Yt=>{console.log("Removing indicator instance:",Yt);try{ct.removeIndicator({paneId:Be,name:Yt.name})}catch(qn){console.log("Failed to remove indicator instance:",qn)}}),console.log("✅ Fallback method successful")}catch($t){console.log("❌ Fallback method also failed:",$t)}}try{const $t=(((Te=ct.getIndicators)==null?void 0:Te.call(ct))??[]).filter(Yt=>(Yt==null?void 0:Yt.name)===Qe&&(!Be||(Yt==null?void 0:Yt.paneId)===Be));$t.length>0&&$t.forEach(Yt=>{try{Yt!=null&&Yt.id?ct.removeIndicator({id:Yt.id}):Yt!=null&&Yt.paneId&&ct.removeIndicator({paneId:Yt.paneId,name:Qe})}catch{}})}catch{}console.log("🧹 Cleaning saved state for:",Qe);const Ce=JSON.parse(localStorage.getItem("indicators")||"{}");console.log("🧹 Current localStorage indicators:",Ce),Ce[Be]&&(Ce[Be]=Ce[Be].filter(It=>It.name!==Qe),Ce[Be].length===0&&delete Ce[Be],localStorage.setItem("indicators",JSON.stringify(Ce)),console.log("🧹 Updated localStorage indicators:",Ce)),f.update(It=>{if(console.log("🧹 Before cleanup saveInds keys:",Object.keys(It.saveInds)),Qe==="ZIGZAG"){const $t=`${Be}_ZIGZAG`;Object.keys(It.saveInds).forEach(Yt=>{const qn=It.saveInds[Yt];Yt.startsWith($t)&&(qn==null?void 0:qn.name)==="ZIGZAG"&&(console.log("🧹 Removing ZigZag save key:",Yt),delete It.saveInds[Yt])})}else{const $t=`${Be}_${Qe}`;console.log("🧹 Cleaning saved state key:",$t,"existed:",!!It.saveInds[$t]),delete It.saveInds[$t]}return console.log("🧹 After cleanup saveInds keys:",Object.keys(It.saveInds)),It}),vv(),d.removeIndicator({chart:ct,name:Qe,paneId:Be}).catch(It=>{console.warn("Background color preservation failed:",It)}),console.log("✅ delInd completed")}hp(c,Be=>Be.cloudIndLoaded).subscribe(Be=>{console.log("🔄 cloudIndLoaded triggered, saveInds:",Object.keys(o().saveInds)),console.log("🚫 Automatic indicator restoration disabled to prevent deleted indicators from reappearing")});function et(Be){const ct=Be.target.scrollTop;ct<i(te)||ct<=10?x(z,!0):ct>i(te)&&ct>50&&x(z,!1),x(te,V(ct))}const ft=hp(c,Be=>Be.initDone);let it=!1;ft.subscribe(Be=>{if(console.log("initDone changed:",Be,"chart:",!!s(),"subscribed:",it),Be>0&&!it&&s()){console.log("Subscribing to OnTooltipIconClick with chart:",s()),console.log("Chart methods available:",Object.getOwnPropertyNames(s())),console.log("subscribeAction method:",typeof s().subscribeAction),it=!0;try{s().subscribeAction(Zg.OnCandleTooltipFeatureClick,Qe=>{var Mt,mt;console.log("🔥 OnTooltipIconClick fired!",Qe);const ct=Qe;if(ct.indicatorName)switch(console.log("Processing icon click:",ct.iconId,"for indicator:",ct.indicatorName),ct.iconId){case"visible":{console.log("Making indicator visible"),(Mt=s())==null||Mt.overrideIndicator({name:ct.indicatorName,paneId:ct.paneId,visible:!0});break}case"invisible":{console.log("Making indicator invisible"),(mt=s())==null||mt.overrideIndicator({name:ct.indicatorName,paneId:ct.paneId,visible:!1});break}case"setting":{console.log("Opening settings"),Fc(c,Ao(r).editIndName=ct.indicatorName,Ao(r)),Fc(c,Ao(r).editPaneId=ct.paneId,Ao(r)),Fc(c,Ao(r).modalIndCfg=!0,Ao(r)),l()&&l(!1);break}case"close":console.log("Deleting indicator:",ct.indicatorName,"from pane:",ct.paneId),He(ct.paneId,ct.indicatorName)}}),console.log("✅ Successfully subscribed to OnTooltipIconClick")}catch(Qe){console.error("❌ Error subscribing to OnTooltipIconClick:",Qe)}}});const Lt=a_(),[Tt,Pt]=Lt;var St=CH(),st=tn(St),xt=At(()=>Kw());sg(st,{get title(){return i(xt)},width:700,maxWidth:"95vw",maxHeight:"min(92svh, 90vh)",get show(){return l()},set show(Be){l(Be)},get theme(){return o().theme},buttons:[],class:"ind-modal",children:(Be,Qe)=>{var ct=mH(),Mt=y(ct),mt=v(y(Mt),2);mn(mt),Ne(()=>Dt(mt,"placeholder",s4()));var Ce=v(mt,2);Ye(Ce,()=>i(N),qn=>{var Vn=iH();Vn.__click=[oH,N],Y(qn,Vn)}),_(Mt);var Te=v(Mt,2),It=y(Te),$t=y(It);Ro($t,17,()=>i(he),fi,(qn,Vn,Dn)=>{var Wn=fH();const pn=At(()=>i(P).has(i(Vn).name));Wn.__click=[rH,pn,Ie,Vn];var gn=y(Wn),Qs=v(gn,2),Is=y(Qs),Cs=y(Is,!0);_(Is),_(Qs);var ro=v(Qs,2);Ye(ro,()=>i(Vn).name==="NPO_MAE",zt=>{var Qt=lH();Qt.__click=[aH,J],Y(zt,Qt)});var bs=v(ro,2);Ye(bs,()=>i(pn),zt=>{var Qt=dH(),ho=y(Qt);ho.__click=[cH,ce,Vn];var ri=v(ho,2);ri.__click=[uH,Ve,Vn],_(Qt),Y(zt,Qt)}),_(Wn),Ne(()=>{Fi(Wn,`group indicator-row relative flex items-center min-h-[56px] px-5 py-3 cursor-pointer transition-all duration-500 ease-out
                   ${(Dn<i(he).length-1?"border-b":"")??""} 
                   ${(i(pn)?"indicator-item-selected":"indicator-item-unselected")??""} svelte-e5btcs`),Fi(gn,`flex items-center justify-center w-2 h-2 rounded-full mr-4 transition-all duration-500
                        ${(i(pn)?"indicator-dot-selected":"indicator-dot-unselected")??""} svelte-e5btcs`),Fi(Is,`indicator-title text-[15px] font-medium tracking-wide leading-relaxed
                           ${(i(pn)?"indicator-text-selected":"indicator-text-unselected")??""} svelte-e5btcs`),tt(Cs,i(Vn).title)}),Y(qn,Wn)});var Yt=v($t,2);Ye(Yt,()=>i(he).length===0,qn=>{var Vn=pH();Y(qn,Vn)}),_(It),ep(It,qn=>pe=qn,()=>pe),_(Te),Di(2),_(ct),Ne(()=>Fi(Mt,`relative group transition-all duration-300 ease-out ${(i(z)?"opacity-100 translate-y-0":"opacity-0 -translate-y-4 pointer-events-none")??""} svelte-e5btcs`)),As(mt,()=>i(N),qn=>x(N,qn)),ld("scroll",It,et),Y(Be,ct)},$$slots:{default:!0}});var Je=v(st,2);Ye(Je,()=>i(J),Be=>{var Qe=xH(),ct=y(Qe);ct.__click=[hH,J];var Mt=v(ct,2),mt=y(Mt),Ce=y(mt),Te=y(Ce),It=v(y(Te),2),$t=y(It),Yt=y($t,!0);_($t);var qn=v($t,2),Vn=y(qn,!0);_(qn),_(It),_(Te);var Dn=v(Te,2),Wn=y(Dn);Wn.__click=[vH,le];var pn=v(Wn,2);pn.__click=[gH,le],_(Dn);var gn=v(Dn,2);gn.__click=[_H,J],_(Ce);var Qs=v(Ce,2),Is=y(Qs);Ye(Is,()=>i(le)==="bn",Cs=>{var ro=yH();Di(22),Y(Cs,ro)},Cs=>{var ro=bH();Di(22),Y(Cs,ro)}),_(Qs),_(mt),_(Mt),_(Qe),Ne(()=>{tt(Yt,i(le)==="bn"?"নিকটতম‑প্যাটার্ন আউটকাম + এমএই‑স্টপ":"Nearest‑Pattern Outcome + MAE‑Stop"),tt(Vn,i(le)==="bn"?"কিভাবে কাজ করে এবং কিভাবে ব্যবহার করবেন":"How it works and how to use"),Fi(Wn,`btn btn-xs ${(i(le)==="bn"?"btn-primary":"btn-outline")??""} svelte-e5btcs`),Fi(pn,`btn btn-xs ${(i(le)==="en"?"btn-primary":"btn-outline")??""} svelte-e5btcs`)}),Y(Be,Qe)});var Xe=v(Je,2);return Ye(Xe,()=>i($),Be=>{var Qe=SH(),ct=tn(Qe);ct.__click=[wH,$];var Mt=v(ct,2),mt=v(y(Mt),2),Ce=y(mt);Ce.__click=[kH,$];var Te=v(Ce,10);Ne(()=>Dt(Te,"href",Tt("https://dutyai.app/settings/investor?device=1",void 0))),_(mt),_(Mt),xg(3,ct,()=>__,()=>({duration:200})),xg(3,Mt,()=>vy,()=>({y:20,duration:300,easing:ww})),Y(Be,Qe)}),Y(n,St),Ed({createIndicator:We,delInd:He})}Tp(["click"]);function lc(n,e){Ld(e,!0);let t=pi(e,"show",15),s=pi(e,"selectedColor",7,"#000000");pi(e,"position",19,()=>({x:0,y:0}));let o=pi(e,"opacity",7,100);const r=Hh();function a(d){const h=(d||"").trim();if(!h)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(h)){const g=h.startsWith("#")?h.slice(1):h;return{r:parseInt(g.slice(0,2),16),g:parseInt(g.slice(2,4),16),b:parseInt(g.slice(4,6),16)}}const m=h.match(/^rgba?\(([^)]+)\)$/i);if(m){const g=m[1].split(",").map(w=>parseFloat(w.trim()));if(g.length>=3&&g.every(w=>!isNaN(w)))return{r:Math.round(g[0]),g:Math.round(g[1]),b:Math.round(g[2])}}return null}function l(d,h){const m=a(d);if(!m)return null;const g=Math.max(0,Math.min(100,h))/100;return`rgba(${m.r}, ${m.g}, ${m.b}, ${g})`}function c(d){const h=d.detail;s(h);const m=l(h,o());r("colorChange",{color:h,opacity:o(),rgba:m})}function f(d){const h=d.detail;o(Number.isFinite(h)?h:o());const m=l(s(),o());r("opacityChange",{opacity:o(),rgba:m,color:s()}),r("colorChange",{color:s(),opacity:o(),rgba:m})}function u(){t(!1),r("close")}Yv(n,{get show(){return t()},set show(d){t(d)},get selectedColor(){return s()},get opacity(){return o()},$$events:{colorChange:c,opacityChange:f,close:u}}),Ed()}const zh={LAYOUTS:"chart.saves.v1",ACTIVE_SAVE_ID:"chart.activeSaveId",LEGACY_LAYOUTS:"chart.saves.v0"};function Lr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function Mx(n){return n.toUpperCase().trim()}function PH(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch{return"UTC"}}function Nx(n){return n&&typeof n.id=="string"&&typeof n.name=="string"&&typeof n.createdAt=="string"&&typeof n.updatedAt=="string"&&typeof n.timezone=="string"&&typeof n.interval=="string"&&typeof n.chartType=="string"&&typeof n.theme=="string"&&Array.isArray(n.panes)&&Array.isArray(n.indicators)&&typeof n.drawingsBySymbol=="object"}class $8{constructor(){$e(this,"initialized",!1);this.initialize()}async initialize(){if(!(this.initialized||!p3))try{await this.migrate(),this.initialized=!0}catch(e){console.error("Failed to initialize storage provider:",e)}}async migrate(){try{const e=localStorage.getItem(zh.LEGACY_LAYOUTS);if(!e)return;console.log("🔄 Migrating chart saves from v0 to v1...");const t=JSON.parse(e);if(!Array.isArray(t))return;if(localStorage.getItem(zh.LAYOUTS)){localStorage.removeItem(zh.LEGACY_LAYOUTS);return}const o=t.map(r=>({id:r.id||Lr(),name:r.name||"Migrated Layout",createdAt:r.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),timezone:r.timezone||PH(),interval:r.interval||"1h",chartType:r.chartType||"candles",theme:r.theme||"dark",panes:r.panes||[],indicators:r.indicators||[],styles:r.styles||{},options:r.options||{},drawingsBySymbol:r.drawings?{[Mx(r.symbol||"DEFAULT")]:r.drawings}:{}}));localStorage.setItem(zh.LAYOUTS,JSON.stringify(o)),localStorage.removeItem(zh.LEGACY_LAYOUTS),console.log(`✅ Migrated ${o.length} layouts to v1 format`)}catch(e){console.error("Migration failed:",e)}}async listSavedLayouts(){await this.initialize();try{const e=localStorage.getItem(zh.LAYOUTS);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(Nx).map(s=>({id:s.id,name:s.name,createdAt:s.createdAt,updatedAt:s.updatedAt})).sort((s,o)=>new Date(o.updatedAt).getTime()-new Date(s.updatedAt).getTime()):[]}catch(e){return console.error("Failed to list saved layouts:",e),[]}}async getSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(zh.LAYOUTS);if(!t)return null;const s=JSON.parse(t);if(!Array.isArray(s))return null;const o=s.find(r=>r.id===e);return o&&Nx(o)?o:null}catch(t){return console.error("Failed to get saved layout:",t),null}}async createSavedLayout(e){await this.initialize();try{const t=new Date().toISOString(),s={...e,id:Lr(),createdAt:t,updatedAt:t,drawingsBySymbol:Object.fromEntries(Object.entries(e.drawingsBySymbol).map(([a,l])=>[Mx(a),l]))},o=localStorage.getItem(zh.LAYOUTS),r=o?JSON.parse(o):[];return r.push(s),localStorage.setItem(zh.LAYOUTS,JSON.stringify(r)),s}catch(t){throw console.error("Failed to create saved layout:",t),new Error("Failed to save layout")}}async updateSavedLayout(e,t){await this.initialize();try{const s=localStorage.getItem(zh.LAYOUTS);if(!s)throw new Error("Layout not found");const o=JSON.parse(s),r=o.findIndex(l=>l.id===e);if(r===-1)throw new Error("Layout not found");const a={...o[r],...t,id:e,updatedAt:new Date().toISOString(),drawingsBySymbol:t.drawingsBySymbol?Object.fromEntries(Object.entries(t.drawingsBySymbol).map(([l,c])=>[Mx(l),c])):o[r].drawingsBySymbol};return o[r]=a,localStorage.setItem(zh.LAYOUTS,JSON.stringify(o)),a}catch(s){throw console.error("Failed to update saved layout:",s),new Error("Failed to update layout")}}async deleteSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(zh.LAYOUTS);if(!t)return;const o=JSON.parse(t).filter(a=>a.id!==e);localStorage.setItem(zh.LAYOUTS,JSON.stringify(o)),await this.getActiveSaveId()===e&&await this.setActiveSaveId(null)}catch(t){throw console.error("Failed to delete saved layout:",t),new Error("Failed to delete layout")}}async setActiveSaveId(e){try{e===null?localStorage.removeItem(zh.ACTIVE_SAVE_ID):localStorage.setItem(zh.ACTIVE_SAVE_ID,e)}catch(t){console.error("Failed to set active save ID:",t)}}async getActiveSaveId(){try{return localStorage.getItem(zh.ACTIVE_SAVE_ID)}catch(e){return console.error("Failed to get active save ID:",e),null}}async layoutNameExists(e,t){return(await this.listSavedLayouts()).some(o=>o.name===e&&o.id!==t)}async cleanup(){try{const e=localStorage.getItem(zh.LAYOUTS);if(!e)return;const t=JSON.parse(e),s=t.filter(Nx);s.length!==t.length&&(localStorage.setItem(zh.LAYOUTS,JSON.stringify(s)),console.log(`🧹 Cleaned up ${t.length-s.length} invalid layouts`))}catch(e){console.error("Failed to cleanup storage:",e)}}}const MH=new $8;function gg(n,e,t,s,o,r,a){if(!i(e)||!t()||!o().editPaneId)return;const l=[a.zoneLookbackBars,a.minZoneBars,a.maxZoneBars,a.atrPeriod,a.volumeMAPeriod,a.minVolumeFactor,a.maxZoneWidthPct,a.priorTrendLookback,a.minOBVTrendStrength,a.minZoneScore,a.mergeNearbyZones?1:0,a.maxZonesDisplayed,a.showLabels?1:0];try{t().overrideIndicator({name:"SMART_MONEY",calcParams:l,paneId:o().editPaneId})}catch(c){console.error("SMART_MONEY realtime update failed:",c)}}function NH(n,e,t){const s={id:Lr(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}};x(e,V([...i(e),s])),t()}function f5(n,e,t,s){const o=e();o&&o.setStyles({median:{size:i(t),style:i(s)}})}function p5(n,e,t,s){const o=e();o&&o.setStyles({slLong:{size:i(t),style:i(s)}})}function m5(n,e,t,s){const o=e();o&&o.setStyles({slShort:{size:i(t),style:i(s)}})}function AH(n,e,t){const s=e();s&&s.setShowOutcomeBand(!!i(t))}function TH(n,e,t){const s=e();s&&s.setShowStopLines(!!i(t))}function FH(n,e,t){const s=e();s&&s.updateSettings({showTable:!!i(t)})}function LH(n,e,t){if(i(e))try{if(i(t).length>=10){console.warn("⚠️ Maximum number of EMV groups (10) reached");return}const o=i(t).length+1,r={id:Lr(),name:`EMV #${o}`,period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"};i(t).push(r),console.log("✅ Added new EMV group:",r.name)}catch(s){console.error("❌ Error adding EMV group:",s)}}function EH(n,e,t,s){if(i(e))try{if(i(t).length>=10){console.warn("⚠️ Maximum number of MTM groups (10) reached");return}const r=i(t).length+1,a=["#2563eb","#8B5CF6","#F59E0B","#10B981","#EF4444","#EC4899","#06B6D4","#F97316"],l=i(t).length%a.length,c={id:Lr(),name:`MTM #${r}`,period:14,color:a[l],thickness:2,lineStyle:"solid"};i(t).push(c),console.log("✅ Added new MTM group:",c.name),s()}catch(o){console.error("❌ Error adding MTM group:",o)}}function $H(n,e,t,s){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Lr(),name:`BIAS${o}`,period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}),s()}function DH(n,e,t,s){if(!i(e))return;const o=i(t).length+1,r=o===1?"CCI":`CCI${o}`;i(t).push({id:Lr(),name:r,period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}),console.log("➕ Added new CCI group:",r),s()}function RH(n,e,t,s){if(!i(e))return;const o=i(t)[i(t).length-1]||i(t)[0],r={id:Lr(),start:(o==null?void 0:o.start)??.02,increment:(o==null?void 0:o.increment)??.02,maxValue:(o==null?void 0:o.maxValue)??.2,color:"#2563eb",dotSize:1};x(t,V([...i(t),r])),s()}function jH(n,e,t,s){if(!i(e))return;const o=["#00FF00","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],r=i(t).map(u=>u.styles.uptrend.color),a=o.filter(u=>!r.includes(u)),l=a.length>0?a[0]:o[i(t).length%o.length],c=i(t)[i(t).length-1]||i(t)[0],f={id:Lr(),period:((c==null?void 0:c.period)||10)+2,multiplier:(c==null?void 0:c.multiplier)||3,showLabels:!0,styles:{uptrend:{color:l,thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}};x(t,V([...i(t),f])),console.log("✅ Added new Smart Trend group:",f),s()}function BH(n,e,t,s){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Lr(),name:`DMI${o}`,diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new DMI group"),s()}function OH(n,e,t,s){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Lr(),name:`CR${o}`,crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new CR group"),s()}function zH(n,e,t,s){if(!i(e))return;const o=["#26A69A","#EF5350","#8B5CF6","#F59E0B","#10B981","#F97316","#06B6D4","#84CC16"],r=i(t).length%o.length;i(t).push({id:Lr(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:o[r]},decreasing:{color:o[(r+1)%o.length]},reverse:{color:"#c4c4c4"}}}),s()}function VH(n,e,t){x(e,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(t,!0)}function Tb(n,e,t,s,o,r,a,l,c,f,u,d,h,m,g,w,C){if(i(e))return;if(i(t)){s();return}if(i(o)){r();return}if(i(a)){l();return}if(i(c)){f();return}if(u.length>=10)return;const M=u[u.length-1],P={...M,title:`${M.title.replace(/\d+$/,"")}${u.length+1}`};u.push(P),d.push(P.default||0),h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}),i(m)?g():i(w)&&C()}function WH(n,e,t,s,o,r,a,l,c,f,u,d,h,m,g){if(!i(e))return;const w=t().editPaneId||"candle_pane";i(o).push({id:Lr(),paneId:w,period:i(r),stdDev:i(a),styles:{fillColor:i(l),fillOpacity:i(c),upperColor:i(f),middleColor:i(u),lowerColor:i(d),thickness:i(h),lineStyle:i(m)}}),g()}var HH=(n,e,t)=>e(i(t).id),qH=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),UH=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Fast</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Slow</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Signal</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">MACD Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Signal Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Positive Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Negative Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Reverse Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div></div></div>'),GH=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MACD</span></button></div></div>'),YH=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Zone Lookback Bars</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Prior Trend Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Bars</label> <input type="number" min="3" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Bars</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Width %</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.005" max="0.10" step="0.005" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Factor</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.5" max="2.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min OBV Trend</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="0.6" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.3" max="0.9" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Merge Nearby Zones</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Overlap/adjacent similar zones merge</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Show Labels</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Type + score label</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zones Displayed</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div>'),KH=(n,e,t)=>{e[9]=n.currentTarget.checked?1:0,t()},XH=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Resistance Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Support Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Trap Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Spike (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="1.0" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Breakout Factor (%)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="number" step="0.0001" min="0.0000" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">e.g. 0.0005 = 0.05%</span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Wick Ratio</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Trap Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Stable Signal</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Show blue “Stable” dots</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normal Quiet Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div></div>'),ZH=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Compression Inputs</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Behavior</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),JH=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Detection Parameters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Filters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),QH=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),eq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Middle</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">RSI Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change RSI Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Lines</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Middle Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Middle Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between mt-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Fill Opacity</span> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.05" max="0.5" step="0.05" class="range range-xs w-20 svelte-fy2ox8"> <span class="text-xs text-base-content/60 w-8 svelte-fy2ox8"> </span></div></div></div></div>'),tq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add RSI</span></button></div></div>'),nq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),sq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%K Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%D Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="50"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Mid Level</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%K Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %K Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%D Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %D Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Colors</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Mid Line</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Mid Line Color"></button></div></div></div>'),oq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Stochastic</span></button></div></div>'),iq=(n,e,t)=>e(i(t).id),rq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),aq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">DI Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ADX Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI+:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI-:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">ADX:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),lq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add DMI</span></button></div></div>'),cq=(n,e,t)=>e(i(t).id),uq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),dq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-50" max="0"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Middle Level</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-70" max="-30"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-100" max="-50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">WR Line:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 border-b border-base-200 pb-1 svelte-fy2ox8">Level Lines</div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Overbought:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Middle:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Oversold:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),fq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Williams %R</span></button></div></div>'),pq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),mq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 sm:col-span-1 col-span-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Main Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Short Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Long Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),hq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More VR</span></button></div></div>'),vq=(n,e,t)=>e(i(t).id),gq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),_q=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 3</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 4</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),yq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BBI</span></button></div></div>'),bq=(n,e,t)=>e(i(t).id),xq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),wq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),kq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add EMV</span></button></div></div>'),Sq=(n,e,t)=>e(i(t).id),Cq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Iq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Pq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MTM</span></button></div></div>'),Mq=(n,e,t)=>e(i(t).id),Nq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove this AO"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">Histogram Colors</label> <div class="grid grid-cols-1 gap-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Increasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Decreasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Reverse Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div></div>'),Aq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Awesome Oscillator"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More AO</span></button></div></div>'),Tq=(n,e,t)=>e(i(t).id),Fq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Lq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">CR Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA1 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA2 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA3 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA4 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">CR:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA1:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA2:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA3:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA4:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Eq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CR</span></button></div></div>'),$q=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Deviation %</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50" step="0.1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Depth</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">ZigZag Line Style</label> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Thickness</span> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Style</span> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),Dq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ZigZag"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ZigZag</button></div></div>'),Rq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this PVT instance">✕</button>'),jq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Bq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More PVT</button></div></div>'),Oq=(n,e,t)=>e(i(t).id),zq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove SAR Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Vq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Start</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Increment</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max value</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="1.0" step="0.01"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Dot size:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div></div></div>'),Wq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More SAR</button></div></div>'),Hq=(n,e,t)=>e(i(t).id),qq=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Smart Trend Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Uq=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="100" step="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Multiplier</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show Labels</label></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Uptrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Downtrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div></div>'),Gq=Me('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary svelte-fy2ox8" title="Add more Smart Trend"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add Smart Trend</button></div></div>'),Yq=(n,e)=>e(),Kq=Me('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete EMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Xq=Me('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),Zq=(n,e)=>e(),Jq=(n,e)=>e(),Qq=Me('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),eU=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),tU=Me('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more EMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add EMA</button></div>'),nU=Me('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),sU=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),oU=Me('<div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-sm svelte-fy2ox8" min="1" max="500"></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Color</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Thickness</label> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Style</label> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),iU=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div></div>'),rU=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Volume"><span class="text-xs svelte-fy2ox8">×</span></button>'),aU=Me('<div class="w-6 svelte-fy2ox8"></div>'),lU=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs svelte-fy2ox8" min="1" max="200"></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Volume Histogram</h4> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Up Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Down Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">EMA Line</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show EMA with Volume</label></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),cU=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"></div>'),uU=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove TRIX"><span class="text-xs svelte-fy2ox8">×</span></button>'),dU=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">TRIX:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Signal:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">TRIX Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Signal Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),fU=(n,e)=>e(),pU=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add More TRIX"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More TRIX</button></div></div>'),mU=(n,e,t)=>e(i(t).id),hU=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BIAS"><span class="text-xs svelte-fy2ox8">×</span></button>'),vU=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),gU=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BIAS"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BIAS</span></button></div></div>'),_U=(n,e,t)=>e(i(t).id),yU=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CCI"><span class="text-xs svelte-fy2ox8">×</span></button>'),bU=Me('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),xU=Me('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CCI"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CCI</span></button></div></div>'),wU=Me('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),kU=Me('<div class="grid grid-cols-1 sm:grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 items-center px-1 py-2 border-b border-base-200 last:border-b-0 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><div class="w-4 h-4 rounded-full border border-base-300 svelte-fy2ox8"></div> <span class="text-sm font-medium text-base-content svelte-fy2ox8"> </span></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-sm w-24 text-center svelte-fy2ox8" min="1" max="200"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Color</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-5 h-5 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Thickness</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Style</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),SU=Me('<div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm sm:text-base font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="hidden sm:grid grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 text-xs text-base-content/60 px-1 svelte-fy2ox8"><div class="svelte-fy2ox8">Component</div> <div class="svelte-fy2ox8">Period</div> <div class="svelte-fy2ox8">Color</div> <div class="svelte-fy2ox8">Thickness</div> <div class="svelte-fy2ox8">Style</div></div> <!></div>'),CU=Me('<div class="mt-3 sm:mt-5 svelte-fy2ox8"><div class="border border-base-300 rounded-lg p-4 bg-base-50/50 svelte-fy2ox8"><div class="flex items-center gap-3 mb-6 pb-4 border-b border-base-200 svelte-fy2ox8"><div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" class="svelte-fy2ox8"></path></svg></div> <div class="svelte-fy2ox8"><h3 class="text-lg font-semibold text-base-content svelte-fy2ox8">Ichimoku Kinko Hyo</h3> <p class="text-sm text-base-content/60 svelte-fy2ox8">Complete cloud indicator with all components</p></div></div> <div class="space-y-6 svelte-fy2ox8"></div> <div class="flex justify-center pt-4 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Ichimoku</span></button></div> <div class="mt-6 pt-4 border-t border-base-200 svelte-fy2ox8"><div class="text-xs text-base-content/60 space-y-1 svelte-fy2ox8"><p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Components:</strong> Tenkan Sen (Conversion), Kijun Sen (Base), Senkou Span A & B (Cloud)</p> <p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Usage:</strong> Trend direction, support/resistance levels, and momentum analysis</p></div></div></div></div>'),IU=Me('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete SMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),PU=Me('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),MU=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),NU=Me('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div>'),AU=Me('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),TU=(n,e)=>e(),FU=Me('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete MA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),LU=Me('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),EU=(n,e)=>e(),$U=(n,e)=>e(),DU=Me('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),RU=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),jU=Me('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more MA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add MA</button></div>'),BU=Me('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),OU=(n,e,t)=>e(i(t).id),zU=Me('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),VU=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),WU=Me('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ROC</button></div></div>'),HU=(n,e,t)=>e(i(t).id),qU=Me('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),UU=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (PSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">PSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 2 (MAPSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAPSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex items-center gap-2 pt-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm svelte-fy2ox8"> <label class="text-sm text-base-content/80 cursor-pointer svelte-fy2ox8">Show MAPSY</label></div></div></div>'),GU=Me('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More PSY</button></div></div>'),YU=(n,e,t)=>e(i(t).id),KU=Me('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),XU=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8" style="display: none;"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (OBV Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">OBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"> <span class="text-xs text-base-content/50 svelte-fy2ox8">Moving average period for OBV smoothing</span></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div></div>'),ZU=Me('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More OBV</button></div></div>'),JU=(n,e,t)=>e(i(t).id),QU=Me('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),eG=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">K Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">D Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">K Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">K:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">D Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">D:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">J Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">J:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),tG=Me('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More KDJ</button></div></div>'),nG=(n,e)=>e("band"),sG=(n,e)=>e("slLong"),oG=(n,e)=>e("slShort"),iG=(n,e)=>e("median"),rG=Me('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Outcome Band</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Band:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Fill Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Stop Lines</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Stops:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Median Path</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">EV Table</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Table:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div></div></div>'),aG=(n,e)=>e("fill",0),lG=(n,e)=>e("upper",0),cG=(n,e)=>e("middle",0),uG=(n,e)=>e("lower",0),dG=(n,e)=>e(0),fG=Me('<button class="btn btn-xs btn-outline btn-error gap-1 text-xs svelte-fy2ox8" title="Remove BOLL 1"><svg class="w-3 h-3 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg> Remove BOLL 1</button>'),pG=(n,e,t)=>e(i(t)),mG=(n,e,t)=>e("fill",i(t)),hG=(n,e,t)=>e("upper",i(t)),vG=(n,e,t)=>e("middle",i(t)),gG=(n,e,t)=>e("lower",i(t)),_G=Me('<div class="bg-base-50 border border-primary/20 rounded-md p-3 space-y-3 mt-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-semibold text-primary svelte-fy2ox8"> </h4> <button class="btn btn-xs btn-ghost text-error svelte-fy2ox8"><svg class="w-3.5 h-3.5 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Fill Area</h5> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Colors</h5> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Style</h5> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),yG=Me('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Parameters</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Fill Area Settings</h4> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"> <div class="flex justify-between text-xs text-base-content/50 svelte-fy2ox8"><span class="svelte-fy2ox8">0%</span> <span class="svelte-fy2ox8">50%</span> <span class="svelte-fy2ox8">100%</span></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Colors</h4> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Style</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex justify-center gap-2 pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more BOLL"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More BOLL</button> <!></div> <!></div>'),bG=Me('<div class="flex justify-center items-center min-h-[120px] svelte-fy2ox8"><div class="text-base-content/70 svelte-fy2ox8"> </div></div>'),xG=Me('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),wG=Me('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),kG=Me('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-16 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),SG=Me('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg></button></div>'),CG=Me('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),IG=Me('<div class="ai-branding-container svelte-fy2ox8"><div class="ai-branding-badge svelte-fy2ox8"><svg class="ai-branding-icon svelte-fy2ox8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-fy2ox8"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-fy2ox8"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-fy2ox8"></line></svg> <div class="ai-branding-text svelte-fy2ox8"><div class="ai-branding-main svelte-fy2ox8">Duty AI Algorithm Included</div> <div class="ai-branding-sub svelte-fy2ox8">Powered by Duty AI</div></div> <div class="ai-branding-glow svelte-fy2ox8"></div></div></div>'),PG=Me('<div class="responsive-modal-content svelte-fy2ox8"><!> <!></div>'),MG=Me("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function NG(n,e){Ld(e,!0);const t=tm(),s=()=>vl(f,"$chart",t),o=()=>vl(l,"$ctx",t),r=()=>vl(c,"$save",t);let a=pi(e,"show",15);const l=cd("ctx"),c=cd("save"),f=cd("chart");let u=V([]),d=V([]),h=V([]);function m(k){const A=(k||"").trim();if(!A)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(A)){const R=A.startsWith("#")?A.slice(1):A;return{r:parseInt(R.slice(0,2),16),g:parseInt(R.slice(2,4),16),b:parseInt(R.slice(4,6),16)}}const B=A.match(/^rgba?\(([^)]+)\)$/i);if(B){const R=B[1].split(",").map(U=>parseFloat(U.trim()));if(R.length>=3&&R.every(U=>!isNaN(U)))return{r:Math.round(R[0]),g:Math.round(R[1]),b:Math.round(R[2])}}return null}function g(k,A){const B=m(k);if(!B)return k;const R=Math.max(0,Math.min(100,A))/100;return`rgba(${B.r}, ${B.g}, ${B.b}, ${R})`}let w=xe("#2196F3"),C=xe(5),M=xe("#f23645"),P=xe("#2962ff"),T=xe("#089981"),N=xe(1),L=xe("solid"),O=xe(20),D=xe(2),$=xe(!1),z=xe(V({x:0,y:0})),te=xe(0),pe=xe("macdLine"),J=xe(!1),le=xe(V({x:0,y:0})),de=xe(0),he=xe(!1),ge=xe(V({x:0,y:0})),ae=xe(0),Ie=xe("diPlus"),ce=xe(!1),je=xe(V({x:0,y:0})),Ve=xe(!1),We=xe(V({x:0,y:0})),He=xe(!1),Ue=xe(V({x:0,y:0})),et=xe(0),ft=xe(!1),it=xe(V({x:0,y:0})),Lt=xe(0),Tt=xe(!1),Pt=xe(V({x:0,y:0})),St=xe(V([])),st=xe(!1),xt=xe(V({x:0,y:0})),Je=xe(0),Xe=xe("histogram"),Be=xe(!1),Qe=xe(V({x:0,y:0})),ct=xe(!1),Mt=xe(V({x:0,y:0})),mt=xe(!1),Ce=xe(V({x:0,y:0})),Te=xe(!1),It=xe(V({x:0,y:0})),$t=xe(0),Yt=xe(!1),qn=xe(V({x:0,y:0})),Vn=xe(0),Dn=xe("vr"),Wn=xe(!1),pn=xe(V({x:0,y:0})),gn=xe(0),Qs=xe(!1),Is=xe(V({x:0,y:0})),Cs=xe(0),ro=xe(!1),bs=xe(V({x:0,y:0})),zt=xe(0),Qt=xe(!1),ho=xe(V({x:0,y:0})),ri=xe(!1),jo=xe(V({x:0,y:0})),Na=xe(0),ar=xe(!1),Aa=xe(V({x:0,y:0})),nr=xe(0),hi=xe(!1),Gc=V({x:0,y:0}),Pu=xe(0),wc=xe("uptrend"),cc=xe(!1),ou=xe(V({x:0,y:0})),zu=xe(0),ja=xe(!1),nc=xe(V({x:0,y:0})),Bc=xe(!1),Vu=xe(V({x:0,y:0})),rf=xe(!1),co=xe(V({x:0,y:0})),ll=xe(0),va=xe(!1),Vl=xe(V({x:0,y:0})),kr=xe(0),Wr=xe("cr"),jl=xe(!1),Xl=xe(V({x:0,y:0})),Mu=xe(!1),Zu=xe(V({x:0,y:0})),xo=xe(!1),Sr=xe(V({x:0,y:0})),ql=xe(0),$f=xe(!1),Cf=xe(V({x:0,y:0})),tp=xe(!1),mf=xe(V({x:0,y:0})),sc=xe(!1),yd=V({x:0,y:0}),If=xe(!1),En=V({x:0,y:0}),ms=xe(!1),js=xe(V({x:0,y:0})),Nn=xe(!1),Io=xe(V({x:0,y:0})),fo=xe(!1),Ji=xe(V({x:0,y:0})),Gi=xe(!1),Al=xe(V({x:0,y:0})),Ii=xe(!1),Wo=xe(V({x:0,y:0})),To=xe(!1),Ba=xe(V({x:0,y:0})),Pi=xe(!1),qs=xe(V({x:0,y:0})),mi=xe(!1),Er=xe(V({x:0,y:0})),Za=xe(!1),vi=xe(V({x:0,y:0})),$r=xe(1),Il=xe("solid"),cl=xe(1),kc=xe("dashed"),uc=xe(1),Tl=xe("dashed"),ur=xe(22),la=xe("#66c2a5"),Fl=xe("#66c2a5"),Oa=xe("#e67e22"),ni=xe("#c0392b"),vc=xe(!0),gl=xe(!0),za=xe(!0),sl=xe(!1),Oc=xe(V({x:0,y:0})),Va=xe(0),Wa=xe(!1),uu=xe(V({x:0,y:0})),ud=xe(0),Ll=xe(0),vu=xe(0),Sc=xe(!1),Ja=xe(V({x:0,y:0})),ga=xe(0),Wu=xe(!1),zc=xe(V({x:0,y:0})),eu=xe(0),Ud=xe(!1),qf=xe(V({x:0,y:0})),Uf=xe(0),dd=xe(!1),Id=xe(!1),dc=xe(!1),Gf=xe(!1),Pd=xe(!1),af=xe(V({x:0,y:0})),ol=xe(0);function du(k,A){if(s()){try{s().removeIndicator({paneId:k,name:A})}catch(B){console.log("Error removing indicator:",B)}c.update(B=>{const R=`${k}_${A}`;return delete B.saveInds[R],B})}}const Nu=At(()=>o().editIndName==="BOLL"),hf=At(()=>o().editIndName==="MACD"),td=At(()=>o().editIndName==="BIAS"),Cc=At(()=>o().editIndName==="AO"),Gd=At(()=>o().editIndName==="WR"),tu=At(()=>o().editIndName==="VR"),Vc=At(()=>o().editIndName==="BBI"),Yd=At(()=>o().editIndName==="EMA"),Md=At(()=>o().editIndName==="SMA"),Au=At(()=>o().editIndName==="MA"),Kd=At(()=>o().editIndName==="ICHIMOKU"),Hu=At(()=>o().editIndName==="PVT"),Tu=At(()=>o().editIndName==="VOL"),bd=At(()=>o().editIndName==="SAR"),gc=At(()=>o().editIndName==="DMI"),qu=At(()=>o().editIndName==="TRIX"),$d=At(()=>o().editIndName==="ROC"),np=At(()=>o().editIndName==="ZIGZAG"),Pf=At(()=>o().editIndName==="PSY"),oe=At(()=>o().editIndName==="OBV"),we=At(()=>o().editIndName==="CR"),K=At(()=>o().editIndName==="NPO_MAE"),re=At(()=>o().editIndName==="KDJ"),ke=At(()=>o().editIndName==="CCI"),ee=At(()=>o().editIndName==="EMV"),Ee=At(()=>o().editIndName==="MTM"),ht=At(()=>o().editIndName==="RSI"),pt=At(()=>o().editIndName==="STOCH"),Nt=At(()=>o().editIndName==="SMARTTREND"),E=At(()=>o().editIndName==="SMART_MONEY"),I=At(()=>o().editIndName==="TRAP_HUNTER"),W=At(()=>o().editIndName==="VOLCANIC"),Z=At(()=>o().editIndName==="VOLCANIC_SIG"),_e=At(()=>i(E)||i(I)||i(W)||i(Z));function me(){if(!(o().editIndName!=="TRAP_HUNTER"||!s()))try{const k=(u||[]).map(A=>Number(A));s().overrideIndicator({name:"TRAP_HUNTER",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating Trap Hunter:",k)}}function Le(){if(!(o().editIndName!=="VOLCANIC"||!s()))try{const k=(u||[]).map(A=>Number(A));s().overrideIndicator({name:"VOLCANIC",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating VOLCANIC:",k)}}function ye(){if(!(o().editIndName!=="VOLCANIC_SIG"||!s()))try{const k=(u||[]).map(A=>Number(A));s().overrideIndicator({name:"VOLCANIC_SIG",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating VOLCANIC_SIG:",k)}}let Se=xe("");wr(()=>{if(!i(W))return;const k=JSON.stringify(u??[]);k!==i(Se)&&(x(Se,V(k)),Le())});let Ge=xe("");wr(()=>{if(!i(Z))return;const k=JSON.stringify(u??[]);k!==i(Ge)&&(x(Ge,V(k)),ye())});const Ae=At(()=>o().editIndName==="SMARTTREND"?"Smart Trend":o().editIndName);let Rt=xe("#2962FF"),nn=xe(2),Xn=xe("solid"),hn=xe(26),is=xe(10),Gs=xe(20),es=xe(40),Mi=xe(60),Kn=V({zoneLookbackBars:40,minZoneBars:5,maxZoneBars:25,atrPeriod:14,volumeMAPeriod:20,minVolumeFactor:1.2,maxZoneWidthPct:.03,priorTrendLookback:20,minOBVTrendStrength:.2,minZoneScore:.6,mergeNearbyZones:!0,maxZonesDisplayed:20,showLabels:!0});function Es(){if(!i(E)||!Array.isArray(u))return;const k=u;Kn.zoneLookbackBars=Number(k[0]??Kn.zoneLookbackBars),Kn.minZoneBars=Number(k[1]??Kn.minZoneBars),Kn.maxZoneBars=Number(k[2]??Kn.maxZoneBars),Kn.atrPeriod=Number(k[3]??Kn.atrPeriod),Kn.volumeMAPeriod=Number(k[4]??Kn.volumeMAPeriod),Kn.minVolumeFactor=Number(k[5]??Kn.minVolumeFactor),Kn.maxZoneWidthPct=Number(k[6]??Kn.maxZoneWidthPct),Kn.priorTrendLookback=Number(k[7]??Kn.priorTrendLookback),Kn.minOBVTrendStrength=Number(k[8]??Kn.minOBVTrendStrength),Kn.minZoneScore=Number(k[9]??Kn.minZoneScore),Kn.mergeNearbyZones=Number(k[10]??(Kn.mergeNearbyZones?1:0))>0,Kn.maxZonesDisplayed=Number(k[11]??Kn.maxZonesDisplayed),Kn.showLabels=Number(k[12]??(Kn.showLabels?1:0))>0}wr(()=>{i(E)&&Es()});function Qo(){var A;const k=[Kn.zoneLookbackBars,Kn.minZoneBars,Kn.maxZoneBars,Kn.atrPeriod,Kn.volumeMAPeriod,Kn.minVolumeFactor,Kn.maxZoneWidthPct,Kn.priorTrendLookback,Kn.minOBVTrendStrength,Kn.minZoneScore,Kn.mergeNearbyZones?1:0,Kn.maxZonesDisplayed,Kn.showLabels?1:0];(A=s())==null||A.overrideIndicator({name:"SMART_MONEY",calcParams:k,paneId:o().editPaneId}),c.update(B=>(B.saveInds[`${o().editPaneId}_SMART_MONEY`]={name:"SMART_MONEY",params:k,pane_id:o().editPaneId},B))}let sr=xe("#FF6B35"),na=xe("#2196F3"),Xr=xe("#4CAF50"),Uu=xe("#FF9800"),xd=xe("#9C27B0"),ul=xe(2),dr=xe(1),Fu=xe(1),gi=xe(1),Dr=xe(1),Yi=xe("solid"),Ki=xe("solid"),Xi=xe("solid"),ca=xe("solid"),Jt=xe("solid");wr(()=>{i($d)&&!i(Pl)?(console.log("🎯 ROC modal opened, initializing..."),x(Pl,!0),jm(),setTimeout(()=>{op()},100)):!i($d)&&i(Pl)&&x(Pl,!1)});let rn=xe(!1),dn=xe(!1);wr(()=>{i(ht)&&!i(rn)?(console.log("🎯 RSI modal opened, initializing..."),x(rn,!0),Vg()):!i(ht)&&i(rn)&&x(rn,!1)}),wr(()=>{i(pt)&&!i(dn)?(console.log("🎯 Stochastic modal opened, initializing..."),x(dn,!0),$m()):!i(pt)&&i(dn)&&x(dn,!1)}),wr(()=>{i(qu)&&!i(_u)?(console.log("🎯 TRIX modal opened, initializing..."),x(_u,!0),Ta()):!i(qu)&&i(_u)&&x(_u,!1)});let uo=xe(!1);wr(()=>{i(Md)&&!i(uo)?(console.log("🎯 SMA modal opened, initializing..."),x(uo,!0),Un()):!i(Md)&&i(uo)&&x(uo,!1)});let zs=xe(!1);wr(()=>{i(tu)&&!i(zs)?(console.log("🎯 VR modal opened, initializing..."),x(zs,!0),O0()):!i(tu)&&i(zs)&&x(zs,!1)});let Hr=xe(!1);wr(()=>{i(Tu)&&!i(Hr)?(console.log("🎯 Volume modal opened, initializing..."),x(Hr,!0),Cg()):!i(Tu)&&i(Hr)&&x(Hr,!1)});let Ul=xe(!1);wr(()=>{i(Vc)&&!i(Ul)?(console.log("🎯 BBI modal opened, initializing..."),x(Ul,!0),_i()):!i(Vc)&&i(Ul)&&x(Ul,!1)}),wr(()=>{i(Vc)&&i(Ul)&&s()&&i(Rd).forEach((k,A)=>{const{period1:B,period2:R,period3:U,period4:q,color:ve,thickness:Re,lineStyle:rt}=k;if(B&&R&&U&&q&&ve&&Re&&rt){const Ut=setTimeout(()=>{Ct(A)},100);return()=>clearTimeout(Ut)}})});let Oi=xe(!1);wr(()=>{i(Nu)&&!i(Oi)?(console.log("🎯 Bollinger Bands modal opened, initializing..."),x(Oi,!0),ph()):!i(Nu)&&i(Oi)&&x(Oi,!1)}),wr(()=>{if(i(Nu)&&i(Oi)&&s()){const k=i(O),A=i(D),B=i(w),R=i(C),U=i(M),q=i(P),ve=i(T),Re=i(N),rt=i(L);if(k&&A&&B&&U&&q&&ve&&Re&&rt){const Ut=setTimeout(()=>{i(Jl).length===0?x(Jl,V([{id:Lr(),paneId:o().editPaneId||"candle_pane",period:k,stdDev:A,styles:{fillColor:B,fillOpacity:R,upperColor:U,middleColor:q,lowerColor:ve,thickness:Re,lineStyle:rt}}])):(i(Jl)[0].period=k,i(Jl)[0].stdDev=A,i(Jl)[0].styles.fillColor=B,i(Jl)[0].styles.fillOpacity=R,i(Jl)[0].styles.upperColor=U,i(Jl)[0].styles.middleColor=q,i(Jl)[0].styles.lowerColor=ve,i(Jl)[0].styles.thickness=Re,i(Jl)[0].styles.lineStyle=rt),ao()},100);return()=>clearTimeout(Ut)}}});let Nd=xe(!1);wr(()=>{i(bd)&&!i(Nd)?(console.log("🎯 SAR modal opened, initializing..."),x(Nd,!0),xu()):!i(bd)&&i(Nd)&&x(Nd,!1)}),wr(()=>{i(bd)&&i(Nd)&&s()&&i(_c).forEach((k,A)=>{const{start:B,increment:R,maxValue:U,color:q,dotSize:ve}=k;if(B!==void 0&&R!==void 0&&U!==void 0&&q&&ve){const Re=setTimeout(()=>{vo(A)},100);return()=>clearTimeout(Re)}})});let hr=xe(!1);wr(()=>{i(Cc)&&!i(hr)?(console.log("🎯 AO modal opened, initializing..."),x(hr,!0),Lp()):!i(Cc)&&i(hr)&&x(hr,!1)}),wr(()=>{i(Cc)&&i(hr)&&s()&&i(oc).forEach((k,A)=>{const{shortPeriod:B,longPeriod:R,styles:U}=k;if(B&&R&&U){const q=setTimeout(()=>{im()},100);return()=>clearTimeout(q)}})});let vr=xe(!1);wr(()=>{i(td)&&!i(vr)?(console.log("🎯 BIAS modal opened, initializing..."),x(vr,!0),Ml()):!i(td)&&i(vr)&&x(vr,!1)}),wr(()=>{i(td)&&i(vr)&&s()&&i(so).forEach((k,A)=>{const{period:B,color:R,thickness:U,lineStyle:q}=k;if(B&&R&&U&&q){const ve=setTimeout(()=>{Gl()},100);return()=>clearTimeout(ve)}})});let _l=xe(!1);wr(()=>{i(Ee)&&!i(_l)?(console.log("🎯 MTM modal opened, initializing..."),x(_l,!0),Ev()):!i(Ee)&&i(_l)&&x(_l,!1)}),wr(()=>{i(Ee)&&i(_l)&&s()&&i(pr).forEach((k,A)=>{const{period:B,color:R,thickness:U,lineStyle:q}=k;if(B&&R&&U&&q){const ve=setTimeout(()=>{ch()},100);return()=>clearTimeout(ve)}})});let ia=xe(!1),Zl=xe(!1);wr(()=>{i(oe)&&!i(ia)?(console.log("🎯 OBV modal opened, initializing..."),x(ia,!0),Bm()):!i(oe)&&i(ia)&&x(ia,!1)}),wr(()=>{if(i(Zl)){console.log("⏸️ Skipping OBV effect - removal in progress");return}i(oe)&&i(ia)&&s()&&i(Qi).forEach((k,A)=>{const{obvPeriod:B,maobvPeriod:R,showMaobv:U,styles:q}=k;if(B&&R&&q){const ve=setTimeout(()=>{om()},100);return()=>clearTimeout(ve)}})});let Bo=xe(!1);wr(()=>{i(ke)&&!i(Bo)?(console.log("🎯 CCI modal opened, initializing..."),x(Bo,!0),fc()):!i(ke)&&i(Bo)&&x(Bo,!1)}),wr(()=>{i(ke)&&i(Bo)&&s()&&i(mo).forEach((k,A)=>{const{period:B,color:R,thickness:U,lineStyle:q}=k;if(B&&R&&U&&q){const ve=setTimeout(()=>{md()},100);return()=>clearTimeout(ve)}})});let Mf=xe(!1);wr(()=>{i(we)&&!i(Mf)?(console.log("🎯 CR modal opened, initializing..."),x(Mf,!0),dp()):!i(we)&&i(Mf)&&x(Mf,!1)}),wr(()=>{i(we)&&i(Mf)&&s()&&i(Cr).forEach((k,A)=>{const{crPeriod:B,crMa1Period:R,crMa2Period:U,crMa3Period:q,crMa4Period:ve,styles:Re}=k;if(B&&R&&U&&q&&ve&&Re){const rt=setTimeout(()=>{nu()},100);return()=>clearTimeout(rt)}})});let Yc=xe(!1);wr(()=>{i(gc)&&!i(Yc)?(console.log("🎯 DMI modal opened, initializing..."),x(Yc,!0),nd()):!i(gc)&&i(Yc)&&x(Yc,!1)}),wr(()=>{i(gc)&&i(Yc)&&s()&&i(El).forEach((k,A)=>{const{diPeriod:B,adxPeriod:R,styles:U}=k;if(B&&R&&U){const q=setTimeout(()=>{Ic()},100);return()=>clearTimeout(q)}})}),wr(()=>{i(tu)&&i(zs)&&s()&&i(Dd).forEach((k,A)=>{const{period:B,shortPeriod:R,longPeriod:U,styles:q}=k;if(B&&R&&U&&q){const ve=setTimeout(()=>{ot(A)},100);return()=>clearTimeout(ve)}})}),wr(()=>{i(hf)&&s()&&i(Lu).length>0&&i(Lu).forEach((k,A)=>{const{fastPeriod:B,slowPeriod:R,signalPeriod:U,styles:q}=k;if(B&&R&&U&&q){const ve=setTimeout(()=>{qh(A)},100);return()=>clearTimeout(ve)}})});let Lu=xe(V([])),Ju=xe(V([])),Dd=xe(V([])),oc=xe(V([])),Rd=xe(V([])),Jl=xe(V([])),Yf=xe(0),An=xe(V([])),yt=xe(0);function Rn(k){x(yt,V(k)),x(ho,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Qt,!0)}function _n(){if(!s())return;const k=o().editPaneId||"candle_pane";for(let A=0;A<6;(A+=1)-1)try{s().removeIndicator({paneId:k,name:"ZIGZAG"})}catch{}i(An).forEach((A,B)=>{const R=A.styles.lineStyle==="solid"?vt.Solid:vt.Dashed,U=A.styles.lineStyle==="dashed"?[4,4]:A.styles.lineStyle==="dotted"?[2,6]:[2,2],q={lines:[{color:A.styles.color,size:A.styles.thickness,style:R,dashedValue:U,smooth:!1}]};s().createIndicator({name:"ZIGZAG",calcParams:[A.deviation,A.depth],styles:q},!0,{id:k});const ve=B===0?`${k}_ZIGZAG`:`${k}_ZIGZAG_${B+1}`;c.update(Re=>(Re.saveInds[ve]={name:"ZIGZAG",pane_id:k,params:[A.deviation,A.depth],styles:q},Re))}),c.update(A=>{const B=`${k}_ZIGZAG`;return Object.keys(A.saveInds).filter(U=>U.startsWith(B)).forEach(U=>{const q=U.match(/_ZIGZAG(?:_(\d+))?$/);(q&&q[1]?parseInt(q[1],10):1)>i(An).length&&delete A.saveInds[U]}),A})}function Vs(k,A){x(Yf,V(A));const B={x:window.innerWidth/2,y:window.innerHeight/2};k==="fill"&&(x(Io,V(B)),x(Nn,!0)),k==="upper"&&(x(Ji,V(B)),x(fo,!0)),k==="middle"&&(x(Al,V(B)),x(Gi,!0)),k==="lower"&&(x(Wo,V(B)),x(Ii,!0))}function Ms(){return window.__npoMaeApi}function $s(k){const A={x:window.innerWidth/2,y:window.innerHeight/2};k==="median"&&(x(Ba,V(A)),x(To,!0)),k==="band"&&(x(qs,V(A)),x(Pi,!0)),k==="slLong"&&(x(Er,V(A)),x(mi,!0)),k==="slShort"&&(x(vi,V(A)),x(Za,!0))}function wo(){const k=Ms();if(!k)return;k.updateSettings({bandAlpha:Math.max(0,Math.min(100,i(ur)))/100});const A=g(i(la),i(ur));k.setColors({band:A})}let Zo=xe(!1);wr(()=>{var k,A;if(!(!i(K)||i(Zo)||!s()))try{const R=(((A=(k=s()).getOverlays)==null?void 0:A.call(k))??[]).find(Re=>(Re==null?void 0:Re.name)==="NearestPatternOutcomeMaeStop"),U=(R==null?void 0:R.extendData)||{},q=U.colors||{};q.median&&x(Fl,V(q.median)),q.band&&x(la,V(q.band)),q.slLong&&x(Oa,V(q.slLong)),q.slShort&&x(ni,V(q.slShort)),typeof U.showOutcomeBand=="boolean"&&x(vc,V(U.showOutcomeBand)),typeof U.showStopLines=="boolean"&&x(gl,V(U.showStopLines)),typeof U.showTable=="boolean"&&x(za,V(U.showTable));const ve=U.styles||{};ve.median&&(typeof ve.median.size=="number"&&x($r,V(ve.median.size)),typeof ve.median.style=="string"&&x(Il,V(ve.median.style))),ve.slLong&&(typeof ve.slLong.size=="number"&&x(cl,V(ve.slLong.size)),typeof ve.slLong.style=="string"&&x(kc,V(ve.slLong.style))),ve.slShort&&(typeof ve.slShort.size=="number"&&x(uc,V(ve.slShort.size)),typeof ve.slShort.style=="string"&&x(Tl,V(ve.slShort.style))),typeof U.bandAlpha=="number"&&x(ur,V(Math.round((U.bandAlpha||0)*100))),x(Zo,!0)}catch{}});function ao(){if(!s())return;const k=o().editPaneId||"candle_pane";for(let A=0;A<6;(A+=1)-1)try{s().removeIndicator({paneId:k,name:"BOLL"})}catch{}i(Jl).forEach((A,B)=>{const R=A.styles.lineStyle==="solid"?vt.Solid:vt.Dashed,U=A.styles.lineStyle==="dashed"?[4,4]:[0,0],q={lines:[{color:A.styles.upperColor,size:A.styles.thickness,style:R,dashedValue:U},{color:A.styles.middleColor,size:A.styles.thickness,style:R,dashedValue:U},{color:A.styles.lowerColor,size:A.styles.thickness,style:R,dashedValue:U}],fill:{color:A.styles.fillColor,opacity:(A.styles.fillOpacity||0)/100}};s().createIndicator({name:"BOLL",calcParams:[A.period,A.stdDev],styles:q},!0,{id:k});const ve=B===0?`${k}_BOLL`:`${k}_BOLL_${B+1}`;c.update(Re=>(Re.saveInds[ve]={name:"BOLL",pane_id:k,params:[A.period,A.stdDev],bollingerStyles:{fillColor:A.styles.fillColor,fillOpacity:A.styles.fillOpacity,upperColor:A.styles.upperColor,middleColor:A.styles.middleColor,lowerColor:A.styles.lowerColor,thickness:A.styles.thickness,lineStyle:A.styles.lineStyle}},Re))}),c.update(A=>{const B=`${k}_BOLL`;return Object.keys(A.saveInds).filter(U=>U.startsWith(B)).forEach(U=>{const q=U.match(/_BOLL(?:_(\d+))?$/);(q&&q[1]?parseInt(q[1],10):1)>i(Jl).length&&delete A.saveInds[U]}),A})}function Ho(k){if(i(Jl).length<=1)return;x(Jl,V(i(Jl).filter((B,R)=>R!==k)));const A=i(Jl)[0];A&&(x(O,V(A.period)),x(D,V(A.stdDev)),x(w,V(A.styles.fillColor)),x(C,V(A.styles.fillOpacity)),x(M,V(A.styles.upperColor)),x(P,V(A.styles.middleColor)),x(T,V(A.styles.lowerColor)),x(N,V(A.styles.thickness)),x(L,V(A.styles.lineStyle))),ao()}let so=xe(V([])),Wi=xe(V([])),_c=xe(V([])),gu=xe(V([])),El=xe(V([])),fu=xe(V([])),Cr=xe(V([])),ba=xe(V([])),Pl=xe(!1),_u=xe(!1),Zr=xe(V([])),Qi=xe(V([])),os=xe(V([])),mo=xe(V([]));function er(){x(mo,V([])),console.log("✅ CCI groups cleared from modal state")}let gr=xe(V([]));function fr(){x(gr,V([])),console.log("✅ EMV groups cleared from modal state")}let pr=xe(V([]));function yu(){x(pr,V([])),console.log("✅ MTM groups cleared from modal state")}function Kc(){x(Qi,V([])),console.log("✅ OBV groups cleared from modal state")}function fd(){x(Zr,V([])),console.log("✅ PSY groups cleared from modal state")}let Rr=xe(V([]));function ic(){x(Rr,V([])),console.log("✅ PVT groups cleared from modal state")}function Lc(){x(St,V([])),console.log("✅ VOL groups cleared from modal state")}function Ad(){x(Ju,V([])),console.log("✅ WR groups cleared from modal state")}function Gu(){if(!i(Hu))return;const k=`${o().editPaneId}_PVT`,A=r().saveInds[k];A&&A.pvtGroups&&A.pvtGroups.length>0?x(Rr,V([...A.pvtGroups])):i(Rr).length===0&&x(Rr,V([{id:Lr(),name:"PVT #1",color:"#2563eb",thickness:1,lineStyle:"solid"}]))}function lf(){var A;if(!i(Hu))return;const k={id:Lr(),name:`PVT #${i(Rr).length+1}`,color:"#2563eb",thickness:1,lineStyle:"solid"};if(i(Rr).push(k),s()){let B=vt.Solid,R=[2,2];k.lineStyle==="dashed"?(B=vt.Dashed,R=[4,4]):k.lineStyle==="dotted"&&(B=vt.Dashed,R=[2,2]);const U={lines:[{color:k.color,size:k.thickness,style:B,dashedValue:R}]},q=(A=s())==null?void 0:A.createIndicator({name:"PVT",styles:U,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);console.log("✅ Created PVT indicator on pane:",q),q&&c.update(ve=>{const Re=`${q}_PVT`;return ve.saveInds[Re]||(ve.saveInds[Re]={name:"PVT",pane_id:q,pvtGroups:[]}),ve.saveInds[Re].pvtGroups||(ve.saveInds[Re].pvtGroups=[]),ve.saveInds[Re].pvtGroups.push({...k}),console.log("💾 Saved new PVT group to storage:",Re,k),ve})}console.log("➕ Added new PVT group:",k.name,"ID:",k.id)}function pd(k){var B,R;if(!i(Hu)||i(Rr).length<=1||k<0||k>=i(Rr).length)return;console.log("🗑️ Removing PVT group at index:",k);const A=i(Rr).length;if(i(Rr)[k],i(Rr).splice(k,1),console.log(`📝 Removed group: ${A} -> ${i(Rr).length}`),i(Rr).forEach((U,q)=>{U.name=`PVT #${q+1}`}),s())try{const q=((B=s())==null?void 0:B.getIndicators()).filter(ve=>ve.name==="PVT");console.log("📈 PVT indicators found:",q.length);for(const ve of q)console.log("🗑️ Removing PVT from pane:",ve.paneId),(R=s())==null||R.removeIndicator({paneId:ve.paneId,name:"PVT"});i(Rr).forEach((ve,Re)=>{var Mn;let rt=vt.Solid,Ut=[2,2];ve.lineStyle==="dashed"?(rt=vt.Dashed,Ut=[4,4]):ve.lineStyle==="dotted"&&(rt=vt.Dashed,Ut=[2,2]);const ls={lines:[{color:ve.color,size:ve.thickness,style:rt,dashedValue:Ut}]};console.log("➕ Re-adding PVT group:",ve.name,"at index:",Re);const ns=(Mn=s())==null?void 0:Mn.createIndicator({name:"PVT",styles:ls,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);ns&&c.update(qo=>{const Yo=`${ns}_PVT`;return qo.saveInds[Yo]||(qo.saveInds[Yo]={name:"PVT",pane_id:ns,pvtGroups:[]}),qo.saveInds[Yo].pvtGroups||(qo.saveInds[Yo].pvtGroups=[]),qo.saveInds[Yo].pvtGroups[Re]={...ve},qo})}),console.log("✅ Successfully updated PVT indicators on chart")}catch(U){console.error("❌ Error updating PVT indicators:",U)}console.log("✅ PVT group removed. Remaining groups:",i(Rr).length)}function Df(){x(ba,V([])),console.log("✅ ROC groups cleared from modal state")}let Li=xe(V([]));function nm(){x(Li,V([])),console.log("✅ RSI groups cleared from modal state")}function Nf(){const k=new Set,A=s();if(!(A!=null&&A.getIndicators))return k;try{A.getIndicators().forEach(R=>{(R==null?void 0:R.name)==="RSI"&&(R!=null&&R.paneId)&&k.add(R.paneId)})}catch(B){console.warn("⚠️ Failed to read RSI pane IDs from chart:",B)}return k}function nt(k,A){const B=Nf();for(const R of B)if(!k.has(R))return R;return A}function yv(k){const A="pane_RSI";if(!k.has(A))return A;let B=2;for(;k.has(`${A}_${B}`)&&B<1e3;)B+=1;if(!k.has(`${A}_${B}`))return`${A}_${B}`;let R=`${A}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;k.has(R);)R=`${A}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return R}function Tv(k,A={}){return{...k,...A,styles:{...k.styles,rsi:{...k.styles.rsi}}}}function Fp(k){var U,q,ve;if(!k||k.name!=="RSI")return null;const A=Array.isArray(k.rsiGroups)&&k.rsiGroups.length>0?k.rsiGroups[0]:null;if(!A)return null;const B=A.actualPaneId||A.paneId||k.pane_id,R=A.styles||{};return{id:A.id||Lr(),period:A.period??(Array.isArray(k.params)?k.params[0]:14),overboughtLevel:A.overboughtLevel??70,middleLevel:A.middleLevel??50,oversoldLevel:A.oversoldLevel??30,fillOpacity:A.fillOpacity??.15,paneId:B||k.pane_id,actualPaneId:B||k.pane_id,styles:{rsi:{color:((U=R.rsi)==null?void 0:U.color)??"#8B5CF6",thickness:((q=R.rsi)==null?void 0:q.thickness)??2,lineStyle:((ve=R.rsi)==null?void 0:ve.lineStyle)??"solid"},overboughtColor:R.overboughtColor??"#EF4444",overboughtThickness:R.overboughtThickness??1,overboughtLineStyle:R.overboughtLineStyle??"dashed",oversoldColor:R.oversoldColor??"#22C55E",oversoldThickness:R.oversoldThickness??1,oversoldLineStyle:R.oversoldLineStyle??"dashed",middleLineColor:R.middleLineColor??"#6B7280",middleLineThickness:R.middleLineThickness??1,middleLineStyle:R.middleLineStyle??"dashed"}}}function pu(){const k=new Map;Object.values(r().saveInds||{}).forEach(B=>{if(!B||B.name!=="RSI")return;const R=Fp(B);R!=null&&R.actualPaneId&&!k.has(R.actualPaneId)&&k.set(R.actualPaneId,R)});const A=Array.from(k.values());return o().editPaneId&&A.sort((B,R)=>B.actualPaneId===o().editPaneId?-1:R.actualPaneId===o().editPaneId?1:(B.actualPaneId||"").localeCompare(R.actualPaneId||"")),A}function Em(){if(!i(ht))return;const k=i(Li).map(A=>{const B=A.actualPaneId||A.paneId||o().editPaneId;return Tv(A,{paneId:B,actualPaneId:B})});c.update(A=>(Object.keys(A.saveInds||{}).forEach(B=>{var R;((R=A.saveInds[B])==null?void 0:R.name)==="RSI"&&delete A.saveInds[B]}),k.forEach(B=>{const R=B.actualPaneId;if(!R)return;const U=`${R}_RSI`;A.saveInds[U]={name:"RSI",pane_id:R,params:[B.period],rsiGroups:[Tv(B)]}}),A))}function Vg(){if(!i(ht))return;const k=pu(),A=Nf();if(A.size>0&&k.length<A.size){const B=[];if(A.forEach(R=>{try{const U=m0.getInstance(R)||m0.getInstanceConfig(R);if(!U)return;const q={id:Lr(),period:U.period??14,overboughtLevel:U.overboughtLevel??70,middleLevel:U.middleLevel??50,oversoldLevel:U.oversoldLevel??30,fillOpacity:U.fillOpacity??.15,paneId:R,actualPaneId:R,styles:{rsi:{color:U.lineColor??"#8B5CF6",thickness:U.lineThickness??2,lineStyle:U.lineStyle??"solid"},overboughtColor:U.overboughtColor??"#EF4444",overboughtThickness:U.overboughtThickness??1,overboughtLineStyle:U.overboughtLineStyle??"dashed",oversoldColor:U.oversoldColor??"#22C55E",oversoldThickness:U.oversoldThickness??1,oversoldLineStyle:U.oversoldLineStyle??"dashed",middleLineColor:U.middleLineColor??"#6B7280",middleLineThickness:U.middleLineThickness??1,middleLineStyle:U.middleLineStyle??"dashed"}};B.push(q)}catch(U){console.warn("⚠️ Failed to reconstruct RSI group from instance:",U)}}),B.length>0){x(Li,V(B)),Em();return}}if(k.length>0){x(Li,V(k)),Em();return}if(i(Li).length===0){const B={id:Lr(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:o().editPaneId,actualPaneId:o().editPaneId,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};x(Li,V([B])),m0.createInstance(B.actualPaneId,{period:B.period,lineColor:B.styles.rsi.color,lineThickness:B.styles.rsi.thickness,lineStyle:B.styles.rsi.lineStyle,overboughtLevel:B.overboughtLevel,oversoldLevel:B.oversoldLevel,middleLevel:B.middleLevel,overboughtColor:B.styles.overboughtColor,overboughtThickness:B.styles.overboughtThickness??1,overboughtLineStyle:B.styles.overboughtLineStyle||"dashed",oversoldColor:B.styles.oversoldColor,oversoldThickness:B.styles.oversoldThickness??1,oversoldLineStyle:B.styles.oversoldLineStyle||"dashed",overboughtFillColor:B.styles.overboughtColor,oversoldFillColor:B.styles.oversoldColor,middleLineColor:B.styles.middleLineColor,middleLineThickness:B.styles.middleLineThickness??1,middleLineStyle:B.styles.middleLineStyle||"dashed",fillOpacity:B.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:B.overboughtLevel,color:B.styles.overboughtColor,lineStyle:B.styles.overboughtLineStyle||"dashed",thickness:B.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:B.middleLevel,color:B.styles.middleLineColor,lineStyle:B.styles.middleLineStyle||"dashed",thickness:B.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:B.oversoldLevel,color:B.styles.oversoldColor,lineStyle:B.styles.oversoldLineStyle||"dashed",thickness:B.styles.oversoldThickness??1,label:"30",visible:!0}]}),Em()}}function kg(){if(!i(ht))return;const k=Nf(),A=new Set(k);i(Li).forEach(q=>{const ve=q.actualPaneId||q.paneId;ve&&A.add(ve)});const B=yv(A),R={id:Lr(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:B,actualPaneId:B,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};i(Li).push(R);let U=B;if(s()){const q=s(),ve=new Set(k);let Re=vt.Solid,rt=[2,2];R.styles.rsi.lineStyle==="dashed"?(Re=vt.Dashed,rt=[6,4]):R.styles.rsi.lineStyle==="dotted"&&(Re=vt.Dashed,rt=[2,2]);const Ut=q.createIndicator({name:"RSI",calcParams:[R.period],styles:{lines:[{color:R.styles.rsi.color,size:R.styles.rsi.thickness,style:Re,dashedValue:rt}]}},!1,{id:B,axis:{gap:{bottom:2}}});if(U=nt(ve,B),R.paneId=U,R.actualPaneId=U,m0.createInstance(U,{period:R.period,lineColor:R.styles.rsi.color,lineThickness:R.styles.rsi.thickness,lineStyle:R.styles.rsi.lineStyle,overboughtLevel:R.overboughtLevel,oversoldLevel:R.oversoldLevel,middleLevel:R.middleLevel,overboughtColor:R.styles.overboughtColor,overboughtThickness:R.styles.overboughtThickness??1,overboughtLineStyle:R.styles.overboughtLineStyle||"dashed",oversoldColor:R.styles.oversoldColor,oversoldThickness:R.styles.oversoldThickness??1,oversoldLineStyle:R.styles.oversoldLineStyle||"dashed",overboughtFillColor:R.styles.overboughtColor,oversoldFillColor:R.styles.oversoldColor,middleLineColor:R.styles.middleLineColor,middleLineThickness:R.styles.middleLineThickness??1,middleLineStyle:R.styles.middleLineStyle||"dashed",fillOpacity:R.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:R.overboughtLevel,color:R.styles.overboughtColor,lineStyle:R.styles.overboughtLineStyle||"dashed",thickness:R.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:R.middleLevel,color:R.styles.middleLineColor,lineStyle:R.styles.middleLineStyle||"dashed",thickness:R.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:R.oversoldLevel,color:R.styles.oversoldColor,lineStyle:R.styles.oversoldLineStyle||"dashed",thickness:R.styles.oversoldThickness??1,label:"30",visible:!0}]}),Ut){const ls=`${U}_RSI`;c.update(ns=>(ns.saveInds[ls]={name:"RSI",pane_id:U,params:[R.period],rsiGroups:[{id:R.id,period:R.period,overboughtLevel:R.overboughtLevel,middleLevel:R.middleLevel,oversoldLevel:R.oversoldLevel,paneId:U,actualPaneId:U,styles:R.styles}]},ns))}}else m0.createInstance(U,{period:R.period,lineColor:R.styles.rsi.color,lineThickness:R.styles.rsi.thickness,lineStyle:R.styles.rsi.lineStyle,overboughtLevel:R.overboughtLevel,oversoldLevel:R.oversoldLevel,middleLevel:R.middleLevel,overboughtColor:R.styles.overboughtColor,overboughtThickness:R.styles.overboughtThickness??1,overboughtLineStyle:R.styles.overboughtLineStyle||"dashed",oversoldColor:R.styles.oversoldColor,oversoldThickness:R.styles.oversoldThickness??1,oversoldLineStyle:R.styles.oversoldLineStyle||"dashed",overboughtFillColor:R.styles.overboughtColor,oversoldFillColor:R.styles.oversoldColor,middleLineColor:R.styles.middleLineColor,middleLineThickness:R.styles.middleLineThickness??1,middleLineStyle:R.styles.middleLineStyle||"dashed",fillOpacity:R.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:R.overboughtLevel,color:R.styles.overboughtColor,lineStyle:R.styles.overboughtLineStyle||"dashed",thickness:R.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:R.middleLevel,color:R.styles.middleLineColor,lineStyle:R.styles.middleLineStyle||"dashed",thickness:R.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:R.oversoldLevel,color:R.styles.oversoldColor,lineStyle:R.styles.oversoldLineStyle||"dashed",thickness:R.styles.oversoldThickness??1,label:"30",visible:!0}]});Em()}function Fv(k){var U;if(!i(ht)||i(Li).length<=1||k<0||k>=i(Li).length)return;console.log("🗑️ Removing RSI group at index:",k);const A=i(Li)[k];let B=A.actualPaneId||A.paneId||o().editPaneId;if(!B&&((U=s())!=null&&U.getIndicators))try{const q=new Set(i(Li).filter((rt,Ut)=>Ut!==k).map(rt=>rt.actualPaneId||rt.paneId).filter(rt=>!!rt)),Re=s().getIndicators().find(rt=>(rt==null?void 0:rt.name)==="RSI"&&(rt==null?void 0:rt.paneId)&&!q.has(rt.paneId));Re!=null&&Re.paneId&&(B=Re.paneId)}catch(q){console.warn("⚠️ Failed to resolve RSI pane ID for removal:",q)}const R=i(Li).length;if(i(Li).splice(k,1),console.log(`📝 Removed group: ${R} -> ${i(Li).length}`),s()&&B)try{console.log("🗑️ Removing RSI from pane:",B),m0.deleteInstance(B),du(B,"RSI")}catch(q){console.error("❌ Error removing RSI indicator:",q)}Em(),console.log("✅ RSI group removed. Remaining groups:",i(Li).length)}function Op(k){if(!i(ht)||!s()||k<0||k>=i(Li).length)return;const A=i(Li)[k],B=A.actualPaneId||A.paneId||o().editPaneId;if(!B){console.warn("⚠️ Unable to resolve pane ID for RSI update");return}try{m0.updateInstance(B,{period:A.period,lineColor:A.styles.rsi.color,lineThickness:A.styles.rsi.thickness,lineStyle:A.styles.rsi.lineStyle,overboughtLevel:A.overboughtLevel,oversoldLevel:A.oversoldLevel,middleLevel:A.middleLevel,overboughtColor:A.styles.overboughtColor||"#EF4444",overboughtThickness:A.styles.overboughtThickness??1,overboughtLineStyle:A.styles.overboughtLineStyle||"dashed",oversoldColor:A.styles.oversoldColor||"#22C55E",oversoldThickness:A.styles.oversoldThickness??1,oversoldLineStyle:A.styles.oversoldLineStyle||"dashed",overboughtFillColor:A.styles.overboughtColor||"#EF4444",oversoldFillColor:A.styles.oversoldColor||"#22C55E",middleLineColor:A.styles.middleLineColor||"#6B7280",middleLineThickness:A.styles.middleLineThickness??1,middleLineStyle:A.styles.middleLineStyle||"dashed",fillOpacity:A.fillOpacity??.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:A.overboughtLevel,color:A.styles.overboughtColor||"#EF4444",lineStyle:A.styles.overboughtLineStyle||"dashed",thickness:A.styles.overboughtThickness??1,label:String(A.overboughtLevel),visible:!0},{id:"middle",value:A.middleLevel,color:A.styles.middleLineColor||"#6B7280",lineStyle:A.styles.middleLineStyle||"dashed",thickness:A.styles.middleLineThickness??1,label:String(A.middleLevel),visible:!0},{id:"oversold",value:A.oversoldLevel,color:A.styles.oversoldColor||"#22C55E",lineStyle:A.styles.oversoldLineStyle||"dashed",thickness:A.styles.oversoldThickness??1,label:String(A.oversoldLevel),visible:!0}]}),s().removeIndicator({paneId:B,name:"RSI"});let R=vt.Solid,U=[2,2];A.styles.rsi.lineStyle==="dashed"?(R=vt.Dashed,U=[6,4]):A.styles.rsi.lineStyle==="dotted"&&(R=vt.Dashed,U=[2,2]);const q=s().createIndicator({name:"RSI",calcParams:[A.period],styles:{lines:[{color:A.styles.rsi.color,size:A.styles.rsi.thickness,style:R,dashedValue:U}]}},!1,{id:B,axis:{gap:{bottom:2}}});try{typeof s().resize=="function"&&s().resize()}catch{}if(A.actualPaneId=B,A.paneId=B,q){const ve=`${B}_RSI`;c.update(Re=>{const rt=(i(Li)||[]).filter(Ut=>(Ut.actualPaneId||Ut.paneId)===B);return Re.saveInds[ve]={name:"RSI",pane_id:B,params:[A.period],rsiGroups:rt},Re})}Em()}catch(R){console.error("❌ Error updating RSI indicator:",R)}}let bu=xe(V([]));function ov(){x(bu,V([])),console.log("✅ Stochastic groups cleared from modal state")}function $m(){if(!i(pt))return;const k=`${o().editPaneId}_STOCH`,A=r().saveInds[k];if(A&&A.stochasticGroups&&A.stochasticGroups.length>0)x(bu,V([...A.stochasticGroups]));else if(i(bu).length===0){const B={id:Lr(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:o().editPaneId,styles:{duty:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};x(bu,V([B])),pb.createInstance(o().editPaneId,{kPeriod:B.kPeriod,dPeriod:B.dPeriod,dutyColor:B.styles.duty.color,dutyThickness:B.styles.duty.thickness,dutyStyle:B.styles.duty.lineStyle,dLineColor:B.styles.dLine.color,dLineThickness:B.styles.dLine.thickness,dLineStyle:B.styles.dLine.lineStyle,levels:[{id:"overbought",value:B.overboughtLevel,color:B.styles.overboughtColor,lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:B.oversoldLevel,color:B.styles.oversoldColor,lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:B.midLevel,color:B.styles.midLineColor,lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]})}}function og(){var A;if(!i(pt))return;const k={id:Lr(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:void 0,styles:{duty:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};if(x(bu,V([...i(bu),k])),i(bu).length>1){const B=Object.values(r().saveInds).filter(Ut=>Ut.name==="STOCH"&&Ut.pane_id).map(Ut=>Ut.pane_id);let R=2;for(;B.includes(`pane_STOCH_${R}`);)R+=1;const U=i(bu).length-1,q=[k.kPeriod,k.dPeriod,1],ve={lines:[{color:k.styles.duty.color,size:k.styles.duty.thickness,style:k.styles.duty.lineStyle==="dashed"||k.styles.duty.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:k.styles.duty.lineStyle==="dashed"?[4,4]:k.styles.duty.lineStyle==="dotted"?[2,2]:[2,2]},{color:k.styles.dLine.color,size:k.styles.dLine.thickness,style:k.styles.dLine.lineStyle==="dashed"||k.styles.dLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:k.styles.dLine.lineStyle==="dashed"?[4,4]:k.styles.dLine.lineStyle==="dotted"?[2,2]:[2,2]}]},Re=`pane_STOCH_${R}`;console.log(`🆕 Immediately creating Stochastic ${R} with pane ID:`,Re),((A=s())==null?void 0:A.createIndicator({name:"STOCH",calcParams:q,styles:ve},!1,{id:Re,axis:{gap:{bottom:2}}}))&&(console.log(`✅ Stochastic ${R} created with pane ID:`,Re),k.paneId=Re,pb.updateInstance(Re,{kPeriod:k.kPeriod,dPeriod:k.dPeriod,levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overboughtColor,lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversoldColor,lineStyle:"solid",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:k.midLevel,color:k.styles.midLineColor,lineStyle:"solid",thickness:1,label:"Midline",visible:!0}],zones:[{id:"overbought_zone",type:"overbought",topLevel:100,bottomLevel:k.overboughtLevel,fillColor:k.styles.overboughtColor,fillOpacity:.1,visible:!0},{id:"oversold_zone",type:"oversold",topLevel:k.oversoldLevel,bottomLevel:0,fillColor:k.styles.oversoldColor,fillOpacity:.1,visible:!0}],dutyColor:k.styles.duty.color,dLineColor:k.styles.dLine.color,showLevels:!0,showZones:!0,overboughtLevel:k.overboughtLevel,oversoldLevel:k.oversoldLevel,midlineLevel:k.midLevel}),c.update(Ut=>{const ls=`pane_STOCH_${R}_STOCH`;return Ut.saveInds[ls]={name:"STOCH",stochasticGroup:k,pane_id:Re,groupIndex:U,params:[k.kPeriod,k.dPeriod,1]},Ut}))}console.log("✅ New Stochastic group added:",k)}function sm(k){if(!i(pt)||k<0||k>=i(bu).length)return;const B=i(bu)[k].paneId||o().editPaneId;try{pb.deleteInstance(B),s()&&s().removeIndicator({paneId:B,name:"STOCH"}),c.update(R=>(Object.keys(R.saveInds).filter(q=>R.saveInds[q].name==="STOCH"&&R.saveInds[q].pane_id===B).forEach(q=>{delete R.saveInds[q]}),R)),x(bu,V(i(bu).filter((R,U)=>U!==k))),console.log("✅ Stochastic group removed successfully")}catch(R){console.error("❌ Error removing Stochastic group:",R)}}function vf(k){if(!i(pt)||k<0||k>=i(bu).length)return;const A=i(bu)[k],B=A.paneId||o().editPaneId;try{pb.updateInstance(B,{kPeriod:A.kPeriod,dPeriod:A.dPeriod,dutyColor:A.styles.duty.color,dutyThickness:A.styles.duty.thickness,dutyStyle:A.styles.duty.lineStyle,dLineColor:A.styles.dLine.color,dLineThickness:A.styles.dLine.thickness,dLineStyle:A.styles.dLine.lineStyle,overboughtLevel:A.overboughtLevel,oversoldLevel:A.oversoldLevel,midlineLevel:A.midLevel,showZones:!0,zones:[{id:"overbought-zone",topLevel:100,bottomLevel:A.overboughtLevel,fillColor:A.styles.overboughtColor||"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold-zone",topLevel:A.oversoldLevel,bottomLevel:0,fillColor:A.styles.oversoldColor||"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}],levels:[{id:"overbought",value:A.overboughtLevel,color:A.styles.overboughtColor||"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:A.oversoldLevel,color:A.styles.oversoldColor||"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:A.midLevel,color:A.styles.midLineColor||"#6B7280",lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]}),s()&&s().removeIndicator({paneId:B,name:"STOCH"});let R=vt.Solid,U=[2,2],q=vt.Solid,ve=[2,2];if(A.styles.duty.lineStyle==="dashed"?(R=vt.Dashed,U=[4,4]):A.styles.duty.lineStyle==="dotted"&&(R=vt.Dashed,U=[2,2]),A.styles.dLine.lineStyle==="dashed"?(q=vt.Dashed,ve=[4,4]):A.styles.dLine.lineStyle==="dotted"&&(q=vt.Dashed,ve=[2,2]),s()?s().createIndicator({name:"STOCH",calcParams:[A.kPeriod,A.dPeriod],styles:{lines:[{color:A.styles.duty.color,size:A.styles.duty.thickness,style:R,dashedValue:U},{color:A.styles.dLine.color,size:A.styles.dLine.thickness,style:q,dashedValue:ve}]}},B===o().editPaneId,{id:B}):null){const rt=`${B}_STOCH`;c.update(Ut=>(Ut.saveInds[rt]={name:"STOCH",pane_id:B,params:[A.kPeriod,A.dPeriod],stochasticGroups:i(bu)},Ut))}console.log("✅ Stochastic indicator and levels updated successfully")}catch(R){console.error("❌ Error updating Stochastic indicator:",R)}}function Dm(){if(!i(hf))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="MACD").sort();console.log("🔍 Found existing MACD keys:",k),k.length>0?(x(Lu,V([])),k.forEach((A,B)=>{const R=r().saveInds[A];if(R){if(R.macdGroup){const U={...R.macdGroup};U.styles||(U.styles={}),U.styles.reverseHistogram||(U.styles.reverseHistogram={color:"#c4c4c4"}),B>0&&R.pane_id&&(U.actualPaneId=R.pane_id),i(Lu).push(U)}else if(R.params&&R.params.length>=3){const U={id:Lr(),fastPeriod:R.params[0]||12,slowPeriod:R.params[1]||26,signalPeriod:R.params[2]||9,actualPaneId:void 0,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#22c55e"},negativeHistogram:{color:"#ef4444"},reverseHistogram:{color:"#c4c4c4"}}};B>0&&R.pane_id&&(U.actualPaneId=R.pane_id),i(Lu).push(U)}}}),console.log("✅ Loaded",i(Lu).length,"existing MACD groups")):i(Lu).length===0&&(x(Lu,V([{id:Lr(),fastPeriod:12,slowPeriod:26,signalPeriod:9,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#22c55e"},negativeHistogram:{color:"#ef4444"},reverseHistogram:{color:"#c4c4c4"}}}])),console.log("🆕 Created default MACD group"))}function Rm(){var R;if(!i(hf))return;const k=[{macdLine:"#2563eb",signalLine:"#dc2626",positiveHistogram:"#22c55e",negativeHistogram:"#ef4444",reverseHistogram:"#c4c4c4"},{macdLine:"#9333ea",signalLine:"#ea580c",positiveHistogram:"#059669",negativeHistogram:"#dc2626",reverseHistogram:"#c4c4c4"},{macdLine:"#ec4899",signalLine:"#f59e0b",positiveHistogram:"#0891b2",negativeHistogram:"#f97316",reverseHistogram:"#c4c4c4"}],A=i(Lu).length%k.length,B={id:Lr(),fastPeriod:12,slowPeriod:26,signalPeriod:9,actualPaneId:void 0,styles:{macdLine:{color:k[A].macdLine,thickness:1,lineStyle:"solid"},signalLine:{color:k[A].signalLine,thickness:1,lineStyle:"solid"},positiveHistogram:{color:k[A].positiveHistogram},negativeHistogram:{color:k[A].negativeHistogram},reverseHistogram:{color:k[A].reverseHistogram}}};if(i(Lu).push(B),i(Lu).length>1){const U=Object.values(r().saveInds).filter(ns=>ns.name==="MACD"&&ns.pane_id).map(ns=>ns.pane_id);let q=2;for(;U.includes(`pane_MACD_${q}`);)q+=1;const ve=i(Lu).length-1,Re=[B.fastPeriod,B.slowPeriod,B.signalPeriod],rt={lines:[{color:B.styles.macdLine.color,size:B.styles.macdLine.thickness,style:B.styles.macdLine.lineStyle==="dashed"||B.styles.macdLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:B.styles.macdLine.lineStyle==="dashed"?[4,4]:B.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:B.styles.signalLine.color,size:B.styles.signalLine.thickness,style:B.styles.signalLine.lineStyle==="dashed"||B.styles.signalLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:B.styles.signalLine.lineStyle==="dashed"?[4,4]:B.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:B.styles.positiveHistogram.color,downColor:B.styles.negativeHistogram.color,noChangeColor:B.styles.positiveHistogram.color,reverseColor:B.styles.reverseHistogram.color,borderSize:0,borderColor:B.styles.positiveHistogram.color}]},Ut=`pane_MACD_${q}`;console.log(`🆕 Immediately creating MACD ${q} with pane ID:`,Ut),((R=s())==null?void 0:R.createIndicator({name:"MACD",calcParams:Re,styles:rt},!1,{id:Ut,axis:{gap:{bottom:2}}}))&&(console.log(`✅ MACD ${q} created with pane ID:`,Ut),B.actualPaneId=Ut,c.update(ns=>{const Mn=`pane_MACD_${q}_MACD`;return ns.saveInds[Mn]={name:"MACD",macdGroup:B,pane_id:Ut,groupIndex:ve,params:[B.fastPeriod,B.slowPeriod,B.signalPeriod]},ns}))}}function Nh(k){var B,R;if(!i(hf)||i(Lu).length<=1)return;const A=i(Lu).findIndex(U=>U.id===k);if(A!==-1){console.log("🗑️ Removing MACD group at index:",A,"ID:",k);try{if(A===0&&i(Lu).length>1){console.log("🔄 Special handling: First MACD removed, promoting second MACD to first position"),x(Lu,V(i(Lu).filter(q=>q.id!==k))),console.log("✅ MACD group removed from array. Remaining groups:",i(Lu).length);const U=i(Lu)[0];U.actualPaneId&&(console.log("🗑️ Removing old second MACD from sub-pane:",U.actualPaneId),(B=s())==null||B.removeIndicator({paneId:U.actualPaneId,name:"MACD"})),U.actualPaneId=void 0,console.log("📊 Updating MACD in edit pane with new first group settings"),qh(0)}else{const U=i(Lu)[A];U.actualPaneId&&(console.log("🗑️ Removing MACD from actual pane:",U.actualPaneId),(R=s())==null||R.removeIndicator({paneId:U.actualPaneId,name:"MACD"}),console.log("✅ Successfully removed MACD from actual pane:",U.actualPaneId)),x(Lu,V(i(Lu).filter(q=>q.id!==k))),console.log("✅ MACD group removed from array. Remaining groups:",i(Lu).length)}c.update(U=>(Object.keys(U.saveInds).forEach(q=>{U.saveInds[q].name==="MACD"&&(console.log("🧹 Cleaning saved state for key:",q),delete U.saveInds[q])}),i(Lu).forEach((q,ve)=>{const Re=ve===0?`${o().editPaneId}_MACD`:`pane_MACD_${ve+1}_MACD`,rt=ve===0?o().editPaneId:q.actualPaneId||`pane_MACD_${ve+1}`;console.log(`💾 Re-saving MACD group ${ve+1} with key:`,Re,"pane ID:",rt),U.saveInds[Re]={name:"MACD",macdGroup:q,pane_id:rt,groupIndex:ve,macdGroups:ve===0?[...i(Lu)]:void 0,params:[q.fastPeriod,q.slowPeriod,q.signalPeriod]}}),U)),console.log("🔄 MACD groups reindexed successfully")}catch(U){console.log("❌ Error removing MACD indicator:",U)}}}function qh(k){var q;const A=i(Lu)[k];if(!A||!s())return;A.styles.reverseHistogram||(A.styles.reverseHistogram={color:"#c4c4c4"});const B=k===0?o().editPaneId:A.actualPaneId||`pane_MACD_${k+1}`,R={lines:[{color:A.styles.macdLine.color,size:A.styles.macdLine.thickness,style:A.styles.macdLine.lineStyle==="dashed"||A.styles.macdLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:A.styles.macdLine.lineStyle==="dashed"?[4,4]:A.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:A.styles.signalLine.color,size:A.styles.signalLine.thickness,style:A.styles.signalLine.lineStyle==="dashed"||A.styles.signalLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:A.styles.signalLine.lineStyle==="dashed"?[4,4]:A.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:A.styles.positiveHistogram.color,downColor:A.styles.negativeHistogram.color,noChangeColor:A.styles.positiveHistogram.color,reverseColor:A.styles.reverseHistogram.color,borderSize:0,borderColor:A.styles.positiveHistogram.color}]};(q=s())==null||q.overrideIndicator({name:"MACD",paneId:B,styles:R,calcParams:[A.fastPeriod,A.slowPeriod,A.signalPeriod]});const U=k===0?`${o().editPaneId}_MACD`:`pane_MACD_${k+1}_MACD`;c.update(ve=>(ve.saveInds[U]&&(ve.saveInds[U].params=[A.fastPeriod,A.slowPeriod,A.signalPeriod],ve.saveInds[U].macdGroup={...A},console.log("💾 Persisted MACD changes to save data:",U,A)),ve)),console.log("🔄 Updated MACD indicator:",k,A)}function ah(k,A){var q;const B=i(Lu)[k];if(!B||!s())return;B.styles.reverseHistogram||(B.styles.reverseHistogram={color:"#c4c4c4"});const R=k===0?o().editPaneId:B.actualPaneId||`pane_MACD_${k+1}`,U={lines:[{color:B.styles.macdLine.color,size:B.styles.macdLine.thickness,style:B.styles.macdLine.lineStyle==="dashed"||B.styles.macdLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:B.styles.macdLine.lineStyle==="dashed"?[4,4]:B.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:B.styles.signalLine.color,size:B.styles.signalLine.thickness,style:B.styles.signalLine.lineStyle==="dashed"||B.styles.signalLine.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:B.styles.signalLine.lineStyle==="dashed"?[4,4]:B.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:B.styles.positiveHistogram.color,downColor:B.styles.negativeHistogram.color,noChangeColor:B.styles.positiveHistogram.color,reverseColor:B.styles.reverseHistogram.color,borderSize:0,borderColor:B.styles.positiveHistogram.color}]};(q=s())==null||q.overrideIndicator({name:"MACD",paneId:R,styles:U}),console.log("🎨 Updated MACD color:",A,B.styles[A].color)}function Lv(){if(i(ee))try{const k=`${o().editPaneId}_EMV`,A=r().saveInds[k];if(A&&A.emvGroups&&Array.isArray(A.emvGroups)&&A.emvGroups.length>0){const B=A.emvGroups.filter(R=>R&&typeof R.id=="string"&&typeof R.name=="string"&&typeof R.period=="number"&&R.period>0&&typeof R.period2=="number"&&R.period2>0&&typeof R.color=="string"&&typeof R.thickness=="number"&&R.thickness>0&&typeof R.lineStyle=="string");B.length>0?(x(gr,V([...B])),console.log("✅ Loaded",B.length,"valid EMV groups")):(console.warn("⚠️ No valid EMV groups found in saved data, creating default"),x0())}else i(gr).length===0&&x0()}catch(k){console.error("❌ Error initializing EMV groups:",k),x0()}}function x0(){x(gr,V([{id:Lr(),name:"EMV #1",period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default EMV group")}function Sg(k){if(!i(ee)||i(gr).length<=1){console.warn("⚠️ Cannot remove EMV group: minimum one group required");return}try{if(!k||typeof k!="string"){console.error("❌ Invalid group ID provided for EMV group removal");return}const A=i(gr).length;x(gr,V(i(gr).filter(B=>B.id!==k))),i(gr).length<A?console.log("✅ Removed EMV group with ID:",k):console.warn("⚠️ EMV group not found for removal:",k)}catch(A){console.error("❌ Error removing EMV group:",A)}}function Ev(){if(i(Ee))try{const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A]&&r().saveInds[A].name==="MTM").sort((A,B)=>A===`${o().editPaneId}_MTM`?-1:B===`${o().editPaneId}_MTM`?1:A.localeCompare(B));k.length>0?(x(pr,V([])),k.forEach((A,B)=>{const R=r().saveInds[A];if(R){if(R.mtmGroup){const U={...R.mtmGroup};B>0&&R.pane_id&&(U.actualPaneId=R.pane_id),i(pr).push(U)}else if(R.mtmGroups&&Array.isArray(R.mtmGroups)&&B===0){const U=R.mtmGroups.filter(q=>q&&typeof q.id=="string"&&typeof q.name=="string"&&typeof q.period=="number"&&q.period>0&&typeof q.color=="string"&&typeof q.thickness=="number"&&q.thickness>0&&typeof q.lineStyle=="string");x(pr,V([...U]))}}}),i(pr).length>0?console.log("✅ Loaded",i(pr).length,"MTM groups from saved data"):(console.warn("⚠️ No valid MTM groups found, creating default"),bv())):i(pr).length===0&&bv()}catch(k){console.error("❌ Error initializing MTM groups:",k),bv()}}function bv(){x(pr,V([{id:Lr(),name:"MTM #1",period:14,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default MTM group")}function lh(k){if(!i(Ee)||i(pr).length<=1){console.warn("⚠️ Cannot remove MTM group: minimum one group required");return}try{if(!k||typeof k!="string"){console.error("❌ Invalid group ID provided for MTM group removal");return}const A=i(pr).length;x(pr,V(i(pr).filter(B=>B.id!==k))),i(pr).length<A?(console.log("✅ Removed MTM group with ID:",k),ch()):console.warn("⚠️ MTM group not found for removal:",k)}catch(A){console.error("❌ Error removing MTM group:",A)}}function ch(){var k;if(!(!i(Ee)||!s()))try{console.log("🔄 Applying MTM changes to chart...");const A=Object.keys(r().saveInds).filter(R=>r().saveInds[R]&&r().saveInds[R].name==="MTM").sort((R,U)=>R===`${o().editPaneId}_MTM`?-1:U===`${o().editPaneId}_MTM`?1:R.localeCompare(U));console.log("🔧 Applying MTM changes. Existing keys:",A),console.log("🔧 Current MTM groups:",i(pr).length);const B=i(pr).length;if(A.length>B)for(let R=B;R<A.length;(R+=1)-1){const U=A[R],q=r().saveInds[U];if(q&&q.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",q.pane_id),(k=s())==null||k.removeIndicator({paneId:q.pane_id,name:"MTM"})}catch(ve){console.log("❌ Error removing excess MTM indicator:",ve)}}i(pr).forEach((R,U)=>{var Re,rt,Ut;const q=[R.period],ve={lines:[{color:R.color,size:R.thickness,style:R.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:R.lineStyle==="dashed"?[4,4]:R.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(U===0)console.log("🔄 Updating first MTM in pane:",o().editPaneId),(Re=s())==null||Re.overrideIndicator({name:"MTM",calcParams:q,styles:ve,paneId:o().editPaneId});else{const ls=`pane_MTM_${U+1}_MTM`,ns=A.find(Mn=>Mn===ls);if(ns){const Mn=r().saveInds[ns];Mn&&Mn.pane_id&&(console.log("🔄 Updating existing MTM in pane:",Mn.pane_id),(rt=s())==null||rt.overrideIndicator({name:"MTM",calcParams:q,styles:ve,paneId:Mn.pane_id}),R.actualPaneId=Mn.pane_id)}else{const Mn=`pane_MTM_${U+1}`;console.log("🆕 Creating new MTM in pane:",Mn);const qo=(Ut=s())==null?void 0:Ut.createIndicator({name:"MTM",calcParams:q,styles:ve},!0,{id:Mn,axis:{gap:{bottom:2}}});qo&&(R.actualPaneId=Mn,console.log("✅ Created new MTM indicator with ID:",qo,"in pane:",Mn))}}}),c.update(R=>{try{Object.keys(R.saveInds).forEach(U=>{R.saveInds[U]&&R.saveInds[U].name==="MTM"&&delete R.saveInds[U]}),i(pr).forEach((U,q)=>{try{const ve=q===0?`${o().editPaneId}_MTM`:`pane_MTM_${q+1}_MTM`,Re=q===0?o().editPaneId:U.actualPaneId||`pane_MTM_${q+1}`;if(!ve||!Re){console.error(`❌ Invalid save key or pane ID for MTM group ${q}`);return}const rt={name:"MTM",mtmGroup:U,pane_id:Re,groupIndex:q,mtmGroups:q===0?[...i(pr)]:void 0,params:[U.period]};R.saveInds[ve]=rt,console.log("💾 Saved MTM group",q,"with key:",ve,"and pane ID:",Re)}catch(ve){console.error(`❌ Error saving MTM group ${q}:`,ve)}})}catch(U){console.error("❌ Error in MTM save operation:",U)}return R}),console.log("✅ MTM changes applied successfully")}catch(A){console.error("❌ Critical error in applyMtm:",A)}}function ig(){if(!i(Gd))return;const k=`${o().editPaneId}_WR`,A=r().saveInds[k];if(A&&A.wrGroups&&A.wrGroups.length>0){x(Ju,V([...A.wrGroups]));return}const B=[];Object.keys(r().saveInds).forEach(R=>{if((R.includes("_WR")||R.startsWith("WR_"))&&R!==k){const U=r().saveInds[R];U&&U.wrGroup&&B.push(U.wrGroup)}}),A&&A.wrGroup&&B.unshift(A.wrGroup),B.length>0?x(Ju,V([...B])):i(Ju).length===0&&x(Ju,V([{id:Lr(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:o().editPaneId,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}}]))}function uh(){if(!i(Gd))return;const k=`pane_WR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A={id:Lr(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:k,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}};if(i(Ju).push(A),lx.createInstance(k,{period:A.period,lineColor:A.styles.wr.color,lineThickness:A.styles.wr.thickness,lineStyle:A.styles.wr.lineStyle,levels:[{id:"overbought",value:A.overboughtLevel,color:A.styles.overbought.color,lineStyle:A.styles.overbought.lineStyle,thickness:A.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:A.middleLevel,color:A.styles.middleLine.color,lineStyle:A.styles.middleLine.lineStyle,thickness:A.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:A.oversoldLevel,color:A.styles.oversold.color,lineStyle:A.styles.oversold.lineStyle,thickness:A.styles.oversold.thickness,label:"Oversold",visible:!0}]}),s()){let B=vt.Solid,R=[2,2];if(A.styles.wr.lineStyle==="dashed"?(B=vt.Dashed,R=[4,4]):A.styles.wr.lineStyle==="dotted"&&(B=vt.Dashed,R=[2,2]),s().createIndicator({name:"WR",calcParams:[A.period],styles:{lines:[{color:A.styles.wr.color,size:A.styles.wr.thickness,style:B,dashedValue:R}]}},!1,{id:k})){const q=`${k}_WR`;c.update(ve=>(ve.saveInds[q]={name:"WR",pane_id:k,params:[A.period]},ve))}}console.log("➕ Added new WR group in new pane:",A.id,k)}function rg(k){if(!i(Gd)||i(Ju).length<=1)return;const A=i(Ju).find(R=>R.id===k);if(!A)return;i(Ju).findIndex(R=>R.id===k);const B=A.paneId;x(Ju,V(i(Ju).filter(R=>R.id!==k))),B&&lx.deleteInstance(B),B&&du(B,"WR"),console.log("🗑️ Removed WR group from pane:",B)}function sp(k){if(!i(Gd)||!s()||k<0||k>=i(Ju).length)return;const A=i(Ju)[k],B=A.paneId||o().editPaneId;console.log("🔄 Updating WR indicator:",k,B);try{lx.updateInstance(B,{period:A.period,lineColor:A.styles.wr.color,lineThickness:A.styles.wr.thickness,lineStyle:A.styles.wr.lineStyle,enableDynamicColoring:!0,overboughtColor:A.styles.overbought.color||"#EF4444",oversoldColor:A.styles.oversold.color||"#10B981",overboughtThreshold:A.overboughtLevel,oversoldThreshold:A.oversoldLevel,levels:[{id:"overbought",value:A.overboughtLevel,color:A.styles.overbought.color||"#EF4444",lineStyle:A.styles.overbought.lineStyle,thickness:A.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:A.middleLevel,color:A.styles.middleLine.color||"#6B7280",lineStyle:A.styles.middleLine.lineStyle,thickness:A.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:A.oversoldLevel,color:A.styles.oversold.color||"#10B981",lineStyle:A.styles.oversold.lineStyle,thickness:A.styles.oversold.thickness,label:"Oversold",visible:!0}]}),s().removeIndicator({paneId:B,name:"WR"});let R=vt.Solid,U=[2,2];if(A.styles.wr.lineStyle==="dashed"?(R=vt.Dashed,U=[4,4]):A.styles.wr.lineStyle==="dotted"&&(R=vt.Dashed,U=[2,2]),s().createIndicator({name:"WR",calcParams:[A.period],styles:{lines:[{color:A.styles.wr.color,size:A.styles.wr.thickness,style:R,dashedValue:U}]}},B===o().editPaneId,{id:B})){const ve=`${B}_WR`;c.update(Re=>(Re.saveInds[ve]={name:"WR",pane_id:B,params:[A.period]},Re))}console.log("✅ WR indicator and levels updated successfully")}catch(R){console.error("❌ Error updating WR indicator:",R)}}function O0(){if(!i(tu))return;const k=Object.entries(r().saveInds).filter(([A,B])=>B.name==="VR");if(k.length>0)x(Dd,V(k.map(([A,B])=>{var R,U,q;return B.vrGroups&&B.vrGroups.length>0?B.vrGroups[0]:B.vrGroup?B.vrGroup:{id:Lr(),paneId:B.pane_id,period:((R=B.params)==null?void 0:R[0])||26,shortPeriod:((U=B.params)==null?void 0:U[1])||6,longPeriod:((q=B.params)==null?void 0:q[2])||12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}}}))),console.log("✅ Loaded VR groups from save system:",i(Dd).length);else if(i(Dd).length===0){const A={id:Lr(),paneId:o().editPaneId,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};x(Dd,V([A])),console.log("✅ Created default VR group with pane ID:",o().editPaneId)}}function Cg(){if(!i(Tu))return;const k=Object.entries(r().saveInds).filter(([A,B])=>B.name==="VOL");if(k.length>0)x(St,V(k.map(([A,B])=>{var R,U,q,ve,Re;if(B.volGroups&&B.volGroups.length>0){const rt=B.volGroups[0];return{...rt,paneId:"candle_pane",styles:{...rt.styles,ema:{visible:((U=(R=rt.styles)==null?void 0:R.ema)==null?void 0:U.visible)??!1,...rt.styles.ema}}}}else if(B.volGroup){const rt=B.volGroup;return{...rt,paneId:"candle_pane",styles:{...rt.styles,ema:{visible:((ve=(q=rt.styles)==null?void 0:q.ema)==null?void 0:ve.visible)??!1,...rt.styles.ema}}}}else return{id:Lr(),paneId:"candle_pane",period:((Re=B.params)==null?void 0:Re[0])||20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}}}))),console.log("✅ Loaded Volume groups from save system:",i(St).length);else if(i(St).length===0){const A={id:Lr(),paneId:"candle_pane",period:20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}};x(St,V([A])),console.log("✅ Created default Volume group:",A)}}function ne(){if(!i(tu))return;const k=`pane_VR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A={id:Lr(),paneId:k,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};if(i(Dd).push(A),s()){let B=vt.Solid,R=[2,2];if(A.styles.vr.lineStyle==="dashed"?(B=vt.Dashed,R=[4,4]):A.styles.vr.lineStyle==="dotted"&&(B=vt.Dashed,R=[2,2]),s().createIndicator({name:"VR",calcParams:[A.period,A.shortPeriod,A.longPeriod],styles:{lines:[{color:A.styles.vr.color,size:A.styles.vr.thickness,style:B,dashedValue:R}]}},!1,{id:k})){const q=`${k}_VR`;c.update(ve=>(ve.saveInds[q]={name:"VR",pane_id:k,params:[A.period,A.shortPeriod,A.longPeriod]},ve))}}console.log("➕ Added new VR group in new pane:",A.id,k)}function fe(k){if(!i(tu)||i(Dd).length<=1||k<0||k>=i(Dd).length)return;console.log("🗑️ Removing VR group at index:",k);const B=i(Dd)[k].paneId,R=i(Dd).length;if(i(Dd).splice(k,1),console.log(`📝 Removed group: ${R} -> ${i(Dd).length}`),s()&&B)try{console.log("🗑️ Removing VR from pane:",B),du(B,"VR")}catch(U){console.error("❌ Error removing VR indicator:",U)}console.log("✅ VR group removed. Remaining groups:",i(Dd).length),console.log("🗑️ Removed VR group from list (will be applied on confirm)")}function qe(k){if(!i(Tu)||i(St).length<=1||k<0||k>=i(St).length)return;console.log("🗑️ Removing Volume group at index:",k),i(St)[k];const A="candle_pane",B=i(St).length;if(i(St).splice(k,1),console.log(`📝 Removed group: ${B} -> ${i(St).length}`),s()&&A)try{console.log("🗑️ Removing Volume from pane:",A),du(A,"VOL")}catch(R){console.error("❌ Error removing Volume indicator:",R)}console.log("✅ Volume group removed. Remaining groups:",i(St).length),console.log("🗑️ Removed Volume group from list (will be applied on confirm)")}function ot(k){if(o().editIndName!=="VR"||!s()||k<0||k>=i(Dd).length)return;const A=i(Dd)[k],B=A.paneId||o().editPaneId;console.log("🔄 Updating VR indicator:",k,B);try{s().removeIndicator({paneId:B,name:"VR"});const R=rt=>{switch(rt){case"dashed":return{style:vt.Dashed,dashedValue:[4,4]};case"dotted":return{style:vt.Dashed,dashedValue:[2,2]};default:return{style:vt.Solid,dashedValue:[2,2]}}},U=R(A.styles.vr.lineStyle),q=R(A.styles.vrShort.lineStyle),ve=R(A.styles.vrLong.lineStyle);if(s().createIndicator({name:"VR",calcParams:[A.period,A.shortPeriod,A.longPeriod],styles:{lines:[{color:A.styles.vr.color,size:A.styles.vr.thickness,style:U.style,dashedValue:U.dashedValue},{color:A.styles.vrShort.color,size:A.styles.vrShort.thickness,style:q.style,dashedValue:q.dashedValue},{color:A.styles.vrLong.color,size:A.styles.vrLong.thickness,style:ve.style,dashedValue:ve.dashedValue}]}},B===o().editPaneId,{id:B})){const rt=`${B}_VR`;c.update(Ut=>(Ut.saveInds[rt]={name:"VR",pane_id:B,params:[A.period,A.shortPeriod,A.longPeriod]},Ut))}console.log("✅ VR indicator updated successfully")}catch(R){console.error("❌ Error updating VR indicator:",R)}}function Wt(k){if(o().editIndName!=="VOL"||!s()||k<0||k>=i(St).length)return;const A=i(St)[k],B="candle_pane";try{console.log("🔄 Updating Volume indicator for group:",k,"paneId:",B),s().removeIndicator({paneId:B,name:"VOL"});let R=vt.Solid,U=[2,2];if(A.styles.ema.lineStyle==="dashed"?(R=vt.Dashed,U=[4,4]):A.styles.ema.lineStyle==="dotted"&&(R=vt.Dashed,U=[2,2]),console.log("updateVolIndicator - Colors being applied:",{upColor:A.styles.histogram.upColor,downColor:A.styles.histogram.downColor,noChangeColor:A.styles.histogram.upColor,emaColor:A.styles.ema.color}),s().createIndicator({name:"VOL",calcParams:[A.period],styles:{bars:[{upColor:A.styles.histogram.upColor,downColor:A.styles.histogram.downColor,noChangeColor:A.styles.histogram.upColor}],lines:[{color:A.styles.ema.color,size:A.styles.ema.thickness,style:R,dashedValue:U}]}},!0,{id:B})){const ve=`${B}_VOL`;c.update(Re=>(Re.saveInds[ve]={name:"VOL",pane_id:B,params:[A.period],volGroup:A},Re))}console.log("✅ Volume indicator updated successfully")}catch(R){console.error("❌ Error updating Volume indicator:",R)}}function Ct(k){if(o().editIndName!=="BBI"||!s()||k<0||k>=i(Rd).length)return;const A=i(Rd)[k],B=A.paneId||o().editPaneId;console.log("🔄 Updating BBI indicator:",k,B);try{s().removeIndicator({paneId:B,name:"BBI"});const U=(ve=>{switch(ve){case"dashed":return{style:vt.Dashed,dashedValue:[4,4]};case"dotted":return{style:vt.Dashed,dashedValue:[2,2]};default:return{style:vt.Solid,dashedValue:[2,2]}}})(A.lineStyle);if(s().createIndicator({name:"BBI",calcParams:[A.period1,A.period2,A.period3,A.period4],styles:{lines:[{color:A.color,size:A.thickness,style:U.style,dashedValue:U.dashedValue}]}},B===o().editPaneId,{id:B})){const ve=`${B}_BBI`;c.update(Re=>(Re.saveInds[ve]={name:"BBI",pane_id:B,params:[A.period1,A.period2,A.period3,A.period4],bbiGroup:A},Re))}console.log("✅ BBI indicator updated successfully")}catch(R){console.error("❌ Error updating BBI indicator:",R)}}function un(){if(!(o().editIndName!=="EMA"||!s()))try{console.log("🔄 Updating EMA indicator"),s().removeIndicator({paneId:o().editPaneId,name:"EMA"});const k=s().createIndicator({name:"EMA",calcParams:u,styles:{lines:u.map((A,B)=>{const R=h[B];let U=vt.Solid,q=[2,2];return(R==null?void 0:R.lineStyle)==="dashed"?(U=vt.Dashed,q=[4,4]):(R==null?void 0:R.lineStyle)==="dotted"&&(U=vt.Dashed,q=[2,2]),{color:(R==null?void 0:R.color)||"#FF6B6B",size:(R==null?void 0:R.thickness)||1,style:U,dashedValue:q}})}},!0,{id:o().editPaneId});console.log("✅ EMA indicator updated successfully")}catch(k){console.error("❌ Error updating EMA indicator:",k)}}function Ln(){if(!(o().editIndName!=="MA"||!s()))try{console.log("🔄 Updating MA indicator"),s().removeIndicator({paneId:o().editPaneId,name:"MA"});const k=s().createIndicator({name:"MA",calcParams:u,styles:{lines:u.map((B,R)=>{const U=h[R];let q=vt.Solid,ve=[2,2];return(U==null?void 0:U.lineStyle)==="dashed"?(q=vt.Dashed,ve=[4,4]):(U==null?void 0:U.lineStyle)==="dotted"&&(q=vt.Dashed,ve=[2,2]),{color:(U==null?void 0:U.color)||"#2563eb",size:(U==null?void 0:U.thickness)||1,style:q,dashedValue:ve}})}},!0,{id:o().editPaneId}),A=`${o().editPaneId}_MA`;c.update(B=>(B.saveInds[A]&&(B.saveInds[A].params=[...u],B.saveInds[A].styles=h.map(R=>({...R}))),B)),console.log("✅ MA indicator updated successfully")}catch(k){console.error("❌ Error updating MA indicator:",k)}}function Un(){var B,R,U;if(!i(Md))return;const k=`${o().editPaneId}_SMA`,A=r().saveInds[k];A&&A.smaGroups&&A.smaGroups.length>0?(x(Wi,V([...A.smaGroups])),console.log("✅ Loaded",i(Wi).length,"SMA groups from saved data")):A&&A.params&&A.params.length>0&&A.styles?(x(Wi,V([{id:Lr(),name:"SMA",period:A.params[0]||20,color:((B=A.styles[0])==null?void 0:B.color)||"#FF6C37",thickness:((R=A.styles[0])==null?void 0:R.thickness)||2,lineStyle:((U=A.styles[0])==null?void 0:U.lineStyle)||"solid"}])),console.log("✅ Loaded SMA from saved data (old format)")):i(Wi).length===0&&(x(Wi,V([{id:Lr(),name:"SMA",period:20,color:"#FF6C37",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default SMA group"))}function Ws(k){var A,B;if(!(o().editIndName!=="SMA"||!s()||i(Wi).length===0||k>=i(Wi).length))try{console.log("🔄 Updating SMA indicator at index:",k);const R=i(Wi)[k],q=((A=s())==null?void 0:A.getIndicators()).filter(Re=>Re.name==="SMA");for(const Re of q)(B=s())==null||B.removeIndicator({paneId:Re.paneId,name:"SMA"});i(Wi).forEach((Re,rt)=>{var ns;let Ut=vt.Solid,ls=[2,2];Re.lineStyle==="dashed"?(Ut=vt.Dashed,ls=[8,4]):Re.lineStyle==="dotted"&&(Ut=vt.Dashed,ls=[2,2]),(ns=s())==null||ns.createIndicator({name:"SMA",calcParams:[Re.period],styles:{lines:[{color:Re.color,size:Re.thickness,style:Ut,dashedValue:ls}]}},!0,{id:o().editPaneId})});const ve=`${o().editPaneId}_SMA`;c.update(Re=>(Re.saveInds[ve]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Wi).map(rt=>({...rt}))},Re)),console.log("✅ SMA indicators updated successfully")}catch(R){console.error("❌ Error updating SMA indicator:",R)}}function bo(){if(!i(Md))return;const k=i(Wi).length>0?i(Wi)[i(Wi).length-1].period+10:20,A=["#FF6C37","#2563eb","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],B=A[i(Wi).length%A.length],R={id:Lr(),name:"SMA",period:k,color:B,thickness:2,lineStyle:"solid"};if(i(Wi).push(R),s()){s().createIndicator({name:"SMA",calcParams:[R.period],styles:{lines:[{color:R.color,size:R.thickness,style:vt.Solid,dashedValue:[2,2]}]}},!0,{id:o().editPaneId});const U=`${o().editPaneId}_SMA`;c.update(q=>(q.saveInds[U]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Wi).map(ve=>({...ve}))},q))}console.log("➕ Added new SMA group:",R)}function Ts(k){var A,B;if(!(!i(Md)||i(Wi).length<=1||k<0||k>=i(Wi).length)&&(console.log("🗑️ Removing SMA group at index:",k),i(Wi).splice(k,1),s()))try{const U=((A=s())==null?void 0:A.getIndicators()).filter(ve=>ve.name==="SMA");for(const ve of U)(B=s())==null||B.removeIndicator({paneId:ve.paneId,name:"SMA"});i(Wi).forEach(ve=>{var Ut;let Re=vt.Solid,rt=[2,2];ve.lineStyle==="dashed"?(Re=vt.Dashed,rt=[8,4]):ve.lineStyle==="dotted"&&(Re=vt.Dashed,rt=[2,2]),(Ut=s())==null||Ut.createIndicator({name:"SMA",calcParams:[ve.period],styles:{lines:[{color:ve.color,size:ve.thickness,style:Re,dashedValue:rt}]}},!0,{id:o().editPaneId})});const q=`${o().editPaneId}_SMA`;c.update(ve=>(i(Wi).length>0?ve.saveInds[q]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Wi).map(Re=>({...Re}))}:delete ve.saveInds[q],ve)),console.log("✅ SMA group removed and chart updated")}catch(R){console.error("❌ Error removing SMA group:",R)}}function Oo(){var k,A;if(i(Md)){console.log("🔧 SMA Confirm: Saving",i(Wi).length,"SMA groups");try{const B=(k=s())==null?void 0:k.getIndicators(),R=(B==null?void 0:B.filter(q=>q.name==="SMA"))||[];for(const q of R)(A=s())==null||A.removeIndicator({paneId:q.paneId,name:"SMA"});i(Wi).forEach(q=>{var rt;let ve=vt.Solid,Re=[2,2];q.lineStyle==="dashed"?(ve=vt.Dashed,Re=[8,4]):q.lineStyle==="dotted"&&(ve=vt.Dashed,Re=[2,2]),(rt=s())==null||rt.createIndicator({name:"SMA",calcParams:[q.period],styles:{lines:[{color:q.color,size:q.thickness,style:ve,dashedValue:Re}]}},!0,{id:o().editPaneId}),console.log("✅ Created SMA with period:",q.period)});const U=`${o().editPaneId}_SMA`;c.update(q=>(q.saveInds[U]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Wi).map(ve=>({...ve}))},console.log("💾 Saved",i(Wi).length,"SMA groups to:",U),q)),console.log("✅ SMA confirm completed successfully"),l.update(q=>(q.editIndName="",q.editPaneId="",q.modalIndCfg=!1,q))}catch(B){console.error("❌ Error in SMA confirm:",B)}}}function _i(){if(!i(Vc))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="BBI").sort((A,B)=>A===`${o().editPaneId}_BBI`?-1:B===`${o().editPaneId}_BBI`?1:A.localeCompare(B));console.log("🔍 Found existing BBI keys:",k),k.length>0?(x(Rd,V([])),k.forEach((A,B)=>{const R=r().saveInds[A];if(R){const U=R.pane_id||A.replace("_BBI","");if(R.bbiGroup){const q={...R.bbiGroup};q.paneId||(q.paneId=U),i(Rd).push(q)}else R.params&&R.params.length===4&&i(Rd).push({id:Lr(),name:`BBI${B+1}`,paneId:U,period1:R.params[0]||3,period2:R.params[1]||6,period3:R.params[2]||12,period4:R.params[3]||24,color:"#8B5CF6",thickness:1,lineStyle:"solid"})}}),console.log("✅ Loaded",i(Rd).length,"existing BBI groups")):i(Rd).length===0&&(x(Rd,V([{id:Lr(),name:"BBI",paneId:o().editPaneId,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BBI group"))}function to(){if(!i(Vc))return;const k=`pane_BBI_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A=i(Rd).length+1,B={id:Lr(),name:`BBI${A}`,paneId:k,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"};if(i(Rd).push(B),s()){const U=(ve=>{switch(ve){case"dashed":return{style:vt.Dashed,dashedValue:[4,4]};case"dotted":return{style:vt.Dashed,dashedValue:[2,2]};default:return{style:vt.Solid,dashedValue:[2,2]}}})(B.lineStyle);if(s().createIndicator({name:"BBI",calcParams:[B.period1,B.period2,B.period3,B.period4],styles:{lines:[{color:B.color,size:B.thickness,style:U.style,dashedValue:U.dashedValue}]}},!1,{id:k})){const ve=`${k}_BBI`;c.update(Re=>(Re.saveInds[ve]={name:"BBI",pane_id:k,params:[B.period1,B.period2,B.period3,B.period4],bbiGroup:B},Re))}}console.log("➕ Added new BBI group in new pane:",B.id,k)}function Ha(k){var U;if(!i(Vc)||i(Rd).length<=1)return;const A=i(Rd).findIndex(q=>q.id===k);if(A===-1)return;const B=i(Rd)[A];console.log("🗑️ Removing BBI group at index:",A,"ID:",k,"paneId:",B.paneId);const R=B.paneId||(A===0?o().editPaneId:null);if(s()&&R){try{console.log("🗑️ Removing BBI from pane:",R),(U=s())==null||U.removeIndicator({paneId:R,name:"BBI"}),console.log("✅ Successfully removed BBI from pane:",R)}catch(q){console.log("❌ Error removing BBI indicator from pane:",R,q)}c.update(q=>{const ve=`${R}_BBI`;return console.log("🧹 Cleaning saved state key:",ve),delete q.saveInds[ve],q})}else console.log("❌ Cannot remove BBI: no valid paneId found for group:",B);x(Rd,V(i(Rd).filter(q=>q.id!==k))),console.log("✅ BBI group removed from array. Remaining groups:",i(Rd).length)}function Ta(){if(!i(qu))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="TRIX").sort((A,B)=>A===`${o().editPaneId}_TRIX`?-1:B===`${o().editPaneId}_TRIX`?1:A.localeCompare(B));console.log("🔍 Found existing TRIX keys:",k),k.length>0?(x(fu,V([])),k.forEach((A,B)=>{const R=r().saveInds[A];if(R)if(R.trixGroup){const U={...R.trixGroup};U.paneId||(U.paneId=R.pane_id||o().editPaneId),i(fu).push(U)}else R.params&&R.params.length>=2&&i(fu).push({id:Lr(),name:`TRIX${B+1}`,trixPeriod:R.params[0]||15,signalPeriod:R.params[1]||9,paneId:R.pane_id||o().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",i(fu).length,"existing TRIX groups")):i(fu).length===0&&(x(fu,V([{id:Lr(),name:"TRIX",trixPeriod:15,signalPeriod:9,paneId:o().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default TRIX group"))}function dl(){if(!i(qu))return;const k=`pane_TRIX_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A={id:Lr(),name:`TRIX${i(fu).length+1}`,trixPeriod:15,signalPeriod:9,paneId:k,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}};if(i(fu).push(A),s()){let B=vt.Solid,R=[2,2],U=vt.Solid,q=[2,2];if(A.styles.trix.lineStyle==="dashed"?(B=vt.Dashed,R=[4,4]):A.styles.trix.lineStyle==="dotted"&&(B=vt.Dashed,R=[2,2]),A.styles.signal.lineStyle==="dashed"?(U=vt.Dashed,q=[4,4]):A.styles.signal.lineStyle==="dotted"&&(U=vt.Dashed,q=[2,2]),s().createIndicator({name:"TRIX",calcParams:[A.trixPeriod,A.signalPeriod],styles:{lines:[{color:A.styles.trix.color,size:A.styles.trix.thickness,style:B,dashedValue:R},{color:A.styles.signal.color,size:A.styles.signal.thickness,style:U,dashedValue:q}]}},!1,{id:k})){const Re=`${k}_TRIX`;c.update(rt=>(rt.saveInds[Re]={name:"TRIX",pane_id:k,params:[A.trixPeriod,A.signalPeriod]},rt))}}console.log("➕ Added new TRIX group in new pane:",A.id,k)}function yl(k){if(!i(qu)||i(fu).length<=1||k<0||k>=i(fu).length)return;console.log("🗑️ Removing TRIX group at index:",k);const B=i(fu)[k].paneId||o().editPaneId,R=i(fu).length;if(i(fu).splice(k,1),console.log(`📝 Removed group: ${R} -> ${i(fu).length}`),s()&&B)try{console.log("🗑️ Removing TRIX from pane:",B),du(B,"TRIX")}catch(U){console.error("❌ Error removing TRIX indicator:",U)}console.log("✅ TRIX group removed. Remaining groups:",i(fu).length)}function Ml(){if(!i(td))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="BIAS").sort((A,B)=>A===`${o().editPaneId}_BIAS`?-1:B===`${o().editPaneId}_BIAS`?1:A.localeCompare(B));console.log("🔍 Found existing BIAS keys:",k),k.length>0?(x(so,V([])),k.forEach((A,B)=>{const R=r().saveInds[A];R&&(R.biasGroup?i(so).push({...R.biasGroup}):R.params&&R.params.length>=1&&i(so).push({id:Lr(),name:`BIAS${B+1}`,period:R.params[0]||6,color:"#2196F3",thickness:1,lineStyle:"solid"}))}),console.log("✅ Loaded",i(so).length,"existing BIAS groups")):i(so).length===0&&(x(so,V([{id:Lr(),name:"BIAS",period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BIAS group"))}function Gl(){var B;if(!i(td)||!s())return;console.log("🔄 Applying BIAS changes in real-time, groups:",i(so).length);const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="BIAS").sort((R,U)=>R===`${o().editPaneId}_BIAS`?-1:U===`${o().editPaneId}_BIAS`?1:R.localeCompare(U));console.log("🔍 Existing BIAS keys:",k);const A=i(so).length;if(k.length>A){console.log(`🗑️ Removing ${k.length-A} excess BIAS indicators`);for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];if(q&&q.pane_id){console.log("🗑️ Removing BIAS indicator from pane:",q.pane_id);try{(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"BIAS"})}catch(ve){console.log("Error removing excess BIAS indicator:",ve)}}}}i(so).forEach((R,U)=>{var Re,rt,Ut;const q=[R.period],ve={lines:[{color:R.color,size:R.thickness,style:R.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:R.lineStyle==="dashed"?[4,4]:R.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(U===0)console.log("🔄 Updating first BIAS indicator in pane:",o().editPaneId),(Re=s())==null||Re.overrideIndicator({name:"BIAS",calcParams:q,styles:ve,paneId:o().editPaneId});else{const ls=`pane_BIAS_${U+1}_BIAS`,ns=k.find(Mn=>Mn===ls);if(ns){const Mn=r().saveInds[ns];Mn&&Mn.pane_id&&(console.log(`🔄 Updating existing BIAS ${U+1} in pane:`,Mn.pane_id),(rt=s())==null||rt.overrideIndicator({name:"BIAS",calcParams:q,styles:ve,paneId:Mn.pane_id}))}else{const Mn=`pane_BIAS_${U+1}`;console.log(`🆕 Creating new BIAS ${U+1} with pane ID:`,Mn),(Ut=s())==null||Ut.createIndicator({name:"BIAS",calcParams:q,styles:ve},!0,{id:Mn})}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="BIAS"&&delete R.saveInds[U]}),i(so).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_BIAS`:`pane_BIAS_${q+1}_BIAS`,Re=q===0?o().editPaneId:`pane_BIAS_${q+1}`;console.log(`💾 Saving BIAS group ${q+1} with key:`,ve),R.saveInds[ve]={name:"BIAS",biasGroup:U,pane_id:Re,groupIndex:q,biasGroups:q===0?[...i(so)]:void 0,params:[U.period]}}),R))}function wd(k){if(!i(td)||i(so).length<=1)return;const A=i(so).findIndex(B=>B.id===k);A!==-1&&(console.log("🗑️ Removing BIAS group at index:",A,"ID:",k),x(so,V(i(so).filter(B=>B.id!==k))),Gl(),console.log("✅ BIAS group removed. Remaining groups:",i(so).length))}function fc(){if(!i(ke))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="CCI").sort((A,B)=>A===`${o().editPaneId}_CCI`?-1:B===`${o().editPaneId}_CCI`?1:A.localeCompare(B));if(console.log("🔍 Found existing CCI keys:",k),k.length>0){x(mo,V([]));let A=1;k.forEach((B,R)=>{const U=r().saveInds[B];if(U)if(U.cciGroup){const q={...U.cciGroup};q.name=A===1?"CCI":`CCI${A}`,i(mo).push(q),A+=1}else U.params&&U.params.length>=1&&(i(mo).push({id:Lr(),name:A===1?"CCI":`CCI${A}`,period:U.params[0]||14,color:"#FF9800",thickness:1,lineStyle:"solid"}),A+=1)}),console.log("✅ Loaded",i(mo).length,"existing CCI groups with proper naming")}else i(mo).length===0&&(x(mo,V([{id:Lr(),name:"CCI",period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default CCI group"))}function md(){if(!i(ke)||!s())return;console.log("🔄 Applying CCI changes in real-time, groups:",i(mo).length);const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="CCI").sort((q,ve)=>q===`${o().editPaneId}_CCI`?-1:ve===`${o().editPaneId}_CCI`?1:q.localeCompare(ve));console.log("🔍 Existing CCI keys:",k);const A=new Map,B=new Set;i(mo).forEach((q,ve)=>{let Re=null;for(const rt of k){if(B.has(rt))continue;const Ut=r().saveInds[rt];if(Ut&&Ut.cciGroup&&Ut.cciGroup.id===q.id){Re=rt,B.add(rt);break}}if(!Re){if(ve===0&&!B.has(`${o().editPaneId}_CCI`))Re=`${o().editPaneId}_CCI`;else{let rt=2;for(;B.has(`pane_CCI_${rt}_CCI`)||k.includes(`pane_CCI_${rt}_CCI`);)rt+=1;Re=`pane_CCI_${rt}_CCI`}B.add(Re)}A.set(q.id,Re)});const R=Array.from(A.values()),U=k.filter(q=>!R.includes(q));U.forEach(q=>{var Re;const ve=r().saveInds[q];if(ve&&ve.pane_id){console.log("🗑️ Removing CCI indicator from pane:",ve.pane_id,"key:",q);try{(Re=s())==null||Re.removeIndicator({paneId:ve.pane_id,name:"CCI"})}catch(rt){console.log("Error removing excess CCI indicator:",rt)}}}),i(mo).forEach((q,ve)=>{var ns,Mn;const Re=[q.period],rt=A.get(q.id),Ut={lines:[{color:q.color,size:q.thickness,style:q.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.lineStyle==="dashed"?[4,4]:q.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},ls=k.includes(rt)?r().saveInds[rt]:null;if(ls&&ls.pane_id)console.log("🔄 Updating existing CCI in pane:",ls.pane_id),(ns=s())==null||ns.overrideIndicator({name:"CCI",calcParams:Re,styles:Ut,paneId:ls.pane_id});else{const qo=rt===`${o().editPaneId}_CCI`?o().editPaneId:rt.replace("_CCI","");console.log("🆕 Creating new CCI with pane ID:",qo,"key:",rt),(Mn=s())==null||Mn.createIndicator({name:"CCI",calcParams:Re,styles:Ut},!0,{id:qo})}}),c.update(q=>(U.forEach(ve=>{delete q.saveInds[ve],console.log("🗑️ Deleted save data for key:",ve)}),i(mo).forEach((ve,Re)=>{const rt=A.get(ve.id),Ut=rt===`${o().editPaneId}_CCI`?o().editPaneId:rt.replace("_CCI","");console.log(`💾 Saving CCI group ${Re+1} with key:`,rt),q.saveInds[rt]={name:"CCI",cciGroup:ve,pane_id:Ut,groupIndex:Re,cciGroups:Re===0?[...i(mo)]:void 0,params:[ve.period]}}),q))}function Yp(k){if(!i(ke)||i(mo).length<=1)return;const A=i(mo).findIndex(B=>B.id===k);A!==-1&&(console.log("🗑️ Removing CCI group at index:",A,"ID:",k),x(mo,V(i(mo).filter(B=>B.id!==k))),md(),console.log("✅ CCI group removed. Remaining groups:",i(mo).length))}function xu(){if(!i(bd))return;const A=Object.values(r().saveInds||{}).filter(B=>(B==null?void 0:B.name)==="SAR").filter(B=>(B==null?void 0:B.pane_id)==="candle_pane");if(A.length>0){const B=A[0];B.sarGroups&&Array.isArray(B.sarGroups)&&B.sarGroups.length>0?x(_c,V([...B.sarGroups])):x(_c,V(A.map(R=>{const[U=.02,q=.02,ve=.2]=R.params||[];return{id:Lr(),start:U,increment:q,maxValue:ve,color:"#2563eb",dotSize:1}})))}else x(_c,V([{id:Lr(),start:.02,increment:.02,maxValue:.2,color:"#2563eb",dotSize:1}]));s()&&i(_c).length>0&&go()}function Xd(k){!i(bd)||i(_c).length<=1||(x(_c,V(i(_c).filter(A=>A.id!==k))),go())}function vo(k){!i(bd)||!s()||k>=i(_c).length||go()}function go(){if(!s()||!i(bd))return;const k="candle_pane";for(let A=0;A<6;(A+=1)-1)try{s().removeIndicator({paneId:k,name:"SAR"})}catch{}i(_c).forEach(A=>{var U;const B=[A.start,A.increment,A.maxValue],R={lines:[{color:A.color,size:A.dotSize,style:vt.Solid}]};(U=s())==null||U.createIndicator({name:"SAR",calcParams:B,styles:R},!0,{id:k})})}function yi(){if(!i(Nt))return;const k=`${o().editPaneId}_SMARTTREND`,A=r().saveInds[k];if(A&&A.superTrendGroups&&A.superTrendGroups.length>0)x(gu,V([...A.superTrendGroups]));else if(A&&Array.isArray(A.params)){const B=Number(A.params[0]??10),R=Number(A.params[1]??3);x(gu,V([{id:Lr(),period:B,multiplier:R,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]))}else i(gu).length===0&&x(gu,V([{id:Lr(),period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]));Eu()}function Jr(k){!i(Nt)||i(gu).length<=1||(x(gu,V(i(gu).filter(A=>A.id!==k))),Eu())}function Yl(k){!i(Nt)||!s()||k>=i(gu).length||(i(gu)[k],Eu())}function Eu(){if(!s()||!i(Nt))return;const k="candle_pane";for(let A=0;A<6;(A+=1)-1)try{s().removeIndicator({paneId:k,name:"SMARTTREND"})}catch{}i(gu).forEach((A,B)=>{var q;const R=[A.period,A.multiplier],U={lines:[{color:A.styles.uptrend.color,size:A.styles.uptrend.thickness,style:A.styles.uptrend.lineStyle==="dashed"?vt.Dashed:vt.Solid}]};(q=s())==null||q.createIndicator({name:"SMARTTREND",calcParams:R,styles:U,extendData:{showLabels:A.showLabels,uptrendColor:A.styles.uptrend.color,downtrendColor:A.styles.downtrend.color,uptrendThickness:A.styles.uptrend.thickness,downtrendThickness:A.styles.downtrend.thickness,uptrendLineStyle:A.styles.uptrend.lineStyle,downtrendLineStyle:A.styles.downtrend.lineStyle}},!0,{id:k})}),c.update(A=>(Object.keys(A.saveInds).forEach(B=>{A.saveInds[B].name==="SMARTTREND"&&delete A.saveInds[B]}),i(gu).forEach((B,R)=>{const U=R===0?`${k}_SMARTTREND`:`${k}_SMARTTREND_${R+1}`;A.saveInds[U]={name:"SMARTTREND",pane_id:k,params:[B.period,B.multiplier],superTrendGroup:B,groupIndex:R}}),A))}function nd(){if(!i(gc))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="DMI").sort((A,B)=>A===`${o().editPaneId}_DMI`?-1:B===`${o().editPaneId}_DMI`?1:A.localeCompare(B));if(console.log("🔍 Found existing DMI keys:",k),k.length>0){x(El,V([]));let A=1;k.forEach((B,R)=>{const U=r().saveInds[B];if(U.dmiGroup){const q={...U.dmiGroup};q.name=A===1?"DMI":`DMI${A}`,i(El).push(q),A+=1}else U.params&&U.params.length>=2&&(i(El).push({id:Lr(),name:A===1?"DMI":`DMI${A}`,diPeriod:U.params[0]||14,adxPeriod:U.params[1]||6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),A+=1)}),console.log("✅ Loaded",i(El).length,"existing DMI groups with proper naming")}else i(El).length===0&&(x(El,V([{id:Lr(),name:"DMI",diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default DMI group"))}function dp(){if(!i(we))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="CR").sort((A,B)=>A===`${o().editPaneId}_CR`?-1:B===`${o().editPaneId}_CR`?1:A.localeCompare(B));console.log("🔍 Found existing CR keys:",k),k.length>0?(x(Cr,V([])),k.forEach((A,B)=>{var U,q,ve,Re,rt;const R=r().saveInds[A];R.crGroup?i(Cr).push({...R.crGroup}):i(Cr).push({id:Lr(),name:`CR${B+1}`,crPeriod:((U=R.params)==null?void 0:U[0])||26,crMa1Period:((q=R.params)==null?void 0:q[1])||10,crMa2Period:((ve=R.params)==null?void 0:ve[2])||20,crMa3Period:((Re=R.params)==null?void 0:Re[3])||40,crMa4Period:((rt=R.params)==null?void 0:rt[4])||60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",i(Cr).length,"existing CR groups")):i(Cr).length===0&&(x(Cr,V([{id:Lr(),name:"CR",crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default CR group"))}function Ic(){if(!i(gc)||!s())return;console.log("🔄 Applying DMI changes in real-time, groups:",i(El).length);const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="DMI").sort((q,ve)=>q===`${o().editPaneId}_DMI`?-1:ve===`${o().editPaneId}_DMI`?1:q.localeCompare(ve));console.log("🔍 Existing DMI keys:",k);const A=new Map,B=new Set;i(El).forEach((q,ve)=>{for(const Re of k){if(B.has(Re))continue;const rt=r().saveInds[Re];if(rt&&rt.dmiGroup&&rt.dmiGroup.id===q.id){A.set(q.id,Re),B.add(Re),console.log(`✅ Matched group ${ve+1} (ID: ${q.id}) to existing key: ${Re}`);break}}}),i(El).forEach((q,ve)=>{if(A.has(q.id))return;let Re=null;if(ve===0&&!B.has(`${o().editPaneId}_DMI`)&&!k.includes(`${o().editPaneId}_DMI`))Re=`${o().editPaneId}_DMI`;else{let rt=2;for(;B.has(`pane_DMI_${rt}_DMI`)||k.includes(`pane_DMI_${rt}_DMI`);)rt+=1;Re=`pane_DMI_${rt}_DMI`}A.set(q.id,Re),B.add(Re),console.log(`🆕 Assigned new key for group ${ve+1} (ID: ${q.id}): ${Re}`)});const R=Array.from(A.values()),U=k.filter(q=>!R.includes(q));U.forEach(q=>{var Re;const ve=r().saveInds[q];if(ve&&ve.pane_id){console.log("🗑️ Removing DMI indicator from pane:",ve.pane_id,"key:",q);try{(Re=s())==null||Re.removeIndicator({paneId:ve.pane_id,name:"DMI"})}catch(rt){console.log("Error removing excess DMI indicator:",rt)}}}),i(El).forEach((q,ve)=>{var qo,Yo,Nc,jd;const Re=[q.diPeriod,q.adxPeriod],rt=A.get(q.id),Ut=ve===0?o().editPaneId:`pane_DMI_${ve+1}`;console.log(`📍 Group ${ve+1} (ID: ${q.id}) -> Target pane: ${Ut}, Save key: ${rt}`);const ls={lines:[{color:q.styles.diPlus.color,size:q.styles.diPlus.thickness,style:q.styles.diPlus.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.diPlus.lineStyle==="dashed"?[4,4]:q.styles.diPlus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.diMinus.color,size:q.styles.diMinus.thickness,style:q.styles.diMinus.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.diMinus.lineStyle==="dashed"?[4,4]:q.styles.diMinus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.adx.color,size:q.styles.adx.thickness,style:q.styles.adx.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.adx.lineStyle==="dashed"?[4,4]:q.styles.adx.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},ns=k.includes(rt)?r().saveInds[rt]:null,Mn=ns==null?void 0:ns.pane_id;if(Mn&&Mn!==Ut){console.log(`🔀 Moving DMI from pane ${Mn} to ${Ut}`);try{(qo=s())==null||qo.removeIndicator({paneId:Mn,name:"DMI"})}catch(cf){console.log("Note: Indicator may not exist in old pane:",cf)}(Yo=s())==null||Yo.createIndicator({name:"DMI",calcParams:Re,styles:ls},!0,{id:Ut})}else Mn?(console.log(`🔄 Updating existing DMI in pane: ${Ut}`),(Nc=s())==null||Nc.overrideIndicator({name:"DMI",calcParams:Re,styles:ls,paneId:Ut})):(console.log(`🆕 Creating new DMI in pane: ${Ut}`),(jd=s())==null||jd.createIndicator({name:"DMI",calcParams:Re,styles:ls},!0,{id:Ut}))}),c.update(q=>(U.forEach(ve=>{delete q.saveInds[ve],console.log("🗑️ Deleted save data for key:",ve)}),i(El).forEach((ve,Re)=>{const rt=A.get(ve.id),Ut=Re===0?o().editPaneId:`pane_DMI_${Re+1}`;console.log(`💾 Saving DMI group ${Re+1} with key: ${rt}, pane: ${Ut}`),q.saveInds[rt]={name:"DMI",dmiGroup:ve,pane_id:Ut,groupIndex:Re,dmiGroups:Re===0?[...i(El)]:void 0,params:[ve.diPeriod,ve.adxPeriod]}}),q))}function zp(k){if(!i(gc)||i(El).length<=1)return;const A=i(El).findIndex(B=>B.id===k);A!==-1&&(console.log("🗑️ Removing DMI group at index:",A,"ID:",k),x(El,V(i(El).filter(B=>B.id!==k))),Ic(),console.log("✅ DMI group removed. Remaining groups:",i(El).length))}function nu(){if(!i(we)||!s())return;console.log("🔄 Applying CR changes in real-time, groups:",i(Cr).length);const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="CR").sort((q,ve)=>q===`${o().editPaneId}_CR`?-1:ve===`${o().editPaneId}_CR`?1:q.localeCompare(ve));console.log("🔍 Existing CR keys:",k);const A=new Map,B=new Set;i(Cr).forEach((q,ve)=>{let Re=null;for(const rt of k){if(B.has(rt))continue;const Ut=r().saveInds[rt];if(Ut&&Ut.crGroup&&Ut.crGroup.id===q.id){Re=rt,B.add(rt);break}}if(!Re){if(ve===0&&!B.has(`${o().editPaneId}_CR`))Re=`${o().editPaneId}_CR`;else{let rt=2;for(;B.has(`pane_CR_${rt}_CR`)||k.includes(`pane_CR_${rt}_CR`);)rt+=1;Re=`pane_CR_${rt}_CR`}B.add(Re)}A.set(q.id,Re)});const R=Array.from(A.values()),U=k.filter(q=>!R.includes(q));U.forEach(q=>{var Re;const ve=r().saveInds[q];if(ve&&ve.pane_id){console.log("🗑️ Removing CR indicator from pane:",ve.pane_id,"key:",q);try{(Re=s())==null||Re.removeIndicator({paneId:ve.pane_id,name:"CR"})}catch(rt){console.log("Error removing excess CR indicator:",rt)}}}),i(Cr).forEach((q,ve)=>{var ns,Mn;const Re=[q.crPeriod,q.crMa1Period,q.crMa2Period,q.crMa3Period,q.crMa4Period],rt=A.get(q.id),Ut={lines:[{color:q.styles.cr.color,size:q.styles.cr.thickness,style:q.styles.cr.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.cr.lineStyle==="dashed"?[4,4]:q.styles.cr.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma1.color,size:q.styles.ma1.thickness,style:q.styles.ma1.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.ma1.lineStyle==="dashed"?[4,4]:q.styles.ma1.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma2.color,size:q.styles.ma2.thickness,style:q.styles.ma2.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.ma2.lineStyle==="dashed"?[4,4]:q.styles.ma2.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma3.color,size:q.styles.ma3.thickness,style:q.styles.ma3.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.ma3.lineStyle==="dashed"?[4,4]:q.styles.ma3.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma4.color,size:q.styles.ma4.thickness,style:q.styles.ma4.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.styles.ma4.lineStyle==="dashed"?[4,4]:q.styles.ma4.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},ls=k.includes(rt)?r().saveInds[rt]:null;if(ls&&ls.pane_id)console.log("🔄 Updating existing CR in pane:",ls.pane_id),(ns=s())==null||ns.overrideIndicator({name:"CR",calcParams:Re,styles:Ut,paneId:ls.pane_id});else{const qo=rt===`${o().editPaneId}_CR`?o().editPaneId:rt.replace("_CR","");console.log("🆕 Creating new CR with pane ID:",qo,"key:",rt),(Mn=s())==null||Mn.createIndicator({name:"CR",calcParams:Re,styles:Ut},!0,{id:qo})}}),c.update(q=>(U.forEach(ve=>{delete q.saveInds[ve],console.log("🗑️ Deleted save data for key:",ve)}),i(Cr).forEach((ve,Re)=>{const rt=A.get(ve.id),Ut=rt===`${o().editPaneId}_CR`?o().editPaneId:rt.replace("_CR","");console.log(`💾 Saving CR group ${Re+1} with key:`,rt),q.saveInds[rt]={name:"CR",crGroup:ve,pane_id:Ut,groupIndex:Re,crGroups:Re===0?[...i(Cr)]:void 0,params:[ve.crPeriod,ve.crMa1Period,ve.crMa2Period,ve.crMa3Period,ve.crMa4Period]}}),q))}function zi(k){if(!i(we)||i(Cr).length<=1)return;const A=i(Cr).findIndex(B=>B.id===k);A!==-1&&(console.log("🗑️ Removing CR group at index:",A,"ID:",k),x(Cr,V(i(Cr).filter(B=>B.id!==k))),nu(),console.log("✅ CR group removed. Remaining groups:",i(Cr).length))}function jm(){if(!i($d))return;const k=`${o().editPaneId}_ROC`,A=r().saveInds[k];A&&A.rocGroups&&A.rocGroups.length>0?(x(ba,V([...A.rocGroups])),i(ba).forEach((B,R)=>{B.paneId||(B.paneId=R===0?o().editPaneId:void 0)})):A&&A.rocGroup?(x(ba,V([A.rocGroup])),i(ba)[0]&&!i(ba)[0].paneId&&(i(ba)[0].paneId=o().editPaneId)):i(ba).length===0&&x(ba,V([{id:Lr(),period:14,period2:21,paneId:o().editPaneId,styles:{roc:{color:"#2563eb",thickness:1,lineStyle:"solid"},roc2:{color:"#dc2626",thickness:1,lineStyle:"solid",visible:!1}}}]))}function op(){var k;if(!(!s()||!i($d)))try{const B=((k=s())==null?void 0:k.getIndicators()).filter(R=>R.name==="ROC");console.log("🔍 Detecting paneIds for ROC indicators:",B.length),B.forEach((R,U)=>{U<i(ba).length&&!i(ba)[U].paneId&&(i(ba)[U].paneId=R.paneId,console.log(`📍 Set paneId ${R.paneId} for ROC group ${U}`))})}catch(A){console.error("❌ Error detecting ROC paneIds:",A)}}function _m(){var Ut,ls;if(!i($d)||!s())return;const k=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],A=i(ba).length%k.length,B={id:Lr(),period:14,period2:21,paneId:void 0,styles:{roc:{color:k[A],thickness:1,lineStyle:"solid"},roc2:{color:k[(A+1)%k.length],thickness:1,lineStyle:"solid",visible:!1}}};i(ba).push(B);const R=[B.period];let U=vt.Solid,q=[2,2];B.styles.roc.lineStyle==="dashed"?(U=vt.Dashed,q=[4,4]):B.styles.roc.lineStyle==="dotted"&&(U=vt.Dashed,q=[2,2]);const ve={lines:[{color:B.styles.roc.color,size:B.styles.roc.thickness,style:U,dashedValue:q,smooth:!1}]},Re={name:"ROC",calcParams:R,styles:ve,figures:[{key:"roc",title:"ROC: ",type:"line"}]};let rt;i(ba).length===1?((Ut=s())==null||Ut.overrideIndicator({...Re,paneId:o().editPaneId}),rt=o().editPaneId):rt=(ls=s())==null?void 0:ls.createIndicator(Re,!1,{axis:{gap:{bottom:2}}}),B.paneId=rt??void 0,c.update(ns=>{const Mn=`${o().editPaneId}_ROC`;return ns.saveInds[Mn]||(ns.saveInds[Mn]={name:"ROC",pane_id:o().editPaneId,params:[B.period],rocGroups:[]}),ns.saveInds[Mn].rocGroups||(ns.saveInds[Mn].rocGroups=[]),ns.saveInds[Mn].rocGroups=[...i(ba)],ns})}function dh(k){var R,U;if(!i($d)||i(ba).length<=1)return;const A=i(ba).findIndex(q=>q.id===k);if(A===-1)return;console.log("🗑️ Removing ROC group at index:",A,"with ID:",k);const B=i(ba).length;if(i(ba).splice(A,1),console.log(`📝 Removed ROC group: ${B} -> ${i(ba).length}`),i(ba).forEach((q,ve)=>{q.name=`ROC #${ve+1}`}),s())try{const ve=((R=s())==null?void 0:R.getIndicators()).filter(Re=>Re.name==="ROC");console.log("📈 ROC indicators found:",ve.length);for(const Re of ve)console.log("🗑️ Removing ROC from pane:",Re.paneId),(U=s())==null||U.removeIndicator({paneId:Re.paneId,name:"ROC"});i(ba).forEach((Re,rt)=>{var qo;let Ut=vt.Solid,ls=[2,2];Re.styles.roc.lineStyle==="dashed"?(Ut=vt.Dashed,ls=[4,4]):Re.styles.roc.lineStyle==="dotted"&&(Ut=vt.Dashed,ls=[2,2]);const ns={lines:[{color:Re.styles.roc.color,size:Re.styles.roc.thickness,style:Ut,dashedValue:ls}]};console.log("➕ Re-adding ROC group:",`ROC_${rt+1}`,"at index:",rt);const Mn=(qo=s())==null?void 0:qo.createIndicator({name:"ROC",calcParams:[Re.period],styles:ns,figures:[{key:"roc",title:"ROC: ",type:"line"}]},!1);Mn&&(Re.paneId=Mn,c.update(Yo=>{const Nc=`${Mn}_ROC`;return Yo.saveInds[Nc]||(Yo.saveInds[Nc]={name:"ROC",pane_id:Mn,rocGroups:[]}),Yo.saveInds[Nc].rocGroups||(Yo.saveInds[Nc].rocGroups=[]),Yo.saveInds[Nc].rocGroups[rt]={...Re},Yo}))}),console.log("✅ Successfully updated ROC indicators on chart")}catch(q){console.error("❌ Error updating ROC indicators:",q)}console.log("✅ ROC group removed. Remaining groups:",i(ba).length)}function Kp(k){var ve,Re;const A=i(ba)[k];if(!A||!s()){console.warn("❌ updateRocIndicator: Missing group or chart",{group:A,chart:!!s()});return}console.log("🔄 updateRocIndicator called:",{groupIndex:k,group:A});let B=vt.Solid,R=[2,2];A.styles.roc.lineStyle==="dashed"?(B=vt.Dashed,R=[4,4]):A.styles.roc.lineStyle==="dotted"&&(B=vt.Dashed,R=[2,2]);const q=((ve=s())==null?void 0:ve.getIndicators()).filter(rt=>rt.name==="ROC");if(console.log("📊 Found ROC indicators on chart:",q.length),console.log("📊 Looking for group index:",k),q.length>k){const rt=q[k];console.log("✅ Found matching ROC indicator by index, updating styles...");const Ut=(Re=s())==null?void 0:Re.overrideIndicator({name:"ROC",paneId:rt.paneId,calcParams:[A.period],styles:{lines:[{color:A.styles.roc.color,size:A.styles.roc.thickness,style:B,dashedValue:R,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Ut),console.log("🎨 Applied styles:",{color:A.styles.roc.color,size:A.styles.roc.thickness,style:B,dashedValue:R});const ls=`${rt.paneId}_ROC`;console.log("💾 Using save key:",ls),c.update(ns=>{ns.saveInds[ls]||(ns.saveInds[ls]={name:"ROC",pane_id:rt.paneId,params:[A.period],rocGroups:[]}),ns.saveInds[ls].rocGroups||(ns.saveInds[ls].rocGroups=[]);const Mn=ns.saveInds[ls].rocGroups||[];for(;Mn.length<=k;)Mn.push({});return Mn[k]={...A},ns.saveInds[ls].rocGroups=Mn,ns.saveInds[ls].params=[A.period],console.log("💾 Persisted ROC changes to save data:",ls,A),ns}),console.log("✅ ROC indicator updated successfully:",k,A)}else console.error("❌ ROC indicator not found on chart for group index:",k),console.log("📊 Available ROC indicators:",q.length),console.log("📊 Requested group index:",k)}function Xp(){if(!i(Pf))return;x(Zr,V([]));const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="PSY").sort((A,B)=>A===`${o().editPaneId}_PSY`?-1:B===`${o().editPaneId}_PSY`?1:A.localeCompare(B));k.length>0?x(Zr,V(k.map((A,B)=>{const R=r().saveInds[A];if(R.psyGroup)return{...R.psyGroup,id:R.psyGroup.id||Lr(),actualPaneId:R.pane_id};if(R.psyGroups){const U=R.psyGroups[B]||R.psyGroups[0];return{...U,id:U.id||Lr(),actualPaneId:R.pane_id}}else{const[U=12,q=6]=R.params||[12,6],ve=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"];return{id:Lr(),psyPeriod:U,mapsyPeriod:q,showMapsy:!0,actualPaneId:R.pane_id,styles:{psy:{color:ve[B%ve.length],thickness:1,lineStyle:"solid"},mapsy:{color:ve[(B+1)%ve.length],thickness:1,lineStyle:"solid"}}}}}))):i(Zr).push({id:Lr(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,styles:{psy:{color:"#2563eb",thickness:1,lineStyle:"solid"},mapsy:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}),x(Zr,V(i(Zr).map(A=>({...A,id:A.id||Lr()}))))}function ym(){var U;if(!i(Pf))return;const k=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],A=i(Zr).length%k.length,B={id:Lr(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,actualPaneId:void 0,styles:{psy:{color:k[A],thickness:1,lineStyle:"solid"},mapsy:{color:k[(A+1)%k.length],thickness:1,lineStyle:"solid"}}};if(i(Zr).push(B),i(Zr).length>1){let q=2;for(;Object.keys(r().saveInds).some(Yo=>Yo===`psy_${String(q).padStart(3,"0")}_PSY`);)q+=1;const ve=i(Zr).length-1,Re=[B.psyPeriod,B.mapsyPeriod],rt=[{key:"psy",title:"PSY: ",type:"line"}];B.showMapsy&&rt.push({key:"mapsy",title:"MAPSY: ",type:"line"});const Ut={lines:[]};let ls=vt.Solid,ns=[2,2];if(B.styles.psy.lineStyle==="dashed"?(ls=vt.Dashed,ns=[4,4]):B.styles.psy.lineStyle==="dotted"&&(ls=vt.Dashed,ns=[2,2]),Ut.lines.push({color:B.styles.psy.color,size:B.styles.psy.thickness,style:ls,dashedValue:ns,smooth:!1}),B.showMapsy){let Yo=vt.Solid,Nc=[2,2];B.styles.mapsy.lineStyle==="dashed"?(Yo=vt.Dashed,Nc=[4,4]):B.styles.mapsy.lineStyle==="dotted"&&(Yo=vt.Dashed,Nc=[2,2]),Ut.lines.push({color:B.styles.mapsy.color,size:B.styles.mapsy.thickness,style:Yo,dashedValue:Nc,smooth:!1})}const Mn=`psy_${String(q).padStart(3,"0")}`;console.log(`🆕 Immediately creating PSY ${q} with pane ID:`,Mn),((U=s())==null?void 0:U.createIndicator({name:"PSY",calcParams:Re,styles:Ut,figures:rt},!1,{id:Mn,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${q} created with pane ID:`,Mn),B.actualPaneId=Mn,c.update(Yo=>{const Nc=`psy_${String(q).padStart(3,"0")}_PSY`;return Yo.saveInds[Nc]={name:"PSY",psyGroup:B,pane_id:Mn,groupIndex:ve,params:[B.psyPeriod,B.mapsyPeriod]},Yo}))}else console.log("📝 New PSY group will be added to edit pane on confirm")}function Ah(k){var B,R,U;if(!i(Pf)||i(Zr).length<=1)return;const A=i(Zr).findIndex(q=>q.id===k);if(A!==-1){console.log("🗑️ Removing PSY group at index:",A,"ID:",k);try{if(A===0&&i(Zr).length>1){console.log("🔄 Special handling: First PSY removed, promoting second PSY to first position"),x(Zr,V(i(Zr).filter(ve=>ve.id!==k))),console.log("✅ PSY group removed from array. Remaining groups:",i(Zr).length);const q=i(Zr)[0];q.actualPaneId&&(console.log("🗑️ Removing old second PSY from sub-pane:",q.actualPaneId),(B=s())==null||B.removeIndicator({paneId:q.actualPaneId,name:"PSY"})),q.actualPaneId=void 0,console.log("📊 Updating PSY in edit pane with new first group settings"),Rf(0)}else{const q=`pane_PSY_${A+1}_PSY`;if(r().saveInds[q]){const ve=r().saveInds[q];console.log("🗑️ Removing PSY from pane:",ve.pane_id),(R=s())==null||R.removeIndicator({paneId:ve.pane_id,name:"PSY"}),console.log("✅ Successfully removed PSY from pane:",ve.pane_id)}else{const ve=i(Zr)[A];ve.actualPaneId&&(console.log("🗑️ Removing PSY from actual pane:",ve.actualPaneId),(U=s())==null||U.removeIndicator({paneId:ve.actualPaneId,name:"PSY"}),console.log("✅ Successfully removed PSY from actual pane:",ve.actualPaneId))}x(Zr,V(i(Zr).filter(ve=>ve.id!==k))),console.log("✅ PSY group removed from array. Remaining groups:",i(Zr).length)}c.update(q=>(Object.keys(q.saveInds).forEach(ve=>{q.saveInds[ve].name==="PSY"&&(console.log("🧹 Cleaning saved state for key:",ve),delete q.saveInds[ve])}),i(Zr).forEach((ve,Re)=>{const rt=Re===0?`${o().editPaneId}_PSY`:`pane_PSY_${Re+1}_PSY`,Ut=Re===0?o().editPaneId:ve.actualPaneId||`pane_PSY_${Re+1}`;q.saveInds[rt]={name:"PSY",psyGroup:ve,pane_id:Ut,groupIndex:Re,psyGroups:Re===0?[...i(Zr)]:void 0,params:[ve.psyPeriod,ve.mapsyPeriod]},console.log("💾 Re-saved PSY group",Re,"with key:",rt,"and pane ID:",Ut)}),q))}catch(q){console.error("❌ Error removing PSY group:",q)}}}function Rf(k){var rt;const A=i(Zr)[k];if(!A||!s())return;const B=k===0?o().editPaneId:A.actualPaneId||`psy_${String(k+1).padStart(3,"0")}`,R=[{key:"psy",title:"PSY: ",type:"line"}];A.showMapsy&&R.push({key:"mapsy",title:"MAPSY: ",type:"line"});const U={lines:[]};let q=vt.Solid,ve=[2,2];if(A.styles.psy.lineStyle==="dashed"?(q=vt.Dashed,ve=[4,4]):A.styles.psy.lineStyle==="dotted"&&(q=vt.Dashed,ve=[2,2]),U.lines.push({color:A.styles.psy.color,size:A.styles.psy.thickness,style:q,dashedValue:ve,smooth:!1}),A.showMapsy){let Ut=vt.Solid,ls=[2,2];A.styles.mapsy.lineStyle==="dashed"?(Ut=vt.Dashed,ls=[4,4]):A.styles.mapsy.lineStyle==="dotted"&&(Ut=vt.Dashed,ls=[2,2]),U.lines.push({color:A.styles.mapsy.color,size:A.styles.mapsy.thickness,style:Ut,dashedValue:ls,smooth:!1})}(rt=s())==null||rt.overrideIndicator({name:"PSY",paneId:B,styles:U,calcParams:[A.psyPeriod,A.mapsyPeriod],figures:R});const Re=k===0?`${o().editPaneId}_PSY`:`psy_${String(k+1).padStart(3,"0")}_PSY`;c.update(Ut=>(Ut.saveInds[Re]&&(Ut.saveInds[Re].params=[A.psyPeriod,A.mapsyPeriod],Ut.saveInds[Re].psyGroup={...A},console.log("💾 Persisted PSY changes to save data:",Re,A)),Ut)),console.log("🔄 Updated PSY indicator:",k,A)}function Bm(){if(!i(oe))return;x(Qi,V([]));const k=Object.entries(r().saveInds).filter(([A,B])=>B.name==="OBV");k.length>0?(k.sort(([A,B],[R,U])=>{const q=B.groupIndex||0,ve=U.groupIndex||0;return q-ve}),k.forEach(([A,B])=>{var U,q;const R=B;if(R.obvGroup){const ve=R.obvGroup;R.pane_id&&(ve.actualPaneId=R.pane_id),i(Qi).push(ve)}else if(R.obvGroups&&R.obvGroups.length>0)x(Qi,V([...R.obvGroups])),i(Qi).forEach((ve,Re)=>{ve.actualPaneId||(Re===0?ve.actualPaneId=o().editPaneId:R.pane_id&&(ve.actualPaneId=R.pane_id))});else{const ve={id:Lr(),obvPeriod:((U=R.params)==null?void 0:U[0])||30,maobvPeriod:((q=R.params)==null?void 0:q[1])||10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}};R.pane_id&&(ve.actualPaneId=R.pane_id),i(Qi).push(ve)}})):i(Qi).push({id:Lr(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:o().editPaneId,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}})}function Om(){if(!i(oe))return;const k=["#FF6B35","#2196F3","#16a34a","#ca8a04","#9333ea","#c2410c"],A=i(Qi).length%k.length,B={id:Lr(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:k[A],thickness:2,lineStyle:"solid"},maobv:{color:k[(A+1)%k.length],thickness:1,lineStyle:"solid"}}},R=new Set;i(Qi).forEach(ve=>{ve.actualPaneId&&R.add(ve.actualPaneId)}),Object.keys(r().saveInds).forEach(ve=>{r().saveInds[ve]&&r().saveInds[ve].name==="OBV"&&r().saveInds[ve].pane_id&&R.add(r().saveInds[ve].pane_id)}),console.log("🔍 Existing OBV pane IDs:",Array.from(R));let U=2;for(;R.has(`pane_OBV_${U}`);)U+=1;const q=`pane_OBV_${U}`;B.actualPaneId=q,console.log("✅ Adding new OBV group with pane ID:",q),i(Qi).push(B),om()}function Uh(k){var R;if(!i(oe)||i(Qi).length<=1)return;x(Zl,!0),console.log("🚫 Set obvRemovalInProgress = true");const A=i(Qi).findIndex(U=>U.id===k);if(A===-1){x(Zl,!1);return}const B=i(Qi)[A];console.log("🗑️ Removing OBV group at index:",A,"ID:",k),console.log("🗑️ Group to remove:",B);try{let U;U=B.actualPaneId,U||Object.keys(r().saveInds).forEach(q=>{const ve=r().saveInds[q];ve&&ve.name==="OBV"&&ve.groupIndex===A&&(U=ve.pane_id)}),!U&&A===0&&(U=o().editPaneId),console.log("🗑️ Removing OBV at index",A,"from pane:",U),U&&(console.log("🗑️ Removing OBV indicator from pane:",U),(R=s())==null||R.removeIndicator({paneId:U,name:"OBV"}),console.log("✅ Successfully removed OBV from pane:",U)),x(Qi,V(i(Qi).filter(q=>q.id!==k))),console.log("✅ OBV group removed from array. Remaining groups:",i(Qi).length),c.update(q=>{const ve=[];return Object.keys(q.saveInds).forEach(Re=>{q.saveInds[Re]&&q.saveInds[Re].name==="OBV"&&ve.push(Re)}),console.log("🧹 Clearing all OBV save data:",ve),ve.forEach(Re=>delete q.saveInds[Re]),i(Qi).forEach((Re,rt)=>{const Ut=Re.actualPaneId||o().editPaneId;if(!Ut){console.error(`❌ No pane ID for OBV group ${rt} during removal cleanup`);return}const ls=`${Ut}_OBV`;q.saveInds[ls]={name:"OBV",obvGroup:Re,pane_id:Ut,groupIndex:rt,obvGroups:rt===0?[...i(Qi)]:void 0,params:[Re.obvPeriod,Re.maobvPeriod]},console.log("💾 Re-saved OBV group",rt,"with key:",ls,"pane:",Ut)}),q}),console.log("✅ OBV removal and reindexing completed"),setTimeout(()=>{x(Zl,!1),console.log("✅ Reset obvRemovalInProgress = false")},200)}catch(U){console.error("❌ Error removing OBV group:",U)}}function om(){if(!(!i(oe)||!s()))try{console.log("🔄 Applying OBV changes to chart..."),console.log("🔧 Current OBV groups:",i(Qi).length);const k=Object.keys(r().saveInds).filter(B=>r().saveInds[B]&&r().saveInds[B].name==="OBV");console.log("🔧 Existing OBV keys in save data:",k);const A=new Set;i(Qi).forEach((B,R)=>{const U=B.actualPaneId||o().editPaneId;A.add(U)}),console.log("🔧 Pane IDs that should exist:",Array.from(A)),k.forEach(B=>{var U;const R=r().saveInds[B];if(R&&R.pane_id&&!A.has(R.pane_id))try{console.log("🗑️ Removing stale OBV indicator from pane:",R.pane_id),(U=s())==null||U.removeIndicator({paneId:R.pane_id,name:"OBV"})}catch(q){console.log("❌ Error removing stale OBV indicator:",q)}}),i(Qi).forEach((B,R)=>{var ve,Re,rt;const U=[B.obvPeriod,B.maobvPeriod],q={lines:[{color:B.styles.obv.color,size:B.styles.obv.thickness,style:B.styles.obv.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:B.styles.obv.lineStyle==="dashed"?[4,4]:B.styles.obv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:B.styles.maobv.color,size:B.styles.maobv.thickness,style:B.styles.maobv.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:B.styles.maobv.lineStyle==="dashed"?[4,4]:B.styles.maobv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(R===0){const Ut=B.actualPaneId||o().editPaneId;B.actualPaneId||(B.actualPaneId=o().editPaneId),console.log("🔄 Updating first OBV in pane:",Ut),(ve=s())==null||ve.overrideIndicator({name:"OBV",calcParams:U,styles:q,paneId:Ut})}else{const Ut=B.actualPaneId||`pane_OBV_${R+1}`;if(k.find(ns=>{const Mn=r().saveInds[ns];return Mn&&Mn.pane_id===Ut}))console.log("🔄 Updating existing OBV in pane:",Ut),(Re=s())==null||Re.overrideIndicator({name:"OBV",calcParams:U,styles:q,paneId:Ut}),B.actualPaneId=Ut;else{const ns=B.actualPaneId||`pane_OBV_${R+1}`;console.log("🆕 Creating new OBV in pane:",ns);const Mn=(rt=s())==null?void 0:rt.createIndicator({name:"OBV",calcParams:U,styles:q},!0,{id:ns,axis:{gap:{bottom:2}}});Mn&&(B.actualPaneId=ns,console.log("✅ Created new OBV indicator with ID:",Mn,"in pane:",ns))}}}),c.update(B=>{try{Object.keys(B.saveInds).forEach(R=>{B.saveInds[R]&&B.saveInds[R].name==="OBV"&&delete B.saveInds[R]}),i(Qi).forEach((R,U)=>{try{const q=R.actualPaneId||o().editPaneId;if(!q){console.error(`❌ No pane ID for OBV group ${U}`);return}const ve=`${q}_OBV`,Re={name:"OBV",obvGroup:R,pane_id:q,groupIndex:U,obvGroups:U===0?[...i(Qi)]:void 0,params:[R.obvPeriod,R.maobvPeriod]};B.saveInds[ve]=Re,console.log("💾 Saved OBV group",U,"with key:",ve,"and pane ID:",q)}catch(q){console.error(`❌ Error saving OBV group ${U}:`,q)}})}catch(R){console.error("❌ Error in OBV save operation:",R)}return B}),console.log("✅ OBV changes applied successfully")}catch(k){console.error("❌ Critical error in applyObv:",k)}}function bm(){if(!i(re))return;console.log("🔄 Initializing KDJ groups for edit pane:",o().editPaneId);const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="KDJ").sort((A,B)=>A===`${o().editPaneId}_KDJ`?-1:B===`${o().editPaneId}_KDJ`?1:A.localeCompare(B));console.log("🔍 Found KDJ keys:",k),k.length>0?(x(os,V([])),k.forEach((A,B)=>{const R=r().saveInds[A];if(console.log(`🔄 Loading KDJ group ${B+1} from key:`,A,R),R){if(R.kdjGroup){const U={...R.kdjGroup};B>0&&R.pane_id&&(U.actualPaneId=R.pane_id),i(os).push(U)}else if(R.params&&R.params.length>=2){const U={id:Lr(),kPeriod:R.params[0]||9,dPeriod:R.params[1]||3,actualPaneId:void 0,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}};B>0&&R.pane_id&&(U.actualPaneId=R.pane_id),i(os).push(U)}}}),console.log("✅ Loaded",i(os).length,"existing KDJ groups")):i(os).length===0&&(x(os,V([{id:Lr(),kPeriod:9,dPeriod:3,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default KDJ group"))}function zm(){var R;if(!i(re))return;const k=["#FF6B35","#2196F3","#9C27B0","#16a34a","#ca8a04","#dc2626"],A=i(os).length%k.length,B={id:Lr(),kPeriod:9,dPeriod:3,actualPaneId:void 0,styles:{k:{color:k[A],thickness:1,lineStyle:"solid"},d:{color:k[(A+1)%k.length],thickness:1,lineStyle:"solid"},j:{color:k[(A+2)%k.length],thickness:1,lineStyle:"solid"}}};if(i(os).push(B),i(os).length>1){const U=Object.values(r().saveInds).filter(ns=>ns.name==="KDJ"&&ns.pane_id).map(ns=>ns.pane_id);let q=2;for(;U.includes(`pane_KDJ_${q}`);)q+=1;const ve=i(os).length-1,Re=[B.kPeriod,B.dPeriod,3],rt={lines:[{color:B.styles.k.color,size:B.styles.k.thickness,style:B.styles.k.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:B.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:B.styles.d.color,size:B.styles.d.thickness,style:B.styles.d.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:B.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:B.styles.j.color,size:B.styles.j.thickness,style:B.styles.j.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:B.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]},Ut=`pane_KDJ_${q}`;console.log(`🆕 Immediately creating KDJ ${q} with pane ID:`,Ut),((R=s())==null?void 0:R.createIndicator({name:"KDJ",calcParams:Re,styles:rt},!1,{id:Ut,axis:{gap:{bottom:2}}}))&&(console.log(`✅ KDJ ${q} created with pane ID:`,Ut),B.actualPaneId=Ut,c.update(ns=>{const Mn=`pane_KDJ_${q}_KDJ`;return ns.saveInds[Mn]={name:"KDJ",kdjGroup:B,pane_id:Ut,groupIndex:ve,params:[B.kPeriod,B.dPeriod,3]},ns}))}}function fp(k){var q;const A=i(os)[k];if(!A||!s())return;const B=k===0?o().editPaneId:A.actualPaneId||`pane_KDJ_${k+1}`,R={lines:[{color:A.styles.k.color,size:A.styles.k.thickness,style:A.styles.k.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:A.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:A.styles.d.color,size:A.styles.d.thickness,style:A.styles.d.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:A.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:A.styles.j.color,size:A.styles.j.thickness,style:A.styles.j.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:A.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]};(q=s())==null||q.overrideIndicator({name:"KDJ",paneId:B,styles:R,calcParams:[A.kPeriod,A.dPeriod,3]});const U=k===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${k+1}_KDJ`;c.update(ve=>(ve.saveInds[U]&&(ve.saveInds[U].params=[A.kPeriod,A.dPeriod,3],ve.saveInds[U].kdjGroup={...A},console.log("💾 Persisted KDJ changes to save data:",U,A)),ve)),console.log("🔄 Updated KDJ indicator:",k,A)}let Td=xe(V([]));function iv(){if(!i(Kd)||i(Td).length>0)return;const k=`${o().editPaneId}_ICHIMOKU`,A=r().saveInds[k];if(A&&Array.isArray(A.ichimokuGroups)&&A.ichimokuGroups.length>0)x(Td,V(A.ichimokuGroups.map((B,R)=>{var U;return{id:B.id||Lr(),name:B.name||`Ichimoku #${R+1}`,params:B.params||[9,26,52],styles:((U=B.styles)==null?void 0:U.map(q=>({color:q.color||"#2563eb",thickness:q.thickness??1,lineStyle:q.lineStyle||"solid"})))||[{color:"#ef4444",thickness:1,lineStyle:"solid"},{color:"#3b82f6",thickness:1,lineStyle:"solid"},{color:"#10b981",thickness:1,lineStyle:"solid"}]}})));else{const B=[u[0]||9,u[1]||26,u[2]||52],R=[0,1,2].map(U=>{var q,ve,Re;return{color:((q=h[U])==null?void 0:q.color)||["#ef4444","#3b82f6","#10b981"][U]||"#2563eb",thickness:((ve=h[U])==null?void 0:ve.thickness)??1,lineStyle:((Re=h[U])==null?void 0:Re.lineStyle)||"solid"}});x(Td,V([{id:Lr(),name:"Ichimoku #1",params:B,styles:R}]))}}function $v(){var U;if(!i(Kd))return;const k=i(Td).length+1,A=[["#ef4444","#3b82f6","#10b981"],["#f59e0b","#8b5cf6","#06b6d4"],["#22c55e","#e11d48","#0ea5e9"]],B=A[(k-1)%A.length],R={id:Lr(),name:`Ichimoku #${k}`,params:[9,26,52],styles:[{color:B[0],thickness:1,lineStyle:"solid"},{color:B[1],thickness:1,lineStyle:"solid"},{color:B[2],thickness:1,lineStyle:"solid"}]};x(Td,V([...i(Td),R]));try{const q={lines:R.styles.map(Re=>({color:Re.color,size:Re.thickness,style:Re.lineStyle==="dashed"||Re.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:Re.lineStyle==="dashed"?[4,4]:Re.lineStyle==="dotted"?[2,2]:[2,2]}))};(U=s())==null||U.createIndicator({name:"ICHIMOKU",calcParams:R.params,styles:q},!0,{id:o().editPaneId});const ve=`${o().editPaneId}_ICHIMOKU`;c.update(Re=>{var rt;return Re.saveInds[ve]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((rt=i(Td)[0])==null?void 0:rt.params)||[9,26,52],ichimokuGroups:i(Td).map(Ut=>({...Ut}))},Re})}catch(q){console.error("❌ Error adding Ichimoku group:",q)}}function Vm(k){var A,B,R;if(!(!i(Kd)||!s()))try{const q=(((B=(A=s())==null?void 0:A.getIndicators)==null?void 0:B.call(A))||[]).filter(Re=>Re.name==="ICHIMOKU"&&Re.paneId===o().editPaneId);for(const Re of q)(R=s())==null||R.removeIndicator({paneId:Re.paneId,name:"ICHIMOKU"});i(Td).forEach(Re=>{var Ut;const rt={lines:Re.styles.map(ls=>({color:ls.color,size:ls.thickness,style:ls.lineStyle==="dashed"||ls.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:ls.lineStyle==="dashed"?[4,4]:ls.lineStyle==="dotted"?[2,2]:[2,2]}))};(Ut=s())==null||Ut.createIndicator({name:"ICHIMOKU",calcParams:Re.params,styles:rt},!0,{id:o().editPaneId})});const ve=`${o().editPaneId}_ICHIMOKU`;c.update(Re=>{var rt;return Re.saveInds[ve]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((rt=i(Td)[0])==null?void 0:rt.params)||[9,26,52],ichimokuGroups:i(Td).map(Ut=>({...Ut}))},Re}),console.log("🔄 Updated Ichimoku groups")}catch(U){console.error("❌ Error updating Ichimoku groups:",U)}}function fh(k){if(i(Kd)&&!(i(Td).length<=1)&&!(k<0||k>=i(Td).length))try{x(Td,V(i(Td).filter((A,B)=>B!==k))),Vm(0),console.log("🗑️ Removed Ichimoku group at index:",k)}catch(A){console.error("❌ Error removing Ichimoku group:",A)}}function Gh(){var k,A,B;if(!(!i(Kd)||!s()))try{const U=(((A=(k=s())==null?void 0:k.getIndicators)==null?void 0:A.call(k))||[]).filter(ve=>ve.name==="ICHIMOKU"&&ve.paneId===o().editPaneId);for(const ve of U)(B=s())==null||B.removeIndicator({paneId:ve.paneId,name:"ICHIMOKU"});i(Td).forEach(ve=>{var rt;const Re={lines:ve.styles.map(Ut=>({color:Ut.color,size:Ut.thickness,style:Ut.lineStyle==="dashed"||Ut.lineStyle==="dotted"?vt.Dashed:vt.Solid,dashedValue:Ut.lineStyle==="dashed"?[4,4]:Ut.lineStyle==="dotted"?[2,2]:[2,2]}))};(rt=s())==null||rt.createIndicator({name:"ICHIMOKU",calcParams:ve.params,styles:Re},!0,{id:o().editPaneId})});const q=`${o().editPaneId}_ICHIMOKU`;c.update(ve=>{var Re;return ve.saveInds[q]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((Re=i(Td)[0])==null?void 0:Re.params)||[9,26,52],ichimokuGroups:i(Td).map(rt=>({...rt}))},ve}),l.update(ve=>(ve.editIndName="",ve.editPaneId="",ve.modalIndCfg=!1,ve)),a(!1),console.log("✅ Ichimoku confirm applied")}catch(R){console.error("❌ Error confirming Ichimoku groups:",R)}}function wu(k){var B,R;if(!i(re)||i(os).length<=1)return;const A=i(os).findIndex(U=>U.id===k);if(A!==-1){console.log("🗑️ Removing KDJ group at index:",A,"ID:",k);try{if(A===0&&i(os).length>1){console.log("🔄 Special handling: First KDJ removed, promoting second KDJ to first position"),x(os,V(i(os).filter(q=>q.id!==k))),console.log("✅ KDJ group removed from array. Remaining groups:",i(os).length);const U=i(os)[0];U.actualPaneId&&(console.log("🗑️ Removing old second KDJ from sub-pane:",U.actualPaneId),(B=s())==null||B.removeIndicator({paneId:U.actualPaneId,name:"KDJ"})),U.actualPaneId=void 0,console.log("📊 Updating KDJ in edit pane with new first group settings"),fp(0)}else{const U=i(os)[A];U.actualPaneId&&(console.log("🗑️ Removing KDJ from actual pane:",U.actualPaneId),(R=s())==null||R.removeIndicator({paneId:U.actualPaneId,name:"KDJ"}),console.log("✅ Successfully removed KDJ from actual pane:",U.actualPaneId)),x(os,V(i(os).filter(q=>q.id!==k))),console.log("✅ KDJ group removed from array. Remaining groups:",i(os).length)}c.update(U=>(Object.keys(U.saveInds).forEach(q=>{U.saveInds[q].name==="KDJ"&&(console.log("🧹 Cleaning saved state for key:",q),delete U.saveInds[q])}),i(os).forEach((q,ve)=>{const Re=ve===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${ve+1}_KDJ`,rt=ve===0?o().editPaneId:q.actualPaneId||`pane_KDJ_${ve+1}`;console.log(`💾 Re-saving KDJ group ${ve+1} with key:`,Re,"pane ID:",rt),U.saveInds[Re]={name:"KDJ",kdjGroup:q,pane_id:rt,groupIndex:ve,kdjGroups:ve===0?[...i(os)]:void 0,params:[q.kPeriod,q.dPeriod,3]}}),U)),console.log("🔄 KDJ groups reindexed successfully")}catch(U){console.log("❌ Error removing KDJ indicator:",U)}}}function Lp(){var A,B;if(!i(Cc))return;console.log("🔄 Initializing AO groups for edit pane:",o().editPaneId);const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="AO").sort((R,U)=>R===`${o().editPaneId}_AO`?-1:U===`${o().editPaneId}_AO`?1:R.localeCompare(U));if(console.log("🔍 Found AO keys:",k),k.length>0)x(oc,V([])),k.forEach((R,U)=>{var ve;const q=r().saveInds[R];if(console.log(`🔄 Loading AO group ${U+1} from key:`,R,q),q)if(q.aoGroup){const Re={...q.aoGroup},rt=Re.styles||{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"}};(ve=rt.reverse)!=null&&ve.color?Re.styles=rt:Re.styles={...rt,reverse:{color:"#c4c4c4"}},i(oc).push(Re)}else q.params&&q.params.length===2&&i(oc).push({id:Lr(),shortPeriod:q.params[0]||5,longPeriod:q.params[1]||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}})}),console.log("✅ Loaded AO groups:",i(oc).length);else{const R=Object.entries(r().saveInds).find(([U,q])=>q.name==="AO"&&U.includes(o().editPaneId||""));if(R){const[,U]=R;console.log("🔄 Found existing AO indicator, creating group from it"),x(oc,V([{id:Lr(),shortPeriod:((A=U.params)==null?void 0:A[0])||5,longPeriod:((B=U.params)==null?void 0:B[1])||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}}]))}else console.log("🔄 Creating default AO group"),x(oc,V([{id:Lr(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}}]))}}function ph(){if(!i(Nu))return;const k=o().editPaneId||"candle_pane",A=Object.entries(r().saveInds).filter(([R,U])=>U&&U.name==="BOLL"&&U.pane_id===k);if(A.length>0){const R=A.sort(([U],[q])=>{var rt,Ut;const ve=(rt=U.match(/_BOLL_(\d+)$/))!=null&&rt[1]?parseInt(U.match(/_BOLL_(\d+)$/)[1],10):1,Re=(Ut=q.match(/_BOLL_(\d+)$/))!=null&&Ut[1]?parseInt(q.match(/_BOLL_(\d+)$/)[1],10):1;return ve-Re});x(Jl,V(R.map(([U,q])=>{var ve,Re,rt,Ut,ls,ns,Mn;return{id:Lr(),paneId:k,period:q.params&&q.params[0]||20,stdDev:q.params&&q.params[1]||2,styles:{fillColor:((ve=q.bollingerStyles)==null?void 0:ve.fillColor)||"#2196F3",fillOpacity:((Re=q.bollingerStyles)==null?void 0:Re.fillOpacity)??5,upperColor:((rt=q.bollingerStyles)==null?void 0:rt.upperColor)||"#f23645",middleColor:((Ut=q.bollingerStyles)==null?void 0:Ut.middleColor)||"#2962ff",lowerColor:((ls=q.bollingerStyles)==null?void 0:ls.lowerColor)||"#089981",thickness:((ns=q.bollingerStyles)==null?void 0:ns.thickness)||1,lineStyle:((Mn=q.bollingerStyles)==null?void 0:Mn.lineStyle)||"solid"}}})))}else x(Jl,V([{id:Lr(),paneId:k,period:i(O)||20,stdDev:i(D)||2,styles:{fillColor:i(w)||"#2196F3",fillOpacity:i(C)??5,upperColor:i(M)||"#f23645",middleColor:i(P)||"#2962ff",lowerColor:i(T)||"#089981",thickness:i(N)||1,lineStyle:i(L)||"solid"}}]));const B=i(Jl)[0];B&&(x(O,V(B.period)),x(D,V(B.stdDev)),x(w,V(B.styles.fillColor)),x(C,V(B.styles.fillOpacity)),x(M,V(B.styles.upperColor)),x(P,V(B.styles.middleColor)),x(T,V(B.styles.lowerColor)),x(N,V(B.styles.thickness)),x(L,V(B.styles.lineStyle))),ao()}function im(){var B;if(!i(Cc)||!s())return;console.log("🔄 Applying AO changes in real-time, groups:",i(oc).length);const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="AO").sort((R,U)=>R===`${o().editPaneId}_AO`?-1:U===`${o().editPaneId}_AO`?1:R.localeCompare(U));console.log("🔍 Existing AO keys:",k);const A=i(oc).length;if(k.length>A){console.log(`🗑️ Removing ${k.length-A} excess AO indicators`);for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];if(q&&q.pane_id){console.log("🗑️ Removing AO indicator from pane:",q.pane_id);try{(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"AO"})}catch(ve){console.log("Error removing excess AO indicator:",ve)}}}}i(oc).forEach((R,U)=>{var Re,rt,Ut,ls,ns;const q=[R.shortPeriod,R.longPeriod],ve={bars:[{upColor:R.styles.increasing.color,downColor:R.styles.decreasing.color,noChangeColor:((Re=R.styles.reverse)==null?void 0:Re.color)||"#c4c4c4",reverseColor:((rt=R.styles.reverse)==null?void 0:rt.color)||"#c4c4c4"}]};if(U===0)console.log("🔄 Updating first AO indicator in pane:",o().editPaneId),(Ut=s())==null||Ut.overrideIndicator({name:"AO",calcParams:q,styles:ve,paneId:o().editPaneId});else{const Mn=`pane_AO_${U+1}_AO`,qo=k.find(Yo=>Yo===Mn);if(qo){const Yo=r().saveInds[qo];Yo&&Yo.pane_id&&(console.log(`🔄 Updating existing AO ${U+1} in pane:`,Yo.pane_id),(ls=s())==null||ls.overrideIndicator({name:"AO",calcParams:q,styles:ve,paneId:Yo.pane_id}))}else{const Yo=`pane_AO_${U+1}`;console.log(`🆕 Creating new AO ${U+1} with pane ID:`,Yo),(ns=s())==null||ns.createIndicator({name:"AO",calcParams:q,styles:ve},!0,{id:Yo})}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="AO"&&delete R.saveInds[U]}),i(oc).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_AO`:`pane_AO_${q+1}_AO`,Re=q===0?o().editPaneId:`pane_AO_${q+1}`;console.log(`💾 Saving AO group ${q+1} with key:`,ve),R.saveInds[ve]={name:"AO",aoGroup:U,pane_id:Re,groupIndex:q,aoGroups:q===0?[...i(oc)]:void 0,params:[U.shortPeriod,U.longPeriod]}}),R))}function Wm(k){!i(Cc)||i(oc).length<=1||!i(oc).find(B=>B.id===k)||(i(oc).findIndex(B=>B.id===k),x(oc,V(i(oc).filter(B=>B.id!==k))),im())}function Af(){const k=`${o().editPaneId}_CR`,A=r().saveInds[k];A&&(x(hn,V(A.crPeriod||26)),x(is,V(A.crMa1Period||10)),x(Gs,V(A.crMa2Period||20)),x(es,V(A.crMa3Period||40)),x(Mi,V(A.crMa4Period||60)),x(sr,V(A.crColor||"#FF6B35")),x(na,V(A.crMa1Color||"#2196F3")),x(Xr,V(A.crMa2Color||"#4CAF50")),x(Uu,V(A.crMa3Color||"#FF9800")),x(xd,V(A.crMa4Color||"#9C27B0")),x(ul,V(A.crThickness||2)),x(dr,V(A.crMa1Thickness||1)),x(Fu,V(A.crMa2Thickness||1)),x(gi,V(A.crMa3Thickness||1)),x(Dr,V(A.crMa4Thickness||1)),x(Yi,V(A.crLineStyle||"solid")),x(Ki,V(A.crMa1LineStyle||"solid")),x(Xi,V(A.crMa2LineStyle||"solid")),x(ca,V(A.crMa3LineStyle||"solid")),x(Jt,V(A.crMa4LineStyle||"solid")))}function xm(k,A){return B=>{x(te,V(k)),x(pe,V(A)),x(z,V({x:window.innerWidth/2,y:window.innerHeight/2})),x($,!0)}}function rm(k){return A=>{x(de,V(k)),x(le,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(J,!0)}}function mh(k,A){return B=>{x(ae,V(k)),x(Ie,V(A)),x(ge,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(he,!0)}}function Hm(k){return A=>{x(Lt,V(k)),x(it,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ft,!0)}}function $l(k,A){return B=>{x(kr,V(k)),x(Wr,V(A)),x(Vl,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(va,!0)}}function am(k,A){return B=>{x(et,k*3+A),x(Ue,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(He,!0)}}function hh(k,A){return B=>{if(x(Je,V(k)),x(Xe,V(A)),x(xt,V({x:B.clientX,y:B.clientY})),x(st,!0),i(St).length>k&&(A==="histogram"||A==="histogram-down")){const R=i(St)[k];A==="histogram"?R.styles.histogram.upColor=g(R.styles.histogram.upColor||"#26a69a",70):R.styles.histogram.downColor=g(R.styles.histogram.downColor||"#ef5350",70),Wt(k)}}}function Zp(k){return A=>{if(x($t,V(k)),A.currentTarget&&A.currentTarget instanceof Element){const B=A.currentTarget.getBoundingClientRect();x(Qe,V({x:B.left+B.width/2,y:B.bottom+5}))}else x(Qe,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(Be,!0)}}function Th(k){return A=>{if(x($t,V(k)),A.currentTarget&&A.currentTarget instanceof Element){const B=A.currentTarget.getBoundingClientRect();x(Mt,V({x:B.left+B.width/2,y:B.bottom+5}))}else x(Mt,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(ct,!0)}}function xv(k){return A=>{if(x($t,V(k)),A.currentTarget&&A.currentTarget instanceof Element){const B=A.currentTarget.getBoundingClientRect();x(Ce,V({x:B.left+B.width/2,y:B.bottom+5}))}else x(Ce,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(mt,!0)}}function ag(k){return A=>{if(x($t,V(k)),A.currentTarget&&A.currentTarget instanceof Element){const B=A.currentTarget.getBoundingClientRect();x(It,V({x:B.left+B.width/2,y:B.bottom+5}))}else x(It,V({x:window.innerWidth/2,y:window.innerHeight/2}));x(Te,!0)}}function Ep(k,A){return B=>{x(Vn,V(k)),x(Dn,V(A)),x(qn,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Yt,!0)}}function $p(k){return A=>{x(gn,V(k)),x(pn,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Wn,!0)}}function qm(k){return A=>{x(Cs,V(k)),x(Is,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Qs,!0)}}function Fh(k){return A=>{x(zt,V(k)),x(bs,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ro,!0)}}function Yh(k){return A=>{x(Na,V(k)),x(jo,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ri,!0)}}function lg(k){return A=>{x(nr,V(k)),x(Aa,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ar,!0)}}function gf(k){return A=>{x(ll,V(k)),x(co,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(rf,!0)}}function wm(k){return A=>{x(zu,V(k)),x(ou,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(cc,!0)}}function Dv(k){return A=>{x(Va,V(k)),x(Oc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(sl,!0)}}function Rv(k){return A=>{x(ud,V(k)),x(uu,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Wa,!0)}}function Um(k,A=0){return B=>{x(vu,V(A)),x(Ll,V(k)),x(nc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(ja,!0)}}function Kh(k){return A=>{x(ga,V(k)),x(Ja,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Sc,!0)}}function wv(k){return A=>{x(eu,V(k)),x(zc,V({x:window.innerWidth/2,y:window.innerHeight/2})),x(Wu,!0)}}hp(l,k=>k.modalIndCfg).subscribe(()=>{if(!o().editIndName)return;if(i(Kd)){iv();const B=x2.ICHIMOKU||[];d.splice(0,d.length,...B);return}if(i(np)){const R=`${o().editPaneId||"candle_pane"}_ZIGZAG`,U=Object.keys(r().saveInds).filter(ve=>{var Re;return ve.startsWith(R)&&((Re=r().saveInds[ve])==null?void 0:Re.name)==="ZIGZAG"}).sort((ve,Re)=>{const rt=Ut=>{const ls=Ut.match(/_ZIGZAG(?:_(\d+))?$/);return ls&&ls[1]?parseInt(ls[1],10):1};return rt(ve)-rt(Re)});x(An,V([])),U.length>0?U.forEach(ve=>{var ns,Mn,qo,Yo;const Re=r().saveInds[ve],rt=((Mn=(ns=Re==null?void 0:Re.styles)==null?void 0:ns.lines)==null?void 0:Mn[0])||{},Ut=Array.isArray(rt.dashedValue)?rt.dashedValue.join(","):"",ls=rt.style===vt.Solid?"solid":Ut==="2,6"?"dotted":"dashed";i(An).push({id:Lr(),deviation:Number(((qo=Re==null?void 0:Re.params)==null?void 0:qo[0])??5),depth:Number(((Yo=Re==null?void 0:Re.params)==null?void 0:Yo[1])??5),styles:{color:rt.color??"#2962FF",thickness:Number(rt.size??2),lineStyle:ls}})}):x(An,V([{id:Lr(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}}]));const q=i(An)[0];u.splice(0,u.length,q.deviation,q.depth),x(Rt,V(q.styles.color)),x(nn,V(q.styles.thickness)),x(Xn,V(q.styles.lineStyle));return}if(i(hf)){Dm();return}if(i(Hu)){Gu();return}if(i(ee)){Lv();return}if(i(Ee)){Ev();return}if(i(Gd)){ig();return}if(i(tu)){O0();return}if(i(Vc)){_i();return}if(i(qu)){Ta();return}if(i(td)){Ml();return}if(i(ke)){fc();return}if(i(bd)){xu();return}if(i(Nt)){yi();return}if(i(gc)){nd();return}if(i(we)){dp();return}if(i($d)){jm();return}if(i(Pf)){Xp();return}if(i(oe)){Bm();return}if(i(re)){bm();return}if(i(Cc)){Lp();return}if(i(we)){Af();return}if(i(Nu)){ph();return}const k=`${o().editPaneId}_${o().editIndName}`,A=r().saveInds[k];if(A&&A.fields&&!i(Nu))d.splice(0,d.length,...A.fields),u.splice(0,u.length,...A.params||[]),h.splice(0,h.length,...A.styles||[]);else{const B=x2[o().editIndName]||[];if(i(Nu)){d.splice(0,d.length,...B);const R=B.map(U=>U.default);u.splice(0,u.length,...R),A&&A.params&&A.params.length>=2&&(u[0]=A.params[0],u[1]=A.params[1])}else if(d.splice(0,d.length,...B),A&&A.params)u.splice(0,u.length,...A.params),h.splice(0,h.length,...A.styles||[]),(i(Au)||i(Yd))&&d.length>u.length&&d.splice(u.length,d.length-u.length);else{const R=B.filter(U=>U.type!=="color").map(U=>U.default);u.splice(0,u.length,...R)}}if(i(qu)){for(;h.length<2;)h.length===0?h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}):h.push({color:"#dc2626",thickness:1,lineStyle:"solid"});for(;h.length>2;)h.pop()}else{for(;h.length<u.length;)h.push({color:"#2563eb",thickness:1,lineStyle:"solid"});for(;h.length>u.length;)h.pop()}}),hp(l,k=>k.clearCciGroups).subscribe(k=>{k>0&&er()}),hp(l,k=>k.clearEmvGroups).subscribe(k=>{k>0&&fr()}),hp(l,k=>k.clearMtmGroups).subscribe(k=>{k>0&&yu()}),hp(l,k=>k.clearObvGroups).subscribe(k=>{k>0&&Kc()}),hp(l,k=>k.clearPsyGroups).subscribe(k=>{k>0&&fd()}),hp(l,k=>k.clearPvtGroups).subscribe(k=>{k>0&&ic()}),hp(l,k=>k.clearRocGroups).subscribe(k=>{k>0&&Df()}),hp(l,k=>k.clearVolGroups).subscribe(k=>{k>0&&Lc()}),hp(l,k=>k.clearWrGroups).subscribe(k=>{k>0&&Ad()});function Wl(k){i(Nu)||u.length<=1||(u.splice(k,1),d.splice(k,1),h.splice(k,1),i(Au)?Ln():i(Yd)&&un())}function Dl(){const k=s();if(!k)return;const A=[6],B=k.createIndicator({name:"BIAS",calcParams:A,createTooltipDataSource:({indicator:ve})=>{const Re=[ve.visible?1:0,2,3],rt=k.getStyles().indicator.tooltip;return{icons:Re.map(ls=>rt.features[ls])}}},!1,{axis:{gap:{bottom:2}}});if(!B)return;const R=B,U={name:"BIAS",pane_id:R,params:A},q=`${R}_BIAS`;c.update(ve=>(ve.saveInds[q]=U,ve)),a(!1)}function gd(){const k=s();if(!k)return;const A=[5,34],B=k.createIndicator({name:"AO",calcParams:A,createTooltipDataSource:({indicator:ve})=>{const Re=[ve.visible?1:0,2,3],rt=k.getStyles().indicator.tooltip;return{icons:Re.map(ls=>rt.features[ls])}}},!1,{axis:{gap:{bottom:2}}});if(B){const ve=k.getStyles();k.setStyles({...ve,indicator:{...ve.indicator,bars:[{upColor:"#8B5CF6",downColor:"#EF4444",noChangeColor:"#8B5CF6"}]}})}if(!B)return;const R=B,U={name:"AO",pane_id:R,params:A},q=`${R}_AO`;c.update(ve=>(ve.saveInds[q]=U,ve)),a(!1)}function Lh(){const k=s();if(!k)return;const A=[14],B=k.createIndicator({name:"WR",calcParams:A,createTooltipDataSource:({indicator:ve})=>{const Re=[ve.visible?1:0,2,3],rt=k.getStyles().indicator.tooltip;return{icons:Re.map(ls=>rt.features[ls])}}},!1,{axis:{gap:{bottom:2}}});if(!B)return;const R=B,U={name:"WR",pane_id:R,params:A},q=`${R}_WR`;c.update(ve=>(ve.saveInds[q]=U,ve)),a(!1)}function gh(){const k=s();if(!k)return;const A=[15,9],B=k.createIndicator({name:"TRIX",calcParams:A,createTooltipDataSource:({indicator:ve})=>{const Re=[ve.visible?1:0,2,3],rt=k.getStyles().indicator.tooltip;return{icons:Re.map(ls=>rt.features[ls])}}},!1,{axis:{gap:{bottom:2}}});if(!B)return;const R=B,U={name:"TRIX",pane_id:R,params:A},q=`${R}_TRIX`;c.update(ve=>(ve.saveInds[q]=U,ve)),a(!1)}function Bv(){var B;if(!i(we))return;const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="CR").sort((R,U)=>R===`${o().editPaneId}_CR`?-1:U===`${o().editPaneId}_CR`?1:R.localeCompare(U));console.log("🔧 Applying CR changes. Existing keys:",k),console.log("🔧 Current CR groups:",i(Cr).length);const A=i(Cr).length;if(k.length>A)for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];try{console.log("🗑️ Removing excess CR indicator from pane:",q.pane_id),(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"CR"})}catch(ve){console.log("❌ Error removing excess CR indicator:",ve)}delete r().saveInds[U]}i(Cr).forEach((R,U)=>{var Re,rt,Ut;const q=[R.crPeriod,R.crMa1Period,R.crMa2Period,R.crMa3Period,R.crMa4Period],ve={lines:[{color:R.styles.cr.color,size:R.styles.cr.thickness,style:R.styles.cr.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.cr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:R.styles.ma1.color,size:R.styles.ma1.thickness,style:R.styles.ma1.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.ma1.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:R.styles.ma2.color,size:R.styles.ma2.thickness,style:R.styles.ma2.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.ma2.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:R.styles.ma3.color,size:R.styles.ma3.thickness,style:R.styles.ma3.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.ma3.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:R.styles.ma4.color,size:R.styles.ma4.thickness,style:R.styles.ma4.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.ma4.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if(U===0)console.log("🔄 Updating first CR in pane:",o().editPaneId),(Re=s())==null||Re.overrideIndicator({name:"CR",calcParams:q,styles:ve,paneId:o().editPaneId});else{const ls=`pane_CR_${U+1}_CR`,ns=k.find(Mn=>Mn===ls);if(ns){const Mn=r().saveInds[ns];console.log("🔄 Updating existing CR in pane:",Mn.pane_id),(rt=s())==null||rt.overrideIndicator({name:"CR",calcParams:q,styles:ve,paneId:Mn.pane_id})}else{const Mn=`pane_CR_${U+1}`;console.log("🆕 Creating new CR in pane:",Mn);const qo=(Ut=s())==null?void 0:Ut.createIndicator({name:"CR",calcParams:q,styles:ve},!0,{id:Mn});console.log("✅ Created new CR indicator with ID:",qo,"in pane:",Mn)}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="CR"&&delete R.saveInds[U]}),i(Cr).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_CR`:`pane_CR_${q+1}_CR`,Re=q===0?o().editPaneId:`pane_CR_${q+1}`,rt={name:"CR",crGroup:U,pane_id:Re,groupIndex:q,crGroups:q===0?[...i(Cr)]:void 0,params:[U.crPeriod,U.crMa1Period,U.crMa2Period,U.crMa3Period,U.crMa4Period]};R.saveInds[ve]=rt,console.log("💾 Saved CR group",q,"with key:",ve,"and pane ID:",Re)}),R)),l.update(R=>(R.editIndName="",R.editPaneId="",R.modalIndCfg=!1,R)),a(!1)}function Eh(){i(Lu).forEach((k,A)=>{qh(A)}),c.update(k=>(Object.keys(k.saveInds).forEach(A=>{k.saveInds[A].name==="MACD"&&delete k.saveInds[A]}),i(Lu).forEach((A,B)=>{const R=B===0?`${o().editPaneId}_MACD`:`pane_MACD_${B+1}_MACD`,U=B===0?o().editPaneId:A.actualPaneId||`pane_MACD_${B+1}`;k.saveInds[R]={name:"MACD",macdGroup:A,pane_id:U,groupIndex:B,params:[A.fastPeriod,A.slowPeriod,A.signalPeriod]}}),k)),console.log("🔄 Clearing edit state and closing popup..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),k)),a(!1)}function Ip(){if(i(Gd)){i(Ju).forEach((k,A)=>{k.paneId&&sp(A)}),c.update(k=>{const A=`${o().editPaneId}_WR`,B={name:"WR",wrGroups:i(Ju),pane_id:o().editPaneId};return k.saveInds[A]=B,i(Ju).forEach((R,U)=>{const q=U===0?`${o().editPaneId}_WR_single`:`WR_${U+1}`,ve={name:"WR",wrGroup:R,pane_id:U===0?o().editPaneId:`new_pane_${U}`,groupIndex:U};k.saveInds[q]=ve}),k});try{console.log("🔄 Clearing edit state and closing popup..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),k)),a(!1),console.log("✅ Popup show flag set to false - handleKdjConfirm completed successfully")}catch(k){console.error("❌ Error in handleKdjConfirm:",k),console.log("🔄 Forcing popup close due to error..."),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1),console.log("✅ Popup forcefully closed after error")}}}function Vp(){i(tu)&&(i(Dd).forEach((k,A)=>{var U;const B=[k.period,k.shortPeriod,k.longPeriod],R={lines:[{color:k.styles.vr.color,size:k.styles.vr.thickness,style:k.styles.vr.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:k.styles.vr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:k.styles.vrShort.color,size:k.styles.vrShort.thickness,style:k.styles.vrShort.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:k.styles.vrShort.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:k.styles.vrLong.color,size:k.styles.vrLong.thickness,style:k.styles.vrLong.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:k.styles.vrLong.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};k.paneId&&((U=s())==null||U.overrideIndicator({name:"VR",calcParams:B,styles:R,paneId:k.paneId}),console.log(`✅ Updated VR indicator in pane: ${k.paneId}`))}),c.update(k=>(i(Dd).forEach((A,B)=>{const R=`${A.paneId}_VR`,U={name:"VR",vrGroup:A,pane_id:A.paneId,params:[A.period,A.shortPeriod,A.longPeriod],groupIndex:B};k.saveInds[R]=U,console.log(`💾 Saved VR group to: ${R}`)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function $h(){i(Tu)&&(i(St).forEach((k,A)=>{var U;const B=[k.period],R={bars:[{upColor:k.styles.histogram.upColor,downColor:k.styles.histogram.downColor,noChangeColor:k.styles.histogram.upColor}],lines:[{color:k.styles.ema.color,size:k.styles.ema.thickness,style:k.styles.ema.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:k.styles.ema.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1,visible:k.styles.ema.visible===!0}]};k.paneId&&((U=s())==null||U.overrideIndicator({name:"VOL",calcParams:B,styles:R,paneId:k.paneId}),console.log(`✅ Updated Volume indicator in pane: ${k.paneId}`))}),c.update(k=>(i(St).forEach((A,B)=>{const R=`${A.paneId}_VOL`,U={name:"VOL",volGroup:A,pane_id:A.paneId,params:[A.period],groupIndex:B};k.saveInds[R]=U,console.log(`💾 Saved Volume group to: ${R}`)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function cv(){i(Vc)&&(console.log("🔧 Applying BBI changes. Current BBI groups:",i(Rd).length),i(Rd).forEach((k,A)=>{var Re;const B=[k.period1,k.period2,k.period3,k.period4],U=(rt=>{switch(rt){case"dashed":return{style:vt.Dashed,dashedValue:[4,4]};case"dotted":return{style:vt.Dashed,dashedValue:[2,2]};default:return{style:vt.Solid,dashedValue:[2,2]}}})(k.lineStyle),q={lines:[{color:k.color,size:k.thickness,style:U.style,dashedValue:U.dashedValue,smooth:!1}]},ve=k.paneId||(A===0?o().editPaneId:`pane_BBI_${A+1}`);console.log("🔄 Updating BBI group",A,"in pane:",ve),(Re=s())==null||Re.overrideIndicator({name:"BBI",calcParams:B,styles:q,paneId:ve}),k.paneId||(k.paneId=ve)}),c.update(k=>(Object.keys(k.saveInds).forEach(A=>{k.saveInds[A].name==="BBI"&&delete k.saveInds[A]}),i(Rd).forEach((A,B)=>{const R=`${A.paneId}_BBI`,U={name:"BBI",bbiGroup:A,pane_id:A.paneId,groupIndex:B,bbiGroups:B===0?[...i(Rd)]:void 0,params:[A.period1,A.period2,A.period3,A.period4]};k.saveInds[R]=U,console.log("💾 Saved BBI group",B,"with key:",R,"and pane ID:",A.paneId)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function Dh(){var k;if(!i(ee)){console.warn("⚠️ handleEmvConfirm called but not in EMV mode");return}try{if(!i(gr)||i(gr).length===0){console.error("❌ No EMV groups to process");return}const A=i(gr).filter(U=>!(!U||typeof U!="object"||typeof U.period!="number"||U.period<=0||typeof U.period2!="number"||U.period2<=0||typeof U.color!="string"||!U.color||typeof U.thickness!="number"||U.thickness<=0||typeof U.lineStyle!="string"||!U.lineStyle));if(A.length===0){console.error("❌ No valid EMV groups found");return}A.length!==i(gr).length&&(console.warn(`⚠️ ${i(gr).length-A.length} invalid EMV groups filtered out`),x(gr,V(A)));const B=Object.keys(r().saveInds).filter(U=>r().saveInds[U]&&r().saveInds[U].name==="EMV").sort((U,q)=>U===`${o().editPaneId}_EMV`?-1:q===`${o().editPaneId}_EMV`?1:U.localeCompare(q));console.log("🔧 Applying EMV changes. Existing keys:",B),console.log("🔧 Current EMV groups:",i(gr).length);const R=i(gr).length;if(B.length>R)for(let U=R;U<B.length;(U+=1)-1){const q=B[U],ve=r().saveInds[q];if(ve&&ve.pane_id)try{console.log("🗑️ Removing excess EMV indicator from pane:",ve.pane_id),(k=s())==null||k.removeIndicator({paneId:ve.pane_id,name:"EMV"})}catch(Re){console.log("❌ Error removing excess EMV indicator:",Re)}}i(gr).forEach((U,q)=>{var rt,Ut,ls;const ve=[U.period,U.period2],Re={lines:[{color:U.color,size:U.thickness,style:U.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:U.lineStyle==="dashed"?[4,4]:U.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(q===0)console.log("🔄 Updating first EMV in pane:",o().editPaneId),(rt=s())==null||rt.overrideIndicator({name:"EMV",calcParams:ve,styles:Re,paneId:o().editPaneId});else{const ns=`pane_EMV_${q+1}_EMV`,Mn=B.find(qo=>qo===ns);if(Mn){const qo=r().saveInds[Mn];qo&&qo.pane_id&&(console.log("🔄 Updating existing EMV in pane:",qo.pane_id),(Ut=s())==null||Ut.overrideIndicator({name:"EMV",calcParams:ve,styles:Re,paneId:qo.pane_id}))}else{const qo=`pane_EMV_${q+1}`;console.log("🆕 Creating new EMV in pane:",qo);const Yo=(ls=s())==null?void 0:ls.createIndicator({name:"EMV",calcParams:ve,styles:Re},!0,{id:qo});Yo&&console.log("✅ Created new EMV indicator with ID:",Yo,"in pane:",qo)}}}),c.update(U=>{try{Object.keys(U.saveInds).forEach(q=>{U.saveInds[q]&&U.saveInds[q].name==="EMV"&&delete U.saveInds[q]}),i(gr).forEach((q,ve)=>{try{const Re=ve===0?`${o().editPaneId}_EMV`:`pane_EMV_${ve+1}_EMV`,rt=ve===0?o().editPaneId:`pane_EMV_${ve+1}`;if(!Re||!rt){console.error(`❌ Invalid save key or pane ID for EMV group ${ve}`);return}const Ut={name:"EMV",emvGroup:q,pane_id:rt,groupIndex:ve,emvGroups:ve===0?[...i(gr)]:void 0,params:[q.period,q.period2]};U.saveInds[Re]=Ut,console.log("💾 Saved EMV group",ve,"with key:",Re,"and pane ID:",rt)}catch(Re){console.error(`❌ Error saving EMV group ${ve}:`,Re)}})}catch(q){console.error("❌ Error in EMV save operation:",q)}return U}),l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),a(!1),console.log("✅ EMV configuration completed successfully")}catch(A){console.error("❌ Critical error in handleEmvConfirm:",A)}}function um(){var k;if(!i(Ee)){console.warn("⚠️ handleMtmConfirm called but not in MTM mode");return}try{if(!i(pr)||i(pr).length===0){console.error("❌ No MTM groups to process");return}const A=i(pr).filter(U=>!(!U||typeof U!="object"||typeof U.period!="number"||U.period<=0||typeof U.color!="string"||!U.color||typeof U.thickness!="number"||U.thickness<=0||typeof U.lineStyle!="string"||!U.lineStyle));if(A.length===0){console.error("❌ No valid MTM groups found");return}A.length!==i(pr).length&&(console.warn(`⚠️ ${i(pr).length-A.length} invalid MTM groups filtered out`),x(pr,V(A)));const B=Object.keys(r().saveInds).filter(U=>r().saveInds[U]&&r().saveInds[U].name==="MTM").sort((U,q)=>U===`${o().editPaneId}_MTM`?-1:q===`${o().editPaneId}_MTM`?1:U.localeCompare(q));console.log("🔧 Applying MTM changes. Existing keys:",B),console.log("🔧 Current MTM groups:",i(pr).length);const R=i(pr).length;if(B.length>R)for(let U=R;U<B.length;(U+=1)-1){const q=B[U],ve=r().saveInds[q];if(ve&&ve.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",ve.pane_id),(k=s())==null||k.removeIndicator({paneId:ve.pane_id,name:"MTM"})}catch(Re){console.log("❌ Error removing excess MTM indicator:",Re)}}i(pr).forEach((U,q)=>{var rt,Ut,ls;const ve=[U.period],Re={lines:[{color:U.color,size:U.thickness,style:U.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:U.lineStyle==="dashed"?[4,4]:U.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(q===0)console.log("🔄 Updating first MTM in pane:",o().editPaneId),(rt=s())==null||rt.overrideIndicator({name:"MTM",calcParams:ve,styles:Re,paneId:o().editPaneId});else{const ns=`pane_MTM_${q+1}_MTM`,Mn=B.find(qo=>qo===ns);if(Mn){const qo=r().saveInds[Mn];qo&&qo.pane_id&&(console.log("🔄 Updating existing MTM in pane:",qo.pane_id),(Ut=s())==null||Ut.overrideIndicator({name:"MTM",calcParams:ve,styles:Re,paneId:qo.pane_id}))}else{const qo=`pane_MTM_${q+1}`;console.log("🆕 Creating new MTM in pane:",qo);const Yo=(ls=s())==null?void 0:ls.createIndicator({name:"MTM",calcParams:ve,styles:Re},!0,{id:qo});Yo&&console.log("✅ Created new MTM indicator with ID:",Yo,"in pane:",qo)}}}),c.update(U=>{try{Object.keys(U.saveInds).forEach(q=>{U.saveInds[q]&&U.saveInds[q].name==="MTM"&&delete U.saveInds[q]}),i(pr).forEach((q,ve)=>{try{const Re=ve===0?`${o().editPaneId}_MTM`:`pane_MTM_${ve+1}_MTM`,rt=ve===0?o().editPaneId:`pane_MTM_${ve+1}`;if(!Re||!rt){console.error(`❌ Invalid save key or pane ID for MTM group ${ve}`);return}const Ut={name:"MTM",mtmGroup:q,pane_id:rt,groupIndex:ve,mtmGroups:ve===0?[...i(pr)]:void 0,params:[q.period]};U.saveInds[Re]=Ut,console.log("💾 Saved MTM group",ve,"with key:",Re,"and pane ID:",rt)}catch(Re){console.error(`❌ Error saving MTM group ${ve}:`,Re)}})}catch(q){console.error("❌ Error in MTM save operation:",q)}return U}),l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),a(!1),console.log("✅ MTM configuration completed successfully")}catch(A){console.error("❌ Critical error in handleMtmConfirm:",A)}}function Ov(){var B;if(!i(td))return;const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="BIAS").sort((R,U)=>R===`${o().editPaneId}_BIAS`?-1:U===`${o().editPaneId}_BIAS`?1:R.localeCompare(U));console.log("🔧 Applying BIAS changes. Existing keys:",k),console.log("🔧 Current BIAS groups:",i(so).length);const A=i(so).length;if(k.length>A)for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];if(q&&q.pane_id)try{console.log("🗑️ Removing excess BIAS indicator from pane:",q.pane_id),(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"BIAS"})}catch(ve){console.log("❌ Error removing excess BIAS indicator:",ve)}}i(so).forEach((R,U)=>{var Re,rt,Ut;const q=[R.period],ve={lines:[{color:R.color,size:R.thickness,style:R.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:R.lineStyle==="dashed"?[4,4]:R.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(U===0)console.log("🔄 Updating first BIAS in pane:",o().editPaneId),(Re=s())==null||Re.overrideIndicator({name:"BIAS",calcParams:q,styles:ve,paneId:o().editPaneId});else{const ls=`pane_BIAS_${U+1}_BIAS`,ns=k.find(Mn=>Mn===ls);if(ns){const Mn=r().saveInds[ns];Mn&&Mn.pane_id&&(console.log("🔄 Updating existing BIAS in pane:",Mn.pane_id),(rt=s())==null||rt.overrideIndicator({name:"BIAS",calcParams:q,styles:ve,paneId:Mn.pane_id}))}else{const Mn=`pane_BIAS_${U+1}`;console.log("🆕 Creating new BIAS in pane:",Mn);const qo=(Ut=s())==null?void 0:Ut.createIndicator({name:"BIAS",calcParams:q,styles:ve},!0,{id:Mn});qo&&console.log("✅ Created new BIAS indicator with ID:",qo,"in pane:",Mn)}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="BIAS"&&delete R.saveInds[U]}),i(so).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_BIAS`:`pane_BIAS_${q+1}_BIAS`,Re=q===0?o().editPaneId:`pane_BIAS_${q+1}`,rt={name:"BIAS",biasGroup:U,pane_id:Re,groupIndex:q,biasGroups:q===0?[...i(so)]:void 0,params:[U.period]};R.saveInds[ve]=rt,console.log("💾 Saved BIAS group",q,"with key:",ve,"and pane ID:",Re)}),R)),l.update(R=>(R.editIndName="",R.editPaneId="",R.modalIndCfg=!1,R)),a(!1),console.log("✅ BIAS configuration saved successfully")}function Rh(){if(!i(ke))return;const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="CCI").sort((q,ve)=>q===`${o().editPaneId}_CCI`?-1:ve===`${o().editPaneId}_CCI`?1:q.localeCompare(ve));console.log("🔧 Applying CCI changes. Existing keys:",k),console.log("🔧 Current CCI groups:",i(mo).length);const A=new Map,B=[],R=new Set;i(mo).forEach((q,ve)=>{let Re=null;for(const rt of k){if(R.has(rt))continue;const Ut=r().saveInds[rt];if(Ut&&Ut.cciGroup&&(Ut.cciGroup.id===q.id||Ut.cciGroup.period===q.period&&Ut.cciGroup.color===q.color&&Ut.cciGroup.thickness===q.thickness&&Ut.cciGroup.lineStyle===q.lineStyle)){Re=rt,R.add(rt);break}}if(!Re){let rt=ve+1,Ut;do Ut=rt===1?`${o().editPaneId}_CCI`:`pane_CCI_${rt}_CCI`,rt+=1;while(R.has(Ut)||k.includes(Ut));Re=Ut,R.add(Re)}A.set(q.id,Re),B.push(Re)});const U=k.filter(q=>!B.includes(q));U.forEach(q=>{var Re;const ve=r().saveInds[q];if(ve&&ve.pane_id)try{console.log("🗑️ Removing CCI indicator from pane:",ve.pane_id,"key:",q),(Re=s())==null||Re.removeIndicator({paneId:ve.pane_id,name:"CCI"})}catch(rt){console.log("❌ Error removing CCI indicator:",rt)}}),i(mo).forEach((q,ve)=>{var ns,Mn;const Re=[q.period],rt={lines:[{color:q.color,size:q.thickness,style:q.lineStyle==="solid"?vt.Solid:vt.Dashed,dashedValue:q.lineStyle==="dashed"?[4,4]:q.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},Ut=A.get(q.id),ls=r().saveInds[Ut];if(ls&&ls.pane_id)console.log("🔄 Updating existing CCI in pane:",ls.pane_id,"with key:",Ut),(ns=s())==null||ns.overrideIndicator({name:"CCI",calcParams:Re,styles:rt,paneId:ls.pane_id});else{const qo=Ut===`${o().editPaneId}_CCI`?o().editPaneId:Ut.replace("_CCI","");console.log("🆕 Creating new CCI in pane:",qo,"with key:",Ut);const Yo=(Mn=s())==null?void 0:Mn.createIndicator({name:"CCI",calcParams:Re,styles:rt},!0,{id:qo});Yo&&console.log("✅ Created new CCI indicator with ID:",Yo,"in pane:",qo)}}),c.update(q=>(U.forEach(ve=>{delete q.saveInds[ve],console.log("🗑️ Deleted save data for key:",ve)}),i(mo).forEach((ve,Re)=>{const rt=A.get(ve.id),Ut=rt===`${o().editPaneId}_CCI`?o().editPaneId:rt.replace("_CCI",""),ls={name:"CCI",cciGroup:ve,pane_id:Ut,groupIndex:Re,cciGroups:Re===0?[...i(mo)]:void 0,params:[ve.period]};q.saveInds[rt]=ls,console.log("💾 Saved CCI group",Re,"with key:",rt,"and pane ID:",Ut)}),q)),l.update(q=>(q.editIndName="",q.editPaneId="",q.modalIndCfg=!1,q)),a(!1),console.log("✅ CCI configuration saved successfully")}function zv(){i(bd)&&(go(),c.update(k=>(Object.keys(k.saveInds).forEach(A=>{k.saveInds[A].name==="SAR"&&delete k.saveInds[A]}),i(_c).forEach((A,B)=>{const R=B===0?"candle_pane_SAR":`SAR_${B+1}`,U={name:"SAR",sarGroup:A,pane_id:"candle_pane",groupIndex:B,sarGroups:B===0?[...i(_c)]:void 0,params:[A.start,A.increment,A.maxValue]};k.saveInds[R]=U}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function kv(){i(Nt)&&(Eu(),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function _h(){var B;if(!i(gc))return;const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="DMI").sort((R,U)=>R===`${o().editPaneId}_DMI`?-1:U===`${o().editPaneId}_DMI`?1:R.localeCompare(U));console.log("🔧 Applying DMI changes. Existing keys:",k),console.log("🔧 Current DMI groups:",i(El).length);const A=i(El).length;if(k.length>A)for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];try{console.log("🗑️ Removing excess DMI indicator from pane:",q.pane_id),(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"DMI"})}catch(ve){console.log("❌ Error removing excess DMI indicator:",ve)}delete r().saveInds[U]}i(El).forEach((R,U)=>{var Re,rt,Ut;const q=[R.diPeriod,R.adxPeriod],ve={lines:[{color:R.styles.diPlus.color,size:R.styles.diPlus.thickness,style:R.styles.diPlus.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.diPlus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:R.styles.diMinus.color,size:R.styles.diMinus.thickness,style:R.styles.diMinus.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.diMinus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:R.styles.adx.color,size:R.styles.adx.thickness,style:R.styles.adx.lineStyle==="dashed"?vt.Dashed:vt.Solid,dashedValue:R.styles.adx.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if(U===0)console.log("🔄 Updating first DMI in pane:",o().editPaneId),(Re=s())==null||Re.overrideIndicator({name:"DMI",calcParams:q,styles:ve,paneId:o().editPaneId});else{const ls=`pane_DMI_${U+1}_DMI`,ns=k.find(Mn=>Mn===ls);if(ns){const Mn=r().saveInds[ns];console.log("🔄 Updating existing DMI in pane:",Mn.pane_id),(rt=s())==null||rt.overrideIndicator({name:"DMI",calcParams:q,styles:ve,paneId:Mn.pane_id})}else{const Mn=`pane_DMI_${U+1}`;console.log("🆕 Creating new DMI in pane:",Mn);const qo=(Ut=s())==null?void 0:Ut.createIndicator({name:"DMI",calcParams:q,styles:ve},!0,{id:Mn});console.log("✅ Created new DMI indicator with ID:",qo,"in pane:",Mn)}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="DMI"&&delete R.saveInds[U]}),i(El).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_DMI`:`pane_DMI_${q+1}_DMI`,Re=q===0?o().editPaneId:`pane_DMI_${q+1}`,rt={name:"DMI",dmiGroup:U,pane_id:Re,groupIndex:q,dmiGroups:q===0?[...i(El)]:void 0,params:[U.diPeriod,U.adxPeriod]};R.saveInds[ve]=rt,console.log("💾 Saved DMI group",q,"with key:",ve,"and pane ID:",Re)}),R)),l.update(R=>(R.editIndName="",R.editPaneId="",R.modalIndCfg=!1,R)),a(!1)}function km(k){var ve,Re;const A=i(Rr)[k];if(!A||!s()){console.warn("❌ updatePvtIndicator: Missing group or chart",{group:A,chart:!!s()});return}console.log("🔄 updatePvtIndicator called:",{groupIndex:k,group:A});let B=vt.Solid,R=[2,2];A.lineStyle==="dashed"?(B=vt.Dashed,R=[4,4]):A.lineStyle==="dotted"&&(B=vt.Dashed,R=[2,2]);const q=((ve=s())==null?void 0:ve.getIndicators()).filter(rt=>rt.name==="PVT");if(console.log("📊 Found PVT indicators on chart:",q.length),console.log("📊 Looking for group index:",k),q.length>k){const rt=q[k];console.log("✅ Found matching PVT indicator by index, updating styles...");const Ut=(Re=s())==null?void 0:Re.overrideIndicator({name:"PVT",paneId:rt.paneId,styles:{lines:[{color:A.color,size:A.thickness,style:B,dashedValue:R,smooth:!1}]},figures:[{key:"pvt",title:"PVT: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Ut),console.log("🎨 Applied styles:",{color:A.color,size:A.thickness,style:B,dashedValue:R});const ls=`${rt.paneId}_PVT`;console.log("💾 Using save key:",ls),c.update(ns=>{ns.saveInds[ls]||(ns.saveInds[ls]={name:"PVT",pane_id:rt.paneId,pvtGroups:[]}),ns.saveInds[ls].pvtGroups||(ns.saveInds[ls].pvtGroups=[]);const Mn=ns.saveInds[ls].pvtGroups||[];for(;Mn.length<=k;)Mn.push({});return Mn[k]={...A},ns.saveInds[ls].pvtGroups=Mn,console.log("💾 Persisted PVT changes to save data:",ls,A),ns}),console.log("✅ PVT indicator updated successfully:",k,A)}else console.error("❌ PVT indicator not found on chart for group index:",k),console.log("📊 Available PVT indicators:",q.length),console.log("📊 Requested group index:",k)}function uv(k){if(!i(qu)||!s()||k<0||k>=i(fu).length)return;const A=i(fu)[k];console.log("🔄 Updating TRIX indicator:",k,A);try{let R=function(Re){let rt=vt.Solid,Ut=[2,2];return Re==="dashed"?(rt=vt.Dashed,Ut=[4,4]):Re==="dotted"&&(rt=vt.Dashed,Ut=[2,2]),{lineStyle:rt,dashedValue:Ut}},B=A.paneId||o().editPaneId;console.log("🔍 Using pane ID for TRIX update:",B,"for group:",k),s().removeIndicator({paneId:B,name:"TRIX"});const U=R(A.styles.trix.lineStyle),q=R(A.styles.signal.lineStyle);if(s().createIndicator({name:"TRIX",calcParams:[A.trixPeriod,A.signalPeriod],styles:{lines:[{color:A.styles.trix.color,size:A.styles.trix.thickness,style:U.lineStyle,dashedValue:U.dashedValue},{color:A.styles.signal.color,size:A.styles.signal.thickness,style:q.lineStyle,dashedValue:q.dashedValue}]}},B===o().editPaneId,{id:B})){const Re=`${B}_TRIX`;c.update(rt=>(rt.saveInds[Re]?rt.saveInds[Re].params=[A.trixPeriod,A.signalPeriod]:rt.saveInds[Re]={name:"TRIX",pane_id:B,params:[A.trixPeriod,A.signalPeriod]},rt.saveInds[Re].trixGroup={...A},rt))}console.log("✅ TRIX indicator updated successfully:",k)}catch(B){console.error("❌ Error updating TRIX indicator:",B)}}function Vv(){var B;if(!i($d)||!s())return;const A=((B=s())==null?void 0:B.getIndicators()).filter(R=>R.name==="ROC");console.log("📊 Found ROC indicators on chart:",A.length),console.log("📊 ROC groups to apply:",i(ba).length),i(ba).forEach((R,U)=>{var Ut,ls;const q=[R.period];let ve=vt.Solid,Re=[2,2];R.styles.roc.lineStyle==="dashed"?(ve=vt.Dashed,Re=[4,4]):R.styles.roc.lineStyle==="dotted"&&(ve=vt.Dashed,Re=[2,2]);const rt=A[U];if(rt){console.log(`🎨 Updating existing ROC indicator ${U} in pane:`,rt.paneId);const ns=(Ut=s())==null?void 0:Ut.overrideIndicator({name:"ROC",paneId:rt.paneId,calcParams:q,styles:{lines:[{color:R.styles.roc.color,size:R.styles.roc.thickness,style:ve,dashedValue:Re,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",ns);const Mn=`${rt.paneId}_ROC`;c.update(qo=>{qo.saveInds[Mn]||(qo.saveInds[Mn]={name:"ROC",pane_id:rt.paneId,params:q,rocGroups:[]}),qo.saveInds[Mn].rocGroups||(qo.saveInds[Mn].rocGroups=[]);const Yo=qo.saveInds[Mn].rocGroups||[];for(;Yo.length<=U;)Yo.push({});return Yo[U]={...R},qo.saveInds[Mn].rocGroups=Yo,qo.saveInds[Mn].params=q,console.log("💾 Persisted ROC changes to save data:",Mn,R),qo}),console.log("✅ ROC indicator updated successfully:",U,R)}else{console.log(`➕ Creating new ROC indicator for group ${U}`);const ns={name:"ROC",calcParams:q,styles:{lines:[{color:R.styles.roc.color,size:R.styles.roc.thickness,style:ve,dashedValue:Re,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]};(ls=s())==null||ls.createIndicator(ns,!1,{axis:{gap:{bottom:2}}})}}),l.update(R=>(R.editIndName="",R.editPaneId="",R.modalIndCfg=!1,R)),a(!1)}function ug(){var B;if(!i(Pf))return;const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="PSY").sort((R,U)=>R===`${o().editPaneId}_PSY`?-1:U===`${o().editPaneId}_PSY`?1:R.localeCompare(U)),A=i(Zr).length;if(k.length>A)for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];if(q&&q.pane_id)try{(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"PSY"})}catch(ve){console.log("Error removing excess PSY indicator:",ve)}}i(Zr).forEach((R,U)=>{var ns,Mn,qo;const q=[R.psyPeriod,R.mapsyPeriod],ve=[{key:"psy",title:"PSY: ",type:"line"}];R.showMapsy&&ve.push({key:"mapsy",title:"MAPSY: ",type:"line"});const Re={lines:[]};let rt=vt.Solid,Ut=[2,2];if(R.styles.psy.lineStyle==="dashed"?(rt=vt.Dashed,Ut=[4,4]):R.styles.psy.lineStyle==="dotted"&&(rt=vt.Dashed,Ut=[2,2]),Re.lines.push({color:R.styles.psy.color,size:R.styles.psy.thickness,style:rt,dashedValue:Ut,smooth:!1}),R.showMapsy){let Yo=vt.Solid,Nc=[2,2];R.styles.mapsy.lineStyle==="dashed"?(Yo=vt.Dashed,Nc=[4,4]):R.styles.mapsy.lineStyle==="dotted"&&(Yo=vt.Dashed,Nc=[2,2]),Re.lines.push({color:R.styles.mapsy.color,size:R.styles.mapsy.thickness,style:Yo,dashedValue:Nc,smooth:!1})}const ls={name:"PSY",calcParams:q,styles:Re,figures:ve};if(U===0)(ns=s())==null||ns.overrideIndicator({...ls,paneId:o().editPaneId});else{const Yo=`psy_${String(U+1).padStart(3,"0")}_PSY`,Nc=k.find(jd=>jd===Yo);if(Nc){const jd=r().saveInds[Nc];jd&&jd.pane_id&&((Mn=s())==null||Mn.overrideIndicator({...ls,paneId:jd.pane_id}))}else{const jd=`psy_${String(U+1).padStart(3,"0")}`;((qo=s())==null?void 0:qo.createIndicator(ls,!1,{id:jd,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${U+1} created with pane ID:`,jd),R.actualPaneId=jd)}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="PSY"&&delete R.saveInds[U]}),i(Zr).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_PSY`:`psy_${String(q+1).padStart(3,"0")}_PSY`,Re=q===0?o().editPaneId:U.actualPaneId||`psy_${String(q+1).padStart(3,"0")}`;R.saveInds[ve]={name:"PSY",psyGroup:U,pane_id:Re,groupIndex:q,params:[U.psyPeriod,U.mapsyPeriod]}}),R)),l.update(R=>(R.editIndName="",R.editPaneId="",R.modalIndCfg=!1,R)),a(!1)}function Wv(){if(!i(oe))return;const k=Object.keys(r().saveInds).filter(A=>r().saveInds[A].name==="OBV");i(Qi).forEach((A,B)=>{var Ut,ls,ns;const R=[A.obvPeriod,A.maobvPeriod],U=[{key:"obv",title:"OBV: ",type:"line"}];A.showMaobv&&U.push({key:"maobv",title:"MAOBV: ",type:"line"});const q={lines:[]};let ve=vt.Solid,Re=[2,2];if(A.styles.obv.lineStyle==="dashed"?(ve=vt.Dashed,Re=[4,4]):A.styles.obv.lineStyle==="dotted"&&(ve=vt.Dashed,Re=[2,2]),q.lines.push({color:A.styles.obv.color,size:A.styles.obv.thickness,style:ve,dashedValue:Re,smooth:!1}),A.showMaobv){let Mn=vt.Solid,qo=[2,2];A.styles.maobv.lineStyle==="dashed"?(Mn=vt.Dashed,qo=[4,4]):A.styles.maobv.lineStyle==="dotted"&&(Mn=vt.Dashed,qo=[2,2]),q.lines.push({color:A.styles.maobv.color,size:A.styles.maobv.thickness,style:Mn,dashedValue:qo,smooth:!1})}const rt={name:"OBV",calcParams:R,styles:q,figures:U};if(B===0)(Ut=s())==null||Ut.overrideIndicator({...rt,paneId:o().editPaneId});else{const Mn=`pane_OBV_${B+1}_OBV`,qo=k.find(Yo=>Yo===Mn);if(qo){const Yo=r().saveInds[qo];Yo&&Yo.pane_id&&((ls=s())==null||ls.overrideIndicator({...rt,paneId:Yo.pane_id}))}else{const Yo=`pane_OBV_${B+1}`;((ns=s())==null?void 0:ns.createIndicator(rt,!1,{id:Yo,axis:{gap:{bottom:2}}}))&&(console.log(`✅ OBV ${B+1} created with pane ID:`,Yo),A.actualPaneId=Yo)}}}),c.update(A=>(Object.keys(A.saveInds).forEach(B=>{A.saveInds[B].name==="OBV"&&delete A.saveInds[B]}),i(Qi).forEach((B,R)=>{const U=R===0?`${o().editPaneId}_OBV`:`pane_OBV_${R+1}_OBV`,q=R===0?o().editPaneId:B.actualPaneId||`pane_OBV_${R+1}`,ve={name:"OBV",obvGroup:B,pane_id:q,groupIndex:R,obvGroups:R===0?[...i(Qi)]:void 0,params:[B.obvPeriod,B.maobvPeriod]};A.saveInds[U]=ve}),A)),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1)}function dg(){if(console.log("🚀 handleKdjConfirm started"),!i(re)){console.log("❌ Not KDJ indicator, returning early");return}try{console.log("🔄 Applying KDJ changes, groups:",i(os).length),console.log("📊 Current KDJ groups data:",JSON.parse(JSON.stringify(i(os)))),console.log("🔄 Preserving existing indicators and updating with current values"),i(os).forEach((k,A)=>{console.log(`🔄 Applying KDJ group ${A+1} with current values`),fp(A)}),c.update(k=>(i(os).forEach((A,B)=>{const R=B===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${B+1}_KDJ`,U=B===0?o().editPaneId:A.actualPaneId||`pane_KDJ_${B+1}`;console.log(`💾 Updating saved KDJ group ${B+1} with key:`,R,"pane ID:",U),k.saveInds[R]={name:"KDJ",kdjGroup:A,pane_id:U,groupIndex:B,kdjGroups:B===0?[...i(os)]:void 0,params:[A.kPeriod,A.dPeriod,3]}}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1)}catch(k){console.error("❌ Error in handleKdjConfirm main logic:",k),console.log("🔄 Forcing popup close due to error in main logic..."),l.update(A=>(A.editIndName="",A.editPaneId="",A.modalIndCfg=!1,A)),a(!1),console.log("✅ Popup forcefully closed after error in main logic")}}function S(){i(np)&&(_n(),x(Qt,!1),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function j(){var B;if(!i(Cc))return;console.log("🔄 Applying AO changes, groups:",i(oc).length);const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R].name==="AO").sort((R,U)=>R===`${o().editPaneId}_AO`?-1:U===`${o().editPaneId}_AO`?1:R.localeCompare(U));console.log("🔍 Existing AO keys:",k);const A=i(oc).length;if(k.length>A){console.log(`🗑️ Removing ${k.length-A} excess AO indicators`);for(let R=A;R<k.length;(R+=1)-1){const U=k[R],q=r().saveInds[U];if(q&&q.pane_id){console.log("🗑️ Removing AO indicator from pane:",q.pane_id);try{(B=s())==null||B.removeIndicator({paneId:q.pane_id,name:"AO"})}catch(ve){console.log("Error removing excess AO indicator:",ve)}}}}i(oc).forEach((R,U)=>{var Re,rt,Ut,ls,ns;const q=[R.shortPeriod,R.longPeriod],ve={bars:[{upColor:R.styles.increasing.color,downColor:R.styles.decreasing.color,noChangeColor:((Re=R.styles.reverse)==null?void 0:Re.color)||"#c4c4c4",reverseColor:((rt=R.styles.reverse)==null?void 0:rt.color)||"#c4c4c4"}]};if(U===0)console.log("🔄 Updating first AO indicator in pane:",o().editPaneId),(Ut=s())==null||Ut.overrideIndicator({name:"AO",calcParams:q,styles:ve,paneId:o().editPaneId});else{const Mn=`pane_AO_${U+1}_AO`,qo=k.find(Yo=>Yo===Mn);if(qo){const Yo=r().saveInds[qo];Yo&&Yo.pane_id&&(console.log(`🔄 Updating existing AO ${U+1} in pane:`,Yo.pane_id),(ls=s())==null||ls.overrideIndicator({name:"AO",calcParams:q,styles:ve,paneId:Yo.pane_id}))}else{const Yo=`pane_AO_${U+1}`;console.log(`🆕 Creating new AO ${U+1} with pane ID:`,Yo),(ns=s())==null||ns.createIndicator({name:"AO",calcParams:q,styles:ve},!0,{id:Yo})}}}),c.update(R=>(Object.keys(R.saveInds).forEach(U=>{R.saveInds[U].name==="AO"&&delete R.saveInds[U]}),i(oc).forEach((U,q)=>{const ve=q===0?`${o().editPaneId}_AO`:`pane_AO_${q+1}_AO`,Re=q===0?o().editPaneId:`pane_AO_${q+1}`;console.log(`💾 Saving AO group ${q+1} with key:`,ve),R.saveInds[ve]={name:"AO",aoGroup:U,pane_id:Re,groupIndex:q,aoGroups:q===0?[...i(oc)]:void 0,params:[U.shortPeriod,U.longPeriod]}}),R)),l.update(R=>(R.editIndName="",R.editPaneId="",R.modalIndCfg=!1,R)),a(!1)}function Q(){i(Nu)&&(i(Jl).length===0?x(Jl,V([{id:Lr(),paneId:o().editPaneId||"candle_pane",period:i(O),stdDev:i(D),styles:{fillColor:i(w),fillOpacity:i(C),upperColor:i(M),middleColor:i(P),lowerColor:i(T),thickness:i(N),lineStyle:i(L)}}])):(i(Jl)[0].period=i(O),i(Jl)[0].stdDev=i(D),i(Jl)[0].styles.fillColor=i(w),i(Jl)[0].styles.fillOpacity=i(C),i(Jl)[0].styles.upperColor=i(M),i(Jl)[0].styles.middleColor=i(P),i(Jl)[0].styles.lowerColor=i(T),i(Jl)[0].styles.thickness=i(N),i(Jl)[0].styles.lineStyle=i(L)),ao(),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function ue(k){var R;if(console.log("🔄 handleConfirm called with:",k),console.log("📊 Current context:",{editIndName:o().editIndName,editPaneId:o().editPaneId,isKdj:i(re),kdjGroups:i(os)}),k==="close"||k==="cancel"){l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),x(Qt,!1),a(!1);return}if(k==="confirm"&&i(hf)&&o().editIndName&&o().editPaneId){Eh();return}if(k==="confirm"&&i(E)&&o().editIndName&&o().editPaneId){Qo(),l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),a(!1);return}if(k==="confirm"&&i(Hu)&&o().editIndName&&o().editPaneId){console.log("🔄 PVT Confirm: Applying all changes to chart"),i(Rr).forEach((U,q)=>{console.log(`🔄 Applying PVT group ${q}:`,U),km(q)}),c.update(U=>{const q=`${o().editPaneId}_PVT`;return U.saveInds[q]={...U.saveInds[q],pvtGroups:[...i(Rr)]},console.log("💾 Saved PVT groups to:",q),U}),l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),a(!1);return}if(k==="confirm"&&i(we)&&o().editIndName&&o().editPaneId){Bv();return}if(k==="confirm"&&i(Gd)&&o().editIndName&&o().editPaneId){Ip();return}if(k==="confirm"&&i(tu)&&o().editIndName&&o().editPaneId){Vp();return}if(k==="confirm"&&i(Tu)&&o().editIndName&&o().editPaneId){$h();return}if(k==="confirm"&&i(Vc)&&o().editIndName&&o().editPaneId){cv();return}if(k==="confirm"&&i(ht)&&o().editIndName&&o().editPaneId){i(Li).forEach((U,q)=>{Op(q)}),Em(),l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),a(!1);return}if(k==="confirm"&&i(ee)&&o().editIndName&&o().editPaneId){Dh();return}if(k==="confirm"&&i(Ee)&&o().editIndName&&o().editPaneId){um();return}if(k==="confirm"&&i(td)&&o().editIndName&&o().editPaneId){Ov();return}if(k==="confirm"&&i(Md)&&o().editIndName&&o().editPaneId){Oo();return}if(k==="confirm"&&i(ke)&&o().editIndName&&o().editPaneId){Rh();return}if(k==="confirm"&&i(bd)&&o().editIndName&&o().editPaneId){zv();return}if(k==="confirm"&&i(Nt)&&o().editIndName&&o().editPaneId){kv();return}if(k==="confirm"&&i(gc)&&o().editIndName&&o().editPaneId){_h();return}if(k==="confirm"&&i($d)&&o().editIndName&&o().editPaneId){Vv();return}if(k==="confirm"&&i(Pf)&&o().editIndName&&o().editPaneId){ug();return}if(k==="confirm"&&i(oe)&&o().editIndName&&o().editPaneId){Wv();return}if(k==="confirm"&&i(Kd)&&o().editIndName&&o().editPaneId){Gh();return}if(k==="confirm"&&i(re)&&o().editIndName&&o().editPaneId){console.log("✅ KDJ confirm condition met, calling handleKdjConfirm"),dg();return}if(k==="confirm"&&i(Cc)&&o().editIndName&&o().editPaneId){j();return}if(k==="confirm"&&i(Nu)&&o().editIndName&&o().editPaneId){Q();return}if(k==="confirm"&&i(np)&&o().editIndName&&o().editPaneId){S();return}if(k!=="confirm"||!o().editIndName||!o().editPaneId||d.length===0){a(!1);return}const A=[],B={lines:[],bars:[]};u.forEach((U,q)=>{const ve=d[q];if(ve&&ve.type==="color"){const Re=ve.styleKey;if(Re){const rt=Re.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(rt){const[,Ut,ls,ns]=rt,Mn=parseInt(ls);B[Ut]||(B[Ut]=[]),B[Ut][Mn]||(B[Ut][Mn]={}),B[Ut][Mn][ns]=U||ve.default}}}else(!Jv.isValid(U)||U==="")&&ve&&ve.default&&(U=ve.default),A.push(Number(U))}),h.forEach((U,q)=>{let ve=vt.Solid,Re=[2,2];U.lineStyle==="dashed"?(ve=vt.Dashed,Re=[4,4]):U.lineStyle==="dotted"&&(ve=vt.Dashed,Re=[2,6]),B.lines[q]={color:U.color,size:U.thickness,style:ve,dashedValue:Re}}),(R=s())==null||R.overrideIndicator({name:o().editIndName,calcParams:A,styles:B,paneId:o().editPaneId}),c.update(U=>{const q={name:o().editIndName,params:A,pane_id:o().editPaneId,styles:[...h]};return i(Nu)||(q.fields=[...d]),U.saveInds[`${o().editPaneId}_${o().editIndName}`]=q,U}),l.update(U=>(U.editIndName="",U.editPaneId="",U.modalIndCfg=!1,U)),a(!1)}a_();var ie=MG(),De=tn(ie);sg(De,{get title(){return i(Ae)},width:600,maxWidth:"min(600px, 95vw)",maxHeight:"90vh",get show(){return a()},set show(k){a(k)},get theme(){return r().theme},click:ue,children:(k,A)=>{var B=PG(),R=y(B);Ye(R,()=>i(hf),q=>{var ve=GH(),Re=y(ve);Ro(Re,17,()=>i(Lu),fi,(ls,ns,Mn)=>{var qo=UH(),Yo=y(qo),Nc=y(Yo);Nc.textContent=`MACD ${Mn+1}`;var jd=v(Nc,2);Ye(jd,()=>i(Lu).length>1,Ai=>{var $o=qH();$o.__click=[HH,Nh,ns],Y(Ai,$o)}),_(Yo);var cf=v(Yo,2),bf=y(cf),ip=v(y(bf),2);mn(ip),_(bf);var Bd=v(bf,2),xf=v(y(Bd),2);mn(xf),_(Bd);var Jd=v(Bd,2),Od=v(y(Jd),2);mn(Od),_(Jd),_(cf);var wf=v(cf,2),kf=y(wf),Ri=v(y(kf),2),_r=At(()=>xm(Mn,"macdLine"));Ri.__click=function(...Ai){var $o;($o=i(_r))==null||$o.apply(this,Ai)};var ua=v(Ri,2);ua.__change=()=>qh(Mn);var Vi=y(ua);Vi.value=(Vi.__value=1)==null?"":1;var xa=v(Vi);xa.value=(xa.__value=2)==null?"":2;var Jc=v(xa);Jc.value=(Jc.__value=3)==null?"":3;var Ua=v(Jc);Ua.value=(Ua.__value=4)==null?"":4;var ku=v(Ua);ku.value=(ku.__value=5)==null?"":5,_(ua);var Su=v(ua,2);Su.__change=()=>qh(Mn);var sa=y(Su);sa.value=(sa.__value="solid")==null?"":"solid";var Ol=v(sa);Ol.value=(Ol.__value="dashed")==null?"":"dashed";var od=v(Ol);od.value=(od.__value="dotted")==null?"":"dotted",_(Su),_(kf);var G=v(kf,2),Bt=v(y(G),2),Ks=At(()=>xm(Mn,"signalLine"));Bt.__click=function(...Ai){var $o;($o=i(Ks))==null||$o.apply(this,Ai)};var cs=v(Bt,2);cs.__change=()=>qh(Mn);var ts=y(cs);ts.value=(ts.__value=1)==null?"":1;var aa=v(ts);aa.value=(aa.__value=2)==null?"":2;var ko=v(aa);ko.value=(ko.__value=3)==null?"":3;var or=v(ko);or.value=(or.__value=4)==null?"":4;var pl=v(or);pl.value=(pl.__value=5)==null?"":5,_(cs);var Nr=v(cs,2);Nr.__change=()=>qh(Mn);var qr=y(Nr);qr.value=(qr.__value="solid")==null?"":"solid";var ec=v(qr);ec.value=(ec.__value="dashed")==null?"":"dashed";var da=v(ec);da.value=(da.__value="dotted")==null?"":"dotted",_(Nr),_(G);var Uo=v(G,2),Qa=v(y(Uo),2),Bn=At(()=>xm(Mn,"positiveHistogram"));Qa.__click=function(...Ai){var $o;($o=i(Bn))==null||$o.apply(this,Ai)},_(Uo);var bi=v(Uo,2),No=v(y(bi),2),yo=At(()=>xm(Mn,"negativeHistogram"));No.__click=function(...Ai){var $o;($o=i(yo))==null||$o.apply(this,Ai)},_(bi);var _a=v(bi,2),xi=v(y(_a),2),lr=At(()=>xm(Mn,"reverseHistogram"));xi.__click=function(...Ai){var $o;($o=i(lr))==null||$o.apply(this,Ai)},_(_a),_(wf),_(qo),Ne(()=>{Dt(Ri,"style",`background-color: ${i(ns).styles.macdLine.color??""}; border: 1px solid #ddd;`),Dt(Bt,"style",`background-color: ${i(ns).styles.signalLine.color??""}; border: 1px solid #ddd;`),Dt(Qa,"style",`background-color: ${i(ns).styles.positiveHistogram.color??""}; border: 1px solid #ddd;`),Dt(No,"style",`background-color: ${i(ns).styles.negativeHistogram.color??""}; border: 1px solid #ddd;`),Dt(xi,"style",`background-color: ${i(ns).styles.reverseHistogram.color??""}; border: 1px solid #ddd;`)}),As(ip,()=>i(ns).fastPeriod,Ai=>i(ns).fastPeriod=Ai),As(xf,()=>i(ns).slowPeriod,Ai=>i(ns).slowPeriod=Ai),As(Od,()=>i(ns).signalPeriod,Ai=>i(ns).signalPeriod=Ai),po(ua,()=>i(ns).styles.macdLine.thickness,Ai=>i(ns).styles.macdLine.thickness=Ai),po(Su,()=>i(ns).styles.macdLine.lineStyle,Ai=>i(ns).styles.macdLine.lineStyle=Ai),po(cs,()=>i(ns).styles.signalLine.thickness,Ai=>i(ns).styles.signalLine.thickness=Ai),po(Nr,()=>i(ns).styles.signalLine.lineStyle,Ai=>i(ns).styles.signalLine.lineStyle=Ai),Y(ls,qo)});var rt=v(Re,2),Ut=y(rt);Ut.__click=Rm,_(rt),_(ve),Y(q,ve)},q=>{var ve=Yn(),Re=tn(ve);Ye(Re,()=>i(E),rt=>{var Ut=YH(),ls=y(Ut),ns=y(ls),Mn=v(y(ns),2);mn(Mn),Mn.__input=[gg,E,s,f,o,l,Kn],_(ns);var qo=v(ns,2),Yo=v(y(qo),2);mn(Yo),Yo.__input=[gg,E,s,f,o,l,Kn],_(qo);var Nc=v(qo,2),jd=v(y(Nc),2);mn(jd),jd.__input=[gg,E,s,f,o,l,Kn],_(Nc);var cf=v(Nc,2),bf=v(y(cf),2);mn(bf),bf.__input=[gg,E,s,f,o,l,Kn],_(cf);var ip=v(cf,2),Bd=v(y(ip),2);mn(Bd),Bd.__input=[gg,E,s,f,o,l,Kn],_(ip);var xf=v(ip,2),Jd=v(y(xf),2);mn(Jd),Jd.__input=[gg,E,s,f,o,l,Kn],_(xf),_(ls);var Od=v(ls,2),wf=y(Od),kf=v(y(wf),2),Ri=y(kf);mn(Ri),Ri.__input=[gg,E,s,f,o,l,Kn];var _r=v(Ri,2),ua=y(_r);Ne(()=>tt(ua,`${(Kn.maxZoneWidthPct*100).toFixed(1)??""}%`)),_(_r),_(kf),_(wf);var Vi=v(wf,2),xa=v(y(Vi),2),Jc=y(xa);mn(Jc),Jc.__input=[gg,E,s,f,o,l,Kn];var Ua=v(Jc,2),ku=y(Ua);Ne(()=>tt(ku,`${Kn.minVolumeFactor.toFixed(2)??""}x`)),_(Ua),_(xa),_(Vi);var Su=v(Vi,2),sa=v(y(Su),2),Ol=y(sa);mn(Ol),Ol.__input=[gg,E,s,f,o,l,Kn];var od=v(Ol,2),G=y(od,!0);Ne(()=>tt(G,Kn.minOBVTrendStrength.toFixed(2))),_(od),_(sa),_(Su);var Bt=v(Su,2),Ks=v(y(Bt),2),cs=y(Ks);mn(cs),cs.__input=[gg,E,s,f,o,l,Kn];var ts=v(cs,2),aa=y(ts,!0);Ne(()=>tt(aa,Kn.minZoneScore.toFixed(2))),_(ts),_(Ks),_(Bt),_(Od);var ko=v(Od,2),or=y(ko),pl=v(y(or),2);mn(pl),pl.__change=[gg,E,s,f,o,l,Kn],_(or);var Nr=v(or,2),qr=v(y(Nr),2);mn(qr),qr.__change=[gg,E,s,f,o,l,Kn],_(Nr),_(ko);var ec=v(ko,2),da=v(y(ec),2);mn(da),da.__input=[gg,E,s,f,o,l,Kn],_(ec),_(Ut),As(Mn,()=>Kn.zoneLookbackBars,Uo=>Kn.zoneLookbackBars=Uo),As(Yo,()=>Kn.priorTrendLookback,Uo=>Kn.priorTrendLookback=Uo),As(jd,()=>Kn.minZoneBars,Uo=>Kn.minZoneBars=Uo),As(bf,()=>Kn.maxZoneBars,Uo=>Kn.maxZoneBars=Uo),As(Bd,()=>Kn.atrPeriod,Uo=>Kn.atrPeriod=Uo),As(Jd,()=>Kn.volumeMAPeriod,Uo=>Kn.volumeMAPeriod=Uo),As(Ri,()=>Kn.maxZoneWidthPct,Uo=>Kn.maxZoneWidthPct=Uo),As(Jc,()=>Kn.minVolumeFactor,Uo=>Kn.minVolumeFactor=Uo),As(Ol,()=>Kn.minOBVTrendStrength,Uo=>Kn.minOBVTrendStrength=Uo),As(cs,()=>Kn.minZoneScore,Uo=>Kn.minZoneScore=Uo),jg(pl,()=>Kn.mergeNearbyZones,Uo=>Kn.mergeNearbyZones=Uo),jg(qr,()=>Kn.showLabels,Uo=>Kn.showLabels=Uo),As(da,()=>Kn.maxZonesDisplayed,Uo=>Kn.maxZonesDisplayed=Uo),Y(rt,Ut)},rt=>{var Ut=Yn(),ls=tn(Ut);Ye(ls,()=>i(I),ns=>{var Mn=XH(),qo=y(Mn),Yo=y(qo),Nc=v(y(Yo),2);mn(Nc),Nc.__input=me,_(Yo);var jd=v(Yo,2),cf=v(y(jd),2);mn(cf),cf.__input=me,_(jd);var bf=v(jd,2),ip=v(y(bf),2);mn(ip),ip.__input=me,_(bf);var Bd=v(bf,2),xf=v(y(Bd),2);mn(xf),xf.__input=me,_(Bd);var Jd=v(Bd,2),Od=v(y(Jd),2);mn(Od),Od.__input=me,_(Jd);var wf=v(Jd,2),kf=v(y(wf),2),Ri=y(kf);mn(Ri),Ri.__input=me;var _r=v(Ri,2),ua=y(_r);Ne(()=>tt(ua,`${Number(u[5]??1.2).toFixed(2)??""}x`)),_(_r),_(kf),_(wf),_(qo);var Vi=v(qo,2),xa=y(Vi),Jc=v(y(xa),2),Ua=y(Jc);mn(Ua),Ua.__input=me,Di(2),_(Jc),_(xa);var ku=v(xa,2),Su=v(y(ku),2),sa=y(Su);mn(sa),sa.__input=me;var Ol=v(sa,2),od=y(Ol,!0);Ne(()=>tt(od,Number(u[7]??.35).toFixed(2))),_(Ol),_(Su),_(ku);var G=v(ku,2),Bt=v(y(G),2),Ks=y(Bt);mn(Ks),Ks.__input=me;var cs=v(Ks,2),ts=y(cs,!0);Ne(()=>tt(ts,Number(u[8]??.5).toFixed(2))),_(cs),_(Bt),_(G),_(Vi);var aa=v(Vi,2),ko=y(aa),or=v(y(ko),2);mn(or),Ne(()=>Av(or,Number(u[9]??1)>0)),or.__change=[KH,u,me],_(ko);var pl=v(ko,2),Nr=v(y(pl),2);mn(Nr),Nr.__input=me,_(pl),_(aa),_(Mn),As(Nc,()=>u[0],qr=>u[0]=qr),As(cf,()=>u[1],qr=>u[1]=qr),As(ip,()=>u[2],qr=>u[2]=qr),As(xf,()=>u[3],qr=>u[3]=qr),As(Od,()=>u[4],qr=>u[4]=qr),As(Ri,()=>u[5],qr=>u[5]=qr),As(Ua,()=>u[6],qr=>u[6]=qr),As(sa,()=>u[7],qr=>u[7]=qr),As(Ks,()=>u[8],qr=>u[8]=qr),As(Nr,()=>u[10],qr=>u[10]=qr),Y(ns,Mn)},ns=>{var Mn=Yn(),qo=tn(Mn);Ye(qo,()=>i(W),Yo=>{var Nc=ZH(),jd=y(Nc),cf=v(y(jd),2),bf=y(cf),ip=v(y(bf),2);mn(ip),ip.__input=Le,_(bf);var Bd=v(bf,2),xf=v(y(Bd),2);mn(xf),xf.__input=Le,_(Bd);var Jd=v(Bd,2),Od=v(y(Jd),2);mn(Od),Od.__input=Le,_(Jd);var wf=v(Jd,2),kf=v(y(wf),2);mn(kf),kf.__input=Le,_(wf);var Ri=v(wf,2),_r=v(y(Ri),2);mn(_r),_r.__input=Le,_(Ri);var ua=v(Ri,2),Vi=v(y(ua),2);mn(Vi),Vi.__input=Le,_(ua),_(cf),_(jd);var xa=v(jd,2),Jc=v(y(xa),2),Ua=y(Jc),ku=v(y(Ua),2),Su=y(ku);mn(Su),Su.__input=Le;var sa=v(Su,2),Ol=y(sa,!0);Ne(()=>tt(Ol,Number(u[6]??.7).toFixed(2))),_(sa),_(ku),_(Ua);var od=v(Ua,2),G=v(y(od),2);mn(G),G.__input=Le,_(od);var Bt=v(od,2),Ks=v(y(Bt),2),cs=y(Ks);mn(cs),cs.__input=Le;var ts=v(cs,2),aa=y(ts);Ne(()=>tt(aa,`${Number(u[8]??1.3).toFixed(2)??""}x`)),_(ts),_(Ks),_(Bt);var ko=v(Bt,2),or=v(y(ko),2),pl=y(or);mn(pl),pl.__input=Le;var Nr=v(pl,2),qr=y(Nr);Ne(()=>tt(qr,`${Number(u[9]??1.3).toFixed(2)??""}x`)),_(Nr),_(or),_(ko);var ec=v(ko,2),da=v(y(ec),2),Uo=y(da);mn(Uo),Uo.__input=Le;var Qa=v(Uo,2),Bn=y(Qa,!0);Ne(()=>tt(Bn,Number(u[10]??.6).toFixed(2))),_(Qa),_(da),_(ec);var bi=v(ec,2),No=v(y(bi),2);mn(No),No.__input=Le,_(bi);var yo=v(bi,2),_a=v(y(yo),2);mn(_a),_a.__input=Le,_(yo),_(Jc),_(xa),_(Nc),As(ip,()=>u[0],xi=>u[0]=xi),As(xf,()=>u[1],xi=>u[1]=xi),As(Od,()=>u[2],xi=>u[2]=xi),As(kf,()=>u[3],xi=>u[3]=xi),As(_r,()=>u[4],xi=>u[4]=xi),As(Vi,()=>u[5],xi=>u[5]=xi),As(Su,()=>u[6],xi=>u[6]=xi),As(G,()=>u[7],xi=>u[7]=xi),As(cs,()=>u[8],xi=>u[8]=xi),As(pl,()=>u[9],xi=>u[9]=xi),As(Uo,()=>u[10],xi=>u[10]=xi),As(No,()=>u[11],xi=>u[11]=xi),As(_a,()=>u[12],xi=>u[12]=xi),Y(Yo,Nc)},Yo=>{var Nc=Yn(),jd=tn(Nc);Ye(jd,()=>i(Z),cf=>{var bf=JH(),ip=y(bf),Bd=v(y(ip),2),xf=y(Bd),Jd=v(y(xf),2);mn(Jd),Jd.__input=ye,_(xf);var Od=v(xf,2),wf=v(y(Od),2);mn(wf),wf.__input=ye,_(Od);var kf=v(Od,2),Ri=v(y(kf),2);mn(Ri),Ri.__input=ye,_(kf);var _r=v(kf,2),ua=v(y(_r),2);mn(ua),ua.__input=ye,_(_r);var Vi=v(_r,2),xa=v(y(Vi),2);mn(xa),xa.__input=ye,_(Vi);var Jc=v(Vi,2),Ua=v(y(Jc),2);mn(Ua),Ua.__input=ye,_(Jc),_(Bd),_(ip);var ku=v(ip,2),Su=v(y(ku),2),sa=y(Su),Ol=v(y(sa),2),od=y(Ol);mn(od),od.__input=ye;var G=v(od,2),Bt=y(G,!0);Ne(()=>tt(Bt,Number(u[6]??.7).toFixed(2))),_(G),_(Ol),_(sa);var Ks=v(sa,2),cs=v(y(Ks),2);mn(cs),cs.__input=ye,_(Ks);var ts=v(Ks,2),aa=v(y(ts),2),ko=y(aa);mn(ko),ko.__input=ye;var or=v(ko,2),pl=y(or);Ne(()=>tt(pl,`${Number(u[8]??1.3).toFixed(2)??""}x`)),_(or),_(aa),_(ts);var Nr=v(ts,2),qr=v(y(Nr),2),ec=y(qr);mn(ec),ec.__input=ye;var da=v(ec,2),Uo=y(da);Ne(()=>tt(Uo,`${Number(u[9]??1.3).toFixed(2)??""}x`)),_(da),_(qr),_(Nr);var Qa=v(Nr,2),Bn=v(y(Qa),2),bi=y(Bn);mn(bi),bi.__input=ye;var No=v(bi,2),yo=y(No,!0);Ne(()=>tt(yo,Number(u[10]??.6).toFixed(2))),_(No),_(Bn),_(Qa);var _a=v(Qa,2),xi=v(y(_a),2);mn(xi),xi.__input=ye,_(_a);var lr=v(_a,2),Ai=v(y(lr),2);mn(Ai),Ai.__input=ye,_(lr),_(Su),_(ku),_(bf),As(Jd,()=>u[0],$o=>u[0]=$o),As(wf,()=>u[1],$o=>u[1]=$o),As(Ri,()=>u[2],$o=>u[2]=$o),As(ua,()=>u[3],$o=>u[3]=$o),As(xa,()=>u[4],$o=>u[4]=$o),As(Ua,()=>u[5],$o=>u[5]=$o),As(od,()=>u[6],$o=>u[6]=$o),As(cs,()=>u[7],$o=>u[7]=$o),As(ko,()=>u[8],$o=>u[8]=$o),As(ec,()=>u[9],$o=>u[9]=$o),As(bi,()=>u[10],$o=>u[10]=$o),As(xi,()=>u[11],$o=>u[11]=$o),As(Ai,()=>u[12],$o=>u[12]=$o),Y(cf,bf)},cf=>{var bf=Yn(),ip=tn(bf);Ye(ip,()=>i(ht),Bd=>{var xf=tq(),Jd=y(xf);Ro(Jd,17,()=>i(Li),fi,(kf,Ri,_r)=>{var ua=eq(),Vi=y(ua),xa=y(Vi);xa.textContent=`RSI ${_r+1}`;var Jc=v(xa,2);Ye(Jc,()=>i(Li).length>1,ti=>{var ki=QH();ki.__click=()=>Fv(_r),Y(ti,ki)}),_(Vi);var Ua=v(Vi,2),ku=y(Ua),Su=v(y(ku),2);mn(Su),Su.__change=()=>{x(Li,V([...i(Li)])),Op(_r)},_(ku);var sa=v(ku,2),Ol=v(y(sa),2);mn(Ol),Ol.__change=()=>{x(Li,V([...i(Li)])),Op(_r)},_(sa);var od=v(sa,2),G=v(y(od),2);mn(G),G.__change=()=>{x(Li,V([...i(Li)])),Op(_r)},_(od);var Bt=v(od,2),Ks=v(y(Bt),2);mn(Ks),Ks.__change=()=>{x(Li,V([...i(Li)])),Op(_r)},_(Bt),_(Ua);var cs=v(Ua,2),ts=y(cs),aa=v(y(ts),2),ko=y(aa);ko.__click=ti=>{x(Uf,V(_r));const ki=ti.currentTarget.getBoundingClientRect();x(qf,V({x:ki.left+ki.width/2,y:ki.bottom+5})),x(Ud,!0)};var or=v(ko,2);or.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var pl=y(or);pl.value=(pl.__value=1)==null?"":1;var Nr=v(pl);Nr.value=(Nr.__value=2)==null?"":2;var qr=v(Nr);qr.value=(qr.__value=3)==null?"":3;var ec=v(qr);ec.value=(ec.__value=4)==null?"":4;var da=v(ec);da.value=(da.__value=5)==null?"":5,_(or);var Uo=v(or,2);Uo.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var Qa=y(Uo);Qa.value=(Qa.__value="solid")==null?"":"solid";var Bn=v(Qa);Bn.value=(Bn.__value="dashed")==null?"":"dashed";var bi=v(Bn);bi.value=(bi.__value="dotted")==null?"":"dotted",_(Uo),_(aa),_(ts),_(cs);var No=v(cs,2),yo=v(y(No),2),_a=v(y(yo),2),xi=y(_a);xi.__click=ti=>{x(ql,V(_r));const ki=ti.currentTarget.getBoundingClientRect();x(Xl,V({x:ki.left+ki.width/2,y:ki.bottom+5})),x(jl,!0)};var lr=v(xi,2);lr.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var Ai=y(lr);Ai.value=(Ai.__value=1)==null?"":1;var $o=v(Ai);$o.value=($o.__value=2)==null?"":2;var Br=v($o);Br.value=(Br.__value=3)==null?"":3,_(lr);var oa=v(lr,2);oa.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var zl=y(oa);zl.value=(zl.__value="solid")==null?"":"solid";var ci=v(zl);ci.value=(ci.__value="dashed")==null?"":"dashed";var Ur=v(ci);Ur.value=(Ur.__value="dotted")==null?"":"dotted",_(oa),_(_a),_(yo);var fa=v(yo,2),yr=v(y(fa),2),Ea=y(yr);Ea.__click=ti=>{x(ql,V(_r));const ki=ti.currentTarget.getBoundingClientRect();x(Zu,V({x:ki.left+ki.width/2,y:ki.bottom+5})),x(Mu,!0)};var Zs=v(Ea,2);Zs.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var us=y(Zs);us.value=(us.__value=1)==null?"":1;var gs=v(us);gs.value=(gs.__value=2)==null?"":2;var ui=v(gs);ui.value=(ui.__value=3)==null?"":3,_(Zs);var Gr=v(Zs,2);Gr.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var wa=y(Gr);wa.value=(wa.__value="solid")==null?"":"solid";var el=v(wa);el.value=(el.__value="dashed")==null?"":"dashed";var ei=v(el);ei.value=(ei.__value="dotted")==null?"":"dotted",_(Gr),_(yr),_(fa);var ji=v(fa,2),Ti=v(y(ji),2),Bi=y(Ti);Bi.__click=ti=>{x(ql,V(_r));const ki=ti.currentTarget.getBoundingClientRect();x(Sr,V({x:ki.left+ki.width/2,y:ki.bottom+5})),x(xo,!0)};var qi=v(Bi,2);qi.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var oi=y(qi);oi.value=(oi.__value=1)==null?"":1;var Jo=v(oi);Jo.value=(Jo.__value=2)==null?"":2;var Ar=v(Jo);Ar.value=(Ar.__value=3)==null?"":3,_(qi);var $i=v(qi,2);$i.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var Ui=y($i);Ui.value=(Ui.__value="solid")==null?"":"solid";var wi=v(Ui);wi.value=(wi.__value="dashed")==null?"":"dashed";var tl=v(wi);tl.value=(tl.__value="dotted")==null?"":"dotted",_($i),_(Ti),_(ji);var _o=v(ji,2),rl=v(y(_o),2),br=y(rl);mn(br),br.__change=()=>{x(Li,V([...i(Li)])),Op(_r)};var di=v(br,2),$a=y(di);Ne(()=>tt($a,`${Math.round((i(Ri).fillOpacity??.15)*100)??""}%`)),_(di),_(rl),_(_o),_(No),_(ua),Ne(()=>{Dt(ko,"style",`background-color: ${i(Ri).styles.rsi.color??""}`),Dt(xi,"style",`background-color: ${(i(Ri).styles.overboughtColor||"#EF4444")??""}`),Dt(Ea,"style",`background-color: ${(i(Ri).styles.oversoldColor||"#22C55E")??""}`),Dt(Bi,"style",`background-color: ${(i(Ri).styles.middleLineColor||"#6B7280")??""}`)}),As(Su,()=>i(Ri).period,ti=>i(Ri).period=ti),As(Ol,()=>i(Ri).overboughtLevel,ti=>i(Ri).overboughtLevel=ti),As(G,()=>i(Ri).middleLevel,ti=>i(Ri).middleLevel=ti),As(Ks,()=>i(Ri).oversoldLevel,ti=>i(Ri).oversoldLevel=ti),po(or,()=>i(Ri).styles.rsi.thickness,ti=>i(Ri).styles.rsi.thickness=ti),po(Uo,()=>i(Ri).styles.rsi.lineStyle,ti=>i(Ri).styles.rsi.lineStyle=ti),po(lr,()=>i(Ri).styles.overboughtThickness,ti=>i(Ri).styles.overboughtThickness=ti),po(oa,()=>i(Ri).styles.overboughtLineStyle,ti=>i(Ri).styles.overboughtLineStyle=ti),po(Zs,()=>i(Ri).styles.oversoldThickness,ti=>i(Ri).styles.oversoldThickness=ti),po(Gr,()=>i(Ri).styles.oversoldLineStyle,ti=>i(Ri).styles.oversoldLineStyle=ti),po(qi,()=>i(Ri).styles.middleLineThickness,ti=>i(Ri).styles.middleLineThickness=ti),po($i,()=>i(Ri).styles.middleLineStyle,ti=>i(Ri).styles.middleLineStyle=ti),As(br,()=>i(Ri).fillOpacity,ti=>i(Ri).fillOpacity=ti),Y(kf,ua)});var Od=v(Jd,2),wf=y(Od);wf.__click=kg,_(Od),_(xf),Y(Bd,xf)},Bd=>{var xf=Yn(),Jd=tn(xf);Ye(Jd,()=>i(pt),Od=>{var wf=oq(),kf=y(wf);Ro(kf,17,()=>i(bu),fi,(ua,Vi,xa)=>{var Jc=sq(),Ua=y(Jc),ku=y(Ua);ku.textContent=`Stochastic ${xa+1}`;var Su=v(ku,2);Ye(Su,()=>i(bu).length>1,oi=>{var Jo=nq();Jo.__click=()=>sm(xa),Y(oi,Jo)}),_(Ua);var sa=v(Ua,2),Ol=y(sa),od=v(y(Ol),2);mn(od),od.__change=()=>vf(xa),_(Ol);var G=v(Ol,2),Bt=v(y(G),2);mn(Bt),Bt.__change=()=>vf(xa),_(G);var Ks=v(G,2),cs=v(y(Ks),2);mn(cs),cs.__change=()=>vf(xa),_(Ks);var ts=v(Ks,2),aa=v(y(ts),2);mn(aa),aa.__change=()=>vf(xa),_(ts),_(sa);var ko=v(sa,2),or=y(ko),pl=v(y(or),2);mn(pl),pl.__change=()=>vf(xa),_(or),_(ko);var Nr=v(ko,2),qr=y(Nr),ec=v(y(qr),2),da=y(ec);da.__click=oi=>{const Jo=oi.currentTarget.getBoundingClientRect();x(af,V({x:Jo.left,y:Jo.bottom+5})),x(ol,V(xa)),x(dd,!0)};var Uo=v(da,2);Uo.__change=()=>vf(xa);var Qa=y(Uo);Qa.value=(Qa.__value=1)==null?"":1;var Bn=v(Qa);Bn.value=(Bn.__value=2)==null?"":2;var bi=v(Bn);bi.value=(bi.__value=3)==null?"":3;var No=v(bi);No.value=(No.__value=4)==null?"":4;var yo=v(No);yo.value=(yo.__value=5)==null?"":5,_(Uo);var _a=v(Uo,2);_a.__change=()=>vf(xa);var xi=y(_a);xi.value=(xi.__value="solid")==null?"":"solid";var lr=v(xi);lr.value=(lr.__value="dashed")==null?"":"dashed";var Ai=v(lr);Ai.value=(Ai.__value="dotted")==null?"":"dotted",_(_a),_(ec),_(qr),_(Nr);var $o=v(Nr,2),Br=y($o),oa=v(y(Br),2),zl=y(oa);zl.__click=oi=>{const Jo=oi.currentTarget.getBoundingClientRect();x(af,V({x:Jo.left,y:Jo.bottom+5})),x(ol,V(xa)),x(Id,!0)};var ci=v(zl,2);ci.__change=()=>vf(xa);var Ur=y(ci);Ur.value=(Ur.__value=1)==null?"":1;var fa=v(Ur);fa.value=(fa.__value=2)==null?"":2;var yr=v(fa);yr.value=(yr.__value=3)==null?"":3;var Ea=v(yr);Ea.value=(Ea.__value=4)==null?"":4;var Zs=v(Ea);Zs.value=(Zs.__value=5)==null?"":5,_(ci);var us=v(ci,2);us.__change=()=>vf(xa);var gs=y(us);gs.value=(gs.__value="solid")==null?"":"solid";var ui=v(gs);ui.value=(ui.__value="dashed")==null?"":"dashed";var Gr=v(ui);Gr.value=(Gr.__value="dotted")==null?"":"dotted",_(us),_(oa),_(Br),_($o);var wa=v($o,2),el=v(y(wa),2),ei=v(y(el),2);ei.__click=oi=>{const Jo=oi.currentTarget.getBoundingClientRect();x(af,V({x:Jo.left,y:Jo.bottom+5})),x(ol,V(xa)),x(dc,!0)},_(el);var ji=v(el,2),Ti=v(y(ji),2);Ti.__click=oi=>{const Jo=oi.currentTarget.getBoundingClientRect();x(af,V({x:Jo.left,y:Jo.bottom+5})),x(ol,V(xa)),x(Gf,!0)},_(ji);var Bi=v(ji,2),qi=v(y(Bi),2);qi.__click=oi=>{const Jo=oi.currentTarget.getBoundingClientRect();x(af,V({x:Jo.left,y:Jo.bottom+5})),x(ol,V(xa)),x(Pd,!0)},_(Bi),_(wa),_(Jc),Ne(()=>{Dt(da,"style",`background-color: ${i(Vi).styles.duty.color??""}`),Dt(zl,"style",`background-color: ${i(Vi).styles.dLine.color??""}`),Dt(ei,"style",`background-color: ${(i(Vi).styles.overboughtColor||"#EF4444")??""}`),Dt(Ti,"style",`background-color: ${(i(Vi).styles.oversoldColor||"#10B981")??""}`),Dt(qi,"style",`background-color: ${(i(Vi).styles.midLineColor||"#6B7280")??""}`)}),As(od,()=>i(Vi).kPeriod,oi=>i(Vi).kPeriod=oi),As(Bt,()=>i(Vi).dPeriod,oi=>i(Vi).dPeriod=oi),As(cs,()=>i(Vi).overboughtLevel,oi=>i(Vi).overboughtLevel=oi),As(aa,()=>i(Vi).oversoldLevel,oi=>i(Vi).oversoldLevel=oi),As(pl,()=>i(Vi).midLevel,oi=>i(Vi).midLevel=oi),po(Uo,()=>i(Vi).styles.duty.thickness,oi=>i(Vi).styles.duty.thickness=oi),po(_a,()=>i(Vi).styles.duty.lineStyle,oi=>i(Vi).styles.duty.lineStyle=oi),po(ci,()=>i(Vi).styles.dLine.thickness,oi=>i(Vi).styles.dLine.thickness=oi),po(us,()=>i(Vi).styles.dLine.lineStyle,oi=>i(Vi).styles.dLine.lineStyle=oi),Y(ua,Jc)});var Ri=v(kf,2),_r=y(Ri);_r.__click=og,_(Ri),_(wf),Y(Od,wf)},Od=>{var wf=Yn(),kf=tn(wf);Ye(kf,()=>i(gc),Ri=>{var _r=lq(),ua=y(_r);Ro(ua,17,()=>i(El),fi,(Jc,Ua,ku)=>{var Su=aq(),sa=y(Su),Ol=y(sa);Ol.textContent=`DMI ${ku+1}`;var od=v(Ol,2);Ye(od,()=>i(El).length>1,Ui=>{var wi=rq();wi.__click=[iq,zp,Ua],Y(Ui,wi)}),_(sa);var G=v(sa,2),Bt=y(G),Ks=v(y(Bt),2);mn(Ks),Ks.__input=Ic,_(Bt);var cs=v(Bt,2),ts=v(y(cs),2);mn(ts),ts.__input=Ic,_(cs),_(G);var aa=v(G,2),ko=y(aa),or=v(y(ko),2),pl=At(()=>mh(ku,"diPlus"));or.__click=function(...Ui){var wi;(wi=i(pl))==null||wi.apply(this,Ui)};var Nr=y(or);_(or);var qr=v(or,2);qr.__change=Ic;var ec=y(qr);ec.value=(ec.__value=1)==null?"":1;var da=v(ec);da.value=(da.__value=2)==null?"":2;var Uo=v(da);Uo.value=(Uo.__value=3)==null?"":3;var Qa=v(Uo);Qa.value=(Qa.__value=4)==null?"":4;var Bn=v(Qa);Bn.value=(Bn.__value=5)==null?"":5,_(qr);var bi=v(qr,2);bi.__change=Ic;var No=y(bi);No.value=(No.__value="solid")==null?"":"solid";var yo=v(No);yo.value=(yo.__value="dashed")==null?"":"dashed";var _a=v(yo);_a.value=(_a.__value="dotted")==null?"":"dotted",_(bi),_(ko);var xi=v(ko,2),lr=v(y(xi),2),Ai=At(()=>mh(ku,"diMinus"));lr.__click=function(...Ui){var wi;(wi=i(Ai))==null||wi.apply(this,Ui)};var $o=y(lr);_(lr);var Br=v(lr,2);Br.__change=Ic;var oa=y(Br);oa.value=(oa.__value=1)==null?"":1;var zl=v(oa);zl.value=(zl.__value=2)==null?"":2;var ci=v(zl);ci.value=(ci.__value=3)==null?"":3;var Ur=v(ci);Ur.value=(Ur.__value=4)==null?"":4;var fa=v(Ur);fa.value=(fa.__value=5)==null?"":5,_(Br);var yr=v(Br,2);yr.__change=Ic;var Ea=y(yr);Ea.value=(Ea.__value="solid")==null?"":"solid";var Zs=v(Ea);Zs.value=(Zs.__value="dashed")==null?"":"dashed";var us=v(Zs);us.value=(us.__value="dotted")==null?"":"dotted",_(yr),_(xi);var gs=v(xi,2),ui=v(y(gs),2),Gr=At(()=>mh(ku,"adx"));ui.__click=function(...Ui){var wi;(wi=i(Gr))==null||wi.apply(this,Ui)};var wa=y(ui);_(ui);var el=v(ui,2);el.__change=Ic;var ei=y(el);ei.value=(ei.__value=1)==null?"":1;var ji=v(ei);ji.value=(ji.__value=2)==null?"":2;var Ti=v(ji);Ti.value=(Ti.__value=3)==null?"":3;var Bi=v(Ti);Bi.value=(Bi.__value=4)==null?"":4;var qi=v(Bi);qi.value=(qi.__value=5)==null?"":5,_(el);var oi=v(el,2);oi.__change=Ic;var Jo=y(oi);Jo.value=(Jo.__value="solid")==null?"":"solid";var Ar=v(Jo);Ar.value=(Ar.__value="dashed")==null?"":"dashed";var $i=v(Ar);$i.value=($i.__value="dotted")==null?"":"dotted",_(oi),_(gs),_(aa),_(Su),Ne(()=>{Dt(Nr,"style",`background-color: ${i(Ua).styles.diPlus.color??""}`),Dt($o,"style",`background-color: ${i(Ua).styles.diMinus.color??""}`),Dt(wa,"style",`background-color: ${i(Ua).styles.adx.color??""}`)}),As(Ks,()=>i(Ua).diPeriod,Ui=>i(Ua).diPeriod=Ui),As(ts,()=>i(Ua).adxPeriod,Ui=>i(Ua).adxPeriod=Ui),po(qr,()=>i(Ua).styles.diPlus.thickness,Ui=>i(Ua).styles.diPlus.thickness=Ui),po(bi,()=>i(Ua).styles.diPlus.lineStyle,Ui=>i(Ua).styles.diPlus.lineStyle=Ui),po(Br,()=>i(Ua).styles.diMinus.thickness,Ui=>i(Ua).styles.diMinus.thickness=Ui),po(yr,()=>i(Ua).styles.diMinus.lineStyle,Ui=>i(Ua).styles.diMinus.lineStyle=Ui),po(el,()=>i(Ua).styles.adx.thickness,Ui=>i(Ua).styles.adx.thickness=Ui),po(oi,()=>i(Ua).styles.adx.lineStyle,Ui=>i(Ua).styles.adx.lineStyle=Ui),Y(Jc,Su)});var Vi=v(ua,2),xa=y(Vi);xa.__click=[BH,gc,El,Ic],_(Vi),_(_r),Y(Ri,_r)},Ri=>{var _r=Yn(),ua=tn(_r);Ye(ua,()=>i(Gd),Vi=>{var xa=fq(),Jc=y(xa);Ro(Jc,17,()=>i(Ju),fi,(Su,sa,Ol)=>{var od=dq(),G=y(od),Bt=y(G);Bt.textContent=`Williams %R ${Ol+1}`;var Ks=v(Bt,2);Ye(Ks,()=>i(Ju).length>1,Xo=>{var Sa=uq();Sa.__click=[cq,rg,sa],Y(Xo,Sa)}),_(G);var cs=v(G,2),ts=y(cs),aa=v(y(ts),2);mn(aa),aa.__change=()=>sp(Ol),_(ts);var ko=v(ts,2),or=v(y(ko),2);mn(or),or.__change=()=>sp(Ol),_(ko);var pl=v(ko,2),Nr=v(y(pl),2);mn(Nr),Nr.__change=()=>sp(Ol),_(pl);var qr=v(pl,2),ec=v(y(qr),2);mn(ec),ec.__change=()=>sp(Ol),_(qr),_(cs);var da=v(cs,2),Uo=y(da),Qa=v(y(Uo),2),Bn=At(()=>Zp(Ol));Qa.__click=function(...Xo){var Sa;(Sa=i(Bn))==null||Sa.apply(this,Xo)};var bi=y(Qa);_(Qa);var No=v(Qa,2);No.__change=()=>sp(Ol);var yo=y(No);yo.value=(yo.__value=1)==null?"":1;var _a=v(yo);_a.value=(_a.__value=2)==null?"":2;var xi=v(_a);xi.value=(xi.__value=3)==null?"":3;var lr=v(xi);lr.value=(lr.__value=4)==null?"":4;var Ai=v(lr);Ai.value=(Ai.__value=5)==null?"":5,_(No);var $o=v(No,2);$o.__change=()=>sp(Ol);var Br=y($o);Br.value=(Br.__value="solid")==null?"":"solid";var oa=v(Br);oa.value=(oa.__value="dashed")==null?"":"dashed";var zl=v(oa);zl.value=(zl.__value="dotted")==null?"":"dotted",_($o),_(Uo),_(da);var ci=v(da,2),Ur=v(y(ci),2),fa=v(y(Ur),2),yr=At(()=>Th(Ol));fa.__click=function(...Xo){var Sa;(Sa=i(yr))==null||Sa.apply(this,Xo)};var Ea=y(fa);_(fa);var Zs=v(fa,2);Zs.__change=()=>sp(Ol);var us=y(Zs);us.value=(us.__value=1)==null?"":1;var gs=v(us);gs.value=(gs.__value=2)==null?"":2;var ui=v(gs);ui.value=(ui.__value=3)==null?"":3;var Gr=v(ui);Gr.value=(Gr.__value=4)==null?"":4;var wa=v(Gr);wa.value=(wa.__value=5)==null?"":5,_(Zs);var el=v(Zs,2);el.__change=()=>sp(Ol);var ei=y(el);ei.value=(ei.__value="solid")==null?"":"solid";var ji=v(ei);ji.value=(ji.__value="dashed")==null?"":"dashed";var Ti=v(ji);Ti.value=(Ti.__value="dotted")==null?"":"dotted",_(el),_(Ur);var Bi=v(Ur,2),qi=v(y(Bi),2),oi=At(()=>ag(Ol));qi.__click=function(...Xo){var Sa;(Sa=i(oi))==null||Sa.apply(this,Xo)};var Jo=y(qi);_(qi);var Ar=v(qi,2);Ar.__change=()=>sp(Ol);var $i=y(Ar);$i.value=($i.__value=1)==null?"":1;var Ui=v($i);Ui.value=(Ui.__value=2)==null?"":2;var wi=v(Ui);wi.value=(wi.__value=3)==null?"":3;var tl=v(wi);tl.value=(tl.__value=4)==null?"":4;var _o=v(tl);_o.value=(_o.__value=5)==null?"":5,_(Ar);var rl=v(Ar,2);rl.__change=()=>sp(Ol);var br=y(rl);br.value=(br.__value="solid")==null?"":"solid";var di=v(br);di.value=(di.__value="dashed")==null?"":"dashed";var $a=v(di);$a.value=($a.__value="dotted")==null?"":"dotted",_(rl),_(Bi);var ti=v(Bi,2),ki=v(y(ti),2),Or=At(()=>xv(Ol));ki.__click=function(...Xo){var Sa;(Sa=i(Or))==null||Sa.apply(this,Xo)};var Qr=y(ki);_(ki);var cr=v(ki,2);cr.__change=()=>sp(Ol);var ya=y(cr);ya.value=(ya.__value=1)==null?"":1;var Ga=v(ya);Ga.value=(Ga.__value=2)==null?"":2;var zr=v(Ga);zr.value=(zr.__value=3)==null?"":3;var ea=v(zr);ea.value=(ea.__value=4)==null?"":4;var pa=v(ea);pa.value=(pa.__value=5)==null?"":5,_(cr);var Ko=v(cr,2);Ko.__change=()=>sp(Ol);var no=y(Ko);no.value=(no.__value="solid")==null?"":"solid";var Si=v(no);Si.value=(Si.__value="dashed")==null?"":"dashed";var ka=v(Si);ka.value=(ka.__value="dotted")==null?"":"dotted",_(Ko),_(ti),_(ci),_(od),Ne(()=>{Dt(bi,"style",`background-color: ${i(sa).styles.wr.color??""}`),Dt(Ea,"style",`background-color: ${i(sa).styles.overbought.color??""}`),Dt(Jo,"style",`background-color: ${i(sa).styles.middleLine.color??""}`),Dt(Qr,"style",`background-color: ${i(sa).styles.oversold.color??""}`)}),As(aa,()=>i(sa).period,Xo=>i(sa).period=Xo),As(or,()=>i(sa).overboughtLevel,Xo=>i(sa).overboughtLevel=Xo),As(Nr,()=>i(sa).middleLevel,Xo=>i(sa).middleLevel=Xo),As(ec,()=>i(sa).oversoldLevel,Xo=>i(sa).oversoldLevel=Xo),po(No,()=>i(sa).styles.wr.thickness,Xo=>i(sa).styles.wr.thickness=Xo),po($o,()=>i(sa).styles.wr.lineStyle,Xo=>i(sa).styles.wr.lineStyle=Xo),po(Zs,()=>i(sa).styles.overbought.thickness,Xo=>i(sa).styles.overbought.thickness=Xo),po(el,()=>i(sa).styles.overbought.lineStyle,Xo=>i(sa).styles.overbought.lineStyle=Xo),po(Ar,()=>i(sa).styles.middleLine.thickness,Xo=>i(sa).styles.middleLine.thickness=Xo),po(rl,()=>i(sa).styles.middleLine.lineStyle,Xo=>i(sa).styles.middleLine.lineStyle=Xo),po(cr,()=>i(sa).styles.oversold.thickness,Xo=>i(sa).styles.oversold.thickness=Xo),po(Ko,()=>i(sa).styles.oversold.lineStyle,Xo=>i(sa).styles.oversold.lineStyle=Xo),Y(Su,od)});var Ua=v(Jc,2),ku=y(Ua);ku.__click=uh,_(Ua),_(xa),Y(Vi,xa)},Vi=>{var xa=Yn(),Jc=tn(xa);Ye(Jc,()=>i(tu),Ua=>{var ku=hq(),Su=y(ku);Ro(Su,17,()=>i(Dd),fi,(od,G,Bt)=>{var Ks=mq(),cs=y(Ks),ts=y(cs);ts.textContent=`VR ${Bt+1}`;var aa=v(ts,2);Ye(aa,()=>i(Dd).length>1,no=>{var Si=pq();Si.__click=()=>fe(Bt),Y(no,Si)}),_(cs);var ko=v(cs,2),or=y(ko),pl=v(y(or),2);mn(pl),_(or);var Nr=v(or,2),qr=v(y(Nr),2);mn(qr),_(Nr);var ec=v(Nr,2),da=v(y(ec),2);mn(da),_(ec),_(ko);var Uo=v(ko,2),Qa=v(y(Uo),2),Bn=y(Qa),bi=v(y(Bn),2),No=At(()=>Ep(Bt,"vr"));bi.__click=function(...no){var Si;(Si=i(No))==null||Si.apply(this,no)};var yo=y(bi);_(bi),_(Bn);var _a=v(Bn,2),xi=v(y(_a),2);xi.__change=()=>ot(Bt);var lr=y(xi);lr.value=(lr.__value=1)==null?"":1;var Ai=v(lr);Ai.value=(Ai.__value=2)==null?"":2;var $o=v(Ai);$o.value=($o.__value=3)==null?"":3;var Br=v($o);Br.value=(Br.__value=4)==null?"":4;var oa=v(Br);oa.value=(oa.__value=5)==null?"":5,_(xi),_(_a);var zl=v(_a,2),ci=v(y(zl),2);ci.__change=()=>ot(Bt);var Ur=y(ci);Ur.value=(Ur.__value="solid")==null?"":"solid";var fa=v(Ur);fa.value=(fa.__value="dashed")==null?"":"dashed";var yr=v(fa);yr.value=(yr.__value="dotted")==null?"":"dotted",_(ci),_(zl),_(Qa),_(Uo);var Ea=v(Uo,2),Zs=v(y(Ea),2),us=y(Zs),gs=v(y(us),2),ui=At(()=>Ep(Bt,"vrShort"));gs.__click=function(...no){var Si;(Si=i(ui))==null||Si.apply(this,no)};var Gr=y(gs);_(gs),_(us);var wa=v(us,2),el=v(y(wa),2);el.__change=()=>ot(Bt);var ei=y(el);ei.value=(ei.__value=1)==null?"":1;var ji=v(ei);ji.value=(ji.__value=2)==null?"":2;var Ti=v(ji);Ti.value=(Ti.__value=3)==null?"":3;var Bi=v(Ti);Bi.value=(Bi.__value=4)==null?"":4;var qi=v(Bi);qi.value=(qi.__value=5)==null?"":5,_(el),_(wa);var oi=v(wa,2),Jo=v(y(oi),2);Jo.__change=()=>ot(Bt);var Ar=y(Jo);Ar.value=(Ar.__value="solid")==null?"":"solid";var $i=v(Ar);$i.value=($i.__value="dashed")==null?"":"dashed";var Ui=v($i);Ui.value=(Ui.__value="dotted")==null?"":"dotted",_(Jo),_(oi),_(Zs),_(Ea);var wi=v(Ea,2),tl=v(y(wi),2),_o=y(tl),rl=v(y(_o),2),br=At(()=>Ep(Bt,"vrLong"));rl.__click=function(...no){var Si;(Si=i(br))==null||Si.apply(this,no)};var di=y(rl);_(rl),_(_o);var $a=v(_o,2),ti=v(y($a),2);ti.__change=()=>ot(Bt);var ki=y(ti);ki.value=(ki.__value=1)==null?"":1;var Or=v(ki);Or.value=(Or.__value=2)==null?"":2;var Qr=v(Or);Qr.value=(Qr.__value=3)==null?"":3;var cr=v(Qr);cr.value=(cr.__value=4)==null?"":4;var ya=v(cr);ya.value=(ya.__value=5)==null?"":5,_(ti),_($a);var Ga=v($a,2),zr=v(y(Ga),2);zr.__change=()=>ot(Bt);var ea=y(zr);ea.value=(ea.__value="solid")==null?"":"solid";var pa=v(ea);pa.value=(pa.__value="dashed")==null?"":"dashed";var Ko=v(pa);Ko.value=(Ko.__value="dotted")==null?"":"dotted",_(zr),_(Ga),_(tl),_(wi),_(Ks),Ne(()=>{Dt(yo,"style",`background-color: ${i(G).styles.vr.color??""}`),Dt(Gr,"style",`background-color: ${i(G).styles.vrShort.color??""}`),Dt(di,"style",`background-color: ${i(G).styles.vrLong.color??""}`)}),As(pl,()=>i(G).period,no=>i(G).period=no),As(qr,()=>i(G).shortPeriod,no=>i(G).shortPeriod=no),As(da,()=>i(G).longPeriod,no=>i(G).longPeriod=no),po(xi,()=>i(G).styles.vr.thickness,no=>i(G).styles.vr.thickness=no),po(ci,()=>i(G).styles.vr.lineStyle,no=>i(G).styles.vr.lineStyle=no),po(el,()=>i(G).styles.vrShort.thickness,no=>i(G).styles.vrShort.thickness=no),po(Jo,()=>i(G).styles.vrShort.lineStyle,no=>i(G).styles.vrShort.lineStyle=no),po(ti,()=>i(G).styles.vrLong.thickness,no=>i(G).styles.vrLong.thickness=no),po(zr,()=>i(G).styles.vrLong.lineStyle,no=>i(G).styles.vrLong.lineStyle=no),Y(od,Ks)});var sa=v(Su,2),Ol=y(sa);Ol.__click=ne,_(sa),_(ku),Y(Ua,ku)},Ua=>{var ku=Yn(),Su=tn(ku);Ye(Su,()=>i(Vc),sa=>{var Ol=yq(),od=y(Ol);Ro(od,17,()=>i(Rd),fi,(Ks,cs,ts)=>{var aa=_q(),ko=y(aa),or=y(ko);or.textContent=`BBI ${ts+1}`;var pl=v(or,2);Ye(pl,()=>i(Rd).length>1,ui=>{var Gr=gq();Gr.__click=[vq,Ha,cs],Y(ui,Gr)}),_(ko);var Nr=v(ko,2),qr=y(Nr),ec=v(y(qr),2);mn(ec),ec.__change=()=>Ct(ts),_(qr);var da=v(qr,2),Uo=v(y(da),2);mn(Uo),Uo.__change=()=>Ct(ts),_(da);var Qa=v(da,2),Bn=v(y(Qa),2);mn(Bn),Bn.__change=()=>Ct(ts),_(Qa);var bi=v(Qa,2),No=v(y(bi),2);mn(No),No.__change=()=>Ct(ts),_(bi),_(Nr);var yo=v(Nr,2),_a=y(yo),xi=v(y(_a),2),lr=At(()=>wv(ts));xi.__click=function(...ui){var Gr;(Gr=i(lr))==null||Gr.apply(this,ui)};var Ai=y(xi);_(xi),_(_a);var $o=v(_a,2),Br=v(y($o),2);Br.__change=()=>Ct(ts);var oa=y(Br);oa.value=(oa.__value=1)==null?"":1;var zl=v(oa);zl.value=(zl.__value=2)==null?"":2;var ci=v(zl);ci.value=(ci.__value=3)==null?"":3;var Ur=v(ci);Ur.value=(Ur.__value=4)==null?"":4;var fa=v(Ur);fa.value=(fa.__value=5)==null?"":5,_(Br),_($o);var yr=v($o,2),Ea=v(y(yr),2);Ea.__change=()=>Ct(ts);var Zs=y(Ea);Zs.value=(Zs.__value="solid")==null?"":"solid";var us=v(Zs);us.value=(us.__value="dashed")==null?"":"dashed";var gs=v(us);gs.value=(gs.__value="dotted")==null?"":"dotted",_(Ea),_(yr),_(yo),_(aa),Ne(()=>Dt(Ai,"style",`background-color: ${i(cs).color??""}`)),As(ec,()=>i(cs).period1,ui=>i(cs).period1=ui),As(Uo,()=>i(cs).period2,ui=>i(cs).period2=ui),As(Bn,()=>i(cs).period3,ui=>i(cs).period3=ui),As(No,()=>i(cs).period4,ui=>i(cs).period4=ui),po(Br,()=>i(cs).thickness,ui=>i(cs).thickness=ui),po(Ea,()=>i(cs).lineStyle,ui=>i(cs).lineStyle=ui),Y(Ks,aa)});var G=v(od,2),Bt=y(G);Bt.__click=to,_(G),_(Ol),Y(sa,Ol)},sa=>{var Ol=Yn(),od=tn(Ol);Ye(od,()=>i(ee),G=>{var Bt=kq(),Ks=y(Bt);Ro(Ks,17,()=>i(gr),fi,(aa,ko)=>{var or=wq(),pl=y(or),Nr=y(pl),qr=y(Nr,!0);_(Nr);var ec=v(Nr,2);Ye(ec,()=>i(gr).length>1,us=>{var gs=xq();gs.__click=[bq,Sg,ko],Y(us,gs)}),_(pl);var da=v(pl,2),Uo=y(da),Qa=v(y(Uo),2);mn(Qa),_(Uo);var Bn=v(Uo,2),bi=v(y(Bn),2);mn(bi),_(Bn),_(da);var No=v(da,2),yo=y(No),_a=v(y(yo),2);_a.__click=[VH,je,ce];var xi=y(_a);_(_a),_(yo);var lr=v(yo,2),Ai=v(y(lr),2),$o=y(Ai);$o.value=($o.__value=1)==null?"":1;var Br=v($o);Br.value=(Br.__value=2)==null?"":2;var oa=v(Br);oa.value=(oa.__value=3)==null?"":3;var zl=v(oa);zl.value=(zl.__value=4)==null?"":4;var ci=v(zl);ci.value=(ci.__value=5)==null?"":5,_(Ai),_(lr);var Ur=v(lr,2),fa=v(y(Ur),2),yr=y(fa);yr.value=(yr.__value="solid")==null?"":"solid";var Ea=v(yr);Ea.value=(Ea.__value="dashed")==null?"":"dashed";var Zs=v(Ea);Zs.value=(Zs.__value="dotted")==null?"":"dotted",_(fa),_(Ur),_(No),_(or),Ne(()=>{tt(qr,i(ko).name),Dt(xi,"style",`background-color: ${i(ko).color??""}`)}),As(Qa,()=>i(ko).period,us=>i(ko).period=us),As(bi,()=>i(ko).period2,us=>i(ko).period2=us),po(Ai,()=>i(ko).thickness,us=>i(ko).thickness=us),po(fa,()=>i(ko).lineStyle,us=>i(ko).lineStyle=us),Y(aa,or)});var cs=v(Ks,2),ts=y(cs);ts.__click=[LH,ee,gr],_(cs),_(Bt),Y(G,Bt)},G=>{var Bt=Yn(),Ks=tn(Bt);Ye(Ks,()=>i(Ee),cs=>{var ts=Pq(),aa=y(ts);Ro(aa,17,()=>i(pr),fi,(pl,Nr,qr)=>{var ec=Iq(),da=y(ec),Uo=y(da),Qa=y(Uo,!0);_(Uo);var Bn=v(Uo,2);Ye(Bn,()=>i(pr).length>1,Gr=>{var wa=Cq();wa.__click=[Sq,lh,Nr],Y(Gr,wa)}),_(da);var bi=v(da,2),No=y(bi),yo=v(y(No),2);mn(yo),yo.__input=ch,_(No),_(bi);var _a=v(bi,2),xi=y(_a),lr=v(y(xi),2),Ai=At(()=>Hm(qr));lr.__click=function(...Gr){var wa;(wa=i(Ai))==null||wa.apply(this,Gr)};var $o=y(lr);_(lr),_(xi);var Br=v(xi,2),oa=v(y(Br),2);oa.__change=ch;var zl=y(oa);zl.value=(zl.__value=1)==null?"":1;var ci=v(zl);ci.value=(ci.__value=2)==null?"":2;var Ur=v(ci);Ur.value=(Ur.__value=3)==null?"":3;var fa=v(Ur);fa.value=(fa.__value=4)==null?"":4;var yr=v(fa);yr.value=(yr.__value=5)==null?"":5,_(oa),_(Br);var Ea=v(Br,2),Zs=v(y(Ea),2);Zs.__change=ch;var us=y(Zs);us.value=(us.__value="solid")==null?"":"solid";var gs=v(us);gs.value=(gs.__value="dashed")==null?"":"dashed";var ui=v(gs);ui.value=(ui.__value="dotted")==null?"":"dotted",_(Zs),_(Ea),_(_a),_(ec),Ne(()=>{tt(Qa,i(Nr).name),Dt($o,"style",`background-color: ${i(Nr).color??""}`)}),As(yo,()=>i(Nr).period,Gr=>i(Nr).period=Gr),po(oa,()=>i(Nr).thickness,Gr=>i(Nr).thickness=Gr),po(Zs,()=>i(Nr).lineStyle,Gr=>i(Nr).lineStyle=Gr),Y(pl,ec)});var ko=v(aa,2),or=y(ko);or.__click=[EH,Ee,pr,ch],_(ko),_(ts),Y(cs,ts)},cs=>{var ts=Yn(),aa=tn(ts);Ye(aa,()=>i(Cc),ko=>{var or=Aq(),pl=y(or);Ro(pl,17,()=>i(oc),fi,(ec,da,Uo)=>{var Qa=Nq(),Bn=y(Qa),bi=y(Bn);bi.textContent=Uo===0?"Awesome Oscillator":`AO ${Uo+1}`;var No=v(bi,2);No.__click=[Mq,Wm,da],_(Bn);var yo=v(Bn,2),_a=y(yo),xi=v(y(_a),2);mn(xi),xi.__input=im,_(_a);var lr=v(_a,2),Ai=v(y(lr),2);mn(Ai),Ai.__input=im,_(lr),_(yo);var $o=v(yo,2),Br=v(y($o),2),oa=y(Br),zl=v(y(oa),2),ci=y(zl),Ur=v(ci,2),fa=At(()=>gf(Uo*3));Ur.__click=function(...qi){var oi;(oi=i(fa))==null||oi.apply(this,qi)};var yr=y(Ur);_(Ur),_(zl),_(oa);var Ea=v(oa,2),Zs=v(y(Ea),2),us=y(Zs),gs=v(us,2),ui=At(()=>gf(Uo*3+1));gs.__click=function(...qi){var oi;(oi=i(ui))==null||oi.apply(this,qi)};var Gr=y(gs);_(gs),_(Zs),_(Ea);var wa=v(Ea,2),el=v(y(wa),2),ei=y(el),ji=v(ei,2),Ti=At(()=>gf(Uo*3+2));ji.__click=function(...qi){var oi;(oi=i(Ti))==null||oi.apply(this,qi)};var Bi=y(ji);_(ji),_(el),_(wa),_(Br),_($o),_(Qa),Ne(()=>{Dt(ci,"style",`background-color: ${i(da).styles.increasing.color??""}`),Dt(yr,"style",`background-color: ${i(da).styles.increasing.color??""}`),Dt(us,"style",`background-color: ${i(da).styles.decreasing.color??""}`),Dt(Gr,"style",`background-color: ${i(da).styles.decreasing.color??""}`),Dt(ei,"style",`background-color: ${i(da).styles.reverse.color??""}`),Dt(Bi,"style",`background-color: ${i(da).styles.reverse.color??""}`)}),As(xi,()=>i(da).shortPeriod,qi=>i(da).shortPeriod=qi),As(Ai,()=>i(da).longPeriod,qi=>i(da).longPeriod=qi),Y(ec,Qa)});var Nr=v(pl,2),qr=y(Nr);qr.__click=[zH,Cc,oc,im],_(Nr),_(or),Y(ko,or)},ko=>{var or=Yn(),pl=tn(or);Ye(pl,()=>i(we),Nr=>{var qr=Eq(),ec=y(qr);Ro(ec,17,()=>i(Cr),fi,(Qa,Bn,bi)=>{var No=Lq(),yo=y(No),_a=y(yo);_a.textContent=`CR ${bi+1}`;var xi=v(_a,2);Ye(xi,()=>i(Cr).length>1,Ka=>{var Ru=Fq();Ru.__click=[Tq,zi,Bn],Y(Ka,Ru)}),_(yo);var lr=v(yo,2),Ai=y(lr),$o=v(y(Ai),2);mn($o),$o.__input=nu,_(Ai);var Br=v(Ai,2),oa=v(y(Br),2);mn(oa),oa.__input=nu,_(Br);var zl=v(Br,2),ci=v(y(zl),2);mn(ci),ci.__input=nu,_(zl);var Ur=v(zl,2),fa=v(y(Ur),2);mn(fa),fa.__input=nu,_(Ur);var yr=v(Ur,2),Ea=v(y(yr),2);mn(Ea),Ea.__input=nu,_(yr),_(lr);var Zs=v(lr,2),us=y(Zs),gs=v(y(us),2),ui=At(()=>$l(bi,"cr"));gs.__click=function(...Ka){var Ru;(Ru=i(ui))==null||Ru.apply(this,Ka)};var Gr=y(gs);_(gs);var wa=v(gs,2);wa.__change=nu;var el=y(wa);el.value=(el.__value=1)==null?"":1;var ei=v(el);ei.value=(ei.__value=2)==null?"":2;var ji=v(ei);ji.value=(ji.__value=3)==null?"":3;var Ti=v(ji);Ti.value=(Ti.__value=4)==null?"":4;var Bi=v(Ti);Bi.value=(Bi.__value=5)==null?"":5,_(wa);var qi=v(wa,2);qi.__change=nu;var oi=y(qi);oi.value=(oi.__value="solid")==null?"":"solid";var Jo=v(oi);Jo.value=(Jo.__value="dashed")==null?"":"dashed";var Ar=v(Jo);Ar.value=(Ar.__value="dotted")==null?"":"dotted",_(qi),_(us);var $i=v(us,2),Ui=v(y($i),2),wi=At(()=>$l(bi,"ma1"));Ui.__click=function(...Ka){var Ru;(Ru=i(wi))==null||Ru.apply(this,Ka)};var tl=y(Ui);_(Ui);var _o=v(Ui,2);_o.__change=nu;var rl=y(_o);rl.value=(rl.__value=1)==null?"":1;var br=v(rl);br.value=(br.__value=2)==null?"":2;var di=v(br);di.value=(di.__value=3)==null?"":3;var $a=v(di);$a.value=($a.__value=4)==null?"":4;var ti=v($a);ti.value=(ti.__value=5)==null?"":5,_(_o);var ki=v(_o,2);ki.__change=nu;var Or=y(ki);Or.value=(Or.__value="solid")==null?"":"solid";var Qr=v(Or);Qr.value=(Qr.__value="dashed")==null?"":"dashed";var cr=v(Qr);cr.value=(cr.__value="dotted")==null?"":"dotted",_(ki),_($i);var ya=v($i,2),Ga=v(y(ya),2),zr=At(()=>$l(bi,"ma2"));Ga.__click=function(...Ka){var Ru;(Ru=i(zr))==null||Ru.apply(this,Ka)};var ea=y(Ga);_(Ga);var pa=v(Ga,2);pa.__change=nu;var Ko=y(pa);Ko.value=(Ko.__value=1)==null?"":1;var no=v(Ko);no.value=(no.__value=2)==null?"":2;var Si=v(no);Si.value=(Si.__value=3)==null?"":3;var ka=v(Si);ka.value=(ka.__value=4)==null?"":4;var Xo=v(ka);Xo.value=(Xo.__value=5)==null?"":5,_(pa);var Sa=v(pa,2);Sa.__change=nu;var tr=y(Sa);tr.value=(tr.__value="solid")==null?"":"solid";var Ya=v(tr);Ya.value=(Ya.__value="dashed")==null?"":"dashed";var ac=v(Ya);ac.value=(ac.__value="dotted")==null?"":"dotted",_(Sa),_(ya);var ml=v(ya,2),wl=v(y(ml),2),Kl=At(()=>$l(bi,"ma3"));wl.__click=function(...Ka){var Ru;(Ru=i(Kl))==null||Ru.apply(this,Ka)};var Dc=y(wl);_(wl);var pc=v(wl,2);pc.__change=nu;var ru=y(pc);ru.value=(ru.__value=1)==null?"":1;var Wc=v(ru);Wc.value=(Wc.__value=2)==null?"":2;var Hc=v(Wc);Hc.value=(Hc.__value=3)==null?"":3;var Ca=v(Hc);Ca.value=(Ca.__value=4)==null?"":4;var au=v(Ca);au.value=(au.__value=5)==null?"":5,_(pc);var zd=v(pc,2);zd.__change=nu;var uf=y(zd);uf.value=(uf.__value="solid")==null?"":"solid";var mu=v(uf);mu.value=(mu.__value="dashed")==null?"":"dashed";var hu=v(mu);hu.value=(hu.__value="dotted")==null?"":"dotted",_(zd),_(ml);var id=v(ml,2),lu=v(y(id),2),Ia=At(()=>$l(bi,"ma4"));lu.__click=function(...Ka){var Ru;(Ru=i(Ia))==null||Ru.apply(this,Ka)};var Kf=y(lu);_(lu);var Vr=v(lu,2);Vr.__change=nu;var Of=y(Vr);Of.value=(Of.__value=1)==null?"":1;var Tf=v(Of);Tf.value=(Tf.__value=2)==null?"":2;var Rl=v(Tf);Rl.value=(Rl.__value=3)==null?"":3;var Ff=v(Rl);Ff.value=(Ff.__value=4)==null?"":4;var df=v(Ff);df.value=(df.__value=5)==null?"":5,_(Vr);var Qd=v(Vr,2);Qd.__change=nu;var Yu=y(Qd);Yu.value=(Yu.__value="solid")==null?"":"solid";var nf=v(Yu);nf.value=(nf.__value="dashed")==null?"":"dashed";var pp=v(nf);pp.value=(pp.__value="dotted")==null?"":"dotted",_(Qd),_(id),_(Zs),_(No),Ne(()=>{Dt(Gr,"style",`background-color: ${i(Bn).styles.cr.color??""}`),Dt(tl,"style",`background-color: ${i(Bn).styles.ma1.color??""}`),Dt(ea,"style",`background-color: ${i(Bn).styles.ma2.color??""}`),Dt(Dc,"style",`background-color: ${i(Bn).styles.ma3.color??""}`),Dt(Kf,"style",`background-color: ${i(Bn).styles.ma4.color??""}`)}),As($o,()=>i(Bn).crPeriod,Ka=>i(Bn).crPeriod=Ka),As(oa,()=>i(Bn).crMa1Period,Ka=>i(Bn).crMa1Period=Ka),As(ci,()=>i(Bn).crMa2Period,Ka=>i(Bn).crMa2Period=Ka),As(fa,()=>i(Bn).crMa3Period,Ka=>i(Bn).crMa3Period=Ka),As(Ea,()=>i(Bn).crMa4Period,Ka=>i(Bn).crMa4Period=Ka),po(wa,()=>i(Bn).styles.cr.thickness,Ka=>i(Bn).styles.cr.thickness=Ka),po(qi,()=>i(Bn).styles.cr.lineStyle,Ka=>i(Bn).styles.cr.lineStyle=Ka),po(_o,()=>i(Bn).styles.ma1.thickness,Ka=>i(Bn).styles.ma1.thickness=Ka),po(ki,()=>i(Bn).styles.ma1.lineStyle,Ka=>i(Bn).styles.ma1.lineStyle=Ka),po(pa,()=>i(Bn).styles.ma2.thickness,Ka=>i(Bn).styles.ma2.thickness=Ka),po(Sa,()=>i(Bn).styles.ma2.lineStyle,Ka=>i(Bn).styles.ma2.lineStyle=Ka),po(pc,()=>i(Bn).styles.ma3.thickness,Ka=>i(Bn).styles.ma3.thickness=Ka),po(zd,()=>i(Bn).styles.ma3.lineStyle,Ka=>i(Bn).styles.ma3.lineStyle=Ka),po(Vr,()=>i(Bn).styles.ma4.thickness,Ka=>i(Bn).styles.ma4.thickness=Ka),po(Qd,()=>i(Bn).styles.ma4.lineStyle,Ka=>i(Bn).styles.ma4.lineStyle=Ka),Y(Qa,No)});var da=v(ec,2),Uo=y(da);Uo.__click=[OH,we,Cr,nu],_(da),_(qr),Y(Nr,qr)},Nr=>{var qr=Yn(),ec=tn(qr);Ye(ec,()=>i(np),da=>{var Uo=Dq(),Qa=y(Uo);Ro(Qa,17,()=>i(An),fi,(No,yo,_a)=>{var xi=$q(),lr=y(xi),Ai=y(lr);Ai.textContent=`ZigZag ${_a+1}`,_(lr);var $o=v(lr,2),Br=y($o),oa=v(y(Br),2);mn(oa),oa.__input=_n,_(Br);var zl=v(Br,2),ci=v(y(zl),2);mn(ci),ci.__input=_n,_(zl),_($o);var Ur=v($o,2),fa=v(y(Ur),2),yr=y(fa),Ea=v(y(yr),2),Zs=y(Ea),us=v(Zs,2);us.__click=()=>Rn(_a);var gs=y(us);_(us),_(Ea),_(yr);var ui=v(yr,2),Gr=v(y(ui),2);Gr.__change=_n;var wa=y(Gr);wa.value=(wa.__value=1)==null?"":1;var el=v(wa);el.value=(el.__value=2)==null?"":2;var ei=v(el);ei.value=(ei.__value=3)==null?"":3;var ji=v(ei);ji.value=(ji.__value=4)==null?"":4;var Ti=v(ji);Ti.value=(Ti.__value=5)==null?"":5,_(Gr),_(ui);var Bi=v(ui,2),qi=v(y(Bi),2);qi.__change=_n;var oi=y(qi);oi.value=(oi.__value="solid")==null?"":"solid";var Jo=v(oi);Jo.value=(Jo.__value="dashed")==null?"":"dashed";var Ar=v(Jo);Ar.value=(Ar.__value="dotted")==null?"":"dotted",_(qi),_(Bi),_(fa),_(Ur),_(xi),Ne(()=>{Dt(Zs,"style",`background-color: ${i(yo).styles.color??""}`),Dt(gs,"style",`background-color: ${i(yo).styles.color??""}`)}),As(oa,()=>i(yo).deviation,$i=>i(yo).deviation=$i),As(ci,()=>i(yo).depth,$i=>i(yo).depth=$i),po(Gr,()=>i(yo).styles.thickness,$i=>i(yo).styles.thickness=$i),po(qi,()=>i(yo).styles.lineStyle,$i=>i(yo).styles.lineStyle=$i),Y(No,xi)});var Bn=v(Qa,2),bi=y(Bn);bi.__click=[NH,An,_n],_(Bn),_(Uo),Y(da,Uo)},da=>{var Uo=Yn(),Qa=tn(Uo);Ye(Qa,()=>i(Hu),Bn=>{var bi=Bq(),No=y(bi);Ro(No,17,()=>i(Rr),fi,(xi,lr,Ai)=>{var $o=jq(),Br=y($o),oa=y(Br),zl=y(oa);Ne(()=>tt(zl,`${i(lr).name??""} (ID: ${i(lr).id.slice(0,8)??""})`)),_(oa);var ci=v(oa,2);Ye(ci,()=>i(Rr).length>1,Jo=>{var Ar=Rq();Ar.__click=()=>pd(Ai),Y(Jo,Ar)}),_(Br);var Ur=v(Br,2),fa=y(Ur),yr=v(y(fa),2),Ea=At(()=>Yh(Ai));yr.__click=function(...Jo){var Ar;(Ar=i(Ea))==null||Ar.apply(this,Jo)};var Zs=y(yr);_(yr),_(fa);var us=v(fa,2),gs=v(y(us),2);gs.__change=Jo=>{Jo.target&&(i(lr).thickness=parseInt(Jo.target.value),km(Ai))};var ui=y(gs);ui.value=(ui.__value=1)==null?"":1;var Gr=v(ui);Gr.value=(Gr.__value=2)==null?"":2;var wa=v(Gr);wa.value=(wa.__value=3)==null?"":3;var el=v(wa);el.value=(el.__value=4)==null?"":4;var ei=v(el);ei.value=(ei.__value=5)==null?"":5,_(gs),_(us);var ji=v(us,2),Ti=v(y(ji),2);Ti.__change=Jo=>{Jo.target&&(i(lr).lineStyle=Jo.target.value,km(Ai))};var Bi=y(Ti);Bi.value=(Bi.__value="solid")==null?"":"solid";var qi=v(Bi);qi.value=(qi.__value="dashed")==null?"":"dashed";var oi=v(qi);oi.value=(oi.__value="dotted")==null?"":"dotted",_(Ti),_(ji),_(Ur),_($o),Ne(()=>Dt(Zs,"style",`background-color: ${i(lr).color??""}`)),po(gs,()=>i(lr).thickness,Jo=>i(lr).thickness=Jo),po(Ti,()=>i(lr).lineStyle,Jo=>i(lr).lineStyle=Jo),Y(xi,$o)});var yo=v(No,2),_a=y(yo);_a.__click=lf,_(yo),_(bi),Y(Bn,bi)},Bn=>{var bi=Yn(),No=tn(bi);Ye(No,()=>i(bd),yo=>{var _a=Wq(),xi=y(_a);Ro(xi,17,()=>i(_c),fi,($o,Br,oa)=>{var zl=Vq(),ci=y(zl),Ur=y(ci);Ur.textContent=`SAR ${oa+1}`;var fa=v(Ur,2);Ye(fa,()=>i(_c).length>1,wi=>{var tl=zq();tl.__click=[Oq,Xd,Br],Y(wi,tl)}),_(ci);var yr=v(ci,2),Ea=y(yr),Zs=v(y(Ea),2);mn(Zs),_(Ea);var us=v(Ea,2),gs=v(y(us),2);mn(gs),_(us);var ui=v(us,2),Gr=v(y(ui),2);mn(Gr),_(ui),_(yr);var wa=v(yr,2),el=y(wa),ei=v(y(el),2),ji=At(()=>lg(oa));ei.__click=function(...wi){var tl;(tl=i(ji))==null||tl.apply(this,wi)};var Ti=y(ei);_(ei),_(el);var Bi=v(el,2),qi=v(y(Bi),2),oi=y(qi);oi.value=(oi.__value=1)==null?"":1;var Jo=v(oi);Jo.value=(Jo.__value=2)==null?"":2;var Ar=v(Jo);Ar.value=(Ar.__value=3)==null?"":3;var $i=v(Ar);$i.value=($i.__value=4)==null?"":4;var Ui=v($i);Ui.value=(Ui.__value=5)==null?"":5,_(qi),_(Bi),_(wa),_(zl),Ne(()=>Dt(Ti,"style",`background-color: ${i(Br).color??""}`)),As(Zs,()=>i(Br).start,wi=>i(Br).start=wi),As(gs,()=>i(Br).increment,wi=>i(Br).increment=wi),As(Gr,()=>i(Br).maxValue,wi=>i(Br).maxValue=wi),po(qi,()=>i(Br).dotSize,wi=>i(Br).dotSize=wi),Y($o,zl)});var lr=v(xi,2),Ai=y(lr);Ai.__click=[RH,bd,_c,go],_(lr),_(_a),Y(yo,_a)},yo=>{var _a=Yn(),xi=tn(_a);Ye(xi,()=>i(Nt),lr=>{var Ai=Gq(),$o=y(Ai);Ro($o,17,()=>i(gu),fi,(zl,ci,Ur)=>{var fa=Uq(),yr=y(fa),Ea=y(yr);Ea.textContent=`Smart Trend ${Ur+1}`;var Zs=v(Ea,2);Ye(Zs,()=>i(gu).length>1,tr=>{var Ya=qq();Ya.__click=[Hq,Jr,ci],Y(tr,Ya)}),_(yr);var us=v(yr,2),gs=y(us),ui=v(y(gs),2);mn(ui),ui.__change=()=>Yl(Ur),_(gs);var Gr=v(gs,2),wa=v(y(Gr),2);mn(wa),wa.__change=()=>Yl(Ur),_(Gr),_(us);var el=v(us,2),ei=y(el);mn(ei),ei.__change=()=>Yl(Ur),Di(2),_(el);var ji=v(el,2),Ti=v(y(ji),2),Bi=y(Ti),qi=v(y(Bi),2);qi.__click=()=>{x(hi,!0),x(Pu,V(Ur)),x(wc,"uptrend")};var oi=y(qi);_(qi),_(Bi);var Jo=v(Bi,2),Ar=v(y(Jo),2);Ar.__change=()=>Yl(Ur);var $i=y(Ar);$i.value=($i.__value=1)==null?"":1;var Ui=v($i);Ui.value=(Ui.__value=2)==null?"":2;var wi=v(Ui);wi.value=(wi.__value=3)==null?"":3;var tl=v(wi);tl.value=(tl.__value=4)==null?"":4;var _o=v(tl);_o.value=(_o.__value=5)==null?"":5,_(Ar),_(Jo);var rl=v(Jo,2),br=v(y(rl),2);br.__change=()=>Yl(Ur);var di=y(br);di.value=(di.__value="solid")==null?"":"solid";var $a=v(di);$a.value=($a.__value="dashed")==null?"":"dashed",_(br),_(rl),_(Ti),_(ji);var ti=v(ji,2),ki=v(y(ti),2),Or=y(ki),Qr=v(y(Or),2);Qr.__click=()=>{x(hi,!0),x(Pu,V(Ur)),x(wc,"downtrend")};var cr=y(Qr);_(Qr),_(Or);var ya=v(Or,2),Ga=v(y(ya),2);Ga.__change=()=>Yl(Ur);var zr=y(Ga);zr.value=(zr.__value=1)==null?"":1;var ea=v(zr);ea.value=(ea.__value=2)==null?"":2;var pa=v(ea);pa.value=(pa.__value=3)==null?"":3;var Ko=v(pa);Ko.value=(Ko.__value=4)==null?"":4;var no=v(Ko);no.value=(no.__value=5)==null?"":5,_(Ga),_(ya);var Si=v(ya,2),ka=v(y(Si),2);ka.__change=()=>Yl(Ur);var Xo=y(ka);Xo.value=(Xo.__value="solid")==null?"":"solid";var Sa=v(Xo);Sa.value=(Sa.__value="dashed")==null?"":"dashed",_(ka),_(Si),_(ki),_(ti),_(fa),Ne(()=>{Dt(oi,"style",`background-color: ${i(ci).styles.uptrend.color??""}`),Dt(cr,"style",`background-color: ${i(ci).styles.downtrend.color??""}`)}),As(ui,()=>i(ci).period,tr=>i(ci).period=tr),As(wa,()=>i(ci).multiplier,tr=>i(ci).multiplier=tr),jg(ei,()=>i(ci).showLabels,tr=>i(ci).showLabels=tr),po(Ar,()=>i(ci).styles.uptrend.thickness,tr=>i(ci).styles.uptrend.thickness=tr),po(br,()=>i(ci).styles.uptrend.lineStyle,tr=>i(ci).styles.uptrend.lineStyle=tr),po(Ga,()=>i(ci).styles.downtrend.thickness,tr=>i(ci).styles.downtrend.thickness=tr),po(ka,()=>i(ci).styles.downtrend.lineStyle,tr=>i(ci).styles.downtrend.lineStyle=tr),Y(zl,fa)});var Br=v($o,2),oa=y(Br);oa.__click=[jH,Nt,gu,Eu],_(Br),_(Ai),Y(lr,Ai)},lr=>{var Ai=Yn(),$o=tn(Ai);Ye($o,()=>i(Yd),Br=>{var oa=nU(),zl=y(oa);Ro(zl,17,()=>d,fi,(Ur,fa,yr)=>{var Ea=eU(),Zs=y(Ea),us=y(Zs),gs=y(us,!0);_(us);var ui=v(us,2),Gr=y(ui);mn(Gr),Gr.__change=[Yq,un];var wa=v(Gr,2);Ye(wa,()=>u.length>1,ei=>{var ji=Kq();ji.__click=()=>Wl(yr),Y(ei,ji)},ei=>{var ji=Xq();Y(ei,ji)}),_(ui),_(Zs);var el=v(Zs,2);Ye(el,()=>h[yr],ei=>{var ji=Qq(),Ti=y(ji),Bi=v(y(Ti),2),qi=At(()=>Dv(yr));Bi.__click=function(...ki){var Or;(Or=i(qi))==null||Or.apply(this,ki)};var oi=y(Bi);_(Bi),_(Ti);var Jo=v(Ti,2),Ar=v(y(Jo),2);Ar.__change=[Zq,un];var $i=y(Ar);$i.value=($i.__value=1)==null?"":1;var Ui=v($i);Ui.value=(Ui.__value=2)==null?"":2;var wi=v(Ui);wi.value=(wi.__value=3)==null?"":3;var tl=v(wi);tl.value=(tl.__value=4)==null?"":4;var _o=v(tl);_o.value=(_o.__value=5)==null?"":5,_(Ar),_(Jo);var rl=v(Jo,2),br=v(y(rl),2);br.__change=[Jq,un];var di=y(br);di.value=(di.__value="solid")==null?"":"solid";var $a=v(di);$a.value=($a.__value="dashed")==null?"":"dashed";var ti=v($a);ti.value=(ti.__value="dotted")==null?"":"dotted",_(br),_(rl),_(ji),Ne(()=>Dt(oi,"style",`background-color: ${h[yr].color??""}`)),po(Ar,()=>h[yr].thickness,ki=>h[yr].thickness=ki),po(br,()=>h[yr].lineStyle,ki=>h[yr].lineStyle=ki),Y(ei,ji)}),_(Ea),Ne(()=>tt(gs,i(fa).title)),As(Gr,()=>u[yr],ei=>u[yr]=ei),Y(Ur,Ea)});var ci=v(zl,2);Ye(ci,()=>d.length<10,Ur=>{var fa=tU(),yr=y(fa);yr.__click=[Tb,Nu,td,Dl,Cc,gd,Gd,Lh,qu,gh,d,u,h,Au,Ln,Yd,un],_(fa),Y(Ur,fa)}),_(oa),Y(Br,oa)},Br=>{var oa=Yn(),zl=tn(oa);Ye(zl,()=>i(Md),ci=>{var Ur=iU(),fa=y(Ur);Ro(fa,17,()=>i(Wi),fi,(Zs,us,gs)=>{var ui=oU(),Gr=y(ui),wa=y(Gr),el=y(wa);_(wa);var ei=v(wa,2);Ye(ei,()=>i(Wi).length>1,Or=>{var Qr=sU();Qr.__click=()=>Ts(gs),Y(Or,Qr)}),_(Gr);var ji=v(Gr,2),Ti=v(y(ji),2);mn(Ti),Ti.__change=()=>Ws(gs),_(ji);var Bi=v(ji,2),qi=y(Bi),oi=v(y(qi),2);oi.__click=Or=>{x(ud,V(gs));const Qr=Or.currentTarget.getBoundingClientRect();x(uu,V({x:Qr.left+Qr.width/2,y:Qr.bottom+5})),x(Wa,!0)};var Jo=y(oi);_(oi),_(qi);var Ar=v(qi,2),$i=v(y(Ar),2);$i.__change=()=>Ws(gs);var Ui=y($i);Ui.value=(Ui.__value=1)==null?"":1;var wi=v(Ui);wi.value=(wi.__value=2)==null?"":2;var tl=v(wi);tl.value=(tl.__value=3)==null?"":3;var _o=v(tl);_o.value=(_o.__value=4)==null?"":4;var rl=v(_o);rl.value=(rl.__value=5)==null?"":5,_($i),_(Ar);var br=v(Ar,2),di=v(y(br),2);di.__change=()=>Ws(gs);var $a=y(di);$a.value=($a.__value="solid")==null?"":"solid";var ti=v($a);ti.value=(ti.__value="dashed")==null?"":"dashed";var ki=v(ti);ki.value=(ki.__value="dotted")==null?"":"dotted",_(di),_(br),_(Bi),_(ui),Ne(()=>{tt(el,`SMA (${i(us).period??""})`),Dt(Jo,"style",`background-color: ${i(us).color??""}`)}),As(Ti,()=>i(us).period,Or=>i(us).period=Or),po($i,()=>i(us).thickness,Or=>i(us).thickness=Or),po(di,()=>i(us).lineStyle,Or=>i(us).lineStyle=Or),Y(Zs,ui)});var yr=v(fa,2),Ea=y(yr);Ea.__click=bo,_(yr),_(Ur),Y(ci,Ur)},ci=>{var Ur=Yn(),fa=tn(Ur);Ye(fa,()=>i(Tu),yr=>{var Ea=cU();Ro(Ea,21,()=>i(St),fi,(Zs,us,gs)=>{var ui=lU(),Gr=y(ui),wa=y(Gr);wa.textContent=`Volume ${gs+1}`;var el=v(wa,2);Ye(el,()=>i(St).length>1,tr=>{var Ya=rU();Ya.__click=()=>qe(gs),Y(tr,Ya)},tr=>{var Ya=aU();Y(tr,Ya)}),_(Gr);var ei=v(Gr,2),ji=y(ei),Ti=v(y(ji),2);mn(Ti),Ti.__change=()=>Wt(gs),_(ji),_(ei);var Bi=v(ei,2),qi=v(y(Bi),2),oi=y(qi),Jo=v(y(oi),2),Ar=At(()=>hh(gs,"histogram"));Jo.__click=function(...tr){var Ya;(Ya=i(Ar))==null||Ya.apply(this,tr)};var $i=y(Jo);_(Jo),_(oi);var Ui=v(oi,2),wi=v(y(Ui),2),tl=At(()=>hh(gs,"histogram-down"));wi.__click=function(...tr){var Ya;(Ya=i(tl))==null||Ya.apply(this,tr)};var _o=y(wi);_(wi),_(Ui),_(qi),_(Bi);var rl=v(Bi,2),br=v(y(rl),2),di=y(br);mn(di),di.__change=()=>Wt(gs),Di(2),_(br);var $a=v(br,2),ti=y($a),ki=v(y(ti),2),Or=At(()=>hh(gs,"ema"));ki.__click=function(...tr){var Ya;(Ya=i(Or))==null||Ya.apply(this,tr)};var Qr=y(ki);_(ki),_(ti);var cr=v(ti,2),ya=v(y(cr),2);ya.__change=()=>Wt(gs);var Ga=y(ya);Ga.value=(Ga.__value=1)==null?"":1;var zr=v(Ga);zr.value=(zr.__value=2)==null?"":2;var ea=v(zr);ea.value=(ea.__value=3)==null?"":3;var pa=v(ea);pa.value=(pa.__value=4)==null?"":4;var Ko=v(pa);Ko.value=(Ko.__value=5)==null?"":5,_(ya),_(cr);var no=v(cr,2),Si=v(y(no),2);Si.__change=()=>Wt(gs);var ka=y(Si);ka.value=(ka.__value="solid")==null?"":"solid";var Xo=v(ka);Xo.value=(Xo.__value="dashed")==null?"":"dashed";var Sa=v(Xo);Sa.value=(Sa.__value="dotted")==null?"":"dotted",_(Si),_(no),_($a),_(rl),_(ui),Ne(()=>{Dt($i,"style",`background-color: ${i(us).styles.histogram.upColor??""}`),Dt(_o,"style",`background-color: ${i(us).styles.histogram.downColor??""}`),Dt(Qr,"style",`background-color: ${i(us).styles.ema.color??""}`)}),As(Ti,()=>i(us).period,tr=>i(us).period=tr),jg(di,()=>i(us).styles.ema.visible,tr=>i(us).styles.ema.visible=tr),po(ya,()=>i(us).styles.ema.thickness,tr=>i(us).styles.ema.thickness=tr),po(Si,()=>i(us).styles.ema.lineStyle,tr=>i(us).styles.ema.lineStyle=tr),Y(Zs,ui)}),_(Ea),Y(yr,Ea)},yr=>{var Ea=Yn(),Zs=tn(Ea);Ye(Zs,()=>i(qu),us=>{var gs=pU(),ui=y(gs);Ro(ui,17,()=>i(fu),fi,(el,ei,ji)=>{var Ti=dU(),Bi=y(Ti),qi=y(Bi),oi=y(qi,!0);_(qi);var Jo=v(qi,2);Ye(Jo,()=>i(fu).length>1,mu=>{var hu=uU();hu.__click=()=>yl(ji),Y(mu,hu)}),_(Bi);var Ar=v(Bi,2),$i=y(Ar),Ui=v(y($i),2);mn(Ui),Ui.__input=()=>uv(ji),_($i);var wi=v($i,2),tl=v(y(wi),2);mn(tl),tl.__input=()=>uv(ji),_(wi),_(Ar);var _o=v(Ar,2),rl=y(_o),br=v(y(rl),2);_(rl);var di=v(rl,2),$a=y(di),ti=v(y($a),2);mn(ti),ti.__input=()=>uv(ji),_($a);var ki=v($a,2),Or=v(y(ki),2);Or.__change=()=>uv(ji);var Qr=y(Or);Qr.value=(Qr.__value=1)==null?"":1;var cr=v(Qr);cr.value=(cr.__value=2)==null?"":2;var ya=v(cr);ya.value=(ya.__value=3)==null?"":3;var Ga=v(ya);Ga.value=(Ga.__value=4)==null?"":4;var zr=v(Ga);zr.value=(zr.__value=5)==null?"":5,_(Or),_(ki);var ea=v(ki,2),pa=v(y(ea),2);pa.__change=()=>uv(ji);var Ko=y(pa);Ko.value=(Ko.__value="solid")==null?"":"solid";var no=v(Ko);no.value=(no.__value="dashed")==null?"":"dashed";var Si=v(no);Si.value=(Si.__value="dotted")==null?"":"dotted",_(pa),_(ea),_(di),_(_o);var ka=v(_o,2),Xo=y(ka),Sa=v(y(Xo),2);_(Xo);var tr=v(Xo,2),Ya=y(tr),ac=v(y(Ya),2);mn(ac),ac.__input=()=>uv(ji),_(Ya);var ml=v(Ya,2),wl=v(y(ml),2);wl.__change=()=>uv(ji);var Kl=y(wl);Kl.value=(Kl.__value=1)==null?"":1;var Dc=v(Kl);Dc.value=(Dc.__value=2)==null?"":2;var pc=v(Dc);pc.value=(pc.__value=3)==null?"":3;var ru=v(pc);ru.value=(ru.__value=4)==null?"":4;var Wc=v(ru);Wc.value=(Wc.__value=5)==null?"":5,_(wl),_(ml);var Hc=v(ml,2),Ca=v(y(Hc),2);Ca.__change=()=>uv(ji);var au=y(Ca);au.value=(au.__value="solid")==null?"":"solid";var zd=v(au);zd.value=(zd.__value="dashed")==null?"":"dashed";var uf=v(zd);uf.value=(uf.__value="dotted")==null?"":"dotted",_(Ca),_(Hc),_(tr),_(ka),_(Ti),Ne(()=>{tt(oi,i(ei).name),Dt(br,"style",`background-color: ${i(ei).styles.trix.color??""}`),Dt(Sa,"style",`background-color: ${i(ei).styles.signal.color??""}`)}),As(Ui,()=>i(ei).trixPeriod,mu=>i(ei).trixPeriod=mu),As(tl,()=>i(ei).signalPeriod,mu=>i(ei).signalPeriod=mu),As(ti,()=>i(ei).styles.trix.color,mu=>i(ei).styles.trix.color=mu),po(Or,()=>i(ei).styles.trix.thickness,mu=>i(ei).styles.trix.thickness=mu),po(pa,()=>i(ei).styles.trix.lineStyle,mu=>i(ei).styles.trix.lineStyle=mu),As(ac,()=>i(ei).styles.signal.color,mu=>i(ei).styles.signal.color=mu),po(wl,()=>i(ei).styles.signal.thickness,mu=>i(ei).styles.signal.thickness=mu),po(Ca,()=>i(ei).styles.signal.lineStyle,mu=>i(ei).styles.signal.lineStyle=mu),Y(el,Ti)});var Gr=v(ui,2),wa=y(Gr);wa.__click=[fU,dl],_(Gr),_(gs),Y(us,gs)},us=>{var gs=Yn(),ui=tn(gs);Ye(ui,()=>i(td),Gr=>{var wa=gU(),el=y(wa);Ro(el,17,()=>i(so),fi,(Ti,Bi,qi)=>{var oi=vU(),Jo=y(oi),Ar=y(Jo);Ar.textContent=`BIAS ${qi+1}`;var $i=v(Ar,2);Ye($i,()=>i(so).length>1,Ko=>{var no=hU();no.__click=[mU,wd,Bi],Y(Ko,no)}),_(Jo);var Ui=v(Jo,2),wi=v(y(Ui),2);mn(wi),wi.__input=Gl,_(Ui);var tl=v(Ui,2),_o=y(tl),rl=v(y(_o),2),br=At(()=>wm(qi));rl.__click=function(...Ko){var no;(no=i(br))==null||no.apply(this,Ko)};var di=y(rl);_(rl),_(_o);var $a=v(_o,2),ti=v(y($a),2);ti.__change=Gl;var ki=y(ti);ki.value=(ki.__value=1)==null?"":1;var Or=v(ki);Or.value=(Or.__value=2)==null?"":2;var Qr=v(Or);Qr.value=(Qr.__value=3)==null?"":3;var cr=v(Qr);cr.value=(cr.__value=4)==null?"":4,_(ti),_($a);var ya=v($a,2),Ga=v(y(ya),2);Ga.__change=Gl;var zr=y(Ga);zr.value=(zr.__value="solid")==null?"":"solid";var ea=v(zr);ea.value=(ea.__value="dashed")==null?"":"dashed";var pa=v(ea);pa.value=(pa.__value="dotted")==null?"":"dotted",_(Ga),_(ya),_(tl),_(oi),Ne(()=>Dt(di,"style",`background-color: ${i(Bi).color??""}`)),As(wi,()=>i(Bi).period,Ko=>i(Bi).period=Ko),po(ti,()=>i(Bi).thickness,Ko=>i(Bi).thickness=Ko),po(Ga,()=>i(Bi).lineStyle,Ko=>i(Bi).lineStyle=Ko),Y(Ti,oi)});var ei=v(el,2),ji=y(ei);ji.__click=[$H,td,so,Gl],_(ei),_(wa),Y(Gr,wa)},Gr=>{var wa=Yn(),el=tn(wa);Ye(el,()=>i(ke),ei=>{var ji=xU(),Ti=y(ji);Ro(Ti,17,()=>i(mo),fi,(oi,Jo,Ar)=>{var $i=bU(),Ui=y($i),wi=y(Ui);wi.textContent=`CCI ${Ar+1}`;var tl=v(wi,2);Ye(tl,()=>i(mo).length>1,ka=>{var Xo=yU();Xo.__click=[_U,Yp,Jo],Y(ka,Xo)}),_(Ui);var _o=v(Ui,2),rl=v(y(_o),2);mn(rl),rl.__input=md,_(_o);var br=v(_o,2),di=y(br),$a=v(y(di),2),ti=At(()=>rm(Ar));$a.__click=function(...ka){var Xo;(Xo=i(ti))==null||Xo.apply(this,ka)};var ki=y($a);_($a),_(di);var Or=v(di,2),Qr=v(y(Or),2);Qr.__change=md;var cr=y(Qr);cr.value=(cr.__value=1)==null?"":1;var ya=v(cr);ya.value=(ya.__value=2)==null?"":2;var Ga=v(ya);Ga.value=(Ga.__value=3)==null?"":3;var zr=v(Ga);zr.value=(zr.__value=4)==null?"":4,_(Qr),_(Or);var ea=v(Or,2),pa=v(y(ea),2);pa.__change=md;var Ko=y(pa);Ko.value=(Ko.__value="solid")==null?"":"solid";var no=v(Ko);no.value=(no.__value="dashed")==null?"":"dashed";var Si=v(no);Si.value=(Si.__value="dotted")==null?"":"dotted",_(pa),_(ea),_(br),_($i),Ne(()=>Dt(ki,"style",`background-color: ${i(Jo).color??""}`)),As(rl,()=>i(Jo).period,ka=>i(Jo).period=ka),po(Qr,()=>i(Jo).thickness,ka=>i(Jo).thickness=ka),po(pa,()=>i(Jo).lineStyle,ka=>i(Jo).lineStyle=ka),Y(oi,$i)});var Bi=v(Ti,2),qi=y(Bi);qi.__click=[DH,ke,mo,md],_(Bi),_(ji),Y(ei,ji)},ei=>{var ji=Yn(),Ti=tn(ji);Ye(Ti,()=>i(Kd),Bi=>{var qi=CU(),oi=y(qi),Jo=v(y(oi),2);Ro(Jo,21,()=>i(Td),fi,(Ui,wi,tl)=>{var _o=SU(),rl=y(_o),br=y(rl),di=y(br,!0);_(br);var $a=v(br,2);Ye($a,()=>i(Td).length>1,ki=>{var Or=wU();Or.__click=()=>fh(tl),Y(ki,Or)}),_(rl);var ti=v(rl,4);Ro(ti,17,()=>d,fi,(ki,Or,Qr)=>{var cr=kU(),ya=y(cr),Ga=y(ya),zr=v(Ga,2),ea=y(zr,!0);_(zr),_(ya);var pa=v(ya,2),Ko=v(y(pa),2);mn(Ko),Ko.__change=()=>Vm(),_(pa);var no=v(pa,2),Si=v(y(no),2),ka=At(()=>Um(Qr,tl));Si.__click=function(...Ca){var au;(au=i(ka))==null||au.apply(this,Ca)};var Xo=y(Si);_(Si),_(no);var Sa=v(no,2),tr=v(y(Sa),2);tr.__change=()=>Vm();var Ya=y(tr);Ya.value=(Ya.__value=1)==null?"":1;var ac=v(Ya);ac.value=(ac.__value=2)==null?"":2;var ml=v(ac);ml.value=(ml.__value=3)==null?"":3;var wl=v(ml);wl.value=(wl.__value=4)==null?"":4;var Kl=v(wl);Kl.value=(Kl.__value=5)==null?"":5,_(tr),_(Sa);var Dc=v(Sa,2),pc=v(y(Dc),2);pc.__change=()=>Vm();var ru=y(pc);ru.value=(ru.__value="solid")==null?"":"solid";var Wc=v(ru);Wc.value=(Wc.__value="dashed")==null?"":"dashed";var Hc=v(Wc);Hc.value=(Hc.__value="dotted")==null?"":"dotted",_(pc),_(Dc),_(cr),Ne(()=>{var Ca,au;Dt(Ga,"style",`background-color: ${((Ca=i(wi).styles[Qr])==null?void 0:Ca.color)??""}`),tt(ea,i(Or).title),Dt(Xo,"style",`background-color: ${((au=i(wi).styles[Qr])==null?void 0:au.color)??""}`)}),As(Ko,()=>i(wi).params[Qr],Ca=>i(wi).params[Qr]=Ca),po(tr,()=>i(wi).styles[Qr].thickness,Ca=>i(wi).styles[Qr].thickness=Ca),po(pc,()=>i(wi).styles[Qr].lineStyle,Ca=>i(wi).styles[Qr].lineStyle=Ca),Y(ki,cr)}),_(_o),Ne(()=>tt(di,i(wi).name)),Y(Ui,_o)}),_(Jo);var Ar=v(Jo,2),$i=y(Ar);$i.__click=$v,_(Ar),Di(2),_(oi),_(qi),Y(Bi,qi)},Bi=>{var qi=Yn(),oi=tn(qi);Ye(oi,()=>i(Md),Jo=>{var Ar=AU(),$i=y(Ar);Ro($i,17,()=>d,fi,(wi,tl,_o)=>{var rl=MU(),br=y(rl),di=y(br),$a=y(di,!0);_(di);var ti=v(di,2),ki=y(ti);mn(ki);var Or=v(ki,2);Ye(Or,()=>u.length>1,wl=>{var Kl=IU();Kl.__click=()=>Wl(_o),Y(wl,Kl)},wl=>{var Kl=PU();Y(wl,Kl)}),_(ti),_(br);var Qr=v(br,2),cr=y(Qr),ya=v(y(cr),2),Ga=At(()=>Rv(_o));ya.__click=function(...wl){var Kl;(Kl=i(Ga))==null||Kl.apply(this,wl)};var zr=y(ya);_(ya),_(cr);var ea=v(cr,2),pa=v(y(ea),2),Ko=y(pa);Ko.value=(Ko.__value=1)==null?"":1;var no=v(Ko);no.value=(no.__value=2)==null?"":2;var Si=v(no);Si.value=(Si.__value=3)==null?"":3;var ka=v(Si);ka.value=(ka.__value=4)==null?"":4;var Xo=v(ka);Xo.value=(Xo.__value=5)==null?"":5,_(pa),_(ea);var Sa=v(ea,2),tr=v(y(Sa),2),Ya=y(tr);Ya.value=(Ya.__value="solid")==null?"":"solid";var ac=v(Ya);ac.value=(ac.__value="dashed")==null?"":"dashed";var ml=v(ac);ml.value=(ml.__value="dotted")==null?"":"dotted",_(tr),_(Sa),_(Qr),_(rl),Ne(()=>{tt($a,i(tl).title),Dt(zr,"style",`background-color: ${h[_o].color??""}`)}),As(ki,()=>u[_o],wl=>u[_o]=wl),po(pa,()=>h[_o].thickness,wl=>h[_o].thickness=wl),po(tr,()=>h[_o].lineStyle,wl=>h[_o].lineStyle=wl),Y(wi,rl)});var Ui=v($i,2);Ye(Ui,()=>d.length<10,wi=>{var tl=NU(),_o=y(tl);_o.__click=[Tb,Nu,td,Dl,Cc,gd,Gd,Lh,qu,gh,d,u,h,Au,Ln,Yd,un],_(tl),Y(wi,tl)}),_(Ar),Y(Jo,Ar)},Jo=>{var Ar=Yn(),$i=tn(Ar);Ye($i,()=>i(Au),Ui=>{var wi=BU(),tl=y(wi);Ro(tl,17,()=>d,fi,(rl,br,di)=>{var $a=RU(),ti=y($a),ki=y(ti),Or=y(ki,!0);_(ki);var Qr=v(ki,2),cr=y(Qr);mn(cr),cr.__change=[TU,Ln];var ya=v(cr,2);Ye(ya,()=>u.length>1,zr=>{var ea=FU();ea.__click=()=>Wl(di),Y(zr,ea)},zr=>{var ea=LU();Y(zr,ea)}),_(Qr),_(ti);var Ga=v(ti,2);Ye(Ga,()=>h[di],zr=>{var ea=DU(),pa=y(ea),Ko=v(y(pa),2),no=At(()=>Kh(di));Ko.__click=function(...Wc){var Hc;(Hc=i(no))==null||Hc.apply(this,Wc)};var Si=y(Ko);_(Ko),_(pa);var ka=v(pa,2),Xo=v(y(ka),2);Xo.__change=[EU,Ln];var Sa=y(Xo);Sa.value=(Sa.__value=1)==null?"":1;var tr=v(Sa);tr.value=(tr.__value=2)==null?"":2;var Ya=v(tr);Ya.value=(Ya.__value=3)==null?"":3;var ac=v(Ya);ac.value=(ac.__value=4)==null?"":4;var ml=v(ac);ml.value=(ml.__value=5)==null?"":5,_(Xo),_(ka);var wl=v(ka,2),Kl=v(y(wl),2);Kl.__change=[$U,Ln];var Dc=y(Kl);Dc.value=(Dc.__value="solid")==null?"":"solid";var pc=v(Dc);pc.value=(pc.__value="dashed")==null?"":"dashed";var ru=v(pc);ru.value=(ru.__value="dotted")==null?"":"dotted",_(Kl),_(wl),_(ea),Ne(()=>Dt(Si,"style",`background-color: ${h[di].color??""}`)),po(Xo,()=>h[di].thickness,Wc=>h[di].thickness=Wc),po(Kl,()=>h[di].lineStyle,Wc=>h[di].lineStyle=Wc),Y(zr,ea)}),_($a),Ne(()=>tt(Or,i(br).title)),As(cr,()=>u[di],zr=>u[di]=zr),Y(rl,$a)});var _o=v(tl,2);Ye(_o,()=>d.length<10,rl=>{var br=jU(),di=y(br);di.__click=[Tb,Nu,td,Dl,Cc,gd,Gd,Lh,qu,gh,d,u,h,Au,Ln,Yd,un],_(br),Y(rl,br)}),_(wi),Y(Ui,wi)},Ui=>{var wi=Yn(),tl=tn(wi);Ye(tl,()=>i($d),_o=>{var rl=WU(),br=y(rl);Ro(br,17,()=>i(ba),fi,(ti,ki,Or)=>{var Qr=VU(),cr=y(Qr),ya=y(cr);ya.textContent=`ROC ${Or+1}`;var Ga=v(ya,2);Ye(Ga,()=>i(ba).length>1,Ca=>{var au=zU();au.__click=[OU,dh,ki],Y(Ca,au)}),_(cr);var zr=v(cr,2),ea=y(zr),pa=v(y(ea),2);mn(pa),pa.__change=()=>Kp(Or),_(ea);var Ko=v(ea,2),no=y(Ko),Si=v(y(no),2),ka=At(()=>$p(Or));Si.__click=function(...Ca){var au;(au=i(ka))==null||au.apply(this,Ca)};var Xo=y(Si);_(Si),_(no);var Sa=v(no,2),tr=v(y(Sa),2);tr.__change=()=>Kp(Or);var Ya=y(tr);Ya.value=(Ya.__value=1)==null?"":1;var ac=v(Ya);ac.value=(ac.__value=2)==null?"":2;var ml=v(ac);ml.value=(ml.__value=3)==null?"":3;var wl=v(ml);wl.value=(wl.__value=4)==null?"":4;var Kl=v(wl);Kl.value=(Kl.__value=5)==null?"":5,_(tr),_(Sa);var Dc=v(Sa,2),pc=v(y(Dc),2);pc.__change=()=>Kp(Or);var ru=y(pc);ru.value=(ru.__value="solid")==null?"":"solid";var Wc=v(ru);Wc.value=(Wc.__value="dashed")==null?"":"dashed";var Hc=v(Wc);Hc.value=(Hc.__value="dotted")==null?"":"dotted",_(pc),_(Dc),_(Ko),_(zr),_(Qr),Ne(()=>Dt(Xo,"style",`background-color: ${i(ki).styles.roc.color??""}`)),As(pa,()=>i(ki).period,Ca=>i(ki).period=Ca),po(tr,()=>i(ki).styles.roc.thickness,Ca=>i(ki).styles.roc.thickness=Ca),po(pc,()=>i(ki).styles.roc.lineStyle,Ca=>i(ki).styles.roc.lineStyle=Ca),Y(ti,Qr)});var di=v(br,2),$a=y(di);$a.__click=_m,_(di),_(rl),Y(_o,rl)},_o=>{var rl=Yn(),br=tn(rl);Ye(br,()=>i(Pf),di=>{var $a=GU(),ti=y($a);Ro(ti,17,()=>i(Zr),fi,(Qr,cr,ya)=>{var Ga=UU(),zr=y(Ga),ea=y(zr);ea.textContent=`PSY ${ya+1}`;var pa=v(ea,2);Ye(pa,()=>i(Zr).length>1,mc=>{var Ku=qU();Ku.__click=[HU,Ah,cr],Y(mc,Ku)}),_(zr);var Ko=v(zr,2),no=y(Ko),Si=v(y(no),2);mn(Si),Si.__change=()=>Rf(ya),_(no);var ka=v(no,2),Xo=v(y(ka),2),Sa=y(Xo),tr=v(y(Sa),2),Ya=At(()=>qm(ya*2));tr.__click=function(...mc){var Ku;(Ku=i(Ya))==null||Ku.apply(this,mc)};var ac=y(tr);_(tr),_(Sa);var ml=v(Sa,2),wl=v(y(ml),2);wl.__change=()=>Rf(ya);var Kl=y(wl);Kl.value=(Kl.__value=1)==null?"":1;var Dc=v(Kl);Dc.value=(Dc.__value=2)==null?"":2;var pc=v(Dc);pc.value=(pc.__value=3)==null?"":3;var ru=v(pc);ru.value=(ru.__value=4)==null?"":4;var Wc=v(ru);Wc.value=(Wc.__value=5)==null?"":5,_(wl),_(ml);var Hc=v(ml,2),Ca=v(y(Hc),2);Ca.__change=()=>Rf(ya);var au=y(Ca);au.value=(au.__value="solid")==null?"":"solid";var zd=v(au);zd.value=(zd.__value="dashed")==null?"":"dashed";var uf=v(zd);uf.value=(uf.__value="dotted")==null?"":"dotted",_(Ca),_(Hc),_(Xo),_(ka);var mu=v(ka,2),hu=v(y(mu),2);mn(hu),hu.__change=()=>Rf(ya),_(mu);var id=v(mu,2),lu=v(y(id),2),Ia=y(lu),Kf=v(y(Ia),2),Vr=At(()=>qm(ya*2+1));Kf.__click=function(...mc){var Ku;(Ku=i(Vr))==null||Ku.apply(this,mc)};var Of=y(Kf);_(Kf),_(Ia);var Tf=v(Ia,2),Rl=v(y(Tf),2);Rl.__change=()=>Rf(ya);var Ff=y(Rl);Ff.value=(Ff.__value=1)==null?"":1;var df=v(Ff);df.value=(df.__value=2)==null?"":2;var Qd=v(df);Qd.value=(Qd.__value=3)==null?"":3;var Yu=v(Qd);Yu.value=(Yu.__value=4)==null?"":4;var nf=v(Yu);nf.value=(nf.__value=5)==null?"":5,_(Rl),_(Tf);var pp=v(Tf,2),Ka=v(y(pp),2);Ka.__change=()=>Rf(ya);var Ru=y(Ka);Ru.value=(Ru.__value="solid")==null?"":"solid";var Xf=v(Ru);Xf.value=(Xf.__value="dashed")==null?"":"dashed";var zf=v(Xf);zf.value=(zf.__value="dotted")==null?"":"dotted",_(Ka),_(pp),_(lu),_(id);var Qp=v(id,2),bp=y(Qp);mn(bp),bp.__change=()=>Rf(ya);var Cm=v(bp,2);_(Qp),_(Ko),_(Ga),Ne(()=>{Dt(ac,"style",`background-color: ${i(cr).styles.psy.color??""}`),Dt(Of,"style",`background-color: ${i(cr).styles.mapsy.color??""}`),Dt(bp,"id",`showMapsy_${i(cr).id??""}`),Dt(Cm,"for",`showMapsy_${i(cr).id??""}`)}),As(Si,()=>i(cr).psyPeriod,mc=>i(cr).psyPeriod=mc),po(wl,()=>i(cr).styles.psy.thickness,mc=>i(cr).styles.psy.thickness=mc),po(Ca,()=>i(cr).styles.psy.lineStyle,mc=>i(cr).styles.psy.lineStyle=mc),As(hu,()=>i(cr).mapsyPeriod,mc=>i(cr).mapsyPeriod=mc),po(Rl,()=>i(cr).styles.mapsy.thickness,mc=>i(cr).styles.mapsy.thickness=mc),po(Ka,()=>i(cr).styles.mapsy.lineStyle,mc=>i(cr).styles.mapsy.lineStyle=mc),jg(bp,()=>i(cr).showMapsy,mc=>i(cr).showMapsy=mc),Y(Qr,Ga)});var ki=v(ti,2),Or=y(ki);Or.__click=ym,_(ki),_($a),Y(di,$a)},di=>{var $a=Yn(),ti=tn($a);Ye(ti,()=>i(oe),ki=>{var Or=ZU(),Qr=y(Or);Ro(Qr,17,()=>i(Qi),fi,(Ga,zr,ea)=>{var pa=XU(),Ko=y(pa),no=y(Ko);no.textContent=`OBV ${ea+1}`;var Si=v(no,2);Ye(Si,()=>i(Qi).length>1,mc=>{var Ku=KU();Ku.__click=[YU,Uh,zr],Y(mc,Ku)}),_(Ko);var ka=v(Ko,2),Xo=y(ka),Sa=v(y(Xo),2);mn(Sa),Sa.__input=om,_(Xo);var tr=v(Xo,2),Ya=v(y(tr),2),ac=y(Ya),ml=v(y(ac),2),wl=At(()=>Fh(ea*2));ml.__click=function(...mc){var Ku;(Ku=i(wl))==null||Ku.apply(this,mc)};var Kl=y(ml);_(ml),_(ac);var Dc=v(ac,2),pc=v(y(Dc),2);pc.__change=om;var ru=y(pc);ru.value=(ru.__value=1)==null?"":1;var Wc=v(ru);Wc.value=(Wc.__value=2)==null?"":2;var Hc=v(Wc);Hc.value=(Hc.__value=3)==null?"":3;var Ca=v(Hc);Ca.value=(Ca.__value=4)==null?"":4;var au=v(Ca);au.value=(au.__value=5)==null?"":5,_(pc),_(Dc);var zd=v(Dc,2),uf=v(y(zd),2);uf.__change=om;var mu=y(uf);mu.value=(mu.__value="solid")==null?"":"solid";var hu=v(mu);hu.value=(hu.__value="dashed")==null?"":"dashed";var id=v(hu);id.value=(id.__value="dotted")==null?"":"dotted",_(uf),_(zd),_(Ya),_(tr);var lu=v(tr,2),Ia=v(y(lu),2);mn(Ia),Ia.__input=om,Di(2),_(lu);var Kf=v(lu,2),Vr=v(y(Kf),2),Of=y(Vr),Tf=v(y(Of),2),Rl=At(()=>Fh(ea*2+1));Tf.__click=function(...mc){var Ku;(Ku=i(Rl))==null||Ku.apply(this,mc)};var Ff=y(Tf);_(Tf),_(Of);var df=v(Of,2),Qd=v(y(df),2);Qd.__change=om;var Yu=y(Qd);Yu.value=(Yu.__value=1)==null?"":1;var nf=v(Yu);nf.value=(nf.__value=2)==null?"":2;var pp=v(nf);pp.value=(pp.__value=3)==null?"":3;var Ka=v(pp);Ka.value=(Ka.__value=4)==null?"":4;var Ru=v(Ka);Ru.value=(Ru.__value=5)==null?"":5,_(Qd),_(df);var Xf=v(df,2),zf=v(y(Xf),2);zf.__change=om;var Qp=y(zf);Qp.value=(Qp.__value="solid")==null?"":"solid";var bp=v(Qp);bp.value=(bp.__value="dashed")==null?"":"dashed";var Cm=v(bp);Cm.value=(Cm.__value="dotted")==null?"":"dotted",_(zf),_(Xf),_(Vr),_(Kf),_(ka),_(pa),Ne(()=>{Dt(Kl,"style",`background-color: ${i(zr).styles.obv.color??""}`),Dt(Ff,"style",`background-color: ${i(zr).styles.maobv.color??""}`)}),As(Sa,()=>i(zr).obvPeriod,mc=>i(zr).obvPeriod=mc),po(pc,()=>i(zr).styles.obv.thickness,mc=>i(zr).styles.obv.thickness=mc),po(uf,()=>i(zr).styles.obv.lineStyle,mc=>i(zr).styles.obv.lineStyle=mc),As(Ia,()=>i(zr).maobvPeriod,mc=>i(zr).maobvPeriod=mc),po(Qd,()=>i(zr).styles.maobv.thickness,mc=>i(zr).styles.maobv.thickness=mc),po(zf,()=>i(zr).styles.maobv.lineStyle,mc=>i(zr).styles.maobv.lineStyle=mc),Y(Ga,pa)});var cr=v(Qr,2),ya=y(cr);ya.__click=Om,_(cr),_(Or),Y(ki,Or)},ki=>{var Or=Yn(),Qr=tn(Or);Ye(Qr,()=>i(re),cr=>{var ya=tG(),Ga=y(ya);Ro(Ga,17,()=>i(os),fi,(pa,Ko,no)=>{var Si=eG(),ka=y(Si),Xo=y(ka);Xo.textContent=`KDJ ${no+1}`;var Sa=v(Xo,2);Ye(Sa,()=>i(os).length>1,se=>{var Ft=QU();Ft.__click=[JU,wu,Ko],Y(se,Ft)}),_(ka);var tr=v(ka,2),Ya=y(tr),ac=y(Ya),ml=v(y(ac),2);mn(ml),ml.__input=se=>{se.target&&(console.log("📊 K Period changed to:",se.target.value,"for group:",no),fp(no))},_(ac);var wl=v(ac,2),Kl=v(y(wl),2);mn(Kl),Kl.__input=se=>{se.target&&(console.log("📊 D Period changed to:",se.target.value,"for group:",no),fp(no))},_(wl),_(Ya);var Dc=v(Ya,2),pc=v(y(Dc),2),ru=v(y(pc),2),Wc=At(()=>am(no,0));ru.__click=function(...se){var Ft;(Ft=i(Wc))==null||Ft.apply(this,se)};var Hc=y(ru);_(ru);var Ca=v(ru,2);Ca.__change=()=>fp(no);var au=y(Ca);au.value=(au.__value=1)==null?"":1;var zd=v(au);zd.value=(zd.__value=2)==null?"":2;var uf=v(zd);uf.value=(uf.__value=3)==null?"":3;var mu=v(uf);mu.value=(mu.__value=4)==null?"":4;var hu=v(mu);hu.value=(hu.__value=5)==null?"":5,_(Ca);var id=v(Ca,2);id.__change=()=>fp(no);var lu=y(id);lu.value=(lu.__value="solid")==null?"":"solid";var Ia=v(lu);Ia.value=(Ia.__value="dashed")==null?"":"dashed";var Kf=v(Ia);Kf.value=(Kf.__value="dotted")==null?"":"dotted",_(id),_(pc),_(Dc);var Vr=v(Dc,2),Of=v(y(Vr),2),Tf=v(y(Of),2),Rl=At(()=>am(no,1));Tf.__click=function(...se){var Ft;(Ft=i(Rl))==null||Ft.apply(this,se)};var Ff=y(Tf);_(Tf);var df=v(Tf,2);df.__change=()=>fp(no);var Qd=y(df);Qd.value=(Qd.__value=1)==null?"":1;var Yu=v(Qd);Yu.value=(Yu.__value=2)==null?"":2;var nf=v(Yu);nf.value=(nf.__value=3)==null?"":3;var pp=v(nf);pp.value=(pp.__value=4)==null?"":4;var Ka=v(pp);Ka.value=(Ka.__value=5)==null?"":5,_(df);var Ru=v(df,2);Ru.__change=()=>fp(no);var Xf=y(Ru);Xf.value=(Xf.__value="solid")==null?"":"solid";var zf=v(Xf);zf.value=(zf.__value="dashed")==null?"":"dashed";var Qp=v(zf);Qp.value=(Qp.__value="dotted")==null?"":"dotted",_(Ru),_(Of),_(Vr);var bp=v(Vr,2),Cm=v(y(bp),2),mc=v(y(Cm),2),Ku=At(()=>am(no,2));mc.__click=function(...se){var Ft;(Ft=i(Ku))==null||Ft.apply(this,se)};var Xh=y(mc);_(mc);var xp=v(mc,2);xp.__change=()=>fp(no);var Im=y(xp);Im.value=(Im.__value=1)==null?"":1;var Ym=v(Im);Ym.value=(Ym.__value=2)==null?"":2;var Bh=v(Ym);Bh.value=(Bh.__value=3)==null?"":3;var Oh=v(Bh);Oh.value=(Oh.__value=4)==null?"":4;var Iv=v(Oh);Iv.value=(Iv.__value=5)==null?"":5,_(xp);var Vd=v(xp,2);Vd.__change=()=>fp(no);var ju=y(Vd);ju.value=(ju.__value="solid")==null?"":"solid";var Wp=v(ju);Wp.value=(Wp.__value="dashed")==null?"":"dashed";var fv=v(Wp);fv.value=(fv.__value="dotted")==null?"":"dotted",_(Vd),_(Cm),_(bp),_(tr),_(Si),Ne(()=>{Dt(Hc,"style",`background-color: ${i(Ko).styles.k.color??""}`),Dt(Ff,"style",`background-color: ${i(Ko).styles.d.color??""}`),Dt(Xh,"style",`background-color: ${i(Ko).styles.j.color??""}`)}),As(ml,()=>i(Ko).kPeriod,se=>i(Ko).kPeriod=se),As(Kl,()=>i(Ko).dPeriod,se=>i(Ko).dPeriod=se),po(Ca,()=>i(Ko).styles.k.thickness,se=>i(Ko).styles.k.thickness=se),po(id,()=>i(Ko).styles.k.lineStyle,se=>i(Ko).styles.k.lineStyle=se),po(df,()=>i(Ko).styles.d.thickness,se=>i(Ko).styles.d.thickness=se),po(Ru,()=>i(Ko).styles.d.lineStyle,se=>i(Ko).styles.d.lineStyle=se),po(xp,()=>i(Ko).styles.j.thickness,se=>i(Ko).styles.j.thickness=se),po(Vd,()=>i(Ko).styles.j.lineStyle,se=>i(Ko).styles.j.lineStyle=se),Y(pa,Si)});var zr=v(Ga,2),ea=y(zr);ea.__click=zm,_(zr),_(ya),Y(cr,ya)},cr=>{var ya=Yn(),Ga=tn(ya);Ye(Ga,()=>i(K),zr=>{var ea=rG(),pa=y(ea),Ko=v(y(pa),2),no=y(Ko),Si=v(y(no),2);mn(Si),Si.__change=[AH,Ms,vc],_(no);var ka=v(no,2),Xo=v(y(ka),2);Xo.__click=[nG,$s];var Sa=y(Xo);const tr=At(()=>`background-color: ${g(i(la),i(ur))}`);_(Xo),_(ka),_(Ko);var Ya=v(Ko,2),ac=y(Ya),ml=v(y(ac),2),wl=y(ml);_(ml),_(ac);var Kl=v(ac,2);mn(Kl),Kl.__change=wo,_(Ya),_(pa);var Dc=v(pa,2),pc=v(y(Dc),2),ru=v(y(pc),2);mn(ru),ru.__change=[TH,Ms,gl],_(pc);var Wc=v(pc,2),Hc=y(Wc),Ca=v(y(Hc),2);Ca.__click=[sG,$s];var au=y(Ca);_(Ca),_(Hc);var zd=v(Hc,2),uf=v(y(zd),2);uf.__click=[oG,$s];var mu=y(uf);_(uf),_(zd),_(Wc);var hu=v(Wc,2),id=y(hu),lu=v(y(id),2);lu.__change=[p5,Ms,cl,kc];var Ia=y(lu);Ia.value=(Ia.__value=1)==null?"":1;var Kf=v(Ia);Kf.value=(Kf.__value=2)==null?"":2;var Vr=v(Kf);Vr.value=(Vr.__value=3)==null?"":3;var Of=v(Vr);Of.value=(Of.__value=4)==null?"":4;var Tf=v(Of);Tf.value=(Tf.__value=5)==null?"":5,_(lu),_(id);var Rl=v(id,2),Ff=v(y(Rl),2);Ff.__change=[p5,Ms,cl,kc];var df=y(Ff);df.value=(df.__value="solid")==null?"":"solid";var Qd=v(df);Qd.value=(Qd.__value="dashed")==null?"":"dashed",_(Ff),_(Rl);var Yu=v(Rl,2),nf=v(y(Yu),2);nf.__change=[m5,Ms,uc,Tl];var pp=y(nf);pp.value=(pp.__value=1)==null?"":1;var Ka=v(pp);Ka.value=(Ka.__value=2)==null?"":2;var Ru=v(Ka);Ru.value=(Ru.__value=3)==null?"":3;var Xf=v(Ru);Xf.value=(Xf.__value=4)==null?"":4;var zf=v(Xf);zf.value=(zf.__value=5)==null?"":5,_(nf),_(Yu);var Qp=v(Yu,2),bp=v(y(Qp),2);bp.__change=[m5,Ms,uc,Tl];var Cm=y(bp);Cm.value=(Cm.__value="solid")==null?"":"solid";var mc=v(Cm);mc.value=(mc.__value="dashed")==null?"":"dashed",_(bp),_(Qp),_(hu),_(Dc);var Ku=v(Dc,2),Xh=v(y(Ku),2),xp=y(Xh),Im=v(y(xp),2);Im.__click=[iG,$s];var Ym=y(Im);_(Im),_(xp);var Bh=v(xp,2),Oh=v(y(Bh),2);Oh.__change=[f5,Ms,$r,Il];var Iv=y(Oh);Iv.value=(Iv.__value=1)==null?"":1;var Vd=v(Iv);Vd.value=(Vd.__value=2)==null?"":2;var ju=v(Vd);ju.value=(ju.__value=3)==null?"":3;var Wp=v(ju);Wp.value=(Wp.__value=4)==null?"":4;var fv=v(Wp);fv.value=(fv.__value=5)==null?"":5,_(Oh),_(Bh);var se=v(Bh,2),Ft=v(y(se),2);Ft.__change=[f5,Ms,$r,Il];var dt=y(Ft);dt.value=(dt.__value="solid")==null?"":"solid";var on=v(dt);on.value=(on.__value="dashed")==null?"":"dashed",_(Ft),_(se),_(Xh),_(Ku);var bt=v(Ku,2),_s=v(y(bt),2),zn=v(y(_s),2);mn(zn),zn.__change=[FH,Ms,za],_(_s),_(bt),_(ea),Ne(()=>{Dt(Sa,"style",i(tr)),tt(wl,`${i(ur)??""}%`),Dt(au,"style",`background-color: ${i(Oa)}`),Dt(mu,"style",`background-color: ${i(ni)}`),Dt(Ym,"style",`background-color: ${i(Fl)}`)}),jg(Si,()=>i(vc),On=>x(vc,On)),As(Kl,()=>i(ur),On=>x(ur,On)),jg(ru,()=>i(gl),On=>x(gl,On)),po(lu,()=>i(cl),On=>x(cl,On)),po(Ff,()=>i(kc),On=>x(kc,On)),po(nf,()=>i(uc),On=>x(uc,On)),po(bp,()=>i(Tl),On=>x(Tl,On)),po(Oh,()=>i($r),On=>x($r,On)),po(Ft,()=>i(Il),On=>x(Il,On)),jg(zn,()=>i(za),On=>x(za,On)),Y(zr,ea)},zr=>{var ea=Yn(),pa=tn(ea);Ye(pa,()=>i(Nu),Ko=>{var no=yG(),Si=y(no),ka=v(y(Si),2),Xo=y(ka),Sa=v(y(Xo),2);mn(Sa),_(Xo);var tr=v(Xo,2),Ya=v(y(tr),2);mn(Ya),_(tr),_(ka),_(Si);var ac=v(Si,2),ml=v(y(ac),2),wl=v(y(ml),2),Kl=y(wl),Dc=v(Kl,2);Dc.__click=[aG,Vs];var pc=y(Dc);_(Dc),_(wl),_(ml);var ru=v(ml,2),Wc=y(ru),Hc=v(y(Wc),2),Ca=y(Hc);_(Hc),_(Wc);var au=v(Wc,2);mn(au),Di(2),_(ru),_(ac);var zd=v(ac,2),uf=v(y(zd),2),mu=y(uf),hu=v(y(mu),2),id=y(hu),lu=v(id,2);lu.__click=[lG,Vs];var Ia=y(lu);_(lu),_(hu),_(mu);var Kf=v(mu,2),Vr=v(y(Kf),2),Of=y(Vr),Tf=v(Of,2);Tf.__click=[cG,Vs];var Rl=y(Tf);_(Tf),_(Vr),_(Kf);var Ff=v(Kf,2),df=v(y(Ff),2),Qd=y(df),Yu=v(Qd,2);Yu.__click=[uG,Vs];var nf=y(Yu);_(Yu),_(df),_(Ff),_(uf),_(zd);var pp=v(zd,2),Ka=v(y(pp),2),Ru=y(Ka),Xf=v(y(Ru),2),zf=y(Xf);zf.value=(zf.__value=1)==null?"":1;var Qp=v(zf);Qp.value=(Qp.__value=2)==null?"":2;var bp=v(Qp);bp.value=(bp.__value=3)==null?"":3;var Cm=v(bp);Cm.value=(Cm.__value=4)==null?"":4;var mc=v(Cm);mc.value=(mc.__value=5)==null?"":5,_(Xf),_(Ru);var Ku=v(Ru,2),Xh=v(y(Ku),2),xp=y(Xh);xp.value=(xp.__value="solid")==null?"":"solid";var Im=v(xp);Im.value=(Im.__value="dashed")==null?"":"dashed";var Ym=v(Im);Ym.value=(Ym.__value="dotted")==null?"":"dotted",_(Xh),_(Ku),_(Ka),_(pp);var Bh=v(pp,2),Oh=y(Bh);Oh.__click=[WH,Nu,o,l,Jl,O,D,w,C,M,P,T,N,L,ao];var Iv=v(Oh,2);Ye(Iv,()=>i(Jl).length>1,ju=>{var Wp=fG();Wp.__click=[dG,Ho],Y(ju,Wp)}),_(Bh);var Vd=v(Bh,2);Ye(Vd,()=>i(Jl).length>1,ju=>{var Wp=Yn(),fv=tn(Wp);Ro(fv,17,()=>i(Jl).slice(1),fi,(se,Ft,dt)=>{var on=_G();const bt=At(()=>dt+1);var _s=y(on),zn=y(_s),On=y(zn);_(zn);var ss=v(zn,2);ss.__click=[pG,Ho,bt],_(_s);var Cn=v(_s,2),Ht=y(Cn),Fs=v(y(Ht),2);mn(Fs),Fs.__change=ao,_(Ht);var Ds=v(Ht,2),xs=v(y(Ds),2);mn(xs),xs.__change=ao,_(Ds),_(Cn);var Rs=v(Cn,2),ys=v(y(Rs),2),ds=v(y(ys),2),Gn=y(ds),xn=v(Gn,2);xn.__click=[mG,Vs,bt];var Ei=y(xn);_(xn),_(ds),_(ys);var kl=v(ys,2),Do=y(kl),oo=v(y(Do),2),ma=y(oo);_(oo),_(Do);var Xa=v(Do,2);mn(Xa),Xa.__change=ao,_(kl),_(Rs);var bc=v(Rs,2),Da=v(y(bc),2),Vf=y(Da),Tr=v(y(Vf),2),zo=y(Tr),ha=v(zo,2);ha.__click=[hG,Vs,bt];var Yr=y(ha);_(ha),_(Tr),_(Vf);var Pa=v(Vf,2),Bu=v(y(Pa),2),ef=y(Bu),wp=v(ef,2);wp.__click=[vG,Vs,bt];var Hp=y(wp);_(wp),_(Bu),_(Pa);var Wd=v(Pa,2),jp=v(y(Wd),2),Zh=y(jp),kp=v(Zh,2);kp.__click=[gG,Vs,bt];var Pv=y(kp);_(kp),_(jp),_(Wd),_(Da),_(bc);var xh=v(bc,2),dm=v(y(xh),2),Bp=y(dm),wh=v(y(Bp),2);wh.__change=ao;var Pm=y(wh);Pm.value=(Pm.__value=1)==null?"":1;var Km=v(Pm);Km.value=(Km.__value=2)==null?"":2;var pg=v(Km);pg.value=(pg.__value=3)==null?"":3;var Tg=v(pg);Tg.value=(Tg.__value=4)==null?"":4;var mg=v(Tg);mg.value=(mg.__value=5)==null?"":5,_(wh),_(Bp);var o0=v(Bp,2),Hg=v(y(o0),2);Hg.__change=ao;var i0=y(Hg);i0.value=(i0.__value="solid")==null?"":"solid";var pv=v(i0);pv.value=(pv.__value="dashed")==null?"":"dashed";var Fg=v(pv);Fg.value=(Fg.__value="dotted")==null?"":"dotted",_(Hg),_(o0),_(dm),_(xh),_(on),Ne(()=>{tt(On,`BOLL ${i(bt)+1}`),Dt(ss,"title",`Remove BOLL ${i(bt)+1}`),Dt(Gn,"style",`background-color: ${i(Ft).styles.fillColor}; opacity: ${(i(Ft).styles.fillOpacity||0)/100}`),Dt(Ei,"style",`background-color: ${i(Ft).styles.fillColor}; opacity: ${(i(Ft).styles.fillOpacity||0)/100}`),tt(ma,`${i(Ft).styles.fillOpacity??""}%`),Dt(zo,"style",`background-color: ${i(Ft).styles.upperColor}`),Dt(Yr,"style",`background-color: ${i(Ft).styles.upperColor}`),Dt(ef,"style",`background-color: ${i(Ft).styles.middleColor}`),Dt(Hp,"style",`background-color: ${i(Ft).styles.middleColor}`),Dt(Zh,"style",`background-color: ${i(Ft).styles.lowerColor}`),Dt(Pv,"style",`background-color: ${i(Ft).styles.lowerColor}`)}),As(Fs,()=>i(Ft).period,mv=>i(Ft).period=mv),As(xs,()=>i(Ft).stdDev,mv=>i(Ft).stdDev=mv),As(Xa,()=>i(Ft).styles.fillOpacity,mv=>i(Ft).styles.fillOpacity=mv),po(wh,()=>i(Ft).styles.thickness,mv=>i(Ft).styles.thickness=mv),po(Hg,()=>i(Ft).styles.lineStyle,mv=>i(Ft).styles.lineStyle=mv),Y(se,on)}),Y(ju,Wp)}),_(no),Ne(()=>{Dt(Kl,"style",`background-color: ${i(w)??""}; opacity: ${i(C)/100}`),Dt(pc,"style",`background-color: ${i(w)??""}; opacity: ${i(C)/100}`),tt(Ca,`${i(C)??""}%`),Dt(id,"style",`background-color: ${i(M)??""}`),Dt(Ia,"style",`background-color: ${i(M)??""}`),Dt(Of,"style",`background-color: ${i(P)??""}`),Dt(Rl,"style",`background-color: ${i(P)??""}`),Dt(Qd,"style",`background-color: ${i(T)??""}`),Dt(nf,"style",`background-color: ${i(T)??""}`)}),As(Sa,()=>i(O),ju=>x(O,ju)),As(Ya,()=>i(D),ju=>x(D,ju)),As(au,()=>i(C),ju=>x(C,ju)),po(Xf,()=>i(N),ju=>x(N,ju)),po(Xh,()=>i(L),ju=>x(L,ju)),Y(Ko,no)},Ko=>{var no=Yn(),Si=tn(no);Ye(Si,()=>!d.length,ka=>{var Xo=bG(),Sa=y(Xo),tr=y(Sa,!0);Ne(()=>tt(tr,n4())),_(Sa),_(Xo),Y(ka,Xo)},ka=>{var Xo=CG(),Sa=y(Xo);Ro(Sa,17,()=>d,fi,(Ya,ac,ml)=>{var wl=kG(),Kl=y(wl),Dc=y(Kl),pc=y(Dc,!0);_(Dc);var ru=v(Dc,2),Wc=y(ru);mn(Wc);var Hc=v(Wc,2);Ye(Hc,()=>u.length>1&&!i(Nu),Yu=>{var nf=xG();nf.__click=()=>Wl(ml),Y(Yu,nf)},Yu=>{var nf=Yn(),pp=tn(nf);Ye(pp,()=>!i(Nu),Ka=>{var Ru=wG();Y(Ka,Ru)},null,!0),Y(Yu,nf)}),_(ru),_(Kl);var Ca=v(Kl,2),au=y(Ca),zd=v(y(au),2),uf=At(()=>rm(ml));zd.__click=function(...Yu){var nf;(nf=i(uf))==null||nf.apply(this,Yu)};var mu=y(zd);_(zd),_(au);var hu=v(au,2),id=v(y(hu),2),lu=y(id);lu.value=(lu.__value=1)==null?"":1;var Ia=v(lu);Ia.value=(Ia.__value=2)==null?"":2;var Kf=v(Ia);Kf.value=(Kf.__value=3)==null?"":3;var Vr=v(Kf);Vr.value=(Vr.__value=4)==null?"":4;var Of=v(Vr);Of.value=(Of.__value=5)==null?"":5,_(id),_(hu);var Tf=v(hu,2),Rl=v(y(Tf),2),Ff=y(Rl);Ff.value=(Ff.__value="solid")==null?"":"solid";var df=v(Ff);df.value=(df.__value="dashed")==null?"":"dashed";var Qd=v(df);Qd.value=(Qd.__value="dotted")==null?"":"dotted",_(Rl),_(Tf),_(Ca),_(wl),Ne(()=>{tt(pc,i(ac).title),Dt(mu,"style",`background-color: ${h[ml].color??""}`)}),As(Wc,()=>u[ml],Yu=>u[ml]=Yu),po(id,()=>h[ml].thickness,Yu=>h[ml].thickness=Yu),po(Rl,()=>h[ml].lineStyle,Yu=>h[ml].lineStyle=Yu),Y(Ya,wl)});var tr=v(Sa,2);Ye(tr,()=>d.length<10&&!i(Nu)&&!i(Hu)&&!i(np),Ya=>{var ac=SG(),ml=y(ac);ml.__click=[Tb,Nu,td,Dl,Cc,gd,Gd,Lh,qu,gh,d,u,h,Au,Ln,Yd,un],_(ac),Ne(()=>Dt(ml,"title",i(td)?"Add more BIAS indicator":i(Cc)?"Add more Awesome Oscillator":i(Gd)?"Add more WR indicator":i(Yd)?"Add more EMA":"Add parameter")),Y(Ya,ac)}),_(Xo),Y(ka,Xo)},!0),Y(Ko,no)},!0),Y(zr,ea)},!0),Y(cr,ya)},!0),Y(ki,Or)},!0),Y(di,$a)},!0),Y(_o,rl)},!0),Y(Ui,wi)},!0),Y(Jo,Ar)},!0),Y(Bi,qi)},!0),Y(ei,ji)},!0),Y(Gr,wa)},!0),Y(us,gs)},!0),Y(yr,Ea)},!0),Y(ci,Ur)},!0),Y(Br,oa)},!0),Y(lr,Ai)},!0),Y(yo,_a)},!0),Y(Bn,bi)},!0),Y(da,Uo)},!0),Y(Nr,qr)},!0),Y(ko,or)},!0),Y(cs,ts)},!0),Y(G,Bt)},!0),Y(sa,Ol)},!0),Y(Ua,ku)},!0),Y(Vi,xa)},!0),Y(Ri,_r)},!0),Y(Od,wf)},!0),Y(Bd,xf)},!0),Y(cf,bf)},!0),Y(Yo,Nc)},!0),Y(ns,Mn)},!0),Y(rt,Ut)},!0),Y(q,ve)});var U=v(R,2);Ye(U,()=>i(_e),q=>{var ve=IG();Y(q,ve)}),_(B),Y(k,B)},$$slots:{default:!0}});var ze=v(De,2),lt=At(()=>{var k,A;return((A=(k=i(Jl)[i(Yf)])==null?void 0:k.styles)==null?void 0:A.upperColor)||"#f23645"});lc(ze,{get show(){return i(fo)},set show(k){x(fo,V(k))},get selectedColor(){return i(lt)},get position(){return i(Ji)},$$events:{colorChange:k=>{i(Jl)[i(Yf)]?(i(Jl)[i(Yf)].styles.upperColor=k.detail.rgba||k.detail.color,ao()):x(M,V(k.detail.rgba||k.detail.color))}}});var wt=v(ze,2),qt=At(()=>{var k,A;return((A=(k=i(Jl)[i(Yf)])==null?void 0:k.styles)==null?void 0:A.middleColor)||"#2962ff"});lc(wt,{get show(){return i(Gi)},set show(k){x(Gi,V(k))},get selectedColor(){return i(qt)},get position(){return i(Al)},$$events:{colorChange:k=>{i(Jl)[i(Yf)]?(i(Jl)[i(Yf)].styles.middleColor=k.detail.rgba||k.detail.color,ao()):x(P,V(k.detail.rgba||k.detail.color))}}});var sn=v(wt,2),Ot=At(()=>{var k,A;return((A=(k=i(Jl)[i(Yf)])==null?void 0:k.styles)==null?void 0:A.lowerColor)||"#089981"});lc(sn,{get show(){return i(Ii)},set show(k){x(Ii,V(k))},get selectedColor(){return i(Ot)},get position(){return i(Wo)},$$events:{colorChange:k=>{i(Jl)[i(Yf)]?(i(Jl)[i(Yf)].styles.lowerColor=k.detail.rgba||k.detail.color,ao()):x(T,V(k.detail.rgba||k.detail.color))}}});var vn=v(sn,2),kn=At(()=>{var k,A;return((A=(k=i(Jl)[i(Yf)])==null?void 0:k.styles)==null?void 0:A.fillColor)||"#2196F3"});lc(vn,{get show(){return i(Nn)},set show(k){x(Nn,V(k))},get selectedColor(){return i(kn)},get position(){return i(Io)},$$events:{colorChange:k=>{i(Jl)[i(Yf)]?(i(Jl)[i(Yf)].styles.fillColor=k.detail.rgba||k.detail.color,ao()):x(w,V(k.detail.rgba||k.detail.color))}}});var as=v(vn,2);lc(as,{get show(){return i(To)},set show(k){x(To,V(k))},get selectedColor(){return i(Fl)},get position(){return i(Ba)},$$events:{colorChange:k=>{var B;x(Fl,V(k.detail.rgba||k.detail.color));const A=window.__npoMaeApi;(B=A==null?void 0:A.setColors)==null||B.call(A,{median:i(Fl)})}}});var Ls=v(as,2),Ys=At(()=>g(i(la),i(ur)));lc(Ls,{get show(){return i(Pi)},set show(k){x(Pi,V(k))},get selectedColor(){return i(Ys)},get position(){return i(qs)},$$events:{colorChange:k=>{x(la,V(k.detail.rgba||k.detail.color)),wo()}}});var yn=v(Ls,2);lc(yn,{get show(){return i(mi)},set show(k){x(mi,V(k))},get selectedColor(){return i(Oa)},get position(){return i(Er)},$$events:{colorChange:k=>{var B;x(Oa,V(k.detail.rgba||k.detail.color));const A=window.__npoMaeApi;(B=A==null?void 0:A.setColors)==null||B.call(A,{slLong:i(Oa)})}}});var Vt=v(yn,2);lc(Vt,{get show(){return i(Za)},set show(k){x(Za,V(k))},get selectedColor(){return i(ni)},get position(){return i(vi)},$$events:{colorChange:k=>{var B;x(ni,V(k.detail.rgba||k.detail.color));const A=window.__npoMaeApi;(B=A==null?void 0:A.setColors)==null||B.call(A,{slShort:i(ni)})}}});var Pn=v(Vt,2),Hn=At(()=>{var k,A,B;return((B=(A=(k=i(Lu)[i(te)])==null?void 0:k.styles)==null?void 0:A[i(pe)])==null?void 0:B.color)||"#2563eb"});lc(Pn,{get show(){return i($)},set show(k){x($,V(k))},get selectedColor(){return i(Hn)},get position(){return i(z)},$$events:{colorChange:k=>{i(Lu).length>i(te)&&(i(Lu)[i(te)].styles[i(pe)].color=k.detail.rgba||k.detail.color,ah(i(te),i(pe)))}}});var Tn=v(Pn,2),bn=At(()=>{var k,A,B;return((B=(A=(k=i(gu)[i(Pu)])==null?void 0:k.styles)==null?void 0:A[i(wc)])==null?void 0:B.color)||"#2563eb"});lc(Tn,{get show(){return i(hi)},set show(k){x(hi,V(k))},get selectedColor(){return i(bn)},get position(){return Gc},$$events:{colorChange:k=>{i(gu).length>i(Pu)&&i(gu)[i(Pu)].styles[i(wc)]&&(i(gu)[i(Pu)].styles[i(wc)].color=k.detail.rgba||k.detail.color,Eu())}}});var In=v(Tn,2),Hs=At(()=>{var k;return((k=i(mo)[i(de)])==null?void 0:k.color)||"#2563eb"});lc(In,{get show(){return i(J)},set show(k){x(J,V(k))},get selectedColor(){return i(Hs)},get position(){return i(le)},$$events:{colorChange:k=>{i(mo).length>i(de)&&(i(mo)[i(de)].color=k.detail.rgba||k.detail.color,md())}}});var Xt=v(In,2),jn=At(()=>{var k,A,B;return((B=(A=(k=i(El)[0])==null?void 0:k.styles)==null?void 0:A.diPlus)==null?void 0:B.color)||"#2563eb"});lc(Xt,{get show(){return i(he)},set show(k){x(he,V(k))},get selectedColor(){return i(jn)},get position(){return i(ge)},$$events:{colorChange:k=>{i(El).length>0&&(i(El)[0].styles.diPlus.color=k.detail.rgba||k.detail.color)}}});var Jn=v(Xt,2),Kt=At(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});lc(Jn,{get show(){return i(ce)},set show(k){x(ce,V(k))},get selectedColor(){return i(Kt)},get position(){return i(je)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Zt=v(Jn,2),an=At(()=>{var k;return((k=i(pr)[i(Lt)])==null?void 0:k.color)||"#2563eb"});lc(Zt,{get show(){return i(ft)},set show(k){x(ft,V(k))},get selectedColor(){return i(an)},get position(){return i(it)},$$events:{colorChange:k=>{i(pr)[i(Lt)]&&(i(pr)[i(Lt)].color=k.detail.rgba||k.detail.color,ch())}}});var rs=v(Zt,2),Sn=At(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});lc(rs,{get show(){return i(Ve)},set show(k){x(Ve,V(k))},get selectedColor(){return i(Sn)},get position(){return i(We)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Xs=v(rs,2),Ni=At(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});lc(Xs,{get show(){return i(Tt)},set show(k){x(Tt,V(k))},get selectedColor(){return i(Ni)},get position(){return i(Pt)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Qn=v(Xs,2),Fo=At(()=>{var k,A,B,R,U,q,ve,Re,rt;return i(Xe)==="histogram"?((B=(A=(k=i(St)[i(Je)])==null?void 0:k.styles)==null?void 0:A.histogram)==null?void 0:B.upColor)||"#26a69a":i(Xe)==="histogram-down"?((q=(U=(R=i(St)[i(Je)])==null?void 0:R.styles)==null?void 0:U.histogram)==null?void 0:q.downColor)||"#ef5350":((rt=(Re=(ve=i(St)[i(Je)])==null?void 0:ve.styles)==null?void 0:Re.ema)==null?void 0:rt.color)||"#2563eb"}),ps=At(()=>i(Xe)==="histogram"||i(Xe)==="histogram-down"?70:100);lc(Qn,{get show(){return i(st)},set show(k){x(st,V(k))},get selectedColor(){return i(Fo)},get opacity(){return i(ps)},get position(){return i(xt)},$$events:{colorChange:k=>{i(St).length>i(Je)&&(i(Xe)==="histogram"?i(St)[i(Je)].styles.histogram.upColor=k.detail.rgba||k.detail.color:i(Xe)==="histogram-down"?i(St)[i(Je)].styles.histogram.downColor=k.detail.rgba||k.detail.color:i(Xe)==="ema"&&(i(St)[i(Je)].styles.ema.color=k.detail.rgba||k.detail.color),Wt(i(Je)))}}});var Po=v(Qn,2),Go=At(()=>{var k,A,B;return((B=(A=(k=i(Ju)[i($t)])==null?void 0:k.styles)==null?void 0:A.wr)==null?void 0:B.color)||"#2563eb"});lc(Po,{get show(){return i(Be)},set show(k){x(Be,V(k))},get selectedColor(){return i(Go)},get position(){return i(Qe)},$$events:{colorChange:k=>{i(Ju).length>i($t)&&i(Ju)[i($t)].styles.wr&&(i(Ju)[i($t)].styles.wr.color=k.detail.rgba||k.detail.color,sp(i($t)))}}});var Ps=v(Po,2),Ns=At(()=>{var k,A,B;return((B=(A=(k=i(Ju)[i($t)])==null?void 0:k.styles)==null?void 0:A.overbought)==null?void 0:B.color)||"#FF4444"});lc(Ps,{get show(){return i(ct)},set show(k){x(ct,V(k))},get selectedColor(){return i(Ns)},get position(){return i(Mt)},$$events:{colorChange:k=>{i(Ju).length>i($t)&&i(Ju)[i($t)].styles.overbought&&(i(Ju)[i($t)].styles.overbought.color=k.detail.rgba||k.detail.color,sp(i($t)))}}});var si=v(Ps,2),Ec=At(()=>{var k,A,B;return((B=(A=(k=i(Ju)[i($t)])==null?void 0:k.styles)==null?void 0:A.oversold)==null?void 0:B.color)||"#00C851"});lc(si,{get show(){return i(mt)},set show(k){x(mt,V(k))},get selectedColor(){return i(Ec)},get position(){return i(Ce)},$$events:{colorChange:k=>{i(Ju).length>i($t)&&i(Ju)[i($t)].styles.oversold&&(i(Ju)[i($t)].styles.oversold.color=k.detail.rgba||k.detail.color,sp(i($t)))}}});var yc=v(si,2),Pc=At(()=>{var k,A,B;return((B=(A=(k=i(Ju)[i($t)])==null?void 0:k.styles)==null?void 0:A.middleLine)==null?void 0:B.color)||"#808080"});lc(yc,{get show(){return i(Te)},set show(k){x(Te,V(k))},get selectedColor(){return i(Pc)},get position(){return i(It)},$$events:{colorChange:k=>{i(Ju).length>i($t)&&i(Ju)[i($t)].styles.middleLine&&(i(Ju)[i($t)].styles.middleLine.color=k.detail.rgba||k.detail.color,sp(i($t)))}}});var rc=v(yc,2),Mc=At(()=>{var k,A,B;return((B=(A=(k=i(Dd)[i(Vn)])==null?void 0:k.styles)==null?void 0:A[i(Dn)])==null?void 0:B.color)||"#2563eb"});lc(rc,{get show(){return i(Yt)},set show(k){x(Yt,V(k))},get selectedColor(){return i(Mc)},get position(){return i(qn)},$$events:{colorChange:k=>{i(Dd).length>i(Vn)&&i(Dd)[i(Vn)].styles[i(Dn)]&&(i(Dd)[i(Vn)].styles[i(Dn)].color=k.detail.rgba||k.detail.color,ot(i(Vn)))}}});var $c=v(rc,2),bl=At(()=>{var k,A,B;return((B=(A=(k=i(ba)[i(gn)])==null?void 0:k.styles)==null?void 0:A.roc)==null?void 0:B.color)||"#2563eb"});lc($c,{get show(){return i(Wn)},set show(k){x(Wn,V(k))},get selectedColor(){return i(bl)},get position(){return i(pn)},$$events:{colorChange:k=>{i(ba).length>i(gn)&&(i(ba)[i(gn)].styles.roc.color=k.detail.rgba||k.detail.color,Kp(i(gn)))}}});var fl=v($c,2),$u=At(()=>{var k,A,B,R,U,q;return i(Cs)%2===0?((B=(A=(k=i(Zr)[Math.floor(i(Cs)/2)])==null?void 0:k.styles)==null?void 0:A.psy)==null?void 0:B.color)||"#2563eb":((q=(U=(R=i(Zr)[Math.floor(i(Cs)/2)])==null?void 0:R.styles)==null?void 0:U.mapsy)==null?void 0:q.color)||"#dc2626"});lc(fl,{get show(){return i(Qs)},set show(k){x(Qs,V(k))},get selectedColor(){return i($u)},get position(){return i(Is)},$$events:{colorChange:k=>{const A=Math.floor(i(Cs)/2);i(Zr).length>A&&(i(Cs)%2===0?(i(Zr)[A].styles.psy.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated PSY color to:",k.detail.color)):(i(Zr)[A].styles.mapsy.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated MAPSY color to:",k.detail.color)),Rf(A))}}});var sd=v(fl,2),Bl=At(()=>{var k,A,B,R,U,q;return i(zt)%2===0?((B=(A=(k=i(Qi)[Math.floor(i(zt)/2)])==null?void 0:k.styles)==null?void 0:A.obv)==null?void 0:B.color)||"#FF6B35":((q=(U=(R=i(Qi)[Math.floor(i(zt)/2)])==null?void 0:R.styles)==null?void 0:U.maobv)==null?void 0:q.color)||"#2196F3"});lc(sd,{get show(){return i(ro)},set show(k){x(ro,V(k))},get selectedColor(){return i(Bl)},get position(){return i(bs)},$$events:{colorChange:k=>{const A=Math.floor(i(zt)/2);i(Qi).length>A&&(i(zt)%2===0?(i(Qi)[A].styles.obv.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated OBV color to:",k.detail.color)):(i(Qi)[A].styles.maobv.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated MAOBV color to:",k.detail.color)),om())}}});var Sp=v(sd,2),Xc=At(()=>{var k;return((k=i(An)[i(yt)])==null?void 0:k.styles.color)||"#2962FF"});lc(Sp,{get show(){return i(Qt)},set show(k){x(Qt,V(k))},get selectedColor(){return i(Xc)},get position(){return i(ho)},$$events:{colorChange:k=>{i(An).length>i(yt)&&(i(An)[i(yt)].styles.color=k.detail.rgba||k.detail.color,_n())}}});var xl=v(Sp,2),Du=At(()=>{var k;return((k=i(Rr)[i(Na)])==null?void 0:k.color)||"#FF6B35"});lc(xl,{get show(){return i(ri)},set show(k){x(ri,V(k))},get selectedColor(){return i(Du)},get position(){return i(jo)},$$events:{colorChange:k=>{i(Rr).length>i(Na)&&(i(Rr)[i(Na)].color=k.detail.rgba||k.detail.color,console.log("🎨 Updated PVT color to:",k.detail.color),km(i(Na)))}}});var _d=v(xl,2),yh=At(()=>{var k;return((k=i(_c)[i(nr)])==null?void 0:k.color)||"#2563eb"});lc(_d,{get show(){return i(ar)},set show(k){x(ar,V(k))},get selectedColor(){return i(yh)},get position(){return i(Aa)},$$events:{colorChange:k=>{i(_c).length>i(nr)&&(i(_c)[i(nr)].color=k.detail.rgba||k.detail.color)}}});var jh=v(_d,2),gp=At(()=>{var k;return((k=i(so)[i(zu)])==null?void 0:k.color)||"#2563eb"});lc(jh,{get show(){return i(cc)},set show(k){x(cc,V(k))},get selectedColor(){return i(gp)},get position(){return i(ou)},$$events:{colorChange:k=>{i(so).length>i(zu)&&(i(so)[i(zu)].color=k.detail.rgba||k.detail.color,Gl())}}});var Sm=v(jh,2),Pp=At(()=>{var k,A;return((A=(k=i(Td)[i(vu)])==null?void 0:k.styles[i(Ll)])==null?void 0:A.color)||"#2563eb"});lc(Sm,{get show(){return i(ja)},set show(k){x(ja,V(k))},get selectedColor(){return i(Pp)},get position(){return i(nc)},$$events:{colorChange:k=>{const A=i(Td)[i(vu)];A&&A.styles&&A.styles.length>i(Ll)&&(A.styles[i(Ll)].color=k.detail.rgba||k.detail.color,Vm(i(vu)))}}});var Dp=v(Sm,2),_p=At(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});lc(Dp,{get show(){return i(Bc)},set show(k){x(Bc,V(k))},get selectedColor(){return i(_p)},get position(){return i(Vu)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Wg=v(Dp,2),_f=At(()=>{var k,A,B,R,U,q,ve,Re,rt;return i(ll)%3===0?((B=(A=(k=i(oc)[Math.floor(i(ll)/3)])==null?void 0:k.styles)==null?void 0:A.increasing)==null?void 0:B.color)||"#00C851":i(ll)%3===1?((q=(U=(R=i(oc)[Math.floor(i(ll)/3)])==null?void 0:R.styles)==null?void 0:U.decreasing)==null?void 0:q.color)||"#FF4444":((rt=(Re=(ve=i(oc)[Math.floor(i(ll)/3)])==null?void 0:ve.styles)==null?void 0:Re.reverse)==null?void 0:rt.color)||"#c4c4c4"});lc(Wg,{get show(){return i(rf)},set show(k){x(rf,V(k))},get selectedColor(){return i(_f)},get position(){return i(co)},$$events:{colorChange:k=>{const A=Math.floor(i(ll)/3);i(oc)[A]&&(i(ll)%3===0?i(oc)[A].styles.increasing.color=k.detail.rgba||k.detail.color:i(ll)%3===1?i(oc)[A].styles.decreasing.color=k.detail.rgba||k.detail.color:i(oc)[A].styles.reverse.color=k.detail.rgba||k.detail.color,im())}}});var Ql=v(Wg,2),Ir=At(()=>{var k,A,B;return((B=(A=(k=i(El)[i(ae)])==null?void 0:k.styles)==null?void 0:A[i(Ie)])==null?void 0:B.color)||"#2563eb"});lc(Ql,{get show(){return i(he)},set show(k){x(he,V(k))},get selectedColor(){return i(Ir)},get position(){return i(ge)},$$events:{colorChange:k=>{i(El).length>i(ae)&&i(El)[i(ae)].styles[i(Ie)]&&(i(El)[i(ae)].styles[i(Ie)].color=k.detail.rgba||k.detail.color,Ic())}}});var kd=v(Ql,2),Rp=At(()=>{var k,A,B;return((B=(A=(k=i(oc)[0])==null?void 0:k.styles)==null?void 0:A.increasing)==null?void 0:B.color)||"#16a34a"});lc(kd,{get show(){return i($f)},set show(k){x($f,V(k))},get selectedColor(){return i(Rp)},get position(){return i(Cf)},$$events:{colorChange:k=>{i(oc).length>0&&(i(oc)[0].styles.increasing.color=k.detail.rgba||k.detail.color)}}});var Jp=v(kd,2),dv=At(()=>{var k,A,B;return((B=(A=(k=i(oc)[0])==null?void 0:k.styles)==null?void 0:A.decreasing)==null?void 0:B.color)||"#dc2626"});lc(Jp,{get show(){return i(tp)},set show(k){x(tp,V(k))},get selectedColor(){return i(dv)},get position(){return i(mf)},$$events:{colorChange:k=>{i(oc).length>0&&(i(oc)[0].styles.decreasing.color=k.detail.rgba||k.detail.color)}}});var yp=v(Jp,2),Hv=At(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});lc(yp,{get show(){return i(sc)},set show(k){x(sc,V(k))},get selectedColor(){return i(Hv)},get position(){return yd},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Pg=v(yp,2),Mg=At(()=>{var k;return((k=h[1])==null?void 0:k.color)||"#dc2626"});lc(Pg,{get show(){return i(If)},set show(k){x(If,V(k))},get selectedColor(){return i(Mg)},get position(){return En},$$events:{colorChange:k=>{h.length>1&&(h[1].color=k.detail.rgba||k.detail.color)}}});var Ng=v(Pg,2),fg=At(()=>{var k;return((k=h[2])==null?void 0:k.color)||"#16a34a"});lc(Ng,{get show(){return i(ms)},set show(k){x(ms,V(k))},get selectedColor(){return i(fg)},get position(){return i(js)},$$events:{colorChange:k=>{h.length>2&&(h[2].color=k.detail.rgba||k.detail.color)}}});var bh=v(Ng,2);lc(bh,{get show(){return i(Nn)},set show(k){x(Nn,V(k))},get selectedColor(){return i(w)},get position(){return i(Io)},$$events:{colorChange:k=>{x(w,V(k.detail.rgba||k.detail.color))}}});var Sv=v(bh,2);lc(Sv,{get show(){return i(fo)},set show(k){x(fo,V(k))},get selectedColor(){return i(M)},get position(){return i(Ji)},$$events:{colorChange:k=>{x(M,V(k.detail.rgba||k.detail.color))}}});var Ag=v(Sv,2);lc(Ag,{get show(){return i(Gi)},set show(k){x(Gi,V(k))},get selectedColor(){return i(P)},get position(){return i(Al)},$$events:{colorChange:k=>{x(P,V(k.detail.rgba||k.detail.color))}}});var Cv=v(Ag,2);lc(Cv,{get show(){return i(Ii)},set show(k){x(Ii,V(k))},get selectedColor(){return i(T)},get position(){return i(Wo)},$$events:{colorChange:k=>{x(T,V(k.detail.rgba||k.detail.color))}}});var Gm=v(Cv,2),Hi=At(()=>{var k;return((k=h[i(Va)])==null?void 0:k.color)||"#2563eb"});lc(Gm,{get show(){return i(sl)},set show(k){x(sl,V(k))},get selectedColor(){return i(Hi)},get position(){return i(Oc)},$$events:{colorChange:k=>{h.length>i(Va)&&(h[i(Va)].color=k.detail.rgba||k.detail.color,un())}}});var Pr=v(Gm,2),iu=At(()=>{var k;return((k=i(Wi)[i(ud)])==null?void 0:k.color)||"#FF6C37"});lc(Pr,{get show(){return i(Wa)},set show(k){x(Wa,V(k))},get selectedColor(){return i(iu)},get position(){return i(uu)},$$events:{colorChange:k=>{i(Wi).length>i(ud)&&(i(Wi)[i(ud)].color=k.detail.rgba||k.detail.color,Ws(i(ud)))}}});var hd=v(Pr,2),yf=At(()=>{var k;return((k=h[i(ga)])==null?void 0:k.color)||"#2563eb"});lc(hd,{get show(){return i(Sc)},set show(k){x(Sc,V(k))},get selectedColor(){return i(yf)},get position(){return i(Ja)},$$events:{colorChange:k=>{h.length>i(ga)&&(h[i(ga)].color=k.detail.rgba||k.detail.color,Ln())}}});var Zd=v(hd,2),Et=At(()=>{var k;return((k=i(Rd)[i(eu)])==null?void 0:k.color)||"#2563eb"});lc(Zd,{get show(){return i(Wu)},set show(k){x(Wu,V(k))},get selectedColor(){return i(Et)},get position(){return i(zc)},$$events:{colorChange:k=>{i(Rd).length>i(eu)&&(i(Rd)[i(eu)].color=k.detail.rgba||k.detail.color,Ct(i(eu)))}}});var hs=v(Zd,2),Lo=At(()=>(()=>{const k=Math.floor(i(et)/3),A=i(et)%3,B=i(os)[k];if(!B)return"#2563eb";switch(A){case 0:return B.styles.k.color;case 1:return B.styles.d.color;case 2:return B.styles.j.color;default:return"#2563eb"}})());lc(hs,{get show(){return i(He)},set show(k){x(He,V(k))},get selectedColor(){return i(Lo)},get position(){return i(Ue)},$$events:{colorChange:k=>{const A=Math.floor(i(et)/3),B=i(et)%3,R=i(os)[A];if(console.log("🎨 KDJ Color change:",{groupIndex:A,lineIndex:B,newColor:k.detail.color,group:R}),R){switch(B){case 0:R.styles.k.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated K color to:",k.detail.color);break;case 1:R.styles.d.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated D color to:",k.detail.color);break;case 2:R.styles.j.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated J color to:",k.detail.color);break}console.log("🎨 Updated KDJ group:",R),fp(A)}}}});var So=v(hs,2),qa=At(()=>(()=>{const k=i(Cr)[i(kr)];if(!k)return"#2563eb";switch(i(Wr)){case"cr":return k.styles.cr.color;case"ma1":return k.styles.ma1.color;case"ma2":return k.styles.ma2.color;case"ma3":return k.styles.ma3.color;case"ma4":return k.styles.ma4.color;default:return"#2563eb"}})());lc(So,{get show(){return i(va)},set show(k){x(va,V(k))},get selectedColor(){return i(qa)},get position(){return i(Vl)},$$events:{colorChange:k=>{const A=i(Cr)[i(kr)];if(A){switch(i(Wr)){case"cr":A.styles.cr.color=k.detail.rgba||k.detail.color;break;case"ma1":A.styles.ma1.color=k.detail.rgba||k.detail.color;break;case"ma2":A.styles.ma2.color=k.detail.rgba||k.detail.color;break;case"ma3":A.styles.ma3.color=k.detail.rgba||k.detail.color;break;case"ma4":A.styles.ma4.color=k.detail.rgba||k.detail.color;break}nu()}}}});var Zc=v(So,2),Eo=At(()=>{var k,A,B;return((B=(A=(k=i(Li)[i(Uf)])==null?void 0:k.styles)==null?void 0:A.rsi)==null?void 0:B.color)||"#8B5CF6"});lc(Zc,{get show(){return i(Ud)},set show(k){x(Ud,V(k))},get selectedColor(){return i(Eo)},get position(){return i(qf)},$$events:{colorChange:k=>{i(Li).length>i(Uf)&&(i(Li)[i(Uf)].styles.rsi.color=k.detail.rgba||k.detail.color,Op(i(Uf)))}}});var Fa=v(Zc,2),il=At(()=>{var k,A;return((A=(k=i(Li)[i(ql)])==null?void 0:k.styles)==null?void 0:A.overboughtColor)||"#EF4444"});lc(Fa,{get show(){return i(jl)},set show(k){x(jl,V(k))},get selectedColor(){return i(il)},get position(){return i(Xl)},$$events:{colorChange:k=>{if(i(Li).length>i(ql)){const A=k.detail.rgba||k.detail.color;i(Li)[i(ql)].styles.overboughtColor=A,x(Li,V([...i(Li)])),Op(i(ql))}}}});var Hl=v(Fa,2),Bf=At(()=>{var k,A;return((A=(k=i(Li)[i(ql)])==null?void 0:k.styles)==null?void 0:A.oversoldColor)||"#22C55E"});lc(Hl,{get show(){return i(Mu)},set show(k){x(Mu,V(k))},get selectedColor(){return i(Bf)},get position(){return i(Zu)},$$events:{colorChange:k=>{if(i(Li).length>i(ql)){const A=k.detail.rgba||k.detail.color;i(Li)[i(ql)].styles.oversoldColor=A,x(Li,V([...i(Li)])),Op(i(ql))}}}});var ai=v(Hl,2),Bs=At(()=>{var k,A;return((A=(k=i(Li)[i(ql)])==null?void 0:k.styles)==null?void 0:A.middleLineColor)||"#6B7280"});lc(ai,{get show(){return i(xo)},set show(k){x(xo,V(k))},get selectedColor(){return i(Bs)},get position(){return i(Sr)},$$events:{colorChange:k=>{if(i(Li).length>i(ql)){const A=k.detail.rgba||k.detail.color;i(Li)[i(ql)].styles.middleLineColor=A,x(Li,V([...i(Li)])),Op(i(ql))}}}});var Fn=v(ai,2),ks=At(()=>{var k,A,B;return((B=(A=(k=i(bu)[i(ol)])==null?void 0:k.styles)==null?void 0:A.duty)==null?void 0:B.color)||"#2962FF"});lc(Fn,{get show(){return i(dd)},set show(k){x(dd,V(k))},get selectedColor(){return i(ks)},get position(){return i(af)},$$events:{colorChange:k=>{i(bu).length>i(ol)&&(i(bu)[i(ol)].styles.duty.color=k.detail.rgba||k.detail.color,vf(i(ol)))}}});var vs=v(Fn,2),li=At(()=>{var k,A,B;return((B=(A=(k=i(bu)[i(ol)])==null?void 0:k.styles)==null?void 0:A.dLine)==null?void 0:B.color)||"#FF6D00"});lc(vs,{get show(){return i(Id)},set show(k){x(Id,V(k))},get selectedColor(){return i(li)},get position(){return i(af)},$$events:{colorChange:k=>{i(bu).length>i(ol)&&(i(bu)[i(ol)].styles.dLine.color=k.detail.rgba||k.detail.color,vf(i(ol)))}}});var ra=v(vs,2),jr=At(()=>{var k,A;return((A=(k=i(bu)[i(ol)])==null?void 0:k.styles)==null?void 0:A.overboughtColor)||"#EF4444"});lc(ra,{get show(){return i(dc)},set show(k){x(dc,V(k))},get selectedColor(){return i(jr)},get position(){return i(af)},$$events:{colorChange:k=>{i(bu).length>i(ol)&&(i(bu)[i(ol)].styles.overboughtColor=k.detail.rgba||k.detail.color,vf(i(ol)))}}});var Mr=v(ra,2),mr=At(()=>{var k,A;return((A=(k=i(bu)[i(ol)])==null?void 0:k.styles)==null?void 0:A.oversoldColor)||"#10B981"});lc(Mr,{get show(){return i(Gf)},set show(k){x(Gf,V(k))},get selectedColor(){return i(mr)},get position(){return i(af)},$$events:{colorChange:k=>{i(bu).length>i(ol)&&(i(bu)[i(ol)].styles.oversoldColor=k.detail.rgba||k.detail.color,vf(i(ol)))}}});var Mo=v(Mr,2),La=At(()=>{var k,A;return((A=(k=i(bu)[i(ol)])==null?void 0:k.styles)==null?void 0:A.midLineColor)||"#6B7280"});return lc(Mo,{get show(){return i(Pd)},set show(k){x(Pd,V(k))},get selectedColor(){return i(La)},get position(){return i(af)},$$events:{colorChange:k=>{i(bu).length>i(ol)&&(i(bu)[i(ol)].styles.midLineColor=k.detail.rgba||k.detail.color,vf(i(ol)))}}}),Y(n,ie),Ed({clearCciGroups:er,clearEmvGroups:fr,clearMtmGroups:yu,clearObvGroups:Kc,clearPsyGroups:fd,clearPvtGroups:ic,clearVolGroups:Lc,clearWrGroups:Ad,clearRocGroups:Df,clearRsiGroups:nm,clearStochasticGroups:ov})}Tp(["click","change","input"]);function AG(n,e,t){const s=n.target;x(e,parseInt(s.value)),t()}function TG(n,e){n.target===n.currentTarget&&e(!1)}var FG=n=>n.stopPropagation(),LG=(n,e)=>e(!1),EG=(n,e)=>e("linear"),$G=(n,e)=>e("radial"),DG=(n,e,t)=>e(i(t).angle),RG=Me('<button class="w-8 h-8 text-sm rounded border transition-colors flex items-center justify-center"> </button>'),jG=Me('<div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Direction</label> <div class="grid grid-cols-4 gap-1 mb-3"></div> <div class="relative"><input type="range" min="0" max="360" class="w-full h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <div class="flex justify-between text-xs text-gray-500 mt-1"><span>0°</span> <span class="text-gray-300"> </span> <span>360°</span></div></div></div>'),BG=Me('<button class="absolute -top-2 -right-1 w-3 h-3 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">×</button>'),OG=Me('<div class="absolute top-0 w-4 h-6 border-2 rounded cursor-grab transform -translate-x-1/2"><!></div>'),zG=Me('<button class="mt-2 w-full py-1 text-xs text-gray-400 border border-dashed border-gray-600 rounded hover:border-gray-400 hover:text-gray-300 transition-colors">+ Add Color Stop</button>'),VG=(n,e,t)=>e(i(t),parseInt(n.currentTarget.value)),WG=(n,e,t)=>e(n,i(t)),HG=(n,e,t)=>e(i(t),n.currentTarget.value),qG=(n,e,t)=>e(i(t),parseInt(n.currentTarget.value)),UG=Me('<div class="mb-4 p-3 bg-[#1A1A1A] rounded border border-[#404040]"><h4 class="text-xs font-medium text-gray-300 mb-3"> </h4> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Position</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Color</label> <div class="flex items-center gap-2"><button class="w-8 h-8 rounded border-2 border-[#404040] cursor-pointer hover:border-gray-300 transition-colors"></button> <input type="text" class="flex-1 px-2 py-1 bg-[#404040] border border-[#555] rounded text-white text-xs focus:border-blue-500 focus:outline-none" placeholder="#000000"></div></div> <div><label class="block text-xs text-gray-400 mb-1">Opacity</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div></div>'),GG=Me('<div class="fixed inset-0 z-[360000] flex items-center justify-center p-4"><div class="gradient-editor-container bg-[#2A2A2A] border border-[#404040] rounded-lg shadow-xl w-full max-w-sm max-h-[90vh] overflow-y-auto svelte-e3zmk9"><div class="p-4"><div class="mb-4"><div class="flex items-center justify-between mb-3"><h3 class="text-sm font-semibold text-white">Gradient Editor</h3> <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors">OK</button></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Gradient Type</label> <div class="flex gap-2"><button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Linear</button> <button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Radial</button></div></div> <!> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Preview</label> <div class="w-full h-12 rounded border border-[#404040]"></div></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Color Stops</label> <div class="relative"><div class="relative w-full h-6 rounded border border-[#404040] cursor-pointer"></div> <!></div></div> <!></div></div></div></div>'),YG=Me("<!> <!>",1);function h5(n,e){Ld(e,!1);const t=Hh();let s=pi(e,"show",12,!1),o=pi(e,"initialGradient",24,()=>({type:"linear",direction:0,stops:[{position:0,color:"#ffffff",opacity:100},{position:100,color:"#000000",opacity:100}]})),r=vd(),a=vd(),l=!1,c=-1,f=vd(!1),u=vd(0),d=vd(o().type),h=vd(o().direction),m=vd([...o().stops]);const g=[{angle:0,label:"→",title:"Left to Right"},{angle:45,label:"↗",title:"Bottom-Left to Top-Right"},{angle:90,label:"↑",title:"Bottom to Top"},{angle:135,label:"↖",title:"Bottom-Right to Top-Left"},{angle:180,label:"←",title:"Right to Left"},{angle:225,label:"↙",title:"Top-Right to Bottom-Left"},{angle:270,label:"↓",title:"Top to Bottom"},{angle:315,label:"↘",title:"Top-Left to Bottom-Right"}];function w(){const ce=[...i(m)].sort((je,Ve)=>je.position-Ve.position).map(je=>`${C(je.color,je.opacity/100)} ${je.position}%`);return i(d)==="linear"?`linear-gradient(${i(h)}deg, ${ce.join(", ")})`:`radial-gradient(circle, ${ce.join(", ")})`}function C(Ie,ce){const je=parseInt(Ie.slice(1,3),16),Ve=parseInt(Ie.slice(3,5),16),We=parseInt(Ie.slice(5,7),16);return`rgba(${je}, ${Ve}, ${We}, ${ce})`}function M(Ie){x(d,Ie),de()}function P(Ie){x(h,Ie),de()}function T(){if(i(m).length>=5)return;const Ie=[...i(m)].sort((He,Ue)=>He.position-Ue.position);let ce=50,je=0,Ve=50;for(let He=0;He<Ie.length-1;(He+=1)-1){const Ue=Ie[He+1].position-Ie[He].position;Ue>je&&(je=Ue,Ve=Ie[He].position+Ue/2)}je>10&&(ce=Ve);const We={position:ce,color:"#808080",opacity:100};x(m,[...i(m),We]),x(u,i(m).length-1),de()}function N(Ie){i(m).length<=2||(x(m,i(m).filter((ce,je)=>je!==Ie)),i(u)>=i(m).length&&x(u,i(m).length-1),de())}function L(Ie,ce){f0(m,i(m)[Ie].position=Math.max(0,Math.min(100,ce))),de()}function O(Ie,ce){f0(m,i(m)[Ie].color=ce),de()}function D(Ie,ce){f0(m,i(m)[Ie].opacity=Math.max(0,Math.min(100,ce))),de()}function $(Ie,ce){const je=Ie.target.getBoundingClientRect();je.right+10,je.top,x(u,ce),x(f,!0)}function z(Ie){i(u)>=0&&i(u)<i(m).length&&(f0(m,i(m)[i(u)].color=Ie.detail),de())}function te(Ie){i(u)>=0&&i(u)<i(m).length&&(f0(m,i(m)[i(u)].opacity=Ie.detail),de())}function pe(Ie){if(!i(a))return;const ce=i(a).getBoundingClientRect(),je=Ie.clientX-ce.left,Ve=je/ce.width*100;let We=-1;const He=8;if(i(m).forEach((Ue,et)=>{const ft=Ue.position/100*ce.width;Math.abs(je-ft)<=He&&(We=et)}),We>=0)l=!0,c=We,x(u,We);else if(i(m).length<5){const Ue={position:Math.max(0,Math.min(100,Ve)),color:"#808080",opacity:100};x(m,[...i(m),Ue]),x(u,i(m).length-1),de()}}function J(Ie){if(!l||c<0||!i(a))return;const ce=i(a).getBoundingClientRect(),je=Ie.clientX-ce.left,Ve=Math.max(0,Math.min(100,je/ce.width*100));f0(m,i(m)[c].position=Ve),de()}function le(){l=!1,c=-1}function de(){const Ie={type:i(d),direction:i(h),stops:[...i(m)],css:w()};t("gradientChange",Ie)}b0(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",le))}),Mh(()=>{de()}),vm(()=>th(s()),()=>{s()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("mousemove",J),document.addEventListener("mouseup",le)},0)}),vm(()=>th(s()),()=>{!s()&&typeof document<"u"&&(document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",le))}),j0(),_v();var he=YG(),ge=tn(he);Ye(ge,s,Ie=>{var ce=GG();ce.__click=[TG,s];var je=y(ce);je.__click=[FG];var Ve=y(je),We=y(Ve),He=y(We),Ue=v(y(He),2);Ue.__click=[LG,s],_(He);var et=v(He,2),ft=v(y(et),2),it=y(ft);it.__click=[EG,M];var Lt=v(it,2);Lt.__click=[$G,M],_(ft),_(et);var Tt=v(et,2);Ye(Tt,()=>i(d)==="linear",Mt=>{var mt=jG(),Ce=v(y(mt),2);Ro(Ce,5,()=>g,fi,(Vn,Dn)=>{var Wn=RG();Wn.__click=[DG,P,Dn];var pn=y(Wn,!0);_(Wn),Ne(()=>{Dt(Wn,"title",i(Dn).title),rr(Wn,"border-blue-500",i(h)===i(Dn).angle),rr(Wn,"bg-blue-600",i(h)===i(Dn).angle),rr(Wn,"text-white",i(h)===i(Dn).angle),rr(Wn,"border-[#404040]",i(h)!==i(Dn).angle),rr(Wn,"text-gray-300",i(h)!==i(Dn).angle),tt(pn,i(Dn).label)}),Y(Vn,Wn)}),_(Ce);var Te=v(Ce,2),It=y(Te);mn(It),It.__input=[AG,h,de];var $t=v(It,2),Yt=v(y($t),2),qn=y(Yt);_(Yt),Di(2),_($t),_(Te),_(mt),Ne(()=>tt(qn,`${i(h)??""}°`)),As(It,()=>i(h),Vn=>x(h,Vn)),Y(Mt,mt)});var Pt=v(Tt,2),St=v(y(Pt),2);const st=sv(()=>`background: ${w()??""};`);_(Pt);var xt=v(Pt,2),Je=v(y(xt),2),Xe=y(Je);const Be=sv(()=>`background: ${w()??""};`);Xe.__mousedown=pe,Ro(Xe,5,()=>i(m),fi,(Mt,mt,Ce)=>{var Te=OG();Te.__click=$t=>{$t.stopPropagation(),x(u,Ce)};var It=y(Te);Ye(It,()=>i(m).length>2,$t=>{var Yt=BG();Yt.__click=qn=>{qn.stopPropagation(),N(Ce)},Y($t,Yt)}),_(Te),Ne(()=>{Dt(Te,"style",`left: ${i(mt).position??""}%; background-color: ${i(mt).color??""};`),rr(Te,"border-white",Ce===i(u)),rr(Te,"border-gray-500",Ce!==i(u))}),Y(Mt,Te)}),_(Xe),ep(Xe,Mt=>x(a,Mt),()=>i(a));var Qe=v(Xe,2);Ye(Qe,()=>i(m).length<5,Mt=>{var mt=zG();mt.__click=T,Y(Mt,mt)}),_(Je),_(xt);var ct=v(xt,2);Ye(ct,()=>i(u)>=0&&i(u)<i(m).length,Mt=>{var mt=UG(),Ce=y(mt),Te=y(Ce);_(Ce);var It=v(Ce,2),$t=v(y(It),2),Yt=y($t);mn(Yt),Yt.__input=[VG,L,u];var qn=v(Yt,2),Vn=y(qn);_(qn),_($t),_(It);var Dn=v(It,2),Wn=v(y(Dn),2),pn=y(Wn);pn.__click=[WG,$,u];var gn=v(pn,2);mn(gn),gn.__input=[HG,O,u],_(Wn),_(Dn);var Qs=v(Dn,2),Is=v(y(Qs),2),Cs=y(Is);mn(Cs),Cs.__input=[qG,D,u];var ro=v(Cs,2),bs=y(ro);_(ro),_(Is),_(Qs),_(mt),Ne(()=>{tt(Te,`Stop ${i(u)+1} Configuration`),tt(Vn,`${i(m)[i(u)].position??""}%`),Dt(pn,"style",`background-color: ${i(m)[i(u)].color??""};`),tt(bs,`${i(m)[i(u)].opacity??""}%`)}),As(Yt,()=>i(m)[i(u)].position,zt=>f0(m,i(m)[i(u)].position=zt)),As(gn,()=>i(m)[i(u)].color,zt=>f0(m,i(m)[i(u)].color=zt)),As(Cs,()=>i(m)[i(u)].opacity,zt=>f0(m,i(m)[i(u)].opacity=zt)),Y(Mt,mt)}),_(We),_(Ve),_(je),ep(je,Mt=>x(r,Mt),()=>i(r)),_(ce),Ne(()=>{rr(it,"bg-blue-600",i(d)==="linear"),rr(it,"text-white",i(d)==="linear"),rr(it,"bg-[#404040]",i(d)!=="linear"),rr(it,"text-gray-300",i(d)!=="linear"),rr(Lt,"bg-blue-600",i(d)==="radial"),rr(Lt,"text-white",i(d)==="radial"),rr(Lt,"bg-[#404040]",i(d)!=="radial"),rr(Lt,"text-gray-300",i(d)!=="radial"),Dt(St,"style",i(st)),Dt(Xe,"style",i(Be))}),Y(Ie,ce)});var ae=v(ge,2);Ye(ae,()=>i(f),Ie=>{var ce=sv(()=>{var Ve;return((Ve=i(m)[i(u)])==null?void 0:Ve.color)||"#000000"}),je=sv(()=>{var Ve;return((Ve=i(m)[i(u)])==null?void 0:Ve.opacity)||100});Yv(Ie,{get show(){return i(f)},set show(Ve){x(f,Ve)},get selectedColor(){return i(ce)},get opacity(){return i(je)},$$events:{colorChange:z,opacityChange:te},$$legacy:!0})}),Y(n,he),Ed()}Tp(["click","input","mousedown"]);var h0,v0,T0,J_,Jb;const m6=class m6 extends Map{constructor(t){super();I1(this,J_);I1(this,h0,new Map);I1(this,v0,T_(0));I1(this,T0,T_(0));if(t){for(var[s,o]of t)super.set(s,o);Tm(this,T0).v=super.size}}has(t){var s=Tm(this,h0),o=s.get(t);if(o===void 0){var r=super.get(t);if(r!==void 0)o=T_(0),s.set(t,o);else return i(Tm(this,v0)),!1}return i(o),!0}forEach(t,s){nb(this,J_,Jb).call(this),super.forEach(t,s)}get(t){var s=Tm(this,h0),o=s.get(t);if(o===void 0){var r=super.get(t);if(r!==void 0)o=T_(0),s.set(t,o);else{i(Tm(this,v0));return}}return i(o),super.get(t)}set(t,s){var d;var o=Tm(this,h0),r=o.get(t),a=super.get(t),l=super.set(t,s),c=Tm(this,v0);if(r===void 0)o.set(t,T_(0)),x(Tm(this,T0),super.size),P1(c);else if(a!==s){P1(r);var f=c.reactions===null?null:new Set(c.reactions),u=f===null||!((d=r.reactions)!=null&&d.every(h=>f.has(h)));u&&P1(c)}return l}delete(t){var s=Tm(this,h0),o=s.get(t),r=super.delete(t);return o!==void 0&&(s.delete(t),x(Tm(this,T0),super.size),x(o,-1),P1(Tm(this,v0))),r}clear(){if(super.size!==0){super.clear();var t=Tm(this,h0);x(Tm(this,T0),0);for(var s of t.values())x(s,-1);P1(Tm(this,v0)),t.clear()}}keys(){return i(Tm(this,v0)),super.keys()}values(){return nb(this,J_,Jb).call(this),super.values()}entries(){return nb(this,J_,Jb).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return i(Tm(this,T0)),super.size}};h0=new WeakMap,v0=new WeakMap,T0=new WeakMap,J_=new WeakSet,Jb=function(){i(Tm(this,v0));var t=Tm(this,h0);if(Tm(this,T0).v!==t.size)for(var s of k6(m6.prototype,this,"keys").call(this))t.has(s)||t.set(s,T_(0));for(var[,o]of Tm(this,h0))i(o)};let gy=m6;function Sw(n="dark"){return{version:2,canvas:{background:{mode:"solid",solid:{color:n==="dark"?"#070211":"#ffffff",alpha:1}},grid:{mode:"solid",solid:{color:n==="dark"?"#081115":"#F3F3F3",alpha:1}}}}}function Fb(n){return JSON.parse(JSON.stringify(n))}function KG(n,e="dark"){const s={current:Sw(e),pending:null,chartId:n};return Fm(s)}function XG(n,e){if(typeof window>"u"||!window.localStorage)return;const t=`dutyai.chart.theme.${n}`;try{localStorage.setItem(t,JSON.stringify(e)),console.debug("THEME_PERSIST",{chartId:n,settings:e})}catch(s){console.error("Failed to persist theme settings:",s)}}function v5(n,e="dark"){if(typeof window>"u"||!window.localStorage)return Sw(e);const t=`dutyai.chart.theme.${n}`;try{const s=localStorage.getItem(t);if(s){const o=JSON.parse(s);if(o.version===2&&o.canvas)return console.debug("THEME_LOAD",{chartId:n,settings:o}),o}}catch(s){console.error("Failed to load persisted theme settings:",s)}return Sw(e)}function ZG(n){if(!n||!n.stops||n.stops.length===0)return"transparent";const e=n.stops.map(t=>{const s=t.alpha!==void 0?t.alpha:1,o=t.color;if(s!==1&&o.startsWith("#")){const r=parseInt(o.slice(1,3),16),a=parseInt(o.slice(3,5),16),l=parseInt(o.slice(5,7),16);return`rgba(${r}, ${a}, ${l}, ${s}) ${t.offset*100}%`}return`${o} ${t.offset*100}%`}).join(", ");if(n.type==="linear")return`linear-gradient(${n.angle||0}deg, ${e})`;if(n.type==="radial"){const t=n.cx||.5,s=n.cy||.5;return n.r,`radial-gradient(circle at ${t*100}% ${s*100}%, ${e})`}return"transparent"}function Ax(n,e=1){if(!n.startsWith("#"))return n;const t=parseInt(n.slice(1,3),16),s=parseInt(n.slice(3,5),16),o=parseInt(n.slice(5,7),16);return`rgba(${t}, ${s}, ${o}, ${e})`}class p6{constructor(e,t,s="dark"){$e(this,"settingsStore");$e(this,"chart");$e(this,"chartId");$e(this,"pendingThemeApplication",null);$e(this,"chartUnsubscribe",null);$e(this,"chartReadinessTimeout",null);$e(this,"applyCanvasColorsFn",null);this.chartId=e,this.chart=t,this.settingsStore=KG(e,s),this.setupChartReadinessMonitoring(),this.loadPersistedSettings(s)}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e,console.log("🎨 Canvas colors function registered with theme manager")}applyCanvasColorsIfAvailable(){this.applyCanvasColorsFn&&(console.log("🎨 Applying canvas colors via theme manager"),this.applyCanvasColorsFn())}getStore(){return this.settingsStore}setupChartReadinessMonitoring(){this.chartUnsubscribe=this.chart.subscribe(e=>{e&&this.pendingThemeApplication&&(console.log("📊 Chart became available, applying pending theme"),this.applyTheme(this.pendingThemeApplication,{preview:!1}),this.pendingThemeApplication=null,this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null))})}setupChartReadinessTimeout(){this.chartReadinessTimeout&&clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=setTimeout(()=>{this.pendingThemeApplication&&(console.warn("📊 Chart readiness timeout - clearing pending theme application"),this.pendingThemeApplication=null),this.chartReadinessTimeout=null},1e4)}destroy(){this.chartUnsubscribe&&(this.chartUnsubscribe(),this.chartUnsubscribe=null),this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null)}loadPersistedSettings(e){let t=v5(this.chartId,e);const s=this.loadFromLegacySystem();s&&(t=this.mergeThemeSettings(t,s)),this.settingsStore.update(r=>({...r,current:t})),mm(this.chart)?this.applyTheme(t,{preview:!1}):(console.log("📊 Chart not ready, deferring theme application"),this.pendingThemeApplication=t,this.setupChartReadinessTimeout())}loadFromLegacySystem(){var e,t,s,o,r,a;try{const l=localStorage.getItem("chart");if(!l)return null;const c=JSON.parse(l);if(!c.styles)return null;console.log("📦 Loading from localStorage - chart type:",(t=(e=c.styles)==null?void 0:e.candle)==null?void 0:t.type);const f={canvas:{background:{},grid:{}}},u=c.styles.backgroundType||"solid";u==="solid"&&c.styles.backgroundColor?f.canvas.background={mode:"solid",solid:{color:c.styles.backgroundColor,alpha:(c.styles.backgroundOpacity??100)/100}}:u==="gradient"&&c.styles.backgroundGradient&&(f.canvas.background={mode:"gradient",gradient:c.styles.backgroundGradient});const d=c.styles.gridType||"solid";if(d==="solid"){const h=((o=(s=c.styles.grid)==null?void 0:s.horizontal)==null?void 0:o.color)||((a=(r=c.styles.grid)==null?void 0:r.vertical)==null?void 0:a.color);if(h){const m=this.extractHexFromColor(h),g=c.styles.gridOpacity??100;f.canvas.grid={mode:"solid",solid:{color:m,alpha:g/100}}}}else d==="gradient"&&c.styles.gridGradient&&(f.canvas.grid={mode:"gradient",gradient:c.styles.gridGradient});return console.debug("LEGACY_LOAD",{loadedSettings:f}),f}catch(l){return console.error("Failed to load from legacy system:",l),null}}extractHexFromColor(e){if(e.startsWith("#"))return e;if(e.startsWith("rgba")||e.startsWith("rgb")){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){const s=parseInt(t[1]).toString(16).padStart(2,"0"),o=parseInt(t[2]).toString(16).padStart(2,"0"),r=parseInt(t[3]).toString(16).padStart(2,"0");return`#${s}${o}${r}`}}return e}mergeThemeSettings(e,t){var o,r;const s=Fb(e);return(o=t.canvas)!=null&&o.background&&(s.canvas.background=t.canvas.background),(r=t.canvas)!=null&&r.grid&&(s.canvas.grid=t.canvas.grid),s}openModal(){this.settingsStore.update(e=>(e.pending===null&&(e.pending=Fb(e.current),console.debug("THEME_MODAL_OPEN",{pending:e.pending})),e))}updatePending(e,t=!1){this.settingsStore.update(s=>(s.pending&&(e(s.pending),t&&this.applyTheme(s.pending,{preview:!0}),console.debug("THEME_PENDING_UPDATE",{pending:s.pending,applyPreview:t})),s))}confirm(){this.settingsStore.update(e=>(e.pending&&(e.current=Fb(e.pending),XG(this.chartId,e.current),this.applyTheme(e.current,{preview:!1}),this.syncToLegacySystem(e.current),console.debug("THEME_COMMIT",{current:e.current}),e.pending=null),e))}syncToLegacySystem(e){var t,s;try{const o=localStorage.getItem("chart");if(o){const r=JSON.parse(o),a=(s=(t=r.styles)==null?void 0:t.candle)==null?void 0:s.type;if(console.log("🔒 Preserving chart type in syncToLegacySystem:",a),r.styles||(r.styles={}),e.canvas.background.mode==="solid"&&e.canvas.background.solid?(r.styles.backgroundColor=e.canvas.background.solid.color,r.styles.backgroundOpacity=(e.canvas.background.solid.alpha??1)*100,r.styles.backgroundType="solid",delete r.styles.backgroundGradient):e.canvas.background.mode==="gradient"&&e.canvas.background.gradient&&(r.styles.backgroundGradient=e.canvas.background.gradient,r.styles.backgroundType="gradient",delete r.styles.backgroundColor,delete r.styles.backgroundOpacity),e.canvas.grid.mode==="solid"&&e.canvas.grid.solid){r.styles.grid||(r.styles.grid={}),r.styles.grid.horizontal||(r.styles.grid.horizontal={}),r.styles.grid.vertical||(r.styles.grid.vertical={});const l=e.canvas.grid.solid.alpha!==void 0&&e.canvas.grid.solid.alpha!==1?Ax(e.canvas.grid.solid.color,e.canvas.grid.solid.alpha):e.canvas.grid.solid.color;r.styles.grid.horizontal.color=l,r.styles.grid.vertical.color=l,r.styles.gridOpacity=(e.canvas.grid.solid.alpha??1)*100,r.styles.gridType="solid",delete r.styles.gridGradient}else e.canvas.grid.mode==="gradient"&&e.canvas.grid.gradient&&(r.styles.gridGradient=e.canvas.grid.gradient,r.styles.gridType="gradient");a&&(r.styles.candle||(r.styles.candle={}),r.styles.candle.type=a,console.log("✅ Restored chart type in syncToLegacySystem:",a)),localStorage.setItem("chart",JSON.stringify(r)),console.debug("LEGACY_SYNC",{syncedStyles:r.styles,preservedChartType:a})}}catch(o){console.error("Failed to sync to legacy system:",o)}}cancel(){this.settingsStore.update(e=>(e.pending&&(this.applyTheme(e.current,{preview:!1}),console.debug("THEME_CANCEL",{reverted_to:e.current}),e.pending=null),e))}reset(){this.settingsStore.update(e=>(e.pending&&(e.pending=Fb(e.current),this.applyTheme(e.pending,{preview:!0}),console.debug("THEME_RESET",{pending:e.pending})),e))}applyTheme(e,t={}){const s=mm(this.chart);if(!s){console.log("📊 Chart not available for theme application, storing for later"),t.preview||(this.pendingThemeApplication=e,this.setupChartReadinessTimeout());return}if(!e||!e.canvas){console.warn("Invalid theme configuration, skipping application");return}const o=t.preview||!1;o?this.addPreviewWatermark():this.removePreviewWatermark();try{e.canvas.background&&this.applyBackground(e.canvas.background),o||(e.canvas.grid&&this.applyGrid(e.canvas.grid,s),setTimeout(()=>{this.applyCanvasColorsIfAvailable()},150)),console.debug("THEME_APPLIED",{theme:e.canvas,preview:o,chartId:this.chartId,appliedGrid:!o})}catch(r){console.error("Failed to apply theme:",r)}}applyBackground(e){const t=document.querySelector(".duty-main"),s=document.querySelector(".duty-widget");if(!t&&!s){console.warn("Chart containers not found for background application");return}if(!e){console.warn("Background configuration is null or undefined, skipping");return}let o;if(e.mode==="solid"&&e.solid&&e.solid.color){const r=e.solid.alpha!==void 0?e.solid.alpha:1;o=r!==1?Ax(e.solid.color,r):e.solid.color}else e.mode==="gradient"&&e.gradient?o=ZG(e.gradient):(console.warn("Invalid background configuration, using fallback"),o="#070211");console.log("🎨 Applying background:",o),[t,s].forEach(r=>{r&&(r.style.removeProperty("background"),r.style.removeProperty("background-color"),r.offsetHeight,r.style.background=o,r.style.backgroundColor=o,r.style.setProperty("--chart-background-color",o),r.offsetHeight)})}applyGrid(e,t){var a,l;const s=t.getStyles()??{},o=wn.cloneDeep(s);try{const c=localStorage.getItem("chart");if(c){const f=JSON.parse(c);(l=(a=f.styles)==null?void 0:a.candle)!=null&&l.type&&(o.candle||(o.candle={}),o.candle.type=f.styles.candle.type,console.log("🔒 Preserved chart type in applyGrid:",f.styles.candle.type))}}catch(c){console.warn("Failed to preserve chart type:",c)}let r;if(e.mode==="solid"&&e.solid){const c=e.solid.alpha!==void 0?e.solid.alpha:1;r=c!==1?Ax(e.solid.color,c):e.solid.color}else if(e.mode==="gradient"&&e.gradient){const c=e.gradient.stops;if(c.length===1)r=c[0].color;else if(c.length>=2)r=this.blendColors(c[0].color,c[c.length-1].color,.5);else{console.warn("Invalid grid gradient configuration");return}}else{console.warn("Invalid grid configuration");return}console.log("🎨 ThemeManager applying grid color:",r),wn.set(o,"grid.horizontal.color",r),wn.set(o,"grid.vertical.color",r),t.setStyles(o),console.log("✅ Applied grid styles directly:",{gridColor:r,gridConfig:o.grid})}blendColors(e,t,s){if(!e.startsWith("#")||!t.startsWith("#"))return e;const o=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),l=parseInt(t.slice(1,3),16),c=parseInt(t.slice(3,5),16),f=parseInt(t.slice(5,7),16),u=Math.round(o*(1-s)+l*s),d=Math.round(r*(1-s)+c*s),h=Math.round(a*(1-s)+f*s);return`#${u.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}`}addPreviewWatermark(){this.removePreviewWatermark();const e=document.querySelector(".duty-main");if(!e)return;const t=document.createElement("div");t.id="theme-preview-watermark",t.style.cssText=`
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
      pointer-events: none;
    `,t.textContent="PREVIEW",e.style.position="relative",e.appendChild(t)}removePreviewWatermark(){const e=document.getElementById("theme-preview-watermark");e&&e.remove()}getCurrentSettings(){return mm(this.settingsStore).current}getPendingSettings(){return mm(this.settingsStore).pending}isModalOpen(){return mm(this.settingsStore).pending!==null}resetToThemeDefaults(e){const t=v5(this.chartId,e);this.settingsStore.update(s=>({...s,current:t,pending:null})),console.log("🔄 Reset TransactionalThemeManager to theme defaults:",e)}}function JG(n,e,t){const s=n.target.checked;x(e,V(s)),t({wick:s})}function QG(n,e,t){const s=n.target.value;x(e,V(s)),t({source:s})}function eY(n,e,t){const s="ATR";x(e,s),t({method:s})}function tY(n,e,t){const s=parseInt(n.target.value||"14",10),o=Math.max(1,isNaN(s)?14:s);x(e,V(o)),t({atrLength:o})}function nY(n,e,t){const s=n.target.value;x(e,V(s)),t({boxSizeMode:s})}function sY(n,e,t){const s=parseFloat(n.target.value||"1"),o=Math.max(1e-4,isNaN(s)?1:s);x(e,V(o)),t({boxSize:o})}function oY(n,e,t){const s=parseInt(n.target.value||"14",10),o=Math.max(1,isNaN(s)?14:s);x(e,V(o)),t({atrLength:o})}function iY(n,e,t){const s=parseInt(n.target.value||"3",10),o=Math.max(1,isNaN(s)?3:s);x(e,V(o)),t({reversalBoxes:o})}function rY(n,e,t){const s=n.target.value;x(e,V(s)),t({upColor:s})}function aY(n,e,t){const s=n.target.value;x(e,V(s)),t({downColor:s})}function lY(n,e,t,s,o,r,a,l){x(e,"ATR"),x(t,1),x(s,14),x(o,3),x(r,"#00E6D8"),x(a,"#FF4D4D"),l({boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"})}function cY(n,e,t,s,o,r,a,l,c,f){if(i(e)==="solid"){const u=n.target.getBoundingClientRect();x(t,V({x:u.right+10,y:u.top})),x(s,!0),x(o,!1),x(r,!1),x(a,!1),x(l,!1),x(c,!1),f()}else i(e)==="gradient"&&(x(r,!0),x(s,!1),x(o,!1),x(a,!1),x(l,!1),x(c,!1))}function uY(n,e,t,s,o,r,a,l,c){if(console.log("🔥 Grid picker clicked, type:",i(e)),i(e)==="solid"){const f=n.target.getBoundingClientRect();x(t,V({x:f.right+10,y:f.top})),console.log("🔥 Opening grid color picker at:",i(t)),x(s,!0),x(o,!1),x(r,!1),x(a,!1),x(l,!1),x(c,!1)}else i(e)==="gradient"&&(x(a,!0),x(s,!1),x(o,!1),x(r,!1),x(l,!1),x(c,!1))}function dY(n,e,t,s,o,r,a,l,c){const f=n.target.getBoundingClientRect();x(e,V({x:f.right+10,y:f.top})),x(t,!0),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c()}function fY(n,e,t,s,o,r,a,l,c){const f=n.target.getBoundingClientRect();x(e,V({x:f.right+10,y:f.top})),x(t,!0),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c()}function pY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function mY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function hY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function vY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function gY(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function _Y(n,e,t,s,o,r,a,l,c,f){const u=n.target.getBoundingClientRect();x(e,V({x:u.right+10,y:u.top})),x(t,!1),x(s,!1),x(o,!1),x(r,!1),x(a,!1),x(l,!1),c(),x(f,!0)}function yY(n,e,t){x(e,!i(e)),t()}function bY(n,e,t){x(e,!i(e)),t()}function xY(n,e,t){x(e,!i(e)),t()}var wY=(n,e)=>x(e,"canvas"),kY=(n,e)=>x(e,"other"),SY=(n,e)=>x(e,"candle"),CY=(n,e)=>x(e,"renko"),IY=Me('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Duty AI Renko</button>'),PY=(n,e)=>x(e,"pnf"),MY=Me('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Point & Figure</button>'),NY=Me('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Canvas Settings</h4> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Background color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Grid color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">X-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Y-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div></div>'),AY=(n,e,t)=>e(i(t).key,n.target.value),TY=Me("<option> </option>"),FY=Me('<select class="select select-bordered select-sm w-full sm:w-32 flex-shrink-0"></select>'),LY=(n,e,t)=>e(i(t).key,n.target.checked),EY=Me('<input type="checkbox" class="toggle toggle-sm flex-shrink-0">'),$Y=Me('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 space-y-2 sm:space-y-0"><label class="text-sm font-medium text-base-content/80 flex-1"> </label> <!></div>'),DY=Me('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Other Settings</h4> <div class="grid grid-cols-1 gap-4"></div></div>'),RY=Me('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Candle Color Customization</h4> <div class="space-y-4"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Body</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Borders</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Wick</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div></div></div>'),jY=Me('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Duty AI Renko Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="flex items-center gap-3"><label class="flex items-center gap-2"><input type="checkbox" class="checkbox checkbox-sm"> <span>Wick</span></label></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Source</label> <select class="select select-bordered select-sm"><option>Close</option><option>Open</option><option>High</option><option>Low</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box size assignment method</label> <select class="select select-bordered select-sm" disabled><option>ATR</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR length</label> <input type="number" min="1" class="input input-bordered input-sm"></div></div></div></div>'),BY=Me('<div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR Length</label> <input type="number" min="1" max="200" step="1" class="input input-bordered input-sm"></div>'),OY=Me('<div class="flex flex-col gap-1"><label class="text-xs opacity-80"> </label> <input type="number" min="0.0001" step="0.1" class="input input-bordered input-sm"></div>'),zY=Me('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Point & Figure Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box Size Mode</label> <select class="select select-bordered select-sm"><option>ATR (Auto-fit)</option><option>Absolute (Price Units)</option><option>Percent (%)</option></select></div> <!></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Reversal Boxes (typical: 3)</label> <input type="number" min="1" max="10" step="1" class="input input-bordered input-sm w-32"></div> <div class="pt-2 border-t border-base-300"><h5 class="text-sm font-medium mb-3">Symbol Colors</h5> <div class="grid grid-cols-2 gap-4"><div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Up Column (X)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div> <div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Down Column (O)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div></div></div> <div class="pt-4 border-t border-base-300"><button class="btn btn-sm btn-outline">Reset P&F to Defaults</button></div></div></div>'),VY=Me('<div class="flex flex-col lg:flex-row min-h-[400px] max-h-[70vh] overflow-hidden"><div class="w-full lg:w-48 border-b lg:border-b-0 lg:border-r border-base-300 pb-4 lg:pb-0 lg:pr-4 mb-4 lg:mb-0"><div class="flex lg:flex-col space-x-2 lg:space-x-0 lg:space-y-2 overflow-x-auto lg:overflow-x-visible"><button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Canvas</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Other Settings</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Candle</button> <!> <!></div></div> <div class="flex-1 lg:pl-6 overflow-y-auto"><!></div></div>'),WY=Me("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function D8(n,e){Ld(e,!0);const t=tm(),s=()=>vl(c,"$save",t),o=()=>vl(f,"$chart",t),r=()=>vl(l,"$ctx",t);let a=pi(e,"show",15);const l=cd("ctx"),c=cd("save"),f=cd("chart"),u=new p6("chart-settings",f,"dark");b0(()=>{u.destroy()});let d=xe(!1),h=null;wr(()=>{var En,ms,js,Nn,Io;if(a())console.log("🔧 Settings modal OPENED"),console.log("  - Current $save.styles.candle.type:",(ms=(En=s().styles)==null?void 0:En.candle)==null?void 0:ms.type),console.log("  - Current chart.getStyles().candle.type:",(Io=(Nn=(js=o())==null?void 0:js.getStyles())==null?void 0:Nn.candle)==null?void 0:Io.type),x(d,!1),u.openModal();else if(!i(d)){console.log("🚫 Settings modal CANCELLED"),h&&(clearTimeout(h),h=null);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}});let m=xe("canvas");const g=new gy;let w=xe(!1),C=xe(!1),M=xe(!1),P=xe(!1),T=xe(V({x:0,y:0})),N=xe(V({x:0,y:0})),L=xe(V({x:0,y:0})),O=xe(V({x:0,y:0})),D=xe(!1),$=xe(!1),z=xe(!1),te=xe(!1),pe=xe(!1),J=xe(!1),le=xe(V({x:0,y:0})),de=xe(V({x:0,y:0})),he=xe(V({x:0,y:0})),ge=xe(V({x:0,y:0})),ae=xe(V({x:0,y:0})),Ie=xe(V({x:0,y:0})),ce=xe(!1),je=xe(!1),Ve=xe(!1),We=xe(V(wn.get(s().styles,"backgroundType")||"solid")),He=xe(V(wn.get(s().styles,"gridType")||"solid")),Ue=xe(V(wn.get(s().styles,"backgroundColor")||"#000000")),et=xe(V(wn.get(s().styles,"grid.horizontal.color")||"#333333")),ft=xe(100),it=xe(100),Lt=xe(100),Tt=xe(100);const Pt=[{key:"candle.priceMark.last.show",label:"Show Last Price",type:"switch",default:!0},{key:"candle.priceMark.high.show",label:"Show High Price",type:"switch",default:!0},{key:"candle.priceMark.low.show",label:"Show Low Price",type:"switch",default:!0},{key:"indicator.lastValueMark.show",label:"Show Indicator Last Value",type:"switch",default:!0},{key:"yAxis.reverse",label:"Reverse Coordinate",type:"switch",default:!1},{key:"grid.show",label:"Grid Show",type:"switch",default:!0}],St=new gy;let st=xe(!0),xt=xe(!0),Je=xe(!0),Xe=xe("#26a69a"),Be=xe("#ef5350"),Qe=xe("#26a69a"),ct=xe("#ef5350"),Mt=xe("#26a69a"),mt=xe("#ef5350");const Ce=At(()=>{var En,ms;return((ms=(En=s().styles)==null?void 0:En.candle)==null?void 0:ms.type)==="renko_atr"});let Te=xe(!1),It=xe("close"),$t=xe("ATR"),Yt=xe(14);wr(()=>{var ms,js;if(!a())return;const En=((js=(ms=s().styles)==null?void 0:ms.candle)==null?void 0:js.renko)||{};x(Te,!!En.wick),x(It,V(En.source||"close")),x($t,V(En.method||"ATR")),x(Yt,V(Math.max(1,(En.atrLength??14)|0)))}),wr(()=>{a()&&(i(Ce)?x(m,V(i(m)==="canvas"||i(m)==="other"?i(m):"renko")):i(m)==="renko"&&x(m,"candle"))});function qn(En){c.update(ms=>{ms.styles||(ms.styles={}),ms.styles.candle||(ms.styles.candle={});const js=ms.styles.candle;return js.renko||(js.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),js.renko={...js.renko,...En},ms})}const Vn=At(()=>{var En,ms;return((ms=(En=s().styles)==null?void 0:En.candle)==null?void 0:ms.type)==="point_and_figure"});let Dn=xe("ATR"),Wn=xe(1),pn=xe(14),gn=xe(3),Qs=xe("#00E6D8"),Is=xe("#FF4D4D");wr(()=>{var ms,js;if(!a())return;const En=((js=(ms=s().styles)==null?void 0:ms.candle)==null?void 0:js.pnf)||{};x(Dn,V(En.boxSizeMode||"ATR")),x(Wn,V(Math.max(1e-4,En.boxSize??1))),x(pn,V(Math.max(1,Math.round(En.atrLength??14)))),x(gn,V(Math.max(1,Math.round(En.reversalBoxes??3)))),x(Qs,V(En.upColor||"#00E6D8")),x(Is,V(En.downColor||"#FF4D4D"))}),wr(()=>{a()&&(i(Vn)?x(m,V(i(m)==="canvas"||i(m)==="other"?i(m):"pnf")):i(m)==="pnf"&&x(m,"candle"))});function Cs(En){c.update(ms=>{ms.styles||(ms.styles={}),ms.styles.candle||(ms.styles.candle={});const js=ms.styles.candle;return js.pnf||(js.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}),js.pnf={...js.pnf,...En},ms})}let ro=xe(V(wn.get(s().styles,"backgroundGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]})),bs=xe(V(wn.get(s().styles,"gridGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#2a2a2a",opacity:100},{position:100,color:"#3a3a3a",opacity:100}]}));function zt(En){if(!En||!En.stops)return"";const js=[...En.stops].sort((Nn,Io)=>Nn.position-Io.position).map(Nn=>{const Io=parseInt(Nn.color.slice(1,3),16),fo=parseInt(Nn.color.slice(3,5),16),Ji=parseInt(Nn.color.slice(5,7),16),Gi=Nn.opacity/100;return`rgba(${Io}, ${fo}, ${Ji}, ${Gi}) ${Nn.position}%`});return En.type==="linear"?`linear-gradient(${En.direction}deg, ${js.join(", ")})`:`radial-gradient(circle, ${js.join(", ")})`}function Qt(En){if(typeof En=="string"&&En.startsWith("rgba(")){const ms=En.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(ms){const js=parseInt(ms[1]),Nn=parseInt(ms[2]),Io=parseInt(ms[3]);return`#${js.toString(16).padStart(2,"0")}${Nn.toString(16).padStart(2,"0")}${Io.toString(16).padStart(2,"0")}`}}return En}function ho(){const En=s().theme;return{backgroundColor:En==="dark"?"#0A0F1A":"#ffffff",backgroundOpacity:100,gridColor:En==="dark"?"#111B2B":"#F3F3F3",gridOpacity:100,xAxisTickTextColor:En==="dark"?"#b3b3b3":"#000000",yAxisTickTextColor:En==="dark"?"#b3b3b3":"#000000"}}wr(()=>{a()&&o()&&(console.log("📂 Modal opened - restoring saved values..."),x(Ve,!0),g.clear(),ri(),queueMicrotask(()=>{x(Ve,!1),console.log("✅ Restoration complete - preview enabled")}))}),wr(()=>{if(!o()||!a()||i(Ve))return;const En=i(ft),ms=i(Ue),js=i(We),Nn=i(ro);Nn==null||Nn.stops,Nn==null||Nn.type,Nn==null||Nn.direction;const Io=document.querySelector(".duty-main"),fo=document.querySelector(".duty-widget");if(js==="solid"){const Ji=g.get("backgroundColor")||ms||ho().backgroundColor,Al=(g.get("backgroundOpacity")??En??100)/100,Ii=nc(Ji,Al);[Io,fo].forEach(Wo=>{if(Wo){const To=Wo;To.style.removeProperty("background"),To.style.removeProperty("background-color"),To.offsetHeight,To.style.setProperty("background",Ii,"important"),To.style.setProperty("background-color",Ii,"important"),To.style.setProperty("--chart-background-color",Ii),To.offsetHeight}})}else if(js==="gradient"){const Ji=g.get("backgroundGradient")||Nn;let Gi=Ji;(!Ji||!Ji.stops||Ji.stops.length===0)&&(Gi={type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]},g.set("backgroundGradient",Gi));const Al=Gi.css||zt(Gi);[Io,fo].forEach(Ii=>{if(Ii){const Wo=Ii;Wo.style.removeProperty("background"),Wo.style.removeProperty("background-color"),Wo.offsetHeight,Wo.style.setProperty("background",Al,"important"),Wo.style.setProperty("background-color",Al,"important"),Wo.style.setProperty("--chart-background-color",Al),Wo.offsetHeight}})}}),wr(()=>{var Io,fo,Ji,Gi;if(!o()||!a()||i(Ve))return;const En=i(it),ms=i(et),js=i(He),Nn=i(bs);if(Nn==null||Nn.stops,Nn==null||Nn.type,Nn==null||Nn.direction,console.log("🔄 Grid effect triggered:",{gridColorType:js,gridColor:ms,gridOpacity:En}),js==="solid"){const Al=g.get("gridColor")||ms||ho().gridColor,Ii=g.get("gridOpacity")??En??100,Wo=nc(Al,Ii/100);console.log("🎨 Applying solid grid color via effect:",Wo);const To=o().getStyles()??{},Ba=wn.cloneDeep(To);(fo=(Io=s().styles)==null?void 0:Io.candle)!=null&&fo.type&&wn.set(Ba,"candle.type",s().styles.candle.type);const Pi=wn.get(To,"grid.show",!0);wn.set(Ba,"grid.show",Pi),wn.set(Ba,"grid.horizontal.show",Pi),wn.set(Ba,"grid.horizontal.color",Wo),wn.set(Ba,"grid.vertical.show",Pi),wn.set(Ba,"grid.vertical.color",Wo),o().setStyles(Ba)}else if(js==="gradient"){const Al=g.get("gridGradient")||Nn;if(Al&&Al.stops&&Al.stops.length>0){const Ii=Al.stops[0],Wo=Al.stops[Al.stops.length-1],To=ou(Ii.color,Wo.color,.5);console.log("🎨 Applying gradient grid color via effect:",To);const Ba=o().getStyles()??{},Pi=wn.cloneDeep(Ba);(Gi=(Ji=s().styles)==null?void 0:Ji.candle)!=null&&Gi.type&&wn.set(Pi,"candle.type",s().styles.candle.type);const qs=wn.get(Ba,"grid.show",!0);wn.set(Pi,"grid.show",qs),wn.set(Pi,"grid.horizontal.show",qs),wn.set(Pi,"grid.horizontal.color",To),wn.set(Pi,"grid.vertical.show",qs),wn.set(Pi,"grid.vertical.color",To),o().setStyles(Pi)}}});function ri(){const En=ho();console.log("🔄 Restoring saved values...",{backgroundType:wn.get(s().styles,"backgroundType"),gridType:wn.get(s().styles,"gridType")});const ms=wn.get(s().styles,"backgroundType")||"solid";if(x(We,V(ms)),ms==="solid"){const mi=wn.get(s().styles,"backgroundColor")||En.backgroundColor,Er=wn.get(s().styles,"backgroundOpacity")||En.backgroundOpacity,Za=Qt(mi);x(Ue,V(Za)),x(ft,V(Er)),g.set("backgroundColor",Za),g.set("backgroundOpacity",Er),console.log("✅ Restored solid BG:",Za,"opacity:",Er)}else if(ms==="gradient"){const mi=wn.get(s().styles,"backgroundGradient");mi&&(x(ro,V({...mi})),g.set("backgroundGradient",mi),console.log("✅ Restored gradient BG:",mi))}const js=wn.get(s().styles,"gridType")||"solid";if(x(He,V(js)),js==="solid"){const mi=wn.get(s().styles,"grid.horizontal.color")||wn.get(s().styles,"grid.vertical.color")||En.gridColor,Er=wn.get(s().styles,"gridOpacity")||En.gridOpacity,Za=Qt(mi);x(et,V(Za)),x(it,V(Er)),g.set("gridColor",Za),g.set("gridOpacity",Er),console.log("✅ Restored solid Grid:",Za,"opacity:",Er)}else if(js==="gradient"){const mi=wn.get(s().styles,"gridGradient");mi&&(x(bs,V({...mi})),g.set("gridGradient",mi),console.log("✅ Restored gradient Grid:",mi))}const Nn=wn.get(s().styles,"xAxis.tickText.color")||En.xAxisTickTextColor,Io=wn.get(s().styles,"xAxis.tickText.opacity")||100,fo=Qt(Nn);x(Lt,V(Io)),g.set("xAxisTickTextColor",fo),g.set("xAxisTickTextOpacity",Io);const Ji=wn.get(s().styles,"yAxis.tickText.color")||En.yAxisTickTextColor,Gi=wn.get(s().styles,"yAxis.tickText.opacity")||100,Al=Qt(Ji);x(Tt,V(Gi)),g.set("yAxisTickTextColor",Al),g.set("yAxisTickTextOpacity",Gi);try{if(o()&&typeof o().getStyles=="function"){const mi=o().getStyles()??{},Er=wn.get(mi,"xAxis.tickText.color"),Za=wn.get(mi,"yAxis.tickText.color");if(Er){const vi=Qt(Er);g.set("xAxisTickTextColor",vi)}if(Za){const vi=Qt(Za);g.set("yAxisTickTextColor",vi)}}}catch(mi){console.warn("Failed to read live axis styles from chart:",mi)}const Ii=wn.get(s().styles,"candle.bar.upColor")||"#26a69a",Wo=wn.get(s().styles,"candle.bar.downColor")||"#ef5350",To=wn.get(s().styles,"candle.bar.upBorderColor")||"#26a69a",Ba=wn.get(s().styles,"candle.bar.downBorderColor")||"#ef5350",Pi=wn.get(s().styles,"candle.bar.upWickColor")||"#26a69a",qs=wn.get(s().styles,"candle.bar.downWickColor")||"#ef5350";x(Xe,V(Ii)),x(Be,V(Wo)),x(Qe,V(To)),x(ct,V(Ba)),x(Mt,V(Pi)),x(mt,V(qs)),Pt.forEach(mi=>{const Er=wn.get(s().styles,mi.key);Er!==void 0?St.set(mi.key,Er):St.set(mi.key,mi.default)})}function jo(En){if(x(Ue,V(En.detail)),g.set("backgroundColor",En.detail),i(We)==="solid"){const ms=i(ft)/100,js=nc(En.detail,ms),Nn=document.querySelector(".duty-main"),Io=document.querySelector(".duty-widget");[Nn,Io].forEach(fo=>{if(fo){const Ji=fo;Ji.style.removeProperty("background"),Ji.style.removeProperty("background-color"),Ji.style.removeProperty("background-image"),Ji.offsetHeight,Ji.style.setProperty("background",js,"important"),Ji.style.setProperty("background-color",js,"important"),Ji.style.setProperty("--chart-background-color",js),Ji.offsetHeight}})}}function Na(En){if(x(ft,V(En.detail)),g.set("backgroundOpacity",En.detail),i(We)==="solid"){const ms=g.get("backgroundColor")||i(Ue)||ho().backgroundColor,js=En.detail/100,Nn=nc(ms,js),Io=document.querySelector(".duty-main"),fo=document.querySelector(".duty-widget");[Io,fo].forEach(Ji=>{if(Ji){const Gi=Ji;Gi.style.removeProperty("background"),Gi.style.removeProperty("background-color"),Gi.offsetHeight,Gi.style.setProperty("background",Nn,"important"),Gi.style.setProperty("background-color",Nn,"important"),Gi.style.setProperty("--chart-background-color",Nn),Gi.offsetHeight}})}}function ar(En){var fo,Ji;if(console.log("🎨 Grid color changed to:",En.detail),x(et,V(En.detail)),g.set("gridColor",En.detail),!o()){console.warn("⚠️ No chart available for grid color preview");return}const ms=nc(En.detail,i(it)/100);console.log("🎨 Applying grid color:",ms);const js=o().getStyles()??{},Nn=wn.cloneDeep(js);(Ji=(fo=s().styles)==null?void 0:fo.candle)!=null&&Ji.type&&wn.set(Nn,"candle.type",s().styles.candle.type);const Io=wn.get(js,"grid.show",!0);wn.set(Nn,"grid.show",Io),wn.set(Nn,"grid.horizontal.show",Io),wn.set(Nn,"grid.horizontal.color",ms),wn.set(Nn,"grid.vertical.show",Io),wn.set(Nn,"grid.vertical.color",ms),console.log("🎨 New grid styles:",Nn.grid);try{o().setStyles(Nn),console.log("✅ Grid styles applied successfully")}catch(Gi){console.error("❌ Failed to apply grid styles:",Gi)}}function Aa(En){var Ji,Gi;if(console.log("🎨 Grid opacity changed to:",En.detail),x(it,V(En.detail)),g.set("gridOpacity",En.detail),!o()){console.warn("⚠️ No chart available for grid opacity preview");return}const ms=g.get("gridColor")||i(et)||ho().gridColor,js=nc(ms,En.detail/100);console.log("🎨 Applying grid opacity:",js);const Nn=o().getStyles()??{},Io=wn.cloneDeep(Nn);(Gi=(Ji=s().styles)==null?void 0:Ji.candle)!=null&&Gi.type&&wn.set(Io,"candle.type",s().styles.candle.type);const fo=wn.get(Nn,"grid.show",!0);wn.set(Io,"grid.show",fo),wn.set(Io,"grid.horizontal.show",fo),wn.set(Io,"grid.horizontal.color",js),wn.set(Io,"grid.vertical.show",fo),wn.set(Io,"grid.vertical.color",js),console.log("🎨 New grid styles:",Io.grid);try{o().setStyles(Io),console.log("✅ Grid opacity applied successfully")}catch(Al){console.error("❌ Failed to apply grid opacity:",Al)}}function nr(En){if(g.set("xAxisTickTextColor",En.detail),o()){const ms=o().getStyles()??{},js=wn.cloneDeep(ms);wn.set(js,"xAxis.tickText.color",En.detail);const Nn=qd(js);o().setStyles(Nn)}}function hi(En){if(g.set("yAxisTickTextColor",En.detail),o()){const ms=o().getStyles()??{},js=wn.cloneDeep(ms);wn.set(js,"yAxis.tickText.color",En.detail);const Nn=qd(js);o().setStyles(Nn)}}function Gc(En){if(x(Lt,V(En.detail)),g.set("xAxisTickTextOpacity",En.detail),o()){const ms=o().getStyles()??{},js=wn.cloneDeep(ms),Nn=g.get("xAxisTickTextColor")||ho().xAxisTickTextColor,Io=En.detail/100,fo=nc(Nn,Io);wn.set(js,"xAxis.tickText.color",fo);const Ji=qd(js);o().setStyles(Ji)}}function Pu(En){if(x(Tt,V(En.detail)),g.set("yAxisTickTextOpacity",En.detail),o()){const ms=o().getStyles()??{},js=wn.cloneDeep(ms),Nn=g.get("yAxisTickTextColor")||ho().yAxisTickTextColor,Io=En.detail/100,fo=nc(Nn,Io);wn.set(js,"yAxis.tickText.color",fo);const Ji=qd(js);o().setStyles(Ji)}}function wc(En){if(x(ro,V({...En.detail})),g.set("backgroundGradient",i(ro)),i(We)==="gradient"){const ms=document.querySelector(".duty-main"),js=document.querySelector(".duty-widget"),Nn=zt(i(ro));[ms,js].forEach(Io=>{if(Io){const fo=Io;fo.style.removeProperty("background"),fo.style.removeProperty("background-color"),fo.offsetHeight,fo.style.setProperty("background",Nn,"important"),fo.style.setProperty("background-color",Nn,"important"),fo.style.setProperty("--chart-background-color",Nn),fo.offsetHeight}})}}function cc(En){var ms,js;if(x(bs,V({...En.detail})),g.set("gridGradient",i(bs)),o()&&i(He)==="gradient"){const Nn=En.detail.stops[0],Io=En.detail.stops[En.detail.stops.length-1],fo=ou(Nn.color,Io.color,.5),Ji=o().getStyles()??{},Gi=wn.cloneDeep(Ji);(js=(ms=s().styles)==null?void 0:ms.candle)!=null&&js.type&&wn.set(Gi,"candle.type",s().styles.candle.type),wn.set(Gi,"grid.horizontal.color",fo),wn.set(Gi,"grid.vertical.color",fo);const Al=qd(Gi);o().setStyles(Al)}}function ou(En,ms,js){const Nn=En.replace("#",""),Io=ms.replace("#",""),fo=parseInt(Nn.substr(0,2),16),Ji=parseInt(Nn.substr(2,2),16),Gi=parseInt(Nn.substr(4,2),16),Al=parseInt(Io.substr(0,2),16),Ii=parseInt(Io.substr(2,2),16),Wo=parseInt(Io.substr(4,2),16),To=Math.round(fo*(1-js)+Al*js),Ba=Math.round(Ji*(1-js)+Ii*js),Pi=Math.round(Gi*(1-js)+Wo*js);return`#${To.toString(16).padStart(2,"0")}${Ba.toString(16).padStart(2,"0")}${Pi.toString(16).padStart(2,"0")}`}function zu(En,ms){var Ji,Gi,Al;const js=(Ji=o())==null?void 0:Ji.getStyles(),Nn=wn.get(js,En);if(En==="yAxis.reverse")try{(Gi=o())==null||Gi.setPaneOptions({axis:{reverse:ms}}),c.update(Ii=>(wn.set(Ii.styles,En,ms),Ii)),St.set(En,ms);return}catch(Ii){console.warn("setPaneOptions not available, falling back to styles:",Ii)}else if(En==="yAxis.type"){console.warn("yAxis.type is not supported in chart engine v10");return}if(Nn==ms)return;St.set(En,ms),c.update(Ii=>(wn.set(Ii.styles,En,ms),Ii));const Io=up(s().theme),fo=wn.merge({},Io,s().styles);(Al=o())==null||Al.setStyles(qd(fo))}function ja(){let En=o();if(!En)return;const ms=En.getStyles()??{};Pt.forEach(js=>{const Nn=wn.get(ms,js.key);js.key==="yAxis.reverse"?St.set(js.key,Nn||!1):St.set(js.key,Nn??js.default)})}function nc(En,ms){const js=En.replace("#",""),Nn=parseInt(js.substr(0,2),16),Io=parseInt(js.substr(2,2),16),fo=parseInt(js.substr(4,2),16);return`rgba(${Nn}, ${Io}, ${fo}, ${ms})`}function Bc(){x(D,!1),x($,!1),x(z,!1),x(te,!1),x(pe,!1),x(J,!1)}function Vu(En){x(Xe,V(En.detail)),kr()}function rf(En){x(Be,V(En.detail)),kr()}function co(En){x(Qe,V(En.detail)),kr()}function ll(En){x(ct,V(En.detail)),kr()}function va(En){x(Mt,V(En.detail)),kr()}function Vl(En){x(mt,V(En.detail)),kr()}function kr(){h&&clearTimeout(h),h=setTimeout(()=>{var Nn,Io;if(!o())return;const En=o().getStyles()??{},ms=wn.cloneDeep(En);(Io=(Nn=s().styles)==null?void 0:Nn.candle)!=null&&Io.type&&wn.set(ms,"candle.type",s().styles.candle.type),i(st)&&(wn.set(ms,"candle.bar.upColor",i(Xe)),wn.set(ms,"candle.bar.downColor",i(Be))),i(xt)&&(wn.set(ms,"candle.bar.upBorderColor",i(Qe)),wn.set(ms,"candle.bar.downBorderColor",i(ct))),i(Je)&&(wn.set(ms,"candle.bar.upWickColor",i(Mt)),wn.set(ms,"candle.bar.downWickColor",i(mt)));const js=qd(ms);o().setStyles(js),h=null},16)}function Wr(En){var ms,js;if(En==="confirm"){console.log("🔧 CONFIRM CLICKED - Using theme manager"),u.updatePending(Nn=>{if(i(We)==="solid"){const Io=g.get("backgroundColor")||i(Ue),fo=g.get("backgroundOpacity")??i(ft);Nn.canvas.background.mode="solid",Nn.canvas.background.solid={color:Io,alpha:fo/100},delete Nn.canvas.background.gradient}else if(i(We)==="gradient"){const Io=g.get("backgroundGradient")||i(ro);Nn.canvas.background.mode="gradient",Nn.canvas.background.gradient=Io,delete Nn.canvas.background.solid}if(i(He)==="solid"){const Io=g.get("gridColor")||i(et),fo=g.get("gridOpacity")??i(it);Nn.canvas.grid.mode="solid",Nn.canvas.grid.solid={color:Io,alpha:fo/100},delete Nn.canvas.grid.gradient}else if(i(He)==="gradient"){const Io=g.get("gridGradient")||i(bs);Nn.canvas.grid.mode="gradient",Nn.canvas.grid.gradient=Io,delete Nn.canvas.grid.solid}}),c.update(Nn=>{var fo,Ji,Gi,Al,Ii,Wo;Nn.styles||(Nn.styles={}),Nn.styles.candle||(Nn.styles.candle={}),Nn.styles.candle.bar||(Nn.styles.candle.bar={}),console.log("🎨 Saving settings - Background Type:",i(We)),console.log("🎨 Saving settings - Grid Type:",i(He));const Io=(Ji=(fo=Nn.styles)==null?void 0:fo.candle)==null?void 0:Ji.type;if(Io&&console.log("🔒 Preserving chart type:",Io),i(We)==="solid"){const To=g.get("backgroundColor")||i(Ue),Ba=g.get("backgroundOpacity")??i(ft);console.log("🎨 Solid BG:",{bgColor:To,bgOpacity:Ba}),To&&(Nn.styles.backgroundColor=To,Nn.styles.backgroundOpacity=Ba,Nn.styles.backgroundType="solid",delete Nn.styles.backgroundGradient)}else if(i(We)==="gradient"){const To=g.get("backgroundGradient")||i(ro);console.log("🎨 Gradient BG:",To),To&&To.stops&&To.stops.length>0?(Nn.styles.backgroundGradient=To,Nn.styles.backgroundType="gradient",delete Nn.styles.backgroundColor,delete Nn.styles.backgroundOpacity,console.log("✅ Gradient background saved to $save.styles")):console.warn("⚠️ Invalid gradient data:",To)}if(i(He)==="solid"){const To=g.get("gridColor")||i(et),Ba=g.get("gridOpacity")??100;console.log("🎨 Solid Grid:",{gridColor:To,gridOpacity:Ba}),To&&(Nn.styles.grid||(Nn.styles.grid={}),Nn.styles.grid.horizontal||(Nn.styles.grid.horizontal={}),Nn.styles.grid.vertical||(Nn.styles.grid.vertical={}),Nn.styles.grid.horizontal.color=To,Nn.styles.grid.vertical.color=To,Nn.styles.gridOpacity=Ba,Nn.styles.gridType="solid",delete Nn.styles.gridGradient)}else if(i(He)==="gradient"){const To=g.get("gridGradient")||i(bs);console.log("🎨 Gradient Grid:",To),To&&To.stops&&To.stops.length>0?(Nn.styles.gridGradient=To,Nn.styles.gridType="gradient",(Al=(Gi=Nn.styles.grid)==null?void 0:Gi.horizontal)==null||delete Al.color,(Wo=(Ii=Nn.styles.grid)==null?void 0:Ii.vertical)==null||delete Wo.color,delete Nn.styles.gridOpacity,console.log("✅ Gradient grid saved to $save.styles")):console.warn("⚠️ Invalid grid gradient data:",To)}try{const To=g.get("xAxisTickTextColor")||ho().xAxisTickTextColor,Ba=g.get("xAxisTickTextOpacity")??100,Pi=nc(To,Ba/100);wn.set(Nn.styles,"xAxis.tickText.color",Pi),wn.set(Nn.styles,"xAxis.tickText.opacity",Ba);const qs=g.get("yAxisTickTextColor")||ho().yAxisTickTextColor,mi=g.get("yAxisTickTextOpacity")??100,Er=nc(qs,mi/100);wn.set(Nn.styles,"yAxis.tickText.color",Er),wn.set(Nn.styles,"yAxis.tickText.opacity",mi)}catch(To){console.warn("Failed to persist axis tick text colors:",To)}try{const To=Nn.styles.candle.bar;i(st)&&(To.upColor=i(Xe),To.downColor=i(Be)),i(xt)&&(To.upBorderColor=i(Qe),To.downBorderColor=i(ct)),i(Je)&&(To.upWickColor=i(Mt),To.downWickColor=i(mt))}catch(To){console.warn("Failed to persist candle colors to $save.styles:",To)}return Io&&Nn.styles.candle&&(Nn.styles.candle.type=Io,console.log("✅ Restored chart type:",Io)),Nn}),u.confirm(),x(d,!0);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors(),a(!1)}else if(En==="reset"){console.log("🔄 RESET CLICKED - Using theme manager"),u.reset();const Nn=ho();x(We,"solid"),x(ft,V(Nn.backgroundOpacity)),x(He,"solid"),x(it,V(Nn.gridOpacity)),x(Lt,100),x(Tt,100),x(st,!0),x(xt,!0),x(Je,!0),x(Xe,"#26a69a"),x(Be,"#ef5350"),x(Qe,"#26a69a"),x(ct,"#ef5350"),x(Mt,"#26a69a"),x(mt,"#ef5350");try{const Io=ho();if(c.update(fo=>{fo.styles||(fo.styles={}),fo.styles.backgroundType="solid",fo.styles.backgroundColor=Io.backgroundColor,fo.styles.backgroundOpacity=Io.backgroundOpacity,delete fo.styles.backgroundGradient,fo.styles.grid||(fo.styles.grid={}),fo.styles.grid.horizontal||(fo.styles.grid.horizontal={}),fo.styles.grid.vertical||(fo.styles.grid.vertical={}),fo.styles.gridType="solid",fo.styles.gridOpacity=Io.gridOpacity,fo.styles.grid.horizontal.color=Io.gridColor,fo.styles.grid.vertical.color=Io.gridColor,delete fo.styles.gridGradient;const Ji=Io.xAxisTickTextColor,Gi=Io.yAxisTickTextColor,Al=nc(Ji,1),Ii=nc(Gi,1);wn.set(fo.styles,"xAxis.tickText.color",Al),wn.set(fo.styles,"xAxis.tickText.opacity",100),wn.set(fo.styles,"yAxis.tickText.color",Ii),wn.set(fo.styles,"yAxis.tickText.opacity",100),fo.styles.candle||(fo.styles.candle={}),fo.styles.candle.bar||(fo.styles.candle.bar={});const Wo=fo.styles.candle.bar;return Wo.upColor=i(Xe),Wo.downColor=i(Be),Wo.upBorderColor=i(Qe),Wo.downBorderColor=i(ct),Wo.upWickColor=i(Mt),Wo.downWickColor=i(mt),fo}),o()){const fo=up(s().theme),Ji=wn.merge({},fo,s().styles);(js=(ms=s().styles)==null?void 0:ms.candle)!=null&&js.type&&wn.set(Ji,"candle.type",s().styles.candle.type);const Gi=ho().xAxisTickTextColor,Al=ho().yAxisTickTextColor,Ii=nc(Gi,1),Wo=nc(Al,1);wn.set(Ji,"xAxis.tickText.color",Ii),wn.set(Ji,"yAxis.tickText.color",Wo);const To=qd(Ji);o().setStyles(To);try{const Ba=document.querySelector(".duty-main"),Pi=document.querySelector(".duty-widget");[Ba,Pi].forEach(qs=>{if(qs){const mi=qs;mi.style.removeProperty("background"),mi.style.removeProperty("background-color"),mi.style.removeProperty("background-image"),mi.style.removeProperty("--chart-background-color")}})}catch{}try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}}catch(Io){console.warn("Failed to apply default candle colors on reset:",Io)}ja(),g.clear(),g.set("backgroundColor",Nn.backgroundColor),g.set("backgroundOpacity",Nn.backgroundOpacity),g.set("gridColor",Nn.gridColor),g.set("gridOpacity",Nn.gridOpacity),g.set("xAxisTickTextColor",Nn.xAxisTickTextColor),g.set("xAxisTickTextOpacity",100),g.set("yAxisTickTextColor",Nn.yAxisTickTextColor),g.set("yAxisTickTextOpacity",100)}else console.log("🚫 CANCEL CLICKED - Using theme manager"),u.cancel(),a(!1);x(w,!1),x(C,!1),x(M,!1),x(P,!1),x(ce,!1),x(je,!1),Bc()}var jl=WY(),Xl=tn(jl);sg(Xl,{title:"Chart Setting",width:"min(90vw, 700px)",get show(){return a()},set show(En){a(En)},get theme(){return s().theme},click:Wr,buttons:["confirm","reset"],children:(En,ms)=>{var js=VY(),Nn=y(js),Io=y(Nn),fo=y(Io);fo.__click=[wY,m];var Ji=v(fo,2);Ji.__click=[kY,m];var Gi=v(Ji,2);Gi.__click=[SY,m];var Al=v(Gi,2);Ye(Al,()=>i(Ce),Ba=>{var Pi=IY();Pi.__click=[CY,m],Ne(()=>{rr(Pi,"bg-primary",i(m)==="renko"),rr(Pi,"text-primary-content",i(m)==="renko"),rr(Pi,"hover:bg-base-200",i(m)!=="renko")}),Y(Ba,Pi)});var Ii=v(Al,2);Ye(Ii,()=>i(Vn),Ba=>{var Pi=MY();Pi.__click=[PY,m],Ne(()=>{rr(Pi,"bg-primary",i(m)==="pnf"),rr(Pi,"text-primary-content",i(m)==="pnf"),rr(Pi,"hover:bg-base-200",i(m)!=="pnf")}),Y(Ba,Pi)}),_(Io),_(Nn);var Wo=v(Nn,2),To=y(Wo);Ye(To,()=>i(m)==="canvas",Ba=>{var Pi=NY(),qs=v(y(Pi),2),mi=v(y(qs),2),Er=y(mi),Za=y(Er);Za.value=(Za.__value="solid")==null?"":"solid";var vi=v(Za);vi.value=(vi.__value="gradient")==null?"":"gradient",_(Er);var $r=v(Er,2);const Il=At(()=>{var Wa;return`background: ${(i(We)==="gradient"?((Wa=g.get("backgroundGradient"))==null?void 0:Wa.css)||zt(i(ro))||"linear-gradient(0deg, #ffffff 0%, #000000 100%)":g.get("backgroundColor")||ho().backgroundColor)??""}`});$r.__click=[cY,We,T,w,C,ce,je,M,P,Bc],_(mi),_(qs);var cl=v(qs,2),kc=v(y(cl),2),uc=y(kc),Tl=y(uc);Tl.value=(Tl.__value="solid")==null?"":"solid";var ur=v(Tl);ur.value=(ur.__value="gradient")==null?"":"gradient",_(uc);var la=v(uc,2);const Fl=At(()=>{var Wa;return`background: ${(i(He)==="gradient"?((Wa=g.get("gridGradient"))==null?void 0:Wa.css)||zt(i(bs))||"linear-gradient(0deg, #f3f3f3 0%, #1c1c1c 100%)":g.get("gridColor")||i(et)||ho().gridColor)??""}`});la.__click=[uY,He,N,C,w,ce,je,M,P],_(kc),_(cl);var Oa=v(cl,2),ni=v(y(Oa),2),vc=y(ni);const gl=At(()=>`background: ${(g.get("xAxisTickTextColor")||ho().xAxisTickTextColor)??""}`);vc.__click=[dY,L,M,w,C,ce,je,P,Bc],_(ni),_(Oa);var za=v(Oa,2),sl=v(y(za),2),Oc=y(sl);const Va=At(()=>`background: ${(g.get("yAxisTickTextColor")||ho().yAxisTickTextColor)??""}`);Oc.__click=[fY,O,P,w,C,ce,je,M,Bc],_(sl),_(za),_(Pi),Ne(()=>{Dt($r,"style",i(Il)),Dt(la,"style",i(Fl)),Dt(vc,"style",i(gl)),Dt(Oc,"style",i(Va))}),po(Er,()=>i(We),Wa=>x(We,Wa)),po(uc,()=>i(He),Wa=>x(He,Wa)),Y(Ba,Pi)},Ba=>{var Pi=Yn(),qs=tn(Pi);Ye(qs,()=>i(m)==="other",mi=>{var Er=DY(),Za=v(y(Er),2);Ro(Za,21,()=>Pt,fi,(vi,$r)=>{var Il=$Y(),cl=y(Il),kc=y(cl,!0);_(cl);var uc=v(cl,2);Ye(uc,()=>i($r).type==="select",Tl=>{var ur=FY();e_(ur,()=>St.get(i($r).key)??i($r).default);var la;ur.__change=[AY,zu,$r],Ro(ur,21,()=>i($r).options||[],fi,(Fl,Oa)=>{var ni=TY(),vc={},gl=y(ni,!0);_(ni),Ne(()=>{vc!==(vc=i(Oa).value)&&(ni.value=(ni.__value=i(Oa).value)==null?"":i(Oa).value),tt(gl,i(Oa).label)}),Y(Fl,ni)}),_(ur),Ne(()=>{la!==(la=St.get(i($r).key)??i($r).default)&&(ur.value=(ur.__value=St.get(i($r).key)??i($r).default)==null?"":St.get(i($r).key)??i($r).default,_0(ur,St.get(i($r).key)??i($r).default))}),Y(Tl,ur)},Tl=>{var ur=Yn(),la=tn(ur);Ye(la,()=>i($r).type==="switch",Fl=>{var Oa=EY();mn(Oa),Ne(()=>Av(Oa,St.get(i($r).key)??i($r).default)),Oa.__change=[LY,zu,$r],Y(Fl,Oa)},null,!0),Y(Tl,ur)}),_(Il),Ne(()=>tt(kc,i($r).label)),Y(vi,Il)}),_(Za),_(Er),Y(mi,Er)},mi=>{var Er=Yn(),Za=tn(Er);Ye(Za,()=>i(m)==="candle",vi=>{var $r=RY(),Il=v(y($r),2),cl=y(Il),kc=y(cl),uc=y(kc);mn(uc),uc.__change=[yY,st,kr],Di(2),_(kc);var Tl=v(kc,2),ur=y(Tl),la=v(y(ur),2);la.__click=[pY,le,w,C,M,P,ce,je,Bc,D],_(ur);var Fl=v(ur,2),Oa=v(y(Fl),2);Oa.__click=[mY,de,w,C,M,P,ce,je,Bc,$],_(Fl),_(Tl),_(cl);var ni=v(cl,2),vc=y(ni),gl=y(vc);mn(gl),gl.__change=[bY,xt,kr],Di(2),_(vc);var za=v(vc,2),sl=y(za),Oc=v(y(sl),2);Oc.__click=[hY,he,w,C,M,P,ce,je,Bc,z],_(sl);var Va=v(sl,2),Wa=v(y(Va),2);Wa.__click=[vY,ge,w,C,M,P,ce,je,Bc,te],_(Va),_(za),_(ni);var uu=v(ni,2),ud=y(uu),Ll=y(ud);mn(Ll),Ll.__change=[xY,Je,kr],Di(2),_(ud);var vu=v(ud,2),Sc=y(vu),Ja=v(y(Sc),2);Ja.__click=[gY,ae,w,C,M,P,ce,je,Bc,pe],_(Sc);var ga=v(Sc,2),Wu=v(y(ga),2);Wu.__click=[_Y,Ie,w,C,M,P,ce,je,Bc,J],_(ga),_(vu),_(uu),_(Il),_($r),Ne(()=>{Dt(la,"style",`background-color: ${i(Xe)??""}`),la.disabled=!i(st),rr(la,"opacity-50",!i(st)),Dt(Oa,"style",`background-color: ${i(Be)??""}`),Oa.disabled=!i(st),rr(Oa,"opacity-50",!i(st)),Dt(Oc,"style",`background-color: ${i(Qe)??""}`),Oc.disabled=!i(xt),rr(Oc,"opacity-50",!i(xt)),Dt(Wa,"style",`background-color: ${i(ct)??""}`),Wa.disabled=!i(xt),rr(Wa,"opacity-50",!i(xt)),Dt(Ja,"style",`background-color: ${i(Mt)??""}`),Ja.disabled=!i(Je),rr(Ja,"opacity-50",!i(Je)),Dt(Wu,"style",`background-color: ${i(mt)??""}`),Wu.disabled=!i(Je),rr(Wu,"opacity-50",!i(Je))}),jg(uc,()=>i(st),zc=>x(st,zc)),jg(gl,()=>i(xt),zc=>x(xt,zc)),jg(Ll,()=>i(Je),zc=>x(Je,zc)),Y(vi,$r)},vi=>{var $r=Yn(),Il=tn($r);Ye(Il,()=>i(m)==="renko",cl=>{var kc=jY(),uc=v(y(kc),2),Tl=y(uc),ur=y(Tl),la=y(ur);mn(la),la.__change=[JG,Te,qn],Di(2),_(ur),_(Tl);var Fl=v(Tl,2),Oa=y(Fl),ni=v(y(Oa),2);ni.__change=[QG,It,qn];var vc=y(ni);vc.value=(vc.__value="close")==null?"":"close";var gl=v(vc);gl.value=(gl.__value="open")==null?"":"open";var za=v(gl);za.value=(za.__value="high")==null?"":"high";var sl=v(za);sl.value=(sl.__value="low")==null?"":"low",_(ni),_(Oa);var Oc=v(Oa,2),Va=v(y(Oc),2);Va.__change=[eY,$t,qn];var Wa=y(Va);Wa.value=(Wa.__value="ATR")==null?"":"ATR",_(Va),_(Oc);var uu=v(Oc,2),ud=v(y(uu),2);mn(ud),ud.__input=[tY,Yt,qn],_(uu),_(Fl),_(uc),_(kc),Ne(()=>{Av(la,i(Te)),Hf(ud,i(Yt))}),po(ni,()=>i(It),Ll=>x(It,Ll)),po(Va,()=>i($t),Ll=>x($t,Ll)),Y(cl,kc)},cl=>{var kc=Yn(),uc=tn(kc);Ye(uc,()=>i(m)==="pnf",Tl=>{var ur=zY(),la=v(y(ur),2),Fl=y(la),Oa=y(Fl),ni=v(y(Oa),2);ni.__change=[nY,Dn,Cs];var vc=y(ni);vc.value=(vc.__value="ATR")==null?"":"ATR";var gl=v(vc);gl.value=(gl.__value="absolute")==null?"":"absolute";var za=v(gl);za.value=(za.__value="percent")==null?"":"percent",_(ni),_(Oa);var sl=v(Oa,2);Ye(sl,()=>i(Dn)==="ATR",dd=>{var Id=BY(),dc=v(y(Id),2);mn(dc),dc.__input=[oY,pn,Cs],_(Id),Ne(()=>Hf(dc,i(pn))),Y(dd,Id)},dd=>{var Id=OY(),dc=y(Id),Gf=y(dc);_(dc);var Pd=v(dc,2);mn(Pd),Pd.__input=[sY,Wn,Cs],_(Id),Ne(()=>{tt(Gf,`Box Size ${(i(Dn)==="percent"?"(%)":"(Price)")??""}`),Hf(Pd,i(Wn))}),Y(dd,Id)}),_(Fl);var Oc=v(Fl,2),Va=v(y(Oc),2);mn(Va),Va.__input=[iY,gn,Cs],_(Oc);var Wa=v(Oc,2),uu=v(y(Wa),2),ud=y(uu),Ll=v(y(ud),2),vu=y(Ll);mn(vu),vu.__input=[rY,Qs,Cs];var Sc=v(vu,2),Ja=y(Sc,!0);_(Sc),_(Ll),_(ud);var ga=v(ud,2),Wu=v(y(ga),2),zc=y(Wu);mn(zc),zc.__input=[aY,Is,Cs];var eu=v(zc,2),Ud=y(eu,!0);_(eu),_(Wu),_(ga),_(uu),_(Wa);var qf=v(Wa,2),Uf=y(qf);Uf.__click=[lY,Dn,Wn,pn,gn,Qs,Is,Cs],_(qf),_(la),_(ur),Ne(()=>{Hf(Va,i(gn)),tt(Ja,i(Qs)),tt(Ud,i(Is))}),po(ni,()=>i(Dn),dd=>x(Dn,dd)),As(vu,()=>i(Qs),dd=>x(Qs,dd)),As(zc,()=>i(Is),dd=>x(Is,dd)),Y(Tl,ur)},null,!0),Y(cl,kc)},!0),Y(vi,$r)},!0),Y(mi,Er)},!0),Y(Ba,Pi)}),_(Wo),_(js),Ne(()=>{rr(fo,"bg-primary",i(m)==="canvas"),rr(fo,"text-primary-content",i(m)==="canvas"),rr(fo,"hover:bg-base-200",i(m)!=="canvas"),rr(Ji,"bg-primary",i(m)==="other"),rr(Ji,"text-primary-content",i(m)==="other"),rr(Ji,"hover:bg-base-200",i(m)!=="other"),rr(Gi,"bg-primary",i(m)==="candle"),rr(Gi,"text-primary-content",i(m)==="candle"),rr(Gi,"hover:bg-base-200",i(m)!=="candle")}),Y(En,js)},$$slots:{default:!0}});var Mu=v(Xl,2);Ye(Mu,()=>i(w),En=>{var ms=At(()=>g.get("backgroundColor")||ho().backgroundColor);Yv(En,{get show(){return i(w)},set show(js){x(w,V(js))},get selectedColor(){return i(ms)},get opacity(){return i(ft)},$$events:{colorChange:jo,opacityChange:Na}})});var Zu=v(Mu,2);Ye(Zu,()=>i(C),En=>{var ms=At(()=>g.get("gridColor")||i(et)||ho().gridColor);Yv(En,{get show(){return i(C)},set show(js){x(C,V(js))},get selectedColor(){return i(ms)},get opacity(){return i(it)},$$events:{colorChange:ar,opacityChange:Aa}})});var xo=v(Zu,2);Ye(xo,()=>i(M),En=>{var ms=At(()=>g.get("xAxisTickTextColor")||ho().xAxisTickTextColor);Yv(En,{get show(){return i(M)},set show(js){x(M,V(js))},get selectedColor(){return i(ms)},get opacity(){return i(Lt)},$$events:{colorChange:nr,opacityChange:Gc}})});var Sr=v(xo,2);Ye(Sr,()=>i(P),En=>{var ms=At(()=>g.get("yAxisTickTextColor")||ho().yAxisTickTextColor);Yv(En,{get show(){return i(P)},set show(js){x(P,V(js))},get selectedColor(){return i(ms)},get opacity(){return i(Tt)},$$events:{colorChange:hi,opacityChange:Pu}})});var ql=v(Sr,2);Ye(ql,()=>i(D),En=>{Yv(En,{get show(){return i(D)},set show(ms){x(D,V(ms))},get selectedColor(){return i(Xe)},$$events:{colorChange:Vu}})});var $f=v(ql,2);Ye($f,()=>i($),En=>{Yv(En,{get show(){return i($)},set show(ms){x($,V(ms))},get selectedColor(){return i(Be)},$$events:{colorChange:rf}})});var Cf=v($f,2);Ye(Cf,()=>i(z),En=>{Yv(En,{get show(){return i(z)},set show(ms){x(z,V(ms))},get selectedColor(){return i(Qe)},$$events:{colorChange:co}})});var tp=v(Cf,2);Ye(tp,()=>i(te),En=>{Yv(En,{get show(){return i(te)},set show(ms){x(te,V(ms))},get selectedColor(){return i(ct)},$$events:{colorChange:ll}})});var mf=v(tp,2);Ye(mf,()=>i(pe),En=>{Yv(En,{get show(){return i(pe)},set show(ms){x(pe,V(ms))},get selectedColor(){return i(Mt)},$$events:{colorChange:va}})});var sc=v(mf,2);Ye(sc,()=>i(J),En=>{Yv(En,{get show(){return i(J)},set show(ms){x(J,V(ms))},get selectedColor(){return i(mt)},$$events:{colorChange:Vl}})});var yd=v(sc,2);Ye(yd,()=>i(ce),En=>{h5(En,{get show(){return i(ce)},set show(ms){x(ce,V(ms))},get initialGradient(){return i(ro)},$$events:{gradientChange:wc}})});var If=v(yd,2);Ye(If,()=>i(je),En=>{h5(En,{get show(){return i(je)},set show(ms){x(je,V(ms))},get initialGradient(){return i(bs)},$$events:{gradientChange:cc}})}),Y(n,jl),Ed()}Tp(["click","change","input"]);var HY=(n,e,t)=>e(i(t).key,n.currentTarget.value),qY=Me("<option> </option>"),UY=Me('<select class="select select-bordered select-sm w-full"></select>'),GY=(n,e,t)=>e(i(t).key,n.currentTarget.checked),YY=Me('<input type="checkbox" class="toggle toggle-sm">'),KY=Me('<span class="text-base-content/70 text-right"> </span> <!>',1),XY=(n,e)=>x(e,!0),ZY=Me('<div class="grid grid-cols-[3fr_2fr_3fr_2fr] gap-5 mx-7 my-5 items-center"><!> <div class="col-span-4 mt-4 pt-4 border-t border-base-300"><button class="btn btn-outline btn-primary w-full">Chart Setting</button></div></div>'),JY=Me("<!> <!>",1);function QY(n,e){Ld(e,!0);const t=tm(),s=()=>vl(f,"$chart",t),o=()=>vl(c,"$save",t);let r=pi(e,"show",15);const a=new gy,l=cd("ctx"),c=cd("save"),f=cd("chart");let u=xe(!1);const d=[{key:"candle.priceMark.last.show",text:"last_price_show",component:"switch"},{key:"candle.priceMark.high.show",text:"high_price_show",component:"switch"},{key:"candle.priceMark.low.show",text:"low_price_show",component:"switch"},{key:"indicator.lastValueMark.show",text:"indicator_last_value_show",component:"switch"},{key:"yAxis.reverse",text:"reverse_coordinate",component:"switch"},{key:"grid.show",text:"grid_show",component:"switch"}];function h(N,L){var te,pe,J,le,de,he,ge,ae,Ie,ce,je,Ve,We,He,Ue,et,ft,it,Lt,Tt,Pt,St,st,xt,Je,Xe,Be;const O=(te=s())==null?void 0:te.getStyles(),D=wn.get(O,N);if(N==="yAxis.reverse")try{(pe=s())==null||pe.setPaneOptions({axis:{reverse:L}}),c.update(Qe=>(wn.set(Qe.styles,N,L),Qe)),a.set(N,L);return}catch(Qe){console.warn("setPaneOptions not available, falling back to styles:",Qe)}if(D==L)return;a.set(N,L),c.update(Qe=>(wn.set(Qe.styles,N,L),Qe));const $=up(o().theme);console.log("🟡 Settings.update key:",N,"value:",L,"theme:",o().theme),console.log("🎨 theme axis colors:",(de=(le=(J=$==null?void 0:$.xAxis)==null?void 0:J.tickText)==null?void 0:le.style)==null?void 0:de.color,(ae=(ge=(he=$==null?void 0:$.yAxis)==null?void 0:he.tickText)==null?void 0:ge.style)==null?void 0:ae.color),console.log("💾 saved axis colors:",wn.get(o().styles,"xAxis.tickText.style.color"),wn.get(o().styles,"yAxis.tickText.style.color"));const z=wn.merge({},$,o().styles);try{const Qe=(je=(ce=(Ie=$==null?void 0:$.xAxis)==null?void 0:Ie.tickText)==null?void 0:ce.style)==null?void 0:je.color,ct=(He=(We=(Ve=$==null?void 0:$.yAxis)==null?void 0:Ve.tickText)==null?void 0:We.style)==null?void 0:He.color;Qe&&((et=(Ue=z==null?void 0:z.xAxis)==null?void 0:Ue.tickText)!=null&&et.style)&&(z.xAxis.tickText.style.color=Qe,(ft=z==null?void 0:z.xAxis)!=null&&ft.tickText&&(delete z.xAxis.tickText.color,delete z.xAxis.tickText.opacity)),ct&&((Lt=(it=z==null?void 0:z.yAxis)==null?void 0:it.tickText)!=null&&Lt.style)&&(z.yAxis.tickText.style.color=ct,(Tt=z==null?void 0:z.yAxis)!=null&&Tt.tickText&&(delete z.yAxis.tickText.color,delete z.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors before apply:",(st=(St=(Pt=z==null?void 0:z.xAxis)==null?void 0:Pt.tickText)==null?void 0:St.style)==null?void 0:st.color,(Xe=(Je=(xt=z==null?void 0:z.yAxis)==null?void 0:xt.tickText)==null?void 0:Je.style)==null?void 0:Xe.color),(Be=s())==null||Be.setStyles(qd(z)),setTimeout(()=>{var mt,Ce,Te,It,$t,Yt,qn,Vn,Dn,Wn,pn;const Qe=((mt=s())==null?void 0:mt.getStyles())||{},ct=((It=(Te=(Ce=Qe==null?void 0:Qe.xAxis)==null?void 0:Ce.tickText)==null?void 0:Te.style)==null?void 0:It.color)??((Yt=($t=Qe==null?void 0:Qe.xAxis)==null?void 0:$t.tickText)==null?void 0:Yt.color),Mt=((Dn=(Vn=(qn=Qe==null?void 0:Qe.yAxis)==null?void 0:qn.tickText)==null?void 0:Vn.style)==null?void 0:Dn.color)??((pn=(Wn=Qe==null?void 0:Qe.yAxis)==null?void 0:Wn.tickText)==null?void 0:pn.color);console.log("✅ chart axis colors after apply:",ct,Mt)},0)}function m(N){var L,O,D,$,z,te,pe,J,le,de,he,ge,ae,Ie,ce,je,Ve,We,He,Ue,et,ft,it,Lt,Tt,Pt,St;if(N==="reset"){const st=(O=(L=o().styles)==null?void 0:L.candle)==null?void 0:O.type,xt=up(o().theme),Je=o().styles;d.forEach(Be=>{wn.unset(Je,Be.key)}),c.update(Be=>(Be.styles=Je,st&&(Be.styles.candle||(Be.styles.candle={}),Be.styles.candle.type=st),Be));const Xe=wn.merge({},xt,o().styles);console.log("🟠 Settings.reset theme:",o().theme),console.log("🎨 default axis colors:",(z=($=(D=xt==null?void 0:xt.xAxis)==null?void 0:D.tickText)==null?void 0:$.style)==null?void 0:z.color,(J=(pe=(te=xt==null?void 0:xt.yAxis)==null?void 0:te.tickText)==null?void 0:pe.style)==null?void 0:J.color);try{const Be=(he=(de=(le=xt==null?void 0:xt.xAxis)==null?void 0:le.tickText)==null?void 0:de.style)==null?void 0:he.color,Qe=(Ie=(ae=(ge=xt==null?void 0:xt.yAxis)==null?void 0:ge.tickText)==null?void 0:ae.style)==null?void 0:Ie.color;Be&&((je=(ce=Xe==null?void 0:Xe.xAxis)==null?void 0:ce.tickText)!=null&&je.style)&&(Xe.xAxis.tickText.style.color=Be,(Ve=Xe==null?void 0:Xe.xAxis)!=null&&Ve.tickText&&(delete Xe.xAxis.tickText.color,delete Xe.xAxis.tickText.opacity)),Qe&&((He=(We=Xe==null?void 0:Xe.yAxis)==null?void 0:We.tickText)!=null&&He.style)&&(Xe.yAxis.tickText.style.color=Qe,(Ue=Xe==null?void 0:Xe.yAxis)!=null&&Ue.tickText&&(delete Xe.yAxis.tickText.color,delete Xe.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors on reset:",(it=(ft=(et=Xe==null?void 0:Xe.xAxis)==null?void 0:et.tickText)==null?void 0:ft.style)==null?void 0:it.color,(Pt=(Tt=(Lt=Xe==null?void 0:Xe.yAxis)==null?void 0:Lt.tickText)==null?void 0:Tt.style)==null?void 0:Pt.color),(St=s())==null||St.setStyles(qd(Xe)),setTimeout(()=>{var Mt,mt,Ce,Te,It,$t,Yt,qn,Vn,Dn,Wn;const Be=((Mt=s())==null?void 0:Mt.getStyles())||{},Qe=((Te=(Ce=(mt=Be==null?void 0:Be.xAxis)==null?void 0:mt.tickText)==null?void 0:Ce.style)==null?void 0:Te.color)??(($t=(It=Be==null?void 0:Be.xAxis)==null?void 0:It.tickText)==null?void 0:$t.color),ct=((Vn=(qn=(Yt=Be==null?void 0:Be.yAxis)==null?void 0:Yt.tickText)==null?void 0:qn.style)==null?void 0:Vn.color)??((Wn=(Dn=Be==null?void 0:Be.yAxis)==null?void 0:Dn.tickText)==null?void 0:Wn.color);console.log("✅ chart axis colors after reset apply:",Qe,ct)},0),g()}else r(!1)}function g(){let N=s();if(!N)return;const L=N.getStyles()??{};d.forEach(O=>{const D=wn.get(L,O.key);O.key==="yAxis.reverse"?a.set(O.key,D||!1):a.set(O.key,D)})}hp(l,N=>N.initDone).subscribe(g),wr(()=>{r()&&s()&&g()});var C=JY(),M=tn(C),P=At(()=>o4());sg(M,{get title(){return i(P)},width:760,get show(){return r()},set show(N){r(N)},get theme(){return o().theme},click:m,buttons:["confirm","reset"],children:(N,L)=>{var O=ZY(),D=y(O);Ro(D,17,()=>d,fi,(te,pe)=>{var J=KY(),le=tn(J),de=y(le,!0);Ne(()=>{var ge;return tt(de,(ge=Bg[i(pe).text])==null?void 0:ge.call(Bg))}),_(le);var he=v(le,2);Ye(he,()=>i(pe).component==="select",ge=>{var ae=UY();e_(ae,()=>a.get(i(pe).key));var Ie;ae.__change=[HY,h,pe],Ro(ae,21,()=>i(pe).dataSource||[],fi,(ce,je)=>{var Ve=qY(),We={},He=y(Ve,!0);Ne(()=>{var Ue;return tt(He,((Ue=Bg[i(je).text])==null?void 0:Ue.call(Bg))||i(je).text)}),_(Ve),Ne(()=>{We!==(We=i(je).key)&&(Ve.value=(Ve.__value=i(je).key)==null?"":i(je).key)}),Y(ce,Ve)}),_(ae),Ne(()=>{Ie!==(Ie=a.get(i(pe).key))&&(ae.value=(ae.__value=a.get(i(pe).key))==null?"":a.get(i(pe).key),_0(ae,a.get(i(pe).key)))}),Y(ge,ae)},ge=>{var ae=Yn(),Ie=tn(ae);Ye(Ie,()=>i(pe).component==="switch",ce=>{var je=YY();mn(je),Ne(()=>Av(je,!!a.get(i(pe).key))),je.__change=[GY,h,pe],Y(ce,je)},null,!0),Y(ge,ae)}),Y(te,J)});var $=v(D,2),z=y($);z.__click=[XY,u],_($),_(O),Y(N,O)},$$slots:{default:!0}});var T=v(M,2);D8(T,{get show(){return i(u)},set show(N){x(u,V(N))}}),Y(n,C),Ed()}Tp(["change","click"]);var eK=Me('<img alt="screenshot" class="w-[500px] mt-5">');function tK(n,e){Ld(e,!0);const t=tm(),s=()=>vl(r,"$save",t);let o=pi(e,"show",15);const r=cd("save");function a(l){if(l==="confirm"){const c=document.createElement("a");c.download="screenshot",c.href=e.url,document.body.appendChild(c),c.click(),c.remove()}o(!1)}sg(n,{title:"Screenshot",width:540,get show(){return o()},set show(l){o(l)},get theme(){return s().theme},click:a,children:(l,c)=>{var f=eK();Ne(()=>Dt(f,"src",e.url)),Y(l,f)},$$slots:{default:!0}}),Ed()}var nK=Me("<option> </option>"),sK=Me('<div class="flex justify-center items-center min-h-[70px]"><select class="select select-bordered w-[70%]"></select></div>');function oK(n,e){Ld(e,!0);const t=tm(),s=()=>vl(r,"$save",t);let o=pi(e,"show",15);const r=cd("save"),a=iP();function l(u){const h=u.target.value;r.update(m=>(m.timezone=h,m))}function c(u){o(!1)}var f=At(()=>e4());sg(n,{get title(){return i(f)},width:400,get show(){return o()},set show(u){o(u)},get theme(){return s().theme},click:c,children:(u,d)=>{var h=sK(),m=y(h);e_(m,()=>s().timezone);var g;m.__change=l,Ro(m,21,()=>a,fi,(w,C)=>{var M=nK(),P={},T=y(M,!0);Ne(()=>tt(T,Bg[i(C).text]())),_(M),Ne(()=>{P!==(P=i(C).key)&&(M.value=(M.__value=i(C).key)==null?"":i(C).key)}),Y(w,M)}),_(m),_(h),Ne(()=>{g!==(g=s().timezone)&&(m.value=(m.__value=s().timezone)==null?"":s().timezone,_0(m,s().timezone))}),Y(u,h)},$$slots:{default:!0}}),Ed()}Tp(["change"]);var iK=Me('<div class="warning-banner"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01M10.29 3.86l-7.6 13.17A1 1 0 003.53 19h16.94a1 1 0 00.84-1.5L13.71 3.86a1 1 0 00-1.73 0z"></path></svg> <span> </span></div>'),rK=(n,e,t)=>e(i(t),n),aK=Me('<div class="selection-badge"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M13.3 4.3L6 11.6 2.7 8.3l1.1-1.1L6 9.4l6.2-6.2 1.1 1.1z" fill="currentColor" stroke="currentColor" stroke-width="0.5"></path></svg></div>'),lK=Me('<button class="chart-card"><div class="card-bg"></div> <!> <div class="icon-container"><div class="icon-glow"></div> <!></div> <span class="chart-name"> </span> <div class="shine-effect"></div></button>'),cK=Me(`<!> <div class="premium-grid"></div> <style>/* ===== PREMIUM GRID LAYOUT ===== */
    .premium-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      padding: 8px;
    }
    
    @media (max-width: 640px) {
      .premium-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding: 6px;
      }
    }
    
    @media (max-width: 480px) {
      .premium-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding: 8px;
      }
    }
    
    /* ===== PREMIUM CHART CARD ===== */
    .chart-card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px 12px 18px;
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      border: 1.5px solid rgba(255, 255, 255, 0.06);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    @media (max-width: 640px) {
      .chart-card {
        padding: 16px 10px 14px;
        gap: 8px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-card {
        padding: 22px 14px 20px;
        gap: 12px;
      }
    }
    
    /* Animated background */
    .card-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg,
        rgba(45, 55, 75, 0.3) 0%,
        rgba(30, 40, 60, 0.2) 50%,
        rgba(20, 30, 50, 0.3) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }
    
    /* Hover state */
    .chart-card:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.12);
      background: linear-gradient(145deg, 
        rgba(35, 45, 60, 0.7) 0%, 
        rgba(25, 35, 50, 0.5) 100%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        0 6px 20px rgba(20, 30, 50, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }
    
    .chart-card:hover .card-bg {
      opacity: 1;
    }
    
    /* Active state */
    .chart-card.active {
      background: linear-gradient(145deg, 
        rgba(30, 50, 80, 0.5) 0%,
        rgba(20, 40, 70, 0.4) 50%,
        rgba(25, 45, 75, 0.5) 100%);
      border-color: rgba(70, 120, 180, 0.4);
      box-shadow: 
        0 8px 32px rgba(30, 60, 100, 0.3),
        0 4px 16px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(60, 100, 150, 0.2);
      transform: translateY(-2px);
    }
    
    .chart-card.active .card-bg {
      background: linear-gradient(145deg,
        rgba(40, 65, 95, 0.4) 0%,
        rgba(30, 55, 85, 0.3) 50%,
        rgba(35, 60, 90, 0.4) 100%);
      opacity: 1;
    }
    
    .chart-card.active:hover {
      transform: translateY(-2px);
      border-color: rgba(80, 130, 190, 0.5);
    }
    
    /* ===== SELECTION BADGE ===== */
    .selection-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, 
        rgba(70, 120, 180, 0.9) 0%, 
        rgba(50, 100, 160, 0.85) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 
        0 3px 10px rgba(30, 60, 100, 0.4),
        0 1px 3px rgba(0, 0, 0, 0.3);
      animation: badgePulse 2.5s ease-in-out infinite;
    }
    
    @keyframes badgePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 
          0 3px 10px rgba(30, 60, 100, 0.4),
          0 1px 3px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 
          0 4px 14px rgba(40, 70, 110, 0.5),
          0 2px 5px rgba(0, 0, 0, 0.35);
      }
    }
    
    /* ===== ICON CONTAINER ===== */
    .icon-container {
      position: relative;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: linear-gradient(145deg, 
        rgba(40, 50, 65, 0.5) 0%, 
        rgba(25, 35, 50, 0.3) 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.06);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .icon-container {
        width: 42px;
        height: 42px;
        border-radius: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .icon-container {
        width: 50px;
        height: 50px;
        border-radius: 12px;
      }

    }
    
    .icon-glow {
      position: absolute;
      inset: -3px;
      background: linear-gradient(145deg, 
        rgba(50, 90, 140, 0.3) 0%, 
        rgba(35, 70, 120, 0.25) 100%);
      border-radius: inherit;
      opacity: 0;
      filter: blur(10px);
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .chart-card:hover .icon-container {
      transform: scale(1.06);
      background: linear-gradient(145deg, 
        rgba(50, 65, 85, 0.6) 0%, 
        rgba(35, 50, 70, 0.4) 100%);
      box-shadow: 
        0 5px 18px rgba(0, 0, 0, 0.25),
        0 2px 10px rgba(30, 50, 80, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .chart-card.active .icon-container {
      background: linear-gradient(145deg, 
        rgba(40, 70, 110, 0.5) 0%, 
        rgba(30, 60, 95, 0.4) 100%);
      border-color: rgba(70, 110, 160, 0.3);
      transform: scale(1.04);
      box-shadow: 
        0 6px 20px rgba(30, 60, 100, 0.3),
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }
    
    .chart-card.active .icon-glow {
      opacity: 0.5;
    }
    
    /* ===== CHART ICON ===== */
    :global(.chart-icon) {
      color: rgba(200, 210, 230, 0.85);
      filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
    }
    
    .chart-card:hover :global(.chart-icon) {
      color: rgba(220, 230, 245, 0.95);
      filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.35));
      transform: scale(1.05);
    }
    
    .chart-card.active :global(.chart-icon) {
      color: rgba(160, 200, 240, 1);
      filter: drop-shadow(0 4px 12px rgba(40, 80, 130, 0.5));
      transform: scale(1.03);
    }
    
    /* ===== CHART NAME ===== */
    .chart-name {
      color: rgba(180, 190, 210, 0.85);
      font-size: 12px;
      font-weight: 500;
      text-align: center;
      line-height: 1.3;
      letter-spacing: 0.4px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .chart-name {
        font-size: 11px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-name {
        font-size: 12.5px;
      }
    }
    
    .chart-card:hover .chart-name {
      color: rgba(210, 220, 235, 0.95);
      transform: translateY(-1px);
    }
    
    .chart-card.active .chart-name {
      color: rgba(180, 210, 240, 1);
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    /* ===== SHINE EFFECT ===== */
    .shine-effect {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        115deg,
        transparent 25%,
        rgba(255, 255, 255, 0.08) 45%,
        rgba(200, 220, 240, 0.12) 50%,
        rgba(255, 255, 255, 0.08) 55%,
        transparent 75%
      );
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chart-card:hover .shine-effect {
      transform: translateX(100%) skewX(-15deg);
    }
    
    /* ===== LIGHT THEME ===== */
    :global([data-theme="light"]) .chart-card {
      background: linear-gradient(145deg, #ffffff 0%, #f9fbff 100%);
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 2px 6px rgba(59, 130, 246, 0.08),
        0 1px 2px rgba(0, 0, 0, 0.04);
    }
    
    :global([data-theme="light"]) .card-bg {
      background: transparent;
      opacity: 0;
    }
    
    :global([data-theme="light"]) .chart-card:hover {
      background: #ffffff;
      border-color: rgba(59, 130, 246, 0.25);
      box-shadow: 
        0 6px 14px rgba(59, 130, 246, 0.10),
        0 3px 8px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active {
      background: linear-gradient(145deg, #e8f4ff 0%, #f0f8ff 100%);
      border-color: rgba(100, 150, 220, 0.4);
      box-shadow: 
        0 3px 10px rgba(100, 150, 220, 0.15),
        0 1px 4px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active .card-bg {
      opacity: 0;
    }
    
    :global([data-theme="light"]) .icon-container {
      background: #f3f6fb;
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.04),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card:hover .icon-container {
      background: #f0f2f5;
      box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.05),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card.active .icon-container {
      background: linear-gradient(145deg, #dceeff 0%, #e6f3ff 100%);
      border-color: rgba(100, 150, 220, 0.2);
      box-shadow: 
        0 2px 8px rgba(100, 150, 220, 0.12),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .icon-glow {
      opacity: 0;
    }
    
    :global([data-theme="light"]) :global(.chart-icon) {
      color: #3b82f6;
      filter: drop-shadow(0 0.5px 1px rgba(59, 130, 246, 0.15));
    }
    
    :global([data-theme="light"]) .chart-card:hover :global(.chart-icon) {
      color: #2563eb;
      filter: drop-shadow(0 1px 2px rgba(37, 99, 235, 0.2));
    }
    
    :global([data-theme="light"]) .chart-card.active :global(.chart-icon) {
      color: #1d4ed8;
      filter: drop-shadow(0 1px 3px rgba(29, 78, 216, 0.3));
    }
    
    :global([data-theme="light"]) .chart-name {
      color: #334155;
    }
    
    :global([data-theme="light"]) .chart-card:hover .chart-name {
      color: #1f2937;
    }
    
    :global([data-theme="light"]) .chart-card.active .chart-name {
      color: #2563eb;
      font-weight: 600;
    }
    
    :global([data-theme="light"]) .selection-badge {
      background: linear-gradient(135deg, #5ba3f5 0%, #4a90e2 100%);
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 
        0 2px 8px rgba(74, 144, 226, 0.3),
        0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    /* ===== WARNING BANNER ===== */
    .warning-banner {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      margin-bottom: 16px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      color: rgba(251, 191, 36, 0.95);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
    }
    
    .warning-banner svg {
      flex-shrink: 0;
      color: rgba(251, 191, 36, 1);
      filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.3));
    }
    
    :global([data-theme="light"]) .warning-banner {
      background: linear-gradient(135deg, rgba(254, 243, 199, 0.9) 0%, rgba(254, 226, 226, 0.8) 100%);
      border-color: rgba(217, 119, 6, 0.3);
      color: rgba(146, 64, 14, 0.95);
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.15);
    }
    
    :global([data-theme="light"]) .warning-banner svg {
      color: rgba(217, 119, 6, 1);
      filter: drop-shadow(0 1px 2px rgba(217, 119, 6, 0.2));
    }
    
    /* ===== DISABLED STATE ===== */
    .chart-card.disabled {
      opacity: 0.35;
      cursor: not-allowed;
      pointer-events: auto;
    }
    
    .chart-card.disabled:hover {
      transform: none;
      opacity: 0.35;
      border-color: rgba(255, 255, 255, 0.06);
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .chart-card.disabled .card-bg {
      opacity: 0;
    }
    
    .chart-card.disabled .icon-container {
      transform: none;
    }
    
    .chart-card.disabled .shine-effect {
      display: none;
    }
    
    :global([data-theme="light"]) .chart-card.disabled {
      opacity: 0.4;
    }
    
    :global([data-theme="light"]) .chart-card.disabled:hover {
      opacity: 0.4;
    }</style>`,1);function uK(n,e){Ld(e,!0);const t=tm(),s=()=>vl(a,"$save",t),o=()=>vl(l,"$chart",t);let r=pi(e,"show",15);cd("ctx");const a=cd("save"),l=cd("chart"),c=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}],f=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"];function u(){return!s()||!s().saveInds?!1:Object.values(s().saveInds).some(w=>w&&f.includes(w.name))}let d=xe(!1),h=xe("");wr(()=>{if(i(d)){const w=setTimeout(()=>{x(d,!1)},5e3);return()=>clearTimeout(w)}});function m(w,C){var N,L,O,D,$;const M=w;if(M.id==="renko_atr"&&u()){x(h,"You cannot use Duty AI Renko chart with AI Indicator"),x(d,!0),console.log("⚠️ Cannot add Renko chart: AI indicators present");return}if(M.id==="point_and_figure"&&u()){x(h,"You cannot use Point & Figure chart with AI Indicator"),x(d,!0),console.log("⚠️ Cannot add P&F chart: AI indicators present");return}if(console.log("📊 CHART TYPE CLICK:",M.id),C){const z=C.currentTarget;z.classList.add("selecting"),setTimeout(()=>{z.classList.remove("selecting")},800)}if(s().styles.candle||Fc(a,Ao(s).styles.candle={},Ao(s)),M.id==="line_chart"){console.log("🎯 Setting up LINE CHART (using area with transparent background)"),Fc(a,Ao(s).styles.candle.type="area",Ao(s));const z=((L=(N=s().styles.candle)==null?void 0:N.bar)==null?void 0:L.upColor)||"#2196F3";Fc(a,Ao(s).styles.candle.area={lineSize:2,lineColor:z,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:"rgba(0, 0, 0, 0)"},{offset:1,color:"rgba(0, 0, 0, 0)"}]},Ao(s)),Fc(a,Ao(s).styles.candle._isLineChart=!0,Ao(s)),console.log("✅ Line chart configured with area type and transparent background")}else if(M.id==="area"){console.log("🎯 Setting up AREA CHART with gradient fill"),Fc(a,Ao(s).styles.candle.type="area",Ao(s)),delete s().styles.candle._isLineChart;const z=((D=(O=s().styles.candle)==null?void 0:O.bar)==null?void 0:D.upColor)||"#2196F3";Fc(a,Ao(s).styles.candle.area={lineSize:2,lineColor:z,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:z+"60"},{offset:1,color:z+"10"}]},Ao(s)),console.log("✅ Area chart configured with gradient background")}else M.id==="renko_atr"?(console.log("🎯 Setting up RENKO (ATR) chart"),Fc(a,Ao(s).styles.candle.type="renko_atr",Ao(s)),s().styles.candle.renko||Fc(a,Ao(s).styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1},Ao(s)),delete s().styles.candle._isLineChart,delete s().styles.candle.area):M.id==="point_and_figure"?(console.log("🎯 Setting up POINT & FIGURE chart"),Fc(a,Ao(s).styles.candle.type="point_and_figure",Ao(s)),s().styles.candle.pnf||Fc(a,Ao(s).styles.candle.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"},Ao(s)),delete s().styles.candle._isLineChart,delete s().styles.candle.area):(Fc(a,Ao(s).styles.candle.type=M.id,Ao(s)),delete s().styles.candle._isLineChart,delete s().styles.candle.area);console.log("✅ Saved chart type to $save.styles:",{type:s().styles.candle.type,isLineChart:s().styles.candle._isLineChart,area:s().styles.candle.area});const P=up(s().theme);wn.merge(P,s().styles);const T=qd(P);($=o())==null||$.setStyles(T),console.log("✅ Styles applied to chart with processing"),r(!1)}function g(){var C,M,P,T;return(M=(C=s().styles)==null?void 0:C.candle)!=null&&M._isLineChart?"line_chart":((T=(P=s().styles)==null?void 0:P.candle)==null?void 0:T.type)||"candle_solid"}sg(n,{get show(){return r()},set show(w){r(w)},title:"Chart Type",width:"550px",maxWidth:"95vw",maxHeight:"90vh",buttons:[],get theme(){return s().theme},class:"chart-type-modal-premium",children:(w,C)=>{var M=cK(),P=tn(M);Ye(P,()=>i(d),N=>{var L=iK(),O=v(y(L),2),D=y(O,!0);_(O),_(L),Ne(()=>tt(D,i(h))),xg(3,L,()=>vy,()=>({y:-20,duration:300})),Y(N,L)});var T=v(P,2);Ro(T,21,()=>c,N=>N.id,(N,L)=>{var O=lK();const D=At(()=>(i(L).id==="renko_atr"||i(L).id==="point_and_figure")&&u());O.__click=[rK,m,L];const $=At(()=>g()===i(L).id);Ne(()=>rr(O,"active",i($)));var z=v(y(O),2);Ye(z,()=>g()===i(L).id&&!i(D),de=>{var he=aK();Y(de,he)});var te=v(z,2),pe=v(y(te),2);Kv(pe,{get name(){return i(L).icon},size:26,class:"chart-icon"}),_(te);var J=v(te,2),le=y(J,!0);_(J),Di(2),_(O),Ne(()=>{rr(O,"disabled",i(D)),tt(le,i(L).name)}),Y(N,O)}),_(T),Di(2),Y(w,M)},$$slots:{default:!0}}),Ed()}Tp(["click"]);function g5(n,e){e(!1)}var dK=(n,e,t,s,o)=>!i(e)&&!i(t)&&s(i(o).is_main,i(o).name),fK=Me('<div class="particle svelte-uswuii"></div>'),pK=Me('<div class="stream-line svelte-uswuii"></div>'),mK=Me('<div class="segment svelte-uswuii"></div>'),hK=Me('<div class="ai-loading-overlay svelte-uswuii"><div class="particles-container svelte-uswuii"></div> <div class="data-stream svelte-uswuii"></div> <div class="loading-content svelte-uswuii"><div class="ai-loader-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg> <div class="ai-pulse-ring ring-1 svelte-uswuii"></div> <div class="ai-pulse-ring ring-2 svelte-uswuii"></div> <div class="ai-pulse-ring ring-3 svelte-uswuii"></div> <div class="ai-glow svelte-uswuii"></div></div> <div class="loading-text-container svelte-uswuii"><div class="loading-text-main svelte-uswuii"> </div> <div class="loading-text-sub svelte-uswuii"> </div></div> <div class="progress-container svelte-uswuii"><div class="progress-bar svelte-uswuii"><div class="progress-glow svelte-uswuii"></div></div> <div class="progress-segments svelte-uswuii"></div></div> <div class="progress-info svelte-uswuii"><div class="progress-percentage svelte-uswuii"> </div> <div class="progress-status svelte-uswuii"> </div></div></div></div>'),vK=(n,e,t,s)=>{n.stopPropagation(),e(i(t),i(s).name)},gK=(n,e,t,s)=>{n.stopPropagation(),e(i(t),i(s).name)},_K=Me('<div class="indicator-actions svelte-uswuii"><button class="action-btn edit-btn svelte-uswuii" title="Edit Parameters"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" class="svelte-uswuii"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" class="svelte-uswuii"></path></svg></button> <button class="action-btn delete-btn svelte-uswuii" title="Remove Indicator"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="3 6 5 6 21 6" class="svelte-uswuii"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" class="svelte-uswuii"></path><line x1="10" y1="11" x2="10" y2="17" class="svelte-uswuii"></line><line x1="14" y1="11" x2="14" y2="17" class="svelte-uswuii"></line></svg></button></div>'),yK=Me('<div class="add-indicator-hint svelte-uswuii"><span class="svelte-uswuii">Click to add</span></div>'),bK=Me('<div class="indicator-icon svelte-uswuii"> </div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii"> </span></div> <!>',1),xK=Me("<div><!></div>"),wK=n=>n.stopPropagation(),kK=Me('<div class="ai-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="ai-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="ai-modal-title"><div class="ai-background svelte-uswuii"><div class="orb orb-1 svelte-uswuii"></div> <div class="orb orb-2 svelte-uswuii"></div> <div class="orb orb-3 svelte-uswuii"></div></div> <div class="ai-content svelte-uswuii"><div class="ai-header svelte-uswuii"><div class="ai-header-left svelte-uswuii"><div class="ai-icon-small svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="ai-header-text svelte-uswuii"><h2 id="ai-modal-title" class="ai-title svelte-uswuii">AI Indicators</h2> <p class="ai-subtitle svelte-uswuii">Duty AI Advanced Algorithm - Exclusive for Pro Traders</p></div></div> <button class="close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button></div> <div class="indicators-list svelte-uswuii"><!> <div class="indicator-row coming-soon-item disabled svelte-uswuii"><div class="coming-soon-glitter-bg svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-1 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-2 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-3 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-4 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-5 svelte-uswuii"></div> <div class="coming-soon-shine-sweep svelte-uswuii"></div> <div class="indicator-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii">AI Trade Entry Finder and more AI algorithms</span> <span class="coming-soon-badge svelte-uswuii">Coming Soon</span></div></div></div> <div class="ai-powered-footer svelte-uswuii"><span class="powered-by-text svelte-uswuii">Powered by Duty AI</span></div></div></div>',1),SK=(n,e)=>x(e,!1),CK=(n,e)=>x(e,!1),IK=Me('<div class="premium-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="premium-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-uswuii"><div class="premium-orb premium-orb-1 svelte-uswuii"></div> <div class="premium-orb premium-orb-2 svelte-uswuii"></div></div> <div class="premium-content svelte-uswuii"><button class="premium-close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button> <div class="premium-icon-wrapper svelte-uswuii"><div class="premium-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-uswuii"></path><path d="M2 17l10 5 10-5" class="svelte-uswuii"></path><path d="M2 12l10 5 10-5" class="svelte-uswuii"></path></svg> <div class="premium-icon-glow svelte-uswuii"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-uswuii">Premium Feature</h2> <p class="premium-message svelte-uswuii">AI Indicators are exclusive premium features. Upgrade to Premium to unlock all advanced AI algorithms and take your trading to the next level.</p> <div class="premium-features svelte-uswuii"><div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Smart Money Footprint</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Trap Hunter (Bull/Bear Traps)</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Volcanic Move & Eruptions</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">More AI algorithms coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-uswuii"><span class="svelte-uswuii">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="5" y1="12" x2="19" y2="12" class="svelte-uswuii"></line><polyline points="12 5 19 12 12 19" class="svelte-uswuii"></polyline></svg></a></div></div>',1),PK=Me("<!> <!>",1);function MK(n,e){Ld(e,!0);const t=tm(),s=()=>vl(u,"$chart",t),o=()=>vl(f,"$save",t),r=()=>vl(c,"$ctx",t),a=()=>vl(B0,"$userPreferences",t);let l=pi(e,"show",15);const c=cd("ctx"),f=cd("save"),u=cd("chart"),d=[{name:"SMART_MONEY",title:"Smart Money Footprint",is_main:!0,icon:"💰"},{name:"TRAP_HUNTER",title:"Trap Hunter (Bull/Bear Traps)",is_main:!0,icon:"🎯"},{name:"VOLCANIC",title:"Volcanic Move (Pressure) (Sub Pane)",is_main:!1,icon:"🌋"},{name:"VOLCANIC_SIG",title:"Volcanic Eruptions (Markers) (Main Pane)",is_main:!0,icon:"💥"}],h={SMART_MONEY:[{text:"💰 Tracking institutional money flow",duration:1200,subtext:"Analyzing whale movements..."},{text:"🏦 Detecting smart money footprints",duration:1400,subtext:"Scanning OBV patterns..."},{text:"📊 Mapping accumulation zones",duration:1300,subtext:"Identifying support levels..."},{text:"🎯 Calculating volume clusters",duration:1200,subtext:"Processing 50,000+ trades..."},{text:"✨ Activating smart money radar",duration:1100,subtext:"Deploying footprint tracker..."}],TRAP_HUNTER:[{text:"🎯 Scanning for bull/bear traps",duration:1200,subtext:"Analyzing false breakouts..."},{text:"🔍 Detecting fake-out patterns",duration:1400,subtext:"Identifying trap signatures..."},{text:"⚡ Processing trap probability",duration:1300,subtext:"Calculating 20+ parameters..."},{text:"🚨 Mapping high-risk zones",duration:1200,subtext:"Locating potential traps..."},{text:"✨ Deploying trap detection AI",duration:1100,subtext:"Activating alert system..."}],VOLCANIC:[{text:"🌋 Measuring market pressure",duration:1200,subtext:"Analyzing momentum buildup..."},{text:"📈 Detecting volcanic activity",duration:1400,subtext:"Scanning RSI extremes..."},{text:"🔥 Calculating eruption zones",duration:1300,subtext:"Processing pressure levels..."},{text:"⚡ Tracking explosive setups",duration:1200,subtext:"Identifying breakout points..."},{text:"✨ Activating volcanic pressure",duration:1100,subtext:"Deploying oscillator..."}],VOLCANIC_SIG:[{text:"💥 Detecting eruption signals",duration:1200,subtext:"Scanning breakout candles..."},{text:"🚀 Analyzing explosive moves",duration:1400,subtext:"Tracking volume spikes..."},{text:"🎯 Mapping eruption markers",duration:1300,subtext:"Calculating signal strength..."},{text:"⚡ Processing 15,000+ patterns",duration:1200,subtext:"Identifying eruption points..."},{text:"✨ Deploying eruption markers",duration:1100,subtext:"Activating signal alerts..."}]};let m=xe(V(new Set));wr(()=>{var Ie;if(!l()||!s())return;const ge=s();let ae=new Set;try{const ce=((Ie=ge.getIndicators)==null?void 0:Ie.call(ge))??[];ae=new Set(ce.map(je=>je.name)),console.log("🧠 AI Modal (open) - from chart.getIndicators:",ce)}catch(ce){console.warn("⚠️ AI Modal - getIndicators failed, falling back to saveInds",ce);const je=new Set;o()&&o().saveInds&&Object.values(o().saveInds).forEach(Ve=>{Ve&&Ve.name&&je.add(Ve.name)}),ae=je}console.log("🔄 AI Modal (open) - selectedIndicators updated:",Array.from(ae)),console.log("🔍 AI Modal (open) - saveInds keys:",Object.keys(o().saveInds||{})),x(m,V(ae))});let g=xe(!1),w=xe(null),C=xe(0),M=xe(0),P=xe(V([])),T=xe(!1);wr(()=>{!r().modalIndCfg&&i(g)&&(x(g,!1),setTimeout(()=>{l(!0)},100))}),wr(()=>{l()&&(console.log("🎯 AI Modal opened"),console.log("📊 Current saveInds:",o().saveInds),console.log("✅ AI indicators in chart:",Array.from(i(m))))});function N(){var ae,Ie,ce;if(((Ie=(ae=o().styles)==null?void 0:ae.candle)==null?void 0:Ie.type)==="renko_atr"){console.log("🔄 Converting Renko chart to Candlestick for AI indicator compatibility"),Fc(f,Ao(o).styles.candle.type="candle_solid",Ao(o)),delete o().styles.candle.renko,delete o().styles.candle._isLineChart,delete o().styles.candle.area;const je=up(o().theme);wn.merge(je,o().styles);const Ve=qd(je);return(ce=s())==null||ce.setStyles(Ve),console.log("✅ Chart converted from Renko to Candlestick"),!0}return!1}async function L(ge){x(w,V(ge)),x(C,0),x(M,0),x(P,V(h[ge]||h.SMART_MONEY));for(let ae=0;ae<i(P).length;(ae+=1)-1){x(C,V(ae));const Ie=i(P)[ae],ce=ae/i(P).length*100,je=(ae+1)/i(P).length*100,Ve=20,We=Ie.duration/Ve;for(let He=0;He<=Ve;(He+=1)-1)x(M,ce+(je-ce)*(He/Ve)),await new Promise(Ue=>setTimeout(Ue,We))}x(w,null),x(C,0),x(M,0),x(P,V([]))}function O(){var ae;const ge=(ae=a())==null?void 0:ae.data;return ge?ge.isPremium===!0||ge.isTrial===!0:!1}async function D(ge,ae){if(!O()){console.log("🔒 Premium access required for AI indicators"),x(T,!0);return}await L(ae),N();let Ie=!1;if(ae==="SMART_MONEY"){const ce="candle_pane",je=s();if(je&&je.createIndicator({name:"SMART_MONEY",calcParams:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},!0,{id:ce})){const We={name:"SMART_MONEY",pane_id:ce,params:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},He=`${ce}_SMART_MONEY`;f.update(Ue=>(Ue.saveInds[He]=We,Ue)),vv(),Np.recordAddIndicator(ae,ce,We.params,He),Ie=!0}}else if(ae==="TRAP_HUNTER"){const ce="candle_pane",je=s();if(je){const Ve=[20,20,3,5,20,1.3,7e-4,.35,.5,1,5];if(je.createIndicator({name:"TRAP_HUNTER",calcParams:Ve},!0,{id:ce})){const He={name:"TRAP_HUNTER",pane_id:ce,params:Ve},Ue=`${ce}_TRAP_HUNTER`;f.update(et=>(et.saveInds[Ue]=He,et)),vv(),Np.recordAddIndicator(ae,ce,He.params,Ue),Ie=!0}}}else if(ae==="VOLCANIC"){const ce="pane_VOLCANIC",je=s();if(je){const Ve=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(je.createIndicator({name:"VOLCANIC",calcParams:Ve},!1,{id:ce})){const He={name:"VOLCANIC",pane_id:ce,params:Ve},Ue=`${ce}_VOLCANIC`;f.update(et=>(et.saveInds[Ue]=He,et)),vv(),Np.recordAddIndicator(ae,ce,He.params,Ue),Ie=!0}}}else if(ae==="VOLCANIC_SIG"){const ce="candle_pane",je=s();if(je){const Ve=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(je.createIndicator({name:"VOLCANIC_SIG",calcParams:Ve},!0,{id:ce})){const He={name:"VOLCANIC_SIG",pane_id:ce,params:Ve},Ue=`${ce}_VOLCANIC_SIG`;f.update(et=>(et.saveInds[Ue]=He,et)),vv(),Np.recordAddIndicator(ae,ce,He.params,Ue),Ie=!0}}}Ie&&console.log(`✅ ${ae} added successfully from AI modal`)}function $(ge,ae){x(g,!0),l(!1),c.update(Ie=>(Ie.editPaneId=ge,Ie.editIndName=ae,Ie.modalIndCfg=!0,Ie))}async function z(ge,ae){if(console.log("🗑️ Deleting indicator:",{paneId:ge,name:ae}),!s()){console.log("❌ No chart available");return}const Ie=s(),ce=`${ge}_${ae}`,je=o().saveInds[ce];je&&Np.recordRemoveIndicator(ae,ge,je.params||[],ce);try{Ie.removeIndicator({paneId:ge,name:ae}),console.log("✅ Indicator removed"),f.update(Ve=>(delete Ve.saveInds[ce],Ve)),vv()}catch(Ve){console.log("❌ Error removing indicator:",Ve)}}const te=a_(),[pe,J]=te;var le=PK(),de=tn(le);Ye(de,l,ge=>{var ae=kK(),Ie=tn(ae);Ie.__click=[g5,l];var ce=v(Ie,2),je=v(y(ce),2),Ve=y(je),We=v(y(Ve),2);We.__click=[g5,l],_(Ve);var He=v(Ve,2),Ue=y(He);Ro(Ue,19,()=>d,ft=>ft.name,(ft,it)=>{var Lt=xK();const Tt=At(()=>i(m).has(i(it).name)),Pt=At(()=>i(w)===i(it).name),St=At(()=>i(it).is_main?"candle_pane":`pane_${i(it).name}`);Lt.__click=[dK,Tt,Pt,D,it];var st=y(Lt);Ye(st,()=>i(Pt),xt=>{var Je=hK(),Xe=y(Je);Ro(Xe,20,()=>Array(12),fi,(Cs,ro,bs)=>{var zt=fK();Dt(zt,"style",`--delay: ${bs*.15}s; --x: ${Math.random()*100}%; --y: ${Math.random()*100}%`),Y(Cs,zt)}),_(Xe);var Qe=v(Xe,2);Ro(Qe,20,()=>Array(8),fi,(Cs,ro,bs)=>{var zt=pK();Dt(zt,"style",`--stream-delay: ${bs*.2}s; left: ${10+bs*12}%`),Y(Cs,zt)}),_(Qe);var Mt=v(Qe,2),mt=v(y(Mt),2),Ce=y(mt),Te=y(Ce,!0);_(Ce);var It=v(Ce,2),$t=y(It,!0);_(It),_(mt);var Yt=v(mt,2),qn=y(Yt),Vn=v(qn,2);Ro(Vn,20,()=>Array(5),fi,(Cs,ro,bs)=>{var zt=mK();Ne(()=>rr(zt,"active",i(C)>=bs)),Y(Cs,zt)}),_(Vn),_(Yt);var Wn=v(Yt,2),pn=y(Wn),gn=y(pn);Ne(()=>tt(gn,`${Math.round(i(M))??""}%`)),_(pn);var Qs=v(pn,2),Is=y(Qs);_(Qs),_(Wn),_(Mt),_(Je),Ne(()=>{var Cs,ro;tt(Te,((Cs=i(P)[i(C)])==null?void 0:Cs.text)||""),tt($t,((ro=i(P)[i(C)])==null?void 0:ro.subtext)||""),Dt(qn,"style",`width: ${i(M)??""}%`),tt(Is,`Phase ${i(C)+1}/5`)}),Y(xt,Je)},xt=>{var Je=bK(),Xe=tn(Je),Be=y(Xe,!0);_(Xe);var Qe=v(Xe,2),ct=y(Qe),Mt=y(ct,!0);_(ct),_(Qe);var mt=v(Qe,2);Ye(mt,()=>i(Tt),Ce=>{var Te=_K(),It=y(Te);It.__click=[vK,$,St,it];var $t=v(It,2);$t.__click=[gK,z,St,it],_(Te),Y(Ce,Te)},Ce=>{var Te=yK();Y(Ce,Te)}),Ne(()=>{tt(Be,i(it).icon),tt(Mt,i(it).title)}),Y(xt,Je)}),_(Lt),Ne(()=>Fi(Lt,`indicator-row ${(i(Tt)?"indicator-selected":"")??""} ${(i(Pt)?"indicator-loading":"")??""} svelte-uswuii`)),Y(ft,Lt)});var et=v(Ue,2);et.__click=[wK],_(He),Di(2),_(je),_(ce),xg(3,Ie,()=>__,()=>({duration:200})),xg(3,ce,()=>vy,()=>({y:20,duration:300,easing:ww})),Y(ge,ae)});var he=v(de,2);Ye(he,()=>i(T),ge=>{var ae=IK(),Ie=tn(ae);Ie.__click=[SK,T];var ce=v(Ie,2),je=v(y(ce),2),Ve=y(je);Ve.__click=[CK,T];var We=v(Ve,10);Ne(()=>Dt(We,"href",pe("https://dutyai.app/settings/investor?device=1",void 0))),_(je),_(ce),xg(3,Ie,()=>__,()=>({duration:200})),xg(3,ce,()=>vy,()=>({y:20,duration:300,easing:ww})),Y(ge,ae)}),Y(n,le),Ed()}Tp(["click"]);var NK=Me('<span class="loading loading-spinner loading-xs"></span>'),AK=Me('<span class="text-xs">•</span>'),TK=Me('<button class="btn btn-primary btn-sm min-w-[100px] transition-all duration-200 svelte-1ib83i5" title="Save Layout Options"><!> Save <!></button>');function FK(n,e){Ld(e,!1);const t=vd(),s=vd();let o=pi(e,"savedLayouts",24,()=>[]),r=pi(e,"activeSaveId",8,null),a=pi(e,"isLoading",8,!1),l=pi(e,"hasUnsavedChanges",8,!1);const c=Hh();function f(){c("showPopup")}vm(()=>(th(r()),th(o())),()=>{x(t,r()?o().find(m=>m.id===r()):null)}),vm(()=>i(t),()=>{x(s,!!i(t))}),j0(),_v();var u=TK(),d=y(u);Ye(d,a,m=>{var g=NK();Y(m,g)},m=>{mz(m,{class:"h-4 w-4"})});var h=v(d,2);Ye(h,l,m=>{var g=AK();Y(m,g)}),_(u),Ne(()=>{u.disabled=a(),rr(u,"btn-warning",l())}),ld("click",u,f),Y(n,u),Ed()}function LK(n,e,t,s,o){n.key==="Enter"&&i(e).valid&&i(t).trim()?(n.preventDefault(),s()):n.key==="Escape"&&(n.preventDefault(),o())}var EK=Me('<div class="flex items-center gap-2 text-sm text-error"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </div>'),$K=Me('<div class="flex items-center gap-2 text-sm text-success"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Layout name is available</div>'),DK=Me('<div class="flex items-center justify-between text-sm"><span class="text-base-content/80"> </span> <span class="text-xs text-base-content/50"> </span></div>'),RK=Me('<div class="space-y-2"><h4 class="text-sm font-medium text-base-content/70"> </h4> <div class="max-h-32 overflow-y-auto space-y-1 p-3 bg-base-200/30 rounded-lg border border-base-300/50 svelte-bhlz05"></div></div>'),jK=Me('<span class="loading loading-spinner loading-sm"></span> Saving...',1),BK=Me('<div class="space-y-6"><div class="space-y-2"><label for="layout-name" class="block text-sm font-medium text-base-content">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter layout name..." class="w-full px-4 py-3 border border-base-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 bg-base-100 text-base-content placeholder-base-content/50"> <!></div> <!> <div class="flex gap-3 justify-end pt-4 border-t border-base-300/50"><button class="btn btn-ghost min-w-[100px] rounded-lg font-medium transition-all duration-200">Cancel</button> <button class="btn btn-primary min-w-[100px] rounded-lg font-medium transition-all duration-200 hover:scale-105"><!></button></div></div>');function OK(n,e){Ld(e,!1);const t=vd();let s=pi(e,"show",12,!1),o=pi(e,"savedLayouts",24,()=>[]),r=pi(e,"isLoading",8,!1),a=pi(e,"mode",8,"save"),l=pi(e,"showExisting",8,!1),c=vd(""),f=vd({valid:!0}),u=vd(!1);const d=Hh();function h(w){if(x(u,!0),!w){x(f,{valid:!1,error:"Layout name is required"}),x(u,!1);return}if(w.length<2){x(f,{valid:!1,error:"Layout name must be at least 2 characters"}),x(u,!1);return}if(w.length>50){x(f,{valid:!1,error:"Layout name must be less than 50 characters"}),x(u,!1);return}if(/[<>:"/\\|?*]/.test(w)){x(f,{valid:!1,error:"Layout name contains invalid characters"}),x(u,!1);return}if(o().some(P=>P.name.toLowerCase()===w.toLowerCase())){x(f,{valid:!1,error:"A layout with this name already exists"}),x(u,!1);return}x(f,{valid:!0}),x(u,!1)}function m(){const w=i(c).trim();i(f).valid&&w&&d("save",{name:w})}function g(){s(!1),d("cancel")}vm(()=>th(s()),()=>{s()&&(x(c,""),x(f,{valid:!0}),x(u,!1))}),vm(()=>i(c),()=>{i(c).trim()?h(i(c).trim()):x(f,{valid:!1,error:"Layout name is required"})}),vm(()=>th(a()),()=>{x(t,a()==="save"?"Save Chart Layout":"Save Layout As")}),j0(),_v(),sg(n,{get show(){return s()},set show(w){s(w)},get title(){return i(t)},width:450,buttons:[],children:(w,C)=>{var M=BK(),P=y(M),T=v(y(P),2);mn(T),T.__keydown=[LK,f,c,m,g],n3(T,!0);const N=sv(()=>!i(f).valid&&i(c).trim()),L=sv(()=>i(f).valid&&i(c).trim());var O=v(T,2);Ye(O,()=>i(c).trim()&&!i(f).valid,J=>{var le=EK(),de=v(y(le));_(le),Ne(()=>tt(de,` ${i(f).error??""}`)),Y(J,le)},J=>{var le=Yn(),de=tn(le);Ye(de,()=>i(f).valid&&i(c).trim(),he=>{var ge=$K();Y(he,ge)},null,!0),Y(J,le)}),_(P);var D=v(P,2);Ye(D,()=>l()&&o().length>0,J=>{var le=RK(),de=y(le),he=y(de);_(de);var ge=v(de,2);Ro(ge,5,o,fi,(ae,Ie)=>{var ce=DK(),je=y(ce),Ve=y(je,!0);_(je);var We=v(je,2),He=y(We,!0);Ne(()=>tt(He,new Date(i(Ie).updatedAt).toLocaleDateString())),_(We),_(ce),Ne(()=>tt(Ve,i(Ie).name)),Y(ae,ce)}),_(ge),_(le),Ne(()=>tt(he,`Existing Layouts (${o().length??""})`)),Y(J,le)});var $=v(D,2),z=y($);z.__click=g;var te=v(z,2);te.__click=m,Ne(()=>te.disabled=!i(f).valid||!i(c).trim()||r()||i(u));var pe=y(te);Ye(pe,r,J=>{var le=jK();Di(),Y(J,le)},J=>{var le=G0("Save Layout");Y(J,le)}),_(te),_($),_(M),Ne(()=>{T.disabled=r(),rr(T,"border-error",i(N)),rr(T,"border-success",i(L)),z.disabled=r()}),As(T,()=>i(c),J=>x(c,J)),Y(w,M)},$$slots:{default:!0},$$legacy:!0}),Ed()}Tp(["keydown","click"]);var zK=Me('<span class="loading loading-spinner loading-xs"></span>'),VK=Me('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path></svg>'),WK=Me('<span class="text-xs text-warning">• Unsaved changes</span>'),HK=Me('<div class="p-4 bg-primary/5 border-b border-base-300/50"><div class="flex items-center gap-2 text-sm"><div class="w-2 h-2 bg-primary rounded-full"></div> <span class="font-medium text-base-content"> </span> <!></div> <div class="text-xs text-base-content/60 mt-1"> </div></div>'),qK=Me('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),UK=Me('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),GK=Me('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),YK=Me('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),KK=Me('<div class="max-h-48 overflow-y-auto svelte-10s4pck"><!></div>'),XK=Me('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Save Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 border-b border-base-300/50"><div class="space-y-2"><button class="w-full flex items-center gap-3 px-4 py-3 text-sm bg-primary text-primary-content hover:bg-primary/90 rounded-md transition-colors duration-150"><!> </button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> Save As...</button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> New Layout</button></div></div> <!> <!></div>',1);function ZK(n,e){Ld(e,!1);const t=vd(),s=vd();let o=pi(e,"show",12,!1),r=pi(e,"savedLayouts",24,()=>[]),a=pi(e,"activeSaveId",8,null),l=pi(e,"isLoading",8,!1),c=pi(e,"hasUnsavedChanges",8,!1),f=pi(e,"position",24,()=>({x:0,y:0})),u=pi(e,"showLayouts",8,!0),d=vd();const h=Hh();function m(z){i(d)&&!i(d).contains(z.target)&&w()}function g(z){z.key==="Escape"&&w()}Mh(()=>{console.log("🎯 ChartSavePopup mounted with props:",{show:o(),savedLayouts:r(),activeSaveId:a(),isLoading:l(),hasUnsavedChanges:c(),position:f()}),o()&&(document.addEventListener("click",m),document.addEventListener("keydown",g))}),b0(()=>{document.removeEventListener("click",m),document.removeEventListener("keydown",g)});function w(){o(!1),h("close")}function C(){i(s)?h("quickSave"):(h("save"),w())}function M(){h("saveAs"),w()}function P(){h("newLayout"),w()}function T(z){h("load",{layoutId:z}),w()}function N(z,te){z.stopPropagation(),h("delete",{layoutId:te})}function L(z){return new Date(z).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function O(){const pe=document.querySelector(".chart-container")||document.querySelector(".duty-widget");if(!pe)return`left: ${f().x}px; top: ${f().y}px;`;const J=pe.getBoundingClientRect();let le=J.left+J.width/2-320/2,de=J.top+J.height/2-400/2;return le=Math.max(20,Math.min(le,window.innerWidth-320-20)),de=Math.max(20,Math.min(de,window.innerHeight-400-20)),`left: ${le}px; top: ${de}px;`}vm(()=>(th(a()),th(r())),()=>{x(t,a()?r().find(z=>z.id===a()):null)}),vm(()=>i(t),()=>{x(s,!!i(t))}),vm(()=>(th(o()),th(r()),th(a()),i(t),i(s)),()=>{var z;o()&&console.log("🔄 ChartSavePopup reactive update (visible):",{show:o(),savedLayouts:((z=r())==null?void 0:z.length)||0,savedLayoutsData:r(),activeSaveId:a(),activeLayout:i(t),hasActiveSave:i(s)})}),vm(()=>th(o()),()=>{o()?setTimeout(()=>{document.addEventListener("click",m),document.addEventListener("keydown",g)},0):(document.removeEventListener("click",m),document.removeEventListener("keydown",g))}),j0(),_v();var D=Yn(),$=tn(D);Ye($,o,z=>{var te=XK(),pe=tn(te),J=v(pe,2);const le=sv(O);var de=y(J),he=v(y(de),2);_(de);var ge=v(de,2),ae=y(ge),Ie=y(ae),ce=y(Ie);Ye(ce,l,et=>{var ft=zK();Y(et,ft)},et=>{var ft=VK();Y(et,ft)});var je=v(ce);_(Ie);var Ve=v(Ie,2),We=v(Ve,2);_(ae),_(ge);var He=v(ge,2);Ye(He,()=>i(t),et=>{var ft=HK(),it=y(ft),Lt=v(y(it),2),Tt=y(Lt);_(Lt);var Pt=v(Lt,2);Ye(Pt,c,xt=>{var Je=WK();Y(xt,Je)}),_(it);var St=v(it,2),st=y(St);Ne(()=>tt(st,`Last saved: ${L(new Date(i(t).updatedAt).getTime())??""}`)),_(St),_(ft),Ne(()=>tt(Tt,`Active: ${i(t).name??""}`)),Y(et,ft)});var Ue=v(He,2);Ye(Ue,u,et=>{var ft=KK(),it=y(ft);Ye(it,()=>r().length===0,Lt=>{var Tt=qK();Y(Lt,Tt)},Lt=>{var Tt=YK(),Pt=y(Tt),St=y(Pt);_(Pt);var st=v(Pt,2);Ro(st,5,r,fi,(xt,Je)=>{var Xe=GK(),Be=y(Xe),Qe=y(Be),ct=y(Qe),Mt=y(ct,!0);_(ct);var mt=v(ct,2);Ye(mt,()=>i(Je).id===a(),$t=>{var Yt=UK();Y($t,Yt)}),_(Qe);var Ce=v(Qe,2),Te=y(Ce,!0);Ne(()=>tt(Te,L(new Date(i(Je).updatedAt).getTime()))),_(Ce),_(Be);var It=v(Be,2);_(Xe),Ne(()=>{Fi(Xe,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(i(Je).id===a()?"bg-primary/10":"")??""}`),tt(Mt,i(Je).name)}),ld("click",It,$t=>N($t,i(Je).id)),ld("click",Xe,()=>T(i(Je).id)),Y(xt,Xe)}),_(st),_(Tt),Ne(()=>tt(St,`Saved Layouts (${r().length??""})`)),Y(Lt,Tt)}),_(ft),Y(et,ft)}),_(J),ep(J,et=>x(d,et),()=>i(d)),Ne(()=>{Dt(J,"style",i(le)),Ie.disabled=l(),tt(je,` ${(i(s)?"Save to Current Layout":"Save New Layout")??""}`)}),ld("click",pe,w),ld("click",he,w),ld("click",Ie,C),ld("click",Ve,M),ld("click",We,P),Y(z,te)}),Y(n,D),Ed()}var JK=Me('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),QK=Me('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),eX=Me('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),tX=Me('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),nX=Me('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),sX=Me('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Load Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="max-h-80 overflow-y-auto svelte-ciowbr"><!></div></div>',1);function oX(n,e){Ld(e,!1);let t=pi(e,"show",12,!1),s=pi(e,"savedLayouts",24,()=>[]),o=pi(e,"activeSaveId",8,null),r=pi(e,"isLoading",8,!1),a=pi(e,"position",24,()=>({x:0,y:0})),l=vd();const c=Hh();function f(T){i(l)&&!i(l).contains(T.target)&&d()}function u(T){T.key==="Escape"&&d()}Mh(()=>{t()&&(document.addEventListener("click",f),document.addEventListener("keydown",u))}),b0(()=>{document.removeEventListener("click",f),document.removeEventListener("keydown",u)});function d(){t(!1),c("close")}function h(T){c("load",{layoutId:T}),d()}function m(T){T!==o()&&h(T)}function g(T,N){T.stopPropagation(),c("delete",{layoutId:N})}function w(T){return new Date(T).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function C(){const L=document.querySelector(".chart-container")||document.querySelector(".duty-widget");if(!L)return`left: ${a().x}px; top: ${a().y}px;`;const O=L.getBoundingClientRect();let D=O.left+O.width/2-320/2,$=O.top+O.height/2-400/2;return D=Math.max(20,Math.min(D,window.innerWidth-320-20)),$=Math.max(20,Math.min($,window.innerHeight-400-20)),`left: ${D}px; top: ${$}px;`}vm(()=>th(t()),()=>{t()?setTimeout(()=>{document.addEventListener("click",f),document.addEventListener("keydown",u)},0):(document.removeEventListener("click",f),document.removeEventListener("keydown",u))}),j0(),_v();var M=Yn(),P=tn(M);Ye(P,t,T=>{var N=sX(),L=tn(N),O=v(L,2);const D=sv(C);var $=y(O),z=v(y($),2);_($);var te=v($,2),pe=y(te);Ye(pe,r,J=>{var le=JK();Y(J,le)},J=>{var le=Yn(),de=tn(le);Ye(de,()=>s().length===0,he=>{var ge=QK();Y(he,ge)},he=>{var ge=nX(),ae=y(ge),Ie=y(ae);_(ae);var ce=v(ae,2);Ro(ce,5,s,fi,(je,Ve)=>{var We=tX(),He=y(We),Ue=y(He),et=y(Ue),ft=y(et,!0);_(et);var it=v(et,2);Ye(it,()=>i(Ve).id===o(),St=>{var st=eX();Y(St,st)}),_(Ue);var Lt=v(Ue,2),Tt=y(Lt,!0);Ne(()=>tt(Tt,w(new Date(i(Ve).updatedAt).getTime()))),_(Lt),_(He);var Pt=v(He,2);_(We),Ne(()=>{Fi(We,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(i(Ve).id===o()?"bg-primary/10":"")??""}`),tt(ft,i(Ve).name)}),ld("click",Pt,St=>g(St,i(Ve).id)),ld("click",We,()=>m(i(Ve).id)),Y(je,We)}),_(ce),_(ge),Ne(()=>tt(Ie,`Saved Layouts (${s().length??""})`)),Y(he,ge)},!0),Y(J,le)}),_(te),_(O),ep(O,J=>x(l,J),()=>i(l)),Ne(()=>Dt(O,"style",i(D))),ld("click",L,d),ld("click",z,d),Y(T,N)}),Y(n,M),Ed()}function iX(n,e,t){i(e)?(console.log("💾 SaveAsSelectModal dispatching saveTo event with layoutId:",i(e)),t("saveTo",{layoutId:i(e)})):console.log("❌ SaveAsSelectModal: No layout selected")}function rX(n,e){e("back")}function aX(n,e){e("cancel")}var lX=Me('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),cX=Me('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts found.</div>'),uX=Me('<label class="flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-base-200"><input type="radio" name="save-as-target" class="radio radio-primary"> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-base-content truncate"> </div> <div class="text-xs text-base-content/60"> </div></div></label>'),dX=Me('<span class="loading loading-spinner loading-xs"></span> Saving...',1),fX=Me('<div class="space-y-4"><div class="flex items-center justify-between"><button class="btn btn-ghost btn-sm" title="Back">← Back</button> <div></div></div> <div class="text-sm text-base-content/70">Select a saved layout to overwrite with the current chart.</div> <div class="max-h-80 overflow-y-auto divide-y divide-base-300/50 rounded-lg border border-base-300/50 svelte-1a3gcnl"><!></div> <div class="flex justify-end gap-3 pt-2"><button class="btn btn-ghost">Cancel</button> <button class="btn btn-primary"><!></button></div></div>');function pX(n,e){Ld(e,!1);const t=[];let s=pi(e,"show",12,!1),o=pi(e,"savedLayouts",24,()=>[]),r=pi(e,"isLoading",8,!1),a=vd(null);const l=Hh();vm(()=>th(s()),()=>{s()&&x(a,null)}),j0(),_v(),sg(n,{get show(){return s()},set show(c){s(c)},title:"Save As: Choose Layout to Overwrite",width:520,buttons:[],children:(c,f)=>{var u=fX(),d=y(u),h=y(d);h.__click=[rX,l],Di(2),_(d);var m=v(d,4),g=y(m);Ye(g,r,T=>{var N=lX();Y(T,N)},T=>{var N=Yn(),L=tn(N);Ye(L,()=>o().length===0,O=>{var D=cX();Y(O,D)},O=>{var D=Yn(),$=tn(D);Ro($,1,o,fi,(z,te)=>{var pe=uX(),J=y(pe);mn(J);var le,de=v(J,2),he=y(de),ge=y(he,!0);_(he);var ae=v(he,2),Ie=y(ae,!0);Ne(()=>tt(Ie,new Date(i(te).updatedAt).toLocaleString())),_(ae),_(de),_(pe),Ne(()=>{le!==(le=i(te).id)&&(J.value=(J.__value=i(te).id)==null?"":i(te).id),tt(ge,i(te).name)}),VC(t,[],J,()=>(i(te).id,i(a)),ce=>x(a,ce)),Y(z,pe)}),Y(O,D)},!0),Y(T,N)}),_(m);var w=v(m,2),C=y(w);C.__click=[aX,l];var M=v(C,2);M.__click=[iX,a,l];var P=y(M);Ye(P,r,T=>{var N=dX();Di(),Y(T,N)},T=>{var N=G0("Save");Y(T,N)}),_(M),_(w),_(u),Ne(()=>{C.disabled=r(),M.disabled=!i(a)||r()}),Y(c,u)},$$slots:{default:!0},$$legacy:!0}),Ed()}Tp(["click"]);function mX(n,e,t,s,o,r,a,l,c){if(!e()){x(t,!0);return}c8(s().symbol),x(r,"normal"),x(a,""),l(),x(c,"date")}function hX(n,e,t,s,o,r,a){if(!e()){x(t,!0);return}c8(s().symbol),x(r,"strategy"),x(a,"deposit")}function vX(n,e,t,s,o,r){if(!e()){x(t,!0),x(s,"choose");return}u8(i(o)),d8(Math.max(0,Number(i(r))||0)),x(s,"leverage")}function _5(n,e,t,s,o,r,a,l,c){if(!e()){x(t,!0),x(s,"choose");return}f8(i(o)?i(r)||100:null),p8(!0),x(a,"strategy"),x(l,""),c(),x(s,"date")}function gX(n,e,t,s,o,r){if(!e()){x(t,!0),x(s,"choose");return}const a=o();a&&(m8(a.fromMs,a.toMs),r())}function _X(n,e,t,s,o,r,a){if(!e()){x(t,!0),x(s,"choose");return}if(WO(),i(o)==="normal"){w2("normal"),Xv(!0),r(!1),a("close");try{window.predictNextCandle&&window.predictNextCandle()}catch{}return}if(i(o)==="strategy"){w2("strategy"),r(!1),a("close");const l=window.sidebarHostRef;l&&l.openSidebar&&l.openSidebar()}}function yX(n,e,t,s){x(e,""),i(t)==="strategy"?x(s,"leverage"):x(s,"choose")}var bX=Me('<div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-stretch svelte-1w86s5a"><div class="card lux-card shadow overflow-hidden h-full svelte-1w86s5a"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-1w86s5a"><div class="flex items-center gap-2 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Normal Price Simulator</div></div> <div class="text-xs opacity-70 mt-1 svelte-1w86s5a">Auto-play historical candles to simulate price movement.</div> <div class="mt-auto pt-3 svelte-1w86s5a"><button class="btn btn-premium-primary w-full svelte-1w86s5a" type="button">Start Normal Mode</button></div></div></div> <div class="card lux-card shadow overflow-hidden h-full svelte-1w86s5a"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-1w86s5a"><div class="flex items-center gap-2 svelte-1w86s5a"><div class="p-2 rounded-full bg-base-300/60 svelte-1w86s5a"><!></div> <div class="text-sm font-semibold svelte-1w86s5a">Trade Strategy Test</div></div> <div class="text-xs opacity-70 mt-1 svelte-1w86s5a">Deposit, set leverage, buy/pending orders, and track portfolio & PnL.</div> <div class="mt-auto pt-3 svelte-1w86s5a"><button class="btn btn-premium-outline w-full svelte-1w86s5a" type="button">Start Strategy Mode</button></div></div></div></div>'),xX=(n,e)=>x(e,"choose"),wX=Me('<option class="svelte-1w86s5a"> </option>'),kX=Me('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Confirm Deposit</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-end svelte-1w86s5a"><div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">Currency</div> <select class="select select-bordered select-sm svelte-1w86s5a"></select></div> <input class="input input-bordered input-sm svelte-1w86s5a" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm Deposit</button></div></div></div>'),SX=(n,e)=>x(e,"deposit"),CX=(n,e)=>x(e,!0),IX=(n,e)=>x(e,!1),PX=Me('<div class="mt-2 flex items-center gap-2 svelte-1w86s5a"><select class="select select-bordered select-sm svelte-1w86s5a"><option class="svelte-1w86s5a">1:50</option><option class="svelte-1w86s5a">1:100</option><option class="svelte-1w86s5a">1:200</option><option class="svelte-1w86s5a">1:400</option><option class="svelte-1w86s5a">1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm</button></div>'),MX=Me('<div class="mt-2 svelte-1w86s5a"><button class="btn btn-sm btn-premium-outline svelte-1w86s5a" type="button">Confirm</button></div>'),NX=Me('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Take leverage?</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-2 flex items-center gap-2 svelte-1w86s5a"><label class="label cursor-pointer svelte-1w86s5a"><input type="radio" name="lev-modal" class="radio radio-sm svelte-1w86s5a"> <span class="label-text ml-2 svelte-1w86s5a">Yes</span></label> <label class="label cursor-pointer svelte-1w86s5a"><input type="radio" name="lev-modal" class="radio radio-sm svelte-1w86s5a"> <span class="label-text ml-2 svelte-1w86s5a">No</span></label></div> <!></div></div>'),AX=Me('<div class="text-xs text-error mt-2 svelte-1w86s5a"> </div>'),TX=Me('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Select Simulation Range</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-end svelte-1w86s5a"><div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">From</div> <input class="input input-bordered input-sm svelte-1w86s5a" type="date"></div> <div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">To</div> <input class="input input-bordered input-sm svelte-1w86s5a" type="date"></div> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm Range</button></div> <!> <div class="mt-3 svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Skip Date Filter</button></div></div></div>'),FX=Me('<div class="p-3 space-y-3 svelte-1w86s5a"><!></div>'),LX=(n,e)=>x(e,!1),EX=(n,e)=>x(e,!1),$X=Me('<div class="premium-modal-backdrop svelte-1w86s5a" role="presentation"></div> <div class="premium-modal-container svelte-1w86s5a" role="dialog" aria-modal="true" aria-labelledby="sim-premium-title"><div class="premium-background svelte-1w86s5a"><div class="premium-orb premium-orb-1 svelte-1w86s5a"></div> <div class="premium-orb premium-orb-2 svelte-1w86s5a"></div></div> <div class="premium-content svelte-1w86s5a"><button class="premium-close-btn svelte-1w86s5a" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><line x1="18" y1="6" x2="6" y2="18" class="svelte-1w86s5a"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-1w86s5a"></line></svg></button> <div class="premium-icon-wrapper svelte-1w86s5a"><div class="premium-icon svelte-1w86s5a"><!> <div class="premium-icon-glow svelte-1w86s5a"></div></div></div> <h2 id="sim-premium-title" class="premium-title svelte-1w86s5a">Premium Feature</h2> <p class="premium-message svelte-1w86s5a">Simulator Normal + Strategy modes are AI Pro exclusives. Unlock them to stress-test setups, fast-forward price action, and train with live-like executions.</p> <div class="premium-features svelte-1w86s5a"><div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Lightning-fast Normal Simulator</span></div> <div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Strategy Mode with deposits, leverage, and PnL</span></div> <div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Priority AI signals & future pro drops</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-1w86s5a"><span class="svelte-1w86s5a">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><line x1="5" y1="12" x2="19" y2="12" class="svelte-1w86s5a"></line><polyline points="12 5 19 12 12 19" class="svelte-1w86s5a"></polyline></svg></a></div></div>',1),DX=Me("<!> <!>",1);function RX(n,e){Ld(e,!0);const t=tm(),s=()=>vl(w,"$save",t),o=()=>vl(B0,"$userPreferences",t);let r=pi(e,"show",15),a=xe("choose"),l=xe(1e5),c=xe(!1),f=xe(null),u=xe(!1),d=xe(null),h=xe(""),m=xe(""),g=xe("");const w=cd("save");let C=xe(V(s().symbol.priceCurrency||"USD"));wr(()=>{r()&&(x(a,"choose"),x(d,null),x(g,""))});const M=Hh();function P(le){le==="close"&&M("close")}function T(){var de;const le=(de=o())==null?void 0:de.data;return(le==null?void 0:le.isPremium)===!0||(le==null?void 0:le.isTrial)===!0}function N(){if(i(h)&&i(m))return;const le=new Date,de=le.toISOString().slice(0,10),ge=new Date(le.getTime()-30*24*60*60*1e3).toISOString().slice(0,10);x(h,V(ge)),x(m,V(de))}function L(){if(x(g,""),!i(h)||!i(m))return x(g,"Please select a start and end date."),null;const le=new Date(i(h)),de=new Date(i(m));if(isNaN(le.getTime())||isNaN(de.getTime()))return x(g,"Invalid date range."),null;le.setHours(0,0,0,0),de.setHours(23,59,59,999);const he=le.getTime(),ge=de.getTime();return!Number.isFinite(he)||!Number.isFinite(ge)||he>ge?(x(g,"Start date must be before end date."),null):{fromMs:he,toMs:ge}}function O(){if(i(d)==="normal")w2("normal"),Xv(!1);else if(i(d)==="strategy"){w2("strategy"),Xv(!1);const le=window.sidebarHostRef;le&&le.openSidebar&&le.openSidebar()}r(!1),M("close")}const D=a_(),[$,z]=D;var te=DX(),pe=tn(te);sg(pe,{get show(){return r()},set show(le){r(le)},title:"Choose Simulator Mode",buttons:[],click:P,get theme(){return s().theme},children:(le,de)=>{var he=FX(),ge=y(he);Ye(ge,()=>i(a)==="choose",ae=>{var Ie=bX(),ce=y(Ie),je=y(ce),Ve=v(y(je),4),We=y(Ve);We.__click=[mX,T,u,s,w,d,g,N,a],_(Ve),_(je),_(ce);var He=v(ce,2),Ue=y(He),et=y(Ue),ft=y(et),it=y(ft);rz(it,{size:18}),_(ft),Di(2),_(et);var Lt=v(et,4),Tt=y(Lt);Tt.__click=[hX,T,u,s,w,d,a],_(Lt),_(Ue),_(He),_(Ie),Y(ae,Ie)},ae=>{var Ie=Yn(),ce=tn(Ie);Ye(ce,()=>i(a)==="deposit",je=>{var Ve=kX(),We=y(Ve),He=v(y(We),2),Ue=y(He);Ue.__click=[xX,a],_(He);var et=v(He,2),ft=y(et),it=v(y(ft),2);Ro(it,21,()=>g8,fi,(Pt,St)=>{var st=wX(),xt={},Je=y(st,!0);_(st),Ne(()=>{xt!==(xt=i(St))&&(st.value=(st.__value=i(St))==null?"":i(St)),tt(Je,i(St))}),Y(Pt,st)}),_(it),_(ft);var Lt=v(ft,2);mn(Lt);var Tt=v(Lt,2);Tt.__click=[vX,T,u,a,C,l],_(et),_(We),_(Ve),po(it,()=>i(C),Pt=>x(C,Pt)),As(Lt,()=>i(l),Pt=>x(l,Pt)),Y(je,Ve)},je=>{var Ve=Yn(),We=tn(Ve);Ye(We,()=>i(a)==="leverage",He=>{var Ue=NX(),et=y(Ue),ft=v(y(et),2),it=y(ft);it.__click=[SX,a],_(ft);var Lt=v(ft,2),Tt=y(Lt),Pt=y(Tt);mn(Pt),Pt.__click=[CX,c],Di(2),_(Tt);var St=v(Tt,2),st=y(St);mn(st),st.__click=[IX,c],Di(2),_(St),_(Lt);var xt=v(Lt,2);Ye(xt,()=>i(c),Je=>{var Xe=PX(),Be=y(Xe),Qe=y(Be);Qe.value=(Qe.__value=50)==null?"":50;var ct=v(Qe);ct.value=(ct.__value=100)==null?"":100;var Mt=v(ct);Mt.value=(Mt.__value=200)==null?"":200;var mt=v(Mt);mt.value=(mt.__value=400)==null?"":400;var Ce=v(mt);Ce.value=(Ce.__value=500)==null?"":500,_(Be);var Te=v(Be,2);Te.__click=[_5,T,u,a,c,f,d,g,N],_(Xe),po(Be,()=>i(f),It=>x(f,It)),Y(Je,Xe)},Je=>{var Xe=MX(),Be=y(Xe);Be.__click=[_5,T,u,a,c,f,d,g,N],_(Xe),Y(Je,Xe)}),_(et),_(Ue),Ne(()=>{Av(Pt,i(c)),Av(st,!i(c))}),Y(He,Ue)},He=>{var Ue=TX(),et=y(Ue),ft=v(y(et),2),it=y(ft);it.__click=[yX,g,d,a],_(ft);var Lt=v(ft,2),Tt=y(Lt),Pt=v(y(Tt),2);mn(Pt),_(Tt);var St=v(Tt,2),st=v(y(St),2);mn(st),_(St);var xt=v(St,2);xt.__click=[gX,T,u,a,L,O],_(Lt);var Je=v(Lt,2);Ye(Je,()=>i(g),Qe=>{var ct=AX(),Mt=y(ct,!0);_(ct),Ne(()=>tt(Mt,i(g))),Y(Qe,ct)});var Xe=v(Je,2),Be=y(Xe);Be.__click=[_X,T,u,a,d,r,M],_(Xe),_(et),_(Ue),As(Pt,()=>i(h),Qe=>x(h,Qe)),As(st,()=>i(m),Qe=>x(m,Qe)),Y(He,Ue)},!0),Y(je,Ve)},!0),Y(ae,Ie)}),_(he),Y(le,he)},$$slots:{default:!0}});var J=v(pe,2);Ye(J,()=>i(u),le=>{var de=$X(),he=tn(de);he.__click=[LX,u];var ge=v(he,2),ae=v(y(ge),2),Ie=y(ae);Ie.__click=[EX,u];var ce=v(Ie,2),je=y(ce),Ve=y(je);ez(Ve,{size:34}),Di(2),_(je),_(ce);var We=v(ce,8);Ne(()=>Dt(We,"href",$("https://dutyai.app/settings/investor?device=1",void 0))),_(ae),_(ge),xg(3,he,()=>__,()=>({duration:200})),xg(3,ge,()=>vy,()=>({y:18,duration:260})),Y(le,de)}),Y(n,te),Ed()}Tp(["click"]);var jX=Me('<div class="toast svelte-66mo1o"><span class="toast-message svelte-66mo1o"> </span></div>');function R8(n,e){Ld(e,!1);let t=pi(e,"message",8,""),s=pi(e,"duration",8,3e3),o=pi(e,"visible",12,!1);const r=Hh();let a=vd();Mh(()=>{o()&&l()});function l(){o(!0),setTimeout(()=>{c()},s())}function c(){o(!1),r("hide")}_v();var f=Yn(),u=tn(f);return Ye(u,o,d=>{var h=jX(),m=y(h),g=y(m,!0);_(m),_(h),ep(h,w=>x(a,w),()=>i(a)),Ne(()=>{rr(h,"show",o()),tt(g,t())}),Y(d,h)}),Y(n,f),L6(e,"showToast",l),L6(e,"hideToast",c),Ed({showToast:l,hideToast:c})}function BX(n,e,t,s,o,r,a){const l=e().theme==="dark"?"light":"dark";if(s()){x(o,V(l)),x(r,!0);return}a(l,!0)}function OX(n,e,t,s){i(e)&&(t(i(e),!0),x(s,!1),x(e,null))}function zX(n,e,t,s){i(e)&&(t(i(e),!1),x(s,!1),x(e,null))}function VX(n,e,t,s,o,r,a,l){const c=n.target;if(!c.files||!c.files.length)return;const f=c.files[0],u=f.name.split(".").shift()||"Unknown";SW.parse(f,{skipEmptyLines:!0,complete:d=>{var m;const h=d.data.map(g=>({timestamp:parseInt(g[0]),open:parseFloat(g[1]),high:parseFloat(g[2]),low:parseFloat(g[3]),close:parseFloat(g[4]),volume:parseFloat(g[5])}));if(x(e,V(u)),h.length>1){const g=h.length-1,w=Math.min(h[1].timestamp-h[0].timestamp,h[g].timestamp-h[g-1].timestamp);Fc(s,Ao(t).period=yg(sP(w/1e3)),Ao(t))}h.length>0&&_B(Math.min(h[0].low,h[h.length-1].low))+3,(m=o())==null||m.applyNewData(h,!1),Fc(l,Ao(a).loadingDuty=!1,Ao(a)),Fc(l,Ao(a).dutyLoaded+=1,Ao(a))}})}function WX(n,e,t,s,o,r){const a=!i(e);x(e,a);try{sessionStorage.setItem("drawbarShown",String(a))}catch{}try{const l=t();l&&l.style.setProperty("--drawing-bar-width",a?"52px":"0px");const c=typeof document<"u"?document.querySelector(".duty-main"):null;c&&c.style.setProperty("--drawing-bar-width",a?"52px":"0px");const f=typeof document<"u"?document.querySelector(".drawbar-host"):null;f&&(f.style.width=a?"52px":"0px",f.style.overflow="hidden");const u=typeof document<"u"?document.querySelector(".drawbar-container"):null;u&&a&&(u.style.borderRightWidth="2px",u.style.borderRightStyle="solid",u.style.borderRightColor="var(--menu-border)");const d=typeof document<"u"?document.querySelector(".drawbar-wrapper"):null;d&&a&&(d.style.display="")}catch{}requestAnimationFrame(()=>{var l;s(),(l=o())==null||l.resize()})}async function HX(n,e,t,s,o,r,a,l,c,f,u,d){if(!i(e)){x(e,!0);try{if(i(t))if(s())try{f();let h=!1;if(document.webkitExitFullscreen)try{document.webkitExitFullscreen(),h=!0}catch(m){console.log("webkitExitFullscreen failed:",m)}if(window.iosFullscreenCleanup)try{window.iosFullscreenCleanup(),delete window.iosFullscreenCleanup,h=!0}catch(m){console.log("iOS cleanup function failed:",m)}if(!h)try{document.body.classList.remove("ios-fullscreen");const m=document.getElementById("ios-fullscreen-style");m&&m.remove();const g=document.querySelector('meta[name="viewport"]');g&&g.setAttribute("content","width=device-width, initial-scale=1.0")}catch(m){console.log("Manual iOS cleanup failed:",m)}x(t,!1),x(u,!1),setTimeout(()=>{a()&&a().resize(),setTimeout(()=>{x(e,!1)},50)},150)}catch(h){console.log("iOS exit rotation failed:",h),x(t,!1),x(u,!1),x(e,!1)}else{try{"screen"in window&&"orientation"in window.screen&&"unlock"in window.screen.orientation&&window.screen.orientation.unlock()}catch(h){console.log("Screen orientation unlock failed:",h)}await d(),x(t,!1),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{x(e,!1)},50)},150):setTimeout(()=>{x(e,!1)},50)}else if(s())try{await o(),window.DeviceOrientationEvent&&r(),x(t,!0),setTimeout(()=>{window.scrollTo(0,1),setTimeout(()=>{window.scrollTo(0,0),a()&&a().resize(),setTimeout(()=>{x(e,!1)},50)},50)},100)}catch(h){console.log("iOS rotation setup failed:",h),x(t,!0),x(e,!1)}else await c(),setTimeout(async()=>{try{"screen"in window&&"orientation"in window.screen&&"lock"in window.screen.orientation?await window.screen.orientation.lock("landscape"):console.log("Screen Orientation API not supported. Please rotate your device manually.")}catch(h){console.log("Screen orientation lock failed:",h)}x(t,!0),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{x(e,!1)},50)},100):setTimeout(()=>{x(e,!1)},50)},50)}catch(h){console.error("Rotation failed:",h),x(t,!1),x(e,!1)}}}var qX=Me('<div class="save-overlay svelte-b1tvfj"><div class="save-success svelte-b1tvfj">Saved to current layout</div></div>'),UX=(n,e)=>{var t;return(t=i(e))==null?void 0:t.click()},GX=Me('<div class="custom-load-section svelte-b1tvfj"><input type="file" class="hidden svelte-b1tvfj" accept="text/csv"> <button class="custom-load-btn svelte-b1tvfj"><span class="custom-load-text svelte-b1tvfj">打开</span> <div class="custom-load-glow svelte-b1tvfj"></div></button></div>'),YX=Me('<div class="rotate-loading-overlay svelte-b1tvfj"><div class="rotate-loading-spinner svelte-b1tvfj"><div class="rotate-spinner-ring svelte-b1tvfj"></div> <div class="rotate-spinner-ring svelte-b1tvfj"></div> <div class="rotate-spinner-ring svelte-b1tvfj"></div></div> <div class="rotate-loading-text svelte-b1tvfj">Rotating...</div></div>'),KX=ta('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-b1tvfj"></path>',1),XX=ta('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-b1tvfj"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-b1tvfj"></path>',1),ZX=(n,e)=>x(e,!0),JX=(n,e,t)=>e(i(t)),QX=Me('<button><span class="timeframe-text svelte-b1tvfj"> </span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),eZ=(n,e,t)=>e(t[0]),tZ=Me('<button><span class="timeframe-text svelte-b1tvfj">4h</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),nZ=(n,e,t)=>e(i(t)),sZ=Me('<button><span class="timeframe-text svelte-b1tvfj"> </span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),oZ=Me('<div class="timeframe-group desktop-only svelte-b1tvfj"><!> <!> <!></div>'),iZ=(n,e,t)=>e(t.find(s=>s.timeframe==="1d")),rZ=Me('<button><span class="timeframe-text svelte-b1tvfj">1d</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),aZ=(n,e,t)=>e(t.find(s=>s.timeframe==="1w")),lZ=Me('<button><span class="timeframe-text svelte-b1tvfj">1w</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),cZ=(n,e)=>x(e,!i(e)),uZ=(n,e,t)=>e(i(t)),dZ=Me('<button><span class="timeframe-text svelte-b1tvfj"> </span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),fZ=(n,e,t)=>e(t[0]),pZ=Me('<button><span class="timeframe-text svelte-b1tvfj">4h</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),mZ=(n,e,t)=>e(t.find(s=>s.timeframe==="1M")),hZ=Me('<button><span class="timeframe-text svelte-b1tvfj">1M</span> <div class="timeframe-glow svelte-b1tvfj"></div></button>'),vZ=Me('<div class="timeframe-inline-expand svelte-b1tvfj"><!> <!> <!></div>'),gZ=Me('<div class="timeframe-group mobile-only svelte-b1tvfj"><!> <!> <button aria-label="More timeframes" title="More"><span class="timeframe-text svelte-b1tvfj">⋯</span> <div class="timeframe-glow svelte-b1tvfj"></div></button> <!></div>'),_Z=(n,e)=>x(e,!0),yZ=(n,e)=>x(e,!0),bZ=(n,e)=>x(e,!0),xZ=(n,e)=>x(e,!0),wZ=Me('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Play" type="button"><!></button>'),kZ=Me('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" disabled title="Simulator active" type="button"><!></button>'),SZ=(n,e)=>x(e,!0),CZ=(n,e)=>x(e,!0),IZ=(n,e,t)=>{e("🖱️ Fullscreen button clicked!"),t()},PZ=(n,e)=>e(n),MZ=(n,e)=>e(n),NZ=n=>{n.preventDefault(),n.stopPropagation()},AZ=(n,e)=>e(n),TZ=Me('<button title="Scroll to see more" aria-label="Scroll right" type="button"><span class="arrow-icon svelte-b1tvfj"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="9 18 15 12 9 6" class="svelte-b1tvfj"></polyline></svg></span></button>'),FZ=Me(`<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 svelte-b1tvfj" role="dialog" aria-modal="true"><div class="bg-base-100 rounded-lg shadow-xl p-6 w-full max-w-md svelte-b1tvfj"><div class="text-base-content text-lg font-semibold mb-2 svelte-b1tvfj">Switch chart template theme?</div> <div class="text-base-content/80 text-sm mb-5 svelte-b1tvfj"> <br class="svelte-b1tvfj"> Would you like to switch the chart template's theme too?</div> <div class="flex justify-end gap-2 svelte-b1tvfj"><button class="btn btn-sm svelte-b1tvfj" type="button">No</button> <button class="btn btn-sm btn-primary svelte-b1tvfj" type="button">Yes</button></div></div></div>`),LZ=(n,e)=>x(e,!1),EZ=(n,e)=>x(e,!1),$Z=Me('<div class="premium-modal-backdrop svelte-b1tvfj" role="presentation"></div> <div class="premium-modal-container svelte-b1tvfj" role="dialog" aria-modal="true" aria-labelledby="renko-premium-title"><div class="premium-background svelte-b1tvfj"><div class="premium-orb premium-orb-1 svelte-b1tvfj"></div> <div class="premium-orb premium-orb-2 svelte-b1tvfj"></div></div> <div class="premium-content svelte-b1tvfj"><button class="premium-close-btn svelte-b1tvfj" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><line x1="18" y1="6" x2="6" y2="18" class="svelte-b1tvfj"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-b1tvfj"></line></svg></button> <div class="premium-icon-wrapper svelte-b1tvfj"><div class="premium-icon svelte-b1tvfj"><!> <div class="premium-icon-glow svelte-b1tvfj"></div></div></div> <h2 id="renko-premium-title" class="premium-title svelte-b1tvfj">Premium Feature</h2> <p class="premium-message svelte-b1tvfj">Renko and Point &amp; Figure intraday/daily views are AI Pro only. Weekly and Monthly stay free—upgrade to unlock every timeframe and keep your edge live.</p> <div class="premium-features svelte-b1tvfj"><div class="premium-feature-item svelte-b1tvfj"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="20 6 9 17 4 12" class="svelte-b1tvfj"></polyline></svg> <span class="svelte-b1tvfj">Full Renko &amp; Point &amp; Figure timeframes</span></div> <div class="premium-feature-item svelte-b1tvfj"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="20 6 9 17 4 12" class="svelte-b1tvfj"></polyline></svg> <span class="svelte-b1tvfj">Sharper entries with intraday brick precision</span></div> <div class="premium-feature-item svelte-b1tvfj"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><polyline points="20 6 9 17 4 12" class="svelte-b1tvfj"></polyline></svg> <span class="svelte-b1tvfj">All future AI Pro chart perks, included</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-b1tvfj"><span class="svelte-b1tvfj">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b1tvfj"><line x1="5" y1="12" x2="19" y2="12" class="svelte-b1tvfj"></line><polyline points="12 5 19 12 12 19" class="svelte-b1tvfj"></polyline></svg></a></div></div>',1),DZ=Me('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="menu-wrapper svelte-b1tvfj"><div class="menu-container svelte-b1tvfj"><div class="menu-left-section svelte-b1tvfj"><div class="menu-toggle-wrapper svelte-b1tvfj"><button class="menu-toggle-btn svelte-b1tvfj" title="Toggle Left Panel"><div class="menu-toggle-icon-wrapper svelte-b1tvfj"><svg viewBox="0 0 1024 1024"><path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" class="svelte-b1tvfj"></path></svg></div> <div class="menu-toggle-glow svelte-b1tvfj"></div></button></div> <!> <div class="rotate-button-wrapper-mobile svelte-b1tvfj"><button type="button"><!> <div class="menu-btn-content svelte-b1tvfj"><div class="menu-icon-wrapper svelte-b1tvfj"><svg width="20" height="20" viewBox="0 0 448 448" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-b1tvfj"><!></svg></div></div> <div class="menu-btn-glow svelte-b1tvfj"></div></button></div> <div class="symbol-search-section svelte-b1tvfj"><div class="symbol-search-content svelte-b1tvfj"><div class="symbol-search-icon svelte-b1tvfj"><!></div> <span class="symbol-name svelte-b1tvfj"> </span></div></div> <div class="timeframe-section svelte-b1tvfj"><!> <!></div> <div class="ai-section svelte-b1tvfj"><button class="ai-btn group relative overflow-hidden svelte-b1tvfj" aria-label="AI Indicators" title="AI Powered Indicators" type="button"><div class="ai-glitter-bg svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-1 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-2 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-3 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-4 svelte-b1tvfj"></div> <div class="ai-glitter-particle ai-glitter-5 svelte-b1tvfj"></div> <div class="ai-shine-sweep svelte-b1tvfj"></div> <div class="ai-btn-content svelte-b1tvfj"><div class="ai-icon-wrapper svelte-b1tvfj"><svg class="ai-icon svelte-b1tvfj" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-b1tvfj"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-b1tvfj"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-b1tvfj"></line></svg></div> <span class="ai-text svelte-b1tvfj">AI</span> <div class="ai-badge-mini svelte-b1tvfj">New</div></div></button></div> <div class="chart-type-section svelte-b1tvfj"><button class="pro-menu-btn svelte-b1tvfj" title="Chart Type"><!> <span class="pro-menu-text svelte-b1tvfj"> </span></button></div> <div class="indicator-section svelte-b1tvfj"><button class="pro-menu-btn svelte-b1tvfj" title="Indicators"><!> <span class="pro-menu-text svelte-b1tvfj"> </span></button></div> <div class="undo-redo-section svelte-b1tvfj"><button title="Undo (Ctrl+Z)"><!></button> <button title="Redo (Ctrl+Y)"><!></button></div></div> <div class="menu-right-section svelte-b1tvfj"><!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Load Chart Layout" type="button"><!></button> <!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Timezone" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Settings" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Script Studio" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Screenshot" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-b1tvfj" title="Toggle Theme" type="button"><!></button></div></div> <!></div> <!> <!> <!>',1);function RZ(n,e){Ld(e,!0);const t=tm(),s=()=>vl(d,"$chart",t),o=()=>vl(m,"$save",t),r=()=>vl(h,"$ctx",t),a=()=>vl(B0,"$userPreferences",t),l=()=>vl(cc,"$isRenkoActive",t),c=()=>vl(ih,"$simulator",t);let f=pi(e,"customLoad",3,!1),u=pi(e,"mainContainer",15);const d=cd("chart"),h=cd("ctx"),m=cd("save");let g=xe(!0);Mh(()=>{try{const E=sessionStorage.getItem("drawbarShown");if(E!=null){x(g,E==="true");const I=u(),W=typeof document<"u"?document.querySelector(".duty-main"):null,Z=typeof document<"u"?document.querySelector(".drawbar-host"):null,_e=i(g)?"52px":"0px";I&&I.style.setProperty("--drawing-bar-width",_e),W&&W.style.setProperty("--drawing-bar-width",_e),Z&&(Z.style.width=_e)}else{const I=typeof document<"u"?document.querySelector(".drawbar-host"):null;if(I){const W=parseFloat(getComputedStyle(I).width||"52");x(g,W>0)}}}catch{}});const w="*";function C(){let E=document;return(E.fullscreenElement||E.mozFullScreenElement||E.webkitFullscreenElement||E.msFullscreenElement)!=null}let M=xe(V(C())),P=xe(!1);{const E=()=>{const W=i(M);if(x(M,V(C())),W&&!i(M)){if(s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Z=up(o().theme);wn.merge(Z,o().styles),s().setStyles(qd(Z)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles before fullscreen exit")}u()&&(u(u().style.cssText="",!0),u().classList.remove("fullscreen")),setTimeout(()=>{var Z;if(u()&&(u().offsetHeight,u().offsetWidth,window.getComputedStyle(u()).height),(Z=s())==null||Z.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const _e=up(o().theme);wn.merge(_e,o().styles),s().setStyles(qd(_e)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var Z;if((Z=s())==null||Z.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const _e=up(o().theme);wn.merge(_e,o().styles),s().setStyles(qd(_e)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Z;if((Z=s())==null||Z.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const _e=up(o().theme);if(wn.merge(_e,o().styles),s().setStyles(qd(_e)),r().applyCanvasColors){r().applyCanvasColors();const me=s().getVisibleRange();me&&s().scrollToDataIndex(me.to,0)}console.log("✅ Final chart colors applied after fullscreen exit")}},300),setTimeout(()=>{var Z;(Z=s())==null||Z.resize()},600),setTimeout(()=>{var Z;(Z=s())==null||Z.resize()},1200)}else setTimeout(()=>{var Z;(Z=s())==null||Z.resize()},100)},I=()=>{if(console.log("📱 handleIOSFullscreenChange triggered"),Vl()){const W=window.innerHeight===screen.height,Z=document.body.classList.contains("ios-fullscreen"),_e=window.navigator.standalone;console.log("🔍 iOS fullscreen checks:",{heightMatch:W,hasIOSClass:Z,isStandalone:_e,windowHeight:window.innerHeight,screenHeight:screen.height,currentFullScreen:i(M)});const me=W||Z||_e,Le=i(M);if(i(M)!==me){if(console.log(`🔄 iOS fullscreen state changed: ${i(M)} → ${me}`),x(M,V(me)),Le&&!me&&s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const ye=up(o().theme);wn.merge(ye,o().styles),s().setStyles(qd(ye)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles for iOS exit")}console.log("📏 Scheduling iOS chart resizes..."),setTimeout(()=>{var ye;if((ye=s())==null||ye.resize(),Le&&!me&&s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Se=up(o().theme);wn.merge(Se,o().styles),s().setStyles(qd(Se)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var ye;if((ye=s())==null||ye.resize(),Le&&!me&&s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Se=up(o().theme);if(wn.merge(Se,o().styles),s().setStyles(qd(Se)),r().applyCanvasColors){r().applyCanvasColors();const Ge=s().getVisibleRange();Ge&&s().scrollToDataIndex(Ge.to,0)}console.log("✅ Final iOS chart colors applied")}},300)}else console.log("✅ No iOS fullscreen state change needed")}else console.log("❌ Not iOS Safari, skipping handler")};document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),Vl()&&(window.addEventListener("resize",I),window.addEventListener("orientationchange",I),document.addEventListener("webkitfullscreenchange",I),"standalone"in window.navigator&&window.addEventListener("beforeunload",()=>{i(ct)&&i(ct)()}))}let T=xe(!1),N=xe(!1),L=xe(!1),O=xe(!1),D=xe(!1);function $(){x(D,!0)}function z(){En()}let te=xe(!1),pe=xe(!1),J=xe(!1),le=xe(""),de=xe(""),he=xe(!1),ge=xe(!1),ae=xe(!1),Ie=xe(!1),ce=xe(!1),je=xe(null),Ve=xe(!1),We=xe(!1),He=xe(!1),Ue=xe(V({x:0,y:0})),et=xe(!1),ft=xe(V({x:0,y:0})),it=xe(V([])),Lt=xe(null),Tt=xe(!1),Pt=xe(!1),St=!1,st=xe(!1),xt=xe(""),Je=xe(!1),Xe=xe(V({x:0,y:0})),Be=xe(!1);function Qe(){try{if(u()){const I=(u().querySelector(".chart-container")||u()).getBoundingClientRect();x(Xe,V({x:I.left+I.width/2,y:I.top+I.height/2}))}else{const E=typeof window<"u"?window.innerWidth:0,I=typeof window<"u"?window.innerHeight:0;x(Xe,V({x:E/2,y:I/2}))}}catch{}}let ct=xe(null);function Mt(E){console.log(E)}let mt=xe(void 0);const Ce=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600}],Te=[{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}],It=[{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400}],$t=["1w","1M"],Yt=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}];let qn=xe(!1),Vn=xe(!1),Dn=xe(!1),Wn=xe(!1),pn=xe(void 0);const gn="smartchart.menu.scrollHint.dismissed",Qs="smartchart.menu.scrollHint.animated";let Is=xe(!1),Cs=xe(!1),ro=xe(!1),bs=null,zt=0;function Qt(){try{x(Is,localStorage.getItem(gn)==="1"),x(Cs,localStorage.getItem(Qs)==="1")}catch{}}function ho(){if(!(i(Cs)||!p3)){x(Cs,!0);try{localStorage.setItem(Qs,"1")}catch{}}}function ri(){if(!i(Is)){x(Is,!0),x(Wn,!1),x(ro,!1),bs&&(clearTimeout(bs),bs=null);try{localStorage.setItem(gn,"1")}catch{}}}function jo(){const E=document.querySelector(".drawbar-host");if(!E)return 0;const I=E.getBoundingClientRect();return Math.max(0,Math.round(I.width))}function Na(){var Ge,Ae,Rt,nn;const E=s();if(!E)return;const I=jo(),W=E.getStyles(),Z=((Ae=(Ge=W.candle)==null?void 0:Ge.tooltip)==null?void 0:Ae.offsetLeft)??4,_e=((nn=(Rt=W.indicator)==null?void 0:Rt.tooltip)==null?void 0:nn.offsetLeft)??4,me=Math.max(0,Z-zt),Le=Math.max(0,_e-zt),ye=me+I,Se=Le+I;if(ye===Z&&Se===_e){zt=I;return}E.setStyles({candle:{tooltip:{offsetLeft:ye}},indicator:{tooltip:{offsetLeft:Se}}}),zt=I}wr(()=>{let E=null,I=null;function W(){return typeof window<"u"&&window.saveManager?(E=window.saveManager.state.subscribe(_e=>{console.log("📊 SaveManager state updated:",_e),_e.initialized?(console.log("🔗 SaveManager is initialized, updating UI state..."),x(it,V(_e.savedLayouts)),x(Lt,V(_e.activeSaveId)),x(Tt,V(_e.isLoading)),I&&(clearInterval(I),I=null)):console.log("⏳ SaveManager exists but not yet initialized...")}),!0):!1}return W()||(console.log("⏳ Waiting for SaveManager to be available..."),I=setInterval(()=>{W()},100)),()=>{E&&E(),I&&clearInterval(I)}});function ar(){s()&&setTimeout(()=>{s().resize()},300)}Mh(()=>{Qt(),Np.init({chart:s(),saveStore:m,overlaysStore:null});const E=()=>{x(Vn,V(Np.canUndo())),x(Dn,V(Np.canRedo()))};E();const I=setInterval(E,100);"screen"in window&&"orientation"in window.screen?window.screen.orientation.addEventListener("change",ar):window.addEventListener("orientationchange",ar),ms();const W=()=>{ri(),ms()},Z=()=>{ms(),typeof window<"u"&&x(Ie,window.innerWidth<=768),Na()};return i(pn)&&i(pn).addEventListener("scroll",W),window.addEventListener("resize",Z),setTimeout(()=>{ms(),typeof window<"u"&&x(Ie,window.innerWidth<=768),Na()},500),()=>{clearInterval(I),bs&&(clearTimeout(bs),bs=null),"screen"in window&&"orientation"in window.screen?window.screen.orientation.removeEventListener("change",ar):window.removeEventListener("orientationchange",ar),i(pn)&&i(pn).removeEventListener("scroll",W),window.removeEventListener("resize",Z)}});function Aa(){i(Vn)&&Np.undo()}function nr(){i(Dn)&&Np.redo()}function hi(E){var I;if(Bc()&&!nc()){const W=E==null?void 0:E.timeframe;if(!$t.includes(W)){x(Be,!0);return}}Fc(m,Ao(o).period=E,Ao(o));try{const W=(I=o())!=null&&I.key&&typeof o().key=="string"?o().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${W}.lastTimeframe`,(E==null?void 0:E.timeframe)||"")}catch{}i(ae)&&x(ae,!1)}function Gc(){var W,Z,_e,me;if((Z=(W=o().styles)==null?void 0:W.candle)!=null&&Z._isLineChart)return Yt.find(Le=>Le.id==="line_chart")||Yt[0];const E=((me=(_e=o().styles)==null?void 0:_e.candle)==null?void 0:me.type)||"candle_solid";return Yt.find(Le=>Le.id===E)||Yt[0]}const Pu=hp(m,E=>E.symbol.ticker),wc=hp(m,E=>E.symbol.shortName),cc=hp(m,E=>{var I,W;return((W=(I=E.styles)==null?void 0:I.candle)==null?void 0:W.type)==="renko_atr"});hp(m,E=>{var I,W;return((W=(I=E.styles)==null?void 0:I.candle)==null?void 0:W.type)==="point_and_figure"}),Pu.subscribe(()=>{x(de,V(o().symbol.shortName||o().symbol.ticker))}),wc.subscribe(()=>{x(de,V(o().symbol.shortName||o().symbol.ticker))});function ou(){const E=o().styles||{},I=up(o().theme);if(E.backgroundColor||E.backgroundGradient||E.backgroundType||E.backgroundOpacity!==void 0||E.gridGradient||E.gridType||E.gridOpacity!==void 0)return!0;const W=Ae=>{if(!Ae||typeof Ae!="string")return"";const Rt=Ae.trim().toLowerCase();if(Rt.startsWith("rgba(")){const nn=Rt.match(/rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(nn){const Xn=Number(nn[1]).toString(16).padStart(2,"0"),hn=Number(nn[2]).toString(16).padStart(2,"0"),is=Number(nn[3]).toString(16).padStart(2,"0");return`#${Xn}${hn}${is}`}}return Rt},Z=W(wn.get(E,"pane.backgroundColor")),_e=W(wn.get(E,"candle.pane.backgroundColor")),me=W(wn.get(I,"pane.backgroundColor"));if(Z&&me&&Z!==me||_e&&me&&_e!==me)return!0;const Le=W(wn.get(E,"grid.horizontal.color")),ye=W(wn.get(E,"grid.vertical.color")),Se=W(wn.get(I,"grid.horizontal.color")),Ge=W(wn.get(I,"grid.vertical.color"));return!!(Le&&Se&&Le!==Se||ye&&Ge&&ye!==Ge)}function zu(E){try{if(window.self!==window.top){const I={type:"theme-change",theme:E};let W=w;try{window.parent.location&&(W=window.parent.location.origin)}catch{W=w}window.parent.postMessage(I,W),console.log("📤 Sent theme-change message to parent:",I,"origin:",W)}}catch(I){console.error("Failed to send theme-change message to parent:",I)}}function ja(E,I){var _e,me,Le,ye,Se;const W=document.querySelector(".duty-main");if(W&&W.setAttribute("data-theme",E),I){try{const Ge=localStorage.getItem("chart");if(Ge){const Ae=JSON.parse(Ge);Ae.styles&&(delete Ae.styles.backgroundColor,delete Ae.styles.backgroundOpacity,delete Ae.styles.backgroundType,delete Ae.styles.backgroundGradient,Ae.styles.grid&&(delete Ae.styles.grid.horizontal,delete Ae.styles.grid.vertical),delete Ae.styles.gridColor,delete Ae.styles.gridOpacity,delete Ae.styles.gridType,delete Ae.styles.gridGradient,localStorage.setItem("chart",JSON.stringify(Ae)),console.log("🧹 Cleared custom background and grid colors from localStorage"))}}catch(Ge){console.error("Failed to clear custom colors from localStorage:",Ge)}if(s()){window.__forceApplyThemeDefaults=!0;const Ge=up(E),Ae=JSON.parse(JSON.stringify(o().styles||{})),Rt=Ge,nn={...Ae,pane:{...Ae.pane,backgroundColor:Rt.pane.backgroundColor},candle:{...Ae.candle,pane:{...(_e=Ae.candle)==null?void 0:_e.pane,backgroundColor:Rt.candle.pane.backgroundColor}},grid:{...Ae.grid,horizontal:{...(me=Ae.grid)==null?void 0:me.horizontal,color:Rt.grid.horizontal.color},vertical:{...(Le=Ae.grid)==null?void 0:Le.vertical,color:Rt.grid.vertical.color}}},Xn=(ye=Ae==null?void 0:Ae.candle)==null?void 0:ye.type,hn=wn.merge({},Ge,nn);delete hn.backgroundColor,delete hn.backgroundOpacity,delete hn.backgroundType,delete hn.backgroundGradient,delete hn.gridColor,delete hn.gridOpacity,delete hn.gridType,delete hn.gridGradient,Xn&&hn.candle&&(hn.candle.type=Xn),s().setStyles(qd(hn)),Fc(m,Ao(o).styles=hn,Ao(o))}try{const Ge=new p6("chart-settings",d,E);Ge.resetToThemeDefaults(E),Ge.destroy(),console.log("🔄 Reset TransactionalThemeManager for theme toggle")}catch(Ge){console.error("Failed to reset TransactionalThemeManager:",Ge)}}Fc(m,Ao(o).theme=E,Ao(o));const Z=(Se=a())==null?void 0:Se.data;if(Z!=null&&Z.clerkId){const Ge=E==="dark"?"Dark":"Light";a8(Z.clerkId,Ge).catch(Ae=>{console.error("Failed to save theme to API:",Ae)})}zu(E)}function nc(){var I;const E=(I=a())==null?void 0:I.data;return(E==null?void 0:E.isPremium)===!0||(E==null?void 0:E.isTrial)===!0}function Bc(){var I,W;const E=(W=(I=o().styles)==null?void 0:I.candle)==null?void 0:W.type;return E==="renko_atr"||E==="point_and_figure"}function Vu(){var I;if(nc()||!Bc())return;const E=(I=o().period)==null?void 0:I.timeframe;if(!$t.includes(E)){const W=Te.find(Z=>Z.timeframe==="1M")||Te.find(Z=>Z.timeframe==="1w");W&&hi(W)}}wr(()=>{var E,I,W;(I=(E=o().styles)==null?void 0:E.candle)==null||I.type,(W=o().period)==null||W.timeframe,Vu()});function rf(){const E=wn.get(o().styles,"backgroundType")==="gradient",I=wn.get(o().styles,"backgroundGradient"),W=E&&I&&Array.isArray(I.stops)&&I.stops.length>0,Z=(me,Le)=>{const ye=(me||"#000000").replace("#",""),Se=parseInt(ye.substring(0,2),16)||0,Ge=parseInt(ye.substring(2,4),16)||0,Ae=parseInt(ye.substring(4,6),16)||0,Rt=Math.max(0,Math.min(1,Le??1));return`rgba(${Se}, ${Ge}, ${Ae}, ${Rt})`};if(W){requestAnimationFrame(()=>{var me,Le;try{const ye=(me=s())==null?void 0:me.getConvertPictureUrl(!0,"png","rgba(0, 0, 0, 0)");if(!ye)return;const Se=new Image;Se.onload=()=>{const Ge=Se.naturalWidth||Se.width,Ae=Se.naturalHeight||Se.height,Rt=document.createElement("canvas");Rt.width=Ge,Rt.height=Ae;const nn=Rt.getContext("2d");if(!nn)return;let Xn;if((I.type==="radial"?"radial":"linear")==="radial")Xn=nn.createRadialGradient(Ge/2,Ae/2,0,Ge/2,Ae/2,Math.max(Ge,Ae)/2);else{const es=((typeof I.direction=="number"?I.direction:90)-90)*Math.PI/180,Mi=Math.cos(es),Kn=Math.sin(es),Es=Ge/2-Ge/2*Mi,Qo=Ae/2-Ae/2*Kn,sr=Ge/2+Ge/2*Mi,na=Ae/2+Ae/2*Kn;Xn=nn.createLinearGradient(Es,Qo,sr,na)}[...I.stops].sort((Gs,es)=>(Gs.position??0)-(es.position??0)).forEach(Gs=>{const es=Math.max(0,Math.min(1,(Gs.position??0)/100)),Mi=Z(Gs.color,(Gs.opacity??100)/100);Xn.addColorStop(es,Mi)}),nn.fillStyle=Xn,nn.fillRect(0,0,Ge,Ae),nn.drawImage(Se,0,0,Ge,Ae),x(le,V(Rt.toDataURL("image/png"))),x(te,!0)},Se.src=ye}catch{let Se=o().theme==="dark"?"#0A0F1A":"#ffffff";x(le,V(((Le=s())==null?void 0:Le.getConvertPictureUrl(!0,"jpeg",Se))??"")),x(te,!0)}});return}let _e;try{const me=document.querySelector(".duty-widget"),Le=document.querySelector(".duty-main"),ye=Se=>{if(!Se)return"";const Ge=getComputedStyle(Se).getPropertyValue("--chart-background-color").trim();return Ge&&!Ge.includes("gradient")?Ge:""};if(_e=ye(me)||ye(Le)||void 0,!_e&&s()&&typeof s().getStyles=="function"){const Se=s().getStyles()??{};_e=wn.get(Se,"pane.backgroundColor")||wn.get(Se,"candle.pane.backgroundColor")||void 0}if(!_e){const Se=wn.get(o().styles,"backgroundColor");_e=Se&&typeof Se=="string"?Se:void 0}}catch{}_e||(_e=o().theme==="dark"?"#0A0F1A":"#ffffff"),requestAnimationFrame(()=>{var me;x(le,V(((me=s())==null?void 0:me.getConvertPictureUrl(!0,"jpeg",_e))??"")),x(te,!0)})}function co(){if(Vl()&&i(ct)){i(ct)();return}let E=document;const I=E.exitFullscreen??E.mozCancelFullScreen??E.webkitExitFullscreen??E.msExitFullscreen;I?I.call(E):Vl()&&Wr()}function ll(){Mt("🔄 toggleFullscreen called, current fullScreen: "+i(M)),Mt("🔍 iOS detection - isIOS(): "+va()+", isIOSSafari(): "+Vl()),i(M)?(Mt("🚪 Exiting fullscreen..."),co()):Vl()?(Mt("📱 Using iOS Safari fullscreen method"),kr()):(Mt("🖥️ Using standard fullscreen method"),jl())}function va(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function Vl(){const E=navigator.userAgent,I=/iPad|iPhone|iPod/.test(E)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,W=/Safari/.test(E)&&!/Chrome|CriOS|FxiOS/.test(E);return I&&W}function kr(){return Mt("📱 enterFullscreenIOS called"),new Promise(E=>{var W;const I=u();if(Mt("🎯 mainContainer element: "+(I?"Found":"Not found")),I&&I.webkitRequestFullscreen){Mt("🔧 Trying webkitRequestFullscreen...");try{I.webkitRequestFullscreen(),setTimeout(()=>{Mt("✅ webkitRequestFullscreen success, setting fullScreen = true"),x(M,!0),E(!0)},300);return}catch(Z){Mt("❌ webkitRequestFullscreen failed: "+Z)}}else Mt("❌ webkitRequestFullscreen not available");if(I&&I.webkitEnterFullscreen)try{I.webkitEnterFullscreen(),setTimeout(()=>{x(M,!0),E(!0)},300);return}catch(Z){console.log("webkitEnterFullscreen failed:",Z)}Mt("🔧 Trying viewport manipulation fallback...");try{const Z=document.querySelector('meta[name="viewport"]'),_e=(Z==null?void 0:Z.getAttribute("content"))||"";Mt("📋 Original viewport content: "+_e);const me=Z||document.createElement("meta");me.setAttribute("name","viewport"),me.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),Z?console.log("🔄 Updated existing viewport meta tag"):(document.head.appendChild(me),console.log("➕ Added new viewport meta tag")),window.scrollTo(0,1),console.log("📜 Scrolled to hide Safari UI");const Le=document.createElement("style");Le.id="ios-fullscreen-style",Le.textContent=`
          body.ios-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100vh !important;
            overflow: hidden !important;
            -webkit-overflow-scrolling: touch !important;
          }
          
          .ios-fullscreen #main-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
          }
          
          /* Hide Safari bottom bar */
          @supports (padding: max(0px)) {
            .ios-fullscreen {
              padding-bottom: env(safe-area-inset-bottom) !important;
            }
          }
        `,document.head.appendChild(Le),console.log("🎨 Added iOS fullscreen CSS styles");const ye=((W=u())==null?void 0:W.getAttribute("data-theme"))||o().theme;Mt("🎨 Preserving theme during iOS fullscreen: "+ye),document.body.classList.add("ios-fullscreen"),console.log("✅ Applied ios-fullscreen class to body"),u()&&(u().setAttribute("data-theme",ye),Mt("🔄 Restored theme attribute: "+ye)),setTimeout(()=>{window.scrollTo(0,0),x(M,!0),Mt("🎯 iOS fullscreen activated successfully!"),x(ct,()=>{var Ae;Mt("🧹 Cleaning up iOS fullscreen...");const Se=((Ae=u())==null?void 0:Ae.getAttribute("data-theme"))||o().theme;Mt("🎨 Preserving theme during cleanup: "+Se),document.body.classList.remove("ios-fullscreen");const Ge=document.getElementById("ios-fullscreen-style");Ge&&Ge.remove(),Z&&_e&&Z.setAttribute("content",_e),u()&&(u().setAttribute("data-theme",Se),Mt("🔄 Restored theme attribute after cleanup: "+Se)),x(M,!1),Mt("✅ iOS fullscreen cleanup completed")}),E(!0)},100)}catch(Z){console.log("iOS Safari viewport fallback failed:",Z),E(!1)}})}function Wr(){var E;if(console.log("🚪 exitFullscreenIOS called"),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const I=up(o().theme);wn.merge(I,o().styles),s().setStyles(qd(I)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied styles before iOS exit")}try{document.webkitExitFullscreen?(console.log("🔧 Trying webkitExitFullscreen..."),document.webkitExitFullscreen()):console.log("❌ webkitExitFullscreen not available"),i(ct)?(console.log("🧹 Using stored cleanup function..."),i(ct)(),x(ct,null)):console.log("❌ No stored cleanup function available"),console.log("🔧 Performing manual cleanup...");const I=((E=u())==null?void 0:E.getAttribute("data-theme"))||o().theme;console.log("🎨 Preserving theme during manual cleanup: "+I),document.body.classList.remove("ios-fullscreen");const W=document.getElementById("ios-fullscreen-style");W&&(W.remove(),console.log("🗑️ Removed iOS fullscreen styles"));const Z=document.querySelector('meta[name="viewport"]');Z&&(Z.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),console.log("📱 Restored viewport meta tag")),u()&&(u().setAttribute("data-theme",I),console.log("🔄 Restored theme attribute after manual cleanup: "+I)),x(M,!1),console.log("✅ Set fullScreen = false"),setTimeout(()=>{var _e;if(console.log("📏 First chart resize..."),(_e=s())==null||_e.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const me=up(o().theme);wn.merge(me,o().styles),s().setStyles(qd(me)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var _e;if((_e=s())==null||_e.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const me=up(o().theme);wn.merge(me,o().styles),s().setStyles(qd(me)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var _e;if((_e=s())==null||_e.resize(),s()&&o().styles){window.__forceApplySavedCanvasColors=!0;const me=up(o().theme);if(wn.merge(me,o().styles),s().setStyles(qd(me)),r().applyCanvasColors){r().applyCanvasColors();const Le=s().getVisibleRange();Le&&s().scrollToDataIndex(Le.to,0)}console.log("✅ Final iOS chart colors applied after exit")}},300)}catch(I){console.log("❌ iOS exit fullscreen failed:",I)}}function jl(){return va()?kr():new Promise(E=>{let I=u();I&&I.requestFullscreen?I.requestFullscreen().then(()=>E(!0)).catch(()=>E(!1)):I&&I.mozRequestFullScreen?(I.mozRequestFullScreen(),setTimeout(()=>E(!0),100)):I&&I.webkitRequestFullscreen?(I.webkitRequestFullscreen(),setTimeout(()=>E(!0),100)):I&&I.msRequestFullscreen?(I.msRequestFullscreen(),setTimeout(()=>E(!0),100)):E(!1)})}function Xl(){Mu();const E=document.createElement("div");E.id="ios-rotation-hint",E.innerHTML=`
      <div style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        z-index: 10000;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 280px;
        backdrop-filter: blur(10px);
      ">
        <div style="font-size: 24px; margin-bottom: 10px;">📱</div>
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Rotate Your Device</div>
        <div style="font-size: 14px; opacity: 0.8;">Turn your device to landscape mode for the best experience</div>
        <div style="margin-top: 15px; font-size: 12px; opacity: 0.6;">Tap anywhere to dismiss</div>
      </div>
    `,E.onclick=Mu,document.body.appendChild(E),setTimeout(Mu,4e3)}function Mu(){const E=document.getElementById("ios-rotation-hint");E&&E.remove()}async function Zu(){if(typeof window<"u"&&window.saveManager){const E=window.saveManager,I=E.getState();if(x(Je,!1),I.activeSaveId){const W=await E.quickSave();W.success||console.error("Quick save failed:",W.error),W.success&&(x(He,!1),x(xt,"Saved to current layout"),x(st,!0),setTimeout(()=>{x(st,!1)},2e3),x(Je,!0),Qe(),setTimeout(()=>{x(Je,!1)},1500))}else x(He,!1),x(Ve,!0)}}function xo(){x(He,!1),x(We,!0)}function Sr(){x(He,!1),x(Ve,!0)}async function ql(E){const{layoutId:I}=E.detail;if(typeof window<"u"&&window.saveManager){const W=window.saveManager;x(Pt,!0);const Z=await W.load(I);x(Pt,!1),Z.success||console.error("Load failed:",Z.error)}}async function $f(E){const{layoutId:I}=E.detail;if(typeof window<"u"&&window.saveManager){const Z=await window.saveManager.delete(I);if(!Z.success){console.error("Delete failed:",Z.error);return}x(it,V((i(it)||[]).filter(_e=>_e.id!==I))),i(Lt)===I&&x(Lt,null),x(Tt,!1)}}async function Cf(E){const{name:I}=E.detail;if(typeof window<"u"&&window.saveManager){const W=window.saveManager;x(Je,!1);const Z=await W.save(I);Z.success?(x(Ve,!1),x(Je,!0),Qe(),setTimeout(()=>{x(Je,!1)},1500)):console.error("Save failed:",Z.error)}}function tp(){x(Ve,!1)}async function mf(E){const{layoutId:I}=E.detail;if(console.log("💾 SaveAsSelectSave triggered with layoutId:",I),typeof window<"u"&&window.saveManager){const W=window.saveManager;console.log("✅ SaveManager found, calling saveTo..."),x(Je,!1);const Z=await W.saveTo(I);Z.success?(console.log("✅ Save to existing successful"),x(We,!1),x(Je,!0),Qe(),setTimeout(()=>{x(Je,!1)},1500)):console.error("❌ Save to existing failed:",Z.error)}else console.error("❌ SaveManager not available")}function sc(){x(We,!1),If()}function yd(){x(We,!1)}function If(){console.log("🎯 Save button clicked, showing popup..."),console.log("📊 Current savedLayouts:",i(it)),console.log("🎯 Current activeSaveId:",i(Lt)),console.log("💾 SaveManager available:",!!window.saveManager);try{if(typeof window<"u"&&window.saveManager){const I=window.saveManager.getState();if(!I||!Array.isArray(I.savedLayouts)||I.savedLayouts.length===0){x(He,!1),x(Ve,!0);return}}else if(!i(it)||i(it).length===0){x(He,!1),x(Ve,!0);return}}catch{x(He,!1),x(Ve,!0);return}if(u()){const E=u().querySelector(".chart-container");if(E){const I=E.getBoundingClientRect();x(Ue,V({x:I.left+I.width/2,y:I.top+I.height/2}))}else{const I=u().getBoundingClientRect();x(Ue,V({x:I.left+I.width/2,y:I.top+I.height/2}))}}x(He,!0)}function En(){if(u()){const E=u().querySelector(".chart-container");if(E){const I=E.getBoundingClientRect();x(ft,V({x:I.left+I.width/2,y:I.top+I.height/2}))}else{const I=u().getBoundingClientRect();x(ft,V({x:I.left+I.width/2,y:I.top+I.height/2}))}}x(et,!0)}function ms(){if(!i(pn))return;if(i(Is)){x(Wn,!1);return}const{scrollWidth:E,clientWidth:I,scrollLeft:W}=i(pn),Z=E>I,_e=W+I>=E-5,me=Z&&!_e;x(Wn,V(me)),me&&!i(Cs)&&!i(ro)&&(x(ro,!0),ho(),bs&&clearTimeout(bs),bs=setTimeout(()=>{x(ro,!1),bs=null},2400))}function js(E){if(E&&(E.preventDefault(),E.stopPropagation()),!i(pn))return;ri();const{scrollLeft:I,clientWidth:W,scrollWidth:Z}=i(pn),_e=W*.7,me=Math.min(I+_e,Z-W);try{i(pn).scrollTo({left:me,behavior:"smooth"})}catch{i(pn).scrollLeft=me}}function Nn(E){E.preventDefault(),E.stopPropagation(),js()}const Io=a_(),[fo,Ji]=Io;var Gi=DZ(),Al=tn(Gi);BW(Al,{get show(){return i(T)},set show(E){x(T,V(E))}});var Ii=v(Al,2);WW(Ii,{get show(){return i(N)},set show(E){x(N,V(E))}});var Wo=v(Ii,2);IH(Wo,{get show(){return i(L)},set show(E){x(L,V(E))}});var To=v(Wo,2);NG(To,{get show(){return r().modalIndCfg},set show(E){Fc(h,Ao(r).modalIndCfg=E,Ao(r))}});var Ba=v(To,2);QY(Ba,{get show(){return i(O)},set show(E){x(O,V(E))}});var Pi=v(Ba,2);D8(Pi,{get show(){return i(D)},set show(E){x(D,V(E))}});var qs=v(Pi,2);tK(qs,{get show(){return i(te)},set show(E){x(te,V(E))},get url(){return i(le)},set url(E){x(le,V(E))}});var mi=v(qs,2);oK(mi,{get show(){return i(pe)},set show(E){x(pe,V(E))}});var Er=v(mi,2);uK(Er,{get show(){return i(qn)},set show(E){x(qn,V(E))}});var Za=v(Er,2);MK(Za,{get show(){return i(J)},set show(E){x(J,V(E))}});var vi=v(Za,2);OK(vi,{get show(){return i(Ve)},set show(E){x(Ve,V(E))},get savedLayouts(){return i(it)},get isLoading(){return i(Tt)},mode:"save",showExisting:!1,$$events:{save:Cf,cancel:tp}});var $r=v(vi,2);pX($r,{get show(){return i(We)},set show(E){x(We,V(E))},get savedLayouts(){return i(it)},get isLoading(){return i(Tt)},$$events:{saveTo:mf,back:sc,cancel:yd}});var Il=v($r,2);ZK(Il,{get show(){return i(He)},set show(E){x(He,V(E))},get savedLayouts(){return i(it)},get activeSaveId(){return i(Lt)},get isLoading(){return i(Tt)},get hasUnsavedChanges(){return St},get position(){return i(Ue)},showLayouts:!1,$$events:{save:Zu,saveAs:xo,quickSave:Zu,newLayout:Sr}});var cl=v(Il,2);oX(cl,{get show(){return i(et)},set show(E){x(et,V(E))},get savedLayouts(){return i(it)},get activeSaveId(){return i(Lt)},get position(){return i(ft)},get isLoading(){return i(Tt)},$$events:{load:ql,delete:$f}});var kc=v(cl,2);R8(kc,{get visible(){return i(st)},set visible(E){x(st,V(E))},get message(){return i(xt)},duration:2e3});var uc=v(kc,2);Ye(uc,()=>i(Je),E=>{var I=qX();Ne(()=>Dt(I,"style",`left: ${i(Xe).x??""}px; top: ${i(Xe).y??""}px;`)),Y(E,I)});var Tl=v(uc,2),ur=y(Tl),la=y(ur),Fl=y(la),Oa=y(Fl);Oa.__click=[WX,g,u,Na,s,d];var ni=y(Oa),vc=y(ni);_(ni),Di(2),_(Oa),_(Fl);var gl=v(Fl,2);Ye(gl,f,E=>{var I=GX(),W=y(I);W.__change=[VX,de,o,m,s,d,r,h],ep(W,_e=>x(mt,_e),()=>i(mt));var Z=v(W,2);Z.__click=[UX,mt],_(I),Y(E,I)});var za=v(gl,2),sl=y(za);sl.__click=[HX,ge,he,va,kr,Xl,s,d,jl,Mu,M,co];var Oc=y(sl);Ye(Oc,()=>i(ge),E=>{var I=YX();Y(E,I)});var Va=v(Oc,2),Wa=y(Va),uu=y(Wa),ud=y(uu);Ye(ud,()=>i(he),E=>{var I=KX();Di(3),Y(E,I)},E=>{var I=XX();Di(3),Y(E,I)}),_(uu),_(Wa),_(Va),Di(2),_(sl),_(za);var Ll=v(za,2);Ll.__click=[ZX,T];var vu=y(Ll),Sc=y(vu),Ja=y(Sc);hz(Ja,{class:"search-icon"}),_(Sc);var ga=v(Sc,2),Wu=y(ga,!0);_(ga),_(vu),_(Ll);var zc=v(Ll,2),eu=y(zc);Ye(eu,()=>!i(Ie),E=>{var I=oZ(),W=y(I);Ro(W,17,()=>Ce,fi,(me,Le)=>{var ye=QX();ye.__click=[JX,hi,Le];var Se=y(ye),Ge=y(Se,!0);_(Se),Di(2),_(ye),Ne(()=>{var Ae;Fi(ye,`timeframe-btn ${(i(Le).timeframe===((Ae=o().period)==null?void 0:Ae.timeframe)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),tt(Ge,i(Le).timeframe)}),Y(me,ye)});var Z=v(W,2);Ye(Z,()=>!l(),me=>{var Le=tZ();Le.__click=[eZ,hi,It],Ne(()=>{var ye;return Fi(Le,`timeframe-btn ${(((ye=o().period)==null?void 0:ye.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),Y(me,Le)});var _e=v(Z,2);Ro(_e,17,()=>Te,fi,(me,Le)=>{var ye=sZ();ye.__click=[nZ,hi,Le];var Se=y(ye),Ge=y(Se,!0);_(Se),Di(2),_(ye),Ne(()=>{var Ae;Fi(ye,`timeframe-btn ${(i(Le).timeframe===((Ae=o().period)==null?void 0:Ae.timeframe)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),tt(Ge,i(Le).timeframe)}),Y(me,ye)}),_(I),Y(E,I)});var Ud=v(eu,2);Ye(Ud,()=>i(Ie),E=>{var I=gZ(),W=y(I);Ye(W,()=>Te.find(Le=>Le.timeframe==="1d"),Le=>{var ye=rZ();ye.__click=[iZ,hi,Te],Ne(()=>{var Se;return Fi(ye,`timeframe-btn ${(((Se=o().period)==null?void 0:Se.timeframe)==="1d"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),Y(Le,ye)});var Z=v(W,2);Ye(Z,()=>Te.find(Le=>Le.timeframe==="1w"),Le=>{var ye=lZ();ye.__click=[aZ,hi,Te],Ne(()=>{var Se;return Fi(ye,`timeframe-btn ${(((Se=o().period)==null?void 0:Se.timeframe)==="1w"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),Y(Le,ye)});var _e=v(Z,2);_e.__click=[cZ,ae];var me=v(_e,2);Ye(me,()=>i(ae),Le=>{var ye=vZ(),Se=y(ye);Ro(Se,17,()=>Ce,fi,(Rt,nn)=>{var Xn=dZ();Xn.__click=[uZ,hi,nn];var hn=y(Xn),is=y(hn,!0);_(hn),Di(2),_(Xn),Ne(()=>{var Gs;Fi(Xn,`timeframe-btn ${(i(nn).timeframe===((Gs=o().period)==null?void 0:Gs.timeframe)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),tt(is,i(nn).timeframe)}),Y(Rt,Xn)});var Ge=v(Se,2);Ye(Ge,()=>!l(),Rt=>{var nn=pZ();nn.__click=[fZ,hi,It],Ne(()=>{var Xn;return Fi(nn,`timeframe-btn ${(((Xn=o().period)==null?void 0:Xn.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),Y(Rt,nn)});var Ae=v(Ge,2);Ye(Ae,()=>Te.find(Rt=>Rt.timeframe==="1M"),Rt=>{var nn=hZ();nn.__click=[mZ,hi,Te],Ne(()=>{var Xn;return Fi(nn,`timeframe-btn ${(((Xn=o().period)==null?void 0:Xn.timeframe)==="1M"?"timeframe-btn-active":"")??""} svelte-b1tvfj`)}),Y(Rt,nn)}),_(ye),xg(1,ye,()=>qW,()=>({duration:180})),xg(2,ye,()=>__,()=>({duration:120})),Y(Le,ye)}),_(I),Ne(()=>{Fi(_e,`timeframe-btn timeframe-more-btn ${(i(ae)?"timeframe-btn-active":"")??""} svelte-b1tvfj`),Dt(_e,"aria-expanded",i(ae))}),Y(E,I)}),_(zc);var qf=v(zc,2),Uf=y(qf);Uf.__click=[_Z,J],_(qf);var dd=v(qf,2),Id=y(dd);Id.__click=[yZ,qn];var dc=y(Id);Kv(dc,{get name(){return Gc().icon},size:16});var Gf=v(dc,2),Pd=y(Gf,!0);Ne(()=>tt(Pd,Gc().name)),_(Gf),_(Id),_(dd);var af=v(dd,2),ol=y(af);ol.__click=[bZ,L];var du=y(ol);Kv(du,{name:"indicator",size:16});var Nu=v(du,2),hf=y(Nu,!0);Ne(()=>tt(hf,Kw())),_(Nu),_(ol),_(af);var td=v(af,2),Cc=y(td);Cc.__click=function(...E){var I;(I=i(Vn)?Aa:void 0)==null||I.apply(this,E)};var Gd=y(Cc);Kv(Gd,{class:"undo-redo-icon",name:"undo",size:16}),_(Cc);var tu=v(Cc,2);tu.__click=function(...E){var I;(I=i(Dn)?nr:void 0)==null||I.apply(this,E)};var Vc=y(tu);Kv(Vc,{class:"undo-redo-icon",name:"redo",size:16}),_(tu),_(td),_(la);var Yd=v(la,2),Md=y(Yd),Au=At(()=>i(Tt)&&!i(Pt));FK(Md,{get savedLayouts(){return i(it)},get activeSaveId(){return i(Lt)},get isLoading(){return i(Au)},get hasUnsavedChanges(){return St},$$events:{save:Zu,saveAs:xo,quickSave:Zu,load:ql,delete:$f,newLayout:Sr,showPopup:If}});var Kd=v(Md,2);Kd.__click=En;var Hu=y(Kd);iz(Hu,{size:18}),_(Kd);var Tu=v(Kd,2);Ye(Tu,()=>c().mode==="none",E=>{var I=wZ();I.__click=[xZ,P];var W=y(I);Kv(W,{name:"play",size:18}),_(I),Y(E,I)},E=>{var I=kZ(),W=y(I);Kv(W,{name:"play",size:18}),_(I),Y(E,I)});var bd=v(Tu,2);bd.__click=[SZ,pe];var gc=y(bd);sz(gc,{size:18}),_(bd);var qu=v(bd,2);qu.__click=[CZ,D];var $d=y(qu);vz($d,{size:18}),_(qu);var np=v(qu,2);np.__click=function(...E){var I;(I=e.onToggleScriptStudio)==null||I.apply(this,E)};var Pf=y(np);oz(Pf,{size:18}),_(np);var oe=v(np,2);oe.__click=rf;var we=y(oe);nz(we,{size:18}),_(oe);var K=v(oe,2);K.__click=[IZ,Mt,ll];var re=y(K);Ye(re,()=>i(M),E=>{uz(E,{size:18})},E=>{cz(E,{size:18})}),_(K);var ke=v(K,2);ke.__click=[BX,o,m,ou,je,ce,ja];var ee=y(ke);Ye(ee,()=>o().theme==="dark",E=>{dz(E,{size:20})},E=>{gz(E,{size:20})}),_(ke),_(Yd),_(ur),ep(ur,E=>x(pn,E),()=>i(pn));var Ee=v(ur,2);Ye(Ee,()=>i(Wn),E=>{var I=TZ();I.__click=[PZ,js],I.__touchstart=[MZ,Nn],I.__touchend=[NZ],I.__pointerdown=[AZ,js],Ne(()=>Fi(I,`menu-scroll-arrow ${(i(ro)?"menu-scroll-arrow--animate":"")??""} svelte-b1tvfj`)),Y(E,I)}),_(Tl);var ht=v(Tl,2);Ye(ht,()=>i(ce),E=>{var I=FZ(),W=y(I),Z=v(y(W),2),_e=y(Z);Di(2),_(Z);var me=v(Z,2),Le=y(me);Le.__click=[zX,je,ja,ce];var ye=v(Le,2);ye.__click=[OX,je,ja,ce],_(me),_(W),_(I),Ne(()=>tt(_e,`${`You're changing the user interface to the ${i(je)==="light"?"Light":"Dark"} theme.`??""} `)),Y(E,I)});var pt=v(ht,2);Ye(pt,()=>i(Be),E=>{var I=$Z(),W=tn(I);W.__click=[LZ,Be];var Z=v(W,2),_e=v(y(Z),2),me=y(_e);me.__click=[EZ,Be];var Le=v(me,2),ye=y(Le),Se=y(ye);Kv(Se,{name:"candle_solid",size:36}),Di(2),_(ye),_(Le);var Ge=v(Le,8);Ne(()=>Dt(Ge,"href",fo("https://dutyai.app/settings/investor?device=1",void 0))),_(_e),_(Z),xg(3,W,()=>__,()=>({duration:180})),xg(3,Z,()=>__,()=>({duration:200})),Y(E,I)});var Nt=v(pt,2);return RX(Nt,{get show(){return i(P)},$$events:{close:()=>x(P,!1)}}),Ne(()=>{ey(vc,`menu-toggle-icon ${(i(g)?"":"rotate")??""} svelte-b1tvfj`),Fi(sl,`menu-btn ${(i(he)?"menu-btn-active":"")??""} ${(i(ge)?"rotate-loading":"")??""} svelte-b1tvfj`),Dt(sl,"title",i(he)?"Exit Fullscreen & Rotation":"Fullscreen & Rotate to Landscape"),sl.disabled=i(ge),rr(Va,"rotate-content-hidden",i(ge)),rr(uu,"rotate-icon-spinning",i(ge)),tt(Wu,i(de)),Fi(Cc,`undo-redo-btn ${(i(Vn)?"":"undo-redo-disabled")??""} svelte-b1tvfj`),Fi(tu,`undo-redo-btn ${(i(Dn)?"":"undo-redo-disabled")??""} svelte-b1tvfj`),Dt(K,"title",i(M)?"Exit Fullscreen":"Fullscreen")}),Y(n,Gi),Ed({openChartSettings:$,openLoadLayout:z})}Tp(["click","change","touchstart","touchend","pointerdown"]);var jZ=Me('<div class="modal-backdrop svelte-1oypfgf"><div class="modal-content svelte-1oypfgf"><div class="modal-actions svelte-1oypfgf"><button class="action-btn copy-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"></rect><path d="M5 15H4C2.9 15 2 14.1 2 13V4C2 2.9 2.9 2 4 2H13C14.1 2 15 2.9 15 4V5" stroke="currentColor" stroke-width="2"></path></svg> <span class="svelte-1oypfgf"> </span></button> <button class="action-btn reset-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M3 12C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12C21 16.97 16.97 21 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M3 12L7 8M3 12L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg> <span class="svelte-1oypfgf">Reset View</span></button></div></div></div>');function BZ(n,e){Ld(e,!1);let t=pi(e,"isOpen",12,!1),s=pi(e,"x",8,0),o=pi(e,"y",8,0),r=pi(e,"currentPrice",8,"");const a=Hh();function l(){t(!1),a("close")}function c(){a("reset"),l()}function f(){a("copy",{price:r()}),l()}function u(g){g.target===g.currentTarget&&l()}function d(g){g.key==="Escape"&&l()}_v();var h=Yn();ld("keydown",NC,d);var m=tn(h);Ye(m,t,g=>{var w=jZ(),C=y(w),M=y(C),P=y(M),T=v(y(P),2),N=y(T);_(T),_(P);var L=v(P,2);_(M),_(C),_(w),Ne(()=>{Dt(C,"style",`left: ${s()??""}px; top: ${o()??""}px;`),tt(N,`Copy Price ${(r()?`(${r()})`:"")??""}`)}),ld("click",P,f),ld("click",L,c),ld("click",w,u),Y(g,w)}),Y(n,h),Ed()}class OZ{constructor(e){$e(this,"chart");$e(this,"overlays",new Map);$e(this,"projectionQueue",new Set);$e(this,"isProjecting",!1);$e(this,"eventListeners",new Map);$e(this,"resizeObserver");$e(this,"periodicProjectionId");$e(this,"lastViewportState");$e(this,"animationFrameId",null);this.chart=e,this.initializeEventListeners()}initializeEventListeners(){if(typeof ResizeObserver<"u"){const e=this.chart.getDom();if(e){const t=new ResizeObserver(()=>{this.scheduleProjection("resize")});t.observe(e),this.resizeObserver=t}}this.setupPeriodicProjection()}setupPeriodicProjection(){this.periodicProjectionId=window.setInterval(()=>{const e=this.getViewportState();e!==this.lastViewportState&&(this.lastViewportState=e,this.scheduleProjection("scroll"))},100)}getViewportState(){try{const e=this.chart.getVisibleRange(),t=this.chart.getSize();return JSON.stringify({visibleRange:e,chartSize:t})}catch{return""}}scheduleProjection(e){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>{this.projectAllOverlays(e),this.animationFrameId=null})}addOverlay(e){this.overlays.set(e.id,e),e.points.length>0&&c5(e.points,this.chart),this.projectOverlay(e)}removeOverlay(e){this.overlays.delete(e);try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Could not remove overlay from chart:",t)}}updateOverlay(e){this.overlays.has(e.id)&&(this.overlays.set(e.id,e),e.points.length>0&&c5(e.points,this.chart),this.projectOverlay(e))}getOverlay(e){return this.overlays.get(e)}getAllOverlays(){return Array.from(this.overlays.values())}projectOverlay(e){const t={chart:this.chart,paneId:"candle_pane"},s=F8(e.points,t);return s.isValid&&e.visible!==!1&&this.updateChartOverlay(e,s.screenPoints),s}projectAllOverlays(e){if(!this.isProjecting){this.isProjecting=!0;try{const t={type:e,chart:this.chart,timestamp:Date.now()};this.emitEvent(e,t);for(const s of this.overlays.values())s.visible!==!1&&this.projectOverlay(s)}finally{this.isProjecting=!1}}}updateChartOverlay(e,t){try{const s=t.map(l=>({x:l.x,y:l.y})),o={id:e.id,name:e.type,points:s.map((l,c)=>{var f,u;return{...l,timestamp:(f=e.points[c])==null?void 0:f.t,value:(u=e.points[c])==null?void 0:u.p}}),styles:this.convertOverlayStyles(e.style),visible:e.visible,lock:e.lock},r=this.chart.getOverlays({id:e.id});(r.length>0?r[0]:null)?this.chart.overrideOverlay(o):this.chart.createOverlay(o)}catch(s){console.error("Error updating chart overlay:",s)}}convertOverlayStyles(e){const t={};return e.line&&(t.line={color:e.line.color,size:e.line.size,style:e.line.style==="dashed"?"dashed":"solid"},e.line.dashedValue&&(t.line.dashedValue=e.line.dashedValue)),e.text&&(t.text={color:e.text.color,backgroundColor:e.text.backgroundColor,borderColor:e.text.borderColor,fontSize:e.text.fontSize}),e.polygon&&(t.polygon={color:e.polygon.color,fillColor:e.polygon.fillColor}),t}onTimeframeChange(){this.scheduleProjection("timeframeChange")}onTimezoneChange(){this.scheduleProjection("timezoneChange")}onPriceScaleChange(){this.scheduleProjection("priceScaleChange")}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}removeEventListener(e,t){const s=this.eventListeners.get(e);s&&s.delete(t)}emitEvent(e,t){const s=this.eventListeners.get(e);s&&s.forEach(o=>{try{o(t)}catch(r){console.error("Error in overlay event listener:",r)}})}forceProjection(){this.projectAllOverlays("resize")}clearAllOverlays(){for(const e of this.overlays.keys())this.removeOverlay(e);this.overlays.clear()}dispose(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0),this.periodicProjectionId&&(clearInterval(this.periodicProjectionId),this.periodicProjectionId=void 0),this.clearAllOverlays(),this.eventListeners.clear()}}const zZ={timeframeChange:{debounceMs:100,enabled:!0},zoom:{throttleMs:16,enabled:!0},scroll:{throttleMs:16,enabled:!0},resize:{debounceMs:250,enabled:!0},dataUpdate:{debounceMs:50,enabled:!0},priceScaleChange:{debounceMs:100,enabled:!0}};class VZ{constructor(e,t={}){$e(this,"chart");$e(this,"projectionManager",null);$e(this,"creationManager",null);$e(this,"eventListeners",new Map);$e(this,"resizeObserver",null);$e(this,"config");$e(this,"debounceTimers",new Map);$e(this,"throttleTimers",new Map);this.chart=e,this.config={...zZ,...t}}setProjectionManager(e){this.projectionManager=e}setCreationManager(e){this.creationManager=e}initialize(){this.setupChartEventListeners(),this.setupResizeObserver(),this.setupCustomEventListeners()}setupChartEventListeners(){this.setupViewportChangeDetection()}setupViewportChangeDetection(){let e=null;const s=setInterval(()=>{try{const o=this.chart.getVisibleRange();o&&this.hasRangeChanged(e,o)&&(e=o,this.handleEvent("scroll"))}catch(o){console.error("Error checking viewport changes:",o)}},16);this.eventListeners.set("viewportPolling",()=>clearInterval(s))}setupResizeObserver(){const e=this.chart.getDom();e&&(this.resizeObserver=new ResizeObserver(()=>{this.handleEvent("resize")}),this.resizeObserver.observe(e))}setupCustomEventListeners(){const e=this.chart.getDom();if(!e)return;const t=()=>this.handleEvent("timeframeChange"),s=()=>this.handleEvent("dataUpdate");e.addEventListener("timeframeChange",t),e.addEventListener("dataUpdate",s),this.eventListeners.set("timeframeChange",()=>{e.removeEventListener("timeframeChange",t)}),this.eventListeners.set("dataUpdate",()=>{e.removeEventListener("dataUpdate",s)})}handleEvent(e){const t=this.config[e];t.enabled&&(t.debounceMs?this.debounceEvent(e,t.debounceMs):t.throttleMs?this.throttleEvent(e,t.throttleMs):this.executeEvent(e))}debounceEvent(e,t){const s=this.debounceTimers.get(e);s&&clearTimeout(s);const o=setTimeout(()=>{this.executeEvent(e),this.debounceTimers.delete(e)},t);this.debounceTimers.set(e,o)}throttleEvent(e,t){const s=this.throttleTimers.get(e)||0,o=Date.now();o-s>=t&&(this.executeEvent(e),this.throttleTimers.set(e,o))}executeEvent(e){try{this.projectionManager&&this.projectionManager.forceProjection();const t=this.chart.getDom();t&&t.dispatchEvent(new CustomEvent("overlayEvent",{detail:{type:e,timestamp:Date.now()}}))}catch(t){console.error(`Error handling ${e} event:`,t)}}hasRangeChanged(e,t){return e?e.from!==t.from||e.to!==t.to:!0}hasPriceRangeChanged(e,t){return e?Math.abs(e.min-t.min)>1e-8||Math.abs(e.max-t.max)>1e-8:!0}triggerEvent(e){this.handleEvent(e)}updateConfig(e,t){this.config[e]={...this.config[e],...t}}setEventEnabled(e,t){this.config[e].enabled=t}destroy(){this.debounceTimers.forEach(e=>clearTimeout(e)),this.debounceTimers.clear(),this.throttleTimers.clear(),this.eventListeners.forEach(e=>e()),this.eventListeners.clear(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}}function y5(n){return typeof n=="object"&&n!==null&&typeof n.x=="number"&&typeof n.y=="number"}function b5(n){return typeof n=="object"&&n!==null&&typeof n.timestamp=="number"&&typeof n.value=="number"}function Tx(n){return typeof n=="object"&&n!==null}class WZ{constructor(e){$e(this,"chart");$e(this,"currentSymbolKey",null);this.chart=e}toDrawing(e,t){try{if(!this.currentSymbolKey)return null;const s=Array.isArray(t==null?void 0:t.points)?t.points.map(f=>{if(f&&typeof f=="object"){if(typeof f.timestamp=="number"&&typeof f.value=="number")return{time:f.timestamp,price:f.value};if(typeof f.t=="number"&&typeof f.p=="number")return{time:f.t,price:f.p}}return null}).filter(Boolean):[];if(s.length===0)return null;const o=(t==null?void 0:t.name)||(t==null?void 0:t.type)||"unknown",r=(t==null?void 0:t.styles)||(t==null?void 0:t.style)||{},a=!!(t!=null&&t.lock),l=(t==null?void 0:t.visible)!==!1;return{id:e,symbolKey:this.currentSymbolKey,type:o,points:s,styles:r,...t!=null&&t.extendData?{extendData:t.extendData}:{},locked:a,visible:l}}catch{return null}}setCurrentSymbolKey(e){this.currentSymbolKey=e,console.log("📍 OverlayCreationManager symbol set:",e)}getCurrentSymbolKey(){return this.currentSymbolKey}createPointFromMouse(e,t){try{const s={x:e,y:t},o={chart:this.chart},r=UW(s,o);return r?{timestamp:r.t,value:r.p}:null}catch(s){return console.error("Failed to create point from mouse coordinates:",s),null}}createDataSpaceOverlay(e){if(!Tx(e)||!e.points||!Array.isArray(e.points))return e;const t=e.points.map(s=>{if(y5(s)){const o=this.createPointFromMouse(s.x,s.y);return o?{timestamp:o.timestamp,value:o.value}:s}else if(b5(s))return s;return s});return{...e,points:t,_isDataSpace:!0}}convertLegacyOverlay(e){if(!Tx(e)||e._isDataSpace||!e.points)return e;const t=e.points.map(s=>{if(y5(s)){const o=this.createPointFromMouse(s.x,s.y);return o?{timestamp:o.timestamp,value:o.value}:s}return s});return{...e,points:t,_isDataSpace:!0}}projectOverlayToScreen(e){if(!Tx(e)||!e._isDataSpace||!e.points)return e;const t=e.points.map(s=>{if(b5(s)){const o={id:s.id||"temp",t:s.timestamp,p:s.value},r={chart:this.chart},a=S2(o,r);return a?{x:a.x,y:a.y}:s}return s});return{...e,points:t}}addOverlay(e){try{const t=this.createDataSpaceOverlay(e),s=this.projectOverlayToScreen(t),o=this.chart.createOverlay(s);if(o){const r=Array.isArray(o)?o[0]:o;if(typeof r=="string"){const a=Qg();if(a){const l=this.toDrawing(r,t);if(l){a.addDrawing(l);try{vv()}catch{}}}}return r}return null}catch(t){return console.error("Failed to add overlay:",t),null}}storeDataSpaceOverlay(e,t){}getStoredDataSpaceOverlay(e){try{const t=localStorage.getItem("dataSpaceOverlays");return t&&JSON.parse(t)[e]||null}catch(t){return console.error("Failed to retrieve data-space overlay:",t),null}}removeStoredDataSpaceOverlay(e){try{const t=Qg();if(t){t.removeDrawing(e);try{vv()}catch{}}}catch(t){console.error("Failed to remove overlay from DrawingManager:",t)}}}function HZ(n){return n.createDataSpaceTemplate("enhancedRect",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{var c,f,u,d,h,m;if(s.length<2)return[];const[o,r]=s,a=[],l=30;return a.push({type:"rect",attrs:{x:Math.min(o.x,r.x)-l,y:Math.min(o.y,r.y)-l,width:Math.abs(r.x-o.x)+l*2,height:Math.abs(r.y-o.y)+l*2},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),a.push({type:"rect",attrs:{x:Math.min(o.x,r.x),y:Math.min(o.y,r.y),width:Math.abs(r.x-o.x),height:Math.abs(r.y-o.y)},styles:{style:"stroke",color:((f=(c=e.style)==null?void 0:c.line)==null?void 0:f.color)||"#1677FF",borderSize:((d=(u=e.style)==null?void 0:u.line)==null?void 0:d.size)||1,borderStyle:((m=(h=e.style)==null?void 0:h.line)==null?void 0:m.style)||"solid"}}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function qZ(n){return n.createDataSpaceTemplate("enhancedCircle",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{var f,u,d,h,m,g;if(s.length<2)return[];const[o,r]=s,a=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),l=[];return l.push({type:"circle",attrs:{x:o.x,y:o.y,r:a+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),l.push({type:"circle",attrs:{x:o.x,y:o.y,r:a},styles:{style:"stroke",color:((u=(f=e.style)==null?void 0:f.line)==null?void 0:u.color)||"#1677FF",borderSize:((h=(d=e.style)==null?void 0:d.line)==null?void 0:h.size)||1,borderStyle:((g=(m=e.style)==null?void 0:m.line)==null?void 0:g.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function UZ(n){return n.createDataSpaceTemplate("enhancedLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{var r,a,l,c,f,u;if(s.length<2)return[];const o=[];for(let d=0;d<s.length-1;d++){const h=s[d],m=s[d+1];o.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:m.x,y:m.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),o.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:m.x,y:m.y}]},styles:{color:((a=(r=e.style)==null?void 0:r.line)==null?void 0:a.color)||"#1677FF",size:((c=(l=e.style)==null?void 0:l.line)==null?void 0:c.size)||.5,style:((u=(f=e.style)==null?void 0:f.line)==null?void 0:u.style)||"solid"}})}return o},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function GZ(n){return n.createDataSpaceTemplate("enhancedTrendLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s,chart:o})=>{var h,m,g,w,C,M;if(s.length<2)return[];const[r,a]=s,l=[];let c=r,f=a;const u=e.extendLeft,d=e.extendRight;if(u||d){const P=o.getSize();if(P){const T=(a.y-r.y)/(a.x-r.x);if(u&&(c={x:0,y:r.y+T*(0-r.x)}),d){const N=r.y+T*(P.width-r.x);f={x:P.width,y:N}}}}return l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:f.x,y:f.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:f.x,y:f.y}]},styles:{color:((m=(h=e.style)==null?void 0:h.line)==null?void 0:m.color)||"#1677FF",size:((w=(g=e.style)==null?void 0:g.line)==null?void 0:w.size)||.5,style:((M=(C=e.style)==null?void 0:C.line)==null?void 0:M.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function YZ(n){return n.createDataSpaceTemplate("enhancedFibonacci",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:s})=>{if(s.length<2)return[];const[o,r]=s,a=[],l=[0,.236,.382,.5,.618,.786,1,1.618,2.618],c=r.y-o.y;return l.forEach(f=>{var d,h,m,g,w,C,M,P;const u=o.y+c*f;a.push({type:"line",attrs:{coordinates:[{x:Math.min(o.x,r.x),y:u},{x:Math.max(o.x,r.x),y:u}]},styles:{color:"transparent",size:30,style:"solid"},ignoreEvent:!1}),a.push({type:"line",attrs:{coordinates:[{x:Math.min(o.x,r.x),y:u},{x:Math.max(o.x,r.x),y:u}]},styles:{color:((h=(d=e.style)==null?void 0:d.line)==null?void 0:h.color)||"#1677FF",style:"dashed",size:((g=(m=e.style)==null?void 0:m.line)==null?void 0:g.size)||2}}),a.push({type:"text",attrs:{x:Math.max(o.x,r.x)+5,y:u,text:`${(f*100).toFixed(1)}%`},styles:{color:((C=(w=e.style)==null?void 0:w.text)==null?void 0:C.color)||"#666666",size:((P=(M=e.style)==null?void 0:M.text)==null?void 0:P.fontSize)||12}})}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function KZ(n){return{enhancedRect:HZ(n),enhancedCircle:qZ(n),enhancedLine:UZ(n),enhancedTrendLine:GZ(n),enhancedFibonacci:YZ(n)}}const Cw=["sma","smma","ema","wma","rsi","bbands","bollinger","bollinger_bands","atr","obv","cci","mfi","ao","trix","vwap","vwma","zscore","evwma","roc","macd","supertrend","kc","keltner","donchian","atr_bands","vwap_bands","linreg_channel","sar","stoch","ichimoku","pivot_high","pivot_low","auto_fib","autofib","last_value","prev_value","line_value","security","expr","formula"],Iw=["line","histogram","area","cross","dots","stepped","step","bar","candles","ohlc","neon_line","bezier_line","glow_points","heatmap","distortion","cloud","aura","candleshadow","supertrend_cloud","fractal_boxes","liquidity_tiles"],Pw=["arrowUp","arrowDown","circle","square","cross","xcross","diamond","triangle_up_filled","triangle_down_filled","box","label","text","emoji","triangle_up_gradient","triangle_down_gradient","arrow_up_glow","arrow_down_glow","circle_pulse","pill","tag","flag","box_gradient","bubble","spark","star"];function hc(n){return Array.isArray(n)?n:[]}function of(n){return typeof n=="string"?n:void 0}function Up(n){return typeof n=="number"&&Number.isFinite(n)?n:void 0}function Fx(n){return String(n||"").replace(/\s+/g,"_").toLowerCase()}function XZ(n,e,t,s){if(!n.length)return{series:[],stateSeries:[]};const o=[],r=[],a=new Set(e.map(f=>Fx(String((f==null?void 0:f.name)||""))).filter(Boolean)),l=new Set(t.map(f=>Fx(String((f==null?void 0:f.name)||""))).filter(Boolean)),c=f=>f==null?"":typeof f=="string"?f:typeof f=="number"&&Number.isFinite(f)?String(f):typeof f=="boolean"?f?"true":"false":"";return n.forEach((f,u)=>{if(!f||typeof f!="object")return;const d=of(f.type),h=(d?d.toLowerCase():"")||(f.state?"state":(f.series,"series")),m=of(f.name)||of(f.series)||of(f.state)||"";if(!m){s.push(`rules[${u}] missing name`);return}if(h!=="series"&&h!=="state"){s.push(`rules[${u}] invalid type "${String(f.type||"")}"`);return}const g=Fx(m);if(a.has(g)||l.has(g)){s.push(`rules[${u}] name "${m}" conflicts with existing series/stateSeries`);return}const w=c(f.whenExpr??f.when),C=c(f.then??f.value??f.expr);if(!C){s.push(`rules[${u}] missing expression`);return}const M=c(f.else),P=w&&w.trim()?`iff(${w}, ${C}, ${M||(h==="state"?m:"na")})`:C;if(h==="state"){const T=c(f.init)||void 0,N=f.selfMode;r.push({name:m,initExpr:T,updateExpr:P,selfMode:N}),l.add(g)}else o.push({name:m,expr:P}),a.add(g)}),{series:o,stateSeries:r}}function q_(n){const e=[];if(!n||typeof n!="object")return e.push("Script must be an object"),{ok:!1,errors:e};const t=n,s=!!(t!=null&&t.strategy)||hc(t==null?void 0:t.signals).length>0,o=hc(t.calc),r=hc(t.series),a=hc(t.stateSeries),l=hc(t.rules),c=XZ(l,r,a,e);c.series.length&&r.push(...c.series),c.stateSeries.length&&a.push(...c.stateSeries);const f=[];if(Array.isArray(t.panes)&&t.panes.length)for(const d of t.panes){const h=d.pane==="sub"?"sub":"main";f.push({pane:h,plots:hc(d.plots),levels:hc(d.levels),labels:hc(d.labels),lines:hc(d.lines),runtimeDrawOps:hc(d.runtimeDrawOps),runtimeLabels:hc(d.runtimeLabels),runtimeLines:hc(d.runtimeLines),runtimeBoxes:hc(d.runtimeBoxes),runtimeTables:hc(d.runtimeTables),runtimeHeatmaps:hc(d.runtimeHeatmaps),overlays:hc(d.overlays),min:Up(d.min),max:Up(d.max),shortName:of(d.shortName),fills:hc(d.fills),backgroundZones:hc(d.backgroundZones),height:Up(d.height)})}else if(t.main||t.sub)t.main&&f.push({pane:"main",plots:hc(t.main.plots),levels:hc(t.main.levels),labels:hc(t.main.labels),lines:hc(t.main.lines),runtimeDrawOps:hc(t.main.runtimeDrawOps),runtimeLabels:hc(t.main.runtimeLabels),runtimeLines:hc(t.main.runtimeLines),runtimeBoxes:hc(t.main.runtimeBoxes),runtimeTables:hc(t.main.runtimeTables),runtimeHeatmaps:hc(t.main.runtimeHeatmaps),overlays:hc(t.main.overlays),min:Up(t.main.min),max:Up(t.main.max),shortName:of(t.main.shortName||t.shortName),fills:hc(t.main.fills),backgroundZones:hc(t.main.backgroundZones),height:Up(t.main.height)}),t.sub&&f.push({pane:"sub",plots:hc(t.sub.plots),levels:hc(t.sub.levels),labels:hc(t.sub.labels),lines:hc(t.sub.lines),runtimeDrawOps:hc(t.sub.runtimeDrawOps),runtimeLabels:hc(t.sub.runtimeLabels),runtimeLines:hc(t.sub.runtimeLines),runtimeBoxes:hc(t.sub.runtimeBoxes),runtimeTables:hc(t.sub.runtimeTables),runtimeHeatmaps:hc(t.sub.runtimeHeatmaps),overlays:hc(t.sub.overlays),min:Up(t.sub.min),max:Up(t.sub.max),shortName:of(t.sub.shortName||t.shortName),fills:hc(t.sub.fills),backgroundZones:hc(t.sub.backgroundZones),height:Up(t.sub.height)});else if(t.pane||t.plots||t.labels||t.levels||t.lines){const d=t.pane==="sub"?"sub":"main";f.push({pane:d,plots:hc(t.plots),levels:hc(t.levels),labels:hc(t.labels),lines:hc(t.lines),runtimeDrawOps:hc(t.runtimeDrawOps),runtimeLabels:hc(t.runtimeLabels),runtimeLines:hc(t.runtimeLines),runtimeBoxes:hc(t.runtimeBoxes),runtimeTables:hc(t.runtimeTables),runtimeHeatmaps:hc(t.runtimeHeatmaps),overlays:hc(t.overlays),min:Up(t.min),max:Up(t.max),shortName:of(t.shortName),fills:[],backgroundZones:[],height:void 0})}f.length||(s?f.push({pane:"main",plots:[],levels:[],labels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],overlays:[],min:Up(t.min),max:Up(t.max),shortName:of(t.shortName),fills:[],backgroundZones:[],height:void 0}):e.push("No panes defined"));const u={calc:o.map((d,h)=>({name:of(d.name)||of(d.type)||`calc_${h}`,type:of(d.type)||of(d.name),source:of(d.source),period:Up(d.period),fast:Up(d.fast),slow:Up(d.slow),signal:Up(d.signal),kPeriod:Up(d.kPeriod),dPeriod:Up(d.dPeriod),left:Up(d.left),right:Up(d.right),tenkan:Up(d.tenkan),kijun:Up(d.kijun),senkouB:Up(d.senkouB),expr:of(d.expr),timeframe:of(d.timeframe),symbol:of(d.symbol),country:of(d.country),lookahead:of(d.lookahead),gaps:of(d.gaps),lower:d.lower===!0?!0:void 0,params:d.params,style:d.style})),series:r.map((d,h)=>({name:of(d.name)||`series_${h}`,expr:of(d.expr)||""})),stateSeries:a.map((d,h)=>({name:of(d.name)||`state_${h}`,initExpr:of(d.initExpr),updateExpr:of(d.updateExpr)||"",selfMode:d.selfMode||void 0})),panes:f,loopPlans:Array.isArray(t.loopPlans)?t.loopPlans:void 0,userFunctions:Array.isArray(t.userFunctions)?t.userFunctions:void 0,signals:hc(t.signals).map((d,h)=>{const m=d==null?void 0:d.order,g=of(d==null?void 0:d.title),w=of(d==null?void 0:d.message),C=of(d==null?void 0:d.whenExpr),M=of(d==null?void 0:d.scoreExpr),P=of(d==null?void 0:d.cooldownExpr),T=of(m==null?void 0:m.kind),N=T?T.trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"):void 0,L=of((d==null?void 0:d.frequency)??(d==null?void 0:d.freq)),O=et=>{if(typeof et=="number"&&Number.isFinite(et)||typeof et=="string")return et},D=et=>{if(typeof et=="number"&&Number.isFinite(et)||typeof et=="string")return et},$=O(m==null?void 0:m.price),z=O((m==null?void 0:m.stopPrice)??(m==null?void 0:m.stop)??(m==null?void 0:m.trigger)),te=O((m==null?void 0:m.limitPrice)??(m==null?void 0:m.limit)??(m==null?void 0:m.lmt)),pe=D(m==null?void 0:m.qty),J=D(m==null?void 0:m.cash),le=D((m==null?void 0:m.commissionPct)??(m==null?void 0:m.commission)),de=D((m==null?void 0:m.slippagePct)??(m==null?void 0:m.slippage)),he=typeof(m==null?void 0:m.qtyPct)=="number"&&Number.isFinite(m.qtyPct)?m.qtyPct:void 0,ge=typeof he=="number"?Math.max(0,Math.min(100,he)):void 0,ae=of(m==null?void 0:m.oco),Ie=typeof(m==null?void 0:m.expiresBars)=="number"&&Number.isFinite(m.expiresBars)?m.expiresBars:void 0,ce=typeof Ie=="number"?Math.max(0,Math.floor(Ie)):void 0,je=m==null?void 0:m.bracket,Ve=(()=>{if(!je||typeof je!="object")return;const et=je,ft=typeof et.stopLossPct=="number"&&Number.isFinite(et.stopLossPct)?Math.max(0,et.stopLossPct):void 0,it=typeof et.takeProfitPct=="number"&&Number.isFinite(et.takeProfitPct)?Math.max(0,et.takeProfitPct):void 0,Lt=typeof et.trailingStopPct=="number"&&Number.isFinite(et.trailingStopPct)?Math.max(0,et.trailingStopPct):void 0,Tt=[],Pt=Array.isArray(et.takeProfits)?et.takeProfits:[];for(const St of Pt){if(!St||typeof St!="object")continue;const st=typeof St.takeProfitPct=="number"?St.takeProfitPct:Number(St.takeProfitPct),xt=typeof St.qtyPct=="number"?St.qtyPct:Number(St.qtyPct);!Number.isFinite(st)||st<=0||!Number.isFinite(xt)||xt<=0||Tt.push({takeProfitPct:Math.max(0,st),qtyPct:Math.max(0,Math.min(100,xt))})}if(Tt.sort((St,st)=>St.takeProfitPct-st.takeProfitPct),!(ft==null&&it==null&&Lt==null&&Tt.length===0))return{stopLossPct:ft,takeProfitPct:it,trailingStopPct:Lt,takeProfits:Tt.length?Tt:void 0}})(),We=typeof(d==null?void 0:d.cooldownBars)=="number"&&Number.isFinite(d.cooldownBars)?d.cooldownBars:void 0,He=typeof We=="number"?Math.max(0,Math.floor(We)):void 0;let Ue=null;return M==null&&(d==null?void 0:d.score)!=null&&(typeof d.score!="number"||!Number.isFinite(d.score)?e.push(`signals[${h}].score must be an integer 0..10`):Number.isInteger(d.score)?d.score<0||d.score>10?e.push(`signals[${h}].score must be in range 0..10`):Ue=d.score:e.push(`signals[${h}].score must be an integer 0..10`)),{type:String((d==null?void 0:d.type)||""),when:String((d==null?void 0:d.when)||""),whenExpr:C,id:of(d==null?void 0:d.id),orderId:of(d==null?void 0:d.orderId),title:g,message:w,frequency:L,score:Ue,scoreExpr:M,order:N||$!=null||z!=null||te!=null||pe!=null||J!=null||ge!=null||ae!=null||ce!=null||le!=null||de!=null||Ve!=null?{kind:N,price:$,stopPrice:z,limitPrice:te,qty:pe,cash:J,qtyPct:ge,oco:ae,expiresBars:ce,commissionPct:le,slippagePct:de,bracket:Ve}:void 0,cooldownBars:He,cooldownExpr:P}}),shortName:of(t.shortName),strategy:t.strategy,params:t.params,style:t.style};return u.series.forEach((d,h)=>{d.name||e.push(`series[${h}] missing name`)}),u.stateSeries.forEach((d,h)=>{d.name||e.push(`stateSeries[${h}] missing name`),d.updateExpr||e.push(`stateSeries[${h}] missing updateExpr`)}),u.panes.forEach((d,h)=>{var m,g,w,C;!s&&!((m=d.plots)!=null&&m.length)&&!((g=d.labels)!=null&&g.length)&&!((w=d.levels)!=null&&w.length)&&!((C=d.lines)!=null&&C.length)&&e.push(`pane[${h}] has no plots/labels/levels/lines`)}),{ok:e.length===0,spec:u,errors:e}}const ZZ=new Set(["line","histogram","area","cross","dots","stepped","step","bar","neon_line","bezier_line","glow_points","cloud","supertrend_cloud","aura","candleshadow"]),x5=n=>!n.interactionActive&&!n.overlayHover,JZ=(n,e={})=>{const t=typeof e.pad=="number"?e.pad:6,s=typeof e.swatch=="number"?e.swatch:8,o=typeof e.gap=="number"?e.gap:6,r=typeof e.lineHeight=="number"?e.lineHeight:14;let a=0,l=0;for(const u of n){const d=Number.isFinite(u.width)?u.width:0,h=Number.isFinite(u.height)?u.height:r;a=Math.max(a,d),l+=Math.max(r,h)}const c=t*2+s+o+a,f=t*2+l;return{boxW:c,boxH:f,usedHeight:f+6,maxTextW:a,totalH:l}};function C2(n){return typeof n=="number"&&Number.isFinite(n)}function Z1(n,e,t){const s=n[t];if(C2(s))return s;const o=e[t];return C2(o)?o:NaN}function J1(n,e,t){const s=n[t];if(C2(s))return s;const o=e[t];return C2(o)?o:NaN}function w5(n,e,t,s){let o=-1,r=-1/0;for(let a=t;a<=s;a++){const l=Z1(n,e,a);Number.isFinite(l)&&l>r&&(r=l,o=a)}return o}function k5(n,e,t,s){let o=-1,r=1/0;for(let a=t;a<=s;a++){const l=J1(n,e,a);Number.isFinite(l)&&l<r&&(r=l,o=a)}return o}function j8(n,e,t,s,o){const r=Math.min(n.length,e.length,t.length);if(r<=1)return null;const a=Math.min(r-1,Math.max(0,Math.trunc(s))),l=Math.max(2,Math.trunc(o.lookback||200)),c=Math.max(0,a-l+1),f=o.direction==="down"?"down":"up";if((o.method==="pivots"?"pivots":"extremes")==="pivots"){const w=Math.max(1,Math.floor(Number(o.pivotLeft??3))),C=Math.max(1,Math.floor(Number(o.pivotRight??3))),M=a;if(M<C)return null;const P=[],T=[],N=te=>{const pe=Z1(n,t,te);if(!Number.isFinite(pe))return null;const J=Math.max(0,te-w),le=Math.min(M,te+C);if(le<te+C)return null;for(let de=J;de<=le;de++){if(de===te)continue;const he=Z1(n,t,de);if(!Number.isFinite(he)||he>=pe)return null}return pe},L=te=>{const pe=J1(e,t,te);if(!Number.isFinite(pe))return null;const J=Math.max(0,te-w),le=Math.min(M,te+C);if(le<te+C)return null;for(let de=J;de<=le;de++){if(de===te)continue;const he=J1(e,t,de);if(!Number.isFinite(he)||he<=pe)return null}return pe},O=Math.max(c,0),D=Math.min(a-C,a);for(let te=O;te<=D;te++){const pe=N(te);pe!=null&&P.push({index:te,value:pe});const J=L(te);J!=null&&T.push({index:te,value:J})}const $=P.length?P[P.length-1]:null,z=T.length?T[T.length-1]:null;if(!(!$||!z))if(f==="up"){let te=null;for(let pe=T.length-1;pe>=0;pe--)if(T[pe].index<$.index){te=T[pe];break}if(te)return{fromIndex:te.index,toIndex:$.index,fromValue:te.value,toValue:$.value}}else{let te=null;for(let pe=P.length-1;pe>=0;pe--)if(P[pe].index<z.index){te=P[pe];break}if(te)return{fromIndex:te.index,toIndex:z.index,fromValue:te.value,toValue:z.value}}}if(f==="up"){const w=w5(n,t,c,a);if(w<0)return null;const C=k5(e,t,c,w);if(C<0)return null;const M=J1(e,t,C),P=Z1(n,t,w);return[M,P].every(Number.isFinite)?{fromIndex:C,toIndex:w,fromValue:M,toValue:P}:null}const d=k5(e,t,c,a);if(d<0)return null;const h=w5(n,t,c,d);if(h<0)return null;const m=J1(e,t,d),g=Z1(n,t,h);return[m,g].every(Number.isFinite)?{fromIndex:h,toIndex:d,fromValue:g,toValue:m}:null}function QZ(n,e,t,s){const o=Math.min(n.length,e.length,t.length),r=new Array(o),a=new Array(o),l=new Array(o),c=new Array(o),f=new Array(o),u=new Array(o),d=new Array(o);for(let h=0;h<o;h++){const m=j8(n,e,t,h,s);if(!m){r[h]=void 0,a[h]=void 0,l[h]=void 0,c[h]=void 0,f[h]=void 0,u[h]=void 0,d[h]=void 0;continue}r[h]=m.fromValue,a[h]=m.toValue,l[h]=m.fromIndex,c[h]=m.toIndex,f[h]=m.fromValue,d[h]=m.toValue,u[h]=m.fromValue+(m.toValue-m.fromValue)*.5}return{from:r,to:a,fromIndex:l,toIndex:c,lvl0:f,lvl50:u,lvl100:d}}function eJ(n){const{seriesMap:e,calcDefs:t,len:s,params:o,lastPrevSource:r,resolveNum:a,onError:l}=n,c=o||{},f=(c==null?void 0:c.__pinev2)===1,u=d=>f?Z_(d,{pineV2:!0}).expr:String(d??"");for(const d of t){const h=d.name||d.type;if(!h)continue;const m=String(h).replace(/\s+/g,"_").toLowerCase(),g=String(d.type||"").toLowerCase();if(g!=="security"){if(g==="sma"){const w=d.source||"close";e[m]=b_(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="smma"){const w=d.source||"close";e[m]=x$(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,13)))}else if(g==="ema"){const w=d.source||"close";e[m]=t0(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="wma"){const w=d.source||"close";e[m]=b$(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="rsi"){const w=d.source||"close";e[m]=w$(e[w]||e.close,Math.max(1,a(d.period,`${m}_period`,14)))}else if(g==="bbands"||g==="bollinger"||g==="bollinger_bands"){const w=d.source||"close",C=Math.max(1,a(d.period,`${m}_period`,20)),M=Math.max(.1,a(d.std,`${m}_std`,a(d.deviation,`${m}_deviation`,2))),{mid:P,upper:T,lower:N}=ow(e[w]||e.close,C,M);e[m+"_mid"]=P,e[m+"_upper"]=T,e[m+"_lower"]=N}else if(g==="atr"){const w=Math.max(1,a(d.period,`${m}_period`,14));e[m]=l2(e.high,e.low,e.close,w)}else if(g==="obv")e[m]=tS(e.close,e.volume);else if(g==="cci"){const w=Math.max(1,a(d.period,`${m}_period`,20));e[m]=nS(e.high,e.low,e.close,w)}else if(g==="mfi"){const w=Math.max(1,a(d.period,`${m}_period`,14));e[m]=sS(e.high,e.low,e.close,e.volume,w)}else if(g==="ao")e[m]=k$(e.high,e.low);else if(g==="trix"){const w=Math.max(1,a(d.period,`${m}_period`,12));e[m]=S$(e.close,w)}else if(g==="vwap")e[m]=Sk(e.close,e.volume);else if(g==="vwma"){const w=Math.max(1,a(d.period,`${m}_period`,20));e[m]=C$(e.close,e.volume,w)}else if(g==="macd"){const w=(d.source||"close").replace(/\s+/g,"_").toLowerCase(),C=Math.max(1,Number(d.fast)||12),M=Math.max(1,Number(d.slow)||26),P=Math.max(1,Number(d.signal)||9),T=e[w]||e.close,N=t0(T,C),L=t0(T,M),O=new Array(s);for(let te=0;te<s;te++)O[te]=N[te]===void 0||L[te]===void 0?void 0:N[te]-L[te];const D=t0(O,P),$=new Array(s),z=new Array(s);for(let te=0;te<s;te++){const pe=O[te],J=D[te];$[te]=typeof J=="number"&&Number.isFinite(J)?J:void 0,z[te]=pe!==void 0&&J!==void 0?pe-J:void 0}e.macd_line=O,e.macd_signal=$,e.macd_hist=z}else if(g==="supertrend"){const w=Math.max(1,Number(d.period)||10),C=Math.max(.1,Number(d.factor)||3);e[m]=I$(e.high,e.low,e.close,w,C)}else if(g==="kc"||g==="keltner"){const w=Math.max(1,Number(d.period)||20),C=Math.max(.1,Number(d.mult)||2),M=P$(e.high,e.low,e.close,w,C);e[m+"_mid"]=M.mid,e[m+"_upper"]=M.upper,e[m+"_lower"]=M.lower}else if(g==="donchian"){const w=Math.max(1,Number(d.period)||20),C=M$(e.high,e.low,w);e[m+"_mid"]=C.mid,e[m+"_upper"]=C.upper,e[m+"_lower"]=C.lower}else if(g==="atr_bands"){const w=Math.max(1,Number(d.period)||14),C=Math.max(.1,Number(d.mult)||2),M=l2(e.high,e.low,e.close,w),P=new Array(s),T=new Array(s);for(let N=0;N<s;N++){const L=M[N],O=e.close[N];P[N]=L!=null&&O!=null?O+C*L:void 0,T[N]=L!=null&&O!=null?O-C*L:void 0}e[m+"_upper"]=P,e[m+"_lower"]=T}else if(g==="zscore"){const w=Math.max(1,Number(d.period)||20),C=d.source||"close";e[m]=oS(e[C]||e.close,w)}else if(g==="volume_delta")e[m]=Ck(e.close,e.volume);else if(g==="cum_delta"){const w=Ck(e.close,e.volume);e[m]=N$(w)}else if(g==="vwap_bands"){const w=Math.max(1,Number(d.period)||20),C=Sk(e.close,e.volume),{upper:M,lower:P}=ow(Array.from(C).map(T=>T),w,Math.max(.1,Number(d.std)||2));e[m+"_mid"]=Array.from(C),e[m+"_upper"]=M,e[m+"_lower"]=P}else if(g==="linreg_channel"){const w=Math.max(1,Number(d.period)||20),C=d.source||"close",M=A$(e[C]||e.close,w);e[m+"_mid"]=M.mid,e[m+"_upper"]=M.upper,e[m+"_lower"]=M.lower}else if(g==="evwma"){const w=Math.max(1,Number(d.period)||20);e[m]=iS(e.close,e.volume,w)}else if(g==="sar"){const w=Math.max(.001,Number(d.step)||.02),C=Math.max(w,Number(d.max)||.2),M=e.high,P=e.low,T=new Array(s);let N=w,L=M[0],O=P[0],D=!0;for(let $=1;$<s;$++){const z=M[$]??NaN,te=P[$]??NaN;if(!Number.isFinite(z)||!Number.isFinite(te)){T[$]=void 0;continue}let pe=O;D?(pe=O+N*(L-O),z>L&&(L=z,N=Math.min(C,N+w)),pe>te&&(D=!1,pe=L,L=te,N=w)):(pe=O-N*(O-L),te<L&&(L=te,N=Math.min(C,N+w)),pe<z&&(D=!0,pe=L,L=z,N=w)),T[$]=pe,O=pe}T[0]=O,e.sar=T}else if(g==="stoch"){const w=Number(d.kPeriod)||14,C=Number(d.dPeriod)||3,M=[],P=[];for(let N=0;N<s;N++){const L=Math.max(0,N-w+1);let O=-1/0,D=1/0;for(let pe=L;pe<=N;pe++){const J=e.high[pe]??e.close[pe]??NaN,le=e.low[pe]??e.close[pe]??NaN;J>O&&(O=J),le<D&&(D=le)}const $=e.close[N]??NaN,z=O-D,te=z===0?void 0:100*(($-D)/z);M.push(te)}const T=b_(M.map(N=>N??NaN),C);for(let N=0;N<s;N++)P.push(isNaN(T[N])?void 0:T[N]);e[m+"_k"]=M,e[m+"_d"]=P}else if(g==="roc"){const w=d.source||"close",C=e[w]||e.close,M=Math.max(1,Number(d.period)||10),P=new Array(s);for(let T=0;T<s;T++){const N=C[T],L=C[T-M];N===void 0||L===void 0||L===0?P[T]=void 0:P[T]=(N/L-1)*100}e[m]=P}else if(g==="ichimoku"){const w=Math.max(1,Number(d.tenkan)||9),C=Math.max(1,Number(d.kijun)||26),M=Math.max(1,Number(d.senkouB)||52),P=C,T=new Array(s),N=new Array(s),L=new Array(s),O=new Array(s),D=new Array(s),$=new Array(s),z=new Array(s),te=e.high,pe=e.low,J=e.close,le=(de,he)=>{let ge=-1/0,ae=1/0;const Ie=Math.max(0,de-he+1);for(let ce=Ie;ce<=de;ce++){const je=te[ce]??J[ce]??NaN,Ve=pe[ce]??J[ce]??NaN;je>ge&&(ge=je),Ve<ae&&(ae=Ve)}return{hi:ge,lo:ae}};for(let de=0;de<s;de++){if(de>=w-1){const{hi:he,lo:ge}=le(de,w);T[de]=(he+ge)/2}if(de>=C-1){const{hi:he,lo:ge}=le(de,C);N[de]=(he+ge)/2}if(T[de]!==void 0&&N[de]!==void 0&&(L[de]=(T[de]+N[de])/2),de>=M-1){const{hi:he,lo:ge}=le(de,M);O[de]=(he+ge)/2}z[de]=de+P<s?J[de+P]:void 0}for(let de=0;de<s;de++)D[de]=de>=P?L[de-P]:void 0,$[de]=de>=P?O[de-P]:void 0;e.tenkan=T,e.kijun=N,e.spana=D,e.spanb=$,e.chikou=z}else if(g==="pivot_high"){const w=Math.max(0,Number(d.left)||3),C=Math.max(0,Number(d.right)||3),M=new Array(s);for(let P=0;P<s;P++){const T=e.high[P]??e.close[P]??NaN;if(!Number.isFinite(T)){M[P]=void 0;continue}let N=!0;const L=Math.max(0,P-w),O=Math.min(s-1,P+C);for(let D=L;D<=O;D++){if(D===P)continue;const $=e.high[D]??e.close[D]??NaN;if(!Number.isFinite($)){N=!1;break}if($>=T){N=!1;break}}M[P]=N?T:void 0}e[m]=M}else if(g==="pivot_low"){const w=Math.max(0,Number(d.left)||3),C=Math.max(0,Number(d.right)||3),M=new Array(s);for(let P=0;P<s;P++){const T=e.low[P]??e.close[P]??NaN;if(!Number.isFinite(T)){M[P]=void 0;continue}let N=!0;const L=Math.max(0,P-w),O=Math.min(s-1,P+C);for(let D=L;D<=O;D++){if(D===P)continue;const $=e.low[D]??e.close[D]??NaN;if(!Number.isFinite($)){N=!1;break}if($<=T){N=!1;break}}M[P]=N?T:void 0}e[m]=M}else if(g==="auto_fib"||g==="autofib"){const w=Math.max(2,Math.floor(a(d.lookback,`${m}_lookback`,200))),M=String(d.direction||"up").trim().toLowerCase()==="down"?"down":"up",P=String(d.method||d.mode||"extremes").trim().toLowerCase(),T=P==="pivots"||P==="pivot"||P==="swing"?"pivots":"extremes",N=Math.max(1,Math.floor(Number(d.pivotLeft??d.left??3))),L=Math.max(1,Math.floor(Number(d.pivotRight??d.right??3))),O=QZ(e.high,e.low,e.close,{lookback:w,direction:M,method:T,pivotLeft:N,pivotRight:L});e[`${m}_from`]=O.from,e[`${m}_to`]=O.to,e[`${m}_from_idx`]=O.fromIndex,e[`${m}_to_idx`]=O.toIndex,e[`${m}_0`]=O.lvl0,e[`${m}_50`]=O.lvl50,e[`${m}_100`]=O.lvl100}else if(g==="last_value"){const w=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),C=e[w]||e.close,M=new Array(s);let P;for(let T=0;T<s;T++){const N=C[T];N!=null&&Number.isFinite(N)&&(P=N),M[T]=P}e[m]=M,r[m]=w}else if(g==="prev_value"){const w=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),C=e[w]||e.close,M=new Array(s);let P,T;for(let N=0;N<s;N++){const L=C[N];if(L!=null&&Number.isFinite(L)){const O=L;(P===void 0||O!==P)&&(T=P,P=O)}M[N]=T}e[m]=M,r[m]=w}else if(g==="line_value"){const w=String(d.startValue||"").replace(/\s+/g,"_").toLowerCase(),C=String(d.endValue||"").replace(/\s+/g,"_").toLowerCase();let P=r[w]||r[C]||"";P||(/pl|low/i.test(w)||/pl|low/i.test(C)?P="pl":(/ph|high/i.test(w)||/ph|high/i.test(C))&&(P="ph"));const T=e[P],N=new Array(s);if(T){const L=[];for(let O=s-1;O>=0&&L.length<2;O--){const D=T[O];D!=null&&Number.isFinite(D)&&L.push(O)}if(L.reverse(),L.length===2){const O=L[0],D=L[1],$=T[O],z=T[D];if(Number.isFinite($)&&Number.isFinite(z)&&D!==O){const te=(z-$)/(D-O),pe=$-te*O,J=Math.max(1,Number(d.lookback)||s),le=Math.max(0,D-J);for(let de=0;de<s;de++)N[de]=de>=le?te*de+pe:void 0}}}e[m]=N}else if(g==="compare"){const w=String(d.left??"").trim(),C=String(d.right??"").trim(),M=String(d.op||">"),P=/^[-+]?\d+(?:\.\d+)?$/.test(w),T=/^[-+]?\d+(?:\.\d+)?$/.test(C),N=w.replace(/\s+/g,"_").toLowerCase(),L=C.replace(/\s+/g,"_").toLowerCase(),O=P?null:e[N]||e.close,D=T?null:e[L]||e.close,$=P?Number(w):NaN,z=T?Number(C):NaN,te=new Array(s);for(let pe=0;pe<s;pe++){const J=P?$:(O==null?void 0:O[pe])??NaN,le=T?z:(D==null?void 0:D[pe])??NaN;if(!Number.isFinite(J)||!Number.isFinite(le)){te[pe]=0;continue}let de=!1;switch(M){case">":de=J>le;break;case"<":de=J<le;break;case">=":de=J>=le;break;case"<=":de=J<=le;break;case"==":de=Math.abs(J-le)<1e-9;break;default:de=J>le;break}te[pe]=de?1:0}e[m]=te}else if(typeof d.expr=="string"&&String(d.expr).trim().length)try{const w={};Object.entries(e).forEach(([T,N])=>{const L=new Float32Array(s);for(let O=0;O<s;O++)L[O]=N[O]??NaN;w[T.replace(/\s+/g,"_").toLowerCase()]=L});const C=g_([{name:m,expr:u(String(d.expr).replace(/\$\{([^}]+)\}/g,(T,N)=>String(c[N]??T)))}],w,c),M=new Array(s),P=C[m];for(let T=0;T<s;T++){const N=P==null?void 0:P[T];M[T]=Number.isFinite(N)?N:void 0}e[m]=M}catch(w){if(l){const C=(w==null?void 0:w.message)!=null?String(w.message):String(w);l(`Expression error: ${C}`,w)}}}}}const B8=n=>/[A-Za-z_$]/.test(n),U_=n=>/[A-Za-z0-9_$]/.test(n),tJ=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?/,nJ=/[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,S5=(n,e)=>{let t=e;for(;t>=0&&/\s/.test(n[t]);)t-=1;return t},C5=(n,e)=>{let t=e;for(;t<n.length&&/\s/.test(n[t]);)t+=1;return t},sJ=(n,e)=>{let t=1;for(let s=e-1;s>=0;s-=1){const o=n[s];if(o===")")t+=1;else if(o==="("&&(t-=1,t===0))return s}return-1},I5=(n,e)=>{let t=1;for(let s=e+1;s<n.length;s+=1){const o=n[s];if(o==="(")t+=1;else if(o===")"&&(t-=1,t===0))return s}return-1},oJ=(n,e)=>{const t=S5(n,e-1);if(t<0)return null;const s=t+1,o=n[t];if(o===")"){const a=sJ(n,t);if(a<0)return null;let l=a,c=S5(n,l-1);if(c>=0&&U_(n[c])){let f=c;for(;f>=0&&U_(n[f]);)f-=1;l=f+1}return{start:l,end:s}}if(U_(o)){let a=t;for(;a-1>=0&&U_(n[a-1]);)a-=1;return{start:a,end:s}}const r=nJ.exec(n.slice(0,s));return r?{start:s-r[0].length,end:s}:null},iJ=(n,e)=>{let t=C5(n,e);if(t>=n.length)return null;const s=n[t];if(s==="("){const r=I5(n,t);return r<0?null:{start:t,end:r+1}}if(B8(s)){let r=t+1;for(;r<n.length&&U_(n[r]);)r+=1;const a=C5(n,r);if(n[a]==="("){const l=I5(n,a);return l<0?null:{start:t,end:l+1}}return{start:t,end:r}}const o=tJ.exec(n.slice(t));return o?{start:t,end:t+o[0].length}:null};function Qb(n){const e=String(n||""),t=e.length;if(!/crosses/i.test(e))return e;const s=[];let o=null,r=0;for(;r<t;){const c=e[r];if(o){c===o&&e[r-1]!=="\\"&&(o=null),r+=1;continue}if(c==="'"||c==='"'){o=c,r+=1;continue}if(B8(c)){let f=r+1;for(;f<t&&U_(e[f]);)f+=1;const d=e.slice(r,f).toLowerCase();if(d==="crossesabove"||d==="crossesbelow"){const h=oJ(e,r),m=iJ(e,f);if(h&&m){s.push({start:h.start,end:m.end,left:h,right:m,fn:d==="crossesabove"?"crossover":"crossunder"}),r=m.end;continue}}r=f;continue}r+=1}if(!s.length)return e;let a="",l=0;for(const c of s){a+=e.slice(l,c.start);const f=e.slice(c.left.start,c.left.end).trim(),u=e.slice(c.right.start,c.right.end).trim();a+=`${c.fn}(${f}, ${u})`,l=c.end}return a+=e.slice(l),a}function rJ(n){console.error("[ScriptStudio]",n)}function Mw(n,e){const t=o=>o.replace(/\$\{([^}]+)\}/g,(r,a)=>{const l=String(a),c=e[l];if(c==null)return r;if(typeof c=="number"&&Number.isFinite(c))return String(c);if(typeof c=="string")return c;try{return JSON.stringify(c)}catch{return String(c)}}),s=o=>{if(o==null)return o;if(typeof o=="string"){const r=o.match(/^\$\{([^}]+)\}$/);if(r){const a=String(r[1]),l=e[a];return l??o}return t(o)}if(Array.isArray(o))return o.map(s);if(typeof o=="object"){const r=Array.isArray(o)?[]:{};return Object.keys(o).forEach(a=>{const l=o[a];r[a]=s(l)}),r}return o};return s(n)}const P5=512;function aJ(n,e){const t=n.match(/^\$\{([^}]+)\}$/);if(t){const s=String(t[1]||"");if(Object.prototype.hasOwnProperty.call(e,s))return e[s]}return n.replace(/\$\{([^}]+)\}/g,(s,o)=>{const r=String(o||"");if(!Object.prototype.hasOwnProperty.call(e,r))return s;const a=e[r];return typeof a=="string"?a:String(a)})}function Nw(n,e){if(n==null)return n;if(typeof n=="string")return aJ(n,e);if(Array.isArray(n))return n.map(t=>Nw(t,e));if(typeof n=="object"){const t={};return Object.keys(n).forEach(s=>{t[s]=Nw(n[s],e)}),t}return n}function Aw(n){let e=0;const t=r=>{if(e+=r,e>P5)throw new Error(`Loop expansion exceeds ${P5} items`)},s=(r,a)=>{const l=r==null?void 0:r.repeat,c=r==null?void 0:r.forEach,f=r==null?void 0:r.template;if(!f||!l&&!c)return[];const u=[],d=m=>{const g=Nw(f,m),w=o(g,m);Array.isArray(w)?u.push(...w):u.push(w)},h=(m,g,w)=>{m.forEach((C,M)=>{const P={...a,[g]:C};w&&(P[w]=M),t(1),d(P)})};if(c&&typeof c=="object"){if(!Array.isArray(c.items))throw new Error("forEach.items must be an array");const m=String(c.var||"item"),g=c.indexVar?String(c.indexVar):void 0;return h(c.items,m,g),u}if(l&&typeof l=="object"){const m=String(l.var||"i"),g=l.indexVar?String(l.indexVar):void 0;if(Array.isArray(l.items))return h(l.items,m,g),u;if(l.count!=null){const M=Number(l.count);if(!Number.isFinite(M))throw new Error("repeat.count must be a number");const P=Math.max(0,Math.floor(M)),T=new Array(P).fill(0).map((N,L)=>L);return h(T,m,g),u}const w=Number(l.from),C=Number(l.to);if(Number.isFinite(w)&&Number.isFinite(C)){const M=l.step!=null?Number(l.step):w<=C?1:-1;if(!Number.isFinite(M))throw new Error("repeat.step must be a number");const P=M===0?w<=C?1:-1:M,T=[];if(P>0)for(let N=w;N<=C;N+=P)T.push(N);else for(let N=w;N>=C;N+=P)T.push(N);return h(T,m,g),u}throw new Error("repeat requires count or from/to")}return u},o=(r,a)=>{if(r==null)return r;if(Array.isArray(r)){const l=[];return r.forEach(c=>{if(c&&typeof c=="object"&&!Array.isArray(c)&&(c.repeat||c.forEach)){if(!c.template)throw new Error("Loop directive requires template");l.push(...s(c,a))}else l.push(o(c,a))}),l}if(typeof r=="object"){const l={};return Object.keys(r).forEach(c=>{l[c]=o(r[c],a)}),l}return r};return o(n,{})}function O2(n,e,t){if(n.save(),e&&(n.beginPath(),n.rect(e.left,e.top,e.width,e.height),n.clip()),t)try{t()}finally{n.restore()}}function M5(n,e,t,s,o,r){if(!e.length)return;const a=Math.max(1,s/2);O2(n,o,()=>{if(n.save(),!!(r&&(r.from||r.to))){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(const M of e)!Number.isFinite(M.x)||!Number.isFinite(M.y)||(M.x<c&&(c=M.x),M.x>f&&(f=M.x),M.y<u&&(u=M.y),M.y>d&&(d=M.y));const h=Number.isFinite(c)?c:o?o.left:0,m=Number.isFinite(f)&&f!==c?f:h+1,g=Number.isFinite(u)?u:o?o.top:0,w=Number.isFinite(d)&&d!==u?d:g+1,C=eh(n,{minX:h,maxX:m,minY:g,maxY:w},r,t);n.fillStyle=C??t}else n.fillStyle=t;for(let c=0;c<e.length;c++){const{x:f,y:u}=e[c];!Number.isFinite(f)||!Number.isFinite(u)||(n.beginPath(),n.arc(f,u,a,0,Math.PI*2),n.fill())}n.restore()})}function lJ(n,e,t,s,o,r,a,l){e.length&&O2(n,l,()=>{const c=Number.isFinite(t)?t:l?l.top+l.height:0,f=(h,m)=>{if(h<0||m<h)return;n.beginPath();let g=!1,w=null,C=null,M=0,P=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,N=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY;for(let D=h;D<=m;D++){const $=e[D];!Number.isFinite($.x)||!Number.isFinite($.y)||(g?n.lineTo($.x,$.y):(n.moveTo($.x,$.y),g=!0,w=$),C=$,M+=1,$.x<P&&(P=$.x),$.x>T&&(T=$.x),$.y<N&&(N=$.y),$.y>L&&(L=$.y))}if(!g||M<2||!w||!C)return;if(n.lineTo(C.x,c),n.lineTo(w.x,c),n.closePath(),n.save(),!!(o&&(o.from||o.to))){const D=Number.isFinite(P)?P:l?l.left:0,$=Number.isFinite(T)&&T!==P?T:D+1,z=Number.isFinite(N)?Math.min(N,c):c,te=Number.isFinite(L)?Math.max(L,c):c+1,pe=eh(n,{minX:D,maxX:$,minY:Number.isFinite(z)?z:0,maxY:Number.isFinite(te)&&te!==z?te:Number.isFinite(z)?z+1:1},o,s);n.fillStyle=pe??s}else n.fillStyle=s;n.fill(),n.restore(),r&&a>0};let u=-1,d=-1;for(let h=0;h<e.length;h++){const m=e[h];Number.isFinite(m.x)&&Number.isFinite(m.y)?(u===-1&&(u=h),d=h):u!==-1&&(f(u,d),u=-1,d=-1)}u!==-1&&f(u,d)})}function cJ(n,e,t,s,o,r){e.length&&O2(n,o,()=>{if(n.beginPath(),!!(r&&(r.from||r.to))){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(const M of e)!Number.isFinite(M.x)||!Number.isFinite(M.y)||(M.x<c&&(c=M.x),M.x>f&&(f=M.x),M.y<u&&(u=M.y),M.y>d&&(d=M.y));const h=Number.isFinite(c)?c:o?o.left:0,m=Number.isFinite(f)&&f!==c?f:h+1,g=Number.isFinite(u)?u:o?o.top:0,w=Number.isFinite(d)&&d!==u?d:g+1,C=eh(n,{minX:h,maxX:m,minY:g,maxY:w},r,t);n.strokeStyle=C??t}else n.strokeStyle=t;let l=!1;for(let c=0;c<e.length-1;c++){const f=e[c],u=e[c+1];!Number.isFinite(f.x)||!Number.isFinite(f.y)||!Number.isFinite(u.x)||!Number.isFinite(u.y)||(l||(n.moveTo(f.x,f.y),l=!0),n.lineTo(u.x,f.y),n.lineTo(u.x,u.y))}l&&(n.lineWidth=s,n.setLineDash([]),n.stroke())})}function Lx(n,e,t,s,o){!e.length||!t.length||O2(n,o,()=>{var a,l;n.beginPath();let r=0;for(;r<e.length&&!(Number.isFinite((a=e[r])==null?void 0:a.x)&&Number.isFinite((l=e[r])==null?void 0:l.y));)r++;if(!(r>=e.length)){for(n.moveTo(e[r].x,e[r].y);r<e.length;r++){const c=e[r];!Number.isFinite(c==null?void 0:c.x)||!Number.isFinite(c==null?void 0:c.y)||n.lineTo(c.x,c.y)}for(let c=t.length-1;c>=0;c--){const f=t[c];!Number.isFinite(f==null?void 0:f.x)||!Number.isFinite(f==null?void 0:f.y)||n.lineTo(f.x,f.y)}n.closePath(),n.save(),n.fillStyle=s,n.fill(),n.restore()}})}class O8{constructor(e){$e(this,"storage");$e(this,"runtime",null);$e(this,"events",{});$e(this,"state");$e(this,"symbolChangeCallbacks",new Set);$e(this,"currentSymbol",null);this.storage=e||MH,this.state=Fm({activeSaveId:null,savedLayouts:[],isLoading:!1,lastError:null,initialized:!1}),this.initialize()}async initialize(){try{this.updateState({isLoading:!0});const[e,t]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);this.updateState({activeSaveId:e,savedLayouts:t,isLoading:!1,lastError:null})}catch(e){console.error("Failed to initialize SaveManager:",e),this.updateState({isLoading:!1,lastError:"Failed to initialize save system"})}}setRuntimeContracts(e){this.runtime=e,this.runtime.onSymbolChange(this.handleSymbolChange.bind(this)),this.currentSymbol=this.runtime.getCurrentSymbol(),this.updateState({initialized:!0}),console.log("✅ SaveManager fully initialized and ready")}setEventHandlers(e){this.events={...this.events,...e}}async handleSymbolChange(e){this.currentSymbol,this.currentSymbol=e;const t=this.getState();if(t.activeSaveId&&this.runtime)try{const s=await this.storage.getSavedLayout(t.activeSaveId);if(s){this.runtime.clearAllDrawings();const o=s.drawingsBySymbol[e]||[];this.runtime.renderDrawings(o)}}catch(s){console.error("Failed to reload drawings for symbol change:",s)}this.symbolChangeCallbacks.forEach(s=>{try{s(e)}catch(o){console.error("Symbol change callback error:",o)}})}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}updateState(e){this.state.update(t=>({...t,...e}))}getState(){let e;return this.state.subscribe(t=>e=t)(),e}validateSaveName(e,t){return!e||e.trim().length===0?{valid:!1,error:"Name is required"}:e.length>100?{valid:!1,error:"Name must be 100 characters or less"}:this.getState().savedLayouts.some(r=>r.name===e&&r.id!==t)?{valid:!1,error:"Name already exists"}:{valid:!0}}async collectCurrentState(){if(!this.runtime)throw new Error("Runtime contracts not set");try{const e=this.runtime.getCurrentSymbol(),t=this.runtime.collectGlobalState(),s=this.runtime.collectDrawings(e);return{global:t,drawings:s,symbol:e}}catch(e){return console.error("Failed to collect chart state:",e),null}}async save(e){var t,s,o,r;try{this.updateState({isLoading:!0,lastError:null});const a=this.validateSaveName(e);if(!a.valid)return this.updateState({isLoading:!1,lastError:a.error}),{success:!1,error:a.error};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={name:e,timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{[l.symbol]:l.drawings}},f=await this.storage.createSavedLayout(c);await this.storage.setActiveSaveId(f.id);const u=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:f.id,savedLayouts:u,isLoading:!1}),(s=(t=this.events).onSaved)==null||s.call(t,f),{success:!0,layout:f}}catch(a){console.error("Save failed:",a);const l=a instanceof Error?a.message:"Save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}async quickSave(){var t,s,o,r;const e=this.getState();if(!e.activeSaveId)return this.updateState({isLoading:!1,lastError:"No active save to update"}),{success:!1,error:"No active save to update"};try{this.updateState({isLoading:!0,lastError:null});const a=await this.storage.getSavedLayout(e.activeSaveId);if(!a)return this.updateState({isLoading:!1,lastError:"Active save not found"}),{success:!1,error:"Active save not found"};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{...a.drawingsBySymbol,[l.symbol]:l.drawings}},f=await this.storage.updateSavedLayout(e.activeSaveId,c),u=await this.storage.listSavedLayouts();return this.updateState({savedLayouts:u,isLoading:!1}),(s=(t=this.events).onSaved)==null||s.call(t,f),{success:!0,layout:f}}catch(a){console.error("Quick save failed:",a);const l=a instanceof Error?a.message:"Quick save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}async saveTo(e){var t,s,o,r,a,l;try{this.updateState({isLoading:!0,lastError:null});const c=await this.collectCurrentState();if(!c)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const f=await this.storage.getSavedLayout(e),u={timezone:c.global.timezone,interval:c.global.interval,chartType:c.global.chartType,theme:c.global.theme,panes:c.global.panes,indicators:c.global.indicators,styles:c.global.styles,options:c.global.options,drawingsBySymbol:f?{...f.drawingsBySymbol,[c.symbol]:c.drawings}:{[c.symbol]:c.drawings}};if(!f){console.log("📝 Layout not found locally, creating new layout via API");const m={name:`Layout ${new Date().toLocaleString()}`,...u},g=await this.storage.createSavedLayout(m);await this.storage.setActiveSaveId(g.id);const w=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:g.id,savedLayouts:w,isLoading:!1}),(s=(t=this.events).onSaved)==null||s.call(t,g),{success:!0,layout:g}}const d=await this.storage.updateSavedLayout(e,u);await this.storage.setActiveSaveId(e);const h=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:e,savedLayouts:h,isLoading:!1}),(r=(o=this.events).onSaved)==null||r.call(o,d),{success:!0,layout:d}}catch(c){console.error("Save to existing failed:",c);const f=c instanceof Error?c.message:"Save failed";return this.updateState({isLoading:!1,lastError:f}),(l=(a=this.events).onError)==null||l.call(a,f),{success:!1,error:f}}}async saveAs(e){return this.save(e)}async load(e){var t,s,o,r,a,l,c,f,u,d,h,m;try{this.updateState({isLoading:!0,lastError:null}),console.log("🔄 Loading layout:",e);const g=await this.storage.getSavedLayout(e);if(!g)try{await this.refresh();const M=await this.storage.getSavedLayout(e);if(!M){const L=await this.storage.listSavedLayouts();if(L&&L.length>0){const O=L[0].id,D=await this.storage.getSavedLayout(O);if(D){if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:D.timezone,interval:D.interval,chartType:D.chartType,theme:D.theme,panes:D.panes,indicators:D.indicators,styles:D.styles,options:D.options});const $=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const z=D.drawingsBySymbol[$]||[];return this.runtime.renderDrawings(z),await this.storage.setActiveSaveId(D.id),this.updateState({activeSaveId:D.id,isLoading:!1}),(s=(t=this.events).onLoaded)==null||s.call(t,D),{success:!0}}}return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}const P=M;if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:P.timezone,interval:P.interval,chartType:P.chartType,theme:P.theme,panes:P.panes,indicators:P.indicators,styles:P.styles,options:P.options});const T=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const N=P.drawingsBySymbol[T]||[];return this.runtime.renderDrawings(N),await this.storage.setActiveSaveId(P.id),this.updateState({activeSaveId:P.id,isLoading:!1}),(r=(o=this.events).onLoaded)==null||r.call(o,P),{success:!0}}catch{return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}if(console.log("📊 Layout data loaded:",{name:g.name,indicatorCount:((a=g.indicators)==null?void 0:a.length)||0,indicators:((l=g.indicators)==null?void 0:l.map(M=>M.type))||[]}),!this.runtime)return console.error("❌ Runtime contracts not set"),this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};console.log("🔧 Applying global state with indicators:",((c=g.indicators)==null?void 0:c.length)||0),await this.runtime.applyGlobalState({timezone:g.timezone,interval:g.interval,chartType:g.chartType,theme:g.theme,panes:g.panes,indicators:g.indicators,styles:g.styles,options:g.options});const w=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const C=g.drawingsBySymbol[w]||[];return this.runtime.renderDrawings(C),await this.storage.setActiveSaveId(g.id),this.updateState({activeSaveId:g.id,isLoading:!1}),(u=(f=this.events).onLoaded)==null||u.call(f,g),console.log("✅ Layout loaded successfully:",{layoutId:g.id,name:g.name,indicatorsRestored:((d=g.indicators)==null?void 0:d.length)||0}),{success:!0}}catch(g){console.error("Load failed:",g);const w=g instanceof Error?g.message:"Load failed";return this.updateState({isLoading:!1,lastError:w}),(m=(h=this.events).onError)==null||m.call(h,w),{success:!1,error:w}}}async delete(e){var t,s,o,r;try{this.updateState({isLoading:!0,lastError:null}),await this.storage.deleteSavedLayout(e);const[a,l]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);return this.updateState({activeSaveId:a,savedLayouts:l,isLoading:!1}),(s=(t=this.events).onDeleted)==null||s.call(t,e),{success:!0}}catch(a){console.error("Delete failed:",a);const l=a instanceof Error?a.message:"Delete failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}hasActiveSave(){return this.getState().activeSaveId!==null}getActiveSaveId(){return this.getState().activeSaveId}async clearActiveSave(){await this.storage.setActiveSaveId(null),this.updateState({activeSaveId:null})}async refresh(){try{this.updateState({isLoading:!0});const e=await this.storage.listSavedLayouts();this.updateState({savedLayouts:e,isLoading:!1,lastError:null})}catch(e){console.error("Refresh failed:",e),this.updateState({isLoading:!1,lastError:"Failed to refresh layouts"})}}destroy(){this.runtime&&this.symbolChangeCallbacks.clear()}}new O8;const Ex="https://noti.dutyai.app/auth/chart/settings";class uJ{constructor(){$e(this,"localStorageProvider");$e(this,"initialized",!1);this.localStorageProvider=new $8}async initialize(){this.initialized||(await this.localStorageProvider.initialize(),this.initialized=!0)}hasUserId(){return!!Og()}getUserId(){return Og()}async saveToApi(e){const t=this.getUserId();if(!t)throw new Error("User ID not found in localStorage");if(e._source==="api"&&!e._isModified)return console.log("🔄 Skipping API save for unmodified API-loaded data"),{...e,_source:"api"};try{console.log(e,"layoutData");const s=e.id||this.generateApiId(),o={clerkId:t,settings:e,id:s};console.log("🌐 Sending to API:",o);const r=await fetch(Ex,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const l=await r.text();throw console.error("API error response:",l),new Error(`API request failed: ${r.status} ${r.statusText} - ${l}`)}const a=await r.json();return console.log("✅ API save successful:",a),{...e,id:a.id||s,createdAt:a.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(s){throw console.error("API save failed:",s),new Error("Failed to save to API")}}generateApiId(){return`api_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async loadFromApi(){var t;const e=this.getUserId();if(!e)throw new Error("User ID not found in localStorage");try{const s=`${Ex}/${e}`;console.log("🌐 API Request:",s);const o=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Response Status:",o.status,o.statusText),!o.ok)throw new Error(`API request failed: ${o.status} ${o.statusText}`);const r=await o.json();return console.log("🌐 API Response Data:",r),Array.isArray(r)?r.map(a=>{var l;return{id:a.id,name:((l=a.settings)==null?void 0:l.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...a.settings,_source:"api"}}):[{id:r.id,name:((t=r.settings)==null?void 0:t.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...r.settings,_source:"api"}]}catch(s){throw console.error("API load failed:",s),new Error("Failed to load from API")}}async deleteFromApi(e){if(!this.getUserId())throw new Error("User ID not found in localStorage");try{const s=`${Ex}/${e}`;console.log("🌐 API Delete Request:",s);const o=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Delete Response Status:",o.status,o.statusText),!o.ok)throw new Error(`API delete request failed: ${o.status} ${o.statusText}`);console.log("✅ Layout deleted successfully from API")}catch(s){throw console.error("API delete failed:",s),new Error("Failed to delete from API")}}async listSavedLayouts(){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Loading layouts from API (userId found)"),(await this.loadFromApi()).map(t=>({id:t.id,name:t.name||"Untitled Layout",createdAt:t.createdAt||new Date().toISOString(),updatedAt:t.updatedAt||new Date().toISOString()}))}catch(e){console.error("API load failed, falling back to localStorage:",e)}return console.log("💾 Loading layouts from localStorage (no userId or API failed)"),this.localStorageProvider.listSavedLayouts()}async getSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Loading specific layout from API");const s=(await this.loadFromApi()).find(o=>o.id===e);if(s)return s;console.log("📖 Layout not found in API response, falling back to localStorage")}catch(t){console.error("API load failed, falling back to localStorage:",t)}return this.localStorageProvider.getSavedLayout(e)}async createSavedLayout(e){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Saving to API (userId found)"),await this.saveToApi(e)}catch(t){console.error("API save failed, falling back to localStorage:",t)}return console.log("💾 Saving to localStorage (no userId or API failed)"),this.localStorageProvider.createSavedLayout(e)}async updateSavedLayout(e,t){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Updating via API (userId found)");try{const a=(await this.loadFromApi()).find(l=>l.id===e);if(a){console.log("📝 Layout found in API, updating via API");const l={...a,...t,_isModified:!0};return await this.saveToApi(l)}}catch(r){console.log("📖 Layout not found in API, checking localStorage:",r)}const s=await this.localStorageProvider.getSavedLayout(e);if(s){console.log("📝 Layout found in localStorage, updating via API");const r={...s,...t};return await this.saveToApi(r)}console.log("📝 Layout not found, creating new via API");const o={id:e,...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_isModified:!0};return await this.saveToApi(o)}catch(s){console.error("API update failed, falling back to localStorage:",s)}return console.log("💾 Updating in localStorage"),this.localStorageProvider.updateSavedLayout(e,t)}async deleteSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Deleting layout from API"),await this.deleteFromApi(e),console.log("✅ Layout deleted from API successfully");return}catch(t){console.error("API delete failed, falling back to localStorage:",t)}return console.log("💾 Deleting from localStorage"),this.localStorageProvider.deleteSavedLayout(e)}async getActiveSaveId(){return await this.initialize(),this.localStorageProvider.getActiveSaveId()}async setActiveSaveId(e){return await this.initialize(),this.localStorageProvider.setActiveSaveId(e)}async cleanup(){return await this.initialize(),this.localStorageProvider.cleanup()}}function dJ(n,e){Ld(e,!1);const t=tm(),s=()=>vl(r,"$save",t),o=()=>vl(a,"$chart",t),r=cd("save");cd("ctx");const a=cd("chart"),l=cd("drawingManager"),c=(()=>{try{return cd("saveRestoring")||null}catch{return null}})(),f=new uJ,u=new O8(f);let d=null,h=null;function m(){try{console.log("🧹 Clearing persisted chart cache to prevent showing unsaved changes...");const C=s(),M=C!=null&&C.key&&typeof C.key=="string"?C.key:"chart";if(typeof localStorage<"u"){const P=localStorage.getItem(M);if(P)try{const L=JSON.parse(P),O={key:L.key||M,theme:L.theme||"dark",symbol:L.symbol||"BINANCE:BTCUSDT",period:L.period||{timeframe:"1d",timespan:"day"}};localStorage.setItem(M,JSON.stringify(O)),console.log("✅ Cleared unsaved chart changes, kept basic settings")}catch(L){console.warn("⚠️ Could not parse stored chart, clearing completely:",L),localStorage.removeItem(M)}const T=`${M}_drawings`,N=`${M}_overlays`;localStorage.removeItem(T),localStorage.removeItem(N),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Persisted chart cache cleared successfully")}try{r.update(P=>{var L,O,D,$;const T=((O=(L=P.styles)==null?void 0:L.candle)==null?void 0:O.type)||"candle_solid",N=(($=(D=P.styles)==null?void 0:D.candle)==null?void 0:$.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};return P.styles={candle:{type:T,renko:N}},P.options={},P.saveInds={},P})}catch(P){console.warn("⚠️ Failed to clear in‑memory save styles/options:",P)}}catch(C){console.error("❌ Error clearing persisted chart cache:",C)}}Mh(async()=>{if(o())g(o());else{const C=a.subscribe(M=>{M&&(C(),g(M))})}});async function g(C){var M,P;try{let T=0;const N=20;for(;!l.get()&&T<N;)await new Promise(D=>setTimeout(D,100)),T+=1;const L=l.get();L?console.log("✅ DrawingManager is available for save system"):console.error("❌ DrawingManager not available after waiting");const O={getCurrentSymbol:()=>o5(s()),collectGlobalState:()=>wB(s(),C),collectDrawings:D=>{if(!L)return console.warn("⚠️ DrawingManager not available, returning empty drawings"),[];const $=L.getDrawingsForSymbol(D);return console.log(`📥 Collected ${$.length} drawings for symbol:`,D),$},applyGlobalState:async D=>await kB(D,r,C),clearAllDrawings:()=>{var D,$;L?L.hideRenderedDrawings():console.warn("⚠️ DrawingManager not available, cannot clear drawings");try{const z=((D=C==null?void 0:C.getOverlays)==null?void 0:D.call(C,{groupId:"drawing_tools"}))||[];for(const te of z)try{($=C==null?void 0:C.removeOverlay)==null||$.call(C,{id:te.id})}catch{}console.log("🗑️ Cleared chart overlays for drawing_tools group")}catch{}},renderDrawings:D=>{if(!L){console.warn("⚠️ DrawingManager not available, cannot render drawings");return}const $=o5(s());console.log(`🎨 Rendering ${D.length} drawings for symbol:`,$),L.setCurrentSymbol($),L.loadDrawingsForSymbol($,D)},onSymbolChange:D=>{h=hp(r,z=>D0(z.symbol)).subscribe(z=>{d!==null&&d!==z&&(console.log("🔄 Save system detected symbol change:",d,"->",z),D(z)),d=z})},offSymbolChange:D=>{h&&(h(),h=null)}};u.setRuntimeContracts(O),u.setEventHandlers({onSaved:()=>{try{gx()}catch{}},onLoaded:()=>{try{gx()}catch{}}}),typeof window<"u"&&(window.saveManager=u,window.forceRefreshChart=async()=>{console.log("🔄 Force refresh triggered from WebView parent"),await w()},window.clearChartCache=()=>{var D;console.log("🗑️ Clearing chart cache");try{const $=(D=s())!=null&&D.key&&typeof s().key=="string"?s().key:"chart";localStorage.removeItem($);const z=`${$}_drawings`;localStorage.removeItem(z);const te=`${$}_overlays`;localStorage.removeItem(te),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Chart cache cleared")}catch($){console.error("❌ Error clearing cache:",$)}});try{u.getActiveSaveId()&&(c==null||c.set(!0))}catch{}m();try{const D=(M=s())!=null&&M.key&&typeof s().key=="string"?s().key:"chart";(typeof localStorage<"u"?localStorage.getItem(`${D}.lastTimeframe`):null)||typeof localStorage<"u"&&localStorage.setItem(`${D}.lastTimeframe`,"1d")}catch{}await w();try{const D=(P=s())!=null&&P.key&&typeof s().key=="string"?s().key:"chart",$=typeof localStorage<"u"?localStorage.getItem(`${D}.lastTimeframe`):null;if($&&typeof $=="string"&&$.length>0){const z=$.slice(-1),te=parseInt($.slice(0,-1))||1,pe=z==="M"?"month":z==="w"?"week":z==="d"?"day":z==="h"?"hour":z==="m"?"minute":z==="s"?"second":"day",J=mp($);r.update(le=>(le.period={multiplier:te,timespan:pe,timeframe:$,secs:J},le))}}catch{}try{gx()}catch{}try{c==null||c.set(!1)}catch{}console.log("✅ Save system initialized successfully")}catch(T){console.error("❌ Failed to initialize save system:",T)}}async function w(){try{console.log("🔍 Starting automatic restoration process (WebView-safe)...");let C=null;try{C=Og()}catch{}if(C){console.log("🌐 User logged in, refreshing saved layouts from server...");try{await u.refresh(),console.log("✅ Saved layouts refreshed from server")}catch(N){console.warn("⚠️ Could not refresh saved layouts from server:",N)}}const M=u.getActiveSaveId();if(console.log("🔍 Active save ID found:",M),M){console.log("🔄 Restoring active saved data:",M);const N=await u.load(M);if(N.success){console.log("✅ Active saved data restored successfully:",M);return}else{console.warn("⚠️ Failed to restore active saved data:",N.error);try{await u.clearActiveSave(),console.log("🧹 Cleared stale activeSaveId after failed restore")}catch(L){console.warn("⚠️ Could not clear activeSaveId:",L)}}}let P=[];const T=u.state.subscribe(N=>{P=(N==null?void 0:N.savedLayouts)||[]});if(T&&T(),P&&P.length>0){const N=P[0];if(console.log("🧭 Auto-selecting first saved layout:",N==null?void 0:N.id,N==null?void 0:N.name),N!=null&&N.id){const L=await u.load(N.id);if(L.success){console.log("✅ First saved layout auto-restored and set active:",N.id);return}else console.warn("⚠️ Failed to auto-load chosen layout:",L.error)}}console.log("ℹ️ No saved layouts found, using default chart configuration")}catch(C){console.error("❌ Error restoring active saved data:",C)}}b0(()=>{h&&h(),u.destroy()}),_v(),Ed()}function fJ(n,e){e("cancel")}function pJ(n,e){e("confirm")}var mJ=Me('<div class="ucm-backdrop svelte-16egrl4"><div class="ucm-modal svelte-16egrl4" role="dialog" aria-modal="true" aria-labelledby="ucm-title"><div class="ucm-header svelte-16egrl4"><h2 id="ucm-title" class="svelte-16egrl4"> </h2></div> <div class="ucm-body svelte-16egrl4"><p> </p></div> <div class="ucm-actions svelte-16egrl4"><button class="btn btn-cancel svelte-16egrl4">Cancel</button> <button class="btn btn-confirm svelte-16egrl4">Confirm</button></div></div></div>');function hJ(n,e){Ld(e,!1);let t=pi(e,"show",8,!1),s=pi(e,"title",8,"Unsaved changes"),o=pi(e,"message",8,"You have unsaved changes. If you refresh, your changes will be lost.");const r=Hh();_v();var a=Yn(),l=tn(a);Ye(l,t,c=>{var f=mJ(),u=y(f),d=y(u),h=y(d),m=y(h,!0);_(h),_(d);var g=v(d,2),w=y(g),C=y(w,!0);_(w),_(g);var M=v(g,2),P=y(M);P.__click=[fJ,r];var T=v(P,2);T.__click=[pJ,r],_(M),_(u),_(f),Ne(()=>{tt(m,s()),tt(C,o())}),Y(c,f)}),Y(n,a),Ed()}Tp(["click"]);const vJ={lookbackPeriod:50,trendWeight:.3,momentumWeight:.25,volatilityWeight:.2,supportResistanceWeight:.15,volumeWeight:.1};function eg(n,e){return n.length<e?n[n.length-1]||0:n.slice(-e).reduce((s,o)=>s+o,0)/e}function $x(n,e){if(n.length===0)return 0;if(n.length<e)return eg(n,n.length);const t=2/(e+1);let s=eg(n.slice(0,e),e);for(let o=e;o<n.length;o++)s=(n[o]-s)*t+s;return s}function z8(n,e=14){if(n.length<e+1)return 50;const t=[];for(let c=1;c<n.length;c++)t.push(n[c]-n[c-1]);let s=0,o=0;for(let c=0;c<e;c++)t[c]>=0?s+=t[c]:o-=t[c];let r=s/e,a=o/e;for(let c=e;c<t.length;c++)t[c]>=0?(r=(r*(e-1)+t[c])/e,a=a*(e-1)/e):(r=r*(e-1)/e,a=(a*(e-1)-t[c])/e);return a===0?100:100-100/(1+r/a)}function gJ(n,e=14){if(n.length<2)return 0;const t=[];for(let s=1;s<n.length;s++){const o=n[s].high,r=n[s].low,a=n[s-1].close,l=Math.max(o-r,Math.abs(o-a),Math.abs(r-a));t.push(l)}return eg(t,Math.min(e,t.length))}function _J(n,e=3){if(n.length<10)return{support:[],resistance:[]};const t=n.map(a=>a.high),s=n.map(a=>a.low),o=[],r=[];for(let a=2;a<n.length-2;a++)t[a]>t[a-1]&&t[a]>t[a-2]&&t[a]>t[a+1]&&t[a]>t[a+2]&&o.push(t[a]),s[a]<s[a-1]&&s[a]<s[a-2]&&s[a]<s[a+1]&&s[a]<s[a+2]&&r.push(s[a]);return o.sort((a,l)=>l-a),r.sort((a,l)=>a-l),{resistance:o.slice(0,e),support:r.slice(0,e)}}function yJ(n){if(n.length<3)return{pattern:"none",bullish:!0,confidence:.5};const e=n[n.length-1],t=n[n.length-2],s=n[n.length-3],o=Math.abs(e.close-e.open),r=e.high-e.low,a=e.close>e.open,l=Math.abs(t.close-t.open),c=t.close>t.open;if(o>l*1.5){if(a&&!c)return{pattern:"bullish_engulfing",bullish:!0,confidence:.75};if(!a&&c)return{pattern:"bearish_engulfing",bullish:!1,confidence:.75}}if(o<r*.1)return{pattern:"doji",bullish:c,confidence:.4};const f=a?e.open-e.low:e.close-e.low,u=a?e.high-e.close:e.high-e.open;return f>o*2&&u<o*.5?{pattern:"hammer",bullish:!0,confidence:.65}:u>o*2&&f<o*.5?{pattern:"shooting_star",bullish:!1,confidence:.65}:a&&c&&s.close>s.open?{pattern:"three_white_soldiers",bullish:!0,confidence:.7}:!a&&!c&&s.close<s.open?{pattern:"three_black_crows",bullish:!1,confidence:.7}:{pattern:"none",bullish:a,confidence:.5}}function bJ(n){if(n.length<30)return{phase:"accumulation",confidence:.5};const e=n.slice(-30),t=e.map(u=>u.close),s=e.map(u=>u.volume||0),o=e.map(u=>u.high-u.low),r=(t[t.length-1]-t[0])/t.length,a=eg(s,s.length),l=eg(s.slice(-5),5),c=eg(o,o.length),f=eg(o.slice(-5),5);return Math.abs(r)<c*.1&&l<a*1.1&&f<c*1.1?{phase:"accumulation",confidence:.7}:r>c*.3&&l>a*1.2?{phase:"markup",confidence:.75}:Math.abs(r)<c*.15&&l>a*1.3&&(t[t.length-10]-t[0])/10>0?{phase:"distribution",confidence:.7}:r<-c*.3&&l>a*1.2?{phase:"markdown",confidence:.75}:{phase:"accumulation",confidence:.5}}function xJ(n){if(n.length<20)return{direction:"sideways",strength:.5};const e=n.map(D=>D.close),t=n.map(D=>D.high),s=n.map(D=>D.low),o=$x(e,9),r=$x(e,21),a=$x(e,Math.min(50,e.length)),l=e[e.length-1];let c="sideways",f=0,u=0;o>r?f++:u++,r>a?f++:u++,l>o?f++:u++;const d=t.slice(-5),h=s.slice(-5),m=d[d.length-1]>d[0],g=h[h.length-1]>h[0],w=d[d.length-1]<d[0],C=h[h.length-1]<h[0];m&&g?f+=2:w&&C&&(u+=2);const M=e.slice(-10),P=(M[M.length-1]-M[0])/M.length,T=eg(M,M.length),N=P/T*100;N>.15?f+=2:N<-.15&&(u+=2),f>u+1?c="up":u>f+1&&(c="down");const L=f+u,O=L>0?Math.abs(f-u)/L:.5;return{direction:c,strength:Math.min(O,1)}}function wJ(n){if(n.length<20)return{value:0,strength:.5};const e=n.map(c=>c.close),t=z8(e,14),s=(t-50)/50,o=(e[e.length-1]-e[e.length-10])/e[e.length-10],r=s*.6+o*10*.4,a=Math.max(-1,Math.min(1,r)),l=Math.abs(t-50)/50;return{value:a,strength:Math.min(l,1)}}function kJ(n){if(n.length<20)return{trend:"stable",relativeCurrent:1};const e=n.map(l=>l.volume||0),t=eg(e,Math.min(20,e.length)),s=eg(e.slice(-5),5),o=e[e.length-1],r=t>0?o/t:1;let a="stable";return s>t*1.2?a="increasing":s<t*.8&&(a="decreasing"),{trend:a,relativeCurrent:r}}function SJ(n,e={}){const t={...vJ,...e};if(n.length<10)return console.warn("Not enough historical data for prediction"),null;const s=n.slice(-t.lookbackPeriod),o=s[s.length-1];console.log("🔮 Predicting next candle from",s.length,"candles");const r=xJ(s);console.log("📈 Trend:",r);const a=wJ(s);console.log("⚡ Momentum:",a);const l=gJ(s,14),c=eg(s.map(Pt=>Pt.close),s.length),f=l/c*100;console.log("📊 Volatility (ATR%):",f.toFixed(2));const u=_J(s);console.log("🎯 Support/Resistance:",u);const d=kJ(s);console.log("📦 Volume:",d);const h=yJ(s);console.log("🎨 Pattern:",h);const m=bJ(s);console.log("🔄 Market Cycle:",m);let g=0;const w=(Math.random()-.5)*.8;g+=w;const C=z8(s.map(Pt=>Pt.close),14),M=C>70,P=C<30,T=r.strength>.7;let N=.15;if(M&&r.direction==="up"&&(N+=.25),P&&r.direction==="down"&&(N+=.25),T&&(N+=.15),Math.random()<N){console.log("🔄 REVERSAL DETECTED - Creating counter-trend candle");const Pt=.5+Math.random()*1.5;r.direction==="up"?g-=Pt:r.direction==="down"?g+=Pt:g+=(Math.random()>.5?1:-1)*Pt}else r.direction==="up"?g+=r.strength*t.trendWeight*1.5:r.direction==="down"?g-=r.strength*t.trendWeight*1.5:g+=(Math.random()-.5)*.6,g+=a.value*a.strength*t.momentumWeight*1.8;if(h.pattern!=="none"){const Pt=h.confidence*1.2;h.bullish?g+=Pt:g-=Pt,console.log(`🎯 Pattern impact: ${h.bullish?"+":"-"}${Pt.toFixed(2)}%`)}m.phase==="markup"?g+=m.confidence*.5:m.phase==="markdown"?g-=m.confidence*.5:m.phase==="distribution"?g-=m.confidence*.2:m.phase==="accumulation"&&(g+=m.confidence*.2);const O=Math.min(f/2,2)*t.volatilityWeight;let D=0;const $=o.close;for(const Pt of u.resistance)$>=Pt*.98&&$<=Pt*1.02&&(D-=.5);for(const Pt of u.support)$>=Pt*.98&&$<=Pt*1.02&&(D+=.5);if(g+=D*t.supportResistanceWeight*1.5,d.trend==="increasing"){const Pt=t.volumeWeight*.8;(g>0||g<0)&&(g*=1+Pt)}else d.trend==="decreasing"&&(g*=.85);const z=(Math.random()-.5)*O*2.5;if(g+=z,Math.random()<.05){const Pt=(Math.random()-.5)*3;g+=Pt,console.log("📰 Surprise move:",Pt.toFixed(2)+"%")}g=Math.max(-6,Math.min(6,g)),console.log("💹 Predicted change:",g.toFixed(2)+"%");const te=$*(g/100),pe=g>0;let J,le,de,he;const ge=f>2?.15:.05,Ie=Math.random()<ge?(Math.random()*.5+.2)*(pe?1:-1):0,ce=Math.abs(te),je=(Math.random()-.5)*.4,Ve=ce*(1+je);if(pe){J=$*(1+Ie/100),he=J+Ve;const Pt=Math.random();let St,st;Pt<.2?(St=l*(.05+Math.random()*.15),st=l*(.05+Math.random()*.15)):Pt<.4?(St=l*(.4+Math.random()*.5),st=l*(.1+Math.random()*.2)):Pt<.6?(St=l*(.05+Math.random()*.15),st=l*(.4+Math.random()*.6)):(St=l*(.15+Math.random()*.35),st=l*(.15+Math.random()*.35)),le=he+St,de=J-st}else{J=$*(1+Ie/100),he=J-Ve;const Pt=Math.random();let St,st;Pt<.2?(St=l*(.05+Math.random()*.15),st=l*(.05+Math.random()*.15)):Pt<.4?(St=l*(.4+Math.random()*.6),st=l*(.05+Math.random()*.15)):Pt<.6?(St=l*(.1+Math.random()*.2),st=l*(.4+Math.random()*.5)):(St=l*(.15+Math.random()*.35),st=l*(.15+Math.random()*.35)),le=J+St,de=he-st}const We=r.direction==="sideways"?.15:.05;if(Math.random()<We){he=J+(Math.random()-.5)*l*.1;const Pt=l*(.3+Math.random()*.4);le=Math.max(J,he)+Pt,de=Math.min(J,he)-Pt,console.log("🎲 Created Doji candle (indecision)")}le=Math.max(J,he,le),de=Math.min(J,he,de);const He=eg(s.map(Pt=>Pt.volume||0),20);eg(s.slice(-5).map(Pt=>Pt.volume||0),5);let Ue=He;const et=Math.min(Math.abs(g)/2,1.5);Ue*=.8+et*.4,d.trend==="increasing"?Ue*=1.1+Math.random()*.3:d.trend==="decreasing"?Ue*=.7+Math.random()*.2:Ue*=.85+Math.random()*.3,h.pattern==="bullish_engulfing"||h.pattern==="bearish_engulfing"?Ue*=1.2+Math.random()*.3:h.pattern==="doji"&&(Ue*=.7+Math.random()*.2),(m.phase==="distribution"||m.phase==="markdown")&&(Ue*=1.1+Math.random()*.2),Ue=Math.max(He*.3,Math.min(Ue,He*3));const ft=s.slice(-5).map((Pt,St,st)=>St>0?Pt.timestamp-st[St-1].timestamp:0).filter(Pt=>Pt>0),it=ft.length>0?eg(ft,ft.length):6e4,Tt={timestamp:o.timestamp+it,open:Math.round(J*100)/100,high:Math.round(le*100)/100,low:Math.round(de*100)/100,close:Math.round(he*100)/100,volume:Math.round(Ue)};return console.log("🎯 Predicted candle:",Tt),Tt}function CJ(n,e){return Date.now()-n>e*2}function IJ(){var n;try{(n=window.predictNextCandle)==null||n.call(window)}catch{}Xv(!0)}function PJ(n,e){(!(typeof window<"u")||window.confirm("Exit simulator?"))&&(e(),c6())}function MJ(n){const e=parseFloat(n.target.value);u6(e)}var NJ=Me('<button class="fc-btn svelte-u36ajg" type="button">Stop</button>'),AJ=Me('<button class="fc-btn svelte-u36ajg" type="button">Start</button>'),TJ=Me('<div class="floating-controls svelte-u36ajg"><div class="fc-content svelte-u36ajg"><div class="fc-header svelte-u36ajg"><div class="fc-title svelte-u36ajg">Simulator</div> <div class="fc-badge svelte-u36ajg"> </div></div> <div class="fc-row svelte-u36ajg"><input type="range" min="0.5" max="10" step="0.5" class="fc-range svelte-u36ajg"></div> <div class="fc-row svelte-u36ajg"><!> <button class="fc-btn fc-danger svelte-u36ajg" type="button">Exit</button></div></div></div>');function FJ(n,e){Ld(e,!0);const t=tm(),s=()=>vl(ih,"$simulator",t);let o=xe(20),r=xe(80),a=xe(!1),l=0,c=0;function f(w){const C="touches"in w?w.touches[0]:w;l=C.clientX-i(o),c=C.clientY-i(r),x(a,!0),window.addEventListener("mousemove",u),window.addEventListener("mouseup",d),window.addEventListener("touchmove",u,{passive:!0}),window.addEventListener("touchend",d)}function u(w){if(!i(a))return;const C="touches"in w?w.touches[0]:w;x(o,C.clientX-l),x(r,C.clientY-c)}function d(){x(a,!1),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",d)}function h(){var w;try{(w=window.stopPrediction)==null||w.call(window)}catch{}Xv(!1)}var m=Yn(),g=tn(m);Ye(g,()=>s().mode==="normal",w=>{var C=TJ(),M=y(C),P=y(M);P.__mousedown=f,P.__touchstart=f;var T=v(y(P),2),N=y(T);_(T),_(P);var L=v(P,2),O=y(L);mn(O),O.__input=[MJ],_(L);var D=v(L,2),$=y(D);Ye($,()=>s().playing,te=>{var pe=NJ();pe.__click=h,Y(te,pe)},te=>{var pe=AJ();pe.__click=[IJ],Y(te,pe)});var z=v($,2);z.__click=[PJ,h],_(D),_(M),_(C),Ne(()=>{Dt(C,"style",`left:${i(o)}px;top:${i(r)}px;`),tt(N,`${s().speed??""}x`),Hf(O,s().speed)}),Y(w,C)}),Y(n,m),Ed()}Tp(["mousedown","touchstart","input","click"]);const V8="scriptStudio.scripts";function wy(){try{const n=localStorage.getItem(V8);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch{return[]}}function ky(n){try{localStorage.setItem(V8,JSON.stringify(n))}catch{}}function e2(){return wy()}function Lb(n){ky(Array.isArray(n)?n:[])}function N5(n){const e=wy(),t=e.findIndex(s=>s.id===n.id);return t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),ky(e),n}function LJ(n,e,t){const s=wy(),o=Date.now(),a={id:`${o}`,name:n,code:e,tags:t||[],createdAt:o,updatedAt:o};return s.push(a),ky(s),a}function EJ(n,e){const t=wy(),s=t.findIndex(r=>r.id===n);if(s===-1)return null;const o={...t[s],...e,updatedAt:Date.now()};return t[s]=o,ky(t),o}function $J(n){const e=wy(),t=e.filter(s=>s.id!==n);return ky(t),t.length!==e.length}function DJ(n){let e="",t=null;for(let s=0;s<n.length;s++){const o=n[s],r=n[s+1];if(t){e+=o,o===t&&n[s-1]!=="\\"&&(t=null);continue}if(o==="'"||o==='"'){t=o,e+=o;continue}if(o==="/"&&r==="/")break;e+=o}return e.replace(/\s+$/,"")}function xr(n){const e=n.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function Kr(n){const e=[];let t="",s=0,o=0,r=0,a=null;for(let l=0;l<n.length;l++){const c=n[l];if(a){t+=c,c===a&&n[l-1]!=="\\"&&(a=null);continue}if(c==="'"||c==='"'){a=c,t+=c;continue}if(c==="("){s+=1,t+=c;continue}if(c===")"){s=Math.max(0,s-1),t+=c;continue}if(c==="{"){o+=1,t+=c;continue}if(c==="}"){o=Math.max(0,o-1),t+=c;continue}if(c==="["){r+=1,t+=c;continue}if(c==="]"){r=Math.max(0,r-1),t+=c;continue}if(c===","&&s===0&&o===0&&r===0){e.push(t.trim()),t="";continue}t+=c}return t.trim()&&e.push(t.trim()),e}function qc(n){const e={};for(const t of n){const s=t.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/);s&&(e[s[1]]=s[2].trim())}return e}let W8=!1,H8=!1;function uy(n){let e=n.trim();return e=e.replace(/\bta\./g,""),e=e.replace(/\bmath\./g,""),W8&&(e=e.replace(/\bsession\./g,"")),e=e.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),e=e.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(t,s,o)=>`${String(s).toLowerCase()}_${o}`),e=(()=>{const t=e;let s="",o=null,r=0;const a=c=>/[A-Za-z_$]/.test(c),l=c=>/[A-Za-z0-9_$]/.test(c);for(;r<t.length;){const c=t[r];if(o){s+=c,c===o&&t[r-1]!=="\\"&&(o=null),r+=1;continue}if(c==="'"||c==='"'){o=c,s+=c,r+=1;continue}if(a(c)){let f=r+1;for(;f<t.length&&l(t[f]);)f+=1;const u=t.slice(r,f);let d=r-1;for(;d>=0&&/\s/.test(t[d]);)d-=1;const h=d>=0&&t[d]===".";let m=f;for(;m<t.length&&/\s/.test(t[m]);)m+=1;if(h){s+=u,r=f;continue}if(t[m]==="["&&H8&&!h){let g=0,w=m,C=null;for(;w<t.length;w++){const M=t[w];if(C){M===C&&t[w-1]!=="\\"&&(C=null);continue}if(M==="'"||M==='"'){C=M;continue}if(M==="[")g+=1;else if(M==="]"&&(g-=1,g===0))break}if(w<t.length&&g===0){const M=t.slice(m+1,w).trim();if(M){s+=`prev(${u}, __hist_index(${M}))`,r=w+1;continue}}}else if(t[m]==="["){let g=m+1;for(;g<t.length&&/\s/.test(t[g]);)g+=1;let w=1;t[g]==="-"&&(w=-1,g+=1);let C=g;for(;C<t.length&&/[0-9]/.test(t[C]);)C+=1;const M=t.slice(g,C);for(;C<t.length&&/\s/.test(t[C]);)C+=1;if(M&&t[C]==="]"){const P=w*Number(M);if(Number.isFinite(P)&&P>=1){s+=`prev(${u}, ${Math.floor(P)})`,r=C+1;continue}if(Number.isFinite(P)&&P===0){s+=u,r=C+1;continue}}}s+=u,r=f;continue}s+=c,r+=1}return s})(),e}function D_(n){let e=uy(n);return e=e.replace(/\bcrossover\s*\(/gi,"crossover("),e=e.replace(/\bcrossunder\s*\(/gi,"crossunder("),e}function Iu(n){const e=n.trim();if(!e.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=/))return!1;const s=e.indexOf("=");if(s<0)return!1;const o=e[s-1]??"",r=e[s+1]??"";return!(o==="="||o==="!"||o==="<"||o===">"||r==="=")}function Xg(n){const e=n.trim().toLowerCase();return e==="true"?!0:e==="false"?!1:null}function Qm(n){const e=n.trim();if(!/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(e))return null;const t=Number(e);return Number.isFinite(t)?t:null}function RJ(n){const e=xr(String(n||"").trim()).toLowerCase();return e?e==="background"||e==="bg"?"background":e==="main"||e==="base"?"main":e==="overlay"||e==="over"?"overlay":e==="ui"?"ui":null:null}function Gg(n){if(n!=null)return RJ(n)??void 0}function Yg(n){if(n==null)return;const e=Qm(xr(String(n)));return e??void 0}function Kg(n){if(n==null)return;const e=xr(String(n)),t=Xg(e);if(t!=null)return t;const s=Qm(e);if(s!=null)return s!==0}function jJ(n){const e=String(n||"").trim().match(/^timestamp\s*\((.*)\)\s*$/i);if(!e)return null;const t=Kr(e[1]||"");if(!t.length)return null;const s=C=>{const M=Qm(xr(C));return M??null};let o=0,r=0;const a=xr(String(t[0]||"")).trim(),l=s(a);if(a&&l==null){const M=a.toUpperCase().match(/^(GMT|UTC)([+-]\d{1,2})?$/);if(M){const P=M[2]?Number(M[2]):0;Number.isFinite(P)&&(r=P*60),o=1}else{const P=Date.parse(a);return Number.isFinite(P)?P:null}}const c=s(t[o]||"");if(c==null)return null;const f=s(t[o+1]||"1")??1,u=s(t[o+2]||"1")??1,d=s(t[o+3]||"0")??0,h=s(t[o+4]||"0")??0,m=s(t[o+5]||"0")??0,g=s(t[o+6]||"0")??0,w=Date.UTC(c,Math.max(0,f-1),u,d,h,m,g);return Number.isFinite(w)?w-r*60*1e3:null}function A5(n){const e=xr(String(n||"").trim());if(!e)return;if(e.startsWith("#")||e.startsWith("rgb"))return e;const t=e.toLowerCase();if(t==="color.green"||t==="green")return"#16a34a";if(t==="color.red"||t==="red")return"#ef4444";if(t==="color.orange"||t==="orange")return"#f59e0b";if(t==="color.blue"||t==="blue")return"#3b82f6";if(t==="color.gray"||t==="gray"||t==="grey")return"#64748b";if(t==="color.white"||t==="white")return"#e2e8f0";if(t==="color.black"||t==="black")return"#0b1220"}function U0(n,e){if(!n||e==null||!Number.isFinite(e))return n;const t=Math.max(0,Math.min(100,e)),s=Math.max(0,Math.min(1,1-t/100)),o=n.trim();if(o.startsWith("#")){const a=o.slice(1),l=a.length===3?a.split("").map(c=>c+c).join(""):a.length===6?a:"";if(l){const c=parseInt(l.slice(0,2),16),f=parseInt(l.slice(2,4),16),u=parseInt(l.slice(4,6),16);if(Number.isFinite(c)&&Number.isFinite(f)&&Number.isFinite(u))return`rgba(${c},${f},${u},${s})`}}const r=o.match(/^rgba?\((.*)\)$/i);if(r){const a=r[1].split(",").map(l=>l.trim());if(a.length>=3){const l=Number(a[0]),c=Number(a[1]),f=Number(a[2]),u=a.length>=4?Number(a[3]):1;if([l,c,f,u].every(d=>Number.isFinite(d))){const d=Math.max(0,Math.min(1,u*s));return`rgba(${l},${c},${f},${d})`}}}return n}function BJ(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^shape\./,"").replace(/^label\./,"");if(t.includes("none"))return"none";if(t.includes("xcross"))return"xcross";if(t.includes("cross"))return"cross";if(t.includes("diamond"))return"diamond";if(t.includes("triangleup"))return"triangle_up_filled";if(t.includes("triangledown"))return"triangle_down_filled";if(t.includes("arrowup"))return"arrowUp";if(t.includes("arrowdown"))return"arrowDown";if(t.includes("circle"))return"circle";if(t.includes("square"))return"square";if(t.includes("flag"))return"flag";if(t.includes("tag"))return"tag";if(t.includes("pill"))return"pill";if(t.includes("label"))return"label"}function OJ(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^label\./,"").replace(/^style_/,"");return t.includes("none")?"text":t.includes("arrowup")?"arrowUp":t.includes("arrowdown")?"arrowDown":t.includes("triangleup")?"triangle_up_filled":t.includes("triangledown")?"triangle_down_filled":t.includes("circle")?"circle":t.includes("square")?"square":t.includes("xcross")?"xcross":t.includes("cross")?"cross":t.includes("diamond")?"diamond":t.includes("flag")?"flag":t.includes("tag")?"tag":t.includes("pill")?"pill":(t.includes("label"),"label")}function V1(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="auto")return 14;if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 18;if(t==="huge")return 22;const s=Qm(xr(e));if(s!=null)return Math.max(6,Math.min(64,s))}function T5(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 16;if(t==="huge")return 18}function u0(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^line\./,"").replace(/^style_/,"");if(t.includes("arrow")&&(t.includes("both")||t.includes("left_right")))return"arrow_both";if(t.includes("arrow")&&t.includes("left"))return"arrow_left";if(t.includes("arrow")&&t.includes("right"))return"arrow_right";if(t.includes("arrow")&&t.includes("none"))return"arrow_none";if(t.includes("dashed"))return"dashed";if(t.includes("dotted"))return"dotted";if(t.includes("solid"))return"solid"}function F5(n){const e=String(n||"").trim().toLowerCase();if(!e||e.startsWith("line."))return;const t=e.replace(/^plot\./,"").replace(/^style_/,"").replace(/^plot\.style_/,"");if(t.includes("histogram")||t.includes("columns"))return"histogram";if(t.includes("stepline")||t.includes("step"))return"stepped";if(t.includes("linebr"))return"line";if(t.includes("area"))return"area";if(t.includes("cross"))return"cross";if(t.includes("circles"))return"dots";if(t.includes("bar"))return"bar";if(t.includes("candles")||t.includes("candle"))return"candles";if(t.includes("ohlc"))return"ohlc";if(t.includes("line"))return"line"}function Dx(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^extend\./,"");if(t.includes("right"))return"right";if(t.includes("left"))return"left";if(t.includes("both"))return"both";if(t.includes("none"))return"none"}function d0(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^xloc\./,"");if(t.includes("bar_time")||t.includes("bartime")||t.includes("time"))return"time";if(t.includes("bar_index")||t.includes("barindex"))return"bar_index"}function u_(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^yloc\./,"");if(t.includes("above"))return"abovebar";if(t.includes("below"))return"belowbar";if(t.includes("price"))return"price"}function d_(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("left"))return"left";if(t.includes("right"))return"right";if(t.includes("center")||t.includes("middle"))return"center"}function W1(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("top"))return"top";if(t.includes("bottom"))return"bottom";if(t.includes("center")||t.includes("middle"))return"middle"}function L5(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^position\./,"");if(t.includes("top_left"))return"top_left";if(t.includes("top_right"))return"top_right";if(t.includes("top_center"))return"top_center";if(t.includes("bottom_left"))return"bottom_left";if(t.includes("bottom_right"))return"bottom_right";if(t.includes("bottom_center"))return"bottom_center";if(t.includes("middle_center")||t.includes("center"))return"middle_center"}function E5(n){const e=String(n||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^location\./,"");if(t.includes("absolute"))return"absolute";if(t.includes("above")||t.includes("top")||t.includes("high"))return"above";if(t.includes("below")||t.includes("bottom")||t.includes("low"))return"below"}function $5(n){const e=String(n||"").trim().toLowerCase();if(e){if(e.includes("on"))return"on";if(e.includes("off"))return"off"}}function D5(n){const e=String(n||"").toLowerCase().replace(/\s+/g,"");if(e){if(e.includes("onceperbarclose")||e.includes("perbarclose")||e.includes("barclose"))return"once_per_bar_close";if(e.includes("onceperbar")||e.includes("perbar")||e.includes("all"))return"once_per_bar";if(e.includes("once"))return"once"}}function R5(n){const e=String(n||"").trim(),t=e.match(/^(?:request\.)?security(?:_lower_tf)?\s*\((.*)\)\s*$/i);if(!t)return null;const s=e.toLowerCase().startsWith("request.security_lower_tf")||e.toLowerCase().startsWith("security_lower_tf"),o=Kr(t[1]||"");if(o.length<2)return null;const r=qc(o),a=o.filter(C=>!Iu(C)),l=a[0]!=null?String(a[0]).trim():"",c=xr(l),f=c&&c.toLowerCase()==="syminfo.tickerid"?"syminfo.tickerid":!(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(c)&&!/^\d+$/.test(c)?`\${${c}}`:c,u=a[1]!=null?String(a[1]).trim():"",d=xr(u),h=d&&d.toLowerCase()==="timeframe.period"?"__CURRENT__":!(u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(d)&&!/^\d+$/.test(d)?`\${${d}}`:d,m=a[2]!=null?uy(String(a[2])):"close",g=$5(String(r.lookahead??""))??(String(r.lookahead??"").toLowerCase().includes("lookahead_on")?"on":String(r.lookahead??"").toLowerCase().includes("lookahead_off")?"off":void 0),w=$5(String(r.gaps??""))??(String(r.gaps??"").toLowerCase().includes("gaps_on")?"on":String(r.gaps??"").toLowerCase().includes("gaps_off")?"off":void 0);return{symbol:f,country:r.country!=null?xr(String(r.country)):void 0,timeframe:h||"__CURRENT__",expr:m||"close",lookahead:g,gaps:w,lower:s}}function Tw(n){var $d,np,Pf;const e=[],t=[],s=new Set,o=new Set,r=!0;W8=r,H8=r;const a="williamsr length must be integer >= 1",l="aroon length must be integer >= 1",c="dmi length must be integer >= 1",f="dmi smoothing must be integer >= 1",u="adx length must be integer >= 1",d="plus_di length must be integer >= 1",h="minus_di length must be integer >= 1",m="dx length must be integer >= 1",g="aroonosc length must be integer >= 1",w="highest length must be integer >= 1",C="lowest length must be integer >= 1",M="sum length must be integer >= 1",P="rising length must be integer >= 1",T="falling length must be integer >= 1",N="valuewhen occurrence must be integer >= 0",L=oe=>{let we=0;for(let K=0;K<oe.length;K++){const re=oe[K];if(re===" ")we+=1;else if(re==="	")we+=2;else break}return we},O=oe=>{let we=0,K=null;for(let re=0;re<oe.length;re++){const ke=oe[re];if(K){ke===K&&oe[re-1]!=="\\"&&(K=null);continue}if(ke==="'"||ke==='"'){K=ke;continue}ke==="("?we+=1:ke===")"&&(we-=1)}return we},D=oe=>{const we=String(oe||"").split(/\r?\n/),K=[];let re="",ke=1,ee=0,Ee=0;for(let ht=0;ht<we.length;ht++){const pt=ht+1,Nt=DJ(we[ht]||""),E=Nt.trim();E&&(re||(ke=pt,Ee=L(Nt)),re=re?`${re} ${E}`:E,ee+=O(E),ee<=0&&(K.push({text:re.trim(),indent:Ee,lineNo:ke,loopSeq:!1}),re="",ee=0,Ee=0))}return re.trim()&&K.push({text:re.trim(),indent:Ee,lineNo:ke,loopSeq:!1}),K};let $=D(n);const z=oe=>{const we=xr(String(oe||"").trim());if(!we)return null;const K=we.split("/").filter(Boolean);if(!K.length)return null;for(let re=K.length-1;re>=0;re--){const ke=K[re];if(!/^\d+$/.test(ke))return ke}return K[0]||null},te=oe=>oe.replace(/^\s*export\s+/i,""),pe=(oe,we)=>{const K=[];let re=0,ke=null;const ee=ht=>/[A-Za-z_$]/.test(ht),Ee=ht=>/[A-Za-z0-9_$]/.test(ht);for(;re<oe.length;){const ht=oe[re];if(ke){K.push(ht),ht===ke&&oe[re-1]!=="\\"&&(ke=null),re+=1;continue}if(ht==="'"||ht==='"'){ke=ht,K.push(ht),re+=1;continue}if(ee(ht)){let pt=re+1;for(;pt<oe.length&&Ee(oe[pt]);)pt+=1;const Nt=oe.slice(re,pt);K.push(we[Nt]||Nt),re=pt;continue}K.push(ht),re+=1}return K.join("")},J=oe=>{const we=oe.toLowerCase();return!!(/tradingview\/ta(\/|$)/.test(we)||/tradingview\/math(\/|$)/.test(we)||/tradingview\/str(\/|$)/.test(we))},le=oe=>{const we=xr(String(oe||"").trim());if(!we)return{error:"import path is empty"};if(typeof window>"u")return{error:`import "${we}" is only supported in browser (local library cache)`};const K=e2(),re=ht=>{if(typeof ht=="string"){const pt=ht.trim();if(pt.startsWith("{")&&pt.includes('"script"')){try{const E=JSON.parse(pt);if(E&&typeof E=="object"&&typeof E.script=="string")return E.script}catch{}const Nt=pt.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if(Nt&&Nt[1])try{return JSON.parse(`"${Nt[1]}"`)}catch{}}return ht}if(ht&&typeof ht=="object"){const pt=ht.script??ht.code;if(typeof pt=="string")return pt}return String(ht||"")},ke=z(we)||we,ee=ht=>K.filter(pt=>pt.name===ht).sort((pt,Nt)=>(Nt.updatedAt||0)-(pt.updatedAt||0))[0],Ee=ee(we)||ee(ke);return Ee?{code:re(Ee.code),name:Ee.name}:{error:`library "${we}" not found in saved scripts`}},de=oe=>{const we=/^\s*export\s+/i.test(oe),K=te(oe).trim();if(!K||/^(import|library|indicator|study|strategy)\b/i.test(K))return null;const re=K.match(/^\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>/);if(re)return{name:re[1],exported:we};const ke=K.match(/^(?:varip\s+|var\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)/i);return ke?{name:ke[1],exported:we}:null},he=(oe,we,K,re,ke)=>{if(re>6)return e.push({message:`import "${we}" exceeded max depth`,line:1}),{lines:[],exports:new Set};const ee=D(oe),Ee=[],ht=new Set,pt=new Set;let Nt=!1;for(const me of ee){const Le=me.text.trim(),ye=Le.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(ye){const Ge=ye[1]||"",Ae=ye[2]||z(Ge)||"";Ae&&Ee.push({path:Ge,alias:Ae,lineNo:me.lineNo});continue}if(/^library\s*\(/i.test(Le))continue;const Se=de(Le);Se&&(ht.add(Se.name),Se.exported&&(pt.add(Se.name),Nt=!0))}const E=Nt?pt:new Set(ht),I={},W=[];for(const me of Ee){const Le=me.alias,ye=xr(me.path);if(!Le){e.push({message:`import "${ye}" needs an alias`,line:me.lineNo});continue}if(J(ye)){I[Le]="";continue}if(ke.includes(ye)){e.push({message:`cyclic import detected: ${ke.join(" -> ")} -> ${ye}`,line:me.lineNo});continue}const Se=le(ye);if(Se.error||!Se.code){e.push({message:Se.error||`library "${ye}" not found`,line:me.lineNo});continue}const Ge=`${K}${Le}__`;I[Le]=Ge;const Ae=he(Se.code,Le,Ge,re+1,[...ke,ye]);W.push(...Ae.lines)}const Z={};ht.forEach(me=>{Z[me]=`${K}${me}`});const _e=[];for(const me of ee){const Le=me.text.trim();if(!Le||/^import\b/i.test(Le)||/^library\s*\(/i.test(Le))continue;let ye=te(me.text);Object.entries(I).forEach(([Se,Ge])=>{if(!Se)return;const Ae=new RegExp(`\\b${Se}\\.`,"gi");ye=ye.replace(Ae,Ge)}),ye=pe(ye,Z),_e.push({...me,text:ye})}return{lines:[...W,..._e],exports:E}},ge={},ae=[],Ie=[];for(const oe of $){const K=oe.text.trim().match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(K){const re=K[1]||"",ke=K[2]||z(re)||"",ee=xr(re);if(!ke){e.push({message:`import "${ee}" needs an alias`,line:oe.lineNo});continue}if(ge[ke]){e.push({message:`import alias "${ke}" already used`,line:oe.lineNo});continue}if(J(ee)){ge[ke]={replacement:"",exports:new Set};continue}const Ee=le(ee);if(Ee.error||!Ee.code){e.push({message:Ee.error||`library "${ee}" not found`,line:oe.lineNo});continue}const ht=`__lib_${ke}__`,pt=he(Ee.code,ke,ht,1,[ee]);ae.push(...pt.lines),ge[ke]={replacement:ht,exports:pt.exports};continue}Ie.push(oe)}$=[...ae,...Ie];let ce="main";for(const oe of $){const we=oe.text.trim().match(/^(indicator|study)\s*\((.*)\)\s*$/i);if(!we)continue;const K=Kr(we[2]||""),ke=qc(K).overlay;if(ke!=null){const ee=Xg(xr(String(ke)));ee==null?e.push({message:"indicator overlay must be true or false",line:oe.lineNo}):ce=ee?"main":"sub"}else ce="sub";break}const je=[{pane:"main",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]}],Ve=[],We=[],He={},Ue=[],et=[],ft={},it=[],Lt={},Tt={};let Pt=null;const St={},st={},xt={},Je={},Xe={},Be={};let Qe=0;const ct=(oe,we)=>{const K=we.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase(),re=K?`__sec_${K}`:"__sec";let ke=re,ee=1;const Ee=ht=>Ve.some(pt=>String((pt==null?void 0:pt.name)||"").toLowerCase()===ht.toLowerCase())||Ue.some(pt=>String((pt==null?void 0:pt.name)||"").toLowerCase()===ht.toLowerCase());for(;Ee(ke);)ee+=1,ke=`${re}_${ee}`;return Ue.push({name:ke,type:"security",symbol:oe.symbol,country:oe.country,timeframe:oe.timeframe,expr:oe.expr,lookahead:oe.lookahead,gaps:oe.gaps,lower:oe.lower}),ke},Mt=(oe,we)=>{const K=String(oe||"");let re="",ke=0,ee=null;const Ee=K.toLowerCase();for(;ke<K.length;){const ht=K[ke];if(ee){re+=ht,ht===ee&&K[ke-1]!=="\\"&&(ee=null),ke+=1;continue}if(ht==="'"||ht==='"'){ee=ht,re+=ht,ke+=1;continue}const pt=Ee.slice(ke),Nt=pt.startsWith("request.security_lower_tf"),E=!Nt&&pt.startsWith("request.security"),I=!Nt&&!E&&pt.startsWith("security_lower_tf")&&(ke===0||!/[a-z0-9_$]/i.test(Ee[ke-1]||"")),W=!Nt&&!E&&!I&&pt.startsWith("security")&&(ke===0||!/[a-z0-9_$]/i.test(Ee[ke-1]||""));if(Nt||E||I||W){let _e=ke+(Nt?25:E?16:I?17:8);for(;_e<K.length&&/\s/.test(K[_e]);)_e+=1;if(K[_e]!=="("){re+=ht,ke+=1;continue}let me=0,Le=_e,ye=null;for(;Le<K.length;Le++){const Rt=K[Le];if(ye){Rt===ye&&K[Le-1]!=="\\"&&(ye=null);continue}if(Rt==="'"||Rt==='"'){ye=Rt;continue}if(Rt==="(")me+=1;else if(Rt===")"&&(me-=1,me===0))break}if(Le>=K.length){re+=K.slice(ke);break}const Se=K.slice(ke,Le+1),Ge=R5(Se);if(!Ge){re+=Se,ke=Le+1;continue}Qe+=1;const Ae=ct(Ge,`${we}_${Qe}`);re+=Ae,ke=Le+1;continue}re+=ht,ke+=1}return re};if(!/(^\s*\/\/@\s*pine)|(^\s*\/\/@\s*version)|\b(strategy|indicator|study)\s*\(/m.test(n))return{ok:!1,errors:[{message:"Not a Pine script",line:1}]};const Ce=()=>{je.some(oe=>oe.pane==="sub")||je.push({pane:"sub",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]})},Te=oe=>(oe==="sub"&&Ce(),je.find(we=>we.pane===oe)||je[0]),It=oe=>{const we=String(oe||"").trim();return!we||/[+\-*/%]/.test(we)?!1:!!(/\b(crossover|crossunder|between|above|below)\s*\(/i.test(we)||/\bcrosses(Above|Below)\b/i.test(we)||/[<>]=?|==|!=/.test(we)||/\b(and|or|not)\b/i.test(we)||/^\s*true\s*$|^\s*false\s*$/i.test(we))},$t=oe=>String(oe||"").trim().replace(/\s+/g,"_").toLowerCase(),Yt=new Set,qn=(oe,we)=>{const K=`${we??"?"}:${oe}`;Yt.has(K)||(Yt.add(K),e.push({message:oe,line:we??1}))},Vn=oe=>{var Ge;if(oe.bodyPlan)return oe.bodyPlan;const we=/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i,K=(Ae,Rt)=>co(String(Ae||"").trim(),Rt),re=Ae=>{for(const Rt of Ae){if(Rt.kind==="return")return!0;if(Rt.kind==="if"){for(const nn of Rt.branches)if(re(nn.body))return!0}if((Rt.kind==="for"||Rt.kind==="while")&&re(Rt.body))return!0}return!1},ke=(Ae,Rt,nn)=>{let Xn=null;for(let hn=Rt;hn<Ae.length;hn++){const is=Ae[hn];if(is.indent<=nn)break;const Gs=String(is.text||"").trim();!Gs||Gs.startsWith("//")||(Xn=is.lineNo)}return Xn},ee=(Ae,Rt,nn,Xn,hn)=>{var Mi,Kn;const is=[],Gs=Es=>Xn.some(Qo=>$t(Qo)===$t(Es));let es=Rt;for(;es<Ae.length;){const Es=Ae[es];if(Es.indent<=nn)break;const Qo=String(Es.text||"").trim();if(!Qo||Qo.startsWith("//")){es+=1;continue}gn=Es.lineNo;const sr=Qo.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(sr){const gi=sr[3],Dr=Qo.includes(":=")?":=":"=",Yi=String(sr[4]??sr[5]??"").trim(),Ki=Es.indent,Xi=[];let ca=es+1;for(;ca<Ae.length&&Ae[ca].indent>Ki;){const dn=Ae[ca].text.trim(),uo=dn.indexOf("=>");if(uo>=0){const zs=dn.slice(0,uo).trim(),Hr=dn.slice(uo+2).trim();Xi.push({cond:zs||void 0,expr:Hr||void 0,lineNo:Ae[ca].lineNo})}ca+=1}if(!Xi.length){qn("switch requires at least one case",Es.lineNo),es+=1;continue}const Jt=Yi?co(Yi,`fn_switch_${gi}`):"";let rn="na";for(let dn=Xi.length-1;dn>=0;dn--){const uo=Xi[dn],zs=uo.expr?co(uo.expr,`fn_switch_${gi}_case`):"na";if(!uo.cond){rn=zs;continue}rn=`iff(${Jt?`(${Jt}) == (${co(uo.cond,`fn_switch_${gi}_cond`)})`:`(${co(uo.cond,`fn_switch_${gi}_cond`)})`}, ${zs}, ${rn})`}Ae.splice(es,ca-es,{text:`${gi} ${Dr} ${rn}`,indent:Ki,lineNo:Es.lineNo});continue}const na=Qo.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(na){const gi=hn!=null&&Es.lineNo===hn,Dr=String(na[1]??na[2]??"").trim(),Yi=Es.indent,Ki=[];let Xi=es+1;for(;Xi<Ae.length&&Ae[Xi].indent>Yi;){const rn=Ae[Xi].text.trim(),dn=rn.indexOf("=>");if(dn>=0){const uo=rn.slice(0,dn).trim(),zs=rn.slice(dn+2).trim();Ki.push({cond:uo||void 0,expr:zs||void 0,lineNo:Ae[Xi].lineNo})}Xi+=1}if(!Ki.length){qn("switch requires at least one case",Es.lineNo),es+=1;continue}const ca=Dr?co(Dr,"fn_switch_expr"):"";if(gi){const rn=[];Ki.forEach(dn=>{if(!dn.expr)return;const uo=dn.cond?ca?`(${ca}) == (${co(dn.cond,"fn_switch_cond")})`:`(${co(dn.cond,"fn_switch_cond")})`:void 0;rn.push({cond:uo,body:[{kind:"return",expr:K(dn.expr,`${oe.name}_return`),lineNo:dn.lineNo}],lineNo:dn.lineNo})}),rn.some(dn=>dn.cond==null)||rn.push({cond:void 0,body:[{kind:"return",expr:"na",lineNo:Es.lineNo}],lineNo:Es.lineNo}),is.push({kind:"if",lineNo:Es.lineNo,branches:rn}),es=Xi;continue}const Jt=[];Ki.forEach((rn,dn)=>{if(rn.expr){if(!rn.cond)Jt.push({text:"else",indent:Yi,lineNo:rn.lineNo});else if(dn===0){const uo=ca?`(${ca}) == (${co(rn.cond,"fn_switch_cond")})`:`(${co(rn.cond,"fn_switch_cond")})`;Jt.push({text:`if (${uo})`,indent:Yi,lineNo:rn.lineNo})}else{const uo=ca?`(${ca}) == (${co(rn.cond,"fn_switch_cond")})`:`(${co(rn.cond,"fn_switch_cond")})`;Jt.push({text:`else if (${uo})`,indent:Yi,lineNo:rn.lineNo})}Jt.push({text:rn.expr,indent:Yi+1,lineNo:rn.lineNo})}}),Ae.splice(es,Xi-es,...Jt);continue}if(Qo==="break"){is.push({kind:"break",lineNo:Es.lineNo}),es+=1;continue}if(Qo==="continue"){is.push({kind:"continue",lineNo:Es.lineNo}),es+=1;continue}if(/^return\b/i.test(Qo)){const gi=Qo.replace(/^return\b/i,"").trim();gi?is.push({kind:"return",expr:K(gi,`${oe.name}_return`),lineNo:Es.lineNo}):(qn(`Function "${oe.name}" return requires an expression`,Es.lineNo),is.push({kind:"return",expr:"na",lineNo:Es.lineNo})),es+=1;continue}const Xr=Qo.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(Xr){const gi=hn!=null&&Es.lineNo===hn,Dr=Es.indent,Yi=[],Ki=String(Xr[1]??Xr[2]??"").trim();gn=Es.lineNo;const Xi=Ki?co(Ki,`fn_if_${oe.name}`):"",ca=gi?ke(Ae,es+1,Dr):null,Jt=ee(Ae,es+1,Dr,Xn,ca);gi&&!re(Jt.ops)&&Jt.ops.push({kind:"return",expr:"na",lineNo:Es.lineNo}),Yi.push({cond:Xi||void 0,body:Jt.ops,lineNo:Es.lineNo});let rn=Jt.nextIdx;for(;rn<Ae.length&&Ae[rn].indent===Dr;){const dn=String(Ae[rn].text||"").trim(),uo=dn.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(uo){const zs=String(uo[1]??uo[2]??"").trim();gn=Ae[rn].lineNo;const Hr=zs?co(zs,`fn_if_${oe.name}`):"",Ul=gi?ke(Ae,rn+1,Dr):null,Oi=ee(Ae,rn+1,Dr,Xn,Ul);gi&&!re(Oi.ops)&&Oi.ops.push({kind:"return",expr:"na",lineNo:Ae[rn].lineNo}),Yi.push({cond:Hr||void 0,body:Oi.ops,lineNo:Ae[rn].lineNo}),rn=Oi.nextIdx;continue}if(/^else$/i.test(dn)){const zs=gi?ke(Ae,rn+1,Dr):null,Hr=ee(Ae,rn+1,Dr,Xn,zs);gi&&!re(Hr.ops)&&Hr.ops.push({kind:"return",expr:"na",lineNo:Ae[rn].lineNo}),Yi.push({cond:void 0,body:Hr.ops,lineNo:Ae[rn].lineNo}),rn=Hr.nextIdx}break}is.push({kind:"if",lineNo:Es.lineNo,branches:Yi}),es=rn;continue}const Uu=Qo.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(Uu){const gi=Uu[1],Dr=String(Uu[2]??"").trim(),Yi=String(Uu[3]??"").trim(),Ki=String(Uu[4]??"1").trim();gn=Es.lineNo;const Xi=co(Dr,`fn_for_${gi}`),ca=co(Yi,`fn_for_${gi}`),Jt=co(Ki,`fn_for_${gi}`),rn=ee(Ae,es+1,Es.indent,[...Xn,gi],null);rn.nextIdx===es+1&&qn(`Function "${oe.name}" for-loop requires an indented body`,Es.lineNo),is.push({kind:"for",lineNo:Es.lineNo,varName:gi,startExpr:Xi,endExpr:ca,stepExpr:Jt,body:rn.ops}),es=rn.nextIdx;continue}const xd=Qo.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(xd){const gi=String(xd[1]??xd[2]??"").trim();gn=Es.lineNo;const Dr=co(gi,`fn_while_${oe.name}`),Yi=ee(Ae,es+1,Es.indent,Xn,null);Yi.nextIdx===es+1&&qn(`Function "${oe.name}" while-loop requires an indented body`,Es.lineNo),is.push({kind:"while",lineNo:Es.lineNo,condExpr:Dr,body:Yi.ops}),es=Yi.nextIdx;continue}const ul=Qo.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(ul){const gi=String(ul[1]||"").toLowerCase(),Dr=Kr(ul[2]||""),Yi=String(Dr[0]||"").trim(),Ki=$t(Yi);if(!Yi){qn(`array.${gi} requires array name`,Es.lineNo),es+=1;continue}if(!!xt[Ki]||((Mi=Je[Ki])==null?void 0:Mi.kind)==="string"){qn(`array.${gi} on string arrays is not supported inside functions`,Es.lineNo),es+=1;continue}if(!Je[Ki]&&!st[Ki]){qn(`array.${gi} unknown array "${Yi}"`,Es.lineNo),es+=1;continue}if(!Je[Ki]&&st[Ki]&&jo(Ki,st[Ki].length,st[Ki]),gi==="push"||gi==="unshift"||gi==="insert"){const rn=Je[Ki];if(rn){const dn=Math.min(bs,Math.max(rn.capacity,rn.size+ro));ar(Ki,dn)}}if(gi==="resize"){const rn=Je[Ki];if(rn){const dn=String(Dr[1]||"0"),uo=Is(dn);if(uo!=null){const zs=Math.min(bs,Math.max(rn.capacity,Math.floor(uo)));ar(Ki,zs)}}}ja(Ki);const ca={};gi==="push"||gi==="unshift"?ca.value=Dr[1]:gi==="insert"?(ca.index=Dr[1],ca.value=Dr[2]):gi==="remove"?ca.index=Dr[1]:gi==="resize"&&(ca.size=Dr[1]);const Jt=nc(Ki,gi,ca,Es.lineNo);if(!Jt){es+=1;continue}Jt.forEach(rn=>{is.push({kind:"assign",name:rn.name,op:rn.op,expr:rn.rhs,lineNo:rn.lineNo})}),es+=1;continue}const dr=Qo.match(/^array\.set\s*\((.*)\)\s*$/i);if(dr){const gi=Kr(dr[1]||""),Dr=String(gi[0]||"").trim(),Yi=String(gi[1]||"").trim(),Ki=String(gi[2]||"").trim();if(!Dr||!Yi||!Ki){qn("array.set(name, index, value) requires 3 args",Es.lineNo),es+=1;continue}const Xi=$t(Dr);if(!Je[Xi]&&!st[Xi]&&!xt[Xi]){qn(`array.set unknown array "${Dr}"`,Es.lineNo),es+=1;continue}if(xt[Xi]){qn("array.set on string arrays is not supported inside functions",Es.lineNo),es+=1;continue}!Je[Xi]&&st[Xi]&&jo(Xi,st[Xi].length,st[Xi]);const ca=co(Yi,`${Xi}_idx`),Jt=hi(ca),rn=co(Ki,`${Xi}_set`),dn=(Kn=Je[Xi])==null?void 0:Kn.sizeSeries,uo=dn!=null?`(${Jt}) >= 0 and (${Jt}) < ${dn}`:void 0,zs=wc(Xi,Jt,rn,uo);if(!zs){qn("array.set index must be within array size",Es.lineNo),es+=1;continue}zs.forEach((Hr,Ul)=>{is.push({kind:"assign",name:zt(Xi,Ul),op:":=",expr:Hr,lineNo:Es.lineNo})}),es+=1;continue}const Fu=Qo.match(we);if(Fu){const gi=Fu[3];if(Gs(gi)){qn(`Loop variable "${gi}" is read-only`,Es.lineNo),es+=1;continue}const Dr=Fu[4],Yi=String(Fu[5]||"").trim(),Ki=String(Fu[1]||"").trim().toLowerCase(),Xi=Ki==="var"||Ki==="varip"?Ki:void 0;gn=Es.lineNo;const ca=co(Yi,gi);is.push({kind:"assign",name:gi,op:Dr,decl:Xi,expr:ca,lineNo:Es.lineNo}),es+=1;continue}if(hn!=null&&Es.lineNo===hn){is.push({kind:"return",expr:K(Qo,`${oe.name}_return`),lineNo:Es.lineNo}),es+=1;continue}qn(`Unsupported statement inside function "${oe.name}": ${Es.text}`,Es.lineNo),es+=1}return{ops:is,nextIdx:es}};if(!oe.bodyLines||!oe.bodyLines.length){const Ae=K(oe.body,`${oe.name}_return`);return oe.bodyPlan={name:oe.name,args:oe.args,lineNo:oe.lineNo,body:[{kind:"return",expr:Ae,lineNo:oe.lineNo}]},oe.bodyPlan}const Ee=oe.bodyLines.map(Ae=>({text:String(Ae.text||""),lineNo:Ae.lineNo,indent:Ae.indent})).filter(Ae=>String(Ae.text||"").trim()&&!String(Ae.text||"").trim().startsWith("//")),ht=((Ge=Ee[0])==null?void 0:Ge.indent)??0;let pt=null;for(let Ae=Ee.length-1;Ae>=0;Ae--){const Rt=Ee[Ae];if(Rt.indent===ht){pt={text:String(Rt.text||"").trim(),lineNo:Rt.lineNo};break}}const Nt=(pt==null?void 0:pt.text)??"",E=/^if\b/i.test(Nt),I=/^switch\b/i.test(Nt),W=/^for\b/i.test(Nt),Z=/^while\b/i.test(Nt),_e=E||I||W||Z,me=/^return\b/i.test(Nt),Le=pt&&!me&&!we.test(Nt)&&(!_e||E||I)?pt.lineNo:null,ye=ee(Ee,0,ht-1,[],Le),Se=Ae=>{for(const Rt of Ae){if(Rt.kind==="return")return!0;if(Rt.kind==="if"){for(const nn of Rt.branches)if(Se(nn.body))return!0}if((Rt.kind==="for"||Rt.kind==="while")&&Se(Rt.body))return!0}return!1};if(!Se(ye.ops))if(pt&&we.test(Nt)){const Ae=Nt.match(we),Rt=(Ae==null?void 0:Ae[3])||"";Rt&&ye.ops.push({kind:"return",expr:K(Rt,`${oe.name}_return`),lineNo:pt.lineNo})}else(!pt||_e)&&(qn(`Function "${oe.name}" requires a return expression`,oe.lineNo),ye.ops.push({kind:"return",expr:"na",lineNo:oe.lineNo}));return oe.bodyPlan={name:oe.name,args:oe.args,lineNo:oe.lineNo,body:ye.ops},oe.bodyPlan},Dn=(oe,we)=>oe,Wn=oe=>String(oe||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(we,K)=>{const re=$t(String(K)),ke=Je[re];if(ke!=null&&ke.dynamic)return we;const ee=st[re],Ee=xt[re],ht=(ke==null?void 0:ke.size)??(ee==null?void 0:ee.length)??(Ee==null?void 0:Ee.length);return Number.isFinite(ht)?String(ht):we}),pn=oe=>{switch(oe.kind){case"NumberLiteral":return oe.value;case"Identifier":{const we=$t(oe.name);if(we==="true")return 1;if(we==="false")return 0;if(we==="na"||we==="nan")return NaN;const K=ft[we]??ft[oe.name],re=typeof K=="number"?K:Number(K);return Number.isFinite(re)?re:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(oe.operator!=="not")return null;const we=pn(oe.expr);return we==null?null:Number.isFinite(we)&&we!==0?0:1}case"BinaryExpression":{const we=pn(oe.left),K=pn(oe.right);if(we==null||K==null)return null;switch(oe.operator){case"+":return we+K;case"-":return we-K;case"*":return we*K;case"/":return K===0?NaN:we/K;case"%":return K===0?NaN:we%K;case">":return Number.isFinite(we)&&Number.isFinite(K)&&we>K?1:0;case"<":return Number.isFinite(we)&&Number.isFinite(K)&&we<K?1:0;case">=":return Number.isFinite(we)&&Number.isFinite(K)&&we>=K?1:0;case"<=":return Number.isFinite(we)&&Number.isFinite(K)&&we<=K?1:0;case"==":return Number.isFinite(we)&&Number.isFinite(K)&&Math.abs(we-K)<1e-9?1:0;case"!=":return Number.isFinite(we)&&Number.isFinite(K)&&Math.abs(we-K)>=1e-9?1:0;case"and":return Number.isFinite(we)&&we!==0&&Number.isFinite(K)&&K!==0?1:0;case"or":return Number.isFinite(we)&&we!==0||Number.isFinite(K)&&K!==0?1:0;default:return null}}case"CallExpression":{const we=oe.callee.toLowerCase();if(we==="iff"&&oe.args.length===3){const ee=pn(oe.args[0]);return ee==null?null:pn(ee!==0?oe.args[1]:oe.args[2])}const K=oe.args.map(ee=>pn(ee));if(K.some(ee=>ee==null))return null;const re=K[0],ke=K[1];switch(we){case"min":return Math.min(re,ke);case"max":return Math.max(re,ke);case"abs":return Math.abs(re);case"ceil":return Math.ceil(re);case"floor":return Math.floor(re);case"round":return Math.round(re);case"sqrt":return Math.sqrt(re);case"pow":return Math.pow(re,ke);default:return null}}default:return null}};let gn=null;const Qs=(oe,we)=>{if(we==null)return;let K;try{K=Ap(oe)}catch{return}const re=(Ee,ht)=>{Ee!=null&&(!Number.isFinite(Ee)||!Number.isInteger(Ee)||Ee<1)&&e.push({message:ht,line:we})},ke=(Ee,ht)=>{Ee!=null&&(!Number.isFinite(Ee)||!Number.isInteger(Ee)||Ee<0)&&e.push({message:ht,line:we})},ee=Ee=>{switch(Ee.kind){case"MemberExpression":ee(Ee.object);return;case"IndexExpression":ee(Ee.object),ee(Ee.index);return;case"UnaryExpression":ee(Ee.expr);return;case"BinaryExpression":ee(Ee.left),ee(Ee.right);return;case"CallExpression":{const ht=Ee.callee.toLowerCase();if(ht==="williamsr"&&Ee.args.length>=1){const pt=Ee.args.length===1?Ee.args[0]:Ee.args[3];re(pt?pn(pt):null,a)}ht==="aroon"&&Ee.args.length>=1&&re(pn(Ee.args[0]),l),ht==="dmi"&&Ee.args.length>=2&&(re(pn(Ee.args[0]),c),re(pn(Ee.args[1]),f)),ht==="adx"&&Ee.args.length>=1&&re(pn(Ee.args[0]),u),ht==="plus_di"&&Ee.args.length>=1&&re(pn(Ee.args[0]),d),ht==="minus_di"&&Ee.args.length>=1&&re(pn(Ee.args[0]),h),ht==="dx"&&Ee.args.length>=1&&re(pn(Ee.args[0]),m),ht==="aroonosc"&&Ee.args.length>=1&&re(pn(Ee.args[0]),g),ht==="sum"&&Ee.args.length>=2&&re(pn(Ee.args[1]),M),ht==="highest"&&Ee.args.length>=2&&re(pn(Ee.args[1]),w),ht==="lowest"&&Ee.args.length>=2&&re(pn(Ee.args[1]),C),ht==="rising"&&Ee.args.length>=2&&re(pn(Ee.args[1]),P),ht==="falling"&&Ee.args.length>=2&&re(pn(Ee.args[1]),T),ht==="valuewhen"&&Ee.args.length>=3&&ke(pn(Ee.args[2]),N),Ee.args.forEach(pt=>ee(pt));return}default:return}};ee(K)},Is=oe=>{const we=xr(String(oe||"").trim());if(!we)return null;const K=we.match(/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g)||[];for(const pt of K){const Nt=$t(pt);if(Lt[Nt])return null}const re=Qm(we);if(re!=null)return re;const ke=$t(we),ee=ft[ke]??ft[we],Ee=typeof ee=="number"?ee:Number(ee);if(Number.isFinite(Ee))return Ee;const ht=Wn(uy(we));try{const pt=Ap(ht),Nt=pn(pt);return Number.isFinite(Nt)?Nt:null}catch{return null}},Cs=oe=>{const we=xr(String(oe||"").trim());if(!we)return null;const K=Qm(we);if(K!=null)return K;const re=$t(we),ke=ft[re]??ft[we],ee=typeof ke=="number"?ke:Number(ke);if(Number.isFinite(ee))return ee;const Ee=Wn(uy(we));try{const ht=Ap(Ee),pt=pn(ht);return Number.isFinite(pt)?pt:null}catch{return null}},ro=32,bs=1024,zt=(oe,we)=>`__arr_${oe}_${we}`,Qt=oe=>`__arr_${oe}__size`,ho=oe=>{const we=$t(oe),K=xt[we];if(K)for(let re=0;re<K.length;re++)ft[zt(we,re)]=K[re]??""},ri=(oe,we)=>{const K=Qt(oe),re=He[K];if(typeof re=="number")return We[re].initExpr||(We[re].initExpr=String(we)),K;const ke=We.length;return He[K]=ke,We.push({name:K,initExpr:String(we),updateExpr:K,selfMode:"current"}),K},jo=(oe,we,K,re)=>{const ke=$t(oe),ee=Math.max(0,Math.floor(we)),Ee=Je[ke],ht=re??ee,pt=Math.min(bs,Math.max((Ee==null?void 0:Ee.capacity)??0,Math.floor(ht))),Nt=ri(ke,Math.max((Ee==null?void 0:Ee.size)??0,ee)),E=Ee?Ee.elements.slice():[];for(let I=E.length;I<pt;I++){const W=zt(ke,I);if(E.push(W),W in He){if(K&&K[I]!=null){const Z=He[W];We[Z].initExpr||(We[Z].initExpr=String(K[I]))}}else{const Z=We.length;He[W]=Z;const _e=K&&K[I]!=null?String(K[I]):void 0;We.push({name:W,initExpr:_e,updateExpr:W,selfMode:"current"})}}return Je[ke]={size:Math.max((Ee==null?void 0:Ee.size)??0,ee),capacity:pt,elements:E,sizeSeries:Nt,dynamic:(Ee==null?void 0:Ee.dynamic)??!1,kind:(Ee==null?void 0:Ee.kind)??"number"},{key:ke,elements:E}},Na=(oe,we,K,re)=>{const ke=$t(oe),ee=Math.max(0,Math.floor(we)),Ee=Je[ke],ht=re??Math.max(ee,1),pt=Math.min(bs,Math.max((Ee==null?void 0:Ee.capacity)??0,Math.floor(ht))),Nt=ri(ke,Math.max((Ee==null?void 0:Ee.size)??0,ee)),E=Ee?Ee.elements.slice():[];for(let I=E.length;I<pt;I++){const W=zt(ke,I);if(E.push(W),W in He){if(K&&K[I]!=null){const Z=He[W];We[Z].initExpr||(We[Z].initExpr=JSON.stringify(K[I]))}}else{const Z=We.length;He[W]=Z;const _e=K&&K[I]!=null?JSON.stringify(K[I]):void 0;We.push({name:W,initExpr:_e,updateExpr:W,selfMode:"current"})}}return Je[ke]={size:Math.max((Ee==null?void 0:Ee.size)??0,ee),capacity:pt,elements:E,sizeSeries:Nt,dynamic:(Ee==null?void 0:Ee.dynamic)??!1,kind:"string"},{key:ke,elements:E}},ar=(oe,we)=>{const K=$t(oe),re=Je[K];re&&(re.capacity>=we||jo(K,re.size,void 0,we))},Aa=(oe,we)=>{const K=$t(oe),re=Je[K];re&&(re.capacity>=we||Na(K,re.size,void 0,we))},nr=(oe,we)=>{var ee,Ee,ht,pt;const K=Is(we);if(K==null)return null;const re=K;if(!Number.isFinite(re)||!Number.isInteger(re))return null;const ke=((ee=Je[oe])==null?void 0:ee.capacity)??((Ee=Je[oe])==null?void 0:Ee.size)??((ht=st[oe])==null?void 0:ht.length)??((pt=xt[oe])==null?void 0:pt.length)??0;return re<0||ke<=0||re>=ke?null:re},hi=oe=>{const we=String(oe||"").trim();return!we||/^__arr_index\s*\(/i.test(we)?oe:`__arr_index(${oe})`},Gc=oe=>{const we=String(oe||"").trim();return!we||/^__arr_index_str\s*\(/i.test(we)?oe:`__arr_index_str(${oe})`},Pu=(oe,we)=>{const K=st[oe],re=xt[oe],ke=Je[oe],ee=(ke==null?void 0:ke.kind)==="string"||!!re&&!K,Ee=(ke==null?void 0:ke.capacity)??(ke==null?void 0:ke.size)??(K==null?void 0:K.length)??(re==null?void 0:re.length)??0;if(!Ee)return null;const ht=ee?Gc(we):hi(we);if(re&&!ke){const I=String(re.length);let W="na";for(let Z=Ee-1;Z>=0;Z--){const _e=I?`(${I}) > ${Z}`:"1",me=JSON.stringify(re[Z]??"");W=`iff(((${ht}) == ${Z}) and (${_e}), ${me}, ${W})`}return W}ee?Na(oe,(ke==null?void 0:ke.size)??Ee,re,Ee):jo(oe,(ke==null?void 0:ke.size)??Ee,K,Ee);const pt=Je[oe],Nt=pt!=null&&pt.dynamic?pt.sizeSeries:String((pt==null?void 0:pt.size)??(K==null?void 0:K.length)??Ee);let E="na";for(let I=Ee-1;I>=0;I--){const W=Nt?`(${Nt}) > ${I}`:"1";E=`iff(((${ht}) == ${I}) and (${W}), ${zt(oe,I)}, ${E})`}return E},wc=(oe,we,K,re,ke)=>{const ee=st[oe],Ee=xt[oe],ht=Je[oe],pt=(ht==null?void 0:ht.kind)==="string"||!!Ee&&!ee,Nt=(ht==null?void 0:ht.capacity)??(ht==null?void 0:ht.size)??(ee==null?void 0:ee.length)??(Ee==null?void 0:Ee.length)??0;if(!Nt)return null;pt?Na(oe,(ht==null?void 0:ht.size)??Nt,Ee,Nt):jo(oe,(ht==null?void 0:ht.size)??Nt,ee,Nt);const E=(ke==null?void 0:ke.normalizeIndex)===!1?we:pt?Gc(we):hi(we),I=[];for(let W=0;W<Nt;W++){const Z=re?`(${re}) and `:"";I.push(`iff(${Z}(${E}) == ${W}, ${K}, ${zt(oe,W)})`)}return I},cc=oe=>String(oe||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(we,K)=>{const re=$t(String(K)),ke=Je[re];if(ke)return ke.sizeSeries;const ee=st[re];if(ee)return String(ee.length);const Ee=xt[re];return Ee?String(Ee.length):we}),ou=(oe,we,K)=>{const re=Je[K],ke=st[K],ee=(re==null?void 0:re.capacity)??(re==null?void 0:re.size)??(ke==null?void 0:ke.length)??0;if(!ee)return null;const Ee=`array.size(${we})`,ht=(E,I)=>{const W=`array.get(${we}, ${E})`,Z=I?`(${W} * ${W})`:W;return`iff(${Ee} > ${E}, ${Z}, 0)`};if(oe==="sum"||oe==="avg"||oe==="stdev"){let E=ht(0,!1);for(let _e=1;_e<ee;_e++)E=`(${E} + ${ht(_e,!1)})`;if(oe==="sum")return E;if(oe==="avg")return`iff(${Ee} > 0, (${E}) / ${Ee}, na)`;let I=ht(0,!0);for(let _e=1;_e<ee;_e++)I=`(${I} + ${ht(_e,!0)})`;const W=`iff(${Ee} > 0, (${E}) / ${Ee}, na)`;return`sqrt(max(${`iff(${Ee} > 0, (${I}) / ${Ee} - (${W} * ${W}), na)`}, 0))`}const pt=oe==="min"?"1000000000000":"-1000000000000";let Nt=`iff(${Ee} > 0, array.get(${we}, 0), ${pt})`;for(let E=1;E<ee;E++){const I=`iff(${Ee} > ${E}, array.get(${we}, ${E}), ${pt})`;Nt=`${oe}(${Nt}, ${I})`}return Nt},zu=oe=>{const we=String(oe||"");let K="",re=0,ke=null;const ee=we.toLowerCase(),Ee=ht=>/[a-z0-9_$]/i.test(ht);for(;re<we.length;){const ht=we[re];if(ke){K+=ht,ht===ke&&we[re-1]!=="\\"&&(ke=null),re+=1;continue}if(ht==="'"||ht==='"'){ke=ht,K+=ht,re+=1;continue}const pt=ee.slice(re).match(/^array\.(sum|min|max|avg|stdev)\b/);if(!pt||re>0&&Ee(ee[re-1]||"")){K+=ht,re+=1;continue}const Nt=String(pt[1]||"").toLowerCase();let E=re+pt[0].length;for(;E<we.length&&/\s/.test(we[E]);)E+=1;if(we[E]!=="("){K+=ht,re+=1;continue}let I=0,W=E,Z=null;for(;W<we.length;W++){const Ge=we[W];if(Z){Ge===Z&&we[W-1]!=="\\"&&(Z=null);continue}if(Ge==="'"||Ge==='"'){Z=Ge;continue}if(Ge==="(")I+=1;else if(Ge===")"&&(I-=1,I===0))break}if(W>=we.length){K+=we.slice(re);break}const _e=we.slice(E+1,W),me=Kr(_e),Le=String(me[0]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Le)){K+=we.slice(re,W+1),re=W+1;continue}const ye=$t(Le),Se=ou(Nt,Le,ye);if(!Se){K+=we.slice(re,W+1),re=W+1;continue}K+=`(${Se})`,re=W+1}return K},ja=oe=>{const we=Je[oe];we&&(we.dynamic=!0)},nc=(oe,we,K,re)=>{const ke=Je[oe];if(!ke)return null;const ee=ke.sizeSeries,Ee=ee,ht=ke.capacity,pt=[],Nt=E=>{E.forEach((I,W)=>{pt.push({name:zt(oe,W),hasVar:!1,declaredType:"",op:":=",rhs:I,lineNo:re})})};if(we==="push"){const E=co(String(K.value||"na"),`${oe}_push`),I=`(${Ee}) < ${ht}`,W=wc(oe,Ee,E,I);return W&&Nt(W),pt.push({name:ee,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${I}, min(${ee} + 1, ${ht}), ${ee})`,lineNo:re}),pt}if(we==="pop")return pt.push({name:ee,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${ee} > 0, max(${ee} - 1, 0), ${ee})`,lineNo:re}),pt;if(we==="clear")return pt.push({name:ee,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:re}),pt;if(we==="resize"){const E=co(String(K.size||"0"),`${oe}_resize`);return pt.push({name:ee,hasVar:!1,declaredType:"",op:":=",rhs:`min(max(0, ${E}), ${ht})`,lineNo:re}),pt}if(we==="shift"||we==="remove"){const E=we==="shift"?"0":co(String(K.index||"0"),`${oe}_remove`),I=hi(E),W=`(${I}) >= 0 and (${I}) < ${Ee}`,Z=[];for(let _e=0;_e<ht;_e++){const me=_e<ht-1?`(${W}) and (${_e} >= (${I})) and (${_e} < (${Ee} - 1))`:"0",Le=_e<ht-1?zt(oe,_e+1):zt(oe,_e);Z.push(`iff(${me}, ${Le}, ${zt(oe,_e)})`)}return Nt(Z),pt.push({name:ee,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${W}, max(${ee} - 1, 0), ${ee})`,lineNo:re}),pt}if(we==="unshift"||we==="insert"){const E=we==="unshift"?"0":co(String(K.index||"0"),`${oe}_insert`),I=hi(E),W=co(String(K.value||"na"),`${oe}_insert_val`),Z=`(${prevSize}) < ${ht}`,_e=`(${I}) >= 0 and (${I}) <= ${Ee}`,me=[];for(let Le=0;Le<ht;Le++){const ye=`(${Le} == (${I}))`,Se=`(${Le} > (${I})) and (${Le} <= ${Ee})`,Ge=Le>0?zt(oe,Le-1):zt(oe,Le);me.push(`iff(${Z} and ${_e} and ${ye}, ${W}, iff(${Z} and ${_e} and ${Se}, ${Ge}, ${zt(oe,Le)}))`)}return Nt(me),pt.push({name:ee,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${Z} and ${_e}, min(${ee} + 1, ${ht}), ${ee})`,lineNo:re}),pt}return null},Bc=(oe,we,K)=>{const re=Je[we];if(!re)return null;jo(oe,re.size,void 0,re.capacity);const ke=Je[oe];if(!ke)return null;const ee=[];for(let Ee=0;Ee<ke.capacity;Ee++)ee.push({name:zt(oe,Ee),hasVar:!1,declaredType:"",op:":=",rhs:zt(we,Ee),lineNo:K});return ee.push({name:ke.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:re.sizeSeries,lineNo:K}),ee},Vu=(oe,we,K,re)=>{const ke=Je[we],ee=Je[K];if(!ke||!ee)return null;const Ee=Math.min(bs,ke.capacity+ee.capacity);jo(oe,Math.min(Ee,ke.size+ee.size),void 0,Ee);const ht=Je[oe];if(!ht)return null;const pt=[];for(let Nt=0;Nt<ht.capacity;Nt++){const E=`iff(${Nt} < ${ke.sizeSeries}, array.get(${we}, ${Nt}), iff(${Nt} < (${ke.sizeSeries} + ${ee.sizeSeries}), array.get(${K}, ${Nt} - ${ke.sizeSeries}), na))`;pt.push({name:zt(oe,Nt),hasVar:!1,declaredType:"",op:":=",rhs:co(E,`${oe}_concat_${Nt}`),lineNo:re})}return pt.push({name:ht.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:`min(${ke.sizeSeries} + ${ee.sizeSeries}, ${Ee})`,lineNo:re}),ja(oe),pt},rf=oe=>{const we=String(oe||"");let K="",re=0,ke=null;const ee=we.toLowerCase();for(;re<we.length;){const Ee=we[re];if(ke){K+=Ee,Ee===ke&&we[re-1]!=="\\"&&(ke=null),re+=1;continue}if(Ee==="'"||Ee==='"'){ke=Ee,K+=Ee,re+=1;continue}if(!(ee.startsWith("array.get",re)&&(re===0||!/[a-z0-9_$]/i.test(ee[re-1]||"")))){K+=Ee,re+=1;continue}let pt=re+9;for(;pt<we.length&&/\s/.test(we[pt]);)pt+=1;if(we[pt]!=="("){K+=Ee,re+=1;continue}let Nt=0,E=pt,I=null;for(;E<we.length;E++){const hn=we[E];if(I){hn===I&&we[E-1]!=="\\"&&(I=null);continue}if(hn==="'"||hn==='"'){I=hn;continue}if(hn==="(")Nt+=1;else if(hn===")"&&(Nt-=1,Nt===0))break}if(E>=we.length){K+=we.slice(re);break}const W=we.slice(pt+1,E),Z=Kr(W),_e=String(Z[0]||"").trim(),me=String(Z[1]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(_e)||!me){K+=we.slice(re,E+1),re=E+1;continue}const Le=$t(_e),ye=st[Le],Se=xt[Le],Ge=Je[Le];if(!((Ge==null?void 0:Ge.capacity)??(Ge==null?void 0:Ge.size)??(ye==null?void 0:ye.length)??(Se==null?void 0:Se.length)??0)){K+=we.slice(re,E+1),re=E+1;continue}const Rt=rf(me),nn=nr(Le,Rt);if(nn!=null){if(Je[Le])K+=zt(Le,nn);else if(ye){const hn=ye[nn];K+=typeof hn=="number"&&Number.isFinite(hn)?String(hn):"na"}else Se?K+=JSON.stringify(Se[nn]??""):K+=zt(Le,nn);re=E+1;continue}const Xn=Pu(Le,Rt);K+=Xn??we.slice(re,E+1),re=E+1}return K},co=(oe,we)=>(()=>{let K=Mt(oe,we);const re=Object.entries(ge);return re.length&&re.forEach(([ke,ee])=>{K=K.replace(new RegExp(`\\b${ke}\\.`,"gi"),ee.replacement)}),K=Dn(K),K=uy(K),K=K.replace(/\bta\./gi,""),K=K.replace(/\bmath\./gi,""),K=K.replace(/\bstr\./gi,""),K=K.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),K=K.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),K=K.replace(/\bstrategy_(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),K=zu(K),K=cc(K),K=rf(K),K=af(K,gn),Qs(K,gn),K})(),ll=(oe,we)=>{if(oe==null)return{};const K=String(oe).trim();return K.startsWith('"')&&K.endsWith('"')||K.startsWith("'")&&K.endsWith("'")?{text:xr(K)}:K?{textExpr:co(K,we)}:{}},va=oe=>oe.when&&zc(D_(co(String(oe.when),"when")))||void 0,Vl=oe=>xr(String(oe.pane??ce)).toLowerCase()==="sub"?"sub":"main",kr=(oe,we)=>{if(oe.pane!=null)return Vl(oe);const K=we?$t(String(we)):"";return K&&Xe[K]||ce},Wr=(oe,we,K)=>{if(!oe)return e.push({message:`${we} requires a value`,line:K}),null;const re=co(String(oe),we);return re||(e.push({message:`${we} requires a value`,line:K}),null)},jl=oe=>{if(!oe)return null;const we=xr(String(oe||"")).trim();return!we||we.toLowerCase()==="na"?null:$t(we)},Xl=oe=>{if(oe==null)return;const we=xr(String(oe)).trim();return we?we.toLowerCase():void 0},Mu=oe=>{if(!oe)return;if(Array.isArray(oe)){const K=oe.map(re=>String(re||"").trim().toLowerCase()).filter(Boolean);return K.length?K:void 0}const we=String(oe||"").split(",").map(K=>K.trim().toLowerCase()).filter(Boolean);return we.length?we:void 0},Zu=(oe,we,K,re,ke,ee)=>{const Ee=[];for(let ht=we;ht+1<oe.length;ht+=2){const pt=Wr(oe[ht],`${re} x`,K),Nt=Wr(oe[ht+1],`${re} y`,K);!pt||!Nt||Ee.push({x:pt,y:Nt,xloc:ke,yloc:ee})}return Ee},xo=oe=>{if(!oe)return;const we=String(oe||"").trim(),K=we.match(/^color\.new\s*\((.*)\)\s*$/i);if(K){const Nt=Kr(K[1]||""),E=xo(Nt[0]),I=Nt[1]!=null?xr(String(Nt[1])):"",W=Qm(I);return U0(E,W??void 0)}const re=we.match(/^color\.from_hex\s*\((.*)\)\s*$/i);if(re){const Nt=Kr(re[1]||""),E=String(Nt[0]??"").trim(),I=E.startsWith('"')||E.startsWith("'"),W=xr(E).trim();if(!I){gn!=null&&!s.has(gn)&&(t.push({message:"Color variables are limited. Use inline color.rgb/color.new/hex or input.color().",line:gn}),s.add(gn));return}if(!/^#[0-9a-fA-F]{6}$/.test(W)){gn!=null&&e.push({message:'color.from_hex expects "#RRGGBB"',line:gn});return}return W}const ke=we.match(/^color\.rgb\s*\((.*)\)\s*$/i);if(ke){const Nt=Kr(ke[1]||""),E=Qm(xr(String(Nt[0]??""))),I=Qm(xr(String(Nt[1]??""))),W=Qm(xr(String(Nt[2]??""))),Z=Qm(xr(String(Nt[3]??"")));if(typeof E=="number"&&typeof I=="number"&&typeof W=="number"){const _e=Math.max(0,Math.min(255,Math.round(E))),me=Math.max(0,Math.min(255,Math.round(I))),Le=Math.max(0,Math.min(255,Math.round(W)));if(typeof Z=="number"&&Number.isFinite(Z)){const ye=Math.max(0,Math.min(255,Math.round(Z))),Se=Math.max(0,Math.min(1,ye/255));return`rgba(${_e},${me},${Le},${Se})`}return`rgb(${_e},${me},${Le})`}}const ee=we.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(ee&&Lt[$t(ee[0])]==="color")return`\${${ee[0]}}`;const Ee=A5(we);if(Ee)return Ee;const ht=xr(we);if(ht.startsWith("#")||ht.startsWith("rgb"))return ht;const pt=ht.toLowerCase();pt&&pt!=="na"&&gn!=null&&!s.has(gn)&&(t.push({message:"Color variables are limited. Use inline color.rgb/color.new/hex or input.color().",line:gn}),s.add(gn))},Sr=(oe,we)=>{if(!oe)return{};const K=co(String(oe),we);if(!K)return{};const re=Is(K);return re!=null?{value:re}:{expr:K}},ql=(oe,we)=>{if(oe==null)return{};const K=V1(String(oe));return K!=null?{value:K}:Sr(oe,we)},$f=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=u0(K);return re||e.push({message:`line style not supported: ${K}`,line:we}),re},Cf=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=Dx(K);return re||e.push({message:`line extend not supported: ${K}`,line:we}),re},tp=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=d0(K);return re||e.push({message:`line xloc not supported: ${K}`,line:we}),re},mf=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=d0(K);return re||e.push({message:`label xloc not supported: ${K}`,line:we}),re},sc=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=d0(K);return re||e.push({message:`box xloc not supported: ${K}`,line:we}),re},yd=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=Dx(K);return re||e.push({message:`box extend not supported: ${K}`,line:we}),re},If=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=u0(K);if(re&&re.startsWith("arrow")){e.push({message:`box border_style not supported: ${K}`,line:we});return}return re||e.push({message:`box border_style not supported: ${K}`,line:we}),re},En=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=d_(K);return re||e.push({message:`box text_halign not supported: ${K}`,line:we}),re},ms=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=W1(K);return re||e.push({message:`box text_valign not supported: ${K}`,line:we}),re},js=(oe,we)=>{if(oe==null)return{};const K=String(oe??"").trim(),re=T5(K);if(re!=null)return{value:re};const ke=Sr(oe,"box.text_size");if(ke.value!=null){const ee=ke.value;!Number.isFinite(ee)||!Number.isInteger(ee)?e.push({message:"box text_size must be an integer",line:we}):ke.value=Math.max(8,Math.min(32,ee))}return K&&re==null&&/^size\./i.test(K)&&e.push({message:`box text_size not supported: ${K}`,line:we}),ke},Nn=(oe,we)=>{const K=Sr(oe,"box.border_width");if(oe!=null&&String(oe).trim()){const re=K.value;if(re!=null)(!Number.isFinite(re)||!Number.isInteger(re)||re<0||re>4)&&e.push({message:"box border_width must be an integer between 0 and 4",line:we});else{const ke=co(String(oe),"box.border_width"),ee=String(ke??oe).trim().toLowerCase();(ee==="na"||ee==="nan")&&e.push({message:"box border_width must be an integer between 0 and 4",line:we})}}return K},Io=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=String(K).toLowerCase().replace(/^location\./,""),ke=re.includes("below")||re.includes("bottom")||re.includes("low"),ee=re.includes("above")||re.includes("top")||re.includes("high"),Ee=ke?"belowbar":ee?"abovebar":void 0;return Ee||e.push({message:`label location not supported: ${K}`,line:we}),Ee},fo=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=d_(K);return re||e.push({message:`label textalign not supported: ${K}`,line:we}),re},Ji=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=OJ(K);return re||e.push({message:`label style not supported: ${K}`,line:we}),re},Gi=(oe,we)=>{if(oe==null)return{};const K=String(oe??"").trim(),re=T5(K);if(re!=null)return{value:re};const ke=Sr(oe,"label.size");if(ke.value!=null){const ee=ke.value;!Number.isFinite(ee)||!Number.isInteger(ee)?e.push({message:"label size must be an integer",line:we}):ke.value=Math.max(8,Math.min(32,ee))}return K&&re==null&&/^size\./i.test(K)&&e.push({message:`label size not supported: ${K}`,line:we}),ke},Al=(oe,we)=>{const K=String(oe??"").trim();if(!K)return;const re=u_(K);if(!re){e.push({message:`label yloc not supported: ${K}`,line:we});return}return re||void 0},Ii=(oe,we)=>{const K=Sr(oe,"line.width");if(oe!=null&&String(oe).trim()){const re=K.value;if(re!=null)(!Number.isFinite(re)||re<1||!Number.isInteger(re))&&e.push({message:"line width must be >= 1",line:we});else{const ke=co(String(oe),"line.width"),ee=String(ke??oe).trim().toLowerCase();(ee==="na"||ee==="nan")&&e.push({message:"line width must be >= 1",line:we})}}return K},Wo=oe=>{const we=xr(String(oe||"").trim()).toLowerCase();return we?we==="na"||we==="nan"||we==="inf"||we==="+inf"||we==="-inf"||we==="infinity"||we==="+infinity"||we==="-infinity":!1},To=(oe,we,K)=>{if(oe==null)return;const re=String(oe||"").trim();if(!re)return;if(we==="time"){Wo(re)&&e.push({message:"line x must be a number when xloc=time",line:K});return}const ke=Is(re);if(ke!=null){(!Number.isFinite(ke)||!Number.isInteger(ke))&&e.push({message:"line x must be an integer when xloc=bar_index",line:K});return}Wo(re)&&e.push({message:"line x must be an integer when xloc=bar_index",line:K})},Ba=(oe,we,K)=>{if(oe==null)return;const re=String(oe||"").trim();if(!re)return;if(we==="time"){Wo(re)&&e.push({message:"label x must be a number when xloc=time",line:K});return}const ke=Is(re);if(ke!=null){(!Number.isFinite(ke)||!Number.isInteger(ke))&&e.push({message:"label x must be an integer when xloc=bar_index",line:K});return}Wo(re)&&e.push({message:"label x must be an integer when xloc=bar_index",line:K})},Pi=(oe,we,K)=>{if(oe==null)return;const re=String(oe||"").trim();if(!re)return;if(we==="time"){Wo(re)&&e.push({message:"box x must be a number when xloc=time",line:K});return}const ke=Is(re);if(ke!=null){(!Number.isFinite(ke)||!Number.isInteger(ke))&&e.push({message:"box x must be an integer when xloc=bar_index",line:K});return}Wo(re)&&e.push({message:"box x must be an integer when xloc=bar_index",line:K})},qs=(oe,we)=>{const K=Te(oe);Array.isArray(K.runtimeDrawOps)||(K.runtimeDrawOps=[]),K.runtimeDrawOps.push(we)},mi=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(nn=>!Iu(nn)),ht=Wr(Ee[0]??ee.x1??ee.x,"line.new x1",we),pt=Wr(Ee[1]??ee.y1??ee.y,"line.new y1",we),Nt=Wr(Ee[2]??ee.x2,"line.new x2",we),E=Wr(Ee[3]??ee.y2,"line.new y2",we);if(!ht||!pt||!Nt||!E)return!0;const I=Vl(ee),W=va(ee),Z=Ii(ee.width??ee.linewidth,we),_e=Gg(ee.layer??ee.Layer),me=Yg(ee.zindex??ee.z_index??ee.zIndex),Le=Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),ye=Xl(ee.group??ee.group_id??ee.groupId),Se=Mu(ee.tags??ee.tag),Ge=K?$t(K):void 0;Ge&&(Xe[Ge]=I);const Ae=tp(ee.xloc!=null?String(ee.xloc):void 0,we),Rt=Ae||"bar_index";return To(ht,Rt,we),To(Nt,Rt,we),qs(I,{kind:"line_new",assign:Ge,once:re?!0:void 0,x1:ht,y1:pt,x2:Nt,y2:E,when:W,color:xo(String(ee.color??""))||void 0,width:Z.value,widthExpr:Z.expr,style:$f(ee.style!=null?String(ee.style):void 0,we)||void 0,extend:Cf(ee.extend!=null?String(ee.extend):void 0,we)||void 0,xloc:Ae,layer:_e,zIndex:me,includeInAutoscale:Le,groupId:ye,tags:Se}),!0},Er=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(sr=>!Iu(sr)),ht=Wr(Ee[0]??ee.x,"label.new x",we);let pt=Wr(Ee[1]??ee.y,"label.new y",we);if(!ht)return!0;const Nt=Ee[2]??ee.text??ee.title??"",E=ll(String(Nt||""),"label_text"),I=ll(String(ee.tooltip??""),"label_tooltip"),W=Vl(ee),Z=va(ee),_e=Al(String(ee.yloc??""),we)||Io(String(ee.location??ee.loc??""),we)||void 0;if(_e&&(!pt||String(pt).trim().toLowerCase()==="na")&&(pt=_e==="belowbar"?"low":_e==="abovebar"?"high":pt),!pt)return!0;const me=Gi(ee.size,we),Le=Gg(ee.layer??ee.Layer),ye=Yg(ee.zindex??ee.z_index??ee.zIndex),Se=Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),Ge=Xl(ee.group??ee.group_id??ee.groupId),Ae=Mu(ee.tags??ee.tag),Rt=ee.wrap!=null?String(ee.wrap).toLowerCase()==="true"||Number(ee.wrap)===1:void 0,nn=Sr(ee.maxwidth??ee.maxWidth,"label.max_width"),Xn=Sr(ee.bg_opacity??ee.bgOpacity,"label.bg_opacity"),hn=Sr(ee.border_width??ee.borderWidth,"label.border_width"),is=Sr(ee.radius,"label.radius"),Gs=Sr(ee.line_height??ee.lineHeight,"label.line_height"),es=ee.padding;let Mi;if(es!=null){const sr=Number(es);if(Number.isFinite(sr))Mi=sr;else{const na=String(es).trim();if(na.startsWith("{"))try{Mi=JSON.parse(na.replace(/([A-Za-z0-9_]+)\s*:/g,'"$1":'))}catch{Mi=void 0}}}const Kn=K?$t(K):void 0;Kn&&(Xe[Kn]=W);const Es=mf(String(ee.xloc??""),we)||void 0;return Ba(ht,Es||"bar_index",we),qs(W,{kind:"label_new",assign:Kn,once:re?!0:void 0,x:ht,y:pt,when:Z,yloc:_e,textAlign:fo(String(ee.textalign??ee.text_align??ee.textAlign??""),we),tooltip:I.text,tooltipExpr:I.textExpr,text:E.text,textExpr:E.textExpr,color:xo(String(ee.color??""))||void 0,bgColor:xo(String(ee.bgcolor??ee.bgColor??ee.background_color??ee.backgroundColor??""))||void 0,borderColor:xo(String(ee.bordercolor??ee.border_color??ee.borderColor??""))||void 0,textColor:xo(String(ee.textcolor??ee.textColor??""))||void 0,style:Ji(String(ee.style??ee.shape??""),we)||void 0,size:me.value??V1(String(ee.size??"")),sizeExpr:me.expr,xloc:Es,layer:Le,zIndex:ye,includeInAutoscale:Se,groupId:Ge,tags:Ae,wrap:Rt,maxWidth:nn.value,bgOpacity:Xn.value,borderWidth:hn.value,radius:is.value,padding:Mi,align:fo(String(ee.align??ee.textalign??ee.textAlign??""),we)||void 0,valign:["top","middle","bottom"].includes(String(ee.valign??"").toLowerCase())?String(ee.valign).toLowerCase():void 0,lineHeight:Gs.value,fontFamily:ee.font_family??ee.fontFamily,fontSize:Sr(ee.font_size??ee.fontSize,"label.font_size").value,fontWeight:ee.font_weight??ee.fontWeight,monospace:ee.monospace!=null?String(ee.monospace).toLowerCase()==="true"||Number(ee.monospace)===1:void 0}),!0},Za=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(Es=>!Iu(Es)),ht=Wr(Ee[0]??ee.left,"box.new left",we),pt=Wr(Ee[1]??ee.top,"box.new top",we),Nt=Wr(Ee[2]??ee.right,"box.new right",we),E=Wr(Ee[3]??ee.bottom,"box.new bottom",we);if(!ht||!pt||!Nt||!E)return!0;const I=Vl(ee),W=va(ee),Z=Nn(ee.border_width??ee.borderWidth,we),_e=ee.text??"",me=ll(String(_e||""),"box_text"),Le=ll(String(ee.tooltip??""),"box_tooltip"),ye=js(ee.text_size??ee.textSize,we),Se=En(String(ee.text_halign??ee.textHalign??""),we)||void 0,Ge=ms(String(ee.text_valign??ee.textValign??""),we)||void 0,Ae=ee.text_wrap??ee.textWrap,Rt=Ae!=null?Xg(String(Ae))??void 0:void 0,nn=Gg(ee.layer??ee.Layer),Xn=Yg(ee.zindex??ee.z_index??ee.zIndex),hn=Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),is=Xl(ee.group??ee.group_id??ee.groupId),Gs=Mu(ee.tags??ee.tag),es=K?$t(K):void 0;es&&(Xe[es]=I);const Mi=sc(String(ee.xloc??""),we)||void 0,Kn=Mi||"bar_index";return Pi(ht,Kn,we),Pi(Nt,Kn,we),qs(I,{kind:"box_new",assign:es,once:re?!0:void 0,left:ht,top:pt,right:Nt,bottom:E,when:W,borderColor:xo(String(ee.border_color??ee.borderColor??""))||void 0,width:Z.value,widthExpr:Z.expr,borderStyle:If(String(ee.border_style??ee.borderStyle??""),we)||void 0,bgColor:xo(String(ee.bgcolor??ee.bgColor??ee.color??""))||void 0,text:me.text,textExpr:me.textExpr,tooltip:Le.text,tooltipExpr:Le.textExpr,textColor:xo(String(ee.text_color??ee.textColor??""))||void 0,textSize:ye.value,textSizeExpr:ye.expr,textHalign:Se,textValign:Ge,textWrap:Rt,extend:yd(String(ee.extend??""),we)||void 0,xloc:Mi,layer:nn,zIndex:Xn,includeInAutoscale:hn,groupId:is,tags:Gs}),!0},vi=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(Xn=>!Iu(Xn)),ht=Ee[0]??ee.position??ee.pos??"top_right",pt=Ee[1]??ee.columns??ee.cols,Nt=Ee[2]??ee.rows,E=pt!=null?Number(pt):NaN,I=Nt!=null?Number(Nt):NaN;if(!Number.isFinite(E)||!Number.isFinite(I))return e.push({message:"table.new(position, columns, rows) requires numeric columns/rows",line:we}),!0;const W=Vl(ee),Z=va(ee),_e=Sr(ee.border_width??ee.borderWidth,"table.border_width"),me=Sr(ee.frame_width??ee.frameWidth,"table.frame_width"),Le=ql(ee.text_size??ee.textSize,"table.text_size"),ye=Gg(ee.layer??ee.Layer),Se=Yg(ee.zindex??ee.z_index??ee.zIndex),Ge=Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),Ae=Xl(ee.group??ee.group_id??ee.groupId),Rt=Mu(ee.tags??ee.tag),nn=K?$t(K):void 0;return nn&&(Xe[nn]=W),qs(W,{kind:"table_new",assign:nn,once:re?!0:void 0,when:Z,position:L5(String(ht))||xr(String(ht)),columns:Math.max(1,Math.floor(E)),rows:Math.max(1,Math.floor(I)),bgcolor:xo(String(ee.bgcolor??ee.bgColor??""))||void 0,borderColor:xo(String(ee.border_color??ee.borderColor??""))||void 0,borderWidth:_e.value,borderWidthExpr:_e.expr,textColor:xo(String(ee.text_color??ee.textColor??""))||void 0,textSize:Le.value,textSizeExpr:Le.expr,textHalign:d_(String(ee.text_halign??ee.textHalign??""))||void 0,textValign:W1(String(ee.text_valign??ee.textValign??""))||void 0,frameColor:xo(String(ee.frame_color??ee.frameColor??""))||void 0,frameWidth:me.value,frameWidthExpr:me.expr,layer:ye,zIndex:Se,includeInAutoscale:Ge,groupId:Ae,tags:Rt}),!0},$r=(oe,we,K="table_cell")=>{const re=Kr(oe||""),ke=qc(re),ee=re.filter(Ae=>!Iu(Ae)),Ee=ee[0]??"",ht=jl(String(Ee||""))||"",pt=ee[1]??ke.column??ke.col,Nt=ee[2]??ke.row,E=pt!=null?Number(pt):NaN,I=Nt!=null?Number(Nt):NaN;if(!ht||!Number.isFinite(E)||!Number.isFinite(I))return t.push({message:"table.cell(table, column, row, text) requires a table id and numeric column/row",line:we}),!0;const W=ee[3]??ke.text??ke.title??"",Z=ll(String(W||""),"table_cell_text"),_e=ql(ke.text_size??ke.textSize,"table.cell_text_size"),me=Sr(ke.width,"table.cell_width"),Le=Sr(ke.height,"table.cell_height"),ye=kr(ke,ht),Se=ke.tooltip!=null?ll(String(ke.tooltip),"table_cell_tooltip"):{},Ge={kind:K,target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke),column:Math.floor(E),row:Math.floor(I),text:Z.text,textExpr:Z.textExpr,textColor:xo(String(ke.text_color??ke.textColor??""))||void 0,textSize:_e.value,textSizeExpr:_e.expr,textHalign:d_(String(ke.text_halign??ke.textHalign??""))||void 0,textValign:W1(String(ke.text_valign??ke.textValign??""))||void 0,bgcolor:xo(String(ke.bgcolor??ke.bgColor??""))||void 0,width:me.value,widthExpr:me.expr,height:Le.value,heightExpr:Le.expr,tooltip:Se.text,tooltipExpr:Se.textExpr};return qs(ye,Ge),!0},Il=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(I=>!Iu(I)),Ee=ee[0],ht=jl(Ee);if(!ht)return!0;const pt=String(oe||"").toLowerCase().replace(/_/g,""),Nt=kr(ke,ht),E={kind:"line_set",target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke)};if(pt==="x1")E.x1=Wr(ee[1],"line.set_x1",K);else if(pt==="y1")E.y1=Wr(ee[1],"line.set_y1",K);else if(pt==="x2")E.x2=Wr(ee[1],"line.set_x2",K);else if(pt==="y2")E.y2=Wr(ee[1],"line.set_y2",K);else if(pt==="xy1")E.x1=Wr(ee[1],"line.set_xy1 x",K),E.y1=Wr(ee[2],"line.set_xy1 y",K);else if(pt==="xy2")E.x2=Wr(ee[1],"line.set_xy2 x",K),E.y2=Wr(ee[2],"line.set_xy2 y",K);else if(pt==="xy")E.x1=Wr(ee[1],"line.set_xy x1",K),E.y1=Wr(ee[2],"line.set_xy y1",K),E.x2=Wr(ee[3],"line.set_xy x2",K),E.y2=Wr(ee[4],"line.set_xy y2",K);else if(pt==="color")E.color=xo(ee[1]??ke.color);else if(pt==="width"||pt==="linewidth"){const I=Ii(ee[1]??ke.width,K);E.width=I.value,E.widthExpr=I.expr}else if(pt==="style")E.style=$f(ee[1]??ke.style,K)||void 0;else if(pt==="extend")E.extend=Cf(ee[1]??ke.extend,K)||void 0;else if(pt==="xloc")E.xloc=tp(ee[1]??ke.xloc,K)||void 0;else return t.push({message:`Unsupported line.set_${oe}()`,line:K}),!0;return qs(Nt,E),!0},cl=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"line_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},kc=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(ye=>!Iu(ye)),ht=jl(Ee[0]??ee.line1??ee.line_1??ee.l1),pt=jl(Ee[1]??ee.line2??ee.line_2??ee.l2);if(!ht||!pt)return t.push({message:"linefill.new(line1, line2) requires two line ids",line:we}),!0;const Nt=kr(ee,ht||pt),E=va(ee),I=Gg(ee.layer??ee.Layer),W=Yg(ee.zindex??ee.z_index??ee.zIndex),Z=Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),_e=Xl(ee.group??ee.group_id??ee.groupId),me=Mu(ee.tags??ee.tag),Le=K?$t(K):void 0;return Le&&(Xe[Le]=Nt),qs(Nt,{kind:"linefill_new",assign:Le,once:re?!0:void 0,when:E,line1:ht,line2:pt,color:xo(Ee[2]??ee.color??ee.fillcolor),layer:I,zIndex:W,includeInAutoscale:Z,groupId:_e,tags:me}),!0},uc=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(I=>!Iu(I)),Ee=ee[0],ht=jl(Ee);if(!ht)return!0;const pt=String(oe||"").toLowerCase().replace(/_/g,""),Nt=kr(ke,ht),E={kind:"linefill_set",target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke)};if(pt==="color")E.color=xo(ee[1]??ke.color??ke.fillcolor);else if(pt==="line1")E.line1=jl(ee[1]??ke.line1??ke.line_1??ke.l1)||void 0;else if(pt==="line2")E.line2=jl(ee[1]??ke.line2??ke.line_2??ke.l2)||void 0;else return t.push({message:`Unsupported linefill.set_${oe}()`,line:K}),!0;return qs(Nt,E),!0},Tl=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"linefill_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},ur=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(Le=>!Iu(Le)),ht=va(ee),pt=d0(String(ee.xloc??""))||void 0,Nt=u_(String(ee.yloc??""))||void 0,E=Zu(Ee,0,we,"polyline.new",pt,Nt);if(E.length<2)return t.push({message:"polyline.new requires at least 2 points (x,y pairs)",line:we}),!0;const I=Vl(ee),W=Gg(ee.layer??ee.Layer),Z=Yg(ee.zindex??ee.z_index??ee.zIndex),_e=Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),me=K?$t(K):void 0;return me&&(Xe[me]=I),qs(I,{kind:"polyline_new",assign:me,once:re?!0:void 0,when:ht,points:E,color:xo(ee.color),width:Sr(ee.width,"polyline.width").value,widthExpr:Sr(ee.width,"polyline.width").expr,style:u0(String(ee.style??""))||void 0,opacity:ee.opacity!=null?Number(ee.opacity):void 0,xloc:pt,yloc:Nt,layer:W,zIndex:Z,includeInAutoscale:_e,groupId:Xl(ee.group??ee.group_id??ee.groupId),tags:Mu(ee.tags??ee.tag)}),!0},la=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ke=K.filter(W=>!Iu(W)),ee=ke[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee),pt=d0(String(re.xloc??""))||void 0,Nt=u_(String(re.yloc??""))||void 0,E=Zu(ke,1,we,"polyline.set_points",pt,Nt),I=Sr(re.width,"polyline.set_width");return qs(ht,{kind:"polyline_set",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re),points:E.length?E:void 0,color:xo(re.color),width:I.value,widthExpr:I.expr,style:u0(String(re.style??""))||void 0,opacity:re.opacity!=null?Number(re.opacity):void 0,xloc:pt,yloc:Nt,layer:Gg(re.layer??re.Layer),zIndex:Yg(re.zindex??re.z_index??re.zIndex),includeInAutoscale:Kg(re.include_in_autoscale??re.includeInAutoscale??re.autoscale),groupId:Xl(re.group??re.group_id??re.groupId),tags:Mu(re.tags??re.tag)}),!0},Fl=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"polyline_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},Oa=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(_e=>!Iu(_e)),ht=va(ee),pt=d0(String(ee.xloc??""))||void 0,Nt=u_(String(ee.yloc??""))||void 0,E=Zu(Ee,0,we,"polygon.new",pt,Nt);if(E.length<3)return t.push({message:"polygon.new requires at least 3 points (x,y pairs)",line:we}),!0;const I=Vl(ee),W=K?$t(K):void 0;W&&(Xe[W]=I);const Z=Sr(ee.stroke_width??ee.strokeWidth,"polygon.stroke_width");return qs(I,{kind:"polygon_new",assign:W,once:re?!0:void 0,when:ht,points:E,fillColor:xo(ee.fill_color??ee.fillcolor??ee.color),strokeColor:xo(ee.stroke_color??ee.strokeColor??ee.borderColor),strokeWidth:Z.value,strokeWidthExpr:Z.expr,strokeStyle:u0(String(ee.stroke_style??ee.strokeStyle??""))||void 0,opacity:ee.opacity!=null?Number(ee.opacity):void 0,xloc:pt,yloc:Nt,layer:Gg(ee.layer??ee.Layer),zIndex:Yg(ee.zindex??ee.z_index??ee.zIndex),includeInAutoscale:Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),groupId:Xl(ee.group??ee.group_id??ee.groupId),tags:Mu(ee.tags??ee.tag)}),!0},ni=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ke=K.filter(W=>!Iu(W)),ee=ke[0],Ee=jl(ee);if(!Ee)return!0;const ht=d0(String(re.xloc??""))||void 0,pt=u_(String(re.yloc??""))||void 0,Nt=Zu(ke,1,we,"polygon.set_points",ht,pt),E=kr(re,Ee),I=Sr(re.stroke_width??re.strokeWidth,"polygon.stroke_width");return qs(E,{kind:"polygon_set",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re),points:Nt.length?Nt:void 0,fillColor:xo(re.fill_color??re.fillcolor??re.color),strokeColor:xo(re.stroke_color??re.strokeColor??re.borderColor),strokeWidth:I.value,strokeWidthExpr:I.expr,strokeStyle:u0(String(re.stroke_style??re.strokeStyle??""))||void 0,opacity:re.opacity!=null?Number(re.opacity):void 0,xloc:ht,yloc:pt,layer:Gg(re.layer??re.Layer),zIndex:Yg(re.zindex??re.z_index??re.zIndex),includeInAutoscale:Kg(re.include_in_autoscale??re.includeInAutoscale??re.autoscale),groupId:Xl(re.group??re.group_id??re.groupId),tags:Mu(re.tags??re.tag)}),!0},vc=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"polygon_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},gl=(oe,we,K,re)=>{const ke=Kr(oe||""),ee=qc(ke),Ee=ke.filter(me=>!Iu(me)),ht=va(ee),pt=d0(String(ee.xloc??""))||void 0,Nt=u_(String(ee.yloc??""))||void 0,E=Zu(Ee,0,we,"path.new",pt,Nt);if(!E.length)return t.push({message:"path.new requires at least one (x,y) point",line:we}),!0;const I=E.map((me,Le)=>({cmd:Le===0?"M":"L",x:me.x,y:me.y,xloc:me.xloc,yloc:me.yloc})),W=Vl(ee),Z=K?$t(K):void 0;Z&&(Xe[Z]=W);const _e=Sr(ee.width,"path.width");return qs(W,{kind:"path_new",assign:Z,once:re?!0:void 0,when:ht,commands:I,color:xo(ee.color),width:_e.value,widthExpr:_e.expr,style:u0(String(ee.style??""))||void 0,opacity:ee.opacity!=null?Number(ee.opacity):void 0,layer:Gg(ee.layer??ee.Layer),zIndex:Yg(ee.zindex??ee.z_index??ee.zIndex),includeInAutoscale:Kg(ee.include_in_autoscale??ee.includeInAutoscale??ee.autoscale),groupId:Xl(ee.group??ee.group_id??ee.groupId),tags:Mu(ee.tags??ee.tag)}),!0},za=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ke=K.filter(Z=>!Iu(Z)),ee=ke[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee),pt=d0(String(re.xloc??""))||void 0,Nt=u_(String(re.yloc??""))||void 0,E=Zu(ke,1,we,"path.set_points",pt,Nt),I=E.length>0?E.map((Z,_e)=>({cmd:_e===0?"M":"L",x:Z.x,y:Z.y,xloc:Z.xloc,yloc:Z.yloc})):void 0,W=Sr(re.width,"path.set_width");return qs(ht,{kind:"path_set",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re),commands:I,color:xo(re.color),width:W.value,widthExpr:W.expr,style:u0(String(re.style??""))||void 0,opacity:re.opacity!=null?Number(re.opacity):void 0,layer:Gg(re.layer??re.Layer),zIndex:Yg(re.zindex??re.z_index??re.zIndex),includeInAutoscale:Kg(re.include_in_autoscale??re.includeInAutoscale??re.autoscale),groupId:Xl(re.group??re.group_id??re.groupId),tags:Mu(re.tags??re.tag)}),!0},sl=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"path_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},Oc=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(I=>!Iu(I)),Ee=ee[0],ht=jl(Ee);if(!ht)return!0;const pt=String(oe||"").toLowerCase().replace(/_/g,""),Nt=kr(ke,ht),E={kind:"label_set",target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke)};if(pt==="x")E.x=Wr(ee[1],"label.set_x",K);else if(pt==="y")E.y=Wr(ee[1],"label.set_y",K);else if(pt==="xy")E.x=Wr(ee[1],"label.set_xy x",K),E.y=Wr(ee[2],"label.set_xy y",K);else if(pt==="text"){const I=ll(String(ee[1]??ke.text??""),"label_set_text");E.text=I.text,E.textExpr=I.textExpr}else if(pt==="color")E.color=xo(ee[1]??ke.color);else if(pt==="textcolor")E.textColor=xo(ee[1]??ke.textcolor??ke.textColor);else if(pt==="style")E.style=Ji(String(ee[1]??ke.style??""),K)||void 0;else if(pt==="size"){const I=Gi(ee[1]??ke.size,K);E.size=I.value??V1(String(ee[1]??ke.size??"")),E.sizeExpr=I.expr}else if(pt==="yloc")E.yloc=Al(String(ee[1]??ke.yloc??""),K)||void 0;else if(pt==="textalign")E.textAlign=fo(String(ee[1]??ke.textalign??ke.textAlign??""),K)||void 0;else if(pt==="tooltip"){const I=ll(String(ee[1]??ke.tooltip??""),"label_set_tooltip");E.tooltip=I.text,E.tooltipExpr=I.textExpr}else if(pt==="xloc")E.xloc=mf(String(ee[1]??ke.xloc??""),K)||void 0;else return t.push({message:`Unsupported label.set_${oe}()`,line:K}),!0;return qs(Nt,E),!0},Va=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"label_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},Wa=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(I=>!Iu(I)),Ee=ee[0],ht=jl(Ee);if(!ht)return!0;const pt=String(oe||"").toLowerCase().replace(/_/g,""),Nt=kr(ke,ht),E={kind:"box_set",target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke)};if(pt==="left")E.left=Wr(ee[1],"box.set_left",K);else if(pt==="right")E.right=Wr(ee[1],"box.set_right",K);else if(pt==="top")E.top=Wr(ee[1],"box.set_top",K);else if(pt==="bottom")E.bottom=Wr(ee[1],"box.set_bottom",K);else if(pt==="lefttop")E.left=Wr(ee[1],"box.set_lefttop left",K),E.top=Wr(ee[2],"box.set_lefttop top",K);else if(pt==="rightbottom")E.right=Wr(ee[1],"box.set_rightbottom right",K),E.bottom=Wr(ee[2],"box.set_rightbottom bottom",K);else if(pt==="bgcolor")E.bgColor=xo(ee[1]??ke.bgcolor??ke.bgColor);else if(pt==="bordercolor")E.borderColor=xo(ee[1]??ke.border_color??ke.borderColor);else if(pt==="borderwidth"){const I=Nn(ee[1]??ke.border_width??ke.borderWidth,K);E.width=I.value,E.widthExpr=I.expr}else if(pt==="borderstyle")E.borderStyle=If(String(ee[1]??ke.border_style??ke.borderStyle??""),K)||void 0;else if(pt==="text"){const I=ll(String(ee[1]??ke.text??""),"box_set_text");E.text=I.text,E.textExpr=I.textExpr}else if(pt==="textcolor")E.textColor=xo(ee[1]??ke.text_color??ke.textColor);else if(pt==="textsize"){const I=js(ee[1]??ke.text_size??ke.textSize,K);E.textSize=I.value,E.textSizeExpr=I.expr}else if(pt==="texthalign")E.textHalign=En(String(ee[1]??ke.text_halign??ke.textHalign??""),K)||void 0;else if(pt==="textvalign")E.textValign=ms(String(ee[1]??ke.text_valign??ke.textValign??""),K)||void 0;else if(pt==="textwrap"){const I=ee[1]??ke.text_wrap??ke.textWrap;I!=null&&(E.textWrap=Xg(String(I))??void 0)}else if(pt==="tooltip"){const I=ll(String(ee[1]??ke.tooltip??""),"box_set_tooltip");E.tooltip=I.text,E.tooltipExpr=I.textExpr}else if(pt==="extend")E.extend=yd(String(ee[1]??ke.extend??""),K)||void 0;else if(pt==="xloc")E.xloc=sc(String(ee[1]??ke.xloc??""),K)||void 0;else return t.push({message:`Unsupported box.set_${oe}()`,line:K}),!0;return qs(Nt,E),!0},uu=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"box_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},ud=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(I=>!Iu(I)),Ee=ee[0],ht=jl(Ee);if(!ht)return!0;const pt=String(oe||"").toLowerCase().replace(/_/g,""),Nt=kr(ke,ht),E={kind:"table_set",target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke)};if(pt==="position")E.position=L5(String(ee[1]??ke.position??""))||xr(String(ee[1]??ke.position??""));else if(pt==="bgcolor")E.bgcolor=xo(ee[1]??ke.bgcolor??ke.bgColor);else if(pt==="bordercolor")E.borderColor=xo(ee[1]??ke.border_color??ke.borderColor);else if(pt==="borderwidth"){const I=Sr(ee[1]??ke.border_width??ke.borderWidth,"table.set_border_width");E.borderWidth=I.value,E.borderWidthExpr=I.expr}else if(pt==="textcolor")E.textColor=xo(ee[1]??ke.text_color??ke.textColor);else if(pt==="textsize"){const I=ql(ee[1]??ke.text_size??ke.textSize,"table.set_text_size");E.textSize=I.value,E.textSizeExpr=I.expr}else if(pt==="texthalign")E.textHalign=d_(String(ee[1]??ke.text_halign??ke.textHalign??""))||void 0;else if(pt==="textvalign")E.textValign=W1(String(ee[1]??ke.text_valign??ke.textValign??""))||void 0;else if(pt==="framecolor")E.frameColor=xo(ee[1]??ke.frame_color??ke.frameColor);else if(pt==="framewidth"){const I=Sr(ee[1]??ke.frame_width??ke.frameWidth,"table.set_frame_width");E.frameWidth=I.value,E.frameWidthExpr=I.expr}else return t.push({message:`Unsupported table.set_${oe}()`,line:K}),!0;return qs(Nt,E),!0},Ll=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ee=K.filter(pt=>!Iu(pt))[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee);return qs(ht,{kind:"table_delete",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)}),!0},vu=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ke=K.filter(E=>!Iu(E)),ee=ke[0],Ee=jl(ee);if(!Ee)return!0;const ht=kr(re,Ee),pt=(E,I)=>{if(!(E==null||String(E).trim()===""))return Wr(String(E),I,we)||void 0},Nt={kind:"table_clear",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)};return Nt.startColumn=pt(ke[1]??re.start_column??re.start_col,"table.clear start_column"),Nt.startRow=pt(ke[2]??re.start_row,"table.clear start_row"),Nt.endColumn=pt(ke[3]??re.end_column??re.end_col,"table.clear end_column"),Nt.endRow=pt(ke[4]??re.end_row,"table.clear end_row"),qs(ht,Nt),!0},Sc=(oe,we)=>{const K=Kr(oe||""),re=qc(K),ke=K.filter(Z=>!Iu(Z)),ee=ke[0],Ee=jl(ee);if(!Ee)return!0;const ht=ke[1]??re.left,pt=ke[2]??re.top,Nt=ke[3]??re.right,E=ke[4]??re.bottom;if(ht==null||pt==null||Nt==null||E==null)return t.push({message:"table.merge(table, left, top, right, bottom) requires 4 numeric args",line:we}),!0;const I=kr(re,Ee),W={kind:"table_merge",target:Ee,targetExpr:ee!=null?String(ee):void 0,when:va(re)};return W.left=Wr(String(ht),"table.merge left",we)||void 0,W.top=Wr(String(pt),"table.merge top",we)||void 0,W.right=Wr(String(Nt),"table.merge right",we)||void 0,W.bottom=Wr(String(E),"table.merge bottom",we)||void 0,qs(I,W),!0},Ja=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(me=>!Iu(me)),Ee=ee[0]??"",ht=jl(String(Ee||""))||"",pt=ee[1]??ke.column??ke.col,Nt=ee[2]??ke.row,E=pt!=null?Number(pt):NaN,I=Nt!=null?Number(Nt):NaN;if(!ht||!Number.isFinite(E)||!Number.isFinite(I))return t.push({message:"table.cell_set_* requires a table id and numeric column/row",line:K}),!0;const W=String(oe||"").toLowerCase().replace(/_/g,""),Z=kr(ke,ht),_e={kind:"table_cell_set",target:ht,targetExpr:Ee!=null?String(Ee):void 0,when:va(ke),column:Math.floor(E),row:Math.floor(I)};if(W==="text"){const me=ll(String(ee[3]??ke.text??""),"table_cell_set_text");_e.text=me.text,_e.textExpr=me.textExpr}else if(W==="textcolor")_e.textColor=xo(ee[3]??ke.text_color??ke.textColor);else if(W==="bgcolor")_e.bgcolor=xo(ee[3]??ke.bgcolor??ke.bgColor);else if(W==="textsize"){const me=ql(ee[3]??ke.text_size??ke.textSize,"table.cell_set_text_size");_e.textSize=me.value,_e.textSizeExpr=me.expr}else if(W==="texthalign")_e.textHalign=d_(String(ee[3]??ke.text_halign??ke.textHalign??""))||void 0;else if(W==="textvalign")_e.textValign=W1(String(ee[3]??ke.text_valign??ke.textValign??""))||void 0;else if(W==="width"){const me=Sr(ee[3]??ke.width,"table.cell_set_width");_e.width=me.value,_e.widthExpr=me.expr}else if(W==="height"){const me=Sr(ee[3]??ke.height,"table.cell_set_height");_e.height=me.value,_e.heightExpr=me.expr}else if(W==="tooltip"){const me=ll(String(ee[3]??ke.tooltip??""),"table_cell_set_tooltip");_e.tooltip=me.text,_e.tooltipExpr=me.textExpr}else return t.push({message:`Unsupported table.cell_set_${oe}()`,line:K}),!0;return qs(Z,_e),!0};for(let oe=0;oe<$.length;oe++){const we=oe,K=$[oe],re=K.text.match(/^\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>\s*(.*)$/);if(!re)continue;const ke=re[1],ee=re[2]||"";let Ee=String(re[3]||"").trim(),ht;if(!Ee){const E=K.indent,I=[];let W=oe+1;for(;W<$.length&&$[W].indent>E;)$[W].text.startsWith("//@pine_fn")||I.push($[W]),W+=1;const Z=I.map(Le=>String(Le.text||"").trim()).filter(Boolean);if(!Z.length){e.push({message:`Function "${ke}" requires a body expression`,line:K.lineNo});continue}ht=I.map(Le=>({text:String(Le.text||""),lineNo:Le.lineNo,indent:Le.indent}));const _e=Z[Z.length-1];Ee=_e.replace(/^return\s+/i,"").trim()||_e;for(let Le=oe+1;Le<W;Le++)$[Le]={...$[Le],text:"//@pine_fn"};oe=W-1}const pt=Kr(ee).map(E=>String(E||"").trim()).filter(Boolean).map(E=>{const I=E.match(/^(?:(?:varip|var)\s+)?(?:float|int|bool|string)\s+([A-Za-z_$][A-Za-z0-9_$]*)$/i);return(I?I[1]:E).trim()}),Nt=$t(ke);St[Nt]&&t.push({message:`Duplicate function definition "${ke}" (later definition overrides).`,line:K.lineNo}),St[Nt]={name:ke,args:pt,body:Ee,lineNo:K.lineNo,bodyLines:ht},$[we]={...K,text:"//@pine_fn"}}const ga=oe=>{const we=String(oe||"").trim(),K=$t(we),re=Tt[K];return re||we},Wu=oe=>{const we=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,K=new Map,re=new Set,ke=Ee=>{const ht=$t(Ee);if(K.has(ht))return K.get(ht);const pt=Tt[ht];if(!pt)return Ee;if(re.has(ht))return pt;re.add(ht);const Nt=String(pt).replace(we,E=>{const I=$t(E);return Tt[I]?`(${ke(I)})`:E});return re.delete(ht),K.set(ht,Nt),Nt},ee=ga(oe);return String(ee).replace(we,Ee=>{const ht=$t(Ee);return Tt[ht]?`(${ke(ht)})`:Ee})},zc=oe=>{const we=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,K=new Map,re=new Set,ke=I=>{const W=$t(I);if(K.has(W))return K.get(W);const Z=Tt[W];if(!Z)return I;if(re.has(W))return Z;re.add(W);const _e=String(Z).replace(we,me=>{const Le=$t(me);return Tt[Le]?`(${ke(Le)})`:me});return re.delete(W),K.set(W,_e),_e},ee=ga(oe),Ee=String(ee).replace(we,I=>{const W=$t(I);return Tt[W]?`(${ke(W)})`:I}),ht=new Set(Ve.map(I=>$t(String((I==null?void 0:I.name)||""))).filter(Boolean)),pt=new Set(Object.keys(ft||{}).map(I=>$t(I)).filter(Boolean)),Nt=new Set(["open","high","low","close","volume","time","and","or","not","true","false","crossesabove","crossesbelow"]);return Ee.replace(we,(I,W)=>{const Z=$t(I);if(!Z||Nt.has(Z))return I;const _e=Ee.slice(W+I.length);return/^\s*\(/.test(_e)||!pt.has(Z)||ht.has(Z)?I:`\${${I}}`})},eu=oe=>oe===">"||oe==="<"||oe===">="||oe==="<="||oe==="=="||oe==="!=",Ud=oe=>{if(!oe||typeof oe!="object")return!1;if(oe.kind==="BinaryExpression"){const we=oe.left,K=oe.right;return eu(oe.operator)&&(we.kind==="BinaryExpression"&&eu(we.operator)||K.kind==="BinaryExpression"&&eu(K.operator))?!0:Ud(we)||Ud(K)}return oe.kind==="UnaryExpression"?Ud(oe.expr):oe.kind==="MemberExpression"?Ud(oe.object):oe.kind==="IndexExpression"?Ud(oe.object)||Ud(oe.index):oe.kind==="CallExpression"?oe.args.some(we=>Ud(we)):!1},qf="Chained comparisons are only supported in simple form. Rewrite as (a < b) and (b < c).",Uf=oe=>{oe!=null&&(o.has(oe)||(e.push({message:qf,line:oe}),o.add(oe)))},dd=oe=>!!oe&&/[A-Za-z0-9_$]/.test(oe),Id=(oe,we,K)=>{if(oe.slice(we,we+K.length).toLowerCase()!==K)return!1;const re=oe[we-1],ke=oe[we+K.length];return!(dd(re)||dd(ke))},dc=oe=>{let we=oe.trim(),K=0;for(;we.startsWith("(")&&we.endsWith(")");){let re=0,ke=null,ee=!0;for(let Ee=0;Ee<we.length;Ee++){const ht=we[Ee];if(ke){ht===ke&&we[Ee-1]!=="\\"&&(ke=null);continue}if(ht==="'"||ht==='"'){ke=ht;continue}if(ht==="(")re+=1;else if(ht===")"&&(re-=1,re===0&&Ee<we.length-1)){ee=!1;break}}if(!ee||re!==0||ke)break;we=we.slice(1,-1).trim(),K+=1}return{inner:we,wraps:K}},Gf=oe=>{const we=[],K=[];let re=0,ke=0,ee=0,Ee=0,ht=null,pt=!1,Nt=0;for(;Nt<oe.length;){const E=oe[Nt];if(ht){E===ht&&oe[Nt-1]!=="\\"&&(ht=null),Nt+=1;continue}if(E==="'"||E==='"'){ht=E,Nt+=1;continue}if(E==="("){ke+=1,Nt+=1;continue}if(E===")"){ke=Math.max(0,ke-1),Nt+=1;continue}if(E==="{"){ee+=1,Nt+=1;continue}if(E==="}"){ee=Math.max(0,ee-1),Nt+=1;continue}if(E==="["){Ee+=1,Nt+=1;continue}if(E==="]"){Ee=Math.max(0,Ee-1),Nt+=1;continue}if(ke||ee||Ee){Nt+=1;continue}const I=oe.slice(Nt,Nt+2);if(I==="<="||I===">="||I==="=="||I==="!="){we.push(oe.slice(re,Nt).trim()),K.push(I),Nt+=2,re=Nt;continue}if(E==="<"||E===">"){we.push(oe.slice(re,Nt).trim()),K.push(E),Nt+=1,re=Nt;continue}if(Id(oe,Nt,"and")){pt=!0,Nt+=3;continue}if(Id(oe,Nt,"or")){pt=!0,Nt+=2;continue}if(Id(oe,Nt,"not")){pt=!0,Nt+=3;continue}if(E==="?"){pt=!0,Nt+=1;continue}if(E===":"){oe[Nt+1]==="="&&(Nt+=1),pt=!0,Nt+=1;continue}if(E===","){pt=!0,Nt+=1;continue}if(E==="="){pt=!0,Nt+=1;continue}Nt+=1}return K.length&&we.push(oe.slice(re).trim()),{terms:we,ops:K,hasChain:K.length>1,complex:pt}},Pd=oe=>{const we=oe.trim();if(!we)return!1;let K=0,re=null,ke=0;for(;ke<we.length;){const ee=we[ke];if(re){ee===re&&we[ke-1]!=="\\"&&(re=null),ke+=1;continue}if(ee==="'"||ee==='"'){re=ee,ke+=1;continue}if(ee==="("){K+=1,ke+=1;continue}if(ee===")"){K=Math.max(0,K-1),ke+=1;continue}if(ee==="{"){ke+=1;continue}if(ee==="}"){ke+=1;continue}if(ee==="["){ke+=1;continue}if(ee==="]"){ke+=1;continue}if(Id(we,ke,"and")||Id(we,ke,"or")||Id(we,ke,"not"))return!1;const Ee=we.slice(ke,ke+2);if(Ee==="<="||Ee===">="||Ee==="=="||Ee==="!="||ee==="<"||ee===">"||ee==="?"||ee===":"||ee==="="||ee===","&&(K<=0||K>1))return!1;ke+=1}return!0},af=(oe,we)=>{if(!/[<>!=]=?|==/.test(oe))return oe;const{inner:K,wraps:re}=dc(oe),ke=Gf(K);if(ke.hasChain&&!ke.complex){const ee=ke.ops.some(Nt=>Nt==="=="||Nt==="!="),Ee=ke.terms.length===ke.ops.length+1&&ke.terms.every(Nt=>Pd(Nt));if(ee||!Ee)return Uf(we),oe;const ht=[];for(let Nt=0;Nt<ke.ops.length;Nt++)ht.push(`(${ke.terms[Nt]}) ${ke.ops[Nt]} (${ke.terms[Nt+1]})`);let pt=ht.join(" and ");for(let Nt=0;Nt<re;Nt++)pt=`(${pt})`;return pt}try{const ee=oe.replace(/\$\{[^}]+\}/g,"1"),Ee=Ap(ee);Ud(Ee)&&Uf(we)}catch{}return oe},ol=(oe,we)=>{if(oe==null)return{};const K=zc(D_(co(String(oe),"when")));if(!K)return{};try{const re=K.replace(/\$\{[^}]+\}/g,"1");Ap(re)}catch(re){const ke=(re==null?void 0:re.message)||String(re);e.push({message:`Pine condition parse failed: ${ke}`,line:we})}return{whenExpr:K}},du=(oe,we)=>{const K=String(oe||"").trim(),re=co(K,we),ke=re.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(ke)return ke[0];const ee=Qm(re);if(ee!=null){const Nt=`__const_${String(ee).replace(/[^\d]/g,"_")}`;return Ve.some(E=>E.name.toLowerCase()===Nt.toLowerCase())||Ve.push({name:Nt,expr:String(ee)}),Nt}const Ee=we.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase();let ht=`__${Ee||"expr"}`,pt=1;for(;Ve.some(Nt=>Nt.name.toLowerCase()===ht.toLowerCase());)pt+=1,ht=`__${Ee||"expr"}_${pt}`;return Ve.push({name:ht,expr:re}),ht},Nu=(oe,we)=>{const K=xr(String(oe||"").trim()),re=$t(K);return Be[re]?Be[re]:du(K,we).replace(/\s+/g,"_").toLowerCase()},hf=(oe,we,K)=>{const re=Kr(oe||"");if(!re.length){e.push({message:"plot() requires at least 1 argument",line:we});return}const ke=re[0],ee=re[1]&&!re[1].includes("=")?re[1]:null,Ee=qc(re),ht=Vl(Ee),pt=Te(ht),Nt=du(ke,xr(String(Ee.title??Ee.name??ee??ke??"plot"))),E=Sr(Ee.offset,"plot_offset"),I=Sr(Ee.show_last,"plot_show_last"),W=Sr(Ee.precision,"plot_precision"),Z=E.value!=null?E.value:E.expr,_e=I.value!=null?I.value:I.expr,me=W.value!=null?W.value:W.expr,Le=Ee.display!=null?String(Ee.display):void 0,ye=Ee.trackprice!=null?Xg(String(Ee.trackprice)):void 0,Se=Ee.transp??Ee.transparency,Ge=Se!=null?Number(Se):void 0,Ae=xo(String(Ee.color??"")),Rt=U0(Ae,Ge),nn=F5(Ee.type),Xn=F5(Ee.style),hn=nn??Xn??xr(String(Ee.type??"line"))??"line",is=Ee.linestyle??Ee.line_style??Ee.lineStyle??(Xn?void 0:Ee.style),Gs=is?u0(String(is)):void 0,es=Nt.replace(/\s+/g,"_").toLowerCase();pt.plots.push({name:xr(String(Ee.title??Ee.name??ee??Nt)),source:es,type:hn,color:Rt,width:Ee.width!=null?Number(Ee.width):Ee.linewidth!=null?Number(Ee.linewidth):void 0,style:Gs??void 0,offset:Z,showLast:_e,precision:me,display:Le,trackPrice:ye}),K&&(Be[$t(K)]=es)},td=(oe,we,K)=>{const re=Kr(we||""),ke=qc(re),ee=re.filter(Qo=>!Iu(Qo));if(ee.length<4){e.push({message:`${oe} plot requires open/high/low/close`,line:K});return}const Ee=Vl(ke),ht=Te(Ee),pt=du(ee[0],`${oe}_open`).replace(/\s+/g,"_").toLowerCase(),Nt=du(ee[1],`${oe}_high`).replace(/\s+/g,"_").toLowerCase(),E=du(ee[2],`${oe}_low`).replace(/\s+/g,"_").toLowerCase(),I=du(ee[3],`${oe}_close`).replace(/\s+/g,"_").toLowerCase(),W=xr(String(ke.title??ke.name??ee[4]??oe)),Z=ke.color??ee[5]??"",_e=ke.colordown??ke.color_down??ke.colordn??"",me=ke.wickcolor??ee[6]??"",Le=ke.bordercolor??ee[7]??"",ye=ke.transp??ke.transparency,Se=ye!=null?Number(ye):void 0,Ge=U0(xo(String(Z)),Se),Ae=U0(xo(String(_e))||Ge,Se),Rt=U0(xo(String(me)),Se),nn=U0(xo(String(Le)),Se),Xn=Sr(ke.offset,`${oe}_offset`),hn=Sr(ke.show_last,`${oe}_show_last`),is=Sr(ke.precision,`${oe}_precision`),Gs=Xn.value!=null?Xn.value:Xn.expr,es=hn.value!=null?hn.value:hn.expr,Mi=is.value!=null?is.value:is.expr,Kn=ke.display!=null?String(ke.display):void 0,Es=ke.trackprice!=null?Xg(String(ke.trackprice)):void 0;ht.plots.push({name:W||oe,type:oe,open:pt,high:Nt,low:E,close:I,color:Ge||(oe==="candles"?"#22c55e":"#64748b"),downColor:Ae||"#ef4444",wickColor:Rt||void 0,borderColor:nn||void 0,offset:Gs,showLast:es,precision:Mi,display:Kn,trackPrice:Es})},Cc=(oe,we,K)=>{const re=we.match(/^input\.(int|float|bool|string|time|session|source|symbol|color)\s*\((.*)\)\s*$/i);if(!re)return!1;const ke=re[1].toLowerCase(),ee=Kr(re[2]||""),Ee=qc(ee),ht=ee.filter(ye=>!Iu(ye)),pt=Ee.defval??ht[0]??"",Nt=Ee.title??ht[1]??"",E=Nt?xr(String(Nt)):void 0,I=ye=>{e.push({message:ye,line:K})},W=ye=>{const Se=typeof ye=="number"?ye:Number(ye);return Number.isFinite(Se)?Se:void 0},Z=W(Ee.minval),_e=W(Ee.maxval),me=W(Ee.step);let Le=null;if(ke==="bool"){const ye=Xg(String(pt));if(ye==null)return I(`input.bool() requires defval true/false for "${oe}"`),!0;Le=ye}else if(ke==="string"||ke==="session"||ke==="symbol")Le=xr(String(pt||""));else if(ke==="color"){const ye=A5(String(pt))||xr(String(pt||""));if(!ye)return I(`input.color() requires a valid color for "${oe}"`),!0;Le=ye}else if(ke==="time"){const ye=W(String(pt));if(ye!=null)Le=ye;else{const Se=jJ(String(pt))??(()=>{const Ge=xr(String(pt||"")),Ae=Date.parse(Ge);return Number.isFinite(Ae)?Ae:null})();if(Se==null)return I(`input.time() requires a numeric or timestamp defval for "${oe}"`),!0;Le=Se}}else if(ke==="source"){const ye=co(String(pt||"close"),`input_source_${oe}`),Se=ye.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);Le=Se?Se[0]:du(ye,`input_source_${oe}`)}else{const ye=W(pt);if(ye==null)return I(`input.${ke}() requires numeric defval for "${oe}"`),!0;Le=ke==="int"?Math.floor(ye):ye}return ft[oe]=Le,Lt[$t(oe)]=ke,it.push({name:oe,type:ke,title:E,defval:Le,minval:Z,maxval:_e,step:me}),!0},Gd=[];let tu=0;const Vc=(oe,we,K,re)=>{var ht,pt;const ke=[],ee=Nt=>re.some(E=>$t(E)===$t(Nt));let Ee=we;for(;Ee<oe.length;){const Nt=oe[Ee];if(Nt.indent<=K)break;const E=String(Nt.text||"").trim();if(!E||E.startsWith("//")){Ee+=1;continue}if(E==="break"){ke.push({kind:"break",lineNo:Nt.lineNo}),Ee+=1;continue}if(E==="continue"){ke.push({kind:"continue",lineNo:Nt.lineNo}),Ee+=1;continue}const I=E.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(I){const ye=Nt.indent,Se=[],Ge=String(I[1]??I[2]??"").trim();gn=Nt.lineNo;const Ae=Ge?co(Ge,"loop_if"):"",Rt=Vc(oe,Ee+1,ye,re);Se.push({cond:Ae||void 0,body:Rt.ops,lineNo:Nt.lineNo});let nn=Rt.nextIdx;for(;nn<oe.length&&oe[nn].indent===ye;){const Xn=String(oe[nn].text||"").trim(),hn=Xn.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(hn){const is=String(hn[1]??hn[2]??"").trim();gn=oe[nn].lineNo;const Gs=is?co(is,"loop_if"):"",es=Vc(oe,nn+1,ye,re);Se.push({cond:Gs||void 0,body:es.ops,lineNo:oe[nn].lineNo}),nn=es.nextIdx;continue}if(/^else$/i.test(Xn)){const is=Vc(oe,nn+1,ye,re);Se.push({cond:void 0,body:is.ops,lineNo:oe[nn].lineNo}),nn=is.nextIdx}break}ke.push({kind:"if",lineNo:Nt.lineNo,branches:Se}),Ee=nn;continue}const W=E.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(W){const ye=W[1],Se=String(W[2]??"").trim(),Ge=String(W[3]??"").trim(),Ae=String(W[4]??"1").trim();gn=Nt.lineNo;const Rt=co(Se,`for_start_${ye}`),nn=co(Ge,`for_end_${ye}`),Xn=co(Ae,`for_step_${ye}`),hn=Vc(oe,Ee+1,Nt.indent,[...re,ye]);hn.nextIdx===Ee+1&&e.push({message:"for-loop requires an indented body",line:Nt.lineNo}),ke.push({kind:"for",lineNo:Nt.lineNo,varName:ye,startExpr:Rt,endExpr:nn,stepExpr:Xn,body:hn.ops}),Ee=hn.nextIdx;continue}const Z=E.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(Z){const ye=String(Z[1]??Z[2]??"").trim();gn=Nt.lineNo;const Se=co(ye,"while_cond"),Ge=Vc(oe,Ee+1,Nt.indent,re);Ge.nextIdx===Ee+1&&e.push({message:"while-loop requires an indented body",line:Nt.lineNo}),ke.push({kind:"while",lineNo:Nt.lineNo,condExpr:Se,body:Ge.ops}),Ee=Ge.nextIdx;continue}const _e=E.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(_e){const ye=String(_e[1]||"").toLowerCase(),Se=Kr(_e[2]||""),Ge=String(Se[0]||"").trim(),Ae=$t(Ge);if(!Ge){e.push({message:`array.${ye} requires array name`,line:Nt.lineNo}),Ee+=1;continue}if(!!xt[Ae]||((ht=Je[Ae])==null?void 0:ht.kind)==="string"){e.push({message:`array.${ye} on string arrays is not supported inside loops`,line:Nt.lineNo}),Ee+=1;continue}if(!Je[Ae]&&!st[Ae]){e.push({message:`array.${ye} unknown array "${Ge}"`,line:Nt.lineNo}),Ee+=1;continue}if(!Je[Ae]&&st[Ae]&&jo(Ae,st[Ae].length,st[Ae]),ye==="push"||ye==="unshift"||ye==="insert"){const hn=Je[Ae];if(hn){const is=Math.min(bs,Math.max(hn.capacity,hn.size+ro));ar(Ae,is)}}if(ye==="resize"){const hn=Je[Ae];if(hn){const is=String(Se[1]||"0"),Gs=Is(is);if(Gs!=null){const es=Math.min(bs,Math.max(hn.capacity,Math.floor(Gs)));ar(Ae,es)}}}ja(Ae);const nn={};ye==="push"||ye==="unshift"?nn.value=Se[1]:ye==="insert"?(nn.index=Se[1],nn.value=Se[2]):ye==="remove"?nn.index=Se[1]:ye==="resize"&&(nn.size=Se[1]);const Xn=nc(Ae,ye,nn,Nt.lineNo);if(!Xn){Ee+=1;continue}Xn.forEach(hn=>{ke.push({kind:"assign",name:hn.name,op:hn.op,expr:hn.rhs,lineNo:hn.lineNo})}),Ee+=1;continue}const me=E.match(/^array\.set\s*\((.*)\)\s*$/i);if(me){const ye=Kr(me[1]||""),Se=String(ye[0]||"").trim(),Ge=String(ye[1]||"").trim(),Ae=String(ye[2]||"").trim();if(!Se||!Ge||!Ae){e.push({message:"array.set(name, index, value) requires 3 args",line:Nt.lineNo}),Ee+=1;continue}const Rt=$t(Se);if(!Je[Rt]&&!st[Rt]&&!xt[Rt]){e.push({message:`array.set unknown array "${Se}"`,line:Nt.lineNo}),Ee+=1;continue}if(xt[Rt]){e.push({message:"array.set on string arrays is not supported inside loops",line:Nt.lineNo}),Ee+=1;continue}!Je[Rt]&&st[Rt]&&jo(Rt,st[Rt].length,st[Rt]);const nn=co(Ge,`${Rt}_idx`),Xn=hi(nn),hn=co(Ae,`${Rt}_set`),is=(pt=Je[Rt])==null?void 0:pt.sizeSeries,Gs=is!=null?`(${Xn}) >= 0 and (${Xn}) < ${is}`:void 0,es=wc(Rt,Xn,hn,Gs);if(!es){e.push({message:"array.set index must be within array size",line:Nt.lineNo}),Ee+=1;continue}es.forEach((Mi,Kn)=>{ke.push({kind:"assign",name:zt(Rt,Kn),op:":=",expr:Mi,lineNo:Nt.lineNo})}),Ee+=1;continue}const Le=E.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(Le){const ye=Le[3];if(ee(ye)){e.push({message:`Loop variable "${ye}" is read-only`,line:Nt.lineNo}),Ee+=1;continue}const Se=Le[4],Ge=String(Le[5]||"").trim();gn=Nt.lineNo;const Ae=co(Ge,ye);ke.push({kind:"assign",name:ye,op:Se,expr:Ae,lineNo:Nt.lineNo}),Ee+=1;continue}e.push({message:`Unsupported statement inside loop: ${Nt.text}`,line:Nt.lineNo}),Ee+=1}return{ops:ke,nextIdx:Ee}},Yd=(oe,we)=>{for(const K of oe){if(K.kind==="assign"){we.add(K.name);continue}if(K.kind==="if"){K.branches.forEach(re=>Yd(re.body,we));continue}(K.kind==="for"||K.kind==="while")&&Yd(K.body,we)}},Md=oe=>{const we=oe.qty_percent??oe.qtyPct??oe.qtyPctVal??oe.qtyPercent,K=we!=null?Number(we):void 0,re=oe.qty??oe.quantity,ke=oe.cash??oe.cashQty??oe.cash_qty,ee=oe.oco??oe.oca_name??oe.ocaName??oe.oca,Ee=ee?xr(String(ee)):void 0,ht=oe.expiresBars!=null?Number(oe.expiresBars):void 0,pt=oe.commission??oe.commissionPct??oe.commission_pct,Nt=oe.slippage??oe.slippagePct??oe.slippage_pct,E=oe.stop??oe.stopPrice,I=oe.limit??oe.limitPrice,W=oe.price,Z=(nn,Xn)=>{if(nn==null)return null;const hn=co(String(nn),Xn);if(!hn)return null;const is=hn.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(is)return is[0];const Gs=Qm(xr(hn));return Gs!=null?String(Gs):du(hn,Xn)},_e=Z(E,"order_stop"),me=Z(I,"order_limit"),Le=Z(W,"order_price"),ye=Z(re,"order_qty"),Se=Z(ke,"order_cash"),Ge=pt!=null?Qm(xr(String(pt))):null,Ae=Nt!=null?Qm(xr(String(Nt))):null,Rt={};return typeof K=="number"&&Number.isFinite(K)&&(Rt.qtyPct=K),ye&&(Rt.qty=ye),Se&&(Rt.cash=Se),Ee&&(Rt.oco=Ee),typeof ht=="number"&&Number.isFinite(ht)&&(Rt.expiresBars=ht),Ge!=null&&Number.isFinite(Ge)&&(Rt.commissionPct=Ge),Ae!=null&&Number.isFinite(Ae)&&(Rt.slippagePct=Ae),_e&&me?(Rt.kind="stop_limit",Rt.stopPrice=_e,Rt.limitPrice=me,Rt):me?(Rt.kind="limit",Rt.price=me,Rt):_e?(Rt.kind="stop",Rt.price=_e,Rt):Le?(Rt.kind="market",Rt):Object.keys(Rt).length?{kind:"market",...Rt}:null},Au=oe=>{const we=ee=>{let Ee=null,ht=0;const pt=_e=>/[A-Za-z0-9_$]/.test(_e),Nt=ee.toLowerCase(),E=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let I=null;for(let _e=0;_e<ee.length;_e++){const me=ee[_e];if(Ee){me===Ee&&ee[_e-1]!=="\\"&&(Ee=null);continue}if(me==="'"||me==='"'){Ee=me;continue}if(me==="("){ht+=1;continue}if(me===")"){ht=Math.max(0,ht-1);continue}if(!(ht>0)&&!(_e>0&&pt(ee[_e-1])))for(const Le of E){if(!Nt.startsWith(Le.token,_e))continue;const ye=_e+Le.token.length;if(ye<ee.length&&pt(ee[ye]))continue;let Se=ye;for(;Se<ee.length&&/\s/.test(ee[Se]);)Se+=1;const Ge=ee[Se];if(!(Ge!=="="&&Ge!==":")){I={key:Le.key,start:_e,valueStart:Se+1};break}}}if(!I)return null;const W=ee.slice(0,I.start).replace(/[,;]+\s*$/,"").trim(),Z=ee.slice(I.valueStart).trim();return{key:I.key,when:W,value:Z}};let K=oe.trim(),re,ke;for(let ee=0;ee<4;ee++){const Ee=we(K);if(!Ee)break;K=Ee.when,Ee.key==="score"&&re==null&&(re=Ee.value),Ee.key==="cooldown"&&ke==null&&(ke=Ee.value)}return{when:K.trim(),scoreRaw:re,cooldownRaw:ke}},Kd=(oe,we,K)=>{if(oe==null)return;const re=co(String(oe),K),ke=Cs(re);if(ke==null||!Number.isFinite(ke)){e.push({message:"score must be an integer between 0 and 10",line:we});return}if(!Number.isInteger(ke)){e.push({message:"score must be an integer between 0 and 10",line:we});return}if(ke<0||ke>10){e.push({message:"score must be in range 0..10",line:we});return}return ke},Hu=(oe,we,K)=>{if(oe==null)return;const re=co(String(oe),K),ke=Cs(re);if(ke==null||!Number.isFinite(ke)){e.push({message:"cooldown must be a non-negative integer",line:we});return}if(!Number.isInteger(ke)){e.push({message:"cooldown must be a non-negative integer",line:we});return}if(ke<0){e.push({message:"cooldown must be a non-negative integer",line:we});return}return ke},Tu=(oe,we,K)=>{const re=oe.cooldown??oe.cooldownBars??oe.cooldown_bars??oe.cooldownbars;return re==null?{value:void 0,hadRaw:!1}:{value:Hu(String(re),we,K),hadRaw:!0}};for(let oe=0;oe<$.length;oe++){const we=$[oe],K=we.lineNo;gn=K;let re=we.text.trim();if(!re||re.startsWith("//@pine_fn")||re.startsWith("//@pine_loop")||(/^\s*export\s+/i.test(re)&&(re=te(re),$[oe]={...we,text:re}),re.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i))||re.match(/^library\s*\((.*)\)\s*$/i))continue;const Ee=re.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(Ee){const An=Ee[3],yt=re.includes(":=")?":=":"=",Rn=String(Ee[4]??Ee[5]??"").trim(),_n=we.indent,Vs=[];let Ms=oe+1;for(;Ms<$.length&&$[Ms].indent>_n;){const Zo=$[Ms].text.trim(),ao=Zo.indexOf("=>");if(ao>=0){const Ho=Zo.slice(0,ao).trim(),so=Zo.slice(ao+2).trim();Vs.push({cond:Ho||void 0,expr:so||void 0,lineNo:$[Ms].lineNo})}Ms+=1}if(!Vs.length){e.push({message:"switch requires at least one case",line:K});continue}const $s=Rn?co(Rn,`switch_${An}`):"";let wo="na";for(let Zo=Vs.length-1;Zo>=0;Zo--){const ao=Vs[Zo],Ho=ao.expr?co(ao.expr,`switch_${An}_case`):"na";if(!ao.cond){wo=Ho;continue}wo=`iff(${$s?`(${$s}) == (${co(ao.cond,`switch_${An}_cond`)})`:`(${co(ao.cond,`switch_${An}_cond`)})`}, ${Ho}, ${wo})`}$.splice(oe,Ms-oe,{text:`${An} ${yt} ${wo}`,indent:_n,lineNo:K}),oe-=1;continue}const ht=re.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(ht){const An=String(ht[1]??ht[2]??"").trim(),yt=we.indent,Rn=[];let _n=oe+1;for(;_n<$.length&&$[_n].indent>yt;){const $s=$[_n].text.trim(),wo=$s.indexOf("=>");if(wo>=0){const Zo=$s.slice(0,wo).trim(),ao=$s.slice(wo+2).trim();Rn.push({cond:Zo||void 0,expr:ao||void 0,lineNo:$[_n].lineNo})}_n+=1}if(!Rn.length){e.push({message:"switch requires at least one case",line:K});continue}const Vs=An?co(An,"switch_expr"):"",Ms=[];Rn.forEach(($s,wo)=>{if($s.expr){if(!$s.cond)Ms.push({text:"else",indent:yt,lineNo:$s.lineNo});else if(wo===0){const Zo=Vs?`(${Vs}) == (${co($s.cond,"switch_cond")})`:`(${co($s.cond,"switch_cond")})`;Ms.push({text:`if (${Zo})`,indent:yt,lineNo:$s.lineNo})}else{const Zo=Vs?`(${Vs}) == (${co($s.cond,"switch_cond")})`:`(${co($s.cond,"switch_cond")})`;Ms.push({text:`else if (${Zo})`,indent:yt,lineNo:$s.lineNo})}Ms.push({text:$s.expr,indent:yt+1,lineNo:$s.lineNo})}}),$.splice(oe,_n-oe,...Ms),oe-=1;continue}const pt=re.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(pt){const An=pt[1],yt=String(pt[2]??"").trim(),Rn=String(pt[3]??"").trim(),_n=String(pt[4]??"1").trim(),Vs=we.indent,Ms=Vc($,oe+1,Vs,[An]);if(Ms.nextIdx===oe+1){e.push({message:"for-loop requires an indented body",line:K});continue}const $s=`__loop_${++tu}`;gn=K;const wo={id:$s,kind:"for",lineNo:K,varName:An,startExpr:co(yt,`for_start_${An}`),endExpr:co(Rn,`for_end_${An}`),stepExpr:co(_n,`for_step_${An}`),body:Ms.ops};Gd.push(wo);const Zo=new Set;Yd(wo.body,Zo);const ao=Array.from(Zo).filter(Ho=>!$t(Ho).startsWith("__arr_"));ao.forEach(Ho=>{We.push({name:Ho,updateExpr:`__loop_exec("${$s}", "${Ho}")`})}),ao.length||We.push({name:`__loop_exec_${$s}`,updateExpr:`__loop_exec("${$s}")`});for(let Ho=oe;Ho<Ms.nextIdx;Ho++)$[Ho]={...$[Ho],text:"//@pine_loop"};oe=Ms.nextIdx-1;continue}const Nt=re.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(Nt){const An=String(Nt[1]??Nt[2]??"").trim();if(!An){e.push({message:"while statement missing condition",line:K});continue}const yt=we.indent,Rn=Vc($,oe+1,yt,[]);if(Rn.nextIdx===oe+1){e.push({message:"while-loop requires an indented body",line:K});continue}const _n=`__loop_${++tu}`;gn=K;const Vs={id:_n,kind:"while",lineNo:K,condExpr:co(An,"while_cond"),body:Rn.ops};Gd.push(Vs);const Ms=new Set;Yd(Vs.body,Ms);const $s=Array.from(Ms).filter(wo=>!$t(wo).startsWith("__arr_"));$s.forEach(wo=>{We.push({name:wo,updateExpr:`__loop_exec("${_n}", "${wo}")`})}),$s.length||We.push({name:`__loop_exec_${_n}`,updateExpr:`__loop_exec("${_n}")`});for(let wo=oe;wo<Rn.nextIdx;wo++)$[wo]={...$[wo],text:"//@pine_loop"};oe=Rn.nextIdx-1;continue}const E=re.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(E){const An=String(E[1]??E[2]??"").trim();if(!An){e.push({message:"if statement missing condition",line:K});continue}const yt=we.indent,Rn=os=>{const mo=[];let er=os;for(;er<$.length&&$[er].indent>yt;)$[er].text.startsWith("//@pine_fn")||mo.push($[er]),er+=1;return{body:mo,nextIdx:er}},_n=[],Vs=Rn(oe+1);if(!Vs.body.length){e.push({message:"if statement requires an indented body",line:K});continue}_n.push({condRaw:An,body:Vs.body,lineNo:K});let Ms=Vs.nextIdx;for(;Ms<$.length&&$[Ms].indent===yt;){const os=$[Ms].text.trim(),mo=os.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(mo){const gr=String(mo[1]??mo[2]??"").trim();if(!gr){e.push({message:"else if missing condition",line:$[Ms].lineNo});break}const fr=Rn(Ms+1);if(!fr.body.length){e.push({message:"else if requires an indented body",line:$[Ms].lineNo});break}_n.push({condRaw:gr,body:fr.body,lineNo:$[Ms].lineNo}),Ms=fr.nextIdx;continue}if(os.match(/^else$/i)){const gr=Rn(Ms+1);if(!gr.body.length){e.push({message:"else requires an indented body",line:$[Ms].lineNo});break}_n.push({condRaw:void 0,body:gr.body,lineNo:$[Ms].lineNo}),Ms=gr.nextIdx;break}break}const $s=[],wo=[];_n.forEach((os,mo)=>{if(!os.condRaw){$s.push(null),wo.push(null);return}const er=co(os.condRaw,`if_${mo+1}`);$s.push(Wu(er)),wo.push(zc(D_(er)))});const Zo=(os,mo)=>{const er=os.slice(0,mo).filter(Boolean);return er.length?er.map(gr=>`(${gr})`).join(" or "):""},ao=os=>{const mo=$s[os],er=Zo($s,os);return mo?er?`((${mo}) and not (${er}))`:`(${mo})`:er?`not (${er})`:"1"},Ho=os=>{const mo=wo[os],er=Zo(wo,os);return mo?er?`((${mo}) and not (${er}))`:`(${mo})`:er?`not (${er})`:"1"},so=(os,mo)=>{var fd,Rr;const er=os.match(/^array\.set\s*\((.*)\)\s*$/i);if(er){const ic=Kr(er[1]||""),Lc=String(ic[0]||"").trim(),Ad=String(ic[1]||"").trim(),Gu=String(ic[2]||"").trim();if(!Lc||!Ad||!Gu)return e.push({message:"array.set(name, index, value) requires 3 args",line:mo}),null;const lf=$t(Lc),pd=st[lf],Df=Je[lf];if(!pd&&!Df)return e.push({message:`array.set unknown array "${Lc}"`,line:mo}),null;const Li=nr(lf,Ad);if(Li!=null){const pu=(Df==null?void 0:Df.size)??(pd==null?void 0:pd.length)??Li+1;jo(lf,pu,pd);const Em=co(Gu,`${lf}_${Li}`),Vg=Is(Em);return pd&&Vg!=null&&(pd[Li]=Vg),[{name:zt(lf,Li),hasVar:!1,declaredType:"",op:":=",rhs:Em,lineNo:mo}]}const nm=co(Ad,`${lf}_idx`),Nf=hi(nm),nt=co(Gu,`${lf}_set`),yv=(fd=Je[lf])==null?void 0:fd.sizeSeries,Tv=yv!=null?`(${Nf}) >= 0 and (${Nf}) < ${yv}`:void 0,Fp=wc(lf,Nf,nt,Tv);return Fp?Fp.map((pu,Em)=>({name:zt(lf,Em),hasVar:!1,declaredType:"",op:":=",rhs:pu,lineNo:mo})):(e.push({message:"array.set index must be within array size",line:mo}),null)}const gr=os.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(gr){const ic=String(gr[1]||"").toLowerCase(),Lc=Kr(gr[2]||""),Ad=String(Lc[0]||"").trim(),Gu=$t(Ad);if(!Ad)return e.push({message:`array.${ic} requires array name`,line:mo}),null;if(!Je[Gu]&&!st[Gu])return e.push({message:`array.${ic} unknown array "${Ad}"`,line:mo}),null;!Je[Gu]&&st[Gu]&&jo(Gu,st[Gu].length,st[Gu]);const lf=Je[Gu];if(!lf)return null;if(ic==="push"||ic==="unshift"||ic==="insert"){const Li=Math.min(bs,Math.max(lf.capacity,lf.size+ro));ar(Gu,Li)}if(ic==="resize"){const Li=String(Lc[1]||"0"),nm=Is(Li);if(nm!=null){const Nf=Math.min(bs,Math.max(lf.capacity,Math.floor(nm)));ar(Gu,Nf)}}ja(Gu);const pd={};ic==="push"||ic==="unshift"?pd.value=Lc[1]:ic==="insert"?(pd.index=Lc[1],pd.value=Lc[2]):ic==="remove"?pd.index=Lc[1]:ic==="resize"&&(pd.size=Lc[1]);const Df=nc(Gu,ic,pd,mo);return Df||null}const fr=os.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(!fr)return null;const pr=String(fr[5]||"").trim();if(/^(line|label|box|table|linefill)\.new\s*\(/i.test(pr)||/^table\.cell\s*\(/i.test(pr))return null;const yu=pr.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(yu){const ic=String(yu[1]||"").toLowerCase(),Lc=Kr(yu[2]||""),Ad=String(Lc[0]||"").trim(),Gu=$t(Ad);if(!Ad)return e.push({message:`array.${ic} requires array name`,line:mo}),null;if(!Je[Gu]&&!st[Gu])return e.push({message:`array.${ic} unknown array "${Ad}"`,line:mo}),null;if(!Je[Gu]&&st[Gu]&&jo(Gu,st[Gu].length,st[Gu]),!Je[Gu])return null;ja(Gu);const pd=ic==="pop"?`array.size(${Ad}) - 1`:ic==="shift"?"0":String(Lc[1]||"0"),Df=co(`array.get(${Ad}, ${pd})`,fr[3]||"array_pop"),Li=nc(Gu,ic==="pop"?"pop":ic==="shift"?"shift":"remove",{index:Lc[1]},mo);return Li?[{name:fr[3],hasVar:!!fr[1],declaredType:fr[2]?String(fr[2]).toLowerCase():"",op:fr[4],rhs:Df,lineNo:mo},...Li]:null}const Kc=pr.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(Kc){const ic=String(Kc[1]||"").toLowerCase(),Lc=Kr(Kc[2]||""),Ad=$t(fr[3]);if(ic==="copy"){const nm=String(Lc[0]||"").trim(),Nf=$t(nm);if(!nm)return e.push({message:"array.copy requires source array name",line:mo}),null;if(xt[Nf])return xt[Ad]=[...xt[Nf]],ho(Ad),[];if(!Je[Nf]&&!st[Nf])return e.push({message:`array.copy unknown array "${nm}"`,line:mo}),null;!Je[Nf]&&st[Nf]&&jo(Nf,st[Nf].length,st[Nf]);const nt=Bc(Ad,Nf,mo);return nt?((Rr=Je[Nf])!=null&&Rr.dynamic&&Je[Ad]&&(Je[Ad].dynamic=!0),nt):null}const Gu=String(Lc[0]||"").trim(),lf=String(Lc[1]||"").trim(),pd=$t(Gu),Df=$t(lf);if(!Gu||!lf)return e.push({message:"array.concat requires two arrays",line:mo}),null;if(xt[pd]||xt[Df])return!xt[pd]||!xt[Df]?(e.push({message:"array.concat string arrays must be same type",line:mo}),null):(xt[Ad]=[...xt[pd],...xt[Df]],ho(Ad),[]);if(!Je[pd]&&!st[pd])return e.push({message:`array.concat unknown array "${Gu}"`,line:mo}),null;if(!Je[Df]&&!st[Df])return e.push({message:`array.concat unknown array "${lf}"`,line:mo}),null;!Je[pd]&&st[pd]&&jo(pd,st[pd].length,st[pd]),!Je[Df]&&st[Df]&&jo(Df,st[Df].length,st[Df]);const Li=Vu(Ad,pd,Df,mo);return Li||null}return[{name:fr[3],hasVar:!!fr[1],declaredType:fr[2]?String(fr[2]).toLowerCase():"",op:fr[4],rhs:co(pr,fr[3]),lineNo:mo}]},Wi={},_c=[],gu=(os,mo)=>{for(const er of os){const gr=so(er.text,er.lineNo);if(gr){for(const fr of gr){const pr=$t(fr.name),yu=Wi[pr]||(Wi[pr]={base:void 0,branches:new Array(_n.length).fill(null)});yu.base||(yu.base=fr),yu.branches[mo]=fr}continue}_c.push({text:er.text,lineNo:er.lineNo,branchIndex:mo,indent:er.indent})}};_n.forEach((os,mo)=>gu(os.body,mo));const El=(os,mo)=>{let er=!1;const gr=os.map(fr=>er||Iu(fr)?fr:(er=!0,mo));return er||gr.unshift(mo),gr},fu=(os,mo,er)=>{const gr=mo.match(new RegExp(`^${os}\\s*\\((.*)\\)\\s*$`,"i"));if(!gr)return null;const fr=Kr(gr[1]||""),pr=ao(er),yu=Ho(er);if(os==="plot"){const Rr=fr.find(Lc=>!Iu(Lc))||"",ic=`iff(${pr}, ${Rr||"na"}, na)`;return`${os}(${El(fr,ic).join(", ")})`}const Kc=fr.find(Rr=>!Iu(Rr))||"",fd=Kc?`${yu} and (${Kc})`:yu;return`${os}(${El(fr,fd).join(", ")})`},Cr=(os,mo)=>{const er=os.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)$/i);if(!er)return null;const gr=er[1],fr=String(er[2]||"").trim(),pr=Ho(mo),yu=fr?`${pr} and (${fr})`:pr;return`signal ${gr} when ${yu}`},ba=(os,mo)=>{const er=os.match(/^(strategy\.(entry|exit|close|close_all|order|cancel|cancel_all))\s*\((.*)\)\s*$/i);if(!er)return null;const gr=er[1],fr=Kr(er[3]||""),pr=Ho(mo);let yu=!1;const Kc=fr.map(fd=>/^\s*when\s*=/.test(fd)?(yu=!0,`when=${pr} and (${fd.replace(/^\s*when\s*=\s*/i,"")})`):fd);return yu||Kc.push(`when=${pr}`),`${gr}(${Kc.join(", ")})`},Pl=(os,mo,er)=>{const gr=mo.match(new RegExp(`^(?:varip\\s+|var\\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill)\\s+)?[A-Za-z_$][A-Za-z0-9_$]*\\s*(?::=|=)\\s*${os}\\s*\\((.*)\\)\\s*$`,"i")),fr=mo.match(new RegExp(`^${os}\\s*\\((.*)\\)\\s*$`,"i"));if(!gr&&!fr)return null;const pr=Kr(((gr==null?void 0:gr[1])||(fr==null?void 0:fr[1]))??""),yu=Ho(er);let Kc=!1;const fd=pr.map(Rr=>/^\s*when\s*=/.test(Rr)?(Kc=!0,`when=${yu} and (${Rr.replace(/^\s*when\s*=\s*/i,"")})`):Rr);return Kc||fd.push(`when=${yu}`),`${os}(${fd.join(", ")})`},_u=(os,mo)=>{const er=os.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(!er)return null;const gr=`${String(er[1]).toLowerCase()}.${String(er[2]).toLowerCase()}`,fr=Kr(er[3]||""),pr=Ho(mo);let yu=!1;const Kc=fr.map(fd=>/^\s*when\s*=/.test(fd)?(yu=!0,`when=${pr} and (${fd.replace(/^\s*when\s*=\s*/i,"")})`):fd);return yu||Kc.push(`when=${pr}`),`${gr}(${Kc.join(", ")})`},Zr=[],Qi=(os,mo,er)=>Zr.push({text:os,indent:er??yt,lineNo:mo,loopSeq:!!we.loopSeq});Object.values(Wi).forEach(os=>{var Rr,ic;const mo=os.base;if(!mo)return;const er=!!os.branches.some(Lc=>Lc==null?void 0:Lc.hasVar),gr=((Rr=os.branches.find(Lc=>Lc==null?void 0:Lc.declaredType))==null?void 0:Rr.declaredType)||"",fr=((ic=os.branches.find(Lc=>Lc==null?void 0:Lc.op))==null?void 0:ic.op)||"=",pr=fr===":="?mo.name:"na",yu=Lc=>{for(let Ad=Lc;Ad<_n.length;Ad++){const Gu=os.branches[Ad];if(!Gu)continue;const lf=$s[Ad],pd=yu(Ad+1);return lf?`iff(${lf}, ${Gu.rhs}, ${pd})`:Gu.rhs}return pr},Kc=yu(0),fd=`${er?"var ":""}${gr?`${gr} `:""}`;Qi(`${fd}${mo.name} ${fr} ${Kc}`,mo.lineNo)});for(const os of _c){const mo=os.text.trim(),er=ao(os.branchIndex);Ho(os.branchIndex);const gr=mo.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(gr){const yu=String(gr[1]??gr[2]??"").trim(),Kc=er&&er!=="1"?`(${er}) and (${yu})`:yu;Qi(`if (${Kc})`,os.lineNo,os.indent);continue}const fr=mo.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(fr){const yu=String(fr[1]??fr[2]??"").trim(),Kc=er&&er!=="1"?`(${er}) and (${yu})`:yu;Qi(`else if (${Kc})`,os.lineNo,os.indent);continue}if(/^else$/i.test(mo)){Qi(er&&er!=="1"?`else if (${er})`:"else",os.lineNo,os.indent);continue}const pr=fu("plot",os.text,os.branchIndex)||fu("plotshape",os.text,os.branchIndex)||fu("plotchar",os.text,os.branchIndex)||Pl("line.new",os.text,os.branchIndex)||Pl("linefill.new",os.text,os.branchIndex)||Pl("label.new",os.text,os.branchIndex)||Pl("box.new",os.text,os.branchIndex)||Pl("polyline.new",os.text,os.branchIndex)||Pl("polygon.new",os.text,os.branchIndex)||Pl("path.new",os.text,os.branchIndex)||Pl("table.cell",os.text,os.branchIndex)||_u(os.text,os.branchIndex)||Cr(os.text,os.branchIndex)||ba(os.text,os.branchIndex);if(pr){Qi(pr,os.lineNo,os.indent);continue}e.push({message:`Unsupported statement inside if: ${os.text}`,line:os.lineNo})}Zr.length||t.push({message:"if statement produced no output",line:K}),$.splice(oe,Ms-oe,...Zr),oe-=1;continue}const I=re.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\((.*)\)\s*$/i);if(I){const An=$t(I[1]),yt=Kr(I[2]||""),Rn=[],_n=[];let Vs=!1,Ms=!1,$s=!0;for(const wo of yt){const Zo=String(wo||"").trim();if(Zo.startsWith('"')&&Zo.endsWith('"')||Zo.startsWith("'")&&Zo.endsWith("'")){_n.push(xr(Zo)),Vs=!0;continue}const Ho=co(Zo,`array_from_${An}`),so=Is(Ho);if(so==null){$s=!1;break}Rn.push(so),Ms=!0}if(!$s||!Rn.length&&!_n.length||Vs&&Ms){e.push({message:"array.from(...) supports only all-numeric or all-string literals (compile-time)",line:K});continue}Vs?(xt[An]=_n,ho(An),Na(An,_n.length,_n)):(jo(An,Rn.length,Rn),st[An]=Rn);continue}const W=re.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(float|int|bool|string)\s*\((.*)\)\s*$/i);if(W){const An=$t(W[1]),yt=String(W[2]||"").toLowerCase(),Rn=Kr(W[3]||""),_n=Rn[0]??"0",Vs=Rn[1]??"0",Ms=Is(_n);if(Ms==null||Ms<0){e.push({message:"array.new_* size must be a numeric constant or param",line:K});continue}if(yt==="string"){let Zo="";const ao=String(Vs??"").trim();(ao.startsWith('"')&&ao.endsWith('"')||ao.startsWith("'")&&ao.endsWith("'"))&&(Zo=xr(ao));const so=new Array(Math.floor(Ms));for(let Wi=0;Wi<so.length;Wi++)so[Wi]=Zo;xt[An]=so,ho(An),Na(An,so.length,so);continue}let $s=Is(Vs);if($s==null){const Zo=Xg(String(Vs));Zo!=null&&($s=Zo?1:0)}$s==null&&($s=0);const wo=new Array(Math.floor(Ms));for(let Zo=0;Zo<wo.length;Zo++)wo[Zo]=$s;jo(An,wo.length,wo);continue}const Z=re.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Z){const An=String(Z[1]||"").toLowerCase(),yt=Kr(Z[2]||""),Rn=String(yt[0]||"").trim(),_n=$t(Rn);if(!Rn){e.push({message:`array.${An} requires array name`,line:K});continue}if(!!xt[_n]||(($d=Je[_n])==null?void 0:$d.kind)==="string"){if(An!=="push"&&An!=="clear"){t.push({message:`array.${An} on string arrays is not supported yet (ignored)`,line:K});continue}if(!Je[_n]){const Wi=xt[_n];Na(_n,(Wi==null?void 0:Wi.length)??0,Wi)}let ao=Je[_n];if(!ao)continue;if(An==="push"){const Wi=Math.min(bs,Math.max(ao.capacity,ao.size+ro));if(Aa(_n,Wi),ao=Je[_n],!ao)continue}ja(_n);const Ho=[];if(An==="push"){const Wi=co(String(yt[1]??"na"),`${_n}_push`),_c=`__str_num(${Wi})`,gu=ao.sizeSeries,El=`(${gu}) < ${ao.capacity}`,fu=`__arr_str_valid(${Wi})`,Cr=`(${El}) and (${fu})`,ba=wc(_n,gu,_c,Cr);ba&&ba.forEach((Pl,_u)=>{Ho.push({name:zt(_n,_u),hasVar:!1,declaredType:"",op:":=",rhs:Pl,lineNo:K})}),Ho.push({name:gu,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${Cr}, min(${gu} + 1, ${ao.capacity}), ${gu})`,lineNo:K})}else An==="clear"&&Ho.push({name:ao.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:K});const so=Ho.map(Wi=>({text:`${Wi.name} ${Wi.op} ${Wi.rhs}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}));so.length&&($.splice(oe,1,...so),oe-=1);continue}if(!Je[_n]&&!st[_n]){e.push({message:`array.${An} unknown array "${Rn}"`,line:K});continue}!Je[_n]&&st[_n]&&jo(_n,st[_n].length,st[_n]);const Ms=Je[_n];if(!Ms)continue;if(An==="push"||An==="unshift"||An==="insert"){const ao=Math.min(bs,Math.max(Ms.capacity,Ms.size+ro));ar(_n,ao)}if(An==="resize"){const ao=String(yt[1]||"0"),Ho=Is(ao);if(Ho!=null){const so=Math.min(bs,Math.max(Ms.capacity,Math.floor(Ho)));ar(_n,so)}}ja(_n);const $s={};An==="push"||An==="unshift"?$s.value=yt[1]:An==="insert"?($s.index=yt[1],$s.value=yt[2]):An==="remove"?$s.index=yt[1]:An==="resize"&&($s.size=yt[1]);const wo=nc(_n,An,$s,K);if(!wo)continue;const Zo=wo.map(ao=>({text:`${ao.name} ${ao.op} ${ao.rhs}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}));$.splice(oe,1,...Zo),oe-=1;continue}const _e=re.match(/^array\.set\s*\((.*)\)\s*$/i);if(_e){const An=Kr(_e[1]||""),yt=String(An[0]||"").trim(),Rn=String(An[1]||"").trim(),_n=String(An[2]||"").trim();if(!yt||!Rn||!_n){e.push({message:"array.set(name, index, value) requires 3 args",line:K});continue}const Vs=$t(yt),Ms=st[Vs],$s=xt[Vs],wo=Je[Vs],Zo=!!$s||(wo==null?void 0:wo.kind)==="string";if(!Ms&&!wo&&!$s){e.push({message:`array.set unknown array "${yt}"`,line:K});continue}if(Zo){Je[Vs]||Na(Vs,($s==null?void 0:$s.length)??0,$s);const Ho=Je[Vs];if(!Ho)continue;const so=co(Rn,`${Vs}_idx`),_c=`__str_num(${co(_n,`${Vs}_set`)})`,gu=Ho.sizeSeries,El=gu?`__arr_set_guard(${so}, ${gu})`:void 0,fu=wc(Vs,so,_c,El,{normalizeIndex:!1});if(!fu){e.push({message:"array.set index must be within array size",line:K});continue}const Cr=fu.map((ba,Pl)=>({text:`${zt(Vs,Pl)} := ${ba}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}));ja(Vs),$.splice(oe,1,...Cr),oe-=1;continue}const ao=nr(Vs,Rn);if(ao!=null){const Ho=(wo==null?void 0:wo.size)??(Ms==null?void 0:Ms.length)??ao+1;jo(Vs,Ho,Ms);const so=co(_n,`${Vs}_${ao}`),Wi=Is(so);Ms&&Wi!=null&&(Ms[ao]=Wi),re=`${zt(Vs,ao)} := ${so}`}else{const Ho=co(Rn,`${Vs}_idx`),so=hi(Ho),Wi=co(_n,`${Vs}_set`),_c=(np=Je[Vs])==null?void 0:np.sizeSeries,gu=_c!=null?`(${so}) >= 0 and (${so}) < ${_c}`:void 0,El=wc(Vs,so,Wi,gu);if(!El){e.push({message:"array.set index must be within array size",line:K});continue}const fu=El.map((Cr,ba)=>({text:`${zt(Vs,ba)} := ${Cr}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}));$.splice(oe,1,...fu),oe-=1;continue}}{const An=re.match(/^\s*\[([^\]]+)\]\s*(:=|=)\s*(.+)$/);if(An){const yt=An[1]||"",Rn=An[2]||"=",Vs=String(An[3]||"").trim().match(/^(?:ta\.)?(bbands|bollinger|macd|stoch|aroon|dmi|supertrend|keltner|kc|donchian|kdj|kst|vortex)\s*\((.*)\)\s*$/i);if(Vs){const Ms=String(Vs[1]||"").toLowerCase(),$s=String(Vs[2]||""),wo=Kr(yt).map(so=>so.trim()).filter(Boolean),Zo=Ms==="stoch"||Ms==="aroon"||Ms==="supertrend"||Ms==="kst"||Ms==="vortex"?2:3;if(wo.length!==Zo){e.push({message:`${Vs[1]}() assignment requires ${Zo} target${Zo===1?"":"s"}`,line:K});continue}const ao=wo.find(so=>so!=="_"&&!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(so));if(ao){e.push({message:`Invalid assignment target "${ao}"`,line:K});continue}const Ho=[];for(let so=0;so<wo.length;so++){const Wi=wo[so];if(Wi==="_")continue;const _c=$s.trim()?`${$s}, ${so}`:String(so);Ho.push({text:`${Wi} ${Rn} ${Ms}(${_c})`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq})}if(Ho.length){$.splice(oe,1,...Ho),oe-=1;continue}}}}const me=re.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(me){const An=!!me[1],yt=me[2]?String(me[2]).toLowerCase():"",Rn=me[3],_n=me[4],Vs=String(me[5]||"").trim(),Ms=Vs.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.new\s*\((.*)\)\s*$/i);if(Ms){const Cr=String(Ms[1]||"").toLowerCase();if(Cr==="line"){mi(Ms[2]||"",K,Rn,An);continue}if(Cr==="linefill"){kc(Ms[2]||"",K,Rn,An);continue}if(Cr==="label"){Er(Ms[2]||"",K,Rn,An);continue}if(Cr==="box"){Za(Ms[2]||"",K,Rn,An);continue}if(Cr==="table"){vi(Ms[2]||"",K,Rn,An);continue}if(Cr==="polyline"){ur(Ms[2]||"",K,Rn,An);continue}if(Cr==="polygon"){Oa(Ms[2]||"",K,Rn,An);continue}if(Cr==="path"){gl(Ms[2]||"",K,Rn,An);continue}}const $s=Vs.match(/^table\.cell\s*\((.*)\)\s*$/i);if($s){$r($s[1]||"",K);continue}const wo=Vs.match(/^plot\s*\((.*)\)\s*$/i);if(wo){hf(wo[1]||"",K,Rn);continue}const Zo=Vs.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(Zo){const Cr=String(Zo[1]||"").toLowerCase(),ba=Kr(Zo[2]||""),Pl=String(ba[0]||"").trim(),_u=$t(Pl);if(!Pl){e.push({message:`array.${Cr} requires array name`,line:K});continue}if(!Je[_u]&&!st[_u]){e.push({message:`array.${Cr} unknown array "${Pl}"`,line:K});continue}if(!Je[_u]&&st[_u]&&jo(_u,st[_u].length,st[_u]),!Je[_u])continue;ja(_u);const Qi=Cr==="pop"?`array.size(${Pl}) - 1`:Cr==="shift"?"0":String(ba[1]||"0"),os=co(`array.get(${Pl}, ${Qi})`,Rn),mo=nc(_u,Cr==="pop"?"pop":Cr==="shift"?"shift":"remove",{index:ba[1]},K);if(!mo)continue;const gr=[{text:`${`${An?"var ":""}${yt?`${yt} `:""}`}${Rn} ${_n} ${os}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq},...mo.map(fr=>({text:`${fr.name} ${fr.op} ${fr.rhs}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}))];$.splice(oe,1,...gr),oe-=1;continue}const ao=Vs.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(ao){const Cr=String(ao[1]||"").toLowerCase(),ba=Kr(ao[2]||""),Pl=$t(Rn);if(Cr==="copy"){const gr=String(ba[0]||"").trim(),fr=$t(gr);if(!gr){e.push({message:"array.copy requires source array name",line:K});continue}if(xt[fr]){xt[Pl]=[...xt[fr]],ho(Pl),$.splice(oe,1),oe-=1;continue}if(!Je[fr]&&!st[fr]){e.push({message:`array.copy unknown array "${gr}"`,line:K});continue}!Je[fr]&&st[fr]&&jo(fr,st[fr].length,st[fr]);const pr=Bc(Pl,fr,K);if(!pr)continue;(Pf=Je[fr])!=null&&Pf.dynamic&&Je[Pl]&&(Je[Pl].dynamic=!0);const yu=pr.map(Kc=>({text:`${Kc.name} ${Kc.op} ${Kc.rhs}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}));$.splice(oe,1,...yu),oe-=1;continue}const _u=String(ba[0]||"").trim(),Zr=String(ba[1]||"").trim(),Qi=$t(_u),os=$t(Zr);if(!_u||!Zr){e.push({message:"array.concat requires two arrays",line:K});continue}if(xt[Qi]||xt[os]){if(!xt[Qi]||!xt[os]){e.push({message:"array.concat string arrays must be same type",line:K});continue}xt[Pl]=[...xt[Qi],...xt[os]],ho(Pl),$.splice(oe,1),oe-=1;continue}if(!Je[Qi]&&!st[Qi]){e.push({message:`array.concat unknown array "${_u}"`,line:K});continue}if(!Je[os]&&!st[os]){e.push({message:`array.concat unknown array "${Zr}"`,line:K});continue}!Je[Qi]&&st[Qi]&&jo(Qi,st[Qi].length,st[Qi]),!Je[os]&&st[os]&&jo(os,st[os].length,st[os]);const mo=Vu(Pl,Qi,os,K);if(!mo)continue;const er=mo.map(gr=>({text:`${gr.name} ${gr.op} ${gr.rhs}`,indent:we.indent,lineNo:K,loopSeq:we.loopSeq}));$.splice(oe,1,...er),oe-=1;continue}if(_n===":="){const Cr=$t(Rn);Cr in ft||Rn in ft||!!Tt[Cr]||Ve.some(Pl=>$t(String((Pl==null?void 0:Pl.name)||""))===Cr)||We.some(Pl=>$t(String((Pl==null?void 0:Pl.name)||""))===Cr)||Ue.some(Pl=>$t(String((Pl==null?void 0:Pl.name)||""))===Cr)||t.push({message:`":=" used before "${Rn}" is defined (use "=" for first assignment)`,line:K})}const Ho=R5(Vs);if(Ho){Ue.push({name:Rn,type:"security",symbol:Ho.symbol,country:Ho.country,timeframe:Ho.timeframe,expr:Ho.expr,lookahead:Ho.lookahead,gaps:Ho.gaps,lower:Ho.lower});continue}const so=co(Vs,Rn);if(!Rn.startsWith("__arr_")&&Cc(Rn,so,K))continue;if(It(so)&&(Tt[Rn.replace(/\s+/g,"_").toLowerCase()]=D_(so)),(An||_n===":=")&&yt!=="bool"&&yt!=="string"){const Cr=$t(Rn),ba=Cr.startsWith("__arr_"),_u=(()=>{const Qi=He[Cr];if(typeof Qi=="number")return Qi;const os=We.length;return He[Cr]=os,We.push({name:Rn,initExpr:void 0,updateExpr:Rn,selfMode:ba?"current":void 0}),os})();if(_n===":="){const Qi=$t(Rn),os=Object.prototype.hasOwnProperty.call(ft,Rn)?Rn:Object.prototype.hasOwnProperty.call(ft,Qi)?Qi:null;if(os&&We[_u]&&!We[_u].initExpr){const mo=ft[os];if(typeof mo=="number"&&Number.isFinite(mo))We[_u].initExpr=String(mo),delete ft[os];else if(typeof mo=="string"){const er=Number(mo);Number.isFinite(er)&&(We[_u].initExpr=String(er),delete ft[os])}}}if((ba||!!we.loopSeq)&&_n===":="&&typeof He[Cr]=="number"){We.push({name:Rn,initExpr:void 0,updateExpr:so,selfMode:"current"});continue}if(An&&_n==="="){We[_u].initExpr=so;continue}if(An&&_n===":="){We[_u].initExpr=so,We[_u].updateExpr=so;continue}We[_u].updateExpr=so;continue}const El=Qm(so);if(El!=null){ft[Rn]=El;continue}const fu=Xg(so);if(fu!=null){ft[Rn]=fu;continue}if(so.startsWith('"')&&so.endsWith('"')||so.startsWith("'")&&so.endsWith("'")){ft[Rn]=xr(so);continue}Ve.push({name:Rn,expr:so});continue}const Le=re.match(/^strategy\s*\((.*)\)\s*$/i);if(Le){const An=Kr(Le[1]||""),yt=qc(An),Rn=Pt&&typeof Pt=="object"?{...Pt}:null,_n=(...ao)=>{for(const Ho of ao){if(yt[Ho]==null)continue;const so=xr(String(yt[Ho])),Wi=Qm(so);if(Wi!=null)return Wi}},Vs=(...ao)=>{for(const Ho of ao){if(yt[Ho]==null)continue;const so=xr(String(yt[Ho])),Wi=Qm(so);return Wi??so}},Ms=(...ao)=>{for(const Ho of ao)if(yt[Ho]!=null)return xr(String(yt[Ho]))},$s=xr(String(yt.default_qty_type??yt.default_qty_type??"")).toLowerCase(),wo=Number(yt.default_qty_value??yt.default_qty_value??NaN),Zo=$s==="cash"?{type:"cash",value:Number.isFinite(wo)?wo:1e4}:$s==="qty"?{type:"qty",value:Number.isFinite(wo)?wo:1}:{type:"percent_of_equity",value:Number.isFinite(wo)?wo:100};if(Pt={initialCapital:_n("initial_capital","initialCapital")??1e4,from:Vs("from","start","startDate","dateFrom","rangeStart"),to:Vs("to","end","endDate","dateTo","rangeEnd"),session:Ms("session","tradingSession","sessionTime"),orderSize:Zo,commissionPct:_n("commissionPct","commission")??0,slippagePct:_n("slippagePct","slippage")??0,spreadPct:_n("spreadPct","spread_pct","spread")??(_n("spreadBps","spread_bps")!=null?_n("spreadBps","spread_bps")/100:void 0),leverage:_n("leverage","lev","marginLeverage","margin_leverage")??void 0,maintenanceMarginPct:_n("maintenanceMarginPct","maintenance_margin_pct","maintMarginPct")??void 0,liquidationFeePct:_n("liquidationFeePct","liquidation_fee_pct","liqFeePct")??void 0,borrowPctPerYear:_n("borrowPctPerYear","borrow_pct_per_year","shortBorrowPctPerYear")??void 0,fundingPctPerDay:_n("fundingPctPerDay","funding_pct_per_day","funding")??void 0,positionMode:(()=>{const ao=xr(String(yt.positionMode??yt.position_mode??"")).toLowerCase();if(ao)return ao.includes("hedge")?"hedging":"netting"})()??void 0,closeMethod:(()=>{const ao=xr(String(yt.closeMethod??yt.close_method??yt.costBasis??yt.cost_basis??"")).toLowerCase();if(ao)return ao.includes("lifo")?"lifo":ao.includes("avg")||ao.includes("average")?"avg":"fifo"})()??void 0,priceTick:_n("priceTick","price_tick","tickSize","tick_size","tick","minTick","min_tick")??void 0,qtyStep:_n("qtyStep","qty_step","quantityStep","quantity_step","lotStep","lot_step")??void 0,minQty:_n("minQty","min_qty","minimumQty","minimum_qty")??void 0,pyramiding:_n("pyramiding")??1,execution:xr(String(yt.execution??"intrabar_ohlc")),intrabarTieBreak:xr(String(yt.intrabarTieBreak??"worst_case")),ohlcPath:xr(String(yt.ohlcPath??"open_high_low_close")),allowShort:Xg(String(yt.allowShort??""))??void 0,allowLong:Xg(String(yt.allowLong??""))??void 0},Rn){const ao=["maxDrawdownPct","maxDrawdownCash","maxPositionPct","maxPositionCash","maxPositionQty","maxIntradayFilledOrders","maxIntradayLossPct","maxIntradayLossCash"];for(const Ho of ao)Rn[Ho]!=null&&(Pt[Ho]=Rn[Ho])}continue}const ye=re.match(/^strategy\.risk\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(ye){const An=String(ye[1]||"").trim().toLowerCase(),yt=Kr(ye[2]||""),Rn=qc(yt),_n=yt.filter(Wi=>!Iu(Wi)),Vs=Rn.value??Rn.max??Rn.size??_n[0],Ms=Rn.type??Rn.qty_type??Rn.qtyType??Rn.position_type??_n[1],$s=Vs!=null?Qm(xr(String(Vs))):null;if($s==null||!Number.isFinite($s)){e.push({message:`strategy.risk.${An}(...) requires numeric value`,line:K});continue}const wo=Ms!=null?xr(String(Ms)).toLowerCase():"",Zo=wo.includes("percent")||wo.includes("equity"),ao=wo.includes("cash")||wo.includes("currency")||wo.includes("fixed"),Ho=wo.includes("qty")||wo.includes("contract"),so=Zo?"percent":ao?"cash":Ho?"qty":"percent";if((!Pt||typeof Pt!="object")&&(Pt={enabled:!0}),An==="max_drawdown"||An==="max_drawdown_percent"){so==="cash"?Pt.maxDrawdownCash=$s:Pt.maxDrawdownPct=$s;continue}if(An==="max_position_size"||An==="max_position"||An==="max_position_size_contracts"){so==="cash"?Pt.maxPositionCash=$s:so==="qty"?Pt.maxPositionQty=$s:Pt.maxPositionPct=$s;continue}if(An==="max_intraday_filled_orders"||An==="max_intraday_orders"){Pt.maxIntradayFilledOrders=Math.max(0,Math.floor($s));continue}if(An==="max_intraday_loss"||An==="max_daily_loss"){so==="cash"?Pt.maxIntradayLossCash=$s:Pt.maxIntradayLossPct=$s;continue}t.push({message:`Ignored strategy.risk method: ${An}`,line:K});continue}if(re.match(/^(indicator|study)\s*\((.*)\)\s*$/i))continue;const Ge=re.match(/^line\.new\s*\((.*)\)\s*$/i);if(Ge){mi(Ge[1]||"",K);continue}const Ae=re.match(/^linefill\.new\s*\((.*)\)\s*$/i);if(Ae){kc(Ae[1]||"",K);continue}const Rt=re.match(/^label\.new\s*\((.*)\)\s*$/i);if(Rt){Er(Rt[1]||"",K);continue}const nn=re.match(/^box\.new\s*\((.*)\)\s*$/i);if(nn){Za(nn[1]||"",K);continue}const Xn=re.match(/^polyline\.new\s*\((.*)\)\s*$/i);if(Xn){ur(Xn[1]||"",K);continue}const hn=re.match(/^polygon\.new\s*\((.*)\)\s*$/i);if(hn){Oa(hn[1]||"",K);continue}const is=re.match(/^path\.new\s*\((.*)\)\s*$/i);if(is){gl(is[1]||"",K);continue}const Gs=re.match(/^table\.new\s*\((.*)\)\s*$/i);if(Gs){vi(Gs[1]||"",K);continue}const es=re.match(/^table\.clear\s*\((.*)\)\s*$/i);if(es){vu(es[1]||"",K);continue}const Mi=re.match(/^table\.merge(?:_cells)?\s*\((.*)\)\s*$/i);if(Mi){Sc(Mi[1]||"",K);continue}const Kn=re.match(/^table\.cell\s*\((.*)\)\s*$/i);if(Kn){$r(Kn[1]||"",K);continue}const Es=re.match(/^line\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Es){Il(Es[1]||"",Es[2]||"",K);continue}const Qo=re.match(/^line\.delete\s*\((.*)\)\s*$/i);if(Qo){cl(Qo[1]||"");continue}const sr=re.match(/^polyline\.set\s*\((.*)\)\s*$/i);if(sr){la(sr[1]||"",K);continue}const na=re.match(/^polyline\.delete\s*\((.*)\)\s*$/i);if(na){Fl(na[1]||"");continue}const Xr=re.match(/^polygon\.set\s*\((.*)\)\s*$/i);if(Xr){ni(Xr[1]||"",K);continue}const Uu=re.match(/^polygon\.delete\s*\((.*)\)\s*$/i);if(Uu){vc(Uu[1]||"");continue}const xd=re.match(/^path\.set\s*\((.*)\)\s*$/i);if(xd){za(xd[1]||"",K);continue}const ul=re.match(/^path\.delete\s*\((.*)\)\s*$/i);if(ul){sl(ul[1]||"");continue}const dr=re.match(/^linefill\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(dr){uc(dr[1]||"",dr[2]||"",K);continue}const Fu=re.match(/^linefill\.delete\s*\((.*)\)\s*$/i);if(Fu){Tl(Fu[1]||"");continue}const gi=re.match(/^label\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(gi){Oc(gi[1]||"",gi[2]||"",K);continue}const Dr=re.match(/^label\.delete\s*\((.*)\)\s*$/i);if(Dr){Va(Dr[1]||"");continue}const Yi=re.match(/^box\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Yi){Wa(Yi[1]||"",Yi[2]||"",K);continue}const Ki=re.match(/^box\.delete\s*\((.*)\)\s*$/i);if(Ki){uu(Ki[1]||"");continue}const Xi=re.match(/^table\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Xi){ud(Xi[1]||"",Xi[2]||"",K);continue}const ca=re.match(/^table\.delete\s*\((.*)\)\s*$/i);if(ca){Ll(ca[1]||"");continue}const Jt=re.match(/^table\.cell_set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Jt){Ja(Jt[1]||"",Jt[2]||"",K);continue}const rn=re.match(/^plotcandle\s*\((.*)\)\s*$/i);if(rn){td("candles",rn[1]||"",K);continue}const dn=re.match(/^plotbar\s*\((.*)\)\s*$/i);if(dn){td("ohlc",dn[1]||"",K);continue}const uo=re.match(/^plotohlc\s*\((.*)\)\s*$/i);if(uo){td("ohlc",uo[1]||"",K);continue}const zs=re.match(/^plotfill\s*\((.*)\)\s*$/i);if(zs){const An=Kr(zs[1]||""),yt=qc(An),Rn=An.filter(wo=>!Iu(wo));if(Rn.length<2){e.push({message:"plotfill() requires 2 plot series",line:K});continue}const _n=Vl(yt),Vs=Te(_n),Ms=Nu(Rn[0],"plotfill_a"),$s=Nu(Rn[1],"plotfill_b");Vs.fills=Array.isArray(Vs.fills)?Vs.fills:[],Vs.fills.push({between:[Ms,$s],color:xo(String(yt.color??""))||xr(String(yt.color??""))||"rgba(34,197,94,0.10)"});continue}const Hr=re.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*plot\s*\((.*)\)\s*$/i);if(Hr){hf(Hr[2]||"",K,Hr[1]);continue}const Ul=re.match(/^plot\s*\((.*)\)\s*$/i);if(Ul){hf(Ul[1]||"",K);continue}const Oi=re.match(/^plotarrow\s*\((.*)\)\s*$/i);if(Oi){const An=Kr(Oi[1]||""),yt=qc(An),Rn=An.filter(Ho=>!Iu(Ho));if(!Rn.length){e.push({message:"plotarrow() requires a series",line:K});continue}const _n=Vl(yt),Vs=Te(_n),Ms=du(Rn[0],"plotarrow").replace(/\s+/g,"_").toLowerCase(),$s=D_(co(`${Ms} > 0`,"plotarrow_up")),wo=D_(co(`${Ms} < 0`,"plotarrow_down")),Zo=xo(String(yt.colorup??yt.color_up??""))||"#22c55e",ao=xo(String(yt.colordown??yt.color_down??""))||"#ef4444";Vs.labels.push({when:$s,text:"▲",color:Zo,position:"below",source:"low",shape:"arrowUp"}),Vs.labels.push({when:wo,text:"▼",color:ao,position:"above",source:"high",shape:"arrowDown"});continue}const Nd=re.match(/^plotshape\s*\((.*)\)\s*$/i);if(Nd){const An=Kr(Nd[1]||"");if(!An.length){e.push({message:"plotshape() requires at least 1 argument",line:K});continue}const yt=qc(An),Rn=An.filter(Qi=>!Iu(Qi)),_n=Rn[0]?ol(Rn[0],K):{};if(!(_n.when??_n.whenExpr)){e.push({message:"plotshape() missing condition",line:K});continue}const Ms=Vl(yt),$s=Te(Ms),wo=E5(String(yt.location??"")),Zo=wo==="below",ao=Zo?"below":"above",Ho=yt.price??yt.y??yt.source??yt.series,so=Ho!=null?du(String(Ho),"shape_price").replace(/\s+/g,"_").toLowerCase():wo==="absolute"?"close":Zo?"low":"high",_c=BJ(String(yt.style??yt.shape??""))||(Zo?"triangle_up_filled":"triangle_down_filled");if(_c==="none")continue;const gu=xr(String(yt.text??yt.title??""))||(Zo?"BUY":"SELL"),El=yt.transp??yt.transparency,fu=El!=null?Number(El):void 0,Cr=U0(xo(String(yt.color??""))||(Zo?"#16a34a":"#ef4444"),fu),ba=xo(String(yt.textcolor??yt.textColor??""))||void 0,Pl=V1(String(yt.size??""))||void 0,_u=Sr(yt.offset,"plotshape_offset");let Zr=_u.value;_u.value!=null&&Number.isFinite(Zr)?Zr=Math.trunc(Zr):_u.expr&&r&&t.push({message:"plotshape offset must be a constant integer",line:K}),$s.labels.push({when:_n.when,whenExpr:_n.whenExpr,text:gu,color:Cr,textColor:ba,position:ao,source:so,shape:_c,size:Pl,offset:Zr});continue}const hr=re.match(/^plotchar\s*\((.*)\)\s*$/i);if(hr){const An=Kr(hr[1]||"");if(!An.length){e.push({message:"plotchar() requires at least 1 argument",line:K});continue}const yt=qc(An),Rn=An.filter(_u=>!Iu(_u)),_n=Rn[0]?ol(Rn[0],K):{};if(!(_n.when??_n.whenExpr)){e.push({message:"plotchar() missing condition",line:K});continue}const Ms=Vl(yt),$s=Te(Ms),wo=E5(String(yt.location??"")),Zo=wo==="below",ao=Zo?"below":"above",Ho=yt.price??yt.y??yt.source??yt.series,so=Ho!=null?du(String(Ho),"char_price").replace(/\s+/g,"_").toLowerCase():wo==="absolute"?"close":Zo?"low":"high",Wi=xr(String(yt.char??""))||xr(String(yt.text??""))||"•",_c=yt.transp??yt.transparency,gu=_c!=null?Number(_c):void 0,El=U0(xo(String(yt.color??""))||(Zo?"#16a34a":"#ef4444"),gu),fu=xo(String(yt.textcolor??yt.textColor??""))||void 0,Cr=V1(String(yt.size??""))||14,ba=Sr(yt.offset,"plotchar_offset");let Pl=ba.value;ba.value!=null&&Number.isFinite(Pl)?Pl=Math.trunc(Pl):ba.expr&&r&&t.push({message:"plotchar offset must be a constant integer",line:K}),$s.labels.push({when:_n.when,whenExpr:_n.whenExpr,text:Wi,color:El,textColor:fu,position:ao,source:so,shape:"text",size:Cr,offset:Pl});continue}const vr=re.match(/^alert\s*\((.*)\)\s*$/i);if(vr){const An=Kr(vr[1]||"");if(!An.length){e.push({message:"alert() requires a message",line:K});continue}const yt=qc(An),Rn=An.filter(so=>!Iu(so)),_n=Rn[0]??yt.message??yt.msg??"",Vs=Rn[1]??yt.freq??yt.frequency??yt.alert_freq??"",Ms=yt.when??null,$s=ol(Ms??"close >= close",K),wo=$s.when??$s.whenExpr??"close >= close",Zo=xr(String(yt.title??"")),ao=xr(String(_n??"")),Ho=D5(String(Vs??""));et.push({id:Zo?`${Zo}`:`alert_${K}`,type:"alert",when:wo,whenExpr:$s.whenExpr,title:Zo||void 0,message:ao||void 0,frequency:Ho});continue}const _l=re.match(/^alertcondition\s*\((.*)\)\s*$/i);if(_l){const An=Kr(_l[1]||"");if(!An.length){e.push({message:"alertcondition() requires a condition",line:K});continue}const yt=qc(An),Rn=An.filter(Ho=>!Iu(Ho)),_n=Rn[0]!=null?String(Rn[0]):"",Vs=_n?ol(_n,K):{},Ms=Vs.when??Vs.whenExpr??null;if(!Ms){e.push({message:"alertcondition() missing condition",line:K});continue}const $s=xr(String(yt.title??"")),wo=xr(String(yt.message??"")),Zo=yt.freq??yt.frequency??yt.alert_freq??"",ao=D5(String(Zo??""));et.push({id:$s?`${$s}`:`alert_${K}`,type:"alert",when:Ms,whenExpr:Vs.whenExpr,title:$s||void 0,message:wo||void 0,frequency:ao});continue}const ia=re.match(/^hline\s*\((.*)\)\s*$/i);if(ia){const An=Kr(ia[1]||"");if(!An.length){e.push({message:"hline() requires value",line:K});continue}const yt=qc(An),Rn=An.filter($s=>!Iu($s)),_n=Qm(xr(Rn[0]??""));if(_n==null){e.push({message:"hline() value must be a number",line:K});continue}const Vs=Vl(yt);Te(Vs).levels.push({name:xr(String(yt.title??yt.name??String(_n))),value:_n,color:xo(String(yt.color??""))||void 0,style:xr(String(yt.linestyle??yt.style??"dashed")),width:yt.width!=null?Number(yt.width):void 0});continue}const Zl=re.match(/^fill\s*\((.*)\)\s*$/i);if(Zl){const An=Kr(Zl[1]||""),yt=qc(An),Rn=An.filter(wo=>!Iu(wo));if(Rn.length<2){e.push({message:"fill() requires 2 plot series",line:K});continue}const _n=Vl(yt),Vs=Te(_n),Ms=du(Rn[0],"fill_a"),$s=du(Rn[1],"fill_b");Vs.fills=Array.isArray(Vs.fills)?Vs.fills:[],Vs.fills.push({between:[Ms,$s],color:xo(String(yt.color??""))||xr(String(yt.color??""))||"rgba(34,197,94,0.10)"});continue}const Bo=re.match(/^signal\s+(entry_long|exit_long|entry_short|exit_short|buy|sell|exit)\s+when\s+(.+)$/i);if(Bo){const An=Au(Bo[2]||"");if(!An.when){e.push({message:"signal ... when requires a condition",line:K});continue}const yt=ol(An.when,K),Rn=yt.when??yt.whenExpr,_n=Kd(An.scoreRaw,K,"signal_score");if(An.scoreRaw!=null&&_n==null)continue;const Vs=Hu(An.cooldownRaw,K,"signal_cooldown");if(An.cooldownRaw!=null&&Vs==null)continue;const Ms=Bo[1].toLowerCase(),$s=Ms==="buy"?"entry_long":Ms==="sell"||Ms==="exit"?"exit_long":Ms;et.push({type:$s,when:Rn,whenExpr:yt.whenExpr,score:_n??null,cooldownBars:Vs});continue}const Mf=re.match(/^strategy\.entry\s*\((.*)\)\s*$/i);if(Mf){const An=Kr(Mf[1]||""),yt=qc(An),_n=An.filter(so=>!Iu(so))[0]||"",Vs=An.find(so=>/strategy\.(long|short)/i.test(so))||"",Ms=/short/i.test(Vs)?"short":"long",$s=yt.when?ol(yt.when,K):{},wo=$s.when??$s.whenExpr??null;if(!wo){e.push({message:"strategy.entry(...) requires when=...",line:K});continue}const Zo=Md(yt),ao=Kd(yt.score??yt.signal_score,K,"entry_score");if((yt.score??yt.signal_score)!=null&&ao==null)continue;const Ho=Tu(yt,K,"entry_cooldown");if(Ho.hadRaw&&Ho.value==null)continue;et.push({id:_n?xr(String(_n)):void 0,type:Ms==="long"?"entry_long":"entry_short",when:wo,whenExpr:$s.whenExpr,order:Zo||void 0,score:ao??null,cooldownBars:Ho.value});continue}const Yc=re.match(/^strategy\.order\s*\((.*)\)\s*$/i);if(Yc){const An=Kr(Yc[1]||""),yt=qc(An),Rn=An.filter(Wi=>!Iu(Wi)),_n=Rn[0]||"",Vs=_n?xr(String(_n)):"";if(!Vs){e.push({message:"strategy.order(...) requires id",line:K});continue}const Ms=An.find(Wi=>/strategy\.(long|short)/i.test(Wi))||Rn[1]||"",$s=/short/i.test(Ms)?"short":/long/i.test(Ms)?"long":"";if(!$s){e.push({message:"strategy.order(...) requires strategy.long/strategy.short",line:K});continue}yt.qty==null&&Rn[2]!=null&&(yt.qty=String(Rn[2]));const wo=yt.when?ol(yt.when,K):{},Zo=wo.when??wo.whenExpr??null;if(!Zo){e.push({message:"strategy.order(...) requires when=...",line:K});continue}const ao=Md(yt),Ho=Kd(yt.score??yt.signal_score,K,"order_score");if((yt.score??yt.signal_score)!=null&&Ho==null)continue;const so=Tu(yt,K,"order_cooldown");if(so.hadRaw&&so.value==null)continue;et.push({id:Vs,orderId:Vs,type:$s==="long"?"entry_long":"entry_short",when:Zo,whenExpr:wo.whenExpr,order:ao||void 0,score:Ho??null,cooldownBars:so.value});continue}const Lu=re.match(/^strategy\.(close|exit)\s*\((.*)\)\s*$/i);if(Lu){const An=Kr(Lu[2]||""),yt=qc(An),_n=An.filter(ba=>!Iu(ba))[0]||"",Vs=yt.when?ol(yt.when,K):{},Ms=Vs.when??Vs.whenExpr??null,$s=yt.side&&/short/i.test(String(yt.side))?"short":"long",wo=Md(yt),Zo=Kd(yt.score??yt.signal_score,K,"exit_score");if((yt.score??yt.signal_score)!=null&&Zo==null)continue;const ao=Tu(yt,K,"exit_cooldown");if(ao.hadRaw&&ao.value==null)continue;const Ho=yt.stop??yt.stopPrice,so=yt.limit??yt.limitPrice,Wi=yt.qty_percent??yt.qtyPct??yt.qtyPctVal??yt.qtyPercent,_c=Wi!=null?Number(Wi):void 0,gu=Ho!=null?du(String(Ho),"exit_stop"):null,El=so!=null?du(String(so),"exit_limit"):null,fu=_n?`${xr(String(_n))}__bracket`:`exit__bracket_${K}`;let Cr=!1;if(Ho!=null&&(et.push({id:`${_n?xr(String(_n)):K}_STOP`,type:$s==="long"?"exit_long":"exit_short",when:`between(${gu||"close"}, low, high)`,order:{kind:"stop",price:(gu||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof _c=="number"&&Number.isFinite(_c)?_c:void 0,oco:fu},score:Zo??null,cooldownBars:ao.value}),Cr=!0),so!=null&&(et.push({id:`${_n?xr(String(_n)):K}_LIMIT`,type:$s==="long"?"exit_long":"exit_short",when:`between(${El||"close"}, low, high)`,order:{kind:"limit",price:(El||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof _c=="number"&&Number.isFinite(_c)?_c:void 0,oco:fu},score:Zo??null,cooldownBars:ao.value}),Cr=!0),Ms&&(et.push({id:_n?xr(String(_n)):void 0,type:$s==="long"?"exit_long":"exit_short",when:Ms,whenExpr:Vs.whenExpr,order:Ho!=null||so!=null?typeof _c=="number"&&Number.isFinite(_c)?{kind:"market",qtyPct:_c}:void 0:wo||(typeof _c=="number"&&Number.isFinite(_c)?{kind:"market",qtyPct:_c}:void 0),score:Zo??null,cooldownBars:ao.value}),Cr=!0),!Cr){e.push({message:"strategy.exit/close(...) needs when=... or stop=/limit=...",line:K});continue}continue}const Ju=re.match(/^strategy\.cancel\s*\((.*)\)\s*$/i);if(Ju){const An=Kr(Ju[1]||""),yt=qc(An),_n=An.filter(wo=>!Iu(wo))[0]||"",Vs=_n?xr(String(_n)):"";if(!Vs){e.push({message:"strategy.cancel(...) requires id",line:K});continue}const Ms=ol(yt.when??"close >= close",K),$s=Ms.when??Ms.whenExpr??"close >= close";et.push({id:`cancel_${Vs}_${K}`,type:"cancel",when:$s,whenExpr:Ms.whenExpr,orderId:Vs});continue}const Dd=re.match(/^strategy\.cancel_all\s*\((.*)\)\s*$/i);if(Dd){const An=Kr(Dd[1]||""),yt=qc(An),Rn=ol(yt.when??"close >= close",K),_n=Rn.when??Rn.whenExpr??"close >= close";et.push({id:`cancel_all_${K}`,type:"cancel_all",when:_n,whenExpr:Rn.whenExpr});continue}const oc=re.match(/^strategy\.close_all\s*\((.*)\)\s*$/i);if(oc){const An=Kr(oc[1]||""),yt=qc(An),Rn=yt.when?ol(yt.when,K):{},_n=Rn.when??Rn.whenExpr??null;if(!_n){e.push({message:"strategy.close_all(...) requires when=...",line:K});continue}const Vs=Kd(yt.score??yt.signal_score,K,"close_all_score");if((yt.score??yt.signal_score)!=null&&Vs==null)continue;const Ms=Tu(yt,K,"close_all_cooldown");if(Ms.hadRaw&&Ms.value==null)continue;et.push({type:"exit_long",when:_n,whenExpr:Rn.whenExpr,id:`close_all_long_${K}`,order:{kind:"market",qtyPct:100},score:Vs??null,cooldownBars:Ms.value}),et.push({type:"exit_short",when:_n,whenExpr:Rn.whenExpr,id:`close_all_short_${K}`,order:{kind:"market",qtyPct:100},score:Vs??null,cooldownBars:Ms.value});continue}const Rd=re.match(/^draw\.clear\s*\((.*)\)\s*$/i);if(Rd){const An=Kr(Rd[1]||""),yt=qc(An),Rn=Vl(yt),_n=String(yt.kind??yt.type??"").toLowerCase(),Vs=["line","label","box","linefill","table","polyline","polygon","path"].includes(_n)?_n:void 0,Ms=Xl(yt.group??yt.group_id??yt.groupId),$s=Xl(yt.tag??yt.tags);qs(Rn,{kind:"draw_clear",when:va(yt),filterKind:Vs,groupId:Ms,tag:$s});continue}const Jl=re.match(/^draw\.for_each\s*\((.*)\)\s*$/i);if(Jl){const An=Kr(Jl[1]||""),yt=qc(An),Rn=Vl(yt),_n=String(yt.kind??yt.type??"").toLowerCase(),Vs=["line","label","box","linefill","table","polyline","polygon","path"].includes(_n)?_n:void 0,Ms=Xl(yt.group??yt.group_id??yt.groupId),$s=Xl(yt.tag??yt.tags),wo=Sr(yt.width,"draw.for_each_width"),Zo=ql(yt.text_size??yt.textSize,"draw.for_each_text_size"),ao=yt.text!=null?ll(String(yt.text),"draw.for_each_text"):{text:void 0,textExpr:void 0},Ho={color:xo(yt.color),fillColor:xo(yt.fill_color??yt.fillcolor??yt.bgcolor??yt.bgColor),width:wo.value,widthExpr:wo.expr,style:u0(String(yt.style??""))||void 0,extend:Dx(String(yt.extend??""))||void 0,xloc:d0(String(yt.xloc??""))||void 0,bgColor:xo(yt.bgcolor??yt.bgColor),bgOpacity:yt.bg_opacity!=null?Number(yt.bg_opacity):yt.bgOpacity!=null?Number(yt.bgOpacity):void 0,borderColor:xo(yt.border_color??yt.borderColor),borderWidth:yt.border_width!=null?Number(yt.border_width):yt.borderWidth!=null?Number(yt.borderWidth):void 0,textColor:xo(yt.text_color??yt.textColor),text:ao.text,textExpr:ao.textExpr,textSize:Zo.value,textSizeExpr:Zo.expr,opacity:yt.opacity!=null?Number(yt.opacity):void 0,wrap:yt.wrap!=null?String(yt.wrap).toLowerCase()==="true"||Number(yt.wrap)===1:void 0,maxWidth:yt.maxwidth!=null?Number(yt.maxwidth):yt.maxWidth!=null?Number(yt.maxWidth):void 0,padding:yt.padding,radius:yt.radius!=null?Number(yt.radius):void 0,align:d_(String(yt.align??yt.textalign??yt.textAlign??""))||void 0,valign:["top","middle","bottom"].includes(String(yt.valign??"").toLowerCase())?String(yt.valign).toLowerCase():void 0,lineHeight:yt.line_height!=null?Number(yt.line_height):yt.lineHeight!=null?Number(yt.lineHeight):void 0,fontFamily:yt.font_family??yt.fontFamily,fontSize:yt.font_size!=null?Number(yt.font_size):yt.fontSize!=null?Number(yt.fontSize):void 0,fontWeight:yt.font_weight??yt.fontWeight,monospace:yt.monospace!=null?String(yt.monospace).toLowerCase()==="true"||Number(yt.monospace)===1:void 0};qs(Rn,{kind:"draw_for_each",when:va(yt),filterKind:Vs,groupId:Ms,tag:$s,updates:Ho});continue}const Yf=re.match(/^draw\.fib\.auto\s*\((.*)\)\s*$/i);if(Yf){const An=Kr(Yf[1]||""),yt=qc(An),Rn=xr(String(yt.name??"fibo"));Ue.push({name:Rn,type:"auto_fib",method:xr(String(yt.method??"pivots")),pivotLeft:Number(yt.left??yt.pivotLeft??3),pivotRight:Number(yt.right??yt.pivotRight??3),lookback:Number(yt.lookback??400),direction:xr(String(yt.direction??"up")),draw:!0});continue}re.startsWith("//@")||t.push({message:`Ignored Pine statement: ${re}`,line:K})}if(!je.some(oe=>Array.isArray(oe.plots)&&oe.plots.length||Array.isArray(oe.labels)&&oe.labels.length||Array.isArray(oe.levels)&&oe.levels.length||Array.isArray(oe.lines)&&oe.lines.length||Array.isArray(oe.runtimeDrawOps)&&oe.runtimeDrawOps.length||Array.isArray(oe.runtimeLabels)&&oe.runtimeLabels.length||Array.isArray(oe.runtimeLines)&&oe.runtimeLines.length||Array.isArray(oe.runtimeBoxes)&&oe.runtimeBoxes.length||Array.isArray(oe.runtimeTables)&&oe.runtimeTables.length)){const oe=Ve.length?Ve[Ve.length-1].name:We.length?We[We.length-1].name:null,we=oe||"close";Te(ce).plots.push({name:oe?xr(String(oe)):"Close",source:we.replace(/\s+/g,"_").toLowerCase(),type:"line",color:"#60a5fa",width:2}),t.push({message:oe?`No plot() found; auto-plotted "${oe}". Add plot(...) to control output.`:'No plot() found; auto-plotted "close". Add plot(...) to control output.',line:1})}for(const oe of je)if((Array.isArray(oe.runtimeDrawOps)&&oe.runtimeDrawOps.length||Array.isArray(oe.runtimeLabels)&&oe.runtimeLabels.length||Array.isArray(oe.runtimeLines)&&oe.runtimeLines.length||Array.isArray(oe.runtimeBoxes)&&oe.runtimeBoxes.length||Array.isArray(oe.runtimeTables)&&oe.runtimeTables.length||Array.isArray(oe.runtimePolylines)&&oe.runtimePolylines.length||Array.isArray(oe.runtimePolygons)&&oe.runtimePolygons.length?!0:Array.isArray(oe.runtimePaths)&&oe.runtimePaths.length)&&(!Array.isArray(oe.plots)||oe.plots.length===0)){const K=Ve.length?Ve[Ve.length-1].name:"close";Array.isArray(oe.plots)||(oe.plots=[]),oe.plots.push({name:"__runtime_stub__",source:String(K||"close").replace(/\s+/g,"_").toLowerCase(),type:"line",color:"rgba(0,0,0,0)",width:0})}if(!(!!Pt||et.length>0)){const we=je.findIndex(K=>K.pane==="main");if(we>=0){const K=je[we];Array.isArray(K.plots)&&K.plots.length||Array.isArray(K.labels)&&K.labels.length||Array.isArray(K.levels)&&K.levels.length||Array.isArray(K.lines)&&K.lines.length||je.some((ee,Ee)=>Ee===we?!1:Array.isArray(ee.plots)&&ee.plots.length||Array.isArray(ee.labels)&&ee.labels.length||Array.isArray(ee.levels)&&ee.levels.length||Array.isArray(ee.lines)&&ee.lines.length)&&je.splice(we,1)}}if(e.length)return{ok:!1,errors:e,warnings:t.length?t:void 0};try{const oe=je.find(we=>we.pane==="sub");if(oe&&typeof oe.min!="number"&&typeof oe.max!="number"){const K=(Array.isArray(oe.levels)?oe.levels:[]).map(re=>Number(re==null?void 0:re.value)).filter(re=>Number.isFinite(re));if(K.length){const re=Math.min(...K),ke=Math.max(...K),ee=K.some(ht=>ht<=30),Ee=K.some(ht=>ht>=70);K.length>=2&&re>=0&&ke<=100&&ee&&Ee&&(oe.min=0,oe.max=100)}}}catch{}const gc=Object.values(St).map(oe=>{const we=Vn(oe);return{name:we.name,args:we.args,lineNo:we.lineNo,body:we.body}});return{ok:!0,spec:{panes:je,calc:Ue,series:Ve,stateSeries:We,signals:et,strategy:Pt,params:ft,loopPlans:Gd,userFunctions:gc.length?gc:void 0},inputDefs:it,warnings:t.length?t:void 0}}function zJ(n){return new Worker(""+new URL("../workers/editor.worker-oRlJJsnX.js",import.meta.url).href,{name:n==null?void 0:n.name})}function VJ(n){return new Worker(""+new URL("../workers/json.worker-CPn_BmvY.js",import.meta.url).href,{name:n==null?void 0:n.name})}function WJ(n){return new Worker(""+new URL("../workers/css.worker-DGFkc2qH.js",import.meta.url).href,{name:n==null?void 0:n.name})}function HJ(n){return new Worker(""+new URL("../workers/html.worker-CltiozTZ.js",import.meta.url).href,{name:n==null?void 0:n.name})}function qJ(n){return new Worker(""+new URL("../workers/ts.worker-CGiXAPLT.js",import.meta.url).href,{name:n==null?void 0:n.name})}const UJ=()=>{var e;if(typeof window>"u")return;const n=window;(e=n.MonacoEnvironment)!=null&&e.getWorker||(n.MonacoEnvironment={getWorker(t,s){return s==="json"?new VJ:s==="css"||s==="scss"||s==="less"?new WJ:s==="html"||s==="handlebars"||s==="razor"?new HJ:s==="typescript"||s==="javascript"?new qJ:new zJ}})};function GJ(n,e){e("reset")}function YJ(n,e){e()}function KJ(n,e,t){i(e)&&(x(e,!1),t("fullpage",{enabled:!1})),t("close")}function XJ(n,e){e("guide")}function ZJ(){my.set(!0)}async function JJ(n,e,t){x(e,!0),await t(!1)}function j5(n,e){x(e,!1)}async function QJ(n,e){await e(!0)}function B5(n,e){x(e,!1)}function eQ(n,e,t){x(e,!i(e)),t("labels",{enabled:i(e)})}function O5(n,e){x(e,!1)}function tQ(n,e,t,s,o){if(!i(e))return;const r=i(t).trim()||`Run ${i(s).length+1}`,a=`cmp_${Date.now()}_${i(s).length}`,l=i(o)&&typeof i(o)=="object"?{...i(o)}:null;x(s,V([...i(s),{id:a,label:r,summary:i(e),params:l,ts:Date.now()}])),x(t,"")}function nQ(n,e,t,s){x(e,V([])),x(t,null),x(s,V({}))}function sQ(n,e,t,s){x(e,""),x(t,""),x(s,"")}function oQ(n,e,t,s,o,r,a,l,c,f,u,d,h,m,g,w,C,M,P,T,N,L,O){var pe;if(!i(e).length)return;if(x(t,""),!i(s)){x(t,"Select Param A");return}if(i(o)&&i(o)===i(s)){x(t,"Param B must differ from Param A");return}const D=r(i(s),i(a),i(l),i(c));if(!D.length){x(t,"Invalid range for Param A");return}const $=i(o)?r(i(o),i(f),i(u),i(d)):[null],z=D.length*($.length||1);if(z>200){x(t,`Too many combos (${z}). Reduce ranges or steps.`);return}const te=[];for(const J of D)for(const le of $){const de={...i(h)};de[i(s)]=J,i(o)&&le!=null&&(de[i(o)]=le),te.push({params:de})}x(m,V(te)),x(g,V([])),x(w,0),x(C,!0),x(M,!1),x(P,"train"),x(T,null),x(N,V(Number(((pe=L())==null?void 0:pe._updatedAt)??0))),O(0)}function iQ(n,e,t,s,o){x(e,!1),x(t,!1),x(s,V([])),x(o,0)}function rQ(n,e,t,s,o,r,a,l,c){x(e,V([])),x(t,null),x(s,""),x(o,0),x(r,V([])),x(a,!1),x(l,!1),x(c,0)}function aQ(n,e,t){x(e,!i(e)),t("fullpage",{enabled:i(e)})}function z5(n,e,t,s,o,r,a,l,c,f){const u=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const d of i(t))u.push(e([s(d.side),d.entryIndex,d.entryTimeLabel,o(d.entryPrice),d.exitIndex,d.exitTimeLabel,o(d.exitPrice),r(d.qty),a(d.barsHeld,0),l(d.netPnl),c(d.pnlPct),l(d.fees),l(d.pnl),d.maePct==null?"-":c(d.maePct),d.mfePct==null?"-":c(d.mfePct),d.entrySignalId,d.exitSignalId,d.exitReason,l(d.cumNet)]));f("backtest_trades.csv",u.join(`
`),"text/csv;charset=utf-8")}function V5(n,e,t,s,o,r,a,l){const c=[e(["id","status","action","side","kind","createdIndex","createdTime","activeFromIndex","expiresAtIndex","qtyPct","qty","cash","tif","price","stopPrice","limitPrice","targetQty","remainingQty","trailPct","trailOffset","trailPrice","filledIndex","filledTime","fillQty","fillPrice","fees","signalId","ocoGroup","note"])];for(const f of i(t))c.push(e([f.id,f.statusLabel,f.actionLabel,f.sideLabel,f.kindLabel,f.createdIndex,f.createdTimeLabel,f.activeFromIndex,f.expiresAtIndex,`${s(f.qtyPct,2)}%`,f.qty==null?"-":o(f.qty),f.cash==null?"-":r(f.cash),f.tif||"-",f.price==null?"-":a(f.price),f.stopPrice==null?"-":a(f.stopPrice),f.limitPrice==null?"-":a(f.limitPrice),f.targetQty==null?"-":o(f.targetQty),f.remainingQty==null?"-":o(f.remainingQty),f.trailPct==null?"-":`${s(f.trailPct,2)}%`,f.trailOffset==null?"-":a(f.trailOffset),f.trailPrice==null?"-":a(f.trailPrice),f.filledIndex,f.filledTimeLabel,f.fillQty==null?"-":o(f.fillQty),f.fillPrice==null?"-":a(f.fillPrice),f.fees==null?"-":r(f.fees),f.signalId,f.ocoGroup,f.note]));l("backtest_orders.csv",c.join(`
`),"text/csv;charset=utf-8")}function lQ(n,e,t,s,o,r,a,l,c,f,u){const d=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const m of i(t))d.push(e([s(m.side),m.entryIndex,m.entryTimeLabel,o(m.entryPrice),m.exitIndex,m.exitTimeLabel,o(m.exitPrice),r(m.qty),a(m.barsHeld,0),l(m.netPnl),c(m.pnlPct),l(m.fees),l(m.pnl),m.maePct==null?"-":c(m.maePct),m.mfePct==null?"-":c(m.mfePct),m.entrySignalId,m.exitSignalId,m.exitReason,l(m.cumNet)]));const h=i(f).type==="all"?"all":`${i(f).type}_${String(i(f).key).replace(/[^a-zA-Z0-9_-]+/g,"_")}`;u(`backtest_trades_${h}.csv`,d.join(`
`),"text/csv;charset=utf-8")}function cQ(n,e,t,s){const o=[e(["index","timestamp","equity"])];for(const r of i(t))o.push(e([r.index,r.timestamp,r.equity]));s("backtest_equity.csv",o.join(`
`),"text/csv;charset=utf-8")}var uQ=n=>n.stopPropagation(),dQ=(n,e)=>{n.stopPropagation(),x(e,"editor")},fQ=(n,e)=>{n.stopPropagation(),x(e,"errors")},pQ=Me("<span> </span>"),mQ=(n,e)=>{n.stopPropagation(),x(e,"results")},hQ=n=>n.stopPropagation(),vQ=(n,e)=>e("main"),gQ=(n,e)=>e("sub"),_Q=Me('<div class="pane-toggle svelte-1ehcy4i" aria-label="Target pane"><button type="button" class="svelte-1ehcy4i">Main</button> <button type="button" class="svelte-1ehcy4i">Sub pane</button></div>'),yQ=Me('<button class="icon svelte-1ehcy4i" type="button" aria-label="Full page view" title="Full page view"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),bQ=Me('<button class="icon svelte-1ehcy4i" type="button" aria-label="Exit full page view" title="Exit full page view (Esc)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 4H4v5M15 4h5v5M9 20H4v-5M15 20h5v-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),xQ=Me('<div class="monaco-loading svelte-1ehcy4i">Loading editor…</div>'),wQ=Me('<div class="monaco-shell svelte-1ehcy4i"><!></div>'),kQ=Me('<div class="gutter-line svelte-1ehcy4i"></div>'),SQ=Me('<div class="editor-gutter svelte-1ehcy4i"></div> <div class="code-shell svelte-1ehcy4i"><pre class="code-overlay svelte-1ehcy4i" aria-hidden="true"><code class="svelte-1ehcy4i"><!></code><mark class="err svelte-1ehcy4i" style="display:none" aria-hidden="true"></mark><mark class="err-warning svelte-1ehcy4i" style="display:none" aria-hidden="true"></mark></pre> <textarea class="code-input svelte-1ehcy4i" spellcheck="false" placeholder="Write or paste your script here, then press Run to see it on the chart"></textarea></div>',1),CQ=Me('<div class="pine-warn-row svelte-1ehcy4i"> </div>'),IQ=Me('<div class="pine-warn svelte-1ehcy4i"></div>'),PQ=(n,e,t)=>e(i(t).name,n.currentTarget.checked),MQ=Me('<label class="toggle svelte-1ehcy4i"><input type="checkbox" class="svelte-1ehcy4i"> <span class="toggle-track svelte-1ehcy4i"></span></label>'),NQ=(n,e,t)=>e(i(t).name,n.currentTarget.value),AQ=Me('<input class="input svelte-1ehcy4i" type="text">'),TQ=(n,e,t,s)=>{const o=n.currentTarget.value,r=e(o);r!=null&&t(i(s).name,r)},FQ=Me('<input class="input svelte-1ehcy4i" type="datetime-local">'),LQ=(n,e,t)=>e(i(t).name,n.currentTarget.value),EQ=Me("<option></option>"),$Q=Me('<div class="input-source svelte-1ehcy4i"><input class="input svelte-1ehcy4i"> <datalist></datalist></div>'),DQ=(n,e,t)=>e(i(t).name,n.currentTarget.value),RQ=Me('<input class="input input-color svelte-1ehcy4i" type="color">'),jQ=(n,e,t)=>{const s=n.currentTarget.value,o=Number(s);Number.isFinite(o)&&e(i(t).name,i(t).type==="int"?Math.floor(o):o)},BQ=Me('<input class="input svelte-1ehcy4i" type="number">'),OQ=Me('<div class="input-row svelte-1ehcy4i"><div class="input-label svelte-1ehcy4i"><div class="input-name svelte-1ehcy4i"> </div> <div class="input-key mono svelte-1ehcy4i"> </div></div> <div class="input-control svelte-1ehcy4i"><!></div></div>'),zQ=Me('<div class="editor-side svelte-1ehcy4i"><div class="side-card svelte-1ehcy4i"><div class="side-title svelte-1ehcy4i">Inputs</div> <div class="side-sub svelte-1ehcy4i">Script inputs — update values, then press Run.</div> <!> <div class="inputs-list svelte-1ehcy4i"></div> <div class="side-hint svelte-1ehcy4i">Change inputs → press <b>Run</b> to re‑calculate.</div></div></div>'),VQ=Me('<div class="no-errors svelte-1ehcy4i">No errors • All good</div>'),WQ=Me('<span class="diag-loc svelte-1ehcy4i"> <!> —</span>'),HQ=Me('<span class="diag-hint svelte-1ehcy4i"> </span>'),qQ=Me('<div><span class="diag-dot svelte-1ehcy4i"></span> <span class="diag-msg svelte-1ehcy4i"><!> </span> <!></div>'),UQ=Me('<div class="errors-header svelte-1ehcy4i"><div class="errors-title svelte-1ehcy4i"> </div> <div class="errors-sub svelte-1ehcy4i">Newest errors appear here as you type.</div></div> <div class="errors-list svelte-1ehcy4i" aria-live="polite"></div>',1),GQ=Me('<div class="errors-area svelte-1ehcy4i"><!></div>'),YQ=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},KQ=(n,e)=>x(e,"trades"),XQ=(n,e)=>x(e,"orders"),ZQ=(n,e)=>x(e,V(n.currentTarget.value)),JQ=(n,e)=>x(e,V(i(e)==="compact"?"full":"compact")),QQ=(n,e)=>e({type:"all"}),eee=Me('<button class="btn btn-xs btn-outline" type="button">Clear filter</button>'),tee=(n,e)=>e("side"),nee=(n,e)=>e("entryIndex"),see=(n,e)=>e("exitIndex"),oee=(n,e)=>e("qty"),iee=(n,e)=>e("barsHeld"),ree=(n,e)=>e("netPnl"),aee=(n,e)=>e("pnlPct"),lee=(n,e)=>e("fees"),cee=(n,e)=>e("pnl"),uee=(n,e)=>e("maePct"),dee=(n,e)=>e("mfePct"),fee=(n,e)=>e("cumNet"),pee=Me('<th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="svelte-1ehcy4i">Signals</th> <th class="svelte-1ehcy4i">Reason</th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th>',1),mee=(n,e,t)=>e(i(t)),hee=(n,e,t)=>{n.key==="Enter"&&e(i(t))},vee=(n,e,t)=>{var s;try{(s=n==null?void 0:n.stopPropagation)==null||s.call(n)}catch{}e(i(t))},gee=Me('<td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Entry</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Exit</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td>',1),_ee=Me('<tr tabindex="0" class="svelte-1ehcy4i"><td class="svelte-1ehcy4i"><button class="btn btn-xs btn-ghost svelte-1ehcy4i" type="button" title="Focus this trade on chart">View</button></td><td class="svelte-1ehcy4i"><span class="tt-pill tt-pill-side svelte-1ehcy4i"> </span></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><!></tr>'),yee=Me('<div class="tt-scroll svelte-1ehcy4i"><table><thead class="svelte-1ehcy4i"><tr><th class="svelte-1ehcy4i">View</th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><!></tr></thead><tbody class="svelte-1ehcy4i"></tbody></table></div>'),bee=Me('<div class="no-errors svelte-1ehcy4i">No trades to show.</div>'),xee=Me(`<div class="tt-toolbar svelte-1ehcy4i"><div class="tt-toolbar-left svelte-1ehcy4i"><div class="tt-title svelte-1ehcy4i">Trades Table <span class="tt-sub mono svelte-1ehcy4i"> </span></div> <div class="tt-note-inline svelte-1ehcy4i">Entry/Exit show index, time, price. Bars = holding
                      duration.</div></div> <div class="tt-toolbar-right"><input class="input input-sm svelte-1ehcy4i" type="text" placeholder="Search trades..."> <button class="btn btn-xs btn-outline" type="button"> </button> <!> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),wee=(n,e)=>x(e,V(i(e)==="compact"?"full":"compact")),kee=Me('<th class="svelte-1ehcy4i">Active / Expire</th> <th class="svelte-1ehcy4i">Signal / OCO</th> <th class="svelte-1ehcy4i">Note</th>',1),See=(n,e,t)=>{var s;try{(s=n==null?void 0:n.stopPropagation)==null||s.call(n)}catch{}e(i(t))},Cee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty</span><span class="mono svelte-1ehcy4i"> </span></div>'),Iee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Cash</span><span class="mono svelte-1ehcy4i"> </span></div>'),Pee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div>'),Mee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Stop</span><span class="mono svelte-1ehcy4i"> </span></div>'),Nee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Limit</span><span class="mono svelte-1ehcy4i"> </span></div>'),Aee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">TIF</span><span class="mono svelte-1ehcy4i"> </span></div>'),Tee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Trail%</span><span class="mono svelte-1ehcy4i"> </span></div>'),Fee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Trail</span><span class="mono svelte-1ehcy4i"> </span></div>'),Lee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">TrailPx</span><span class="mono svelte-1ehcy4i"> </span></div>'),Eee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Remaining</span><span class="mono svelte-1ehcy4i"> </span></div>'),$ee=Me('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Target</span><span class="mono svelte-1ehcy4i"> </span></div>'),Dee=Me('<td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Active</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Expire</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Signal</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">OCO</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="mono svelte-1ehcy4i"> </td>',1),Ree=Me('<tr class="svelte-1ehcy4i"><td class="svelte-1ehcy4i"><button class="btn btn-xs btn-ghost svelte-1ehcy4i" type="button" title="View this order on chart">View</button></td><td class="mono svelte-1ehcy4i"> </td><td class="svelte-1ehcy4i"><span> </span></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Action</span> <span class="tt-pill tt-pill-action svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Side</span> <span class="tt-pill tt-pill-side svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Kind</span> <span class="tt-pill tt-pill-kind svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty%</span><span class="mono svelte-1ehcy4i"> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty</span><span class="mono svelte-1ehcy4i"> </span></div> <!> <!> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Fees</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><!></tr>'),jee=Me('<div class="tt-scroll svelte-1ehcy4i"><table><thead class="svelte-1ehcy4i"><tr><th class="svelte-1ehcy4i">View</th><th class="svelte-1ehcy4i">ID</th><th class="svelte-1ehcy4i">Status</th><th class="svelte-1ehcy4i">Type</th><th class="svelte-1ehcy4i">Created</th><th class="svelte-1ehcy4i">Request</th><th class="svelte-1ehcy4i">Fill</th><!></tr></thead><tbody class="svelte-1ehcy4i"></tbody></table></div>'),Bee=Me('<div class="no-errors svelte-1ehcy4i">No orders to show.</div>'),Oee=Me(`<div class="tt-title-row svelte-1ehcy4i"><div class="tt-title-group svelte-1ehcy4i"><div class="tt-title svelte-1ehcy4i">Orders</div> <div class="tt-sub mono svelte-1ehcy4i"> <!></div> <div class="tt-note-inline svelte-1ehcy4i">Request shows desired qty/price; Fill shows executed
                      values.</div></div> <div class="tt-title-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),zee=Me('<div class="tables-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="tables-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Trades and Orders"><div class="tables-modal-head svelte-1ehcy4i"><div class="tables-modal-title svelte-1ehcy4i">Trades & Orders</div> <div class="tables-modal-actions svelte-1ehcy4i"><div class="tables-modal-tabs svelte-1ehcy4i" role="tablist" aria-label="Tables"><button type="button" role="tab" class="svelte-1ehcy4i">Trades</button> <button type="button" role="tab" class="svelte-1ehcy4i">Orders</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="tables-modal-body svelte-1ehcy4i"><!></div></div></div>'),Vee=Me("Backtest requires <code>strategy(...)</code> — add it, then press <b>Run</b>.",1),Wee=Me('Backtest requires <code>"strategy"</code> — add it, then press <b>Run</b>.',1),Hee=Me('<div class="no-errors svelte-1ehcy4i"><!></div>'),qee=Me("No backtest results yet — add <code>strategy.entry/strategy.exit</code>, then press <b>Run</b>.",1),Uee=Me('No backtest results yet — add <code>"signals"</code>, then press <b>Run</b>.',1),Gee=Me('<div class="no-errors svelte-1ehcy4i"><!></div>'),Yee=Me("Ready — press <b>Run</b> to calculate results.",1),Kee=Me('<div class="mono svelte-1ehcy4i" style="margin-top:6px; opacity:0.8"> </div>'),Xee=Me('<div class="no-errors svelte-1ehcy4i"><!> <!></div>'),Zee=Me('<div class="meta-chip svelte-1ehcy4i">Last signal <span class="mono svelte-1ehcy4i"> </span></div>'),Jee=Me('<div class="meta-chip svelte-1ehcy4i">Filter <span class="mono svelte-1ehcy4i"> </span></div>'),Qee=(n,e)=>e("setup"),ete=(n,e)=>x(e,V(n.currentTarget.value)),tte=(n,e)=>x(e,V(n.currentTarget.value)),nte=(n,e)=>x(e,V(n.currentTarget.value)),ste=Me('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),ote=Me('<div class="bt-active mono svelte-1ehcy4i"> </div>'),ite=(n,e)=>x(e,V(n.currentTarget.value)),rte=Me('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),ate=(n,e,t)=>e(i(t).id),lte=(n,e,t)=>e(i(t).id),cte=Me('<div class="compare-metric svelte-1ehcy4i"><span class="cd-key svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div>'),ute=Me('<div class="compare-metric svelte-1ehcy4i"><span class="cd-key svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div>'),dte=Me('<div class="compare-params svelte-1ehcy4i"></div>'),fte=Me('<div class="cd-empty svelte-1ehcy4i">No params</div>'),pte=(n,e,t)=>e(i(t).id),mte=Me('<pre class="compare-raw mono svelte-1ehcy4i"> </pre>'),hte=Me('<div class="compare-details svelte-1ehcy4i"><div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Summary</div> <div class="compare-metrics svelte-1ehcy4i"></div></div> <div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Params</div> <!></div> <div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Raw (optional)</div> <button class="btn btn-xs btn-outline" type="button"> </button> <!></div></div>'),vte=Me('<div class="compare-row svelte-1ehcy4i"><div class="mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="mono svelte-1ehcy4i"> </div> <div class="compare-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Remove</button></div></div> <!>',1),gte=Me('<div class="compare-table svelte-1ehcy4i"><div class="compare-head svelte-1ehcy4i"><div>Run</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">Ret%</div> <div class="right svelte-1ehcy4i">DD%</div> <div class="right svelte-1ehcy4i">Sharpe</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Trades</div> <div>Params</div> <div>Actions</div></div> <!></div>'),_te=Me('<div class="bt-empty svelte-1ehcy4i">Pin runs to compare net PnL, drawdown, Sharpe, and params.</div>'),yte=(n,e)=>e("performance"),bte=Me(`No signals matched. Check <code>when</code> conditions and series
                    names; try a simpler condition first.`,1),xte=Me(`Signals matched but no orders filled. Common causes:
                    limit/stop price never touches • stop‑limit expires • try <code>"order": &#123; "kind": "market" &#125;</code> first, then add limit/stop.`,1),wte=Me('<div class="bt-hint svelte-1ehcy4i"><div class="bt-hint-title svelte-1ehcy4i">No trades yet</div> <div class="bt-hint-body svelte-1ehcy4i"><!></div></div>'),kte=(n,e)=>e("behavior"),Ste=Me('<div class="sig-row svelte-1ehcy4i"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Cte=Me('<div class="signal-table svelte-1ehcy4i"><div class="sig-head svelte-1ehcy4i"><div>Signal</div> <div class="right svelte-1ehcy4i">Trades</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">PF</div></div> <!></div>'),Ite=Me('<div class="no-errors svelte-1ehcy4i">No signal stats yet.</div>'),Pte=(n,e)=>e("optimization"),Mte=(n,e)=>e(n.currentTarget.value),Nte=Me("<option> </option>"),Ate=(n,e)=>x(e,V(Number(n.currentTarget.value))),Tte=(n,e)=>x(e,V(Number(n.currentTarget.value))),Fte=(n,e)=>x(e,V(Number(n.currentTarget.value))),Lte=(n,e)=>e(n.currentTarget.value),Ete=Me("<option> </option>"),$te=(n,e)=>x(e,V(Number(n.currentTarget.value))),Dte=(n,e)=>x(e,V(Number(n.currentTarget.value))),Rte=(n,e)=>x(e,V(Number(n.currentTarget.value))),jte=Me('<div class="opt-range-grid svelte-1ehcy4i"><label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Step</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label></div>'),Bte=(n,e)=>x(e,V(n.currentTarget.value)),Ote=(n,e)=>x(e,V(n.currentTarget.checked)),zte=(n,e)=>x(e,V(Math.max(10,Math.min(90,Number(n.currentTarget.value)||70)))),Vte=Me('<div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Train %</div> <div class="opt-control svelte-1ehcy4i"><input class="input input-sm svelte-1ehcy4i" type="number" min="10" max="90"></div></div>'),Wte=Me('<button class="btn btn-xs btn-outline" type="button">Stop</button>'),Hte=Me('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),qte=Me('<div class="opt-warning svelte-1ehcy4i"> </div>'),Ute=Me('<div class="opt-progress svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div>'),Gte=Me('<div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Param A</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"></select></div></div> <div class="opt-range-grid svelte-1ehcy4i"><label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Step</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label></div> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Param B</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"><option>None</option><!></select></div></div> <!> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Metric</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"><option>Net PnL</option><option>Profit Factor</option><option>Sharpe</option><option>Win Rate</option><option>Max Drawdown (lower better)</option></select></div></div> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Walk-forward</div> <div class="opt-control opt-toggle svelte-1ehcy4i"><label class="toggle svelte-1ehcy4i"><input type="checkbox" class="svelte-1ehcy4i"> <span class="toggle-track svelte-1ehcy4i"></span></label></div></div> <!> <div class="opt-actions svelte-1ehcy4i"><button class="btn btn-xs btn-primary" type="button">Run grid</button> <!> <span class="opt-note svelte-1ehcy4i">Up to 200 combos per run.</span></div> <!> <!>',1),Yte=Me('<div class="bt-empty svelte-1ehcy4i">No numeric inputs found. Add <code>input.int</code> or <code>input.float</code> to optimize.</div>'),Kte=Me('<div><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Xte=Me('<div class="opt-test svelte-1ehcy4i"> </div>'),Zte=Me('<div class="opt-results-meta svelte-1ehcy4i"> </div> <div class="opt-results svelte-1ehcy4i"><div class="opt-results-head svelte-1ehcy4i"><div>Params</div> <div class="right svelte-1ehcy4i">Metric</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">Ret%</div> <div class="right svelte-1ehcy4i">DD%</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Trades</div></div> <!></div> <!>',1),Jte=Me('<div class="bt-empty svelte-1ehcy4i">Run a grid search to see ranked results.</div>'),Qte=(n,e)=>e("charts"),ene=(n,e)=>{x(e,"1w")},tne=(n,e)=>{x(e,"1m")},nne=(n,e)=>{x(e,"3m")},sne=(n,e)=>{x(e,"6m")},one=(n,e)=>{x(e,"1y")},ine=(n,e)=>{x(e,"5y")},rne=(n,e)=>{x(e,"all")},ane=Me('<div class="report-metrics svelte-1ehcy4i"><div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Start</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">End</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Net</span> <span> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Return</span> <span> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Range</span> <span class="mono svelte-1ehcy4i"> </span></div></div>'),lne=ta('<path fill="none" stroke="var(--report-benchmark-stroke)" stroke-width="1.25" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path>'),cne=ta('<circle class="report-dot equity svelte-1ehcy4i" r="1.8"></circle>'),une=Me('<svg class="report-svg svelte-1ehcy4i" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Equity curve"><path fill="var(--report-equity-fill)"></path><path fill="none" stroke="var(--report-equity-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><!><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-1ehcy4i"> </div> <div class="chart-axis bottom mono svelte-1ehcy4i"> </div>',1),dne=Me('<div class="report-empty svelte-1ehcy4i">No data</div>'),fne=Me('<div class="crosshair v svelte-1ehcy4i"></div> <div class="crosshair h svelte-1ehcy4i"></div> <div class="chart-tooltip svelte-1ehcy4i"><div class="tt-title mono svelte-1ehcy4i"> </div> <div class="tt-val svelte-1ehcy4i">Equity: <span class="mono svelte-1ehcy4i"> </span></div> <div class="tt-sub svelte-1ehcy4i">Net: <span class="mono svelte-1ehcy4i"> </span></div> <div class="tt-sub svelte-1ehcy4i">Return: <span class="mono svelte-1ehcy4i"> </span></div></div>',1),pne=Me('<div class="report-legend svelte-1ehcy4i"><div class="legend-item svelte-1ehcy4i"><span class="legend-dot equity svelte-1ehcy4i"></span>Equity</div> <div class="legend-item svelte-1ehcy4i"><span class="legend-dot bench svelte-1ehcy4i"></span>Buy &amp; Hold</div></div>'),mne=Me('<div class="report-metrics svelte-1ehcy4i"><div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Worst DD</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Avg DD</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Last DD</span> <span class="mono svelte-1ehcy4i"> </span></div></div>'),hne=ta('<circle class="report-dot dd svelte-1ehcy4i" r="1.8"></circle>'),vne=Me('<svg class="report-svg svelte-1ehcy4i" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Drawdown"><path fill="var(--report-dd-fill)"></path><path fill="none" stroke="var(--report-dd-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-1ehcy4i"> </div> <div class="chart-axis bottom mono svelte-1ehcy4i"> </div>',1),gne=Me('<div class="report-empty svelte-1ehcy4i">No data</div>'),_ne=Me('<div class="tt-sub svelte-1ehcy4i">Equity: <span class="mono svelte-1ehcy4i"> </span></div>'),yne=Me('<div class="crosshair v svelte-1ehcy4i"></div> <div class="crosshair h svelte-1ehcy4i"></div> <div class="chart-tooltip svelte-1ehcy4i"><div class="tt-title mono svelte-1ehcy4i"> </div> <div class="tt-val svelte-1ehcy4i">DD: <span class="mono svelte-1ehcy4i"> </span></div> <!></div>',1),bne=(n,e)=>e("returns"),xne=(n,e,t,s,o)=>{e({type:"month",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades")},wne=(n,e,t,s,o)=>{n.key==="Enter"&&(e({type:"month",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades"))},kne=Me('<div role="button" tabindex="0"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Sne=Me('<div class="returns-table svelte-1ehcy4i"><div class="rt-head svelte-1ehcy4i"><div>Month</div> <div class="right svelte-1ehcy4i">Return</div></div> <!></div>'),Cne=Me('<div class="no-errors svelte-1ehcy4i">No monthly returns yet.</div>'),Ine=(n,e,t,s,o)=>{e({type:"week",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades")},Pne=(n,e,t,s,o)=>{n.key==="Enter"&&(e({type:"week",key:i(t).key}),s("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades"))},Mne=Me('<div role="button" tabindex="0"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Nne=Me('<div class="returns-table svelte-1ehcy4i"><div class="rt-head svelte-1ehcy4i"><div>Week</div> <div class="right svelte-1ehcy4i">Return</div></div> <!></div>'),Ane=Me('<div class="no-errors svelte-1ehcy4i">No weekly returns yet.</div>'),Tne=(n,e)=>e("distributions"),Fne=Me('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),Lne=Me('<div class="hist svelte-1ehcy4i"></div>'),Ene=Me('<div class="no-errors svelte-1ehcy4i">No trades yet.</div>'),$ne=Me('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),Dne=Me('<div class="hist svelte-1ehcy4i"></div>'),Rne=Me('<div class="no-errors svelte-1ehcy4i">No MAE data.</div>'),jne=Me('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),Bne=Me('<div class="hist svelte-1ehcy4i"></div>'),One=Me('<div class="no-errors svelte-1ehcy4i">No MFE data.</div>'),zne=Me('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),Vne=Me('<div class="hist svelte-1ehcy4i"></div>'),Wne=Me('<div class="no-errors svelte-1ehcy4i">No duration data.</div>'),Hne=(n,e)=>e("exports"),qne=(n,e)=>e("trades"),Une=(n,e)=>e("orders"),Gne=Me('<button class="btn btn-sm btn-outline" type="button">Download Filtered Trades CSV</button>'),Yne=Me('<div class="results-shell svelte-1ehcy4i"><div class="results-hero svelte-1ehcy4i"><div class="results-title-group svelte-1ehcy4i"><div class="results-title svelte-1ehcy4i">Strategy Results</div> <div class="results-sub svelte-1ehcy4i">Latest run summary. Update inputs or filters, then press Run.</div></div> <div class="results-kpis svelte-1ehcy4i"><div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Final equity</div> <div class="kpi-value mono svelte-1ehcy4i"> </div></div> <div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Net PnL</div> <div> </div></div> <div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Max drawdown</div> <div class="kpi-value mono svelte-1ehcy4i"> </div></div></div></div> <div class="results-meta svelte-1ehcy4i"><div class="meta-chip svelte-1ehcy4i">Signals <span class="mono svelte-1ehcy4i"> </span> <span class="meta-sub mono svelte-1ehcy4i"> </span></div> <!> <!></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Setup</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Setup info">i</button></div> <div class="section-sub svelte-1ehcy4i">Limit the backtest window or pin runs for comparison.</div></div></div> <div class="bt-tools svelte-1ehcy4i"><div class="bt-tool-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Backtest Filters</div> <div class="bt-field-grid svelte-1ehcy4i"><label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="date"></label> <label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="date"></label> <label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Session</span> <input class="input input-sm svelte-1ehcy4i" type="text" placeholder="0930-1600"></label></div> <div class="bt-actions svelte-1ehcy4i"><button class="btn btn-xs btn-primary" type="button">Re-run</button> <!> <!> <div class="bt-note svelte-1ehcy4i">Dates use UTC • Session HHMM‑HHMM</div></div></div> <div class="bt-tool-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Compare Runs</div> <div class="bt-compare-toolbar svelte-1ehcy4i"><input class="input input-sm svelte-1ehcy4i" type="text" placeholder="Label (optional)"> <button class="btn btn-xs btn-primary" type="button">Pin current</button> <!></div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Performance Snapshot</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Performance snapshot info">i</button></div> <div class="section-sub svelte-1ehcy4i">Core stats for this run at a glance.</div></div></div> <div class="results-grid svelte-1ehcy4i"><div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Trades</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> <!></div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Win rate</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Net PnL</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Expectancy</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Risk</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Exposure</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div></div> <!></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Trade Behavior</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Trade behavior info">i</button></div> <div class="section-sub svelte-1ehcy4i">Breakdowns by side and signal.</div></div></div> <div class="breakdown-grid svelte-1ehcy4i"><div class="breakdown-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Long vs Short</div> <div class="breakdown-row svelte-1ehcy4i"><span class="mono svelte-1ehcy4i">Long</span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="breakdown-row svelte-1ehcy4i"><span class="mono svelte-1ehcy4i">Short</span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div></div> <div class="breakdown-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Per‑Signal Stats</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Optimization</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Optimization info">i</button></div> <div class="section-sub svelte-1ehcy4i">Search numeric inputs and rank by the chosen metric.</div></div> <div class="section-meta mono svelte-1ehcy4i"> <!></div></div> <div class="opt-grid svelte-1ehcy4i"><div class="opt-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Params</div> <!></div> <div class="opt-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Results</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Charts</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Charts info">i</button></div> <div class="section-sub svelte-1ehcy4i">Equity and drawdown for the selected range.</div></div> <div class="section-meta svelte-1ehcy4i"><div class="range-toggle svelte-1ehcy4i" role="group" aria-label="Report range"><button type="button" class="svelte-1ehcy4i">1W</button> <button type="button" class="svelte-1ehcy4i">1M</button> <button type="button" class="svelte-1ehcy4i">3M</button> <button type="button" class="svelte-1ehcy4i">6M</button> <button type="button" class="svelte-1ehcy4i">1Y</button> <button type="button" class="svelte-1ehcy4i">5Y</button> <button type="button" class="svelte-1ehcy4i">All</button></div></div></div> <div class="reports-grid svelte-1ehcy4i"><div class="report-card svelte-1ehcy4i"><div class="report-head svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Equity Curve</div> <div class="report-sub mono svelte-1ehcy4i"><!></div></div> <!> <div class="report-canvas svelte-1ehcy4i"><!> <!></div> <!></div> <div class="report-card svelte-1ehcy4i"><div class="report-head svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Drawdown (%)</div> <div class="report-sub mono svelte-1ehcy4i"> </div></div> <!> <div class="report-canvas svelte-1ehcy4i"><!> <!></div></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Returns</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Returns info">i</button></div> <div class="section-sub svelte-1ehcy4i">Monthly and weekly performance snapshots.</div></div></div> <div class="returns-grid svelte-1ehcy4i"><div class="return-card svelte-1ehcy4i"><div class="rc-title-row svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Monthly Returns</div></div> <div class="rc-subhint svelte-1ehcy4i">Click a row to filter trades by that period.</div> <!></div> <div class="return-card svelte-1ehcy4i"><div class="rc-title-row svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Weekly Returns</div></div> <div class="rc-subhint svelte-1ehcy4i">Click a row to filter trades by that period.</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Distributions</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Distributions info">i</button></div> <div class="section-sub svelte-1ehcy4i">See how trades are distributed across outcomes.</div></div></div> <div class="dist-grid svelte-1ehcy4i"><div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">PnL% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">MAE% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">MFE% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Trade Duration (bars)</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Exports & Totals</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Exports info">i</button></div> <div class="section-sub svelte-1ehcy4i">Download data or review totals for this run.</div></div></div> <div class="export-row svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Open Trades Table</button> <button class="btn btn-sm btn-primary" type="button">Open Orders Table</button> <button class="btn btn-sm btn-outline" type="button">Download Trades CSV</button> <!> <button class="btn btn-sm btn-outline" type="button">Download Orders CSV</button> <button class="btn btn-sm btn-outline" type="button">Download Equity CSV</button></div> <div class="pnl-strip svelte-1ehcy4i"><div class="pnl-item pos svelte-1ehcy4i"> </div> <div class="pnl-item neg svelte-1ehcy4i"> </div> <div> </div></div> <div class="pnl-strip pnl-strip-2 svelte-1ehcy4i"><div class="pnl-item svelte-1ehcy4i"> </div> <div class="pnl-item svelte-1ehcy4i"> </div> <div class="pnl-item svelte-1ehcy4i"> </div></div></div></div>'),Kne=Me('<div class="errors-area svelte-1ehcy4i"><!> <!></div>'),Xne=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},Zne=(n,e)=>x(e,"en"),Jne=(n,e)=>x(e,"bn"),Qne=Me("<li> </li>"),ese=Me("<li> </li>"),tse=Me('<ul class="info-list svelte-1ehcy4i"></ul> <div class="info-example svelte-1ehcy4i"><div class="info-example-title svelte-1ehcy4i">Example</div> <ul class="svelte-1ehcy4i"></ul></div>',1),nse=Me('<div class="info-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="info-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Section info"><div class="info-modal-head svelte-1ehcy4i"><div class="info-modal-title svelte-1ehcy4i"> </div> <div class="info-modal-actions svelte-1ehcy4i"><div class="info-lang-toggle svelte-1ehcy4i" role="group" aria-label="Info language"><button type="button" class="svelte-1ehcy4i">EN</button> <button type="button" class="svelte-1ehcy4i">BN</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="info-modal-body svelte-1ehcy4i"><!></div></div></div>'),sse=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},ose=(n,e)=>{n.key==="Enter"&&e()},ise=Me('<div class="library-loading svelte-1ehcy4i">Loading saved scripts…</div>'),rse=Me('<div class="library-empty svelte-1ehcy4i">No saved scripts yet.</div>'),ase=(n,e,t)=>x(e,V(i(t).id)),lse=Me('<button type="button"><div class="save-row-name svelte-1ehcy4i"> </div> <div class="save-row-meta svelte-1ehcy4i"> </div></button>'),cse=(n,e,t)=>i(e)&&t(i(e)),use=Me('<div class="library-error svelte-1ehcy4i"> </div>'),dse=Me('<div class="library-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="library-modal save-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Save script"><div class="library-head svelte-1ehcy4i"><div class="library-title svelte-1ehcy4i">Save Script</div> <div class="library-head-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-body save-grid svelte-1ehcy4i"><div class="save-panel svelte-1ehcy4i"><div class="save-card svelte-1ehcy4i"><label class="input-label svelte-1ehcy4i" for="save-script-name">Script name</label> <input id="save-script-name" class="input svelte-1ehcy4i" placeholder="Enter a unique name"> <div class="save-actions svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Save as new</button> <span class="save-hint svelte-1ehcy4i">Names must be unique</span></div></div></div> <div class="save-panel svelte-1ehcy4i"><div class="save-card svelte-1ehcy4i"><div class="save-divider svelte-1ehcy4i">Overwrite existing</div> <div class="save-list svelte-1ehcy4i"><!></div> <div class="save-actions overwrite-actions svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Overwrite selected</button> <span class="save-hint svelte-1ehcy4i">Replaces the selected script with current code</span></div></div></div> <!></div></div></div>'),fse=n=>{var e;try{(e=n==null?void 0:n.stopPropagation)==null||e.call(n)}catch{}},pse=Me('<div class="library-error svelte-1ehcy4i"> </div>'),mse=Me('<div class="library-loading svelte-1ehcy4i">Loading scripts…</div>'),hse=Me('<div class="library-empty svelte-1ehcy4i">No scripts found.</div>'),vse=(n,e,t)=>e(i(t)),gse=(n,e,t)=>e(i(t)),_se=(n,e,t)=>e(i(t)),yse=(n,e,t)=>e(i(t)),bse=(n,e,t)=>e(i(t).id),xse=Me('<div class="library-row svelte-1ehcy4i"><div><div class="library-name svelte-1ehcy4i"> </div> <div class="library-meta svelte-1ehcy4i"> </div></div> <div class="library-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Edit</button> <button class="btn btn-xs btn-outline" type="button">Insert</button> <button class="btn btn-xs btn-outline" type="button">Run</button> <button class="btn btn-xs btn-outline" type="button">Copy</button> <button class="btn btn-xs btn-danger svelte-1ehcy4i" type="button">Delete</button></div></div>'),wse=Me('<div class="library-list svelte-1ehcy4i"></div>'),kse=Me('<div class="library-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="library-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="My script library"><div class="library-head svelte-1ehcy4i"><div class="library-title svelte-1ehcy4i">My Script Library</div> <div class="library-head-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Refresh</button> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-toolbar svelte-1ehcy4i"><input class="input library-search svelte-1ehcy4i" type="search" placeholder="Search scripts"> <div class="library-count svelte-1ehcy4i"> </div></div> <!> <div class="library-body svelte-1ehcy4i"><!></div></div></div>'),Sse=Me('<span class="footer-alert-line svelte-1ehcy4i"> </span>'),Cse=Me('<span tabindex="0"><span class="footer-alert-icon svelte-1ehcy4i">!</span> <span class="footer-alert-label svelte-1ehcy4i"> </span> <span class="footer-alert-tip svelte-1ehcy4i" role="tooltip"><span class="footer-alert-title svelte-1ehcy4i"> </span> <!></span></span>'),Ise=Me('<div class="script-studio svelte-1ehcy4i"><div class="studio-header svelte-1ehcy4i"><div class="studio-title svelte-1ehcy4i"><div class="title-dot svelte-1ehcy4i"></div> <div class="title-text-group svelte-1ehcy4i"><div class="title-text svelte-1ehcy4i">Script Studio</div> <div class="title-sub svelte-1ehcy4i">Inline editor · draft → chart</div></div></div> <div class="studio-meta svelte-1ehcy4i"><div class="view-toggle svelte-1ehcy4i"><button type="button" class="svelte-1ehcy4i">Editor</button> <button type="button" class="svelte-1ehcy4i"><span> </span> <!></button> <button type="button" class="svelte-1ehcy4i">Results</button></div> <div class="lang-toggle svelte-1ehcy4i" aria-label="Script mode"><span class="lang-label svelte-1ehcy4i">Mode</span> <select class="lang-select svelte-1ehcy4i"><option>Auto</option><option>JSON</option><option>Pine</option><option>DSL</option><option>JS</option></select></div></div> <div class="studio-actions svelte-1ehcy4i"><!> <button class="ghost svelte-1ehcy4i" type="button" title="Toggle chart labels"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M2 3.5h8M2 6h8M2 8.5h5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span> </span></button> <button class="ghost ghost-secondary svelte-1ehcy4i" type="button"><span>Documentation</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span>Alerts</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span>My Library</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M3 2.5h6v7H3z" stroke="currentColor" stroke-width="1.2"></path><path d="M4 1h4v2H4z" fill="currentColor"></path><path d="M5 7h2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Save</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M6 2a4 4 0 1 1-3.5 2.06" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path><path d="M2.5 2.5v3h3" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Reset</span></button> <button class="primary svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true"><path d="M4 3.2v5.6L9 6 4 3.2Z"></path></svg></span> <span> </span></button> <!> <button class="icon svelte-1ehcy4i" type="button" aria-label="Collapse script dock">&times;</button></div></div> <div class="editor-area svelte-1ehcy4i"><div class="editor-shell svelte-1ehcy4i"><div class="editor-main svelte-1ehcy4i"><div class="editor-toolbar svelte-1ehcy4i"><div class="editor-file svelte-1ehcy4i"><span class="file-dot svelte-1ehcy4i"></span> <span class="file-name svelte-1ehcy4i"> </span> <span class="file-meta svelte-1ehcy4i"> </span></div> <div class="editor-hints svelte-1ehcy4i"><span class="hint svelte-1ehcy4i">1. Write or paste script</span> <span class="hint svelte-1ehcy4i">2. Press Run ▶</span></div></div> <div class="editor-scroll svelte-1ehcy4i"><!></div></div> <!></div></div> <!> <!> <!> <!> <div class="studio-footer svelte-1ehcy4i"><div class="footer-left svelte-1ehcy4i"><span></span> <span class="footer-text svelte-1ehcy4i"> </span> <!></div> <div class="footer-right svelte-1ehcy4i"><span class="footer-hint svelte-1ehcy4i">Ctrl/Cmd + S to save</span> <span class="footer-divider svelte-1ehcy4i">•</span> <span class="footer-hint svelte-1ehcy4i">Ctrl/Cmd + Enter to run</span></div></div></div>');function Pse(n,e){Ld(e,!0);let t=pi(e,"code",15,""),s=pi(e,"codeVersion",3,0),o=pi(e,"status",3,null),r=pi(e,"error",3,null),a=pi(e,"runtimeDiagnostics",19,()=>[]),l=pi(e,"backtest",3,null),c=pi(e,"signalEvents",19,()=>[]),f=pi(e,"isRunning",3,!1),u=pi(e,"isOpen",3,!0),d=pi(e,"paneTarget",7,"main"),h=pi(e,"labelsEnabled",3,!0);const m=Hh();function g(){const ne=T(t());(typeof t()!="string"||ne!==t())&&(t(ne),i(so)&&_n&&($s=!0,_n.setValue(ne),$s=!1)),m("run",{code:ne,params:i(la),lang:i(Te),backtest:i(ri)})}const w="https://noti.dutyai.app/auth/chart/scripts",C=ne=>String(ne||"").trim().toLowerCase(),M=ne=>{const fe=String(ne||""),qe=fe.match(/^\s*library\s*\(\s*["']([^"']+)["']/im);if(qe)return qe[1];const ot=fe.match(/^\s*(indicator|study|strategy)\s*\(\s*["']([^"']+)["']/im);return ot?ot[2]:null},P=ne=>{if(typeof ne=="string")return ne;if(ne==null)return"";try{return JSON.stringify(ne,null,2)}catch{return String(ne)}},T=ne=>{if(typeof ne=="string"){const fe=ne.trim();if(fe.startsWith("{")&&fe.includes('"script"')){try{const qe=JSON.parse(fe);if(qe&&typeof qe=="object"&&typeof qe.script=="string"&&(qe.userPreferenceId||qe.createdAt||qe.updatedAt))return qe.script}catch{}if(fe.includes('"userPreferenceId"')||fe.includes('"createdAt"')){const qe=fe.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if(qe&&qe[1])try{return JSON.parse(`"${qe[1]}"`)}catch{}}}return ne}if(ne&&typeof ne=="object"){const fe=ne.script??ne.code;if(typeof fe=="string")return fe}return P(ne)};let N=xe(!1),L=xe(!1),O=xe(!1),D=xe(null),$=xe(""),z=xe(V([])),te=xe(!1),pe=xe(""),J=xe(null),le=xe(!1),de=xe(null);function he(ne){m("saveStatus",{status:ne})}const ge=ne=>{if(typeof ne=="number"&&Number.isFinite(ne))return ne;if(typeof ne=="string"&&ne.trim()){const fe=Date.parse(ne);if(Number.isFinite(fe))return fe}return Date.now()},ae=ne=>{if(!ne)return null;const fe=String(ne.id||ne._id||ne.scriptId||ne.name||"").trim()||`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,qe=String(ne.name||ne.title||"Untitled Script").trim(),ot=ne.script??ne.code??ne.source??"",Wt=P(ot).trim(),Ct=ge(ne.createdAt||ne.created_at),un=ge(ne.updatedAt||ne.updated_at||Ct);return{id:fe,name:qe,code:Wt,createdAt:Ct,updatedAt:un}},Ie=ne=>[...ne].sort((fe,qe)=>(qe.updatedAt||0)-(fe.updatedAt||0));async function ce(ne=!1){if(i(O)&&!ne)return;x(L,!0),x(D,null);const fe=Og();if(!fe){const qe=Ie(e2());x(z,V(qe)),x(O,!0),x(L,!1);return}try{const qe=await fetch(`${w}/${fe}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!qe.ok){const Ln=await qe.text();throw new Error(Ln||`${qe.status} ${qe.statusText}`)}const ot=await qe.json(),Ct=(Array.isArray(ot)?ot:Array.isArray(ot==null?void 0:ot.data)?ot.data:Array.isArray(ot==null?void 0:ot.scripts)?ot.scripts:[]).map(ae).filter(Boolean),un=Ie(Ct);x(z,V(un)),Lb(un),x(O,!0)}catch{const ot=Ie(e2());x(z,V(ot)),x(O,!0),x(D,"Could not reach server. Showing local copies.")}finally{x(L,!1)}}function je(){x(te,!0),x(J,null),x(de,null);const ne=M(T(t()));x(pe,V(ne||"")),ce(!1)}const Ve=(ne,fe)=>{const qe=C(ne);return qe?(i(z).length?i(z):e2()).some(Wt=>C(Wt.name)===qe&&Wt.id!==fe):!1};async function We(){if(i(le))return;const ne=String(i(pe)||"").trim();if(!ne){x(J,"Enter a script name to save.");return}if(Ve(ne)){x(J,"That name already exists. Choose a different name.");return}x(le,!0),x(J,null);const fe=Og();try{let qe=null;const ot=T(t());if(fe){const Wt=await fetch(`${w}/${fe}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ne,script:ot})});if(!Wt.ok){const Ln=await Wt.text();throw new Error(Ln||`${Wt.status} ${Wt.statusText}`)}const Ct=await Wt.json(),un=ae({id:(Ct==null?void 0:Ct.id)||(Ct==null?void 0:Ct.scriptId)||(Ct==null?void 0:Ct._id),name:ne,script:(Ct==null?void 0:Ct.script)||(Ct==null?void 0:Ct.code)||ot,createdAt:Ct==null?void 0:Ct.createdAt,updatedAt:Ct==null?void 0:Ct.updatedAt});un&&(qe=un,N5(qe))}else qe=LJ(ne,ot);qe&&(x(z,V(Ie([qe,...i(z).filter(Wt=>Wt.id!==qe.id)]))),Lb(i(z)),he(`Saved • ${qe.name}`)),x(te,!1)}catch{x(J,"Save failed. Please try again.")}finally{x(le,!1)}}async function He(ne){if(i(le))return;const fe=i(z).find(Wt=>Wt.id===ne);if(!fe)return;const qe=String(fe.name||"").trim();if(!qe)return;if(Ve(qe,ne)){x(J,"Another script already uses this name.");return}x(le,!0),x(J,null);const ot=Og();try{let Wt=null;const Ct=T(t());if(ot){const un=await fetch(`${w}/${ne}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:qe,script:Ct})});if(!un.ok){const Ws=await un.text();throw new Error(Ws||`${un.status} ${un.statusText}`)}const Ln=await un.json(),Un=ae({id:ne,name:qe,script:(Ln==null?void 0:Ln.script)||(Ln==null?void 0:Ln.code)||Ct,createdAt:fe.createdAt,updatedAt:(Ln==null?void 0:Ln.updatedAt)||Date.now()});Un&&(Wt=Un,N5(Wt))}else Wt=EJ(ne,{code:Ct,name:qe});Wt&&(x(z,V(Ie([Wt,...i(z).filter(un=>un.id!==Wt.id)]))),Lb(i(z)),he(`Saved • ${Wt.name}`)),x(te,!1)}catch{x(J,"Update failed. Please try again.")}finally{x(le,!1)}}async function Ue(ne){const fe=i(z).find(Wt=>Wt.id===ne);if(!fe||!(typeof window>"u"?!0:window.confirm(`Delete "${fe.name}"? This cannot be undone.`)))return;const ot=Og();try{if(ot){const Ct=await fetch(`${w}/${ne}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!Ct.ok){const un=await Ct.text();throw new Error(un||`${Ct.status} ${Ct.statusText}`)}}else $J(ne);const Wt=i(z).filter(Ct=>Ct.id!==ne);x(z,V(Ie(Wt))),Lb(i(z)),he(`Deleted • ${fe.name}`)}catch{x(D,"Delete failed. Please try again.")}}async function et(ne){try{await navigator.clipboard.writeText(String(ne.code||"")),he(`Copied • ${ne.name}`)}catch{he("Copy failed")}}async function ft(ne,fe){const qe=T(t()),ot=T(ne),Wt=fe!=null&&fe.append&&qe?`${qe}

${ot}`.trim():ot;t(Wt),i(so)&&_n&&($s=!0,_n.setValue(Wt),$s=!1),x(Ce,"editor"),await o2(),requestAnimationFrame(()=>Rn==null?void 0:Rn.layout()),fe!=null&&fe.run&&g()}function it(ne){ft(ne)}async function Lt(ne){await ft(ne.code||""),x(N,!1),he(`Loaded • ${ne.name}`)}async function Tt(ne){await ft(ne.code||"",{append:!0}),x(N,!1),he(`Inserted • ${ne.name}`)}async function Pt(ne){await ft(ne.code||"",{run:!0}),x(N,!1)}const St=()=>{const ne=String(i($)||"").trim().toLowerCase();return ne?i(z).filter(fe=>String(fe.name||"").toLowerCase().includes(ne)):i(z)},st=ne=>{if(!Number.isFinite(ne))return"";try{return new Date(ne).toLocaleString()}catch{return""}};wr(()=>{const ne=T(t());ne!==t()&&(t(ne),i(so)&&_n&&($s=!0,_n.setValue(ne),$s=!1))});function xt(ne){d()!==ne&&(d(ne),m("pane",{target:ne}))}const Je=ne=>{let fe=String(ne||"").trim();return fe=i6(fe).replace(/#.*$/,""),fe=fe.split(";")[0],fe=fe.replace(/,\s*$/,""),fe=fe.replace(/\b(and|or)\b\s*$/i,""),fe=fe.replace(/\$\{[^}]+\}/g,"1"),fe=fe.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),fe=fe.replace(/\bstr\./gi,""),fe=fe.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),fe=fe.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(qe,ot,Wt)=>`${String(ot).toLowerCase()}_${Wt}`),fe=fe.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),fe=fe.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),fe=Z_(fe,{pineV2:!0}).expr,fe=Qb(fe),fe.trim()},Xe=new Set(["na","nan","pi","e","true","false"]),Be=ne=>{const fe=[],qe=ot=>{if(!(!ot||typeof ot!="object"))switch(ot.kind){case"Identifier":{const Wt=String(ot.name||"").toLowerCase();Xe.has(Wt)||fe.push(ot.name);return}case"UnaryExpression":qe(ot.expr);return;case"BinaryExpression":qe(ot.left),qe(ot.right);return;case"CallExpression":ot.args.forEach(Wt=>qe(Wt));return;default:return}};return qe(ne),fe},Qe=["close","open","high","low","hl2","hlc3","ohlc4","volume"],ct=ne=>{const fe=typeof ne=="number"?ne:Number(ne);if(!Number.isFinite(fe)||fe<=0)return"";try{return new Date(fe).toISOString().slice(0,16)}catch{return""}},Mt=ne=>{if(!ne)return null;const fe=Date.parse(ne);if(Number.isFinite(fe))return fe;const qe=Number(ne);return Number.isFinite(qe)?qe:null},mt=ne=>{const fe=String(ne||"").trim();if(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(fe))return fe.length===4?`#${fe[1]}${fe[1]}${fe[2]}${fe[2]}${fe[3]}${fe[3]}`:fe;const qe=fe.match(/^rgba?\(([^)]+)\)$/i);if(qe){const ot=qe[1].split(",").map(Wt=>Wt.trim());if(ot.length>=3){const Wt=Number(ot[0]),Ct=Number(ot[1]),un=Number(ot[2]);if([Wt,Ct,un].every(Ln=>Number.isFinite(Ln))){const Ln=Un=>Math.max(0,Math.min(255,Math.round(Un))).toString(16).padStart(2,"0");return`#${Ln(Wt)}${Ln(Ct)}${Ln(un)}`}}}return"#22c55e"};let Ce=xe("editor"),Te=xe("auto"),It=xe(V(!!h())),$t=xe(!1),Yt=xe("trades"),qn=xe("compact"),Vn=xe("compact"),Dn=xe(!1);const Wn={setup:{en:{title:"Setup",desc:["Backtest Filters define the time window for the run (date range + session).","Filters do not change results until you press Run again.","Session uses HHMM-HHMM (leave blank for full day).","Compare Runs saves a snapshot (results + inputs) when you press Pin current.","Use Compare to see how parameter changes affect results side-by-side."],examples:["From 2025-01-01 to 2025-03-31 + Session 0930-1600 -> Run shows only those hours.","Pin Run A -> change fast=10 -> Run -> Pin Run B to compare."]},bn:{title:"সেটআপ",desc:["Backtest Filters মানে কোন সময়ের ডেটা নিয়ে টেস্ট করবেন (তারিখ + সেশন)।","ফিল্টার বদলালেই ফল বদলায় না—আবার Run দিলেই নতুন ফল আসবে।","Session ফরম্যাট HHMM-HHMM; ফাঁকা রাখলে পুরো দিন ধরা হয়।","Pin current দিলে ওই মুহূর্তের ফল + ইনপুট সেভ হয়।","Compare দিয়ে ছোট পরিবর্তনের ফল পাশাপাশিই দেখা যায়।"],examples:["From 2025-01-01, To 2025-03-31 + Session 0930-1600 দিলে শুধু ওই সময়ের ফল।","Run A Pin -> fast=10 দিন -> Run -> Pin -> দুইটা রানের ফল তুলনা।"]}},performance:{en:{title:"Performance Snapshot",desc:["Trades means a complete position: entry -> exit. For long it is buy->sell; for short it is sell->buy.","Net PnL is your real profit after fees; Return (%) compares that to your starting capital.","Max Drawdown is the biggest fall from a previous peak; smaller is safer.","Profit Factor > 1 means total wins are larger than total losses; Expectancy is avg profit per trade.","Sharpe/Sortino show risk-adjusted return; Exposure shows how long you were in the market."],examples:["A 60% win rate with negative Net PnL means losses are larger than wins.","A smooth, slowly rising equity curve usually means lower risk."]},bn:{title:"পারফরম্যান্স স্ন্যাপশট",desc:["Trades মানে সম্পূর্ণ একটি পজিশন: entry থেকে exit। Long হলে buy->sell, short হলে sell->buy।","Net PnL হলো আসল লাভ/ক্ষতি: মোট লাভ থেকে ফি/চার্জ বাদ।","Return (%) দেখায় শুরু করা টাকার তুলনায় কত শতাংশ লাভ/ক্ষতি হলো।","Max Drawdown মানে আগের সর্বোচ্চ লেভেল থেকে সবচেয়ে বড় পতন—এটা যত কম, তত নিরাপদ।","Profit Factor > 1 হলে লাভ ক্ষতির চেয়ে বেশি; Expectancy হলো প্রতি ট্রেডে গড় লাভ/ক্ষতি।","Sharpe/Sortino বলে একই লাভ করতে কত ঝুঁকি নিয়েছেন; Exposure দেখায় কত সময় ট্রেডে ছিলেন।"],examples:["Win rate বেশি হলেও Net negative হলে loss-গুলো বড় হয়েছে।","কম Drawdown + ধীরে ওপরে ওঠা curve মানে স্টেবল ট্রেডিং।"]}},behavior:{en:{title:"Trade Behavior",desc:["Long vs Short splits performance by direction.","Per-Signal Stats groups trades by signal ID so you can see what works.","Signals with low Net/PF are usually the ones to fix or remove.","Use this section to debug entries/exits, not just profitability."],examples:["Short trades = 0 means a long-only strategy.","If EXIT_FULL is net negative, your exit logic may be hurting results."]},bn:{title:"ট্রেড বিহেভিয়ার",desc:["Long বনাম Short আলাদা করে দেখায় কোন দিক বেশি কাজ করেছে।","Per-Signal Stats দেখায় কোন signal ID লাভ/ক্ষতি দিচ্ছে।","যে signal বারবার ক্ষতি করে, সেটি পরিবর্তন বা বন্ধ করতে পারবেন।","Trades/Net/PF দেখে বোঝা যায় কোনটা শক্তিশালী।"],examples:["Short ট্রেড 0 হলে long-only।","EXIT_FULL যদি net negative হয়, exit logic ঠিক করুন।"]}},optimization:{en:{title:"Optimization",desc:["Optimization only works if your script defines input.int or input.float.","Param A/B choose which inputs to sweep.","From/To/Step sets the grid values for each parameter.","Total runs = count(A) x count(B); too many combos triggers a warning.","Metric controls ranking (Max DD: lower is better).","Walk-forward splits Train/Test so results are more realistic."],examples:["Fast 5->20 step 5 gives 4 values; Slow 20->60 step 10 gives 5 values -> 20 runs.","Top row is best by the chosen metric."]},bn:{title:"অপ্টিমাইজেশন",desc:["Optimization কাজ করবে শুধু input.int বা input.float থাকলে।","Param A/B মানে কোন ইনপুটের মান ঘুরিয়ে দেখা হবে।","From/To/Step দিয়ে রেঞ্জ সেট হয়।","মোট রান = A-র মান x B-র মান (খুব বেশি হলে warning আসবে)।","Metric অনুযায়ী র‍্যাংক হয় (Max DD হলে কম মান ভালো)।","Walk-forward দিলে Train/Test আলাদা হয়ে বাস্তবসম্মত ফল পাওয়া যায়।"],examples:["Fast 5->20 step 5 = 4 মান; Slow 20->60 step 10 = 5 মান -> মোট 20 রান।","Top row মানে সেরা ফল।"]}},charts:{en:{title:"Charts",desc:["Equity curve (area + line) shows how your balance moved over time.","Buy & Hold line is the benchmark: what if you just held.","Drawdown chart shows the depth of pullbacks from peaks.","Range buttons only change the chart window, not the backtest itself."],examples:["Equity above Buy & Hold means the strategy outperformed holding.","Hover to see the exact date and equity value."]},bn:{title:"চার্টস",desc:["Equity curve (area + line) দেখায় আপনার ব্যালেন্স সময়ের সাথে কেমন বদলেছে।","Buy & Hold line হলো তুলনা—শুধু ধরে রাখলে কী হতো।","Drawdown chart দেখায় সবচেয়ে বড় পতন কত % ছিল।","1M/3M/6M/All শুধু চার্ট রেঞ্জ বদলায়, ট্রেড রেজাল্ট নয়।"],examples:["Equity line যদি Buy & Hold-এর উপরে থাকে, স্ট্র্যাটেজি ভালো।","Hover করলে নির্দিষ্ট দিনের equity দেখা যায়।"]}},returns:{en:{title:"Returns",desc:["Monthly/Weekly returns show which periods were good or bad.","Click a row to filter trades for that period.","Great for spotting seasonality or outlier months.","Empty means there were no trades in that period."],examples:["2025-02 +3.2% means that month was profitable.","Click a week row, then open Trades table to see those trades."]},bn:{title:"রিটার্নস",desc:["Monthly/Weekly রিটার্নস দেখায় কোন সময় ভালো বা খারাপ গেছে।","Row ক্লিক করলে ওই সময়ের ট্রেড ফিল্টার হয়।","Seasonality ধরতে কাজে লাগে।","ডেটা না থাকলে ওই সময় ট্রেড হয়নি।"],examples:["2025-02 মাসে +3.2% মানে লাভ।","Week row ক্লিক করলে Trades টেবিলে ফিল্টার হয়।"]}},distributions:{en:{title:"Distributions",desc:["PnL% histogram shows how trade outcomes are spread.","MAE% = worst adverse move; MFE% = best favorable move.","Duration shows how long trades usually last (in bars).","Use these to tune stops, targets, and holding time."],examples:["If most PnL% bins are small, results are consistent but modest.","High MAE suggests trades go deep negative before exit."]},bn:{title:"ডিস্ট্রিবিউশন",desc:["PnL% histogram দেখায় ফলাফল কোন রেঞ্জে বেশি হচ্ছে।","MAE% = সবচেয়ে খারাপ adverse move; MFE% = সবচেয়ে ভালো move।","Duration দিয়ে ট্রেড কত বার ধরে থাকে বোঝা যায়।","এগুলো দেখে stop-loss/TP টিউন করা যায়।"],examples:["PnL% ছোট রেঞ্জে বেশি মানে consistent ছোট লাভ।","MAE বেশি হলে ট্রেড আগে অনেক নিচে যায়।"]}},exports:{en:{title:"Exports & Totals",desc:["Open Trades/Orders tables to inspect each trade and order.","CSV exports are for Excel/Sheets or external analysis.","Totals summarize gross profit, gross loss, net, initial/final equity.","Filtered trades CSV respects the current month/week filter."],examples:["Use Trades CSV to build custom reports.","Total = Gross Profit - Gross Loss (fees shown separately)."]},bn:{title:"এক্সপোর্টস ও টোটালস",desc:["Trades/Orders টেবিলে প্রতিটি ট্রেডের Net PnL/fees/price দেখা যায়।","CSV ডাউনলোড করে Excel/Sheets-এ বিশ্লেষণ করা যায়।","Totals-এ gross profit, gross loss, net, initial/final equity দেখা যায়।","Filtered trades CSV বর্তমান ফিল্টার মেনে চলে।"],examples:["Trades CSV দিয়ে custom রিপোর্ট বানান।","Total = Gross Profit - Gross Loss (fees আলাদা)।"]}}};let pn=xe(!1),gn=xe("setup"),Qs=xe("bn");function Is(ne){x(gn,V(ne)),x(pn,!0)}let Cs=xe(V([])),ro=xe("");function bs(ne){x(Cs,V(i(Cs).filter(ot=>ot.id!==ne))),i(Sr)===ne&&x(Sr,null);const{[ne]:fe,...qe}=i(ql);x(ql,V(qe))}let zt=xe(""),Qt=xe(""),ho=xe("");const ri=At(()=>{const ne={},fe=i(zt).trim(),qe=i(Qt).trim(),ot=i(ho).trim();return fe&&(ne.from=fe),qe&&(ne.to=qe),ot&&(ne.session=ot),Object.keys(ne).length?ne:null}),jo=At(()=>!!i(ri)),Na=At(()=>{const ne=[];return(i(zt)||i(Qt))&&ne.push(`${i(zt)||"…"} → ${i(Qt)||"…"}`),i(ho)&&ne.push(`Session ${i(ho)}`),ne.join(" • ")}),ar=At(()=>i(ur).filter(ne=>ne.type==="int"||ne.type==="float"));let Aa=xe(!1),nr=xe(""),hi=xe(""),Gc=xe(0),Pu=xe(0),wc=xe(1),cc=xe(0),ou=xe(0),zu=xe(1),ja=xe("netPnl"),nc=xe(!1),Bc=xe(V([])),Vu=xe(0),rf=xe(!1),co=xe(V([])),ll=xe(""),va=xe(!1),Vl=xe(70),kr=xe("train"),Wr=xe(null),jl=xe(0);const Xl=At(()=>i(Bc).length),Mu=At(()=>i(Xl)>0?Math.min(100,Math.round(i(Vu)/i(Xl)*100)):0),Zu=At(()=>[...i(co)].sort((ne,fe)=>Nn(fe.summary)-Nn(ne.summary))),xo=At(()=>i(ja)==="profitFactor"?"Profit Factor":i(ja)==="sharpe"?"Sharpe":i(ja)==="winRate"?"Win Rate":i(ja)==="maxDrawdownPct"?"Max DD (lower is better)":"Net PnL");let Sr=xe(null),ql=xe(V({}));function $f(ne){x(Sr,V(i(Sr)===ne?null:ne))}function Cf(ne){x(ql,V({...i(ql),[ne]:!i(ql)[ne]}))}function tp(ne,fe=40){if(ne==null)return"—";let qe="";if(typeof ne=="number"||typeof ne=="boolean")qe=String(ne);else if(typeof ne=="string")qe=ne;else try{qe=JSON.stringify(ne)}catch{qe=String(ne)}return fe>0&&qe.length>fe?`${qe.slice(0,fe-1)}…`:qe}function mf(ne){return ne?Object.entries(ne).slice(0,6).map(([fe,qe])=>`${fe}=${tp(qe,18)}`).join(", "):"-"}const sc=ne=>[{label:"Final",value:zs(ne.finalEquity,2)},{label:"Net",value:`${ne.netPnl>=0?"+":""}${zs(ne.netPnl,2)} (${Bo(ne.netPnlPct??0)})`},{label:"DD",value:Bo(ne.maxDrawdownPct??0)},{label:"PF",value:Mf(ne.profitFactor??0)},{label:"Win",value:Bo(ne.winRate??0)},{label:"Trades",value:String(ne.trades??0)},{label:"Sharpe",value:Mf(ne.sharpe??0)},{label:"Sortino",value:Mf(ne.sortino??0)},{label:"Exposure",value:Bo(ne.exposurePct??0)},{label:"Bars/Trade",value:zs(ne.avgBarsInTrade??0,1)}];function yd(ne){try{return JSON.stringify({label:ne.label,ts:ne.ts,params:ne.params,summary:ne.summary},null,2)}catch{return String(ne.summary)}}function If(ne){const fe=i(ar).find(un=>un.name===ne),qe=typeof(fe==null?void 0:fe.defval)=="number"?fe.defval:0,ot=typeof(fe==null?void 0:fe.minval)=="number"?fe.minval:qe,Wt=typeof(fe==null?void 0:fe.maxval)=="number"?fe.maxval:qe,Ct=typeof(fe==null?void 0:fe.step)=="number"?fe.step:(fe==null?void 0:fe.type)==="int"?1:.1;return{from:ot,to:Wt,step:Ct}}function En(ne){x(nr,V(ne));const fe=If(ne);x(Gc,V(fe.from)),x(Pu,V(fe.to)),x(wc,V(fe.step))}function ms(ne){if(x(hi,V(ne)),!ne)return;const fe=If(ne);x(cc,V(fe.from)),x(ou,V(fe.to)),x(zu,V(fe.step))}wr(()=>{i(Aa)||i(ar).length&&(En(i(ar)[0].name),i(ar).length>1&&ms(i(ar)[1].name),x(Aa,!0))});function js(ne,fe,qe,ot){const Wt=i(ar).find(Ts=>Ts.name===ne),Ct=(Wt==null?void 0:Wt.type)==="int",un=Math.abs(ot||1);if(!Number.isFinite(fe)||!Number.isFinite(qe)||!Number.isFinite(un)||un<=0)return[];const Ln=[],Un=fe<=qe?1:-1;let Ws=fe,bo=0;for(;Un>0&&Ws<=qe+1e-9||Un<0&&Ws>=qe-1e-9;){const Ts=Ct?Math.round(Ws):Number(Ws.toFixed(6));if(Ln.push(Ts),Ws+=un*Un,bo+=1,bo>2e3)break}return Array.from(new Set(Ln))}function Nn(ne){return ne?i(ja)==="profitFactor"?ne.profitFactor??0:i(ja)==="sharpe"?ne.sharpe??0:i(ja)==="winRate"?ne.winRate??0:i(ja)==="maxDrawdownPct"?-(ne.maxDrawdownPct??0):ne.netPnl??0:-1/0}function Io(ne){return ne?i(ja)==="profitFactor"?ne.profitFactor??0:i(ja)==="sharpe"?ne.sharpe??0:i(ja)==="winRate"?ne.winRate??0:i(ja)==="maxDrawdownPct"?ne.maxDrawdownPct??0:ne.netPnl??0:0}function fo(ne){const fe=Io(ne);return i(ja)==="winRate"||i(ja)==="maxDrawdownPct"?Bo(fe):zs(fe,2)}function Ji(ne){const fe=i(ri)&&typeof i(ri)=="object"?{...i(ri)}:null;return!fe&&!ne?null:{...fe||{},...ne||{}}}function Gi(ne){if(!i(Bc).length)return;const fe=i(Bc)[ne];if(!fe)return;const qe=i(va)?Al(i(kr)):null,ot=Ji(qe);x(rf,!0),m("run",{code:t(),params:fe.params,lang:i(Te),backtest:ot})}function Al(ne){var Ct,un;if(!i(Cc).length)return null;const fe=Number((Ct=i(Cc)[0])==null?void 0:Ct.timestamp),qe=Number((un=i(Cc)[i(Cc).length-1])==null?void 0:un.timestamp);if(!Number.isFinite(fe)||!Number.isFinite(qe)||qe<=fe)return null;const ot=Math.max(10,Math.min(90,Number(i(Vl))||70))/100,Wt=Math.round(fe+(qe-fe)*ot);return ne==="train"?{from:fe,to:Wt}:{from:Wt,to:qe}}wr(()=>{var Ct;if(!i(nc)||!i(rf)||f())return;const ne=p0(l()),fe=Number((ne==null?void 0:ne._updatedAt)??0),qe=Number(p0(i(jl)));if(!ne||!fe||fe===qe)return;x(jl,V(fe)),x(rf,!1);const ot=((Ct=i(Bc)[i(Vu)])==null?void 0:Ct.params)||{},Wt=ne.summary;if(Wt&&(x(co,V([...i(co),{params:ot,summary:Wt}])),i(va)&&i(kr)==="test"&&x(Wr,V({params:ot,summary:Wt}))),x(Vu,i(Vu)+1),i(Vu)<i(Bc).length)Gi(i(Vu));else if(i(va)&&i(kr)==="train"){const un=[...i(co)].sort((Ln,Un)=>Nn(Un.summary)-Nn(Ln.summary))[0];un?(x(Bc,V([{params:un.params}])),x(Vu,0),x(kr,"test"),Gi(0)):x(nc,!1)}else x(nc,!1)});const Ii=At(()=>i(Te)==="auto"?"auto":i(Te)),Wo=ne=>{const fe=String(ne||"").trim();return fe.startsWith("{")||fe.startsWith("[")},To=ne=>{const fe=String(ne||"");return/^\s*\/\/@\s*(?:pine|version)\b/m.test(fe)||/\b(strategy|indicator|library|plot)\s*\(/m.test(fe)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(fe)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(fe)},Ba=ne=>{const fe=String(ne||"").split(/\r?\n/),qe=Math.min(8,fe.length);for(let ot=0;ot<qe;(ot+=1)-1){const Ct=(fe[ot]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!Ct)continue;const un=String(Ct[1]||"").toLowerCase();if(un==="auto"||un==="json"||un==="pine"||un==="dsl"||un==="js")return un}return null},Pi=At(()=>{if(i(Te)!=="auto")return i(Te);const ne=Ba(t());return ne||(Wo(t())?"json":"auto")});wr(()=>{x(It,V(!!h()))});const qs=At(()=>i(Ce)==="results");function mi(){x(Dn,!1),m("fullpage",{enabled:!1})}Mh(()=>{const ne=fe=>{i(Dn)&&fe.key==="Escape"&&(fe.preventDefault(),mi())};return window.addEventListener("keydown",ne),()=>window.removeEventListener("keydown",ne)}),Mh(async()=>{if(!(typeof window>"u")&&i(An)==="idle"){x(An,"loading");try{UJ();const ne=await Rg(()=>import("../chunks/editor.api.XtYpUk0H.js").then(ot=>ot.m),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url);if(await Promise.all([Rg(()=>import("../chunks/monaco.contribution.BLSvLrUx.js"),__vite__mapDeps([15,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Rg(()=>import("../chunks/monaco.contribution.CopFz6KF.js"),__vite__mapDeps([16,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Rg(()=>import("../chunks/monaco.contribution.2-k9hypo.js"),__vite__mapDeps([17,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Rg(()=>import("../chunks/monaco.contribution.Bc7meUci.js"),__vite__mapDeps([18,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Rg(()=>import("../chunks/suggestController.TAqXY2ko.js"),__vite__mapDeps([19,1,2,3,4,5,6,12,20,21,22]),import.meta.url),Rg(()=>import("../chunks/parameterHints.StIp-S_A.js"),__vite__mapDeps([23,2,1,3,24]),import.meta.url),Rg(()=>import("../chunks/hoverContribution.CisGEAg6.js"),__vite__mapDeps([25,2,1,3,11,4,5,6,20,21,9,10,26]),import.meta.url),Rg(()=>import("../chunks/formatActions.BuL_rer4.js"),__vite__mapDeps([27,2,4,13,11]),import.meta.url)]),yt=ne,El(ne),fu(ne),Cr(ne),await o2(),!i(Yf)){x(An,"failed");return}const fe=ba(String(t()||""));x(Ho,V(fe)),_n=ne.editor.createModel(String(t()||""),fe),Rn=ne.editor.create(i(Yf),{model:_n,automaticLayout:!0,minimap:{enabled:!1},fontSize:13,fontFamily:'JetBrains Mono, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace',lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:fe==="pine"?"off":"on",theme:Pl(),quickSuggestions:{other:!0,comments:!1,strings:!0},suggestOnTriggerCharacters:!0,parameterHints:{enabled:!0},inlineSuggest:{enabled:!0},tabCompletion:"on",snippetSuggestions:"inline",wordBasedSuggestions:!1,quickSuggestionsDelay:40}),Rn.addAction({id:"scriptstudio.format",label:"Format Document",keybindings:[ne.KeyMod.CtrlCmd|ne.KeyMod.Shift|ne.KeyCode.KeyF],run:()=>Rn==null?void 0:Rn.getAction("editor.action.formatDocument").run()}),Vs.push(Rn.onDidType(ot=>{if(Rn&&(ot==="."||ot==="("))try{const Wt=Rn.getAction("editor.action.triggerSuggest");Wt?Wt.run():Rn.trigger("keyboard","editor.action.triggerSuggest",{})}catch{}})),Vs.push(Rn.onDidChangeModelContent(ot=>{if(!_n||$s)return;ao+=1;const Wt=ao;wo&&clearTimeout(wo);const Ct=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Ct&&Zo!=null&&Ct(Zo),Zo=null;const Ln=(Array.isArray(ot==null?void 0:ot.changes)?ot.changes.reduce((Un,Ws)=>Un+String((Ws==null?void 0:Ws.text)||"").length,0):0)>800?180:60;wo=setTimeout(()=>{const Un=()=>{if(!_n||$s||Wt!==ao)return;const bo=_n.getValue();Ms=!0,bo!==t()&&t(bo),Ms=!1},Ws=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Ws&&Ln>60?Zo=Ws(Un,{timeout:250}):Un()},Ln)}));const qe=new MutationObserver(()=>{yt&&yt.editor.setTheme(Pl())});if(qe.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),qe.observe(document.body,{attributes:!0,attributeFilter:["data-theme"]}),Vs.push({dispose:()=>qe.disconnect()}),Vs.push({dispose:()=>{wo&&clearTimeout(wo),wo=null;const ot=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;ot&&Zo!=null&&ot(Zo),Zo=null}}),typeof ResizeObserver<"u"){const ot=new ResizeObserver(()=>{Rn==null||Rn.layout()});i(Yf)&&ot.observe(i(Yf)),Vs.push({dispose:()=>ot.disconnect()})}x(An,"ready"),_u()}catch(ne){console.warn("[ScriptStudio] Monaco init failed:",ne),x(An,"failed")}}}),b0(()=>{try{i(Dn)&&m("fullpage",{enabled:!1})}catch{}Vs.forEach(ne=>ne.dispose()),Vs=[],Rn==null||Rn.dispose(),_n==null||_n.dispose(),Rn=null,_n=null});const Er=At(()=>{try{if(!Wo(String(t()||"")))return!1;const ne=JSON.parse(String(t()||"").trim());return!!(ne!=null&&ne.strategy)}catch{return!1}}),Za=At(()=>{try{if(!Wo(String(t()||"")))return!1;const ne=JSON.parse(String(t()||"").trim());return Array.isArray(ne==null?void 0:ne.signals)&&ne.signals.length>0}catch{return!1}});let vi=xe(""),$r=xe(null);wr(()=>{const ne=String(t()||""),fe=i(Pi);if(!(fe==="pine"||fe==="auto"&&To(ne))){x(vi,""),x($r,null);return}let ot=!1,Wt=null;const Ct=ne,un=()=>{if(!ot&&Ct===String(t()||""))try{const Un=Tw(Ct);if(ot||Ct!==String(t()||""))return;x(vi,V(Ct)),x($r,V(Un))}catch{if(ot||Ct!==String(t()||""))return;x(vi,V(Ct)),x($r,null)}},Ln=setTimeout(()=>{const Un=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Un?Wt=Un(un,{timeout:250}):un()},160);return()=>{ot=!0,clearTimeout(Ln);const Un=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Un&&Wt!=null&&Un(Wt)}});const Il=At(()=>{const ne=i($r);return!!(ne&&ne.ok&&ne.spec&&ne.spec.strategy)}),cl=At(()=>{const ne=i($r),fe=ne&&ne.ok&&ne.spec?ne.spec.signals:null;return Array.isArray(fe)&&fe.length>0}),kc=At(()=>!!(i(Er)||i(Il))),uc=At(()=>!!(i(Za)||i(cl))),Tl=At(()=>{const ne=i($r);return!ne||!ne.ok?[]:Array.isArray(ne.warnings)?ne.warnings:[]}),ur=At(()=>{const ne=i($r);return!ne||!ne.ok?[]:Array.isArray(ne.inputDefs)?ne.inputDefs:[]});let la=xe(null);wr(()=>{if(!i(ur).length){x(la,null);return}i(la)==null&&x(la,V({}))});const Fl=At(()=>{const ne={};for(const fe of i(ur))ne[fe.name]=i(la)&&fe.name in i(la)?i(la)[fe.name]:fe.defval;return ne}),Oa=(ne,fe)=>{x(la,V({...i(la)||{},[ne]:fe}))},ni=At(()=>{var ne;return((ne=l())==null?void 0:ne.summary)||null}),vc=At(()=>{if(!i(qs))return{total:0,entryLong:0,exitLong:0,entryShort:0,exitShort:0,lastTs:null};const ne=Array.isArray(c())?c():[],fe={total:ne.length,entryLong:0,exitLong:0,entryShort:0,exitShort:0};let qe=null;for(const ot of ne){if(!ot)continue;ot.type==="entry_long"?fe.entryLong+=1:ot.type==="exit_long"?fe.exitLong+=1:ot.type==="entry_short"?fe.entryShort+=1:ot.type==="exit_short"&&(fe.exitShort+=1);const Wt=Number(ot.timestamp);Number.isFinite(Wt)&&(qe=qe==null?Wt:Math.max(qe,Wt))}return{...fe,lastTs:qe}}),gl=At(()=>{var ne;return i(qs)&&Array.isArray((ne=l())==null?void 0:ne.trades)?l().trades:[]}),za=At(()=>{var ne;return i(qs)&&Array.isArray((ne=l())==null?void 0:ne.orders)?l().orders:[]}),sl=ne=>{const fe=typeof ne=="number"?ne:Number(ne);return!Number.isFinite(fe)||fe<=0?null:fe<1e12?fe*1e3:fe},Oc=ne=>{const fe=sl(ne);if(fe==null)return"-";try{const ot=new Date(fe).toISOString();return`${ot.slice(0,10)} ${ot.slice(11,16)}`}catch{return"-"}},Va=ne=>{const fe=typeof ne=="number"?ne:Number(ne);return Number.isFinite(fe)?fe:null},Wa=At(()=>{var Wt;const ne=i(qs)&&Array.isArray((Wt=l())==null?void 0:Wt.roundTrips)?l().roundTrips:[],fe=i(gl).length===0&&ne.length>0,qe=(fe?ne:i(gl)).filter(Ct=>Ct&&Number.isFinite(Number(Ct.entryIndex))&&Number.isFinite(Number(Ct.exitIndex))).slice().sort((Ct,un)=>Number(Ct.exitIndex)-Number(un.exitIndex)||Number(Ct.entryIndex)-Number(un.entryIndex));let ot=0;return qe.map((Ct,un)=>{const Ln=Va(Ct.pnl??Ct.grossPnl??Ct.profit),Un=Va(Ct.fees??Ct.fee??Ct.commission),Ws=fe&&Number.isFinite(Number(Ct.netPnl))?Number(Ct.netPnl):(Ln??0)-(Un??0);ot+=Ws;const bo=sl(Ct.entryTimestamp),Ts=sl(Ct.exitTimestamp),Oo=Oc(bo),_i=Oc(Ts),to=[Ct.side||"",Ct.entryIndex,Ct.exitIndex,bo??0,Ts??0,Ct.entryOrderId??"",Ct.exitOrderId??"",un].join(":"),Ha=Va(fe?Ct.avgEntryPrice??Ct.entryPrice??Ct.entry:Ct.entryPrice??Ct.entry_price??Ct.entry),Ta=Va(fe?Ct.avgExitPrice??Ct.exitPrice??Ct.exit:Ct.exitPrice??Ct.exit_price??Ct.exit);return{id:to,side:String(Ct.side||""),qty:Va(Ct.qty??Ct.size??Ct.qtyEntered)??0,entryIndex:Number(Ct.entryIndex)||0,exitIndex:Number(Ct.exitIndex)||0,entryTimestamp:bo,exitTimestamp:Ts,entryTimeLabel:Oo,exitTimeLabel:_i,entryPrice:Ha??0,exitPrice:Ta??0,entrySignalId:Ct.entrySignalId!=null?String(Ct.entrySignalId):"",exitSignalId:Ct.exitSignalId!=null?String(Ct.exitSignalId):"",pnl:Ln??0,pnlPct:Va(Ct.pnlPct??Ct.pnl_pct??Ct.returnPct)??0,fees:Un??0,netPnl:Ws,cumNet:ot,exitReason:String(Ct.exitReason||""),maePct:Number.isFinite(Number(Ct.maePct))?Number(Ct.maePct):null,mfePct:Number.isFinite(Number(Ct.mfePct))?Number(Ct.mfePct):null,barsHeld:Math.max(0,(Number(Ct.exitIndex)||0)-(Number(Ct.entryIndex)||0)+1)}})}),uu=At(()=>i(za).filter(fe=>fe&&Number.isFinite(Number(fe.createdIndex))).slice().sort((fe,qe)=>Number(fe.createdIndex)-Number(qe.createdIndex)||String(fe.id||"").localeCompare(String(qe.id||""))).map((fe,qe)=>{const ot=sl(fe.createdTimestamp),Wt=sl(fe.filledTimestamp),Ct=String(fe.kind||"").toLowerCase(),un=String(fe.action||""),Ln=String(fe.side||""),Un=String(fe.status||""),Ws=Va(fe.qty??fe.quantity),bo=Va(fe.cash),Ts=Va(fe.price),Oo=Va(fe.stopPrice),_i=Va(fe.limitPrice),to=fe.tif!=null?String(fe.tif).toUpperCase():"",Ha=Va(fe.remainingQty),Ta=Va(fe.targetQty),dl=Va(fe.trailPct),yl=Va(fe.trailOffset),Ml=Va(fe.trailPrice),Gl=String(Un||"").toLowerCase().replace(/[^a-z0-9]+/g,"-");return{id:String(fe.id||qe),action:un,actionLabel:Yc(un),side:Ln,sideLabel:Yc(Ln),kind:String(fe.kind||""),kindLabel:Lu(fe.kind),originalKind:String(fe.originalKind||""),status:Un,statusLabel:Yc(Un),statusKey:Gl,signalId:fe.signalId!=null?String(fe.signalId):"",ocoGroup:fe.ocoGroup!=null?String(fe.ocoGroup):"",createdIndex:Number(fe.createdIndex)||0,createdTimestamp:ot,createdTimeLabel:Oc(ot),activeFromIndex:Number(fe.activeFromIndex)||0,expiresAtIndex:Number.isFinite(Number(fe.expiresAtIndex))?Number(fe.expiresAtIndex):null,qtyPct:Number(fe.qtyPct)||0,qty:Ws,cash:bo,tif:to,remainingQty:Ha,targetQty:Ta,trailPct:dl,trailOffset:yl,trailPrice:Ml,price:Ts,stopPrice:Oo??(Ct==="stop"?Ts:null),limitPrice:_i??(Ct==="limit"?Ts:null),filledIndex:Number.isFinite(Number(fe.filledIndex))?Number(fe.filledIndex):null,filledTimestamp:Wt,filledTimeLabel:Oc(Wt),fillPrice:Va(fe.fillPrice),fillQty:Va(fe.fillQty),fees:Va(fe.fees),note:fe.note!=null?String(fe.note):""}})),ud=At(()=>i(uu).length>500?i(uu).slice(i(uu).length-500):i(uu));let Ll=xe(V({type:"all"})),vu=xe(""),Sc=xe(V({key:"exitIndex",dir:"desc"}));function Ja(ne){i(Sc).key===ne?x(Sc,V({key:ne,dir:i(Sc).dir==="asc"?"desc":"asc"})):x(Sc,V({key:ne,dir:"desc"}))}function ga(ne){return i(Sc).key!==ne?"":i(Sc).dir==="asc"?"↑":"↓"}const Wu=At(()=>{const ne=i(Wa),fe=Ln=>{const Un=Number(Ln==null?void 0:Ln.exitTimestamp);return!Number.isFinite(Un)||Un<=0?!1:i(Ll).type==="month"?re(Un)===i(Ll).key:i(Ll).type==="week"?ke(Un)===i(Ll).key:!0},qe=i(vu).trim().toLowerCase(),ot=i(Ll).type==="all"?ne:ne.filter(fe),Wt=qe?ot.filter(Ln=>[Ln.side,Ln.exitReason,Ln.entrySignalId,Ln.exitSignalId,String(Ln.entryIndex),String(Ln.exitIndex)].filter(Boolean).map(Ws=>String(Ws).toLowerCase()).some(Ws=>Ws.includes(qe))):ot,Ct=i(Sc).dir==="asc"?1:-1,un=i(Sc).key;return Wt.slice().sort((Ln,Un)=>{const Ws=Ln==null?void 0:Ln[un],bo=Un==null?void 0:Un[un];if(un==="side")return String(Ws).localeCompare(String(bo))*Ct;const Ts=typeof Ws=="number"?Ws:Number(Ws),Oo=typeof bo=="number"?bo:Number(bo);return!Number.isFinite(Ts)&&!Number.isFinite(Oo)?0:Number.isFinite(Ts)?Number.isFinite(Oo)?(Ts-Oo)*Ct:-1:1})}),zc=ne=>{const fe=ne.length;let qe=0,ot=0,Wt=0,Ct=0,un=0,Ln=0,Un=0,Ws=0,bo=0;for(const Ta of ne){const dl=Number(Ta==null?void 0:Ta.netPnl)||0,yl=Number(Ta==null?void 0:Ta.fees)||0,Ml=Number(Ta==null?void 0:Ta.pnl)||0;Wt+=dl,Ct+=yl,un+=Ml,Ml>0?Ln+=Ml:Ml<0&&(Un+=Math.abs(Ml)),dl>0?(qe+=1,Ws+=dl):dl<0&&(ot+=1,bo+=dl)}const Ts=fe?qe/fe*100:0,Oo=qe?Ws/qe:0,_i=ot?bo/ot:0,to=Un>0?Ln/Un:Ln>0?1/0:0,Ha=fe?qe/fe*Oo+ot/fe*_i:0;return{trades:fe,wins:qe,losses:ot,winRate:Ts,net:Wt,fees:Ct,gross:un,grossProfit:Ln,grossLoss:Un,profitFactor:to,avgWin:Oo,avgLoss:_i,expectancy:Ha}},eu=At(()=>{const ne=i(Wa).filter(qe=>String(qe.side)==="long"),fe=i(Wa).filter(qe=>String(qe.side)==="short");return{long:zc(ne),short:zc(fe)}}),Ud=At(()=>{const ne=i(Wa),fe=new Map;for(const ot of ne){const Wt=String(ot.entrySignalId||ot.exitSignalId||"unknown"),Ct=fe.get(Wt)||[];Ct.push(ot),fe.set(Wt,Ct)}const qe=Array.from(fe.entries()).map(([ot,Wt])=>({id:ot,...zc(Wt)}));return qe.sort((ot,Wt)=>(Wt.net||0)-(ot.net||0)),qe}),qf=At(()=>{const ne=i(Wa).map(fe=>Number(fe==null?void 0:fe.pnlPct)).filter(fe=>Number.isFinite(fe));return np(ne,12)}),Uf=At(()=>{const ne=i(Wa).map(fe=>Number(fe==null?void 0:fe.maePct)).filter(fe=>Number.isFinite(fe));return np(ne,10)}),dd=At(()=>{const ne=i(Wa).map(fe=>Number(fe==null?void 0:fe.mfePct)).filter(fe=>Number.isFinite(fe));return np(ne,10)}),Id=At(()=>{const ne=i(Wa).map(fe=>Number(fe==null?void 0:fe.barsHeld)).filter(fe=>Number.isFinite(fe));return np(ne,10)}),dc=At(()=>i(Wu).length>500?i(Wu).slice(i(Wu).length-500):i(Wu)),Gf=At(()=>i(Wa).reduce((ne,fe)=>ne+(Number(fe.netPnl)||0),0));let Pd=xe(null);function af(ne){x(Pd,V((ne==null?void 0:ne.id)||null)),m("selectTrade",{trade:ne||null})}function ol(ne){ne&&(af(ne),td())}function du(ne){ne&&(m("focusOrder",{order:ne}),td())}function Nu(ne){x(Ll,V(ne)),i(Pd)&&(i(Wu).some(qe=>qe.id===i(Pd))||x(Pd,null))}function hf(ne){x(Yt,V(ne)),x($t,!0)}function td(){x($t,!1)}const Cc=At(()=>{var ne;return i(qs)&&Array.isArray((ne=l())==null?void 0:ne.equity)?l().equity:[]}),Gd=At(()=>{var ne;return i(qs)&&Array.isArray((ne=l())==null?void 0:ne.benchmark)?l().benchmark:[]});let tu=xe("6m");function Vc(ne,fe){var Ct;if(!Array.isArray(ne)||ne.length===0)return[];if(fe==="all")return ne;const qe=Number((Ct=ne[ne.length-1])==null?void 0:Ct.timestamp);if(!Number.isFinite(qe)||qe<=0)return ne;const ot=fe==="1w"?7:fe==="1m"?30:fe==="3m"?90:fe==="6m"?180:fe==="1y"?365:365*5,Wt=qe-ot*864e5;return ne.filter(un=>Number(un==null?void 0:un.timestamp)>=Wt)}const Yd=At(()=>Vc(i(Cc),i(tu))),Md=At(()=>Vc(i(Gd),i(tu))),Au=At(()=>i(Yd).map(ne=>({index:Number(ne.index),ts:Number(ne.timestamp),equity:Number(ne.equity)})).filter(ne=>Number.isFinite(ne.index)&&Number.isFinite(ne.ts)&&Number.isFinite(ne.equity))),Kd=At(()=>i(Md).map(ne=>({index:Number(ne.index),ts:Number(ne.timestamp),equity:Number(ne.equity)})).filter(ne=>Number.isFinite(ne.index)&&Number.isFinite(ne.ts)&&Number.isFinite(ne.equity))),Hu=At(()=>{if(!i(Au).length)return[];let ne=-1/0;return i(Au).map(fe=>{ne=Math.max(ne,fe.equity);const qe=ne>0?(fe.equity-ne)/ne*100:0;return{index:fe.index,ts:fe.ts,ddPct:qe}})}),Tu=At(()=>{if(!i(Au).length)return null;const ne=i(Au)[0].equity,fe=i(Au)[i(Au).length-1].equity;let qe=1/0,ot=-1/0;for(const un of i(Au))un.equity<qe&&(qe=un.equity),un.equity>ot&&(ot=un.equity);const Wt=fe-ne,Ct=ne!==0?Wt/ne*100:0;return{first:ne,last:fe,net:Wt,retPct:Ct,min:qe,max:ot}}),bd=At(()=>{if(!i(Hu).length)return null;let ne=0,fe=0;for(const Wt of i(Hu)){const Ct=Number(Wt.ddPct)||0;Ct<ne&&(ne=Ct),fe+=Ct}const qe=fe/i(Hu).length,ot=i(Hu)[i(Hu).length-1].ddPct??0;return{worstAbs:Math.abs(ne),avgAbs:Math.abs(qe),lastAbs:Math.abs(ot)}}),gc=At(()=>{if(!i(oe)||!i(Au).length)return null;const ne=i(Au)[i(Au).length-1],fe=i(oe).maxY-i(oe).minY;return!Number.isFinite(fe)||fe===0?null:{x:100,y:(1-(ne.equity-i(oe).minY)/fe)*100,value:ne.equity}}),qu=At(()=>{if(!i(K)||!i(Hu).length)return null;const ne=i(Hu)[i(Hu).length-1],fe=i(K).maxY-i(K).minY;return!Number.isFinite(fe)||fe===0?null:{x:100,y:(1-(ne.ddPct-i(K).minY)/fe)*100,value:ne.ddPct}});function $d(ne,fe){const qe=ne.filter(_i=>Number.isFinite(_i));if(!qe.length)return null;const ot=typeof fe=="number"&&Number.isFinite(fe)?fe:Math.min(...qe);let Wt=Math.min(...qe,ot),Ct=Math.max(...qe,ot);if(!Number.isFinite(Wt)||!Number.isFinite(Ct))return null;Wt===Ct&&(Wt-=1,Ct+=1);const un=qe.length,Ln=_i=>un<=1?0:_i/(un-1)*100,Un=_i=>(1-(_i-Wt)/(Ct-Wt))*100,Ws=Un(ot),bo=qe.map((_i,to)=>({x:Ln(to),y:Un(_i)})),Ts=bo.map((_i,to)=>`${to===0?"M":"L"} ${_i.x.toFixed(3)} ${_i.y.toFixed(3)}`).join(" "),Oo=[`M ${bo[0].x.toFixed(3)} ${Ws.toFixed(3)}`,...bo.map(_i=>`L ${_i.x.toFixed(3)} ${_i.y.toFixed(3)}`),`L ${bo[bo.length-1].x.toFixed(3)} ${Ws.toFixed(3)}`,"Z"].join(" ");return{line:Ts,area:Oo,minY:Wt,maxY:Ct,baselineY:Ws}}function np(ne,fe){const qe=ne.filter(Ln=>Number.isFinite(Ln));if(!qe.length||fe<=0)return[];let ot=Math.min(...qe),Wt=Math.max(...qe);if(ot===Wt)return[{label:`${zs(ot,2)}`,count:qe.length,min:ot,max:Wt}];const Ct=(Wt-ot)/fe,un=[];for(let Ln=0;Ln<fe;(Ln+=1)-1){const Un=ot+Ct*Ln,Ws=Ln===fe-1?Wt:ot+Ct*(Ln+1);un.push({label:`${zs(Un,2)}–${zs(Ws,2)}`,count:0,min:Un,max:Ws})}for(const Ln of qe){const Un=Math.min(un.length-1,Math.floor((Ln-ot)/Ct));un[Un].count+=1}return un}function Pf(ne){let fe=0;for(const qe of ne)qe.count>fe&&(fe=qe.count);return fe||1}const oe=At(()=>$d(i(Au).map(ne=>ne.equity))),we=At(()=>$d(i(Kd).map(ne=>ne.equity))),K=At(()=>$d(i(Hu).map(ne=>ne.ddPct),0));function re(ne){const fe=new Date(ne),qe=fe.getUTCFullYear(),ot=String(fe.getUTCMonth()+1).padStart(2,"0");return`${qe}-${ot}`}function ke(ne){const fe=new Date(ne),qe=new Date(Date.UTC(fe.getUTCFullYear(),fe.getUTCMonth(),fe.getUTCDate())),ot=qe.getUTCDay()||7;qe.setUTCDate(qe.getUTCDate()+4-ot);const Wt=new Date(Date.UTC(qe.getUTCFullYear(),0,1)),Ct=Math.ceil(((qe-Wt)/864e5+1)/7);return`${qe.getUTCFullYear()}-W${String(Ct).padStart(2,"0")}`}function ee(ne,fe){if(!(ne!=null&&ne.length))return[];const qe=fe==="month"?re:ke,ot=new Map;for(const Ln of ne){const Un=Number(Ln==null?void 0:Ln.timestamp),Ws=Number(Ln==null?void 0:Ln.equity),bo=Number(Ln==null?void 0:Ln.index);if(!Number.isFinite(Un)||!Number.isFinite(Ws)||!Number.isFinite(bo))continue;const Ts=qe(Un),Oo=ot.get(Ts);Oo?Oo.last={ts:Un,eq:Ws,idx:bo}:ot.set(Ts,{first:{ts:Un,eq:Ws,idx:bo},last:{ts:Un,eq:Ws,idx:bo}})}const Wt=Array.from(ot.keys()).sort(),Ct=[];let un=null;for(const Ln of Wt){const Un=ot.get(Ln),Ws=Number(Un.last.eq);if(!Number.isFinite(Ws))continue;if(un==null){un=Ws;continue}const bo=un!==0?(Ws-un)/un*100:0;Ct.push({key:Ln,retPct:bo,from:un,to:Ws,toIndex:Number(Un.last.idx),toTs:Number(Un.last.ts)}),un=Ws}return Ct}const Ee=At(()=>ee(i(Cc),"month")),ht=At(()=>ee(i(Cc),"week")),pt=At(()=>{const ne=new Map;for(const fe of i(Wa)){const qe=Number(fe==null?void 0:fe.exitTimestamp);if(!Number.isFinite(qe)||qe<=0)continue;const ot=re(qe),Wt=ne.get(ot)||{trades:0,wins:0,losses:0,net:0,fees:0},Ct=Number(fe==null?void 0:fe.netPnl)||0;Wt.trades+=1,Wt.net+=Ct,Wt.fees+=Number(fe==null?void 0:fe.fees)||0,Ct>0?Wt.wins+=1:Ct<0&&(Wt.losses+=1),ne.set(ot,Wt)}return ne}),Nt=At(()=>{const ne=new Map;for(const fe of i(Wa)){const qe=Number(fe==null?void 0:fe.exitTimestamp);if(!Number.isFinite(qe)||qe<=0)continue;const ot=ke(qe),Wt=ne.get(ot)||{trades:0,wins:0,losses:0,net:0,fees:0},Ct=Number(fe==null?void 0:fe.netPnl)||0;Wt.trades+=1,Wt.net+=Ct,Wt.fees+=Number(fe==null?void 0:fe.fees)||0,Ct>0?Wt.wins+=1:Ct<0&&(Wt.losses+=1),ne.set(ot,Wt)}return ne});function E(ne){const fe=qe=>{const ot=qe==null?"":String(qe);return/[",\n]/.test(ot)?`"${ot.replace(/"/g,'""')}"`:ot};return ne.map(fe).join(",")}function I(ne,fe,qe){try{const ot=new Blob([fe],{type:qe}),Wt=URL.createObjectURL(ot),Ct=document.createElement("a");Ct.href=Wt,Ct.download=ne,document.body.appendChild(Ct),Ct.click(),Ct.remove(),setTimeout(()=>URL.revokeObjectURL(Wt),2500)}catch{}}const W=190,Z=86,_e=10;let me=xe(null),Le=xe(null);const ye=At(()=>{try{const ne=JSON.parse(String(t()||"").trim());return!!(ne!=null&&ne.pane||ne!=null&&ne.panes||ne!=null&&ne.main||ne!=null&&ne.sub)}catch{return!1}});wr(()=>{i(Au),i(Hu),i(Ce),i(Ce)});function Se(ne){var to;if(!i(Au).length)return;const qe=ne.currentTarget.getBoundingClientRect(),ot=Math.max(0,Math.min(W,qe.width-_e*2)),Wt=Math.max(0,Math.min(Z,qe.height-_e*2)),Ct=Math.max(0,Math.min(qe.width,ne.clientX-qe.left)),un=Math.max(0,Math.min(qe.height,ne.clientY-qe.top)),Ln=Math.round(Ct/Math.max(1,qe.width)*(i(Au).length-1)),Un=i(Au)[Ln];if(!Un)return;const Ws=((to=i(Au)[0])==null?void 0:to.equity)??Un.equity,bo=Un.equity-Ws,Ts=Ws!==0?bo/Ws*100:0;let Oo=Ct+12;Oo+ot+_e>qe.width&&(Oo=Ct-12-ot),Oo=Math.max(_e,Math.min(Oo,qe.width-ot-_e));let _i=un-12-Wt;_i<_e&&(_i=un+12),_i=Math.max(_e,Math.min(_i,qe.height-Wt-_e)),x(me,V({x:Ct,y:un,left:Oo,top:_i,ts:Un.ts,equity:Un.equity,net:bo,retPct:Ts}))}function Ge(ne){var Oo;if(!i(Hu).length)return;const qe=ne.currentTarget.getBoundingClientRect(),ot=Math.max(0,Math.min(W,qe.width-_e*2)),Wt=Math.max(0,Math.min(Z,qe.height-_e*2)),Ct=Math.max(0,Math.min(qe.width,ne.clientX-qe.left)),un=Math.max(0,Math.min(qe.height,ne.clientY-qe.top)),Ln=Math.round(Ct/Math.max(1,qe.width)*(i(Hu).length-1)),Un=i(Hu)[Ln];if(!Un)return;const Ws=(Oo=i(Au)[Ln])==null?void 0:Oo.equity;let bo=Ct+12;bo+ot+_e>qe.width&&(bo=Ct-12-ot),bo=Math.max(_e,Math.min(bo,qe.width-ot-_e));let Ts=un-12-Wt;Ts<_e&&(Ts=un+12),Ts=Math.max(_e,Math.min(Ts,qe.height-Wt-_e)),x(Le,V({x:Ct,y:un,left:bo,top:Ts,ts:Un.ts,ddPct:Un.ddPct,equity:Number.isFinite(Ws)?Ws:null}))}const Ae=At(()=>{const ne=String(t()||"");if(!ne)return 1;let fe=1;for(let qe=0;qe<ne.length;(qe+=1)-1)ne.charCodeAt(qe)===10&&(fe+=1);return fe}),Rt=At(()=>i(An)==="failed"?String(t()||"").split(`
`):[]);function nn(ne,fe){let qe=1,ot=1;for(let Wt=0;Wt<fe&&Wt<ne.length;Wt+=1)ne[Wt]===`
`?(qe+=1,ot=1):ot+=1;return{line:qe,col:ot}}const Xn=ne=>{const fe=String(ne||""),qe=[[/JS guardrail: loop iteration limit exceeded/i,"Reduce loop size or add a break/guard condition."],[/JS guardrail: time budget exceeded/i,"Reduce per-bar work or heavy calculations; optimize loops."],[/JS guardrail: call depth exceeded/i,"Avoid deep recursion or excessive nested calls."],[/ctx\.hist offset must be a non-negative integer/i,"Use integer offsets only: ctx.hist(series, 0/1/2/...)."],[/strategy\.[^\s]+ is not available in JS/i,"Use documented strategy accessors (snake_case or camelCase)."],[/JS guardrail: max series points exceeded/i,"Reduce loaded bars or increase the guardrail limit."],[/JS guardrail: draw op limit exceeded/i,"Reduce draw calls or gate them with conditions."],[/JS guardrail: total runtime exceeded/i,"Reduce the number of bars or simplify per-bar work."],[/JS engine: no bars available/i,"Load chart data or switch to a symbol/timeframe with candles."]];for(const[ot,Wt]of qe)if(ot.test(fe))return Wt};function hn(ne){try{return{ok:!0,value:JSON.parse(ne)}}catch(fe){const qe=String((fe==null?void 0:fe.message)||"Invalid JSON"),ot=qe.match(/position\s+(\d+)/i),Wt=ot?Number(ot[1]):null,Ct=typeof Wt=="number"&&Number.isFinite(Wt)?nn(ne,Wt):void 0;return{ok:!1,error:{level:"error",message:qe,hint:"Fix JSON syntax (quotes/commas/braces).",line:Ct==null?void 0:Ct.line,col:Ct==null?void 0:Ct.col}}}}const is=ne=>{let fe="",qe=null;for(let ot=0;ot<ne.length;(ot+=1)-1){const Wt=ne[ot],Ct=ne[ot+1];if(qe){fe+=Wt,Wt===qe&&ne[ot-1]!=="\\"&&(qe=null);continue}if(Wt==="'"||Wt==='"'){qe=Wt,fe+=Wt;continue}if(Wt==="/"&&Ct==="/")break;fe+=Wt}return fe},Gs=ne=>{let fe="",qe=null;for(let ot=0;ot<ne.length;(ot+=1)-1){const Wt=ne[ot];if(qe){fe+=" ",Wt===qe&&ne[ot-1]!=="\\"&&(qe=null);continue}if(Wt==="'"||Wt==='"'){qe=Wt,fe+=" ";continue}fe+=Wt}return fe},es=ne=>{const fe=String(ne||"").split(/\r?\n/),qe=/[A-Za-z_$][A-Za-z0-9_$]*\s*\[\s*-\s*\d+\s*\]/;for(let ot=0;ot<fe.length;(ot+=1)-1){const Wt=is(fe[ot]||""),Ct=Gs(Wt),un=qe.exec(Ct);if(un)return{line:ot+1,col:un.index+1,snippet:un[0].trim()}}return null},Mi=ne=>{const fe=String(ne||""),qe=[];let ot="",Wt=0,Ct=null,un=!1;for(let Ln=0;Ln<fe.length;(Ln+=1)-1){const Un=fe[Ln];if(Ct){if(ot+=Un,un){un=!1;continue}if(Un==="\\"){un=!0;continue}Un===Ct&&(Ct=null);continue}if(Un==="'"||Un==='"'){Ct=Un,ot+=Un;continue}if(Un==="("){Wt+=1,ot+=Un;continue}if(Un===")"&&Wt>0){Wt-=1,ot+=Un;continue}if(Un===","&&Wt===0){ot.trim()&&qe.push(ot.trim()),ot="";continue}ot+=Un}return ot.trim()&&qe.push(ot.trim()),qe},Kn=ne=>{const fe=String(ne||"").split(/\r?\n/),qe={},ot=Ct=>Ct.trim().toLowerCase(),Wt=Ct=>{const un=String(Ct||"").trim();if(!/^[-+]?\d+(?:\.\d+)?$/.test(un))return null;const Ln=Number(un);return Number.isFinite(Ln)?Math.max(0,Math.floor(Ln)):null};for(let Ct=0;Ct<fe.length;(Ct+=1)-1){const un=is(fe[Ct]||""),Ln=un.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(?:float|int|bool|string)\s*\(([^)]*)\)/i);if(Ln){const Ws=Mi(Ln[2]||""),bo=Wt(Ws[0]||"");bo!=null&&(qe[ot(Ln[1]||"")]=bo);continue}const Un=un.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\(([^)]*)\)/i);if(Un){const Ws=Mi(Un[2]||"");Ws.length&&(qe[ot(Un[1]||"")]=Ws.length)}}for(let Ct=0;Ct<fe.length;(Ct+=1)-1){const un=is(fe[Ct]||""),Ln=Gs(un),Un=Ln.match(/\barray\.set\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+(?:\.\d+)?)\b/i);if(Un){const bo=ot(Un[1]||""),Ts=Number(Un[2]),Oo=qe[bo],_i=Ln.indexOf(Un[0]||"")+1;if(Number.isFinite(Ts)&&!Number.isInteger(Ts))return{line:Ct+1,col:_i>0?_i:1,message:"array index must be an integer"};if(Number.isFinite(Ts)&&Ts<0)return{line:Ct+1,col:_i>0?_i:1,message:"Negative array index not allowed"};if(Number.isFinite(Ts)&&Oo!=null&&Ts>=Oo)return{line:Ct+1,col:_i>0?_i:1,message:"array.set index must be within array size"}}const Ws=Ln.match(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+(?:\.\d+)?)\b/i);if(Ws){const bo=Number(Ws[2]),Ts=Ln.indexOf(Ws[0]||"")+1;if(Number.isFinite(bo)&&!Number.isInteger(bo))return{line:Ct+1,col:Ts>0?Ts:1,message:"array index must be an integer"};if(Number.isFinite(bo)&&bo<0)return{line:Ct+1,col:Ts>0?Ts:1,message:"Negative array index not allowed"}}}return null},Es=ne=>{const fe=String(ne||"").trim();if(!fe)return"";const qe=fe[0];return(qe==='"'||qe==="'")&&fe.endsWith(qe)?fe.slice(1,-1):fe},Qo=ne=>{const fe=Es(ne).trim().toLowerCase();if(!fe)return null;const qe=fe.replace(/^shape\./,"").replace(/^label\./,"");return qe.includes("none")?"none":qe.includes("xcross")?"xcross":qe.includes("cross")?"cross":qe.includes("diamond")?"diamond":qe.includes("triangleup")?"triangle_up_filled":qe.includes("triangledown")?"triangle_down_filled":qe.includes("arrowup")?"arrowUp":qe.includes("arrowdown")?"arrowDown":qe.includes("circle")?"circle":qe.includes("square")?"square":qe.includes("flag")?"flag":qe.includes("tag")?"tag":qe.includes("pill")?"pill":qe.includes("label")?"label":null},sr=ne=>{const fe=Es(ne).trim().toLowerCase();if(!fe)return null;const qe=fe.replace(/^size\./,"");if(qe==="auto")return 14;if(qe==="tiny")return 10;if(qe==="small")return 12;if(qe==="normal")return 14;if(qe==="large")return 18;if(qe==="huge")return 22;const ot=Number(qe);return Number.isFinite(ot)?ot:null},na=ne=>{const fe=String(ne||"").trim().toLowerCase();return fe?fe.startsWith('"')||fe.startsWith("'")||fe.startsWith("shape.")||fe.startsWith("label.")?!0:["triangleup","triangledown","arrowup","arrowdown","circle","square","label","cross","xcross","diamond","flag","tag","pill","none"].includes(fe):!1},Xr=ne=>{const fe=String(ne||"").trim().toLowerCase();return fe?fe.startsWith('"')||fe.startsWith("'")?!0:fe.startsWith("location."):!1},Uu=ne=>{const fe=Es(ne).trim().toLowerCase();if(!fe)return null;const qe=fe.replace(/^location\./,"");return qe.includes("absolute")?"absolute":/(above|top|high)/.test(qe)?"above":/(below|bottom|low)/.test(qe)?"below":null},xd=ne=>{const fe=String(ne||"").trim().toLowerCase();return fe?fe.startsWith('"')||fe.startsWith("'")||fe.startsWith("size.")?!0:/^[-+]?\d+(?:\.\d+)?$/.test(fe):!1},ul=ne=>{const fe={};return ne.forEach(qe=>{const ot=qe.indexOf("=");if(ot<=0)return;const Wt=qe.slice(0,ot).trim().toLowerCase(),Ct=qe.slice(ot+1).trim();Wt&&(fe[Wt]=Ct)}),fe},dr=ne=>{const fe=String(ne||"").split(/\r?\n/);for(let qe=0;qe<fe.length;(qe+=1)-1){const ot=is(fe[qe]||""),Wt=ot.match(/^\s*(plotshape|plotchar)\s*\((.*)\)\s*$/i);if(!Wt)continue;const Ct=String(Wt[1]||"").toLowerCase(),un=Mi(Wt[2]||""),Ln=ul(un),Un=Ln.style??Ln.shape;if(Ct==="plotshape"&&Un&&na(Un)&&!Qo(Un)){const Oo=Math.max(1,ot.indexOf(Un)+1);return{line:qe+1,col:Oo,message:`plotshape style not supported: ${Un}`}}const Ws=Ln.location;if(Ws&&Xr(Ws)&&!Uu(Ws)){const Oo=Math.max(1,ot.indexOf(Ws)+1);return{line:qe+1,col:Oo,message:`${Ct} location not supported: ${Ws}`}}const bo=Ln.size;if(bo&&xd(bo)&&sr(bo)==null){const Oo=Math.max(1,ot.indexOf(bo)+1);return{line:qe+1,col:Oo,message:`${Ct} size not supported: ${bo}`}}}return null},Fu=ne=>{const fe=String(ne||"").trim();if(!fe)return!1;const qe=fe[0];if(qe!=='"'&&qe!=="'")return!1;let ot=1,Wt=!1;for(;ot<fe.length;(ot+=1)-1){const Ct=fe[ot];if(Wt){Wt=!1;continue}if(Ct==="\\"){Wt=!0;continue}if(Ct===qe){ot+=1;break}}return ot<=1?!1:fe.slice(ot).trim().length===0},gi=ne=>{const fe=String(ne||"").split(/\r?\n/);for(let qe=0;qe<fe.length;(qe+=1)-1){const ot=fe[qe]||"";let Wt=null,Ct=0,un=-1,Ln=-1;for(let Un=0;Un<ot.length;(Un+=1)-1){const Ws=ot[Un],bo=ot[Un+1];if(Wt){Ws===Wt&&ot[Un-1]!=="\\"&&(Wt=null);continue}if(Ws==="'"||Ws==='"'){Wt=Ws;continue}if(Ws==="/"&&bo==="/")break;if(Ws==="?"){Ct===0&&(un=Un),Ct+=1;continue}if(Ws===":"&&Ct>0&&(Ct-=1,Ct===0)){Ln=Un;break}}if(un>=0&&Ln>un){const Un=ot.slice(un+1,Ln),Ws=ot.slice(Ln+1),bo=Fu(Un),Ts=Fu(Ws);if(bo!==Ts)return{line:qe+1,col:un+1,snippet:ot.slice(un).trim()}}}return null};function Dr(){var Ln,Un,Ws,bo;const ne=[],fe=String(t()||""),qe=fe.trim();if(!qe)return ne;const ot=Ts=>{const Oo=new Set;Ts.forEach(to=>{const Ha=`${to.level}:${String(to.message||"").trim()}`;Ha.trim()!==`${to.level}:`&&Oo.add(Ha)});const _i=String(r()||"").trim();if(_i){const to=`error:${_i}`;Oo.has(to)||(Ts.unshift({level:"error",message:_i,hint:(i(Pi)==="js"?Xn(_i):void 0)||"See the console for details if needed."}),Oo.add(to))}return Array.isArray(a())&&a().forEach(to=>{if(to&&typeof to=="object"){const dl=to.level==="error"||to.level==="warning"?to.level:"warning",yl=String(to.message||"").trim();if(!yl)return;const Ml=`${dl}:${yl}`;if(Oo.has(Ml))return;Oo.add(Ml),Ts.push({level:dl,message:yl,hint:to.hint?String(to.hint):void 0,line:typeof to.line=="number"?to.line:void 0,col:typeof to.col=="number"?to.col:void 0});return}const Ha=String(to||"").trim();if(!Ha)return;const Ta=`warning:${Ha}`;Oo.has(Ta)||(Oo.add(Ta),Ts.push({level:"warning",message:Ha}))}),Ts},Wt=i(Pi);if(Wt==="pine"||Wt==="auto"&&To(fe)){try{const Ts=i(vi)===fe?i($r):null;if(Ts&&Ts.ok===!1&&Array.isArray(Ts.errors)&&Ts.errors.length)return Ts.errors.slice(0,12).forEach(Oo=>{ne.push({level:"error",message:String((Oo==null?void 0:Oo.message)||"Pine error"),hint:"Fix the Pine line or use the Guide examples.",line:typeof(Oo==null?void 0:Oo.line)=="number"?Oo.line:void 0,col:1})}),ot(ne);if(Ts&&Ts.ok){const Oo=es(qe);if(Oo)return ne.push({level:"error",message:`Negative history index not allowed: ${Oo.snippet}`,hint:"Use x[0], x[1], x[2] (negative indices are invalid).",line:Oo.line,col:Oo.col}),ot(ne);const _i=(Ts.warnings||[]).find(yl=>String((yl==null?void 0:yl.message)||"").includes('":=" used before'));if(_i)return ne.push({level:"error",message:String(_i.message||'":=" used before declaration'),hint:"Declare with var or use '=' for first assignment.",line:typeof _i.line=="number"?_i.line:void 0,col:1}),ot(ne);const to=gi(qe);if(to)return ne.push({level:"error",message:"Ternary branches must both be numeric or both non-numeric",hint:"Use numeric values on both branches or non-numeric values on both branches.",line:to.line,col:to.col}),ot(ne);const Ha=Kn(qe);if(Ha)return ne.push({level:"error",message:Ha.message,hint:"Use a valid non-negative index within the array size.",line:Ha.line,col:Ha.col}),ot(ne);const Ta=dr(qe);if(Ta)return ne.push({level:"error",message:Ta.message,hint:"Use a supported plotshape/plotchar option value.",line:Ta.line,col:Ta.col}),ot(ne);const dl=q_(Ts.spec);dl.ok||(dl.errors||[]).forEach(yl=>ne.push({level:"error",message:yl,hint:Qi(yl)}))}}catch{}return ot(ne)}if(Wt==="js"||Wt==="dsl"||Wt==="auto"&&!Wo(qe))return ot(ne);const un=hn(qe);if(!un.ok)return ne.push(un.error),ot(ne);try{const Ts=un.value;if(Ts&&(Ts.plots||Ts.calc||Ts.panes||Ts.main||Ts.sub)){const Oo=Ts&&typeof Ts=="object"?Ts.params||{}:{},_i=Mw(Ts,Oo);let to=_i;try{to=Aw(_i)}catch(vo){return ne.push({level:"error",message:`Template expansion error: ${String((vo==null?void 0:vo.message)||vo)}`,hint:"Check repeat/forEach blocks and loop sizes."}),ot(ne)}const Ha=q_(to);Ha.ok||(Ha.errors||[]).forEach(vo=>ne.push({level:"error",message:vo,hint:Qi(vo)}));const Ta=to.pane||to.plots||to.labels||to.levels||to.lines?{pane:to.pane||"main",plots:to.plots||[],labels:to.labels||[],levels:to.levels||[],lines:to.lines||[],min:to.min,max:to.max}:null,dl=[].concat(Ta?[Ta]:[]).concat(to.panes||[]).concat(to.main?[to.main]:[]).concat(to.sub?[to.sub]:[]),yl=Array.isArray(to.calc)?to.calc:[],Ml=Array.isArray(to.series)?to.series:[],Gl=Array.isArray((Ln=Ha.spec)==null?void 0:Ln.series)?(Un=Ha.spec)==null?void 0:Un.series:[],wd=Array.isArray((Ws=Ha.spec)==null?void 0:Ws.stateSeries)?(bo=Ha.spec)==null?void 0:bo.stateSeries:[],fc=new Set(["open","high","low","close","volume","time","bar_index"]);Ml.forEach(vo=>{const go=String((vo==null?void 0:vo.name)||"").replace(/\s+/g,"_").toLowerCase();go&&fc.add(go)}),Gl.forEach(vo=>{const go=String((vo==null?void 0:vo.name)||"").replace(/\s+/g,"_").toLowerCase();go&&fc.add(go)}),wd.forEach(vo=>{const go=String((vo==null?void 0:vo.name)||"").replace(/\s+/g,"_").toLowerCase();go&&fc.add(go)}),yl.forEach(vo=>{const go=String((vo==null?void 0:vo.type)||(vo==null?void 0:vo.name)||"").toLowerCase(),yi=String((vo==null?void 0:vo.name)||(vo==null?void 0:vo.type)||"").replace(/\s+/g,"_").toLowerCase();if(Cw.includes(go)||go&&ne.push({level:"error",message:`Unsupported calc type "${vo==null?void 0:vo.type}"`,hint:`Use one of: ${Array.from(Cw).join(", ")}`}),go==="ema"){const Jr=vo==null?void 0:vo.period;(typeof Jr!="number"||!(Jr>0))&&ne.push({level:"error",message:"EMA requires numeric period > 0",hint:'Add "period": e.g., 20'})}if(go==="macd"){const Jr=Yl=>typeof Yl=="number"&&Yl>0;(!Jr(vo==null?void 0:vo.fast)||!Jr(vo==null?void 0:vo.slow)||!Jr(vo==null?void 0:vo.signal))&&ne.push({level:"error",message:"MACD requires numeric fast/slow/signal",hint:'Add "fast":12, "slow":26, "signal":9'})}if(go==="stoch"){const Jr=Yl=>typeof Yl=="number"&&Yl>0;(!Jr(vo==null?void 0:vo.kPeriod)||!Jr(vo==null?void 0:vo.dPeriod))&&ne.push({level:"error",message:"Stochastic requires kPeriod and dPeriod",hint:'Add "kPeriod":14, "dPeriod":3'})}yi&&(go==="bbands"||go==="bollinger"||go==="bollinger_bands"||go==="kc"||go==="keltner"||go==="donchian"||go==="linreg_channel"?(fc.add(`${yi}_mid`),fc.add(`${yi}_upper`),fc.add(`${yi}_lower`)):go==="atr_bands"?(fc.add(`${yi}_upper`),fc.add(`${yi}_lower`)):go==="macd"?(fc.add("macd_line"),fc.add("macd_signal"),fc.add("macd_hist")):go==="stoch"?(fc.add(`${yi}_k`),fc.add(`${yi}_d`)):go==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"].forEach(Jr=>fc.add(Jr)):fc.add(yi))}),dl.forEach((vo,go)=>{(vo.plots||[]).forEach((yi,Jr)=>{const Yl=String((yi==null?void 0:yi.type)||"line").toLowerCase();Iw.includes(Yl)||ne.push({level:"warning",message:`Pane[${go}] plot[${Jr}] unsupported type "${yi==null?void 0:yi.type}"`,hint:`Supported: ${Array.from(Iw).join(", ")}`});const Eu=String((yi==null?void 0:yi.source)||"").replace(/\s+/g,"_").toLowerCase();Eu&&!fc.has(Eu)&&ne.push({level:"error",message:`Pane[${go}] plot[${Jr}] source "${yi==null?void 0:yi.source}" not defined`,hint:"Define it in calc/series or use a valid alias."})}),(vo.labels||[]).forEach((yi,Jr)=>{const Yl=String((yi==null?void 0:yi.shape)||"label");Yl&&!Pw.includes(Yl)&&ne.push({level:"warning",message:`Pane[${go}] label[${Jr}] unsupported shape "${Yl}"`,hint:`Supported: ${Array.from(Pw).join(", ")}`}),yi!=null&&yi.shape||ne.push({level:"warning",message:`Pane[${go}] label[${Jr}] no shape set (default: label)`,hint:'Set "shape": triangle_up_filled, triangle_down_filled, label, pill, tag, flag'});const Eu=String((yi==null?void 0:yi.source)||"").replace(/\s+/g,"_").toLowerCase();Eu&&!["open","high","low","close","volume"].includes(Eu)&&!fc.has(Eu)&&ne.push({level:"error",message:`Pane[${go}] label[${Jr}] source "${yi==null?void 0:yi.source}" not defined`,hint:"Use high/low/open/close or a defined series"}),String((vo==null?void 0:vo.pane)||"main").toLowerCase()==="sub"&&(Eu==="high"||Eu==="low")&&ne.push({level:"warning",message:`Pane[${go}] label[${Jr}] anchors to price in sub pane`,hint:"Move label to main pane for price anchors"});const nd=String((yi==null?void 0:yi.whenExpr)||""),dp=String((yi==null?void 0:yi.when)||"");if(nd.trim())try{const Ic=Ap(Je(nd));Be(Ic).forEach(nu=>{const zi=nu.replace(/\s+/g,"_").toLowerCase();!fc.has(zi)&&!["open","high","low","close","volume"].includes(zi)&&ne.push({level:"warning",message:`Label[${go}:${Jr}] references unknown series "${nu}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(Ic){const zp=(Ic==null?void 0:Ic.position)!=null?` at ${Ic.position}`:"",nu=Ic instanceof Qv?Ic.message:String(Ic),zi=typeof(Ic==null?void 0:Ic.position)=="number"?nn(qe,Ic.position):void 0;ne.push({level:"error",message:`Label[${go}:${Jr}] Pine expression parse failed${zp}: ${nu}`,hint:"Use parentheses to disambiguate comparisons; split chained comparisons with and/or.",line:zi==null?void 0:zi.line,col:zi==null?void 0:zi.col})}else if(dp.trim())try{const Ic=Ap(Je(dp));Be(Ic).forEach(nu=>{const zi=nu.replace(/\s+/g,"_").toLowerCase();!fc.has(zi)&&!["open","high","low","close","volume"].includes(zi)&&ne.push({level:"warning",message:`Label[${go}:${Jr}] references unknown series "${nu}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(Ic){const zp=(Ic==null?void 0:Ic.position)!=null?` at ${Ic.position}`:"",nu=Ic instanceof Qv?Ic.message:String(Ic),zi=typeof(Ic==null?void 0:Ic.position)=="number"?nn(qe,Ic.position):void 0;ne.push({level:"error",message:`Label[${go}:${Jr}] condition parse failed${zp}: ${nu}`,hint:"Use parentheses to disambiguate comparisons; split chained comparisons with and/or.",line:zi==null?void 0:zi.line,col:zi==null?void 0:zi.col})}})});const md=new Set;dl.forEach(vo=>{(vo.plots||[]).forEach(go=>{const yi=String((go==null?void 0:go.source)||"").replace(/\s+/g,"_").toLowerCase();yi&&md.add(yi)}),(vo.labels||[]).forEach(go=>{const yi=String((go==null?void 0:go.source)||"").replace(/\s+/g,"_").toLowerCase();yi&&md.add(yi);const Jr=String((go==null?void 0:go.whenExpr)||""),Yl=String((go==null?void 0:go.when)||"");try{if(Jr.trim()){const Eu=Ap(Je(Jr));Be(Eu).forEach(dp=>md.add(dp.replace(/\s+/g,"_").toLowerCase()))}else if(Yl.trim()){const Eu=Ap(Je(Yl));Be(Eu).forEach(dp=>md.add(dp.replace(/\s+/g,"_").toLowerCase()))}}catch{}}),(vo.lines||[]).forEach(go=>{const yi=String((go==null?void 0:go.segmentsFrom)||"").replace(/\s+/g,"_").toLowerCase();yi&&md.add(yi);const Jr=String((go==null?void 0:go.start)||"").replace(/\s+/g,"_").toLowerCase();Jr&&md.add(Jr);const Yl=String((go==null?void 0:go.end)||"").replace(/\s+/g,"_").toLowerCase();Yl&&md.add(Yl)})}),(Array.isArray(Ts.signals)?Ts.signals:[]).forEach(vo=>{const go=String((vo==null?void 0:vo.whenExpr)||""),yi=String((vo==null?void 0:vo.when)||"");try{if(go.trim()){const Jr=Ap(Je(go));Be(Jr).forEach(Eu=>md.add(Eu.replace(/\s+/g,"_").toLowerCase()))}else if(yi.trim()){const Jr=Ap(Je(yi));Be(Jr).forEach(Eu=>md.add(Eu.replace(/\s+/g,"_").toLowerCase()))}}catch{}});const xu=Ml.map(vo=>String((vo==null?void 0:vo.expr)||"")).join(" ").replace(/\s+/g," ").toLowerCase(),Xd=(vo,go)=>{const yi=vo.toLowerCase(),Jr=go;return yi==="bbands"||yi==="bollinger"||yi==="bollinger_bands"||yi==="kc"||yi==="keltner"||yi==="donchian"||yi==="linreg_channel"?[`${Jr}_mid`,`${Jr}_upper`,`${Jr}_lower`]:yi==="atr_bands"?[`${Jr}_upper`,`${Jr}_lower`]:yi==="stoch"?[`${Jr}_k`,`${Jr}_d`]:yi==="macd"?["macd_line","macd_signal","macd_hist"]:yi==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[Jr]};return yl.forEach(vo=>{const go=String((vo==null?void 0:vo.name)||(vo==null?void 0:vo.type)||"").replace(/\s+/g,"_").toLowerCase();if(go&&!md.has(go)){const yi=String((vo==null?void 0:vo.type)||""),Jr=Xd(yi,go);if(!Jr.some(Eu=>md.has(Eu))){const Eu=xu&&new RegExp(`\\b${go.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test(xu),nd=xu&&Jr.some(dp=>new RegExp(`\\b${dp.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test(xu));if(Eu||nd)return;ne.push({level:"warning",message:`Calc "${yi}" (${go}) is defined but not used`,hint:"Reference it in plots or label conditions"})}}}),ot(ne)}}catch{ne.push({level:"warning",message:"Non‑JSON script detected",hint:"Use JSON spec or the DSL examples from Guide. If JSON, ensure valid commas/quotes/braces.",line:1,col:1})}return ot(ne)}let Yi=xe(V([]));wr(()=>{const ne=String(t()||"");r(),a(),i(Pi),i(vi),i($r);let fe=!1,qe=null;const ot=()=>{fe||ne===String(t()||"")&&x(Yi,V(Dr()))},Wt=setTimeout(()=>{const Ct=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Ct?qe=Ct(ot,{timeout:250}):ot()},140);return()=>{fe=!0,clearTimeout(Wt);const Ct=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Ct&&qe!=null&&Ct(qe)}});const Ki=At(()=>i(Yi).filter(ne=>ne.level==="error").length),Xi=At(()=>i(Yi).filter(ne=>ne.level==="warning").length),ca=At(()=>i(Yi).length),Jt=At(()=>i(Ki)>0?"Errors":i(Xi)>0?"Warnings":"Issues"),rn=At(()=>r()?`Error: ${r()}`:f()?"Running…":o()?o():"Ready"),dn=At(()=>{const ne=String(t()||"");if(!/security_lower_tf/i.test(ne))return null;const fe=String(r()||""),qe=String(o()||"");return fe&&/(lower_tf|lower timeframe)/i.test(fe)?{kind:"error",label:"Lower TF",title:"Lower TF not available",lines:["Lower TF must be smaller than the chart timeframe.","Switch chart timeframe higher or lower the requested TF.","Lower TF needs server data; wait if loading."]}:fe&&/request\.security/i.test(fe)?{kind:"warning",label:"Lower TF",title:"Lower TF data not ready",lines:["Lower TF data may be missing for this range.","Zoom to recent data or wait for fetch to finish."]}:/loading request\.security/i.test(qe)?{kind:"info",label:"Lower TF",title:"Lower TF data loading",lines:["Lower TF candles are loading from the server.","The chart will refresh when data arrives."]}:null}),uo=At(()=>{const ne=typeof i(dn)=="function"?i(dn)():i(dn);if(!ne)return"";const fe=ne.title||"Lower TF",qe=Array.isArray(ne.lines)?ne.lines:[];return[fe,...qe].join(`
`)}),zs=(ne,fe=2)=>Number.isFinite(ne)?ne.toFixed(fe):"—",Hr=(ne,fe=2,qe=8)=>{if(!Number.isFinite(ne))return"—";const ot=Math.abs(ne);if(ot===0||ot>=1)return ne.toFixed(fe);const Wt=Math.ceil(-Math.log10(ot)),Ct=Math.max(fe,Math.min(qe,fe+Wt));return ne.toFixed(Ct)},Ul=ne=>Hr(ne,2,6),Oi=ne=>Hr(ne,2,10),Nd=ne=>Hr(ne,6,10),hr=(ne,fe=2)=>{const qe=typeof ne=="number"?ne:Number(ne);return Number.isFinite(qe)?zs(qe,fe):"—"},vr=ne=>{const fe=typeof ne=="number"?ne:Number(ne);return Number.isFinite(fe)?Ul(fe):"—"},_l=ne=>{const fe=typeof ne=="number"?ne:Number(ne);return Number.isFinite(fe)?Oi(fe):"—"},ia=ne=>{const fe=typeof ne=="number"?ne:Number(ne);return Number.isFinite(fe)?Nd(fe):"—"},Zl=ne=>{const fe=typeof ne=="number"?ne:Number(ne);return Number.isFinite(fe)?Bo(fe):"—"},Bo=ne=>`${zs(ne,2)}%`,Mf=ne=>ne===1/0?"∞":zs(ne,2),Yc=ne=>{const fe=String(ne||"").replace(/_/g," ").trim();return fe?fe.charAt(0).toUpperCase()+fe.slice(1):"—"},Lu=ne=>{const fe=String(ne||"").toLowerCase();return fe?fe==="stop_limit"?"Stop-limit":fe==="trailing_stop"?"Trailing stop":fe==="mit"?"MIT":fe==="lit"?"LIT":fe==="market"?"Market":fe==="limit"?"Limit":fe==="stop"?"Stop":Yc(fe):"—"},Ju=At(()=>i(Yi).filter(ne=>typeof ne.line=="number").map(ne=>({line:ne.line,col:ne.col,level:ne.level}))),Dd=At(()=>{if(i(An)!=="failed")return"";const ne=String(t()||"").split(`
`),fe=new Map;i(Ju).forEach(ot=>{fe.has(ot.line)||fe.set(ot.line,[]),fe.get(ot.line).push({col:ot.col,level:ot.level})});const qe=ot=>ot.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return ne.map((ot,Wt)=>{const Ct=Wt+1,un=fe.get(Ct)||[],Ln=un.some(Oo=>!Oo.col),Un=qe(ot||" ");if(Ln)return`<div class="code-line"><mark class="err err-${un[0].level}">${Un}</mark></div>`;if(!un.length)return`<div class="code-line"><span>${Un}</span></div>`;const Ws=un.filter(Oo=>typeof Oo.col=="number"&&Oo.col>0).sort((Oo,_i)=>Oo.col-_i.col);let bo="",Ts=0;return Ws.forEach((Oo,_i)=>{const to=Math.max(0,Oo.col-1);to>Ts&&(bo+=qe(ot.slice(Ts,to))),bo+=`<mark class="err err-${Oo.level}">${qe(ot.slice(to))||"&nbsp;"}</mark>`,Ts=ot.length}),Ts<ot.length&&(bo+=qe(ot.slice(Ts))),`<div class="code-line"><span>${bo||"&nbsp;"}</span></div>`}).join("")});let oc=xe(void 0),Rd=xe(void 0),Jl=xe(void 0),Yf=xe(void 0),An=xe("idle"),yt=null,Rn=null,_n=null,Vs=[],Ms=!1,$s=!1,wo=null,Zo=null,ao=0,Ho=xe("plaintext");const so=At(()=>i(An)==="ready"),Wi={indicator:"Creates an indicator script.",strategy:"Creates a strategy script with backtest settings.",library:"Marks this script as a reusable library.",import:"Import a local library by name.",plot:"Plot a series on chart.",plotcandle:"Plot custom candles from OHLC series.",plotbar:"Plot OHLC bars from series.",plotohlc:"Plot OHLC bars from series.",plotarrow:"Plot up/down arrows from a series.",plotfill:"Fill between two plots.",fill:"Fill between two series.",plotshape:"Plot a shape on chart.",plotchar:"Plot a character on chart.",hline:"Draw a horizontal line.",input:"Create a user input.","input.int":"Integer input.","input.float":"Float input.","input.bool":"Boolean input.","input.string":"String input.","request.security":"Fetch HTF/MTF series.","request.security_lower_tf":"Fetch lower timeframe series.","strategy.entry":"Place an entry order.","strategy.exit":"Place an exit order.","strategy.order":"Place a generic order.",alertcondition:"Emit an alert when condition is true.",barstate:"Bar state flags (islast, isnewbar, isrealtime).",timeframe:"Chart timeframe helpers.",syminfo:"Symbol metadata (ticker, type, etc.)."},_c={uri:"scriptstudio://schema/script.json",fileMatch:["*"],schema:{type:"object",description:"Script Studio JSON spec",properties:{pane:{type:"string",description:'Default pane ("main" or "sub")'},min:{type:"number"},max:{type:"number"},params:{type:"object",description:"Named params (input values)"},strategy:{type:"object",properties:{initialCapital:{type:"number"},orderSize:{type:"object"},commissionPct:{type:"number"},slippagePct:{type:"number"},execution:{type:"string"},allowShort:{type:"boolean"},pyramiding:{type:"number"}}},calc:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"},source:{type:"string"},period:{type:"number"},fast:{type:"number"},slow:{type:"number"},signal:{type:"number"},expr:{type:"string"},timeframe:{type:"string"},symbol:{type:"string"},country:{type:"string"},lookahead:{type:"string"},gaps:{type:"string"}}}},series:{type:"array",items:{type:"object",properties:{name:{type:"string"},expr:{type:"string"}}}},rules:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["series","state"]},name:{type:"string"},series:{type:"string"},state:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},then:{type:"string"},value:{type:"string"},expr:{type:"string"},else:{type:"string"},init:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},stateSeries:{type:"array",items:{type:"object",properties:{name:{type:"string"},initExpr:{type:"string"},updateExpr:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},plots:{type:"array",items:{type:"object",properties:{name:{type:"string"},source:{type:"string"},type:{type:"string"},color:{type:"string"},width:{type:"number"},style:{type:"string"},offset:{type:["number","string"]},showLast:{type:["number","string"]},open:{type:"string"},high:{type:"string"},low:{type:"string"},close:{type:"string"},downColor:{type:"string"},wickColor:{type:"string"},borderColor:{type:"string"}}}},labels:{type:"array",items:{type:"object",properties:{when:{type:"string"},whenExpr:{type:"string"},text:{type:"string"},textExpr:{type:"string"},shape:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},position:{type:"string"},source:{type:"string"},bgColor:{type:"string"},bgColorExpr:{type:"string"},borderColor:{type:"string"},borderColorExpr:{type:"string"},textColor:{type:"string"},textColorExpr:{type:"string"},size:{type:"number"},sizeExpr:{type:"string"},offsetY:{type:"number"},offsetYExpr:{type:"string"}}}},lines:{type:"array",items:{type:"object",properties:{name:{type:"string"},start:{type:"string"},end:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},width:{type:"number"},widthExpr:{type:"string"},sizeExpr:{type:"string"},style:{type:"string"},extend:{type:"string"},segmentsFrom:{type:"string"},maxSegments:{type:"number"}}}},signals:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},score:{type:"number",minimum:0,maximum:10,multipleOf:1},scoreExpr:{type:"string"},cooldownBars:{type:"number"},cooldownExpr:{type:"string"},order:{type:"object"}}}},panes:{type:"array",items:{type:"object",properties:{pane:{type:"string"},plots:{$ref:"#/properties/plots"},labels:{$ref:"#/properties/labels"},levels:{type:"array"},lines:{$ref:"#/properties/lines"},min:{type:"number"},max:{type:"number"}}}},main:{$ref:"#/properties/panes/items"},sub:{$ref:"#/properties/panes/items"}}}},gu=ne=>{const fe=(Wt,Ct,un)=>({label:Wt,kind:ne.languages.CompletionItemKind.Function,insertText:Wt,insertTextRules:void 0,detail:Ct}),qe=Wt=>({label:Wt,kind:ne.languages.CompletionItemKind.Keyword,insertText:Wt,detail:"keyword"}),ot=(Wt,Ct,un)=>({label:Wt,kind:ne.languages.CompletionItemKind.Snippet,insertText:Ct,insertTextRules:ne.languages.CompletionItemInsertTextRule.InsertAsSnippet,detail:un});return[qe("if"),qe("else"),qe("for"),qe("while"),qe("switch"),qe("break"),qe("continue"),qe("return"),qe("var"),qe("varip"),qe("export"),qe("import"),qe("library"),ot("indicator",'indicator("${1:Title}", overlay=${2:true})',"indicator(...)"),ot("strategy",'strategy(initial_capital=${1:10000}, execution="bar_close", allowShort=${2:false})',"strategy(...)"),ot("input.int",'input.int(${1:14}, title="${2:Length}")',"input.int(...)"),ot("input.float",'input.float(${1:14.0}, title="${2:Length}")',"input.float(...)"),ot("input.bool",'input.bool(${1:true}, title="${2:Enabled}")',"input.bool(...)"),ot("input.string",'input.string("${1:Value}", title="${2:Title}")',"input.string(...)"),fe("plot","plot(series)"),fe("plotcandle","plotcandle(open, high, low, close)"),fe("plotbar","plotbar(open, high, low, close)"),fe("plotohlc","plotohlc(open, high, low, close)"),fe("plotarrow","plotarrow(series)"),fe("plotfill","plotfill(plotA, plotB, color)"),fe("fill","fill(seriesA, seriesB, color)"),fe("plotshape","plotshape(condition)"),fe("plotchar","plotchar(condition)"),fe("hline","hline(price)"),fe("line.new","line.new(x1, y1, x2, y2)"),fe("label.new","label.new(x, y, text)"),fe("box.new","box.new(left, top, right, bottom)"),fe("table.new","table.new(position, columns, rows)"),fe("table.cell","table.cell(table_id, column, row, text)"),fe("table.clear","table.clear(table_id)"),fe("request.security","request.security(symbol, timeframe, expr)"),fe("request.security_lower_tf","request.security_lower_tf(symbol, timeframe, expr)"),fe("strategy.entry","strategy.entry(id, side)"),fe("strategy.exit","strategy.exit(id, side)"),fe("strategy.order","strategy.order(id, side)"),fe("strategy.cancel","strategy.cancel(id)"),fe("strategy.close","strategy.close(id)"),fe("alertcondition","alertcondition(condition, title, message)"),fe("ema","ema(source, length)"),fe("sma","sma(source, length)"),fe("rsi","rsi(source, length)"),fe("macd","macd(source, fast, slow, signal)"),fe("highest","highest(source, length)"),fe("lowest","lowest(source, length)"),fe("atr","atr(high, low, close, length)"),fe("stoch","stoch(high, low, close, kPeriod, dPeriod)"),fe("array.new_float","array.new_float(size, initial)"),fe("array.new_string","array.new_string(size, initial)"),fe("array.from","array.from(val1, val2, val3)"),fe("array.get","array.get(arr, index)"),fe("array.set","array.set(arr, index, value)"),fe("array.push","array.push(arr, value)"),fe("array.pop","array.pop(arr)"),fe("array.size","array.size(arr)")]},El=ne=>{ne.languages.getLanguages().some(fe=>fe.id==="pine")||(ne.languages.register({id:"pine"}),ne.languages.setLanguageConfiguration("pine",{comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}],surroundingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}]}),ne.languages.setMonarchTokensProvider("pine",{keywords:["if","else","for","while","switch","break","continue","return","var","varip","export","import","library","strategy","indicator","study"],types:["int","float","bool","string","line","label","box","table","linefill","color"],tokenizer:{root:[[/\/\/.*$/,"comment"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/\b(true|false|na)\b/,"constant"],[/\b\d+(\.\d+)?\b/,"number"],[/[{}()[\]]/,"@brackets"],[/[=><!~?:&|+\-*\/%^]/,"operator"],[/[A-Za-z_][A-Za-z0-9_]*/,{cases:{"@keywords":"keyword","@types":"type","@default":"identifier"}}]],string_double:[[/[^\\"]+/,"string"],[/\\./,"string.escape"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/\\./,"string.escape"],[/'/,"string","@pop"]]}}),ne.languages.registerCompletionItemProvider("pine",{triggerCharacters:[".","("],provideCompletionItems:(fe,qe)=>{const ot=fe.getWordUntilPosition(qe),Wt=new ne.Range(qe.lineNumber,ot.startColumn,qe.lineNumber,ot.endColumn);return{suggestions:gu(ne).map(un=>({...un,range:Wt}))}}}),ne.languages.registerHoverProvider("pine",{provideHover(fe,qe){const ot=fe.getWordAtPosition(qe);if(!ot)return null;const Wt=ot.word,Ct=Wi[Wt]||Wi[Wt.toLowerCase()];return Ct?{range:new ne.Range(qe.lineNumber,ot.startColumn,qe.lineNumber,ot.endColumn),contents:[{value:`**${Wt}**`},{value:Ct}]}:null}}))},fu=ne=>{var fe,qe;(qe=(fe=ne.languages)==null?void 0:fe.json)!=null&&qe.jsonDefaults&&ne.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[_c]})},Cr=ne=>{ne.editor.getTheme&&ne.editor._scriptStudioThemes||(ne.editor.defineTheme("scriptstudio-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#0b0a1a","editor.foreground":"#e2e8f0","editorLineNumber.foreground":"#475569","editorLineNumber.activeForeground":"#94a3b8","editor.selectionBackground":"#1f2a44","editor.inactiveSelectionBackground":"#1b2338","editorCursor.foreground":"#94a3b8"}}),ne.editor.defineTheme("scriptstudio-light",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#f8fafc","editor.foreground":"#0f172a","editorLineNumber.foreground":"#94a3b8","editorLineNumber.activeForeground":"#334155","editor.selectionBackground":"#dbeafe","editor.inactiveSelectionBackground":"#e2e8f0","editorCursor.foreground":"#1e293b"}}),ne.editor._scriptStudioThemes=!0)},ba=ne=>i(Pi)==="json"?"json":i(Pi)==="dsl"?"plaintext":i(Pi)==="pine"?"pine":i(Pi)==="js"?"javascript":/^\s*\/\/@\s*(?:pine|version)\b/m.test(ne)||/\b(strategy|indicator|library|plot)\s*\(/m.test(ne)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(ne)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(ne)?"pine":Wo(ne)?"json":"plaintext",Pl=()=>(document.documentElement.getAttribute("data-theme")||document.body.getAttribute("data-theme"))==="light"?"scriptstudio-light":"scriptstudio-dark",_u=()=>{if(!yt||!_n)return;const ne=[],fe=(qe,ot,Wt,Ct,un)=>{const Ln=Math.max(1,Math.min(_n.getLineCount(),Wt||1)),Un=Math.max(1,Ct||1),Ws=_n.getLineContent(Ln)||"",bo=Math.max(Un+1,Ws.length+1);ne.push({startLineNumber:Ln,startColumn:Un,endLineNumber:Ln,endColumn:bo,message:un?`${ot} • ${un}`:ot,severity:qe==="error"?yt.MarkerSeverity.Error:yt.MarkerSeverity.Warning})};i(Yi).forEach(qe=>fe(qe.level,qe.message,qe.line,qe.col,qe.hint)),i(Tl).forEach(qe=>fe("warning",qe.message,qe.line,1)),yt.editor.setModelMarkers(_n,"scriptstudio",ne)};function Zr(){var qe,ot;const ne=((qe=i(oc))==null?void 0:qe.scrollTop)??0,fe=((ot=i(oc))==null?void 0:ot.scrollLeft)??0;i(Rd)&&(i(Rd).scrollTop=ne,i(Rd).scrollLeft=fe),i(Jl)&&(i(Jl).scrollTop=ne)}function Qi(ne){const fe=ne.toLowerCase();return fe.includes("no panes defined")?'Add pane:"main" or {main:{...}} with plots/labels.':fe.includes("has no plots/labels/levels/lines")?"Add at least one plot or label in the pane.":fe.includes("series")?"Check series names and expressions; use normalized aliases like macd_line.":"Review field names/types; see Guide examples."}wr(()=>{if(!yt||!_n||!i(so)||Ms)return;s();const ne=String(t()||"");_n.getValue()!==ne&&($s=!0,_n.setValue(ne),$s=!1)}),wr(()=>{if(!yt||!Rn||!i(so)||s()<=0)return;const ne=String(t()||""),fe=ba(ne),qe=Rn.getModel();if(qe){_n=qe,qe.setValue(ne),i(Ho)!==fe&&(x(Ho,V(fe)),yt.editor.setModelLanguage(qe,fe));try{Rn.updateOptions({wordWrap:fe==="pine"?"off":"on"})}catch{}_u(),requestAnimationFrame(()=>Rn==null?void 0:Rn.layout())}}),wr(()=>{if(!yt||!_n||!i(so))return;const ne=ba(String(t()||""));if(ne!==i(Ho)){x(Ho,V(ne)),yt.editor.setModelLanguage(_n,ne);try{Rn==null||Rn.updateOptions({wordWrap:ne==="pine"?"off":"on"})}catch{}}}),wr(()=>{!yt||!_n||!i(so)||_u()}),wr(()=>{!Rn||!i(so)||i(Ce)==="editor"&&requestAnimationFrame(()=>Rn==null?void 0:Rn.layout())}),wr(()=>{!Rn||!i(so)||(i(ur).length,requestAnimationFrame(()=>Rn==null?void 0:Rn.layout()))}),a_();var os=Ise(),mo=y(os);mo.__pointerdown=[uQ];var er=v(y(mo),2),gr=y(er),fr=y(gr);fr.__click=[dQ,Ce];var pr=v(fr,2);pr.__click=[fQ,Ce];var yu=y(pr),Kc=y(yu,!0);_(yu);var fd=v(yu,2);Ye(fd,()=>i(ca),ne=>{var fe=pQ(),qe=y(fe,!0);_(fe),Ne(()=>{Fi(fe,`err-badge ${(i(Ki)===0&&i(Xi)>0?"warn":"")??""} svelte-1ehcy4i`),tt(qe,i(ca))}),Y(ne,fe)}),_(pr);var Rr=v(pr,2);Rr.__click=[mQ,Ce],_(gr);var ic=v(gr,2),Lc=v(y(ic),2);Lc.__click=[hQ];var Ad=y(Lc);Ad.value=(Ad.__value="auto")==null?"":"auto";var Gu=v(Ad);Gu.value=(Gu.__value="json")==null?"":"json";var lf=v(Gu);lf.value=(lf.__value="pine")==null?"":"pine";var pd=v(lf);pd.value=(pd.__value="dsl")==null?"":"dsl";var Df=v(pd);Df.value=(Df.__value="js")==null?"":"js",_(Lc),_(ic),_(er);var Li=v(er,2),nm=y(Li);Ye(nm,()=>!i(ye),ne=>{var fe=_Q(),qe=y(fe);qe.__click=[vQ,xt];var ot=v(qe,2);ot.__click=[gQ,xt],_(fe),Ne(()=>{rr(qe,"active",d()==="main"),rr(ot,"active",d()==="sub")}),Y(ne,fe)});var Nf=v(nm,2);Nf.__click=[eQ,It,m];var nt=v(y(Nf),2),yv=y(nt);_(nt),_(Nf);var Tv=v(Nf,2);Tv.__click=[XJ,m];var Fp=v(Tv,2);Fp.__click=[ZJ];var pu=v(Fp,2);pu.__click=[JJ,N,ce];var Em=v(pu,2);Em.__click=[YJ,je];var Vg=v(Em,2);Vg.__click=[GJ,m];var kg=v(Vg,2);kg.__click=g;var Fv=v(y(kg),2),Op=y(Fv,!0);_(Fv),_(kg);var bu=v(kg,2);Ye(bu,()=>!i(Dn),ne=>{var fe=yQ();fe.__click=[aQ,Dn,m],Y(ne,fe)},ne=>{var fe=bQ();fe.__click=mi,Y(ne,fe)});var ov=v(bu,2);ov.__click=[KJ,Dn,m],_(Li),_(mo);var $m=v(mo,2),og=y($m),sm=y(og),vf=y(sm),Dm=y(vf),Rm=v(y(Dm),2),Nh=y(Rm);_(Rm);var qh=v(Rm,2),ah=y(qh);_(qh),_(Dm),Di(2),_(vf);var Lv=v(vf,2),x0=y(Lv);Ye(x0,()=>i(An)!=="failed",ne=>{var fe=wQ(),qe=y(fe);Ye(qe,()=>i(An)!=="ready",ot=>{var Wt=xQ();Y(ot,Wt)}),_(fe),ep(fe,ot=>x(Yf,ot),()=>i(Yf)),Y(ne,fe)},ne=>{var fe=SQ(),qe=tn(fe);Ro(qe,21,()=>i(Rt),fi,(Un,Ws,bo)=>{var Ts=kQ();Ts.textContent=bo+1,Y(Un,Ts)}),_(qe),ep(qe,Un=>x(Jl,Un),()=>i(Jl));var ot=v(qe,2),Wt=y(ot),Ct=y(Wt),un=y(Ct);DC(un,()=>i(Dd)),_(Ct),Di(2),_(Wt),ep(Wt,Un=>x(Rd,Un),()=>i(Rd));var Ln=v(Wt,2);uC(Ln),Ln.__input=Zr,ep(Ln,Un=>x(oc,Un),()=>i(oc)),_(ot),ld("scroll",Ln,Zr),As(Ln,t),Y(ne,fe)}),_(Lv),_(sm);var Sg=v(sm,2);Ye(Sg,()=>i(ur).length,ne=>{var fe=zQ(),qe=y(fe),ot=v(y(qe),4);Ye(ot,()=>i(Tl).length,Ct=>{var un=IQ();Ro(un,21,()=>i(Tl).slice(0,3),Ln=>Ln.message,(Ln,Un)=>{var Ws=CQ(),bo=y(Ws);_(Ws),Ne(()=>tt(bo,`Line ${i(Un).line??""}: ${i(Un).message??""}`)),Y(Ln,Ws)}),_(un),Y(Ct,un)});var Wt=v(ot,2);Ro(Wt,21,()=>i(ur),Ct=>Ct.name,(Ct,un)=>{var Ln=OQ(),Un=y(Ln),Ws=y(Un),bo=y(Ws,!0);_(Ws);var Ts=v(Ws,2),Oo=y(Ts,!0);_(Ts),_(Un);var _i=v(Un,2),to=y(_i);Ye(to,()=>i(un).type==="bool",Ha=>{var Ta=MQ(),dl=y(Ta);mn(dl),Ne(()=>Av(dl,!!i(Fl)[i(un).name])),dl.__change=[PQ,Oa,un],Di(2),_(Ta),Y(Ha,Ta)},Ha=>{var Ta=Yn(),dl=tn(Ta);Ye(dl,()=>i(un).type==="string"||i(un).type==="session"||i(un).type==="symbol",yl=>{var Ml=AQ();mn(Ml),Ne(()=>Hf(Ml,String(i(Fl)[i(un).name]??""))),Ml.__input=[NQ,Oa,un],Y(yl,Ml)},yl=>{var Ml=Yn(),Gl=tn(Ml);Ye(Gl,()=>i(un).type==="time",wd=>{var fc=FQ();mn(fc),Ne(()=>Hf(fc,ct(i(Fl)[i(un).name]??i(un).defval))),fc.__input=[TQ,Mt,Oa,un],Y(wd,fc)},wd=>{var fc=Yn(),md=tn(fc);Ye(md,()=>i(un).type==="source",Yp=>{var xu=$Q(),Xd=y(xu);mn(Xd),Ne(()=>Hf(Xd,String(i(Fl)[i(un).name]??i(un).defval??"close"))),Xd.__input=[LQ,Oa,un];var vo=v(Xd,2);Ro(vo,21,()=>Qe,fi,(go,yi)=>{var Jr=EQ(),Yl={};Ne(()=>{Yl!==(Yl=i(yi))&&(Jr.value=(Jr.__value=i(yi))==null?"":i(yi))}),Y(go,Jr)}),_(vo),_(xu),Ne(()=>{Dt(Xd,"list",`source-options-${i(un).name}`),Dt(vo,"id",`source-options-${i(un).name}`)}),Y(Yp,xu)},Yp=>{var xu=Yn(),Xd=tn(xu);Ye(Xd,()=>i(un).type==="color",vo=>{var go=RQ();mn(go),Ne(()=>Hf(go,mt(i(Fl)[i(un).name]??i(un).defval))),go.__input=[DQ,Oa,un],Y(vo,go)},vo=>{var go=BQ();mn(go),Ne(()=>Hf(go,Number(i(Fl)[i(un).name]??i(un).defval))),go.__input=[jQ,Oa,un],Ne(()=>{Dt(go,"step",i(un).step??(i(un).type==="int"?1:.01)),Dt(go,"min",i(un).minval),Dt(go,"max",i(un).maxval)}),Y(vo,go)},!0),Y(Yp,xu)},!0),Y(wd,fc)},!0),Y(yl,Ml)},!0),Y(Ha,Ta)}),_(_i),_(Ln),Ne(()=>{tt(bo,i(un).title||i(un).name),tt(Oo,i(un).name)}),Y(Ct,Ln)}),_(Wt),Di(2),_(qe),_(fe),Y(ne,fe)}),_(og),_($m);var Ev=v($m,2);Ye(Ev,()=>i(Ce)==="errors",ne=>{var fe=GQ(),qe=y(fe);Ye(qe,()=>i(Yi).length===0,ot=>{var Wt=VQ();Y(ot,Wt)},ot=>{var Wt=UQ(),Ct=tn(Wt),un=y(Ct),Ln=y(un);_(un),Di(2),_(Ct);var Un=v(Ct,2);Ro(Un,21,()=>i(Yi),fi,(Ws,bo)=>{var Ts=qQ(),Oo=v(y(Ts),2),_i=y(Oo);Ye(_i,()=>i(bo).line,Ta=>{var dl=WQ(),yl=y(dl),Ml=v(yl);Ye(Ml,()=>i(bo).col,Gl=>{var wd=G0();Ne(()=>tt(wd,`· Col ${i(bo).col??""}`)),Y(Gl,wd)}),Di(),_(dl),Ne(()=>tt(yl,`Line ${i(bo).line??""}`)),Y(Ta,dl)});var to=v(_i);_(Oo);var Ha=v(Oo,2);Ye(Ha,()=>i(bo).hint,Ta=>{var dl=HQ(),yl=y(dl);_(dl),Ne(()=>tt(yl,`— ${i(bo).hint??""}`)),Y(Ta,dl)}),_(Ts),Ne(()=>{Fi(Ts,`${`diag-item ${i(bo).level}`??""} svelte-1ehcy4i`),tt(to,` ${i(bo).message??""}`)}),Y(Ws,Ts)}),_(Un),Ne(()=>tt(Ln,`Errors (${(i(Ki)||0)??""})`)),Y(ot,Wt)}),_(fe),Y(ne,fe)},ne=>{var fe=Yn(),qe=tn(fe);Ye(qe,()=>i(Ce)==="results",ot=>{var Wt=Kne(),Ct=y(Wt);Ye(Ct,()=>i($t),Ln=>{var Un=zee();Un.__click=td;var Ws=y(Un);Ws.__click=[YQ];var bo=y(Ws),Ts=v(y(bo),2),Oo=y(Ts),_i=y(Oo);_i.__click=[KQ,Yt];var to=v(_i,2);to.__click=[XQ,Yt],_(Oo);var Ha=v(Oo,2);Ha.__click=td,_(Ts),_(bo);var Ta=v(bo,2),dl=y(Ta);Ye(dl,()=>i(Yt)==="trades",yl=>{var Ml=xee(),Gl=tn(Ml),wd=y(Gl),fc=y(wd),md=v(y(fc)),Yp=y(md);_(md),_(fc),Di(2),_(wd);var xu=v(wd,2),Xd=y(xu);mn(Xd),Xd.__input=[ZQ,vu];var vo=v(Xd,2);vo.__click=[JQ,qn];var go=y(vo,!0);_(vo);var yi=v(vo,2);Ye(yi,()=>i(Ll).type!=="all",Eu=>{var nd=eee();nd.__click=[QQ,Nu],Y(Eu,nd)});var Jr=v(yi,2);Jr.__click=[z5,E,Wa,Yc,_l,ia,hr,vr,Zl,I],_(xu),_(Gl);var Yl=v(Gl,2);Ye(Yl,()=>i(dc).length,Eu=>{var nd=yee(),dp=y(nd),Ic=y(dp),zp=y(Ic),nu=v(y(zp)),zi=y(nu);zi.__click=[tee,Ja];var jm=y(zi);Ne(()=>tt(jm,`Side ${ga("side")??""}`)),_(zi),_(nu);var op=v(nu),_m=y(op);_m.__click=[nee,Ja];var dh=y(_m);Ne(()=>tt(dh,`Entry ${ga("entryIndex")??""}`)),_(_m),_(op);var Kp=v(op),Xp=y(Kp);Xp.__click=[see,Ja];var ym=y(Xp);Ne(()=>tt(ym,`Exit ${ga("exitIndex")??""}`)),_(Xp),_(Kp);var Ah=v(Kp),Rf=y(Ah);Rf.__click=[oee,Ja];var Bm=y(Rf);Ne(()=>tt(Bm,`Qty ${ga("qty")??""}`)),_(Rf),_(Ah);var Om=v(Ah),Uh=y(Om);Uh.__click=[iee,Ja];var om=y(Uh);Ne(()=>tt(om,`Bars ${ga("barsHeld")??""}`)),_(Uh),_(Om);var bm=v(Om),zm=y(bm);zm.__click=[ree,Ja];var fp=y(zm);Ne(()=>tt(fp,`Net PnL ${ga("netPnl")??""}`)),_(zm),_(bm);var Td=v(bm),iv=y(Td);iv.__click=[aee,Ja];var $v=y(iv);Ne(()=>tt($v,`PnL% ${ga("pnlPct")??""}`)),_(iv),_(Td);var Vm=v(Td);Ye(Vm,()=>i(qn)==="full",Gh=>{var wu=pee(),Lp=tn(wu),ph=y(Lp);ph.__click=[lee,Ja];var im=y(ph);Ne(()=>tt(im,`Fees ${ga("fees")??""}`)),_(ph),_(Lp);var Wm=v(Lp,2),Af=y(Wm);Af.__click=[cee,Ja];var xm=y(Af);Ne(()=>tt(xm,`Gross ${ga("pnl")??""}`)),_(Af),_(Wm);var rm=v(Wm,2),mh=y(rm);mh.__click=[uee,Ja];var Hm=y(mh);Ne(()=>tt(Hm,`MAE% ${ga("maePct")??""}`)),_(mh),_(rm);var $l=v(rm,2),am=y($l);am.__click=[dee,Ja];var hh=y(am);Ne(()=>tt(hh,`MFE% ${ga("mfePct")??""}`)),_(am),_($l);var Zp=v($l,6),Th=y(Zp);Th.__click=[fee,Ja];var xv=y(Th);Ne(()=>tt(xv,`Cum Net ${ga("cumNet")??""}`)),_(Th),_(Zp),Y(Gh,wu)}),_(zp),_(Ic);var fh=v(Ic);Ro(fh,21,()=>i(dc),Gh=>Gh.id,(Gh,wu)=>{var Lp=_ee();Lp.__click=[mee,af,wu],Lp.__keydown=[hee,af,wu];var ph=y(Lp),im=y(ph);im.__click=[vee,ol,wu],_(ph);var Wm=v(ph),Af=y(Wm),xm=y(Af,!0);Ne(()=>tt(xm,Yc(i(wu).side))),_(Af),_(Wm);var rm=v(Wm),mh=y(rm),Hm=y(mh),$l=v(y(Hm)),am=y($l);_($l),_(Hm);var hh=v(Hm,2),Zp=v(y(hh)),Th=y(Zp,!0);_(Zp),_(hh);var xv=v(hh,2),ag=v(y(xv)),Ep=y(ag,!0);Ne(()=>tt(Ep,_l(i(wu).entryPrice))),_(ag),_(xv),_(mh),_(rm);var $p=v(rm),qm=y($p),Fh=y(qm),Yh=v(y(Fh)),lg=y(Yh);_(Yh),_(Fh);var gf=v(Fh,2),wm=v(y(gf)),Dv=y(wm,!0);_(wm),_(gf);var Rv=v(gf,2),Um=v(y(Rv)),Kh=y(Um,!0);Ne(()=>tt(Kh,_l(i(wu).exitPrice))),_(Um),_(Rv),_(qm),_($p);var wv=v($p),cg=y(wv,!0);Ne(()=>tt(cg,ia(i(wu).qty))),_(wv);var rv=v(wv),vh=y(rv,!0);Ne(()=>tt(vh,hr(i(wu).barsHeld,0))),_(rv);var lm=v(rv);const Ig=At(()=>(Number(i(wu).netPnl)>=0?"+":"")??""),cm=At(()=>vr(i(wu).netPnl)??"");var av=y(lm);Ne(()=>tt(av,`${i(Ig)}${i(cm)}`)),_(lm);var lv=v(lm),jv=y(lv,!0);Ne(()=>tt(jv,Zl(i(wu).pnlPct))),_(lv);var jf=v(lv);Ye(jf,()=>i(qn)==="full",Wl=>{var Dl=gee(),gd=tn(Dl),Lh=y(gd,!0);Ne(()=>tt(Lh,vr(i(wu).fees))),_(gd);var gh=v(gd,2);const Bv=At(()=>(Number(i(wu).pnl)>=0?"+":"")??""),Eh=At(()=>vr(i(wu).pnl)??"");var Ip=y(gh);Ne(()=>tt(Ip,`${i(Bv)}${i(Eh)}`)),_(gh);var Vp=v(gh,2),$h=y(Vp,!0);Ne(()=>tt($h,i(wu).maePct==null?"-":Zl(i(wu).maePct))),_(Vp);var cv=v(Vp,2),Dh=y(cv,!0);Ne(()=>tt(Dh,i(wu).mfePct==null?"-":Zl(i(wu).mfePct))),_(cv);var um=v(cv,2),Ov=y(um),Rh=y(Ov),zv=v(y(Rh)),kv=y(zv,!0);_(zv),_(Rh);var _h=v(Rh,2),km=v(y(_h)),uv=y(km,!0);_(km),_(_h),_(Ov),_(um);var Vv=v(um,2),ug=y(Vv,!0);_(Vv);var Wv=v(Vv,2);const dg=At(()=>(Number(i(wu).cumNet)>=0?"+":"")??""),S=At(()=>vr(i(wu).cumNet)??"");var j=y(Wv);Ne(()=>tt(j,`${i(dg)}${i(S)}`)),_(Wv),Ne(()=>{tt(kv,i(wu).entrySignalId||"-"),tt(uv,i(wu).exitSignalId||"-"),tt(ug,i(wu).exitReason||"-")}),Y(Wl,Dl)}),_(Lp),Ne(()=>{rr(Lp,"selected",i(Pd)===i(wu).id),rr(Lp,"pos",i(wu).netPnl>=0),rr(Lp,"neg",i(wu).netPnl<0),tt(am,`#${i(wu).entryIndex??""}`),tt(Th,i(wu).entryTimeLabel),tt(lg,`#${i(wu).exitIndex??""}`),tt(Dv,i(wu).exitTimeLabel)}),Y(Gh,Lp)}),_(fh),_(dp),_(nd),Ne(()=>Fi(dp,`${`tt-table tt-table-trades ${i(qn)}`??""} svelte-1ehcy4i`)),Y(Eu,nd)},Eu=>{var nd=bee();Y(Eu,nd)}),Ne(()=>{tt(Yp,`(${i(Wu).length??""}/${i(Wa).length??""})`),Hf(Xd,i(vu)),tt(go,i(qn)==="compact"?"Show details":"Compact view")}),Y(yl,Ml)},yl=>{var Ml=Oee(),Gl=tn(Ml),wd=y(Gl),fc=v(y(wd),2),md=y(fc),Yp=v(md);Ye(Yp,()=>i(uu).length>500,Jr=>{var Yl=G0("• Showing last 500");Y(Jr,Yl)}),_(fc),Di(2),_(wd);var xu=v(wd,2),Xd=y(xu);Xd.__click=[wee,Vn];var vo=y(Xd,!0);_(Xd);var go=v(Xd,2);go.__click=[V5,E,uu,hr,ia,vr,_l,I],_(xu),_(Gl);var yi=v(Gl,2);Ye(yi,()=>i(uu).length,Jr=>{var Yl=jee(),Eu=y(Yl),nd=y(Eu),dp=y(nd),Ic=v(y(dp),7);Ye(Ic,()=>i(Vn)==="full",nu=>{var zi=kee();Di(4),Y(nu,zi)}),_(dp),_(nd);var zp=v(nd);Ro(zp,21,()=>i(ud),nu=>nu.id,(nu,zi)=>{var jm=Ree(),op=y(jm),_m=y(op);_m.__click=[See,du,zi],_(op);var dh=v(op),Kp=y(dh,!0);_(dh);var Xp=v(dh),ym=y(Xp),Ah=y(ym,!0);_(ym),_(Xp);var Rf=v(Xp),Bm=y(Rf),Om=y(Bm),Uh=v(y(Om),2),om=y(Uh,!0);_(Uh),_(Om);var bm=v(Om,2),zm=v(y(bm),2),fp=y(zm,!0);_(zm),_(bm);var Td=v(bm,2),iv=v(y(Td),2),$v=y(iv,!0);_(iv),_(Td),_(Bm),_(Rf);var Vm=v(Rf),fh=y(Vm),Gh=y(fh),wu=v(y(Gh)),Lp=y(wu);_(wu),_(Gh);var ph=v(Gh,2),im=v(y(ph)),Wm=y(im,!0);_(im),_(ph),_(fh),_(Vm);var Af=v(Vm),xm=y(Af),rm=y(xm),mh=v(y(rm)),Hm=y(mh);Ne(()=>tt(Hm,`${hr(i(zi).qtyPct,2)??""}%`)),_(mh),_(rm);var $l=v(rm,2);Ye($l,()=>i(zi).qty!=null,jf=>{var Wl=Cee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,ia(i(zi).qty))),_(Dl),_(Wl),Y(jf,Wl)});var am=v($l,2);Ye(am,()=>i(zi).cash!=null,jf=>{var Wl=Iee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,vr(i(zi).cash))),_(Dl),_(Wl),Y(jf,Wl)});var hh=v(am,2);Ye(hh,()=>i(zi).price!=null,jf=>{var Wl=Pee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,_l(i(zi).price))),_(Dl),_(Wl),Y(jf,Wl)});var Zp=v(hh,2);Ye(Zp,()=>i(zi).stopPrice!=null,jf=>{var Wl=Mee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,_l(i(zi).stopPrice))),_(Dl),_(Wl),Y(jf,Wl)});var Th=v(Zp,2);Ye(Th,()=>i(zi).limitPrice!=null,jf=>{var Wl=Nee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,_l(i(zi).limitPrice))),_(Dl),_(Wl),Y(jf,Wl)});var xv=v(Th,2);Ye(xv,()=>i(zi).tif,jf=>{var Wl=Aee(),Dl=v(y(Wl)),gd=y(Dl,!0);_(Dl),_(Wl),Ne(()=>tt(gd,i(zi).tif)),Y(jf,Wl)});var ag=v(xv,2);Ye(ag,()=>i(zi).trailPct!=null,jf=>{var Wl=Tee(),Dl=v(y(Wl)),gd=y(Dl);Ne(()=>tt(gd,`${hr(i(zi).trailPct,2)??""}%`)),_(Dl),_(Wl),Y(jf,Wl)});var Ep=v(ag,2);Ye(Ep,()=>i(zi).trailOffset!=null,jf=>{var Wl=Fee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,_l(i(zi).trailOffset))),_(Dl),_(Wl),Y(jf,Wl)});var $p=v(Ep,2);Ye($p,()=>i(zi).trailPrice!=null,jf=>{var Wl=Lee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,_l(i(zi).trailPrice))),_(Dl),_(Wl),Y(jf,Wl)}),_(xm),_(Af);var qm=v(Af),Fh=y(qm),Yh=y(Fh),lg=v(y(Yh)),gf=y(lg,!0);_(lg),_(Yh);var wm=v(Yh,2),Dv=v(y(wm)),Rv=y(Dv,!0);_(Dv),_(wm);var Um=v(wm,2),Kh=v(y(Um)),wv=y(Kh,!0);Ne(()=>tt(wv,i(zi).fillQty==null?"-":ia(i(zi).fillQty))),_(Kh),_(Um);var cg=v(Um,2);Ye(cg,()=>i(zi).remainingQty!=null,jf=>{var Wl=Eee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,ia(i(zi).remainingQty))),_(Dl),_(Wl),Y(jf,Wl)});var rv=v(cg,2);Ye(rv,()=>i(zi).targetQty!=null,jf=>{var Wl=$ee(),Dl=v(y(Wl)),gd=y(Dl,!0);Ne(()=>tt(gd,ia(i(zi).targetQty))),_(Dl),_(Wl),Y(jf,Wl)});var vh=v(rv,2),lm=v(y(vh)),Ig=y(lm,!0);Ne(()=>tt(Ig,i(zi).fillPrice==null?"-":_l(i(zi).fillPrice))),_(lm),_(vh);var cm=v(vh,2),av=v(y(cm)),lv=y(av,!0);Ne(()=>tt(lv,i(zi).fees==null?"-":vr(i(zi).fees))),_(av),_(cm),_(Fh),_(qm);var jv=v(qm);Ye(jv,()=>i(Vn)==="full",jf=>{var Wl=Dee(),Dl=tn(Wl),gd=y(Dl),Lh=y(gd),gh=v(y(Lh)),Bv=y(gh);_(gh),_(Lh);var Eh=v(Lh,2),Ip=v(y(Eh)),Vp=y(Ip,!0);_(Ip),_(Eh),_(gd),_(Dl);var $h=v(Dl,2),cv=y($h),Dh=y(cv),um=v(y(Dh)),Ov=y(um,!0);_(um),_(Dh);var Rh=v(Dh,2),zv=v(y(Rh)),kv=y(zv,!0);_(zv),_(Rh),_(cv),_($h);var _h=v($h,2),km=y(_h,!0);_(_h),Ne(()=>{tt(Bv,`#${i(zi).activeFromIndex??""}`),tt(Vp,i(zi).expiresAtIndex==null?"-":`#${i(zi).expiresAtIndex}`),tt(Ov,i(zi).signalId||"-"),tt(kv,i(zi).ocoGroup||"-"),tt(km,i(zi).note||"-")}),Y(jf,Wl)}),_(jm),Ne(()=>{tt(Kp,i(zi).id),Fi(ym,`${`tt-pill status status-${i(zi).statusKey}`??""} svelte-1ehcy4i`),tt(Ah,i(zi).statusLabel),tt(om,i(zi).actionLabel),tt(fp,i(zi).sideLabel),tt($v,i(zi).kindLabel),tt(Lp,`#${i(zi).createdIndex??""}`),tt(Wm,i(zi).createdTimeLabel),tt(gf,i(zi).filledIndex==null?"-":`#${i(zi).filledIndex}`),tt(Rv,i(zi).filledIndex==null?"-":i(zi).filledTimeLabel)}),Y(nu,jm)}),_(zp),_(Eu),_(Yl),Ne(()=>Fi(Eu,`${`tt-table tt-table-orders ${i(Vn)}`??""} svelte-1ehcy4i`)),Y(Jr,Yl)},Jr=>{var Yl=Bee();Y(Jr,Yl)}),Ne(()=>{tt(md,`Rows ${i(uu).length??""}`),tt(vo,i(Vn)==="compact"?"Show details":"Compact view")}),Y(yl,Ml)}),_(Ta),_(Ws),_(Un),Ne(()=>{rr(_i,"active",i(Yt)==="trades"),rr(to,"active",i(Yt)==="orders")}),Y(Ln,Un)});var un=v(Ct,2);Ye(un,()=>!i(ni),Ln=>{var Un=Yn(),Ws=tn(Un);Ye(Ws,()=>!i(kc),bo=>{var Ts=Hee(),Oo=y(Ts);Ye(Oo,()=>i(Il)||i(cl),_i=>{var to=Vee();Di(4),Y(_i,to)},_i=>{var to=Wee();Di(4),Y(_i,to)}),_(Ts),Y(bo,Ts)},bo=>{var Ts=Yn(),Oo=tn(Ts);Ye(Oo,()=>!i(uc),_i=>{var to=Gee(),Ha=y(to);Ye(Ha,()=>i(Il)||i(cl),Ta=>{var dl=qee();Di(4),Y(Ta,dl)},Ta=>{var dl=Uee();Di(4),Y(Ta,dl)}),_(to),Y(_i,to)},_i=>{var to=Xee(),Ha=y(to);Ye(Ha,f,dl=>{var yl=G0("Running… please wait.");Y(dl,yl)},dl=>{var yl=Yee();Di(2),Y(dl,yl)});var Ta=v(Ha,2);Ye(Ta,()=>i(Il)||i(cl),dl=>{var yl=Kee(),Ml=y(yl);_(yl),Ne(()=>tt(Ml,`Pine parsed: strategy ${(i(Il)?"yes":"no")??""} • signals
                ${(i(cl)?"yes":"no")??""}`)),Y(dl,yl)}),_(to),Y(_i,to)},!0),Y(bo,Ts)}),Y(Ln,Un)},Ln=>{var Un=Yne(),Ws=y(Un),bo=v(y(Ws),2),Ts=y(bo),Oo=v(y(Ts),2),_i=y(Oo,!0);Ne(()=>tt(_i,zs(i(ni).finalEquity,2))),_(Oo),_(Ts);var to=v(Ts,2),Ha=v(y(to),2),Ta=y(Ha);Ne(()=>tt(Ta,`${(i(ni).netPnl>=0?"+":"")??""}${zs(i(ni).netPnl,2)??""}`)),_(Ha),_(to);var dl=v(to,2),yl=v(y(dl),2),Ml=y(yl,!0);Ne(()=>tt(Ml,Bo(i(ni).maxDrawdownPct))),_(yl),_(dl),_(bo),_(Ws);var Gl=v(Ws,2),wd=y(Gl),fc=v(y(wd)),md=y(fc,!0);_(fc);var Yp=v(fc,2),xu=y(Yp);_(Yp),_(wd);var Xd=v(wd,2);Ye(Xd,()=>i(vc).lastTs,ai=>{var Bs=Zee(),Fn=v(y(Bs)),ks=y(Fn,!0);Ne(()=>tt(ks,new Date(i(vc).lastTs).toISOString().slice(0,10))),_(Fn),_(Bs),Y(ai,Bs)});var vo=v(Xd,2);Ye(vo,()=>i(Na),ai=>{var Bs=Jee(),Fn=v(y(Bs)),ks=y(Fn,!0);_(Fn),_(Bs),Ne(()=>tt(ks,i(Na))),Y(ai,Bs)}),_(Gl);var go=v(Gl,2),yi=y(go),Jr=y(yi),Yl=y(Jr),Eu=v(y(Yl),2);Eu.__click=[Qee,Is],_(Yl),Di(2),_(Jr),_(yi);var nd=v(yi,2),dp=y(nd),Ic=v(y(dp),2),zp=y(Ic),nu=v(y(zp),2);mn(nu),nu.__input=[ete,zt],_(zp);var zi=v(zp,2),jm=v(y(zi),2);mn(jm),jm.__input=[tte,Qt],_(zi);var op=v(zi,2),_m=v(y(op),2);mn(_m),_m.__input=[nte,ho],_(op),_(Ic);var dh=v(Ic,2),Kp=y(dh);Kp.__click=g;var Xp=v(Kp,2);Ye(Xp,()=>i(jo),ai=>{var Bs=ste();Bs.__click=[sQ,zt,Qt,ho],Y(ai,Bs)});var ym=v(Xp,2);Ye(ym,()=>i(Na),ai=>{var Bs=ote(),Fn=y(Bs,!0);_(Bs),Ne(()=>tt(Fn,i(Na))),Y(ai,Bs)}),Di(2),_(dh),_(dp);var Ah=v(dp,2),Rf=v(y(Ah),2),Bm=y(Rf);mn(Bm),Bm.__input=[ite,ro];var Om=v(Bm,2);Om.__click=[tQ,ni,ro,Cs,la];var Uh=v(Om,2);Ye(Uh,()=>i(Cs).length,ai=>{var Bs=rte();Bs.__click=[nQ,Cs,Sr,ql],Y(ai,Bs)}),_(Rf);var om=v(Rf,2);Ye(om,()=>i(Cs).length,ai=>{var Bs=gte(),Fn=v(y(Bs),2);Ro(Fn,17,()=>i(Cs),ks=>ks.id,(ks,vs)=>{var li=vte(),ra=tn(li),jr=y(ra),Mr=y(jr,!0);_(jr);var mr=v(jr,2),Mo=y(mr);Ne(()=>tt(Mo,`${(i(vs).summary.netPnl>=0?"+":"")??""}${zs(i(vs).summary.netPnl,2)??""}`)),_(mr);var La=v(mr,2),k=y(La,!0);Ne(()=>tt(k,Bo(i(vs).summary.netPnlPct??0))),_(La);var A=v(La,2),B=y(A,!0);Ne(()=>tt(B,Bo(i(vs).summary.maxDrawdownPct??0))),_(A);var R=v(A,2),U=y(R,!0);Ne(()=>tt(U,Mf(i(vs).summary.sharpe??0))),_(R);var q=v(R,2),ve=y(q,!0);Ne(()=>tt(ve,Bo(i(vs).summary.winRate??0))),_(q);var Re=v(q,2),rt=y(Re,!0);_(Re);var Ut=v(Re,2),ls=y(Ut,!0);Ne(()=>tt(ls,mf(i(vs).params))),_(Ut);var ns=v(Ut,2),Mn=y(ns);Mn.__click=[ate,$f,vs];var qo=y(Mn,!0);_(Mn);var Yo=v(Mn,2);Yo.__click=[lte,bs,vs],_(ns),_(ra);var Nc=v(ra,2);Ye(Nc,()=>i(Sr)===i(vs).id,jd=>{var cf=hte(),bf=y(cf),ip=v(y(bf),2);Ro(ip,21,()=>sc(i(vs).summary),fi,(Ri,_r)=>{var ua=cte(),Vi=y(ua),xa=y(Vi,!0);_(Vi);var Jc=v(Vi,2),Ua=y(Jc,!0);_(Jc),_(ua),Ne(()=>{tt(xa,i(_r).label),tt(Ua,i(_r).value)}),Y(Ri,ua)}),_(ip),_(bf);var Bd=v(bf,2),xf=v(y(Bd),2);Ye(xf,()=>i(vs).params&&Object.keys(i(vs).params).length,Ri=>{var _r=dte();Ro(_r,21,()=>Object.entries(i(vs).params),fi,(ua,Vi)=>{let xa=()=>i(Vi)[0],Jc=()=>i(Vi)[1];var Ua=ute(),ku=y(Ua),Su=y(ku,!0);_(ku);var sa=v(ku,2),Ol=y(sa,!0);Ne(()=>tt(Ol,tp(Jc(),0))),_(sa),_(Ua),Ne(()=>tt(Su,xa())),Y(ua,Ua)}),_(_r),Y(Ri,_r)},Ri=>{var _r=fte();Y(Ri,_r)}),_(Bd);var Jd=v(Bd,2),Od=v(y(Jd),2);Od.__click=[pte,Cf,vs];var wf=y(Od,!0);_(Od);var kf=v(Od,2);Ye(kf,()=>i(ql)[i(vs).id],Ri=>{var _r=mte(),ua=y(_r,!0);Ne(()=>tt(ua,yd(i(vs)))),_(_r),Y(Ri,_r)}),_(Jd),_(cf),Ne(()=>tt(wf,i(ql)[i(vs).id]?"Hide raw":"Show raw")),Y(jd,cf)}),Ne(()=>{tt(Mr,i(vs).label),Fi(mr,`${`right mono ${i(vs).summary.netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),tt(rt,i(vs).summary.trades??0),Dt(Mn,"aria-expanded",i(Sr)===i(vs).id),tt(qo,i(Sr)===i(vs).id?"Hide":"Details")}),Y(ks,li)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=_te();Y(ai,Bs)}),_(Ah),_(nd),_(go);var bm=v(go,2),zm=y(bm),fp=y(zm),Td=y(fp),iv=v(y(Td),2);iv.__click=[yte,Is],_(Td),Di(2),_(fp),_(zm);var $v=v(zm,2),Vm=y($v),fh=v(y(Vm),2),Gh=y(fh,!0);_(fh);var wu=v(fh,2),Lp=y(wu),ph=v(Lp);Ye(ph,()=>i(ni).roundTrips!=null,ai=>{var Bs=G0();Ne(()=>tt(Bs,`• Positions ${i(ni).roundTrips??""}`)),Y(ai,Bs)}),_(wu),_(Vm);var im=v(Vm,2),Wm=v(y(im),2),Af=y(Wm,!0);Ne(()=>tt(Af,Bo(i(ni).winRate))),_(Wm);var xm=v(Wm,2);const rm=At(()=>Bo(i(ni).maxDrawdownPct)??""),mh=At(()=>zs(i(ni).maxDrawdownValue??0,2)??"");var Hm=y(xm);Ne(()=>tt(Hm,`Max DD ${i(rm)} / ${i(mh)}`)),_(xm),_(im);var $l=v(im,2),am=v(y($l),2),hh=y(am);Ne(()=>tt(hh,`${(i(ni).netPnl>=0?"+":"")??""}${zs(i(ni).netPnl,2)??""}`)),_(am);var Zp=v(am,2);const Th=At(()=>Bo(i(ni).netPnlPct)??""),xv=At(()=>zs(i(ni).feesPaid,2)??""),ag=At(()=>Mf(i(ni).profitFactor)??"");var Ep=y(Zp);Ne(()=>tt(Ep,`${i(Th)} • Fees ${i(xv)} • PF ${i(ag)}`)),_(Zp),_($l);var $p=v($l,2),qm=v(y($p),2),Fh=y(qm);Ne(()=>tt(Fh,`${(i(ni).expectancy>=0?"+":"")??""}${zs(i(ni).expectancy??0,2)??""}`)),_(qm);var Yh=v(qm,2);const lg=At(()=>zs(i(ni).avgTrade??0,2)??""),gf=At(()=>Mf(i(ni).payoffRatio??0)??""),wm=At(()=>i(ni).maxConsecWins??0??""),Dv=At(()=>i(ni).maxConsecLosses??0??"");var Rv=y(Yh);Ne(()=>tt(Rv,`Avg ${i(lg)} • Payoff
                  ${i(gf)} • Streak
                  W ${i(wm)}/L ${i(Dv)}`)),_(Yh),_($p);var Um=v($p,2),Kh=v(y(Um),2),wv=y(Kh);Ne(()=>tt(wv,`Sharpe ${Mf(i(ni).sharpe??0)??""}`)),_(Kh);var cg=v(Kh,2);const rv=At(()=>Mf(i(ni).sortino??0)??""),vh=At(()=>Bo(i(ni).volatilityPct??0)??"");var lm=y(cg);Ne(()=>tt(lm,`Sortino ${i(rv)} • Vol
                  ${i(vh)}`)),_(cg),_(Um);var Ig=v(Um,2),cm=v(y(Ig),2),av=y(cm,!0);Ne(()=>tt(av,Bo(i(ni).exposurePct??0))),_(cm);var lv=v(cm,2);const jv=At(()=>Bo(i(ni).maxRunupPct??0)??""),jf=At(()=>zs(i(ni).maxRunupValue??0,2)??""),Wl=At(()=>zs(i(ni).avgBarsInTrade??0,1)??""),Dl=At(()=>Mf(i(ni).calmar??0)??"");var gd=y(lv);Ne(()=>tt(gd,`Run-up ${i(jv)} / ${i(jf)} • Bars/trade
                  ${i(Wl)} • Calmar
                  ${i(Dl)}`)),_(lv),_(Ig),_($v);var Lh=v($v,2);Ye(Lh,()=>i(ni).trades===0,ai=>{var Bs=wte(),Fn=v(y(Bs),2),ks=y(Fn);Ye(ks,()=>i(vc).total===0,vs=>{var li=bte();Di(2),Y(vs,li)},vs=>{var li=xte();Di(2),Y(vs,li)}),_(Fn),_(Bs),Y(ai,Bs)}),_(bm);var gh=v(bm,2),Bv=y(gh),Eh=y(Bv),Ip=y(Eh),Vp=v(y(Ip),2);Vp.__click=[kte,Is],_(Ip),Di(2),_(Eh),_(Bv);var $h=v(Bv,2),cv=y($h),Dh=v(y(cv),2),um=v(y(Dh),2),Ov=y(um);_(um);var Rh=v(um,2),zv=y(Rh);Ne(()=>tt(zv,`Win ${Bo(i(eu).long.winRate)??""}`)),_(Rh);var kv=v(Rh,2),_h=y(kv);Ne(()=>tt(_h,`Net ${(i(eu).long.net>=0?"+":"")??""}${zs(i(eu).long.net,2)??""}`)),_(kv);var km=v(kv,2),uv=y(km);Ne(()=>tt(uv,`PF ${Mf(i(eu).long.profitFactor)??""}`)),_(km),_(Dh);var Vv=v(Dh,2),ug=v(y(Vv),2),Wv=y(ug);_(ug);var dg=v(ug,2),S=y(dg);Ne(()=>tt(S,`Win ${Bo(i(eu).short.winRate)??""}`)),_(dg);var j=v(dg,2),Q=y(j);Ne(()=>tt(Q,`Net ${(i(eu).short.net>=0?"+":"")??""}${zs(i(eu).short.net,2)??""}`)),_(j);var ue=v(j,2),ie=y(ue);Ne(()=>tt(ie,`PF ${Mf(i(eu).short.profitFactor)??""}`)),_(ue),_(Vv),_(cv);var De=v(cv,2),ze=v(y(De),2);Ye(ze,()=>i(Ud).length,ai=>{var Bs=Cte(),Fn=v(y(Bs),2);Ro(Fn,17,()=>i(Ud).slice(0,12),fi,(ks,vs)=>{var li=Ste(),ra=y(li),jr=y(ra,!0);_(ra);var Mr=v(ra,2),mr=y(Mr,!0);_(Mr);var Mo=v(Mr,2),La=y(Mo,!0);Ne(()=>tt(La,Bo(i(vs).winRate))),_(Mo);var k=v(Mo,2),A=y(k);Ne(()=>tt(A,`${(i(vs).net>=0?"+":"")??""}${zs(i(vs).net,2)??""}`)),_(k);var B=v(k,2),R=y(B,!0);Ne(()=>tt(R,Mf(i(vs).profitFactor))),_(B),_(li),Ne(()=>{tt(jr,i(vs).id),tt(mr,i(vs).trades),Fi(k,`${`right mono ${i(vs).net>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),Y(ks,li)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=Ite();Y(ai,Bs)}),_(De),_($h),_(gh);var lt=v(gh,2),wt=y(lt),qt=y(wt),sn=y(qt),Ot=v(y(sn),2);Ot.__click=[Pte,Is],_(sn),Di(2),_(qt);var vn=v(qt,2),kn=y(vn,!0),as=v(kn);Ye(as,()=>i(nc),ai=>{var Bs=G0();Ne(()=>tt(Bs,`• Running ${i(Vu)??""}/${i(Xl)??""} (${i(Mu)??""}%) • ${i(kr)??""}`)),Y(ai,Bs)}),_(vn),_(wt);var Ls=v(wt,2),Ys=y(Ls),yn=v(y(Ys),2);Ye(yn,()=>i(ar).length,ai=>{var Bs=Gte(),Fn=tn(Bs),ks=v(y(Fn),2),vs=y(ks);e_(vs,()=>i(nr));var li;vs.__change=[Mte,En],Ro(vs,21,()=>i(ar),_r=>_r.name,(_r,ua)=>{var Vi=Nte(),xa={},Jc=y(Vi,!0);_(Vi),Ne(()=>{xa!==(xa=i(ua).name)&&(Vi.value=(Vi.__value=i(ua).name)==null?"":i(ua).name),tt(Jc,i(ua).title||i(ua).name)}),Y(_r,Vi)}),_(vs),_(ks),_(Fn);var ra=v(Fn,2),jr=y(ra),Mr=v(y(jr),2);mn(Mr),Mr.__input=[Ate,Gc],_(jr);var mr=v(jr,2),Mo=v(y(mr),2);mn(Mo),Mo.__input=[Tte,Pu],_(mr);var La=v(mr,2),k=v(y(La),2);mn(k),k.__input=[Fte,wc],_(La),_(ra);var A=v(ra,2),B=v(y(A),2),R=y(B);e_(R,()=>i(hi));var U;R.__change=[Lte,ms];var q=y(R);q.value=((q.__value="")==null,"");var ve=v(q);Ro(ve,17,()=>i(ar),_r=>_r.name,(_r,ua)=>{var Vi=Ete(),xa={},Jc=y(Vi,!0);_(Vi),Ne(()=>{xa!==(xa=i(ua).name)&&(Vi.value=(Vi.__value=i(ua).name)==null?"":i(ua).name),tt(Jc,i(ua).title||i(ua).name)}),Y(_r,Vi)}),_(R),_(B),_(A);var Re=v(A,2);Ye(Re,()=>i(hi),_r=>{var ua=jte(),Vi=y(ua),xa=v(y(Vi),2);mn(xa),xa.__input=[$te,cc],_(Vi);var Jc=v(Vi,2),Ua=v(y(Jc),2);mn(Ua),Ua.__input=[Dte,ou],_(Jc);var ku=v(Jc,2),Su=v(y(ku),2);mn(Su),Su.__input=[Rte,zu],_(ku),_(ua),Ne(()=>{Hf(xa,i(cc)),Hf(Ua,i(ou)),Hf(Su,i(zu))}),Y(_r,ua)});var rt=v(Re,2),Ut=v(y(rt),2),ls=y(Ut);e_(ls,()=>i(ja));var ns;ls.__change=[Bte,ja];var Mn=y(ls);Mn.value=(Mn.__value="netPnl")==null?"":"netPnl";var qo=v(Mn);qo.value=(qo.__value="profitFactor")==null?"":"profitFactor";var Yo=v(qo);Yo.value=(Yo.__value="sharpe")==null?"":"sharpe";var Nc=v(Yo);Nc.value=(Nc.__value="winRate")==null?"":"winRate";var jd=v(Nc);jd.value=(jd.__value="maxDrawdownPct")==null?"":"maxDrawdownPct",_(ls),_(Ut),_(rt);var cf=v(rt,2),bf=v(y(cf),2),ip=y(bf),Bd=y(ip);mn(Bd),Bd.__change=[Ote,va],Di(2),_(ip),_(bf),_(cf);var xf=v(cf,2);Ye(xf,()=>i(va),_r=>{var ua=Vte(),Vi=v(y(ua),2),xa=y(Vi);mn(xa),xa.__input=[zte,Vl],_(Vi),_(ua),Ne(()=>Hf(xa,i(Vl))),Y(_r,ua)});var Jd=v(xf,2),Od=y(Jd);Od.__click=[oQ,ar,ll,nr,hi,js,Gc,Pu,wc,cc,ou,zu,Fl,Bc,co,Vu,nc,rf,kr,Wr,jl,l,Gi];var wf=v(Od,2);Ye(wf,()=>i(nc),_r=>{var ua=Wte();ua.__click=[iQ,nc,rf,Bc,jl],Y(_r,ua)},_r=>{var ua=Yn(),Vi=tn(ua);Ye(Vi,()=>i(co).length,xa=>{var Jc=Hte();Jc.__click=[rQ,co,Wr,ll,Vu,Bc,nc,rf,jl],Y(xa,Jc)},null,!0),Y(_r,ua)}),Di(2),_(Jd);var kf=v(Jd,2);Ye(kf,()=>i(ll),_r=>{var ua=qte(),Vi=y(ua,!0);_(ua),Ne(()=>tt(Vi,i(ll))),Y(_r,ua)});var Ri=v(kf,2);Ye(Ri,()=>i(nc),_r=>{var ua=Ute(),Vi=y(ua);_(ua),Ne(()=>Dt(Vi,"style",`width:${i(Mu)}%`)),Y(_r,ua)}),Ne(()=>{li!==(li=i(nr))&&(vs.value=(vs.__value=i(nr))==null?"":i(nr),_0(vs,i(nr))),Hf(Mr,i(Gc)),Hf(Mo,i(Pu)),Hf(k,i(wc)),U!==(U=i(hi))&&(R.value=(R.__value=i(hi))==null?"":i(hi),_0(R,i(hi))),ns!==(ns=i(ja))&&(ls.value=(ls.__value=i(ja))==null?"":i(ja),_0(ls,i(ja))),Av(Bd,i(va)),Od.disabled=i(nc)}),Y(ai,Bs)},ai=>{var Bs=Yte();Y(ai,Bs)}),_(Ys);var Vt=v(Ys,2),Pn=v(y(Vt),2);Ye(Pn,()=>i(Zu).length,ai=>{var Bs=Zte(),Fn=tn(Bs),ks=y(Fn);_(Fn);var vs=v(Fn,2),li=v(y(vs),2);Ro(li,19,()=>i(Zu),(jr,Mr)=>mf(jr.params)+Mr,(jr,Mr,mr)=>{var Mo=Kte(),La=y(Mo),k=y(La,!0);Ne(()=>tt(k,mf(i(Mr).params))),_(La);var A=v(La,2),B=y(A,!0);Ne(()=>tt(B,fo(i(Mr).summary))),_(A);var R=v(A,2),U=y(R);Ne(()=>tt(U,`${(i(Mr).summary.netPnl>=0?"+":"")??""}${zs(i(Mr).summary.netPnl,2)??""}`)),_(R);var q=v(R,2),ve=y(q,!0);Ne(()=>tt(ve,Bo(i(Mr).summary.netPnlPct??0))),_(q);var Re=v(q,2),rt=y(Re,!0);Ne(()=>tt(rt,Bo(i(Mr).summary.maxDrawdownPct??0))),_(Re);var Ut=v(Re,2),ls=y(Ut,!0);Ne(()=>tt(ls,Bo(i(Mr).summary.winRate??0))),_(Ut);var ns=v(Ut,2),Mn=y(ns,!0);_(ns),_(Mo),Ne(()=>{Fi(Mo,`${`opt-results-row ${i(mr)===0?"best":""}`??""} svelte-1ehcy4i`),Fi(R,`${`right mono ${i(Mr).summary.netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),tt(Mn,i(Mr).summary.trades??0)}),Y(jr,Mo)}),_(vs);var ra=v(vs,2);Ye(ra,()=>i(va)&&i(Wr),jr=>{var Mr=Xte();const mr=At(()=>mf(i(Wr).params)??""),Mo=At(()=>(i(Wr).summary.netPnl>=0?"+":"")??""),La=At(()=>zs(i(Wr).summary.netPnl,2)??""),k=At(()=>Bo(i(Wr).summary.maxDrawdownPct??0)??""),A=At(()=>Bo(i(Wr).summary.winRate??0)??"");var B=y(Mr);Ne(()=>tt(B,`Test run: ${i(mr)} • Net ${i(Mo)}${i(La)} • DD ${i(k)} • Win ${i(A)}`)),_(Mr),Y(jr,Mr)}),Ne(()=>tt(ks,`Showing ${i(Zu).length??""} runs`)),Y(ai,Bs)},ai=>{var Bs=Jte();Y(ai,Bs)}),_(Vt),_(Ls),_(lt);var Hn=v(lt,2),Tn=y(Hn),bn=y(Tn),In=y(bn),Hs=v(y(In),2);Hs.__click=[Qte,Is],_(In),Di(2),_(bn);var Xt=v(bn,2),jn=y(Xt),Jn=y(jn);Jn.__click=[ene,tu];var Kt=v(Jn,2);Kt.__click=[tne,tu];var Zt=v(Kt,2);Zt.__click=[nne,tu];var an=v(Zt,2);an.__click=[sne,tu];var rs=v(an,2);rs.__click=[one,tu];var Sn=v(rs,2);Sn.__click=[ine,tu];var Xs=v(Sn,2);Xs.__click=[rne,tu],_(jn),_(Xt),_(Tn);var Ni=v(Tn,2),Qn=y(Ni),Fo=y(Qn),ps=v(y(Fo),2),Po=y(ps);Ye(Po,()=>i(Au).length,ai=>{var Bs=G0();const Fn=At(()=>zs(i(Au)[0].equity,2)??""),ks=At(()=>zs(i(Au)[i(Au).length-1].equity,2)??"");Ne(()=>tt(Bs,`${i(Fn)} → ${i(ks)}`)),Y(ai,Bs)}),_(ps),_(Fo);var Go=v(Fo,2);Ye(Go,()=>i(Tu),ai=>{var Bs=ane(),Fn=y(Bs),ks=v(y(Fn),2),vs=y(ks,!0);Ne(()=>tt(vs,zs(i(Tu).first,2))),_(ks),_(Fn);var li=v(Fn,2),ra=v(y(li),2),jr=y(ra,!0);Ne(()=>tt(jr,zs(i(Tu).last,2))),_(ra),_(li);var Mr=v(li,2),mr=v(y(Mr),2),Mo=y(mr);Ne(()=>tt(Mo,`${(i(Tu).net>=0?"+":"")??""}${zs(i(Tu).net,2)??""}`)),_(mr),_(Mr);var La=v(Mr,2),k=v(y(La),2),A=y(k);Ne(()=>tt(A,`${(i(Tu).retPct>=0?"+":"")??""}${Bo(i(Tu).retPct)??""}`)),_(k),_(La);var B=v(La,2),R=v(y(B),2);const U=At(()=>zs(i(Tu).min,2)??""),q=At(()=>zs(i(Tu).max,2)??"");var ve=y(R);Ne(()=>tt(ve,`${i(U)}–${i(q)}`)),_(R),_(B),_(Bs),Ne(()=>{Fi(mr,`${`mono ${i(Tu).net>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),Fi(k,`${`mono ${i(Tu).retPct>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),Y(ai,Bs)});var Ps=v(Go,2);Ps.__pointermove=Se;var Ns=y(Ps);Ye(Ns,()=>i(oe),ai=>{var Bs=une(),Fn=tn(Bs),ks=y(Fn),vs=v(ks),li=v(vs);Ye(li,()=>i(we),La=>{var k=lne();Ne(()=>Dt(k,"d",i(we).line)),Y(La,k)});var ra=v(li,4);Ye(ra,()=>i(gc),La=>{var k=cne();Ne(()=>{Dt(k,"cx",i(gc).x),Dt(k,"cy",i(gc).y)}),Y(La,k)}),_(Fn);var jr=v(Fn,2),Mr=y(jr,!0);Ne(()=>tt(Mr,zs(i(oe).maxY,2))),_(jr);var mr=v(jr,2),Mo=y(mr,!0);Ne(()=>tt(Mo,zs(i(oe).minY,2))),_(mr),Ne(()=>{Dt(ks,"d",i(oe).area),Dt(vs,"d",i(oe).line)}),Y(ai,Bs)},ai=>{var Bs=dne();Y(ai,Bs)});var si=v(Ns,2);Ye(si,()=>i(me),ai=>{var Bs=fne(),Fn=tn(Bs),ks=v(Fn,2),vs=v(ks,2),li=y(vs),ra=y(li,!0);Ne(()=>tt(ra,new Date(i(me).ts).toISOString().slice(0,10))),_(li);var jr=v(li,2),Mr=v(y(jr)),mr=y(Mr,!0);Ne(()=>tt(mr,zs(i(me).equity,2))),_(Mr),_(jr);var Mo=v(jr,2),La=v(y(Mo)),k=y(La);Ne(()=>tt(k,`${(i(me).net>=0?"+":"")??""}${vr(i(me).net)??""}`)),_(La),_(Mo);var A=v(Mo,2),B=v(y(A)),R=y(B);Ne(()=>tt(R,`${(i(me).retPct>=0?"+":"")??""}${Zl(i(me).retPct)??""}`)),_(B),_(A),_(vs),Ne(()=>{Dt(Fn,"style",`left:${i(me).x}px;`),Dt(ks,"style",`top:${i(me).y}px;`),Dt(vs,"style",`left:${i(me).left}px; top:${i(me).top}px;`)}),Y(ai,Bs)}),_(Ps);var Ec=v(Ps,2);Ye(Ec,()=>i(we),ai=>{var Bs=pne();Y(ai,Bs)}),_(Qn);var yc=v(Qn,2),Pc=y(yc),rc=v(y(Pc),2),Mc=y(rc);Ne(()=>tt(Mc,`Max ${Bo(i(ni).maxDrawdownPct)??""}`)),_(rc),_(Pc);var $c=v(Pc,2);Ye($c,()=>i(bd),ai=>{var Bs=mne(),Fn=y(Bs),ks=v(y(Fn),2),vs=y(ks,!0);Ne(()=>tt(vs,Bo(i(bd).worstAbs))),_(ks),_(Fn);var li=v(Fn,2),ra=v(y(li),2),jr=y(ra,!0);Ne(()=>tt(jr,Bo(i(bd).avgAbs))),_(ra),_(li);var Mr=v(li,2),mr=v(y(Mr),2),Mo=y(mr,!0);Ne(()=>tt(Mo,Bo(i(bd).lastAbs))),_(mr),_(Mr),_(Bs),Y(ai,Bs)});var bl=v($c,2);bl.__pointermove=Ge;var fl=y(bl);Ye(fl,()=>i(K),ai=>{var Bs=vne(),Fn=tn(Bs),ks=y(Fn),vs=v(ks),li=v(vs,4);Ye(li,()=>i(qu),Mo=>{var La=hne();Ne(()=>{Dt(La,"cx",i(qu).x),Dt(La,"cy",i(qu).y)}),Y(Mo,La)}),_(Fn);var ra=v(Fn,2),jr=y(ra);Ne(()=>tt(jr,`${zs(i(K).maxY,2)??""}%`)),_(ra);var Mr=v(ra,2),mr=y(Mr);Ne(()=>tt(mr,`${zs(i(K).minY,2)??""}%`)),_(Mr),Ne(()=>{Dt(ks,"d",i(K).area),Dt(vs,"d",i(K).line)}),Y(ai,Bs)},ai=>{var Bs=gne();Y(ai,Bs)});var $u=v(fl,2);Ye($u,()=>i(Le),ai=>{var Bs=yne(),Fn=tn(Bs),ks=v(Fn,2),vs=v(ks,2),li=y(vs),ra=y(li,!0);Ne(()=>tt(ra,new Date(i(Le).ts).toISOString().slice(0,10))),_(li);var jr=v(li,2),Mr=v(y(jr)),mr=y(Mr,!0);Ne(()=>tt(mr,Bo(Math.abs(i(Le).ddPct)))),_(Mr),_(jr);var Mo=v(jr,2);Ye(Mo,()=>i(Le).equity!=null,La=>{var k=_ne(),A=v(y(k)),B=y(A,!0);Ne(()=>tt(B,zs(i(Le).equity,2))),_(A),_(k),Y(La,k)}),_(vs),Ne(()=>{Dt(Fn,"style",`left:${i(Le).x}px;`),Dt(ks,"style",`top:${i(Le).y}px;`),Dt(vs,"style",`left:${i(Le).left}px; top:${i(Le).top}px;`)}),Y(ai,Bs)}),_(bl),_(yc),_(Ni),_(Hn);var sd=v(Hn,2),Bl=y(sd),Sp=y(Bl),Xc=y(Sp),xl=v(y(Xc),2);xl.__click=[bne,Is],_(Xc),Di(2),_(Sp),_(Bl);var Du=v(Bl,2),_d=y(Du),yh=v(y(_d),4);Ye(yh,()=>i(Ee).length,ai=>{var Bs=Sne(),Fn=v(y(Bs),2);Ro(Fn,17,()=>i(Ee),fi,(ks,vs)=>{var li=kne();Ne(()=>Dt(li,"title",(()=>{const Mo=i(pt).get(i(vs).key)||null;if(!Mo)return"Click to filter trades by this month";const La=Mo.trades?Mo.wins/Mo.trades*100:0,k=Mo.net>=0?`+${zs(Mo.net,2)}`:`${zs(Mo.net,2)}`;return`Trades ${Mo.trades} • Win ${Bo(La)} • Net ${k} • Fees ${zs(Mo.fees,2)} • Click to filter`})())),li.__click=[xne,Nu,vs,m,hf],li.__keydown=[wne,Nu,vs,m,hf];var ra=y(li),jr=y(ra,!0);_(ra);var Mr=v(ra,2),mr=y(Mr);Ne(()=>tt(mr,`${(i(vs).retPct>=0?"+":"")??""}${Bo(i(vs).retPct)??""}`)),_(Mr),_(li),Ne(()=>{Fi(li,`${`rt-row ${i(vs).retPct>=0?"pos":"neg"} ${i(Ll).type==="month"&&i(Ll).key===i(vs).key?"active":""}`??""} svelte-1ehcy4i`),tt(jr,i(vs).key)}),Y(ks,li)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=Cne();Y(ai,Bs)}),_(_d);var jh=v(_d,2),gp=v(y(jh),4);Ye(gp,()=>i(ht).length,ai=>{var Bs=Nne(),Fn=v(y(Bs),2);Ro(Fn,17,()=>i(ht),fi,(ks,vs)=>{var li=Mne();Ne(()=>Dt(li,"title",(()=>{const Mo=i(Nt).get(i(vs).key)||null;if(!Mo)return"Click to filter trades by this week";const La=Mo.trades?Mo.wins/Mo.trades*100:0,k=Mo.net>=0?`+${zs(Mo.net,2)}`:`${zs(Mo.net,2)}`;return`Trades ${Mo.trades} • Win ${Bo(La)} • Net ${k} • Fees ${zs(Mo.fees,2)} • Click to filter`})())),li.__click=[Ine,Nu,vs,m,hf],li.__keydown=[Pne,Nu,vs,m,hf];var ra=y(li),jr=y(ra,!0);_(ra);var Mr=v(ra,2),mr=y(Mr);Ne(()=>tt(mr,`${(i(vs).retPct>=0?"+":"")??""}${Bo(i(vs).retPct)??""}`)),_(Mr),_(li),Ne(()=>{Fi(li,`${`rt-row ${i(vs).retPct>=0?"pos":"neg"} ${i(Ll).type==="week"&&i(Ll).key===i(vs).key?"active":""}`??""} svelte-1ehcy4i`),tt(jr,i(vs).key)}),Y(ks,li)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=Ane();Y(ai,Bs)}),_(jh),_(Du),_(sd);var Sm=v(sd,2),Pp=y(Sm),Dp=y(Pp),_p=y(Dp),Wg=v(y(_p),2);Wg.__click=[Tne,Is],_(_p),Di(2),_(Dp),_(Pp);var _f=v(Pp,2),Ql=y(_f),Ir=v(y(Ql),2);Ye(Ir,()=>i(qf).length,ai=>{var Bs=Lne();Ro(Bs,21,()=>i(qf),fi,(Fn,ks)=>{var vs=Fne(),li=y(vs),ra=y(li,!0);_(li);var jr=v(li,2),Mr=y(jr);const mr=At(()=>`width:${i(ks).count/Pf(i(qf))*100}%`);_(jr);var Mo=v(jr,2),La=y(Mo,!0);_(Mo),_(vs),Ne(()=>{tt(ra,i(ks).label),Dt(Mr,"style",i(mr)),tt(La,i(ks).count)}),Y(Fn,vs)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=Ene();Y(ai,Bs)}),_(Ql);var kd=v(Ql,2),Rp=v(y(kd),2);Ye(Rp,()=>i(Uf).length,ai=>{var Bs=Dne();Ro(Bs,21,()=>i(Uf),fi,(Fn,ks)=>{var vs=$ne(),li=y(vs),ra=y(li,!0);_(li);var jr=v(li,2),Mr=y(jr);const mr=At(()=>`width:${i(ks).count/Pf(i(Uf))*100}%`);_(jr);var Mo=v(jr,2),La=y(Mo,!0);_(Mo),_(vs),Ne(()=>{tt(ra,i(ks).label),Dt(Mr,"style",i(mr)),tt(La,i(ks).count)}),Y(Fn,vs)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=Rne();Y(ai,Bs)}),_(kd);var Jp=v(kd,2),dv=v(y(Jp),2);Ye(dv,()=>i(dd).length,ai=>{var Bs=Bne();Ro(Bs,21,()=>i(dd),fi,(Fn,ks)=>{var vs=jne(),li=y(vs),ra=y(li,!0);_(li);var jr=v(li,2),Mr=y(jr);const mr=At(()=>`width:${i(ks).count/Pf(i(dd))*100}%`);_(jr);var Mo=v(jr,2),La=y(Mo,!0);_(Mo),_(vs),Ne(()=>{tt(ra,i(ks).label),Dt(Mr,"style",i(mr)),tt(La,i(ks).count)}),Y(Fn,vs)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=One();Y(ai,Bs)}),_(Jp);var yp=v(Jp,2),Hv=v(y(yp),2);Ye(Hv,()=>i(Id).length,ai=>{var Bs=Vne();Ro(Bs,21,()=>i(Id),fi,(Fn,ks)=>{var vs=zne(),li=y(vs),ra=y(li,!0);_(li);var jr=v(li,2),Mr=y(jr);const mr=At(()=>`width:${i(ks).count/Pf(i(Id))*100}%`);_(jr);var Mo=v(jr,2),La=y(Mo,!0);_(Mo),_(vs),Ne(()=>{tt(ra,i(ks).label),Dt(Mr,"style",i(mr)),tt(La,i(ks).count)}),Y(Fn,vs)}),_(Bs),Y(ai,Bs)},ai=>{var Bs=Wne();Y(ai,Bs)}),_(yp),_(_f),_(Sm);var Pg=v(Sm,2),Mg=y(Pg),Ng=y(Mg),fg=y(Ng),bh=v(y(fg),2);bh.__click=[Hne,Is],_(fg),Di(2),_(Ng),_(Mg);var Sv=v(Mg,2),Ag=y(Sv);Ag.__click=[qne,hf];var Cv=v(Ag,2);Cv.__click=[Une,hf];var Gm=v(Cv,2);Gm.__click=[z5,E,Wa,Yc,_l,ia,hr,vr,Zl,I];var Hi=v(Gm,2);Ye(Hi,()=>i(Ll).type!=="all",ai=>{var Bs=Gne();Bs.__click=[lQ,E,Wu,Yc,_l,ia,hr,vr,Zl,Ll,I],Y(ai,Bs)});var Pr=v(Hi,2);Pr.__click=[V5,E,uu,hr,ia,vr,_l,I];var iu=v(Pr,2);iu.__click=[cQ,E,Cc,I],_(Sv);var hd=v(Sv,2),yf=y(hd),Zd=y(yf);Ne(()=>tt(Zd,`Gross Profit: +${zs(i(ni).grossProfit,2)??""}`)),_(yf);var Et=v(yf,2),hs=y(Et);Ne(()=>tt(hs,`Gross Loss: -${zs(i(ni).grossLoss,2)??""}`)),_(Et);var Lo=v(Et,2),So=y(Lo);Ne(()=>tt(So,`Total: ${(i(ni).netPnl>=0?"+":"")??""}${zs(i(ni).netPnl,2)??""}`)),_(Lo),_(hd);var qa=v(hd,2),Zc=y(qa),Eo=y(Zc);Ne(()=>tt(Eo,`Net (from trades): ${(i(Gf)>=0?"+":"")??""}${Ul(i(Gf))??""}`)),_(Zc);var Fa=v(Zc,2),il=y(Fa);Ne(()=>tt(il,`Initial: ${zs(i(ni).initialCapital,2)??""}`)),_(Fa);var Hl=v(Fa,2),Bf=y(Hl);Ne(()=>tt(Bf,`Final: ${zs(i(ni).finalEquity,2)??""}`)),_(Hl),_(qa),_(Pg),_(Un),Ne(()=>{Fi(Ha,`${`kpi-value mono ${i(ni).netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),tt(md,i(vc).total),tt(xu,`L ${i(vc).entryLong??""}/${i(vc).exitLong??""} • S ${i(vc).entryShort??""}/${i(vc).exitShort??""}`),Hf(nu,i(zt)),Hf(jm,i(Qt)),Hf(_m,i(ho)),Kp.disabled=f(),Hf(Bm,i(ro)),Om.disabled=!i(ni),tt(Gh,i(ni).trades),tt(Lp,`Wins ${i(ni).wins??""} • Loss ${i(ni).losses??""} `),tt(Ov,`Trades ${i(eu).long.trades??""}`),tt(Wv,`Trades ${i(eu).short.trades??""}`),tt(kn,i(xo)),rr(Jn,"active",i(tu)==="1w"),rr(Kt,"active",i(tu)==="1m"),rr(Zt,"active",i(tu)==="3m"),rr(an,"active",i(tu)==="6m"),rr(rs,"active",i(tu)==="1y"),rr(Sn,"active",i(tu)==="5y"),rr(Xs,"active",i(tu)==="all"),Fi(Lo,`${`pnl-item ${i(ni).netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),ld("pointerleave",Ps,()=>{x(me,null)}),ld("pointerleave",bl,()=>{x(Le,null)}),Y(Ln,Un)}),_(Wt),Y(ot,Wt)},null,!0),Y(ne,fe)});var bv=v(Ev,2);Ye(bv,()=>i(pn),ne=>{var fe=nse();fe.__click=[O5,pn];var qe=y(fe);qe.__click=[Xne];var ot=y(qe),Wt=y(ot),Ct=y(Wt,!0);_(Wt);var un=v(Wt,2),Ln=y(un),Un=y(Ln);Un.__click=[Zne,Qs];var Ws=v(Un,2);Ws.__click=[Jne,Qs],_(Ln);var bo=v(Ln,2);bo.__click=[O5,pn],_(un),_(ot);var Ts=v(ot,2),Oo=y(Ts);Ye(Oo,()=>Wn[i(gn)],_i=>{var to=tse(),Ha=tn(to);Ro(Ha,21,()=>Wn[i(gn)][i(Qs)].desc,fi,(yl,Ml)=>{var Gl=Qne(),wd=y(Gl,!0);_(Gl),Ne(()=>tt(wd,i(Ml))),Y(yl,Gl)}),_(Ha);var Ta=v(Ha,2),dl=v(y(Ta),2);Ro(dl,21,()=>Wn[i(gn)][i(Qs)].examples,fi,(yl,Ml)=>{var Gl=ese(),wd=y(Gl,!0);_(Gl),Ne(()=>tt(wd,i(Ml))),Y(yl,Gl)}),_(dl),_(Ta),Y(_i,to)}),_(Ts),_(qe),_(fe),Ne(()=>{var _i,to;tt(Ct,(to=(_i=Wn[i(gn)])==null?void 0:_i[i(Qs)])==null?void 0:to.title),rr(Un,"active",i(Qs)==="en"),rr(Ws,"active",i(Qs)==="bn")}),Y(ne,fe)});var lh=v(bv,2);Ye(lh,()=>i(te),ne=>{var fe=dse();fe.__click=[B5,te];var qe=y(fe);qe.__click=[sse];var ot=y(qe),Wt=v(y(ot),2),Ct=y(Wt);Ct.__click=[B5,te],_(Wt),_(ot);var un=v(ot,2),Ln=y(un),Un=y(Ln),Ws=v(y(Un),2);mn(Ws),Ws.__keydown=[ose,We];var bo=v(Ws,2),Ts=y(bo);Ts.__click=We,Di(2),_(bo),_(Un),_(Ln);var Oo=v(Ln,2),_i=y(Oo),to=v(y(_i),2),Ha=y(to);Ye(Ha,()=>i(L),Ml=>{var Gl=ise();Y(Ml,Gl)},Ml=>{var Gl=Yn(),wd=tn(Gl);Ye(wd,()=>i(z).length===0,fc=>{var md=rse();Y(fc,md)},fc=>{var md=Yn(),Yp=tn(md);Ro(Yp,17,()=>i(z),fi,(xu,Xd)=>{var vo=lse();vo.__click=[ase,de,Xd];var go=y(vo),yi=y(go,!0);_(go);var Jr=v(go,2),Yl=y(Jr,!0);Ne(()=>tt(Yl,st(i(Xd).updatedAt))),_(Jr),_(vo),Ne(()=>{Fi(vo,`save-row ${(i(de)===i(Xd).id?"selected":"")??""} svelte-1ehcy4i`),tt(yi,i(Xd).name)}),Y(xu,vo)}),Y(fc,md)},!0),Y(Ml,Gl)}),_(to);var Ta=v(to,2),dl=y(Ta);dl.__click=[cse,de,He],Di(2),_(Ta),_(_i),_(Oo);var yl=v(Oo,2);Ye(yl,()=>i(J),Ml=>{var Gl=use(),wd=y(Gl,!0);_(Gl),Ne(()=>tt(wd,i(J))),Y(Ml,Gl)}),_(un),_(qe),_(fe),Ne(()=>{Ts.disabled=i(le),dl.disabled=!i(de)||i(le)}),As(Ws,()=>i(pe),Ml=>x(pe,Ml)),Y(ne,fe)});var ch=v(lh,2);Ye(ch,()=>i(N),ne=>{var fe=kse();fe.__click=[j5,N];var qe=y(fe);qe.__click=[fse];var ot=y(qe),Wt=v(y(ot),2),Ct=y(Wt);Ct.__click=[QJ,ce];var un=v(Ct,2);un.__click=[j5,N],_(Wt),_(ot);var Ln=v(ot,2),Un=y(Ln);mn(Un);var Ws=v(Un,2),bo=y(Ws);Ne(()=>tt(bo,`${St().length??""} scripts`)),_(Ws),_(Ln);var Ts=v(Ln,2);Ye(Ts,()=>i(D),to=>{var Ha=pse(),Ta=y(Ha,!0);_(Ha),Ne(()=>tt(Ta,i(D))),Y(to,Ha)});var Oo=v(Ts,2),_i=y(Oo);Ye(_i,()=>i(L),to=>{var Ha=mse();Y(to,Ha)},to=>{var Ha=Yn(),Ta=tn(Ha);Ye(Ta,()=>St().length===0,dl=>{var yl=hse();Y(dl,yl)},dl=>{var yl=wse();Ro(yl,21,St,fi,(Ml,Gl)=>{var wd=xse(),fc=y(wd),md=y(fc),Yp=y(md,!0);_(md);var xu=v(md,2),Xd=y(xu);Ne(()=>tt(Xd,`Updated ${st(i(Gl).updatedAt)??""}`)),_(xu),_(fc);var vo=v(fc,2),go=y(vo);go.__click=[vse,Lt,Gl];var yi=v(go,2);yi.__click=[gse,Tt,Gl];var Jr=v(yi,2);Jr.__click=[_se,Pt,Gl];var Yl=v(Jr,2);Yl.__click=[yse,et,Gl];var Eu=v(Yl,2);Eu.__click=[bse,Ue,Gl],_(vo),_(wd),Ne(()=>tt(Yp,i(Gl).name)),Y(Ml,wd)}),_(yl),Y(dl,yl)},!0),Y(to,Ha)}),_(Oo),_(qe),_(fe),Ne(()=>Ct.disabled=i(L)),As(Un,()=>i($),to=>x($,to)),Y(ne,fe)});var ig=v(ch,2),uh=y(ig),rg=y(uh),sp=v(rg,2),O0=y(sp,!0);_(sp);var Cg=v(sp,2);return Ye(Cg,()=>typeof i(dn)=="function"?i(dn)():i(dn),ne=>{var fe=Cse();const qe=At(()=>typeof i(dn)=="function"?i(dn)():i(dn));Ne(()=>Dt(fe,"title",typeof i(uo)=="function"?i(uo)():i(uo)));var ot=v(y(fe),2),Wt=y(ot,!0);_(ot);var Ct=v(ot,2),un=y(Ct),Ln=y(un,!0);_(un);var Un=v(un,2);Ro(Un,17,()=>i(qe).lines,fi,(Ws,bo)=>{var Ts=Sse(),Oo=y(Ts,!0);_(Ts),Ne(()=>tt(Oo,i(bo))),Y(Ws,Ts)}),_(Ct),_(fe),Ne(()=>{Fi(fe,`${`footer-alert ${i(qe).kind}`??""} svelte-1ehcy4i`),tt(Wt,i(qe).label),tt(Ln,i(qe).title)}),Y(ne,fe)}),_(uh),Di(2),_(ig),_(os),Ne(()=>{Dt(os,"aria-hidden",!u()),rr(os,"fullpage",i(Dn)),rr(fr,"selected",i(Ce)==="editor"),rr(pr,"selected",i(Ce)==="errors"),rr(pr,"has-errors",i(Ki)>0),rr(pr,"has-warnings",i(Ki)===0&&i(Xi)>0),tt(Kc,i(Jt)),rr(Rr,"selected",i(Ce)==="results"),Dt(Nf,"aria-pressed",i(It)),tt(yv,`Labels ${(i(It)?"On":"Off")??""}`),kg.disabled=f(),tt(Op,f()?"Running...":"Run"),rr($m,"hidden",i(Ce)!=="editor"),tt(Nh,`inline-script.${i(Ii)??""}`),tt(ah,`Lines: ${i(Ae)??""}`),rr(Lv,"monaco-mode",i(An)!=="failed"),Fi(rg,`footer-dot ${(r()?"error":f()?"running":"ok")??""} svelte-1ehcy4i`),tt(O0,i(rn))}),po(Lc,()=>i(Te),ne=>x(Te,ne)),Y(n,os),Ed({setEditorCode:it})}Tp(["pointerdown","click","input","change","keydown","pointermove"]);const Mse=[{id:"js-basic-plot",title:"JS basic plot",format:"js",description:"Plot close as a line (JS mode).",code:`// @lang js
export function onBar(ctx) {
  plot(ctx.close, { color: "#22c55e", title: "Close" });
}`},{id:"js-draw-demo",title:"JS draw tools demo",format:"js",description:"Labels, lines, boxes, and a table updated each bar (draw ops are capped).",code:`// @lang js
let statsTable;

export function onInit(ctx) {
  statsTable = table.new("top_right", 2, 2, {
    bgcolor: "rgba(15, 23, 42, 0.85)",
    text_color: "#e2e8f0",
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  plot(ctx.close, { color: "#38bdf8", title: "Close", pane: "main" });

  const every = i % 20 === 0;
  plotshape(every, { style: "cross", location: "abovebar", color: "#f97316" });

  if (every) {
    label.new(ctx.bar_index, ctx.high, "Pulse", {
      style: "label",
      color: "#0f172a",
      textcolor: "#f8fafc",
      avoidOverlap: true,
    });
    line.new(i - 1, ctx.low, i + 1, ctx.high, {
      color: "#22c55e",
      width: 1,
    });
    box.new(i - 2, ctx.high, i + 2, ctx.low, {
      border_color: "#f59e0b",
      bgcolor: "rgba(245, 158, 11, 0.15)",
    });
  }

  if (statsTable) {
    table.cell(statsTable, 0, 0, "Bar");
    table.cell(statsTable, 1, 0, String(i));
  }
}`},{id:"js-heatmap-raster",title:"JS heatmap raster",format:"js",description:"WebGL heatmap raster with bar_index + price anchors.",code:`// @lang js
let hm;

export function onInit(ctx) {
  hm = heatmap.new({
    id: "vol_heat",
    pane: "sub",
    xloc: "bar_index",
    opacity: 0.85,
    xBinPx: 6,
    yBinPx: 6,
    agg: "avg",
    blend: "screen",
    colormap: [
      { stop: 0, color: "#0f172a" },
      { stop: 0.4, color: "#1d4ed8" },
      { stop: 0.7, color: "#22c55e" },
      { stop: 1, color: "#f59e0b" },
    ],
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  if (i % 3 === 0) {
    const range = Number(ctx.high) - Number(ctx.low);
    heatmap.push(hm, i, Number(ctx.close), range);
  }
  plot(ta.ema(ctx.close, 20), { color: "#38bdf8", title: "EMA 20" });
}`},{id:"js-gradient-demo",title:"JS gradient demo",format:"js",description:"Area + callout + candle gradients in one script.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.ema(ctx.close, 20), {
    type: "area",
    gradient: { from: "rgba(96,165,250,0.35)", to: "rgba(34,197,94,0.12)", mode: "vertical" },
  });

  plotshape(Number(ctx.bar_index) % 25 === 5, {
    style: "callout",
    text: "BUY",
    location: "belowbar",
    bgGradient: { from: "#16a34a", to: "#22c55e", mode: "horizontal" },
  });

  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, {
    gradient: { from: "rgba(34,197,94,0.45)", to: "rgba(34,197,94,0.1)" },
    downGradient: { from: "rgba(239,68,68,0.45)", to: "rgba(239,68,68,0.1)" },
  });
}`},{id:"js-str-color-demo",title:"JS strings + color utils",format:"js",description:"str.format + str.upper + color.from_gradient + hsl.",code:`// @lang js
let badge;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;

  const price = str.tostring(ctx.close, "0.00");
  const tag = str.format("sig {0}", str.pad_left(ctx.bar_index, 4, "0"));
  const text = str.upper(str.format("{0} @ {1}", tag, price));

  const mix = color.from_gradient("#22c55e", "#ef4444", 0.25);
  const bg = color.set_alpha(mix, 0.18);
  const fg = color.hsl(210, 80, 60);

  badge = label.new(ctx.bar_index, ctx.high, text, {
    style: "label",
    color: bg,
    textcolor: fg,
    size: "small",
  });
}`},{id:"js-polygon-demo",title:"JS polygon overlay",format:"js",description:"Polygon overlay (GPU accelerated when WebGL is enabled).",code:`// @lang js
let poly;

export function onBar(ctx) {
  const x0 = ctx.bar_index - 2;
  const x1 = ctx.bar_index - 1;
  const x2 = ctx.bar_index;
  const y0 = ctx.low;
  const y1 = ctx.high;
  const y2 = ctx.low;

  if (!poly) {
    poly = polygon.new(
      x0, y0,
      x1, y1,
      x2, y2,
      {
        fillColor: "rgba(56, 189, 248, 0.25)",
        strokeColor: "#38bdf8",
        strokeWidth: 2,
        strokeStyle: "dashed",
        includeInAutoscale: false,
      }
    );
  }

  polygon.set_points(poly, x0, y0, x1, y1, x2, y2);
}`},{id:"js-overlay-basic",title:"JS overlay templates",format:"js",description:"Template-based overlay (rect) created via overlay.new.",code:`// @lang js
let rect;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  const i = Number(ctx.bar_index);
  if (i !== last) return;
  const low = Number(ctx.low);
  const high = Number(ctx.high);
  if (!Number.isFinite(low) || !Number.isFinite(high)) return;

  rect = overlay.new(
    "rect",
    [
      { index: last - 20, value: low },
      { index: last, value: high },
    ],
    { styles: { polygon: { color: "rgba(14, 165, 233, 0.18)" } } }
  );
}`},{id:"js-overlay-fib-labels",title:"JS overlay fib labels (left)",format:"js",description:"Fibonacci overlay with labels placed on the left side of the levels.",code:`// @lang js
let fib;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;

  fib = overlay.new(
    "fibonacciSegment",
    [
      { extreme: "low", lookback: 300 },
      { extreme: "high", lookback: 300 },
    ],
    {
      extendData: {
        labelSide: "left",
        labelOffset: 16,
        labelAlign: "right",
        fibonacciLevels: [
          { value: 0, color: "#64748b", label: "0", visible: true },
          { value: 0.382, color: "#60a5fa", label: "0.382", visible: true },
          { value: 0.5, color: "#22c55e", label: "0.5", visible: true },
          { value: 0.618, color: "#f59e0b", label: "0.618", visible: true },
          { value: 1, color: "#64748b", label: "1", visible: true },
        ],
      },
    }
  );
}`},{id:"js-primitives-advanced",title:"JS primitives (glow + gradient)",format:"js",description:"Polyline glow + polygon gradient fill (WebGL or Canvas fallback).",code:`// @lang js
let poly;
let pl;

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  const lowRaw = Number(ctx.low);
  const highRaw = Number(ctx.high);
  const low = Number.isFinite(lowRaw) ? lowRaw : Number(ctx.hist(ctx.low, 1));
  const high = Number.isFinite(highRaw) ? highRaw : Number(ctx.hist(ctx.high, 1));
  const mid = (low + high) / 2;

  if (!poly) {
    poly = polygon.new(
      i - 6, low,
      i - 3, high,
      i, low,
      {
        fillGradient: { from: "rgba(59, 130, 246, 0.35)", to: "rgba(34, 197, 94, 0.12)", mode: "vertical" },
        strokeColor: "#38bdf8",
        strokeWidth: 2,
        glow: 6,
        glowColor: "rgba(56, 189, 248, 0.7)",
        glowOpacity: 0.35,
        includeInAutoscale: false,
      }
    );
  }

  if (!pl) {
    pl = polyline.new(
      i - 4, mid,
      i - 2, high,
      i, mid,
      {
        color: "#f59e0b",
        width: 2,
        glow: 5,
        glowColor: "rgba(245, 158, 11, 0.75)",
        glowOpacity: 0.35,
        includeInAutoscale: false,
      }
    );
  }

  polygon.set_points(poly, i - 6, low, i - 3, high, i, low);
  polyline.set_points(pl, i - 4, mid, i - 2, high, i, mid);

  plot(ta.ema(ctx.close, 20), { color: "#22c55e", title: "EMA 20" });
}`},{id:"js-ema-color-segments",title:"JS EMA color segments",format:"js",description:"Color-switching EMA using fixed polyline segments.",code:`// @lang js
const WINDOW = 140;
let emaHist = [];
let closeHist = [];
let handles = [];

function initHandles() {
  if (handles.length) return;
  for (let i = 0; i < WINDOW; i++) {
    handles.push(
      polyline.new(0, 0, 0, 0, {
        color: "#3b82f6",
        width: 2,
        when: 0,
        includeInAutoscale: false,
      })
    );
  }
}

export function onBar(ctx) {
  const ema = Number(ta.ema(ctx.close, 20));
  const close = Number(ctx.close);
  if (!Number.isFinite(ema) || !Number.isFinite(close)) return;

  emaHist.push(ema);
  closeHist.push(close);
  if (emaHist.length > WINDOW + 1) {
    emaHist.shift();
    closeHist.shift();
  }

  initHandles();
  const lastX = Number(ctx.bar_index);
  const len = emaHist.length;

  for (let s = 0; s < WINDOW; s++) {
    const i1 = len - WINDOW + s;
    const i0 = i1 - 1;
    const h = handles[s];
    if (i0 < 0 || i1 <= 0 || i1 >= len) {
      polyline.set_points(h, 0, 0, 0, 0, { when: 0 });
      continue;
    }

    const x0 = lastX - (len - 1 - i0);
    const x1 = lastX - (len - 1 - i1);
    const y0 = emaHist[i0];
    const y1 = emaHist[i1];
    const color = closeHist[i1] >= emaHist[i1] ? "#3b82f6" : "#ef4444";

    polyline.set_points(h, x0, y0, x1, y1, { color, width: 2, when: 1 });
  }
}
`},{id:"js-interaction-runtime",title:"JS interaction (drag shapes)",format:"js",description:"Drag the last-bar line/polyline/polygon to test snapping + hit-testing.",code:`// @lang js
export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  const lastIdx = ctx.bar_index.data.length - 1;
  const lowRaw = Number(ctx.low);
  const highRaw = Number(ctx.high);
  const low = Number.isFinite(lowRaw) ? lowRaw : Number(ctx.hist(ctx.low, 1));
  const high = Number.isFinite(highRaw) ? highRaw : Number(ctx.hist(ctx.high, 1));
  if (!Number.isFinite(low) || !Number.isFinite(high)) return;
  const mid = (low + high) / 2;
  const when = i === lastIdx;

  polyline.new(
    i - 6, mid,
    i - 3, high,
    i, mid,
    { color: "#22c55e", width: 2, includeInAutoscale: false, when }
  );

  polygon.new(
    i - 9, low,
    i - 4, high,
    i + 1, low,
    {
      fillColor: "rgba(56, 189, 248, 0.2)",
      strokeColor: "#38bdf8",
      strokeWidth: 2,
      when,
      includeInAutoscale: false,
    }
  );

  line.new(i - 12, low, i, high, {
    color: "#f59e0b",
    width: 1,
    when,
    includeInAutoscale: false,
  });
}`},{id:"js-loop-average",title:"JS loop average",format:"js",description:"Simple looped average using ctx.hist (offsets must be integer >= 0).",code:`// @lang js
export function onBar(ctx) {
  let sum = 0;
  for (let i = 0; i < 5; i++) {
    sum += ctx.hist(ctx.close, i);
  }
  const avg = sum / 5;
  plot(avg, { color: "#e879f9", title: "Avg(5)", pane: "sub" });
}`},{id:"js-ta-macd",title:"JS ta.macd",format:"js",description:"MACD with SMA/EMA overlays using ta.*.",code:`// @lang js
export function onBar(ctx) {
  const smaFast = ta.sma(ctx.close, 10);
  const emaSlow = ta.ema(ctx.close, 30);
  plot(smaFast, { color: "#60a5fa", title: "SMA 10" });
  plot(emaSlow, { color: "#f59e0b", title: "EMA 30" });

  const [macdLine, signalLine, hist] = ta.macd(ctx.close, 12, 26, 9);
  plot(macdLine, { color: "#22c55e", title: "MACD", pane: "sub" });
  plot(signalLine, { color: "#ef4444", title: "Signal", pane: "sub" });
  plot(hist, { color: "#94a3b8", title: "Hist", pane: "sub", type: "histogram" });
}`},{id:"js-ta-extended-mas",title:"JS ta extended MAs",format:"js",description:"DEMA/TEMA/HMA/KAMA/ALMA/T3/TRIMA/SWMA/EVWMA family.",code:`// @lang js
export function onBar(ctx) {
  const src = ctx.close;
  plot(ta.dema(src, 20), { title: "DEMA", color: "#ef4444", pane: "sub" });
  plot(ta.tema(src, 20), { title: "TEMA", color: "#f97316", pane: "sub" });
  plot(ta.hma(src, 20), { title: "HMA", color: "#eab308", pane: "sub" });
  plot(ta.kama(src, 10, 2, 30), { title: "KAMA", color: "#22c55e", pane: "sub" });
  plot(ta.alma(src, 20, 0.85, 6), { title: "ALMA", color: "#14b8a6", pane: "sub" });
  plot(ta.t3(src, 10, 0.7), { title: "T3", color: "#3b82f6", pane: "sub" });
  plot(ta.trima(src, 20), { title: "TRIMA", color: "#8b5cf6", pane: "sub" });
  plot(ta.swma(src, 20), { title: "SWMA", color: "#ec4899", pane: "sub" });
  plot(ta.evwma(src, ctx.volume, 20), { title: "EVWMA", color: "#0ea5e9", pane: "sub" });
}`},{id:"js-ta-extended-osc",title:"JS ta extended oscillators",format:"js",description:"CMO/TSI/StochRSI/PPO/TRIX/AO/ZScore/ATRP/NATR set.",code:`// @lang js
export function onBar(ctx) {
  const src = ctx.close;
  plot(ta.cmo(src, 14), { title: "CMO", color: "#ef4444", pane: "sub" });
  plot(ta.tsi(src, 25, 13), { title: "TSI", color: "#f97316", pane: "sub" });
  plot(ta.stochrsi(src, 14, 3, 3), { title: "StochRSI", color: "#eab308", pane: "sub" });
  plot(ta.ppo(src, 12, 26), { title: "PPO", color: "#22c55e", pane: "sub" });
  plot(ta.trix(src, 9), { title: "TRIX", color: "#0ea5e9", pane: "sub" });
  plot(ta.ao(), { title: "AO", color: "#8b5cf6", pane: "sub" });
  plot(ta.zscore(src, 20), { title: "ZScore", color: "#14b8a6", pane: "sub" });
  plot(ta.atrp(14), { title: "ATRP", color: "#94a3b8", pane: "sub" });
  plot(ta.natr(14), { title: "NATR", color: "#64748b", pane: "sub" });
}`},{id:"js-ta-extended-volume",title:"JS ta extended volume",format:"js",description:"AD + CMF volume indicators.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.ad(), { title: "AD", color: "#8b5cf6", pane: "sub" });
  plot(ta.cmf(20), { title: "CMF", color: "#22c55e", pane: "sub" });
}`},{id:"js-ta-uo-cog-bbw",title:"JS ta UO/COG/BBW",format:"js",description:"Ultimate oscillator, center of gravity, and band width.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.uo(7, 14, 28), { title: "UO", color: "#22c55e", pane: "sub" });
  plot(ta.cog(ctx.close, 10), { title: "COG", color: "#3b82f6", pane: "sub" });
  plot(ta.bbw(ctx.close, 20, 2), { title: "BBW", color: "#ef4444", pane: "sub" });
}`},{id:"js-ta-pivot-tr",title:"JS ta pivots + TR",format:"js",description:"Pivot highs/lows, pivot points, and true range.",code:`// @lang js
export function onBar(ctx) {
  const left = 3;
  const right = 3;
  const ph = ta.pivothigh(ctx.high, left, right);
  const pl = ta.pivotlow(ctx.low, left, right);

  plot(ph, { title: "Pivot High", color: "#f97316", offset: -right });
  plot(pl, { title: "Pivot Low", color: "#22c55e", offset: -right });

  const piv = ta.pivot_points(20, "classic");
  plot(piv.pp, { title: "PP", color: "#38bdf8" });
  plot(piv.r1, { title: "R1", color: "#ef4444" });
  plot(piv.s1, { title: "S1", color: "#22c55e" });

  plot(ta.tr(), { title: "TR", color: "#94a3b8", pane: "sub" });
}`},{id:"js-mtf-htf-ema",title:"JS MTF (HTF EMA)",format:"js",description:"Higher-timeframe close + EMA using request.security.",code:`// @lang js
const htfCloseExpr = (s) => s.close;
const htfEmaExpr = (s, env) => env.ta.ema(s.close, 20);

export function onBar(ctx) {
  const htfClose = request.security("240", htfCloseExpr);
  const htfEma = request.security("240", htfEmaExpr);
  plot(htfClose, { color: "#38bdf8", title: "HTF Close" });
  plot(htfEma, { color: "#f59e0b", title: "HTF EMA 20" });
}`},{id:"js-mtf-lower-tf",title:"JS MTF (LTF Close)",format:"js",description:"Lower-timeframe close using request.security_lower_tf.",code:`// @lang js
const ltfCloseExpr = (s) => s.close;

export function onBar(ctx) {
  const ltfClose = request.security_lower_tf("5", ltfCloseExpr);
  plot(ltfClose, { color: "#22c55e", title: "LTF Close (5m)" });
}`},{id:"js-mtf-multi-symbol",title:"JS MTF (multi-symbol)",format:"js",description:"Multi-symbol HTF series via request.security(symbol, tf, expr). Set symbols if available.",code:`// @lang js
const closeExpr = (s) => s.close;

export function onBar(ctx) {
  const symB = ctx.input("Symbol B (optional)", "");
  const symC = ctx.input("Symbol C (optional)", "");
  const bbb = symB
    ? request.security(symB, "240", closeExpr)
    : request.security("240", closeExpr);
  const ccc = symC
    ? request.security(symC, "60", closeExpr)
    : request.security("60", closeExpr);
  plot(bbb, { color: "#22c55e", title: "BBB 240" });
  plot(ccc, { color: "#f97316", title: "CCC 60" });
}`},{id:"js-math-color",title:"JS math + color",format:"js",description:"math.mod and color.new usage on plots.",code:`// @lang js
export function onBar(ctx) {
  const spread = math.max(ctx.high, ctx.low) - math.min(ctx.high, ctx.low);
  plot(spread, { color: color.new(color.teal, 20), title: "Spread", pane: "sub" });

  const tick = math.mod(ctx.bar_index, 10);
  plot(tick, { color: color.rgb(239, 68, 68), title: "Mod(10)", pane: "sub" });
}`},{id:"js-plot-fill-advanced",title:"JS plot + fill (advanced)",format:"js",description:"Advanced plot types with fill and hline.",code:`// @lang js
export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastPlot = plot(fast, { color: "#38bdf8", type: "neon_line", width: 2 });
  const slowPlot = plot(slow, { color: "#f59e0b", type: "bezier_line", width: 2 });
  fill(fastPlot, slowPlot, { color: "rgba(59, 130, 246, 0.12)" });
  hline(0, { color: "#64748b", style: "dashed", pane: "sub" });
  plot(Number(fast) - Number(slow), { color: "#f472b6", title: "Diff", pane: "sub", type: "area" });
}`},{id:"js-plot-advanced",title:"JS plot advanced (histogram)",format:"js",description:"Histogram + hline in sub pane with cross-only plotshape/plotchar.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);

  plot(fast, { color: "#38bdf8", type: "neon_line", width: 2 });
  plot(slow, { color: "#f59e0b", type: "bezier_line", width: 2 });

  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const diff = fastNow - slowNow;
  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  plot(diff, { type: "histogram", color: "#94a3b8", pane: "sub" });
  hline(0, { color: "#64748b", style: "dashed", pane: "sub" });

  plotshape(crossUp, {
    style: "triangle_up",
    location: "abovebar",
    color: "#22c55e",
    text: "UP",
  });
  plotchar(crossDown, {
    char: "x",
    location: "belowbar",
    color: "#ef4444",
  });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-draw-options-parity",title:"JS draw options parity",format:"js",description:"Labels/lines/boxes/tables with advanced styling + layer/zIndex.",code:`// @lang js
let stats;

export function onInit() {
  stats = table.new("top_right", 2, 2, {
    bgcolor: "rgba(15, 23, 42, 0.85)",
    frameColor: "#334155",
    frameWidth: 1,
    text_color: "#e2e8f0",
    text_halign: "center",
    text_valign: "middle",
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  plot(ctx.close, { color: "#38bdf8", title: "Close" });

  if (i % 25 === 0) {
    label.new(ctx.bar_index, ctx.high, "Pulse", {
      style: "flag",
      color: "#0f172a",
      textcolor: "#f8fafc",
      bgcolor: "rgba(59, 130, 246, 0.2)",
      borderColor: "#60a5fa",
      borderWidth: 1,
      align: "center",
      valign: "middle",
      padding: { left: 6, right: 6, top: 3, bottom: 3 },
      tooltip: "Label tooltip",
      layer: "overlay",
      zIndex: 5,
      includeInAutoscale: false,
    });

    line.new(i - 2, ctx.low, i + 2, ctx.high, {
      color: "#22c55e",
      width: 2,
      style: "dashed",
      extend: "right",
      layer: "overlay",
      zIndex: 2,
      includeInAutoscale: false,
    });

    box.new(i - 3, ctx.high, i + 3, ctx.low, {
      border_color: "#f59e0b",
      border_width: 1,
      bgcolor: "rgba(245, 158, 11, 0.12)",
      text: "Zone",
      text_halign: "center",
      text_valign: "middle",
      text_wrap: true,
      tooltip: "Box tooltip",
      layer: "background",
      zIndex: 1,
      includeInAutoscale: false,
    });
  }

  if (stats) {
    table.cell(stats, 0, 0, "Bar", { text_color: "#e2e8f0" });
    table.cell(stats, 1, 0, String(i), { text_color: "#38bdf8" });
    table.cell(stats, 0, 1, "Close", { text_color: "#e2e8f0" });
    table.cell(stats, 1, 1, String(ctx.close), {
      text_color: "#22c55e",
      bgcolor: "rgba(15, 23, 42, 0.5)",
    });
  }
}`},{id:"js-plotcandle-ohlc",title:"JS plotcandle + plotohlc",format:"js",description:"Custom candles/ohlc with colors.",code:`// @lang js
export function onBar(ctx) {
  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, {
    color: "rgba(34,197,94,0.35)",
    downColor: "rgba(239,68,68,0.35)",
    wickColor: "#94a3b8",
    borderColor: "#334155",
  });
  plotohlc(ctx.open, ctx.high, ctx.low, ctx.close, {
    color: "#0ea5e9",
    downColor: "#f97316",
  });
}`},{id:"js-alert-basic",title:"JS alert basic",format:"js",description:"Alert rules via alertcondition/alert (Alerts Center).",code:`// @lang js
export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) > Number(slow);

  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", {
    id: "ema_cross_up",
    frequency: "once_per_bar",
  });

  alert("Pulse", {
    when: Number(ctx.bar_index) % 50 === 0,
    id: "pulse",
  });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f59e0b", title: "EMA 21" });
}`},{id:"js-strategy-basic",title:"JS strategy basic",format:"js",description:"Entry/exit signals with backtest config.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.05 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastNow = Number(fast);
  const slowNow = Number(slow);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.close("L", { when: crossDown });

  plot(fast, { color: "#22c55e", title: "EMA 10" });
  plot(slow, { color: "#ef4444", title: "EMA 30" });
  plot(strategy.position_size, { color: "#94a3b8", title: "Pos Size", pane: "sub" });
  plot(strategy.equity, { color: "#38bdf8", title: "Equity", pane: "sub" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-bracket",title:"JS strategy bracket",format:"js",description:"Entry with stop/limit exits and bracket sizing.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.04, slippagePct: 0.02 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const atr = ta.atr(14);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  const stopPx = Number(ctx.close) - Number(atr) * 1.5;
  const limitPx = Number(ctx.close) + Number(atr) * 2.0;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.exit("L", { when: crossDown, stop: stopPx, limit: limitPx, qtyPct: 50 });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f97316", title: "EMA 21" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-advanced",title:"JS strategy advanced",format:"js",description:"Order types + bracket/trailing options with strategy.config.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({
    initialCapital: 10000,
    commissionType: "percent",
    commissionPct: 0.03,
    slippageType: "ticks",
    slippageTicks: 2,
    pyramiding: 2,
    orderSize: { type: "percent_of_equity", value: 50 },
    allowShort: true,
    execution: "intrabar_ohlc",
    fillMode: "volume",
    volumeFillPct: 50,
    timeInForce: "gtc",
  });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const atr = ta.atr(14);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, {
    when: crossUp,
    bracket: { stopLossPct: 1.5, takeProfitPct: 3, trailingStopPct: 1 },
    kind: "mit",
    price: Number(ctx.close) + Number(atr) * 0.5,
    tif: "ioc",
  });

  const stopEntry = Number(ctx.close) + Number(atr) * 0.8;
  const limitEntry = stopEntry + Number(atr) * 0.2;
  strategy.order("S", strategy.short, {
    when: crossDown,
    kind: "lit",
    price: stopEntry,
    limit: limitEntry,
    qty: 1,
    tif: "fok",
    slippageType: "abs",
    slippageAbs: Number(atr) * 0.1,
  });

  strategy.exit("L", {
    kind: "trailing_stop",
    trailPct: 1.2,
    trailPrice: ctx.close,
    qtyPct: 50,
    commissionType: "cash",
    commissionCash: 1.5,
  });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f97316", title: "EMA 21" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-accessors",title:"JS strategy accessors",format:"js",description:"Plot-only accessors for closed/open trade stats.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.02, pyramiding: 1 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastNow = Number(fast);
  const slowNow = Number(slow);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.close("L", { when: crossDown });

  plot(strategy.closedtrades.profit(0), { color: "#38bdf8", title: "Closed PnL", pane: "sub" });
  plot(strategy.closedtrades.net_profit(0), { color: "#22c55e", title: "Closed Net", pane: "sub" });
  plot(strategy.opentrades.profit(0), { color: "#f59e0b", title: "Open PnL", pane: "sub" });
  plot(strategy.closedtrades.fees(0), { color: "#94a3b8", title: "Closed Fees", pane: "sub" });

  plot(fast, { color: "#22c55e", title: "EMA 10" });
  plot(slow, { color: "#ef4444", title: "EMA 30" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-rsi-mean",title:"JS strategy RSI mean reversion",format:"js",description:"RSI oversold/overbought entries with limit orders.",code:`// @lang js
export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.02, pyramiding: 2 });
}

export function onBar(ctx) {
  const rsi = ta.rsi(ctx.close, 14);
  const rsiNow = Number(rsi);

  const longCond = Number.isFinite(rsiNow) && rsiNow < 30;
  const shortCond = Number.isFinite(rsiNow) && rsiNow > 70;

  const limitLong = Number(ctx.close) * 0.995;
  const limitShort = Number(ctx.close) * 1.005;

  strategy.order("RL", strategy.long, { when: longCond, limit: limitLong, qty: 1 });
  strategy.order("RS", strategy.short, { when: shortCond, limit: limitShort, qty: 1 });

  strategy.close("RL", { when: rsiNow > 55 });
  strategy.close("RS", { when: rsiNow < 45 });

  plot(rsi, { color: "#60a5fa", title: "RSI 14", pane: "sub" });
  plot(70, { color: "#94a3b8", title: "OB", pane: "sub" });
  plot(30, { color: "#94a3b8", title: "OS", pane: "sub" });
}`}];var Nse=Me('<span class="svelte-15ifth6"> </span>'),Ase=Me('<span class="svelte-15ifth6"> </span>'),Tse=Me('<span class="svelte-15ifth6"> </span>'),Fse=Me('<span class="svelte-15ifth6"> </span>'),Lse=Me(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="json-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Define indicators with calc + plots + labels + lines.</li> <li>Compose series with expression math and condition language.</li> <li>Add trading signals and optional backtest settings.</li> <li>Build multi-pane visuals with main/sub panes.</li></ul> <h3 id="json-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to JSON.</li> <li>Start from a minimal spec with one plot.</li> <li>Add calc or series definitions you want to draw.</li> <li>Click Run to render the chart overlays.</li></ol> <h3 id="json-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">calc</div> <p>Structured indicators (ema, rsi, macd, bbands, etc.).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">series</div> <p>Expression-based series (lag, add, mul, custom math).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">when vs whenExpr</div> <p>Use when for condition language, whenExpr for expressions.</p></div></div> <h3 id="json-supported" class="svelte-15ifth6">Supported features</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Calc types</div> <div class="ss-tag-list svelte-15ifth6"></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Plot types</div> <div class="ss-tag-list svelte-15ifth6"></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Label shapes</div> <div class="ss-tag-list svelte-15ifth6"></div></div></div> <h3 id="json-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>Every pane must include at least one plot/label/level/line.</li> <li>Template loops (repeat/forEach) expand at load time.</li> <li>Signals score must be integers between 0 and 10.</li></ul> <h3 id="json-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>Schema validation failed: check field names and types.</li> <li>pane has no plots/labels/levels/lines: add at least one.</li> <li>Missing series: define calc/series names used in plots.</li> <li>Condition parse failed: validate when syntax.</li> <li>Expressions: dotted calls (<code>ta.sma</code>/<code>math.max</code>/<code>session.isin</code>), dotted fields (<code>syminfo.*</code>/<code>barstate.*</code>/<code>strategy.*</code>/<code>timeframe.*</code>), and inline <code>//</code> comments are supported; if pasted code fails, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="json-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">Runnable JSON examples live in the Examples tab → JSON Examples. Suggested
              starting points: EMA baseline, Labels and shapes, Polyline + path, Layer
              ordering, Autoscale exclusion, Draw clear + loop.</p> <details class="ss-dev-notes svelte-15ifth6"><summary>For developers</summary> <div class="ss-dev-body svelte-15ifth6"><p>Feature flags (dev only):</p> <div class="ss-tag-list svelte-15ifth6"></div> <p>Guardrails:</p> <ul class="ss-list svelte-15ifth6"><li>VERIFY mode compares snapshots without updating.</li> <li>UPDATE_SNAPSHOTS=1 regenerates fixtures when intentional.</li></ul></div></details></section>`),Ese=Me(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="dsl-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Create quick signals and labels with a short syntax.</li> <li>Define simple series expressions (ema, highest, lowest).</li> <li>Attach scores and cooldowns to signals.</li></ul> <h3 id="dsl-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to DSL.</li> <li>Define series with <code>name = expr</code>.</li> <li>Add <code>signal ... when ...</code> and <code>label at ...</code>.</li> <li>Click Run to see labels and signal results.</li></ol> <h3 id="dsl-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Assignments</div> <p>Numbers become params; expressions become series.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Signals</div> <p>Use signal aliases like buy/sell/top/bot with when.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p>label at top/bot with text, color, and shape.</p></div></div> <h3 id="dsl-supported" class="svelte-15ifth6">Supported features</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Series</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">ema</span> <span class="svelte-15ifth6">sma</span> <span class="svelte-15ifth6">highest</span> <span class="svelte-15ifth6">lowest</span> <span class="svelte-15ifth6">lag</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Signals</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">signal buy/sell/top/bot</span> <span class="svelte-15ifth6">score</span> <span class="svelte-15ifth6">cooldown</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Labels</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">label at top/bot</span> <span class="svelte-15ifth6">text/color/shape</span></div></div></div> <h3 id="dsl-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>DSL is partial: no plots, no strategy blocks, no tables.</li> <li>Each line must follow a DSL command or assignment.</li></ul> <h3 id="dsl-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>signal ... when requires a condition: add a valid when.</li> <li>Unknown series: define the series before using it.</li> <li>Invalid score/cooldown: use numeric values only.</li> <li>Expressions: dotted calls (<code>ta.sma</code>/<code>math.max</code>/<code>session.isin</code>), dotted fields (<code>syminfo.*</code>/<code>barstate.*</code>/<code>strategy.*</code>/<code>timeframe.*</code>), and inline <code>//</code> comments are supported; if pasted code fails, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="dsl-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">DSL examples live in the Examples tab → DSL Examples. DSL is partial, so
              the list may be small compared to JSON/Pine.</p></section>`),$se=Me(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Changelog</a> <a class="svelte-15ifth6">How-to</a> <a class="svelte-15ifth6">Sessions</a> <a class="svelte-15ifth6">request.security</a> <a class="svelte-15ifth6">Not supported yet</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="pine-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Build overlay or oscillator indicators with Pine syntax.</li> <li>Use plots (plotcandle/plotbar/plotohlc/plotfill/plotarrow/hline), shapes, labels, lines, boxes, and draw.clear/for_each.</li> <li>Access history (x[n]), nz/na, and var state across bars.</li> <li>Use member fields like <code>syminfo.*</code>, <code>barstate.*</code>, <code>timeframe.*</code>, and <code>strategy.*</code>.</li> <li>Use arrays, time/date fields, and session filters.</li> <li>Use expanded ta.* (MA family + oscillators + channels + volume), including bbands/macd/stoch/cci/mfi/obv and kama/hma/tsi/supertrend/kdj/kst/uo/bbw.</li></ul> <h3 id="pine-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to Pine.</li> <li>Add <code>//@pine</code> and <code>//@version=5</code>.</li> <li>Define <code>indicator("Name", overlay=true/false)</code>.</li> <li>Create a series and call <code>plot()</code> or <code>plotshape()</code>.</li> <li>Click Run to render the overlays.</li></ol> <p class="ss-note svelte-15ifth6">Pine is strict and deterministic, with extra builtins and runtime validation.</p> <h3 id="pine-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Execution model</div> <p>Runs once per bar; each series is an array of values (no lookahead).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">History + na</div> <p>x[0] is current bar, x[1] previous; out-of-range =&gt; na.</p> <p>Negative index raises a diagnostic.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">State</div> <p><code>var</code> initializes once, <code>:=</code> updates the series.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Conditionals</div> <p>if/else and ternary return per-bar series values.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Line rendering</div> <p>Dash styles are deterministic and use pixel units (no zoom scaling).</p> <p>extend is viewport-clipped and recomputed on pan/zoom.</p> <p>xloc=time uses floor + clamp; bar_index requires integers.</p> <p>Line handles use stable ids; line.set after line.delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p>xloc bar_index/time is strict; bar_index requires integers.</p> <p>xloc=time floors to the previous bar and clamps before-first.</p> <p>textalign left/center/right, tooltip, size, color/textcolor.</p> <p>bgcolor/bordercolor/border_width supported; text/tooltip truncate (24/80).</p> <p>yloc supports price/abovebar/belowbar with fixed padding; location=location.* maps to yloc.</p> <p>label.set after delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Boxes</div> <p>xloc/extend/border_style/text_size/text_halign/text_valign are strict.</p> <p>xloc=time floors to previous bar and clamps before-first; bar_index requires integers.</p> <p>extend expands to viewport edges (left/right/both) using resolved indices.</p> <p>border_width must be 0..4; numeric text_size clamps 8..32.</p> <p>Dash arrays match line policy; text is single-line with fixed padding and truncation.</p> <p>Box cap: max 200 active boxes per script run; extra creates are skipped with a single diagnostic; delete/clear frees capacity.</p> <p>Box handles use stable ids; box.set after delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Arrays</div> <p>Numeric arrays: array.new_float/int + push/get/set/size/clear + pop/shift/unshift/insert/remove/resize.</p> <p>array.from(...) builds compile-time arrays (literals only, all numeric or all string, no mixed types).</p> <p>String arrays: array.new_string + push/get/set/size/clear.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Builtins</div> <p>math.mod/math.fmod, expanded ta.* (MA/oscillator/channel/volume families incl. kama/hma/tsi/stochrsi/supertrend/keltner/donchian/ad/cmf + kdj/kst/uo/bbw/pvi/nvi/vortex/cog), time/date functions (year(time)/hour(time)/timestamp()/timenow()/time_close()), and session.isin(time, "HHMM-HHMM") in UTC.</p></div></div> <h3 id="pine-supported" class="svelte-15ifth6">Supported features</h3> <p class="ss-note svelte-15ifth6">Verified by guardrails. Pine adds stricter validation and extra builtins.</p> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Core syntax (verified)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">if/else</span> <span class="svelte-15ifth6">ternary</span> <span class="svelte-15ifth6">var / :=</span> <span class="svelte-15ifth6">history x[n]</span> <span class="svelte-15ifth6">nz / na</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Plots + primitives</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plot</span> <span class="svelte-15ifth6">plotshape</span> <span class="svelte-15ifth6">plotchar</span> <span class="svelte-15ifth6">plotcandle</span> <span class="svelte-15ifth6">plotbar/plotohlc</span> <span class="svelte-15ifth6">plotfill/fill</span> <span class="svelte-15ifth6">plotarrow</span> <span class="svelte-15ifth6">hline</span> <span class="svelte-15ifth6">label.new</span> <span class="svelte-15ifth6">line.new</span> <span class="svelte-15ifth6">box.new</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Tables + paths (limited)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">table.new/table.cell</span> <span class="svelte-15ifth6">linefill.new</span> <span class="svelte-15ifth6">polyline.new</span> <span class="svelte-15ifth6">polygon.new</span> <span class="svelte-15ifth6">path.new</span></div> <p>linefill.set_* supports color/line1/line2; table.set_*/table.cell_set_* support a subset (unsupported methods warn).</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Line options (validation)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">style: solid/dashed/dotted</span> <span class="svelte-15ifth6">extend: none/left/right/both</span> <span class="svelte-15ifth6">xloc: bar_index/time</span> <span class="svelte-15ifth6">width: integer &gt;= 1</span></div> <p>Dash arrays: solid [], dashed [6,4] (width &gt;= 3 → [8,5]), dotted [2,4] (width &gt;= 3 → [3,5]).</p> <p>lineDashOffset is fixed to 0 for deterministic renders.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Line lifecycle</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">stable ids</span> <span class="svelte-15ifth6">in-place updates</span> <span class="svelte-15ifth6">delete diagnostics</span></div> <p>line.new ids are deterministic per script run; line.set_* updates in place.</p> <p>line.set_* after line.delete reports <code>line is deleted</code>.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Label options (validation)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">xloc: bar_index/time</span> <span class="svelte-15ifth6">textalign: left/center/right</span> <span class="svelte-15ifth6">size: tiny/small/normal/large/huge</span> <span class="svelte-15ifth6">style: up/down/circle/square/none</span> <span class="svelte-15ifth6">tooltip</span> <span class="svelte-15ifth6">yloc: price/abovebar/belowbar</span> <span class="svelte-15ifth6">location: abovebar/belowbar</span> <span class="svelte-15ifth6">bgcolor/bordercolor/border_width</span></div> <p>label.new ids are deterministic per script run; label.set_* updates in place.</p> <p>label.set_* after label.delete reports <code>label is deleted</code>.</p> <p>above/below defaults includeInAutoscale=false unless set explicitly.</p> <p>Size map: tiny=10, small=12, normal=14, large=16, huge=18; numeric sizes clamp 8..32.</p> <p>Text truncates at 24 chars; tooltip truncates at 80.</p> <p>Label cap: max 500 active labels per script run; extra creates are skipped with a single diagnostic; deleting labels frees capacity.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">plotshape/plotchar options</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">location.abovebar/belowbar</span> <span class="svelte-15ifth6">location.absolute</span> <span class="svelte-15ifth6">shape.triangleup/triangledown</span> <span class="svelte-15ifth6">shape.circle</span> <span class="svelte-15ifth6">shape.cross/xcross/diamond/flag</span> <span class="svelte-15ifth6">text/textcolor</span> <span class="svelte-15ifth6">size.tiny/small/large</span> <span class="svelte-15ifth6">offset</span> <span class="svelte-15ifth6">color</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Runtime draw</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">draw.clear</span> <span class="svelte-15ifth6">draw.for_each</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Arrays</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">array.new_float/int</span> <span class="svelte-15ifth6">array.push/get/set/size/clear</span> <span class="svelte-15ifth6">array.pop/shift/unshift/insert/remove/resize</span> <span class="svelte-15ifth6">array.from (const)</span> <span class="svelte-15ifth6">array.new_string (runtime)</span></div> <p>array.from is compile-time only and requires literal values (all numeric or all string).</p> <p>String arrays: runtime push/get/set/size/clear supported; pop/shift/unshift/insert/remove/resize are not supported yet.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">ta.* subset</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">ta.sma/ta.ema/ta.wma/ta.rma</span> <span class="svelte-15ifth6">ta.dema/ta.tema/ta.hma</span> <span class="svelte-15ifth6">ta.kama/ta.alma/ta.t3</span> <span class="svelte-15ifth6">ta.trima/ta.swma/ta.evwma</span> <span class="svelte-15ifth6">ta.atr/ta.atrp/ta.natr</span> <span class="svelte-15ifth6">ta.bbands</span> <span class="svelte-15ifth6">ta.keltner/ta.donchian</span> <span class="svelte-15ifth6">ta.supertrend</span> <span class="svelte-15ifth6">ta.sar</span> <span class="svelte-15ifth6">ta.macd</span> <span class="svelte-15ifth6">ta.stoch/ta.stochrsi</span> <span class="svelte-15ifth6">ta.cci</span> <span class="svelte-15ifth6">ta.mfi</span> <span class="svelte-15ifth6">ta.obv</span> <span class="svelte-15ifth6">ta.cmo/ta.tsi</span> <span class="svelte-15ifth6">ta.ppo/ta.trix/ta.ao</span> <span class="svelte-15ifth6">ta.zscore</span> <span class="svelte-15ifth6">ta.cog</span> <span class="svelte-15ifth6">ta.highest/ta.lowest</span> <span class="svelte-15ifth6">ta.williamsr</span> <span class="svelte-15ifth6">ta.aroon/ta.aroonosc</span> <span class="svelte-15ifth6">ta.dmi/ta.adx/ta.plus_di/ta.minus_di/ta.dx</span> <span class="svelte-15ifth6">ta.sum</span> <span class="svelte-15ifth6">ta.rising/ta.falling</span> <span class="svelte-15ifth6">ta.valuewhen</span> <span class="svelte-15ifth6">ta.pivothigh/low</span> <span class="svelte-15ifth6">ta.ad/ta.cmf</span> <span class="svelte-15ifth6">ta.kdj/ta.kst</span> <span class="svelte-15ifth6">ta.uo</span> <span class="svelte-15ifth6">ta.bbw</span> <span class="svelte-15ifth6">ta.pvi/ta.nvi</span> <span class="svelte-15ifth6">ta.vortex</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Time + session</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">year(time)/month(time)/dayofweek(time)</span> <span class="svelte-15ifth6">hour(time)/minute(time)/second(time)</span> <span class="svelte-15ifth6">timestamp(...)</span> <span class="svelte-15ifth6">timenow()</span> <span class="svelte-15ifth6">time_close()</span> <span class="svelte-15ifth6">session.isin(time, "HHMM-HHMM")</span></div></div></div> <h3 id="pine-changelog" class="svelte-15ifth6">Changelog</h3> <ul class="ss-list svelte-15ifth6"><li>Function bodies now support control flow (<code>if/for/while/switch</code>), <code>var/varip</code>, and <code>:=</code>.</li> <li>Loops run at runtime with <code>break</code>/<code>continue</code> and a configurable max-iteration cap.</li> <li>Added member access for <code>syminfo.*</code>/<code>barstate.*</code>/<code>timeframe.*</code>/<code>strategy.*</code> and parsing for indexed expressions.</li> <li>Comparisons propagate na (operators &lt;=, &gt;=, !=).</li> <li>Safe math: invalid domains return na; division by 0 returns na; diagnostics are one-time.</li> <li>Added math.mod/math.fmod and ta.williamsr/ta.aroon/ta.dmi/ta.adx (ta.sum alias).</li> <li>Added ta.plus_di/ta.minus_di/ta.dx/ta.aroonosc.</li> <li>Added ta.rising/ta.falling and strict ta.sum length validation.</li> <li>Added ta.highest/ta.lowest with strict length validation and na-aware windows.</li> <li>Expanded ta.* with MA/oscillator/channel/volume families (kama/hma/tsi/stochrsi/supertrend/keltner/donchian/ad/cmf + kdj/kst/uo/bbw/pvi/nvi/vortex/cog).</li> <li>Added plot.style_* mapping (stepline/histogram/area/cross/circles) and plotshape/plotchar offset + extra shapes.</li> <li>Area plots no longer fill across na gaps (prevents triangle artifacts).</li> <li>Script Studio issue panel now recognizes plotshape cross/xcross/diamond/flag/tag/pill/none and location.absolute/size.auto.</li> <li>Added line.style_arrow_* support for runtime line objects.</li> <li>Added string array runtime ops (array.new_string + push/get/set/size/clear).</li> <li>Ternary numeric branches now unify int/float results.</li> <li>Strict integer rules for history/array indices and bar_index xloc values.</li> <li>A4: unified truthiness + tri-value logical ops + short-circuit; when uses expression semantics.</li></ul> <h3 id="pine-howto" class="svelte-15ifth6">How-to</h3> <ul class="ss-list svelte-15ifth6"><li>Operators &lt;=, &gt;=, != are supported.</li> <li>Comparisons return numeric 1/0 and yield na if any input is na.</li> <li>Use parentheses to make complex arithmetic + comparisons explicit.</li> <li>Chained comparisons are supported in simple form (1 &lt; x &lt; 3, a &lt;= b &lt;= c).</li> <li>For complex chains, rewrite explicitly: (a &lt; b) and (b &lt; c).</li> <li>Unsupported in chains: == / !=, or chains mixed with and/or/not or ternary at the same level.</li></ul> <h3 id="pine-known-limitations" class="svelte-15ifth6">Known Limitations (Important)</h3> <p class="ss-note svelte-15ifth6">These are current engine limits. Watch diagnostics for warnings.</p> <p class="ss-note svelte-15ifth6"><strong>1) Color expressions/variables</strong></p> <ul class="ss-list svelte-15ifth6"><li>Supported color forms: "#RRGGBB", color.rgb(r,g,b), color.new(color, transp), input.color(...).</li> <li>Not reliably supported: computed/local color variables in plot/plotshape (e.g., myColor = color.rgb(...); plot(..., color=myColor)).</li> <li>Workaround: inline the color expression in the call or use input.color.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported
plot(close, color="#22c55e")
c = input.color("#22c55e", "C")
plot(close, color=c)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Warning
myColor = color.rgb(34, 197, 94)
plot(close, color=myColor)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Workaround
plot(close, color=color.rgb(34, 197, 94))
</code></pre> <p class="ss-note svelte-15ifth6"><strong>2) Function bodies</strong></p> <ul class="ss-list svelte-15ifth6"><li>Multi-line functions support <code>if/for/while/switch</code>, <code>var/varip</code>, and <code>:=</code> assignments.</li> <li>Implicit return uses the final expression or a final <code>if</code>/<code>switch</code> block; use <code>return</code> for early exits.</li> <li>Loop iteration caps apply inside functions too (see loop semantics below).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported
f(x) =>
  var acc = 0.0
  if x > 0
    acc := acc + x
  acc
plot(f(close))
</code></pre> <p class="ss-note svelte-15ifth6"><strong>3) Loop semantics</strong></p> <ul class="ss-list svelte-15ifth6"><li>for/while execute at runtime with <code>break</code>/<code>continue</code> support.</li> <li>for-loops run to completion when bounds are finite (no default cap).</li> <li>while-loops use a safety cap (default 1000) to prevent infinite loops; a warning is emitted if exceeded.</li> <li>Set <code>__loop_max_iters</code> via input to override the cap for all loops; set it to 0 for unlimited (use with care). Values above 1,000,000 are clamped.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported (small loop)
sum = 0.0
for i = 0 to 5
  sum := sum + i
plot(sum)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Warning
for i = 0 to bar_index
  sum := sum + i
plot(sum)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Workaround
plot(ta.sum(close, 5))
</code></pre> <h3 id="pine-boolean-policy" class="svelte-15ifth6">Boolean + na policy</h3> <ul class="ss-list svelte-15ifth6"><li>Conditions treat na as false; non-zero numbers are true.</li> <li>Conditions must be bool or number; string conditions are treated as false with a runtime warning.</li> <li>Tri-value logic: not(na) =&gt; na; na and false =&gt; false; na or true =&gt; true; other na cases propagate.</li> <li>and/or are short-circuit (skipped branches are not evaluated).</li> <li>Runtime warnings appear once per run per call-site.</li></ul> <h3 id="pine-ta-rules" class="svelte-15ifth6">ta.* rules</h3> <ul class="ss-list svelte-15ifth6"><li>ATR signatures: <code>ta.atr(length)</code>, <code>atr(length)</code>, and <code>atr(high, low, close, length)</code>.</li> <li>ATR uses true range + RMA (smma) smoothing; the seed is SMA of the first length values, so early bars are na.</li> <li>Lengths for ta.highest/ta.lowest/ta.sum/ta.rising/ta.falling must be integers &gt;= 1; invalid returns na with a runtime diagnostic.</li> <li>valuewhen occurrence must be integer &gt;= 0; invalid returns na with a runtime diagnostic.</li> <li>valuewhen conditions use A4 truthiness; na is treated as false (diagnostic once per call-site).</li> <li>highest/lowest ignore na inside the window; if all values are na, the result is na.</li> <li>Early bars use the available window up to the current bar (no warmup requirement).</li></ul> <h3 id="pine-stdlib" class="svelte-15ifth6">Standard Library Support</h3> <ul class="ss-list svelte-15ifth6"><li>math: <code>math.mod(a, b)</code> (modulus; sign follows divisor), <code>math.fmod(a, b)</code> (remainder; sign follows dividend). Divisor 0 returns na with a runtime diagnostic.</li> <li>str: <code>str.tostring</code>, <code>str.length</code>, <code>str.contains</code>, <code>str.replace</code>, <code>str.lower</code>, <code>str.upper</code>, <code>str.startswith</code>, <code>str.endswith</code>.</li> <li>color: <code>color.rgb</code>, <code>color.new</code>, <code>color.from_hex("#RRGGBB")</code>.</li> <li>ta: <code>ta.rma(src, len)</code> (Wilder's smoothing), <code>ta.tr()</code>/<code>ta.tr(high, low, close)</code>, <code>ta.vwap()</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// math + str
modv = math.mod(-5, 4)
ok = str.contains("alpha", "ph")
plot(modv)
plot(ok)

// color + ta
plot(close, color=color.from_hex("#ffcc00"))
plot(ta.vwap())
</code></pre> <p class="ss-note svelte-15ifth6"><strong>Known differences vs TradingView</strong></p> <ul class="ss-list svelte-15ifth6"><li>vwap() resets on UTC day boundaries using HLC3 * volume / volume (basic daily VWAP, not full session rules).</li> <li>math.mod uses mathematical modulus; math.fmod uses remainder (JS-style %).</li></ul> <h3 id="pine-session" class="svelte-15ifth6">Session filters</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>session.isin(time, "HHMM-HHMM")</code> to filter bars.</li> <li>Session strings must be string literals with an ASCII hyphen (no variables; e.g., "0930-1600").</li> <li>UTC time-of-day only (no exchange timezone yet).</li> <li>Wrap-around supported: <code>"2200-0200"</code> crosses midnight.</li> <li>Returns 1/0 (numeric) for plots or plotshape conditions.</li> <li>Invalid format errors with <code>session.isin session must be in HHMM-HHMM</code>.</li></ul> <h3 id="pine-request-security" class="svelte-15ifth6">request.security</h3> <p class="ss-note svelte-15ifth6">Pulls a series from another symbol/timeframe into the current chart.
              Uses server-backed candles when available, otherwise resamples chart candles.</p> <ul class="ss-list svelte-15ifth6"><li>Supported: HTF/MTF series, multi-symbol, lookahead/gaps flags.</li> <li>Pine accepts <code>ta.*</code> prefixes (e.g., <code>ta.ema</code>); the prefix is optional.</li> <li>Defaults: <code>lookahead=barmerge.lookahead_off</code>, <code>gaps=barmerge.gaps_off</code>.</li> <li>Lower TF: use <code>request.security_lower_tf</code> and the TF must be lower than the chart.</li> <li>Lower TF error: <code>request.security_lower_tf: "&lt;tf&gt;" must be lower than chart timeframe "&lt;chartTf&gt;"</code>.</li> <li>No silent fallback: lower TF without lower-TF candles is a hard error.</li> <li>Lower TF data error: <code>request.security error: request.security: lower timeframe "&lt;tf&gt;" is not available from current chart data (base ~&lt;N&gt;m). Switch chart timeframe lower or provide lower-TF datafeed.</code>.</li> <li>Invalid timeframe error: <code>request.security error: request.security: invalid timeframe "&lt;tf&gt;"</code>.</li> <li>Missing data errors: <code>request.security: no data for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>No overlap errors: <code>request.security: no overlap for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>Loading status: <code>Loading request.security: &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)... loaded &lt;oldest&gt;-&gt;&lt;newest&gt;</code>.</li> <li>Loading status (partial): <code>Loading request.security (partial): &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)... loaded &lt;oldest&gt;-&gt;&lt;newest&gt;</code>.</li></ul> <p class="ss-note svelte-15ifth6">Alignment: each base bar maps to the HTF bucket that contains its end time
              (next base open - 1ms). <code>lookahead_off</code> uses the previous confirmed
              HTF bar until the current HTF bar closes; <code>lookahead_on</code> uses the
              current HTF bar across the bucket. The last bar never confirms an HTF close.</p> <p class="ss-note svelte-15ifth6">Timezone: bucket boundaries use the symbol timezone when available, otherwise
              the chart timezone (UTC if none). Per-call timezone overrides are not supported.</p> <p class="ss-note svelte-15ifth6"><strong>Lookahead & gaps matrix</strong></p> <ul class="ss-list svelte-15ifth6"><li><code>lookahead_off + gaps_off</code>: updates on HTF close, carries forward across gaps (default).</li> <li><code>lookahead_off + gaps_on</code>: updates on HTF close, returns na inside gaps.</li> <li><code>lookahead_on + gaps_off</code>: updates within HTF bucket, carries forward across gaps.</li> <li><code>lookahead_on + gaps_on</code>: updates within HTF bucket, returns na inside gaps.</li></ul> <p class="ss-note svelte-15ifth6">Gap = missing HTF bucket or bucket mismatch. Use off/off for stable signals,
              on/on for live intrabucket updates with explicit gaps.</p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Default: stable signals
close_htf = request.security(syminfo.tickerid, "240", close,
  lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)

// Live within-bucket updates + explicit gaps
close_live = request.security(syminfo.tickerid, "240", close,
  lookahead=barmerge.lookahead_on, gaps=barmerge.gaps_on)
</code></pre> <p class="ss-note svelte-15ifth6">Not supported: nested <code>request.security</code> inside the expression,
              seconds-based timeframes, or synthetic lower-TF bars. Nested calls error: <code>request.security error: request.security: nested request.security inside security expression is not supported</code>.</p> <p class="ss-note svelte-15ifth6"><strong>Common errors</strong></p> <ul class="ss-list svelte-15ifth6"><li>No data: <code>request.security: no data for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>No overlap: <code>request.security: no overlap for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>Invalid timeframe: <code>request.security error: request.security: invalid timeframe "&lt;tf&gt;"</code>.</li> <li>Nested security: <code>request.security error: request.security: nested request.security inside security expression is not supported</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Multi-symbol compare
close_bbb = request.security("BBB", "240", close)
close_ccc = request.security("CCC", "240", close)
spread = close_bbb - close_ccc
plot(spread, title="BBB-CCC Spread")
</code></pre> <p class="ss-note svelte-15ifth6"><strong>request.security_lower_tf</strong></p> <p class="ss-note svelte-15ifth6">Use this to fetch a lower timeframe series than the chart. The requested
              timeframe must be strictly lower, and lower-TF candles must be available
              (no synthetic downsampling).</p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Lower-TF close from 5m on a 15m chart
close_ltf = request.security_lower_tf(syminfo.tickerid, "5", close)
plot(close_ltf, title="LTF Close")
</code></pre> <p class="ss-note svelte-15ifth6"><strong>Limits &amp; performance</strong></p> <ul class="ss-list svelte-15ifth6"><li>Limits (enforced): 16 calls, 8 symbols, 8 timeframes, 5000 bars per series.</li> <li>Limit errors: <code>request.security error: request.security: limit exceeded: &lt;reason&gt;</code>.</li> <li>Performance: internal caching avoids recompute; outputs are unchanged.</li></ul> <p class="ss-note svelte-15ifth6">If you hit limits, reduce calls/symbols/timeframes or use a higher timeframe.</p> <p class="ss-note svelte-15ifth6"><strong>Minimal examples</strong></p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// HTF EMA filter
ema_htf = request.security(syminfo.tickerid, "240", ta.ema(close, 20))
filter = close > ema_htf
plot(ema_htf, title="HTF EMA 20")
plot(filter ? 1 : 0, title="EMA Filter", style="histogram")

// Multi-symbol spread
close_bbb = request.security("BBB", "240", close)
close_ccc = request.security("CCC", "240", close)
spread = close_bbb - close_ccc
plot(spread, title="BBB-CCC Spread")
</code></pre> <h3 id="pine-not-supported" class="svelte-15ifth6">Limited / experimental (use with care)</h3> <ul class="ss-list svelte-15ifth6"><li>request.security / request.security_lower_tf (experimental; see request.security section for limits/errors).</li> <li>table.* drawing APIs (supported but limited; unsupported set methods warn and are ignored).</li> <li>strategy.* order functions (supported as signals/backtest; not full TradingView strategy parity).</li></ul> <h3 id="pine-strategy-accessors" class="svelte-15ifth6">Strategy accessors</h3> <ul class="ss-list svelte-15ifth6"><li>Supported: <code>strategy.position_size</code>, <code>strategy.position_avg_price</code>, <code>strategy.equity</code>.</li> <li>position_size is net qty (long &gt; 0, short &lt; 0, flat = 0).</li> <li>position_avg_price is the average entry price for the open position; na when flat.</li> <li>equity updates on bar close and includes unrealized P&amp;L using close (no intrabar fills yet).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Minimal usage
pos = strategy.position_size
avg = strategy.position_avg_price
eq = strategy.equity
plot(pos)
plot(avg)
plot(eq)
</code></pre> <h3 id="pine-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>Caps: labels 500, lines 500, boxes 200, runtime draws 1000.</li> <li>When a cap is exceeded, extra objects are skipped with diagnostics.</li> <li>Label cap frees capacity on delete/clear and emits a single runtime diagnostic.</li> <li>Box cap frees capacity on delete/clear and emits a single runtime diagnostic.</li> <li>Lifecycle is consistent: new() creates, set_* updates in place, delete/clear marks handles deleted and set_* after delete emits &quot;&lt;type&gt; is deleted&quot;.</li> <li>Box options are strict (xloc/extend/border_style/border_width/text_size/text_halign/text_valign).</li> <li>Box xloc is strict (time floors+clamps; bar_index requires integers).</li> <li>Box extend expands to the visible viewport edges.</li> <li>Scripts are bar-based (no tick-level execution).</li> <li>Strict validation for safer, deterministic runs.</li> <li>Line xloc rules are strict (bar_index integer, time uses floor + clamp).</li> <li>Line extend is viewport-clipped and recomputed on pan/zoom.</li></ul> <h3 id="pine-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>Missing //@pine header: add it at the top.</li> <li>plotshape requires a condition and valid style/location options.</li> <li>Negative history index: use x[1] or greater.</li> <li>array.set index must be within array size.</li> <li>valuewhen occurrence must be integer &gt;= 0; pivot left/right must be integer &gt;= 1.</li> <li>ta.highest/ta.lowest/ta.sum/ta.rising/ta.falling length must be integer &gt;= 1.</li> <li>Time fields are functions: use <code>hour(time)</code>, not <code>hour</code>.</li> <li>line style/extend/xloc not supported: use valid literals.</li> <li>line width must be &gt;= 1 (integer).</li> <li>line x must be integer when xloc=bar_index, number when xloc=time.</li> <li>line.set after line.delete triggers: "line is deleted".</li> <li>box.set after box.delete triggers: "box is deleted".</li> <li>label x must be integer when xloc=bar_index, number when xloc=time.</li> <li>label.set after label.delete triggers: "label is deleted".</li> <li>label yloc must be price/abovebar/belowbar.</li> <li>Label text/tooltip may truncate (24/80 chars); shorten if needed.</li> <li>Expect extend to clip to the visible viewport (not full history).</li> <li>Top-level loops inside top-level if blocks are not supported yet; use draw when-conditions to gate last-bar actions.</li> <li>Function bodies now allow <code>if/for/while/switch</code> + <code>var/varip</code> + <code>:=</code>; loop caps still apply.</li> <li>session.isin session must be in HHMM-HHMM (literal string, ASCII '-', example: "0930-1600").</li> <li>Dotted calls and member fields are supported (examples: <code>ta.sma</code>, <code>math.max</code>, <code>session.isin</code>, <code>syminfo.tickerid</code>, <code>barstate.islast</code>, <code>strategy.position_size</code>, <code>timeframe.period</code>).</li> <li>Inline comments using <code>//</code> are supported; block comments (<code>/* ... */</code>) are not supported.</li> <li>If pasted code fails unexpectedly, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="pine-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">All runnable Pine examples live in the Examples tab → Pine Examples.</p> <ul class="ss-list svelte-15ifth6"><li>EMA baseline, History + nz, var state, if/ternary basics.</li> <li>Array push/get/size, draw.clear + draw.for_each.</li> <li>Line update + delete, line style + extend, xloc mapping demo.</li> <li>Line extend (viewport clipped), dash styles, width 3 dash parity.</li> <li>Label yloc price/abovebar/belowbar + location alias.</li> <li>Label size mapping + bg/border + text/tooltip truncation.</li> <li>Label cap examples: delete frees capacity + single diagnostic.</li> <li>draw.clear by group/tags for line/label/box.</li> <li>Box lifecycle + delete diagnostics.</li> <li>Box extend examples (viewport-clipped).</li> <li>Box style examples (bg/border/dash/text).</li> <li>ta.highest/ta.lowest, ta.sum, ta.rising/ta.falling, ta.valuewhen, ta.pivothigh/low, ta.bbands/macd/stoch/cci/mfi/obv.</li> <li>Time fields, time_close, session.isin.</li></ul></section>`),Dse=Me(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">Start Here</a> <a class="svelte-15ifth6">Quick Index</a> <a class="svelte-15ifth6">Common Recipes</a> <a class="svelte-15ifth6">Implementation Playbook</a> <a class="svelte-15ifth6">Supported vs Not Supported</a> <a class="svelte-15ifth6">Script Structure</a> <a class="svelte-15ifth6">Data Model</a> <a class="svelte-15ifth6">History + NaN</a> <a class="svelte-15ifth6">Plots</a> <a class="svelte-15ifth6">Gradients</a> <a class="svelte-15ifth6">Pane Scaling</a> <a class="svelte-15ifth6">Autoscale Defaults</a> <a class="svelte-15ifth6">Draw Tools</a> <a class="svelte-15ifth6">Polyline/Polygon</a> <a class="svelte-15ifth6">Overlay Templates</a> <a class="svelte-15ifth6">Interaction</a> <a class="svelte-15ifth6">Heatmap</a> <a class="svelte-15ifth6">WebGL Runtime</a> <a class="svelte-15ifth6">Strategy & Backtest</a> <a class="svelte-15ifth6">Alerts</a> <a class="svelte-15ifth6">Multi-Timeframe</a> <a class="svelte-15ifth6">Datafeed Parity</a> <a class="svelte-15ifth6">Stdlib</a> <a class="svelte-15ifth6">JS API Index</a> <a class="svelte-15ifth6">Performance</a> <a class="svelte-15ifth6">Limits & Safety</a> <a class="svelte-15ifth6">Guardrails</a> <a class="svelte-15ifth6">JS Rules (Exact)</a> <a class="svelte-15ifth6">Troubleshooting</a> <a class="svelte-15ifth6">Examples</a> <a class="svelte-15ifth6">Status</a></div> <h3 id="js-start" class="svelte-15ifth6">Start Here (5 steps)</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch Script Studio mode to JS and keep <code>// @lang js</code> on line 1.</li> <li>Choose your goal: indicator, strategy, overlay, or heatmap.</li> <li>Open the Examples tab and pick the closest example.</li> <li>Edit only one thing at a time (inputs → logic → visuals).</li> <li>Run and check the Issues panel if something is not visible.</li></ol> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Indicator</div> <p>Compute a series from <code>ctx.*</code> and plot it.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy</div> <p>Use <code>strategy.entry/exit/close</code> and plot equity in a sub pane.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay</div> <p>Use <code>overlay.new</code> or draw primitives (line/box/polygon).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap</div> <p>Create once in <code>onInit</code>, then push points in <code>onBar</code>.</p></div></div> <h3 id="js-index" class="svelte-15ifth6">Quick Index (find by task)</h3> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">I want to…</th><th class="svelte-15ifth6">Go to section</th><th class="svelte-15ifth6">Example to run</th></tr></thead><tbody><tr><td class="svelte-15ifth6">Plot a line indicator</td><td class="svelte-15ifth6">Plots</td><td class="svelte-15ifth6">JS basic plot</td></tr><tr><td class="svelte-15ifth6">Place buy/sell markers</td><td class="svelte-15ifth6">Plots (plotshape)</td><td class="svelte-15ifth6">JS plot advanced</td></tr><tr><td class="svelte-15ifth6">Draw boxes/labels/lines</td><td class="svelte-15ifth6">Draw Tools</td><td class="svelte-15ifth6">JS draw tools demo</td></tr><tr><td class="svelte-15ifth6">Draw polylines / polygons</td><td class="svelte-15ifth6"><a>Polyline/Polygon</a></td><td class="svelte-15ifth6">JS polygon overlay</td></tr><tr><td class="svelte-15ifth6">Create Fibonacci overlays</td><td class="svelte-15ifth6">Overlay Templates</td><td class="svelte-15ifth6">JS overlay fib labels</td></tr><tr><td class="svelte-15ifth6">Build a heatmap</td><td class="svelte-15ifth6">Heatmap</td><td class="svelte-15ifth6">JS heatmap raster</td></tr><tr><td class="svelte-15ifth6">Run a strategy backtest</td><td class="svelte-15ifth6">Strategy & Backtest</td><td class="svelte-15ifth6">JS strategy basic</td></tr><tr><td class="svelte-15ifth6">Create alert rules</td><td class="svelte-15ifth6">Alerts (JS)</td><td class="svelte-15ifth6">JS alert basic</td></tr><tr><td class="svelte-15ifth6">Use higher timeframe data</td><td class="svelte-15ifth6">Multi-Timeframe</td><td class="svelte-15ifth6">JS MTF basic</td></tr></tbody></table></div> <h3 id="js-recipes" class="svelte-15ifth6">Common Recipes (copy + edit)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">1) Indicator (single line)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const value = ta.ema(ctx.close, 20);
  if (!Number.isFinite(value)) return;
  plot(value, &#123; color: "#22c55e", title: "EMA 20" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">2) Indicator + signals</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  plot(fast, &#123; color: "#22c55e", title: "EMA 8" &#125;);
  plot(slow, &#123; color: "#f59e0b", title: "EMA 21" &#125;);
  plotshape(crossUp, &#123; style: "triangle_up", location: "belowbar", color: "#22c55e" &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">3) Strategy (entry + exit)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  const crossDown = fast &lt; slow;
  strategy.entry("L", strategy.long, &#123; when: crossUp &#125;);
  strategy.close("L", &#123; when: crossDown &#125;);
  plot(fast, &#123; color: "#22c55e", title: "EMA 8" &#125;);
  plot(slow, &#123; color: "#f59e0b", title: "EMA 21" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">4) Alerts (rules)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) &gt; Number(slow);
  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", &#123;
    id: "ema_cross_up",
    frequency: "once_per_bar",
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">5) Overlay template</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let rect;
export function onBar(ctx) &#123;
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;
  rect = overlay.new(
    "rect",
    [&#123; index: last - 20, value: ctx.low &#125;, &#123; index: last, value: ctx.high &#125;],
    &#123; styles: &#123; polygon: &#123; color: "rgba(14, 165, 233, 0.18)" &#125; &#125; &#125;
  );
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">6) Heatmap (sub pane)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let hm;
export function onInit() &#123;
  hm = heatmap.new(&#123; id: "vol", pane: "sub", xBinPx: 6, yBinPx: 6, agg: "avg" &#125;);
&#125;
export function onBar(ctx) &#123;
  if (Number(ctx.bar_index) % 3 === 0) &#123;
    heatmap.push(hm, Number(ctx.bar_index), Number(ctx.close), Number(ctx.volume));
  &#125;
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">7) Color-switching EMA (segments)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const WINDOW = 80;
let emaHist = [];
let closeHist = [];
let handles = [];

function initHandles() &#123;
  if (handles.length) return;
  for (let i = 0; i &lt; WINDOW; i++) &#123;
    handles.push(polyline.new(0, 0, 0, 0, &#123; color: "#3b82f6", width: 2, when: 0 &#125;));
  &#125;
&#125;

export function onBar(ctx) &#123;
  const ema = Number(ta.ema(ctx.close, 20));
  const close = Number(ctx.close);
  if (!Number.isFinite(ema) || !Number.isFinite(close)) return;
  emaHist.push(ema);
  closeHist.push(close);
  if (emaHist.length &gt; WINDOW + 1) &#123;
    emaHist.shift();
    closeHist.shift();
  &#125;
  initHandles();
  const lastX = Number(ctx.bar_index);
  const len = emaHist.length;
  for (let s = 0; s &lt; WINDOW; s++) &#123;
    const i1 = len - WINDOW + s;
    const i0 = i1 - 1;
    const h = handles[s];
    if (i0 &lt; 0 || i1 &lt;= 0 || i1 &gt;= len) &#123;
      polyline.set_points(h, 0, 0, 0, 0, &#123; when: 0 &#125;);
      continue;
    &#125;
    const x0 = lastX - (len - 1 - i0);
    const x1 = lastX - (len - 1 - i1);
    const y0 = emaHist[i0];
    const y1 = emaHist[i1];
    const color = closeHist[i1] &gt;= emaHist[i1] ? "#3b82f6" : "#ef4444";
    polyline.set_points(h, x0, y0, x1, y1, &#123; color, width: 2, when: 1 &#125;);
  &#125;
&#125;</code></pre></div></div> <h3 id="js-playbook" class="svelte-15ifth6">Implementation Playbook (step-by-step)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">A) Script structure</div> <ul class="ss-list svelte-15ifth6"><li>Declare handles in module scope.</li> <li>Use <code>onInit</code> for one-time setup.</li> <li>Use <code>onBar</code> for all logic and visuals.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">B) Indicator build</div> <ul class="ss-list svelte-15ifth6"><li>Pick input: <code>ctx.close</code> / <code>ctx.high</code>.</li> <li>Compute: <code>ta.ema</code> / custom math.</li> <li>Guard NaN, then <code>plot</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">C) Strategy build</div> <ul class="ss-list svelte-15ifth6"><li>Define signals.</li> <li>Use <code>strategy.entry/exit/close</code>.</li> <li>Plot equity in a sub pane.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">D) Overlay build</div> <ul class="ss-list svelte-15ifth6"><li>Create once with <code>overlay.new</code>.</li> <li>Update points with <code>overlay.set_points</code>.</li> <li>Keep handles stable.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">E) Heatmap build</div> <ul class="ss-list svelte-15ifth6"><li>Create in <code>onInit</code>.</li> <li>Push points each bar.</li> <li>Tune bins with <code>set_grid</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">F) Interaction</div> <ul class="ss-list svelte-15ifth6"><li>Interaction is enabled by default.</li> <li>Draw on last bar for visibility.</li> <li>Keep draw order stable.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">G) Performance</div> <ul class="ss-list svelte-15ifth6"><li>Keep loops small.</li> <li>Reuse handles.</li> <li>Prefer heatmap for dense visuals.</li></ul></div></div> <h3 id="js-support" class="svelte-15ifth6">Supported vs Not Supported</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Supported</div> <ul class="ss-list svelte-15ifth6"><li><strong>Execution:</strong> <code>onInit</code> once, <code>onBar</code> per bar, globals persist across bars.</li> <li><strong>Data:</strong> <code>ctx.open/high/low/close</code>, <code>ctx.volume/time</code>, <code>ctx.bar_index</code>.</li> <li><strong>History:</strong> <code>ctx.hist(series, n)</code> (integer <code>n &gt;= 0</code>).</li> <li><strong>Indicators:</strong> <code>ta.*</code> MA family, oscillators, volatility, volume, pivots.</li> <li><strong>Math, color, strings:</strong> <code>math.*</code>, <code>color.*</code>, <code>str.*</code> helpers.</li> <li><strong>Plots:</strong> <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>plotcandle</code>, <code>plotohlc</code>, <code>plotbar</code>, <code>hline</code>, <code>fill</code>.</li> <li><strong>Plot types:</strong> line/area/histogram/bar + neon/glow/bezier/cloud.</li> <li><strong>Draw tools:</strong> <code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polyline.new</code>, <code>polygon.new</code>, <code>table.new</code>.</li> <li><strong>Styling:</strong> layer/zIndex, glow, gradients, tooltips, avoidOverlap.</li> <li><strong>Overlays:</strong> <code>overlay.new</code> templates (fib, ruler, shapes).</li> <li><strong>Heatmap:</strong> raster heatmap with LOD + tiling, colormap, bin sizes.</li> <li><strong>Strategy:</strong> <code>strategy.entry/exit/close/cancel</code>, config, brackets.</li> <li><strong>Alerts:</strong> <code>alertcondition</code> / <code>alert</code> rules in Alerts Center.</li> <li><strong>Backtest accessors:</strong> <code>strategy.equity</code>, <code>position_size</code>, trade metrics (plot-only).</li> <li><strong>MTF:</strong> <code>request.security</code> / <code>request.security_lower_tf</code> with multi-symbol + lookahead/gaps/timezone/session.</li> <li><strong>Diagnostics:</strong> warnings vs errors in Issues panel.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Not Supported (yet / by design)</div> <ul class="ss-list svelte-15ifth6"><li><strong>Pine syntax:</strong> JS mode does not parse Pine.</li> <li><strong>Async/IO:</strong> no DOM, network, timers, or async APIs.</li> <li><strong>Non-determinism:</strong> <code>Date</code>, <code>Math.random</code>, <code>performance.now</code> blocked.</li> <li><strong>Dynamic code:</strong> no <code>eval</code>, <code>Function</code>, or dynamic <code>import</code>.</li> <li><strong>External libs:</strong> third-party packages not available.</li></ul></div></div> <h3 id="js-structure" class="svelte-15ifth6">Script Structure (skeleton)</h3> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let handle;

export function onInit(ctx) &#123;
  // one-time setup: tables, heatmaps, config
&#125;

export function onBar(ctx) &#123;
  // per-bar logic
  const i = Number(ctx.bar_index);
  if (!Number.isFinite(i)) return;

  // draw or plot
  plot(ctx.close, &#123; color: "#22c55e", title: "Close" &#125;);
&#125;</code></pre> <ul class="ss-list svelte-15ifth6"><li>Global variables persist across bars: use them for handles.</li> <li><code>onInit</code> runs once, <code>onBar</code> runs on every bar.</li> <li>All visuals should happen inside <code>onBar</code>.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Handle reuse (important)</div> <p>Create once, then update with <code>set_points</code> or <code>set</code> to avoid leaks.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Last-bar pattern</div> <p>Draw only on the last bar to keep visuals stable and visible.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Warmup guard</div> <p>Skip bars where indicators return NaN to avoid noise.</p></div></div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Last-bar only
const last = ctx.bar_index.data.length - 1;
if (Number(ctx.bar_index) !== last) return;</code></pre> <h3 id="js-data" class="svelte-15ifth6">Data Model (ctx)</h3> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">What</th><th class="svelte-15ifth6">How to use</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6">Price series</td><td class="svelte-15ifth6"><code>ctx.open/high/low/close</code></td><td class="svelte-15ifth6"><code>ta.ema(ctx.close, 20)</code></td></tr><tr><td class="svelte-15ifth6">Volume series</td><td class="svelte-15ifth6"><code>ctx.volume</code></td><td class="svelte-15ifth6"><code>ta.obv()</code></td></tr><tr><td class="svelte-15ifth6">Time & index</td><td class="svelte-15ifth6"><code>ctx.time</code>, <code>ctx.bar_index</code></td><td class="svelte-15ifth6"><code>Number(ctx.bar_index)</code></td></tr><tr><td class="svelte-15ifth6">Inputs</td><td class="svelte-15ifth6"><code>ctx.input(name, default)</code></td><td class="svelte-15ifth6"><code>const len = ctx.input("Len", 20)</code></td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Series arrays are available as <code>ctx.bar_index.data</code> (useful for last-bar checks).</li> <li>Convert to numbers when needed: <code>Number(ctx.close)</code>.</li></ul> <h3 id="js-history" class="svelte-15ifth6">History + NaN Rules</h3> <ul class="ss-list svelte-15ifth6"><li><code>ctx.hist(series, n)</code> only accepts integer <code>n &gt;= 0</code>.</li> <li>Out of range returns <code>NaN</code>.</li> <li>Use <code>Number.isFinite(x)</code> before plotting or using in conditions.</li> <li>Conditions accept number/boolean/string only; objects/arrays are errors.</li> <li><code>NaN</code> is treated as false inside conditions.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Guard warmup bars
const value = ta.ema(ctx.close, 20);
if (!Number.isFinite(value)) return;
plot(value, &#123; title: "EMA 20" &#125;);</code></pre> <h3 id="js-plots" class="svelte-15ifth6">Plots (line / area / histogram)</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Core plots</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plot</span> <span class="svelte-15ifth6">plotshape</span> <span class="svelte-15ifth6">plotchar</span> <span class="svelte-15ifth6">hline</span> <span class="svelte-15ifth6">fill</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Candle plots</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plotcandle</span> <span class="svelte-15ifth6">plotohlc</span> <span class="svelte-15ifth6">plotbar</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Advanced types</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">neon_line</span> <span class="svelte-15ifth6">glow_points</span> <span class="svelte-15ifth6">bezier_line</span> <span class="svelte-15ifth6">cloud</span></div></div></div> <p class="ss-note svelte-15ifth6">Legends auto-stack. Hide a legend with <code>legend: false</code>, or move it using <code>legendPosition</code>/<code>legendOffsetX</code>/<code>legendOffsetY</code>.</p> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Plot option</th><th class="svelte-15ifth6">Meaning</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>type</code></td><td class="svelte-15ifth6">Line/area/histogram/bar/candles/ohlc + advanced types.</td><td class="svelte-15ifth6"><code>&#123; type: "histogram" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>color</code> / <code>width</code></td><td class="svelte-15ifth6">Stroke color and width.</td><td class="svelte-15ifth6"><code>&#123; color: "#22c55e", width: 2 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Two-stop fill/stroke gradient for plots.</td><td class="svelte-15ifth6"><code>&#123; gradient: &#123; from: "rgba(56,189,248,.4)", to: "rgba(34,197,94,.2)", mode: "vertical" &#125; &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>offset</code></td><td class="svelte-15ifth6">Shift plot forward/backward by bars.</td><td class="svelte-15ifth6"><code>&#123; offset: -1 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>showLast</code></td><td class="svelte-15ifth6">Only show last N bars.</td><td class="svelte-15ifth6"><code>&#123; showLast: 100 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>trackPrice</code></td><td class="svelte-15ifth6">Show last value label at right axis.</td><td class="svelte-15ifth6"><code>&#123; trackPrice: true &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>pane</code></td><td class="svelte-15ifth6">Target pane (<code>"main"</code> or <code>"sub"</code>).</td><td class="svelte-15ifth6"><code>&#123; pane: "sub" &#125;</code></td></tr></tbody></table></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">plotshape styles</div> <p>cross, xcross, triangle_up, triangle_down, circle, square, diamond, star, arrow_up, arrow_down, flag, tag, pill, bubble, spark, box, box_gradient, label, text, circle_pulse, arrow_up_glow, arrow_down_glow, triangle_up_gradient, triangle_down_gradient.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">plotshape options</div> <p><code>size</code>, <code>location</code> (abovebar/belowbar/price), <code>offset</code>, <code>text</code>, <code>textcolor</code>, <code>bgGradient</code>, <code>tooltip</code>.</p></div></div> <h3 id="js-gradient" class="svelte-15ifth6">Gradients (plots + labels + boxes)</h3> <p class="ss-note svelte-15ifth6">Use a two-stop gradient object: <code>&#123; from, to, mode &#125;</code>. Supported modes: <code>"vertical"</code> (default), <code>"horizontal"</code>, <code>"radial"</code>.</p> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">How to use (step-by-step)</div> <ul class="ss-list svelte-15ifth6"><li>Pick the target API: <code>plot</code>, <code>plotcandle</code>, <code>plotshape</code>, <code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polygon.new</code>, <code>fill</code>.</li> <li>Build the gradient object: <code>&#123; from: "#...", to: "#...", mode: "vertical|horizontal|radial" &#125;</code>.</li> <li>Attach it to the right key (see table below).</li> <li>Keep gradients simple: two stops only for best performance.</li> <li>If a gradient looks flat, check pane scaling or set <code>includeInAutoscale: true</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Which key to use</div> <table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">API</th><th class="svelte-15ifth6">Gradient key</th><th class="svelte-15ifth6">Affects</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>plot</code></td><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Line/area/hist/dots/stepped/neon/bezier/cloud</td></tr><tr><td class="svelte-15ifth6"><code>plotcandle</code></td><td class="svelte-15ifth6"><code>gradient</code>, <code>downGradient</code></td><td class="svelte-15ifth6">Up/down candle bodies</td></tr><tr><td class="svelte-15ifth6"><code>plotshape</code> / <code>label.new</code></td><td class="svelte-15ifth6"><code>bgGradient</code></td><td class="svelte-15ifth6">Label background</td></tr><tr><td class="svelte-15ifth6"><code>line.new</code> / <code>polyline.new</code></td><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Stroke color</td></tr><tr><td class="svelte-15ifth6"><code>box.new</code></td><td class="svelte-15ifth6"><code>bgGradient</code></td><td class="svelte-15ifth6">Box fill</td></tr><tr><td class="svelte-15ifth6"><code>polygon.new</code></td><td class="svelte-15ifth6"><code>fillGradient</code></td><td class="svelte-15ifth6">Polygon fill</td></tr><tr><td class="svelte-15ifth6"><code>fill</code></td><td class="svelte-15ifth6"><code>fillGradient</code></td><td class="svelte-15ifth6">Band fill between two series</td></tr></tbody></table></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plot gradient (line/area/hist)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const v = ta.ema(ctx.close, 20);
  plot(v, &#123;
    type: "area",
    color: "#60a5fa",
    gradient: &#123; from: "rgba(96,165,250,0.35)", to: "rgba(34,197,94,0.12)", mode: "vertical" &#125;
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Label / plotshape gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const isBuy = Number(ctx.bar_index) % 25 === 5;
  plotshape(isBuy, &#123;
    style: "callout",
    text: "BUY",
    location: "belowbar",
    bgGradient: &#123; from: "#16a34a", to: "#22c55e", mode: "horizontal" &#125;
  &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Candle gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, &#123;
    color: "#22c55e",
    downColor: "#ef4444",
    gradient: &#123; from: "rgba(34,197,94,0.45)", to: "rgba(34,197,94,0.1)", mode: "vertical" &#125;,
    downGradient: &#123; from: "rgba(239,68,68,0.45)", to: "rgba(239,68,68,0.1)", mode: "vertical" &#125;
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Box gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  box.new(ctx.bar_index - 10, ctx.high, ctx.bar_index, ctx.low, &#123;
    bgGradient: &#123; from: "rgba(56,189,248,0.25)", to: "rgba(14,116,144,0.12)", mode: "vertical" &#125;,
    borderColor: "#38bdf8"
  &#125;);
&#125;</code></pre></div></div> <h3 id="js-pane-scaling" class="svelte-15ifth6">Pane Scaling (important)</h3> <ul class="ss-list svelte-15ifth6"><li>Each pane has a single y-scale. If you plot very different magnitudes together, small series look flat.</li> <li>Example: <code>strategy.equity</code> (~10,000) vs <code>strategy.position_size</code> (~1).</li> <li>Solution: use <code>pane: "sub"</code> or normalize one series.</li></ul> <h3 id="js-autoscale" class="svelte-15ifth6">Autoscale Defaults</h3> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code> to avoid chart compression.</li> <li>Heatmaps in sub panes default to autoscale on.</li> <li>If a plot is off-screen, set <code>includeInAutoscale: true</code> or adjust pane.</li></ul> <h3 id="js-draw" class="svelte-15ifth6">Draw Tools (labels / lines / boxes)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p><code>label.new</code> supports padding, wrap, tooltip, font, avoidOverlap.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Lines</div> <p><code>line.new</code> supports dashed/dotted, gradient, extend, glow.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Boxes</div> <p><code>box.new</code> supports borders, text, and background fill/gradient.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polylines / Polygons</div> <p><code>polyline.new</code> / <code>polygon.new</code> support glow + gradients.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Tables</div> <p><code>table.new</code> / <code>table.cell</code> for small dashboards.</p></div></div> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code>.</li> <li>Use <code>layer</code> + <code>zIndex</code> for draw order.</li> <li>Use <code>timestamp + value</code> for overlays to avoid index misalignment.</li> <li>Lock tool locks existing drawings; starting a new draw auto-unlocks for editing.</li> <li>Floating lock toggles only the selected drawing and stays locked until unlocked there.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Label options (common)</div> <p>bgcolor, bgGradient, borderColor, borderWidth, padding, wrap, maxWidth, align, valign, textAlign, fontFamily, fontSize, fontWeight, lineHeight, radius, tooltip, layer, zIndex, includeInAutoscale, xloc, yloc, avoidOverlap, collision.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Line options (common)</div> <p>color, gradient, width, style (solid/dashed/dotted), glow, glowColor, glowOpacity, extend, xloc, layer, zIndex, includeInAutoscale.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polygon options (common)</div> <p>fillColor, fillGradient (vertical/horizontal/radial), strokeColor, strokeWidth, strokeStyle, opacity, glow, glowColor, glowOpacity, layer, zIndex, includeInAutoscale.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Box + table options</div> <p>box: border_color, border_width, border_style, bgcolor, bgGradient, text, text_halign, text_valign, text_wrap, extend, xloc. table: bgcolor, frameColor, frameWidth, borderColor, borderWidth, text_color, text_halign, text_valign, text_size.</p></div></div> <h4 id="js-polyline-polygon">Polylines / Polygons (step-by-step)</h4> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polyline step-by-step</div> <ul class="ss-list svelte-15ifth6"><li>Choose points in bar_index + price (or time + price).</li> <li>Call <code>polyline.new</code> with points and options.</li> <li>Use <code>polyline.set_points</code> if you want to update it.</li> <li>Per-bar color changes require segments (one handle per segment).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const i = Number(ctx.bar_index);
  polyline.new(
    &#123; x: i - 3, y: Number(ctx.low) &#125;,
    &#123; x: i, y: Number(ctx.high) &#125;,
    &#123; x: i + 3, y: Number(ctx.low) &#125;,
    &#123; color: "#22c55e", width: 2, includeInAutoscale: false &#125;
  );
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polygon step-by-step</div> <ul class="ss-list svelte-15ifth6"><li>Use at least 3 points (closed shape).</li> <li>Call <code>polygon.new</code> with points and fill/stroke options.</li> <li>Curves: use fractional x values (ex: <code>i + 0.25</code>) or keep shapes wide enough (8-12 bars).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const i = Number(ctx.bar_index);
  polygon.new(
    &#123; x: i - 3, y: Number(ctx.low) &#125;,
    &#123; x: i, y: Number(ctx.high) &#125;,
    &#123; x: i + 3, y: Number(ctx.low) &#125;,
    &#123;
      fillColor: "rgba(56,189,248,0.25)",
      strokeColor: "#38bdf8",
      strokeWidth: 2,
      includeInAutoscale: false
    &#125;
  );
&#125;</code></pre></div></div> <h3 id="js-overlays" class="svelte-15ifth6">Overlay Templates</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay rules</div> <ul class="ss-list svelte-15ifth6"><li>Prefer <code>&#123;timestamp, value&#125;</code> points for stable alignment.</li> <li>Draw overlays on the last bar so they update cleanly.</li> <li>Use <code>extendData</code> for template-specific settings.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Fibonacci example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;
  overlay.new("fibonacciSegment", [
    &#123; timestamp: Number(ctx.hist(ctx.time, 1)), value: Number(ctx.hist(ctx.low, 1)) &#125;,
    &#123; timestamp: Number(ctx.hist(ctx.time, 0)), value: Number(ctx.hist(ctx.high, 0)) &#125;,
  ], &#123;
    extendData: &#123;
      labelSide: "left",
      labelOffset: 16,
      labelAlign: "right",
      fibonacciLevels: [
        &#123; value: 0, color: "#64748b", label: "0", visible: true &#125;,
        &#123; value: 0.382, color: "#60a5fa", label: "0.382", visible: true &#125;,
        &#123; value: 0.5, color: "#22c55e", label: "0.5", visible: true &#125;,
        &#123; value: 0.618, color: "#f59e0b", label: "0.618", visible: true &#125;,
        &#123; value: 1, color: "#64748b", label: "1", visible: true &#125;,
      ],
    &#125;
  &#125;);
&#125;</code></pre></div></div> <ul class="ss-list svelte-15ifth6"><li>Create with <code>overlay.new(name, points, opts)</code>.</li> <li>Update with <code>overlay.set_points(handle, points)</code>.</li> <li>Points can be pairs (<code>[index, value]</code>) or objects (<code>&#123; index, value &#125;</code>).</li> <li>Common templates: <code>rect</code>, <code>circle</code>, <code>triangle</code>, <code>parallelogram</code>, <code>arrow</code>, <code>text</code>, <code>emoji</code>.</li> <li>Fibonacci: <code>fibonacciSegment</code>, <code>fibonacciExtension</code>, <code>fibonacciCircle</code>, <code>fibonacciSpiral</code>, <code>fibonacciSpeedResistanceFan</code>.</li> <li>Other: <code>horizontalStraightLine</code>, <code>horizontalRayLine</code>, <code>ruler</code>, <code>trade</code>, <code>note</code>, <code>barSignal</code>, <code>gannBox</code>, <code>pointAndFigure</code>.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Point fields</div> <p>index, timestamp, value, source, pivot, extreme, lookback, left, right, which.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Fibonacci labels</div> <p><code>extendData.labelSide</code>, <code>labelOffset</code>, <code>labelAlign</code>, <code>fibonacciLevels</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Guardrails</div> <p>Max overlays and total overlay points are capped to protect performance.</p></div></div> <h3 id="js-interaction" class="svelte-15ifth6">Interaction</h3> <ul class="ss-list svelte-15ifth6"><li>Drag: line, polyline, polygon, path, box, label.</li> <li>Resize: box (edge/corner handles).</li> <li>Draw objects + plots render behind by default; hover lifts them to the foreground.</li> <li>Hover priority: draw/overlay hits take precedence over series hover.</li> <li>Click a candle or plot line/bar to place selection markers every 6 bars (auto‑throttled), with a brighter dot on the selected bar. Click empty space to clear.</li> <li>Snap: hold Alt to disable; hold Shift to lock axis; arrows to nudge.</li> <li>Edits are session-scoped (no script callbacks yet).</li></ul> <h3 id="js-heatmap" class="svelte-15ifth6">Heatmap</h3> <ul class="ss-list svelte-15ifth6"><li>Create once in <code>onInit</code> using <code>heatmap.new</code>.</li> <li>Push points every bar with <code>heatmap.push</code>.</li> <li>Use <code>heatmap.set_grid</code> to adjust bin sizes.</li></ul> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Option</th><th class="svelte-15ifth6">Meaning</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>pane</code></td><td class="svelte-15ifth6">Target pane (<code>"sub"</code> recommended for heatmaps).</td><td class="svelte-15ifth6"><code>&#123; pane: "sub" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>xloc</code> / <code>yloc</code></td><td class="svelte-15ifth6">Coordinate system: <code>bar_index</code> or <code>time</code>; <code>price</code> for y.</td><td class="svelte-15ifth6"><code>&#123; xloc: "bar_index" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>xBinPx</code> / <code>yBinPx</code></td><td class="svelte-15ifth6">Bin size in pixels (LOD scales up when zoomed out).</td><td class="svelte-15ifth6"><code>&#123; xBinPx: 6, yBinPx: 6 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>agg</code></td><td class="svelte-15ifth6">Aggregation: sum/avg/max/min.</td><td class="svelte-15ifth6"><code>&#123; agg: "avg" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>blend</code> / <code>opacity</code></td><td class="svelte-15ifth6">Blend mode and opacity for visuals.</td><td class="svelte-15ifth6"><code>&#123; blend: "screen", opacity: 0.85 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>colormap</code></td><td class="svelte-15ifth6">Color ramp with stops.</td><td class="svelte-15ifth6"><code>&#123; colormap: [&#123; stop: 0, color: "#0f172a" &#125;] &#125;</code></td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Use <code>heatmap.setGrid</code> (alias) to update bins after creation.</li> <li>Heatmap points are capped; exceeding the cap emits a warning.</li> <li>Heatmaps redraw on zoom/scroll and stay aligned to candles.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>let hm;
export function onInit() &#123;
  hm = heatmap.new(&#123; id: "hm", pane: "sub", xBinPx: 6, yBinPx: 6, agg: "avg" &#125;);
&#125;
export function onBar(ctx) &#123;
  heatmap.push(hm, Number(ctx.bar_index), Number(ctx.close), Number(ctx.volume));
&#125;</code></pre> <h3 id="js-webgl" class="svelte-15ifth6">WebGL Runtime</h3> <ul class="ss-list svelte-15ifth6"><li>Heatmaps use WebGL by default for performance (Canvas fallback if needed).</li> <li>WebGL accelerates polylines/polygons when available.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap raster (WebGL)</div> <p>Bins are rasterized in GPU tiles; zooming out increases bin size for speed.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Primitives (WebGL)</div> <p>Lines/polylines/polygons render in GPU for smooth zoom/scroll.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Glow</div> <p>Glow may render via Canvas for stability; outline stays crisp.</p></div></div> <h3 id="js-strategy" class="svelte-15ifth6">Strategy & Backtest</h3> <ul class="ss-list svelte-15ifth6"><li>Signals evaluate on bar close; market fills next bar open.</li> <li>Enable intrabar fills with <code>execution: "intrabar_ohlc"</code>.</li> <li>Order kinds include <code>market/limit/stop/stop_limit/mit/lit/trailing_stop</code> (use <code>kind</code>).</li> <li>Use <code>tif: "gtc" | "ioc" | "fok"</code> to control time-in-force.</li> <li><code>fillMode: "volume"</code> enables partial fills (use <code>volumeFillPct</code>).</li> <li>Use <code>strategy.entry/exit/close</code> and plot equity in a sub pane.</li> <li>Accessors like <code>strategy.equity</code> are for plots (not entry logic).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  const crossDown = fast &lt; slow;
  strategy.entry("L", strategy.long, &#123; when: crossUp, qty: 1 &#125;);
  strategy.exit("L", &#123; stop: Number(ctx.close) * 0.98, limit: Number(ctx.close) * 1.03 &#125;);
  strategy.close("L", &#123; when: crossDown &#125;);
&#125;</code></pre> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Order types</div> <p>market/limit/stop/stop_limit + MIT/LIT + trailing_stop. Use <code>kind</code> to override.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Sizing</div> <p><code>strategy.config(&#123; orderSize: &#123; type, value &#125; &#125;)</code> for default sizing.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Partial fills</div> <p>Enable <code>fillMode: "volume"</code> and set <code>volumeFillPct</code> (ex: 50).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Risk caps</div> <p><code>max_drawdown</code>, <code>max_position_size</code>, <code>max_intraday_loss</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Costs</div> <p><code>commissionType</code> + <code>commissionPct/commissionCash/commissionPerUnit</code>, <code>slippageType</code> + <code>slippagePct/slippageAbs/slippageTicks</code>.</p></div></div> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Accessor (plot only)</th><th class="svelte-15ifth6">Meaning</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>strategy.position_size</code></td><td class="svelte-15ifth6">Current position size.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.position_avg_price</code></td><td class="svelte-15ifth6">Average entry price.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.equity</code></td><td class="svelte-15ifth6">Equity curve.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.net_profit</code></td><td class="svelte-15ifth6">Total net profit.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.trades</code></td><td class="svelte-15ifth6">Number of completed trades.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.win_rate</code></td><td class="svelte-15ifth6">Win percentage.</td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Trade arrays: <code>strategy.closedtrades.&lt;field&gt;(offset)</code> and <code>strategy.opentrades.&lt;field&gt;(offset)</code>.</li> <li>Fields include <code>profit/net_profit/fees</code>, <code>entry_fee</code>, and <code>exit_fee</code> (closed only).</li> <li>Accessors are computed after backtest; do not use for signals.</li></ul> <h3 id="js-alerts" class="svelte-15ifth6">Alerts (JS)</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>alertcondition</code> to register alert rules.</li> <li>Use <code>alert</code> for quick, message-based alerts.</li> <li>Provide a stable <code>id</code> or <code>title</code> so the rule persists.</li> <li>Frequency: <code>once</code>, <code>once_per_bar</code>, <code>once_per_bar_close</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) &gt; Number(slow);

  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", &#123;
    id: "ema_cross_up",
    frequency: "once_per_bar",
  &#125;);

  alert("Momentum check", &#123;
    when: Number(ctx.bar_index) % 50 === 0,
    id: "pulse",
  &#125;);
&#125;</code></pre> <h3 id="js-mtf" class="svelte-15ifth6">Multi-Timeframe</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>request.security(tf, expr, opts)</code> and <code>request.security_lower_tf</code> for HTF/LTF series (multi-symbol supported).</li> <li>Define <code>expr</code> outside <code>onBar</code> to avoid call limits.</li> <li>Nested calls are allowed with a depth guardrail (default 6); lower TF requires datafeed coverage.</li> <li>Alignment defaults to previous bar; use <code>lookahead</code> for same-bar values.</li> <li><code>gaps: true</code> leaves gaps when HTF bars do not align.</li> <li>Invalid timeframe strings throw a deterministic error.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Options</div> <p><code>lookahead</code>, <code>gaps</code>, <code>timezone</code>, <code>session</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Timeframes</div> <p>Supports seconds (ex: <code>30s</code>) and higher TF strings like <code>240</code>, <code>1D</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Limits</div> <p>Call limit per script run is enforced (default 20).</p></div></div> <h4 class="ss-subtitle">MTF step-by-step</h4> <ol class="ss-list svelte-15ifth6"><li><strong>Pick your TFs:</strong> Chart TF is the base. Use HTF with <code>request.security</code> and LTF with <code>request.security_lower_tf</code>.</li> <li><strong>Define expressions once:</strong> Put <code>expr</code> outside <code>onBar</code> to avoid reallocation and call limits.</li> <li><strong>Call from onBar:</strong> Use the same <code>expr</code> function every bar for stable caching.</li> <li><strong>Wait for coverage:</strong> If the status says "Loading request.security...", wait for data to finish loading.</li> <li><strong>Handle errors:</strong> "No data" means the symbol/timeframe is not available. "Lower TF must be lower" means your request TF is not smaller than the chart TF.</li> <li><strong>Multi-symbol:</strong> Use real tickers available in your datafeed. Missing symbols will error deterministically.</li> <li><strong>Nesting:</strong> Nested calls are allowed but capped at depth 6; keep nesting shallow for performance.</li></ol> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">HTF example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const htfCloseExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const htf = request.security("240", htfCloseExpr);
  plot(htf, &#123; title: "HTF Close" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">LTF example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const ltfCloseExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const ltf = request.security_lower_tf("5", ltfCloseExpr);
  plot(ltf, &#123; title: "LTF Close" &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Multi-symbol example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const closeExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const sym = ctx.input("Symbol", "");
  const src = sym ? request.security(sym, "240", closeExpr)
                  : request.security("240", closeExpr);
  plot(src, &#123; title: "Symbol HTF" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Common errors</div> <ul class="ss-list svelte-15ifth6"><li><code>no data</code>: symbol/timeframe not available in datafeed.</li> <li><code>must be lower</code>: LTF request is not smaller than chart TF.</li> <li><code>call limit</code>: too many <code>request.security</code> calls.</li></ul></div></div> <h3 id="js-datafeed" class="svelte-15ifth6">Datafeed Parity (Session/Timezone/Adjust)</h3> <ul class="ss-list svelte-15ifth6"><li>Symbol metadata is sourced from the datafeed when available: <code>timezone</code>, <code>session</code>, <code>sessionExtended</code>, <code>tickSize</code>, <code>lotSize</code>, <code>contractSize</code>.</li> <li>Session mode (chart-level): <code>regular</code> (default), <code>extended</code>, or <code>all</code> (24x7).</li> <li>Corporate actions: <code>adjustMode</code> can be <code>none</code>, <code>split</code>, <code>dividend</code>, or <code>all</code> (applies before scripts run).</li> <li>Advanced: chart config can set <code>options.datafeed.sessionMode</code> / <code>options.datafeed.adjustMode</code>.</li> <li>Timezone resolution: symbol timezone → session timezone → chart timezone → UTC.</li> <li>Per-call overrides: <code>request.security(..., &#123; session, timezone &#125;)</code> for alignment control.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Why it matters</div> <p>Session windows control gaps/alignments, timezone affects bucket boundaries, and adjustments keep history consistent across splits/dividends.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Defaults</div> <p><code>sessionMode: "regular"</code>, <code>adjustMode: "none"</code>. Datafeed metadata overrides apply automatically when present.</p></div></div> <h3 id="js-stdlib" class="svelte-15ifth6">Stdlib</h3> <ul class="ss-list svelte-15ifth6"><li><code>ta.*</code>: moving averages, oscillators, volatility, volume, pivots, trend tools.</li> <li><code>math.*</code>: trig/log/pow, clamp, mod/fmod, sum/avg, isfinite/isnan.</li> <li><code>color.*</code>: rgb/rgba/hsl/hsv, gradients, blend/mix, alpha + channel helpers.</li> <li><code>str.*</code>: format, replace, trim, split/join, substring, casing.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MA family</div> <p>sma, ema, wma, rma, vwma, dema, tema, hma, kama, alma, t3, trima, swma, evwma.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Oscillators</div> <p>rsi, stoch, stochrsi, cmo, roc, mom, tsi, ppo, trix, ao, zscore.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Volatility & ranges</div> <p>tr, atr, atrp, natr, bbands, bbw, donchian, keltner.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Trend tools</div> <p>dmi, adx, aroon, aroonosc, vortex, supertrend, sar, linreg, linreg_slope, linreg_intercept, linreg_angle.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Volume</div> <p>obv, ad, cmf, pvi, nvi.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Helpers</div> <p>sum, highest, lowest, pivot/pivot_points, pivothigh, pivotlow, rising, falling, cross, crossover, crossunder, valuewhen.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strings</div> <p>length, upper/lower, trim, contains, starts/ends, replace, split/join, substring, format.</p></div></div> <h3 id="js-api" class="svelte-15ifth6">JS API Index</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Core</div> <p><code>onInit</code>, <code>onBar</code>, <code>ctx.input</code>, <code>ctx.hist</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plots</div> <p><code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>plotcandle</code>, <code>plotbar</code>, <code>plotohlc</code>, <code>hline</code>, <code>fill</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw</div> <p><code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polyline.new</code>, <code>polygon.new</code>, <code>table.new</code>, <code>table.cell</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay</div> <p><code>overlay.new</code>, <code>overlay.set</code>, <code>overlay.set_points</code>, <code>overlay.delete</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap</div> <p><code>heatmap.new</code>, <code>heatmap.push</code>, <code>heatmap.clear</code>, <code>heatmap.set_grid</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy</div> <p><code>strategy.config</code>, <code>strategy.entry</code>, <code>strategy.exit</code>, <code>strategy.close</code>, <code>strategy.cancel</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Alerts</div> <p><code>alertcondition</code>, <code>alert</code> (rules feed the Alerts Center).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MTF</div> <p><code>request.security</code> / <code>request.security_lower_tf</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Builtins</div> <p><code>ta.*</code>, <code>math.*</code>, <code>color.*</code>, <code>str.*</code>.</p></div></div> <h3 id="js-performance" class="svelte-15ifth6">Performance</h3> <ul class="ss-list svelte-15ifth6"><li>Keep loops small; avoid heavy allocations per bar.</li> <li>Reuse handles instead of recreating shapes every bar.</li> <li>Prefer heatmap for dense visuals.</li> <li>Define MTF expressions once to reduce call overhead.</li> <li>Use sub panes for large-magnitude series (equity vs size).</li> <li>WebGL is used automatically for heatmaps and can accelerate primitives.</li> <li>Rendering is coalesced per frame; redundant redraws are merged.</li> <li>For large data, limit custom loops to the visible window when possible.</li></ul> <h3 id="js-safety" class="svelte-15ifth6">Limits & Safety</h3> <ul class="ss-list svelte-15ifth6"><li>Loop iterations and per-bar runtime are capped.</li> <li>Draw ops per bar are capped (extra calls are skipped with a warning).</li> <li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> are blocked.</li> <li>Network/timers/DOM APIs are blocked.</li> <li>Diagnostics include warning vs error severity in the Issues panel.</li> <li>Plots that are all NaN/undefined emit a warning.</li> <li>Conditions accept number/boolean/string only.</li> <li>JS mode does not implement Pine syntax or semantics.</li></ul> <h3 id="js-guardrails" class="svelte-15ifth6">Guardrails (always on)</h3> <ul class="ss-list svelte-15ifth6"><li>Loop iteration caps prevent infinite loops.</li> <li>Per-bar time budget prevents UI freezes.</li> <li>Total runtime cap prevents long scripts from blocking the UI.</li> <li>Output caps limit plots and draw ops.</li> <li>Draw ops are capped per bar; extra draw calls are skipped with a warning.</li> <li>Diagnostics include warning vs error severity (non-fatal errors may still render).</li> <li>Plots that are all NaN/undefined emit a warning.</li> <li>AST-based loop guards are injected into <code>for/while/do</code> blocks.</li> <li><code>eval</code>, <code>Function</code>, <code>import</code> are blocked.</li> <li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> are blocked.</li> <li>Environment globals blocked: <code>window</code>, <code>document</code>, <code>globalThis</code>, <code>self</code>, <code>navigator</code>, <code>location</code>, <code>crypto</code>.</li> <li>Network/timer APIs blocked: <code>fetch</code>, <code>WebSocket</code>, <code>setTimeout</code>, <code>setInterval</code>.</li></ul> <h3 id="js-rules" class="svelte-15ifth6">JS Rules (Exact Behavior)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Execution model</div> <ul class="ss-list svelte-15ifth6"><li><code>onInit</code> runs once before the first bar.</li> <li><code>onBar</code> runs oldest → newest.</li> <li>Global variables persist across bars.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Series + history</div> <ul class="ss-list svelte-15ifth6"><li>Use <code>ctx.open/high/low/close/volume/time/bar_index</code>.</li> <li><code>ctx.hist(series, n)</code> requires integer <code>n &gt;= 0</code>.</li> <li>Out-of-range returns <code>NaN</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">NaN + conditions</div> <ul class="ss-list svelte-15ifth6"><li><code>NaN</code> propagates through math.</li> <li><code>NaN</code> is false in conditions.</li> <li>Only number/boolean/string conditions allowed.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plot + fill semantics</div> <ul class="ss-list svelte-15ifth6"><li><code>plot()</code> returns a series handle.</li> <li><code>fill(a, b)</code> accepts handles or constants.</li> <li>Calling <code>fill()</code> every bar stacks opacity; guard it when possible.</li> <li>Series used by <code>fill()</code> should be plotted every bar to avoid wedge shapes.</li> <li><code>fill()</code> supports <code>fillGradient</code> using <code>&#123; from, to, mode &#125;</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Layering</div> <ul class="ss-list svelte-15ifth6"><li>Layers: background → main → overlay → ui.</li> <li>Higher <code>zIndex</code> draws on top.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MTF rules</div> <ul class="ss-list svelte-15ifth6"><li><code>request.security</code> / <code>request.security_lower_tf</code> (multi-symbol).</li> <li>Nested calls allowed with a depth guardrail (default 6).</li> <li>Lower TF requires datafeed coverage.</li> <li>Call limit enforced per run.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy fills</div> <ul class="ss-list svelte-15ifth6"><li>Signals on bar close; fills next bar open.</li> <li>Brackets attach to entries.</li> <li>Accessors are plot-only after backtest.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw autoscale</div> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw styling</div> <ul class="ss-list svelte-15ifth6"><li>Glow supported on line/polyline/polygon.</li> <li>Polygon gradients: vertical/horizontal/radial.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay templates</div> <ul class="ss-list svelte-15ifth6"><li>Points accept index/time/value fields.</li> <li>Overlay count/points are capped.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap rules</div> <ul class="ss-list svelte-15ifth6"><li>Bins in pixels; LOD scales when zoomed out.</li> <li>Points are capped; warnings on overflow.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Diagnostics</div> <ul class="ss-list svelte-15ifth6"><li>Warnings vs errors in Issues panel.</li> <li>All-NaN plots emit a warning.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Determinism + sandbox</div> <ul class="ss-list svelte-15ifth6"><li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> blocked.</li> <li>No DOM/network/timers/async APIs.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Stdlib scope</div> <ul class="ss-list svelte-15ifth6"><li>Only <code>ta.*</code>, <code>math.*</code>, <code>color.*</code> exposed.</li> <li>Strings/arrays use native JS methods.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Compatibility</div> <ul class="ss-list svelte-15ifth6"><li>JS mode is not Pine; features not listed are undefined.</li></ul></div></div> <h3 id="js-troubleshoot" class="svelte-15ifth6">Troubleshooting</h3> <ul class="ss-list svelte-15ifth6"><li>JSON syntax error: switch editor mode to JS.</li> <li>Nothing renders: confirm <code>plot()</code> or draw APIs are called.</li> <li>Overlay invisible: use <code>&#123; index, value &#125;</code> points.</li> <li>Chart compresses: set <code>includeInAutoscale: false</code>.</li> <li>MTF errors: check timeframe string and call limits.</li> <li>Heatmap blank: ensure <code>heatmap.push</code> is called each bar.</li> <li>All NaN: add warmup guard with <code>Number.isFinite</code>.</li> <li>Plot overlap: use <code>pane: "sub"</code> for mixed magnitudes.</li> <li><code>__js_draw_stub__</code> label: draw-only scripts auto-add an invisible plot to keep the pane alive. Hide it by adding <code>plot(ctx.close, &#123; color: "rgba(0,0,0,0)", width: 0, legend: false, title: "" &#125;)</code>. Note: keep the stub if your script has only draw calls; hide it if you already plot a series or want a clean legend.</li></ul> <h3 id="js-examples" class="svelte-15ifth6">Examples to run</h3> <p class="ss-note svelte-15ifth6">Examples tab → JS Examples</p> <ul class="ss-list svelte-15ifth6"><li><strong>JS basic plot:</strong> minimal indicator baseline.</li> <li><strong>JS draw tools demo:</strong> label/line/box/table usage.</li> <li><strong>JS heatmap raster:</strong> sub-pane heatmap + EMA.</li> <li><strong>JS overlay templates:</strong> rect/fib overlays.</li> <li><strong>JS primitives (glow + gradient):</strong> WebGL primitives showcase.</li> <li><strong>JS strings + color utils:</strong> str.format + color blend/hsl helpers.</li> <li><strong>JS strategy basic/advanced/accessors:</strong> entries, exits, equity plotting.</li> <li><strong>JS MTF (HTF/LTF/multi-symbol):</strong> request.security examples.</li> <li><strong>JS plot advanced:</strong> plot types + fill + hline.</li> <li><strong>JS draw options parity:</strong> style-rich draw options.</li></ul> <h3 id="js-status" class="svelte-15ifth6">Status</h3> <p class="ss-note svelte-15ifth6">JS mode is stable for indicators, visuals, strategies, and MTF (HTF/LTF + multi-symbol).
              Ensure the datafeed covers requested symbols/timeframes and watch the Issues panel for guardrail warnings.</p></section>`),Rse=Me('<div class="ss-loading svelte-15ifth6">Loading examples...</div>'),jse=Me('<article class="ss-example-card svelte-15ifth6"><div class="ss-example-card-head svelte-15ifth6"><div><h4 class="svelte-15ifth6"> </h4> <p class="svelte-15ifth6"> </p></div></div> <pre class="ss-code ss-code-small svelte-15ifth6"><code> </code></pre> <div class="ss-example-actions svelte-15ifth6"><button class="ss-btn svelte-15ifth6" type="button">Copy</button> <button class="ss-btn primary svelte-15ifth6" type="button">Use in Editor</button></div></article>'),Bse=Me('<div class="ss-empty svelte-15ifth6">No examples match your search.</div>'),Ose=Me('<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-examples-toolbar svelte-15ifth6"><div class="ss-tabs svelte-15ifth6" role="tablist" aria-label="Example formats"><button role="tab" type="button" data-examples-tab="json">JSON Examples</button> <button role="tab" type="button" data-examples-tab="dsl">DSL Examples</button> <button role="tab" type="button" data-examples-tab="pine">Pine Examples</button> <button role="tab" type="button" data-examples-tab="js">JS Examples</button></div> <input class="ss-search svelte-15ifth6" type="search" placeholder="Search examples"></div> <!> <div class="ss-examples-grid svelte-15ifth6"></div> <!></section>'),zse=Me('<div class="ss-toast svelte-15ifth6" role="status"> </div>'),Vse=Me('<div class="ss-guide-backdrop svelte-15ifth6" role="dialog" aria-modal="true" aria-labelledby="ss-guide-title"><div class="ss-guide-modal svelte-15ifth6"><div class="ss-guide-header svelte-15ifth6"><div><h2 id="ss-guide-title" class="svelte-15ifth6">Script Studio Documentation</h2> <p class="ss-guide-subhead svelte-15ifth6">Write indicators and drawings with JSON, DSL, Pine, or JS scripts.</p></div> <button class="ss-guide-close svelte-15ifth6" type="button" aria-label="Close guide">&times;</button></div> <div class="ss-tabs svelte-15ifth6" role="tablist" aria-label="Documentation tabs"><button role="tab" type="button" data-tab="json">JSON</button> <button role="tab" type="button" data-tab="dsl">DSL</button> <button role="tab" type="button" data-tab="pine">Pine</button> <button role="tab" type="button" data-tab="js">JS</button> <button role="tab" type="button" data-tab="examples">Examples</button></div> <div class="ss-guide-body svelte-15ifth6"><!></div> <!></div></div>');function Wse(n,e){Ld(e,!1);const t=vd();let s=pi(e,"show",8,!1);const o=Hh();let r=vd("json"),a=vd(null),l=vd("json"),c=vd(""),f=vd(""),u=vd(!1);const d=[...Cw].sort(),h=[...Iw].sort(),m=[...Pw].sort(),g=[{id:"dsl-signal-label",title:"DSL signal + label",format:"dsl",description:"Simple series, a signal, and two labels for top/bot conditions.",code:`fast = ema(close, 10)
slow = ema(close, 20)

signal buy when (fast crossesAbove slow) score:8 cooldown:5
signal sell when (fast crossesBelow slow) score:6

label at top when (fast crossesAbove slow) text:"BUY" color:#16a34a
label at bot when (fast crossesBelow slow) text:"SELL" color:#ef4444`},{id:"dsl-fractal",title:"DSL fractal tops/bots",format:"dsl",description:"Highest/lowest window with labels at turning points.",code:`win = 5
hi = highest(close, win)
lo = lowest(close, win)

signal top when (close == hi)
signal bot when (close == lo)

label at top when (close == hi) text:"TOP" color:#f59e0b
label at bot when (close == lo) text:"BOT" color:#3b82f6`}];let w=vd({json:[],pine:[],dsl:g,js:Mse}),C=!1,M=!1,P=vd({json:!1,pine:!1,dsl:!1,js:!1}),T={json:!1,pine:!1,dsl:!0,js:!0};function N(){o("close")}function L(){i(a)&&f0(a,i(a).scrollTop=0)}function O(Ve){i(r)!==Ve&&(x(r,Ve),L(),Ve==="examples"&&de(i(l)))}function D(Ve){var Ue,et,ft;const We=(et=(Ue=Ve.target)==null?void 0:Ue.closest)==null?void 0:et.call(Ue,"[data-tab]"),He=(ft=We==null?void 0:We.dataset)==null?void 0:ft.tab;He&&O(He)}function $(Ve){i(l)!==Ve&&(x(l,Ve),L(),de(Ve))}function z(Ve){var Ue,et,ft;const We=(et=(Ue=Ve.target)==null?void 0:Ue.closest)==null?void 0:et.call(Ue,"[data-examples-tab]"),He=(ft=We==null?void 0:We.dataset)==null?void 0:ft.examplesTab;He&&$(He)}function te(Ve){return String(Ve||"").replace(/\\r\\n/g,`
`).replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"')}async function pe(Ve){const We=te(Ve);try{await navigator.clipboard.writeText(We),J("Copied to clipboard");return}catch{}try{const He=document.createElement("textarea");He.value=We,He.setAttribute("readonly","true"),He.style.position="absolute",He.style.left="-9999px",document.body.appendChild(He),He.select(),document.execCommand("copy"),document.body.removeChild(He),J("Copied to clipboard")}catch{J("Copy failed")}}function J(Ve){x(f,Ve),x(u,!0),window.clearTimeout(J._t),J._t=window.setTimeout(()=>{x(u,!1)},2e3)}async function le(){if(C||M)return;M=!0;const Ve=await Rg(()=>import("../chunks/registry.BdqBMTdh.js"),[],import.meta.url);x(w,{...i(w),json:Ve.jsonExamples||[],pine:Ve.pineExamples||[]}),C=!0,M=!1}async function de(Ve){T[Ve]||i(P)[Ve]||(x(P,{...i(P),[Ve]:!0}),Ve!=="dsl"&&Ve!=="js"&&await le(),T={...T,[Ve]:!0},x(P,{...i(P),[Ve]:!1}))}function he(Ve){o("insert",{code:Ve.code,mode:Ve.format})}const ge=a_(),[ae,Ie]=ge;vm(()=>(i(r),i(l)),()=>{i(r)==="examples"&&de(i(l))}),vm(()=>(i(r),i(l),i(w)),()=>{i(r)==="examples"&&i(l)==="dsl"&&x(w,{...i(w),dsl:g})}),vm(()=>(i(w),i(l),i(c)),()=>{x(t,(()=>{const Ve=i(w)[i(l)]||[],We=i(c).trim().toLowerCase();return We?Ve.filter(He=>`${He.title} ${He.description}`.toLowerCase().includes(We)):Ve})())}),j0(),_v();var ce=Yn(),je=tn(ce);Ye(je,s,Ve=>{var We=Vse(),He=y(We),Ue=y(He),et=v(y(Ue),2);_(Ue);var ft=v(Ue,2),it=y(ft),Lt=v(it,2),Tt=v(Lt,2),Pt=v(Tt,2),St=v(Pt,2);_(ft);var st=v(ft,2),xt=y(st);Ye(xt,()=>i(r)==="json",Xe=>{var Be=Lse(),Qe=y(Be),ct=y(Qe);Ne(()=>Dt(ct,"href",ae("#json-what",void 0)));var Mt=v(ct,2);Ne(()=>Dt(Mt,"href",ae("#json-quick",void 0)));var mt=v(Mt,2);Ne(()=>Dt(mt,"href",ae("#json-core",void 0)));var Ce=v(mt,2);Ne(()=>Dt(Ce,"href",ae("#json-supported",void 0)));var Te=v(Ce,2);Ne(()=>Dt(Te,"href",ae("#json-limits",void 0)));var It=v(Te,2);Ne(()=>Dt(It,"href",ae("#json-mistakes",void 0)));var $t=v(It,2);Ne(()=>Dt($t,"href",ae("#json-mini",void 0))),_(Qe);var Yt=v(Qe,16),qn=y(Yt),Vn=v(y(qn),2);Ro(Vn,5,()=>d,fi,(ro,bs)=>{var zt=Nse(),Qt=y(zt,!0);_(zt),Ne(()=>tt(Qt,i(bs))),Y(ro,zt)}),_(Vn),_(qn);var Dn=v(qn,2),Wn=v(y(Dn),2);Ro(Wn,5,()=>h,fi,(ro,bs)=>{var zt=Ase(),Qt=y(zt,!0);_(zt),Ne(()=>tt(Qt,i(bs))),Y(ro,zt)}),_(Wn),_(Dn);var pn=v(Dn,2),gn=v(y(pn),2);Ro(gn,5,()=>m,fi,(ro,bs)=>{var zt=Tse(),Qt=y(zt,!0);_(zt),Ne(()=>tt(Qt,i(bs))),Y(ro,zt)}),_(gn),_(pn),_(Yt);var Qs=v(Yt,14),Is=v(y(Qs),2),Cs=v(y(Is),2);Ro(Cs,5,()=>Object.keys(t8),fi,(ro,bs)=>{var zt=Fse(),Qt=y(zt,!0);_(zt),Ne(()=>tt(Qt,i(bs))),Y(ro,zt)}),_(Cs),Di(4),_(Is),_(Qs),_(Be),Y(Xe,Be)},Xe=>{var Be=Yn(),Qe=tn(Be);Ye(Qe,()=>i(r)==="dsl",ct=>{var Mt=Ese(),mt=y(Mt),Ce=y(mt);Ne(()=>Dt(Ce,"href",ae("#dsl-what",void 0)));var Te=v(Ce,2);Ne(()=>Dt(Te,"href",ae("#dsl-quick",void 0)));var It=v(Te,2);Ne(()=>Dt(It,"href",ae("#dsl-core",void 0)));var $t=v(It,2);Ne(()=>Dt($t,"href",ae("#dsl-supported",void 0)));var Yt=v($t,2);Ne(()=>Dt(Yt,"href",ae("#dsl-limits",void 0)));var qn=v(Yt,2);Ne(()=>Dt(qn,"href",ae("#dsl-mistakes",void 0)));var Vn=v(qn,2);Ne(()=>Dt(Vn,"href",ae("#dsl-mini",void 0))),_(mt),Di(28),_(Mt),Y(ct,Mt)},ct=>{var Mt=Yn(),mt=tn(Mt);Ye(mt,()=>i(r)==="pine",Ce=>{var Te=$se(),It=y(Te),$t=y(It);Ne(()=>Dt($t,"href",ae("#pine-what",void 0)));var Yt=v($t,2);Ne(()=>Dt(Yt,"href",ae("#pine-quick",void 0)));var qn=v(Yt,2);Ne(()=>Dt(qn,"href",ae("#pine-core",void 0)));var Vn=v(qn,2);Ne(()=>Dt(Vn,"href",ae("#pine-supported",void 0)));var Dn=v(Vn,2);Ne(()=>Dt(Dn,"href",ae("#pine-changelog",void 0)));var Wn=v(Dn,2);Ne(()=>Dt(Wn,"href",ae("#pine-howto",void 0)));var pn=v(Wn,2);Ne(()=>Dt(pn,"href",ae("#pine-session",void 0)));var gn=v(pn,2);Ne(()=>Dt(gn,"href",ae("#pine-request-security",void 0)));var Qs=v(gn,2);Ne(()=>Dt(Qs,"href",ae("#pine-not-supported",void 0)));var Is=v(Qs,2);Ne(()=>Dt(Is,"href",ae("#pine-limits",void 0)));var Cs=v(Is,2);Ne(()=>Dt(Cs,"href",ae("#pine-mistakes",void 0)));var ro=v(Cs,2);Ne(()=>Dt(ro,"href",ae("#pine-mini",void 0))),_(It),Di(146),_(Te),Y(Ce,Te)},Ce=>{var Te=Yn(),It=tn(Te);Ye(It,()=>i(r)==="js",$t=>{var Yt=Dse(),qn=y(Yt),Vn=y(qn);Ne(()=>Dt(Vn,"href",ae("#js-start",void 0)));var Dn=v(Vn,2);Ne(()=>Dt(Dn,"href",ae("#js-index",void 0)));var Wn=v(Dn,2);Ne(()=>Dt(Wn,"href",ae("#js-recipes",void 0)));var pn=v(Wn,2);Ne(()=>Dt(pn,"href",ae("#js-playbook",void 0)));var gn=v(pn,2);Ne(()=>Dt(gn,"href",ae("#js-support",void 0)));var Qs=v(gn,2);Ne(()=>Dt(Qs,"href",ae("#js-structure",void 0)));var Is=v(Qs,2);Ne(()=>Dt(Is,"href",ae("#js-data",void 0)));var Cs=v(Is,2);Ne(()=>Dt(Cs,"href",ae("#js-history",void 0)));var ro=v(Cs,2);Ne(()=>Dt(ro,"href",ae("#js-plots",void 0)));var bs=v(ro,2);Ne(()=>Dt(bs,"href",ae("#js-gradient",void 0)));var zt=v(bs,2);Ne(()=>Dt(zt,"href",ae("#js-pane-scaling",void 0)));var Qt=v(zt,2);Ne(()=>Dt(Qt,"href",ae("#js-autoscale",void 0)));var ho=v(Qt,2);Ne(()=>Dt(ho,"href",ae("#js-draw",void 0)));var ri=v(ho,2);Ne(()=>Dt(ri,"href",ae("#js-polyline-polygon",void 0)));var jo=v(ri,2);Ne(()=>Dt(jo,"href",ae("#js-overlays",void 0)));var Na=v(jo,2);Ne(()=>Dt(Na,"href",ae("#js-interaction",void 0)));var ar=v(Na,2);Ne(()=>Dt(ar,"href",ae("#js-heatmap",void 0)));var Aa=v(ar,2);Ne(()=>Dt(Aa,"href",ae("#js-webgl",void 0)));var nr=v(Aa,2);Ne(()=>Dt(nr,"href",ae("#js-strategy",void 0)));var hi=v(nr,2);Ne(()=>Dt(hi,"href",ae("#js-alerts",void 0)));var Gc=v(hi,2);Ne(()=>Dt(Gc,"href",ae("#js-mtf",void 0)));var Pu=v(Gc,2);Ne(()=>Dt(Pu,"href",ae("#js-datafeed",void 0)));var wc=v(Pu,2);Ne(()=>Dt(wc,"href",ae("#js-stdlib",void 0)));var cc=v(wc,2);Ne(()=>Dt(cc,"href",ae("#js-api",void 0)));var ou=v(cc,2);Ne(()=>Dt(ou,"href",ae("#js-performance",void 0)));var zu=v(ou,2);Ne(()=>Dt(zu,"href",ae("#js-safety",void 0)));var ja=v(zu,2);Ne(()=>Dt(ja,"href",ae("#js-guardrails",void 0)));var nc=v(ja,2);Ne(()=>Dt(nc,"href",ae("#js-rules",void 0)));var Bc=v(nc,2);Ne(()=>Dt(Bc,"href",ae("#js-troubleshoot",void 0)));var Vu=v(Bc,2);Ne(()=>Dt(Vu,"href",ae("#js-examples",void 0)));var rf=v(Vu,2);Ne(()=>Dt(rf,"href",ae("#js-status",void 0))),_(qn);var co=v(qn,10),ll=y(co),va=v(y(ll)),Vl=v(y(va),3),kr=v(y(Vl)),Wr=y(kr);Ne(()=>Dt(Wr,"href",ae("#js-polyline-polygon",void 0))),_(kr),Di(),_(Vl),Di(5),_(va),_(ll),_(co),Di(186),_(Yt),Y($t,Yt)},$t=>{var Yt=Yn(),qn=tn(Yt);Ye(qn,()=>i(r)==="examples",Vn=>{var Dn=Ose(),Wn=y(Dn),pn=y(Wn),gn=y(pn),Qs=v(gn,2),Is=v(Qs,2),Cs=v(Is,2);_(pn);var ro=v(pn,2);mn(ro),_(Wn);var bs=v(Wn,2);Ye(bs,()=>i(P)[i(l)]&&!i(w)[i(l)].length,ho=>{var ri=Rse();Y(ho,ri)});var zt=v(bs,2);Ro(zt,5,()=>i(t),fi,(ho,ri)=>{var jo=jse(),Na=y(jo),ar=y(Na),Aa=y(ar),nr=y(Aa,!0);_(Aa);var hi=v(Aa,2),Gc=y(hi,!0);_(hi),_(ar),_(Na);var Pu=v(Na,2),wc=y(Pu),cc=y(wc,!0);_(wc),_(Pu);var ou=v(Pu,2),zu=y(ou),ja=v(zu,2);_(ou),_(jo),Ne(()=>{tt(nr,i(ri).title),tt(Gc,i(ri).description),tt(cc,i(ri).code)}),ld("click",zu,()=>pe(i(ri).code)),ld("click",ja,()=>he(i(ri))),Y(ho,jo)}),_(zt);var Qt=v(zt,2);Ye(Qt,()=>!i(t).length&&!i(P)[i(l)],ho=>{var ri=Bse();Y(ho,ri)}),_(Dn),Ne(()=>{Fi(gn,`ss-tab ${(i(l)==="json"?"active":"")??""} svelte-15ifth6`),Dt(gn,"aria-selected",i(l)==="json"),Fi(Qs,`ss-tab ${(i(l)==="dsl"?"active":"")??""} svelte-15ifth6`),Dt(Qs,"aria-selected",i(l)==="dsl"),Fi(Is,`ss-tab ${(i(l)==="pine"?"active":"")??""} svelte-15ifth6`),Dt(Is,"aria-selected",i(l)==="pine"),Fi(Cs,`ss-tab ${(i(l)==="js"?"active":"")??""} svelte-15ifth6`),Dt(Cs,"aria-selected",i(l)==="js")}),ld("click",pn,z),As(ro,()=>i(c),ho=>x(c,ho)),Y(Vn,Dn)},null,!0),Y($t,Yt)},!0),Y(Ce,Te)},!0),Y(ct,Mt)},!0),Y(Xe,Be)}),_(st),ep(st,Xe=>x(a,Xe),()=>i(a));var Je=v(st,2);Ye(Je,()=>i(u),Xe=>{var Be=zse(),Qe=y(Be,!0);_(Be),Ne(()=>tt(Qe,i(f))),Y(Xe,Be)}),_(He),_(We),Ne(()=>{Fi(it,`ss-tab ${(i(r)==="json"?"active":"")??""} svelte-15ifth6`),Dt(it,"aria-selected",i(r)==="json"),Fi(Lt,`ss-tab ${(i(r)==="dsl"?"active":"")??""} svelte-15ifth6`),Dt(Lt,"aria-selected",i(r)==="dsl"),Fi(Tt,`ss-tab ${(i(r)==="pine"?"active":"")??""} svelte-15ifth6`),Dt(Tt,"aria-selected",i(r)==="pine"),Fi(Pt,`ss-tab ${(i(r)==="js"?"active":"")??""} svelte-15ifth6`),Dt(Pt,"aria-selected",i(r)==="js"),Fi(St,`ss-tab ${(i(r)==="examples"?"active":"")??""} svelte-15ifth6`),Dt(St,"aria-selected",i(r)==="examples")}),ld("click",et,N),ld("click",ft,D),ld("click",We,Xe=>{Xe.target===Xe.currentTarget&&N()}),Y(Ve,We)}),Y(n,ce),Ed()}const Hse={signals:new Set,label:new Set};function W5(n,e){Hse[n].forEach(t=>{try{t(e)}catch{}})}const Sy=Fm({});function qse(n,e){Sy.update(t=>({...t,[n]:e}))}function Use(n){return mm(Sy)[n]||[]}const Gse=Sy;function Yse(n){Sy.update(e=>{const{[n]:t,...s}=e;return s})}function Kse(){Sy.set({})}class Xse{constructor(e,t,s,o){$e(this,"gl");$e(this,"width");$e(this,"height");$e(this,"padding");$e(this,"texture");$e(this,"cursorX",0);$e(this,"cursorY",0);$e(this,"rowHeight",0);this.gl=e,this.width=Math.max(1,Math.floor(t)),this.height=Math.max(1,Math.floor(s)),this.padding=Math.max(0,Math.floor((o==null?void 0:o.padding)??1));const r=e.createTexture();if(!r)throw new Error("Failed to create WebGL texture.");this.texture=r,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=(o==null?void 0:o.filter)??e.LINEAR;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null)}bind(e=0){const t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}allocate(e,t){const s=Math.max(1,Math.floor(e)),o=Math.max(1,Math.floor(t)),r=s+this.padding*2,a=o+this.padding*2;if(r>this.width||a>this.height||(this.cursorX+r>this.width&&(this.cursorX=0,this.cursorY+=this.rowHeight,this.rowHeight=0),this.cursorY+a>this.height))return null;const l=this.cursorX+this.padding,c=this.cursorY+this.padding;this.cursorX+=r,this.rowHeight=Math.max(this.rowHeight,a);const f=l/this.width,u=c/this.height,d=(l+s)/this.width,h=(c+o)/this.height;return{x:l,y:c,width:s,height:o,u0:f,v0:u,u1:d,v1:h}}update(e,t){const s=this.gl;s.bindTexture(s.TEXTURE_2D,this.texture),s.texSubImage2D(s.TEXTURE_2D,0,e.x,e.y,s.RGBA,s.UNSIGNED_BYTE,t)}destroy(){this.gl.deleteTexture(this.texture)}}const Zse={alpha:!0,antialias:!0,depth:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!0,powerPreference:"high-performance"},H5=(n,e,t)=>{const s=n.createShader(e);if(!s)return null;if(n.shaderSource(s,t),n.compileShader(s),!n.getShaderParameter(s,n.COMPILE_STATUS)){const o=n.getShaderInfoLog(s);return n.deleteShader(s),console.warn("[WebGL] Shader compile failed:",o),null}return s},Jse=(n,e)=>{const t=H5(n,n.VERTEX_SHADER,e.vertex),s=H5(n,n.FRAGMENT_SHADER,e.fragment);if(!t||!s)return null;const o=n.createProgram();if(!o)return null;if(n.attachShader(o,t),n.attachShader(o,s),n.linkProgram(o),n.deleteShader(t),n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const r=n.getProgramInfoLog(o);return n.deleteProgram(o),console.warn("[WebGL] Program link failed:",r),null}return o},Qse=(n,e)=>{const t={...Zse},s=n.getContext("webgl2",t),o=!s&&n.getContext("webgl",t),r=s||o,a=s?"webgl2":o?"webgl1":"canvas",l=r?null:n.getContext("2d"),c=new Map,f=new Map,u=new Map;return{mode:a,canvas:n,gl:r??void 0,ctx2d:l,isWebgl:!!r,isWebgl2:!!s,resize:(h,m,g)=>{const w=Math.max(1,Math.floor(h*g)),C=Math.max(1,Math.floor(m*g));n.width=w,n.height=C,n.style.width=`${h}px`,n.style.height=`${m}px`,r?r.viewport(0,0,w,C):l&&l.setTransform(g,0,0,g,0,0)},getProgram:(h,m)=>{if(!r)return null;const g=m.version?`@${m.version}`:"",w=`${h}${g}`,C=c.get(w);if(C)return C;const M=Jse(r,m);if(!M)return null;const P=new Map,T=new Map;Array.isArray(m.attributes)&&m.attributes.forEach(L=>{P.set(L,r.getAttribLocation(M,L))}),Array.isArray(m.uniforms)&&m.uniforms.forEach(L=>{T.set(L,r.getUniformLocation(M,L))});const N={key:w,program:M,attributes:P,uniforms:T};return c.set(w,N),N},getBuffer:(h,m)=>{if(!r)return null;const g=`${h}:${m??r.ARRAY_BUFFER}`,w=f.get(g);if(w)return w;const C=r.createBuffer();if(!C)return null;const M={key:g,buffer:C,target:m??r.ARRAY_BUFFER};return f.set(g,M),M},createTextureAtlas:(h,m,g)=>{if(!r)return null;const w=u.get(h);if(w)return w;const C=new Xse(r,m,g);return u.set(h,C),C},destroy:()=>{if(r){for(const h of c.values())r.deleteProgram(h.program);for(const h of f.values())r.deleteBuffer(h.buffer);for(const h of u.values())h.destroy()}c.clear(),f.clear(),u.clear()}}},q5=[{stop:0,color:"#0b1020"},{stop:.25,color:"#1e4fd8"},{stop:.5,color:"#22c55e"},{stop:.75,color:"#f59e0b"},{stop:1,color:"#ef4444"}],U5=25e4,q8=1e6,Rx=256,G5=256,Y5=512,K5=32,X5=512,U8=n=>Math.max(0,Math.min(1,n)),eoe=n=>{const e=n.replace("#","").trim();if(e.length===3){const t=parseInt(e[0]+e[0],16),s=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16);return[t,s,o,255]}if(e.length===6||e.length===8){const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),r=e.length===8?parseInt(e.slice(6,8),16):255;return[t,s,o,r]}return null},toe=n=>{const e=n.trim().match(/rgba?\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*(?:,\s*([0-9.]+)\s*)?\)/i);if(!e)return null;const t=Number(e[1]),s=Number(e[2]),o=Number(e[3]),r=e[4],a=r==null?1:Number(r);return[t,s,o,a].every(l=>Number.isFinite(l))?[Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,s)),Math.max(0,Math.min(255,o)),Math.max(0,Math.min(255,Math.round(a*255)))]:null},noe=n=>{if(!n)return[255,255,255,255];const e=String(n).trim();if(!e)return[255,255,255,255];if(e.startsWith("#")){const t=eoe(e);if(t)return t}if(e.startsWith("rgb")){const t=toe(e);if(t)return t}return[255,255,255,255]},Z5=n=>{const e=new Uint8Array(1024),t=n.map(o=>({stop:U8(Number(o.stop)),color:noe(o.color)})).sort((o,r)=>o.stop-r.stop),s=o=>{if(!t.length)return[255,255,255,255];if(o<=t[0].stop)return t[0].color;if(o>=t[t.length-1].stop)return t[t.length-1].color;for(let r=0;r+1<t.length;r++){const a=t[r],l=t[r+1];if(o>=a.stop&&o<=l.stop){const c=l.stop-a.stop||1,f=(o-a.stop)/c,u=Math.round(a.color[0]+(l.color[0]-a.color[0])*f),d=Math.round(a.color[1]+(l.color[1]-a.color[1])*f),h=Math.round(a.color[2]+(l.color[2]-a.color[2])*f),m=Math.round(a.color[3]+(l.color[3]-a.color[3])*f);return[u,d,h,m]}}return t[t.length-1].color};for(let o=0;o<256;o++){const r=o/255,[a,l,c,f]=s(r),u=o*4;e[u]=a,e[u+1]=l,e[u+2]=c,e[u+3]=f}return e},G8=(n,e,t,s)=>{let o=Math.max(1,e),r=Math.max(1,t),a=Math.max(1,Math.floor(n.width/o)),l=Math.max(1,Math.floor(n.height/r)),c=a*l;if(c>s){const f=Math.sqrt(c/s);o=Math.max(1,Math.floor(o*f)),r=Math.max(1,Math.floor(r*f)),a=Math.max(1,Math.floor(n.width/o)),l=Math.max(1,Math.floor(n.height/r)),c=a*l}return{xBins:a,yBins:l,binX:o,binY:r}},soe=(n,e,t)=>{const s=Math.max(1,e),o=Math.max(1,t),r=Math.max(1,Math.floor(n.width/s)),a=Math.max(1,Math.floor(n.height/o)),l=r*a;let c=1;if(l>U5){const d=Math.sqrt(l/U5),h=Math.pow(2,Math.floor(Math.log2(d)));c=Math.max(1,h)}const f=Math.max(1,Math.floor(s*c)),u=Math.max(1,Math.floor(o*c));return G8(n,f,u,q8)},ooe=n=>{let e=Rx,t=Math.ceil(n.width/e),s=Math.ceil(n.height/e),o=t*s;if(o>G5){const r=Math.ceil(Math.sqrt(o/G5));e=Math.max(Rx,Rx*r),t=Math.ceil(n.width/e),s=Math.ceil(n.height/e),o=t*s}return{tileSize:e,cols:t,rows:s}},ioe=(n,e,t,s,o)=>{const{xBins:r,yBins:a,binX:l,binY:c}=G8(e,t,s,q8),f=r*a,u=new Float32Array(f),d=new Uint32Array(f);if(o==="max")for(let w=0;w<f;w++)u[w]=-1/0;else if(o==="min")for(let w=0;w<f;w++)u[w]=1/0;for(const w of n){const C=w.x-e.left,M=w.y-e.top;if(C<0||M<0||C>=e.width||M>=e.height)continue;const P=Math.floor(C/l),T=Math.floor(M/c);if(P<0||T<0||P>=r||T>=a)continue;const N=T*r+P,L=w.value;Number.isFinite(L)&&(o==="max"?u[N]=Math.max(u[N],L):o==="min"?u[N]=Math.min(u[N],L):u[N]+=L,d[N]+=1)}if(o==="avg")for(let w=0;w<f;w++){const C=d[w];u[w]=C>0?u[w]/C:0}let h=1/0,m=-1/0;for(let w=0;w<f;w++){if(!d[w])continue;const C=u[w];Number.isFinite(C)&&(h=Math.min(h,C),m=Math.max(m,C))}const g=new Uint8Array(f);for(let w=0;w<f;w++)d[w]&&(g[w]=1);return{width:r,height:a,accum:u,mask:g,min:h,max:m}},roe=(n,e,t,s)=>{const o=n.width*n.height*4,r=s&&s.length===o?s:new Uint8Array(o),a=Number.isFinite(e)?e:0;let l=Number.isFinite(t)?t:a+1;a===l&&(l=a+1);const c=l-a||1;for(let f=0;f<n.accum.length;f++){const u=n.accum[f],d=n.mask[f]===1,h=Number.isFinite(u)?U8((u-a)/c):0,m=Math.round(h*255),g=f*4;r[g]=m,r[g+1]=0,r[g+2]=0,r[g+3]=d?255:0}return r};class aoe{constructor(e){$e(this,"runtime");$e(this,"program",null);$e(this,"quadBuffer",null);$e(this,"dataTextures",new Map);$e(this,"colormapCache",new Map);$e(this,"tileCache",new Map);$e(this,"cacheTick",0);$e(this,"canvasFallback",null);this.runtime=e}ensureProgram(e){if(this.program)return;const t=`
      attribute vec2 a_pos;
      void main() {
        gl_Position = vec4(a_pos, 0.0, 1.0);
      }
    `,s=`
      precision mediump float;
      uniform sampler2D u_data;
      uniform sampler2D u_colormap;
      uniform vec4 u_bounds;
      uniform vec2 u_canvas;
      uniform float u_opacity;
      void main() {
        vec2 frag = vec2(gl_FragCoord.x, u_canvas.y - gl_FragCoord.y);
        vec2 pos = frag - u_bounds.xy;
        if (pos.x < 0.0 || pos.y < 0.0 || pos.x > u_bounds.z || pos.y > u_bounds.w) {
          discard;
        }
        vec2 uv = vec2(pos.x / u_bounds.z, pos.y / u_bounds.w);
        vec4 data = texture2D(u_data, uv);
        float v = data.r;
        float m = data.a;
        vec4 c = texture2D(u_colormap, vec2(v, 0.5));
        gl_FragColor = vec4(c.rgb, c.a * u_opacity * m);
      }
    `,o=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);if(!o||!r||(e.shaderSource(o,t),e.shaderSource(r,s),e.compileShader(o),e.compileShader(r),!e.getShaderParameter(o,e.COMPILE_STATUS))||!e.getShaderParameter(r,e.COMPILE_STATUS))return;const a=e.createProgram();a&&(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.deleteShader(o),e.deleteShader(r),e.getProgramParameter(a,e.LINK_STATUS)&&(this.program=a))}ensureQuadBuffer(e){if(this.quadBuffer)return;const t=e.createBuffer();if(!t)return;e.bindBuffer(e.ARRAY_BUFFER,t);const s=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),this.quadBuffer=t}getColormapTexture(e,t){const s=JSON.stringify(t),o=this.colormapCache.get(s);if(o)return o;const r=e.createTexture();if(!r)return null;e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const a=Z5(t);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,256,1,0,e.RGBA,e.UNSIGNED_BYTE,a),this.colormapCache.set(s,r),r}getDataTexture(e,t,s,o,r,a){const l=this.dataTextures.get(t);if(l&&l.width===s&&l.height===o&&l.version===r)return l.lastUsed=a,l.texture;const c=(l==null?void 0:l.texture)??e.createTexture();return c?(e.bindTexture(e.TEXTURE_2D,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),this.dataTextures.set(t,{texture:c,width:s,height:o,version:r,lastUsed:a}),c):null}getSpecCache(e,t){let s=this.tileCache.get(e);return s||(s={tiles:new Map,lastUsed:t},this.tileCache.set(e,s)),s.lastUsed=t,s}pruneCaches(){if(this.tileCache.size>K5){const t=Array.from(this.tileCache.entries()).sort((o,r)=>o[1].lastUsed-r[1].lastUsed),s=this.tileCache.size-K5;for(let o=0;o<s;o++)this.tileCache.delete(t[o][0])}let e=0;if(this.tileCache.forEach(t=>{e+=t.tiles.size}),e>Y5){const t=[];this.tileCache.forEach((o,r)=>{o.tiles.forEach((a,l)=>{t.push([r,l,a])})}),t.sort((o,r)=>o[2].lastUsed-r[2].lastUsed);const s=e-Y5;for(let o=0;o<s;o++){const[r,a]=t[o],l=this.tileCache.get(r);l==null||l.tiles.delete(a)}}if(this.dataTextures.size>X5){const t=Array.from(this.dataTextures.entries()).sort((o,r)=>o[1].lastUsed-r[1].lastUsed),s=this.dataTextures.size-X5;for(let o=0;o<s;o++){const r=t[o];if(!r)continue;const a=r[1].texture;this.runtime.gl&&this.runtime.gl.deleteTexture(a),this.dataTextures.delete(r[0])}}}buildTiles(e,t){const s=e.bounds,o=e.xBinPx??3,r=e.yBinPx??3,a=e.agg??"sum",l=soe(s,o,r),{tileSize:c,cols:f,rows:u}=ooe(s),d=new Array(f*u);for(const P of e.points){const T=P.x-s.left,N=P.y-s.top;if(T<0||N<0||T>=s.width||N>=s.height)continue;const L=Math.floor(T/c),O=Math.floor(N/c);if(L<0||O<0||L>=f||O>=u)continue;const D=O*f+L;d[D]||(d[D]=[]),d[D].push(P)}const h=e.viewKey??"",m=`${e.id}:${e.version??0}:${h}:${l.binX}:${l.binY}:${a}`,g=this.getSpecCache(m,t),w=[];for(let P=0;P<u;P++)for(let T=0;T<f;T++){const N=P*f+T,L=d[N];if(!L||!L.length)continue;const O=s.left+T*c,D=s.top+P*c,$=Math.min(c,s.width-T*c),z=Math.min(c,s.height-P*c),te={left:O,top:D,width:$,height:z},pe=`${T}:${P}:${$}:${z}`;let J=g.tiles.get(pe);if(J)J.lastUsed=t;else{const le=ioe(L,te,l.binX,l.binY,a);J={grid:le,encoded:new Uint8Array(le.width*le.height*4),min:NaN,max:NaN,lastUsed:t},g.tiles.set(pe,J)}w.push({key:pe,bounds:te,grid:J.grid,encoded:J.encoded,min:J.min,max:J.max})}let C=Number.isFinite(e.minValue)?e.minValue:1/0,M=Number.isFinite(e.maxValue)?e.maxValue:-1/0;if(!Number.isFinite(e.minValue)||!Number.isFinite(e.maxValue))for(const P of w)Number.isFinite(e.minValue)||(C=Math.min(C,P.grid.min)),Number.isFinite(e.maxValue)||(M=Math.max(M,P.grid.max));Number.isFinite(C)||(C=0),Number.isFinite(M)||(M=C+1),C===M&&(M=C+1);for(const P of w)if(P.min!==C||P.max!==M){P.encoded=roe(P.grid,C,M,P.encoded),P.min=C,P.max=M;const T=g.tiles.get(P.key);T&&(T.encoded=P.encoded,T.min=C,T.max=M)}return w.map(P=>({key:P.key,bounds:P.bounds,encoded:P.encoded,width:P.grid.width,height:P.grid.height}))}clear(){const e=this.runtime.gl;if(!e){const t=this.runtime.ctx2d;t&&t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);return}e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}render(e,t){this.cacheTick+=1;const s=this.cacheTick;if(!e.length){(t==null?void 0:t.clear)!==!1&&this.clear(),this.pruneCaches();return}const o=this.runtime,r=o.gl;if(!r){this.renderCanvas(e),this.pruneCaches();return}const a=o.canvas.clientWidth||o.canvas.width||1,l=o.canvas.clientHeight||o.canvas.height||1,c=o.canvas.width/a,f=o.canvas.height/l;if((t==null?void 0:t.clear)!==!1&&(r.disable(r.SCISSOR_TEST),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)),this.ensureProgram(r),this.ensureQuadBuffer(r),!this.program||!this.quadBuffer)return;r.useProgram(this.program),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer);const u=r.getAttribLocation(this.program,"a_pos");r.enableVertexAttribArray(u),r.vertexAttribPointer(u,2,r.FLOAT,!1,0,0);const d=r.getUniformLocation(this.program,"u_data"),h=r.getUniformLocation(this.program,"u_colormap"),m=r.getUniformLocation(this.program,"u_bounds"),g=r.getUniformLocation(this.program,"u_canvas"),w=r.getUniformLocation(this.program,"u_opacity");r.uniform2f(g,o.canvas.width,o.canvas.height),r.enable(r.BLEND),r.disable(r.DEPTH_TEST),r.enable(r.SCISSOR_TEST);for(const C of e)for(const M of C.heatmaps){const P=this.buildTiles(M,s);if(!P.length)continue;const T=M.colormap&&M.colormap.length?M.colormap:q5,N=this.getColormapTexture(r,T);if(!N)continue;const L=Number.isFinite(M.opacity)?Math.max(0,Math.min(1,M.opacity)):1;r.uniform1f(w,L),M.blend==="add"?r.blendFunc(r.SRC_ALPHA,r.ONE):M.blend==="screen"?r.blendFunc(r.ONE,r.ONE_MINUS_SRC_COLOR):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(const O of P){const D=`${M.id}:${O.key}`,$=this.getDataTexture(r,D,O.width,O.height,M.version??0,s);if(!$)continue;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,$),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,O.width,O.height,0,r.RGBA,r.UNSIGNED_BYTE,O.encoded),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,N),r.uniform1i(d,0),r.uniform1i(h,1);const z=O.bounds.left*c,te=O.bounds.top*f,pe=O.bounds.width*c,J=O.bounds.height*f;r.uniform4f(m,z,te,pe,J);const le=Math.round(z),de=Math.round(o.canvas.height-(te+J)),he=Math.round(pe),ge=Math.round(J);r.scissor(le,de,he,ge),r.drawArrays(r.TRIANGLES,0,6)}}r.disable(r.SCISSOR_TEST),this.pruneCaches()}renderCanvas(e){const t=this.runtime.ctx2d;if(t){t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);for(const s of e)for(const o of s.heatmaps){const r=o.colormap&&o.colormap.length?o.colormap:q5,a=Z5(r),l=this.buildTiles(o,this.cacheTick);if(l.length)for(const c of l){const f=t.createImageData(c.width,c.height);for(let m=0;m<c.width*c.height;m++){const g=m*4,C=c.encoded[g]*4;f.data[g]=a[C],f.data[g+1]=a[C+1],f.data[g+2]=a[C+2];const M=c.encoded[g+3]/255;f.data[g+3]=Math.round(a[C+3]*M)}this.canvasFallback||(this.canvasFallback=document.createElement("canvas"));const u=this.canvasFallback;u.width=c.width,u.height=c.height;const d=u.getContext("2d");if(!d)continue;d.putImageData(f,0,0);const h=Number.isFinite(o.opacity)?Math.max(0,Math.min(1,o.opacity)):1;t.save(),t.globalAlpha=h,t.drawImage(u,c.bounds.left,c.bounds.top,c.bounds.width,c.bounds.height),t.restore()}}this.pruneCaches()}}destroy(){const e=this.runtime.gl;e&&this.program&&e.deleteProgram(this.program),e&&this.quadBuffer&&e.deleteBuffer(this.quadBuffer);for(const t of this.dataTextures.values())e&&e.deleteTexture(t.texture);for(const t of this.colormapCache.values())e&&e.deleteTexture(t);this.dataTextures.clear(),this.colormapCache.clear(),this.tileCache.clear(),this.program=null,this.quadBuffer=null,this.canvasFallback=null}}const t2=n=>Math.max(0,Math.min(1,n)),Eb=(n,e,t)=>n+(e-n)*t,loe=(n,e,t)=>[Eb(n[0],e[0],t),Eb(n[1],e[1],t),Eb(n[2],e[2],t),Eb(n[3],e[3],t)],coe=n=>{const e=n.replace("#","").trim();if(e.length===3){const t=parseInt(e[0]+e[0],16),s=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16);return[t,s,o,255]}if(e.length===6||e.length===8){const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),r=e.length===8?parseInt(e.slice(6,8),16):255;return[t,s,o,r]}return null},uoe=n=>{const e=n.trim().match(/rgba?\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*(?:,\s*([0-9.]+)\s*)?\)/i);if(!e)return null;const t=Number(e[1]),s=Number(e[2]),o=Number(e[3]),r=e[4],a=r==null?1:Number(r);return[t,s,o,a].every(l=>Number.isFinite(l))?[Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,s)),Math.max(0,Math.min(255,o)),Math.max(0,Math.min(255,Math.round(a*255)))]:null},h_=n=>{if(!n)return[1,1,1,1];const e=String(n).trim();if(!e)return[1,1,1,1];if(e.startsWith("#")){const t=coe(e);if(t)return[t[0]/255,t[1]/255,t[2]/255,t[3]/255]}if(e.startsWith("rgb")){const t=uoe(e);if(t)return[t[0]/255,t[1]/255,t[2]/255,t[3]/255]}return[1,1,1,1]},Y8=n=>{const e=n.length;if(e<3)return[];const t=Array.from({length:e},(f,u)=>u),s=[],r=(()=>{let f=0;for(let u=0;u<e;u++){const d=n[u],h=n[(u+1)%e];f+=(h.x-d.x)*(h.y+d.y)}return f})()>0?1:-1,a=(f,u,d)=>{const h=n[f],m=n[u],g=n[d],w=(m.x-h.x)*(g.y-h.y)-(m.y-h.y)*(g.x-h.x);return r*w<0},l=(f,u,d,h)=>{const m=h.x-u.x,g=h.y-u.y,w=d.x-u.x,C=d.y-u.y,M=f.x-u.x,P=f.y-u.y,T=m*m+g*g,N=m*w+g*C,L=m*M+g*P,O=w*w+C*C,D=w*M+C*P,$=1/(T*O-N*N||1),z=(O*L-N*D)*$,te=(T*D-N*L)*$;return z>=0&&te>=0&&z+te<=1};let c=0;for(;t.length>3&&c<1e4;){c+=1;let f=!1;for(let u=0;u<t.length;u++){const d=t[(u-1+t.length)%t.length],h=t[u],m=t[(u+1)%t.length];if(!a(d,h,m))continue;const g=n[d],w=n[h],C=n[m];let M=!1;for(let P=0;P<t.length;P++){const T=t[P];if(!(T===d||T===h||T===m)&&l(n[T],g,w,C)){M=!0;break}}if(!M){s.push(d,h,m),t.splice(u,1),f=!0;break}}if(!f)break}if(t.length===3&&s.push(t[0],t[1],t[2]),!s.length)for(let f=1;f+1<e;f++)s.push(0,f,f+1);return s},R_=(n,e)=>{const t=[];if(n.length<2)return t;const s=e.toLowerCase(),o=s==="dashed"?[6,4]:s==="dotted"?[2,2]:null;if(!o){for(let l=0;l+1<n.length;l++)t.push({a:n[l],b:n[l+1]});return t}let r=0,a=0;for(let l=0;l+1<n.length;l++){const c=n[l],f=n[l+1],u=f.x-c.x,d=f.y-c.y,h=Math.hypot(u,d);if(!Number.isFinite(h)||h<=0)continue;const m=u/h,g=d/h;let w=0;for(;w<h;){const C=o[r%o.length],M=C-a,P=Math.min(M,h-w);if(r%2===0&&P>0){const N=c.x+m*w,L=c.y+g*w,O=c.x+m*(w+P),D=c.y+g*(w+P);t.push({a:{x:N,y:L},b:{x:O,y:D}})}w+=P,a+=P,a>=C-1e-6&&(r+=1,a=0)}}return t},H1=(n,e,t)=>{if(!n.length)return new Float32Array(0);const s=[],o=Math.max(.5,e/2);for(const r of n){const a=r.b.x-r.a.x,l=r.b.y-r.a.y,c=Math.hypot(a,l);if(!Number.isFinite(c)||c<=0)continue;const f=-l/c,u=a/c,d=r.a.x+f*o,h=r.a.y+u*o,m=r.a.x-f*o,g=r.a.y-u*o,w=r.b.x+f*o,C=r.b.y+u*o,M=r.b.x-f*o,P=r.b.y-u*o;s.push(d,h,t[0],t[1],t[2],t[3],m,g,t[0],t[1],t[2],t[3],w,C,t[0],t[1],t[2],t[3],w,C,t[0],t[1],t[2],t[3],m,g,t[0],t[1],t[2],t[3],M,P,t[0],t[1],t[2],t[3])}return new Float32Array(s)},doe=(n,e)=>{if(n.length<3)return new Float32Array(0);const t=Y8(n);if(!t.length)return new Float32Array(0);const s=[];for(let o=0;o<t.length;o+=3){const r=n[t[o]],a=n[t[o+1]],l=n[t[o+2]];s.push(r.x,r.y,e[0],e[1],e[2],e[3],a.x,a.y,e[0],e[1],e[2],e[3],l.x,l.y,e[0],e[1],e[2],e[3])}return new Float32Array(s)},foe=(n,e)=>{if(n.length<3||e.length!==n.length)return new Float32Array(0);const t=Y8(n);if(!t.length)return new Float32Array(0);const s=[];for(let o=0;o<t.length;o+=3){const r=t[o],a=t[o+1],l=t[o+2],c=n[r],f=n[a],u=n[l],d=e[r],h=e[a],m=e[l];s.push(c.x,c.y,d[0],d[1],d[2],d[3],f.x,f.y,h[0],h[1],h[2],h[3],u.x,u.y,m[0],m[1],m[2],m[3])}return new Float32Array(s)},poe=(n,e,t,s=1)=>{if(!e||!e.from&&!e.to)return null;const o=h_(e.from||t||"#38bdf8"),r=h_(e.to||t||e.from||"#38bdf8"),a=Math.min(...n.map(M=>M.x)),l=Math.max(...n.map(M=>M.x)),c=Math.min(...n.map(M=>M.y)),f=Math.max(...n.map(M=>M.y)),u=l-a||1,d=f-c||1,h=String(e.mode||"vertical").toLowerCase();let m=0,g=0,w=1;if(h==="radial"){m=(a+l)/2,g=(c+f)/2,w=0;for(const M of n){const P=Math.hypot(M.x-m,M.y-g);P>w&&(w=P)}(!Number.isFinite(w)||w<=0)&&(w=1)}const C=[];for(const M of n){let P=0;h==="horizontal"?P=(M.x-a)/u:h==="radial"?P=Math.hypot(M.x-m,M.y-g)/w:P=(M.y-c)/d;const T=loe(o,r,t2(P));T[3]=T[3]*s,C.push(T)}return C};class moe{constructor(e){$e(this,"runtime");$e(this,"program",null);$e(this,"buffer",null);this.runtime=e}ensureProgram(e){if(this.program)return;const t=`
      attribute vec2 a_pos;
      attribute vec4 a_color;
      varying vec4 v_color;
      uniform vec2 u_canvas;
      void main() {
        vec2 clip = (a_pos / u_canvas) * 2.0 - 1.0;
        gl_Position = vec4(clip.x, -clip.y, 0.0, 1.0);
        v_color = a_color;
      }
    `,s=`
      precision mediump float;
      varying vec4 v_color;
      void main() {
        gl_FragColor = v_color;
      }
    `,o=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);if(!o||!r||(e.shaderSource(o,t),e.shaderSource(r,s),e.compileShader(o),e.compileShader(r),!e.getShaderParameter(o,e.COMPILE_STATUS))||!e.getShaderParameter(r,e.COMPILE_STATUS))return;const a=e.createProgram();a&&(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.deleteShader(o),e.deleteShader(r),e.getProgramParameter(a,e.LINK_STATUS)&&(this.program=a))}ensureBuffer(e){this.buffer||(this.buffer=e.createBuffer())}clear(){const e=this.runtime.gl;if(!e){const t=this.runtime.ctx2d;t&&t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);return}e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}render(e,t){const s=this.runtime,o=s.gl;if(!o){this.clear();return}const r=s.canvas.clientWidth||s.canvas.width||1,a=s.canvas.clientHeight||s.canvas.height||1,l=s.canvas.width/r,c=s.canvas.height/a,f=Number.isFinite(l)&&Number.isFinite(c)?(l+c)/2:1;if((t==null?void 0:t.clear)!==!1&&(o.disable(o.SCISSOR_TEST),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),!e.length||(this.ensureProgram(o),this.ensureBuffer(o),!this.program||!this.buffer))return;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.buffer);const u=o.getAttribLocation(this.program,"a_pos"),d=o.getAttribLocation(this.program,"a_color"),h=o.getUniformLocation(this.program,"u_canvas");o.enableVertexAttribArray(u),o.enableVertexAttribArray(d),o.vertexAttribPointer(u,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(d,4,o.FLOAT,!1,24,8),o.uniform2f(h,s.canvas.width,s.canvas.height),o.enable(o.BLEND),o.disable(o.DEPTH_TEST),o.enable(o.SCISSOR_TEST);const m=(g,w)=>w?g.map(C=>({x:Math.round(C.x)+.5,y:Math.round(C.y)+.5})):g;for(const g of e){const w=g.bounds,C=Math.round(w.left*l),M=Math.round(s.canvas.height-(w.top+w.height)*c),P=Math.round(w.width*l),T=Math.round(w.height*c);o.scissor(C,M,P,T);for(const N of g.shapes){const L=Number.isFinite(N.opacity)?t2(N.opacity):1,O=N.blend||"normal";if(O==="add"?o.blendFunc(o.SRC_ALPHA,o.ONE):O==="screen"?o.blendFunc(o.ONE,o.ONE_MINUS_SRC_COLOR):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),N.kind==="polygon"){const ge=N.points.map(Ue=>({x:Ue.x*l,y:Ue.y*c})),ae=N.fillColor,Ie=N.fillGradient,ce=Ie?poe(ge,Ie,ae,L):null;if(ce&&ce.length===ge.length){const Ue=foe(ge,ce);Ue.length&&(o.bufferData(o.ARRAY_BUFFER,Ue,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Ue.length/6))}else if(ae){const Ue=h_(ae),et=[Ue[0],Ue[1],Ue[2],Ue[3]*L],ft=doe(ge,et);ft.length&&(o.bufferData(o.ARRAY_BUFFER,ft,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,ft.length/6))}const je=N.strokeColor,Ve=(N.strokeWidth??1)*f,We=Number.isFinite(N.glow)?N.glow:0,He=Number.isFinite(N.glowOpacity)?t2(N.glowOpacity):.35;if(We>0&&(je||ae)){const Ue=h_(N.glowColor||je||ae||"#e2e8f0"),et=[Ue[0],Ue[1],Ue[2],Ue[3]*L*He],ft=Math.max(1,Ve+We*f),it=m(ge.length?[...ge,ge[0]]:[],!0),Lt=R_(it,"solid"),Tt=H1(Lt,ft,et);Tt.length&&(o.bufferData(o.ARRAY_BUFFER,Tt,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Tt.length/6))}if(je&&Ve>0){const Ue=h_(je),et=[Ue[0],Ue[1],Ue[2],Ue[3]*L],ft=N.strokeStyle||"solid",it=ft==="dashed"||ft==="dotted"||Ve<=1,Lt=m(ge.length?[...ge,ge[0]]:[],it),Tt=R_(Lt,ft),Pt=H1(Tt,Ve,et);Pt.length&&(o.bufferData(o.ARRAY_BUFFER,Pt,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Pt.length/6))}continue}const D=N.style||"solid",$=Math.max(1,(N.width??1)*f),z=N.color||"#e2e8f0",te=h_(z),pe=[te[0],te[1],te[2],te[3]*L],J=Number.isFinite(N.glow)?N.glow:0,le=Number.isFinite(N.glowOpacity)?t2(N.glowOpacity):.35,de=ge=>{if(!ge.length||J<=0)return;const ae=h_(N.glowColor||z||"#e2e8f0"),Ie=[ae[0],ae[1],ae[2],ae[3]*L*le],ce=Math.max(1,$+J*f),je=H1(ge,ce,Ie);je.length&&(o.bufferData(o.ARRAY_BUFFER,je,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,je.length/6))};let he=[];if(N.kind==="path"&&N.commands){let ge=[];const ae=()=>{if(ge.length>=2){const Ie=R_(ge,D),ce=m(ge,!0);de(R_(ce,"solid"));const je=H1(Ie,$,pe);je.length&&(o.bufferData(o.ARRAY_BUFFER,je,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,je.length/6))}ge=[]};for(const Ie of N.commands)Ie.cmd==="M"?(ae(),ge.push({x:Ie.x*l,y:Ie.y*c})):Ie.cmd==="L"&&ge.push({x:Ie.x*l,y:Ie.y*c});ae();continue}if(N.points&&(he=N.points.map(ge=>({x:ge.x*l,y:ge.y*c}))),he.length>=2){const ge=R_(he,D),ae=m(he,!0);de(R_(ae,"solid"));const Ie=H1(ge,$,pe);Ie.length&&(o.bufferData(o.ARRAY_BUFFER,Ie,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Ie.length/6))}}}o.disable(o.SCISSOR_TEST)}destroy(){const e=this.runtime.gl;e&&this.program&&e.deleteProgram(this.program),e&&this.buffer&&e.deleteBuffer(this.buffer),this.program=null,this.buffer=null}}const z2=Fm({}),hoe=z2;function voe(n,e){const t={...e,_updatedAt:Date.now()};z2.update(s=>({...s,[n]:t}))}function J5(n){z2.update(e=>{const{[n]:t,...s}=e;return s})}function goe(){z2.set({})}function Cp(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function Q5(n,e="start"){if(n==null)return null;if(typeof n=="number"&&Number.isFinite(n))return n>1e11?Math.floor(n):Math.floor(n*1e3);const t=String(n).trim();if(!t)return null;if(/^\d+$/.test(t)){const r=Number(t);if(Number.isFinite(r))return r>1e11?Math.floor(r):Math.floor(r*1e3)}const s=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(s){const r=Number(s[1]),a=Number(s[2])-1,l=Number(s[3]);if([r,a,l].every(c=>Number.isFinite(c))){const c=Date.UTC(r,a,l);return Number.isFinite(c)?e==="end"?c+86399999:c:null}}const o=Date.parse(t);return Number.isFinite(o)?o:null}function _oe(n){if(!n)return null;const e=String(n).trim();if(!e)return null;const t=e.match(/^(\d{2})(?::?(\d{2}))?\s*-\s*(\d{2})(?::?(\d{2}))?$/);if(!t)return null;const s=Number(t[1]),o=Number(t[2]||"0"),r=Number(t[3]),a=Number(t[4]||"0");return![s,o,r,a].every(l=>Number.isFinite(l))||s<0||s>23||r<0||r>23||o<0||o>59||a<0||a>59?null:{startMin:s*60+o,endMin:r*60+a}}function yoe(n){if(n===!0)return{enabled:!0,execution:"intrabar_ohlc",intrabarTieBreak:"worst_case",ohlcPath:"open_high_low_close",intrabarTicks:6,initialCapital:1e4,fromTs:null,toTs:null,session:null,orderSize:{type:"percent_of_equity",value:100},commissionPct:0,commissionCash:null,commissionPerUnit:null,commissionType:"percent",slippagePct:0,slippageAbs:null,slippageTicks:null,slippageType:"percent",priceTick:null,qtyStep:null,minQty:null,spreadPct:null,leverage:1,maintenanceMarginPct:null,liquidationFeePct:null,borrowPctPerYear:null,fundingPctPerDay:null,positionMode:"netting",closeMethod:"fifo",pyramiding:1,timeInForce:"gtc",fillMode:"full",volumeFillPct:100,stopLossPct:null,takeProfitPct:null,takeProfits:[],trailingStopPct:null,maxDrawdownPct:null,maxDrawdownCash:null,maxPositionPct:null,maxPositionCash:null,maxPositionQty:null,maxIntradayFilledOrders:null,maxIntradayLossPct:null,maxIntradayLossCash:null,allowLong:!0,allowShort:!0,closeOnEnd:!0};if(!n||typeof n!="object")return null;const e=n;if(e.enabled===!1)return null;const t=String(e.execution||e.exec||e.mode||"").trim().toLowerCase()||"intrabar_ohlc",s=t==="bar_close"||t==="barclose"||t==="close"?"bar_close":t==="intrabar_ticks"||t==="intrabarticks"||t==="ticks"?"intrabar_ticks":"intrabar_ohlc",o=String(e.intrabarTieBreak||e.tieBreak||"").trim().toLowerCase(),r=o==="best_case"||o==="best"||o==="tp"?"best_case":o==="ohlc"||o==="path"?"ohlc":"worst_case",a=String(e.ohlcPath||e.path||"").trim().toLowerCase(),l=a==="open_low_high_close"||a==="olhc"?"open_low_high_close":"open_high_low_close",c=e.intrabarTicks??e.ticks??e.tickCount??e.intrabarTickCount??null,f=Math.max(2,Math.min(100,Math.floor(Cp(c,6)))),u=Math.max(0,Cp(e.initialCapital,1e4)),d=Math.max(0,Cp(e.commissionPct,0)),h=e.commissionCash??e.commission_cash??e.commissionFixed??e.commission_fixed??null,m=e.commissionPerUnit??e.commission_per_unit??e.commissionPerShare??e.commission_per_share??null,g=h==null?null:Math.max(0,Cp(h,0)),w=m==null?null:Math.max(0,Cp(m,0)),C=String(e.commissionType??e.commission_mode??e.commissionMode??"").trim().toLowerCase(),M=w!=null||C==="per_unit"?"per_unit":g!=null||C==="cash"?"cash":"percent",P=Math.max(0,Cp(e.slippagePct??e.slippage??e.slippage_percent,0)),T=e.slippageAbs??e.slippage_abs??null,N=e.slippageTicks??e.slippage_ticks??e.slippageTick??null,L=T==null?null:Math.max(0,Cp(T,0)),O=N==null?null:Math.max(0,Cp(N,0)),D=String(e.slippageType??e.slippage_mode??e.slippageMode??"").trim().toLowerCase(),$=O!=null||D==="ticks"?"ticks":L!=null||D==="abs"?"abs":"percent",z=e.priceTick??e.price_tick??e.tickSize??e.tick_size??e.tick??e.minTick??e.min_tick??null,te=e.qtyStep??e.qty_step??e.quantityStep??e.quantity_step??e.lotStep??e.lot_step??null,pe=e.minQty??e.min_qty??e.minimumQty??e.minimum_qty??null,J=z==null?null:Math.max(0,Cp(z,0)),le=te==null?null:Math.max(0,Cp(te,0)),de=pe==null?null:Math.max(0,Cp(pe,0)),he=e.spreadPct??e.spread_pct??e.spread??e.spreadBps??e.spread_bps??null,ge=(()=>{if(he==null)return null;const nr=Cp(he,0);return!Number.isFinite(nr)||nr<=0?null:"spreadBps"in e||"spread_bps"in e?nr/100:nr})(),ae=e.leverage??e.lev??e.marginLeverage??e.margin_leverage??1,Ie=Math.max(1,Cp(ae,1)),ce=e.maintenanceMarginPct??e.maintenance_margin_pct??e.maintMarginPct??null,je=e.liquidationFeePct??e.liquidation_fee_pct??e.liqFeePct??null,Ve=e.borrowPctPerYear??e.borrow_pct_per_year??e.shortBorrowPctPerYear??null,We=e.fundingPctPerDay??e.funding_pct_per_day??e.funding??null,He=ce==null?null:Math.max(0,Cp(ce,0)),Ue=je==null?null:Math.max(0,Cp(je,0)),et=Ve==null?null:Math.max(0,Cp(Ve,0)),ft=We==null?null:Math.max(0,Cp(We,0)),it=String(e.positionMode??e.position_mode??"").trim().toLowerCase(),Lt=it==="hedge"||it==="hedging"?"hedging":"netting",Tt=String(e.closeMethod??e.close_method??e.costBasis??e.cost_basis??"").trim().toLowerCase(),Pt=Tt==="lifo"?"lifo":Tt==="avg"||Tt==="average"?"avg":"fifo",St=Math.max(1,Math.min(50,Math.floor(Cp(e.pyramiding??e.maxEntries??e.max_positions??e.maxPositions??1,1)))),st=String(e.timeInForce??e.tif??e.orderTif??e.order_tif??"").trim().toLowerCase(),xt=st==="ioc"||st==="immediate_or_cancel"?"ioc":st==="fok"||st==="fill_or_kill"?"fok":"gtc",Je=String(e.fillMode??e.fill_mode??"").trim().toLowerCase(),Xe=Je==="volume"||Je==="partial"||e.partialFills?"volume":"full",Be=Math.max(0,Math.min(100,Cp(e.volumeFillPct??e.volume_fill_pct??e.fillPct??100,100))),Qe=e.stopLossPct??e.slPct??e.sl??e.stopLoss??e.stop_loss??null,ct=e.takeProfitPct??e.tpPct??e.tp??e.takeProfit??e.take_profit??null,Mt=e.trailingStopPct??e.trailPct??e.trailing??e.trailingStop??null,mt=Qe==null?null:Math.max(0,Cp(Qe,0)),Ce=ct==null?null:Math.max(0,Cp(ct,0)),Te=Mt==null?null:Math.max(0,Cp(Mt,0)),It=typeof e.allowLong=="boolean"?e.allowLong:e.allowLong!==!1,$t=typeof e.allowShort=="boolean"?e.allowShort:e.allowShort!==!1,Yt=typeof e.closeOnEnd=="boolean"?e.closeOnEnd:e.closeOnEnd!==!1,qn=Q5(e.from??e.start??e.startDate??e.dateFrom??e.fromDate??e.rangeStart,"start")??null,Vn=Q5(e.to??e.end??e.endDate??e.dateTo??e.toDate??e.rangeEnd,"end")??null,Dn=_oe(e.session??e.tradingSession??e.sessionTime),Wn=e.takeProfits??e.tpLevels??e.takeProfitLevels??[],pn=[];if(Array.isArray(Wn))for(const nr of Wn){if(!nr||typeof nr!="object")continue;const hi=Cp(nr.takeProfitPct??nr.tpPct??nr.pct,NaN),Gc=Cp(nr.qtyPct??nr.qty??nr.percent,NaN);!Number.isFinite(hi)||hi<=0||!Number.isFinite(Gc)||Gc<=0||pn.push({takeProfitPct:hi,qtyPct:Math.max(0,Math.min(100,Gc))})}pn.sort((nr,hi)=>nr.takeProfitPct-hi.takeProfitPct);const gn=e.risk&&typeof e.risk=="object"?e.risk:{},Qs=nr=>{if(nr==null)return null;const hi=Cp(nr,NaN);return Number.isFinite(hi)?hi:null},Is=Qs(e.maxDrawdownPct??e.max_drawdown_pct??gn.maxDrawdownPct??gn.max_drawdown_pct??gn.max_drawdown)??null,Cs=Qs(e.maxDrawdownCash??e.max_drawdown_cash??gn.maxDrawdownCash??gn.max_drawdown_cash)??null,ro=Qs(e.maxPositionPct??e.max_position_pct??gn.maxPositionPct??gn.max_position_pct??gn.max_position_size)??null,bs=Qs(e.maxPositionCash??e.max_position_cash??gn.maxPositionCash??gn.max_position_cash)??null,zt=Qs(e.maxPositionQty??e.max_position_qty??gn.maxPositionQty??gn.max_position_qty??gn.max_contracts)??null,Qt=Qs(e.maxIntradayFilledOrders??e.max_intraday_filled_orders??gn.maxIntradayFilledOrders??gn.max_intraday_filled_orders)??null,ho=Qs(e.maxIntradayLossPct??e.max_intraday_loss_pct??gn.maxIntradayLossPct??gn.max_intraday_loss_pct??gn.max_intraday_loss)??null,ri=Qs(e.maxIntradayLossCash??e.max_intraday_loss_cash??gn.maxIntradayLossCash??gn.max_intraday_loss_cash)??null;let jo=0;const Na=[];for(const nr of pn){if(jo>=100)break;const hi=100-jo,Gc=Math.min(hi,nr.qtyPct);Gc<=0||(Na.push({takeProfitPct:nr.takeProfitPct,qtyPct:Gc}),jo+=Gc)}const ar=e.orderSize??e.positionSize??e.order??null;let Aa={type:"percent_of_equity",value:100};if(ar&&typeof ar=="object"){const nr=String(ar.type||"").trim().toLowerCase(),hi=Cp(ar.value,100);nr==="cash"?Aa={type:"cash",value:Math.max(0,hi)}:nr==="qty"?Aa={type:"qty",value:Math.max(0,hi)}:nr?Aa={type:"percent_of_equity",value:Math.max(0,Math.min(100,hi))}:Aa={type:"percent_of_equity",value:Math.max(0,Math.min(100,hi))}}else if(ar!=null){const nr=Cp(ar,100);Aa={type:"percent_of_equity",value:Math.max(0,Math.min(100,nr))}}return{enabled:!0,execution:s,intrabarTieBreak:r,ohlcPath:l,intrabarTicks:f,initialCapital:u,fromTs:qn,toTs:Vn,session:Dn,orderSize:Aa,commissionPct:d,commissionCash:g,commissionPerUnit:w,commissionType:M,slippagePct:P,slippageAbs:L,slippageTicks:O,slippageType:$,priceTick:J&&J>0?J:null,qtyStep:le&&le>0?le:null,minQty:de&&de>0?de:null,spreadPct:ge&&ge>0?ge:null,leverage:Ie,maintenanceMarginPct:He&&He>0?He:null,liquidationFeePct:Ue&&Ue>0?Ue:null,borrowPctPerYear:et&&et>0?et:null,fundingPctPerDay:ft&&ft>0?ft:null,positionMode:Lt,closeMethod:Pt,pyramiding:St,timeInForce:xt,fillMode:Xe,volumeFillPct:Be,stopLossPct:mt!=null&&mt>0?mt:null,takeProfitPct:Ce!=null&&Ce>0?Ce:null,takeProfits:Na,trailingStopPct:Te!=null&&Te>0?Te:null,maxDrawdownPct:Is!=null&&Is>0?Is:null,maxDrawdownCash:Cs!=null&&Cs>0?Cs:null,maxPositionPct:ro!=null&&ro>0?ro:null,maxPositionCash:bs!=null&&bs>0?bs:null,maxPositionQty:zt!=null&&zt>0?zt:null,maxIntradayFilledOrders:Qt!=null&&Qt>0?Math.floor(Qt):null,maxIntradayLossPct:ho!=null&&ho>0?ho:null,maxIntradayLossCash:ri!=null&&ri>0?ri:null,allowLong:It,allowShort:$t,closeOnEnd:Yt}}function e3(n){return n==="cancel"||n==="cancel_all"?0:n==="exit_long"?1:n==="exit_short"?2:n==="entry_long"?3:n==="entry_short"?4:9}function n2(n){const e=n==null?void 0:n.close;return typeof e=="number"&&Number.isFinite(e)?e:null}function jx(n){return typeof n=="number"&&Number.isFinite(n)?n:null}function boe(n){const e=n2(n);if(e==null)return null;const t=jx(n==null?void 0:n.open)??e,s=jx(n==null?void 0:n.high)??Math.max(t,e),o=jx(n==null?void 0:n.low)??Math.min(t,e);return{o:t,h:s,l:o,c:e}}function xoe(n,e,t){var Ee,ht,pt,Nt,E;const s=t.initialCapital,o=t.commissionPct/100,r=t.commissionCash,a=t.commissionPerUnit,l=t.commissionType,c=t.slippagePct/100,f=t.slippageAbs,u=t.slippageTicks,d=t.slippageType,h=t.priceTick&&t.priceTick>0?t.priceTick:null,m=t.qtyStep&&t.qtyStep>0?t.qtyStep:null,g=t.minQty&&t.minQty>0?t.minQty:null,w=t.spreadPct&&t.spreadPct>0?t.spreadPct/100:0,C=w>0?w/2:0,M=Math.max(1,Number(t.leverage)||1),P=t.maintenanceMarginPct&&t.maintenanceMarginPct>0?t.maintenanceMarginPct/100:null,T=t.liquidationFeePct&&t.liquidationFeePct>0?t.liquidationFeePct/100:null,N=t.borrowPctPerYear&&t.borrowPctPerYear>0?t.borrowPctPerYear/100:null,L=t.fundingPctPerDay&&t.fundingPctPerDay>0?t.fundingPctPerDay/100:null,O=t.maxDrawdownPct&&t.maxDrawdownPct>0?t.maxDrawdownPct/100:null,D=t.maxDrawdownCash&&t.maxDrawdownCash>0?t.maxDrawdownCash:null,$=t.maxPositionPct&&t.maxPositionPct>0?t.maxPositionPct/100:null,z=t.maxPositionCash&&t.maxPositionCash>0?t.maxPositionCash:null,te=t.maxPositionQty&&t.maxPositionQty>0?t.maxPositionQty:null,pe=t.maxIntradayFilledOrders&&t.maxIntradayFilledOrders>0?Math.floor(t.maxIntradayFilledOrders):null,J=t.maxIntradayLossPct&&t.maxIntradayLossPct>0?t.maxIntradayLossPct/100:null,le=t.maxIntradayLossCash&&t.maxIntradayLossCash>0?t.maxIntradayLossCash:null,de=(I,W,Z)=>{const _e=(Z==null?void 0:Z.commissionMode)??l,me=(Z==null?void 0:Z.commissionValue)??(_e==="per_unit"?a:_e==="cash"?r:o);return Number.isFinite(me)?_e==="cash"?Math.max(0,me):_e==="per_unit"?Math.max(0,me*Math.max(0,I)):Math.max(0,W*Math.max(0,me)):0},he=(I,W)=>{const Z=(W==null?void 0:W.slippageMode)??d,_e=(W==null?void 0:W.slippageValue)??(Z==="ticks"?u:Z==="abs"?f:c);return Number.isFinite(_e)?Z==="ticks"?h?Math.max(0,_e*h):0:Z==="abs"?Math.max(0,_e):Math.max(0,I*Math.max(0,_e)):0},ge=I=>{if(!Number.isFinite(I)||I<=0)return 0;const W=String(I),Z=W.match(/e-(\d+)$/i);if(Z)return Math.max(0,Math.min(12,Number(Z[1])||0));const _e=W.indexOf(".");return _e>=0?Math.max(0,Math.min(12,W.length-_e-1)):0},ae=(I,W,Z)=>{if(!Number.isFinite(I))return NaN;if(!Number.isFinite(W)||W<=0)return I;const _e=ge(W),me=Math.pow(10,_e),Le=Math.round(W*me);if(!Number.isFinite(Le)||Le<=0)return I;const ye=I*me;return(Z==="ceil"?Math.ceil(ye/Le-1e-12):Z==="round"?Math.round(ye/Le):Math.floor(ye/Le+1e-12))*Le/me},Ie=(I,W)=>m?ae(I,m,W):I,ce=(I,W)=>I==="entry"?W==="long":W==="short",je=(I,W)=>C?ce(I,W)?1+C:1-C:1,Ve=(I,W,Z)=>{const _e=je(W,Z);return _e===1?I:{o:I.o*_e,h:I.h*_e,l:I.l*_e,c:I.c*_e}},We=(I,W,Z,_e)=>{if(!h)return _e;const me=ce(I,W);return ae(_e,h,Z==="limit"?me?"floor":"ceil":me?"ceil":"floor")},He=(I,W,Z)=>{if(!h)return Z;const me=ce(I,W)?"ceil":"floor";return ae(Z,h,me)};let Ue=0,et=0;const ft={long:[],short:[]},it=I=>ft[I],Lt=I=>it(I).some(W=>W.qty>1e-12),Tt=()=>Lt("long")||Lt("short"),Pt=I=>it(I).filter(W=>W.qty>1e-12).length,St=I=>I==="long"?"short":"long",st=[],xt=[],Je=[],Xe=new Map;let Be=1;const Qe=[],ct=()=>`o${Be++}`,Mt=I=>{var Z;const W=Number((Z=n[I])==null?void 0:Z.timestamp);return Number.isFinite(W)&&W>0?W:Date.now()},mt=I=>{const W=ct(),Z={id:W,...I};return Je.push(Z),Xe.set(W,Z),Z},Ce=(I,W)=>{if(!I)return;const Z=Xe.get(I);Z&&Object.assign(Z,W)},Te=I=>{const W=I.id?Xe.get(I.id):null;if(!W)return;const Z=Number.isFinite(W.fillQty)?W.fillQty:0,_e=Number.isFinite(W.fillPrice)?W.fillPrice:0,me=Number.isFinite(I.qty)?I.qty:0,Le=Z+me,ye=Le>0?(_e*Z+I.price*me)/Le:I.price,Se=(Number.isFinite(W.fees)?W.fees:0)+(Number.isFinite(I.fees)?I.fees:0);W.fillQty=Le,W.fillPrice=ye,W.fees=Se,W.filledIndex=I.index,W.filledTimestamp=I.timestamp,I.targetQty!=null&&(W.targetQty=I.targetQty),I.remainingQty!=null&&(W.remainingQty=I.remainingQty),I.status&&(W.status=I.status),I.note&&(W.note=I.note)},It=n.length,$t={initialCapital:s,finalEquity:s,netPnl:0,netPnlPct:0,grossProfit:0,grossLoss:0,profitFactor:0,trades:0,roundTrips:0,wins:0,losses:0,winRate:0,maxDrawdownPct:0,maxDrawdownValue:0,feesPaid:0,avgTrade:0,avgWin:0,avgLoss:0,payoffRatio:0,expectancy:0,maxConsecWins:0,maxConsecLosses:0,exposurePct:0,maxRunupPct:0,maxRunupValue:0,avgBarsInTrade:0,volatilityPct:0,sharpe:0,sortino:0,calmar:0};if(!It)return{summary:$t,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]};const Yt=new Array(It).fill(0),qn=new Array(It).fill(0),Vn=new Array(It).fill(0),Dn=new Array(It).fill(0),Wn=new Array(It).fill(0),pn=new Array(It).fill(0),gn=new Array(It).fill(0),Qs=new Array(It).fill(0),Is=new Array(It).fill(0),Cs=new Array(It).fill(0),ro=new Array(It).fill(0),bs=new Array(It).fill(0),zt=new Array(It).fill(0),Qt=new Array(It).fill(0),ho=new Array(It).fill(0),ri=new Array(It).fill(0),jo=new Array(It).fill(0),Na=new Array(It).fill(0),ar=new Array(It).fill(0),Aa=new Array(It).fill(s),nr=new Array(It).fill(0),hi=Array.from({length:It},()=>[]);let Gc=0,Pu=0,wc=0,cc=0,ou=0,zu=0,ja=0,nc="",Bc=s,Vu=!1;const rf=t.fromTs!=null&&Number.isFinite(t.fromTs)?t.fromTs:null,co=t.toTs!=null&&Number.isFinite(t.toTs)?t.toTs:null;let ll=0,va=It-1;if(rf!=null){const I=n.findIndex(W=>Number(W==null?void 0:W.timestamp)>=rf);if(I>=0)ll=I;else return{summary:$t,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}if(co!=null){for(let I=It-1;I>=0;I--){const W=Number((Ee=n[I])==null?void 0:Ee.timestamp);if(Number.isFinite(W)&&W<=co){va=I;break}}if(va<ll)return{summary:$t,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}const Vl=t.session,kr=I=>{var ye;if(!Vl)return!0;const W=Number((ye=n[I])==null?void 0:ye.timestamp);if(!Number.isFinite(W)||W<=0)return!0;const Z=new Date(W),_e=Z.getUTCHours()*60+Z.getUTCMinutes(),{startMin:me,endMin:Le}=Vl;return me<=Le?_e>=me&&_e<=Le:_e>=me||_e<=Le},Wr=(Array.isArray(e)?e:[]).filter(I=>typeof(I==null?void 0:I.index)=="number"&&I.index>=0).filter(I=>I.index>=ll&&I.index<=va).filter(I=>kr(I.index)).slice().sort((I,W)=>I.index-W.index||e3(I.type)-e3(W.type));let jl=0,Xl=s,Mu=0,Zu=0,xo=s,Sr=0,ql=0,$f=1;const Cf={long:null,short:null},tp=(I,W)=>{const Z=Cf[I];if(Z)return Z;const _e={id:`t${$f++}`,side:I,entryIndex:W,entryTimestamp:Mt(W),exitIndex:W,exitTimestamp:Mt(W),qtyEntered:0,entryNotional:0,qtyExited:0,exitNotional:0,grossPnl:0,fees:0,entries:0,exits:0};return Cf[I]=_e,_e},mf=(I,W)=>{if(Lt(I))return;const Z=Cf[I];if(!Z)return;const _e=Z.qtyEntered,me=_e>0?Z.entryNotional/_e:0,Le=Z.qtyExited>0?Z.exitNotional/Z.qtyExited:0,ye=Z.entryNotional>0?Z.grossPnl/Z.entryNotional*100:0;xt.push({id:Z.id,side:Z.side,entryIndex:Z.entryIndex,entryTimestamp:Z.entryTimestamp,exitIndex:Z.exitIndex,exitTimestamp:Z.exitTimestamp,qty:_e,avgEntryPrice:me,avgExitPrice:Le,grossPnl:Z.grossPnl,fees:Z.fees,netPnl:Z.grossPnl-Z.fees,pnlPct:ye,entries:Z.entries,exits:Z.exits,maePct:typeof Z.maeMin=="number"&&Number.isFinite(Z.maeMin)?Z.maeMin:void 0,mfePct:typeof Z.mfeMax=="number"&&Number.isFinite(Z.mfeMax)?Z.mfeMax:void 0}),Cf[I]=null},sc=(I,W)=>{let Z=0;for(const _e of it("long"))_e.qty<=0||(Z+=(W-_e.entryPrice)*_e.qty);for(const _e of it("short"))_e.qty<=0||(Z+=(_e.entryPrice-W)*_e.qty);return s+Ue+Z-et},yd=I=>{let W=0;for(const Z of it("long"))Z.qty<=0||(W+=(I-Z.entryPrice)*Z.qty);for(const Z of it("short"))Z.qty<=0||(W+=(Z.entryPrice-I)*Z.qty);return Number.isFinite(W)?W:0},If=()=>{let I=0,W=0,Z=0,_e=0;for(const Le of it("long"))Le.qty<=0||(I+=Le.qty,W+=Le.entryPrice*Le.qty);for(const Le of it("short"))Le.qty<=0||(Z+=Le.qty,_e+=Le.entryPrice*Le.qty);const me=I-Z;return me>0&&I>0?W/I:me<0&&Z>0?_e/Z:NaN},En=(I,W)=>{if(t.orderSize.type==="cash")return Math.max(0,t.orderSize.value)*M;if(t.orderSize.type==="qty")return Math.max(0,t.orderSize.value*W);const Z=Math.max(0,Math.min(100,t.orderSize.value));return I*Z/100*M},ms=()=>{let I=0;for(const W of it("long"))I+=W.qty>0?W.entryNotional:0;for(const W of it("short"))I+=W.qty>0?W.entryNotional:0;return I},js=()=>M>0?ms()/M:0,Nn=I=>{const W=Number(I);if(!Number.isFinite(W)||W<=0)return{long:0,short:0,total:0};let Z=0,_e=0;for(const me of it("long"))Z+=me.qty>0?me.qty*W:0;for(const me of it("short"))_e+=me.qty>0?me.qty*W:0;return{long:Z,short:_e,total:Z+_e}},Io=(I,W,Z)=>{var Xn,hn;if(!Tt()||!N&&!L||I<=Z)return;const _e=Number((Xn=n[I-1])==null?void 0:Xn.timestamp),me=Number((hn=n[I])==null?void 0:hn.timestamp);if(!Number.isFinite(_e)||!Number.isFinite(me)||me<=_e)return;const Le=me-_e,ye=Le/864e5,Se=Le/(365*864e5);if(!Number.isFinite(ye)||ye<=0)return;const Ge=Nn(W);let Ae=0,Rt=0;L&&(Ae=Math.max(0,Ge.total*L*ye)),N&&(Rt=Math.max(0,Ge.short*N*Se));const nn=Ae+Rt;if(!(!Number.isFinite(nn)||nn<=0)){if(et+=nn,Ae>0&&Ge.total>0){const is=Ae*Ge.long/Ge.total,Gs=Ae-is;Cf.long&&(Cf.long.fees+=is),Cf.short&&(Cf.short.fees+=Gs)}Rt>0&&Cf.short&&(Cf.short.fees+=Rt)}},fo=(I,W,Z)=>{if(!Tt())return!1;const _e=Mt(I);let me=!1;for(const Le of["long","short"]){if(!Lt(Le))continue;const ye=mt({action:"exit",side:Le,kind:"market",originalKind:"market",status:"pending",createdIndex:I,createdTimestamp:_e,activeFromIndex:I,qtyPct:100,price:W,note:Z}),Se=mi(Le,I,W,"liquidation","market",{orderId:ye.id},T??void 0);Se?(Ce(ye.id,{status:"filled",filledIndex:I,filledTimestamp:_e,fillPrice:Se.execPrice,fillQty:Se.qtyClosed,fees:Se.exitFees}),me=!0):Ce(ye.id,{status:"rejected",note:`${Z} (no fill)`})}if(me&&vi.length){for(const Le of vi)Ce(Le.orderId,{status:"canceled",note:"Canceled on liquidation"});vi.length=0}return me},Ji=(I,W)=>{if(!P||!Tt())return!1;const Z=Ge=>{const Ae=sc(I,Ge),nn=Nn(Ge).total*P;return{px:Ge,equityNow:Ae,req:nn,gap:Ae-nn}},_e=Z(W.l),me=Z(W.h),Le=Number.isFinite(_e.gap)&&_e.gap<=1e-9,ye=Number.isFinite(me.gap)&&me.gap<=1e-9;if(!Le&&!ye)return!1;const Se=Le&&ye?_e.gap<=me.gap?_e:me:Le?_e:me;return fo(I,Se.px,"AUTO liquidation")},Gi=(I,W,Z,_e)=>{const me=he(Z,_e);return!Number.isFinite(me)||me<=0?Z:ce(I,W)?Z+me:Z-me},Al=(I,W,Z,_e)=>{if(Z==="limit")return He("entry",I,W);const me=W*je("entry",I),Le=Gi("entry",I,me,_e);return He("entry",I,Le)},Ii=(I,W,Z,_e)=>{if(Z==="limit")return He("exit",I,W);const me=W*je("exit",I),Le=Gi("exit",I,me,_e);return He("exit",I,Le)},Wo=I=>{if(!I||typeof I!="object")return;const W=Ae=>{const Rt=typeof Ae=="number"?Ae:Number(Ae);return Number.isFinite(Rt)?Rt:void 0},Z=W(I.stopLossPct),_e=W(I.takeProfitPct),me=W(I.trailingStopPct),Le=I.takeProfits,ye=[];if(Array.isArray(Le))for(const Ae of Le){if(!Ae||typeof Ae!="object")continue;const Rt=W(Ae.takeProfitPct),nn=W(Ae.qtyPct);Rt==null||Rt<=0||nn==null||nn<=0||ye.push({takeProfitPct:Math.max(0,Rt),qtyPct:Math.max(0,Math.min(100,nn))})}ye.sort((Ae,Rt)=>Ae.takeProfitPct-Rt.takeProfitPct);let Se=0;const Ge=[];for(const Ae of ye){if(Se>=100)break;const Rt=100-Se,nn=Math.min(Rt,Ae.qtyPct);nn<=0||(Ge.push({takeProfitPct:Ae.takeProfitPct,qtyPct:nn}),Se+=nn)}if(!(Z==null&&_e==null&&me==null&&Ge.length===0))return{stopLossPct:Z,takeProfitPct:_e,trailingStopPct:me,takeProfits:Ge.length?Ge:void 0}},To=(I,W,Z,_e,me)=>{if(!Number.isFinite(Z)||Z<=0)return{ok:!1,reject:"Invalid fill price"};const Le=sc(W,Z),ye=me&&typeof me.qty=="number"&&Number.isFinite(me.qty)?Math.abs(me.qty):null,Se=me&&typeof me.cash=="number"&&Number.isFinite(me.cash)?Math.abs(me.cash):null;let Ge=0;if(ye!=null)Ge=ye;else if(Se!=null)Ge=Se*M/Z;else{const hn=Number.isFinite(_e)?Math.max(0,Math.min(100,_e)):100;if(hn<=0)return{ok:!1,reject:"qtyPct <= 0"};const is=En(Le,Z)*hn/100;if(!Number.isFinite(is)||is<=0)return{ok:!1,reject:"Notional <= 0"};Ge=is/Z}if(!Number.isFinite(Ge)||Ge<=0)return{ok:!1,reject:"Qty <= 0"};const Ae=Ie(Ge,"floor");if(!Number.isFinite(Ae)||Ae<=0)return m?{ok:!1,reject:`Qty rounded to 0 (qtyStep=${m})`}:{ok:!1,reject:"Qty <= 0"};if(g!=null&&Ae<g)return{ok:!1,reject:`Qty ${Ae} < minQty ${g}`};if(te!=null&&Er(I)+Ae>te)return{ok:!1,reject:"Max position qty exceeded"};if(z!=null&&Nn(Z)[I]+Ae*Z>z)return{ok:!1,reject:"Max position cash exceeded"};if($!=null&&$>0){const is=Nn(Z)[I]+Ae*Z,Gs=Le*$;if(Gs>0&&is>Gs)return{ok:!1,reject:"Max position percent exceeded"}}const Rt=Z*Ae,nn=M>0?Rt/M:Rt,Xn=js();return nn>0&&Xn+nn>Le+1e-9?{ok:!1,reject:"Insufficient margin"}:{ok:!0,qty:Ae,equityNow:Le}},Ba=(I,W,Z,_e=100,me="market",Le,ye,Se)=>{var Uu,xd,ul;if(t.positionMode==="netting"&&Lt(St(I)))return{ok:!1,reject:"Netting mode: opposite position open"};if(Vu)return{ok:!1,reject:"Risk limit reached"};if(pe!=null&&ja>=pe)return{ok:!1,reject:"Max intraday filled orders reached"};if(Pt(I)>=t.pyramiding)return{ok:!1,reject:`Pyramiding limit reached (${t.pyramiding})`};const Ge=Al(I,Z,me,Se),Ae=To(I,W,Ge,_e,Se);if(!Ae.ok)return{ok:!1,reject:Ae.reject};const Rt=Ae.qty,nn=Ge*Rt,Xn=de(Rt,nn,Se);et+=Xn;{const dr=tp(I,W);dr.qtyEntered+=Rt,dr.entryNotional+=nn,dr.fees+=Xn,dr.entries+=1}const hn=t.closeMethod==="avg"?void 0:Wo(Le),is=(hn==null?void 0:hn.stopLossPct)!=null?hn.stopLossPct:t.stopLossPct,Gs=(hn==null?void 0:hn.takeProfitPct)!=null?hn.takeProfitPct:t.takeProfitPct,es=(hn==null?void 0:hn.trailingStopPct)!=null?hn.trailingStopPct:t.trailingStopPct,Mi=is&&is>0?I==="long"?Ge*(1-is/100):Ge*(1+is/100):null,Kn=Gs&&Gs>0?I==="long"?Ge*(1+Gs/100):Ge*(1-Gs/100):null,Es=Mi!=null&&Number.isFinite(Mi)?We("exit",I,"stop",Mi):null,Qo=Kn!=null&&Number.isFinite(Kn)?We("exit",I,"limit",Kn):null,sr={side:I,qty:Rt,entryIndex:W,entryTimestamp:((Uu=n[W])==null?void 0:Uu.timestamp)??Date.now(),entryPrice:Ge,entrySignalId:ye==null?void 0:ye.signalId,entryOrderId:ye==null?void 0:ye.orderId,entrySignalScore:(ye==null?void 0:ye.score)??null,entryNotional:nn,entryFee:Xn,entryFeeRemaining:Xn,stopPrice:Es&&Number.isFinite(Es)?Es:null,takePrice:Qo&&Number.isFinite(Qo)?Qo:null,trailingPct:es,trailingStop:es&&es>0?I==="long"?We("exit",I,"stop",Ge*(1-es/100)):We("exit",I,"stop",Ge*(1+es/100)):null,takeProfitOrders:[],maxFav:Ge,maxAdv:Ge},na=(xd=hn==null?void 0:hn.takeProfits)!=null&&xd.length?hn.takeProfits:t.takeProfits;if(na!=null&&na.length){const dr=[];let Fu=0;for(const gi of na){if(Fu>=Rt)break;const Dr=Math.max(0,Math.min(Rt-Fu,Rt*gi.qtyPct/100)),Yi=Ie(Dr,"floor");if(!Number.isFinite(Yi)||Yi<=0||g!=null&&Yi<g&&Yi<Rt-Fu-1e-12)continue;const Ki=I==="long"?Ge*(1+gi.takeProfitPct/100):Ge*(1-gi.takeProfitPct/100),Xi=We("exit",I,"limit",Ki);!Number.isFinite(Xi)||Xi<=0||(dr.push({price:Xi,qty:Yi,pct:gi.takeProfitPct}),Fu+=Yi)}sr.takeProfitOrders=dr.sort((gi,Dr)=>I==="long"?gi.price-Dr.price:Dr.price-gi.price)}ja+=1;const Xr=it(I);if(t.closeMethod==="avg"&&Xr.length){const dr=Xr[0],Fu=dr.qty+sr.qty,gi=dr.entryNotional+sr.entryNotional,Dr=Fu>0?gi/Fu:dr.entryPrice;dr.qty=Fu,dr.entryNotional=gi,dr.entryPrice=Dr,dr.entryFee+=sr.entryFee,dr.entryFeeRemaining+=sr.entryFeeRemaining;const Yi=t.stopLossPct,Ki=t.takeProfitPct,Xi=t.trailingStopPct,ca=Yi&&Yi>0?I==="long"?Dr*(1-Yi/100):Dr*(1+Yi/100):null,Jt=Ki&&Ki>0?I==="long"?Dr*(1+Ki/100):Dr*(1-Ki/100):null;if(dr.stopPrice=ca!=null&&Number.isFinite(ca)?We("exit",I,"stop",ca):null,dr.takePrice=Jt!=null&&Number.isFinite(Jt)?We("exit",I,"limit",Jt):null,dr.trailingPct=Xi,dr.trailingStop=Xi&&Xi>0?I==="long"?We("exit",I,"stop",Dr*(1-Xi/100)):We("exit",I,"stop",Dr*(1+Xi/100)):null,dr.takeProfitOrders=[],(ul=t.takeProfits)!=null&&ul.length){const rn=[];let dn=0;for(const uo of t.takeProfits){if(dn>=dr.qty)break;const zs=Math.max(0,Math.min(dr.qty-dn,dr.qty*uo.qtyPct/100)),Hr=Ie(zs,"floor");if(!Number.isFinite(Hr)||Hr<=0)continue;const Ul=I==="long"?Dr*(1+uo.takeProfitPct/100):Dr*(1-uo.takeProfitPct/100),Oi=We("exit",I,"limit",Ul);!Number.isFinite(Oi)||Oi<=0||(rn.push({price:Oi,qty:Hr,pct:uo.takeProfitPct}),dn+=Hr)}dr.takeProfitOrders=rn.sort((uo,zs)=>I==="long"?uo.price-zs.price:zs.price-uo.price)}return dr.maxFav=dr.maxFav==null?Dr:dr.maxFav,dr.maxAdv=dr.maxAdv==null?Dr:dr.maxAdv,{ok:!0,lot:dr}}return Xr.push(sr),{ok:!0,lot:sr}},Pi=(I,W,Z,_e,me)=>{const Le=Er(I);if(!Number.isFinite(Le)||Le<=0)return 0;if(_e!=null&&Number.isFinite(_e)){const Se=Math.abs(_e);return Se>0?Math.min(Le,Se):0}if(me!=null&&Number.isFinite(me)){const Se=Math.abs(me);if(Se<=0||!Number.isFinite(W)||W<=0)return 0;const Ae=(M>0?Se*M:Se)/W;return Number.isFinite(Ae)&&Ae>0?Math.min(Le,Ae):0}const ye=Number.isFinite(Z)?Math.max(0,Math.min(100,Z)):100;return ye<=0?0:Le*ye/100},qs=(I,W,Z,_e="signal",me,Le="market",ye,Se,Ge)=>{var na;const Ae=I.side;m&&(I.qty=Ie(I.qty,"round"));const Rt=Ii(Ae,Z,Le,Ge);if(!Number.isFinite(Rt)||Rt<=0)return null;const nn=I.qty,Xn=me==null?nn:Math.max(0,Math.min(nn,me)),hn=me==null?m?Ie(Xn,"round"):Xn:m?Ie(Xn,"floor"):Xn;if(!Number.isFinite(hn)||hn<=0||g!=null&&me!=null&&hn<g&&hn<nn-1e-12)return null;const is=nn>0&&Number.isFinite(I.entryFeeRemaining)?I.entryFeeRemaining*hn/nn:0,Gs=Rt*hn,es=de(hn,Gs,Ge),Mi=Se&&Se>0?Gs*Se:0;et+=es,et+=Mi;const Kn=Ae==="long"?(Rt-I.entryPrice)*hn:(I.entryPrice-Rt)*hn;Ue+=Kn;{const Xr=tp(Ae,I.entryIndex);Xr.qtyExited+=hn,Xr.exitNotional+=Gs,Xr.grossPnl+=Kn,Xr.fees+=is+es+Mi,Xr.exits+=1,Xr.exitIndex=W,Xr.exitTimestamp=Mt(W)}const Es=Number.isFinite(I.entryPrice)&&I.entryPrice>0?I.entryPrice*hn:NaN,Qo=(()=>{if(!(I.entryPrice<=0)&&!(I.maxAdv==null||!Number.isFinite(I.maxAdv)))return I.side==="long"?(I.maxAdv-I.entryPrice)/I.entryPrice*100:(I.entryPrice-I.maxAdv)/I.entryPrice*100})(),sr=(()=>{if(!(I.entryPrice<=0)&&!(I.maxFav==null||!Number.isFinite(I.maxFav)))return I.side==="long"?(I.maxFav-I.entryPrice)/I.entryPrice*100:(I.entryPrice-I.maxFav)/I.entryPrice*100})();st.push({side:Ae,qty:hn,entryIndex:I.entryIndex,entryTimestamp:I.entryTimestamp,entryPrice:I.entryPrice,entrySignalId:I.entrySignalId,entryOrderId:I.entryOrderId,entrySignalScore:I.entrySignalScore??null,exitIndex:W,exitTimestamp:((na=n[W])==null?void 0:na.timestamp)??Date.now(),exitPrice:Rt,exitSignalId:ye==null?void 0:ye.signalId,exitOrderId:ye==null?void 0:ye.orderId,exitSignalScore:(ye==null?void 0:ye.score)??null,exitReason:_e,pnl:Kn,pnlPct:Number.isFinite(Es)&&Es>0?Kn/Es*100:0,fees:is+es+Mi,entryFee:is,exitFee:es+Mi,netPnl:Kn-(is+es+Mi),maePct:typeof Qo=="number"&&Number.isFinite(Qo)?Qo:void 0,mfePct:typeof sr=="number"&&Number.isFinite(sr)?sr:void 0}),zu+=Math.max(0,W-I.entryIndex+1),Gc+=is+es+Mi,Kn>0?(Pu+=Kn,cc+=1):Kn<0&&(wc+=Math.abs(Kn),ou+=1);try{const Xr=Cf[Ae];typeof Qo=="number"&&Number.isFinite(Qo)&&Xr&&(Xr.maeMin=Xr.maeMin==null?Qo:Math.min(Xr.maeMin,Qo)),typeof sr=="number"&&Number.isFinite(sr)&&Xr&&(Xr.mfeMax=Xr.mfeMax==null?sr:Math.max(Xr.mfeMax,sr))}catch{}return I.qty-=hn,m&&(I.qty=Ie(I.qty,"round")),I.entryFeeRemaining=Math.max(0,I.entryFeeRemaining-is),I.qty<=1e-12&&(I.entryFeeRemaining=0),{qtyClosed:hn,fees:is+es+Mi,exitFee:es+Mi,execPrice:Rt}},mi=(I,W,Z,_e="signal",me="market",Le,ye,Se)=>{const Ge=it(I);if(!Ge.length)return null;const Ae=Ge.slice();let Rt=0,nn=0,Xn=0,hn=0;for(const is of Ae)if(is.qty>0){const Gs=qs(is,W,Z,_e,is.qty,me,Le,ye,Se);Gs&&(Rt+=Gs.qtyClosed,nn+=Gs.fees,Xn+=Gs.exitFee,hn+=Gs.execPrice*Gs.qtyClosed)}return ft[I]=it(I).filter(is=>is.qty>1e-12),mf(I),Rt<=0?null:{qtyClosed:Rt,fees:nn,exitFees:Xn,execPrice:hn/Rt}},Er=I=>{const W=it(I);return W.length?W.reduce((Z,_e)=>Z+(_e.qty>0?_e.qty:0),0):0},Za=(I,W,Z,_e,me="signal",Le="market",ye,Se,Ge)=>{const Ae=it(I);if(!Ae.length)return null;let Rt=Math.max(0,_e),nn=0,Xn=0,hn=0,is=0;const Gs=t.closeMethod==="lifo"?Ae.slice().reverse():Ae;for(const es of Gs){if(Rt<=0)break;if(es.qty<=0)continue;const Mi=Math.min(es.qty,Rt),Kn=qs(es,W,Z,me,Mi,Le,ye,Se,Ge);Kn&&(nn+=Kn.qtyClosed,Xn+=Kn.fees,hn+=Kn.exitFee,is+=Kn.execPrice*Kn.qtyClosed),Rt-=Mi}return ft[I]=it(I).filter(es=>es.qty>1e-12),mf(I),nn<=0?null:{qtyClosed:nn,fees:Xn,exitFees:hn,execPrice:is/nn}},vi=[],$r=(I,W)=>{for(let Z=vi.length-1;Z>=0;Z--){const _e=vi[Z];I(_e)&&(Ce(_e.orderId,{status:"canceled",note:W}),vi.splice(Z,1))}},Il=(I,W)=>{if(!I)return;const Z=String(I).trim();Z&&$r(_e=>String(_e.signalId||"")===Z||String(_e.orderId||"")===Z,W)},cl=I=>{$r(()=>!0,I)},kc=I=>(I==null?void 0:I.order)||{},uc=I=>{const W=typeof I=="number"?I:Number(I);return!Number.isFinite(W)||W<=0?100:Math.max(0,Math.min(100,W))},Tl=I=>{const W=typeof I=="number"?I:Number(I);return Number.isFinite(W)?Math.max(0,W):null},ur=I=>{const W=typeof I=="number"?I:Number(I);return Number.isFinite(W)?W:null},la=I=>{if(!I||typeof I!="object")return null;const W=String(I.commissionType??I.commission_mode??I.commissionMode??"").trim().toLowerCase(),Z=I.commissionCash??I.commission_cash??I.commissionFixed??I.commission_fixed??null,_e=I.commissionPerUnit??I.commission_per_unit??I.commissionPerShare??I.commission_per_share??null,me=I.commissionValue??I.commission_value??null,Le=I.commissionPct??I.commission??null;let ye=null,Se=null;return W==="cash"?(ye="cash",Se=ur(me??Z)):W==="per_unit"||W==="perunit"?(ye="per_unit",Se=ur(me??_e)):W==="percent"||W==="pct"?(ye="percent",Se=Tl(Le),Se!=null&&(Se/=100)):_e!=null?(ye="per_unit",Se=ur(_e)):Z!=null?(ye="cash",Se=ur(Z)):me!=null?(ye="percent",Se=Tl(me),Se!=null&&(Se/=100)):Le!=null&&(ye="percent",Se=Tl(Le),Se!=null&&(Se/=100)),!ye||Se==null||!Number.isFinite(Se)?null:{commissionMode:ye,commissionValue:Math.max(0,Se)}},Fl=I=>{if(!I||typeof I!="object")return null;const W=String(I.slippageType??I.slippage_mode??I.slippageMode??"").trim().toLowerCase(),Z=I.slippageAbs??I.slippage_abs??null,_e=I.slippageTicks??I.slippage_ticks??null,me=I.slippageValue??I.slippage_value??null,Le=I.slippagePct??I.slippage??null;let ye=null,Se=null;return W==="abs"?(ye="abs",Se=ur(me??Z)):W==="ticks"?(ye="ticks",Se=ur(me??_e)):W==="percent"||W==="pct"?(ye="percent",Se=Tl(Le),Se!=null&&(Se/=100)):Z!=null?(ye="abs",Se=ur(Z)):_e!=null?(ye="ticks",Se=ur(_e)):me!=null?(ye="percent",Se=Tl(me),Se!=null&&(Se/=100)):Le!=null&&(ye="percent",Se=Tl(Le),Se!=null&&(Se/=100)),!ye||Se==null||!Number.isFinite(Se)?null:{slippageMode:ye,slippageValue:Math.max(0,Se)}},Oa=I=>{const W=String(I||"market").trim().toLowerCase();return W==="limit"||W==="lit"?"limit":W==="stop"||W==="trailing_stop"?"stop":"market"},ni=(I,W,Z,_e,me)=>Number.isFinite(me)?I==="entry"?W==="long"?Z==="limit"?_e.l<=me:_e.h>=me:Z==="limit"?_e.h>=me:_e.l<=me:W==="long"?Z==="limit"?_e.h>=me:_e.l<=me:Z==="limit"?_e.l<=me:_e.h>=me:!1,vc=(I,W,Z)=>{for(const _e of Z)I.side==="long"?_e==="high"?I.maxFav=I.maxFav==null?W.h:Math.max(I.maxFav,W.h):I.maxAdv=I.maxAdv==null?W.l:Math.min(I.maxAdv,W.l):_e==="low"?I.maxFav=I.maxFav==null?W.l:Math.min(I.maxFav,W.l):I.maxAdv=I.maxAdv==null?W.h:Math.max(I.maxAdv,W.h)},gl=I=>t.intrabarTieBreak==="ohlc"?t.ohlcPath==="open_high_low_close"?["high","low"]:["low","high"]:t.intrabarTieBreak==="best_case"?I==="long"?["high","low"]:["low","high"]:I==="long"?["low","high"]:["high","low"],za=I=>{const{lot:W,i:Z,triggerPx:_e,reason:me,qty:Le,fillKind:ye,note:Se}=I;if(!Number.isFinite(_e)||_e<=0||!Number.isFinite(Le)||Le<=0)return!1;const Ge=ye==="limit"?"limit":"stop",Ae=Mt(Z),Rt=mt({action:"exit",side:W.side,kind:Ge,originalKind:Ge,status:"pending",createdIndex:Z,createdTimestamp:Ae,activeFromIndex:Z,qtyPct:100,price:_e,note:Se}),nn=qs(W,Z,_e,me,Le,ye,{orderId:Rt.id});return nn?(Ce(Rt.id,{status:"filled",filledIndex:Z,filledTimestamp:Ae,fillPrice:nn.execPrice,fillQty:nn.qtyClosed,fees:nn.exitFee,note:Se}),!0):(Ce(Rt.id,{status:"rejected",note:`${Se} (no fill)`}),!1)},sl=I=>{var _e;if(t.fillMode!=="volume")return Number.POSITIVE_INFINITY;const W=Number((_e=n[I])==null?void 0:_e.volume);if(!Number.isFinite(W)||W<=0)return Number.POSITIVE_INFINITY;const Z=W*t.volumeFillPct/100;return Number.isFinite(Z)&&Z>0?Z:Number.POSITIVE_INFINITY},Oc=(I,W,Z)=>{if(I.targetQty!=null&&I.remainingQty!=null)return{ok:!0,target:I.targetQty,remaining:I.remainingQty};if(I.action==="entry"){const ye=To(I.side,W,Z,I.qtyPct,{qty:I.qty,cash:I.cash});return ye.ok?(I.targetQty=ye.qty,I.remainingQty=ye.qty,{ok:!0,target:ye.qty,remaining:ye.qty}):{ok:!1,reject:ye.reject}}const _e=Pi(I.side,Z,I.qtyPct,I.qty,I.cash),me=Ie(_e,"floor");if(!Number.isFinite(me)||me<=0)return{ok:!1,reject:"Qty <= 0"};const Le=Er(I.side);return g!=null&&me>0&&me<g&&me<Le-1e-12?{ok:!1,reject:`Qty ${me} < minQty ${g}`}:(I.targetQty=me,I.remainingQty=me,{ok:!0,target:me,remaining:me})},Va=I=>I.tif??t.timeInForce,Wa=(I,W,Z,_e,me,Le)=>{const ye=Oc(I,W,Z);if(!ye.ok)return Ce(I.orderId,{status:"rejected",note:ye.reject}),{remove:!0,filled:!1};const Se=Va(I),Ge=ye.remaining,Ae=sl(W),Rt=Math.min(Ge,Ae);if(Se==="fok"&&Rt+1e-12<Ge)return Ce(I.orderId,{status:"rejected",note:"FOK not fully filled"}),{remove:!0,filled:!1};if(Se==="ioc"&&Rt<=0)return Ce(I.orderId,{status:"canceled",note:"IOC not filled"}),{remove:!0,filled:!1};if(Rt<=0)return{remove:!1,filled:!1};const nn=I.slippageMode!=null||I.slippageValue!=null||I.commissionMode!=null||I.commissionValue!=null?{slippageMode:I.slippageMode,slippageValue:I.slippageValue,commissionMode:I.commissionMode,commissionValue:I.commissionValue}:void 0,Xn=Mt(W);let hn=0,is=Z,Gs=0,es=!1;if(I.action==="entry"){if(t.positionMode==="netting"){const Qo=St(I.side);if(Lt(Qo)){const sr=mt({action:"exit",side:Qo,kind:_e==="limit"?"limit":"market",originalKind:"market",status:"pending",createdIndex:W,createdTimestamp:Xn,activeFromIndex:W,qtyPct:100,price:Z,note:"AUTO netting close (reverse)"}),na=mi(Qo,W,Z,"signal",_e,{orderId:sr.id,signalId:I.signalId,score:I.score??null});Ce(sr.id,{status:na?"filled":"rejected",filledIndex:na?W:void 0,filledTimestamp:na?Xn:void 0,fillPrice:na==null?void 0:na.execPrice,fillQty:(na==null?void 0:na.qtyClosed)??0,fees:(na==null?void 0:na.exitFees)??0,note:na?"AUTO netting close (reverse)":"AUTO netting close failed"})}}const Es=Ba(I.side,W,Z,I.qtyPct,_e,I.bracket,{orderId:I.orderId,signalId:I.signalId,score:I.score??null},{qty:Rt,...nn});if(Es.ok){const Qo=Es.lot;if(hn=Qo.qty,is=Qo.entryPrice,Gs=Qo.entryFee,es=!0,t.execution!=="bar_close"){const sr=gl(I.side),na=sr.indexOf(me),Xr=na>=0?sr.slice(na+1):sr;vc(Qo,Le,Xr),uu(I.side,W,Le,Xr)}}}else{const Es=Rt>=Er(I.side)-1e-12?mi(I.side,W,Z,"signal",_e,{orderId:I.orderId,signalId:I.signalId,score:I.score??null},void 0,nn):Za(I.side,W,Z,Rt,"signal",_e,{orderId:I.orderId,signalId:I.signalId,score:I.score??null},void 0,nn);Es&&(hn=Es.qtyClosed,is=Es.execPrice,Gs=Es.exitFees,es=!0)}if(!es||hn<=0)return Ce(I.orderId,{status:"rejected",note:"Order not filled"}),{remove:!0,filled:!1};const Mi=Math.max(0,Ge-hn),Kn=Mi<=1e-12?"filled":"partial";return Te({id:I.orderId,index:W,timestamp:Xn,qty:hn,price:is,fees:Gs,targetQty:ye.target,remainingQty:Mi,status:Kn,note:Kn==="partial"?"Partial fill":void 0}),I.remainingQty=Mi,I.targetQty=ye.target,Se==="ioc"?(Mi>1e-12&&Ce(I.orderId,{status:"canceled",note:"IOC remainder canceled"}),{remove:!0,filled:!0}):{remove:Mi<=1e-12,filled:!0}},uu=(I,W,Z,_e)=>{if(!Lt(I)||t.execution==="bar_close")return!1;let me=!1;const Le=ye=>{var Se,Ge;for(const Ae of it(I)){if(Ae.qty<=0)continue;const Rt=Ve(Z,"exit",Ae.side);if(Ae.trailingPct&&Ae.trailingPct>0){const nn=Ae.trailingPct/100;if(Ae.side==="long"&&ye==="high"){const Xn=Z.h*(1-nn);Ae.trailingStop=Ae.trailingStop==null?Xn:Math.max(Ae.trailingStop,Xn)}if(Ae.side==="short"&&ye==="low"){const Xn=Z.l*(1+nn);Ae.trailingStop=Ae.trailingStop==null?Xn:Math.min(Ae.trailingStop,Xn)}}if(Ae.side==="long"&&ye==="high"){if((Se=Ae.takeProfitOrders)!=null&&Se.length){const nn=[];for(const Xn of Ae.takeProfitOrders){if(Ae.qty<=0)break;Rt.h>=Xn.price?me=za({lot:Ae,i:W,triggerPx:Xn.price,reason:"take_profit",qty:Xn.qty,fillKind:"limit",note:`AUTO take_profit (${Xn.pct}%)`})||me:nn.push(Xn)}Ae.takeProfitOrders=nn}Ae.takePrice!=null&&Rt.h>=Ae.takePrice&&Ae.qty>0&&(me=za({lot:Ae,i:W,triggerPx:Ae.takePrice,reason:"take_profit",qty:Ae.qty,fillKind:"limit",note:"AUTO take_profit"})||me)}if(Ae.side==="short"&&ye==="low"){if((Ge=Ae.takeProfitOrders)!=null&&Ge.length){const nn=[];for(const Xn of Ae.takeProfitOrders){if(Ae.qty<=0)break;Rt.l<=Xn.price?me=za({lot:Ae,i:W,triggerPx:Xn.price,reason:"take_profit",qty:Xn.qty,fillKind:"limit",note:`AUTO take_profit (${Xn.pct}%)`})||me:nn.push(Xn)}Ae.takeProfitOrders=nn}Ae.takePrice!=null&&Rt.l<=Ae.takePrice&&Ae.qty>0&&(me=za({lot:Ae,i:W,triggerPx:Ae.takePrice,reason:"take_profit",qty:Ae.qty,fillKind:"limit",note:"AUTO take_profit"})||me)}if(Ae.side==="long"&&ye==="low"){if(Ae.stopPrice!=null&&Rt.l<=Ae.stopPrice){me=za({lot:Ae,i:W,triggerPx:Ae.stopPrice,reason:"stop_loss",qty:Ae.qty,fillKind:"stop",note:"AUTO stop_loss"})||me;continue}Ae.trailingStop!=null&&Rt.l<=Ae.trailingStop&&(me=za({lot:Ae,i:W,triggerPx:Ae.trailingStop,reason:"trailing_stop",qty:Ae.qty,fillKind:"stop",note:"AUTO trailing_stop"})||me)}if(Ae.side==="short"&&ye==="high"){if(Ae.stopPrice!=null&&Rt.h>=Ae.stopPrice){me=za({lot:Ae,i:W,triggerPx:Ae.stopPrice,reason:"stop_loss",qty:Ae.qty,fillKind:"stop",note:"AUTO stop_loss"})||me;continue}Ae.trailingStop!=null&&Rt.h>=Ae.trailingStop&&(me=za({lot:Ae,i:W,triggerPx:Ae.trailingStop,reason:"trailing_stop",qty:Ae.qty,fillKind:"stop",note:"AUTO trailing_stop"})||me)}}ft[I]=it(I).filter(Ae=>Ae.qty>1e-12),mf(I)};for(const ye of _e){if(!Lt(I))break;Le(ye)}return me},ud=(I,W)=>{if(I)for(let Z=vi.length-1;Z>=0;Z--){const _e=vi[Z];(_e==null?void 0:_e.ocoGroup)===I&&(W&&_e.orderId===W||(Ce(_e.orderId,{status:"canceled",note:"OCO canceled"}),vi.splice(Z,1)))}},Ll=(I,W,Z)=>I==="entry"?W==="long"?Z==="limit"?"low":"high":Z==="limit"?"high":"low":W==="long"?Z==="limit"?"high":"low":Z==="limit"?"low":"high",vu=(I,W,Z,_e,me)=>{const Le=me.o;if(!Number.isFinite(Le)||!Number.isFinite(_e))return{px:_e,fillsAtOpen:!1};const ye=Le*je(I,W);return Z==="limit"?I==="entry"&&W==="long"&&Le<=_e||I==="entry"&&W==="short"&&Le>=_e||I==="exit"&&W==="long"&&Le>=_e||I==="exit"&&W==="short"&&Le<=_e?{px:ye,fillsAtOpen:!0}:{px:_e,fillsAtOpen:!1}:I==="entry"&&W==="long"&&Le>=_e||I==="entry"&&W==="short"&&Le<=_e||I==="exit"&&W==="long"&&Le<=_e||I==="exit"&&W==="short"&&Le>=_e?{px:Le,fillsAtOpen:!0}:{px:_e,fillsAtOpen:!1}},Sc=(I,W,Z)=>{var ye,Se;if(!Lt(I)||t.execution==="bar_close")return!1;const _e=Z.o;if(!Number.isFinite(_e)||_e<=0)return!1;const me=_e*je("exit",I);let Le=!1;for(const Ge of it(I).slice())if(!(Ge.qty<=0))if(Ge.side==="long"){if(Ge.stopPrice!=null&&me<=Ge.stopPrice){Le=za({lot:Ge,i:W,triggerPx:_e,reason:"stop_loss",qty:Ge.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||Le;continue}if(Ge.trailingStop!=null&&me<=Ge.trailingStop){Le=za({lot:Ge,i:W,triggerPx:_e,reason:"trailing_stop",qty:Ge.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||Le;continue}if((ye=Ge.takeProfitOrders)!=null&&ye.length){const Ae=[];for(const Rt of Ge.takeProfitOrders){if(Ge.qty<=0)break;me>=Rt.price?Le=za({lot:Ge,i:W,triggerPx:me,reason:"take_profit",qty:Rt.qty,fillKind:"limit",note:`AUTO take_profit (${Rt.pct}%) (gap)`})||Le:Ae.push(Rt)}Ge.takeProfitOrders=Ae}Ge.takePrice!=null&&me>=Ge.takePrice&&Ge.qty>0&&(Le=za({lot:Ge,i:W,triggerPx:me,reason:"take_profit",qty:Ge.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||Le)}else{if(Ge.stopPrice!=null&&me>=Ge.stopPrice){Le=za({lot:Ge,i:W,triggerPx:_e,reason:"stop_loss",qty:Ge.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||Le;continue}if(Ge.trailingStop!=null&&me>=Ge.trailingStop){Le=za({lot:Ge,i:W,triggerPx:_e,reason:"trailing_stop",qty:Ge.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||Le;continue}if((Se=Ge.takeProfitOrders)!=null&&Se.length){const Ae=[];for(const Rt of Ge.takeProfitOrders){if(Ge.qty<=0)break;me<=Rt.price?Le=za({lot:Ge,i:W,triggerPx:me,reason:"take_profit",qty:Rt.qty,fillKind:"limit",note:`AUTO take_profit (${Rt.pct}%) (gap)`})||Le:Ae.push(Rt)}Ge.takeProfitOrders=Ae}Ge.takePrice!=null&&me<=Ge.takePrice&&Ge.qty>0&&(Le=za({lot:Ge,i:W,triggerPx:me,reason:"take_profit",qty:Ge.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||Le)}return ft[I]=it(I).filter(Ge=>Ge.qty>1e-12),mf(I),Le},Ja=(I,W)=>{if(!vi.length)return;if(Vu){cl("Canceled by risk limit");return}pe!=null&&ja>=pe&&$r(Se=>Se.action==="entry","Max intraday filled orders reached");for(let Se=vi.length-1;Se>=0;Se--){const Ge=vi[Se];if(!(I<Ge.activeFromIndex)){if(Ge.expiresAtIndex!=null&&I>Ge.expiresAtIndex){Ce(Ge.orderId,{status:"expired",note:"Expired"}),vi.splice(Se,1);continue}if(Ge.action==="exit"&&!Lt(Ge.side)){Ce(Ge.orderId,{status:"canceled",note:"No position"}),vi.splice(Se,1);continue}}}for(const Se of vi){if(Se.kind!=="trailing_stop"||I<Se.activeFromIndex||Se.action!=="exit"||!Lt(Se.side))continue;const Ge=typeof Se.trailPct=="number"&&Number.isFinite(Se.trailPct)?Se.trailPct:null,Ae=typeof Se.trailOffset=="number"&&Number.isFinite(Se.trailOffset)?Se.trailOffset:null,Rt=typeof Se.trailPrice=="number"&&Number.isFinite(Se.trailPrice)?Se.trailPrice:Se.side==="long"?W.h:W.l,nn=Ae??(Ge!=null&&Ge>0?Rt*Ge/100:null);if(!(!nn||!Number.isFinite(nn)||nn<=0))if(Se.side==="long"){const Xn=Rt-nn;Se.price=Se.price==null?Xn:Math.max(Se.price,Xn)}else{const Xn=Rt+nn;Se.price=Se.price==null?Xn:Math.min(Se.price,Xn)}}const Z=[];for(let Se=0;Se<vi.length;Se++){const Ge=vi[Se];if(I<Ge.activeFromIndex||Ge.expiresAtIndex!=null&&I>Ge.expiresAtIndex)continue;const Ae=Ve(W,Ge.action,Ge.side);if(Ge.action==="exit"){if(!Lt(Ge.side))continue}else if(Pt(Ge.side)>=t.pyramiding)continue;const Rt=Ge.ocoGroup||`__solo__${Ge.orderId||Se}`,nn=Ge.action==="exit"?0:1,Xn=gl(Ge.side);if(Ge.kind==="stop_limit"){const sr=Ge.stopPrice??Ge.price,na=Ge.limitPrice??Ge.price;if(!Number.isFinite(sr)||!Number.isFinite(na)||!ni(Ge.action,Ge.side,"stop",Ae,sr))continue;const Uu=Ll(Ge.action,Ge.side,"stop"),xd=Xn.indexOf(Uu),ul=vu(Ge.action,Ge.side,"stop",sr,W),dr=ul.fillsAtOpen?0:xd>=0?xd+1:99,Fu=Uu==="high"?sr:-sr;Z.push({groupKey:Rt,orderId:Ge.orderId,pi:Se,action:Ge.action,side:Ge.side,kind:"stop_limit",triggerExt:Uu,phase:dr,actionRank:nn,priceRank:Fu,sp:sr,lp:na,stopAtOpen:ul.fillsAtOpen,limitAtOpen:vu(Ge.action,Ge.side,"limit",na,W).fillsAtOpen});continue}const hn=Ge.price;if(hn==null||!Number.isFinite(hn))continue;const is=Ge.kind==="stop"||Ge.kind==="trailing_stop"?"stop":"limit";if(!ni(Ge.action,Ge.side,is,Ae,hn))continue;const es=Ll(Ge.action,Ge.side,is),Mi=Xn.indexOf(es),Es=vu(Ge.action,Ge.side,is,hn,W).fillsAtOpen?0:Mi>=0?Mi+1:99,Qo=es==="high"?hn:-hn;Z.push({groupKey:Rt,orderId:Ge.orderId,pi:Se,action:Ge.action,side:Ge.side,kind:Ge.kind,triggerKind:is,triggerExt:es,phase:Es,actionRank:nn,priceRank:Qo,px:hn})}if(!Z.length)return;const _e=new Map,me=(Se,Ge)=>Se.phase!==Ge.phase?Se.phase<Ge.phase?Se:Ge:Se.actionRank!==Ge.actionRank?Se.actionRank<Ge.actionRank?Se:Ge:Se.priceRank!==Ge.priceRank?Se.priceRank<Ge.priceRank?Se:Ge:Se.pi<Ge.pi?Se:Ge;for(const Se of Z){const Ge=_e.get(Se.groupKey);_e.set(Se.groupKey,Ge?me(Ge,Se):Se)}const Le=Array.from(_e.values()).sort((Se,Ge)=>Se.phase!==Ge.phase?Se.phase-Ge.phase:Se.actionRank!==Ge.actionRank?Se.actionRank-Ge.actionRank:Se.priceRank!==Ge.priceRank?Se.priceRank-Ge.priceRank:Se.pi-Ge.pi),ye=(Se,Ge)=>{if(Se){const Ae=vi.findIndex(Rt=>Rt.orderId===Se);if(Ae>=0)return Ae}return typeof Ge=="number"?Ge:-1};for(const Se of Le){const Ge=ye(Se.orderId,Se.pi);if(Ge<0||Ge>=vi.length)continue;const Ae=vi[Ge];if(I<Ae.activeFromIndex||Ae.expiresAtIndex!=null&&I>Ae.expiresAtIndex)continue;const Rt=Ve(W,Ae.action,Ae.side);if(Ae.action==="exit"){if(!Lt(Ae.side)){Ce(Ae.orderId,{status:"canceled",note:"No position"}),vi.splice(Ge,1);continue}}else if(Pt(Ae.side)>=t.pyramiding)continue;if(Ae.kind==="stop_limit"){const Kn=Ae.stopPrice??Ae.price,Es=Ae.limitPrice??Ae.price;if(!Number.isFinite(Kn)||!Number.isFinite(Es)||!ni(Ae.action,Ae.side,"stop",Rt,Kn))continue;const sr=ni(Ae.action,Ae.side,"limit",Rt,Es),na=Ll(Ae.action,Ae.side,"stop"),Xr=Ll(Ae.action,Ae.side,"limit"),Uu=gl(Ae.side),xd=Uu.indexOf(na),ul=Uu.indexOf(Xr);if(sr&&xd>=0&&ul>=0&&xd<ul){const gi=vu(Ae.action,Ae.side,"limit",Es,W).px,Dr=Wa(Ae,I,gi,"limit",na,W);Dr.filled&&ud(Ae.ocoGroup,Ae.orderId),Dr.remove?vi.splice(Ge,1):Ae.remainingQty!=null&&Ae.remainingQty>1e-12&&(Ae.kind="limit",Ae.price=Es,Ae.activeFromIndex=I+1);continue}Ce(Ae.orderId,{kind:"limit",note:"Stop triggered → limit active next bar"}),Ae.kind="limit",Ae.price=Es,Ae.activeFromIndex=I+1;continue}const nn=Ae.price;if(nn==null||!Number.isFinite(nn))continue;const Xn=Ae.kind==="stop"||Ae.kind==="trailing_stop"?"stop":"limit";if(!ni(Ae.action,Ae.side,Xn,Rt,nn))continue;let is=Oa(Ae.kind),Gs=vu(Ae.action,Ae.side,Xn,nn,W).px;const es=Ll(Ae.action,Ae.side,Xn);if(Ae.kind==="lit"){const Kn=typeof Ae.limitPrice=="number"&&Number.isFinite(Ae.limitPrice)?Ae.limitPrice:nn;if(!ni(Ae.action,Ae.side,"limit",Rt,Kn)){Ce(Ae.orderId,{kind:"limit",note:"LIT triggered → limit active next bar"}),Ae.kind="limit",Ae.price=Kn,Ae.activeFromIndex=I+1;continue}Gs=vu(Ae.action,Ae.side,"limit",Kn,W).px,is="limit"}const Mi=Wa(Ae,I,Gs,is,es,W);Mi.filled&&ud(Ae.ocoGroup,Ae.orderId),Mi.remove&&vi.splice(Ge,1)}},ga=(I,W)=>{if(!Tt()||t.execution==="bar_close")return!1;const Z=Sc("long",I,W),_e=Sc("short",I,W),me=uu("long",I,W,gl("long")),Le=uu("short",I,W,gl("short"));return Z||_e||me||Le};let Wu=0,zc=0;for(let I=ll;I<=va;I++){const W=boe(n[I]);if(!W)continue;const Z=W.c;Io(I,Z,ll);const _e=Number((ht=n[I])==null?void 0:ht.timestamp);if(Number.isFinite(_e)&&_e>0){const ye=new Date(_e).toISOString().slice(0,10);ye&&ye!==nc&&(nc=ye,Bc=sc(I,Z),ja=0)}for(const ye of it("long"))ye.qty<=0||(ye.maxFav=ye.maxFav==null?W.h:Math.max(ye.maxFav,W.h),ye.maxAdv=ye.maxAdv==null?W.l:Math.min(ye.maxAdv,W.l));for(const ye of it("short"))ye.qty<=0||(ye.maxFav=ye.maxFav==null?W.l:Math.min(ye.maxFav,W.l),ye.maxAdv=ye.maxAdv==null?W.h:Math.max(ye.maxAdv,W.h));for(Tt()&&ga(I,W),Ja(I,W),Ji(I,W);jl<Wr.length&&Wr[jl].index===I;){const ye=Wr[jl];if(ye.type==="cancel"){Il(ye.orderId??ye.signalId,"Canceled by strategy.cancel"),jl+=1;continue}if(ye.type==="cancel_all"){cl("Canceled by strategy.cancel_all"),jl+=1;continue}const Se=kc(ye),Ae=String((Se==null?void 0:Se.kind)||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop/g,"trailing_stop"),Rt=uc(Se==null?void 0:Se.qtyPct),nn=Se==null?void 0:Se.qty,Xn=Se==null?void 0:Se.cash,hn=typeof nn=="number"&&Number.isFinite(nn)?nn:Number(nn),is=typeof Xn=="number"&&Number.isFinite(Xn)?Xn:Number(Xn),Gs=Number.isFinite(hn)?hn:void 0,es=Number.isFinite(is)?is:void 0,Mi=la(Se),Kn=Fl(Se),Es=Mi||Kn?{...Mi,...Kn}:void 0,Qo=typeof(Se==null?void 0:Se.oco)=="string"&&String(Se.oco).trim()?String(Se.oco).trim():void 0,sr=String((Se==null?void 0:Se.tif)??(Se==null?void 0:Se.timeInForce)??"").trim().toLowerCase(),Xr=sr?sr==="ioc"||sr==="immediate_or_cancel"?"ioc":sr==="fok"||sr==="fill_or_kill"?"fok":"gtc":t.timeInForce,Uu=Se==null?void 0:Se.expiresBars,xd=typeof Uu=="number"&&Number.isFinite(Uu)&&Uu>0?Math.floor(Uu):sr==="day"?1:null,ul=xd?I+xd:void 0,dr=Wo(Se==null?void 0:Se.bracket),Fu=(Se==null?void 0:Se.trailPct)??(Se==null?void 0:Se.trail_percent)??(Se==null?void 0:Se.trailPercent)??(Se==null?void 0:Se.trailingStopPct)??(Se==null?void 0:Se.trailing_stop_pct)??null,gi=(Se==null?void 0:Se.trailOffset)??(Se==null?void 0:Se.trailPoints)??(Se==null?void 0:Se.trail_points)??(Se==null?void 0:Se.trail_offset)??null,Dr=(Se==null?void 0:Se.trailPrice)??(Se==null?void 0:Se.trail_price)??null,Yi=Tl(Fu),Ki=ur(gi),Xi=ur(Dr),ca=Vu?"Risk limit reached":pe!=null&&ja>=pe?"Max intraday filled orders reached":null,Jt={commissionMode:Es==null?void 0:Es.commissionMode,commissionValue:Es==null?void 0:Es.commissionValue,slippageMode:Es==null?void 0:Es.slippageMode,slippageValue:Es==null?void 0:Es.slippageValue},rn={qtyPct:Rt,qty:Gs,cash:es,tif:Xr,trailPct:Yi??void 0,trailOffset:Ki??void 0,trailPrice:Xi??void 0,...Jt},dn=(Ae==="limit"||Ae==="stop"||Ae==="mit"||Ae==="lit")&&typeof(Se==null?void 0:Se.price)=="number"?Se.price:Z,uo=typeof(Se==null?void 0:Se.stopPrice)=="number"?Se.stopPrice:typeof(Se==null?void 0:Se.price)=="number"?Se.price:Z,zs=typeof(Se==null?void 0:Se.limitPrice)=="number"?Se.limitPrice:typeof(Se==null?void 0:Se.price)=="number"?Se.price:Z,Hr=Ae==="limit"||Ae==="stop"||Ae==="mit"||Ae==="lit"?We(ye.type.startsWith("entry")?"entry":"exit",ye.type.endsWith("long")?"long":"short",Ae==="stop"?"stop":"limit",dn):dn,Ul=Ae==="stop_limit"?We(ye.type.startsWith("entry")?"entry":"exit",ye.type.endsWith("long")?"long":"short","stop",uo):uo,Oi=Ae==="stop_limit"||Ae==="lit"?We(ye.type.startsWith("entry")?"entry":"exit",ye.type.endsWith("long")?"long":"short","limit",zs):zs,Nd=Mt(I),hr=Ae==="limit"||Ae==="stop"||Ae==="stop_limit"||Ae==="mit"||Ae==="lit"||Ae==="trailing_stop"?Ae:"market";if(ye.type==="exit_long"&&Lt("long"))if(hr==="stop_limit"){if(Number.isFinite(Ul)&&Ul>0&&Number.isFinite(Oi)&&Oi>0){const vr=mt({action:"exit",side:"long",kind:"stop_limit",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,stopPrice:Ul,limitPrice:Oi});vi.push({action:"exit",side:"long",kind:"stop_limit",signalId:ye.signalId,score:ye.score??null,stopPrice:Ul,limitPrice:Oi,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,...rn,orderId:vr.id})}}else if(hr==="limit"||hr==="stop"||hr==="mit"||hr==="lit"||hr==="trailing_stop"){if(Number.isFinite(Hr)&&Hr>0){const vr=typeof Xi=="number"&&Number.isFinite(Xi)?Xi:Z,_l=Ki!=null&&Number.isFinite(Ki)?Ki:Yi!=null&&Number.isFinite(Yi)?vr*Yi/100:null,ia=hr==="trailing_stop"&&_l!=null?We("exit","long","stop",vr-_l):Hr,Zl=mt({action:"exit",side:"long",kind:hr,originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,trailPct:Yi??void 0,trailOffset:Ki??void 0,trailPrice:Xi??void 0,price:ia,limitPrice:hr==="lit"?Oi:void 0});vi.push({action:"exit",side:"long",kind:hr,signalId:ye.signalId,score:ye.score??null,price:ia,limitPrice:hr==="lit"?Oi:void 0,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,...rn,orderId:Zl.id})}}else{const vr=Er("long"),_l=Pi("long",Z,Rt,Gs,es),ia=Ie(_l,"floor"),Zl=mt({action:"exit",side:"long",kind:"market",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr});if(g!=null&&ia>0&&ia<g&&ia<vr-1e-12)Ce(Zl.id,{status:"rejected",note:`Qty ${ia} < minQty ${g}`});else{const Bo=ia>=vr-1e-12?mi("long",I,Z,"signal","market",{signalId:ye.signalId,orderId:Zl.id,score:ye.score??null},void 0,Es):Za("long",I,Z,ia,"signal","market",{signalId:ye.signalId,orderId:Zl.id,score:ye.score??null},void 0,Es);Ce(Zl.id,{status:Bo?"filled":"rejected",filledIndex:Bo?I:void 0,filledTimestamp:Bo?Nd:void 0,fillPrice:(Bo==null?void 0:Bo.execPrice)??Ii("long",Z,"market"),fillQty:(Bo==null?void 0:Bo.qtyClosed)??0,fees:(Bo==null?void 0:Bo.exitFees)??0,note:Bo?void 0:"Exit not filled"})}}else if(ye.type==="exit_short"&&Lt("short"))if(hr==="stop_limit"){if(Number.isFinite(Ul)&&Ul>0&&Number.isFinite(Oi)&&Oi>0){const vr=mt({action:"exit",side:"short",kind:"stop_limit",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,stopPrice:Ul,limitPrice:Oi});vi.push({action:"exit",side:"short",kind:"stop_limit",signalId:ye.signalId,score:ye.score??null,stopPrice:Ul,limitPrice:Oi,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,...rn,orderId:vr.id})}}else if(hr==="limit"||hr==="stop"||hr==="mit"||hr==="lit"||hr==="trailing_stop"){if(Number.isFinite(Hr)&&Hr>0){const vr=typeof Xi=="number"&&Number.isFinite(Xi)?Xi:Z,_l=Ki!=null&&Number.isFinite(Ki)?Ki:Yi!=null&&Number.isFinite(Yi)?vr*Yi/100:null,ia=hr==="trailing_stop"&&_l!=null?We("exit","short","stop",vr+_l):Hr,Zl=mt({action:"exit",side:"short",kind:hr,originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,trailPct:Yi??void 0,trailOffset:Ki??void 0,trailPrice:Xi??void 0,price:ia,limitPrice:hr==="lit"?Oi:void 0});vi.push({action:"exit",side:"short",kind:hr,signalId:ye.signalId,score:ye.score??null,price:ia,limitPrice:hr==="lit"?Oi:void 0,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,...rn,orderId:Zl.id})}}else{const vr=Er("short"),_l=Pi("short",Z,Rt,Gs,es),ia=Ie(_l,"floor"),Zl=mt({action:"exit",side:"short",kind:"market",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr});if(g!=null&&ia>0&&ia<g&&ia<vr-1e-12)Ce(Zl.id,{status:"rejected",note:`Qty ${ia} < minQty ${g}`});else{const Bo=ia>=vr-1e-12?mi("short",I,Z,"signal","market",{signalId:ye.signalId,orderId:Zl.id,score:ye.score??null},void 0,Es):Za("short",I,Z,ia,"signal","market",{signalId:ye.signalId,orderId:Zl.id,score:ye.score??null},void 0,Es);Ce(Zl.id,{status:Bo?"filled":"rejected",filledIndex:Bo?I:void 0,filledTimestamp:Bo?Nd:void 0,fillPrice:(Bo==null?void 0:Bo.execPrice)??Ii("short",Z,"market"),fillQty:(Bo==null?void 0:Bo.qtyClosed)??0,fees:(Bo==null?void 0:Bo.exitFees)??0,note:Bo?void 0:"Exit not filled"})}}else if(ye.type==="entry_long"&&t.allowLong)if(hr==="stop_limit"){if(Number.isFinite(Ul)&&Ul>0&&Number.isFinite(Oi)&&Oi>0){const vr=mt({action:"entry",side:"long",kind:"stop_limit",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,stopPrice:Ul,limitPrice:Oi});ca?Ce(vr.id,{status:"rejected",note:ca}):vi.push({action:"entry",side:"long",kind:"stop_limit",signalId:ye.signalId,score:ye.score??null,stopPrice:Ul,limitPrice:Oi,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,bracket:dr,...rn,orderId:vr.id})}}else if(hr==="limit"||hr==="stop"||hr==="mit"||hr==="lit"||hr==="trailing_stop"){if(Number.isFinite(Hr)&&Hr>0){const vr=typeof Xi=="number"&&Number.isFinite(Xi)?Xi:Z,_l=Ki!=null&&Number.isFinite(Ki)?Ki:Yi!=null&&Number.isFinite(Yi)?vr*Yi/100:null,ia=hr==="trailing_stop"&&_l!=null?We("entry","long","stop",vr+_l):Hr,Zl=mt({action:"entry",side:"long",kind:hr,originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,trailPct:Yi??void 0,trailOffset:Ki??void 0,trailPrice:Xi??void 0,price:ia,limitPrice:hr==="lit"?Oi:void 0});ca?Ce(Zl.id,{status:"rejected",note:ca}):vi.push({action:"entry",side:"long",kind:hr,signalId:ye.signalId,score:ye.score??null,price:ia,limitPrice:hr==="lit"?Oi:void 0,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,bracket:dr,...rn,orderId:Zl.id})}}else{const vr=mt({action:"entry",side:"long",kind:"market",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr});if(ca){Ce(vr.id,{status:"rejected",note:ca}),jl+=1;continue}if(t.positionMode==="netting"){const ia="short";if(Lt(ia)){const Zl=mt({action:"exit",side:ia,kind:"market",originalKind:"market",status:"pending",createdIndex:I,createdTimestamp:Nd,activeFromIndex:I,qtyPct:100,price:Z,note:"AUTO netting close (reverse)"}),Bo=mi(ia,I,Z,"signal","market",{signalId:ye.signalId,orderId:Zl.id,score:ye.score??null});Ce(Zl.id,{status:Bo?"filled":"rejected",filledIndex:Bo?I:void 0,filledTimestamp:Bo?Nd:void 0,fillPrice:(Bo==null?void 0:Bo.execPrice)??Ii(ia,Z,"market"),fillQty:(Bo==null?void 0:Bo.qtyClosed)??0,fees:(Bo==null?void 0:Bo.exitFees)??0})}}const _l=Ba("long",I,Z,Rt,"market",dr,{signalId:ye.signalId,orderId:vr.id,score:ye.score??null},{qty:Gs,cash:es,...Es});if(_l.ok){const ia=_l.lot;Ce(vr.id,{status:"filled",filledIndex:I,filledTimestamp:Nd,fillPrice:ia.entryPrice,fillQty:ia.qty,fees:ia.entryFee})}else Ce(vr.id,{status:"rejected",note:_l.reject||"Entry blocked"})}else if(ye.type==="entry_short"&&t.allowShort)if(hr==="stop_limit"){if(Number.isFinite(Ul)&&Ul>0&&Number.isFinite(Oi)&&Oi>0){const vr=mt({action:"entry",side:"short",kind:"stop_limit",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,stopPrice:Ul,limitPrice:Oi});ca?Ce(vr.id,{status:"rejected",note:ca}):vi.push({action:"entry",side:"short",kind:"stop_limit",signalId:ye.signalId,score:ye.score??null,stopPrice:Ul,limitPrice:Oi,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,bracket:dr,...rn,orderId:vr.id})}}else if(hr==="limit"||hr==="stop"||hr==="mit"||hr==="lit"||hr==="trailing_stop"){if(Number.isFinite(Hr)&&Hr>0){const vr=typeof Xi=="number"&&Number.isFinite(Xi)?Xi:Z,_l=Ki!=null&&Number.isFinite(Ki)?Ki:Yi!=null&&Number.isFinite(Yi)?vr*Yi/100:null,ia=hr==="trailing_stop"&&_l!=null?We("entry","short","stop",vr-_l):Hr,Zl=mt({action:"entry",side:"short",kind:hr,originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I+1,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr,trailPct:Yi??void 0,trailOffset:Ki??void 0,trailPrice:Xi??void 0,price:ia,limitPrice:hr==="lit"?Oi:void 0});ca?Ce(Zl.id,{status:"rejected",note:ca}):vi.push({action:"entry",side:"short",kind:hr,signalId:ye.signalId,score:ye.score??null,price:ia,limitPrice:hr==="lit"?Oi:void 0,activeFromIndex:I+1,expiresAtIndex:ul,ocoGroup:Qo,bracket:dr,...rn,orderId:Zl.id})}}else{const vr=mt({action:"entry",side:"short",kind:"market",originalKind:hr,status:"pending",signalId:ye.signalId,ocoGroup:Qo,createdIndex:I,createdTimestamp:Nd,activeFromIndex:I,expiresAtIndex:ul,qtyPct:Rt,qty:Gs,cash:es,tif:Xr});if(ca){Ce(vr.id,{status:"rejected",note:ca}),jl+=1;continue}if(t.positionMode==="netting"){const ia="long";if(Lt(ia)){const Zl=mt({action:"exit",side:ia,kind:"market",originalKind:"market",status:"pending",createdIndex:I,createdTimestamp:Nd,activeFromIndex:I,qtyPct:100,price:Z,note:"AUTO netting close (reverse)"}),Bo=mi(ia,I,Z,"signal","market",{signalId:ye.signalId,orderId:Zl.id,score:ye.score??null});Ce(Zl.id,{status:Bo?"filled":"rejected",filledIndex:Bo?I:void 0,filledTimestamp:Bo?Nd:void 0,fillPrice:(Bo==null?void 0:Bo.execPrice)??Ii(ia,Z,"market"),fillQty:(Bo==null?void 0:Bo.qtyClosed)??0,fees:(Bo==null?void 0:Bo.exitFees)??0})}}const _l=Ba("short",I,Z,Rt,"market",dr,{signalId:ye.signalId,orderId:vr.id,score:ye.score??null},{qty:Gs,cash:es,...Es});if(_l.ok){const ia=_l.lot;Ce(vr.id,{status:"filled",filledIndex:I,filledTimestamp:Nd,fillPrice:ia.entryPrice,fillQty:ia.qty,fees:ia.entryFee})}else Ce(vr.id,{status:"rejected",note:_l.reject||"Entry blocked"})}jl+=1}let me=sc(I,Z);if(!Vu){const ye=Bc-me,Se=le??(J!=null?Bc*J:null),Ge=Xl>0?(Xl-me)/Xl:0,Ae=Xl-me,Rt=O!=null&&Ge>=O||D!=null&&Ae>=D,nn=Se!=null&&Number.isFinite(ye)&&ye>=Se;(Rt||nn)&&(Vu=!0,cl("Canceled by risk limit"),Lt("long")&&mi("long",I,Z,"signal","market"),Lt("short")&&mi("short",I,Z,"signal","market"),me=sc(I,Z))}{const ye=(pt=n==null?void 0:n[I])==null?void 0:pt.timestamp,Se=Number(ye);Qe.push({index:I,timestamp:Number.isFinite(Se)&&Se>0?Se:Date.now(),equity:me})}if(me>Xl&&(Xl=me),Xl>0){const ye=(Xl-me)/Xl;ye>Mu&&(Mu=ye);const Se=Xl-me;Se>Zu&&(Zu=Se)}if(Number.isFinite(me)){if(!Number.isFinite(xo)||me<xo)xo=me;else if(xo>0){const ye=me-xo;ye>ql&&(ql=ye);const Se=ye/xo;Se>Sr&&(Sr=Se)}}Wu+=1,Tt()&&(zc+=1);const Le=Er("long")-Er("short");Yt[I]=Le,qn[I]=If(),Vn[I]=Pt("long")+Pt("short"),Dn[I]=st.length,Wn[I]=yd(Z),pn[I]=Ue-Gc,gn[I]=Pu,Qs[I]=wc,Is[I]=cc,Cs[I]=ou,ro[I]=st.length>0?cc/st.length*100:0,bs[I]=Mu*100,zt[I]=Zu,Qt[I]=Sr*100,ho[I]=ql,Aa[I]=me,nr[I]=me-s,ri[I]=st.length>0?(Ue-Gc)/st.length:0,jo[I]=cc>0?Pu/cc:0,Na[I]=ou>0?-(wc/ou):0,ar[I]=st.length>0?zu/st.length:0;{const ye=[];for(const Se of it("long"))Se.qty<=1e-12||ye.push({side:"long",qty:Se.qty,entryIndex:Se.entryIndex,entryTimestamp:Se.entryTimestamp,entryPrice:Se.entryPrice,entryFee:Se.entryFee,entrySignalId:Se.entrySignalId,entryOrderId:Se.entryOrderId,entrySignalScore:Se.entrySignalScore??null,maxFav:Se.maxFav,maxAdv:Se.maxAdv});for(const Se of it("short"))Se.qty<=1e-12||ye.push({side:"short",qty:Se.qty,entryIndex:Se.entryIndex,entryTimestamp:Se.entryTimestamp,entryPrice:Se.entryPrice,entryFee:Se.entryFee,entrySignalId:Se.entrySignalId,entryOrderId:Se.entryOrderId,entrySignalScore:Se.entrySignalScore??null,maxFav:Se.maxFav,maxAdv:Se.maxAdv});ye.sort((Se,Ge)=>Ge.entryIndex-Se.entryIndex),hi[I]=ye}}if(t.closeOnEnd&&Tt()&&n.length){const I=va,W=n2(n[I]);if(W!=null){Lt("long")&&mi("long",I,W,"end","market"),Lt("short")&&mi("short",I,W,"end","market");const Z=sc(I,W);{const me=(Nt=n==null?void 0:n[I])==null?void 0:Nt.timestamp,Le=Number(me);Qe.push({index:I,timestamp:Number.isFinite(Le)&&Le>0?Le:Date.now(),equity:Z})}if(Z>Xl&&(Xl=Z),Xl>0){const me=(Xl-Z)/Xl;me>Mu&&(Mu=me);const Le=Xl-Z;Le>Zu&&(Zu=Le)}if(Number.isFinite(Z)){if(!Number.isFinite(xo)||Z<xo)xo=Z;else if(xo>0){const me=Z-xo;me>ql&&(ql=me);const Le=me/xo;Le>Sr&&(Sr=Le)}}const _e=Er("long")-Er("short");Yt[I]=_e,qn[I]=If(),Vn[I]=Pt("long")+Pt("short"),Dn[I]=st.length,Wn[I]=yd(W),pn[I]=Ue-Gc,gn[I]=Pu,Qs[I]=wc,Is[I]=cc,Cs[I]=ou,ro[I]=st.length>0?cc/st.length*100:0,bs[I]=Mu*100,zt[I]=Zu,Qt[I]=Sr*100,ho[I]=ql,Aa[I]=Z,nr[I]=Z-s,ri[I]=st.length>0?(Ue-Gc)/st.length:0,jo[I]=cc>0?Pu/cc:0,Na[I]=ou>0?-(wc/ou):0,ar[I]=st.length>0?zu/st.length:0,hi[I]=[]}if(vi.length){for(const Z of vi)Ce(Z.orderId,{status:"canceled",note:"Canceled on end"});vi.length=0}}const eu=Qe.length?Qe[Qe.length-1].equity:s,Ud=eu-s,qf=st.reduce((I,W)=>I+(W.pnl>0?W.pnl:0),0),Uf=st.reduce((I,W)=>I+(W.pnl<0?Math.abs(W.pnl):0),0),dd=st.filter(I=>I.pnl>0).length,Id=st.filter(I=>I.pnl<0).length,dc=st.length,Gf=dc?dd/dc*100:0,Pd=dc?Ud/dc:0,af=dd?qf/dd:0,ol=Id?-(Uf/Id):0,du=ol!==0?Math.abs(af/ol):af>0?1/0:0,Nu=dc>0?st.reduce((I,W)=>I+Math.max(0,W.exitIndex-W.entryIndex+1),0)/dc:0,hf=Wu>0?zc/Wu*100:0,td=[];{let I="",W=NaN,Z=0;for(const _e of Qe){const me=Number(_e.timestamp);if(!Number.isFinite(me)||me<=0)continue;const Le=new Date(me).toISOString().slice(0,10);I&&Le!==I&&Number.isFinite(W)&&td.push({ts:Z,eq:W}),I=Le,W=_e.equity,Z=me}I&&Number.isFinite(W)&&td.push({ts:Z,eq:W})}const Cc=[];for(let I=1;I<td.length;I++){const W=td[I-1].eq,Z=td[I].eq;Number.isFinite(W)&&W!==0&&Number.isFinite(Z)&&Cc.push((Z-W)/W)}const Gd=Cc.length?Cc.reduce((I,W)=>I+W,0)/Cc.length:0,tu=Cc.length>1?Cc.reduce((I,W)=>I+(W-Gd)**2,0)/(Cc.length-1):0,Vc=tu>0?Math.sqrt(tu):0,Yd=Cc.filter(I=>I<0),Md=Yd.length?Yd.reduce((I,W)=>I+W,0)/Yd.length:0,Au=Yd.length>1?Yd.reduce((I,W)=>I+(W-Md)**2,0)/(Yd.length-1):0,Kd=Au>0?Math.sqrt(Au):0,Hu=Vc>0?Gd/Vc*Math.sqrt(252):0,Tu=Kd>0?Gd/Kd*Math.sqrt(252):0,bd=Vc>0?Vc*Math.sqrt(252)*100:0,gc=Qe.length?Qe[0].equity:s,qu=Qe.length?Number(Qe[0].timestamp):NaN,$d=Qe.length?Number(Qe[Qe.length-1].timestamp):NaN,np=Number.isFinite(qu)&&Number.isFinite($d)&&$d>qu?($d-qu)/(365*864e5):0,Pf=gc>0?eu/gc:1,oe=np>0?Math.pow(Pf,1/np)-1:Pf-1,we=Mu>0?oe/Mu:oe>0?1/0:0,K=[];if(Qe.length){const I=Qe[0].index,W=n2(n[I])??NaN;if(Number.isFinite(W)&&W>0){const Z=s/W;for(let _e=ll;_e<=va;_e++){const me=n2(n[_e]);if(me==null||!Number.isFinite(me))continue;const Le=(E=n==null?void 0:n[_e])==null?void 0:E.timestamp,ye=Number(Le);K.push({index:_e,timestamp:Number.isFinite(ye)&&ye>0?ye:Date.now(),equity:Z*me})}}}const re=dc?dd/dc*af+Id/dc*ol:0;let ke=0,ee=0;{let I=0,W=0;for(const Z of st)Z.pnl>0?(I+=1,W=0,I>ke&&(ke=I)):Z.pnl<0&&(W+=1,I=0,W>ee&&(ee=W))}return{summary:{initialCapital:s,finalEquity:eu,netPnl:Ud,netPnlPct:s>0?Ud/s*100:0,grossProfit:qf,grossLoss:Uf,profitFactor:Uf>0?qf/Uf:qf>0?1/0:0,trades:dc,roundTrips:xt.length,wins:dd,losses:Id,winRate:Gf,maxDrawdownPct:Mu*100,maxDrawdownValue:Zu,feesPaid:et,avgTrade:Pd,avgWin:af,avgLoss:ol,payoffRatio:du,expectancy:re,maxConsecWins:ke,maxConsecLosses:ee,exposurePct:hf,maxRunupPct:Sr*100,maxRunupValue:ql,avgBarsInTrade:Nu,volatilityPct:bd,sharpe:Hu,sortino:Tu,calmar:we},trades:st,roundTrips:xt,orders:Je,equity:Qe,benchmark:K,series:{positionSize:Yt,positionAvgPrice:qn,openTrades:Vn,closedTrades:Dn,openProfit:Wn,closedProfit:pn,grossProfit:gn,grossLoss:Qs,winTrades:Is,lossTrades:Cs,winRate:ro,maxDrawdownPct:bs,maxDrawdownValue:zt,maxRunupPct:Qt,maxRunupValue:ho,avgTrade:ri,avgWin:jo,avgLoss:Na,avgBarsInTrade:ar,equity:Aa,netProfit:nr},accessors:{openTradesByBar:hi,closedTrades:st}}}function $b(n){return n.replace(/^"|"$/g,"").replace(/^'|'$/g,"")}function woe(n){const e={},t=/([A-Za-z_$][A-Za-z0-9_$]*)\s*:\s*("([^"\\]|\\.)*"|'([^'\\]|\\.)*'|[^\s]+)/g;let s;for(;s=t.exec(n);){const o=String(s[1]||"").toLowerCase(),r=String(s[2]||"");e[o]=r}return e}function koe(n){const e=r=>{let a=null,l=0;const c=g=>/[A-Za-z0-9_$]/.test(g),f=r.toLowerCase(),u=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let d=null;for(let g=0;g<r.length;g++){const w=r[g];if(a){w===a&&r[g-1]!=="\\"&&(a=null);continue}if(w==="'"||w==='"'){a=w;continue}if(w==="("){l+=1;continue}if(w===")"){l=Math.max(0,l-1);continue}if(!(l>0)&&!(g>0&&c(r[g-1])))for(const C of u){if(!f.startsWith(C.token,g))continue;const M=g+C.token.length;if(M<r.length&&c(r[M]))continue;let P=M;for(;P<r.length&&/\s/.test(r[P]);)P+=1;const T=r[P];if(!(T!=="="&&T!==":")){d={key:C.key,start:g,valueStart:P+1};break}}}if(!d)return null;const h=r.slice(0,d.start).replace(/[,;]+\s*$/,"").trim(),m=r.slice(d.valueStart).trim();return{key:d.key,when:h,value:m}};let t=n.trim(),s,o;for(let r=0;r<4;r++){const a=e(t);if(!a)break;t=a.when,a.key==="score"&&s==null&&(s=a.value),a.key==="cooldown"&&o==null&&(o=a.value)}return{when:t.trim(),scoreRaw:s,cooldownRaw:o}}function Soe(n,e,t){const s=n.trim();if(!s)throw new Error(`Line ${t}: score requires a numeric value`);const o=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[s],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&o.test(r)?Number(r):null,l=a??(o.test(s)?Number(s):null),c=u=>{switch(u.kind){case"NumberLiteral":return u.value;case"Identifier":{const d=e[u.name],h=typeof d=="number"?d:Number(d);return Number.isFinite(h)?h:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(u.operator!=="not")return null;const d=c(u.expr);return d==null?null:Number.isFinite(d)&&d!==0?0:1}case"BinaryExpression":{const d=c(u.left),h=c(u.right);if(d==null||h==null)return null;switch(u.operator){case"+":return d+h;case"-":return d-h;case"*":return d*h;case"/":return h===0?NaN:d/h;case"%":return h===0?NaN:d%h;case">":return Number.isFinite(d)&&Number.isFinite(h)&&d>h?1:0;case"<":return Number.isFinite(d)&&Number.isFinite(h)&&d<h?1:0;case">=":return Number.isFinite(d)&&Number.isFinite(h)&&d>=h?1:0;case"<=":return Number.isFinite(d)&&Number.isFinite(h)&&d<=h?1:0;case"==":return Number.isFinite(d)&&Number.isFinite(h)&&Math.abs(d-h)<1e-9?1:0;case"!=":return Number.isFinite(d)&&Number.isFinite(h)&&Math.abs(d-h)>=1e-9?1:0;case"and":return Number.isFinite(d)&&d!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(d)&&d!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const d=u.callee.toLowerCase();if(d==="iff"&&u.args.length===3){const w=c(u.args[0]);return w==null?null:c(w!==0?u.args[1]:u.args[2])}const h=u.args.map(w=>c(w));if(h.some(w=>w==null))return null;const m=h[0],g=h[1];switch(d){case"min":return Math.min(m,g);case"max":return Math.max(m,g);case"abs":return Math.abs(m);case"ceil":return Math.ceil(m);case"floor":return Math.floor(m);case"round":return Math.round(m);case"sqrt":return Math.sqrt(m);case"pow":return Math.pow(m,g);default:return null}}default:return null}};let f=l;if(f==null)try{const u=Ap(s);f=c(u)}catch{f=null}if(f==null||!Number.isFinite(f))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(!Number.isInteger(f))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(f<0||f>10)throw new Error(`Line ${t}: score must be in range 0..10`);return f}function Coe(n,e,t){const s=n.trim();if(!s)throw new Error(`Line ${t}: cooldown requires a numeric value`);const o=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[s],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&o.test(r)?Number(r):null,l=a??(o.test(s)?Number(s):null),c=u=>{switch(u.kind){case"NumberLiteral":return u.value;case"Identifier":{const d=e[u.name],h=typeof d=="number"?d:Number(d);return Number.isFinite(h)?h:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(u.operator!=="not")return null;const d=c(u.expr);return d==null?null:Number.isFinite(d)&&d!==0?0:1}case"BinaryExpression":{const d=c(u.left),h=c(u.right);if(d==null||h==null)return null;switch(u.operator){case"+":return d+h;case"-":return d-h;case"*":return d*h;case"/":return h===0?NaN:d/h;case"%":return h===0?NaN:d%h;case">":return Number.isFinite(d)&&Number.isFinite(h)&&d>h?1:0;case"<":return Number.isFinite(d)&&Number.isFinite(h)&&d<h?1:0;case">=":return Number.isFinite(d)&&Number.isFinite(h)&&d>=h?1:0;case"<=":return Number.isFinite(d)&&Number.isFinite(h)&&d<=h?1:0;case"==":return Number.isFinite(d)&&Number.isFinite(h)&&d===h?1:0;case"!=":return Number.isFinite(d)&&Number.isFinite(h)&&d!==h?1:0;case"and":return Number.isFinite(d)&&d!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(d)&&d!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const d=u.callee.toLowerCase();if(d==="iff"&&u.args.length===3){const w=c(u.args[0]);return w==null?null:c(w!==0?u.args[1]:u.args[2])}const h=u.args.map(w=>c(w));if(h.some(w=>w==null))return null;const m=h[0],g=h[1];switch(d){case"min":return Math.min(m,g);case"max":return Math.max(m,g);case"abs":return Math.abs(m);case"ceil":return Math.ceil(m);case"floor":return Math.floor(m);case"round":return Math.round(m);case"sqrt":return Math.sqrt(m);case"pow":return Math.pow(m,g);default:return null}}default:return null}};let f=l;if(f==null)try{const u=Ap(s);f=c(u)}catch{f=null}if(f==null||!Number.isFinite(f))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(!Number.isInteger(f))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(f<0)throw new Error(`Line ${t}: cooldown must be a non-negative integer`);return f}function t3(n){const e=String(n||"").split(/\n+/),t={},s=[],o=[],r=[],a=[],l={};for(let f=0;f<e.length;f++){const u=e[f],d=f+1,h=u.replace(/#.*$/,"").replace(/\/\/.*$/,"").trim();if(!h)continue;let m;if(m=h.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/),m){const g=m[1],w=m[2].trim(),C=Number(w);Number.isFinite(C)&&/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(w)?t[g]=C:w.startsWith('"')&&w.endsWith('"')||w.startsWith("'")&&w.endsWith("'")?t[g]=$b(w):s.push({name:g,expr:w});continue}if(m=h.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)\s*$/i),m){const g=m[1],w=koe(m[2]||"");if(!w.when)throw new Error(`Line ${d}: signal ... when requires a condition`);const C=w.when.trim();l[g.toLowerCase()]=C;const M=g.toLowerCase(),P=M==="top"?"entry_long":M==="bot"?"entry_short":M==="buy"?"entry_long":M==="sell"||M==="exit"?"exit_long":M,T=w.scoreRaw!=null?Soe(w.scoreRaw,t,d):null,N=w.cooldownRaw!=null?Coe(w.cooldownRaw,t,d):void 0;o.push({type:P,when:C,score:T,cooldownBars:N});continue}if(m=h.match(/^label\s+at\s+(top|bot)(?:\s+when\s*\((.+?)\))?\s+(.+)$/i),m){const g=m[1].toLowerCase(),w=(m[2]||"").trim(),C=m[3]||"",M=woe(C),P=M.text?$b(M.text):g==="top"?"▲":"▼",T=M.color||(g==="top"?"#f97316":"#3b82f6"),N=g==="top"?"above":"below",L=M.source?$b(M.source):g==="top"?"high":"low",O=M.shape?$b(M.shape):void 0,D=J=>s.some(le=>le.name.replace(/\s+/g,"_").toLowerCase()===J.replace(/\s+/g,"_").toLowerCase()),$=typeof t.WIN=="number"||typeof t.WIN=="string"&&Number.isFinite(Number(t.WIN)),z=g==="top"?D("hiwin")?"close == HIWIN":$?"close == highest(close, WIN)":"close < -1e20":D("lowin")?"close == LOWIN":$?"close == lowest(close, WIN)":"close < -1e20",pe={when:w||l[g]||z,text:P,color:T,position:N,source:L,shape:O};L==="high"||L==="low"?r.push(pe):a.push(pe);continue}}const c=[];return(r.length||o.length)&&c.push({pane:"main",plots:[],labels:r,levels:[],lines:[]}),a.length&&c.push({pane:"sub",plots:[],labels:a,levels:[],lines:[],min:0,max:100}),{params:t,series:s,signals:o,panes:c}}function Ioe(n,e,t,s){if(!ev("interactionV2"))return;const{endedId:o}=yw();o&&(x(e,""),x(t,"")),o&&s()}function Poe(n,e,t,s,o){i(e)&&t(),i(s)&&o()}function Moe(n,e,t,s,o,r,a,l){var c,f,u,d,h,m;i(e)&&(i(t)==="overlay"?i(s)&&i(s).startsWith(o)?(f=(c=i(r))==null?void 0:c.pasteOverlayFromClipboard)==null||f.call(c,i(s),i(e)):(d=(u=i(r))==null?void 0:u.pasteOverlayAtPixel)==null||d.call(u,i(e)):i(t)==="text"&&((m=(h=i(r))==null?void 0:h.pasteTextAtPixel)==null||m.call(h,i(a),i(e))),l())}function Noe(n,e,t,s){var o,r;i(e)&&((r=(o=i(t))==null?void 0:o.cloneOverlayById)==null||r.call(o,i(e)),s())}function Aoe(n,e,t,s){var o,r;i(e)&&((r=(o=i(t))==null?void 0:o.copyOverlayById)==null||r.call(o,i(e)),s())}function Toe(n,e,t,s){var o,r;i(e)&&((r=(o=i(t))==null?void 0:o.removeOverlayById)==null||r.call(o,i(e)),s())}function Foe(n,e,t){var s,o;(o=(s=i(e))==null?void 0:s.openChartSettings)==null||o.call(s),t()}function Loe(n,e,t){var s,o;(o=(s=i(e))==null?void 0:s.openLoadLayout)==null||o.call(s),t()}function Eoe(n,e,t){e(),t()}var $oe=(n,e,t)=>Fc(t(),Ao(e).clickChart+=1,Ao(e)),Doe=Me('<div class="duty-loading-overlay svelte-1ddlfai"><div class="loader-content svelte-1ddlfai"><div class="ai-minimal svelte-1ddlfai"><div class="brand-text svelte-1ddlfai">Duty AI</div> <span class="brand-shine svelte-1ddlfai"></span> <div class="orbit svelte-1ddlfai"><span class="o-dot o1 svelte-1ddlfai"></span><span class="o-dot o2 svelte-1ddlfai"></span></div> <div class="progress-line svelte-1ddlfai"><span class="dot svelte-1ddlfai"></span></div> <div class="tagline svelte-1ddlfai">Preparing data</div></div></div></div>'),Roe=n=>n.stopPropagation(),joe=Me('<div class="historical-loading-indicator svelte-1ddlfai"><div class="loading-spinner svelte-1ddlfai"></div> <span class="svelte-1ddlfai">Loading historical data...</span></div>'),Boe=(n,e,t,s)=>{var r,a,l,c;if(!i(e))return;(a=(r=i(t))==null?void 0:r.toggleOverlayManualLockById)==null||a.call(r,i(e));const o=(c=(l=i(t))==null?void 0:l.getOverlayLockInfo)==null?void 0:c.call(l,i(e));x(s,V(!!(o!=null&&o.manualLock)))},Ooe=ta('<path d="M8 10V7a4 4 0 0 1 8 0v3" class="svelte-1ddlfai"></path>'),zoe=ta('<path d="M8 10V7a4 4 0 0 1 7.5-2" class="svelte-1ddlfai"></path>'),Voe=Me('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="7" y="7" width="10" height="10" rx="2" class="svelte-1ddlfai"></rect><rect x="3" y="3" width="10" height="10" rx="2" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai">Clone</span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="-1 -1 26 26" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="9" y="9" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect><rect x="4" y="4" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai">Copy</span></button> <button class="action-btn lock-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="5" y="10" width="14" height="10" rx="2" class="svelte-1ddlfai"></rect><!></svg> <span class="svelte-1ddlfai"> </span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M4 7h16" class="svelte-1ddlfai"></path><path d="M9 7V4h6v3" class="svelte-1ddlfai"></path><path d="M6 7l1 13h10l1-13" class="svelte-1ddlfai"></path><path d="M10 11v6" class="svelte-1ddlfai"></path><path d="M14 11v6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Remove This Drawing</span></button>',1),Woe=Me('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M8 4h8l2 2v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" class="svelte-1ddlfai"></path><path d="M12 9v6" class="svelte-1ddlfai"></path><path d="m9 12 3 3 3-3" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Paste</span></button>'),Hoe=Me('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M4 7h16" class="svelte-1ddlfai"></path><path d="M9 7V4h6v3" class="svelte-1ddlfai"></path><path d="M6 7l1 13h10l1-13" class="svelte-1ddlfai"></path><path d="M10 11v6" class="svelte-1ddlfai"></path><path d="M14 11v6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai"> </span></button>'),qoe=Me('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M4 7h16" class="svelte-1ddlfai"></path><path d="M9 7V4h6v3" class="svelte-1ddlfai"></path><path d="M6 7l1 13h10l1-13" class="svelte-1ddlfai"></path><path d="M10 11v6" class="svelte-1ddlfai"></path><path d="M14 11v6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai"> </span></button>'),Uoe=Me('<button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="-2 -2 28 28" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M3 12a9 9 0 1 0 3-6.7" class="svelte-1ddlfai"></path><path d="M3 3v6h6" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Reset View</span></button> <button class="action-btn copy-btn svelte-1ddlfai"><svg viewBox="-1 -1 26 26" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="9" y="9" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect><rect x="4" y="4" width="11" height="11" rx="2" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai"> </span></button> <!> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><rect x="3" y="3" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect><rect x="14" y="3" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect><rect x="3" y="14" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect><rect x="14" y="14" width="7" height="7" rx="1" class="svelte-1ddlfai"></rect></svg> <span class="svelte-1ddlfai"> </span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="M12 3v12" class="svelte-1ddlfai"></path><path d="m7 10 5 5 5-5" class="svelte-1ddlfai"></path><path d="M5 21h14" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Load Layout</span></button> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="svelte-1ddlfai"><path d="m8 17-5-5 5-5" class="svelte-1ddlfai"></path><path d="m16 7 5 5-5 5" class="svelte-1ddlfai"></path></svg> <span class="svelte-1ddlfai">Script Studio</span></button> <!> <!> <button class="action-btn reset-btn svelte-1ddlfai"><svg viewBox="0 0 800 800" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1ddlfai"><g clip-path="url(#clip0_settings_menu)" class="svelte-1ddlfai"><path d="M287 733.333C270.734 733.237 254.941 727.855 242 717.999L173 666.666C157.077 654.251 146.512 636.211 143.474 616.25C140.437 596.289 145.158 575.922 156.667 559.333C162.756 550.341 166.627 540.033 167.959 529.255C169.292 518.477 168.049 507.537 164.334 497.333L162.334 491.999C159.746 482.763 155.017 474.267 148.53 467.201C142.044 460.135 133.982 454.699 125 451.333H119.667C100.196 444.785 84.0938 430.821 74.8572 412.473C65.6205 394.124 63.9949 372.873 70.3335 353.333L97.6669 266.666C100.183 256.625 104.815 247.237 111.254 239.131C117.693 231.026 125.789 224.389 135 219.666C143.579 215.246 152.965 212.613 162.59 211.925C172.216 211.238 181.881 212.51 191 215.666C200.93 219.008 211.525 219.874 221.865 218.189C232.206 216.505 241.978 212.32 250.334 205.999L254.667 202.666C262.23 196.631 268.343 188.976 272.554 180.265C276.765 171.554 278.968 162.008 279 152.333V144.333C278.911 123.937 286.882 104.332 301.178 89.7854C315.475 75.2391 334.939 66.9296 355.334 66.666H440.334C450.256 66.6928 460.076 68.6795 469.228 72.5121C478.381 76.3447 486.686 81.9478 493.667 88.9994C508.343 103.926 516.496 124.067 516.334 144.999V154.333C516.164 163.524 518.158 172.627 522.153 180.907C526.148 189.187 532.033 196.412 539.334 201.999L543 204.666C550.481 210.276 559.208 213.994 568.437 215.503C577.665 217.012 587.122 216.268 596 213.333L607.333 209.666C616.936 206.483 627.08 205.267 637.163 206.089C647.245 206.912 657.059 209.757 666.018 214.454C674.977 219.151 682.899 225.605 689.31 233.43C695.721 241.255 700.49 250.291 703.333 259.999L729.667 343.999C735.76 363.412 734.095 384.431 725.02 402.642C715.946 420.854 700.168 434.84 681 441.666L674.333 443.999C664.528 447.21 655.661 452.78 648.512 460.22C641.364 467.659 636.151 476.741 633.333 486.666C630.68 495.893 630.051 505.584 631.489 515.077C632.928 524.569 636.399 533.639 641.667 541.666L650.333 554.333C661.827 571.014 666.503 591.46 663.404 611.479C660.305 631.498 649.666 649.574 633.667 661.999L566.667 713.666C558.572 719.856 549.296 724.324 539.41 726.795C529.524 729.265 519.237 729.686 509.182 728.031C499.127 726.376 489.517 722.68 480.944 717.171C472.371 711.663 465.017 704.457 459.334 695.999L455.334 690.333C449.874 682.128 442.425 675.441 433.682 670.894C424.938 666.347 415.185 664.09 405.334 664.333C395.933 664.576 386.721 667.026 378.441 671.484C370.161 675.943 363.045 682.285 357.667 689.999L350 700.999C344.315 709.517 336.946 716.78 328.346 722.341C319.747 727.901 310.1 731.642 300 733.333C295.677 733.756 291.323 733.756 287 733.333ZM146.667 387.333C165.49 394.045 182.474 405.082 196.253 419.556C210.033 434.029 220.221 451.536 226 470.666V474.666C233.198 494.554 235.561 515.868 232.895 536.85C230.229 557.831 222.61 577.877 210.667 595.333C208.559 597.662 207.391 600.691 207.391 603.833C207.391 606.974 208.559 610.004 210.667 612.333L282.334 666.666C283.269 667.4 284.35 667.926 285.505 668.208C286.66 668.49 287.862 668.522 289.03 668.301C290.198 668.08 291.306 667.611 292.278 666.927C293.25 666.242 294.065 665.358 294.667 664.333L302.333 653.333C313.896 636.625 329.338 622.97 347.335 613.539C365.333 604.107 385.348 599.181 405.667 599.181C425.986 599.181 446.001 604.107 463.998 613.539C481.995 622.97 497.437 636.625 509 653.333L513 659.333C514.433 661.366 516.572 662.792 519 663.333C520.114 663.497 521.249 663.434 522.337 663.148C523.426 662.861 524.445 662.357 525.334 661.666L594 609.666C596.404 607.758 597.985 605.002 598.419 601.964C598.853 598.926 598.107 595.837 596.333 593.333L587.667 580.666C576.374 564.199 568.924 545.407 565.866 525.676C562.809 505.944 564.221 485.778 570 466.666C575.858 446.578 586.455 428.191 600.898 413.052C615.342 397.912 633.21 386.462 653 379.666L659.667 377.333C662.445 376.22 664.671 374.053 665.857 371.305C667.044 368.557 667.095 365.452 666 362.666L640 279.666C639.376 278.214 638.463 276.904 637.317 275.815C636.171 274.726 634.816 273.882 633.333 273.333C632.352 272.835 631.267 272.575 630.167 272.575C629.066 272.575 627.981 272.835 627 273.333L615.667 276.999C596.495 283.327 576.074 284.903 556.158 281.594C536.242 278.284 517.428 270.187 501.334 257.999L500 254.999C484.556 243.303 472.034 228.186 463.416 210.836C454.798 193.485 450.32 174.372 450.334 154.999V144.666C450.394 141.453 449.198 138.344 447 135.999C445.082 134.266 442.585 133.315 440 133.333H355.334C353.976 133.417 352.648 133.77 351.426 134.369C350.205 134.968 349.113 135.803 348.215 136.825C347.317 137.847 346.63 139.036 346.192 140.325C345.755 141.613 345.576 142.975 345.667 144.333V152.666C345.669 172.567 341.102 192.203 332.317 210.061C323.533 227.919 310.766 243.521 295 255.666L290.667 258.999C273.658 271.95 253.724 280.517 232.623 283.947C211.522 287.376 189.902 285.563 169.667 278.666C168.153 278.158 166.514 278.158 165 278.666C163.119 279.809 161.702 281.58 161 283.666L133.334 370.666C132.369 373.629 132.595 376.851 133.964 379.651C135.332 382.45 137.736 384.607 140.667 385.666L146.667 387.333Z" fill="currentColor" class="svelte-1ddlfai"></path><path d="M400 516.667C376.925 516.667 354.369 509.825 335.183 497.006C315.997 484.186 301.044 465.965 292.214 444.647C283.384 423.329 281.073 399.871 285.575 377.24C290.076 354.609 301.188 333.821 317.504 317.505C333.82 301.189 354.608 290.077 377.239 285.576C399.87 281.074 423.328 283.385 444.646 292.215C465.964 301.045 484.185 315.998 497.005 335.184C509.824 354.37 516.666 376.926 516.666 400.001C516.666 430.943 504.375 460.617 482.496 482.496C460.616 504.376 430.942 516.667 400 516.667ZM400 350.001C390.111 350.001 380.444 352.933 372.221 358.427C363.999 363.921 357.59 371.73 353.806 380.867C350.021 390.003 349.031 400.056 350.96 409.755C352.89 419.454 357.652 428.363 364.644 435.356C371.637 442.349 380.546 447.111 390.245 449.04C399.944 450.969 409.998 449.979 419.134 446.195C428.27 442.41 436.079 436.002 441.573 427.779C447.067 419.557 450 409.89 450 400.001C450 386.74 444.732 374.022 435.355 364.645C425.978 355.269 413.261 350.001 400 350.001Z" fill="currentColor" class="svelte-1ddlfai"></path></g><defs class="svelte-1ddlfai"><clipPath id="clip0_settings_menu" class="svelte-1ddlfai"><rect width="800" height="800" fill="white" class="svelte-1ddlfai"></rect></clipPath></defs></svg> <span class="svelte-1ddlfai">Settings</span></button>',1),Goe=Me('<div class="reset-menu svelte-1ddlfai"><!></div>'),Yoe=Me('<div class="duty-main svelte-1ddlfai"><div class="alerts-container svelte-1ddlfai"></div> <!> <div class="chart-container svelte-1ddlfai"><div class="chart-shell svelte-1ddlfai"><div class="duty-content svelte-1ddlfai"><div class="drawbar-host svelte-1ddlfai" style="width: var(--drawing-bar-width); overflow: hidden;"><!></div> <!> <div class="duty-widget svelte-1ddlfai" role="application" tabindex="0"><canvas class="script-webgl-layer svelte-1ddlfai"></canvas> <canvas class="script-overlay svelte-1ddlfai"></canvas> <canvas class="tool-overlay svelte-1ddlfai"></canvas></div> <!></div> <div><div class="dock-resize-handle svelte-1ddlfai" aria-label="Resize script dock"><div class="handle-bar svelte-1ddlfai"></div></div> <div class="dock-body svelte-1ddlfai"><!></div></div></div> <!></div> <!> <!> <!> <!> <!> <!> <!> <!></div>');function Koe(n,e){var Vv,ug,Wv,dg;Ld(e,!0);const t=tm(),s=()=>vl(D(),"$save",t),o=()=>vl(Te,"$chart",t),r=()=>vl(ih,"$simulator",t),a=()=>vl(O(),"$ctx",t),l=()=>vl(o3,"$page",t),c=()=>vl(B0,"$userPreferences",t),f=()=>vl($t,"$alerts",t),u=()=>vl(Wa,"$saveRestoring",t),d=()=>vl(hoe,"$scriptBacktests",t),h=()=>vl(Gse,"$scriptSignals",t),m=(...S)=>{},g=-10,w=(S,j,Q,ue,ie,De)=>{const ze=Math.max(0,Math.min(De,Math.min(ue,ie)/2));S.beginPath(),S.moveTo(j+ze,Q),S.lineTo(j+ue-ze,Q),S.quadraticCurveTo(j+ue,Q,j+ue,Q+ze),S.lineTo(j+ue,Q+ie-ze),S.quadraticCurveTo(j+ue,Q+ie,j+ue-ze,Q+ie),S.lineTo(j+ze,Q+ie),S.quadraticCurveTo(j,Q+ie,j,Q+ie-ze),S.lineTo(j,Q+ze),S.quadraticCurveTo(j,Q,j+ze,Q),S.closePath()},C=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch{return"UTC"}},M=S=>{if(!S)return S??null;const j=eS(S),Q={...S},ue=t1((S==null?void 0:S.session)||j.regular)||void 0,ie=t1((S==null?void 0:S.sessionExtended)||j.extended)||void 0;return!Q.session&&ue&&(Q.session=ue),!Q.sessionExtended&&ie&&(Q.sessionExtended=ie),!Q.timezone&&j.timezone&&(Q.timezone=j.timezone),!Q.sessionTimezone&&(Q.timezone||j.timezone)&&(Q.sessionTimezone=Q.timezone||j.timezone),Q};rk(C());function P(S){const Q=`${S??""}`.replace(/0[\{\(](\d+)[\}\)]/g,(ie,De)=>{const ze=Number(De);return!Number.isFinite(ze)||ze<=0?"0":"0".repeat(Math.min(50,Math.trunc(ze)))}),ue=(ie,De)=>{if(!Number.isFinite(ie)||ie===0)return`${ie}`;const ze=ie<0?"-":"",lt=Math.abs(ie),wt=Math.floor(Math.log10(lt))+1;let qt=lt/Math.pow(10,wt),sn=wt;const Ot=Number(qt.toFixed(De));return Ot>=1?(qt=Ot/10,sn=wt+1):qt=Ot,`${ze}${qt.toFixed(De)}e${sn}`};try{const ie=/^(-?)([\d,]+)(?:\.(\d+))?$/.exec(Q.trim());if(ie){const De=ie[1]||"",ze=ie[2]||"0",lt=ie[3]||"";if(ze.replace(/,/g,"").length>=5&&lt.length>2)return`${De}${ze}.${lt.slice(0,2).padEnd(2,"0")}`}}catch{}try{const ie=Ab(s().symbol);if(ie==="stock"||ie==="crypto"){const De=Number(Q.replace(/,/g,"").trim());if(Number.isFinite(De)){const ze=Math.abs(De);if(ze>0&&ze<1e-4)return ue(De,5)}}}catch{}return Q}const T=new nR;let N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},L=null;oE.forEach(S=>I3(S)),dE.forEach(S=>OI(S)),c$.forEach(S=>{S.extendData=="datafeed"&&(S.extendData=T),Z2(S)});let O=pi(e,"ctx",23,()=>Fm(new h4)),D=pi(e,"save",19,()=>Uw("chart",new Ob)),$=pi(e,"customLoad",3,!1);const z=5e3,te=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600},{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400},{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}],pe=`{
  "pane": "sub",
  "min": -2,
  "max": 2,
  "shortName": "Debug Area",
  "plots": [
    {
      "name": "AreaTest",
      "source": "close",
      "type": "area",
      "color": "rgba(129,140,248,0.4)",
      "width": 1
    }
  ]
}`;try{const S=sessionStorage.getItem("chart.tabId");S?Fc(D(),Ao(s).key=`chart:${S}`,Ao(s)):s().key||Fc(D(),Ao(s).key="chart",Ao(s))}catch{s().key||Fc(D(),Ao(s).key="chart",Ao(s))}try{const S=s()&&s().symbol&&typeof s().symbol=="object",j=s()&&s().period&&typeof s().period=="object";(!S||!j)&&D().set(new Ob)}catch{D().set(new Ob)}D().update(S=>{if(!(S.allExgs instanceof Set)){const j=Array.isArray(S.allExgs)?S.allExgs:[];S.allExgs=new Set(j)}return S});let J,le,de,he,ge=null,ae=null,Ie=null,ce=null,je=!1,Ve=null,We=[],He=null,Ue=[];const et=new Set;let ft=null,it=[],Lt=[],Tt=!1,Pt=!1,St=!1,st=xe(!1),xt=xe(!1),Je=xe(null),Xe=xe(!1),Be=xe(void 0),Qe=xe(null),ct=xe(void 0),Mt=xe(void 0),mt=xe(void 0),Ce=xe(void 0);const Te=Fm(null),It=500,$t=EC();let Yt=xe(!1),qn=xe(!1),Vn=xe(!1),Dn=xe(.35);const Wn=.2,pn=.6;let gn=xe(!1),Qs=0,Is=0,Cs=xe(pe),ro=xe(0),bs=xe(void 0),zt=xe("Ready"),Qt=xe(null),ho=xe(V([])),ri=xe(!1),jo=0,Na=new Set,ar="",Aa=null,nr=xe(!0),hi=!1;const Gc="SCRIPT_STUDIO";let Pu=[],wc=[],cc=xe(null),ou=xe("main"),zu=new Set;const ja="script-trade-focus",nc="script-order-focus",Bc=()=>{var Q;const S=((Q=s().options)==null?void 0:Q.datafeed)||{},j=M(s().symbol)||s().symbol;return{sessionMode:String(S.sessionMode||"regular"),adjustMode:String(S.adjustMode||"none"),timezone:String((j==null?void 0:j.timezone)||(j==null?void 0:j.sessionTimezone)||C())}};let Vu=[],rf=[];const co=(S,j)=>{const Q=typeof S=="number"?S:Number(S);if(!Number.isFinite(Q))return"-";try{return P(Q.toFixed(Math.max(0,Math.min(10,j))))}catch{return`${Q}`}},ll=S=>{const j=typeof S=="number"?S:Number(S);return!Number.isFinite(j)||j<=0?null:j<1e12?j*1e3:j};function va(){const S=o();if(S){try{for(const j of Vu)S.removeOverlay({id:j});Vu=[]}catch{}try{S.removeOverlay({groupId:ja})}catch{}}}function Vl(){const S=o();if(S){try{for(const j of rf)S.removeOverlay({id:j});rf=[]}catch{}try{S.removeOverlay({groupId:nc})}catch{}}}function kr(S){if(S==null)return;const j=String(S);j&&Vu.push(j)}function Wr(S){if(S==null)return;const j=String(S);j&&rf.push(j)}function jl(S){var Q;const j=o();if(!(!j||!S))try{const ue=((Q=j.getDataList)==null?void 0:Q.call(j))||[],ie=Math.max(0,Math.floor(Number(S.entryIndex)||0)),De=Math.max(0,Math.floor(Number(S.exitIndex)||0)),ze=ue[ie]||null,lt=ue[De]||null,wt=ll(S.entryTimestamp)??ll((ze==null?void 0:ze.timestamp)??(ze==null?void 0:ze.time))??null,qt=ll(S.exitTimestamp)??ll((lt==null?void 0:lt.timestamp)??(lt==null?void 0:lt.time))??null,sn=Number(S.entryPrice),Ot=Number(S.exitPrice);if(!Number.isFinite(sn)||!Number.isFinite(Ot)||wt==null||qt==null)return;va(),Vl();const vn=Number(S.netPnl)>=0,kn=vn?"#22c55e":"#ef4444",as=vn?"#16a34a":"#ef4444",Ls=vn?"#16a34a":"#f59e0b",Ys=Number(S.netPnl)||0,yn=Number(S.fees)||0,Vt=String(S.exitReason||"").replace(/_/g," "),Pn=j.createOverlay({name:"trade",paneId:"candle_pane",groupId:ja,lock:!1,visible:!0,points:[{timestamp:wt,value:sn},{timestamp:qt,value:Ot},{timestamp:qt,value:Ot}],extendData:{line_color:kn,in_color:as,out_color:Ls,in_text:`ENTRY ${String(S.side||"").toUpperCase()} @ ${co(sn,6)}`,out_text:`EXIT @ ${co(Ot,6)} • ${Vt||"signal"} • Net ${Ys>=0?"+":""}${co(Ys,2)} • Fees ${co(yn,2)}`,selected:!1,active:!1,distance:18}});kr(Pn);try{const Hn=j.createOverlay({name:"note",paneId:"candle_pane",groupId:ja,lock:!1,visible:!0,points:[{timestamp:wt,value:sn},{timestamp:wt,value:sn}],extendData:{line_color:"transparent",in_color:as,in_text:`ENTRY ${String(S.side||"").toUpperCase()} @ ${co(sn,6)}`,out_color:as,out_text:"",distance:24,offsetX:-70,align:"right"}});kr(Hn);const Tn=j.createOverlay({name:"note",paneId:"candle_pane",groupId:ja,lock:!1,visible:!0,points:[{timestamp:qt,value:Ot},{timestamp:qt,value:Ot}],extendData:{line_color:"transparent",in_color:Ls,in_text:`EXIT @ ${co(Ot,6)} • ${Vt||"signal"} • Net ${Ys>=0?"+":""}${co(Ys,2)} • Fees ${co(yn,2)}`,out_color:Ls,out_text:"",distance:24,offsetX:70,align:"left"}});kr(Tn)}catch{}try{j.scrollToDataIndex(De,0)}catch{try{j.scrollToTimestamp(qt,0)}catch{}}}catch(ue){console.error("[ScriptStudio] focus trade failed",ue)}}function Xl(S){var Q;const j=o();if(!(!j||!S))try{const ue=((Q=j.getDataList)==null?void 0:Q.call(j))||[],ie=Number(S.filledIndex),De=Number(S.createdIndex),ze=Number.isFinite(ie)?Math.max(0,Math.floor(ie)):Number.isFinite(De)?Math.max(0,Math.floor(De)):null,lt=ze!=null?ue[ze]:null,wt=ll(S.filledTimestamp)??ll(S.createdTimestamp)??ll((lt==null?void 0:lt.timestamp)??(lt==null?void 0:lt.time))??null,qt=Number.isFinite(Number(S.fillPrice))?Number(S.fillPrice):Number.isFinite(Number(S.stopPrice))?Number(S.stopPrice):Number.isFinite(Number(S.limitPrice))?Number(S.limitPrice):Number.isFinite(Number(S.price))?Number(S.price):NaN;if(!Number.isFinite(qt)||wt==null)return;Vl(),va();const sn=String(S.action||"").toLowerCase(),Ot=String(S.side||"").toLowerCase(),as=sn==="entry"?Ot==="short"?"#ef4444":"#16a34a":sn==="exit"?"#f59e0b":"#64748b",Ls=String(S.kindLabel||S.kind||"").toUpperCase(),Ys=String(S.statusLabel||S.status||"").replace(/_/g," ").trim(),yn=`ORDER ${Ls}${Ot?` ${Ot.toUpperCase()}`:""}${Ys?` • ${Ys}`:""}`,Vt=j.createOverlay({name:"horizontalStraightLine",paneId:"candle_pane",groupId:nc,lock:!1,visible:!0,points:[{timestamp:wt,value:qt},{timestamp:wt,value:qt}],extendData:{showDot:!0,interactive:!1},styles:{line:{color:as,size:1,style:"dashed"}}});Wr(Vt);const Pn=j.createOverlay({name:"note",paneId:"candle_pane",groupId:nc,lock:!1,visible:!0,points:[{timestamp:wt,value:qt},{timestamp:wt,value:qt}],extendData:{line_color:as,in_color:as,in_text:yn,distance:24,offsetX:-70,align:"right"}});Wr(Pn),ze!=null?j.scrollToDataIndex(ze,0):j.scrollToTimestamp(wt,0)}catch(ue){console.error("[ScriptStudio] focus order failed",ue)}}function Mu(S){const j=o();if(!j)return!1;const Q=Math.max(0,Math.floor(Number(S)||0));try{return j.scrollToDataIndex(Q,0),!0}catch(ue){return console.error("[ScriptStudio] focus index failed",ue),!1}}function Zu(S){const j=o();if(!j)return!1;const Q=Math.floor(Number(S)||0);if(!Number.isFinite(Q)||Q<=0)return!1;try{return j.scrollToTimestamp(Q,0),!0}catch(ue){return console.error("[ScriptStudio] focus timestamp failed",ue),!1}}let xo=new Map;const Sr=new Set;let ql=null,$f=null;const Cf={solid:vt.Solid,dashed:vt.Dashed,dotted:vt.Dashed,arrow_left:vt.Solid,arrow_right:vt.Solid,arrow_both:vt.Solid,arrow_none:vt.Solid};let tp={};const mf=new Map,sc=new Map,yd=S=>{if(!S)return 0;let j=2166136261;for(let ue=0;ue<S.length;(ue+=1)-1)j^=S.charCodeAt(ue),j=Math.imul(j,16777619);const Q=j>>>0;return Q===0?1:Q},If=S=>{const j=String(S||"");let Q="",ue=0;for(;ue<j.length;){const ie=j[ue];if(ie==='"'||ie==="'"){const De=ie;ue+=1;let ze="",lt=!1;for(;ue<j.length;){const wt=j[ue];if(lt){ze+=wt,lt=!1,ue+=1;continue}if(wt==="\\"){lt=!0,ue+=1;continue}if(wt===De){ue+=1;break}ze+=wt,ue+=1}Q+=String(yd(ze));continue}Q+=ie,ue+=1}return Q};function En(S){let j=String(S||"").trim();return j=j.replace(/\$\{([^}]+)\}/g,(Q,ue)=>{const ie=tp[String(ue)];if(ie==null)return Q;if(typeof ie=="number"&&Number.isFinite(ie)||typeof ie=="string")return String(ie);try{return JSON.stringify(ie)}catch{return String(ie)}}),j=i6(j).replace(/#.*$/,""),j=j.split(";")[0],j=j.replace(/,\s*$/,""),j=j.replace(/\b(and|or)\b\s*$/i,""),j=j.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),j=j.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),j=j.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(Q,ue,ie)=>`${String(ue).toLowerCase()}_${ie}`),j=j.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),j=j.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),hi?(j=j.replace(/\bstr\./gi,""),j=Z_(j,{pineV2:!0}).expr,j=Qb(j),j.trim()):(j=j.replace(/\bta\./gi,""),j=j.replace(/\bmath\./gi,""),j=j.replace(/\bstr\./gi,""),j=If(j),j=Qb(j),j.trim())}function ms(S){const j=String(S||"");let Q="",ue=null,ie=0;const De=lt=>/[A-Za-z_$]/.test(lt),ze=lt=>/[A-Za-z0-9_$]/.test(lt);for(;ie<j.length;){const lt=j[ie];if(ue){Q+=lt,lt===ue&&j[ie-1]!=="\\"&&(ue=null),ie+=1;continue}if(lt==="'"||lt==='"'){ue=lt,Q+=lt,ie+=1;continue}if(De(lt)){let wt=ie+1;for(;wt<j.length&&ze(j[wt]);)wt+=1;const qt=j.slice(ie,wt);let sn=wt;for(;sn<j.length&&/\s/.test(j[sn]);)sn+=1;if(j[sn]==="["){let Ot=sn+1;for(;Ot<j.length&&/\s/.test(j[Ot]);)Ot+=1;let vn=1;j[Ot]==="-"&&(vn=-1,Ot+=1);let kn=Ot;for(;kn<j.length&&/[0-9]/.test(j[kn]);)kn+=1;const as=j.slice(Ot,kn);for(;kn<j.length&&/\s/.test(j[kn]);)kn+=1;if(as&&j[kn]==="]"){const Ls=vn*Number(as);if(Number.isFinite(Ls)&&Ls>=1){Q+=`prev(${qt}, ${Math.floor(Ls)})`,ie=kn+1;continue}if(Number.isFinite(Ls)&&Ls===0){Q+=qt,ie=kn+1;continue}}}Q+=qt,ie=wt;continue}Q+=lt,ie+=1}return Q}function js(S){let j=String(S||"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_");return hi?(j=j.replace(/\bstr\./g,""),Z_(j,{pineV2:!0}).expr):(j=j.replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(Q,ue,ie)=>`${String(ue).toLowerCase()}_${ie}`),j=If(j),ms(j))}function Nn(S){let j=String(S||"").replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(Q,ue,ie)=>`${String(ue).toLowerCase()}_${ie}`);return ms(j)}let Io=!1,fo=xe(!1),Ji=xe(!1),Gi=xe(null),Al=!0,Ii=null,Wo=!1,To=0,Ba=null,Pi=xe(!1),qs=null,mi=0;function Er(){return mi+=1,mi}let Za=null,vi=null,$r=null,Il=null,cl=null,kc=null,uc=null,Tl=null,ur=!1,la=null;const Fl=()=>{o()&&(Za&&(clearTimeout(Za),Za=null),vi&&(cancelAnimationFrame(vi),vi=null),vi=requestAnimationFrame(()=>{vi=null,gl.requestKey("window-resize:stage1",()=>{if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=up(s().theme);wn.merge(S,p0(s().styles)),o().setStyles(qd(S)),Oi(),Ll(),Pd()})}),Za=setTimeout(()=>{Za=null,gl.requestKey("window-resize:stage2",()=>{var Q,ue,ie,De,ze,lt,wt,qt,sn;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=up(s().theme);if(wn.merge(S,p0(s().styles)),o().setStyles(qd(S)),Oi(),Ll(),Pd(),am()){const Ot=o(),vn=((ue=(Q=Ot.getSize)==null?void 0:Q.call(Ot))==null?void 0:ue.height)??(J==null?void 0:J.clientHeight)??((ie=J==null?void 0:J.getBoundingClientRect)==null?void 0:ie.call(J).height)??0,kn=((ze=(De=Ot.getSize)==null?void 0:De.call(Ot))==null?void 0:ze.width)??(J==null?void 0:J.clientWidth)??((lt=J==null?void 0:J.getBoundingClientRect)==null?void 0:lt.call(J).width)??0,as=kn>0&&vn>0&&kn>vn;if($r===null||$r!==as){$r=as;try{const Ls=(wt=Ot.getPaneOptions)==null?void 0:wt.call(Ot);if(Array.isArray(Ls)&&vn>0){const yn=Math.round(vn*(as?.3:.25));Ls.forEach(Vt=>{var Hn;const Pn=Vt==null?void 0:Vt.id;Pn&&(Pn==="candle_pane"||Pn==="x_axis_pane"||Vt!=null&&Vt.state&&Vt.state!=="normal"||(Hn=Ot.setPaneOptions)==null||Hn.call(Ot,{id:Pn,height:yn}))})}}catch{}}}const j=(sn=(qt=o()).getVisibleRange)==null?void 0:sn.call(qt);j&&typeof j.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(j.to,0)},30)})},160))};function Oa(S){const j=(S==null?void 0:S.ticker)||(S==null?void 0:S.symbol);if(j)return`https://s3-api.bayah.app/cdn/symbol/logo/${j}.svg`}function ni(S){if(!S)return S;const j=Oa(S);return S.logo&&S.logo2?S:{...S,logo:S.logo||S.logo2||j,logo2:S.logo2}}const vc=f6(),gl=B2(),za=new p6("global-chart",Te,s().theme||"dark");let sl=null,Oc=null,Va=null;const Wa=Fm(!1);I0("ctx",O()),I0("save",D()),I0("chart",Te),I0("alerts",$t),I0("datafeed",T),I0("renderIntegration",vc),I0("globalThemeManager",za),I0("drawingManager",{get:()=>sl}),I0("saveRestoring",Wa);function uu(S){const j=S.match(/WIN\s*=\s*(\d+)/i),Q=Math.max(2,Math.min(500,j&&parseInt(j[1],10)||5)),ue=S.match(/label\s+at\s+top\s+text:\s*\"?([^\"\n]+)\"?/i),ie=S.match(/label\s+at\s+bot\s+text:\s*\"?([^\"\n]+)\"?/i),De=S.match(/label\s+at\s+top.*color:\s*([#a-zA-Z0-9]+)/i),ze=S.match(/label\s+at\s+bot.*color:\s*([#a-zA-Z0-9]+)/i),lt=((ue==null?void 0:ue[1])||"▲").trim(),wt=((ie==null?void 0:ie[1])||"▼").trim(),qt=((De==null?void 0:De[1])||"#f97316").trim(),sn=((ze==null?void 0:ze[1])||"#3b82f6").trim();if(!lt||!wt)throw new Error("Script is missing label text for top/bot.");return{window:Q,topText:lt,botText:wt,topColor:qt,botColor:sn}}function ud(S,j){return{name:j,shortName:"Script",precision:4,zLevel:10,calcParams:[S.window],figures:[{key:"hi",title:`HI(${S.window})`,type:"line"},{key:"lo",title:`LO(${S.window})`,type:"line"}],styles:{lines:[{color:"rgba(0,0,0,0)",size:1e-4,style:vt.Solid},{color:"rgba(0,0,0,0)",size:1e-4,style:vt.Solid}]},shouldOhlc:!0,calc:(Q,ue)=>{var lt;const ie=Math.max(2,Math.min(500,((lt=ue.calcParams)==null?void 0:lt[0])||S.window||5)),De=Math.max(2,Math.floor(ie/2)),ze=[];for(let wt=0;wt<Q.length;(wt+=1)-1){const qt=Q[wt].high??Q[wt].close,sn=Q[wt].low??Q[wt].close;let Ot,vn,kn=!1,as=!1;if(wt>=De&&wt<=Q.length-De-1){const Ls=wt-De,Ys=wt+De;let yn=-1/0,Vt=1/0;for(let bn=Ls;bn<=Ys;(bn+=1)-1){const In=Q[bn].high??Q[bn].close,Hs=Q[bn].low??Q[bn].close;In>yn&&(yn=In),Hs<Vt&&(Vt=Hs)}Ot=yn,vn=Vt;const Pn=Math.max(1e-8,Math.abs(qt||sn||1)*1e-4);let Hn=-1,Tn=-1;for(let bn=Ls;bn<=Ys;(bn+=1)-1){const In=Q[bn].high??Q[bn].close,Hs=Q[bn].low??Q[bn].close;if(Hn===-1&&Math.abs(In-yn)<=Pn&&(Hn=bn),Tn===-1&&Math.abs(Hs-Vt)<=Pn&&(Tn=bn),Hn!==-1&&Tn!==-1)break}kn=Math.abs(qt-yn)<=Pn&&wt===Hn,as=Math.abs(sn-Vt)<=Pn&&wt===Tn}ze.push({hi:Ot,lo:vn,high:qt,low:sn,topSignal:kn,botSignal:as})}return ze},draw:({ctx:Q,indicator:ue,xAxis:ie,yAxis:De,bounding:ze})=>{if(!Q||!ie||!De)return!1;const lt=(ue==null?void 0:ue.result)||[];Q.save(),ze&&(Q.beginPath(),Q.rect(0,0,ze.width,ze.height),Q.clip()),Q.textAlign="center",Q.textBaseline="middle",Q.font='12px "Inter", "SF Pro", system-ui, -apple-system, sans-serif';for(let wt=0;wt<lt.length;(wt+=1)-1){const qt=lt[wt];if(!qt)continue;const sn=ie.convertToPixel(wt);if(qt.topSignal&&qt.hi!==void 0){const Ot=De.convertToPixel(qt.hi);if(Number.isFinite(Ot)){const vn=Ot-8;Q.fillStyle=S.topColor,Q.strokeStyle="rgba(0,0,0,0.35)",Q.lineWidth=1,Q.textBaseline="middle",Q.fillText(S.topText,sn,vn),Q.strokeText(S.topText,sn,vn),Q.beginPath(),Q.arc(sn,vn-8,3.5,0,Math.PI*2),Q.fill(),Q.stroke()}}if(qt.botSignal&&qt.lo!==void 0){const Ot=De.convertToPixel(qt.lo);if(Number.isFinite(Ot)){const vn=Ot+8;Q.fillStyle=S.botColor,Q.strokeStyle="rgba(0,0,0,0.35)",Q.lineWidth=1,Q.textBaseline="middle",Q.fillText(S.botText,sn,vn),Q.strokeText(S.botText,sn,vn),Q.beginPath(),Q.arc(sn,vn+8,3.5,0,Math.PI*2),Q.fill(),Q.stroke()}}}return Q.restore(),!0}}}function Ll(){if(!J)return;const S=J.getBoundingClientRect(),j=typeof window<"u"?Math.max(1,window.devicePixelRatio||1):1,Q=De=>{if(!De)return;De.style.width=`${S.width}px`,De.style.height=`${S.height}px`,De.width=Math.floor(S.width*j),De.height=Math.floor(S.height*j);const ze=De.getContext("2d");ze&&ze.setTransform(j,0,0,j,0,0)},ue=De=>{De&&(De.style.width=`${S.width}px`,De.style.height=`${S.height}px`,De.width=Math.floor(S.width*j),De.height=Math.floor(S.height*j))};Q(le),Q(he),ue(de),ge=le==null?void 0:le.getContext("2d"),Ve=he==null?void 0:he.getContext("2d"),(ev("webglRuntimeDrawV1")||je)&&de?(ae||(ae=Qse(de)),!Ie&&ae&&(Ie=new aoe(ae)),!ce&&ae&&(ce=new moe(ae)),ae==null||ae.resize(S.width,S.height,j)):ae&&(ae.destroy(),ae=null,Ie&&(Ie.destroy(),Ie=null),ce&&(ce.destroy(),ce=null))}const vu=()=>{if(Pt||St){it=[],Lt=[];return}Tt||(Tt=!0,gl.request(()=>{if(Tt=!1,!ae){it=[],Lt=[];return}const S=it,j=Lt;it=[],Lt=[];const Q=S.length>0,ue=j.length>0;if(!Q&&!ue){Ie==null||Ie.clear(),ce==null||ce.clear();return}if(Ie&&Q?Ie.render(S,{clear:!0}):Ie&&Ie.clear(),ce&&ue){const ie=!Q;ce.render(j,{clear:ie})}}))},Sc=()=>{ae&&(Ie==null||Ie.clear(),ce==null||ce.clear())},Ja=S=>{const{runtimeHeatmaps:j,bounds:Q,xAxis:ue,yAxis:ie,offsetX:De,offsetY:ze,drawConfigMeta:lt,len:wt,tsIndex:qt,timeSeriesMs:sn,avgIntervalMs:Ot}=S;if(!j.length)return[];const vn=(yn,Vt,Pn)=>{var Hn,Tn,bn;return Ok({xVal:yn,xloc:Vt,len:wt,timeSeriesMs:sn,tsIndex:qt,config:{mode:((Hn=lt==null?void 0:lt.time)==null?void 0:Hn.mode)||"nearest",toleranceBars:Number.isFinite((Tn=lt==null?void 0:lt.time)==null?void 0:Tn.toleranceBars)?Math.max(0,Math.floor(lt.time.toleranceBars)):0,toleranceMs:Number.isFinite((bn=lt==null?void 0:lt.time)==null?void 0:bn.toleranceMs)?Math.max(0,Math.floor(lt.time.toleranceMs)):0,futureBars:Number.isFinite(lt==null?void 0:lt.futureBars)?Math.max(0,Math.floor(lt.futureBars)):0,avgIntervalMs:Ot,strictXloc:!1},meta:Pn})},kn={background:0,main:1,overlay:2,ui:3},as=(()=>{const yn=Hs=>{var jn;const Xt=(jn=ue==null?void 0:ue.convertToPixel)==null?void 0:jn.call(ue,Hs);return Number.isFinite(Xt)?Math.round(Xt):0},Vt=Hs=>{var jn;const Xt=(jn=ie==null?void 0:ie.convertToPixel)==null?void 0:jn.call(ie,Hs);return Number.isFinite(Xt)?Math.round(Xt):0},Pn=yn(0),Hn=yn(Math.max(0,wt-1)),Tn=wt>1?yn(1)-yn(0):0,bn=Vt(0),In=Vt(1);return`${Pn}:${Hn}:${Tn}:${bn}:${In}:${Math.round(Q.width)}:${Math.round(Q.height)}`})(),Ls=j.map((yn,Vt)=>{const Pn=String((yn==null?void 0:yn.layer)||"main").toLowerCase(),Hn=kn[Pn]??kn.main,Tn=yn==null?void 0:yn.zIndex,bn=Number.isFinite(Number(Tn))?Number(Tn):0;return{hm:yn,idx:Vt,layer:Hn,zIndex:bn}}).sort((yn,Vt)=>yn.layer-Vt.layer||yn.zIndex-Vt.zIndex||yn.idx-Vt.idx),Ys=[];for(const yn of Ls){const Vt=yn.hm;if(!Vt)continue;const Pn=Array.isArray(Vt.points)?Vt.points:[];if(!Pn.length)continue;const Hn=Vt.xloc??"bar_index";if((Vt.yloc??"price")!=="price")continue;const bn=[];for(const Hs of Pn){const Xt=Number(Hs==null?void 0:Hs.x),jn=Number(Hs==null?void 0:Hs.y),Jn=Number(Hs==null?void 0:Hs.value);if(!Number.isFinite(Xt)||!Number.isFinite(jn)||!Number.isFinite(Jn))continue;const Kt=vn(Xt,Hn,{kind:"heatmap",id:Vt.id??"heatmap"});if(Kt==null)continue;const Zt=ue.convertToPixel(Kt),an=ie.convertToPixel(jn);!Number.isFinite(Zt)||!Number.isFinite(an)||bn.push({x:Zt+De,y:an+ze,value:Jn})}if(!bn.length)continue;const In=Vt.id??`heatmap_${yn.idx+1}`;Ys.push({id:In,bounds:Q,points:bn,opacity:Vt.opacity,colormap:Vt.colormap,blend:Vt.blend,xBinPx:Vt.xBinPx,yBinPx:Vt.yBinPx,minValue:Vt.minValue,maxValue:Vt.maxValue,agg:Vt.agg,version:Vt.version,viewKey:as})}return Ys},ga=S=>{const{runtimeLineDefs:j,runtimeLineFills:Q,runtimePolylineDefs:ue,runtimePolygonDefs:ie,runtimePathDefs:De,xAxis:ze,yAxis:lt,offsetX:wt,offsetY:qt,fromIndex:sn,toIndex:Ot,len:vn}=S,kn=[],as=(Vt,Pn)=>{const Hn=ze.convertToPixel(Vt),Tn=lt.convertToPixel(Pn);return!Number.isFinite(Hn)||!Number.isFinite(Tn)?null:{x:Hn+wt,y:Tn+qt}},Ls=Vt=>{let Pn=NaN,Hn=NaN,Tn=NaN,bn=NaN;if(Vt.strictExtend){const In=typeof lt.getRange=="function"?lt.getRange():null,Hs=bb({startIndex:Vt.startIndex,endIndex:Vt.endIndex,startValue:Vt.startValue,endValue:Vt.endValue,slope:Vt.slope,intercept:Vt.intercept,extend:Vt.extend,fromIndex:sn,toIndex:Ot,yRange:In,toX:Xt=>ze.convertToPixel(Xt),toY:Xt=>lt.convertToPixel(Xt)});if(!Hs)return null;Pn=Hs.extended.x1,Hn=Hs.extended.y1,Tn=Hs.extended.x2,bn=Hs.extended.y2}else{let In=Vt.startIndex,Hs=Vt.endIndex;Vt.extend==="both"?(In=0,Hs=Math.max(0,vn-1)):Vt.extend==="left"?In=0:Vt.extend==="right"&&(Hs=Math.max(0,vn-1));const Xt=Number.isFinite(Vt.slope)&&Number.isFinite(Vt.intercept)?Vt.slope*In+Vt.intercept:Vt.startValue,jn=Number.isFinite(Vt.slope)&&Number.isFinite(Vt.intercept)?Vt.slope*Hs+Vt.intercept:Vt.endValue;Pn=ze.convertToPixel(In),Hn=lt.convertToPixel(Xt),Tn=ze.convertToPixel(Hs),bn=lt.convertToPixel(jn)}return!Number.isFinite(Pn)||!Number.isFinite(Hn)||!Number.isFinite(Tn)||!Number.isFinite(bn)?null:{a:{x:Pn+wt,y:Hn+qt},b:{x:Tn+wt,y:bn+qt}}};for(const Vt of j){if(!Vt)continue;const Pn=String(Vt.style||"solid").toLowerCase();if(Pn.includes("arrow"))continue;const Hn=Ls(Vt);Hn&&kn.push({kind:"line",points:[Hn.a,Hn.b],color:Vt.color,width:Vt.width,style:Pn,opacity:Vt.opacity})}for(const Vt of ue){if(!(Vt!=null&&Vt.points)||Vt.points.length<2)continue;const Pn=Math.min(...Vt.points.map(bn=>bn.index));if(Math.max(...Vt.points.map(bn=>bn.index))<sn-2||Pn>Ot+2)continue;const Tn=[];for(const bn of Vt.points){const In=as(bn.index,bn.value);In&&Tn.push(In)}Tn.length<2||kn.push({kind:"polyline",points:Tn,color:Vt.color,width:Vt.width,style:Vt.style,opacity:Vt.opacity})}for(const Vt of ie){if(!(Vt!=null&&Vt.points)||Vt.points.length<3)continue;const Pn=Math.min(...Vt.points.map(bn=>bn.index));if(Math.max(...Vt.points.map(bn=>bn.index))<sn-2||Pn>Ot+2)continue;const Tn=[];for(const bn of Vt.points){const In=as(bn.index,bn.value);In&&Tn.push(In)}Tn.length<3||kn.push({kind:"polygon",points:Tn,fillColor:Vt.fillColor,strokeColor:Vt.strokeColor,strokeWidth:Vt.strokeWidth,strokeStyle:Vt.strokeStyle,opacity:Vt.opacity})}for(const Vt of De){if(!(Vt!=null&&Vt.commands)||!Vt.commands.length)continue;const Pn=[];for(const Hn of Vt.commands){const Tn=as(Hn.index,Hn.value);Tn&&(Hn.cmd==="M"||Hn.cmd==="L")&&Pn.push({cmd:Hn.cmd,x:Tn.x,y:Tn.y})}Pn.length&&kn.push({kind:"path",commands:Pn,color:Vt.color,width:Vt.width,style:Vt.style,opacity:Vt.opacity})}const Ys=Vt=>{let Pn=Number(Vt==null?void 0:Vt.startIndex),Hn=Number(Vt==null?void 0:Vt.endIndex);if(!Number.isFinite(Pn)||!Number.isFinite(Hn))return null;if(Pn>Hn){const bn=Pn;Pn=Hn,Hn=bn}const Tn=String((Vt==null?void 0:Vt.extend)||"").toLowerCase();return Tn==="both"?(Pn=0,Hn=Math.max(0,vn-1)):Tn==="left"?Pn=0:Tn==="right"&&(Hn=Math.max(0,vn-1)),{a:Pn,b:Hn}},yn=(Vt,Pn)=>Number.isFinite(Vt==null?void 0:Vt.slope)&&Number.isFinite(Vt==null?void 0:Vt.intercept)?Vt.slope*Pn+Vt.intercept:Number.isFinite(Vt==null?void 0:Vt.startValue)?Vt.startValue:Number.NaN;for(const Vt of Q){const Pn=Vt==null?void 0:Vt.line1,Hn=Vt==null?void 0:Vt.line2;if(!Pn||!Hn)continue;const Tn=Ys(Pn),bn=Ys(Hn);if(!Tn||!bn)continue;const In=Math.max(sn,Tn.a,bn.a),Hs=Math.min(Ot,Tn.b,bn.b);if(In>Hs)continue;const Xt=[],jn=[];for(let Jn=In;Jn<=Hs;(Jn+=1)-1){const Kt=yn(Pn,Jn),Zt=yn(Hn,Jn);if(!Number.isFinite(Kt)||!Number.isFinite(Zt))continue;const an=as(Jn,Kt),rs=as(Jn,Zt);!an||!rs||(Xt.push(an),jn.push(rs))}if(Xt.length>1&&jn.length>1){const Jn=Xt.concat(jn.reverse());kn.push({kind:"polygon",points:Jn,fillColor:Vt.color||"rgba(59,130,246,0.15)",opacity:Vt.opacity})}}return kn},Wu=()=>{ae&&Ue.length&&(Pt||(Pt=!0,requestAnimationFrame(()=>{var S,j,Q,ue;Pt=!1,St=!0;try{const ie=o();if(!ie)return;const De=(Q=(S=ie.getXAxisPane)==null?void 0:(j=S.call(ie)).getAxisComponent)==null?void 0:Q.call(j);if(!De)return;const ze=zc(),lt=[],wt=[],qt=!!(ae!=null&&ae.isWebgl&&ce);for(const sn of Ue){const Ot=(ue=sn.def)==null?void 0:ue.__lastResult;if(!Ot)continue;const vn=Array.isArray(Ot)?Ot:Array.isArray(Ot==null?void 0:Ot.__rows)?Ot.__rows:[],kn=Number.isFinite(Ot==null?void 0:Ot.__len)?Number(Ot.__len):vn.length,as=Array.isArray(Ot==null?void 0:Ot.__runtimeHeatmaps)?Ot.__runtimeHeatmaps:[],Ls=Array.isArray(Ot==null?void 0:Ot.__runtimeLineDefs)?Ot.__runtimeLineDefs:[],Ys=Array.isArray(Ot==null?void 0:Ot.__runtimeLineFills)?Ot.__runtimeLineFills:[],yn=Array.isArray(Ot==null?void 0:Ot.__runtimePolylineDefs)?Ot.__runtimePolylineDefs:[],Vt=Array.isArray(Ot==null?void 0:Ot.__runtimePolygonDefs)?Ot.__runtimePolygonDefs:[],Pn=Array.isArray(Ot==null?void 0:Ot.__runtimePathDefs)?Ot.__runtimePathDefs:[],Hn=as.length>0,Tn=qt&&(Ls.length||Ys.length||yn.length||Vt.length||Pn.length);if(!Hn&&!Tn)continue;const bn=(Ot==null?void 0:Ot.__tsIndex)||{},In=Array.isArray(Ot==null?void 0:Ot.__timeSeriesMs)?Ot.__timeSeriesMs:[];let Hs=0;if(In.length>=2){let Fo=0;for(let ps=1;ps<In.length;(ps+=1)-1)Fo+=Math.abs(In[ps]-In[ps-1]);Hs=Fo/(In.length-1)}const Xt=(Ot==null?void 0:Ot.__drawConfig)||{},jn=sn.paneId??"candle_pane",Jn=ze[jn]||ze.candle_pane;if(!Jn)continue;const Kt=eu(jn),Zt=Kt==null?void 0:Kt.axis;if(!Zt)continue;const an={left:Jn.left,top:Jn.top,width:Jn.width,height:Jn.height},rs=typeof De.getRange=="function"?De.getRange():{from:0,to:kn?kn-1:0},Sn=kn?kn-1:-1,Xs=typeof(Ot==null?void 0:Ot.__virtualMaxIndex)=="number"?Math.max(Sn,Number(Ot.__virtualMaxIndex)):Sn,Ni=Xs>=0?Math.max(0,Math.floor(((rs==null?void 0:rs.from)??0)-2)):0,Qn=Xs>=0?Math.min(Xs,Math.ceil(((rs==null?void 0:rs.to)??Xs)+2)):-1;if(Hn){const Fo=Ja({runtimeHeatmaps:as,bounds:an,xAxis:De,yAxis:Zt,offsetX:an.left,offsetY:an.top,drawConfigMeta:Xt,len:kn,tsIndex:bn,timeSeriesMs:In,avgIntervalMs:Hs});Fo.length&&lt.push({bounds:an,heatmaps:Fo})}if(Tn){const Fo=ga({runtimeLineDefs:Ls,runtimeLineFills:Ys,runtimePolylineDefs:yn,runtimePolygonDefs:Vt,runtimePathDefs:Pn,bounds:an,xAxis:De,yAxis:Zt,offsetX:an.left,offsetY:an.top,fromIndex:Ni,toIndex:Qn,len:kn});Fo.length&&wt.push({bounds:an,shapes:Fo})}}if(Ie&&lt.length?Ie.render(lt,{clear:!0}):Ie&&Ie.clear(),ce&&wt.length){const sn=lt.length===0;ce.render(wt,{clear:sn})}}finally{St=!1}})))};function zc(){const S={},j=J==null?void 0:J.getBoundingClientRect(),Q=(j==null?void 0:j.width)??((le==null?void 0:le.width)||0),ue=(j==null?void 0:j.height)??((le==null?void 0:le.height)||0),ie=new DOMRect(0,0,Q,ue);return((J==null?void 0:J.querySelectorAll('[class*="dutycharts-pane"]'))||[]).forEach((ze,lt)=>{var Ot;if((Ot=ze.classList)!=null&&Ot.contains("dutycharts-pane-separator"))return;const qt=ze.getAttribute("data-pane-id")||ze.getAttribute("data-id")||""||(lt===0?"candle_pane":`pane_index_${lt}`);if(!qt)return;const sn=ze.getBoundingClientRect();if(j){const vn=sn.left-j.left,kn=sn.top-j.top;S[qt]=new DOMRect(vn,kn,sn.width,sn.height)}else S[qt]=ie}),S.candle_pane||(S.candle_pane=ie),S}function eu(S){var De,ze,lt,wt,qt,sn;if(!o())return null;const j=o(),Q=((De=j.getDrawPaneById)==null?void 0:De.call(j,S))??((ze=j._drawPanes)==null?void 0:ze.find(Ot=>{var vn;return((vn=Ot==null?void 0:Ot.getId)==null?void 0:vn.call(Ot))===S}));if(!(Q!=null&&Q.getAxisComponent))return null;const ue=Q.getAxisComponent(),ie=((qt=(wt=(lt=Q.getMainWidget)==null?void 0:lt.call(Q))==null?void 0:wt.getBounding)==null?void 0:qt.call(wt))??((sn=Q.getBounding)==null?void 0:sn.call(Q));return ue?{axis:ue,bounding:ie}:null}function Ud(S){var wt,qt;const j=xo.get(S);if(!j)return;const Q=eu(S);if(!Q)return;const{axis:ue}=Q,ie=Math.min(j.min,j.max),De=Math.max(j.min,j.max),ze=Math.max(1e-9,De-ie),lt={from:ie,to:De,range:ze,realFrom:ie,realTo:De,realRange:ze,displayFrom:ie,displayTo:De,displayRange:ze};(wt=ue.setRange)==null||wt.call(ue,lt),(qt=ue.buildTicks)==null||qt.call(ue,!0)}function qf(S){xo.has(S)&&(Sr.has(S)||(Sr.add(S),gl.request(()=>{Sr.delete(S),Ud(S)})))}const Uf=(S,j)=>{for(let Q=S.length-1;Q>=0;(Q-=1)+1){const ie=(S[Q]||{})[j];if(Number.isFinite(ie))return ie}return null},dd=(S,j,Q,ue,ie)=>{if(!Q||Q.legend===!1)return;const De=Q.plots||[],ze=Q.plotKeys||[];if(!De.length)return;const lt=[],wt='12px "Inter", system-ui, -apple-system, sans-serif',qt=14;for(let Zt=0;Zt<De.length;(Zt+=1)-1){const an=De[Zt]||{},rs=String((an==null?void 0:an.display)||"").toLowerCase();if(rs.includes("none")||rs==="display.none"||String(an.name||"").toLowerCase()==="__zero__"||an.legend===!1)continue;const Sn=ze[Zt];if(!Sn)continue;const Xs=Uf(ue,Sn),Ni=typeof an.precision=="number"&&Number.isFinite(an.precision)?Math.max(0,Math.min(10,Math.trunc(an.precision))):4,Qn=Xs==null?"-":co(Xs,Ni),ps=`${String(an.name||Sn)} ${Qn}`,Po=an.color||"#94a3b8",Go=wb(ps,{font:wt,color:"#e2e8f0",lineHeight:qt,align:"left"});lt.push({text:ps,color:Po,atlas:Go})}if(!lt.length)return;const sn=6,Ot=8,vn=6,kn=JZ(lt.map(Zt=>({width:Zt.atlas?Zt.atlas.width:0,height:Zt.atlas?Zt.atlas.height:qt})),{pad:sn,swatch:Ot,gap:vn,lineHeight:qt}),{boxW:as,boxH:Ls}=kn,Ys=String((Q==null?void 0:Q.legendPosition)||"top_left").toLowerCase().replace(/\s+/g,"_"),yn=Number((Q==null?void 0:Q.legendOffsetX)??0),Vt=Number((Q==null?void 0:Q.legendOffsetY)??0),Pn=Number.isFinite(yn)?yn:0,Hn=Number.isFinite(Vt)?Vt:0,Tn=8,bn=Ys.includes("right"),In=Ys.includes("bottom"),Hs=j.top<12?24:8,Xt=bn?j.left+j.width-Tn-as+Pn:j.left+Tn+Pn,jn=In?j.top+j.height-Tn-Ls-Hn:j.top+Hs+Hn,Jn=In?jn-ie:jn+ie;S.save(),S.beginPath(),S.rect(j.left,j.top,j.width,j.height),S.clip(),S.fillStyle="rgba(15,23,42,0.78)",S.strokeStyle="rgba(148,163,184,0.35)",S.lineWidth=1,S.beginPath(),hf(S,Xt,Jn,as,Ls,6),S.fill(),S.stroke();let Kt=Jn+sn;for(const Zt of lt){const an=Zt.atlas,rs=an?an.height:qt,Sn=Math.max(qt,rs),Xs=Kt+Sn/2-2;S.fillStyle=Zt.color,S.fillRect(Xt+sn,Xs,Ot,4),an?S.drawImage(an.canvas,Math.round(Xt+sn+Ot+vn),Math.round(Kt),an.width,an.height):(S.font=wt,S.fillStyle="#e2e8f0",S.textBaseline="top",S.textAlign="left",S.fillText(Zt.text,Xt+sn+Ot+vn,Kt)),Kt+=Sn}return S.restore(),Ls+6},Id=S=>{const j=ic((S==null?void 0:S.open)??(S==null?void 0:S.o)??(S==null?void 0:S.price)??(S==null?void 0:S.value)),Q=ic((S==null?void 0:S.close)??(S==null?void 0:S.c)??(S==null?void 0:S.price)??(S==null?void 0:S.value));return!Rr(j)||!Rr(Q)?null:(j+Q)/2},dc=(S,j,Q)=>{var qt;const ue=typeof(S==null?void 0:S.getRange)=="function"?S.getRange():null,ie=(qt=Q==null?void 0:Q.getVisibleRange)==null?void 0:qt.call(Q),De=Number.isFinite(ue==null?void 0:ue.from)?ue.from:Number.isFinite(ie==null?void 0:ie.from)?ie.from:0,ze=Number.isFinite(ue==null?void 0:ue.to)?ue.to:Number.isFinite(ie==null?void 0:ie.to)?ie.to:Math.max(0,j-1),lt=Math.max(0,Math.floor(De)),wt=Math.min(Math.max(0,j-1),Math.ceil(ze));return{from:lt,to:wt}},Gf=(S,j,Q,ue)=>{const ie=typeof(ue==null?void 0:ue.size)=="number"&&ue.size>0?ue.size:5,De=typeof(ue==null?void 0:ue.alpha)=="number"&&Number.isFinite(ue.alpha)?Math.max(0,Math.min(1,ue.alpha)):1,ze=typeof(ue==null?void 0:ue.glow)=="number"&&ue.glow>=0?ue.glow:10;S.save(),S.globalAlpha=De,S.shadowColor="rgba(56,189,248,0.55)",S.shadowBlur=ze,S.fillStyle="rgba(15,23,42,0.9)",S.strokeStyle="#38bdf8",S.lineWidth=2,S.beginPath(),S.arc(j,Q,ie,0,Math.PI*2),S.fill(),S.stroke(),S.shadowBlur=0,S.fillStyle="#e2e8f0",S.beginPath(),S.arc(j,Q,Math.max(1.4,ie*.32),0,Math.PI*2),S.fill(),S.restore()};function Pd(){var qt,sn,Ot,vn,kn,as,Ls;if(!ge||!o())return;const S=ge;S.clearRect(0,0,le.width,le.height),S.save(),S.font='12px "Inter", system-ui, -apple-system, sans-serif',S.textAlign="center",S.textBaseline="middle";const j=o(),Q=zc(),ue=((qt=j.getDataList)==null?void 0:qt.call(j))||[],ie=(vn=(Ot=(sn=j.getXAxisPane)==null?void 0:sn.call(j))==null?void 0:Ot.getAxisComponent)==null?void 0:vn.call(Ot),De=new Set,ze=[],lt={},wt={};for(const Ys of Ue){const{def:yn,paneId:Vt}=Ys,Pn=yn==null?void 0:yn.__lastResult,Hn=Array.isArray(Pn)?Pn:Array.isArray(Pn==null?void 0:Pn.__rows)?Pn.__rows:[];if(!Array.isArray(Hn)||Hn.length===0||!Pn)continue;const Tn=Q[Vt]||Q.candle_pane,bn={left:Tn.left,top:Tn.top,width:Tn.width,height:Tn.height},In=Pn.__labelItems;if(Array.isArray(In)){const Jn=Pn.__tsIndex||{},Kt={},Zt={};for(const an of In){const rs=an==null?void 0:an.meta;if(!rs)continue;const Sn=rs==null?void 0:rs.value;if(typeof Sn!="number"||!Number.isFinite(Sn))continue;const Xs=an==null?void 0:an.ts,Ni=an==null?void 0:an.tsMs,Qn=(()=>{if(typeof(an==null?void 0:an.index)=="number")return an.index;if(typeof Xs=="number"&&Number.isFinite(Xs)){const si=Jn[String(Xs)];if(typeof si=="number")return si}if(typeof Ni=="number"&&Number.isFinite(Ni)){const si=Jn[`${Math.floor(Ni)}_ms`]??Jn[`${Math.floor(Ni/1e3)}_s`];if(typeof si=="number")return si}})();if(typeof Qn!="number"||!Number.isFinite(Qn))continue;const Fo=(rs.position||"above")==="above",ps=typeof rs.size=="number"&&rs.size>0?rs.size:12,Po=typeof rs.offsetY=="number"?rs.offsetY:10,Go=Fo?Kt[Qn]||0:Zt[Qn]||0,Ps=Po+Go*Math.max(6,ps/3);Fo?Kt[Qn]=Go+1:Zt[Qn]=Go+1;const Ns=(rs==null?void 0:rs.tooltip)!=null?String(rs.tooltip):"";Ns&&ze.push({kind:"label",paneId:Vt,ts:typeof Xs=="number"?Xs:void 0,index:Qn,value:Sn,tooltip:Ns,size:ps,isAbove:Fo,offsetPx:Ps})}}const Hs=Pn.__runtimeTables;if(Array.isArray(Hs))for(const Jn of Hs)(Array.isArray(Jn==null?void 0:Jn.cells)?Jn.cells:[]).some(an=>an==null?void 0:an.tooltip)&&ze.push({kind:"table",paneId:Vt,table:Jn});const Xt=Use(yn.name);if(Array.isArray(Xt)&&Xt.length)for(const Jn of Xt){const Kt=Jn.index,Zt=ue[Kt],an=(Zt==null?void 0:Zt.timestamp)??(Zt==null?void 0:Zt.time);if(!Number.isFinite(an))continue;let rs,Sn="",Xs=!0,Ni="";Jn.type==="entry_long"?(rs=(Zt==null?void 0:Zt.low)??(Zt==null?void 0:Zt.close),Sn="#16a34a",Xs=!0,Ni="BUY"):Jn.type==="exit_long"?(rs=(Zt==null?void 0:Zt.high)??(Zt==null?void 0:Zt.close),Sn="#f59e0b",Xs=!1,Ni="EXIT"):Jn.type==="entry_short"?(rs=(Zt==null?void 0:Zt.high)??(Zt==null?void 0:Zt.close),Sn="#ef4444",Xs=!1,Ni="SELL"):Jn.type==="exit_short"&&(rs=(Zt==null?void 0:Zt.low)??(Zt==null?void 0:Zt.close),Sn="#f59e0b",Xs=!0,Ni="EXIT");const Qn=Array.isArray(yn==null?void 0:yn.figures)&&((kn=yn.figures[0])!=null&&kn.key)?String(yn.figures[0].key):"",Fo=Vt!=="candle_pane";let ps=rs;if(Fo&&Qn){const Du=(Hn[Kt]||{})[Qn];Du!=null&&Number.isFinite(Du)&&(ps=Du)}if(!Number.isFinite(ps))continue;const Po=S2({id:Kt,t:an,p:ps},{chart:o(),paneId:Vt});if(!Po)continue;const Go=12;S.font=`600 ${Go}px "Inter", system-ui, -apple-system, sans-serif`;const Ps=Math.max(12,S.measureText(Ni).width+18),Ns=Math.max(16,Go+8),si=6,Ec=6,yc=bn.top+6,Pc=bn.top+bn.height-6,rc=yc+si+Ns,Mc=Pc-si-Ns,$c=Po.y;let bl=Xs?$c-Ec:$c+Ec;bl=Math.max(rc,Math.min(Mc,bl));const fl=Po.x-Math.floor(Ps/2),$u=Xs?bl-si-Ns:bl+si,sd=Math.max(3,Math.floor(Ns/3)),Bl=Sn||"#16a34a",Sp="rgba(0,0,0,0.35)",Xc="#f8fafc";S.save(),S.lineWidth=1,S.fillStyle=Bl,S.strokeStyle=Sp,S.shadowColor="rgba(0,0,0,0.25)",S.shadowBlur=6,w(S,fl,$u,Ps,Ns,sd),S.fill(),S.stroke(),S.shadowBlur=0,S.beginPath(),Xs?(S.moveTo(Po.x-si,$u+Ns),S.lineTo(Po.x+si,$u+Ns),S.lineTo(Po.x,bl)):(S.moveTo(Po.x-si,$u),S.lineTo(Po.x+si,$u),S.lineTo(Po.x,bl)),S.closePath(),S.fill(),S.stroke(),Ni&&(S.fillStyle=Xc,S.textAlign="center",S.textBaseline="middle",S.fillText(Ni,Po.x,$u+Ns/2)),S.restore()}const jn=yn==null?void 0:yn.__plotMeta;if(jn&&Tn){const Jn=Vt||"candle_pane",Zt=String((jn==null?void 0:jn.legendPosition)||"top_left").toLowerCase().replace(/\s+/g,"_").includes("bottom");Jn in wt||(wt[Jn]=td(o(),Jn));const an=lt[Jn]||0,rs=Zt?0:wt[Jn]||0,Sn=an+rs,Xs=dd(S,Tn,jn,Hn,Sn);typeof Xs=="number"&&Number.isFinite(Xs)&&(lt[Jn]=(lt[Jn]||0)+Xs)}}if(i(Kc)&&ie){const Ys=i(Kc).paneId,yn=Q[Ys]||Q.candle_pane;if(yn&&!De.has(Ys)){const Vt=eu(Ys),Pn=Vt==null?void 0:Vt.axis,Hn=dc(ie,ue.length,j),Tn=Math.max(0,Hn.to-Hn.from+1);let bn=Math.max(1,Math.floor(os));Tn/bn>mo&&(bn=Math.max(1,Math.ceil(Tn/mo)));let In=null;if(i(Kc).kind==="indicator"){const Kt=((as=j.getIndicators)==null?void 0:as.call(j,{paneId:Ys}))||((Ls=j.getIndicators)==null?void 0:Ls.call(j))||[];In=Kt.find(Zt=>(Zt==null?void 0:Zt.id)===i(Kc).indicatorId)||Kt.find(Zt=>(Zt==null?void 0:Zt.name)===i(Kc).indicatorName)||null}let Hs=[];const Xt=In&&Df(In),jn=yn?Li(yn):null,Jn=Xt&&In?nm(In,ue,Hn.from,Hn.to):0;if(In&&pd(In)&&(Hs=yv(Array.isArray(In==null?void 0:In.result)?In.result:[],Hn.from,Hn.to)),Pn&&Tn>0){S.save(),S.beginPath(),S.rect(yn.left,yn.top,yn.width,yn.height),S.clip();for(let Kt=Hn.from;Kt<=Hn.to;Kt+=bn){let Zt=null;if(i(Kc).kind==="candle")Ys==="candle_pane"&&(Zt=Id(ue[Kt]));else if(i(Kc).kind==="indicator"&&i(Kc).plotKey&&In){const Xs=lf(In,Kt,ue);Xs&&(Zt=ic(Xs[i(Kc).plotKey])),!Rr(Zt)&&i(Kc).plotKey==="zigzag"&&Hs.length&&(Zt=Tv(Hs,Kt))}if(!Rr(Zt))continue;const an=ie.convertToPixel(Kt);let rs=Pn.convertToPixel(Zt)+yn.top;if(Xt&&jn&&Jn>0&&i(Kc).plotKey==="volume"){const Xs=Math.min(1,Zt/Jn),Ni=Math.max(1,Math.floor(Xs*jn.effectiveBandHeight));rs=yn.top+jn.bandBottom-Ni}if(!Rr(an)||!Rr(rs))continue;const Sn=Kt===i(Kc).barIndex;Gf(S,an,rs,{size:Sn?5:3,alpha:Sn?1:.75,glow:Sn?10:6})}S.restore(),De.add(Ys)}}}We=ze,ol(),ge==null||ge.restore()}function af(){!Ve||!he||Ve.clearRect(0,0,he.width,he.height)}function ol(){He!=null&&cancelAnimationFrame(He),He=requestAnimationFrame(()=>{He=null,Gd()})}const du=(S,j)=>!(S.x+S.width<j.x||j.x+j.width<S.x||S.y+S.height<j.y||j.y+j.height<S.y),Nu=S=>{if((S==null?void 0:S.avoidOverlap)===!0||(S==null?void 0:S.avoid_overlap)===!0)return!0;const j=String((S==null?void 0:S.collision)||"").toLowerCase();return j==="avoid"||j==="hide"},hf=(S,j,Q,ue,ie,De)=>{const ze=Math.max(0,Math.min(De,Math.min(ue,ie)/2));S.beginPath(),S.moveTo(j+ze,Q),S.lineTo(j+ue-ze,Q),S.quadraticCurveTo(j+ue,Q,j+ue,Q+ze),S.lineTo(j+ue,Q+ie-ze),S.quadraticCurveTo(j+ue,Q+ie,j+ue-ze,Q+ie),S.lineTo(j+ze,Q+ie),S.quadraticCurveTo(j,Q+ie,j,Q+ie-ze),S.lineTo(j,Q+ze),S.quadraticCurveTo(j,Q,j+ze,Q),S.closePath()},td=(S,j)=>{var Xt,jn,Jn,Kt,Zt;if(!S)return 0;const Q=(Xt=S.getChartStore)==null?void 0:Xt.call(S),ue=((jn=Q==null?void 0:Q.getStyles)==null?void 0:jn.call(Q))||{},ie=((Jn=ue==null?void 0:ue.candle)==null?void 0:Jn.tooltip)||{},De=((Kt=ue==null?void 0:ue.indicator)==null?void 0:Kt.tooltip)||{},ze=(an,rs)=>{const Sn=Number.isFinite(an==null?void 0:an.size)?Number(an.size):rs,Xs=Number.isFinite(an==null?void 0:an.marginTop)?Number(an.marginTop):0,Ni=Number.isFinite(an==null?void 0:an.marginBottom)?Number(an.marginBottom):0;return Sn+Xs+Ni},lt=(an,rs)=>{if((an==null?void 0:an.show)===!1)return 0;const Sn=Number.isFinite(an==null?void 0:an.size)?Number(an.size):rs,Xs=Number.isFinite(an==null?void 0:an.marginTop)?Number(an.marginTop):0,Ni=Number.isFinite(an==null?void 0:an.marginBottom)?Number(an.marginBottom):0;return Sn+Xs+Ni},wt=(ie==null?void 0:ie.legend)||{},qt=ze(wt,12),sn=lt(ie==null?void 0:ie.title,14);let Ot=0;const vn=wt==null?void 0:wt.template;Array.isArray(vn)?Ot=vn.length:Array.isArray(wt==null?void 0:wt.labels)?Ot=wt.labels.length:Ot=5;let kn=sn+qt*Math.max(0,Ot);const as=(De==null?void 0:De.legend)||{},Ls=ze(as,12),Ys=lt(De==null?void 0:De.title,12),yn=Array.isArray((Zt=S.getIndicators)==null?void 0:Zt.call(S,{paneId:j}))?S.getIndicators({paneId:j}):[];let Vt=0;for(const an of yn){if((an==null?void 0:an.visible)===!1)continue;const rs=Array.isArray(an==null?void 0:an.figures)?an.figures.length:1,Sn=Math.max(1,rs);Vt+=Sn,kn+=Ys}kn+=Ls*Vt;const Pn=(ie==null?void 0:ie.rect)||{},Hn=Number.isFinite(Pn==null?void 0:Pn.paddingTop)?Number(Pn.paddingTop):4,Tn=Number.isFinite(Pn==null?void 0:Pn.paddingBottom)?Number(Pn.paddingBottom):4,bn=Number.isFinite(Pn==null?void 0:Pn.offsetTop)?Number(Pn.offsetTop):4,In=Number.isFinite(Pn==null?void 0:Pn.offsetBottom)?Number(Pn.offsetBottom):4,Hs=Number.isFinite(Pn==null?void 0:Pn.borderSize)?Number(Pn.borderSize):1;return kn+=Hn+Tn+bn+In+Hs*2,Math.max(0,Math.ceil(kn+6))};function Cc(S,j,Q,ue,ie,De){if(!j)return;const ze=260,lt=10,wt=8,qt=16;S.save(),S.font='12px "Inter", system-ui, -apple-system, sans-serif';const sn=wb(j,{font:S.font,color:"#e2e8f0",maxWidth:ze-lt*2,wrap:!0,lineHeight:qt,align:"left"}),Ot=sn?sn.width:S.measureText(j).width,vn=sn?sn.height:qt,kn=Math.min(ze,Math.max(60,Ot+lt*2)),as=Math.max(qt+wt*2,vn+wt*2),Ls=8,Ys=12,yn=[{x:Q+Ys,y:ue+Ys},{x:Q-kn-Ys,y:ue+Ys},{x:Q+Ys,y:ue-as-Ys},{x:Q-kn-Ys,y:ue-as-Ys}];let Vt=yn[0],Pn=Number.POSITIVE_INFINITY;for(const Xt of yn){const jn=Math.max(0,Ls-Xt.x),Jn=Math.max(0,Xt.x+kn-(ie-Ls)),Kt=Math.max(0,Ls-Xt.y),Zt=Math.max(0,Xt.y+as-(De-Ls)),an=jn+Jn+Kt+Zt;an<Pn&&(Pn=an,Vt=Xt)}let Hn=Vt.x,Tn=Vt.y;Hn=Math.max(Ls,Math.min(ie-kn-Ls,Hn)),Tn=Math.max(Ls,Math.min(De-as-Ls,Tn));const bn=8;S.fillStyle="rgba(15,23,42,0.92)",S.strokeStyle="rgba(148,163,184,0.35)",S.lineWidth=1,S.beginPath(),S.moveTo(Hn+bn,Tn),S.lineTo(Hn+kn-bn,Tn),S.quadraticCurveTo(Hn+kn,Tn,Hn+kn,Tn+bn),S.lineTo(Hn+kn,Tn+as-bn),S.quadraticCurveTo(Hn+kn,Tn+as,Hn+kn-bn,Tn+as),S.lineTo(Hn+bn,Tn+as),S.quadraticCurveTo(Hn,Tn+as,Hn,Tn+as-bn),S.lineTo(Hn,Tn+bn),S.quadraticCurveTo(Hn,Tn,Hn+bn,Tn),S.closePath(),S.fill(),S.stroke(),S.fillStyle="#e2e8f0",S.textAlign="left",S.textBaseline="top";const In=Hn+lt,Hs=Tn+wt;sn?S.drawImage(sn.canvas,Math.round(In),Math.round(Hs),sn.width,sn.height):S.fillText(j,In,Hs),S.restore()}function Gd(){var qt,sn,Ot,vn;if(!Ve||!he||!J)return;if(Ve.clearRect(0,0,he.width,he.height),!We.length){try{Pd()}catch{}if(!We.length)return}const S=o();if(!S)return;const j=J.getBoundingClientRect(),Q=zc();let ue=i(ov),ie=i($m);const De=(Ot=(qt=S.getChartStore)==null?void 0:(sn=qt.call(S)).getCrosshair)==null?void 0:Ot.call(sn);if(De&&(Number.isFinite(De.realX)||Number.isFinite(De.x))){const kn=De.paneId||"candle_pane",as=Q[kn]||Q.candle_pane,Ls=typeof De.realX=="number"?De.realX:De.x;if(typeof Ls=="number"&&Number.isFinite(Ls)&&(ue=Ls),typeof De.y=="number"&&Number.isFinite(De.y)){const Ys=(as==null?void 0:as.top)??0;ie=De.y+Ys}}if(ue==null||ie==null||ue<0||ie<0||ue>j.width||ie>j.height)return;const ze=((vn=S.getDataList)==null?void 0:vn.call(S))||[];let lt=null;for(const kn of We){if(kn.kind!=="table")continue;const as=Q[kn.paneId]||Q.candle_pane;if(!as)continue;const Ls=ue-as.left,Ys=ie-as.top,yn=kn.table;if(!yn||Ls<0||Ys<0)continue;const Vt=Math.max(1,Math.floor(Number(yn.columns??1))),Pn=Math.max(1,Math.floor(Number(yn.rows??1))),Hn=typeof yn.textSize=="number"&&yn.textSize>0?yn.textSize:12,Tn=8,bn=new Array(Vt).fill(0),In=new Array(Pn).fill(Math.max(20,Hn+8)),Hs=Array.isArray(yn.cells)?yn.cells:[],Xt=new Map;for(const ps of Hs){const Po=Math.max(0,Math.min(Vt-1,ps.column)),Go=Math.max(0,Math.min(Pn-1,ps.row));Xt.set(`${Po}:${Go}`,ps)}const jn=Array.isArray(yn.merges)?yn.merges:[],Jn=new Map,Kt=new Map;for(const ps of jn){if(!ps)continue;let Po=Math.max(0,Math.min(Vt-1,Math.floor(Number(ps.left)))),Go=Math.max(0,Math.min(Vt-1,Math.floor(Number(ps.right)))),Ps=Math.max(0,Math.min(Pn-1,Math.floor(Number(ps.top)))),Ns=Math.max(0,Math.min(Pn-1,Math.floor(Number(ps.bottom))));if(!Number.isFinite(Po)||!Number.isFinite(Go)||!Number.isFinite(Ps)||!Number.isFinite(Ns))continue;Po>Go&&([Po,Go]=[Go,Po]),Ps>Ns&&([Ps,Ns]=[Ns,Ps]);const si=`${Po}:${Ps}:${Go}:${Ns}`;Kt.has(si)||Kt.set(si,{left:Po,top:Ps,right:Go,bottom:Ns,minW:0,minH:0});for(let Ec=Po;Ec<=Go;(Ec+=1)-1)for(let yc=Ps;yc<=Ns;(yc+=1)-1)Jn.set(`${Ec}:${yc}`,{left:Po,top:Ps,right:Go,bottom:Ns})}for(const ps of Hs){const Po=Math.max(0,Math.min(Vt-1,ps.column)),Go=Math.max(0,Math.min(Pn-1,ps.row)),Ps=Jn.get(`${Po}:${Go}`);if(Ps&&(Ps.left!==Po||Ps.top!==Go))continue;const Ns=ps.text||"",si=typeof ps.textSize=="number"&&ps.textSize>0?ps.textSize:Hn;Ve.font=`${si}px "Inter", system-ui, -apple-system, sans-serif`;const Ec=Ve.measureText(Ns).width+Tn*2,yc=typeof ps.width=="number"&&ps.width>0?ps.width:0,Pc=typeof ps.height=="number"&&ps.height>0?ps.height:Math.max(20,si+8);if(Ps){const rc=`${Ps.left}:${Ps.top}:${Ps.right}:${Ps.bottom}`,Mc=Kt.get(rc);Mc&&(Mc.minW=Math.max(Mc.minW,Ec,yc),Mc.minH=Math.max(Mc.minH,Pc))}else bn[Po]=Math.max(bn[Po],Ec,yc),In[Go]=Math.max(In[Go],Pc)}for(let ps=0;ps<Vt;(ps+=1)-1)bn[ps]<60&&(bn[ps]=60);for(const ps of Kt.values()){let Po=0;for(let Ps=ps.left;Ps<=ps.right;(Ps+=1)-1)Po+=bn[Ps]||0;Po<ps.minW&&(bn[ps.right]=(bn[ps.right]||0)+(ps.minW-Po));let Go=0;for(let Ps=ps.top;Ps<=ps.bottom;(Ps+=1)-1)Go+=In[Ps]||0;Go<ps.minH&&(In[ps.bottom]=(In[ps.bottom]||0)+(ps.minH-Go))}const Zt=bn.reduce((ps,Po)=>ps+Po,0),an=In.reduce((ps,Po)=>ps+Po,0),rs=String(yn.position||"top_right").toLowerCase();let Sn=Tn,Xs=Tn;const Ni=as.width,Qn=as.height;if(rs.includes("top_right")?(Sn=Ni-Zt-Tn,Xs=Tn):rs.includes("bottom_left")?(Sn=Tn,Xs=Qn-an-Tn):rs.includes("bottom_right")?(Sn=Ni-Zt-Tn,Xs=Qn-an-Tn):rs.includes("top_center")?(Sn=(Ni-Zt)/2,Xs=Tn):rs.includes("bottom_center")?(Sn=(Ni-Zt)/2,Xs=Qn-an-Tn):(rs.includes("middle_center")||rs.includes("center"))&&(Sn=(Ni-Zt)/2,Xs=(Qn-an)/2),Ls<Sn||Ys<Xs||Ls>Sn+Zt||Ys>Xs+an)continue;let Fo=Sn;for(let ps=0;ps<Vt;(ps+=1)-1){let Po=Xs;for(let Go=0;Go<Pn;(Go+=1)-1){const Ps=bn[ps],Ns=In[Go],si=Jn.get(`${ps}:${Go}`);if(si&&(si.left!==ps||si.top!==Go)){Po+=Ns;continue}const Ec=si?(()=>{let rc=0;for(let Mc=si.left;Mc<=si.right;(Mc+=1)-1)rc+=bn[Mc]||0;return rc})():Ps,yc=si?(()=>{let rc=0;for(let Mc=si.top;Mc<=si.bottom;(Mc+=1)-1)rc+=In[Mc]||0;return rc})():Ns,Pc=Xt.get(`${ps}:${Go}`);if(Pc!=null&&Pc.tooltip&&Ls>=Fo&&Ls<=Fo+Ec&&Ys>=Po&&Ys<=Po+yc){lt={text:String(Pc.tooltip),x:as.left+Fo+Ec/2,y:as.top+Po+yc/2};break}Po+=Ns}if(lt)break;Fo+=bn[ps]}if(lt)break}if(lt){Cc(Ve,lt.text,lt.x,lt.y,j.width,j.height);return}let wt=null;for(const kn of We){if(kn.kind!=="label")continue;const as=typeof kn.ts=="number"?kn.ts:typeof kn.index=="number"?(()=>{const jn=ze[kn.index];return(jn==null?void 0:jn.timestamp)??(jn==null?void 0:jn.time)??(jn==null?void 0:jn.t)})():void 0;if(typeof as!="number"||!Number.isFinite(as))continue;const Ls=as<1e12?as*1e3:as,Ys=S2({t:Ls,p:kn.value},{chart:S,paneId:kn.paneId});if(!Ys)continue;let yn=Ys.y;const Vt=typeof kn.offsetPx=="number"?kn.offsetPx:10;kn.isAbove!==!1?yn-=Vt:yn+=Vt;const Hn=Q[kn.paneId]||Q.candle_pane,Tn=typeof kn.size=="number"&&kn.size>0?kn.size/2:6;if(Hn){const jn=Hn.top+Tn+2,Jn=Hn.top+Hn.height-Tn-2;yn=Math.max(jn,Math.min(Jn,yn))}const bn=ue-Ys.x,In=ie-yn,Hs=Math.hypot(bn,In),Xt=Math.max(14,Tn+10);Hs<=Xt&&(!wt||Hs<wt.dist)&&(wt={text:kn.tooltip,x:Ys.x,y:yn,dist:Hs})}wt&&Cc(Ve,wt.text,wt.x,wt.y,j.width,j.height)}function tu(S){if(!S)return{r:0,g:0,b:0};const j=S.trim();if(j.startsWith("#")&&(j.length===7||j.length===4)){const ue=j.length===4?`#${j[1]}${j[1]}${j[2]}${j[2]}${j[3]}${j[3]}`:j,ie=parseInt(ue.slice(1,3),16),De=parseInt(ue.slice(3,5),16),ze=parseInt(ue.slice(5,7),16);return{r:ie,g:De,b:ze}}const Q=S.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);return Q?{r:+Q[1],g:+Q[2],b:+Q[3]}:{r:0,g:0,b:0}}function Vc(S){const j=[S.r,S.g,S.b].map(Q=>Q/255).map(Q=>Q<=.03928?Q/12.92:Math.pow((Q+.055)/1.055,2.4));return .2126*j[0]+.7152*j[1]+.0722*j[2]}function Yd(S,j){const Q=Vc(tu(S)),ue=Vc(tu(j)),ie=Math.max(Q,ue),De=Math.min(Q,ue);return(ie+.05)/(De+.05)}function Md(S){const j="#111111",Q="#FFFFFF";return Yd(Q,S)>=Yd(j,S)?Q:j}const Au=48,Kd=80,Hu=6,Tu=4,bd=(S,j)=>{const Q=String(S??"").replace(/\s*\n\s*/g," ");return Q.length<=j?Q:j<=1?"…":`${Q.slice(0,Math.max(0,j-1))}…`},gc=S=>{if(!Number.isFinite(S))return;const j=Math.round(Number(S));return Math.max(8,Math.min(32,j))},qu=S=>{if(!Number.isFinite(S))return;const j=Math.round(Number(S));return Math.max(0,Math.min(4,j))},$d=S=>{var qt;if(!S)return S;const j=String(S).trim(),Q=j.match(/^rgba?\(([^)]+)\)$/i);if(!Q)return j;const ue=((qt=Q[1])==null?void 0:qt.split(",").map(sn=>sn.trim()))??[];if(ue.length<3)return j;const ie=Number(ue[0]),De=Number(ue[1]),ze=Number(ue[2]);if(!Number.isFinite(ie)||!Number.isFinite(De)||!Number.isFinite(ze))return j;if(ue.length<4)return`rgb(${Math.round(ie)}, ${Math.round(De)}, ${Math.round(ze)})`;const lt=Number(ue[3]),wt=Number.isFinite(lt)?Math.max(0,Math.min(1,lt)):1;return`rgba(${Math.round(ie)}, ${Math.round(De)}, ${Math.round(ze)}, ${wt})`},np=S=>{var De;const Q=String(S||"").trim().match(/^rgba\(([^)]+)\)$/i);if(!Q)return null;const ue=((De=Q[1])==null?void 0:De.split(",").map(ze=>ze.trim()))??[];if(ue.length<4)return null;const ie=Number(ue[3]);return Number.isFinite(ie)?Math.max(0,Math.min(1,ie)):null},Pf=S=>{const j=tu(S),Q=np(S)??1,ue=De=>Math.max(0,Math.min(255,Math.round(De*.75))),ie=Math.max(0,Math.min(1,Q+.15));return`rgba(${ue(j.r)}, ${ue(j.g)}, ${ue(j.b)}, ${ie})`},oe=S=>{const j=S.bgColor?$d(String(S.bgColor)):void 0,Q=S.borderColor?$d(String(S.borderColor)):void 0;let ue=qu(typeof S.borderWidth=="number"?S.borderWidth:void 0);ue==null&&(ue=Q?1:0);let ie=Q;!ie&&ue>0&&j&&(ie=Pf(j)),!ie&&!Q&&(ue=0);const De=String(S.borderStyle||"solid").toLowerCase(),ze=ue>0?Vk(De,ue):[],lt=0,wt=bd(S.text??"",Au),qt=bd(S.tooltip??"",Kd),sn=S.textColor?$d(String(S.textColor)):void 0,Ot=gc(S.textSize)??12,vn=S.textHalign==="left"||S.textHalign==="right"?S.textHalign:"center",kn=S.textValign==="top"||S.textValign==="bottom"?S.textValign:"middle";return{bgColor:j,borderColor:ie,borderWidth:ue,borderStyle:De,dash:ze,dashOffset:lt,textFinal:wt,tooltipFinal:qt,textColor:sn,fontPx:Ot,textHalign:vn,textValign:kn,padX:Hu,padY:Tu}};function we(S,j){let Q=S.replace(/\s+/g,"_").toLowerCase().replace(/[^a-z0-9_]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||"plot",ue=1;for(;j.has(Q);)Q=`${Q}_${ue}`,ue+=1;return j.add(Q),Q}function K(S){if(S){try{wc.forEach(j=>{Yse(j),J5(j)})}catch{}Pu.forEach(j=>{try{S.removeIndicator({id:j})}catch{}}),Pu=[],wc.forEach(j=>{try{S.removeIndicator({paneId:"candle_pane",name:j})}catch{}try{S.removeIndicator({paneId:"pane_script",name:j})}catch{}try{S.removeIndicator({paneId:"script_pane",name:j})}catch{}}),wc=[],Ue=[];try{Sc()}catch{}xo.forEach((j,Q)=>{var ie,De,ze;const ue=eu(Q);(ie=ue==null?void 0:ue.axis)!=null&&ie.setAutoCalcTickFlag&&(ue.axis.setAutoCalcTickFlag(!0),(ze=(De=ue.axis).buildTicks)==null||ze.call(De,!0))}),xo.clear(),Sr.clear(),x(cc,null)}}const re={limits:{line:240,linefill:120,label:300,box:180,table:20,polyline:180,polygon:160,path:160},pruningPolicy:"fifo",futureBars:200,time:{mode:"nearest",toleranceBars:2,toleranceMs:6e4},decimationPx:2},ke=500,ee=200,Ee={labels:ke,lines:500,boxes:ee,runtimeDraws:1e3},ht={maxPx:0,offsetPx:0,lastAppliedTs:0},pt=new Map,Nt=new Map;function E(S){if(!Array.isArray(S)||S.length===0)return null;let j=0,Q=0;S.forEach(ie=>{if(typeof ie=="string"){Q+=1;return}String((ie==null?void 0:ie.level)||"").toLowerCase()==="error"?j+=1:Q+=1});const ue=j+Q;return ue?j&&Q?`issues: ${ue} (${j} error${j===1?"":"s"})`:j?`errors: ${j}`:`warnings: ${Q}`:null}function I(S,j){const Q=[],ue=new Set,ie=De=>{if(!De)return;const ze=String((De==null?void 0:De.level)||"warning").toLowerCase(),lt=String((De==null?void 0:De.message)||De||"").trim();if(!lt)return;const wt=`${ze}:${lt}`;ue.has(wt)||(ue.add(wt),typeof De=="string"?Q.push({level:"warning",message:lt}):Q.push(De))};return(S||[]).forEach(ie),(j||[]).forEach(ie),Q}function W(S){if(S==null)return!1;const j=String(S).trim().toLowerCase();if(!j)return!1;if(j==="transparent"||j==="none")return!0;const Q=j.match(/rgba?\(([^)]+)\)/);if(Q){const ie=Q[1].split(",").map(De=>De.trim());if(ie.length>=4){const De=Number(ie[3]);return Number.isFinite(De)&&De<=0}return!1}const ue=j.match(/hsla?\(([^)]+)\)/);if(ue){const ie=ue[1].split(",").map(De=>De.trim());if(ie.length>=4){const De=Number(ie[3]);return Number.isFinite(De)&&De<=0}return!1}if(j.startsWith("#")){const ie=j.slice(1);if(ie.length===4)return ie[3]==="0";if(ie.length===8)return ie.slice(6)==="00"}return!1}function Z(S){if(!S||typeof S!="object")return!1;const j=S.gradient||S.upGradient||S.downGradient;if(j){const ie=j==null?void 0:j.from,De=j==null?void 0:j.to;return ie!=null||De!=null?!W(ie)||!W(De):!0}const Q=[S.color,S.downColor,S.wickColor,S.borderColor];return Q.some(ie=>ie!=null)?Q.some(ie=>ie!=null&&!W(ie)):!0}async function _e(S,j="auto"){var kd,Rp,Jp,dv,yp,Hv,Pg,Mg,Ng,fg,bh,Sv,Ag,Cv,Gm,Hi,Pr,iu,hd,yf,Zd;const Q=o();if(!Q)throw new Error("Chart not ready yet. Please try again in a moment.");Na=new Set,j!=="js"&&x(ho,V([]));const ue=String(j||"script").trim().toLowerCase(),ie=j==="pine",De=new Map,ze=ie?{emitOnce:(Et,hs)=>{const Lo=String(Et||hs||"").trim(),So=String(hs||Et||"").trim();!Lo||!So||De.has(Lo)||De.set(Lo,So)}}:void 0,lt=(Et,hs)=>{if(!ie)return;const Lo=`Limit exceeded: ${Et} (max ${hs})`;Na.add(Lo)};ie&&((!S.params||typeof S.params!="object")&&(S.params={}),S.params.__pinev2=1),hi=((kd=S.params)==null?void 0:kd.__pinev2)===1;const wt=j==="json",qt=Array.isArray(S.calc)?S.calc:[],sn=Array.isArray(S.series)?S.series:[],Ot=Array.isArray(S.stateSeries)?S.stateSeries:[],vn=Et=>String(Et||"").replace(/\s+/g,"_").toLowerCase(),kn=(Et,hs)=>{const Lo=new Set,So=If(Et),qa=/[A-Za-z_$][A-Za-z0-9_$]*/g;let Zc;for(;Zc=qa.exec(So);){const Eo=vn(Zc[0]||"");hs.has(Eo)&&Lo.add(Eo)}return Lo},as=Et=>{const hs=[],Lo=[],So=[],qa=new Map;Et.forEach((il,Hl)=>{const Bf=vn(String((il==null?void 0:il.name)||`series_${Hl}`));So[Hl]=Bf,qa.set(Bf,String((il==null?void 0:il.expr)??""))});const Zc=new Set(qa.keys()),Eo=new Set;qa.forEach((il,Hl)=>{/\b__arr_/i.test(il)&&Eo.add(Hl)});let Fa=!0;for(;Fa;)Fa=!1,qa.forEach((il,Hl)=>{if(Eo.has(Hl))return;const Bf=kn(il,Zc);for(const ai of Bf)if(Eo.has(ai)){Eo.add(Hl),Fa=!0;break}});return Et.forEach((il,Hl)=>{const Bf=So[Hl]||"";Eo.has(Bf)?Lo.push(il):hs.push(il)}),{primary:hs,arrayDependent:Lo}},{primary:Ls,arrayDependent:Ys}=as(sn),yn=[],Vt=Array.isArray(S.signals)?S.signals:[];if(Array.isArray(S.panes))for(const Et of S.panes){const hs=Et.pane==="sub"?"sub":"main";yn.push({pane:hs,plots:Array.isArray(Et.plots)?Et.plots:[],levels:Array.isArray(Et.levels)?Et.levels:[],labels:Array.isArray(Et.labels)?Et.labels:[],lines:Array.isArray(Et.lines)?Et.lines:[],runtimeDrawOps:Array.isArray(Et.runtimeDrawOps)?Et.runtimeDrawOps:[],runtimeLabels:Array.isArray(Et.runtimeLabels)?Et.runtimeLabels:[],runtimeLines:Array.isArray(Et.runtimeLines)?Et.runtimeLines:[],runtimeBoxes:Array.isArray(Et.runtimeBoxes)?Et.runtimeBoxes:[],runtimeTables:Array.isArray(Et.runtimeTables)?Et.runtimeTables:[],runtimeHeatmaps:Array.isArray(Et.runtimeHeatmaps)?Et.runtimeHeatmaps:[],overlays:Array.isArray(Et.overlays)?Et.overlays:[],fills:Array.isArray(Et.fills)?Et.fills:[],backgroundZones:Array.isArray(Et.backgroundZones)?Et.backgroundZones:[],min:Et.min,max:Et.max,shortName:Et.shortName||S.shortName,height:Et.height})}else if(S.main||S.sub)S.main&&yn.push({pane:"main",plots:Array.isArray(S.main.plots)?S.main.plots:[],levels:Array.isArray(S.main.levels)?S.main.levels:[],labels:Array.isArray(S.main.labels)?S.main.labels:[],lines:Array.isArray(S.main.lines)?S.main.lines:[],runtimeDrawOps:Array.isArray(S.main.runtimeDrawOps)?S.main.runtimeDrawOps:[],runtimeLabels:Array.isArray(S.main.runtimeLabels)?S.main.runtimeLabels:[],runtimeLines:Array.isArray(S.main.runtimeLines)?S.main.runtimeLines:[],runtimeBoxes:Array.isArray(S.main.runtimeBoxes)?S.main.runtimeBoxes:[],runtimeTables:Array.isArray(S.main.runtimeTables)?S.main.runtimeTables:[],runtimeHeatmaps:Array.isArray(S.main.runtimeHeatmaps)?S.main.runtimeHeatmaps:[],overlays:Array.isArray(S.main.overlays)?S.main.overlays:Array.isArray(S.overlays)?S.overlays:[],fills:Array.isArray(S.main.fills)?S.main.fills:[],backgroundZones:Array.isArray(S.main.backgroundZones)?S.main.backgroundZones:[],min:S.main.min,max:S.main.max,shortName:S.main.shortName||S.shortName,height:S.main.height}),S.sub&&yn.push({pane:"sub",plots:Array.isArray(S.sub.plots)?S.sub.plots:[],levels:Array.isArray(S.sub.levels)?S.sub.levels:[],labels:Array.isArray(S.sub.labels)?S.sub.labels:[],lines:Array.isArray(S.sub.lines)?S.sub.lines:[],runtimeDrawOps:Array.isArray(S.sub.runtimeDrawOps)?S.sub.runtimeDrawOps:[],runtimeLabels:Array.isArray(S.sub.runtimeLabels)?S.sub.runtimeLabels:[],runtimeLines:Array.isArray(S.sub.runtimeLines)?S.sub.runtimeLines:[],runtimeBoxes:Array.isArray(S.sub.runtimeBoxes)?S.sub.runtimeBoxes:[],runtimeTables:Array.isArray(S.sub.runtimeTables)?S.sub.runtimeTables:[],runtimeHeatmaps:Array.isArray(S.sub.runtimeHeatmaps)?S.sub.runtimeHeatmaps:[],overlays:Array.isArray(S.sub.overlays)?S.sub.overlays:[],fills:Array.isArray(S.sub.fills)?S.sub.fills:[],backgroundZones:Array.isArray(S.sub.backgroundZones)?S.sub.backgroundZones:[],min:S.sub.min,max:S.sub.max,shortName:S.sub.shortName||S.shortName,height:S.sub.height});else{const hs=S.pane==="sub"?"sub":S.pane==="main"?"main":i(ou);yn.push({pane:hs,plots:Array.isArray(S.plots)?S.plots:[],levels:Array.isArray(S.levels)?S.levels:[],labels:Array.isArray(S.labels)?S.labels:[],lines:Array.isArray(S.lines)?S.lines:[],runtimeDrawOps:Array.isArray(S.runtimeDrawOps)?S.runtimeDrawOps:[],runtimeLabels:Array.isArray(S.runtimeLabels)?S.runtimeLabels:[],runtimeLines:Array.isArray(S.runtimeLines)?S.runtimeLines:[],runtimeBoxes:Array.isArray(S.runtimeBoxes)?S.runtimeBoxes:[],runtimeTables:Array.isArray(S.runtimeTables)?S.runtimeTables:[],runtimeHeatmaps:Array.isArray(S.runtimeHeatmaps)?S.runtimeHeatmaps:[],overlays:Array.isArray(S.overlays)?S.overlays:[],fills:Array.isArray(S.fills)?S.fills:[],backgroundZones:Array.isArray(S.backgroundZones)?S.backgroundZones:[],min:S.min,max:S.max,shortName:S.shortName,height:S.height}),x(ou,V(hs))}if(yn.some(Et=>Array.isArray(Et.runtimeHeatmaps)&&Et.runtimeHeatmaps.length)){je=!0;try{Ll()}catch{}}if(!yn.length)throw new Error("No panes defined in script.");const Hn=(()=>{const Et=yn.findIndex(hs=>hs.pane==="main");return Et>=0?Et:0})(),Tn=yn.some(Et=>Et.plots&&Et.plots.length||Et.overlays&&Et.overlays.length||Et.labels&&Et.labels.length||Et.levels&&Et.levels.length||Et.lines&&Et.lines.length||Et.runtimeDrawOps&&Et.runtimeDrawOps.length||Et.runtimeLabels&&Et.runtimeLabels.length||Et.runtimeLines&&Et.runtimeLines.length||Et.runtimeBoxes&&Et.runtimeBoxes.length||Et.runtimeTables&&Et.runtimeTables.length||Et.runtimeHeatmaps&&Et.runtimeHeatmaps.length),bn=!!(S!=null&&S.strategy)||Vt.length>0;if(!Tn&&!bn)throw new Error("No plots or labels defined in script.");!Tn&&bn&&(yn[0]||yn.push({pane:"main",plots:[],levels:[],labels:[],lines:[],overlays:[]}),yn[0].plots=Array.isArray(yn[0].plots)?yn[0].plots:[],yn[0].plots.push({name:"__hidden__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:1e-4,style:"solid",layer:"background"})),K(Q);try{Q.removeOverlay({groupId:"runtime"})}catch{}const In=`${Gc}_${Date.now()}`;let Hs=0,Xt=!1;const jn={maxCalls:16,maxSymbols:8,maxTimeframes:8,maxBars:5e3},Jn=new Map,Kt=new Map,Zt=Et=>{const hs=String(Et||"").trim(),Lo=hs.lastIndexOf("@");if(Lo>0&&Lo<hs.length-1){const So=hs.slice(0,Lo).trim(),qa=hs.slice(Lo+1).trim();if(So&&qa)return{ticker:So,country:qa}}return{ticker:hs}},an=Et=>String(Et||"").trim().toLowerCase().replace(/\s+/g,""),rs=Array.isArray((Rp=s())==null?void 0:Rp.allSymbols)?s().allSymbols:[],Sn=new Map,Xs=new Map,Ni=new Map;for(const Et of rs){const hs=an(String((Et==null?void 0:Et.ticker)||""));hs&&Sn.set(hs,Et);const Lo=an(String((Et==null?void 0:Et.shortName)||""));Lo&&!Xs.has(Lo)&&Xs.set(Lo,Et);const So=an(String((Et==null?void 0:Et.name)||""));So&&!Ni.has(So)&&Ni.set(So,Et)}const Qn=(Et,hs)=>{let Lo=String(Et??"").trim();if(!Lo)return"__CURRENT__";try{Lo=Lo.replace(/\$\{([^}]+)\}/g,(Eo,Fa)=>{var Hl;const il=(hs==null?void 0:hs[Fa])??(hs==null?void 0:hs[(Hl=Fa==null?void 0:Fa.toLowerCase)==null?void 0:Hl.call(Fa)]);return il==null?Eo:String(il)})}catch{}const So=Lo.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(So)){const Eo=(hs==null?void 0:hs[So])??(hs==null?void 0:hs[So.toLowerCase()]);typeof Eo=="string"&&Eo.trim()&&(Lo=Eo.trim())}const qa=String(Lo).trim(),Zc=qa.toLowerCase();return Zc==="syminfo.tickerid"||Zc==="syminfo.ticker"||Zc==="syminfo.root"||Zc==="__current__"||Zc==="__current_symbol__"?"__CURRENT__":qa},Fo=Bc(),ps=Et=>({...Et,sessionMode:Fo.sessionMode,adjustMode:Fo.adjustMode}),Po=Et=>{const hs=String(Fo.sessionMode||"regular").toLowerCase(),Lo=String((Et==null?void 0:Et.session)||""),So=String((Et==null?void 0:Et.sessionExtended)||"");return hs==="all"?"24x7":hs==="extended"&&So||Lo},Go=(Et,hs,Lo)=>{const So=Qn(Et,Lo);if(So==="__CURRENT__")return ps(Ns);const qa=Zt(So),Zc=String(qa.ticker||"").trim(),Eo=an(Zc),Fa=Eo&&Sn.get(Eo)||Eo&&Xs.get(Eo)||Eo&&Ni.get(Eo)||null,il=String(hs||qa.country||(Fa==null?void 0:Fa.country)||Ns.country||"BD").trim()||"BD";return Fa&&String(Fa.ticker||"").trim()?ps({...Fa,country:il}):ps({...Ns,ticker:Zc,country:il})},Ps=S!=null&&S.params&&typeof S.params=="object"?S.params:{},Ns=((Jp=s())==null?void 0:Jp.symbol)||{ticker:"UNKNOWN"},si=((dv=Q.getDataList)==null?void 0:dv.call(Q))||[],Ec=typeof((yp=si==null?void 0:si[0])==null?void 0:yp.timestamp)=="number"?si[0].timestamp:typeof((Hv=si==null?void 0:si[0])==null?void 0:Hv.time)=="number"?si[0].time:0,yc=typeof((Pg=si==null?void 0:si[si.length-1])==null?void 0:Pg.timestamp)=="number"?si[si.length-1].timestamp:typeof((Mg=si==null?void 0:si[si.length-1])==null?void 0:Mg.time)=="number"?si[si.length-1].time:0,Pc=Et=>{const hs=typeof Et=="number"?Et:Number(Et);return!Number.isFinite(hs)||hs<=0?0:hs<1e12?hs*1e3:hs},rc=Pc(Ec),Mc=Pc(yc),$c=Et=>{const hs=String(Et??"").trim();if(!hs)return"__CURRENT__";const Lo=hs.toUpperCase();if(Lo==="CURRENT"||Lo==="__CURRENT__"||Lo==="TIMEFRAME.PERIOD")return"__CURRENT__";if(Lo==="D"||Lo==="1D")return"1d";if(Lo==="W"||Lo==="1W")return"1w";if(Lo==="M"||Lo==="1M")return"1M";if(/^\d+$/.test(hs))return`${hs}m`;const So=Lo.match(/^(\d+)\s*H$/);return So?`${So[1]}h`:hs},bl=Et=>{const hs=String(Et||"").trim();if(!hs)return 0;if(/^\d+$/.test(hs))return mp(`${hs}m`);if(hs==="M"||hs==="1M")return mp("1M");const Lo=hs.toUpperCase();if(Lo==="D"||Lo==="1D")return mp("1d");if(Lo==="W"||Lo==="1W")return mp("1w");const So=hs.match(/^(\d+)\s*([A-Za-z]+)$/);if(So){const qa=So[1]||"1",Zc=So[2]||"";if(Zc==="M")return mp(`${qa}M`);const Eo=Zc.toLowerCase();return Eo.startsWith("min")?mp(`${qa}m`):Eo==="h"||Eo.startsWith("hr")||Eo.startsWith("hour")?mp(`${qa}h`):Eo==="d"||Eo.startsWith("day")?mp(`${qa}d`):Eo==="w"||Eo.startsWith("wk")||Eo.startsWith("week")?mp(`${qa}w`):mp(`${qa}${Eo}`)}try{return mp(hs)}catch{return 0}},fl=bl(((fg=(Ng=s())==null?void 0:Ng.period)==null?void 0:fg.timeframe)||""),$u=fl>0?fl*1e3:0,sd=Mc>0&&$u>0?Mc+$u-1:Mc;if(ie){(!S.params||typeof S.params!="object")&&(S.params={});const Et=si.length>=1?si[si.length-1]:null,hs=si.length>=2?si[si.length-2]:null,Lo=Pc((Et==null?void 0:Et.timestamp)??(Et==null?void 0:Et.time)),So=Pc((hs==null?void 0:hs.timestamp)??(hs==null?void 0:hs.time)),Zc=(Number.isFinite(Lo)&&Number.isFinite(So)&&Lo>So?Lo-So:0)||$u||0,Eo=Number.isFinite(Lo)&&Lo>0&&Zc>0?Lo+Zc:Date.now();S.params.__barDurationMs=Zc,S.params.__nowMs=Eo}const Bl=Et=>{const hs=String(Et||"").trim();if(!hs)return"__CURRENT__";const Lo=hs.toLowerCase();if(Lo.endsWith("m")){const So=Number(Lo.slice(0,-1));if(Number.isFinite(So)&&So>0)return String(Math.floor(So))}if(Lo.endsWith("h")){const So=Number(Lo.slice(0,-1));if(Number.isFinite(So)&&So>0)return String(Math.floor(So*60))}return Lo.endsWith("d")?"D":Lo.endsWith("w")?"W":hs==="1M"||hs==="M"?"M":(/^\d+$/.test(hs),hs)},Sp=Et=>{let hs=String(Et??"__CURRENT__");try{hs=hs.replace(/\$\{([^}]+)\}/g,(So,qa)=>{var Eo;const Zc=(Ps==null?void 0:Ps[qa])??(Ps==null?void 0:Ps[(Eo=qa==null?void 0:qa.toLowerCase)==null?void 0:Eo.call(qa)]);return Zc==null?So:String(Zc)});const Lo=hs.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Lo)){const So=(Ps==null?void 0:Ps[Lo])??(Ps==null?void 0:Ps[Lo.toLowerCase()]);So!=null&&(hs=String(So))}}catch{}return hs},Xc=new Map;let xl=[];try{const Et=(qt||[]).filter(hs=>String((hs==null?void 0:hs.type)||"").toLowerCase()==="security");if(Et.length&&(Ns!=null&&Ns.ticker)){if(zu.size)for(const So of zu){const[qa]=String(So).split("@");if(qa&&qa!==Ns.ticker)try{T.stopSymbolPipelines(qa)}catch{}}const hs=new Set,Lo=new Map;for(const So of Et){const qa=String((So==null?void 0:So.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!qa)continue;const Zc=!!(So!=null&&So.lower),Eo=Go(So==null?void 0:So.symbol,So==null?void 0:So.country,Ps),Fa=String((Eo==null?void 0:Eo.ticker)||"").trim(),il=String((Eo==null?void 0:Eo.country)||"BD");if(!Fa)continue;hs.add(`${Fa}@${il}`);const Hl=Sp((So==null?void 0:So.timeframe)||(So==null?void 0:So.tf)||"__CURRENT__"),Bf=Hl==="__CURRENT__"?((Sv=(bh=s())==null?void 0:bh.period)==null?void 0:Sv.timeframe)||"1m":$c(Hl),ai=Hl==="__CURRENT__"?Bl(((Cv=(Ag=s())==null?void 0:Ag.period)==null?void 0:Cv.timeframe)||"1m"):String(Hl||"__CURRENT__");Xc.set(qa,{ticker:Fa,country:il,pipelineTf:Bf,computeTf:ai,lower:Zc});const Bs=`${Fa}@${il}|${Bf}`;Bf&&Bf!=="__CURRENT__"&&Lo.set(Bs,{sym:Eo,tf:Bf})}if(xl=Array.from(Lo.values()),zu=hs,Lo.size&&rc>0&&sd>0)await Promise.all(Array.from(Lo.values()).map(({sym:So,tf:qa})=>T.ensureHistoryCovers(So,qa,rc,sd,3e3).catch(()=>null)));else if(Lo.size)for(const{sym:So,tf:qa}of Lo.values())try{T.startBackgroundPrefetch(So,{timeframe:qa})}catch{}}}catch(Et){console.warn("[ScriptStudio] request.security prefetch skipped",Et)}try{ft&&(clearInterval(ft),ft=null)}catch{}if(xl.length){const Et=Date.now(),hs=25e3;ft=setInterval(()=>{var qa;const Lo=o();if(!Lo)return;if(Date.now()-Et>hs){try{clearInterval(ft)}catch{}ft=null;return}let So=0;for(const{sym:Zc,tf:Eo}of xl){const Fa=T.getHistorySnapshot(Zc,Eo);if(Fa!=null&&Fa.error)continue;const il=(((qa=Fa==null?void 0:Fa.candles)==null?void 0:qa.length)||0)>=2,Hl=rc>0&&sd>0&&((Fa==null?void 0:Fa.oldestTimestampLoaded)??1/0)<=rc&&((Fa==null?void 0:Fa.newestTimestampLoaded)??0)>=sd;!(Fa!=null&&Fa.isComplete)&&(!il||!Hl)&&(So+=1)}if(So<=0){try{clearInterval(ft)}catch{}ft=null;return}gl.requestKey("security:refresh",()=>{try{Lo.resize()}catch{}try{Pd()}catch{}})},350)}const Du=(Et,hs)=>{var xa,Jc,Ua,ku,Su,sa,Ol,od;const Lo=new Set,So=[],qa={min:"__rt_autoscale_min",max:"__rt_autoscale_max"},Zc=Et.plots||[],Eo=S!=null&&S.params&&typeof S.params=="object"?S.params:{},Fa=G=>{if(G!=null){if(typeof G!="string")return String(G);try{const Bt=G.replace(/\$\{([^}]+)\}/g,(cs,ts)=>{var ko;const aa=(Eo==null?void 0:Eo[ts])??(Eo==null?void 0:Eo[(ko=ts==null?void 0:ts.toLowerCase)==null?void 0:ko.call(ts)]);return aa==null?cs:String(aa)});if(Bt!==G)return Bt;const Ks=G.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Ks)){const cs=(Eo==null?void 0:Eo[Ks])??(Eo==null?void 0:Eo[Ks.toLowerCase()]);if(cs!=null)return String(cs)}return Bt}catch{return G}}},il=G=>{if(G==null)return;if(typeof G=="number"&&Number.isFinite(G))return G;const Bt=Fa(G);if(!Bt)return;const Ks=Number(Bt);return Number.isFinite(Ks)?Ks:void 0},Hl=Zc.filter(G=>{const Bt=String((G==null?void 0:G.display)||"").toLowerCase();return Bt?!Bt.includes("none")&&Bt!=="display.none":!0}).map(G=>{const Bt=Fa(G==null?void 0:G.color),Ks=il(G==null?void 0:G.offset),cs=il((G==null?void 0:G.showLast)??(G==null?void 0:G.show_last)),ts=il(G==null?void 0:G.precision);return{...G,color:Bt??(G==null?void 0:G.color),offset:Ks,showLast:cs,precision:ts}}),Bf=Et.runtimeDrawOps||[],ai=Et.runtimeLabels||[],Bs=Et.runtimeLines||[],Fn=Et.runtimeBoxes||[],ks=Et.runtimeTables||[],vs=Et.runtimeHeatmaps||[],li=G=>{const Bt=(Ks,cs)=>{Ks.length=0,Array.isArray(cs)&&Ks.push(...cs)};Bt(Bf,G==null?void 0:G.runtimeDrawOps),Bt(ai,G==null?void 0:G.runtimeLabels),Bt(Bs,G==null?void 0:G.runtimeLines),Bt(Fn,G==null?void 0:G.runtimeBoxes),Bt(ks,G==null?void 0:G.runtimeTables),Bt(vs,G==null?void 0:G.runtimeHeatmaps)},ra=Hl.some(G=>String((G==null?void 0:G.type)||"").toLowerCase()==="histogram"),jr=ra,Mr=typeof Et.min=="number"||typeof Et.max=="number",mr=Et.pane==="sub"&&!jr&&!Mr;Et.pane==="sub"&&ra&&Hl.push({name:"__zero__",source:"__zero__",type:"line",color:"rgba(0,0,0,0)",width:0});const Mo=[...Et.levels||[],...Et._trackLevels||[]],La=Et.labels||[],k=Et.lines||[],A={},B=Hl.map(G=>{const Bt=we(G.name||G.source||"plot",Lo);So.push(Bt);const Ks=(G.source||G.name||"").replace(/\s+/g,"_").toLowerCase();Ks&&(A[Ks]=Bt);const cs=(G.type||G.style||"").toLowerCase();return cs==="histogram"?{key:Bt,title:G.name||Bt,type:"bar",baseValue:0}:cs==="bar"?{key:Bt,title:G.name||Bt,type:"bar",baseValue:0}:{key:Bt,title:G.name||Bt,type:"line"}});B.push({key:qa.min,type:"line"},{key:qa.max,type:"line"});const R=Hl.map((G,Bt)=>{var ts;const Ks=String((G==null?void 0:G.type)||"").toLowerCase();return Ks!=="candles"&&Ks!=="ohlc"?null:{key:So[Bt]||((ts=B[Bt])==null?void 0:ts.key)||`plot_${Bt}`,openKey:String((G==null?void 0:G.open)||"open").replace(/\s+/g,"_").toLowerCase(),highKey:String((G==null?void 0:G.high)||"high").replace(/\s+/g,"_").toLowerCase(),lowKey:String((G==null?void 0:G.low)||"low").replace(/\s+/g,"_").toLowerCase(),closeKey:String((G==null?void 0:G.close)||"close").replace(/\s+/g,"_").toLowerCase(),offset:Number.isFinite(G==null?void 0:G.offset)?Math.trunc(G.offset):0,showLast:Number.isFinite(G==null?void 0:G.showLast)?Math.max(0,Math.floor(G.showLast)):0}}).filter(Boolean),U=`${In}_${Et.pane}_${hs}`,q=`${In}__strategy`,ve=(S==null?void 0:S.drawConfig)||{},Re={limits:{...re.limits,...ve.limits||{}},pruningPolicy:ve.pruningPolicy==="lru"||ve.pruningPolicy==="byGroup"?ve.pruningPolicy:re.pruningPolicy,futureBars:Number.isFinite(ve.futureBars)?Math.max(0,Math.floor(ve.futureBars)):re.futureBars,time:{mode:((xa=ve==null?void 0:ve.time)==null?void 0:xa.mode)==="prev"||((Jc=ve==null?void 0:ve.time)==null?void 0:Jc.mode)==="next"?ve.time.mode:re.time.mode,toleranceBars:Number.isFinite((Ua=ve==null?void 0:ve.time)==null?void 0:Ua.toleranceBars)?Math.max(0,Math.floor(ve.time.toleranceBars)):re.time.toleranceBars,toleranceMs:Number.isFinite((ku=ve==null?void 0:ve.time)==null?void 0:ku.toleranceMs)?Math.max(0,Math.floor(ve.time.toleranceMs)):re.time.toleranceMs},decimationPx:Number.isFinite(ve.decimationPx)?Math.max(1,Math.floor(ve.decimationPx)):re.decimationPx},rt={};let Ut="",ls=!1,ns=-1;const Mn=hs===Hn;let qo=!1,Yo="",Nc=null,jd="",cf=null;const bf=2e4,ip=G=>new Promise((Bt,Ks)=>{const cs=new Worker(new URL(""+new URL("../workers/runtime.worker-B3x7EOJS.js",import.meta.url).href,import.meta.url),{type:"module"}),ts=setTimeout(()=>{try{cs.terminate()}catch{}Ks(new Error("Runtime worker timed out"))},bf);cs.onerror=()=>{try{clearTimeout(ts)}catch{}try{cs.terminate()}catch{}Ks(new Error("Runtime worker error"))},cs.onmessage=aa=>{const ko=aa.data;if(!(!ko||ko.id!==G.id)){try{clearTimeout(ts)}catch{}try{cs.terminate()}catch{}if(ko.error){Ks(new Error(String(ko.error)));return}Bt({seriesMap:ko.seriesMap||{},lastPrevSource:ko.lastPrevSource||void 0,diagnostics:Array.isArray(ko.diagnostics)?ko.diagnostics:void 0})}},cs.postMessage(G)}),Bd=Hl.map((G,Bt)=>{var aa;const Ks=(G.source||G.name||"").replace(/\s+/g,"_").toLowerCase();let cs="#22d3ee";/ema\d+/i.test(Ks)?cs=(aa=/ema(\d+)/i.exec(Ks))!=null&&aa[1]&&Number(RegExp.$1)<=20?"#22c55e":"#ef4444":/signal|sig/i.test(Ks)?cs="#f59e0b":/hist|bar/i.test(G.type||G.style||"")&&(cs="#64748b");const ts=(G.type||G.style||"").toLowerCase();return ts==="histogram"?{color:"rgba(0,0,0,0)",size:1e-4,style:vt.Solid}:ts==="dots"||ts==="cross"?{color:"rgba(0,0,0,0)",size:1e-4,style:vt.Solid}:ts==="candles"||ts==="ohlc"?{color:"rgba(0,0,0,0)",size:1e-4,style:vt.Solid}:{color:G.color||cs,size:G.width??2,gradient:G==null?void 0:G.gradient,style:Cf[(G.style||"solid").toLowerCase()]??vt.Solid}});Bd.push({color:"rgba(0,0,0,0)",size:0,style:vt.Solid},{color:"rgba(0,0,0,0)",size:0,style:vt.Solid});const xf=Hl.filter(G=>{const Bt=(G.type||G.style||"").toLowerCase();return Bt==="histogram"||Bt==="bar"}).map(G=>{const Bt=G.color||"#64748b",Ks=G.downColor||Bt;return{style:"fill",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],upColor:Bt,downColor:Ks,noChangeColor:Bt,gradient:G==null?void 0:G.gradient}}),Jd={name:U,shortName:Et.shortName||"Script",precision:4,calcParams:[],figures:B,shouldOhlc:!1,zLevel:gr,minValue:(()=>{const G=Et.pane==="sub",Bt=Hl.some(Ks=>String((Ks==null?void 0:Ks.type)||"").toLowerCase()==="histogram");if(typeof Et.min=="number")return Et.min;if(G&&Bt)return-5})(),maxValue:(()=>{const G=Et.pane==="sub",Bt=Hl.some(Ks=>String((Ks==null?void 0:Ks.type)||"").toLowerCase()==="histogram");if(typeof Et.max=="number")return Et.max;if(G&&Bt)return 5})(),styles:{lines:Bd,...xf.length?{bars:xf}:{}},calc:async G=>{var Pv,xh,dm,Bp,wh,Pm,Km,pg,Tg,mg,o0,Hg,i0,pv,Fg,mv,Mm,Zf,hg,w0,S_,Cy,Iy,C_,Py,I_,My,Ny,Ay,Ty,r1,Fy,Ly,Ey,P_,M_,$y,Dy,N_,Ry,A_,jy,By,Oy,zy,Vy,Wy,Hy,qy,Uy,Gy,Yy,Ky,Xy;const Bt=G.length,Ks=Bt?G[Bt-1]:null,cs=(Ks==null?void 0:Ks.timestamp)??(Ks==null?void 0:Ks.time)??(Ks==null?void 0:Ks.t)??0,ts=typeof cs=="number"?cs:Number(cs),aa=Bt?G[0]:null,ko=(aa==null?void 0:aa.timestamp)??(aa==null?void 0:aa.time)??(aa==null?void 0:aa.t)??0,or=typeof ko=="number"?ko:Number(ko);let pl=0,Nr=0,qr=0,ec=0;if(xl.length)for(const{sym:at,tf:Oe}of xl){const _t=T.getHistorySnapshot(at,Oe),p=Number((_t==null?void 0:_t.lastUpdatedAt)??0);Number.isFinite(p)&&(pl=Math.max(pl,p));const b=((Pv=_t==null?void 0:_t.candles)==null?void 0:Pv.length)??0;Nr+=Number.isFinite(b)?b:0,_t!=null&&_t.error&&(qr+=1),!(_t!=null&&_t.error)&&!(_t!=null&&_t.isComplete)&&(((xh=_t==null?void 0:_t.candles)==null?void 0:xh.length)??0)<2&&(ec+=1)}const da=`${Bt}:${Number.isFinite(or)?or:0}:${Number.isFinite(ts)?ts:0}:${i(nr)?1:0}:${pl}:${Nr}:${qr}:${ec}:${jo}:${ar}:${Hs}`;if(da===Yo&&Nc)return Nc;const Uo={},Qa={},Bn={};let bi=!1;const No=(S==null?void 0:S.params)||{};tp=No;const yo=(at,Oe,_t)=>{if(typeof at=="number"&&Number.isFinite(at))return at;if(typeof at=="string"){const p=Number(at);if(Number.isFinite(p))return p;const b=at.match(/^\$\{([^}]+)\}$/),F=b?b[1]:at,H=No[F],be=typeof H=="number"?H:Number(H);if(Number.isFinite(be))return be}if(Oe&&No[Oe]!=null){const p=No[Oe],b=typeof p=="number"?p:Number(p);if(Number.isFinite(b))return b}return _t??0},_a=at=>{if(typeof at=="number")return Number.isFinite(at)?at:void 0;if(typeof at=="string"){const _t=at.replace(/[^0-9eE+\\-\\.]/g,"");if(!_t||_t==="+"||_t==="-"||_t===".")return;const p=Number(_t);return Number.isFinite(p)?p:void 0}const Oe=Number(at);return Number.isFinite(Oe)?Oe:void 0},xi=new Array(Bt),lr=new Array(Bt),Ai=new Array(Bt),$o=new Array(Bt),Br=new Array(Bt),oa=new Array(Bt),zl=new Array(Bt);for(let at=0;at<Bt;(at+=1)-1){const Oe=G[at],_t=_a((Oe==null?void 0:Oe.close)??(Oe==null?void 0:Oe.c)??(Oe==null?void 0:Oe.price)??(Oe==null?void 0:Oe.value)),p=_a((Oe==null?void 0:Oe.open)??(Oe==null?void 0:Oe.o))??_t,b=_a((Oe==null?void 0:Oe.high)??(Oe==null?void 0:Oe.h))??_t??p,F=_a((Oe==null?void 0:Oe.low)??(Oe==null?void 0:Oe.l))??_t??p,H=_a((Oe==null?void 0:Oe.volume)??(Oe==null?void 0:Oe.vol))??0,be=_a((Oe==null?void 0:Oe.timestamp)??(Oe==null?void 0:Oe.time)??(Oe==null?void 0:Oe.t))??0;$o[at]=_t,xi[at]=p,lr[at]=b,Ai[at]=F,Br[at]=H,oa[at]=be,zl[at]=at}Bn.open=xi,Bn.close=$o,Bn.high=lr,Bn.low=Ai,Bn.volume=Br,Bn.time=oa,Bn.bar_index=zl;let ci=null;const Ur=S==null?void 0:S.__jsSeriesMap,fa=Ur?Object.values(Ur):[],yr=fa.length>0&&fa.every(at=>Array.isArray(at)&&at.length===Bt);Ur&&yr&&(ci=Ur);const Ea=S==null?void 0:S.__jsCode;if(!ci&&Ea){const at=`${Bt}:${Number.isFinite(or)?or:0}:${Number.isFinite(ts)?ts:0}:${jo}`;if(at===jd&&cf)ci=cf;else try{const Oe=await ul({id:`${U}_js_${Bt}_${Number.isFinite(ts)?ts:0}`,code:Ea,base:{open:xi,high:lr,low:Ai,close:$o,volume:Br,time:oa},params:No});if(Oe!=null&&Oe.error)x(Qt,V(String(Oe.error||"JS engine failed"))),x(zt,"Validation failed");else if((dm=Oe==null?void 0:Oe.output)!=null&&dm.seriesMap){ci=Oe.output.seriesMap,cf=ci,jd=at,S.__jsSeriesMap=ci;const _t=Array.isArray((Bp=Oe==null?void 0:Oe.output)==null?void 0:Bp.panes)?Oe.output.panes:[];if(_t.length){const p=(Et==null?void 0:Et.pane)||"main",b=_t.find(F=>((F==null?void 0:F.pane)??"main")===p)||(_t.length===1?_t[0]:null);b&&li(b)}}}catch(Oe){const _t=Oe instanceof Error?Oe.message:"JS engine failed";x(Qt,V(_t)),x(zt,"Validation failed")}}if(ci){const at={};Object.entries(ci).forEach(([Oe,_t])=>{const p=String(Oe||"").replace(/\s+/g,"_").toLowerCase();!p||!Array.isArray(_t)||_t.length!==Bt||(at[p]=_t)}),ci=Object.keys(at).length?at:null}const Zs=at=>{const Oe=new Array(Bt);for(let _t=0;_t<Bt;(_t+=1)-1)Oe[_t]=at;return Oe},us={},gs=mf.get(q),ui=at=>Array.isArray(at)&&at.length===Bt?at:null;us.strategy_position_size=ui(gs==null?void 0:gs.positionSize)??Zs(0),us.strategy_position_avg_price=ui(gs==null?void 0:gs.positionAvgPrice)??Zs(NaN),us.strategy_opentrades=ui(gs==null?void 0:gs.openTrades)??Zs(0),us.strategy_closedtrades=ui(gs==null?void 0:gs.closedTrades)??Zs(0),us.strategy_openprofit=ui(gs==null?void 0:gs.openProfit)??Zs(0),us.strategy_closedprofit=ui(gs==null?void 0:gs.closedProfit)??Zs(0),us.strategy_grossprofit=ui(gs==null?void 0:gs.grossProfit)??Zs(0),us.strategy_grossloss=ui(gs==null?void 0:gs.grossLoss)??Zs(0),us.strategy_wintrades=ui(gs==null?void 0:gs.winTrades)??Zs(0),us.strategy_losstrades=ui(gs==null?void 0:gs.lossTrades)??Zs(0),us.strategy_winrate=ui(gs==null?void 0:gs.winRate)??Zs(0),us.strategy_max_drawdown=ui(gs==null?void 0:gs.maxDrawdownPct)??Zs(0),us.strategy_max_drawdown_value=ui(gs==null?void 0:gs.maxDrawdownValue)??Zs(0),us.strategy_max_runup=ui(gs==null?void 0:gs.maxRunupPct)??Zs(0),us.strategy_max_runup_value=ui(gs==null?void 0:gs.maxRunupValue)??Zs(0),us.strategy_avg_trade=ui(gs==null?void 0:gs.avgTrade)??Zs(0),us.strategy_avg_win=ui(gs==null?void 0:gs.avgWin)??Zs(0),us.strategy_avg_loss=ui(gs==null?void 0:gs.avgLoss)??Zs(0),us.strategy_avg_bars_in_trade=ui(gs==null?void 0:gs.avgBarsInTrade)??Zs(0),us.strategy_equity=ui(gs==null?void 0:gs.equity)??Zs(0),us.strategy_netprofit=ui(gs==null?void 0:gs.netProfit)??Zs(0);const Gr=gs==null?void 0:gs.initialCapital;us.strategy_initial_capital=Zs(typeof Gr=="number"&&Number.isFinite(Gr)?Gr:0);const wa=String(((Pm=(wh=s())==null?void 0:wh.period)==null?void 0:Pm.timeframe)||"1m").trim(),el=wa.match(/^(\d+)\s*([a-zA-Z])$/);let ei=0,ji="";el?(ei=Number(el[1]),ji=el[2]||""):/^\d+$/.test(wa)&&(ei=Number(wa),ji="m");const Ti=ji==="M"?"M":ji.toLowerCase();let Bi=0;if(ei>0&&Ti)try{Bi=mp(`${ei}${Ti}`)}catch{}const qi=Ti==="s",oi=Ti==="m",Jo=Ti==="h",Ar=Ti==="d",$i=Ti==="w",Ui=Ti==="M",wi=Ti==="y",tl=qi||oi||Jo;let _o="";ei>0&&Ti&&(Ti==="m"?_o=String(ei):Ti==="h"?_o=String(ei*60):Ti==="s"?_o=`${ei}S`:Ti==="d"?_o=ei===1?"D":`${ei}D`:Ti==="w"?_o=ei===1?"W":`${ei}W`:Ti==="M"?_o=ei===1?"M":`${ei}M`:Ti==="y"&&(_o=ei===1?"Y":`${ei}Y`)),us.timeframe_multiplier=Zs(ei||0),us.timeframe_seconds=Zs(Bi||0),us.timeframe_isseconds=Zs(qi?1:0),us.timeframe_isminutes=Zs(oi?1:0),us.timeframe_ishours=Zs(Jo?1:0),us.timeframe_isdaily=Zs(Ar?1:0),us.timeframe_isweekly=Zs($i?1:0),us.timeframe_ismonthly=Zs(Ui?1:0),us.timeframe_isyearly=Zs(wi?1:0),us.timeframe_isintraday=Zs(tl?1:0),us.timeframe_period=Zs(yd(_o));const rl=Ns==null?void 0:Ns.pricePrecision,br=typeof rl=="number"?rl:Number(rl),di=Number.isFinite(br)?Math.max(0,Math.floor(br)):2,$a=(Ns==null?void 0:Ns.tickSize)??(Ns==null?void 0:Ns.minTick)??(Ns==null?void 0:Ns.priceStep),ti=typeof $a=="number"?$a:Number($a),ki=Number.isFinite(ti)&&ti>0?ti:1/Math.pow(10,di);us.syminfo_mintick=Zs(ki),us.syminfo_tick_size=Zs(ki);const Or=Ns==null?void 0:Ns.lotSize,Qr=typeof Or=="number"?Or:Number(Or);us.syminfo_lot_size=Zs(Number.isFinite(Qr)?Qr:1);const cr=Ns==null?void 0:Ns.contractSize,ya=typeof cr=="number"?cr:Number(cr);us.syminfo_pointvalue=Zs(Number.isFinite(ya)?ya:1);const Ga=String((Ns==null?void 0:Ns.ticker)||""),zr=String((Ns==null?void 0:Ns.country)||""),ea=zr?`${Ga}@${zr}`:Ga,pa=Ga.split(/[:.]/).pop()||Ga,Ko=String((Ns==null?void 0:Ns.exchange)||(Ns==null?void 0:Ns.market)||""),no=String((Ns==null?void 0:Ns.name)||(Ns==null?void 0:Ns.shortName)||""),Si=String((Ns==null?void 0:Ns.type)||""),ka=String((Ns==null?void 0:Ns.priceCurrency)||""),Xo=String((Ns==null?void 0:Ns.timezone)||(Ns==null?void 0:Ns.sessionTimezone)||((Km=s())==null?void 0:Km.timezone)||"UTC"),Sa=String((Fo==null?void 0:Fo.sessionMode)||"regular").toLowerCase(),tr=String((Ns==null?void 0:Ns.session)||""),Ya=String((Ns==null?void 0:Ns.sessionExtended)||""),ac=Sa==="all"?"24x7":Sa==="extended"&&Ya||tr;us.syminfo_tickerid=Zs(yd(ea)),us.syminfo_ticker=Zs(yd(Ga)),us.syminfo_root=Zs(yd(pa)),us.syminfo_prefix=Zs(yd(Ko)),us.syminfo_exchange=Zs(yd(Ko)),us.syminfo_description=Zs(yd(no)),us.syminfo_type=Zs(yd(Si)),us.syminfo_currency=Zs(yd(ka)),us.syminfo_timezone=Zs(yd(Xo)),us.syminfo_session=Zs(yd(ac)),us.syminfo_session_extended=Zs(yd(Ya)),us.syminfo_isdelayed=Zs(0);const ml=Zs(0),wl=Zs(0),Kl=Zs(0),Dc=Zs(Bt>0?1:0),pc=Zs(0),ru=Zs(Bt>0?1:0),Wc=Zs(Bt>0?1:0);if(Bt>0){ml[0]=1,wl[Bt-1]=1;const at=Pe=>{const Ze=typeof Pe=="number"?Pe:Number(Pe);return!Number.isFinite(Ze)||Ze<=0?0:Ze<1e12?Ze*1e3:Ze},Oe=Date.now(),_t=at(oa[Bt-1]??0),p=Bi>0?Bi*1e3:0,b=((pg=s().options)==null?void 0:pg.enableRealtime)===!0||r().playing===!0,F=Math.max(6e4,p>0?p*2:6e4),H=b&&N.active&&N.lastUpdateAt>0&&Oe-N.lastUpdateAt<=F,be=p>0&&_t>0?Oe<_t+p:H;if(H){be&&(pc[Bt-1]=1,ru[Bt-1]=0),Dc[Bt-1]=be?0:1,Wc.fill(0);const Pe=N.lastNewBarIndex>=0?N.lastNewBarIndex:Bt-1;Pe>=0&&Pe<Bt&&(Wc[Pe]=1);const Ze=be?Bt-2:Bt-1;Ze>=0&&(Kl[Ze]=1)}else Kl[Bt-1]=1}us.barstate_isfirst=ml,us.barstate_islast=wl,us.barstate_islastconfirmedhistory=Kl,us.barstate_isconfirmed=Dc,us.barstate_isrealtime=pc,us.barstate_ishistory=ru,us.barstate_isnew=Wc,Object.entries(us).forEach(([at,Oe])=>{Bn[at]=Oe});const Hc=Hl.some(at=>String((at==null?void 0:at.source)||"").toLowerCase()==="__zero__");let Ca=null;if(Hc){Ca=new Array(Bt);for(let at=0;at<Bt;(at+=1)-1)Ca[at]=0}const au=[];try{const at=(qt||[]).filter(Oe=>String((Oe==null?void 0:Oe.type)||"").toLowerCase()==="security");if(at.length&&Bt>0){const Oe=b=>{let F=String(b??"__CURRENT__");try{F=F.replace(/\$\{([^}]+)\}/g,(be,Pe)=>{var Ke;const Ze=(No==null?void 0:No[Pe])??(No==null?void 0:No[(Ke=Pe==null?void 0:Pe.toLowerCase)==null?void 0:Ke.call(Pe)]);return Ze==null?be:String(Ze)});const H=F.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(H)){const be=(No==null?void 0:No[H])??(No==null?void 0:No[H.toLowerCase()]);be!=null&&(F=String(be))}}catch{}return F};if(at.length>jn.maxCalls)throw new Error("request.security: limit exceeded: too many calls");const _t=new Set,p=new Set;for(const b of at){const F=Go(b==null?void 0:b.symbol,b==null?void 0:b.country,No),H=String((F==null?void 0:F.ticker)||"").trim(),be=String((F==null?void 0:F.country)||"").trim(),Pe=be?`${H}@${be}`:H;_t.add(Pe||"__UNKNOWN__");const Ze=String(Oe((b==null?void 0:b.timeframe)||(b==null?void 0:b.tf)||"__CURRENT__")||"__CURRENT__"),Ke=Ze==="__CURRENT__"?Bl(((mg=(Tg=s())==null?void 0:Tg.period)==null?void 0:mg.timeframe)||"1m"):Ze;p.add(String(Ke||"__CURRENT__"))}if(_t.size>jn.maxSymbols)throw new Error("request.security: limit exceeded: too many symbols");if(p.size>jn.maxTimeframes)throw new Error("request.security: limit exceeded: too many timeframes");if(Bt>jn.maxBars)throw new Error("request.security: limit exceeded: too many bars");for(const b of at){const F=String((b==null?void 0:b.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!F)continue;const H=Go(b==null?void 0:b.symbol,b==null?void 0:b.country,No),be=String(Oe((b==null?void 0:b.timeframe)||(b==null?void 0:b.tf)||"__CURRENT__")||"__CURRENT__"),Pe=be==="__CURRENT__"?((Hg=(o0=s())==null?void 0:o0.period)==null?void 0:Hg.timeframe)||"1m":$c(be),Ze=Xc.get(F),Ke=(Ze==null?void 0:Ze.pipelineTf)||Pe,ut=(Ze==null?void 0:Ze.computeTf)||(be==="__CURRENT__"?Bl(((pv=(i0=s())==null?void 0:i0.period)==null?void 0:pv.timeframe)||"1m"):be),Gt=!!(Ze!=null&&Ze.lower||b!=null&&b.lower),fn=String((H==null?void 0:H.ticker)||"").trim(),$n=String((H==null?void 0:H.country)||"").trim(),cn=bl(ut);if(Gt&&fl>0&&cn>0&&cn>=fl){if(!i(Qt)){const Cl=String(((mv=(Fg=s())==null?void 0:Fg.period)==null?void 0:mv.timeframe)||"");x(Qt,`request.security_lower_tf: "${ut}" must be lower than chart timeframe "${Cl}"`)}Bn[F]=new Array(Bt),au.push(F);continue}const eo=Ke&&Ke!=="__CURRENT__"?`${fn}${$n?`@${$n}`:""}|${Ke}`:"",Js=Ke&&Ke!=="__CURRENT__"?Kt.has(eo)?Kt.get(eo):(()=>{const Cl=T.getHistorySnapshot(H,Ke);return Kt.set(eo,Cl),Cl})():null,Co=Js?Js.candles:null,ws=Number(oa[0]??0),Zn=Number(oa[Bt-1]??0);if(Ke&&Ke!=="__CURRENT__"){const Cl=fm=>{const rp=typeof fm=="number"?fm:Number(fm);return!Number.isFinite(rp)||rp<=0?0:rp<1e12?rp*1e3:rp},cu=Cl(ws),Wf=Cl(Zn),kh=Co&&Co.length>=2,Xm=Co&&Co.length?Number(((Mm=Co[0])==null?void 0:Mm.timestamp)??((Zf=Co[0])==null?void 0:Zf.time)??((hg=Co[0])==null?void 0:hg.t)??0):0,z0=Co&&Co.length?Number(((w0=Co[Co.length-1])==null?void 0:w0.timestamp)??((S_=Co[Co.length-1])==null?void 0:S_.time)??((Cy=Co[Co.length-1])==null?void 0:Cy.t)??0):0,qg=Cl((Js==null?void 0:Js.oldestTimestampLoaded)??Xm),Sh=Cl((Js==null?void 0:Js.newestTimestampLoaded)??z0),Lg=kh&&cu>0&&Wf>0&&qg>0&&Sh>0&&qg<=Wf&&Sh>=cu,em=Lg&&qg<=cu&&Sh>=Wf;if(!kh||!Lg){const fm=String((H==null?void 0:H.ticker)||""),rp=String((H==null?void 0:H.country)||"");if(Js!=null&&Js.error)i(Qt)||x(Qt,`request.security: ${fm}${rp?`@${rp}`:""} (${Ke}) error: ${Js.error}`);else if(Js!=null&&Js.isComplete){if(!i(Qt)){const Nm=!kh||!(Co&&Co.length);if(Gt&&Nm){const Zm=fl>0?Math.round(fl/60):0;x(Qt,`request.security error: request.security: lower timeframe "${ut}" is not available from current chart data${Zm?` (base ~${Zm}m)`:""}. Switch chart timeframe lower or provide lower-TF datafeed.`)}else x(Qt,V(Nm?`request.security: no data for ${fm}${rp?`@${rp}`:""} (${Ke})`:`request.security: no overlap for ${fm}${rp?`@${rp}`:""} (${Ke})`))}}else if(i(zt)==="Running..."||i(zt)==="Plotted from Pine"||i(zt)==="Plotted from DSL"){const Nm=Js!=null&&Js.oldestTimestampLoaded?new Date(Js.oldestTimestampLoaded).toISOString().slice(0,10):"?",Zm=Js!=null&&Js.newestTimestampLoaded?new Date(Js.newestTimestampLoaded).toISOString().slice(0,10):"?";x(zt,`Loading request.security: ${fm}${rp?`@${rp}`:""} (${Ke})… loaded ${Nm}→${Zm}`)}Bn[F]=new Array(Bt),au.push(F);continue}if(!em&&!(Js!=null&&Js.error)&&!(Js!=null&&Js.isComplete)&&(i(zt)==="Running..."||i(zt)==="Plotted from Pine"||i(zt)==="Plotted from DSL")){const fm=String((H==null?void 0:H.ticker)||""),rp=String((H==null?void 0:H.country)||""),Nm=Js!=null&&Js.oldestTimestampLoaded?new Date(Js.oldestTimestampLoaded).toISOString().slice(0,10):"?",Zm=Js!=null&&Js.newestTimestampLoaded?new Date(Js.newestTimestampLoaded).toISOString().slice(0,10):"?";x(zt,`Loading request.security (partial): ${fm}${rp?`@${rp}`:""} (${Ke})… loaded ${Nm}→${Zm}`)}}const Ss=String((b==null?void 0:b.expr)||"close"),Fr=hi?Z_(Ss,{pineV2:!0}).expr:String(Ss??"").trim(),Ra=String((b==null?void 0:b.lookahead)||"off").toLowerCase(),xc=Ra==="on"||Ra.includes("on")&&!Ra.includes("off")?"on":"off",Nl=String((b==null?void 0:b.gaps)||"off").toLowerCase(),Qc=Nl==="on"||Nl.includes("on")&&!Nl.includes("off")?"on":"off",al=`${xi[Bt-1]??""}|${lr[Bt-1]??""}|${Ai[Bt-1]??""}|${$o[Bt-1]??""}|${Br[Bt-1]??""}`,Hd=Co&&Co.length?Number(((Iy=Co[0])==null?void 0:Iy.timestamp)??((C_=Co[0])==null?void 0:C_.time)??0):0,Zi=Co&&Co.length?Number(((Py=Co[Co.length-1])==null?void 0:Py.timestamp)??((I_=Co[Co.length-1])==null?void 0:I_.time)??0):0,Xu=String((H==null?void 0:H.timezone)||(H==null?void 0:H.sessionTimezone)||((My=s())==null?void 0:My.timezone)||"UTC"),Jf=Po(H)||Po(Ns)||"",Cu=`sym=${fn}${$n?`@${$n}`:""}|tf=${ut}|srcTf=${Ke}|srcLen=${Co?Co.length:0}|src0=${Hd}|srcN=${Zi}|la=${xc}|gaps=${Qc}|lower=${Gt?1:0}|expr=${Fr}|len=${Bt}|t0=${ws}|tN=${Zn}|tail=${al}|tz=${Xu}|session=${Jf}`,Sl=Jn.get(Cu),ff=Sl&&Sl.len===Bt&&Sl.firstTime===ws&&Sl.lastTime===Zn&&Sl.tailSig===al?Sl.out:(()=>{const Cl=eR({timestamps:oa,open:xi,high:lr,low:Ai,close:$o,volume:Br,sourceCandles:Co||void 0,timeframe:ut,expr:Ss,lookahead:xc,gaps:Qc,scalars:No,userFunctions:S==null?void 0:S.userFunctions,timezone:Xu,session:Jf,allowLowerTfFallback:!Gt});return Jn.set(Cu,{out:Cl,len:Bt,firstTime:ws,lastTime:Zn,tailSig:al}),Cl})();try{let Cl=!1;const cu=Math.max(0,Bt-250);for(let Wf=Bt-1;Wf>=cu;(Wf-=1)+1){const kh=ff[Wf];if(kh!=null&&Number.isFinite(kh)){Cl=!0;break}}if(!Cl&&!i(Qt)){const Wf=String((H==null?void 0:H.ticker)||""),kh=String((H==null?void 0:H.country)||"");x(zt,`request.security: no overlap for ${Wf}${kh?`@${kh}`:""} (${Ke}) — try a more recent chart range or switch chart timeframe`)}}catch{}Bn[F]=ff,au.push(F)}}}catch(at){const Oe=(at==null?void 0:at.message)!=null?String(at.message):String(at);console.error("[ScriptStudio] request.security error",at),i(Qt)||x(Qt,`request.security error: ${Oe}`)}const zd=()=>{if(Ls.length&&Bt>0)try{const at={open:new Float32Array(Bt),high:new Float32Array(Bt),low:new Float32Array(Bt),close:new Float32Array(Bt),volume:new Float32Array(Bt),time:new Float32Array(Bt),bar_index:new Float32Array(Bt)};for(let p=0;p<Bt;(p+=1)-1)at.open[p]=xi[p]??NaN,at.high[p]=lr[p]??NaN,at.low[p]=Ai[p]??NaN,at.close[p]=$o[p]??NaN,at.volume[p]=Br[p]??0,at.time[p]=oa[p]??0,at.bar_index[p]=zl[p]??p;const Oe=p=>{if(!at[p]){if(p==="hl2"){const b=new Float32Array(Bt);for(let F=0;F<Bt;(F+=1)-1){const H=lr[F],be=Ai[F];b[F]=H==null||be==null?NaN:(H+be)/2}at[p]=b}else if(p==="hlc3"){const b=new Float32Array(Bt);for(let F=0;F<Bt;(F+=1)-1){const H=lr[F],be=Ai[F],Pe=$o[F];b[F]=H==null||be==null||Pe==null?NaN:(H+be+Pe)/3}at[p]=b}else if(p==="ohlc4"){const b=new Float32Array(Bt);for(let F=0;F<Bt;(F+=1)-1){const H=xi[F],be=lr[F],Pe=Ai[F],Ze=$o[F];b[F]=H==null||be==null||Pe==null||Ze==null?NaN:(H+be+Pe+Ze)/4}at[p]=b}}};No&&typeof No=="object"&&Object.entries(No).forEach(([p,b])=>{if(typeof b!="string")return;const F=String(p).replace(/\s+/g,"_").toLowerCase(),H=String(b).replace(/\s+/g,"_").toLowerCase();Oe(H);const be=at[H];if(be){at[F]=be;const Pe=new Array(Bt);for(let Ze=0;Ze<Bt;(Ze+=1)-1){const Ke=be[Ze];Pe[Ze]=Number.isFinite(Ke)?Ke:void 0}Bn[F]=Pe}});for(const p of au){const b=Bn[p];if(!b)continue;const F=new Float32Array(Bt);for(let H=0;H<Bt;(H+=1)-1)F[H]=b[H]??NaN;at[p]=F}Object.entries(us).forEach(([p,b])=>{if(!b)return;const F=new Float32Array(Bt);for(let H=0;H<Bt;(H+=1)-1)F[H]=b[H]??NaN;at[p]=F});const _t=g_(Ls.map((p,b)=>({name:String(p.name||`series_${b}`),expr:js(String(p.expr||"").replace(/\$\{([^}]+)\}/g,(F,H)=>String(No[H]??F)))})),at,No,sc.get(q),ze,{loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(_t).forEach(([p,b])=>{const F=p.replace(/\s+/g,"_").toLowerCase(),H=new Array(Bt);for(let be=0;be<Bt;(be+=1)-1)H[be]=b[be];Bn[F]=H})}catch(at){const Oe=(at==null?void 0:at.message)!=null?String(at.message):String(at);console.error("[ScriptStudio] expression engine error",at),i(Qt)||x(Qt,`Expression error: ${Oe}`),i(zt)||x(zt,"Expression error")}eJ({seriesMap:Bn,calcDefs:qt,len:Bt,params:No,lastPrevSource:rt,resolveNum:yo,onError:(at,Oe)=>{Oe&&console.error("[ScriptStudio] expr eval error",Oe),i(Qt)||x(Qt,V(at)),i(zt)||x(zt,"Expression error")}})};if(Bt>0&&(sn.length||qt.length||Ot.length)){const at={...us};if(au.length&&au.forEach(_t=>{const p=Bn[_t];p&&(at[_t]=p)}),Ca&&(at.__zero__=Ca),ci&&Object.entries(ci).forEach(([_t,p])=>{!Array.isArray(p)||p.length!==Bt||(at[_t]=p)}),(()=>{const _t=/\bstrategy[._](closedtrades|opentrades)[._]/i,p=b=>_t.test(String(b??""));return!!(sn.some(b=>p(b==null?void 0:b.expr))||Ot.some(b=>p(b==null?void 0:b.initExpr)||p(b==null?void 0:b.updateExpr)||p(b==null?void 0:b.expr))||qt.some(b=>p(b==null?void 0:b.expr)||p(b==null?void 0:b.when)))})())zd();else try{const _t=`${U}_rt_${Bt}_${Number.isFinite(ts)?ts:0}`,p=mr?"calc_only":"full",b=await ip({id:_t,base:{open:xi,high:lr,low:Ai,close:$o,volume:Br,time:oa},calc:qt,series:sn,stateSeries:Ot,params:No,extraSeries:at,stage:p,autoSortStateSeries:wt,loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});b.diagnostics&&De.size>=0&&b.diagnostics.forEach(H=>{const be=String(H||"").trim();be&&(De.has(be)||De.set(be,H))});const F=b.seriesMap||{};Object.keys(Bn).forEach(H=>delete Bn[H]),Object.entries(F).forEach(([H,be])=>{Bn[H]=be}),b.lastPrevSource&&Object.assign(rt,b.lastPrevSource),bi=p==="full"}catch(_t){console.warn("[ScriptStudio] runtime worker fallback",_t),zd()}}else zd();if(Hc){if(!Ca){Ca=new Array(Bt);for(let at=0;at<Bt;(at+=1)-1)Ca[at]=0}Bn.__zero__=Ca}if(Et.pane==="sub"){const at=new Set,Oe=new Set;Hl.forEach(p=>{const b=(p.source||p.name||"").replace(/\s+/g,"_").toLowerCase();b&&at.add(b),String(p.type||"").toLowerCase()==="histogram"&&b&&Oe.add(b)}),(Et.labels||[]).forEach(p=>{const b=((p==null?void 0:p.source)||(p==null?void 0:p.name)||"").replace(/\s+/g,"_").toLowerCase();b&&at.add(b)}),(Ny=Et.fills)==null||Ny.forEach(p=>{(Array.isArray(p==null?void 0:p.between)?p.between:[]).forEach(F=>{const H=String(F||"").replace(/\s+/g,"_").toLowerCase();H&&at.add(H)})});const _t=(p,b)=>{let F=1/0,H=-1/0;for(let Ke=0;Ke<p.length;(Ke+=1)-1){const ut=p[Ke];ut==null||Number.isNaN(ut)||(ut<F&&(F=ut),ut>H&&(H=ut))}const be=H-F;if(!(H>200||F<-50||be>200))return p;const Ze=new Array(p.length);if(be>1e-8){for(let Ke=0;Ke<p.length;(Ke+=1)-1){const ut=p[Ke];Ze[Ke]=ut==null?void 0:(ut-F)/be*100}return Ze}if(b){for(let Ke=0;Ke<p.length;(Ke+=1)-1){const ut=p[Ke],Gt=b[Ke];Ze[Ke]=ut==null||Gt===void 0||Gt===null||Gt===0?void 0:ut/Gt*50+50}return Ze}return p};!jr&&!Mr&&at.forEach(p=>{Bn[p]&&!Oe.has(p)&&!/hist|macd|signal/i.test(p)&&(Bn[p]=_t(Bn[p],Bn.close))})}if(!bi&&Ls.length&&Bt>0)try{const at=new Set(Ls.map((p,b)=>String((p==null?void 0:p.name)||`series_${b}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Oe={};Object.entries(Bn).forEach(([p,b])=>{const F=String(p||"").replace(/\s+/g,"_").toLowerCase();if(at.has(F))return;const H=new Float32Array(Bt);for(let be=0;be<Bt;(be+=1)-1)H[be]=b[be]??NaN;Oe[F]=H});const _t=g_(Ls.map((p,b)=>({name:String(p.name||`series_${b}`),expr:js(String(p.expr||"").replace(/\$\{([^}]+)\}/g,(F,H)=>String(No[H]??F)))})),Oe,No,sc.get(q),ze,{loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(_t).forEach(([p,b])=>{const F=p.replace(/\s+/g,"_").toLowerCase(),H=new Array(Bt);for(let be=0;be<Bt;(be+=1)-1)H[be]=b[be];Bn[F]=H})}catch(at){const Oe=(at==null?void 0:at.message)!=null?String(at.message):String(at);console.error("[ScriptStudio] expression engine error (2nd pass)",at),i(Qt)||x(Qt,`Expression error: ${Oe}`),i(zt)||x(zt,"Expression error")}const uf=Ot.filter(at=>/^__arr_/i.test(String((at==null?void 0:at.name)||""))),mu=Ot.filter(at=>!/^__arr_/i.test(String((at==null?void 0:at.name)||"")));if(!bi&&uf.length&&Bt>0)try{const at={};Object.entries(Bn).forEach(([_t,p])=>{const b=String(_t||"").replace(/\s+/g,"_").toLowerCase(),F=new Float32Array(Bt);for(let H=0;H<Bt;(H+=1)-1)F[H]=p[H]??NaN;at[b]=F});const Oe=Fk(uf.map((_t,p)=>({name:String((_t==null?void 0:_t.name)||`state_${p}`),initExpr:(_t==null?void 0:_t.initExpr)!=null?js(String(_t.initExpr).replace(/\$\{([^}]+)\}/g,(b,F)=>String(No[F]??b))):void 0,updateExpr:js(String((_t==null?void 0:_t.updateExpr)??(_t==null?void 0:_t.expr)??"").replace(/\$\{([^}]+)\}/g,(b,F)=>String(No[F]??b))),selfMode:_t==null?void 0:_t.selfMode})),at,No,sc.get(q),{autoSort:wt,diagnostics:ze,loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(Oe).forEach(([_t,p])=>{const b=_t.replace(/\s+/g,"_").toLowerCase(),F=new Array(Bt);for(let H=0;H<Bt;(H+=1)-1)F[H]=p[H];Bn[b]=F})}catch(at){const Oe=(at==null?void 0:at.message)!=null?String(at.message):String(at);console.error("[ScriptStudio] state series error",at),i(Qt)||x(Qt,`Expression error: ${Oe}`),i(zt)||x(zt,"Expression error")}if(!bi&&Ys.length&&Bt>0)try{const at=new Set(Ys.map((p,b)=>String((p==null?void 0:p.name)||`series_${b}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Oe={};Object.entries(Bn).forEach(([p,b])=>{const F=String(p||"").replace(/\s+/g,"_").toLowerCase();if(at.has(F))return;const H=new Float32Array(Bt);for(let be=0;be<Bt;(be+=1)-1)H[be]=b[be]??NaN;Oe[F]=H});const _t=g_(Ys.map((p,b)=>({name:String(p.name||`series_${b}`),expr:js(String(p.expr||"").replace(/\$\{([^}]+)\}/g,(F,H)=>String(No[H]??F)))})),Oe,No,sc.get(q),ze,{loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(_t).forEach(([p,b])=>{const F=p.replace(/\s+/g,"_").toLowerCase(),H=new Array(Bt);for(let be=0;be<Bt;(be+=1)-1)H[be]=b[be];Bn[F]=H})}catch(at){const Oe=(at==null?void 0:at.message)!=null?String(at.message):String(at);console.error("[ScriptStudio] expression engine error (array pass)",at),i(Qt)||x(Qt,`Expression error: ${Oe}`),i(zt)||x(zt,"Expression error")}if(!bi&&mu.length&&Bt>0)try{const at={};Object.entries(Bn).forEach(([_t,p])=>{const b=String(_t||"").replace(/\s+/g,"_").toLowerCase(),F=new Float32Array(Bt);for(let H=0;H<Bt;(H+=1)-1)F[H]=p[H]??NaN;at[b]=F});const Oe=Fk(mu.map((_t,p)=>({name:String((_t==null?void 0:_t.name)||`state_${p}`),initExpr:(_t==null?void 0:_t.initExpr)!=null?js(String(_t.initExpr).replace(/\$\{([^}]+)\}/g,(b,F)=>String(No[F]??b))):void 0,updateExpr:js(String((_t==null?void 0:_t.updateExpr)??(_t==null?void 0:_t.expr)??"").replace(/\$\{([^}]+)\}/g,(b,F)=>String(No[F]??b))),selfMode:_t==null?void 0:_t.selfMode})),at,No,sc.get(q),{autoSort:wt,diagnostics:ze,loopPlans:S==null?void 0:S.loopPlans,userFunctions:S==null?void 0:S.userFunctions});Object.entries(Oe).forEach(([_t,p])=>{const b=_t.replace(/\s+/g,"_").toLowerCase(),F=new Array(Bt);for(let H=0;H<Bt;(H+=1)-1)F[H]=p[H];Bn[b]=F})}catch(at){const Oe=(at==null?void 0:at.message)!=null?String(at.message):String(at);console.error("[ScriptStudio] state series error",at),i(Qt)||x(Qt,`Expression error: ${Oe}`),i(zt)||x(zt,"Expression error")}ci&&Object.entries(ci).forEach(([at,Oe])=>{const _t=String(at||"").replace(/\s+/g,"_").toLowerCase();!Array.isArray(Oe)||Oe.length!==Bt||(Bn[_t]=Oe)});const hu={};B.forEach(at=>{hu[at.key]=new Array(Bt)});const id=new Array(Bt),lu=[];for(let at=0;at<Bt;(at+=1)-1){const Oe={};Hl.forEach((p,b)=>{const F=So[b]||B[b].key,H=(p.source||p.name||"").replace(/\s+/g,"_").toLowerCase(),be=Bn[H]||Bn[F]||Bn.close,Pe=yo(p==null?void 0:p.offset,void 0,0),Ze=Number.isFinite(Pe)?Math.trunc(Pe):0,Ke=at-Ze,ut=yo((p==null?void 0:p.showLast)??(p==null?void 0:p.show_last),void 0,NaN),Gt=Number.isFinite(ut)?Math.max(0,Math.floor(ut)):0,$n=(!Gt||at>=Bt-Gt)&&Ke>=0&&Ke<be.length?be[Ke]:void 0;Oe[F]=$n,hu[F][at]=$n}),Oe.__open=Bn.open[at],Oe.__close=Bn.close[at],Oe.__high=Bn.high[at],Oe.__low=Bn.low[at],R.length&&R.forEach(p=>{const b=Bn[p.openKey]||Bn.open,F=Bn[p.highKey]||Bn.high,H=Bn[p.lowKey]||Bn.low,be=Bn[p.closeKey]||Bn.close;if(!b||!F||!H||!be)return;const Pe=Number.isFinite(p.offset)?p.offset:0,Ze=at-Pe,Ke=Number.isFinite(p.showLast)?p.showLast:0,ut=!Ke||at>=Bt-Ke,Gt=fn=>ut&&Ze>=0&&Ze<fn.length?fn[Ze]:void 0;Oe[`${p.key}__open`]=Gt(b),Oe[`${p.key}__high`]=Gt(F),Oe[`${p.key}__low`]=Gt(H),Oe[`${p.key}__close`]=Gt(be)}),id[at]=Oe;const _t=((Ay=G[at])==null?void 0:Ay.timestamp)??((Ty=G[at])==null?void 0:Ty.time)??((r1=G[at])==null?void 0:r1.t);if(typeof _t=="number"){const p=String(_t);Uo[p]=Oe,Qa[p]=at;const b=_t<1e12?Math.floor(_t*1e3):Math.floor(_t);lu.push(b),Qa[`${b}_ms`]=at,Qa[`${Math.floor(b/1e3)}_s`]=at}}let Ia=0;if(lu.length>=2){let at=0;for(let Oe=1;Oe<lu.length;(Oe+=1)-1)at+=Math.abs(lu[Oe]-lu[Oe-1]);Ia=at/(lu.length-1)}const Kf=[];Hl.forEach((at,Oe)=>{if(!(at!=null&&at.trackPrice))return;const _t=So[Oe]||B[Oe].key,p=hu[_t];if(!p||!p.length)return;let b=NaN;for(let F=p.length-1;F>=0;(F-=1)+1){const H=p[F];if(H!=null&&Number.isFinite(H)){b=H;break}}Number.isFinite(b)&&Kf.push({value:b,color:at.color||"#94a3b8",width:1,style:"dashed"})}),Et._trackLevels=Kf;const Vr={},Of=at=>{const Oe=new Float32Array(Bt);for(let _t=0;_t<Bt;(_t+=1)-1){const p=at[_t];Oe[_t]=p??NaN}return Oe};Object.entries(Bn).forEach(([at,Oe])=>{Vr[at.replace(/\s+/g,"_").toLowerCase()]=Of(Oe)}),Object.entries(hu).forEach(([at,Oe])=>{Vr[at]=Of(Oe)}),ci&&Object.entries(ci).forEach(([at,Oe])=>{Array.isArray(Oe)&&(Vr[at]||(Vr[at]=Of(Oe)))});try{Object.entries(A).forEach(([at,Oe])=>{const _t=String(at||"").replace(/\s+/g,"_").toLowerCase(),p=String(Oe||"");!_t||!p||Vr[_t]||Vr[p]&&(Vr[_t]=Vr[p])})}catch{}{const at=Object.keys(Vr);for(const Oe of at){if(!Oe.includes("_"))continue;const _t=Oe.replace(/_/g,"");!_t||_t===Oe||Vr[_t]||(Vr[_t]=Vr[Oe])}}const Tf=new Map,Rl=new Map,Ff=new Map,df=new Map,Qd="condition must be bool or number",Yu=at=>{let Oe=String(at||"").replace(/\$\{([^}]+)\}/g,(p,b)=>String(No[b]??p));Oe=Oe.replace(/\/\/.*$/,"").replace(/#.*$/,""),Oe=Oe.split(";")[0],Oe=Oe.replace(/[,;]+\s*$/,""),Oe=Oe.replace(/\b(and|or)\b\s*$/i,""),Oe=Oe.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),Oe=Oe.replace(/\bcrosses\s+below\b/gi,"crossesBelow");const _t=js(Oe);return Qb(_t)},nf=at=>{const Oe=Yu(at);if(!Oe)return null;const _t=Ff.get(Oe);if(_t)return _t;try{const p=Ap(Oe);return Ff.set(Oe,p),p}catch{return null}},pp=at=>{const Oe=Yu(at);if(!Oe)return!1;const _t=df.get(Oe);if(_t!=null)return _t;const p=nf(at),b=p?s0(p):!1;return df.set(Oe,b),b},Ka=at=>{const Oe=Yu(at);if(!Oe)return null;const _t=Tf.get(Oe);if(_t)return _t;try{const p=_b(Oe,Vr,No,sc.get(q),ze);return Tf.set(Oe,p),p}catch(p){const b=(p==null?void 0:p.message)!=null?String(p.message):String(p);return i(Qt)||x(Qt,`Expression error: ${b}`),i(zt)||x(zt,"Expression error"),null}},Ru=at=>{const Oe=Yu(at);if(!Oe)return null;const _t=Rl.get(Oe);if(_t)return _t;if(ie&&pp(at)){ze==null||ze.emitOnce(`cond_type:${Oe}`,Qd);const H=new Uint8Array(Bt);return Rl.set(Oe,H),H}const p=Ka(at);if(!p)return null;const b=new Uint8Array(Bt),F=ie?`cond_na:${Oe}`:"";for(let H=0;H<Bt;(H+=1)-1){const be=p[H];b[H]=ie?y0(be,ze,F)?1:0:Number.isFinite(be)&&be!==0?1:0}return Rl.set(Oe,b),b},Xf=(at,Oe)=>{const _t=String(at||"").trim(),p=String(Oe||"").trim(),b=_t||p;return b?Ru(b):null};if(Mn&&!qo&&sn.length){try{const Oe=sn.map(_t=>String((_t==null?void 0:_t.name)||"")).map(_t=>_t.replace(/\s+/g,"_").toLowerCase()).filter(Boolean).filter(_t=>!(_t in Bn));if(Oe.length){const _t=`Missing series: ${Oe.slice(0,6).join(", ")}${Oe.length>6?", ...":""}`;x(Qt,V(i(Qt)?`${i(Qt)} • ${_t}`:_t))}}catch{}qo=!0}const zf=[],Qp=new Map,bp=new Map,Cm=at=>js(String(at||"").replace(/\$\{([^}]+)\}/g,(Oe,_t)=>String(No[_t]??Oe))),mc=at=>Nn(String(at||"").replace(/\$\{([^}]+)\}/g,(Oe,_t)=>String(No[_t]??Oe))),Ku=at=>{const Oe=mc(at);if(!Oe)return null;const _t=Qp.get(Oe);if(_t)return _t;try{const p=Ek(Oe,Vr,No,sc.get(q),ze);return Qp.set(Oe,p),p}catch(p){const b=(p==null?void 0:p.message)!=null?String(p.message):String(p);return i(Qt)||x(Qt,`Expression error: ${b}`),i(zt)||x(zt,"Expression error"),null}},Xh=at=>{const Oe=Cm(at);if(!Oe)return null;const _t=bp.get(Oe);if(_t)return _t;try{const p=_b(Oe,Vr,No,sc.get(q),ze);return bp.set(Oe,p),p}catch(p){const b=(p==null?void 0:p.message)!=null?String(p.message):String(p);return i(Qt)||x(Qt,`Expression error: ${b}`),i(zt)||x(zt,"Expression error"),null}},xp=(at,Oe,_t)=>{if(!at)return _t;const p=at[Oe];if(p==null)return _t;const b=String(p);return b||_t},Im=(at,Oe,_t)=>{if(!at)return _t;const p=at[Oe];return Number.isFinite(p)?p:_t};if(i(nr)&&Array.isArray(La)&&La.length){const at=ie?Ee.labels:((Fy=S==null?void 0:S.style)==null?void 0:Fy.labelLimit)??((Ly=Et==null?void 0:Et.style)==null?void 0:Ly.labelLimit)??(Et==null?void 0:Et.labelLimit),Oe=(()=>{const F=typeof at=="number"?at:Number(at);return Number.isFinite(F)?Math.max(0,Math.floor(F)):600})();let _t=0,p=!1,b=!1;for(const F of La){if(p)break;if(!F)continue;const H=String(F.whenExpr||"").trim(),be=String(F.when||"").trim();if(!H&&!be)continue;const Pe=!ie&&String(F.shape||"").toLowerCase()==="text"&&String(F.text||"").trim().length<=1;let Ze;const Ke=Xf(H,be);if(!Ke)continue;Ze=Ke;const ut=(F.source||F.name||"").replace(/\s+/g,"_").toLowerCase(),Gt=ut==="open"||ut==="high"||ut==="low"||ut==="close"||ut==="volume"||ut==="time",fn=A[ut],$n=fn||((Ey=B[0])==null?void 0:Ey.key);if(!Pe&&(Oe===0||_t>=Oe)){ie&&!b&&(lt("labels",Oe),b=!0),p=!0;break}const cn=[];for(let Cu=0;Cu<Bt;(Cu+=1)-1)Ze[Cu]&&cn.push(Cu);if(!cn.length)continue;const eo=Pe?cn.length:Math.max(0,Oe-_t);if(eo<=0){ie&&!b&&(lt("labels",Oe),b=!0),Pe||(p=!0);break}!Pe&&cn.length>eo&&ie&&!b&&(lt("labels",Oe),b=!0);const Js=cn.length<=eo?cn:(()=>{const Cu=Math.max(1,Math.ceil(cn.length/eo)),Sl=[];for(let ff=cn.length-1;ff>=0&&Sl.length<eo;ff-=Cu)Sl.push(cn[ff]);return Sl.sort((ff,Cl)=>ff-Cl),Sl})(),Co=String(F.textExpr||"").trim(),ws=Co?Ku(Co):null,Zn=String(F.colorExpr||"").trim(),Ss=Zn?Ku(Zn):null,Fr=String(F.bgColorExpr||"").trim(),Ra=Fr?Ku(Fr):null,xc=String(F.borderColorExpr||"").trim(),Nl=xc?Ku(xc):null,Qc=String(F.textColorExpr||"").trim(),al=Qc?Ku(Qc):null,Hd=String(F.sizeExpr||"").trim(),Zi=Hd?Xh(Hd):null,Xu=String(F.offsetYExpr||"").trim(),Jf=Xu?Xh(Xu):null;for(const Cu of Js){if(!Pe&&_t>=Oe){p=!0;break}const Sl=id[Cu]||(id[Cu]={});let ff=(ut&&Bn[ut]?Bn[ut][Cu]:void 0)??(fn?Sl[fn]:void 0)??($n?Sl[$n]:void 0);if(Et.pane==="sub"&&Gt&&$n&&Sl[$n]!==void 0&&Sl[$n]!==null&&Number.isFinite(Sl[$n])&&(ff=Sl[$n]),Et.pane==="sub"&&typeof Et.min=="number"&&typeof Et.max=="number"&&Gt&&typeof ff=="number"&&Number.isFinite(ff)&&(ff<Et.min-5||ff>Et.max+5)&&(ff=$n?Sl[$n]:ff),ff==null||Number.isNaN(ff)){const rp=A.__zero__||"__zero__",Nm=Sl[rp];ff=Nm??0}const Cl=Gt&&ut||$n,cu=`__label_${Cl}_${F.position||"above"}`,Wf=F.text!=null?String(F.text):ws?String(ws[Cu]??""):"",kh=xp(Ss,Cu,F.color||"#f97316"),Xm=xp(Ra,Cu,F.bgColor),z0=xp(Nl,Cu,F.borderColor),qg=xp(al,Cu,F.textColor),Sh=Im(Zi,Cu,F.size),Lg=Im(Jf,Cu,F.offsetY);Sl[cu]={text:Wf,color:kh,yKey:Cl,position:F.position||"above",offset:F.offset,value:ff,shape:F.shape,callout:F.callout,bgColor:Xm,bgGradient:F.bgGradient??F.gradient,borderColor:z0,textColor:qg,size:Sh,offsetY:Lg,wrap:F.wrap,maxWidth:F.maxWidth,padding:F.padding,bgOpacity:F.bgOpacity,borderWidth:F.borderWidth,radius:F.radius,align:F.align,valign:F.valign,lineHeight:F.lineHeight,fontFamily:F.fontFamily,fontSize:F.fontSize,fontWeight:F.fontWeight,monospace:F.monospace};const em=((P_=G[Cu])==null?void 0:P_.timestamp)??((M_=G[Cu])==null?void 0:M_.time)??(($y=G[Cu])==null?void 0:$y.t),fm=typeof em=="number"&&Number.isFinite(em)?em<1e12?Math.floor(em*1e3):Math.floor(em):void 0;zf.push({index:Cu,ts:em,tsMs:fm,meta:Sl[cu]}),Pe||(_t+=1);try{W5("label",{pane:Et.pane,index:Cu,meta:Sl[cu]})}catch{}}}}const Ym=new Map,Bh=new Map,Oh=new Map,Iv=new Map,Vd=/\b(?:line|label|box|table)_get_[a-z0-9_]+\s*\(/i;let ju=null;const Wp=at=>js(String(at||"").replace(/\$\{([^}]+)\}/g,(Oe,_t)=>String(No[_t]??Oe))),fv=at=>Nn(String(at||"").replace(/\$\{([^}]+)\}/g,(Oe,_t)=>String(No[_t]??Oe))),se=(at,Oe)=>{const _t=Wp(at);if(!_t)return null;const p=Ym.get(_t);if(p)return p;const b=_t.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(b){const F=b[0].replace(/\s+/g,"_").toLowerCase(),H=Vr==null?void 0:Vr[F];if(H)return Ym.set(_t,H),H;const be=(Bn==null?void 0:Bn[F])??(ci?ci[F]:void 0);if(Array.isArray(be)){const Pe=Of(be);return Vr[F]=Pe,Ym.set(_t,Pe),Pe}}try{const F=_b(_t,Vr,No,sc.get(q),ze);return Ym.set(_t,F),F}catch(F){const H=(F==null?void 0:F.message)!=null?String(F.message):String(F);return i(Qt)||x(Qt,`Expression error: ${H}`),i(zt)||x(zt,"Expression error"),null}},Ft=(at,Oe)=>{const _t=fv(at);if(!_t)return null;const p=Bh.get(_t);if(p)return p;try{const b=Ek(_t,Vr,No,sc.get(q),ze);return Bh.set(_t,b),b}catch(b){const F=(b==null?void 0:b.message)!=null?String(b.message):String(b);return i(Qt)||x(Qt,`Expression error: ${F}`),i(zt)||x(zt,"Expression error"),null}},dt=at=>{const Oe=Wp(at);if(!Oe)return null;let _t=Oh.get(Oe);if(_t)return _t;try{return _t=Ap(Oe),Oh.set(Oe,_t),_t}catch(p){const b=(p==null?void 0:p.message)!=null?String(p.message):String(p);return i(Qt)||x(Qt,`Expression error: ${b}`),i(zt)||x(zt,"Expression error"),null}},on=(at,Oe,_t)=>{if(!ju)return null;const p=dt(at);if(!p)return null;try{return DD(p,Vr,No,_t,ju,sc.get(q),ze)}catch(b){const F=(b==null?void 0:b.message)!=null?String(b.message):String(b);return i(Qt)||x(Qt,`Expression error: ${F}`),i(zt)||x(zt,"Expression error"),null}},bt=(at,Oe,_t)=>{const p=on(at,Oe,_t);return p!=null&&Number.isFinite(p)?p:void 0},_s=(at,Oe,_t)=>{const p=fv(at);if(!p||!ju)return"";let b=Iv.get(p);if(!b)try{b=Ap(p),Iv.set(p,b)}catch(F){const H=(F==null?void 0:F.message)!=null?String(F.message):String(F);return i(Qt)||x(Qt,`Expression error: ${H}`),i(zt)||x(zt,"Expression error"),""}try{return RD(b,Vr,No,_t,ju,sc.get(q))}catch(F){const H=(F==null?void 0:F.message)!=null?String(F.message):String(F);return i(Qt)||x(Qt,`Expression error: ${H}`),i(zt)||x(zt,"Expression error"),""}},zn=new Set,On=at=>{const Oe=at;zn.has(Oe)||(zn.add(Oe),console.warn(at))},ss=new Set,Cn=at=>{ss.has(at)||(ss.add(at),ie&&(ze==null||ze.emitOnce(at,at)),x(Qt,V(i(Qt)?`${i(Qt)} • ${at}`:at)),i(zt)||x(zt,"Expression error"))},Ht=(at,Oe,_t)=>{const p=(_t==null?void 0:_t.kind)==="label"?"label":(_t==null?void 0:_t.kind)==="box"?"box":"line",b=ie&&((_t==null?void 0:_t.kind)==="line"||(_t==null?void 0:_t.kind)==="label"||(_t==null?void 0:_t.kind)==="box"),F=(_t==null?void 0:_t.kind)==="polyline"||(_t==null?void 0:_t.kind)==="polygon"||(_t==null?void 0:_t.kind)==="path",H=Oe??"bar_index";if(b){if(H==="time"){if(!Number.isFinite(at))return Cn(`${p} x must be a number when xloc=time`),null}else if(!Number.isInteger(at))return Cn(`${p} x must be an integer when xloc=bar_index`),null}return Ok({xVal:at,xloc:H,len:Bt,timeSeriesMs:lu,tsIndex:Qa,config:{mode:Re.time.mode,toleranceBars:Re.time.toleranceBars,toleranceMs:Re.time.toleranceMs,futureBars:Re.futureBars,avgIntervalMs:Ia,strictXloc:b,allowFloatIndex:F},warn:On,meta:_t})},Fs=(at,Oe)=>{const _t=[];if(at)for(let F=0;F<Bt;(F+=1)-1)at[F]&&_t.push(F);else for(let F=0;F<Bt;(F+=1)-1)_t.push(F);if(_t.length<=Oe)return _t;const p=Math.max(1,Math.ceil(_t.length/Oe)),b=[];for(let F=_t.length-1;F>=0&&b.length<Oe;F-=p)b.push(_t[F]);return b.sort((F,H)=>F-H),b},Ds=at=>{if(typeof at!="string")return;const Oe=at.trim().toLowerCase();if(Oe==="background"||Oe==="bg")return"background";if(Oe==="main"||Oe==="base")return"main";if(Oe==="overlay"||Oe==="over")return"overlay";if(Oe==="ui")return"ui"},xs=at=>{if(typeof at=="number"&&Number.isFinite(at))return at;if(typeof at=="string"){const Oe=Number(at);return Number.isFinite(Oe)?Oe:void 0}},Rs=at=>{if(typeof at=="boolean")return at;if(typeof at=="number")return Number.isFinite(at)?at!==0:void 0;if(typeof at=="string"){const Oe=at.trim().toLowerCase();if(Oe==="true")return!0;if(Oe==="false")return!1;const _t=Number(Oe);if(Number.isFinite(_t))return _t!==0}},ys=[],ds=[],Gn=[],xn=[],Ei=Math.max(Bt-1+Re.futureBars,Bt-1),kl=[],Do=[],oo=[],ma=at=>{if(Number.isFinite(at)&&!(at<=0))return Math.min(64,at)},Xa=at=>{if(Number.isFinite(at))return Math.max(0,Math.min(1,at))};let bc=null,Da=null;if(Bf.length){const at=new Map,Oe=jt=>{const en=String(jt||"").trim();return en?en.replace(/\s+/g,"_").toLowerCase():null},_t=ie?Oe(String(((Dy=S==null?void 0:S.params)==null?void 0:Dy.__scriptId)??(S==null?void 0:S.id)??(S==null?void 0:S.name)??(S==null?void 0:S.title)??""))||"script":"";bc=`${Oe(String((S==null?void 0:S.id)??(S==null?void 0:S.name)??U))}_${Et.pane}_${hs}`||U;const p=pt.get(bc)??new Map;pt.set(bc,p),Da=Nt.get(bc)??{created:{},updated:{},pruned:{}};const b=(jt,en)=>{const X=Da[en][jt]??0;Da[en][jt]=X+1},F=(jt,en)=>`${jt}:${en}`,H=new Map,be=new Map,Pe=(jt,en)=>{const X=Oe(jt);return X?en.get(X)||X:null},Ze=(jt,en)=>{if(!en)return null;const X=F(jt,en),io=H.get(X);if(io)return io;const Fe={__handle:!0,kind:jt,id:en,key:X};return H.set(X,Fe),Fe},Ke=(jt,en)=>{const X=Oe(jt);X&&en&&be.set(X,en)},ut=(jt,en)=>{const X=Oe(jt);if(!X)return null;const io=be.get(X);return!io||en&&io.kind!==en?null:io},Gt=(jt,en,X,io)=>{const Fe=ut(X,jt);if(Fe)return Fe;const gt=ut(en,jt);if(gt)return gt;const fs=Pe(en,io);if(!fs)return null;const ln=Ze(jt,fs);return ln&&Ke(en,ln),ln},fn=(jt,en,X,io)=>{var Fe;return((Fe=Gt(jt,en,X,io))==null?void 0:Fe.id)??null},$n=(jt,en,X)=>{const io=String(jt||"").trim(),Fe=String(en||"").trim(),gt=io||Fe;if(!gt)return!0;const fs=Wp(gt);if(fs&&Vd.test(fs)){if(ie){const hl=dt(fs);if(hl&&s0(hl))return ze==null||ze.emitOnce(`cond_type:${fs}`,Qd),!1;const Ac=on(fs,"when",X);return Ac==null?!1:y0(Ac,ze,`cond_na:${fs}`)}const Ci=bt(fs,"when",X);return Number.isFinite(Ci)&&Ci!==0}let ln=at.get(gt);return ln||(ln=Xf(io,Fe),at.set(gt,ln)),ln?!!ln[X]:!1},cn=(jt,en,X)=>{if(!jt)return;const io=String(jt||"").trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(io)){const ln=vn(io),Ci=Bn[ln]??(ci?ci[ln]:void 0);if(Ci){const hl=Ci[X];return Number.isFinite(hl)?hl:void 0}}const Fe=Wp(String(jt));if(Fe&&Vd.test(Fe))return bt(Fe,en,X);const gt=se(String(jt));if(!gt)return;const fs=gt[X];return Number.isFinite(fs)?fs:void 0},eo=(jt,en,X,io)=>{if(jt!=null)return String(jt);if(!en)return"";const Fe=fv(String(en));if(Fe&&Vd.test(Fe))return _s(Fe,X,io);const gt=Ft(en);return gt?String(gt[io]??""):""},Js=24,Co=80,ws=(jt,en)=>{const X=String(jt??"");return!ie||X.length<=en?X:en<=1?"…":`${X.slice(0,Math.max(0,en-1))}…`},Zn=jt=>{if(!ie)return jt;if(Number.isFinite(jt)){if(!Number.isInteger(jt)||jt<1){ze==null||ze.emitOnce("line_width_int","line width must be an integer >= 1");return}return jt}},Ss=jt=>{if(!ie)return jt;if(Number.isFinite(jt)){if(!Number.isInteger(jt)){ze==null||ze.emitOnce("label_size_int","label size must be an integer");return}return Math.max(8,Math.min(32,jt))}},Fr=jt=>{if(!ie)return jt;if(!Number.isFinite(jt))return;const en=Math.round(Number(jt));return Math.max(0,Math.min(4,en))},Ra=jt=>{if(!ie)return jt;if(Number.isFinite(jt)){if(!Number.isInteger(jt)){ze==null||ze.emitOnce("box_text_size_int","box text_size must be an integer");return}return Math.max(8,Math.min(32,jt))}},xc=jt=>{if(!ie)return jt;if(Number.isFinite(jt)){if(!Number.isInteger(jt)){ze==null||ze.emitOnce("box_border_width_int","box border_width must be an integer between 0 and 4");return}return Math.max(0,Math.min(4,jt))}},Nl=jt=>ie?jt||"rgba(0,0,0,0)":jt,Qc=jt=>ie?jt||"rgba(0,0,0,0)":jt,al=jt=>{if(Array.isArray(jt)){const en=jt.map(X=>String(X||"").trim().toLowerCase()).filter(Boolean);return en.length?en:void 0}if(typeof jt=="string"){const en=jt.split(",").map(X=>X.trim().toLowerCase()).filter(Boolean);return en.length?en:void 0}},Hd=(jt,en,X)=>{if(!jt)return;en&&(jt.groupId=en);const io=al(X);io&&(jt.tags=io)},Zi={line:new Set,label:new Set,box:new Set},Xu=(jt,en,X)=>{if(!ie)return;const io=`${en}:${X}`,Fe=Zi[jt];if(Fe.has(io))return;Fe.add(io);const gt=`${jt} is deleted`;x(Qt,V(i(Qt)?`${i(Qt)} • ${gt}`:gt)),i(zt)||x(zt,"Expression error")},Jf=(jt,en)=>{ie&&(jt==="line"&&a1.add(en),jt==="label"&&l1.add(en),jt==="box"&&V0.add(en))},Cu=(jt,en)=>ie?jt==="line"?a1.has(en):jt==="label"?l1.has(en):jt==="box"?V0.has(en):!1:!1,Sl=jt=>{if(!ie||g6)return;g6=!0;const en=`line limit reached: ${jt} (skipping new lines)`;x(Qt,V(i(Qt)?`${i(Qt)} • ${en}`:en)),i(zt)||x(zt,"Expression error")},ff=jt=>{if(!ie||h6)return;h6=!0;const en=`label limit reached: ${jt} (skipping new labels)`;x(Qt,V(i(Qt)?`${i(Qt)} • ${en}`:en)),i(zt)||x(zt,"Expression error")},Cl=jt=>{if(!ie||v6)return;v6=!0;const en=`box limit reached: ${jt} (skipping new boxes)`;x(Qt,V(i(Qt)?`${i(Qt)} • ${en}`:en)),i(zt)||x(zt,"Expression error")},cu=jt=>String(jt??"").trim().toLowerCase(),Wf=(jt,en)=>en?H.get(F(jt,en)):null,kh=(jt,en,X,io,Fe,gt)=>{if(!en||io&&io!==jt)return!1;const fs=Wf(jt,en),ln=cu(Fe);if(ln&&cu((X==null?void 0:X.groupId)??(fs==null?void 0:fs.groupId))!==ln)return!1;const Ci=cu(gt);if(Ci){const hl=al((X==null?void 0:X.tags)??(fs==null?void 0:fs.tags))??(fs!=null&&fs.tags?al(fs.tags):void 0);if(!hl||!hl.includes(Ci))return!1}return!0},Xm=(jt,en)=>{var Fe;if(!en)return;const X=F(jt,en);if(H.get(X)){H.delete(X);const gt=qp==null?void 0:qp[jt];(Fe=gt==null?void 0:gt.delete)==null||Fe.call(gt,en);for(const[ln,Ci]of be.entries())(Ci==null?void 0:Ci.key)===X&&be.delete(ln);for(const[ln,Ci]of p.entries())(Ci==null?void 0:Ci.key)===X&&p.delete(ln);const fs=ln=>{for(const[Ci,hl]of ln.entries())hl===en&&ln.delete(Ci)};jt==="line"&&fs(em),jt==="linefill"&&fs(fm),jt==="label"&&fs(rp),jt==="box"&&fs(Nm),jt==="table"&&fs(Zm),jt==="polyline"&&fs(k0),jt==="polygon"&&fs(r0),jt==="path"&&fs(a0)}},z0=(jt,en,X)=>{en<=0||console.warn(`[ScriptStudio] ${jt} limit ${X} reached; pruned ${en} via ${Re.pruningPolicy} policy`)},qg=(jt,en,X)=>{if(Re.pruningPolicy==="lru"){const io=qp[X];return jt.slice().sort((Fe,gt)=>(io.get(Fe)??Number.MIN_SAFE_INTEGER)-(io.get(gt)??Number.MIN_SAFE_INTEGER))}if(Re.pruningPolicy==="byGroup"){const io=new Map;return jt.forEach((Fe,gt)=>{var ln;const fs=((ln=en.get(Fe))==null?void 0:ln.groupId)||"";io.has(fs)||io.set(fs,gt)}),jt.slice().sort((Fe,gt)=>{var Ac,Ma;const fs=((Ac=en.get(Fe))==null?void 0:Ac.groupId)||"",ln=((Ma=en.get(gt))==null?void 0:Ma.groupId)||"",Ci=io.get(fs)??0,hl=io.get(ln)??0;return Ci!==hl?Ci-hl:jt.indexOf(Fe)-jt.indexOf(gt)})}return jt.slice()},Sh=(jt,en,X,io)=>{const Fe=[];if(jt.length<=X)return;const gt=qg(jt,en,io);for(;jt.length>X&&gt.length;){const fs=gt.shift();if(!fs)continue;en.delete(fs);const ln=jt.indexOf(fs);ln>=0&&jt.splice(ln,1),S0[io].push(fs),Xm(io,fs),Fe.push(fs),b(io,"pruned")}Fe.length&&z0(io,Fe.length,X)},Lg=(jt,en,X,io,Fe)=>{const gt=[];if(!jt||!jt.length)return gt;for(const fs of jt){if(!fs)continue;const ln=cn(fs.x,`${io}.x`,Fe),Ci=cn(fs.y,`${io}.y`,Fe);ln==null||Ci==null||gt.push({x:ln,y:Ci,xloc:fs.xloc||en,yloc:fs.yloc||X})}return gt},em=new Map,fm=new Map,rp=new Map,Nm=new Map,Zm=new Map,k0=new Map,r0=new Map,a0=new Map,Jh=new Map,rd=new Map,Qu=new Map,Rc=new Map,Qf=new Map,Lf=new Map,Jm=new Map,pm=new Map,a1=new Set,l1=new Set,V0=new Set,c1=[],u1=[],d1=[],f1=[],l_=[],p1=[],m1=[],h1=[],qp={line:new Map,linefill:new Map,label:new Map,box:new Map,table:new Map,polyline:new Map,polygon:new Map,path:new Map},S0={line:[],linefill:[],label:[],box:[],table:[],polyline:[],polygon:[],path:[]},Zy=()=>Jh.size+rd.size+Qu.size+Rc.size+Qf.size+Lf.size+Jm.size+pm.size,W0=(jt,en,X,io)=>!ie||!io?!1:Eg!=null&&Zy()>=Eg?(lt("runtime draws",Eg),!0):en!=null&&en>0&&X>=en?(lt(jt,en),!0):!1;let K8=0,X8=0,Z8=0,Jy=0,Qy=0,h6=!1,eb=0,v6=!1,g6=!1,v1=0,g1=0,_1=0,y1=0,b1=0,x1=0,w1=0,k1=0;p.forEach((jt,en)=>{if(!jt||!jt.key)return;H.set(jt.key,jt),be.set(en,jt);const X=jt.id;if(X){if(jt.kind==="line"){em.set(en,X);const io=X.match(/line_(\d+)/);io&&(v1=Math.max(v1,Number(io[1])))}else if(jt.kind==="linefill"){fm.set(en,X);const io=X.match(/linefill_(\d+)/);io&&(g1=Math.max(g1,Number(io[1])))}else if(jt.kind==="label"){rp.set(en,X);const io=X.match(/label_(\d+)/);io&&(_1=Math.max(_1,Number(io[1])))}else if(jt.kind==="box"){Nm.set(en,X);const io=X.match(/box_(\d+)/);io&&(y1=Math.max(y1,Number(io[1])))}else if(jt.kind==="table"){Zm.set(en,X);const io=X.match(/table_(\d+)/);io&&(b1=Math.max(b1,Number(io[1])))}else if(jt.kind==="polyline"){k0.set(en,X);const io=X.match(/polyline_(\d+)/);io&&(x1=Math.max(x1,Number(io[1])))}else if(jt.kind==="polygon"){r0.set(en,X);const io=X.match(/polygon_(\d+)/);io&&(w1=Math.max(w1,Number(io[1])))}else if(jt.kind==="path"){a0.set(en,X);const io=X.match(/path_(\d+)/);io&&(k1=Math.max(k1,Number(io[1])))}}});const S1=ie?Ee.lines:Re.limits.line||240,tb=ie?Ee.labels:Re.limits.label||300,_6=ie?Ee.boxes:Re.limits.box||180,y6=Re.limits.table||20,J8=Re.limits.linefill||120,Q8=Re.limits.polyline||180,eC=Re.limits.polygon||160,tC=Re.limits.path||160,Eg=ie?Ee.runtimeDraws:null;ju={get:(jt,en,X,io)=>{const Fe=String(en||"").toLowerCase().replace(/[^a-z0-9]/g,""),gt=Oe(String(X||""));if(gt){if(jt==="line"){const fs=fn("line",gt,gt,em),ln=Jh.get(fs);return ln?Fe==="x1"?Number.isFinite(ln.x1)?ln.x1:NaN:Fe==="y1"?Number.isFinite(ln.y1)?ln.y1:NaN:Fe==="x2"?Number.isFinite(ln.x2)?ln.x2:NaN:Fe==="y2"?Number.isFinite(ln.y2)?ln.y2:NaN:Fe==="width"||Fe==="linewidth"?Number.isFinite(ln.width)?ln.width:NaN:Fe==="color"?ln.color??"":Fe==="style"?ln.style??"":Fe==="extend"?ln.extend??"":Fe==="xloc"?ln.xloc??"":void 0:void 0}if(jt==="label"){const fs=fn("label",gt,gt,rp),ln=Qu.get(fs);return ln?Fe==="x"?Number.isFinite(ln.x)?ln.x:NaN:Fe==="y"?Number.isFinite(ln.y)?ln.y:NaN:Fe==="size"?Number.isFinite(ln.size)?ln.size:NaN:Fe==="text"?ln.text??"":Fe==="color"?ln.color??"":Fe==="textcolor"?ln.textColor??"":Fe==="style"?ln.shape??"":Fe==="yloc"?ln.yloc??"":Fe==="xloc"?ln.xloc??"":Fe==="textalign"?ln.textAlign??"":Fe==="tooltip"?ln.tooltip??"":void 0:void 0}if(jt==="box"){const fs=fn("box",gt,gt,Nm),ln=Rc.get(fs);return ln?Fe==="left"?Number.isFinite(ln.left)?ln.left:NaN:Fe==="right"?Number.isFinite(ln.right)?ln.right:NaN:Fe==="top"?Number.isFinite(ln.top)?ln.top:NaN:Fe==="bottom"?Number.isFinite(ln.bottom)?ln.bottom:NaN:Fe==="borderwidth"?Number.isFinite(ln.borderWidth)?ln.borderWidth:NaN:Fe==="textsize"?Number.isFinite(ln.textSize)?ln.textSize:NaN:Fe==="textwrap"?ln.textWrap?1:0:Fe==="bgcolor"?ln.bgColor??"":Fe==="bordercolor"?ln.borderColor??"":Fe==="borderstyle"?ln.borderStyle??"":Fe==="text"?ln.text??"":Fe==="textcolor"?ln.textColor??"":Fe==="texthalign"?ln.textHalign??"":Fe==="textvalign"?ln.textValign??"":Fe==="extend"?ln.extend??"":Fe==="xloc"?ln.xloc??"":void 0:void 0}if(jt==="table"){const fs=fn("table",gt,gt,Zm),ln=Qf.get(fs);return ln?Fe==="position"?ln.position??"":Fe==="columns"?Number.isFinite(ln.columns)?ln.columns:NaN:Fe==="rows"?Number.isFinite(ln.rows)?ln.rows:NaN:Fe==="borderwidth"?Number.isFinite(ln.borderWidth)?ln.borderWidth:NaN:Fe==="framewidth"?Number.isFinite(ln.frameWidth)?ln.frameWidth:NaN:Fe==="textsize"?Number.isFinite(ln.textSize)?ln.textSize:NaN:Fe==="bgcolor"?ln.bgcolor??"":Fe==="bordercolor"?ln.borderColor??"":Fe==="textcolor"?ln.textColor??"":Fe==="texthalign"?ln.textHalign??"":Fe==="textvalign"?ln.textValign??"":Fe==="framecolor"?ln.frameColor??"":void 0:void 0}}}};let Am=0;for(let jt=0;jt<Bt;(jt+=1)-1)for(let en=0;en<Bf.length;(en+=1)-1){const X=Bf[en];if(Am+=1,!X||!$n(X.whenExpr,X.when,jt))continue;const io=`${X.kind}:${en}`;if(X.kind==="line_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?em.get(Fe):null,ln=fs?Jh.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=ie?!0:!ln;if(ie&&Ci){if(Eg!=null&&Zy()>=Eg){lt("runtime draws",Eg);continue}if(Jy>=S1){lt("lines",S1),Sl(S1);continue}}else if(W0("lines",S1,Jh.size,Ci))continue;const hl=cn(X.x1,"line.x1",jt),Ac=cn(X.y1,"line.y1",jt),Ma=cn(X.x2,"line.x2",jt),su=cn(X.y2,"line.y2",jt);if(hl==null||Ac==null||Ma==null||su==null)continue;const tf=S0.line.shift(),Tc=ie?`pline:${_t}:${(K8+=1)-1}`:null,sf=Tc||(gt==null?void 0:gt.id)||fs||tf||`line_${v1+=1}`;if(!Tc){const vg=sf.match(/line_(\d+)/);vg&&(v1=Math.max(v1,Number(vg[1])))}const Sf=X.width??cn(X.widthExpr,"line.width",jt)??void 0,Vo=Zn(Sf),tc=ma(X.glow),Ch=Xa(X.glowOpacity),$g=X.glowColor,C0=Ds(X.layer),C1=xs(X.zIndex),qv=Rs(X.includeInAutoscale),Mv=gt&&gt.id===sf?gt:Ze("line",sf);Hd(Mv,X.groupId,al(X.tags)),Jh.set(sf,{x1:hl,y1:Ac,x2:Ma,y2:su,color:X.color,gradient:X.gradient,width:Vo,glow:tc,glowColor:$g,glowOpacity:Ch,style:X.style,extend:X.extend,xloc:X.xloc,layer:C0,zIndex:C1,includeInAutoscale:qv,groupId:X.groupId??(Mv==null?void 0:Mv.groupId),tags:al(X.tags)??(Mv==null?void 0:Mv.tags)}),qp.line.set(sf,Am),b("line",Ci?"created":"updated"),c1.push(sf),Sh(c1,Jh,S1,"line"),ie&&(Jy=Jh.size),Fe&&Mv&&(em.set(Fe,sf),Ke(Fe,Mv),p.set(Fe,Mv));continue}if(X.kind==="line_set"){const Fe=fn("line",X.target,X.targetExpr,em);if(!Fe)continue;if(ie&&Cu("line",Fe)){Xu("line",Fe,io);continue}const gt=Jh.get(Fe);if(!gt)continue;const fs=cn(X.x1,"line.set_x1",jt),ln=cn(X.y1,"line.set_y1",jt),Ci=cn(X.x2,"line.set_x2",jt),hl=cn(X.y2,"line.set_y2",jt);if(fs!=null&&(gt.x1=fs),ln!=null&&(gt.y1=ln),Ci!=null&&(gt.x2=Ci),hl!=null&&(gt.y2=hl),X.color&&(gt.color=X.color),X.gradient&&(gt.gradient=X.gradient),X.width!=null||X.widthExpr){const Ac=X.width??cn(X.widthExpr,"line.set_width",jt),Ma=Zn(Ac);Ma!=null&&(gt.width=Ma)}if(X.glow!=null){const Ac=ma(X.glow);Ac!=null&&(gt.glow=Ac)}if(X.glowOpacity!=null){const Ac=Xa(X.glowOpacity);Ac!=null&&(gt.glowOpacity=Ac)}X.glowColor&&(gt.glowColor=X.glowColor),X.style&&(gt.style=X.style),X.extend&&(gt.extend=X.extend),X.xloc&&(gt.xloc=X.xloc),qp.line.set(Fe,Am),b("line","updated");continue}if(X.kind==="line_delete"){const Fe=fn("line",X.target,X.targetExpr,em);if(!Fe)continue;Jh.delete(Fe);const gt=c1.indexOf(Fe);gt>=0&&c1.splice(gt,1),ie?(Jf("line",Fe),Jy=Jh.size):Xm("line",Fe);continue}if(X.kind==="linefill_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?fm.get(Fe):null,ln=fs?rd.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=!ln;if(W0("runtime draws",null,rd.size,Ci))continue;const hl=fn("line",X.line1,X.line1,em),Ac=fn("line",X.line2,X.line2,em);if(!hl||!Ac)continue;const Ma=S0.linefill.shift(),su=(gt==null?void 0:gt.id)||fs||Ma||`linefill_${g1+=1}`,tf=su.match(/linefill_(\d+)/);tf&&(g1=Math.max(g1,Number(tf[1])));const Tc=Ds(X.layer),sf=xs(X.zIndex),Sf=Rs(X.includeInAutoscale),Vo=gt??Ze("linefill",su);Hd(Vo,X.groupId,al(X.tags)),rd.set(su,{line1:hl,line2:Ac,color:X.color,layer:Tc,zIndex:sf,includeInAutoscale:Sf,groupId:X.groupId??(Vo==null?void 0:Vo.groupId),tags:al(X.tags)??(Vo==null?void 0:Vo.tags)}),qp.linefill.set(su,Am),b("linefill",ln?"updated":"created"),u1.push(su),Sh(u1,rd,J8,"linefill"),Fe&&Vo&&(fm.set(Fe,su),Ke(Fe,Vo),p.set(Fe,Vo));continue}if(X.kind==="linefill_set"){const Fe=fn("linefill",X.target,X.targetExpr,fm);if(!Fe)continue;const gt=rd.get(Fe);if(!gt)continue;if(X.color&&(gt.color=X.color),X.line1){const fs=fn("line",X.line1,X.line1,em);fs&&(gt.line1=fs)}if(X.line2){const fs=fn("line",X.line2,X.line2,em);fs&&(gt.line2=fs)}qp.linefill.set(Fe,Am),b("linefill","updated");continue}if(X.kind==="linefill_delete"){const Fe=fn("linefill",X.target,X.targetExpr,fm);if(!Fe)continue;rd.delete(Fe);const gt=u1.indexOf(Fe);gt>=0&&u1.splice(gt,1),Xm("linefill",Fe);continue}if(X.kind==="label_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?rp.get(Fe):null,ln=fs?Qu.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=ie?!0:!ln;if(ie&&Ci){if(Eg!=null&&Zy()>=Eg){lt("runtime draws",Eg);continue}if(Qy>=ke){lt("labels",ke),ff(ke);continue}}else if(W0("labels",tb,Qu.size,Ci))continue;const hl=cn(X.x,"label.x",jt),Ac=cn(X.y,"label.y",jt);if(hl==null||Ac==null)continue;const Ma=S0.label.shift(),su=ie?`plabel:${_t}:${(X8+=1)-1}`:null,tf=su||(gt==null?void 0:gt.id)||fs||Ma||`label_${_1+=1}`;if(!su){const b6=tf.match(/label_(\d+)/);b6&&(_1=Math.max(_1,Number(b6[1])))}const Tc=X.size??cn(X.sizeExpr,"label.size",jt)??void 0,sf=Ss(Tc),Sf=X.padding,Vo=X.radius??cn(X.radiusExpr,"label.radius",jt),tc=X.maxWidth??cn(X.maxWidthExpr,"label.max_width",jt),Ch=X.borderWidth??cn(X.borderWidthExpr,"label.border_width",jt),$g=ie?Fr(Ch)??0:Ch,C0=X.lineHeight??cn(X.lineHeightExpr,"label.line_height",jt),C1=Ds(X.layer),qv=xs(X.zIndex),Mv=Rs(X.includeInAutoscale),vg=gt&&gt.id===tf?gt:Ze("label",tf);Hd(vg,X.groupId,al(X.tags));const nC=eo(X.text,X.textExpr,"label.text",jt),sC=eo(X.tooltip,X.tooltipExpr,"label.tooltip",jt);Qu.set(tf,{x:hl,y:Ac,text:ws(nC,Js),color:X.color,textColor:X.textColor,shape:X.style,size:sf,xloc:X.xloc,yloc:X.yloc,textAlign:X.textAlign,tooltip:ws(sC,Co),wrap:ie?!1:X.wrap,maxWidth:ie?void 0:tc,padding:Sf,bgColor:Nl(X.bgColor),bgGradient:X.bgGradient??X.gradient,bgOpacity:X.bgOpacity,borderColor:Qc(X.borderColor),borderWidth:$g,radius:Vo,align:X.align,valign:X.valign,lineHeight:C0,fontFamily:X.fontFamily,fontSize:X.fontSize,fontWeight:X.fontWeight,monospace:X.monospace,pineV2:ie||void 0,layer:C1,zIndex:qv,includeInAutoscale:Mv,groupId:X.groupId??(vg==null?void 0:vg.groupId),tags:al(X.tags)??(vg==null?void 0:vg.tags)}),qp.label.set(tf,Am),b("label",Ci?"created":"updated"),d1.push(tf),Sh(d1,Qu,tb,"label"),ie&&(Qy=Qu.size),Fe&&vg&&(rp.set(Fe,tf),Ke(Fe,vg),p.set(Fe,vg));continue}if(X.kind==="label_set"){const Fe=fn("label",X.target,X.targetExpr,rp);if(!Fe)continue;if(ie&&Cu("label",Fe)){Xu("label",Fe,io);continue}const gt=Qu.get(Fe);if(!gt)continue;const fs=cn(X.x,"label.set_x",jt),ln=cn(X.y,"label.set_y",jt);if(fs!=null&&(gt.x=fs),ln!=null&&(gt.y=ln),X.text!=null||X.textExpr){const Ci=eo(X.text,X.textExpr,"label.set_text",jt);gt.text=ws(Ci,Js)}if(X.color&&(gt.color=X.color),X.textColor&&(gt.textColor=X.textColor),X.style&&(gt.shape=X.style),X.size!=null||X.sizeExpr){const Ci=X.size??cn(X.sizeExpr,"label.set_size",jt);Ci!=null&&(gt.size=Ss(Ci))}if(X.yloc&&(gt.yloc=X.yloc),X.textAlign&&(gt.textAlign=X.textAlign),X.tooltip!=null||X.tooltipExpr){const Ci=eo(X.tooltip,X.tooltipExpr,"label.set_tooltip",jt);gt.tooltip=ws(Ci,Co)}X.xloc&&(gt.xloc=X.xloc),!ie&&X.wrap!=null&&(gt.wrap=X.wrap),!ie&&X.maxWidth!=null&&(gt.maxWidth=X.maxWidth),X.padding!=null&&(gt.padding=X.padding),X.bgColor&&(gt.bgColor=Nl(X.bgColor)),X.bgGradient?gt.bgGradient=X.bgGradient:X.gradient&&(gt.bgGradient=X.gradient),X.bgOpacity!=null&&(gt.bgOpacity=X.bgOpacity),X.borderColor&&(gt.borderColor=Qc(X.borderColor)),X.borderWidth!=null&&(gt.borderWidth=Fr(X.borderWidth)),X.radius!=null&&(gt.radius=X.radius),X.align&&(gt.align=X.align),X.valign&&(gt.valign=X.valign),X.lineHeight!=null&&(gt.lineHeight=X.lineHeight),X.fontFamily&&(gt.fontFamily=X.fontFamily),X.fontSize!=null&&(gt.fontSize=X.fontSize),X.fontWeight&&(gt.fontWeight=X.fontWeight),X.monospace!=null&&(gt.monospace=X.monospace),qp.label.set(Fe,Am),b("label","updated");continue}if(X.kind==="label_delete"){const Fe=fn("label",X.target,X.targetExpr,rp);if(!Fe)continue;Qu.delete(Fe);const gt=d1.indexOf(Fe);gt>=0&&d1.splice(gt,1),ie?(Qy=Qu.size,Jf("label",Fe)):Xm("label",Fe);continue}if(X.kind==="box_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?Nm.get(Fe):null,ln=fs?Rc.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=ie?!0:!ln;if(ie&&Ci){if(Eg!=null&&Zy()>=Eg){lt("runtime draws",Eg);continue}if(eb>=ee){lt("boxes",ee),Cl(ee);continue}}else if(W0("boxes",_6,Rc.size,Ci))continue;const hl=cn(X.left,"box.left",jt),Ac=cn(X.right,"box.right",jt),Ma=cn(X.top,"box.top",jt),su=cn(X.bottom,"box.bottom",jt);if(hl==null||Ac==null||Ma==null||su==null)continue;const tf=S0.box.shift(),Tc=ie?`pbox:${_t}:${(Z8+=1)-1}`:null,sf=Tc||(gt==null?void 0:gt.id)||fs||tf||`box_${y1+=1}`;if(!Tc){const Mv=sf.match(/box_(\d+)/);Mv&&(y1=Math.max(y1,Number(Mv[1])))}const Sf=X.width??cn(X.widthExpr,"box.border_width",jt)??void 0,Vo=ie?xc(Sf):Sf,tc=X.textSize??cn(X.textSizeExpr,"box.text_size",jt)??void 0,Ch=ie?Ra(tc):tc,$g=Ds(X.layer),C0=xs(X.zIndex),C1=Rs(X.includeInAutoscale),qv=gt??Ze("box",sf);Hd(qv,X.groupId,al(X.tags)),Rc.set(sf,{left:hl,right:Ac,top:Ma,bottom:su,borderColor:X.borderColor,bgColor:X.bgColor,bgGradient:X.bgGradient??X.gradient,borderWidth:Vo,borderStyle:X.borderStyle,text:eo(X.text,X.textExpr,"box.text",jt),tooltip:eo(X.tooltip,X.tooltipExpr,"box.tooltip",jt),textColor:X.textColor,textSize:Ch,textHalign:X.textHalign,textValign:X.textValign,textWrap:X.textWrap,extend:X.extend,xloc:X.xloc,layer:$g,zIndex:C0,includeInAutoscale:C1,groupId:X.groupId??(qv==null?void 0:qv.groupId),tags:al(X.tags)??(qv==null?void 0:qv.tags)}),qp.box.set(sf,Am),b("box",Ci?"created":"updated"),f1.push(sf),Sh(f1,Rc,_6,"box"),ie&&(eb=Rc.size),Fe&&qv&&(Nm.set(Fe,sf),Ke(Fe,qv),p.set(Fe,qv));continue}if(X.kind==="box_set"){const Fe=fn("box",X.target,X.targetExpr,Nm);if(!Fe)continue;if(ie&&Cu("box",Fe)){Xu("box",Fe,io);continue}const gt=Rc.get(Fe);if(!gt)continue;const fs=cn(X.left,"box.set_left",jt),ln=cn(X.right,"box.set_right",jt),Ci=cn(X.top,"box.set_top",jt),hl=cn(X.bottom,"box.set_bottom",jt);if(fs!=null&&(gt.left=fs),ln!=null&&(gt.right=ln),Ci!=null&&(gt.top=Ci),hl!=null&&(gt.bottom=hl),X.borderColor&&(gt.borderColor=X.borderColor),X.bgColor&&(gt.bgColor=X.bgColor),X.bgGradient?gt.bgGradient=X.bgGradient:X.gradient&&(gt.bgGradient=X.gradient),X.width!=null||X.widthExpr){const Ac=X.width??cn(X.widthExpr,"box.set_border_width",jt),Ma=ie?xc(Ac):Ac;Ma!=null&&(gt.borderWidth=Ma)}if(X.borderStyle&&(gt.borderStyle=X.borderStyle),(X.text!=null||X.textExpr)&&(gt.text=eo(X.text,X.textExpr,"box.set_text",jt)),X.textColor&&(gt.textColor=X.textColor),X.textSize!=null||X.textSizeExpr){const Ac=X.textSize??cn(X.textSizeExpr,"box.set_text_size",jt),Ma=ie?Ra(Ac):Ac;Ma!=null&&(gt.textSize=Ma)}(X.tooltip!=null||X.tooltipExpr)&&(gt.tooltip=eo(X.tooltip,X.tooltipExpr,"box.set_tooltip",jt)),X.textHalign&&(gt.textHalign=X.textHalign),X.textValign&&(gt.textValign=X.textValign),typeof X.textWrap=="boolean"&&(gt.textWrap=X.textWrap),X.extend&&(gt.extend=X.extend),X.xloc&&(gt.xloc=X.xloc),qp.box.set(Fe,Am),b("box","updated");continue}if(X.kind==="box_delete"){const Fe=fn("box",X.target,X.targetExpr,Nm);if(!Fe)continue;Rc.delete(Fe);const gt=f1.indexOf(Fe);gt>=0&&f1.splice(gt,1),ie?(eb=Rc.size,Jf("box",Fe)):Xm("box",Fe);continue}if(X.kind==="polyline_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?k0.get(Fe):null,ln=fs?Lf.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=!ln;if(W0("runtime draws",null,Lf.size,Ci))continue;const hl=Lg(X.points,X.xloc,X.yloc,"polyline.points",jt);if(!hl.length)continue;const Ac=S0.polyline.shift(),Ma=(gt==null?void 0:gt.id)||fs||Ac||`polyline_${x1+=1}`,su=Ma.match(/polyline_(\d+)/);su&&(x1=Math.max(x1,Number(su[1])));const tf=X.width??cn(X.widthExpr,"polyline.width",jt)??void 0,Tc=gt??Ze("polyline",Ma);Hd(Tc,X.groupId,al(X.tags)),Lf.set(Ma,{id:Ma,points:hl,color:X.color,gradient:X.gradient,width:tf,style:X.style,opacity:X.opacity,glow:ma(X.glow),glowColor:X.glowColor,glowOpacity:Xa(X.glowOpacity),layer:Ds(X.layer),zIndex:xs(X.zIndex),includeInAutoscale:Rs(X.includeInAutoscale),groupId:X.groupId??(Tc==null?void 0:Tc.groupId),tags:al(X.tags)??(Tc==null?void 0:Tc.tags)}),qp.polyline.set(Ma,Am),b("polyline",ln?"updated":"created"),p1.push(Ma),Sh(p1,Lf,Q8,"polyline"),Fe&&Tc&&(k0.set(Fe,Ma),Ke(Fe,Tc),p.set(Fe,Tc));continue}if(X.kind==="polyline_set"){const Fe=fn("polyline",X.target,X.targetExpr,k0);if(!Fe)continue;const gt=Lf.get(Fe);if(!gt)continue;if(X.points&&X.points.length){const ln=Lg(X.points,X.xloc,X.yloc,"polyline.set_points",jt);ln.length&&(gt.points=ln)}if(X.color&&(gt.color=X.color),X.gradient&&(gt.gradient=X.gradient),X.width!=null||X.widthExpr){const ln=X.width??cn(X.widthExpr,"polyline.set_width",jt);ln!=null&&(gt.width=ln)}if(X.style&&(gt.style=X.style),X.opacity!=null&&(gt.opacity=X.opacity),X.glow!=null){const ln=ma(X.glow);ln!=null&&(gt.glow=ln)}if(X.glowOpacity!=null){const ln=Xa(X.glowOpacity);ln!=null&&(gt.glowOpacity=ln)}X.glowColor&&(gt.glowColor=X.glowColor),X.layer&&(gt.layer=X.layer),X.zIndex!=null&&(gt.zIndex=X.zIndex),X.includeInAutoscale!=null&&(gt.includeInAutoscale=X.includeInAutoscale),X.groupId&&(gt.groupId=X.groupId);const fs=al(X.tags);fs&&(gt.tags=fs),qp.polyline.set(Fe,Am),b("polyline","updated");continue}if(X.kind==="polyline_delete"){const Fe=fn("polyline",X.target,X.targetExpr,k0);if(!Fe)continue;Lf.delete(Fe);const gt=p1.indexOf(Fe);gt>=0&&p1.splice(gt,1),Xm("polyline",Fe);continue}if(X.kind==="polygon_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?r0.get(Fe):null,ln=fs?Jm.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=!ln;if(W0("runtime draws",null,Jm.size,Ci))continue;const hl=Lg(X.points,X.xloc,X.yloc,"polygon.points",jt);if(hl.length<3)continue;const Ac=S0.polygon.shift(),Ma=(gt==null?void 0:gt.id)||fs||Ac||`polygon_${w1+=1}`,su=Ma.match(/polygon_(\d+)/);su&&(w1=Math.max(w1,Number(su[1])));const tf=X.strokeWidth??cn(X.strokeWidthExpr,"polygon.stroke_width",jt)??void 0,Tc=gt??Ze("polygon",Ma);Hd(Tc,X.groupId,al(X.tags)),Jm.set(Ma,{id:Ma,points:hl,fillColor:X.fillColor,fillGradient:X.fillGradient,strokeColor:X.strokeColor,strokeWidth:tf,strokeStyle:X.strokeStyle,opacity:X.opacity,glow:ma(X.glow),glowColor:X.glowColor,glowOpacity:Xa(X.glowOpacity),layer:Ds(X.layer),zIndex:xs(X.zIndex),includeInAutoscale:Rs(X.includeInAutoscale),groupId:X.groupId??(Tc==null?void 0:Tc.groupId),tags:al(X.tags)??(Tc==null?void 0:Tc.tags)}),qp.polygon.set(Ma,Am),b("polygon",ln?"updated":"created"),m1.push(Ma),Sh(m1,Jm,eC,"polygon"),Fe&&Tc&&(r0.set(Fe,Ma),Ke(Fe,Tc),p.set(Fe,Tc));continue}if(X.kind==="polygon_set"){const Fe=fn("polygon",X.target,X.targetExpr,r0);if(!Fe)continue;const gt=Jm.get(Fe);if(!gt)continue;if(X.points&&X.points.length){const ln=Lg(X.points,X.xloc,X.yloc,"polygon.set_points",jt);ln.length>=3&&(gt.points=ln)}if(X.fillColor&&(gt.fillColor=X.fillColor),X.fillGradient&&(gt.fillGradient=X.fillGradient),X.strokeColor&&(gt.strokeColor=X.strokeColor),X.strokeWidth!=null||X.strokeWidthExpr){const ln=X.strokeWidth??cn(X.strokeWidthExpr,"polygon.stroke_width",jt);ln!=null&&(gt.strokeWidth=ln)}if(X.strokeStyle&&(gt.strokeStyle=X.strokeStyle),X.opacity!=null&&(gt.opacity=X.opacity),X.glow!=null){const ln=ma(X.glow);ln!=null&&(gt.glow=ln)}if(X.glowOpacity!=null){const ln=Xa(X.glowOpacity);ln!=null&&(gt.glowOpacity=ln)}X.glowColor&&(gt.glowColor=X.glowColor),X.layer&&(gt.layer=X.layer),X.zIndex!=null&&(gt.zIndex=X.zIndex),X.includeInAutoscale!=null&&(gt.includeInAutoscale=X.includeInAutoscale),X.groupId&&(gt.groupId=X.groupId);const fs=al(X.tags);fs&&(gt.tags=fs),qp.polygon.set(Fe,Am),b("polygon","updated");continue}if(X.kind==="polygon_delete"){const Fe=fn("polygon",X.target,X.targetExpr,r0);if(!Fe)continue;Jm.delete(Fe);const gt=m1.indexOf(Fe);gt>=0&&m1.splice(gt,1),Xm("polygon",Fe);continue}if(X.kind==="path_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?a0.get(Fe):null,ln=fs?pm.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=!ln;if(W0("runtime draws",null,pm.size,Ci))continue;const hl=Array.isArray(X.commands)&&X.commands.length?X.commands:(X.points||[]).map((sf,Sf)=>({cmd:Sf===0?"M":"L",x:sf.x,y:sf.y,xloc:sf.xloc||X.xloc,yloc:sf.yloc||X.yloc}));if(!hl.length)continue;const Ac=S0.path.shift(),Ma=(gt==null?void 0:gt.id)||fs||Ac||`path_${k1+=1}`,su=Ma.match(/path_(\d+)/);su&&(k1=Math.max(k1,Number(su[1])));const tf=X.width??cn(X.widthExpr,"path.width",jt)??void 0,Tc=gt??Ze("path",Ma);Hd(Tc,X.groupId,al(X.tags)),pm.set(Ma,{id:Ma,commands:hl,color:X.color,gradient:X.gradient,width:tf,style:X.style,opacity:X.opacity,glow:ma(X.glow),glowColor:X.glowColor,glowOpacity:Xa(X.glowOpacity),layer:Ds(X.layer),zIndex:xs(X.zIndex),includeInAutoscale:Rs(X.includeInAutoscale),groupId:X.groupId??(Tc==null?void 0:Tc.groupId),tags:al(X.tags)??(Tc==null?void 0:Tc.tags)}),qp.path.set(Ma,Am),b("path",ln?"updated":"created"),h1.push(Ma),Sh(h1,pm,tC,"path"),Fe&&Tc&&(a0.set(Fe,Ma),Ke(Fe,Tc),p.set(Fe,Tc));continue}if(X.kind==="path_set"){const Fe=fn("path",X.target,X.targetExpr,a0);if(!Fe)continue;const gt=pm.get(Fe);if(!gt)continue;if(X.commands&&X.commands.length&&(gt.commands=X.commands),X.color&&(gt.color=X.color),X.gradient&&(gt.gradient=X.gradient),X.width!=null||X.widthExpr){const ln=X.width??cn(X.widthExpr,"path.set_width",jt);ln!=null&&(gt.width=ln)}if(X.style&&(gt.style=X.style),X.opacity!=null&&(gt.opacity=X.opacity),X.glow!=null){const ln=ma(X.glow);ln!=null&&(gt.glow=ln)}if(X.glowOpacity!=null){const ln=Xa(X.glowOpacity);ln!=null&&(gt.glowOpacity=ln)}X.glowColor&&(gt.glowColor=X.glowColor),X.layer&&(gt.layer=X.layer),X.zIndex!=null&&(gt.zIndex=X.zIndex),X.includeInAutoscale!=null&&(gt.includeInAutoscale=X.includeInAutoscale),X.groupId&&(gt.groupId=X.groupId);const fs=al(X.tags);fs&&(gt.tags=fs),qp.path.set(Fe,Am),b("path","updated");continue}if(X.kind==="path_delete"){const Fe=fn("path",X.target,X.targetExpr,a0);if(!Fe)continue;pm.delete(Fe);const gt=h1.indexOf(Fe);gt>=0&&h1.splice(gt,1),Xm("path",Fe);continue}if(X.kind==="table_new"){const Fe=Oe(X.assign),gt=Fe?be.get(Fe):null,fs=Fe?Zm.get(Fe):null,ln=fs?Qf.get(fs):null;if(X.once&&Fe&&fs&&ln)continue;const Ci=!ln;if(W0("runtime draws",null,Qf.size,Ci))continue;const hl=Math.max(1,Math.floor(Number(X.columns??0))),Ac=Math.max(1,Math.floor(Number(X.rows??0)));if(!hl||!Ac)continue;const Ma=S0.table.shift(),su=(gt==null?void 0:gt.id)||fs||Ma||`table_${b1+=1}`,tf=su.match(/table_(\d+)/);tf&&(b1=Math.max(b1,Number(tf[1])));const Tc=Ds(X.layer),sf=xs(X.zIndex),Sf=Rs(X.includeInAutoscale),Vo=gt??Ze("table",su);Hd(Vo,X.groupId,al(X.tags)),Qf.set(su,{id:su,position:X.position||"top_right",columns:hl,rows:Ac,bgcolor:X.bgcolor,borderColor:X.borderColor,borderWidth:X.borderWidth??cn(X.borderWidthExpr,"table.border_width",jt)??void 0,textColor:X.textColor,textSize:X.textSize??cn(X.textSizeExpr,"table.text_size",jt)??void 0,textHalign:X.textHalign,textValign:X.textValign,frameColor:X.frameColor,frameWidth:X.frameWidth??cn(X.frameWidthExpr,"table.frame_width",jt)??void 0,cells:new Map,merges:[],layer:Tc,zIndex:sf,includeInAutoscale:Sf,groupId:X.groupId??(Vo==null?void 0:Vo.groupId),tags:al(X.tags)??(Vo==null?void 0:Vo.tags)}),qp.table.set(su,Am),b("table",ln?"updated":"created"),l_.push(su),Sh(l_,Qf,y6,"table"),Fe&&Vo&&(Zm.set(Fe,su),Ke(Fe,Vo),p.set(Fe,Vo));continue}if(X.kind==="table_set"){const Fe=fn("table",X.target,X.targetExpr,Zm);if(!Fe)continue;const gt=Qf.get(Fe);if(!gt)continue;if(X.position&&(gt.position=X.position),X.bgcolor&&(gt.bgcolor=X.bgcolor),X.borderColor&&(gt.borderColor=X.borderColor),X.borderWidth!=null||X.borderWidthExpr){const fs=X.borderWidth??cn(X.borderWidthExpr,"table.set_border_width",jt);fs!=null&&(gt.borderWidth=fs)}if(X.textColor&&(gt.textColor=X.textColor),X.textSize!=null||X.textSizeExpr){const fs=X.textSize??cn(X.textSizeExpr,"table.set_text_size",jt);fs!=null&&(gt.textSize=fs)}if(X.textHalign&&(gt.textHalign=X.textHalign),X.textValign&&(gt.textValign=X.textValign),X.frameColor&&(gt.frameColor=X.frameColor),X.frameWidth!=null||X.frameWidthExpr){const fs=X.frameWidth??cn(X.frameWidthExpr,"table.set_frame_width",jt);fs!=null&&(gt.frameWidth=fs)}qp.table.set(Fe,Am),b("table","updated");continue}if(X.kind==="table_delete"){const Fe=fn("table",X.target,X.targetExpr,Zm);if(!Fe)continue;Qf.delete(Fe);const gt=l_.indexOf(Fe);gt>=0&&l_.splice(gt,1),Xm("table",Fe);continue}if(X.kind==="table_clear"){const Fe=fn("table",X.target,X.targetExpr,Zm);if(!Fe)continue;const gt=Qf.get(Fe);if(!gt)continue;if(!(X.startColumn!=null||X.startRow!=null||X.endColumn!=null||X.endRow!=null)){(Ry=(N_=gt.cells)==null?void 0:N_.clear)==null||Ry.call(N_),gt.merges=[],qp.table.set(Fe,Am),b("table","updated");continue}const ln=cn(X.startColumn,"table.clear_start_col",jt),Ci=cn(X.startRow,"table.clear_start_row",jt),hl=cn(X.endColumn,"table.clear_end_col",jt),Ac=cn(X.endRow,"table.clear_end_row",jt);if(ln==null||Ci==null||hl==null||Ac==null){(jy=(A_=gt.cells)==null?void 0:A_.clear)==null||jy.call(A_),gt.merges=[];continue}const Ma=Math.min(Math.floor(ln),Math.floor(hl)),su=Math.max(Math.floor(ln),Math.floor(hl)),tf=Math.min(Math.floor(Ci),Math.floor(Ac)),Tc=Math.max(Math.floor(Ci),Math.floor(Ac)),sf=gt.cells||new Map;for(const Sf of Array.from(sf.keys())){const[Vo,tc]=String(Sf).split(":"),Ch=Number(Vo),$g=Number(tc);Ch>=Ma&&Ch<=su&&$g>=tf&&$g<=Tc&&sf.delete(Sf)}gt.cells=sf,Array.isArray(gt.merges)&&gt.merges.length&&(gt.merges=gt.merges.filter(Sf=>{if(!Sf)return!1;const Vo=Math.min(Sf.left,Sf.right),tc=Math.max(Sf.left,Sf.right),Ch=Math.min(Sf.top,Sf.bottom),$g=Math.max(Sf.top,Sf.bottom);return!(Vo<=su&&tc>=Ma&&Ch<=Tc&&$g>=tf)})),qp.table.set(Fe,Am),b("table","updated");continue}if(X.kind==="table_merge"){const Fe=fn("table",X.target,X.targetExpr,Zm);if(!Fe)continue;const gt=Qf.get(Fe);if(!gt)continue;const fs=cn(X.left,"table.merge_left",jt),ln=cn(X.top,"table.merge_top",jt),Ci=cn(X.right,"table.merge_right",jt),hl=cn(X.bottom,"table.merge_bottom",jt);if(fs==null||ln==null||Ci==null||hl==null)continue;const Ac=Math.min(Math.floor(fs),Math.floor(Ci)),Ma=Math.max(Math.floor(fs),Math.floor(Ci)),su=Math.min(Math.floor(ln),Math.floor(hl)),tf=Math.max(Math.floor(ln),Math.floor(hl));gt.columns=Math.max(gt.columns||1,Ma+1),gt.rows=Math.max(gt.rows||1,tf+1),Array.isArray(gt.merges)||(gt.merges=[]);const Tc=`${Ac}:${su}:${Ma}:${tf}`;gt.merges.some(sf=>`${sf.left}:${sf.top}:${sf.right}:${sf.bottom}`===Tc)||gt.merges.push({left:Ac,top:su,right:Ma,bottom:tf}),qp.table.set(Fe,Am),b("table","updated");continue}if(X.kind==="table_cell"||X.kind==="table_cell_set"){const Fe=fn("table",X.target,X.targetExpr,Zm);if(!Fe)continue;let gt=Qf.get(Fe);if(!gt){const Ci=Wf("table",Fe);gt={id:Fe,position:"top_right",columns:Math.max(1,Math.floor(Number(X.column??0)+1)),rows:Math.max(1,Math.floor(Number(X.row??0)+1)),cells:new Map,merges:[],groupId:Ci==null?void 0:Ci.groupId,tags:Ci==null?void 0:Ci.tags},Qf.set(Fe,gt),l_.push(Fe),Sh(l_,Qf,y6,"table")}gt.columns=Math.max(gt.columns||1,Math.floor(Number(X.column??0)+1)),gt.rows=Math.max(gt.rows||1,Math.floor(Number(X.row??0)+1));const fs=`${X.column??0}:${X.row??0}`,ln=gt.cells.get(fs)||{column:Math.floor(Number(X.column??0)),row:Math.floor(Number(X.row??0))};if((X.text!=null||X.textExpr)&&(ln.text=eo(X.text,X.textExpr,"table.cell_text",jt)),X.textColor&&(ln.textColor=X.textColor),X.bgcolor&&(ln.bgcolor=X.bgcolor),X.textSize!=null||X.textSizeExpr){const Ci=X.textSize??cn(X.textSizeExpr,"table.cell_text_size",jt);Ci!=null&&(ln.textSize=Ci)}if(X.textHalign&&(ln.textHalign=X.textHalign),X.textValign&&(ln.textValign=X.textValign),X.width!=null||X.widthExpr){const Ci=X.width??cn(X.widthExpr,"table.cell_width",jt);Ci!=null&&(ln.width=Ci)}if(X.height!=null||X.heightExpr){const Ci=X.height??cn(X.heightExpr,"table.cell_height",jt);Ci!=null&&(ln.height=Ci)}(X.tooltip!=null||X.tooltipExpr)&&(ln.tooltip=eo(X.tooltip,X.tooltipExpr,"table.cell_tooltip",jt)),gt.cells.set(fs,ln),qp.table.set(Fe,Am),b("table","updated");continue}if(X.kind==="draw_clear"){const Fe=X.filterKind,gt=cu(X.groupId),fs=cu(X.tag),ln=(Ci,hl,Ac)=>{const Ma=Array.from(hl.keys());for(const su of Ma){const tf=hl.get(su);if(!kh(Ci,su,tf,Fe,gt,fs))continue;hl.delete(su);const Tc=Ac.indexOf(su);Tc>=0&&Ac.splice(Tc,1),ie&&(Ci==="line"||Ci==="label"||Ci==="box")?Jf(Ci,su):Xm(Ci,su)}};(!Fe||Fe==="line")&&ln("line",Jh,c1),(!Fe||Fe==="linefill")&&ln("linefill",rd,u1),(!Fe||Fe==="label")&&ln("label",Qu,d1),(!Fe||Fe==="box")&&ln("box",Rc,f1),(!Fe||Fe==="table")&&ln("table",Qf,l_),(!Fe||Fe==="polyline")&&ln("polyline",Lf,p1),(!Fe||Fe==="polygon")&&ln("polygon",Jm,m1),(!Fe||Fe==="path")&&ln("path",pm,h1),ie&&(!Fe||Fe==="label")&&(Qy=Qu.size),ie&&(!Fe||Fe==="box")&&(eb=Rc.size),ie&&(!Fe||Fe==="line")&&(Jy=Jh.size);continue}if(X.kind==="draw_for_each"){const Fe=X.updates||{},gt=X.filterKind,fs=cu(X.groupId),ln=cu(X.tag),Ci=Vo=>{if(Fe.color&&(Vo.color=Fe.color),Fe.gradient&&(Vo.gradient=Fe.gradient),Fe.width!=null||Fe.widthExpr){const tc=Fe.width??cn(Fe.widthExpr,"draw.for_each_line_width",jt),Ch=Zn(tc);Ch!=null&&(Vo.width=Ch)}if(Fe.glow!=null){const tc=ma(Fe.glow);tc!=null&&(Vo.glow=tc)}if(Fe.glowOpacity!=null){const tc=Xa(Fe.glowOpacity);tc!=null&&(Vo.glowOpacity=tc)}Fe.glowColor&&(Vo.glowColor=Fe.glowColor),Fe.style&&(Vo.style=Fe.style),Fe.extend&&(Vo.extend=Fe.extend),Fe.xloc&&(Vo.xloc=Fe.xloc)},hl=Vo=>{if(Fe.color&&(Vo.color=Fe.color),Fe.textColor&&(Vo.textColor=Fe.textColor),Fe.bgGradient&&(Vo.bgGradient=Fe.bgGradient),Fe.text!=null||Fe.textExpr){const tc=eo(Fe.text,Fe.textExpr,"draw.for_each_label_text",jt);Vo.text=ws(tc,Js)}if(Fe.textSize!=null||Fe.textSizeExpr){const tc=Fe.textSize??cn(Fe.textSizeExpr,"draw.for_each_label_size",jt);tc!=null&&(Vo.size=Ss(tc))}Fe.xloc&&(Vo.xloc=Fe.xloc),!ie&&Fe.wrap!=null&&(Vo.wrap=Fe.wrap),!ie&&Fe.maxWidth!=null&&(Vo.maxWidth=Fe.maxWidth),Fe.padding!=null&&(Vo.padding=Fe.padding),Fe.bgColor&&(Vo.bgColor=Nl(Fe.bgColor)),Fe.bgOpacity!=null&&(Vo.bgOpacity=Fe.bgOpacity),Fe.borderColor&&(Vo.borderColor=Qc(Fe.borderColor)),Fe.borderWidth!=null&&(Vo.borderWidth=Fr(Fe.borderWidth)),Fe.radius!=null&&(Vo.radius=Fe.radius),Fe.align&&(Vo.align=Fe.align),Fe.valign&&(Vo.valign=Fe.valign),Fe.lineHeight!=null&&(Vo.lineHeight=Fe.lineHeight),Fe.fontFamily&&(Vo.fontFamily=Fe.fontFamily),Fe.fontSize!=null&&(Vo.fontSize=Fe.fontSize),Fe.fontWeight&&(Vo.fontWeight=Fe.fontWeight),Fe.monospace!=null&&(Vo.monospace=Fe.monospace)},Ac=Vo=>{if(Fe.bgColor&&(Vo.bgColor=Fe.bgColor),Fe.bgGradient&&(Vo.bgGradient=Fe.bgGradient),Fe.borderColor&&(Vo.borderColor=Fe.borderColor),Fe.textColor&&(Vo.textColor=Fe.textColor),(Fe.text!=null||Fe.textExpr)&&(Vo.text=eo(Fe.text,Fe.textExpr,"draw.for_each_box_text",jt)),Fe.textSize!=null||Fe.textSizeExpr){const tc=Fe.textSize??cn(Fe.textSizeExpr,"draw.for_each_box_text_size",jt),Ch=ie?Ra(tc):tc;Ch!=null&&(Vo.textSize=Ch)}Fe.extend&&(Vo.extend=Fe.extend),Fe.xloc&&(Vo.xloc=Fe.xloc)},Ma=Vo=>{Fe.color&&(Vo.color=Fe.color)},su=Vo=>{if(Fe.bgColor&&(Vo.bgcolor=Fe.bgColor),Fe.borderColor&&(Vo.borderColor=Fe.borderColor),Fe.textColor&&(Vo.textColor=Fe.textColor),Fe.textSize!=null||Fe.textSizeExpr){const tc=Fe.textSize??cn(Fe.textSizeExpr,"draw.for_each_table_text_size",jt);tc!=null&&(Vo.textSize=tc)}},tf=Vo=>{if(Fe.color&&(Vo.color=Fe.color),Fe.gradient&&(Vo.gradient=Fe.gradient),Fe.width!=null||Fe.widthExpr){const tc=Fe.width??cn(Fe.widthExpr,"draw.for_each_polyline_width",jt);tc!=null&&(Vo.width=tc)}if(Fe.style&&(Vo.style=Fe.style),Fe.opacity!=null&&(Vo.opacity=Fe.opacity),Fe.glow!=null){const tc=ma(Fe.glow);tc!=null&&(Vo.glow=tc)}if(Fe.glowOpacity!=null){const tc=Xa(Fe.glowOpacity);tc!=null&&(Vo.glowOpacity=tc)}Fe.glowColor&&(Vo.glowColor=Fe.glowColor)},Tc=Vo=>{if(Fe.fillColor&&(Vo.fillColor=Fe.fillColor),Fe.fillGradient&&(Vo.fillGradient=Fe.fillGradient),Fe.color&&(Vo.strokeColor=Fe.color),Fe.borderColor&&(Vo.strokeColor=Fe.borderColor),Fe.width!=null||Fe.widthExpr){const tc=Fe.width??cn(Fe.widthExpr,"draw.for_each_polygon_width",jt);tc!=null&&(Vo.strokeWidth=tc)}if(Fe.opacity!=null&&(Vo.opacity=Fe.opacity),Fe.glow!=null){const tc=ma(Fe.glow);tc!=null&&(Vo.glow=tc)}if(Fe.glowOpacity!=null){const tc=Xa(Fe.glowOpacity);tc!=null&&(Vo.glowOpacity=tc)}Fe.glowColor&&(Vo.glowColor=Fe.glowColor)},sf=Vo=>{if(Fe.color&&(Vo.color=Fe.color),Fe.gradient&&(Vo.gradient=Fe.gradient),Fe.width!=null||Fe.widthExpr){const tc=Fe.width??cn(Fe.widthExpr,"draw.for_each_path_width",jt);tc!=null&&(Vo.width=tc)}if(Fe.style&&(Vo.style=Fe.style),Fe.opacity!=null&&(Vo.opacity=Fe.opacity),Fe.glow!=null){const tc=ma(Fe.glow);tc!=null&&(Vo.glow=tc)}if(Fe.glowOpacity!=null){const tc=Xa(Fe.glowOpacity);tc!=null&&(Vo.glowOpacity=tc)}Fe.glowColor&&(Vo.glowColor=Fe.glowColor)},Sf=(Vo,tc,Ch)=>{for(const[$g,C0]of tc.entries())kh(Vo,$g,C0,gt,fs,ln)&&Ch(C0)};(!gt||gt==="line")&&Sf("line",Jh,Ci),(!gt||gt==="linefill")&&Sf("linefill",rd,Ma),(!gt||gt==="label")&&Sf("label",Qu,hl),(!gt||gt==="box")&&Sf("box",Rc,Ac),(!gt||gt==="table")&&Sf("table",Qf,su),(!gt||gt==="polyline")&&Sf("polyline",Lf,tf),(!gt||gt==="polygon")&&Sf("polygon",Jm,Tc),(!gt||gt==="path")&&Sf("path",pm,sf);continue}}if(i(nr)){let jt=0;for(const[en,X]of Qu.entries()){if(jt>=tb){lt("labels",tb);break}const io=Ht(X.x,X.xloc,{kind:"label",id:en});if(io==null||io<0||io>Ei)continue;const Fe=X.yloc||"price";let gt=X.y;if(Fe==="abovebar"||Fe==="belowbar"){if(io>=Bt)continue;const Ma=G[io],su=(Ma==null?void 0:Ma.high)??(Ma==null?void 0:Ma.h),tf=(Ma==null?void 0:Ma.low)??(Ma==null?void 0:Ma.l);if(Fe==="abovebar"){if(!Number.isFinite(su))continue;gt=Number(su)}if(Fe==="belowbar"){if(!Number.isFinite(tf))continue;gt=Number(tf)}}if(!Number.isFinite(gt))continue;const fs=X.includeInAutoscale!=null?X.includeInAutoscale:ie?Fe==="price":X.includeInAutoscale,ln=id[io]||(id[io]={}),Ci=`__label_rt_${io}_${zf.length}`;ln[Ci]={id:en,text:X.text||"",color:X.color||"#f97316",yKey:"__rt__",position:Fe==="belowbar"?"below":"above",value:gt,yloc:Fe,shape:X.shape,callout:X.callout,textColor:X.textColor,textAlign:X.textAlign,tooltip:X.tooltip,size:X.size,pineV2:ie||void 0,wrap:X.wrap,maxWidth:X.maxWidth,padding:X.padding,bgColor:X.bgColor,bgGradient:X.bgGradient??X.gradient,bgOpacity:X.bgOpacity,borderColor:X.borderColor,borderWidth:X.borderWidth,radius:X.radius,align:X.align,valign:X.valign,lineHeight:X.lineHeight,fontFamily:X.fontFamily,fontSize:X.fontSize,fontWeight:X.fontWeight,monospace:X.monospace,offsetY:0,layer:X.layer,zIndex:X.zIndex,includeInAutoscale:fs};const hl=((By=G[io])==null?void 0:By.timestamp)??((Oy=G[io])==null?void 0:Oy.time)??((zy=G[io])==null?void 0:zy.t),Ac=typeof hl=="number"&&Number.isFinite(hl)?hl<1e12?Math.floor(hl*1e3):Math.floor(hl):void 0;zf.push({index:io,ts:hl,tsMs:Ac,meta:ln[Ci]}),jt+=1}}const V2=new Map;for(const[jt,en]of Jh.entries()){const X={kind:"line",id:jt},io=Ht(en.x1,en.xloc,X),Fe=Ht(en.x2,en.xloc,X);if(io==null||Fe==null||!Number.isFinite(en.y1)||!Number.isFinite(en.y2))continue;const gt=Fe!==io?(en.y2-en.y1)/(Fe-io):void 0,fs=gt!=null?en.y1-gt*io:void 0,ln={id:jt,startIndex:io,endIndex:Fe,startValue:en.y1,endValue:en.y2,slope:gt,intercept:fs,color:en.color,gradient:en.gradient,width:en.width,glow:en.glow,glowColor:en.glowColor,glowOpacity:en.glowOpacity,style:en.style,extend:en.extend,strictExtend:ie,layer:en.layer,zIndex:en.zIndex,includeInAutoscale:en.includeInAutoscale};V2.set(jt,ln),ys.push(ln)}for(const jt of rd.values()){if(!jt)continue;const en=V2.get(jt.line1),X=V2.get(jt.line2);!en||!X||kl.push({line1:en,line2:X,color:jt.color,layer:jt.layer,zIndex:jt.zIndex,includeInAutoscale:jt.includeInAutoscale})}for(const[jt,en]of Rc.entries()){const X={kind:"box",id:jt},io=Ht(en.left,en.xloc,X),Fe=Ht(en.right,en.xloc,X);io==null||Fe==null||!Number.isFinite(en.top)||!Number.isFinite(en.bottom)||Do.push({leftIndex:io,rightIndex:Fe,topValue:en.top,bottomValue:en.bottom,borderColor:en.borderColor,bgColor:en.bgColor,bgGradient:en.bgGradient,borderWidth:en.borderWidth,borderStyle:en.borderStyle,text:en.text,textColor:en.textColor,textSize:en.textSize,textHalign:en.textHalign,textValign:en.textValign,textWrap:en.textWrap,extend:en.extend,layer:en.layer,zIndex:en.zIndex,includeInAutoscale:en.includeInAutoscale})}for(const[jt,en]of Lf.entries()){if(!en||!Array.isArray(en.points))continue;const X=[];for(const io of en.points){if(!io)continue;const Fe=Ht(io.x,io.xloc||en.xloc,{kind:"polyline",id:jt});if(Fe==null)continue;const gt=io.y;Number.isFinite(gt)&&X.push({index:Fe,value:gt})}X.length<2||ds.push({id:en.id,points:X,color:en.color,gradient:en.gradient,width:en.width,style:en.style,opacity:en.opacity,glow:en.glow,glowColor:en.glowColor,glowOpacity:en.glowOpacity,layer:en.layer,zIndex:en.zIndex,includeInAutoscale:en.includeInAutoscale})}for(const[jt,en]of Jm.entries()){if(!en||!Array.isArray(en.points))continue;const X=[];for(const io of en.points){if(!io)continue;const Fe=Ht(io.x,io.xloc||en.xloc,{kind:"polygon",id:jt});if(Fe==null)continue;const gt=io.y;Number.isFinite(gt)&&X.push({index:Fe,value:gt})}X.length<3||Gn.push({id:en.id,points:X,fillColor:en.fillColor,fillGradient:en.fillGradient,strokeColor:en.strokeColor,strokeWidth:en.strokeWidth,strokeStyle:en.strokeStyle,opacity:en.opacity,glow:en.glow,glowColor:en.glowColor,glowOpacity:en.glowOpacity,layer:en.layer,zIndex:en.zIndex,includeInAutoscale:en.includeInAutoscale})}for(const[jt,en]of pm.entries()){if(!en||!Array.isArray(en.commands))continue;const X=[];for(const io of en.commands){if(!io||!io.cmd)continue;const Fe=Ht(io.x,io.xloc||en.xloc,{kind:"path",id:jt});if(Fe==null)continue;const gt=io.y;if(!Number.isFinite(gt))continue;const fs=String(io.cmd||"").toUpperCase();fs!=="M"&&fs!=="L"||X.push({cmd:fs,index:Fe,value:gt})}X.length&&xn.push({id:en.id,commands:X,color:en.color,gradient:en.gradient,width:en.width,style:en.style,opacity:en.opacity,glow:en.glow,glowColor:en.glowColor,glowOpacity:en.glowOpacity,layer:en.layer,zIndex:en.zIndex,includeInAutoscale:en.includeInAutoscale})}for(const jt of Qf.values()){const en=[];(jt.cells||new Map).forEach(io=>{en.push({column:Math.floor(Number(io.column??0)),row:Math.floor(Number(io.row??0)),text:io.text||"",textColor:io.textColor,bgcolor:io.bgcolor,textSize:io.textSize,textHalign:io.textHalign,textValign:io.textValign,width:io.width,height:io.height,tooltip:io.tooltip})}),oo.push({id:jt.id,position:jt.position,columns:Math.max(1,Math.floor(Number(jt.columns??1))),rows:Math.max(1,Math.floor(Number(jt.rows??1))),bgcolor:jt.bgcolor,borderColor:jt.borderColor,textColor:jt.textColor,frameColor:jt.frameColor,borderWidth:jt.borderWidth,frameWidth:jt.frameWidth,textSize:jt.textSize,textHalign:jt.textHalign,textValign:jt.textValign,cells:en,merges:Array.isArray(jt.merges)?jt.merges:[],layer:jt.layer,zIndex:jt.zIndex,includeInAutoscale:jt.includeInAutoscale})}}if(i(nr)&&ai.length)for(const Oe of ai){if(!Oe||!Oe.x||!Oe.y)continue;const _t=String(Oe.whenExpr||"").trim(),p=String(Oe.when||"").trim(),b=_t||p?Xf(_t,p):null,F=se(String(Oe.x)),H=se(String(Oe.y));if(!F||!H)continue;const be=Fs(b,300),Pe=Oe.textExpr?String(Oe.textExpr):"",Ze=Pe?Ft(Pe):null,Ke=Oe.colorExpr?String(Oe.colorExpr):"",ut=Ke?Ft(Ke):null,Gt=Oe.textColorExpr?String(Oe.textColorExpr):"",fn=Gt?Ft(Gt):null,$n=Oe.sizeExpr?String(Oe.sizeExpr):"",cn=$n?se($n):null,eo=Ds(Oe.layer),Js=xs(Oe.zIndex),Co=Rs(Oe.includeInAutoscale);for(const ws of be){const Zn=F[ws],Ss=Ht(Zn,Oe.xloc,{kind:"runtime_label",id:ws});if(Ss==null||Ss<0||Ss>Ei)continue;let Ra=H[ws];if(Oe.yloc==="abovebar"||Oe.yloc==="belowbar"){if(Ss>=Bt)continue;const Sl=G[Ss],ff=(Sl==null?void 0:Sl.high)??(Sl==null?void 0:Sl.h),Cl=(Sl==null?void 0:Sl.low)??(Sl==null?void 0:Sl.l);Oe.yloc==="abovebar"&&Number.isFinite(ff)&&(Ra=ff),Oe.yloc==="belowbar"&&Number.isFinite(Cl)&&(Ra=Cl)}if(!Number.isFinite(Ra))continue;const xc=Oe.text!=null?String(Oe.text):Ze?String(Ze[ws]??""):"",Nl=ut&&ut[ws]!=null&&String(ut[ws]).trim()?String(ut[ws]):Oe.color||"#f97316",Qc=fn&&fn[ws]!=null&&String(fn[ws]).trim()?String(fn[ws]):Oe.textColor,al=cn?cn[ws]:NaN,Hd=Number.isFinite(al)?al:Oe.size,Zi=id[Ss]||(id[Ss]={}),Xu=`__label_rt_${Ss}_${zf.length}`;Zi[Xu]={text:xc,color:Nl,yKey:"__rt__",position:Oe.yloc==="belowbar"?"below":"above",value:Ra,shape:Oe.shape,callout:Oe.callout,textColor:Qc,textAlign:Oe.textAlign,tooltip:Oe.tooltip,size:Hd,offsetY:typeof Oe.offsetY=="number"?Oe.offsetY:0,layer:eo,zIndex:Js,includeInAutoscale:Co,wrap:Oe.wrap,maxWidth:Oe.maxWidth,padding:Oe.padding,bgColor:Oe.bgColor,bgOpacity:Oe.bgOpacity,borderColor:Oe.borderColor,borderWidth:Oe.borderWidth,radius:Oe.radius,align:Oe.align,valign:Oe.valign,lineHeight:Oe.lineHeight,fontFamily:Oe.fontFamily,fontSize:Oe.fontSize,fontWeight:Oe.fontWeight,monospace:Oe.monospace};const Jf=((Vy=G[Ss])==null?void 0:Vy.timestamp)??((Wy=G[Ss])==null?void 0:Wy.time)??((Hy=G[Ss])==null?void 0:Hy.t),Cu=typeof Jf=="number"&&Number.isFinite(Jf)?Jf<1e12?Math.floor(Jf*1e3):Math.floor(Jf):void 0;zf.push({index:Ss,ts:Jf,tsMs:Cu,meta:Zi[Xu]})}}Uo.__labelItems=zf,Uo.__tsIndex=Qa,Uo.__timeSeriesMs=lu;const Vf=[];if(Bs.length)for(const Oe of Bs){if(!Oe)continue;const _t=String(Oe.whenExpr||"").trim(),p=String(Oe.when||"").trim(),b=_t||p?Xf(_t,p):null,F=se(String(Oe.x1)),H=se(String(Oe.y1)),be=se(String(Oe.x2)),Pe=se(String(Oe.y2));if(!F||!H||!be||!Pe)continue;const Ze=Fs(b,240),Ke=Oe.colorExpr?String(Oe.colorExpr):"",ut=Ke?Ft(Ke):null,Gt=Oe.widthExpr||Oe.sizeExpr,fn=Gt?String(Gt):"",$n=fn?se(fn):null;for(const cn of Ze){const eo={kind:"runtime_line",id:cn},Js=Ht(F[cn],Oe.xloc,eo),Co=Ht(be[cn],Oe.xloc,eo);if(Js==null||Co==null)continue;const ws=H[cn],Zn=Pe[cn];if(!Number.isFinite(ws)||!Number.isFinite(Zn))continue;const Ss=Co!==Js?(Zn-ws)/(Co-Js):void 0,Fr=Ss!=null?ws-Ss*Js:void 0,Ra=ut&&ut[cn]!=null&&String(ut[cn]).trim()?String(ut[cn]):Oe.color,xc=$n?$n[cn]:NaN,Nl=Number.isFinite(xc)?xc:Oe.width,Qc=ma(Oe.glow),al=Xa(Oe.glowOpacity);Vf.push({startIndex:Js,endIndex:Co,startValue:ws,endValue:Zn,slope:Ss,intercept:Fr,color:Ra,gradient:Oe.gradient,width:Nl,glow:Qc,glowColor:Oe.glowColor,glowOpacity:al,style:Oe.style,extend:Oe.extend,strictExtend:ie,layer:Ds(Oe.layer),zIndex:xs(Oe.zIndex),includeInAutoscale:Rs(Oe.includeInAutoscale)})}}const Tr=[];if(Fn.length)for(const Oe of Fn){if(!Oe)continue;const _t=String(Oe.whenExpr||"").trim(),p=String(Oe.when||"").trim(),b=_t||p?Xf(_t,p):null,F=se(String(Oe.left)),H=se(String(Oe.right)),be=se(String(Oe.top)),Pe=se(String(Oe.bottom)),Ze=Oe.textExpr?String(Oe.textExpr):"",Ke=Ze?Ft(Ze):null,ut=Oe.bgColorExpr?String(Oe.bgColorExpr):"",Gt=ut?Ft(ut):null,fn=Oe.borderColorExpr?String(Oe.borderColorExpr):"",$n=fn?Ft(fn):null,cn=Oe.textColorExpr?String(Oe.textColorExpr):"",eo=cn?Ft(cn):null,Js=Oe.borderWidthExpr||Oe.sizeExpr,Co=Js?String(Js):"",ws=Co?se(Co):null;if(!F||!H||!be||!Pe)continue;const Zn=Fs(b,180);for(const Ss of Zn){const Fr={kind:"runtime_box",id:Ss},Ra=Ht(F[Ss],Oe.xloc,Fr),xc=Ht(H[Ss],Oe.xloc,Fr);if(Ra==null||xc==null)continue;const Nl=be[Ss],Qc=Pe[Ss];if(!Number.isFinite(Nl)||!Number.isFinite(Qc))continue;const al=Oe.text!=null?String(Oe.text):Ke?String(Ke[Ss]??""):"",Hd=Gt&&Gt[Ss]!=null&&String(Gt[Ss]).trim()?String(Gt[Ss]):Oe.bgColor,Zi=$n&&$n[Ss]!=null&&String($n[Ss]).trim()?String($n[Ss]):Oe.borderColor,Xu=eo&&eo[Ss]!=null&&String(eo[Ss]).trim()?String(eo[Ss]):Oe.textColor,Jf=ws?ws[Ss]:NaN,Cu=Number.isFinite(Jf)?Jf:Oe.borderWidth;Tr.push({leftIndex:Ra,rightIndex:xc,topValue:Nl,bottomValue:Qc,borderColor:Zi,bgColor:Hd,bgGradient:Oe.bgGradient??Oe.gradient,borderWidth:Cu,borderStyle:Oe.borderStyle,text:al,textColor:Xu,textSize:Oe.textSize,textHalign:Oe.textHalign,textValign:Oe.textValign,textWrap:Oe.textWrap,extend:Oe.extend,layer:Ds(Oe.layer),zIndex:xs(Oe.zIndex),includeInAutoscale:Rs(Oe.includeInAutoscale)})}}const zo=[];if(ks.length){const at=Math.max(0,Bt-1);for(const Oe of ks){if(!Oe)continue;const _t=Math.max(1,Math.floor(Number(Oe.columns??1))),p=Math.max(1,Math.floor(Number(Oe.rows??1))),b=[],F=Array.isArray(Oe.cells)?Oe.cells:[];for(const H of F){if(!H)continue;const be=String(H.whenExpr||"").trim(),Pe=String(H.when||"").trim();if(be||Pe){const ut=Xf(be,Pe);if(ut&&!ut[at])continue}let Ze="";if(H.text!=null)Ze=String(H.text);else if(H.textExpr){const ut=Ft(String(H.textExpr));Ze=ut?String(ut[at]??""):""}const Ke=H.tooltip!=null?String(H.tooltip):H.tooltipExpr?evalTextAt(void 0,String(H.tooltipExpr),"table.tooltip",at):void 0;b.push({column:Math.floor(Number(H.column??0)),row:Math.floor(Number(H.row??0)),text:Ze,textColor:H.textColor,bgcolor:H.bgcolor,textSize:H.textSize,textHalign:H.textHalign,textValign:H.textValign,width:H.width,height:H.height,tooltip:Ke})}zo.push({id:Oe.id,position:Oe.position,columns:_t,rows:p,bgcolor:Oe.bgcolor,borderColor:Oe.borderColor,textColor:Oe.textColor,frameColor:Oe.frameColor,borderWidth:Oe.borderWidth,frameWidth:Oe.frameWidth,textSize:Oe.textSize,textHalign:Oe.textHalign,textValign:Oe.textValign,cells:b,merges:Array.isArray(Oe.merges)?Oe.merges:[],layer:Ds(Oe.layer),zIndex:xs(Oe.zIndex),includeInAutoscale:Rs(Oe.includeInAutoscale)})}}const ha=Vf.length||ys.length?Vf.concat(ys):[],Yr=kl.length?kl:[],Pa=Tr.length||Do.length?Tr.concat(Do):[],Bu=ds.length?ds:[],ef=Gn.length?Gn:[],wp=xn.length?xn:[],Hp=zo.length||oo.length?zo.concat(oo):[];if(Uo.__runtimeLineDefs=ha,Uo.__runtimeLineFills=Yr,Uo.__runtimeBoxDefs=Pa,Uo.__runtimePolylineDefs=Bu,Uo.__runtimePolygonDefs=ef,Uo.__runtimePathDefs=wp,Uo.__runtimeTables=Hp,Uo.__runtimeHeatmaps=vs,bc&&Da&&Nt.set(bc,Da),Array.isArray(k)&&k.length){let at=[];const Oe=_t=>{const p=[];for(let b=Bt-1;b>=0&&p.length<2;(b-=1)+1){const F=_t[b];F!=null&&Number.isFinite(F)&&p.push(b)}return p.reverse()};if(k.forEach(_t=>{const p=String(_t.colorExpr||"").trim(),b=p?Ku(p):null,F=String(_t.widthExpr||_t.sizeExpr||"").trim(),H=F?Xh(F):null,be=String(_t.start||"").replace(/\s+/g,"_").toLowerCase(),Pe=String(_t.end||"").replace(/\s+/g,"_").toLowerCase();let Ke=rt[be]||rt[Pe]||"";Ke||(/low/i.test(be)||/low/i.test(Pe)?Ke="pl":(/high/i.test(be)||/high/i.test(Pe))&&(Ke="ph"));const Gt=(_t.segmentsFrom?String(_t.segmentsFrom):"").replace(/\s+/g,"_").toLowerCase(),fn=Bn[Ke],$n=Gt&&Bn[Gt]||void 0,cn=$n||fn||Bn.ph||Bn.pl;if(cn)if($n){const eo=[];for(let Zn=0;Zn<Bt;(Zn+=1)-1){const Ss=$n[Zn];Ss!=null&&Number.isFinite(Ss)&&eo.push(Zn)}const Js=Math.max(1,Number(_t.maxSegments)||eo.length-1),Co=Math.min(Js,24);let ws=0;for(let Zn=eo.length-2;Zn>=0&&!(ws>=Co);(Zn-=1)+1){const Ss=eo[Zn],Fr=eo[Zn+1],Ra=$n[Ss],xc=$n[Fr];if(!Number.isFinite(Ra)||!Number.isFinite(xc)||Fr===Ss)continue;const Nl=(xc-Ra)/(Fr-Ss),Qc=Ra-Nl*Ss;let al=!1;const Hd=Math.max(Ss,Bt-80);let Zi=NaN;for(let Xu=Hd;Xu<=Math.min(Fr,Bt-1);(Xu+=1)-1){const Jf=Nl*Xu+Qc,Cu=Bn.close[Xu];if(!Number.isFinite(Jf)||!Number.isFinite(Cu))continue;const Sl=Cu-Jf;if(!Number.isNaN(Zi)&&Sl*Zi<0){al=!0;break}Zi=Sl}al||(at.push({startIndex:Ss,endIndex:Fr,startValue:Ra,endValue:xc,slope:Nl,intercept:Qc,color:xp(b,Fr,_t.color||"#64748b"),width:Im(H,Fr,_t.width??1),style:(_t.style||"dotted").toLowerCase(),extend:_t.extend||"right",name:_t.name}),ws+=1)}}else{const eo=Oe(cn);if(eo.length===2){const Js=eo[0],Co=eo[1],ws=cn[Js],Zn=cn[Co];if(Number.isFinite(ws)&&Number.isFinite(Zn)){const Ss=(Zn-ws)/(Co-Js),Fr=ws-Ss*Js;let Ra=!1;const xc=Math.max(Js,Bt-80);let Nl=NaN;for(let Qc=xc;Qc<=Math.min(Co,Bt-1);(Qc+=1)-1){const al=Ss*Qc+Fr,Hd=Bn.close[Qc];if(!Number.isFinite(al)||!Number.isFinite(Hd))continue;const Zi=Hd-al;if(!Number.isNaN(Nl)&&Zi*Nl<0){Ra=!0;break}Nl=Zi}if(Ra)return;at.push({startIndex:Js,endIndex:Co,startValue:ws,endValue:Zn,slope:Ss,intercept:Fr,color:xp(b,Co,_t.color||"#22c55e"),width:Im(H,Co,_t.width??2),style:(_t.style||"solid").toLowerCase(),extend:_t.extend||"none",name:_t.name})}}}}),at.length){const _t=[],p=new Set;for(const b of at){const F=Math.round((b.slope||0)*1e4),H=Math.round((b.intercept||0)*100),be=`${F}:${H}:${b.style}:${b.color}:${b.extend}`;p.has(be)||(p.add(be),_t.push(b))}at=_t.slice(0,60)}if(!at.length){const _t=(p,b,F,H)=>{const be=String(p||"").replace(/\s+/g,"_").toLowerCase(),Pe=Bn[be];if(!Pe)return;const Ze=[];for(let Ke=0;Ke<Bt;(Ke+=1)-1){const ut=Pe[Ke];ut!=null&&Number.isFinite(ut)&&Ze.push(Ke)}if(Ze.length>=2){const Ke=Ze[Ze.length-2],ut=Ze[Ze.length-1],Gt=Pe[Ke],fn=Pe[ut];if(Number.isFinite(Gt)&&Number.isFinite(fn)&&ut!==Ke){const $n=(fn-Gt)/(ut-Ke),cn=Gt-$n*Ke;at.push({startIndex:Ke,endIndex:ut,startValue:Gt,endValue:fn,slope:$n,intercept:cn,color:b,width:H,style:F,extend:"right",name:be})}}};_t("ph","#64748b","dotted",1),_t("pl","#64748b","dotted",1)}Uo.__lineDefs=at}if(Mn&&(Vt.length||S!=null&&S.strategy)){const at=U;try{const Oe=G.map(F=>({timestamp:F.timestamp??F.time??0})),_t=Vt.map(F=>({...F,when:En(String((F==null?void 0:F.when)||"")),frequency:F==null?void 0:F.frequency,cooldownBars:typeof(F==null?void 0:F.cooldownBars)=="number"&&Number.isFinite(F.cooldownBars)?Math.max(0,Math.floor(F.cooldownBars)):void 0}));_t.forEach((F,H)=>{!F||F.id!=null||(F.id=String(H))});const p=(F,H)=>{var Jh;let be=new Array(H).fill(0),Pe=new Array(H).fill(NaN),Ze=new Array(H).fill(0),Ke=new Array(H).fill(0),ut=new Array(H).fill(0),Gt=new Array(H).fill(0),fn=new Array(H).fill(0),$n=new Array(H).fill(0),cn=new Array(H).fill(0),eo=new Array(H).fill(0),Js=new Array(H).fill(0),Co=new Array(H).fill(0),ws=new Array(H).fill(0),Zn=new Array(H).fill(0),Ss=new Array(H).fill(0),Fr=new Array(H).fill(0),Ra=new Array(H).fill(0),xc=new Array(H).fill(0),Nl=new Array(H).fill(0);const Qc=((Jh=F==null?void 0:F.summary)==null?void 0:Jh.initialCapital)??0;let al=new Array(H).fill(Qc),Hd=new Array(H).fill(0);if(!F)return{positionSize:be,positionAvgPrice:Pe,openTrades:Ze,closedTrades:Ke,openProfit:ut,closedProfit:Gt,grossProfit:fn,grossLoss:$n,winTrades:cn,lossTrades:eo,winRate:Js,maxDrawdownPct:Co,maxDrawdownValue:ws,maxRunupPct:Zn,maxRunupValue:Ss,avgTrade:Fr,avgWin:Ra,avgLoss:xc,avgBarsInTrade:Nl,equity:al,netProfit:Hd,initialCapital:Qc};const Zi=F==null?void 0:F.series,Xu=rd=>Array.isArray(rd)&&rd.length===H?rd:null,Jf=Xu(Zi==null?void 0:Zi.positionSize),Cu=Xu(Zi==null?void 0:Zi.positionAvgPrice),Sl=Xu(Zi==null?void 0:Zi.openTrades),ff=Xu(Zi==null?void 0:Zi.closedTrades),Cl=Xu(Zi==null?void 0:Zi.openProfit),cu=Xu(Zi==null?void 0:Zi.closedProfit),Wf=Xu(Zi==null?void 0:Zi.grossProfit),kh=Xu(Zi==null?void 0:Zi.grossLoss),Xm=Xu(Zi==null?void 0:Zi.winTrades),z0=Xu(Zi==null?void 0:Zi.lossTrades),qg=Xu(Zi==null?void 0:Zi.winRate),Sh=Xu(Zi==null?void 0:Zi.maxDrawdownPct),Lg=Xu(Zi==null?void 0:Zi.maxDrawdownValue),em=Xu(Zi==null?void 0:Zi.maxRunupPct),fm=Xu(Zi==null?void 0:Zi.maxRunupValue),rp=Xu(Zi==null?void 0:Zi.avgTrade),Nm=Xu(Zi==null?void 0:Zi.avgWin),Zm=Xu(Zi==null?void 0:Zi.avgLoss),k0=Xu(Zi==null?void 0:Zi.avgBarsInTrade),r0=Xu(Zi==null?void 0:Zi.equity),a0=Xu(Zi==null?void 0:Zi.netProfit);if(Jf&&(be=Jf),Cu&&(Pe=Cu),Sl&&(Ze=Sl),ff&&(Ke=ff),Cl&&(ut=Cl),cu&&(Gt=cu),Wf&&(fn=Wf),kh&&($n=kh),Xm&&(cn=Xm),z0&&(eo=z0),qg&&(Js=qg),Sh&&(Co=Sh),Lg&&(ws=Lg),em&&(Zn=em),fm&&(Ss=fm),rp&&(Fr=rp),Nm&&(Ra=Nm),Zm&&(xc=Zm),k0&&(Nl=k0),r0&&(al=r0),a0&&(Hd=a0),!Jf){const rd=new Array(H);for(const Rc of F.orders||[]){if(!Rc||Rc.status!=="filled")continue;const Qf=Rc==null?void 0:Rc.filledIndex,Lf=typeof Qf=="number"&&Number.isFinite(Qf)?Math.floor(Qf):-1;if(Lf<0||Lf>=H)continue;const Jm=Rc==null?void 0:Rc.fillQty,pm=typeof Jm=="number"?Jm:Number(Jm);if(!Number.isFinite(pm)||pm===0)continue;const a1=String((Rc==null?void 0:Rc.side)||"").toLowerCase(),l1=String((Rc==null?void 0:Rc.action)||"").toLowerCase();let V0=0;l1==="entry"?V0=a1==="short"?-pm:pm:l1==="exit"&&(V0=a1==="short"?pm:-pm),!(!Number.isFinite(V0)||V0===0)&&(rd[Lf]||(rd[Lf]=[]),rd[Lf].push(V0))}let Qu=0;for(let Rc=0;Rc<H;(Rc+=1)-1){const Qf=rd[Rc];if(Qf)for(const Lf of Qf)Qu+=Lf;be[Rc]=Qu}}if(!Sl||!ff){const rd=new Int32Array(H+1),Qu=new Int32Array(H+1);for(const Lf of F.roundTrips||[]){const Jm=typeof Lf.entryIndex=="number"&&Number.isFinite(Lf.entryIndex)?Math.max(0,Math.floor(Lf.entryIndex)):-1,pm=typeof Lf.exitIndex=="number"&&Number.isFinite(Lf.exitIndex)?Math.max(0,Math.floor(Lf.exitIndex)):-1;Jm>=0&&Jm<H&&(rd[Jm]+=1),pm>=0&&pm<H&&(rd[pm]-=1,Qu[pm]+=1)}let Rc=0,Qf=0;for(let Lf=0;Lf<H;(Lf+=1)-1){Rc+=rd[Lf],Qf+=Qu[Lf];const Jm=be[Lf]!==0;Sl||(Ze[Lf]=Rc>0?Rc:Jm?1:0),ff||(Ke[Lf]=Qf)}}if(!r0&&Array.isArray(F.equity)&&F.equity.length){for(const Qu of F.equity){const Rc=Number(Qu==null?void 0:Qu.index),Qf=Number(Qu==null?void 0:Qu.equity);!Number.isFinite(Rc)||Rc<0||Rc>=H||Number.isFinite(Qf)&&(al[Math.floor(Rc)]=Qf)}let rd=al[0];for(let Qu=0;Qu<H;(Qu+=1)-1){const Rc=al[Qu];if(!Number.isFinite(Rc)){al[Qu]=rd;continue}rd=Rc}}if(!a0)for(let rd=0;rd<H;(rd+=1)-1){const Qu=al[rd];Hd[rd]=Number.isFinite(Qu)?Qu-Qc:NaN}if(!qg)for(let rd=0;rd<H;(rd+=1)-1){const Qu=Ke[rd]??0,Rc=cn[rd]??0;Js[rd]=Qu>0?Rc/Qu*100:0}if(!Sh){let rd=Qc;for(let Qu=0;Qu<H;(Qu+=1)-1){const Rc=al[Qu];if(Number.isFinite(Rc)&&(Rc>rd&&(rd=Rc),rd>0)){const Qf=(rd-Rc)/rd;Co[Qu]=Math.max(Co[Qu],Qf*100)}}}return{positionSize:be,positionAvgPrice:Pe,openTrades:Ze,closedTrades:Ke,openProfit:ut,closedProfit:Gt,grossProfit:fn,grossLoss:$n,winTrades:cn,lossTrades:eo,winRate:Js,maxDrawdownPct:Co,maxDrawdownValue:ws,maxRunupPct:Zn,maxRunupValue:Ss,avgTrade:Fr,avgWin:Ra,avgLoss:xc,avgBarsInTrade:Nl,equity:al,netProfit:Hd,initialCapital:Qc}},b=F=>{if(!F)return;if(Array.isArray(F==null?void 0:F.errors)&&F.errors.length){const Ke=F.errors.slice(0,4).map(ut=>String(ut)).join(" • ");x(Qt,V(i(Qt)?`${i(Qt)} • ${Ke}`:Ke)),(!i(zt)||i(zt)==="Plotted from Pine"||i(zt)==="Plotted from DSL")&&x(zt,"Signals error")}const H=new Map;_t.forEach((Ke,ut)=>{H.set(String((Ke==null?void 0:Ke.id)??ut),Ke)});const be=(Ke,ut,Gt)=>{if(typeof Ke=="number"&&Number.isFinite(Ke))return Ke;if(typeof Ke=="string"){const fn=Ke.replace(/\s+/g,"_").toLowerCase(),$n=Vr==null?void 0:Vr[fn],cn=$n?$n[ut]:NaN;if(Number.isFinite(cn))return cn;const eo=Number(Ke);if(Number.isFinite(eo))return eo}return Gt},Pe=(Ke,ut)=>{if(typeof Ke=="number"&&Number.isFinite(Ke))return Ke;if(typeof Ke=="string"){const Gt=Ke.replace(/\s+/g,"_").toLowerCase(),fn=Vr==null?void 0:Vr[Gt],$n=fn?fn[ut]:NaN;if(Number.isFinite($n))return $n;const cn=Number(Ke);if(Number.isFinite(cn))return cn}},Ze=(F.signals||[]).map(Ke=>{const ut=H.get(String((Ke==null?void 0:Ke.signalId)??""))||null,Gt=(ut==null?void 0:ut.order)||null;if(!Gt)return{...Ke,orderId:(ut==null?void 0:ut.orderId)??(Ke==null?void 0:Ke.orderId),title:ut==null?void 0:ut.title,message:ut==null?void 0:ut.message,frequency:ut==null?void 0:ut.frequency};const fn=String(Gt.kind||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"),$n=Vr==null?void 0:Vr.close,cn=$n?$n[Ke.index]:NaN,eo=Number.isFinite(cn)?cn:0,Js=Cl=>{const cu=typeof Cl=="string"?Cl.trim():"";return cu||void 0},Co=Cl=>{const cu=typeof Cl=="number"?Cl:Number(Cl);if(!(!Number.isFinite(cu)||cu<=0))return Math.floor(cu)},ws=(Cl,cu,Wf)=>{if(typeof Cl=="number"&&Number.isFinite(Cl))return Cl;if(typeof Cl=="string")return be(Cl,cu,Wf)},Zn=fn==="limit"||fn==="stop"?be(Gt.price,Ke.index,eo):void 0,Ss=Gt.stopPrice??Gt.stop??Gt.trigger,Fr=Gt.limitPrice??Gt.limit??Gt.lmt,Ra=Gt.qty??Gt.quantity,xc=Gt.cash,Nl=Pe(Ra,Ke.index),Qc=Pe(xc,Ke.index),al=Gt.commissionPct??Gt.commission,Hd=Gt.slippagePct??Gt.slippage,Zi=Pe(al,Ke.index),Xu=Pe(Hd,Ke.index),Jf=fn==="stop_limit"?ws(Ss??Gt.price,Ke.index,eo):void 0,Cu=fn==="stop_limit"?ws(Fr??Gt.price,Ke.index,eo):void 0,Sl=Gt==null?void 0:Gt.bracket,ff=Sl&&typeof Sl=="object"?{stopLossPct:typeof Sl.stopLossPct=="number"?Sl.stopLossPct:Number(Sl.stopLossPct),takeProfitPct:typeof Sl.takeProfitPct=="number"?Sl.takeProfitPct:Number(Sl.takeProfitPct),trailingStopPct:typeof Sl.trailingStopPct=="number"?Sl.trailingStopPct:Number(Sl.trailingStopPct),takeProfits:Array.isArray(Sl.takeProfits)?Sl.takeProfits.map(Cl=>({takeProfitPct:typeof(Cl==null?void 0:Cl.takeProfitPct)=="number"?Cl.takeProfitPct:Number(Cl==null?void 0:Cl.takeProfitPct),qtyPct:typeof(Cl==null?void 0:Cl.qtyPct)=="number"?Cl.qtyPct:Number(Cl==null?void 0:Cl.qtyPct)})).filter(Cl=>Number.isFinite(Cl.takeProfitPct)&&Cl.takeProfitPct>0&&Number.isFinite(Cl.qtyPct)&&Cl.qtyPct>0):void 0}:void 0;return{...Ke,orderId:(ut==null?void 0:ut.orderId)??(Ke==null?void 0:Ke.orderId),title:ut==null?void 0:ut.title,message:ut==null?void 0:ut.message,frequency:ut==null?void 0:ut.frequency,order:{kind:fn,price:Zn,stopPrice:Jf,limitPrice:Cu,qty:Nl,cash:Qc,commissionPct:Zi,slippagePct:Xu,qtyPct:Gt.qtyPct==null?void 0:Math.max(0,Math.min(100,Number(Gt.qtyPct)||0)),oco:Js(Gt.oco),expiresBars:Co(Gt.expiresBars),bracket:ff}}});qse(at,Ze);try{const Ke=_t.filter(Gt=>String((Gt==null?void 0:Gt.type)||"")==="alert").map(Gt=>({id:String((Gt==null?void 0:Gt.id)??""),title:Gt==null?void 0:Gt.title,message:Gt==null?void 0:Gt.message,frequency:Gt==null?void 0:Gt.frequency})).filter(Gt=>Gt.id);Ke.length&&wz(Ke);const ut=Ze.filter(Gt=>String((Gt==null?void 0:Gt.type)||"")==="alert");if(ut.length){const Gt=Oe.length?Oe.length-1:0,fn=Vr==null?void 0:Vr.close,$n=fn&&fn.length?fn[Gt]:void 0;(async()=>{var eo,Js,Co,ws,Zn,Ss;const cn=await Pz({events:ut.map(Fr=>({signalId:Fr.signalId,title:Fr.title,message:Fr.message,frequency:Fr.frequency,index:Fr.index,timestamp:Fr.timestamp})),context:{symbol:((Js=(eo=s())==null?void 0:eo.symbol)==null?void 0:Js.ticker)||((ws=(Co=s())==null?void 0:Co.symbol)==null?void 0:ws.name),timeframe:(Ss=(Zn=s())==null?void 0:Zn.period)==null?void 0:Ss.timeframe,price:Number.isFinite($n)?$n:void 0,latestIndex:Gt}});for(const Fr of cn){const Ra=Fr.deliveries.find(xc=>xc.channel==="app");if(Ra&&Ra.status==="pending"){const xc=Fr.message||Fr.title||"Alert fired";$t.addAlert("info",xc,4)}}for(const Fr of cn){if(!Fr.deliveries.some(xc=>xc.status==="pending"))continue;const Ra=await x8(Fr);w8(Fr.id,Ra)}})()}}catch{}try{const Ke=(S==null?void 0:S.strategy)??null,ut=Ke===!0?{enabled:!0}:Ke,Gt=ut&&typeof ut=="object"?{...ut}:ut,fn=Aa&&typeof Aa=="object"?Gt&&typeof Gt=="object"?{...Gt,...Aa}:{...Aa}:Gt,$n=yoe(fn);if($n){const cn=Zn=>{const Ss=typeof Zn=="number"?Zn:Number(Zn);return Number.isFinite(Ss)?Ss:void 0},eo=G.map((Zn,Ss)=>{const Fr=(Zn==null?void 0:Zn.timestamp)??(Zn==null?void 0:Zn.time)??0,Ra=typeof Fr=="number"?Fr:Number(Fr),xc=cn(Zn==null?void 0:Zn.close);return{index:Ss,timestamp:Number.isFinite(Ra)?Ra:0,open:cn(Zn==null?void 0:Zn.open),high:cn(Zn==null?void 0:Zn.high),low:cn(Zn==null?void 0:Zn.low),close:xc??NaN,volume:cn(Zn==null?void 0:Zn.volume)}}),Js=Ze.filter(Zn=>{const Ss=String((Zn==null?void 0:Zn.type)||"");return Ss==="entry_long"||Ss==="exit_long"||Ss==="entry_short"||Ss==="exit_short"||Ss==="cancel"||Ss==="cancel_all"}),Co=xoe(eo,Js,$n);voe(at,Co);const ws=p(Co,eo.length);mf.set(q,{positionSize:ws.positionSize,positionAvgPrice:ws.positionAvgPrice,openTrades:ws.openTrades,closedTrades:ws.closedTrades,openProfit:ws.openProfit,closedProfit:ws.closedProfit,grossProfit:ws.grossProfit,grossLoss:ws.grossLoss,winTrades:ws.winTrades,lossTrades:ws.lossTrades,winRate:ws.winRate,maxDrawdownPct:ws.maxDrawdownPct,maxDrawdownValue:ws.maxDrawdownValue,maxRunupPct:ws.maxRunupPct,maxRunupValue:ws.maxRunupValue,avgTrade:ws.avgTrade,avgWin:ws.avgWin,avgLoss:ws.avgLoss,avgBarsInTrade:ws.avgBarsInTrade,equity:ws.equity,netProfit:ws.netProfit,initialCapital:ws.initialCapital}),Co.accessors?sc.set(q,Co.accessors):sc.delete(q),Hs+=1,Xt||(Xt=!0,gl.requestKey("strategy:refresh",()=>{var Zn,Ss;try{const Fr=((Zn=Q.getDataList)==null?void 0:Zn.call(Q))||[];(Ss=Q.applyNewData)==null||Ss.call(Q,Fr,!1)}catch{}}))}else J5(at),mf.delete(q),sc.delete(q)}catch(Ke){console.error("[ScriptStudio] backtest error",Ke)}try{W5("signals",{id:F.id,signals:F.signals})}catch{}};if(!_t.length)b({id:at,signals:[]});else{const F=`${Oe.length}:${((qy=Oe[Oe.length-1])==null?void 0:qy.timestamp)??0}:${_t.map(be=>`${String((be==null?void 0:be.type)||"")}:${String((be==null?void 0:be.whenExpr)||"")}:${String((be==null?void 0:be.when)||"")}`).join("|")}`;let H=!1;if(jo!==ns){try{const be=[],Pe=Oe.length,Ze=new Map,Ke=new Map,ut=new Map,Gt=new Map,fn=ws=>js(String(ws||"").replace(/\$\{([^}]+)\}/g,(Zn,Ss)=>String(No[Ss]??Zn))),$n=ws=>Yu(String(ws||"").replace(/\$\{([^}]+)\}/g,(Zn,Ss)=>String(No[Ss]??Zn))),cn=(ws,Zn)=>{const Ss=Zn!=null&&Zn.when?$n(ws):fn(ws);if(!Ss)return null;const Fr=Ze.get(Ss);if(Fr)return Fr;try{const Ra=_b(Ss,Vr,No,sc.get(q),ze);return Ze.set(Ss,Ra),Ra}catch{return null}},eo=ws=>{const Zn=$n(ws);if(!Zn)return null;const Ss=ut.get(Zn);if(Ss)return Ss;try{const Fr=Ap(Zn);return ut.set(Zn,Fr),Fr}catch{return null}},Js=ws=>{const Zn=$n(ws);if(!Zn)return!1;const Ss=Gt.get(Zn);if(Ss!=null)return Ss;const Fr=eo(ws),Ra=Fr?s0(Fr):!1;return Gt.set(Zn,Ra),Ra},Co=ws=>{const Zn=$n(ws);if(!Zn)return null;const Ss=Ke.get(Zn);if(Ss)return Ss;if(ie&&Js(ws)){ze==null||ze.emitOnce(`cond_type:${Zn}`,Qd);const Nl=new Uint8Array(Pe);return Ke.set(Zn,Nl),Nl}const Fr=cn(ws,{when:!0});if(!Fr)return null;const Ra=new Uint8Array(Pe),xc=ie?`cond_na:${Zn}`:"";for(let Nl=0;Nl<Pe;(Nl+=1)-1){const Qc=Fr[Nl];Ra[Nl]=ie?y0(Qc,ze,xc)?1:0:Number.isFinite(Qc)&&Qc!==0?1:0}return Ke.set(Zn,Ra),Ra};for(let ws=0;ws<_t.length;(ws+=1)-1){const Zn=_t[ws],Ss=String((Zn==null?void 0:Zn.type)||"");if(Ss!=="entry_long"&&Ss!=="exit_long"&&Ss!=="entry_short"&&Ss!=="exit_short"&&Ss!=="alert"&&Ss!=="cancel"&&Ss!=="cancel_all")continue;const Fr=String((Zn==null?void 0:Zn.id)??ws),Ra=(Zn==null?void 0:Zn.orderId)!=null&&String(Zn.orderId).trim()?String(Zn.orderId).trim():void 0,xc=String((Zn==null?void 0:Zn.whenExpr)||"").trim(),Nl=String((Zn==null?void 0:Zn.when)||"").trim();if(!xc&&!Nl)continue;const Qc=Co(xc||Nl);if(!Qc)continue;const al=String((Zn==null?void 0:Zn.cooldownExpr)||"").trim(),Hd=al?cn(al):null;if(Hd)for(let cu=0;cu<Pe;(cu+=1)-1){const Wf=Hd[cu];if(Number.isFinite(Wf)&&(!Number.isInteger(Wf)||Wf<0))throw new Error("cooldownExpr must be a non-negative integer")}const Zi=Zn==null?void 0:Zn.cooldownBars,Xu=typeof Zi=="number"&&Number.isFinite(Zi)?Math.max(0,Math.floor(Zi)):0,Jf=String((Zn==null?void 0:Zn.scoreExpr)||"").trim(),Cu=Jf?cn(Jf):null;if(Cu)for(let cu=0;cu<Pe;(cu+=1)-1){const Wf=Cu[cu];if(Number.isFinite(Wf)&&(!Number.isInteger(Wf)||Wf<0||Wf>10))throw new Error("scoreExpr must be an integer 0..10")}const Sl=Zn==null?void 0:Zn.score,ff=typeof Sl=="number"&&Number.isFinite(Sl)?Sl:null;let Cl=0;for(let cu=0;cu<Pe;(cu+=1)-1){const Wf=Hd&&Number.isFinite(Hd[cu])?Math.max(0,Math.floor(Hd[cu])):Xu;if(Wf>0&&cu<Cl||!Qc[cu])continue;const kh=((Uy=Oe[cu])==null?void 0:Uy.timestamp)??Date.now(),Xm=Cu&&Number.isFinite(Cu[cu])?Cu[cu]:ff;be.push({type:Ss,index:cu,timestamp:kh,signalId:Fr,orderId:Ra,score:Xm??null}),Wf>0&&(Cl=cu+Wf)}}b({id:at,signals:be})}catch(be){console.error("[ScriptStudio] local signals/backtest error",be)}ns=jo,H=!0}if(H&&(Ut=F),!(ls||F===Ut)){ls=!0,Ut=F;const be=new Worker(new URL(""+new URL("../workers/signals.worker-CYmm2_EA.js",import.meta.url).href,import.meta.url),{type:"module"}),Pe={id:at,condSeries:Vr,bars:Oe,signals:_t,params:No,userFunctions:S==null?void 0:S.userFunctions};be.onerror=()=>{ls=!1;try{be.terminate()}catch{}},be.onmessage=Ze=>{const Ke=Ze.data;if(!(!Ke||Ke.id!==Pe.id)){b(Ke);try{be.terminate()}catch{}ls=!1}},be.postMessage(Pe)}}}catch(Oe){ls=!1,console.error("[ScriptStudio] signals worker error",Oe)}}const Wd=Rs(((Gy=S==null?void 0:S.style)==null?void 0:Gy.runtimeDrawAutoscale)??((Yy=S==null?void 0:S.style)==null?void 0:Yy.includeDrawingsInAutoscale)),jp=at=>!!Wd||Rs(at)===!0;if(!!Wd||Pa.some(at=>jp(at==null?void 0:at.includeInAutoscale))||ha.some(at=>jp(at==null?void 0:at.includeInAutoscale))||Yr.some(at=>jp(at==null?void 0:at.includeInAutoscale))||vs.some(at=>jp(at==null?void 0:at.includeInAutoscale))||zf.some(at=>{var Oe;return jp((Oe=at==null?void 0:at.meta)==null?void 0:Oe.includeInAutoscale)})){const at=new Array(Bt),Oe=new Array(Bt),_t=(Pe,Ze)=>{if(!Number.isFinite(Ze)||Pe<0||Pe>=Bt)return;const Ke=at[Pe],ut=Oe[Pe];at[Pe]=Ke==null||Ze<Ke?Ze:Ke,Oe[Pe]=ut==null||Ze>ut?Ze:ut},p=(Pe,Ze,Ke)=>{if(!Number.isFinite(Ke))return;const ut=Math.max(0,Math.min(Pe,Ze)),Gt=Math.min(Bt-1,Math.max(Pe,Ze));for(let fn=ut;fn<=Gt;(fn+=1)-1)_t(fn,Ke)},b=Pe=>{let Ze=Number(Pe==null?void 0:Pe.startIndex),Ke=Number(Pe==null?void 0:Pe.endIndex);if(!Number.isFinite(Ze)||!Number.isFinite(Ke))return null;if(Ze>Ke){const Gt=Ze;Ze=Ke,Ke=Gt}const ut=String((Pe==null?void 0:Pe.extend)||"").toLowerCase();return ut==="both"?(Ze=0,Ke=Math.max(0,Bt-1)):ut==="left"?Ze=0:ut==="right"&&(Ke=Math.max(0,Bt-1)),{a:Ze,b:Ke}},F=(Pe,Ze)=>Number.isFinite(Pe==null?void 0:Pe.slope)&&Number.isFinite(Pe==null?void 0:Pe.intercept)?Pe.slope*Ze+Pe.intercept:Number.isFinite(Pe==null?void 0:Pe.startValue)?Pe.startValue:Number.NaN;for(const Pe of Pa){if(!jp(Pe==null?void 0:Pe.includeInAutoscale))continue;let Ze=Pe.leftIndex,Ke=Pe.rightIndex;if(ie){const ut=Math.max(0,Bt-1),Gt=Number.isFinite(fromIndex)?fromIndex:Ze,fn=Number.isFinite(toIndex)?toIndex:Ke,$n=Math.max(0,Math.min(Gt,fn)),cn=Math.min(ut,Math.max(Gt,fn)),eo=zk({baseLeft:Ze,baseRight:Ke,extend:Pe.extend,vpLeft:$n,vpRight:cn,lastIndex:ut});eo&&(Ze=eo.leftExt,Ke=eo.rightExt)}else{const ut=String(Pe.extend||"").toLowerCase();ut==="both"?(Ze=0,Ke=Math.max(0,Bt-1)):ut==="left"?Ze=0:ut==="right"&&(Ke=Math.max(0,Bt-1))}p(Ze,Ke,Number(Pe.topValue)),p(Ze,Ke,Number(Pe.bottomValue))}for(const Pe of ha){if(!jp(Pe==null?void 0:Pe.includeInAutoscale))continue;const Ze=b(Pe);if(!Ze)continue;const{a:Ke,b:ut}=Ze;if(Number.isFinite(Pe==null?void 0:Pe.slope)&&Number.isFinite(Pe==null?void 0:Pe.intercept))for(let Gt=Ke;Gt<=ut;(Gt+=1)-1){const fn=F(Pe,Gt);_t(Gt,fn)}else _t(Ke,Number(Pe==null?void 0:Pe.startValue)),_t(ut,Number(Pe==null?void 0:Pe.endValue))}for(const Pe of Yr){if(!jp(Pe==null?void 0:Pe.includeInAutoscale))continue;const Ze=Pe==null?void 0:Pe.line1,Ke=Pe==null?void 0:Pe.line2;if(!Ze||!Ke)continue;const ut=b(Ze),Gt=b(Ke);if(!ut||!Gt)continue;const fn=Math.max(ut.a,Gt.a),$n=Math.min(ut.b,Gt.b);if(!(fn>$n))for(let cn=fn;cn<=$n;(cn+=1)-1){const eo=F(Ze,cn),Js=F(Ke,cn);!Number.isFinite(eo)||!Number.isFinite(Js)||(_t(cn,Math.min(eo,Js)),_t(cn,Math.max(eo,Js)))}}for(const Pe of zf){if(!jp((Ky=Pe==null?void 0:Pe.meta)==null?void 0:Ky.includeInAutoscale))continue;const Ze=Pe==null?void 0:Pe.index,Ke=(Xy=Pe==null?void 0:Pe.meta)==null?void 0:Xy.value;typeof Ze!="number"||!Number.isFinite(Ze)||Number.isFinite(Ke)&&_t(Ze,Number(Ke))}for(const Pe of vs){if(!jp(Pe==null?void 0:Pe.includeInAutoscale))continue;const Ze=Array.isArray(Pe==null?void 0:Pe.points)?Pe.points:[];if(!Ze.length)continue;const Ke=(Pe==null?void 0:Pe.xloc)??"bar_index";for(const ut of Ze){const Gt=Number(ut==null?void 0:ut.x),fn=Number(ut==null?void 0:ut.y);if(!Number.isFinite(Gt)||!Number.isFinite(fn))continue;const $n=Ht(Gt,Ke,{kind:"heatmap",id:(Pe==null?void 0:Pe.id)??"heatmap"});$n!=null&&_t($n,fn)}}const H=hu[qa.min],be=hu[qa.max];for(let Pe=0;Pe<Bt;(Pe+=1)-1){const Ze=at[Pe],Ke=Oe[Pe];H&&(H[Pe]=Ze),be&&(be[Pe]=Ke);const ut=id[Pe];ut&&(ut[qa.min]=Ze,ut[qa.max]=Ke)}}id.length=Math.max(id.length,Ei+1);const kp=Uo;kp.__rows=id,kp.__len=Bt,kp.__futureBars=Re.futureBars,kp.__virtualMaxIndex=Ei,kp.__drawConfig=Re,kp.__scriptSource=ue,Yo=da,Nc=kp,Jd.__lastResult=Nc;try{gl.requestKey("script-overlay:redraw",()=>{try{Pd()}catch{}})}catch{}return Nc},draw:({ctx:G,indicator:Bt,bounding:Ks,xAxis:cs,yAxis:ts,chart:aa})=>{var fv;if(!G||!cs||!ts)return!1;const ko=(Bt==null?void 0:Bt.result)||{},or=Array.isArray(ko)?ko:Array.isArray(ko.__rows)?ko.__rows:[],pl=ev("interactionV2"),Nr=ko.__drawConfig||{},qr=Number.isFinite(ko.__futureBars)?Math.max(0,Number(ko.__futureBars)):Number.isFinite(Nr==null?void 0:Nr.futureBars)?Math.max(0,Number(Nr.futureBars)):0,ec=typeof ko.__virtualMaxIndex=="number"?Number(ko.__virtualMaxIndex):or.length&&qr?or.length-1+qr:or.length?or.length-1:-1,da=typeof cs.getRange=="function"?cs.getRange():{from:0,to:or.length?or.length-1:0},Uo=or.length?or.length-1:-1,Qa=Math.max(Uo,ec),Bn=Qa>=0?Math.max(0,Math.floor(((da==null?void 0:da.from)??0)-2)):0,bi=Qa>=0?Math.min(Qa,Math.ceil(((da==null?void 0:da.to)??Qa)+2)):-1;if(pl&&Qa>=1){const se=Math.max(0,Math.min(Bn,Qa-1)),Ft=cs.convertToPixel(se),dt=cs.convertToPixel(se+1),on=Number.isFinite(Ft)&&Number.isFinite(dt)?Math.abs(dt-Ft):NaN,bt=typeof ts.getRange=="function"?ts.getRange():null,_s=Number(bt==null?void 0:bt.from),zn=Number(bt==null?void 0:bt.to);let On=NaN;if(Number.isFinite(_s)&&Number.isFinite(zn)&&_s!==zn){const ss=(_s+zn)/2,Cn=(zn-_s)/100,Ht=ts.convertToPixel(ss),Fs=ts.convertToPixel(ss+Cn);Number.isFinite(Ht)&&Number.isFinite(Fs)&&(On=Math.abs(Fs-Ht))}qh={x:Number.isFinite(on)&&on>0?on:qh.x,y:Number.isFinite(On)&&On>0?On:qh.y}}(()=>{var zn,On,ss,Cn,Ht,Fs,Ds;if(!qr||ec<=Uo){(ht.maxPx||ht.offsetPx)&&(ht.maxPx=0,ht.offsetPx=0,ht.lastAppliedTs=0);return}const se=(Ht=(Cn=(ss=(On=(zn=cs==null?void 0:cs.getParent)==null?void 0:zn.call(cs))==null?void 0:On.getChart)==null?void 0:ss.call(On))==null?void 0:Cn.getChartStore)==null?void 0:Ht.call(Cn);if(!se)return;const Ft=typeof performance<"u"?performance.now():Date.now();if(Ft-ht.lastAppliedTs<500)return;const dt=((Fs=se.getBarSpace)==null?void 0:Fs.call(se).bar)??6,on=Math.max(0,qr*dt),bt=((Ds=se.getOffsetRightDistance)==null?void 0:Ds.call(se))??0,_s=Math.max(on,bt);typeof se.setMaxOffsetRightDistance=="function"&&Math.abs(_s-ht.maxPx)>.5&&(se.setMaxOffsetRightDistance(_s),ht.maxPx=_s),bt+.5<on&&typeof se.setOffsetRightDistance=="function"&&Math.abs(on-ht.offsetPx)>.5&&(se.setOffsetRightDistance(on,!0),ht.offsetPx=on,ht.lastAppliedTs=Ft)})();const yo=Ks?{left:0,top:0,width:Ks.width,height:Ks.height}:void 0;G.save(),yo&&(G.beginPath(),G.rect(0,0,yo.width,yo.height),G.clip());const _a=Array.isArray(ko.__runtimeBoxDefs)?ko.__runtimeBoxDefs:[],xi=Array.isArray(ko.__runtimePolylineDefs)?ko.__runtimePolylineDefs:[],lr=Array.isArray(ko.__runtimePolygonDefs)?ko.__runtimePolygonDefs:[],Ai=Array.isArray(ko.__runtimePathDefs)?ko.__runtimePathDefs:[],$o=Array.isArray(ko.__runtimeLineFills)?ko.__runtimeLineFills:[],Br=Array.isArray(ko.__runtimeLineDefs)?ko.__runtimeLineDefs:[],oa=Array.isArray(ko.__runtimeTables)?ko.__runtimeTables:[],zl=Array.isArray(vs)?vs:[],ci=Array.isArray(ko.__lineDefs)?ko.__lineDefs:[],Ur=Array.isArray(ko.__labelItems)?ko.__labelItems:[],fa=ko.__tsIndex||{},yr=Array.isArray(ko.__timeSeriesMs)?ko.__timeSeriesMs:[];let Ea=0;if(yr.length>=2){let se=0;for(let Ft=1;Ft<yr.length;(Ft+=1)-1)se+=Math.abs(yr[Ft]-yr[Ft-1]);Ea=se/(yr.length-1)}const Zs=or.length,us=(se,Ft)=>{const dt=typeof se=="string"?se.trim().toLowerCase():"";return dt==="background"||dt==="bg"?"background":dt==="main"||dt==="base"?"main":dt==="overlay"||dt==="over"?"overlay":dt==="ui"?"ui":Ft},gs=(se,Ft)=>{if(typeof se=="number"&&Number.isFinite(se))return se;if(typeof se=="string"){const dt=Number(se);if(Number.isFinite(dt))return dt}return Ft},ui=se=>{const Ft=String(se||"").trim().toLowerCase();return Ft?Ft.replace(/[^a-z0-9_-]+/g,"_"):"script"},Gr={box:"background",line:"background",linefill:"background",label:"background",table:"ui",lineSegment:"background",polyline:"background",polygon:"background",path:"background"},wa={box:10,lineSegment:20,linefill:30,line:40,label:50,table:60,polyline:25,polygon:15,path:27},el=pl&&O0(),ji=`${ui((Bt==null?void 0:Bt.__scriptSource)??(ko==null?void 0:ko.__scriptSource)??(Nr==null?void 0:Nr.source))}:${(Bt==null?void 0:Bt.name)??"runtime"}:${(Bt==null?void 0:Bt.paneId)??"pane"}`,Ti=typeof(Ks==null?void 0:Ks.left)=="number"&&Number.isFinite(Ks.left)?Ks.left:0,Bi=typeof(Ks==null?void 0:Ks.top)=="number"&&Number.isFinite(Ks.top)?Ks.top:0,qi={x:Ti,y:Bi},oi=zc(),Jo=(Bt==null?void 0:Bt.paneId)??"candle_pane",Ar=oi[Jo]||oi.candle_pane,$i=Ar&&Number.isFinite(Ar.width)&&Number.isFinite(Ar.height)?{left:Ar.left,top:Ar.top,width:Ar.width,height:Ar.height}:Ks&&Number.isFinite(Ks.width)&&Number.isFinite(Ks.height)?{left:Ti,top:Bi,width:Ks.width,height:Ks.height}:null,Ui=$i&&Number.isFinite($i.left)?$i.left:Ti,wi=$i&&Number.isFinite($i.top)?$i.top:Bi,tl=!!(ae!=null&&ae.isWebgl&&ce&&$i),_o=[],rl=se=>tl?(_o.push(se),!0):!1,br=se=>se?rl(se):!1;if(ae&&Ie&&$i){if(zl.length){const se=Ja({runtimeHeatmaps:zl,bounds:$i,xAxis:cs,yAxis:ts,offsetX:$i.left,offsetY:$i.top,drawConfigMeta:Nr,len:Zs,tsIndex:fa,timeSeriesMs:yr,avgIntervalMs:Ea});se.length&&it.push({bounds:$i,heatmaps:se})}vu()}const di=(fv=aa==null?void 0:aa.getChartStore)==null?void 0:fv.call(aa),$a=pl&&typeof(cs==null?void 0:cs.convertFromPixel)=="function"&&typeof(ts==null?void 0:ts.convertFromPixel)=="function"?{toIndex:se=>typeof(di==null?void 0:di.coordinateToFloatIndex)=="function"?di.coordinateToFloatIndex(se):cs.convertFromPixel(se),toValue:se=>ts.convertFromPixel(se),toX:se=>typeof(di==null?void 0:di.dataIndexToCoordinate)=="function"?di.dataIndexToCoordinate(se):cs.convertToPixel(se),toY:se=>ts.convertToPixel(se)}:null,ki=pl?(()=>{var Ht,Fs;const se=Number((Fs=(Ht=aa==null?void 0:aa.getSymbol)==null?void 0:Ht.call(aa))==null?void 0:Fs.pricePrecision),Ft=Number.isFinite(se)?se:$_(s().symbol);if(Number.isFinite(Ft)&&Ft>=0)return Math.pow(10,-Math.max(0,Ft));const dt=typeof(ts==null?void 0:ts.getRange)=="function"?ts.getRange():null,on=Number(dt==null?void 0:dt.from),bt=Number(dt==null?void 0:dt.to);if(!Number.isFinite(on)||!Number.isFinite(bt)||on===bt)return Number.NaN;const zn=Math.abs(bt-on)/40;if(!Number.isFinite(zn)||zn<=0)return Number.NaN;const On=Math.pow(10,Math.floor(Math.log10(zn))),ss=zn/On;let Cn=1;return ss>5?Cn=10:ss>2?Cn=5:ss>1&&(Cn=2),Cn*On})():Number.NaN,Or=pl&&$a?{timeStep:1,priceStep:Number.isFinite(ki)&&ki>0?ki:Number.NaN}:null,Qr=[],cr=new Map,ya=[],Ga=8,zr=Ga/2,ea={n:"ns-resize",s:"ns-resize",e:"ew-resize",w:"ew-resize",ne:"nesw-resize",sw:"nesw-resize",nw:"nwse-resize",se:"nwse-resize"},pa=12,Ko=()=>(x0+=1)-1,no=se=>{var dt;const Ft=(se==null?void 0:se.id)??((dt=se==null?void 0:se.meta)==null?void 0:dt.id)??(se==null?void 0:se.name)??(se==null?void 0:se.key);return Ft!=null&&String(Ft).trim()?String(Ft):null},Si=se=>{const Ft=no(se.payload);return Ft?`${ji}:${Ft}`:`${ji}:${se.kind}:${se.createdAt}`},ka=se=>{const Ft=no(se);return Ft?`${ji}:${Ft}`:null},Xo=se=>{if(!pl)return null;const Ft=o_(se);return Ft||null},Sa=se=>{const Ft=se==null?void 0:se.box;return Ft&&Number.isFinite(Ft.leftIndex)&&Number.isFinite(Ft.rightIndex)&&Number.isFinite(Ft.topValue)&&Number.isFinite(Ft.bottomValue)?Ft:null},tr=se=>{const Ft=se==null?void 0:se.label;return Ft&&Number.isFinite(Ft.index)&&Number.isFinite(Ft.value)?Ft:null},Ya=se=>{const Ft=se==null?void 0:se.translate;if(Ft&&Number.isFinite(Ft.dxIndex)&&Number.isFinite(Ft.dyValue)){const dt=Number(Ft.dxIndex),on=Number(Ft.dyValue);if(dt!==0||on!==0)return{dxIndex:dt,dyValue:on}}return null},ac=Number.isFinite(Nr==null?void 0:Nr.decimationPx)&&Number(Nr.decimationPx)>0?Math.floor(Number(Nr.decimationPx)):re.decimationPx,ml=(se,Ft)=>Ft<Bn-2||se>bi+2,wl=se=>({x:cs.convertToPixel(se.index),y:ts.convertToPixel(se.value)}),Kl=(se,Ft)=>{if(!Ft)return se;const dt=Ya(Xo(Ft));return dt?{index:se.index+dt.dxIndex,value:se.value+dt.dyValue}:se},Dc=(se,Ft)=>{if(!Ft)return se;const dt=Ya(Xo(Ft));return dt?se.map(on=>({index:on.index+dt.dxIndex,value:on.value+dt.dyValue})):se},pc=(se,Ft)=>{if(!Ft)return se;const dt=Ya(Xo(Ft));if(!dt)return se;const on=dt.dxIndex,bt=dt.dyValue,_s=Number(se==null?void 0:se.slope),zn=Number.isFinite(_s)&&Number.isFinite(se==null?void 0:se.intercept)?Number(se.intercept)+bt-_s*on:se==null?void 0:se.intercept;return{...se,startIndex:Number(se.startIndex)+on,endIndex:Number(se.endIndex)+on,startValue:Number(se.startValue)+bt,endValue:Number(se.endValue)+bt,intercept:zn}},ru=(se,Ft)=>{if(!(se!=null&&se.points)||se.points.length<2)return;const dt=Dc(se.points,Ft),on=Math.min(...dt.map(ds=>ds.index)),bt=Math.max(...dt.map(ds=>ds.index));if(ml(on,bt))return;const _s=ac>1?dx(dt,wl,ac):dt;if(!_s.length)return;G.save(),G.beginPath();let zn=!0,On=Number.POSITIVE_INFINITY,ss=Number.NEGATIVE_INFINITY,Cn=Number.POSITIVE_INFINITY,Ht=Number.NEGATIVE_INFINITY;for(const ds of _s){const{x:Gn,y:xn}=wl(ds);!Number.isFinite(Gn)||!Number.isFinite(xn)||(zn?(G.moveTo(Gn,xn),zn=!1):G.lineTo(Gn,xn),Gn<On&&(On=Gn),Gn>ss&&(ss=Gn),xn<Cn&&(Cn=xn),xn>Ht&&(Ht=xn))}if(zn){G.restore();return}const Fs=typeof se.opacity=="number"?Math.max(0,Math.min(1,se.opacity)):1,Ds=se.width??2,xs=Number.isFinite(se.glow)?se.glow:0,Rs=Number.isFinite(se.glowOpacity)?Math.max(0,Math.min(1,se.glowOpacity)):.35;if(xs>0&&(G.save(),G.strokeStyle=se.glowColor||se.color||"#e2e8f0",G.globalAlpha=Fs*Rs,G.lineWidth=Ds+xs,G.setLineDash([]),G.stroke(),G.restore()),se.gradient&&(se.gradient.from||se.gradient.to)){const ds=eh(G,{minX:Number.isFinite(On)?On:0,maxX:Number.isFinite(ss)&&ss!==On?ss:Number.isFinite(On)?On+1:1,minY:Number.isFinite(Cn)?Cn:0,maxY:Number.isFinite(Ht)&&Ht!==Cn?Ht:Number.isFinite(Cn)?Cn+1:1},se.gradient,se.color||"#e2e8f0");G.strokeStyle=ds??(se.color||"#e2e8f0")}else G.strokeStyle=se.color||"#e2e8f0";G.globalAlpha=Fs,G.lineWidth=Ds;const ys=String(se.style||"solid").toLowerCase();ys==="dashed"?G.setLineDash([6,4]):ys==="dotted"?G.setLineDash([2,2]):G.setLineDash([]),G.stroke(),G.setLineDash([]),G.globalAlpha=1,G.restore()},Wc=(se,Ft)=>{if(!(se!=null&&se.points)||se.points.length<3)return;const dt=Dc(se.points,Ft),on=Math.min(...dt.map(xs=>xs.index)),bt=Math.max(...dt.map(xs=>xs.index));if(ml(on,bt))return;const _s=ac>1?dx(dt,wl,ac):dt;if(_s.length<3)return;G.save(),G.beginPath();let zn=!0,On=Number.POSITIVE_INFINITY,ss=Number.NEGATIVE_INFINITY,Cn=Number.POSITIVE_INFINITY,Ht=Number.NEGATIVE_INFINITY;for(const xs of _s){const{x:Rs,y:ys}=wl(xs);!Number.isFinite(Rs)||!Number.isFinite(ys)||(zn?(G.moveTo(Rs,ys),zn=!1):G.lineTo(Rs,ys),Rs<On&&(On=Rs),Rs>ss&&(ss=Rs),ys<Cn&&(Cn=ys),ys>Ht&&(Ht=ys))}G.closePath();const Fs=typeof se.opacity=="number"?Math.max(0,Math.min(1,se.opacity)):1;G.globalAlpha=Fs;const Ds=se.fillGradient;if(Ds&&(Ds.from||Ds.to)){const xs=Ds.from||se.fillColor||"#38bdf8",Rs=Ds.to||se.fillColor||xs,ys=String(Ds.mode||"vertical").toLowerCase(),ds=Number.isFinite(On)?On:0,Gn=Number.isFinite(ss)&&ss!==On?ss:ds+1,xn=Number.isFinite(Cn)?Cn:0,Ei=Number.isFinite(Ht)&&Ht!==Cn?Ht:xn+1;let kl;if(ys==="horizontal")kl=G.createLinearGradient(ds,xn,Gn,xn);else if(ys==="radial"){const Do=(ds+Gn)/2,oo=(xn+Ei)/2,ma=Math.max(Gn-ds,Ei-xn)/2;kl=G.createRadialGradient(Do,oo,0,Do,oo,Math.max(1,ma))}else kl=G.createLinearGradient(ds,xn,ds,Ei);kl.addColorStop(0,xs),kl.addColorStop(1,Rs),G.fillStyle=kl,G.fill()}else se.fillColor&&(G.fillStyle=se.fillColor,G.fill());if(se.strokeColor||se.strokeWidth){const xs=se.strokeWidth??1,Rs=Number.isFinite(se.glow)?se.glow:0,ys=Number.isFinite(se.glowOpacity)?Math.max(0,Math.min(1,se.glowOpacity)):.35;Rs>0&&(G.save(),G.strokeStyle=se.glowColor||se.strokeColor||se.fillColor||"#e2e8f0",G.globalAlpha=Fs*ys,G.lineWidth=xs+Rs,G.setLineDash([]),G.stroke(),G.restore()),G.strokeStyle=se.strokeColor||"#e2e8f0",G.lineWidth=xs;const ds=String(se.strokeStyle||"solid").toLowerCase();ds==="dashed"?G.setLineDash([6,4]):ds==="dotted"?G.setLineDash([2,2]):G.setLineDash([]),G.stroke(),G.setLineDash([])}G.globalAlpha=1,G.restore()},Hc=(se,Ft)=>{if(!(se!=null&&se.commands)||!se.commands.length)return;const dt=se.commands.map(ys=>Kl({index:ys.index,value:ys.value},Ft)),on=Math.min(...dt.map(ys=>ys.index)),bt=Math.max(...dt.map(ys=>ys.index));if(ml(on,bt))return;G.save(),G.beginPath();let _s=!1,zn=Number.POSITIVE_INFINITY,On=Number.NEGATIVE_INFINITY,ss=Number.POSITIVE_INFINITY,Cn=Number.NEGATIVE_INFINITY;for(let ys=0;ys<se.commands.length;(ys+=1)-1){const ds=se.commands[ys],Gn=dt[ys],xn=cs.convertToPixel(Gn.index),Ei=ts.convertToPixel(Gn.value);!Number.isFinite(xn)||!Number.isFinite(Ei)||(ds.cmd==="M"?(G.moveTo(xn,Ei),_s=!0):ds.cmd==="L"&&(G.lineTo(xn,Ei),_s=!0),xn<zn&&(zn=xn),xn>On&&(On=xn),Ei<ss&&(ss=Ei),Ei>Cn&&(Cn=Ei))}if(!_s){G.restore();return}const Ht=typeof se.opacity=="number"?Math.max(0,Math.min(1,se.opacity)):1,Fs=se.width??2,Ds=Number.isFinite(se.glow)?se.glow:0,xs=Number.isFinite(se.glowOpacity)?Math.max(0,Math.min(1,se.glowOpacity)):.35;if(Ds>0&&(G.save(),G.strokeStyle=se.glowColor||se.color||"#e2e8f0",G.globalAlpha=Ht*xs,G.lineWidth=Fs+Ds,G.setLineDash([]),G.stroke(),G.restore()),se.gradient&&(se.gradient.from||se.gradient.to)){const ys=eh(G,{minX:Number.isFinite(zn)?zn:0,maxX:Number.isFinite(On)&&On!==zn?On:Number.isFinite(zn)?zn+1:1,minY:Number.isFinite(ss)?ss:0,maxY:Number.isFinite(Cn)&&Cn!==ss?Cn:Number.isFinite(ss)?ss+1:1},se.gradient,se.color||"#e2e8f0");G.strokeStyle=ys??(se.color||"#e2e8f0")}else G.strokeStyle=se.color||"#e2e8f0";G.lineWidth=Fs;const Rs=String(se.style||"solid").toLowerCase();Rs==="dashed"?G.setLineDash([6,4]):Rs==="dotted"?G.setLineDash([2,2]):G.setLineDash([]),G.globalAlpha=Ht,G.stroke(),G.setLineDash([]),G.globalAlpha=1,G.restore()},Ca=(se,Ft)=>{if(!(se!=null&&se.points)||se.points.length<2)return[];const dt=Dc(se.points,Ft),on=Math.min(...dt.map(ss=>ss.index)),bt=Math.max(...dt.map(ss=>ss.index));if(ml(on,bt))return[];const _s=ac>1?dx(dt,wl,ac):dt,zn=[];let On=null;for(const ss of _s){const{x:Cn,y:Ht}=wl(ss);if(!Number.isFinite(Cn)||!Number.isFinite(Ht))continue;const Fs={x:Cn+Ti,y:Ht+Bi};On&&zn.push({a:On,b:Fs}),On=Fs}return zn},au=(se,Ft)=>{if(!(se!=null&&se.commands)||!se.commands.length)return[];const dt=se.commands.map(On=>Kl({index:On.index,value:On.value},Ft)),on=Math.min(...dt.map(On=>On.index)),bt=Math.max(...dt.map(On=>On.index));if(ml(on,bt))return[];const _s=[];let zn=null;for(let On=0;On<se.commands.length;(On+=1)-1){const ss=se.commands[On],Cn=dt[On],Ht=cs.convertToPixel(Cn.index),Fs=ts.convertToPixel(Cn.value);if(!Number.isFinite(Ht)||!Number.isFinite(Fs))continue;const Ds={x:Ht+Ti,y:Fs+Bi};ss.cmd==="M"?zn=Ds:ss.cmd==="L"&&(zn&&_s.push({a:zn,b:Ds}),zn=Ds)}return _s},zd=(se,Ft)=>{if(!(se!=null&&se.points)||se.points.length<3)return[];const dt=Dc(se.points,Ft),on=Math.min(...dt.map(zn=>zn.index)),bt=Math.max(...dt.map(zn=>zn.index));if(ml(on,bt))return[];const _s=[];for(const zn of dt){const On=cs.convertToPixel(zn.index),ss=ts.convertToPixel(zn.value);!Number.isFinite(On)||!Number.isFinite(ss)||_s.push({x:On+Ti,y:ss+Bi})}return _s},uf={background:[],main:[],overlay:[],ui:[]};let mu=0;const hu=(se,Ft,dt,on)=>{const bt=us(Ft,Gr[se]),_s=gs(dt,wa[se]),zn={kind:se,layer:bt,zIndex:_s,createdAt:(mu+=1)-1,payload:on};if(pl&&se!=="table"&&(i(vf)||i(Dm))){const On=Si(zn);(On===i(vf)||On===i(Dm))&&(zn.layer="overlay",zn.zIndex=Math.max(zn.zIndex,1e5))}uf[zn.layer].push(zn)};if(_a.length)for(const se of _a)se&&hu("box",se.layer,se.zIndex,se);if(lr.length)for(const se of lr)se&&hu("polygon",se.layer,se.zIndex,se);if(xi.length)for(const se of xi)se&&hu("polyline",se.layer,se.zIndex,se);if(Ai.length)for(const se of Ai)se&&hu("path",se.layer,se.zIndex,se);if(ci.length)for(const se of ci)se&&hu("lineSegment",se.layer,se.zIndex,se);if($o.length)for(const se of $o)se&&hu("linefill",se.layer,se.zIndex,se);if(Br.length)for(const se of Br)se&&hu("line",se.layer,se.zIndex,se);if(i(nr)&&Ur.length)for(const se of Ur){const Ft=se==null?void 0:se.meta;Ft&&hu("label",Ft.layer,Ft.zIndex,se)}if(oa.length)for(const se of oa)se&&hu("table",se.layer,se.zIndex,se);if(el&&Qa>=0){let se=uh.get(ji);if(!se||!Number.isFinite(se.leftA)||!Number.isFinite(se.rightA)||se.rightA>Qa||se.rightB>Qa){const Ft=typeof(ts==null?void 0:ts.getRange)=="function"?ts.getRange():null,dt=Number(Ft==null?void 0:Ft.from),on=Number(Ft==null?void 0:Ft.to);if(Number.isFinite(dt)&&Number.isFinite(on)&&dt!==on){const bt=Math.min(dt,on),_s=Math.max(dt,on),zn=Math.max(1e-6,_s-bt),On=_s-zn*.25,ss=_s-zn*.45,Cn=(On+ss)/2,Ht=Math.max(0,Math.floor((Bn+bi)/2)),Fs=Math.max(0,Ht-6),Ds=Math.max(0,Ht+6),xs=Math.max(0,Ht-3),Rs=Math.max(0,Ht+9);se={leftA:Fs,rightA:Ds,leftB:xs,rightB:Rs,topValue:On,bottomValue:ss,labelValue:Cn,midIndex:Ht},uh.set(ji,se)}}se&&(hu("box","overlay",10,{id:"interaction_debug_box_a",leftIndex:se.leftA,rightIndex:se.rightA,topValue:se.topValue,bottomValue:se.bottomValue,borderColor:"rgba(59,130,246,0.9)",bgColor:"rgba(59,130,246,0.08)"}),hu("box","overlay",10,{id:"interaction_debug_box_b",leftIndex:se.leftB,rightIndex:se.rightB,topValue:se.topValue,bottomValue:se.bottomValue,borderColor:"rgba(16,185,129,0.9)",bgColor:"rgba(16,185,129,0.08)"}),hu("label","overlay",20,{index:se.midIndex,meta:{id:"interaction_debug_label_top",text:"TOP",value:se.labelValue,position:"above",shape:"label",size:12,color:"#f97316",textColor:"#0f172a",textAlign:"center",layer:"overlay",zIndex:20}}))}const id=se=>{let Ft=se.leftIndex,dt=se.rightIndex;if(ie){const _s=Math.max(0,Zs-1),zn=Number.isFinite(Bn)?Bn:Ft,On=Number.isFinite(bi)?bi:dt,ss=Math.max(0,Math.min(zn,On)),Cn=Math.min(_s,Math.max(zn,On)),Ht=zk({baseLeft:Ft,baseRight:dt,extend:se.extend,vpLeft:ss,vpRight:Cn,lastIndex:_s});Ht&&(Ft=Ht.leftExt,dt=Ht.rightExt)}else se.extend==="both"?(Ft=0,dt=Math.max(0,Zs-1)):se.extend==="left"?Ft=0:se.extend==="right"&&(dt=Math.max(0,Zs-1));const on=se.topValue,bt=se.bottomValue;return!Number.isFinite(Ft)||!Number.isFinite(dt)||!Number.isFinite(on)||!Number.isFinite(bt)?null:{leftIndex:Ft,rightIndex:dt,topValue:on,bottomValue:bt}},lu=(se,Ft)=>{const dt=id(se);if(!dt)return null;const on=Ft?Xo(Ft):null;return Sa(on)??dt},Ia=(se,Ft)=>{const dt=Ft?Xo(Ft):null,on=id(se);if(!on)return null;const bt=Sa(dt)??on;let _s=cs.convertToPixel(bt.leftIndex),zn=cs.convertToPixel(bt.rightIndex),On=ts.convertToPixel(bt.topValue),ss=ts.convertToPixel(bt.bottomValue);return!Number.isFinite(_s)||!Number.isFinite(zn)||!Number.isFinite(On)||!Number.isFinite(ss)?null:{x1:_s,x2:zn,y1:On,y2:ss}},Kf=(se,Ft)=>{const dt=Ia(se,Ft);if(!dt)return;const on=Math.min(dt.x1,dt.x2),bt=Math.min(dt.y1,dt.y2),_s=Math.abs(dt.x2-dt.x1),zn=Math.abs(dt.y2-dt.y1);if(ie){const ss=oe(se);ss.bgColor&&(G.fillStyle=ss.bgColor,G.fillRect(on,bt,_s,zn)),ss.borderWidth>0&&ss.borderColor&&(G.strokeStyle=ss.borderColor,G.lineWidth=ss.borderWidth,G.setLineDash(ss.dash),G.lineDashOffset=ss.dashOffset,G.strokeRect(on,bt,_s,zn),G.setLineDash([]),G.lineDashOffset=0);const Cn=String(ss.textFinal||"");if(Cn){const Ht=ss.fontPx,Fs=ss.padX,Ds=ss.padY,xs=Math.max(0,_s-Fs*2),Rs=Math.max(0,zn-Ds*2);if(xs<=0||Rs<=0)return;G.save(),G.beginPath(),G.rect(on+Fs,bt+Ds,xs,Rs),G.clip(),G.font=`${Ht}px "Inter", system-ui, -apple-system, sans-serif`,G.fillStyle=ss.textColor||ss.borderColor||"#e2e8f0";const ys=ss.textHalign==="left"||ss.textHalign==="right"?ss.textHalign:"center";G.textAlign=ys,G.textBaseline="top";const ds=Math.max(12,Ht+2),Gn=Math.max(0,Rs);let xn=bt+Ds;ss.textValign==="middle"?xn=bt+Ds+(Gn-ds)/2:ss.textValign==="bottom"&&(xn=bt+Ds+Gn-ds);let Ei=on+Fs+xs/2;ys==="left"&&(Ei=on+Fs),ys==="right"&&(Ei=on+Fs+xs),G.fillText(Cn,Ei,xn),G.restore()}return}const On=se.bgGradient??se.gradient;if(On&&(On.from||On.to)){const ss=eh(G,{minX:on,maxX:on+_s,minY:bt,maxY:bt+zn},On,se.bgColor||"#0f172a");G.fillStyle=ss??(se.bgColor||"#0f172a"),G.fillRect(on,bt,_s,zn)}else se.bgColor&&(G.fillStyle=se.bgColor,G.fillRect(on,bt,_s,zn));if(se.borderColor||se.borderWidth){G.strokeStyle=se.borderColor||"#64748b",G.lineWidth=se.borderWidth??1;const ss=String(se.borderStyle||"solid").toLowerCase();ss==="dashed"?G.setLineDash([6,4]):ss==="dotted"?G.setLineDash([2,2]):G.setLineDash([]),G.strokeRect(on,bt,_s,zn),G.setLineDash([])}if(se.text){const ss=String(se.text||"");if(ss){const Cn=typeof se.textSize=="number"&&se.textSize>0?se.textSize:12,Ht=6,Fs=Math.max(0,_s-Ht*2);G.save(),G.font=`${Cn}px "Inter", system-ui, -apple-system, sans-serif`,G.fillStyle=se.textColor||se.borderColor||"#e2e8f0";const Ds=se.textHalign==="left"||se.textHalign==="right"?se.textHalign:"center";G.textAlign=Ds,G.textBaseline="top";const xs=se.textWrap===!0,Rs=ss.split(/\n/),ys=[];if(xs&&Fs>0)for(const Do of Rs){const oo=Do.split(/\s+/).filter(Boolean);let ma="";const Xa=()=>{ma&&(ys.push(ma),ma="")},bc=Da=>{if(!Da)return;if(G.measureText(Da).width>Fs&&Fs>4){Xa();let zo="";for(const ha of Da){const Yr=zo+ha;G.measureText(Yr).width>Fs&&zo?(ys.push(zo),zo=ha):zo=Yr}zo&&ys.push(zo);return}const Tr=ma?`${ma} ${Da}`:Da;G.measureText(Tr).width>Fs&&ma?(Xa(),ma=Da):ma=Tr};for(const Da of oo)bc(Da);Xa()}else for(const Do of Rs)ys.push(Do);const ds=Math.max(12,Cn+2),Gn=Math.max(1,Math.floor(Math.max(0,zn-Ht*2)/ds));if(ys.length>Gn){ys.length=Gn;const Do="...";let oo=ys[Gn-1]||"";if(Fs>0)for(;oo&&G.measureText(`${oo}${Do}`).width>Fs;)oo=oo.slice(0,-1);ys[Gn-1]=oo?`${oo}${Do}`:Do}const xn=ys.length*ds;let Ei=bt+Ht;se.textValign==="middle"||se.textValign==="center"?Ei=bt+(zn-xn)/2:se.textValign==="bottom"&&(Ei=bt+zn-Ht-xn);let kl=on+_s/2;Ds==="left"&&(kl=on+Ht),Ds==="right"&&(kl=on+_s-Ht);for(let Do=0;Do<ys.length;(Do+=1)-1)G.fillText(ys[Do],kl,Ei+Do*ds);G.restore()}}},Vr=(se,Ft,dt,on,bt,_s)=>{const zn=Math.atan2(on-Ft,dt-se),On=Math.max(6,bt),ss=zn+Math.PI-Math.PI/6,Cn=zn+Math.PI+Math.PI/6,Ht=dt+On*Math.cos(ss),Fs=on+On*Math.sin(ss),Ds=dt+On*Math.cos(Cn),xs=on+On*Math.sin(Cn);G.beginPath(),G.moveTo(dt,on),G.lineTo(Ht,Fs),G.lineTo(Ds,xs),G.closePath(),G.fillStyle=_s,G.fill()},Of=(se,Ft)=>{const dt=pc(se,Ft);let on=NaN,bt=NaN,_s=NaN,zn=NaN;if(dt.strictExtend){const Rs=typeof ts.getRange=="function"?ts.getRange():null,ys=bb({startIndex:dt.startIndex,endIndex:dt.endIndex,startValue:dt.startValue,endValue:dt.endValue,slope:dt.slope,intercept:dt.intercept,extend:dt.extend,fromIndex:Bn,toIndex:bi,yRange:Rs,toX:ds=>cs.convertToPixel(ds),toY:ds=>ts.convertToPixel(ds)});if(!ys)return;on=ys.extended.x1,bt=ys.extended.y1,_s=ys.extended.x2,zn=ys.extended.y2}else{let Rs=dt.startIndex,ys=dt.endIndex;dt.extend==="both"?(Rs=0,ys=Math.max(0,Zs-1)):dt.extend==="left"?Rs=0:dt.extend==="right"&&(ys=Math.max(0,Zs-1));const ds=Number.isFinite(dt.slope)&&Number.isFinite(dt.intercept)?dt.slope*Rs+dt.intercept:dt.startValue,Gn=Number.isFinite(dt.slope)&&Number.isFinite(dt.intercept)?dt.slope*ys+dt.intercept:dt.endValue;on=cs.convertToPixel(Rs),bt=ts.convertToPixel(ds),_s=cs.convertToPixel(ys),zn=ts.convertToPixel(Gn)}if(!Number.isFinite(on)||!Number.isFinite(bt)||!Number.isFinite(_s)||!Number.isFinite(zn))return;G.beginPath(),G.moveTo(on,bt),G.lineTo(_s,zn);const On=typeof dt.opacity=="number"?Math.max(0,Math.min(1,dt.opacity)):1,ss=dt.width??2,Cn=Number.isFinite(dt.glow)?dt.glow:0,Ht=Number.isFinite(dt.glowOpacity)?Math.max(0,Math.min(1,dt.glowOpacity)):.35;if(Cn>0&&(G.save(),G.strokeStyle=dt.glowColor||dt.color||"#22c55e",G.globalAlpha=On*Ht,G.lineWidth=ss+Cn,G.setLineDash([]),G.stroke(),G.restore()),dt.gradient&&(dt.gradient.from||dt.gradient.to)){const Rs=eh(G,{minX:Math.min(on,_s),maxX:Math.max(on,_s),minY:Math.min(bt,zn),maxY:Math.max(bt,zn)},dt.gradient,dt.color||"#22c55e");G.strokeStyle=Rs??(dt.color||"#22c55e")}else G.strokeStyle=dt.color||"#22c55e";G.globalAlpha=On,G.lineWidth=ss;const Fs=(dt.style||"solid").toLowerCase(),Ds=Fs.includes("arrow"),xs=Ds?"solid":Fs;if(dt.strictExtend){const Rs=Vk(xs,dt.width??2);G.setLineDash(Rs),G.lineDashOffset=0}else xs==="dashed"?G.setLineDash([6,4]):xs==="dotted"?G.setLineDash([2,2]):G.setLineDash([]);if(G.stroke(),G.setLineDash([]),G.globalAlpha=1,Ds){const Rs=Math.max(6,(dt.width??2)*2.5),ys=dt.color||"#22c55e";(Fs.includes("left")||Fs.includes("both"))&&Vr(_s,zn,on,bt,Rs,ys),(Fs.includes("right")||Fs.includes("both"))&&Vr(on,bt,_s,zn,Rs,ys)}},Tf=(se,Ft)=>{const dt=pc(se,Ft);let on=NaN,bt=NaN,_s=NaN,zn=NaN;if(dt.strictExtend){const On=typeof ts.getRange=="function"?ts.getRange():null,ss=bb({startIndex:dt.startIndex,endIndex:dt.endIndex,startValue:dt.startValue,endValue:dt.endValue,slope:dt.slope,intercept:dt.intercept,extend:dt.extend,fromIndex:Bn,toIndex:bi,yRange:On,toX:Cn=>cs.convertToPixel(Cn),toY:Cn=>ts.convertToPixel(Cn)});if(!ss)return null;on=ss.extended.x1,bt=ss.extended.y1,_s=ss.extended.x2,zn=ss.extended.y2}else{let On=dt.startIndex,ss=dt.endIndex;dt.extend==="both"?(On=0,ss=Math.max(0,Zs-1)):dt.extend==="left"?On=0:dt.extend==="right"&&(ss=Math.max(0,Zs-1));const Cn=Number.isFinite(dt.slope)&&Number.isFinite(dt.intercept)?dt.slope*On+dt.intercept:dt.startValue,Ht=Number.isFinite(dt.slope)&&Number.isFinite(dt.intercept)?dt.slope*ss+dt.intercept:dt.endValue;on=cs.convertToPixel(On),bt=ts.convertToPixel(Cn),_s=cs.convertToPixel(ss),zn=ts.convertToPixel(Ht)}return!Number.isFinite(on)||!Number.isFinite(bt)||!Number.isFinite(_s)||!Number.isFinite(zn)?null:{a:{x:on+Ti,y:bt+Bi},b:{x:_s+Ti,y:zn+Bi}}},Rl=se=>{let Ft=Number(se==null?void 0:se.startIndex),dt=Number(se==null?void 0:se.endIndex);if(!Number.isFinite(Ft)||!Number.isFinite(dt))return null;if(Ft>dt){const bt=Ft;Ft=dt,dt=bt}const on=String((se==null?void 0:se.extend)||"").toLowerCase();return on==="both"?(Ft=0,dt=Math.max(0,Zs-1)):on==="left"?Ft=0:on==="right"&&(dt=Math.max(0,Zs-1)),{a:Ft,b:dt}},Ff=(se,Ft)=>Number.isFinite(se==null?void 0:se.slope)&&Number.isFinite(se==null?void 0:se.intercept)?se.slope*Ft+se.intercept:Number.isFinite(se==null?void 0:se.startValue)?se.startValue:Number.NaN,df=se=>{const Ft=se==null?void 0:se.line1,dt=se==null?void 0:se.line2;if(!Ft||!dt)return;const on=pc(Ft,ka(Ft)??void 0),bt=pc(dt,ka(dt)??void 0),_s=Rl(on),zn=Rl(bt);if(!_s||!zn)return;const On=Math.max(Bn,_s.a,zn.a),ss=Math.min(bi,_s.b,zn.b);if(On>ss)return;const Cn=[],Ht=[];for(let Fs=On;Fs<=ss;(Fs+=1)-1){const Ds=Ff(on,Fs),xs=Ff(bt,Fs);if(!Number.isFinite(Ds)||!Number.isFinite(xs))continue;const Rs=cs.convertToPixel(Fs),ys=ts.convertToPixel(Ds),ds=ts.convertToPixel(xs);Cn.push({x:Rs,y:ys}),Ht.push({x:Rs,y:ds})}Cn.length>1&&Ht.length>1&&Lx(G,Cn,Ht,se.color||"rgba(59,130,246,0.15)",yo)},Qd=(se,Ft)=>{const dt=pc(se,Ft),on=String((dt==null?void 0:dt.style)||"solid").toLowerCase();if(on.includes("arrow")||Number.isFinite(dt==null?void 0:dt.glow)&&dt.glow>0)return null;let bt=NaN,_s=NaN,zn=NaN,On=NaN;if(dt.strictExtend){const ss=typeof ts.getRange=="function"?ts.getRange():null,Cn=bb({startIndex:dt.startIndex,endIndex:dt.endIndex,startValue:dt.startValue,endValue:dt.endValue,slope:dt.slope,intercept:dt.intercept,extend:dt.extend,fromIndex:Bn,toIndex:bi,yRange:ss,toX:Ht=>cs.convertToPixel(Ht),toY:Ht=>ts.convertToPixel(Ht)});if(!Cn)return null;bt=Cn.extended.x1,_s=Cn.extended.y1,zn=Cn.extended.x2,On=Cn.extended.y2}else{let ss=dt.startIndex,Cn=dt.endIndex;dt.extend==="both"?(ss=0,Cn=Math.max(0,Zs-1)):dt.extend==="left"?ss=0:dt.extend==="right"&&(Cn=Math.max(0,Zs-1));const Ht=Number.isFinite(dt.slope)&&Number.isFinite(dt.intercept)?dt.slope*ss+dt.intercept:dt.startValue,Fs=Number.isFinite(dt.slope)&&Number.isFinite(dt.intercept)?dt.slope*Cn+dt.intercept:dt.endValue;bt=cs.convertToPixel(ss),_s=ts.convertToPixel(Ht),zn=cs.convertToPixel(Cn),On=ts.convertToPixel(Fs)}return!Number.isFinite(bt)||!Number.isFinite(_s)||!Number.isFinite(zn)||!Number.isFinite(On)?null:{kind:"line",points:[{x:bt+Ui,y:_s+wi},{x:zn+Ui,y:On+wi}],color:dt.color,width:dt.width,glow:dt.glow,glowColor:dt.glowColor,glowOpacity:dt.glowOpacity,style:on,opacity:dt.opacity}},Yu=(se,Ft)=>{if(Number.isFinite(se==null?void 0:se.glow)&&se.glow>0||!(se!=null&&se.points)||se.points.length<2)return null;const dt=Dc(se.points,Ft),on=Math.min(...dt.map(zn=>zn.index));if(Math.max(...dt.map(zn=>zn.index))<Bn-2||on>bi+2)return null;const _s=[];for(const zn of dt){const On=cs.convertToPixel(zn.index),ss=ts.convertToPixel(zn.value);!Number.isFinite(On)||!Number.isFinite(ss)||_s.push({x:On+Ui,y:ss+wi})}return _s.length<2?null:{kind:"polyline",points:_s,color:se.color,width:se.width,glow:se.glow,glowColor:se.glowColor,glowOpacity:se.glowOpacity,style:se.style,opacity:se.opacity}},nf=(se,Ft)=>{if(Number.isFinite(se==null?void 0:se.glow)&&se.glow>0||!(se!=null&&se.points)||se.points.length<3)return null;const dt=Dc(se.points,Ft),on=Math.min(...dt.map(zn=>zn.index));if(Math.max(...dt.map(zn=>zn.index))<Bn-2||on>bi+2)return null;const _s=[];for(const zn of dt){const On=cs.convertToPixel(zn.index),ss=ts.convertToPixel(zn.value);!Number.isFinite(On)||!Number.isFinite(ss)||_s.push({x:On+Ui,y:ss+wi})}return _s.length<3?null:{kind:"polygon",points:_s,fillColor:se.fillColor,fillGradient:se.fillGradient,strokeColor:se.strokeColor,strokeWidth:se.strokeWidth,strokeStyle:se.strokeStyle,opacity:se.opacity,glow:se.glow,glowColor:se.glowColor,glowOpacity:se.glowOpacity}},pp=(se,Ft)=>{if(Number.isFinite(se==null?void 0:se.glow)&&se.glow>0||!(se!=null&&se.commands)||!se.commands.length)return null;const dt=[];for(const on of se.commands){const bt=Kl({index:on.index,value:on.value},Ft),_s=cs.convertToPixel(bt.index),zn=ts.convertToPixel(bt.value);!Number.isFinite(_s)||!Number.isFinite(zn)||(on.cmd==="M"||on.cmd==="L")&&dt.push({cmd:on.cmd,x:_s+Ui,y:zn+wi})}return dt.length?{kind:"path",commands:dt,color:se.color,width:se.width,glow:se.glow,glowColor:se.glowColor,glowOpacity:se.glowOpacity,style:se.style,opacity:se.opacity}:null},Ka=se=>{const Ft=se==null?void 0:se.line1,dt=se==null?void 0:se.line2;if(!Ft||!dt)return null;const on=pc(Ft,ka(Ft)??void 0),bt=pc(dt,ka(dt)??void 0),_s=Rl(on),zn=Rl(bt);if(!_s||!zn)return null;const On=Math.max(Bn,_s.a,zn.a),ss=Math.min(bi,_s.b,zn.b);if(On>ss)return null;const Cn=[],Ht=[];for(let Ds=On;Ds<=ss;(Ds+=1)-1){const xs=Ff(on,Ds),Rs=Ff(bt,Ds);if(!Number.isFinite(xs)||!Number.isFinite(Rs))continue;const ys=cs.convertToPixel(Ds),ds=ts.convertToPixel(xs),Gn=ts.convertToPixel(Rs);!Number.isFinite(ys)||!Number.isFinite(ds)||!Number.isFinite(Gn)||(Cn.push({x:ys+Ui,y:ds+wi}),Ht.push({x:ys+Ui,y:Gn+wi}))}return Cn.length<2||Ht.length<2?null:{kind:"polygon",points:Cn.concat(Ht.reverse()),fillColor:se.color||"rgba(59,130,246,0.15)",fillGradient:se.fillGradient,opacity:se.opacity}},Ru=(se,Ft)=>{const dt=Number(se);if(Number.isFinite(dt))return{left:dt,right:dt,top:dt,bottom:dt};if(se&&typeof se=="object"){const on=se,bt=Number(on.left),_s=Number(on.right),zn=Number(on.top),On=Number(on.bottom);return{left:Number.isFinite(bt)?bt:Ft.left,right:Number.isFinite(_s)?_s:Ft.right,top:Number.isFinite(zn)?zn:Ft.top,bottom:Number.isFinite(On)?On:Ft.bottom}}return Ft},Xf=se=>{const Ft=Number.isFinite(se==null?void 0:se.fontSize)&&Number(se.fontSize)>0?Number(se.fontSize):Number.isFinite(se==null?void 0:se.size)&&Number(se.size)>0?Number(se.size):12,dt=(se==null?void 0:se.fontFamily)||(se!=null&&se.monospace?'"SFMono-Regular", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace':'"Inter", system-ui, -apple-system, sans-serif');return{font:`${(se==null?void 0:se.fontWeight)||"600"} ${Ft}px ${dt}`,size:Ft}},zf=(se,Ft,dt,on,bt,_s)=>{const zn=Math.max(0,Math.min(_s,Math.min(on,bt)/2));se.beginPath(),se.moveTo(Ft+zn,dt),se.lineTo(Ft+on-zn,dt),se.quadraticCurveTo(Ft+on,dt,Ft+on,dt+zn),se.lineTo(Ft+on,dt+bt-zn),se.quadraticCurveTo(Ft+on,dt+bt,Ft+on-zn,dt+bt),se.lineTo(Ft+zn,dt+bt),se.quadraticCurveTo(Ft,dt+bt,Ft,dt+bt-zn),se.lineTo(Ft,dt+zn),se.quadraticCurveTo(Ft,dt,Ft+zn,dt),se.closePath()},Qp=(se,Ft,dt)=>{if(!dt)return{index:se,value:Ft};const on=Xo(dt),bt=tr(on);return bt?{index:bt.index,value:bt.value}:{index:se,value:Ft}},bp=8,Cm=se=>{var zn,On,ss,Cn,Ht;const Ft=typeof(se==null?void 0:se.getRange)=="function"?se.getRange():null,dt=typeof(se==null?void 0:se.getParent)=="function"?(Ht=(Cn=(ss=(On=(zn=se.getParent())==null?void 0:zn.getYAxisWidget)==null?void 0:On.call(zn))==null?void 0:ss.getBounding)==null?void 0:Cn.call(ss))==null?void 0:Ht.height:0,on=Ft&&Number.isFinite(Ft.realRange)?Number(Ft.realRange):Ft&&Number.isFinite(Ft.displayRange)?Number(Ft.displayRange):null,bt=Number.isFinite(dt)&&dt>0&&on!=null?Math.abs(on)/Math.max(1,dt):null;let _s=null;if(bt==null){const Fs=$_(s().symbol),Ds=Math.max(0,Math.min(8,Math.trunc(Fs))),xs=Math.pow(10,-Ds);_s=Number.isFinite(xs)?xs:.01}return{padPx:bp,pricePerPixel:bt,fallbackStep:_s}},mc=typeof ts<"u"?ts:null,Ku=Cm(mc),Xh=(se,Ft,dt)=>{if(!ie)return se;const on=typeof(dt==null?void 0:dt.convertToPixel)=="function"?dt.convertToPixel(se):NaN;if(Number.isFinite(on)&&typeof(dt==null?void 0:dt.convertFromPixel)=="function"){const bt=on+(Ft==="above"?-Ku.padPx:Ku.padPx),_s=dt.convertFromPixel(bt);if(Number.isFinite(_s))return _s}return Ku.pricePerPixel!=null?se+(Ft==="above"?Ku.pricePerPixel:-Ku.pricePerPixel)*Ku.padPx:Ku.fallbackStep!=null?se+(Ft==="above"?Ku.fallbackStep:-Ku.fallbackStep):se},xp=(se,Ft)=>{const dt=se==null?void 0:se.ts,on=se==null?void 0:se.tsMs,bt=se==null?void 0:se.meta;if(!bt)return null;const _s=(()=>{let Ht;return typeof dt=="number"&&Number.isFinite(dt)&&(Ht=fa[String(dt)]),Ht==null&&typeof on=="number"&&Number.isFinite(on)&&(Ht=fa[`${Math.floor(on)}_ms`]??fa[`${Math.floor(on/1e3)}_s`]),typeof Ht=="number"&&Number.isFinite(Ht)?Ht:se==null?void 0:se.index})();if(typeof _s!="number"||!Number.isFinite(_s))return null;const zn=bt==null?void 0:bt.value;if(zn==null)return null;const On=typeof bt.offset=="number"&&Number.isFinite(bt.offset)?Math.trunc(bt.offset):0,ss=Qp(_s+On,Number(zn),Ft);let Cn=ss.value;return ie&&(bt==null?void 0:bt.yloc)==="abovebar"?Cn=Xh(Cn,"above",mc):ie&&(bt==null?void 0:bt.yloc)==="belowbar"&&(Cn=Xh(Cn,"below",mc)),{index:ss.index,value:Cn}},Im=(se,Ft,dt)=>{const on=typeof(se==null?void 0:se.offsetY)=="number"?se.offsetY:10,bt=((se==null?void 0:se.position)||"above")==="above",_s=typeof(se==null?void 0:se.size)=="number"&&se.size>0?se.size:12,zn=bt?dt.above[Ft]||0:dt.below[Ft]||0,On=on+zn*Math.max(6,_s/3);return{isAbove:bt,offset:On,size:_s}},Ym=(se,Ft,dt)=>{dt?se.above[Ft]=(se.above[Ft]||0)+1:se.below[Ft]=(se.below[Ft]||0)+1},Bh=(se,Ft,dt)=>{const on=se==null?void 0:se.meta;if(!on)return null;const bt=xp(se,dt);if(!bt)return null;let _s=bt.index;const zn=bt.value;if(bi>=0&&(_s<Bn||_s>bi))return null;const On=cs.convertToPixel(_s);if(!Number.isFinite(On))return null;let ss=ts.convertToPixel(zn);if(!Number.isFinite(ss))return null;const{isAbove:Cn,offset:Ht,size:Fs}=Im(on,_s,Ft);Cn?ss-=Ht:ss+=Ht,Ym(Ft,_s,Cn);const Ds=Fs/2;if(yo||Ks){const xn=0+Ds+2,Ei=((yo==null?void 0:yo.height)??Ks.height)-Ds-2;ss=Math.max(xn,Math.min(Ei,ss))}if(on.wrap===!0||on.maxWidth!=null||on.padding!=null||on.bgOpacity!=null||on.radius!=null||on.borderWidth!=null||on.align||on.valign||on.lineHeight!=null||on.fontFamily||on.fontSize!=null||on.fontWeight||on.monospace){const xn=Xf(on),Ei=Ru(on.padding,{left:8,right:8,top:6,bottom:6}),kl=on.align||on.textAlign,Do=kl==="left"||kl==="right"?kl:"center",oo=wb(String(on.text??""),{font:xn.font,color:"#e2e8f0",maxWidth:on.maxWidth,wrap:on.wrap===!0||on.textWrap===!0,lineHeight:on.lineHeight,align:Do}),ma=oo?{width:oo.width,height:oo.height}:K1({text:String(on.text??""),font:xn.font,maxWidth:on.maxWidth,wrap:on.wrap===!0||on.textWrap===!0,lineHeight:on.lineHeight}),Xa=Math.ceil(ma.width+Ei.left+Ei.right),bc=Math.ceil(ma.height+Ei.top+Ei.bottom),Da=on.valign,Vf=Da==="top"||Da==="middle"||Da==="bottom"?Da:Cn?"bottom":"top";let Tr=On;Do==="center"?Tr=On-Xa/2:Do==="right"&&(Tr=On-Xa);let zo=ss;if(Vf==="middle"?zo=ss-bc/2:Vf==="bottom"&&(zo=ss-bc),yo||Ks){const Yr=((yo==null?void 0:yo.height)??Ks.height)-bc;zo=Math.max(0,Math.min(Yr,zo))}return{x:Tr+Ti,y:zo+Bi,width:Xa,height:bc}}let Rs=Fs,ys=Fs;const ds=String(on.shape||"").toLowerCase(),Gn=String(on.text??"");if(Gn&&(ds==="text"||ds==="emoji"||ds==="label")){const xn=Xf(on),Ei=K1({text:Gn,font:xn.font,maxWidth:on.maxWidth,wrap:on.wrap===!0||on.textWrap===!0,lineHeight:on.lineHeight});Rs=Math.max(Rs,Math.ceil(Ei.width)),ys=Math.max(ys,Math.ceil(Ei.height))}return{x:On-Rs/2+Ti,y:ss-ys/2+Bi,width:Rs,height:ys}},Oh=(se,Ft,dt,on)=>{G.font='12px "Inter", system-ui, -apple-system, sans-serif';const bt=se==null?void 0:se.meta;if(!bt)return;const _s=bt.textAlign==="left"||bt.textAlign==="right"?bt.textAlign:"center";G.textAlign=_s;const zn=xp(se,dt);if(!zn)return;let On=zn.index;const ss=zn.value;if(bi>=0&&(On<Bn||On>bi))return;const Cn=cs.convertToPixel(On);if(!Number.isFinite(Cn))return;let Ht=ts.convertToPixel(ss);if(!Number.isFinite(Ht))return;const{isAbove:Fs,offset:Ds,size:xs}=Im(bt,On,Ft);if(Fs?(Ht-=Ds,G.textBaseline="bottom"):(Ht+=Ds,G.textBaseline="top"),Ym(Ft,On,Fs),dt&&(on!=null&&on.has(dt)))return;const Rs=xs/2;if(yo||Ks){const Tr=0+Rs+2,zo=((yo==null?void 0:yo.height)??Ks.height)-Rs-2;Ht=Math.max(Tr,Math.min(zo,Ht))}if(bt.wrap===!0||bt.maxWidth!=null||bt.padding!=null||bt.bgOpacity!=null||bt.radius!=null||bt.borderWidth!=null||bt.align||bt.valign||bt.lineHeight!=null||bt.fontFamily||bt.fontSize!=null||bt.fontWeight||bt.monospace||bt.callout===!0){const Tr=Xf(bt),zo=Ru(bt.padding,{left:8,right:8,top:6,bottom:6}),ha=bt.align||bt.textAlign,Yr=ha==="left"||ha==="right"?ha:"center",Pa=String(bt.shape||"").toLowerCase(),Bu=bt.callout===!0||Pa==="callout"||Pa==="pill"||Pa==="label"||Pa==="tag"||Pa==="flag"||Pa==="box_gradient",ef=bt.callout===!0||Pa==="callout",wp=bt.textColor||(Bu?"#f8fafc":bt.color||"#f97316"),Hp=!Bu,Wd=ef?null:wb(String(bt.text??""),{font:Tr.font,color:wp,maxWidth:bt.maxWidth,wrap:bt.wrap===!0||bt.textWrap===!0,lineHeight:bt.lineHeight,align:Yr}),jp=Wd?{width:Wd.width,height:Wd.height,lineHeight:Wd.lineHeight}:K1({text:String(bt.text??""),font:Tr.font,maxWidth:bt.maxWidth,wrap:bt.wrap===!0||bt.textWrap===!0,lineHeight:bt.lineHeight}),Zh=Math.ceil(jp.width+zo.left+zo.right),kp=Math.ceil(jp.height+zo.top+zo.bottom),Pv=bt.valign,xh=Pv==="top"||Pv==="middle"||Pv==="bottom"?Pv:Fs?"bottom":"top";let dm=Cn;Yr==="center"?dm=Cn-Zh/2:Yr==="right"&&(dm=Cn-Zh);let Bp=Ht;xh==="middle"?Bp=Ht-kp/2:xh==="bottom"&&(Bp=Ht-kp);const wh=bt.callout===!0?Math.max(4,Math.round(kp/4)):0;if(yo||Ks){const Mm=0+(bt.callout===!0&&!Fs?wh:0),Zf=((yo==null?void 0:yo.height)??Ks.height)-kp-(bt.callout===!0&&Fs?wh:0);Bp=Math.max(Mm,Math.min(Zf,Bp))}const Pm=bt!=null&&bt.pineV2?bt.bgColor||"rgba(0,0,0,0)":bt.bgColor||bt.color||"rgba(15,23,42,0.95)",Km=(bt==null?void 0:bt.bgGradient)??(bt==null?void 0:bt.gradient),pg=bt.bgOpacity!=null?Math.max(0,Math.min(1,Number(bt.bgOpacity))):null,Tg=bt!=null&&bt.pineV2?bt.borderColor||"rgba(0,0,0,0)":bt.borderColor||"rgba(0,0,0,0.65)",mg=bt.borderWidth!=null?Math.max(0,Number(bt.borderWidth)):bt!=null&&bt.pineV2||Bu?0:1,o0=bt.radius!=null?Number(bt.radius):String(bt.shape||"").toLowerCase()==="pill"?kp/2:void 0,Hg=Math.max(0,o0??6),i0=G.globalAlpha;if(G.globalAlpha=typeof bt.opacity=="number"?Math.max(0,Math.min(1,bt.opacity)):1,G.save(),zf(G,dm,Bp,Zh,kp,Hg),Pm||Km&&(Km.from||Km.to)){const Mm=G.globalAlpha;if(pg!=null&&(G.globalAlpha=Mm*pg),Km&&(Km.from||Km.to)){const Zf=eh(G,{minX:dm,maxX:dm+Zh,minY:Bp,maxY:Bp+kp},Km,Pm||"#0f172a");G.fillStyle=Zf??Pm}else G.fillStyle=Pm;G.fill(),G.globalAlpha=Mm}if(mg>0&&(G.strokeStyle=Tg,G.lineWidth=mg,G.stroke()),bt.callout===!0){const Mm=Math.max(4,Math.round(kp/4)),Zf=Cn,hg=Fs?Bp+kp:Bp,w0=Fs?hg+Mm:hg-Mm;if(G.beginPath(),G.moveTo(Zf-Mm,hg),G.lineTo(Zf+Mm,hg),G.lineTo(Zf,w0),G.closePath(),Km&&(Km.from||Km.to)){const S_=eh(G,{minX:dm,maxX:dm+Zh,minY:Math.min(Bp,w0),maxY:Math.max(Bp+kp,w0)},Km,Pm||"#0f172a");G.fillStyle=S_??Pm}else Pm&&(G.fillStyle=Pm);G.fill(),mg>0&&(G.strokeStyle=Tg,G.lineWidth=mg,G.stroke())}G.textBaseline="top",G.textAlign=Yr==="left"?"left":Yr==="right"?"right":"center";const pv=Yr==="left"?dm+zo.left:Yr==="right"?dm+Zh-zo.right:dm+Zh/2;let Fg=Bp+zo.top;const mv=G.globalCompositeOperation;if(G.globalCompositeOperation="source-over",Wd){const Mm=Yr==="left"?pv:Yr==="right"?pv-Wd.width:pv-Wd.width/2;G.drawImage(Wd.canvas,Math.round(Mm),Math.round(Fg),Wd.width,Wd.height)}else{G.font=Tr.font,G.fillStyle=wp,Hp&&(G.strokeStyle="rgba(0,0,0,0.45)",G.lineWidth=1);const Mm=K1({text:String(bt.text??""),font:Tr.font,maxWidth:bt.maxWidth,wrap:bt.wrap===!0||bt.textWrap===!0,lineHeight:bt.lineHeight});for(const Zf of Mm.lines)G.fillText(Zf,Math.round(pv),Math.round(Fg)),Hp&&G.strokeText(Zf,Math.round(pv),Math.round(Fg)),Fg+=Mm.lineHeight}G.globalCompositeOperation=mv,G.restore(),G.globalAlpha=i0;return}const ds=bt.shape||"",Gn=ds==="arrow_up"?"arrowUp":ds==="arrow_down"?"arrowDown":ds==="triangle_up_filled"?"triangleUpFilled":ds==="triangle_down_filled"?"triangleDownFilled":ds==="cross"?"cross":ds==="xcross"?"xcross":ds==="diamond"?"diamond":ds==="arrow_up_glow"?"arrowUpGlow":ds==="arrow_down_glow"?"arrowDownGlow":ds==="triangle_up_gradient"?"triangleUpGradient":ds==="triangle_down_gradient"?"triangleDownGradient":ds==="circle_pulse"?"circlePulse":ds==="callout"?"callout":ds==="tag"?"tag":ds==="flag"?"flag":ds==="pill"?"pill":ds==="box_gradient"?"boxGradient":ds==="bubble"?"bubble":ds==="spark"?"spark":ds==="star"?"star":ds==="label"?"label":ds==="text"||ds==="emoji"?"text":ds,xn=xs/2,Ei=bt!=null&&bt.pineV2?bt.bgColor||"rgba(0,0,0,0)":bt.bgColor||"rgba(15,23,42,0.95)",kl=(bt==null?void 0:bt.bgGradient)??(bt==null?void 0:bt.gradient),Do=bt!=null&&bt.pineV2?bt.borderColor||"rgba(0,0,0,0)":bt.borderColor||"rgba(0,0,0,0.65)",oo=String(bt.shape||"").toLowerCase(),ma=bt.callout===!0||oo==="callout"||oo==="pill"||oo==="label"||oo==="tag"||oo==="flag"||oo==="box_gradient",Xa=bt.textColor||(ma?"#f8fafc":bt.color||"#f8fafc"),bc=String(bt.text||""),Da=typeof bt.borderWidth=="number"?Math.max(0,bt.borderWidth):bt!=null&&bt.pineV2||ma?0:1;G.lineWidth=Da;const Vf=G.globalAlpha;if(G.globalAlpha=typeof bt.opacity=="number"?Math.max(0,Math.min(1,bt.opacity)):1,Gn==="circle"||Gn==="square"||Gn==="arrowUp"||Gn==="arrowDown"||Gn==="cross"||Gn==="xcross"||Gn==="diamond"||Gn==="box"||Gn==="triangleUpFilled"||Gn==="triangleDownFilled"||Gn==="label"||Gn==="arrowUpGlow"||Gn==="arrowDownGlow"||Gn==="triangleUpGradient"||Gn==="triangleDownGradient"||Gn==="circlePulse"||Gn==="callout"||Gn==="tag"||Gn==="flag"||Gn==="pill"||Gn==="boxGradient"||Gn==="bubble"||Gn==="spark"||Gn==="star"||Gn==="text"){if(G.save(),G.strokeStyle=Do,kl&&(kl.from||kl.to)){const Tr=eh(G,{minX:Cn-xn,maxX:Cn+xn,minY:Ht-xn,maxY:Ht+xn},kl,Ei||"#0f172a");G.fillStyle=Tr??(bt!=null&&bt.pineV2?Ei:bt.color||Ei)}else G.fillStyle=bt!=null&&bt.pineV2?Ei:bt.color||Ei;if(Gn==="circle")G.beginPath(),G.arc(Cn,Ht,xn,0,Math.PI*2),G.fill(),Da>0&&G.stroke();else if(Gn==="square")G.beginPath(),G.rect(Cn-xn,Ht-xn,xs,xs),G.fill(),Da>0&&G.stroke();else if(Gn==="cross")G.strokeStyle=bt.color||Do,G.beginPath(),G.moveTo(Cn-xn,Ht),G.lineTo(Cn+xn,Ht),G.moveTo(Cn,Ht-xn),G.lineTo(Cn,Ht+xn),Da>0&&G.stroke();else if(Gn==="xcross")G.strokeStyle=bt.color||Do,G.beginPath(),G.moveTo(Cn-xn,Ht-xn),G.lineTo(Cn+xn,Ht+xn),G.moveTo(Cn-xn,Ht+xn),G.lineTo(Cn+xn,Ht-xn),Da>0&&G.stroke();else if(Gn==="diamond")G.beginPath(),G.moveTo(Cn,Ht-xn),G.lineTo(Cn+xn,Ht),G.lineTo(Cn,Ht+xn),G.lineTo(Cn-xn,Ht),G.closePath(),G.fill(),Da>0&&G.stroke();else if(Gn==="arrowUp"||Gn==="arrowUpGlow")G.beginPath(),G.moveTo(Cn,Ht-xn),G.lineTo(Cn-xn,Ht+xn),G.lineTo(Cn+xn,Ht+xn),G.closePath(),(Gn==="arrowUpGlow"||bt.shadow)&&(G.shadowColor=bt.color||Ei,G.shadowBlur=12),G.fill(),Da>0&&G.stroke();else if(Gn==="arrowDown"||Gn==="arrowDownGlow")G.beginPath(),G.moveTo(Cn,Ht+xn),G.lineTo(Cn-xn,Ht-xn),G.lineTo(Cn+xn,Ht-xn),G.closePath(),(Gn==="arrowDownGlow"||bt.shadow)&&(G.shadowColor=bt.color||Ei,G.shadowBlur=12),G.fill(),Da>0&&G.stroke();else if(Gn==="triangleUpFilled")G.beginPath(),G.moveTo(Cn,Ht-xn),G.lineTo(Cn-xn,Ht+xn),G.lineTo(Cn+xn,Ht+xn),G.closePath(),G.fill(),Da>0&&G.stroke();else if(Gn==="triangleDownFilled")G.beginPath(),G.moveTo(Cn,Ht+xn),G.lineTo(Cn-xn,Ht-xn),G.lineTo(Cn+xn,Ht-xn),G.closePath(),G.fill(),Da>0&&G.stroke();else if(Gn==="triangleUpGradient"||Gn==="triangleDownGradient"){const Tr=G.createLinearGradient(Cn-xn,Ht-xn,Cn+xn,Ht+xn);Tr.addColorStop(0,bt.bgColor||"rgba(59,130,246,0.6)"),Tr.addColorStop(1,bt.color||"rgba(34,197,94,0.6)"),G.fillStyle=Tr,G.beginPath(),Gn==="triangleUpGradient"?(G.moveTo(Cn,Ht-xn),G.lineTo(Cn-xn,Ht+xn),G.lineTo(Cn+xn,Ht+xn)):(G.moveTo(Cn,Ht+xn),G.lineTo(Cn-xn,Ht-xn),G.lineTo(Cn+xn,Ht-xn)),G.closePath(),G.fill(),Da>0&&G.stroke()}else if(Gn==="circlePulse")G.beginPath(),G.arc(Cn,Ht,xn,0,Math.PI*2),G.fill(),Da>0&&G.stroke(),G.globalAlpha=.4,G.beginPath(),G.arc(Cn,Ht,xn*1.6,0,Math.PI*2),G.stroke(),G.globalAlpha=1;else if(Gn==="pill"){const Tr=Math.max(10,G.measureText(bc||"").width+16),zo=Math.max(12,xs),ha=Cn-Math.floor(Tr/2),Yr=Ht-Math.floor(zo/2),Pa=zo/2;G.beginPath(),G.moveTo(ha+Pa,Yr),G.lineTo(ha+Tr-Pa,Yr),G.arc(ha+Tr-Pa,Yr+Pa,Pa,-Math.PI/2,Math.PI/2),G.lineTo(ha+Pa,Yr+zo),G.arc(ha+Pa,Yr+Pa,Pa,Math.PI/2,-Math.PI/2),G.closePath(),G.fill(),Da>0&&G.stroke()}else if(Gn==="callout"){const Tr=Math.max(10,G.measureText(bc||"").width+18),zo=Math.max(12,xs+6),ha=Cn-Math.floor(Tr/2),Yr=Ht-Math.floor(zo/2),Pa=Math.max(4,Math.floor(zo/3));zf(G,ha,Yr,Tr,zo,Pa),G.fill(),Da>0&&G.stroke();const Bu=Math.max(4,Math.floor(zo/4));G.beginPath(),Fs?(G.moveTo(Cn-Bu,Yr+zo),G.lineTo(Cn+Bu,Yr+zo),G.lineTo(Cn,Yr+zo+Bu)):(G.moveTo(Cn-Bu,Yr),G.lineTo(Cn+Bu,Yr),G.lineTo(Cn,Yr-Bu)),G.closePath(),G.fill(),Da>0&&G.stroke()}else if(Gn==="tag"||Gn==="flag"){const Tr=Math.max(10,G.measureText(bc||"").width+20),zo=Math.max(12,xs+4),ha=Cn-Math.floor(Tr/2),Yr=Ht-Math.floor(zo/2);G.beginPath(),G.rect(ha,Yr,Tr,zo),G.fill(),Da>0&&G.stroke(),Gn==="flag"&&(G.beginPath(),G.moveTo(ha,Yr),G.lineTo(ha-zo/2,Yr+zo/2),G.lineTo(ha,Yr+zo),G.closePath(),G.fill(),G.stroke())}else if(Gn==="boxGradient"){const Tr=Math.max(10,G.measureText(bc||"").width+12),zo=Math.max(12,xs+6),ha=Cn-Math.floor(Tr/2),Yr=Ht-Math.floor(zo/2),Pa=G.createLinearGradient(ha,Yr,ha+Tr,Yr+zo);Pa.addColorStop(0,bt.bgColor||"rgba(15,23,42,0.5)"),Pa.addColorStop(1,bt.color||"rgba(59,130,246,0.35)"),G.fillStyle=Pa,G.beginPath(),G.rect(ha,Yr,Tr,zo),G.fill(),Da>0&&G.stroke()}else if(Gn==="bubble")G.beginPath(),G.arc(Cn,Ht,xn,0,Math.PI*2),G.fill(),Da>0&&G.stroke(),G.beginPath(),G.moveTo(Cn,Ht+xn),G.lineTo(Cn+xn,Ht+xn+6),Da>0&&G.stroke();else if(Gn==="spark")G.beginPath(),G.moveTo(Cn,Ht-xn),G.lineTo(Cn,Ht+xn),G.moveTo(Cn-xn,Ht),G.lineTo(Cn+xn,Ht),Da>0&&G.stroke();else if(Gn==="star"){G.beginPath();for(let Tr=0;Tr<5;(Tr+=1)-1){const zo=Math.PI*2*Tr/5,ha=Cn+Math.cos(zo)*xn,Yr=Ht+Math.sin(zo)*xn,Pa=zo+Math.PI/5,Bu=Cn+Math.cos(Pa)*(xn/2),ef=Ht+Math.sin(Pa)*(xn/2);Tr===0?G.moveTo(ha,Yr):G.lineTo(ha,Yr),G.lineTo(Bu,ef)}G.closePath(),G.fill(),Da>0&&G.stroke()}else if(Gn==="box"){const Tr=row.__open,zo=row.__close,ha=row.__high,Yr=row.__low;if(Tr!=null&&zo!=null&&ha!=null&&Yr!=null){const Pa=bt.boxMode||"body",Bu=Pa==="wick"?ha:Math.max(Tr,zo),ef=Pa==="wick"?Yr:Math.min(Tr,zo),wp=ts.convertToPixel(Bu),Hp=ts.convertToPixel(ef);if(Number.isFinite(wp)&&Number.isFinite(Hp)){const Wd=cs.convertToPixel(On),jp=On>0?cs.convertToPixel(On-1):Wd-Math.abs(cs.convertToPixel(1)-cs.convertToPixel(0)),Zh=On<or.length-1?cs.convertToPixel(On+1):Wd+Math.abs(cs.convertToPixel(1)-cs.convertToPixel(0)),kp=0,Pv=((yo==null?void 0:yo.width)??Ks.width)||0,xh=Math.min(Wd,Math.max(kp,Math.floor((jp+Wd)/2))),dm=Math.max(Wd,Math.min(Pv,Math.ceil((Wd+Zh)/2))),Bp=Math.min(wp,Hp),wh=Math.max(1,Math.abs(Hp-wp)),Pm=Math.max(2,dm-xh);G.beginPath(),G.rect(xh,Bp,Pm,wh),G.fill(),G.strokeStyle=Do,G.lineWidth=xs,G.stroke()}}}else if(Gn==="label"){const Tr=G.measureText(bc||""),zo=Math.max(10,Tr.width+12),ha=Math.max(12,xs+6),Yr=Math.max(3,Math.floor(ha/3)),Pa=Cn-Math.floor(zo/2),Bu=Ht-Math.floor(ha/2);G.beginPath();const ef=Yr;G.moveTo(Pa+ef,Bu),G.lineTo(Pa+zo-ef,Bu),G.quadraticCurveTo(Pa+zo,Bu,Pa+zo,Bu+ef),G.lineTo(Pa+zo,Bu+ha-ef),G.quadraticCurveTo(Pa+zo,Bu+ha,Pa+zo-ef,Bu+ha),G.lineTo(Pa+ef,Bu+ha),G.quadraticCurveTo(Pa,Bu+ha,Pa,Bu+ha-ef),G.lineTo(Pa,Bu+ef),G.quadraticCurveTo(Pa,Bu,Pa+ef,Bu),G.closePath(),G.fill(),G.stroke()}else if(Gn==="text"){G.fillStyle=Xa,G.textAlign=_s;const Tr=typeof bt.size=="number"&&bt.size>0?bt.size:14;G.font=`${Tr}px sans-serif`;const zo=Fs?Ht-(Tr/2+4):Ht+(Tr/2+4);G.fillText(bc||"",Cn,zo)}if(bc&&Gn!=="text"){const Tr=typeof bt.size=="number"&&bt.size>0?bt.size:12,zo=Gn==="callout"||Gn==="label"||Gn==="pill"||Gn==="tag"||Gn==="flag"||Gn==="boxGradient"||bt.callout===!0,ha=Tr/2,Yr=typeof bt.textPadding=="number"?Math.max(0,bt.textPadding):ha+6,Pa=zo?Ht:Fs?Ht-Yr:Ht+Yr,Bu=G.globalCompositeOperation;G.globalCompositeOperation="source-over",G.fillStyle=bt.callout===!0?bt.textColor||"#f8fafc":Xa,zo||(G.strokeStyle="rgba(0,0,0,0.45)"),G.textAlign="center",G.textBaseline="middle",G.fillText(bc,Cn,Pa),zo||G.strokeText(bc,Cn,Pa),G.globalCompositeOperation=Bu}G.restore(),G.globalAlpha=Vf}else if(bc)G.fillStyle=Xa,G.strokeStyle="rgba(0,0,0,0.45)",G.lineWidth=1,G.fillText(bc,Cn,Ht),G.strokeText(bc,Cn,Ht);else{const Tr=String(ds||"");if(!et.has(Tr)){et.add(Tr);try{console.warn("[ScriptStudio] Unknown label shape:",Tr)}catch{}}G.beginPath(),G.arc(Cn,Ht,Math.max(3,xs/3),0,Math.PI*2),G.fillStyle=bt.color||"#22d3ee",G.fill()}},Iv=se=>{if(!se||!se.columns||!se.rows)return;const Ft=8,dt=((yo==null?void 0:yo.width)??Ks.width)||0,on=((yo==null?void 0:yo.height)??Ks.height)||0,bt=Math.max(1,Math.floor(se.columns)),_s=Math.max(1,Math.floor(se.rows)),zn=typeof se.textSize=="number"&&se.textSize>0?se.textSize:12,On=new Array(bt).fill(0),ss=new Array(_s).fill(Math.max(20,zn+8)),Cn=Array.isArray(se.cells)?se.cells:[],Ht=new Map;for(const Do of Cn){const oo=Math.max(0,Math.min(bt-1,Do.column)),ma=Math.max(0,Math.min(_s-1,Do.row));Ht.set(`${oo}:${ma}`,Do)}const Fs=Array.isArray(se.merges)?se.merges:[],Ds=new Map,xs=new Map;for(const Do of Fs){if(!Do)continue;let oo=Math.max(0,Math.min(bt-1,Math.floor(Number(Do.left)))),ma=Math.max(0,Math.min(bt-1,Math.floor(Number(Do.right)))),Xa=Math.max(0,Math.min(_s-1,Math.floor(Number(Do.top)))),bc=Math.max(0,Math.min(_s-1,Math.floor(Number(Do.bottom))));if(!Number.isFinite(oo)||!Number.isFinite(ma)||!Number.isFinite(Xa)||!Number.isFinite(bc))continue;oo>ma&&([oo,ma]=[ma,oo]),Xa>bc&&([Xa,bc]=[bc,Xa]);const Da=`${oo}:${Xa}:${ma}:${bc}`;xs.has(Da)||xs.set(Da,{left:oo,top:Xa,right:ma,bottom:bc,minW:0,minH:0});for(let Vf=oo;Vf<=ma;(Vf+=1)-1)for(let Tr=Xa;Tr<=bc;(Tr+=1)-1)Ds.set(`${Vf}:${Tr}`,{left:oo,top:Xa,right:ma,bottom:bc})}for(const Do of Cn){const oo=Math.max(0,Math.min(bt-1,Do.column)),ma=Math.max(0,Math.min(_s-1,Do.row)),Xa=Ds.get(`${oo}:${ma}`);if(Xa&&(Xa.left!==oo||Xa.top!==ma))continue;const bc=Do.text||"",Da=typeof Do.textSize=="number"&&Do.textSize>0?Do.textSize:zn;G.font=`${Da}px "Inter", system-ui, -apple-system, sans-serif`;const Vf=G.measureText(bc).width+Ft*2,Tr=typeof Do.width=="number"&&Do.width>0?Do.width:0,zo=typeof Do.height=="number"&&Do.height>0?Do.height:Math.max(20,Da+8);if(Xa){const ha=`${Xa.left}:${Xa.top}:${Xa.right}:${Xa.bottom}`,Yr=xs.get(ha);Yr&&(Yr.minW=Math.max(Yr.minW,Vf,Tr),Yr.minH=Math.max(Yr.minH,zo))}else On[oo]=Math.max(On[oo],Vf,Tr),ss[ma]=Math.max(ss[ma],zo)}for(let Do=0;Do<bt;(Do+=1)-1)On[Do]<60&&(On[Do]=60);for(const Do of xs.values()){let oo=0;for(let Xa=Do.left;Xa<=Do.right;(Xa+=1)-1)oo+=On[Xa]||0;oo<Do.minW&&(On[Do.right]=(On[Do.right]||0)+(Do.minW-oo));let ma=0;for(let Xa=Do.top;Xa<=Do.bottom;(Xa+=1)-1)ma+=ss[Xa]||0;ma<Do.minH&&(ss[Do.bottom]=(ss[Do.bottom]||0)+(Do.minH-ma))}const Rs=On.reduce((Do,oo)=>Do+oo,0),ys=ss.reduce((Do,oo)=>Do+oo,0),ds=String(se.position||"top_right").toLowerCase();let Gn=Ft,xn=Ft;ds.includes("top_right")?(Gn=dt-Rs-Ft,xn=Ft):ds.includes("bottom_left")?(Gn=Ft,xn=on-ys-Ft):ds.includes("bottom_right")?(Gn=dt-Rs-Ft,xn=on-ys-Ft):ds.includes("top_center")?(Gn=(dt-Rs)/2,xn=Ft):ds.includes("bottom_center")?(Gn=(dt-Rs)/2,xn=on-ys-Ft):(ds.includes("middle_center")||ds.includes("center"))&&(Gn=(dt-Rs)/2,xn=(on-ys)/2),G.save(),se.bgcolor&&(G.fillStyle=se.bgcolor,G.fillRect(Gn,xn,Rs,ys));const Ei=se.frameColor||se.borderColor;Ei&&(G.strokeStyle=Ei,G.lineWidth=typeof se.frameWidth=="number"&&se.frameWidth>0?se.frameWidth:typeof se.borderWidth=="number"&&se.borderWidth>0?se.borderWidth:1,G.strokeRect(Gn,xn,Rs,ys));let kl=Gn;for(let Do=0;Do<bt;(Do+=1)-1){let oo=xn;for(let ma=0;ma<_s;(ma+=1)-1){const Xa=On[Do],bc=ss[ma],Da=Ds.get(`${Do}:${ma}`);if(Da&&(Da.left!==Do||Da.top!==ma)){oo+=bc;continue}const Vf=Da?(()=>{let Hp=0;for(let Wd=Da.left;Wd<=Da.right;(Wd+=1)-1)Hp+=On[Wd]||0;return Hp})():Xa,Tr=Da?(()=>{let Hp=0;for(let Wd=Da.top;Wd<=Da.bottom;(Wd+=1)-1)Hp+=ss[Wd]||0;return Hp})():bc,zo=Ht.get(`${Do}:${ma}`);zo!=null&&zo.bgcolor&&(G.fillStyle=zo.bgcolor,G.fillRect(kl,oo,Vf,Tr)),G.strokeStyle=se.borderColor||"rgba(148,163,184,0.5)",G.lineWidth=typeof se.borderWidth=="number"&&se.borderWidth>0?se.borderWidth:1,G.strokeRect(kl,oo,Vf,Tr);const ha=(zo==null?void 0:zo.text)||"",Yr=typeof(zo==null?void 0:zo.textSize)=="number"&&zo.textSize>0?zo.textSize:zn;G.font=`${Yr}px "Inter", system-ui, -apple-system, sans-serif`;const Pa=(zo==null?void 0:zo.textHalign)||se.textHalign||"left",Bu=(zo==null?void 0:zo.textValign)||se.textValign||"middle";G.textAlign=Pa==="center"||Pa==="right"?Pa:"left",G.textBaseline=Bu==="top"?"top":Bu==="bottom"?"bottom":"middle";let ef=kl+Ft;G.textAlign==="center"&&(ef=kl+Vf/2),G.textAlign==="right"&&(ef=kl+Vf-Ft);let wp=oo+Tr/2;G.textBaseline==="top"&&(wp=oo+Ft),G.textBaseline==="bottom"&&(wp=oo+Tr-Ft),G.fillStyle=(zo==null?void 0:zo.textColor)||se.textColor||"#e2e8f0",G.fillText(ha,ef,wp),oo+=bc}kl+=On[Do]}G.restore()},Vd=se=>{var ss,Cn;const Ft=uf[se];if(!Ft||!Ft.length)return;const dt=Ft.slice().sort((Ht,Fs)=>Ht.zIndex!==Fs.zIndex?Ht.zIndex-Fs.zIndex:Ht.createdAt-Fs.createdAt),on={above:{},below:{}},bt={above:{},below:{}},_s=[],zn=new Map,On=new Set;for(const Ht of dt){const Fs=Si(Ht);if(!(pl&&((ss=o_(Fs))!=null&&ss.hidden))){if(Ht.kind==="label"){const Ds=(Cn=Ht==null?void 0:Ht.payload)==null?void 0:Cn.meta,xs=Bh(Ht.payload,bt,Fs);xs&&zn.set(Fs,xs),xs&&Nu(Ds)&&(_s.some(ys=>du(ys,xs))?On.add(Fs):_s.push(xs))}if(pl){if(Ht.kind==="box"){const Ds=lu(Ht.payload,Fs),xs=Ia(Ht.payload,Fs),Rs=xs?{x:Math.min(xs.x1,xs.x2)+Ti,y:Math.min(xs.y1,xs.y2)+Bi,width:Math.abs(xs.x2-xs.x1),height:Math.abs(xs.y2-xs.y1)}:null;if(Rs&&Ds&&(Qr.push({id:Fs,type:Ht.kind,zIndex:Ht.zIndex,createdAt:Ko(),rect:Rs,box:Ds,axis:$a??void 0,offset:qi,snap:Or??void 0}),cr.set(Fs,Rs)),i(Dm)&&i(Dm)===Fs&&xs){const ys=Math.min(xs.x1,xs.x2),ds=Math.max(xs.x1,xs.x2),Gn=Math.min(xs.y1,xs.y2),xn=Math.max(xs.y1,xs.y2),Ei={left:ys,right:ds,top:Gn,bottom:xn},kl=2,Do=Math.max(Ga,8),oo=(()=>{const ha=ts.convertFromPixel(Gn),Yr=ts.convertFromPixel(Gn+Do);return Number.isFinite(ha)&&Number.isFinite(Yr)?Math.abs(Yr-ha):0})(),ma=ys+Ti,Xa=ds+Ti,bc=Gn+Bi,Da=xn+Bi,Vf=(ma+Xa)/2,Tr=(bc+Da)/2,zo={n:{x:Vf,y:bc},s:{x:Vf,y:Da},e:{x:Xa,y:Tr},w:{x:ma,y:Tr},ne:{x:Xa,y:bc},nw:{x:ma,y:bc},se:{x:Xa,y:Da},sw:{x:ma,y:Da}};Object.keys(zo).forEach(ha=>{const Yr=zo[ha],Pa={x:Yr.x-zr,y:Yr.y-zr,width:Ga,height:Ga},Bu={x:Pa.x-Ti,y:Pa.y-Bi,width:Pa.width,height:Pa.height},ef=`__handle:${Fs}:${ha}`;ya.push({id:ef,targetId:Fs,position:ha,rect:Pa,rectLocal:Bu,boundsPx:Ei,cursor:ea[ha],minWidthIndex:kl,minHeightValue:oo}),Qr.push({id:ef,type:"handle",zIndex:1e5,createdAt:Ko(),rect:Pa,handle:{targetId:Fs,position:ha,boundsPx:Ei,minWidthIndex:kl,minHeightValue:oo},axis:$a??void 0,offset:qi,snap:Or??void 0})})}}else if(Ht.kind==="line"||Ht.kind==="lineSegment"){const Ds=Tf(Ht.payload,Fs);Ds&&Qr.push({id:Fs,type:Ht.kind,zIndex:Ht.zIndex,createdAt:Ko(),segment:Ds,tolerance:pa,axis:$a??void 0,offset:qi,snap:Or??void 0})}else if(Ht.kind==="label"){const Ds=xp(Ht.payload,Fs),xs=zn.get(Fs)||null;xs&&Ds&&!On.has(Fs)&&Qr.push({id:Fs,type:Ht.kind,zIndex:Ht.zIndex,createdAt:Ko(),rect:xs,label:Ds,axis:$a??void 0,offset:qi,snap:Or??void 0})}else if(Ht.kind==="polyline"){const Ds=Ca(Ht.payload,Fs);Ds.length&&Qr.push({id:Fs,type:Ht.kind,zIndex:Ht.zIndex,createdAt:Ko(),segments:Ds,tolerance:pa,axis:$a??void 0,offset:qi,snap:Or??void 0})}else if(Ht.kind==="polygon"){const Ds=zd(Ht.payload,Fs);if(Ds.length>=3){let xs=Number.POSITIVE_INFINITY,Rs=Number.POSITIVE_INFINITY,ys=Number.NEGATIVE_INFINITY,ds=Number.NEGATIVE_INFINITY;for(const xn of Ds)!Number.isFinite(xn.x)||!Number.isFinite(xn.y)||(xn.x<xs&&(xs=xn.x),xn.x>ys&&(ys=xn.x),xn.y<Rs&&(Rs=xn.y),xn.y>ds&&(ds=xn.y));const Gn=Number.isFinite(xs)&&Number.isFinite(Rs)&&Number.isFinite(ys)&&Number.isFinite(ds)?{x:xs,y:Rs,width:Math.max(0,ys-xs),height:Math.max(0,ds-Rs)}:null;Gn&&cr.set(Fs,Gn),Qr.push({id:Fs,type:Ht.kind,zIndex:Ht.zIndex,createdAt:Ko(),polygon:Ds,rect:Gn??void 0,tolerance:pa,axis:$a??void 0,offset:qi,snap:Or??void 0})}}else if(Ht.kind==="path"){const Ds=au(Ht.payload,Fs);Ds.length&&Qr.push({id:Fs,type:Ht.kind,zIndex:Ht.zIndex,createdAt:Ko(),segments:Ds,tolerance:pa,axis:$a??void 0,offset:qi,snap:Or??void 0})}}Ht.kind==="box"?Kf(Ht.payload,Fs):Ht.kind==="polygon"?br(nf(Ht.payload,Fs))||Wc(Ht.payload,Fs):Ht.kind==="polyline"?br(Yu(Ht.payload,Fs))||ru(Ht.payload,Fs):Ht.kind==="path"?br(pp(Ht.payload,Fs))||Hc(Ht.payload,Fs):Ht.kind==="line"||Ht.kind==="lineSegment"?br(Qd(Ht.payload,Fs))||Of(Ht.payload,Fs):Ht.kind==="linefill"?br(Ka(Ht.payload))||df(Ht.payload):Ht.kind==="label"?Oh(Ht.payload,on,Fs,On):Ht.kind==="table"&&Iv(Ht.payload)}}};Vd("background"),Hl.forEach((se,Ft)=>{var bt,_s,zn,On,ss,Cn,Ht,Fs;const dt=So[Ft]||B[Ft].key,on=(se.type||"").toLowerCase();if(on==="candles"||on==="ohlc"){const Ds=`${dt}__open`,xs=`${dt}__high`,Rs=`${dt}__low`,ys=`${dt}__close`,ds=cs.convertToPixel(Bn),Gn=Bn+1<=bi?cs.convertToPixel(Bn+1):cs.convertToPixel(Math.max(Bn-1,0)),xn=Number.isFinite(ds)&&Number.isFinite(Gn)?Math.max(2,Math.abs(Gn-ds)):6,Ei=Math.max(2,Math.min(14,xn*.7)),kl=Ei/2,Do=se.color||"#22c55e",oo=se.downColor||"#ef4444",ma=se.upGradient??se.gradient,Xa=se.downGradient??se.gradient,bc=se.borderColor||Do,Da=se.borderColor||oo,Vf=se.wickColor||Do,Tr=se.wickColor||oo;for(let zo=Bn;zo<=bi;(zo+=1)-1){const ha=or[zo]||{},Yr=ha[Ds]??ha.__open,Pa=ha[xs]??ha.__high,Bu=ha[Rs]??ha.__low,ef=ha[ys]??ha.__close;if(Yr==null||Pa==null||Bu==null||ef==null||Number.isNaN(Yr)||Number.isNaN(Pa)||Number.isNaN(Bu)||Number.isNaN(ef))continue;const wp=cs.convertToPixel(zo),Hp=ef>=Yr,Wd=ts.convertToPixel(Math.max(Yr,ef)),jp=ts.convertToPixel(Math.min(Yr,ef)),Zh=ts.convertToPixel(Pa),kp=ts.convertToPixel(Bu),Pv=Hp?Vf:Tr;if(G.beginPath(),G.strokeStyle=Pv,G.lineWidth=1,G.moveTo(wp,Zh),G.lineTo(wp,kp),G.stroke(),on==="candles"){const xh=Hp?Do:oo,dm=Hp?bc:Da,Bp=Math.max(1,Math.abs(jp-Wd)),wh=Hp?ma:Xa;if(wh&&(wh.from||wh.to)){const Pm=eh(G,{minX:wp-kl,maxX:wp+kl,minY:Math.min(Wd,jp),maxY:Math.max(Wd,jp)},wh,xh);G.fillStyle=Pm??xh}else G.fillStyle=xh;G.strokeStyle=dm,G.lineWidth=1,G.beginPath(),G.rect(wp-kl,Math.min(Wd,jp),Ei,Bp),G.fill(),G.stroke()}else{const xh=Hp?bc:Da;G.strokeStyle=xh,G.lineWidth=1,G.beginPath(),G.moveTo(wp-kl,ts.convertToPixel(Yr)),G.lineTo(wp,ts.convertToPixel(Yr)),G.moveTo(wp,ts.convertToPixel(ef)),G.lineTo(wp+kl,ts.convertToPixel(ef)),G.stroke()}}}if(on==="dots"){const Ds=se.color||"#22d3ee",xs=se.width||4,Rs=[];for(let ys=Bn;ys<=bi;(ys+=1)-1){const ds=(bt=or[ys])==null?void 0:bt[dt];if(ds==null){Rs.push({x:NaN,y:NaN});continue}const Gn=cs.convertToPixel(ys),xn=ts.convertToPixel(ds);Rs.push({x:Gn,y:xn})}M5(G,Rs,Ds,xs,yo,se==null?void 0:se.gradient)}if(on==="cross"){const Ds=se.color||"#22d3ee",xs=se.width||6;G.save();const Rs=se==null?void 0:se.gradient;if(Rs&&(Rs.from||Rs.to)){const ys=yo??{left:0,top:0,width:Ks.width,height:Ks.height},ds=eh(G,{minX:ys.left,maxX:ys.left+ys.width,minY:ys.top,maxY:ys.top+ys.height},Rs,Ds);G.strokeStyle=ds??Ds}else G.strokeStyle=Ds;G.lineWidth=Math.max(1,Math.round(xs/3));for(let ys=Bn;ys<=bi;(ys+=1)-1){const ds=(_s=or[ys])==null?void 0:_s[dt];if(ds==null)continue;const Gn=cs.convertToPixel(ys),xn=ts.convertToPixel(ds);if(!Number.isFinite(Gn)||!Number.isFinite(xn))continue;const Ei=xs/2;G.beginPath(),G.moveTo(Gn-Ei,xn),G.lineTo(Gn+Ei,xn),G.moveTo(Gn,xn-Ei),G.lineTo(Gn,xn+Ei),G.stroke()}G.restore()}if(on==="stepped"||on==="step"){const Ds=se.color||"#22c55e",xs=se.width||2,Rs=[];for(let ys=Bn;ys<=bi;(ys+=1)-1){const ds=(zn=or[ys])==null?void 0:zn[dt];if(ds==null){Rs.push({x:NaN,y:NaN});continue}Rs.push({x:cs.convertToPixel(ys),y:ts.convertToPixel(ds)})}cJ(G,Rs,Ds,xs,yo,se==null?void 0:se.gradient)}if(on==="area"){const Ds=se.color||"rgba(56,189,248,0.3)",xs=[];for(let Gn=Bn;Gn<=bi;(Gn+=1)-1){const xn=(On=or[Gn])==null?void 0:On[dt];if(xn==null){xs.push({x:NaN,y:NaN});continue}const Ei=cs.convertToPixel(Gn),kl=ts.convertToPixel(xn);xs.push({x:Ei,y:kl})}const Rs=ts.convertToPixel(0),ds=String(se.baseline||"").toLowerCase()==="zero"?Rs:yo?yo.height:Ks.top+Ks.height;lJ(G,xs,ds,Ds,se==null?void 0:se.gradient,null,0,yo)}if(on==="glow_points"){const Ds=se.color||"#22d3ee",xs=(se.width||4)+2,Rs=[];for(let ys=Bn;ys<=bi;(ys+=1)-1){const ds=(ss=or[ys])==null?void 0:ss[dt];if(ds==null){Rs.push({x:NaN,y:NaN});continue}Rs.push({x:cs.convertToPixel(ys),y:ts.convertToPixel(ds)})}G.save(),G.shadowColor=Ds,G.shadowBlur=12,M5(G,Rs,Ds,xs,yo,se==null?void 0:se.gradient),G.restore()}if(on==="neon_line"){const Ds=se.color||"#22d3ee",xs=se.width||2;G.save(),G.shadowColor=Ds,G.shadowBlur=14;const Rs=se==null?void 0:se.gradient;if(Rs&&(Rs.from||Rs.to)){const ds=yo??{left:0,top:0,width:Ks.width,height:Ks.height},Gn=eh(G,{minX:ds.left,maxX:ds.left+ds.width,minY:ds.top,maxY:ds.top+ds.height},Rs,Ds);G.strokeStyle=Gn??Ds}else G.strokeStyle=Ds;G.beginPath();let ys=!1;for(let ds=Bn;ds<=bi;(ds+=1)-1){const Gn=(Cn=or[ds])==null?void 0:Cn[dt];if(Gn==null)continue;const xn=cs.convertToPixel(ds),Ei=ts.convertToPixel(Gn);ys?G.lineTo(xn,Ei):(G.moveTo(xn,Ei),ys=!0)}G.lineWidth=xs,G.stroke(),G.restore()}if(on==="bezier_line"){const Ds=se.color||"#34d399",xs=se.width||2;G.save();const Rs=se==null?void 0:se.gradient;if(Rs&&(Rs.from||Rs.to)){const xn=yo??{left:0,top:0,width:Ks.width,height:Ks.height},Ei=eh(G,{minX:xn.left,maxX:xn.left+xn.width,minY:xn.top,maxY:xn.top+xn.height},Rs,Ds);G.strokeStyle=Ei??Ds}else G.strokeStyle=Ds;G.beginPath();let ys=NaN,ds=NaN,Gn=!1;for(let xn=Bn;xn<=bi;(xn+=1)-1){const Ei=(Ht=or[xn])==null?void 0:Ht[dt];if(Ei==null)continue;const kl=cs.convertToPixel(xn),Do=ts.convertToPixel(Ei);if(!Gn)G.moveTo(kl,Do),Gn=!0;else{const oo=(ys+kl)/2,ma=(ds+Do)/2;G.quadraticCurveTo(ys,ds,oo,ma)}ys=kl,ds=Do}G.lineWidth=xs,G.stroke(),G.restore()}if(on==="cloud"||on==="supertrend_cloud"){const Ds=se.color||"rgba(14,165,233,0.12)";G.save();const xs=[],Rs=[];for(let Gn=Bn;Gn<=bi;(Gn+=1)-1){const xn=or[Gn]||{},Ei=cs.convertToPixel(Gn),kl=ts.convertToPixel(xn[dt]),Do=ts.convertToPixel(xn[So[0]]);xs.push({x:Ei,y:kl}),Rs.push({x:Ei,y:Do})}let ys=Ds;const ds=se==null?void 0:se.gradient;if(ds&&(ds.from||ds.to)){let Gn=Number.POSITIVE_INFINITY,xn=Number.NEGATIVE_INFINITY,Ei=Number.POSITIVE_INFINITY,kl=Number.NEGATIVE_INFINITY;for(const oo of xs)!Number.isFinite(oo.x)||!Number.isFinite(oo.y)||(oo.x<Gn&&(Gn=oo.x),oo.x>xn&&(xn=oo.x),oo.y<Ei&&(Ei=oo.y),oo.y>kl&&(kl=oo.y));for(const oo of Rs)!Number.isFinite(oo.x)||!Number.isFinite(oo.y)||(oo.x<Gn&&(Gn=oo.x),oo.x>xn&&(xn=oo.x),oo.y<Ei&&(Ei=oo.y),oo.y>kl&&(kl=oo.y));const Do=eh(G,{minX:Number.isFinite(Gn)?Gn:0,maxX:Number.isFinite(xn)&&xn!==Gn?xn:Number.isFinite(Gn)?Gn+1:1,minY:Number.isFinite(Ei)?Ei:0,maxY:Number.isFinite(kl)&&kl!==Ei?kl:Number.isFinite(Ei)?Ei+1:1},ds,Ds);Do&&(ys=Do)}Lx(G,xs,Rs,ys,yo),G.restore()}if(on==="aura"||on==="candleshadow"){const Ds=se.color||"#a78bfa",xs=se.width||2;G.save(),G.shadowColor=Ds,G.shadowBlur=18;const Rs=se==null?void 0:se.gradient;if(Rs&&(Rs.from||Rs.to)){const ds=yo??{left:0,top:0,width:Ks.width,height:Ks.height},Gn=eh(G,{minX:ds.left,maxX:ds.left+ds.width,minY:ds.top,maxY:ds.top+ds.height},Rs,Ds);G.strokeStyle=Gn??Ds}else G.strokeStyle=Ds;G.beginPath();let ys=!1;for(let ds=Bn;ds<=bi;(ds+=1)-1){const Gn=(Fs=or[ds])==null?void 0:Fs[dt];if(Gn==null)continue;const xn=cs.convertToPixel(ds),Ei=ts.convertToPixel(Gn);ys?G.lineTo(xn,Ei):(G.moveTo(xn,Ei),ys=!0)}G.lineWidth=xs,G.stroke(),G.restore()}});const ju=Et.fills||[];if(Array.isArray(ju)&&ju.length)for(const se of ju){const Ft=Array.isArray(se==null?void 0:se.between)?se.between:[];if(!Ft||Ft.length!==2)continue;const dt=(Ft[0]||"").replace(/\s+/g,"_").toLowerCase(),on=(Ft[1]||"").replace(/\s+/g,"_").toLowerCase(),bt=A[dt],_s=A[on];if(!bt||!_s)continue;const zn=[],On=[];for(let Ht=Bn;Ht<=bi;(Ht+=1)-1){const Fs=or[Ht]||{},Ds=cs.convertToPixel(Ht),xs=ts.convertToPixel(Fs[bt]),Rs=ts.convertToPixel(Fs[_s]);zn.push({x:Ds,y:xs}),On.push({x:Ds,y:Rs})}let ss=se.color||"rgba(0,0,0,0.12)";const Cn=se.fillGradient;if(Cn&&(Cn.from||Cn.to)){let Ht=Number.POSITIVE_INFINITY,Fs=Number.NEGATIVE_INFINITY,Ds=Number.POSITIVE_INFINITY,xs=Number.NEGATIVE_INFINITY;for(const oo of zn)!Number.isFinite(oo==null?void 0:oo.x)||!Number.isFinite(oo==null?void 0:oo.y)||(oo.x<Ht&&(Ht=oo.x),oo.x>Fs&&(Fs=oo.x),oo.y<Ds&&(Ds=oo.y),oo.y>xs&&(xs=oo.y));for(const oo of On)!Number.isFinite(oo==null?void 0:oo.x)||!Number.isFinite(oo==null?void 0:oo.y)||(oo.x<Ht&&(Ht=oo.x),oo.x>Fs&&(Fs=oo.x),oo.y<Ds&&(Ds=oo.y),oo.y>xs&&(xs=oo.y));const Rs=Cn.from||ss,ys=Cn.to||ss||Rs,ds=String(Cn.mode||"vertical").toLowerCase(),Gn=Number.isFinite(Ht)?Ht:0,xn=Number.isFinite(Fs)&&Fs!==Ht?Fs:Gn+1,Ei=Number.isFinite(Ds)?Ds:0,kl=Number.isFinite(xs)&&xs!==Ds?xs:Ei+1;let Do;if(ds==="horizontal")Do=G.createLinearGradient(Gn,Ei,xn,Ei);else if(ds==="radial"){const oo=(Gn+xn)/2,ma=(Ei+kl)/2,Xa=Math.max(xn-Gn,kl-Ei)/2;Do=G.createRadialGradient(oo,ma,0,oo,ma,Math.max(1,Xa))}else Do=G.createLinearGradient(Gn,Ei,Gn,kl);Do.addColorStop(0,String(Rs)),Do.addColorStop(1,String(ys)),ss=Do}Lx(G,zn,On,ss,yo)}Vd("main"),Mo.forEach(se=>{const Ft=ts.convertToPixel(se.value);if(!Number.isFinite(Ft))return;G.beginPath(),G.moveTo(0,Ft),G.lineTo(((yo==null?void 0:yo.width)??Ks.width)||0,Ft),G.strokeStyle=se.color||"#64748b",G.lineWidth=se.width??1;const dt=(se.style||"dashed").toLowerCase();dt==="dashed"||dt==="dotted"?G.setLineDash(dt==="dashed"?[4,4]:[2,2]):G.setLineDash([]),G.stroke(),G.setLineDash([])});const Wp=Et.backgroundZones||[];if(Array.isArray(Wp)&&Wp.length)for(const se of Wp){const Ft=Number.isFinite(se.from)?ts.convertToPixel(se.from):0,dt=Number.isFinite(se.to)?ts.convertToPixel(se.to):(yo==null?void 0:yo.height)??Ks.height,on=Math.min(Ft,dt),bt=Math.abs(dt-Ft);G.beginPath(),G.rect(0,on,((yo==null?void 0:yo.width)??Ks.width)||0,bt),G.fillStyle=se.color||"rgba(34,197,94,0.08)",G.fill()}if(Vd("overlay"),Vd("ui"),tl&&$i&&_o.length&&(Lt.push({bounds:$i,shapes:_o}),vu()),pl&&ya.length){G.save(),G.fillStyle="rgba(226,232,240,0.9)",G.strokeStyle="rgba(15,23,42,0.65)",G.lineWidth=1;for(const se of ya){const Ft=se.rectLocal;G.beginPath(),G.rect(Ft.x+.5,Ft.y+.5,Ft.width,Ft.height),G.fill(),G.stroke()}G.restore()}if(pl&&i(vf)){const se=cr.get(i(vf));se&&(G.save(),G.strokeStyle="rgba(148,163,184,0.75)",G.lineWidth=1,G.strokeRect(se.x-Ti+.5,se.y-Bi+.5,se.width,se.height),G.restore())}return pl?(ah.set(ji,Qr),Lv=Array.from(ah.values()).flat()):ah.has(ji)&&(ah.delete(ji),Lv=Array.from(ah.values()).flat()),G.restore(),!1}},Od=(Et==null?void 0:Et.legend)??((Su=S==null?void 0:S.style)==null?void 0:Su.legend)??!0,wf=G=>{if(G==null)return;const Bt=String(G).toLowerCase().replace(/\s+/g,"_");if(Bt.includes("bottom")&&Bt.includes("right"))return"bottom_right";if(Bt.includes("bottom")&&Bt.includes("left"))return"bottom_left";if(Bt.includes("top")&&Bt.includes("right"))return"top_right";if(Bt.includes("top")&&Bt.includes("left"))return"top_left";if(Bt.includes("bottom"))return"bottom_left";if(Bt.includes("top"))return"top_left"},kf=G=>{const Bt=il(G);return Number.isFinite(Bt)?Bt:void 0},Ri=Hl.find(G=>(G==null?void 0:G.legendPosition)!=null||(G==null?void 0:G.legendOffsetX)!=null||(G==null?void 0:G.legendOffsetY)!=null),_r=wf((Et==null?void 0:Et.legendPosition)??(Et==null?void 0:Et.legend_position)??(Ri==null?void 0:Ri.legendPosition)??(Ri==null?void 0:Ri.legend_position)??((sa=S==null?void 0:S.style)==null?void 0:sa.legendPosition))||"top_left",ua=kf((Et==null?void 0:Et.legendOffsetX)??(Et==null?void 0:Et.legend_offset_x)??(Ri==null?void 0:Ri.legendOffsetX)??(Ri==null?void 0:Ri.legend_offset_x)??((Ol=S==null?void 0:S.style)==null?void 0:Ol.legendOffsetX))??0,Vi=kf((Et==null?void 0:Et.legendOffsetY)??(Et==null?void 0:Et.legend_offset_y)??(Ri==null?void 0:Ri.legendOffsetY)??(Ri==null?void 0:Ri.legend_offset_y)??((od=S==null?void 0:S.style)==null?void 0:od.legendOffsetY))??0;return Jd.__plotMeta={plots:Hl,plotKeys:So,legend:Od,legendPosition:_r,legendOffsetX:ua,legendOffsetY:Vi},Jd.__scriptSource=ue,Jd},_d=[],yh=[];yn.forEach((Et,hs)=>{var ai,Bs,Fn,ks,vs,li,ra;const Lo=Du(Et,hs);try{Z2(Lo)}catch(jr){console.debug("Script indicator register error",jr)}const So=Et.pane==="main"?"candle_pane":`pane_script_${hs}`;yh[hs]=So;const qa=Et.pane==="main",Zc=typeof Et.min=="number"&&typeof Et.max=="number",Eo=Et.pane==="sub"?{gap:Zc?{top:0,bottom:0}:{top:2,bottom:2}}:void 0;let Fa=Q.createIndicator(Lo.name,qa,{id:So,height:typeof Et.height=="number"&&Number.isFinite(Et.height)?Et.height:Et.pane==="sub"?((ai=S==null?void 0:S.sub)==null?void 0:ai.height)??(S==null?void 0:S.height)??200:((Bs=S==null?void 0:S.main)==null?void 0:Bs.height)??(S==null?void 0:S.height)??void 0,axis:Eo});if(Fa||(Fa=Q.createIndicator(Lo,qa,{id:So,height:typeof Et.height=="number"&&Number.isFinite(Et.height)?Et.height:Et.pane==="sub"?((Fn=S==null?void 0:S.sub)==null?void 0:Fn.height)??(S==null?void 0:S.height)??200:((ks=S==null?void 0:S.main)==null?void 0:ks.height)??(S==null?void 0:S.height)??void 0,axis:Eo})),!Fa)throw new Error("Unable to render script indicator.");Pu.push(Fa),wc.push(Lo.name),Ue.push({def:Lo,paneId:So}),Zc?(xo.set(So,{min:Et.min,max:Et.max}),Ud(So),qf(So)):xo.delete(So);try{Q.createOverlay({name:"script-layer",visible:!0,lock:!0,groupId:"runtime"})}catch{}const il=(ra=Lo.calc)==null?void 0:ra.call(Lo,((li=(vs=o())==null?void 0:vs.getDataList)==null?void 0:li.call(vs))||[],{calcParams:[]}),Hl=Array.isArray(il)?il:Array.isArray(il==null?void 0:il.__rows)?il.__rows:[],Bf=i(nr)?Hl.reduce((jr,Mr)=>jr+Object.keys(Mr||{}).filter(mr=>mr.startsWith("__label_")).length,0):0;_d.push(Bf)});try{const Et=Ue.find(hs=>hs.paneId==="candle_pane");x(cc,V(((Gm=Et==null?void 0:Et.def)==null?void 0:Gm.name)||((Pr=(Hi=Ue[0])==null?void 0:Hi.def)==null?void 0:Pr.name)||null))}catch{x(cc,null)}try{const Et=((iu=Q.getDataList)==null?void 0:iu.call(Q))||[],hs=Fn=>{const ks=typeof Fn=="number"?Fn:Number(Fn);return Number.isFinite(ks)?ks:void 0},Lo=Et.map(Fn=>{const ks=hs((Fn==null?void 0:Fn.close)??(Fn==null?void 0:Fn.c)??(Fn==null?void 0:Fn.price));return hs((Fn==null?void 0:Fn.high)??(Fn==null?void 0:Fn.h))??ks}),So=Et.map(Fn=>{const ks=hs((Fn==null?void 0:Fn.close)??(Fn==null?void 0:Fn.c)??(Fn==null?void 0:Fn.price));return hs((Fn==null?void 0:Fn.low)??(Fn==null?void 0:Fn.l))??ks}),qa=Et.map(Fn=>hs((Fn==null?void 0:Fn.close)??(Fn==null?void 0:Fn.c)??(Fn==null?void 0:Fn.price))),Zc=(Fn,ks)=>{const vs=Fn[ks];return typeof vs=="number"&&Number.isFinite(vs)?vs:null},Eo=(Fn,ks)=>{const vs=Et.length;if(vs<=0)return null;const li=Math.max(1,Math.floor(ks.left)),ra=Math.max(1,Math.floor(ks.right)),jr=Math.max(2,Math.floor(ks.lookback)),Mr=vs-1,mr=Math.max(0,Mr-jr+1),Mo=Math.max(0,Mr-ra);if(Mo<mr)return null;const La=Fn==="high"?Lo:So,k=[];for(let R=mr+li;R<=Mo;(R+=1)-1){const U=Zc(La,R);if(U==null)continue;let q=!0;for(let ve=R-li;ve<=R+ra;(ve+=1)-1){if(ve===R)continue;const Re=Zc(La,ve);if(Re==null){q=!1;break}if(Fn==="high"){if(Re>=U){q=!1;break}}else if(Re<=U){q=!1;break}}q&&k.push(R)}if(!k.length)return null;const A=Math.trunc(ks.which);if(A===0)return k[k.length-1];if(A<0){const R=k.length+A;return R>=0?k[R]:null}const B=A-1;return B>=0&&B<k.length?k[B]:null},Fa=(Fn,ks)=>{const vs=Et.length;if(vs<=0)return null;const li=Math.max(2,Math.floor(ks.lookback)),ra=vs-1,jr=Math.max(0,ra-li+1),Mr=Fn==="high"?Lo:So;let mr=null,Mo=Fn==="high"?-1/0:1/0;for(let La=jr;La<=ra;(La+=1)-1){const k=Zc(Mr,La);k!=null&&(Fn==="high"?k>Mo&&(Mo=k,mr=La):k<Mo&&(Mo=k,mr=La))}return mr},il=Fn=>{const ks=typeof Fn=="number"?Fn:Number(Fn);if(!Number.isFinite(ks))return null;const vs=Et.length,li=ks<0?vs+Math.trunc(ks):Math.trunc(ks);return li<0||li>=vs?null:li},Hl=Fn=>{var jr,Mr;if(!Fn||typeof Fn!="object")return null;if(Fn.pivot){const mr=String(Fn.pivot).toLowerCase()==="low"?"low":"high",Mo=Eo(mr,{left:Number(Fn.left??Fn.pivotLeft??3),right:Number(Fn.right??Fn.pivotRight??3),lookback:Number(Fn.lookback??400),which:Number(Fn.which??-1)});Mo!=null&&(Fn={index:Mo,source:mr})}else if(Fn.extreme){const mr=String(Fn.extreme).toLowerCase()==="low"?"low":"high",Mo=Fa(mr,{lookback:Number(Fn.lookback??400)});Mo!=null&&(Fn={index:Mo,source:mr})}const ks=il(Fn.index),vs=typeof Fn.timestamp=="number"&&Number.isFinite(Fn.timestamp)?Fn.timestamp:ks!=null?((jr=Et[ks])==null?void 0:jr.timestamp)??((Mr=Et[ks])==null?void 0:Mr.time)??null:null;let li=typeof Fn.value=="number"&&Number.isFinite(Fn.value)?Fn.value:null;if(li==null&&ks!=null&&Fn.source){const mr=String(Fn.source||"").replace(/\s+/g,"_").toLowerCase(),Mo=Et[ks],La=mr==="open"?Mo==null?void 0:Mo.open:mr==="high"?Mo==null?void 0:Mo.high:mr==="low"?Mo==null?void 0:Mo.low:mr==="close"?Mo==null?void 0:Mo.close:mr==="volume"?Mo==null?void 0:Mo.volume:null;typeof La=="number"&&Number.isFinite(La)&&(li=La)}const ra={};return vs!=null&&(ra.timestamp=vs),li!=null&&(ra.value=li),ks!=null&&(ra.__index=ks),Object.keys(ra).length?ra:null},Bf=[];yn.forEach((Fn,ks)=>{(Array.isArray(Fn.overlays)?Fn.overlays:[]).forEach(li=>Bf.push({paneId:yh[ks]||(Fn.pane==="main"?"candle_pane":"pane_script"),overlay:li}))});let ai=0;const Bs=[];Bf.forEach(({paneId:Fn,overlay:ks})=>{try{const vs=String((ks==null?void 0:ks.name)||"").trim();if(!vs)return;const ra=(Array.isArray(ks==null?void 0:ks.points)?ks.points:[]).map(Hl).filter(Boolean),jr={name:vs,paneId:(ks==null?void 0:ks.pane)==="main"?"candle_pane":((ks==null?void 0:ks.pane)==="sub",Fn),groupId:"runtime",lock:(ks==null?void 0:ks.lock)===!0,visible:(ks==null?void 0:ks.visible)!==!1,points:ra};ks!=null&&ks.styles&&(jr.styles=ks.styles),ks!=null&&ks.extendData&&(jr.extendData=ks.extendData),Q.createOverlay(jr),ai+=1}catch(vs){Bs.push(String((vs==null?void 0:vs.message)||vs))}});try{const Fn=Array.isArray(qt)?qt:[];for(const ks of Fn){const vs=String((ks==null?void 0:ks.type)||"").trim().toLowerCase();if(vs!=="auto_fib"&&vs!=="autofib"||!(ks.draw===!0||ks.autoDraw===!0)||Et.length<2)continue;const ra=Math.max(2,Math.floor(Number(ks.lookback)||200)),Mr=String(ks.direction||"up").trim().toLowerCase()==="down"?"down":"up",mr=String(ks.method||ks.mode||"extremes").trim().toLowerCase(),Mo=mr==="pivots"||mr==="pivot"||mr==="swing"?"pivots":"extremes",La=Math.max(1,Math.floor(Number(ks.pivotLeft??ks.left??3))),k=Math.max(1,Math.floor(Number(ks.pivotRight??ks.right??3))),A=j8(Lo,So,qa,Et.length-1,{lookback:ra,direction:Mr,method:Mo,pivotLeft:La,pivotRight:k});if(!A)continue;const B=Et[A.fromIndex],R=Et[A.toIndex],U=(B==null?void 0:B.timestamp)??(B==null?void 0:B.time)??null,q=(R==null?void 0:R.timestamp)??(R==null?void 0:R.time)??null;if(U==null||q==null)continue;const ve=ks.levels,Re=Array.isArray(ve)&&ve.length?ve.map(rt=>{if(typeof rt=="number")return{value:rt,color:"#64748b",label:String(rt)};if(rt&&typeof rt=="object"){const Ut=typeof rt.value=="number"?rt.value:Number(rt.value);return Number.isFinite(Ut)?{value:Ut,color:String(rt.color||"#64748b"),label:String(rt.label??Ut)}:null}return null}).filter(Boolean):[{value:0,color:"#64748b",label:"0"},{value:.382,color:"#60a5fa",label:"0.382"},{value:.5,color:"#22c55e",label:"0.5"},{value:.618,color:"#f59e0b",label:"0.618"},{value:1,color:"#64748b",label:"1"}];Q.createOverlay({name:"fibonacciSegment",paneId:"candle_pane",groupId:"runtime",lock:!1,visible:!0,points:[{timestamp:U,value:A.fromValue},{timestamp:q,value:A.toValue}],extendData:{fibonacciLevels:Re}}),ai+=1}}catch(Fn){Bs.push(String((Fn==null?void 0:Fn.message)||Fn))}ai&&x(zt,`${i(zt)||"Plotted"} • overlays: ${ai}`),Bs.length&&x(Qt,`Overlay error: ${Bs.slice(0,2).join(" • ")}`)}catch(Et){console.error("[ScriptStudio] overlay create error",Et)}try{const Et=Ue.find(hs=>hs.paneId==="candle_pane");x(cc,V(((hd=Et==null?void 0:Et.def)==null?void 0:hd.name)||((Zd=(yf=Ue[0])==null?void 0:yf.def)==null?void 0:Zd.name)||null))}catch{x(cc,null)}const jh=yn.map(Et=>Et.pane).join("+"),gp=_d.reduce((Et,hs)=>Et+hs,0),Sm=yn.flatMap(Et=>Et.plots||[]),Pp=Sm.length,Dp=Sm.filter(Z).length,_p=yn.some(Et=>Array.isArray(Et.labels)&&Et.labels.length>0||Array.isArray(Et.runtimeLabels)&&Et.runtimeLabels.length>0),Wg=yn.some(Et=>Array.isArray(Et.runtimeLines)&&Et.runtimeLines.length>0||Array.isArray(Et.runtimeBoxes)&&Et.runtimeBoxes.length>0||Array.isArray(Et.runtimeTables)&&Et.runtimeTables.length>0||Array.isArray(Et.runtimeDrawOps)&&Et.runtimeDrawOps.length>0||Array.isArray(Et.overlays)&&Et.overlays.length>0),_f=[],Ql=Dp===0&&!Wg;if(Ql&&!i(nr)&&(gp>0||_p)&&_f.push({level:"warning",message:"Labels are disabled; this script only outputs labels, so nothing is visible.",hint:"Turn Labels On or add a plot/line/box."}),Ql&&_p&&gp===0&&_f.push({level:"warning",message:"No label signals matched, so nothing was drawn.",hint:"Loosen your conditions or add a plot for context."}),Ql&&_f.length===0&&(Pp>0?_f.push({level:"warning",message:"All plots are hidden (transparent/opacity 0) and no draws are visible.",hint:"Use a visible color or remove transparent plots while debugging."}):_f.push({level:"warning",message:"No visible output: no plots or draw calls were produced.",hint:"Check conditions/returns or add a plot for context."})),_f.length&&x(ho,V(I(i(ho),_f))),x(zt,`Plotted (${jh}) • labels: ${i(nr)?gp:"off"}`),Na.size&&x(zt,`${i(zt)} • limits: ${Array.from(Na).join(" • ")}`),ie&&x(ho,V(Array.from(De.values()))),gp===0)try{const Et=yn.reduce((Eo,Fa)=>Eo+(Fa.plots||[]).length,0),hs=[],Lo=yn.some(Eo=>Array.isArray(Eo.labels)&&Eo.labels.length>0),So=yn.some(Eo=>Array.isArray(Eo.runtimeDrawOps)&&Eo.runtimeDrawOps.length>0||Array.isArray(Eo.overlays)&&Eo.overlays.length>0||Array.isArray(Eo.runtimeLabels)&&Eo.runtimeLabels.length>0||Array.isArray(Eo.runtimeLines)&&Eo.runtimeLines.length>0||Array.isArray(Eo.runtimeBoxes)&&Eo.runtimeBoxes.length>0||Array.isArray(Eo.runtimeTables)&&Eo.runtimeTables.length>0);Et===0&&!Lo&&!So&&hs.push("Pane has no plots");const qa=new Set(["open","high","low","close","volume","time","bar_index","barstate_isfirst","barstate_islast","barstate_islastconfirmedhistory","barstate_isconfirmed","barstate_isrealtime","barstate_ishistory","barstate_isnew","timeframe_multiplier","timeframe_seconds","timeframe_isseconds","timeframe_isminutes","timeframe_ishours","timeframe_isdaily","timeframe_isweekly","timeframe_ismonthly","timeframe_isyearly","timeframe_isintraday","timeframe_period","syminfo_mintick","syminfo_pointvalue","syminfo_tickerid","syminfo_ticker","syminfo_root","syminfo_prefix","syminfo_exchange","syminfo_description","syminfo_type","syminfo_currency","syminfo_timezone","syminfo_session","syminfo_isdelayed","strategy_position_size","strategy_position_avg_price","strategy_opentrades","strategy_closedtrades","strategy_openprofit","strategy_closedprofit","strategy_grossprofit","strategy_grossloss","strategy_wintrades","strategy_losstrades","strategy_winrate","strategy_max_drawdown","strategy_max_drawdown_value","strategy_max_runup","strategy_max_runup_value","strategy_avg_trade","strategy_avg_win","strategy_avg_loss","strategy_avg_bars_in_trade","strategy_equity","strategy_netprofit","strategy_initial_capital"]),Zc=(Eo,Fa)=>{const il=(Eo||"").toLowerCase(),Hl=Fa.replace(/\s+/g,"_").toLowerCase();return il==="bbands"||il==="bollinger"||il==="bollinger_bands"||il==="kc"||il==="keltner"||il==="donchian"||il==="linreg_channel"?[`${Hl}_mid`,`${Hl}_upper`,`${Hl}_lower`]:il==="atr_bands"?[`${Hl}_upper`,`${Hl}_lower`]:il==="stoch"?[`${Hl}_k`,`${Hl}_d`]:il==="macd"?["macd_line","macd_signal","macd_hist"]:il==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[Hl]};if(qt.forEach(Eo=>{const Fa=String((Eo==null?void 0:Eo.name)||(Eo==null?void 0:Eo.type)||"").replace(/\s+/g,"_").toLowerCase();Zc(String((Eo==null?void 0:Eo.type)||""),Fa).forEach(il=>qa.add(il))}),sn.forEach(Eo=>{const Fa=String((Eo==null?void 0:Eo.name)||"").replace(/\s+/g,"_").toLowerCase();Fa&&qa.add(Fa)}),yn.forEach((Eo,Fa)=>{(Eo.labels||[]).forEach((il,Hl)=>{const Bf=String((il==null?void 0:il.when)||"").trim(),Bs=String((il==null?void 0:il.whenExpr)||"").trim()||Bf;if(!Bs){hs.push(`Label[${Fa}:${Hl}] has empty condition`);return}try{const Fn=S!=null&&S.params&&typeof S.params=="object"?S.params:{},ks=Bs.replace(/\$\{([^}]+)\}/g,(mr,Mo)=>{const La=Fn[Mo],k=typeof La=="number"?La:Number(La);return Number.isFinite(k)?String(k):"0"}),vs=En(ks),li=[],ra=Ap(vs),jr=mr=>{!mr||typeof mr!="object"||(mr.kind==="Identifier"&&li.push(String(mr.name||"")),Object.values(mr).forEach(jr))};jr(ra);const Mr=li.filter(mr=>{const Mo=mr.replace(/\s+/g,"_").toLowerCase();return Mo==="na"||Mo==="nan"||Mo==="true"||Mo==="false"||Mo==="pi"||Mo==="e"?!1:!qa.has(Mo)&&!["open","high","low","close","volume"].includes(Mo)});Mr.length&&hs.push(`Label[${Fa}:${Hl}] unknown series: ${Mr.join(", ")}`)}catch(Fn){const ks=(Fn==null?void 0:Fn.position)!=null?` at ${Fn.position}`:"",vs=Fn!=null&&Fn.message?String(Fn.message):String(Fn);hs.push(`Label[${Fa}:${Hl}] parse failed${ks}: ${vs}`)}})}),hs.length){const Eo=hs.join(" • ");x(Qt,V(i(Qt)?`${i(Qt)} • ${Eo}`:Eo))}else x(zt,"No label signals matched")}catch{}const Ir=E(i(ho));Ir&&x(zt,`${i(zt)||"Plotted"} • ${Ir}`),Ll();try{ft&&(clearInterval(ft),ft=null)}catch{}Pd()}function me(S){const j=String(S||"").split(/\r?\n/),Q=Math.min(8,j.length);for(let ue=0;ue<Q;(ue+=1)-1){const De=(j[ue]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!De)continue;const ze=String(De[1]||"").toLowerCase();if(ze==="auto"||ze==="json"||ze==="pine"||ze==="dsl"||ze==="js")return ze}return null}function Le(S,j){return j&&j!=="auto"?j:me(S)||"auto"}function ye(S){let j="",Q=null;for(let ue=0;ue<S.length;(ue+=1)-1){const ie=S[ue],De=S[ue+1];if(Q){j+=ie,ie===Q&&S[ue-1]!=="\\"&&(Q=null);continue}if(ie==="'"||ie==='"'){Q=ie,j+=ie;continue}if(ie==="/"&&De==="/")break;j+=ie}return j}function Se(S){let j="",Q=null;for(let ue=0;ue<S.length;(ue+=1)-1){const ie=S[ue];if(Q){j+=" ",ie===Q&&S[ue-1]!=="\\"&&(Q=null);continue}if(ie==="'"||ie==='"'){Q=ie,j+=" ";continue}j+=ie}return j}function Ge(S){const j=String(S||"").split(/\r?\n/),Q=/[A-Za-z_$][A-Za-z0-9_$]*\s*\[\s*-\s*\d+\s*\]/;for(let ue=0;ue<j.length;(ue+=1)-1){const ie=ye(j[ue]||""),De=Se(ie),ze=Q.exec(De);if(ze)return{line:ue+1,col:ze.index+1,snippet:ze[0].trim()}}return null}function Ae(S){const j=String(S||""),Q=[];let ue="",ie=0,De=null,ze=!1;for(let lt=0;lt<j.length;(lt+=1)-1){const wt=j[lt];if(De){if(ue+=wt,ze){ze=!1;continue}if(wt==="\\"){ze=!0;continue}wt===De&&(De=null);continue}if(wt==="'"||wt==='"'){De=wt,ue+=wt;continue}if(wt==="("){ie+=1,ue+=wt;continue}if(wt===")"&&ie>0){ie-=1,ue+=wt;continue}if(wt===","&&ie===0){ue.trim()&&Q.push(ue.trim()),ue="";continue}ue+=wt}return ue.trim()&&Q.push(ue.trim()),Q}function Rt(S){const j=String(S||"").split(/\r?\n/),Q={},ue=De=>De.trim().toLowerCase(),ie=De=>{const ze=String(De||"").trim();if(!/^[-+]?\d+(?:\.\d+)?$/.test(ze))return null;const lt=Number(ze);return Number.isFinite(lt)?Math.max(0,Math.floor(lt)):null};for(let De=0;De<j.length;(De+=1)-1){const ze=ye(j[De]||""),lt=ze.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(?:float|int|bool|string)\s*\(([^)]*)\)/i);if(lt){const qt=Ae(lt[2]||""),sn=ie(qt[0]||"");sn!=null&&(Q[ue(lt[1]||"")]=sn);continue}const wt=ze.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\(([^)]*)\)/i);if(wt){const qt=Ae(wt[2]||"");qt.length&&(Q[ue(wt[1]||"")]=qt.length)}}for(let De=0;De<j.length;(De+=1)-1){const ze=ye(j[De]||""),lt=Se(ze),wt=lt.match(/\barray\.set\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+)\b/i);if(wt){const sn=ue(wt[1]||""),Ot=Number(wt[2]),vn=Q[sn],kn=lt.indexOf(wt[0]||"")+1;if(Number.isFinite(Ot)&&Ot<0)return{line:De+1,col:kn>0?kn:1,message:"Negative array index not allowed"};if(Number.isFinite(Ot)&&vn!=null&&Ot>=vn)return{line:De+1,col:kn>0?kn:1,message:"array.set index must be within array size"}}const qt=lt.match(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+)\b/i);if(qt){const sn=Number(qt[2]),Ot=lt.indexOf(qt[0]||"")+1;if(Number.isFinite(sn)&&sn<0)return{line:De+1,col:Ot>0?Ot:1,message:"Negative array index not allowed"}}}return null}function nn(S){const j=String(S||"").trim();if(!j)return"";const Q=j[0];return(Q==='"'||Q==="'")&&j.endsWith(Q)?j.slice(1,-1):j}function Xn(S){const j=nn(S).trim().toLowerCase();if(!j)return null;const Q=j.replace(/^shape\./,"").replace(/^label\./,"");return Q.includes("none")?"none":Q.includes("xcross")?"xcross":Q.includes("cross")?"cross":Q.includes("diamond")?"diamond":Q.includes("triangleup")?"triangle_up_filled":Q.includes("triangledown")?"triangle_down_filled":Q.includes("arrowup")?"arrowUp":Q.includes("arrowdown")?"arrowDown":Q.includes("circle")?"circle":Q.includes("square")?"square":Q.includes("flag")?"flag":Q.includes("tag")?"tag":Q.includes("pill")?"pill":Q.includes("label")?"label":null}function hn(S){const j=nn(S).trim().toLowerCase();if(!j)return null;const Q=j.replace(/^size\./,"");if(Q==="auto")return 14;if(Q==="tiny")return 10;if(Q==="small")return 12;if(Q==="normal")return 14;if(Q==="large")return 18;if(Q==="huge")return 22;const ue=Number(Q);return Number.isFinite(ue)?ue:null}function is(S){const j=String(S||"").trim().toLowerCase();return j?j.startsWith('"')||j.startsWith("'")||j.startsWith("shape.")||j.startsWith("label.")?!0:["triangleup","triangledown","arrowup","arrowdown","circle","square","label","diamond","cross","xcross","flag","tag","pill","none"].includes(j):!1}function Gs(S){const j=String(S||"").trim().toLowerCase();return j?j.startsWith('"')||j.startsWith("'")?!0:j.startsWith("location."):!1}function es(S){const j=nn(S).trim().toLowerCase();if(!j)return null;const Q=j.replace(/^location\./,"");return Q.includes("absolute")?"absolute":/(above|top|high)/.test(Q)?"above":/(below|bottom|low)/.test(Q)?"below":null}function Mi(S){const j=String(S||"").trim().toLowerCase();return j?j.startsWith('"')||j.startsWith("'")||j.startsWith("size.")?!0:/^[-+]?\d+(?:\.\d+)?$/.test(j):!1}function Kn(S){const j={};return S.forEach(Q=>{const ue=Q.indexOf("=");if(ue<=0)return;const ie=Q.slice(0,ue).trim().toLowerCase(),De=Q.slice(ue+1).trim();ie&&(j[ie]=De)}),j}function Es(S){const j=String(S||"").split(/\r?\n/);for(let Q=0;Q<j.length;(Q+=1)-1){const ue=ye(j[Q]||""),ie=ue.match(/^\s*(plotshape|plotchar)\s*\((.*)\)\s*$/i);if(!ie)continue;const De=String(ie[1]||"").toLowerCase(),ze=Ae(ie[2]||""),lt=Kn(ze),wt=lt.style??lt.shape;if(De==="plotshape"&&wt&&is(wt)&&!Xn(wt)){const vn=Math.max(1,ue.indexOf(wt)+1);return{line:Q+1,col:vn,message:`plotshape style not supported: ${wt}`}}const qt=lt.location;if(qt&&Gs(qt)&&!es(qt)){const vn=Math.max(1,ue.indexOf(qt)+1);return{line:Q+1,col:vn,message:`${De} location not supported: ${qt}`}}const sn=lt.size;if(sn&&Mi(sn)&&hn(sn)==null){const vn=Math.max(1,ue.indexOf(sn)+1);return{line:Q+1,col:vn,message:`${De} size not supported: ${sn}`}}}return null}function Qo(S){const j=String(S||"").trim();if(!j)return!1;const Q=j[0];if(Q!=='"'&&Q!=="'")return!1;let ue=1,ie=!1;for(;ue<j.length;(ue+=1)-1){const De=j[ue];if(ie){ie=!1;continue}if(De==="\\"){ie=!0;continue}if(De===Q){ue+=1;break}}return ue<=1?!1:j.slice(ue).trim().length===0}function sr(S){const j=String(S||"").split(/\r?\n/);for(let Q=0;Q<j.length;(Q+=1)-1){const ue=j[Q]||"";let ie=null,De=0,ze=-1,lt=-1;for(let wt=0;wt<ue.length;(wt+=1)-1){const qt=ue[wt],sn=ue[wt+1];if(ie){qt===ie&&ue[wt-1]!=="\\"&&(ie=null);continue}if(qt==="'"||qt==='"'){ie=qt;continue}if(qt==="/"&&sn==="/")break;if(qt==="?"){De===0&&(ze=wt),De+=1;continue}if(qt===":"&&De>0&&(De-=1,De===0)){lt=wt;break}}if(ze>=0&&lt>ze){const wt=ue.slice(ze+1,lt),qt=ue.slice(lt+1),sn=Qo(wt),Ot=Qo(qt);if(sn!==Ot)return{line:Q+1,col:ze+1,snippet:ue.slice(ze).trim()}}}return null}const na=S=>{const j=S.match(/^\s*(indicator|study)\s*\(\s*("([^"]+)"|'([^']+)')/m);return(j?(j[3]||j[4]||"").trim():"")||null},Xr=S=>{let j=0;for(let Q=0;Q<S.length;(Q+=1)-1)j=j*31+S.charCodeAt(Q)>>>0;return j.toString(36)},Uu=S=>{const j=na(S);return j||`pine_${Xr(S)}`},xd=2e4,ul=S=>new Promise((j,Q)=>{const ue=new Worker(new URL(""+new URL("../workers/js.worker-B6MBShEo.js",import.meta.url).href,import.meta.url),{type:"module"}),ie=setTimeout(()=>{try{ue.terminate()}catch{}Q(new Error("JS worker timed out"))},xd);ue.onerror=()=>{try{clearTimeout(ie)}catch{}try{ue.terminate()}catch{}Q(new Error("JS worker error"))},ue.onmessage=De=>{const ze=De.data;if(!(!ze||ze.id!==S.id)){try{clearTimeout(ie)}catch{}try{ue.terminate()}catch{}j(ze)}},ue.postMessage(S)});async function dr(S,j,Q,ue){var lt,wt,qt,sn,Ot,vn,kn,as,Ls,Ys,yn,Vt,Pn;x(Qt,null),x(zt,"Running..."),x(ho,V([])),x(ri,!0),jo+=1,kz(),Aa=ue&&typeof ue=="object"?{...ue}:null,ar=(()=>{if(!Aa)return"";const Hn=Aa,Tn=Hn.from??"",bn=Hn.to??"",In=Hn.session??"";return`${Tn}|${bn}|${In}`})();let ie="parse",De=Q||void 0,ze;try{let Hn=null;const Tn=String(S||""),bn=Tn.trim(),In=Le(Tn,Q);De=In;const Hs=bn.startsWith("{")||bn.startsWith("["),Xt=Kt=>{try{return JSON.parse(Kt)}catch{return null}},jn=Kt=>Kt&&typeof Kt=="object"&&(Kt.plots||Kt.calc||Kt.series||Kt.signals||Kt.strategy||Kt.labels||Kt.levels||Kt.lines||Kt.overlays||Kt.panes||Kt.main||Kt.sub);if(In==="json"){const Kt=Xt(bn);if(!Kt){x(Qt,"Invalid JSON: expected a script spec object"),x(zt,"Validation failed");return}if(!jn(Kt)){x(Qt,"JSON mode expects a script spec object"),x(zt,"Validation failed");return}try{const Zt=Kt&&typeof Kt=="object"?Kt.params||{}:{},an=Mw(Kt,Zt);let rs=an;try{rs=Aw(an)}catch(Xs){const Ni=Xs instanceof Error?Xs.message:String(Xs);x(Qt,`Template expansion error: ${Ni}`),x(zt,"Validation failed");return}ze=String(rs&&(rs.shortName||rs.name||rs.title)||"").trim()||void 0,ie="normalize";const Sn=q_(rs);if(Sn.ok&&Sn.spec)ue&&typeof ue=="object"&&(rs.strategy={...rs.strategy||{},...ue}),ie="draw",await _e(rs,"json"),x(zt,"Plotted from JSON");else{const Xs=(Sn.errors||[]).join("; ");x(Qt,V(Xs?`Schema validation failed: ${Xs}`:"Schema validation failed")),x(zt,"Validation failed");return}}catch(Zt){const an=Zt instanceof Error?Zt.message:String(Zt);x(Qt,`Schema validation error: ${an}`),x(zt,"Validation failed");return}return}if(In==="js"){const Kt=o();if(!Kt){x(Qt,"Chart not ready yet. Please try again in a moment."),x(zt,"Validation failed");return}const Zt=((lt=Kt.getDataList)==null?void 0:lt.call(Kt))||[];if(!Zt.length){x(Qt,"JS engine: no bars available"),x(zt,"Validation failed");return}const an=Zt.length,rs=new Array(an),Sn=new Array(an),Xs=new Array(an),Ni=new Array(an),Qn=new Array(an),Fo=new Array(an),ps=Ql=>{if(typeof Ql=="number")return Number.isFinite(Ql)?Ql:void 0;if(typeof Ql=="string"){const kd=Ql.replace(/[^0-9eE+\\-\\.]/g,"");if(!kd||kd==="+"||kd==="-"||kd===".")return;const Rp=Number(kd);return Number.isFinite(Rp)?Rp:void 0}const Ir=Number(Ql);return Number.isFinite(Ir)?Ir:void 0};for(let Ql=0;Ql<an;(Ql+=1)-1){const Ir=Zt[Ql],kd=ps((Ir==null?void 0:Ir.close)??(Ir==null?void 0:Ir.c)??(Ir==null?void 0:Ir.price)??(Ir==null?void 0:Ir.value)),Rp=ps((Ir==null?void 0:Ir.open)??(Ir==null?void 0:Ir.o))??kd,Jp=ps((Ir==null?void 0:Ir.high)??(Ir==null?void 0:Ir.h))??kd??Rp,dv=ps((Ir==null?void 0:Ir.low)??(Ir==null?void 0:Ir.l))??kd??Rp,yp=ps((Ir==null?void 0:Ir.volume)??(Ir==null?void 0:Ir.vol))??0,Hv=ps((Ir==null?void 0:Ir.timestamp)??(Ir==null?void 0:Ir.time)??(Ir==null?void 0:Ir.t))??0;Ni[Ql]=kd,rs[Ql]=Rp,Sn[Ql]=Jp,Xs[Ql]=dv,Qn[Ql]=yp,Fo[Ql]=Hv}const Po=j&&typeof j=="object"?{...j}:{},Go=/request\s*\.\s*security/i.test(S),Ps=((wt=s())==null?void 0:wt.symbol)||{ticker:"UNKNOWN"},Ns=String((Ps==null?void 0:Ps.country)||"BD").trim()||"BD",si=`${String((Ps==null?void 0:Ps.ticker)||"UNKNOWN").trim()}@${Ns}`,Ec=String(((sn=(qt=s())==null?void 0:qt.period)==null?void 0:sn.timeframe)||"1m").trim()||"1m",yc=Ql=>{const Ir=typeof Ql=="number"?Ql:Number(Ql);return!Number.isFinite(Ir)||Ir<=0?0:Ir<1e12?Ir*1e3:Ir},Pc=yc(Fo[0]??0),rc=yc(Fo[an-1]??0),Mc=Ql=>{const Ir=String(Ql||"").trim();if(!Ir)return 0;if(/^\d+$/.test(Ir))return mp(`${Ir}m`);if(Ir==="M"||Ir==="1M")return mp("1M");const kd=Ir.toUpperCase();if(kd==="D"||kd==="1D")return mp("1d");if(kd==="W"||kd==="1W")return mp("1w");const Rp=Ir.match(/^(\d+)\s*([A-Za-z]+)$/);if(Rp){const Jp=Rp[1]||"1",dv=Rp[2]||"";if(dv==="M")return mp(`${Jp}M`);const yp=dv.toLowerCase();return yp.startsWith("min")?mp(`${Jp}m`):yp==="h"||yp.startsWith("hr")||yp.startsWith("hour")?mp(`${Jp}h`):yp==="d"||yp.startsWith("day")?mp(`${Jp}d`):yp==="w"||yp.startsWith("wk")||yp.startsWith("week")?mp(`${Jp}w`):yp.startsWith("sec")?mp(`${Jp}s`):mp(`${Jp}${yp}`)}try{return mp(Ir)}catch{return 0}},$c=Mc(Ec),bl=$c>0?$c*1e3:0,fl=rc>0&&bl>0?rc+bl-1:rc,$u=(vn=(Ot=o())==null?void 0:Ot.getVisibleRange)==null?void 0:vn.call(Ot),sd=Ql=>Number.isFinite(Ql)?Math.max(0,Math.min(an-1,Math.floor(Ql))):0,Bl=$u?sd($u.from):0,Sp=$u?sd($u.to):an-1,Xc=yc(Fo[Bl]??0),xl=yc(Fo[Sp]??0),Du=Xc||Pc,_d=xl>0&&bl>0?xl+bl-1:fl;let yh,jh,gp=null;if(Go){let Ql=null;try{Ql=await ul({id:`js_mtf_${Date.now()}`,code:S,base:{open:rs,high:Sn,low:Xs,close:Ni,volume:Qn,time:Fo},params:Po,mtf:{baseSymbol:si,baseTimeframe:Ec,collectOnly:!0}})}catch(kd){const Rp=kd instanceof Error?kd.message:"JS engine failed";x(Qt,V(Rp)),x(zt,"Validation failed");return}if(!Ql||Ql.error){x(Qt,V(String((Ql==null?void 0:Ql.error)||"JS engine failed"))),x(zt,"Validation failed");return}const Ir=Array.isArray(Ql==null?void 0:Ql.mtfRequests)?Ql.mtfRequests:[];if(Ir.length){const kd=Hi=>String(Hi||"").trim().toLowerCase().replace(/\s+/g,""),Rp=Hi=>{const Pr=String(Hi||"").trim(),iu=Pr.lastIndexOf("@");if(iu>0&&iu<Pr.length-1){const hd=Pr.slice(0,iu).trim(),yf=Pr.slice(iu+1).trim();if(hd&&yf)return{ticker:hd,country:yf}}return{ticker:Pr}},Jp=Array.isArray((kn=s())==null?void 0:kn.allSymbols)?s().allSymbols:[],dv=new Map,yp=new Map,Hv=new Map;for(const Hi of Jp){const Pr=kd(String((Hi==null?void 0:Hi.ticker)||""));Pr&&dv.set(Pr,Hi);const iu=kd(String((Hi==null?void 0:Hi.shortName)||""));iu&&!yp.has(iu)&&yp.set(iu,Hi);const hd=kd(String((Hi==null?void 0:Hi.name)||""));hd&&!Hv.has(hd)&&Hv.set(hd,Hi)}const Pg=Hi=>{const Pr=String(Hi??"").trim();if(!Pr)return"__CURRENT__";const iu=Pr.toLowerCase();return iu==="syminfo.tickerid"||iu==="syminfo.ticker"||iu==="syminfo.root"||iu==="__current__"||iu==="__current_symbol__"?"__CURRENT__":Pr},Mg=Hi=>{const Pr=Pg(Hi);if(Pr==="__CURRENT__")return{sym:Ps,found:!0,raw:Pr};const iu=Rp(Pr),hd=String(iu.ticker||"").trim(),yf=kd(hd),Zd=yf&&dv.get(yf)||yf&&yp.get(yf)||yf&&Hv.get(yf)||null,Et=String(iu.country||(Zd==null?void 0:Zd.country)||Ns).trim()||Ns;return Zd&&String(Zd.ticker||"").trim()?{sym:{...Zd,country:Et},found:!0,raw:Pr}:{sym:{...Ps,ticker:hd,country:Et},found:!1,raw:Pr}},Ng=Hi=>{const Pr=String(Hi??"").trim();if(!Pr)return"__CURRENT__";const iu=Pr.toUpperCase();if(iu==="CURRENT"||iu==="__CURRENT__"||iu==="TIMEFRAME.PERIOD")return"__CURRENT__";if(iu==="D"||iu==="1D")return"1d";if(iu==="W"||iu==="1W")return"1w";if(iu==="M"||iu==="1M")return"1M";if(/^\d+$/.test(Pr))return`${Pr}m`;const hd=iu.match(/^(\d+)\s*H$/);if(hd)return`${hd[1]}h`;const yf=iu.match(/^(\d+)\s*S$/);return yf?`${yf[1]}s`:Pr},fg=new Set,bh=new Map,Sv={},Ag=(Hi,Pr)=>{Hi&&(Sv[kd(Hi)]=Pr)};for(const Hi of Ir){const Pr=Hi==null?void 0:Hi.symbol,iu=Mg(Pr);if(Pr!=null&&String(Pr).trim()&&!iu.found&&iu.raw!=="__CURRENT__"){x(Qt,`request.security: unknown symbol "${String(Pr).trim()}"`),x(zt,"Validation failed");return}const hd=iu.sym,yf=String((hd==null?void 0:hd.ticker)||"").trim();if(!yf)continue;const Zd=String((hd==null?void 0:hd.country)||Ns).trim()||Ns,Et=`${yf}@${Zd}`,hs=kd(Et);fg.add(Et),Ag(Pr?String(Pr):void 0,Et);const Lo=String((Hi==null?void 0:Hi.timeframe)||"__CURRENT__").trim()||"__CURRENT__",So=Lo==="__CURRENT__"?Ec:Ng(Lo);if(!So||So==="__CURRENT__")continue;const qa=Mc(So);if(Hi!=null&&Hi.lower&&$c>0&&qa>=$c){x(Qt,`request.security_lower_tf: "${Lo}" must be lower than chart timeframe "${Ec}"`),x(zt,"Validation failed");return}const Zc=`${hs}|${So}`;bh.has(Zc)||bh.set(Zc,{sym:hd,tf:So,computeTf:Lo,lower:!!(Hi!=null&&Hi.lower),symbolKey:hs,rawSymbol:Pr?String(Pr):void 0})}if(zu.size)for(const Hi of zu){const[Pr]=String(Hi).split("@");if(Pr&&Pr!==Ps.ticker)try{T.stopSymbolPipelines(Pr)}catch{}}if(zu=fg,bh.size&&Pc>0&&fl>0)await Promise.all(Array.from(bh.values()).map(({sym:Hi,tf:Pr,lower:iu})=>{const hd=iu?8e3:3500;return T.ensureHistoryCovers(Hi,Pr,Du,_d,hd).catch(()=>null)}));else if(bh.size)for(const{sym:Hi,tf:Pr}of bh.values())try{T.startBackgroundPrefetch(Hi,{timeframe:Pr})}catch{}yh={},jh=Sv;let Cv=0,Gm="";for(const Hi of bh.values()){const Pr=T.getHistorySnapshot(Hi.sym,Hi.tf);if(Pr!=null&&Pr.error){x(Qt,`request.security: ${Hi.sym.ticker}${Hi.sym.country?`@${Hi.sym.country}`:""} (${Hi.tf}) error: ${Pr.error}`),x(zt,"Validation failed");return}const iu=Array.isArray(Pr==null?void 0:Pr.candles)?Pr.candles:[];if(!iu.length){if(!(Pr!=null&&Pr.isComplete)){Cv+=1,Gm||(Gm=`Loading request.security: ${Hi.sym.ticker}${Hi.sym.country?`@${Hi.sym.country}`:""} (${Hi.tf})… waiting for candles`);continue}x(Qt,`request.security: no data for ${Hi.sym.ticker}${Hi.sym.country?`@${Hi.sym.country}`:""} (${Hi.tf})`),x(zt,"Validation failed");return}const hd=yc((Pr==null?void 0:Pr.oldestTimestampLoaded)??0),yf=yc((Pr==null?void 0:Pr.newestTimestampLoaded)??0),Zd=Du>0&&_d>0&&hd>0&&yf>0&&hd<=Du&&yf>=_d;if(!(Du===0||_d===0||yf>=Du&&hd<=_d)){if(!(Pr!=null&&Pr.isComplete)){Cv+=1,Gm||(Gm=`Loading request.security: ${Hi.sym.ticker}${Hi.sym.country?`@${Hi.sym.country}`:""} (${Hi.tf})… waiting for overlap`);continue}x(Qt,`request.security: no overlap for ${Hi.sym.ticker}${Hi.sym.country?`@${Hi.sym.country}`:""} (${Hi.tf})`),x(zt,"Validation failed");return}if(!(Pr!=null&&Pr.isComplete)&&!Zd&&(Cv+=1,!Gm)){const Lo=hd||0,So=yf||0;Gm=`Loading request.security: ${Hi.sym.ticker}${Hi.sym.country?`@${Hi.sym.country}`:""} (${Hi.tf})… loaded ${Lo}→${So}`}const hs=`${Hi.symbolKey}|${Hi.tf}`;yh[hs]={key:hs,symbol:Hi.sym.ticker,country:Hi.sym.country,timeframe:Hi.tf,candles:iu}}if(Cv>0&&Gm){gp=Gm,x(zt,V(Gm));const Hi=jo,Pr=Date.now(),iu=25e3;try{ft&&(clearInterval(ft),ft=null)}catch{}ft=setInterval(()=>{if(jo!==Hi){try{clearInterval(ft)}catch{}ft=null;return}if(Date.now()-Pr>iu){try{clearInterval(ft)}catch{}ft=null;return}if(i(ri))return;let hd=0;for(const yf of bh.values()){const Zd=T.getHistorySnapshot(yf.sym,yf.tf);if(Zd!=null&&Zd.error)continue;const Et=yc((Zd==null?void 0:Zd.oldestTimestampLoaded)??0),hs=yc((Zd==null?void 0:Zd.newestTimestampLoaded)??0),Lo=Du>0&&_d>0&&Et>0&&hs>0&&Et<=Du&&hs>=_d;(!(Array.isArray(Zd==null?void 0:Zd.candles)&&Zd.candles.length>0)||!(Zd!=null&&Zd.isComplete)&&!Lo)&&(hd+=1)}if(hd<=0){try{clearInterval(ft)}catch{}ft=null,dr(S,j,"js",ue)}},400);return}}}const Sm=`js_${Date.now()}`;let Pp=null;try{Pp=await ul({id:Sm,code:S,base:{open:rs,high:Sn,low:Xs,close:Ni,volume:Qn,time:Fo},params:Po,mtf:Go?{baseSymbol:si,baseTimeframe:Ec,symbolAliases:jh,sources:yh}:void 0})}catch(Ql){const Ir=Ql instanceof Error?Ql.message:"JS engine failed";x(Qt,V(Ir)),x(zt,"Validation failed");return}if(!Pp||Pp.error){x(Qt,V(String((Pp==null?void 0:Pp.error)||"JS engine failed"))),x(zt,"Validation failed");return}const Dp=Array.isArray(Pp==null?void 0:Pp.diagnostics)?Pp.diagnostics:[],_p=Pp.output;if(!_p||!Array.isArray(_p.panes)||!_p.panes.length){x(Qt,"JS script produced no plots or draws"),x(zt,"Validation failed");return}je=Array.isArray(_p.panes)&&_p.panes.some(Ql=>Array.isArray(Ql==null?void 0:Ql.runtimeHeatmaps)&&Ql.runtimeHeatmaps.length),Ll();const _f={panes:_p.panes,params:j&&typeof j=="object"?{...j}:{},signals:_p.signals||[],strategy:_p.strategy||void 0};ue&&typeof ue=="object"&&(_f.strategy={..._f.strategy||{},...ue}),_f.__jsCode=S,_f.__jsParams=_f.params,_f.__jsSeriesMap=_p.seriesMap||{},ie="draw",await _e(_f,"js"),x(ho,V(I(i(ho),Dp))),x(zt,V(gp||"Plotted from JS"));return}if(In==="pine"){const Kt=Tw(S);if(Kt.ok){try{const ps=Kt.spec&&typeof Kt.spec=="object"?Kt.spec.params||{}:{},Po=j&&typeof j=="object"?{...ps,...j}:ps;Kt.spec.params=Po}catch{}const Zt=Uu(S);ze=String(((as=Kt.spec)==null?void 0:as.shortName)||((Ls=Kt.spec)==null?void 0:Ls.name)||((Ys=Kt.spec)==null?void 0:Ys.title)||"").trim()||""||Zt||void 0,ue&&typeof ue=="object"&&(Kt.spec.strategy={...Kt.spec.strategy||{},...ue}),(!Kt.spec.params||typeof Kt.spec.params!="object")&&(Kt.spec.params={}),ze&&(Kt.spec.params.__scriptId=ze),ie="normalize";const rs=Ge(S);if(rs){x(Qt,`Negative history index not allowed: ${rs.snippet} (line ${rs.line})`),x(zt,"Validation failed");return}const Sn=(Kt.warnings||[]).find(ps=>String((ps==null?void 0:ps.message)||"").includes('":=" used before'));if(Sn){const ps=typeof Sn.line=="number"?` (line ${Sn.line})`:"";x(Qt,`${String(Sn.message||'":=" used before declaration')}${ps}`),x(zt,"Validation failed");return}if(sr(S)){x(Qt,"Ternary branches must both be numeric or both non-numeric"),x(zt,"Validation failed");return}const Ni=Rt(S);if(Ni){x(Qt,V(Ni.message)),x(zt,"Validation failed");return}const Qn=Es(S);if(Qn){x(Qt,V(Qn.message)),x(zt,"Validation failed");return}const Fo=q_(Kt.spec);if(Fo.ok&&Fo.spec)ie="draw",await _e(Fo.spec,"pine"),x(zt,"Plotted from Pine");else{const ps=(Fo.errors||[]).join("; ");x(Qt,V(ps?`Schema validation failed: ${ps}`:"Schema validation failed")),x(zt,"Validation failed");return}}else x(Qt,V((Kt.errors||[]).slice(0,6).map(Zt=>`Line ${Zt.line}: ${Zt.message}`).join(" • "))),x(zt,"Validation failed");return}if(In==="dsl"){const Kt=t3(S),Zt={calc:[],series:Kt.series,panes:Kt.panes,signals:Kt.signals,params:j&&typeof j=="object"?{...Kt.params,...j}:Kt.params};ze=String(Zt.shortName||Zt.name||Zt.title||"").trim()||void 0,ue&&typeof ue=="object"&&(Zt.strategy={...Zt.strategy||{},...ue}),ie="draw",await _e(Zt,"dsl"),x(zt,"Plotted from DSL");return}if(Hs)try{Hn=JSON.parse(bn)}catch(Kt){const Zt=String((Kt==null?void 0:Kt.message)||"Invalid JSON");x(Qt,`Invalid JSON: ${Zt}`),x(zt,"Validation failed");return}else try{Hn=JSON.parse(bn)}catch{}if(jn(Hn))try{const Kt=Hn&&typeof Hn=="object"?Hn.params||{}:{},Zt=Mw(Hn,Kt);let an=Zt;try{an=Aw(Zt)}catch(Sn){const Xs=Sn instanceof Error?Sn.message:String(Sn);x(Qt,`Template expansion error: ${Xs}`),x(zt,"Validation failed");return}ze=String(an&&(an.shortName||an.name||an.title)||"").trim()||void 0,ie="normalize";const rs=q_(an);if(rs.ok&&rs.spec)ue&&typeof ue=="object"&&(an.strategy={...an.strategy||{},...ue}),ie="draw",await _e(an,"json");else{const Sn=(rs.errors||[]).join("; ");x(Qt,V(Sn?`Schema validation failed: ${Sn}`:"Schema validation failed")),x(zt,"Validation failed");return}}catch(Kt){const Zt=Kt instanceof Error?Kt.message:String(Kt);x(Qt,`Schema validation error: ${Zt}`),x(zt,"Validation failed");return}else try{const Kt=Tw(S);if(Kt.ok){try{const Po=Kt.spec&&typeof Kt.spec=="object"?Kt.spec.params||{}:{},Go=j&&typeof j=="object"?{...Po,...j}:Po;Kt.spec.params=Go}catch{}ue&&typeof ue=="object"&&(Kt.spec.strategy={...Kt.spec.strategy||{},...ue}),ie="normalize";const rs=Ge(S);if(rs){x(Qt,`Negative history index not allowed: ${rs.snippet} (line ${rs.line})`),x(zt,"Validation failed");return}const Sn=(Kt.warnings||[]).find(Po=>String((Po==null?void 0:Po.message)||"").includes('":=" used before'));if(Sn){const Po=typeof Sn.line=="number"?` (line ${Sn.line})`:"";x(Qt,`${String(Sn.message||'":=" used before declaration')}${Po}`),x(zt,"Validation failed");return}if(sr(S)){x(Qt,"Ternary branches must both be numeric or both non-numeric"),x(zt,"Validation failed");return}const Ni=Rt(S);if(Ni){x(Qt,V(Ni.message)),x(zt,"Validation failed");return}const Qn=Es(S);if(Qn){x(Qt,V(Qn.message)),x(zt,"Validation failed");return}const Fo=q_(Kt.spec);if(Fo.ok&&Fo.spec){ie="draw",await _e(Fo.spec,"pine"),x(zt,"Plotted from Pine");return}const ps=(Fo.errors||[]).join("; ");x(Qt,V(ps?`Schema validation failed: ${ps}`:"Schema validation failed")),x(zt,"Validation failed");return}else{const rs=(Kt.errors||[]).filter(Sn=>String((Sn==null?void 0:Sn.message)||"")!=="Not a Pine script");if(rs.length){x(Qt,V(rs.slice(0,6).map(Sn=>`Line ${Sn.line}: ${Sn.message}`).join(" • "))),x(zt,"Validation failed");return}}const Zt=t3(S),an={calc:[],series:Zt.series,panes:Zt.panes,signals:Zt.signals,params:j&&typeof j=="object"?{...Zt.params,...j}:Zt.params};ze=String(an.shortName||an.name||an.title||"").trim()||void 0,ue&&typeof ue=="object"&&(an.strategy={...an.strategy||{},...ue}),ie="draw",await _e(an,"dsl"),x(zt,"Plotted from DSL")}catch{const Zt=uu(S),an=o();if(!an)throw new Error("Chart not ready yet. Please try again in a moment.");K(an);const rs=`${Gc}_${Date.now()}`,Sn=ud(Zt,rs);try{Z2(Sn)}catch(Go){console.debug("Script indicator register error",Go)}const Xs=i(ou)==="main"?"candle_pane":"pane_script",Ni=i(ou)==="main";let Qn=an.createIndicator(Sn.name,Ni,{id:Xs,axis:i(ou)==="sub"?{gap:{top:2,bottom:2}}:void 0});if(Qn||(Qn=an.createIndicator(Sn,Ni,{id:Xs,axis:i(ou)==="sub"?{gap:{top:2,bottom:2}}:void 0})),!Qn)throw new Error("Unable to render script indicator.");Pu.push(Qn),wc.push(Sn.name),x(cc,V(Sn.name));const Fo=((Pn=Sn.calc)==null?void 0:Pn.call(Sn,((Vt=(yn=o())==null?void 0:yn.getDataList)==null?void 0:Vt.call(yn))||[],{calcParams:[Zt.window]}))||[],ps=Fo.filter(Go=>Go==null?void 0:Go.topSignal).length,Po=Fo.filter(Go=>Go==null?void 0:Go.botSignal).length;x(zt,`Plotted (WIN=${Zt.window}) • ▲ ${ps} / ▼ ${Po}`)}}catch(Hn){const Tn=Hn instanceof Error?Hn.message:"Script failed to run.";x(Qt,V(Tn)),x(zt,null);try{K(o())}catch{}rJ({scriptId:ze,format:De,stage:ie,message:Tn,stack:Hn instanceof Error?Hn.stack:void 0}),console.error("[ScriptStudio] run failed",Hn)}finally{x(ri,!1)}ge==null||ge.restore()}function Fu(){const S=o();try{K(S)}catch{}try{va()}catch{}try{Vl()}catch{}try{S==null||S.removeOverlay({groupId:"runtime"})}catch{}try{S==null||S.removeOverlay({name:"script-layer"})}catch{}Ue=[];try{ft&&(clearInterval(ft),ft=null)}catch{}try{ge&&le&&ge.clearRect(0,0,le.width,le.height)}catch{}try{Sc()}catch{}je=!1;try{Ll()}catch{}try{Kse()}catch{}try{goe()}catch{}x(zt,"Reset"),x(Qt,null),x(ri,!1),x(cc,null),Aa=null,ar=""}function gi(){typeof requestAnimationFrame>"u"||requestAnimationFrame(()=>{gl.requestKey("dock:resize",()=>{var Q,ue;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=up(s().theme);wn.merge(S,p0(s().styles)),o().setStyles(qd(S)),Oi();const j=(ue=(Q=o()).getVisibleRange)==null?void 0:ue.call(Q);j&&typeof j.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(j.to,0)},30)})})}function Dr(){x(Yt,!0),gi()}function Yi(){x(Yt,!1),x(qn,!1),gi()}const Ki=()=>{window.removeEventListener("mousemove",ca),window.removeEventListener("touchmove",ca),window.removeEventListener("mouseup",Jt),window.removeEventListener("touchend",Jt)};function Xi(S){if(!i(Yt))return;const j="touches"in S?S.touches[0]:S,{clientY:Q}=j;Qs=Q,Is=i(Dn),x(gn,!0),window.addEventListener("mousemove",ca),window.addEventListener("touchmove",ca,{passive:!1}),window.addEventListener("mouseup",Jt),window.addEventListener("touchend",Jt),S.preventDefault()}function ca(S){var ze;if(!i(gn))return;const j="touches"in S?S.touches[0]:S,Q=(ze=i(mt))==null?void 0:ze.getBoundingClientRect();if(!Q)return;const ue=Qs-j.clientY,ie=Is*Q.height+ue,De=Math.min(pn,Math.max(Wn,ie/Q.height));x(Dn,V(De)),gi(),S.preventDefault()}function Jt(){i(gn)&&(x(gn,!1),Ki(),gi(),setTimeout(()=>{gl.requestKey("dock:resize-final",()=>{var Q,ue;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const S=up(s().theme);wn.merge(S,p0(s().styles)),o().setStyles(qd(S)),Oi();const j=(ue=(Q=o()).getVisibleRange)==null?void 0:ue.call(Q);j&&typeof j.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(j.to,0)},30)})},140))}b0(()=>{if(Ki(),ft){try{clearInterval(ft)}catch{}ft=null}ae&&(ae.destroy(),ae=null,ce&&(ce.destroy(),ce=null))});function rn(S){if(!S)return"";if(Array.isArray(S.colors)&&S.colors.length>0){const j=S.angle||S.direction||0,Q=S.colors.map(ue=>`${ue.color} ${ue.position}%`).join(", ");return`linear-gradient(${j}deg, ${Q})`}if(Array.isArray(S.stops)&&S.stops.length>0){const j=S.type==="radial"?"radial":"linear",Q=S.direction??S.angle??0,ie=[...S.stops].sort((De,ze)=>(De.position??0)-(ze.position??0)).map(De=>{const ze=(De.color||"").trim(),lt=De.position??0,wt=(De.opacity??100)/100;if(ze.startsWith("#")){const qt=parseInt(ze.slice(1,3),16),sn=parseInt(ze.slice(3,5),16),Ot=parseInt(ze.slice(5,7),16);return`rgba(${qt}, ${sn}, ${Ot}, ${wt}) ${lt}%`}if(ze.startsWith("rgb(")||ze.startsWith("rgba(")){const qt=ze.match(/rgba?\(([^)]+)\)/i);if(qt){const sn=qt[1].split(",").map(as=>as.trim()),[Ot,vn,kn]=sn;return`rgba(${Ot}, ${vn}, ${kn}, ${wt}) ${lt}%`}}return`${ze} ${lt}%`});return j==="radial"?`radial-gradient(circle, ${ie.join(", ")})`:`linear-gradient(${Q}deg, ${ie.join(", ")})`}return""}function dn(S){return Math.max(0,Math.min(1,S))}function uo(S){const j=(S||"").trim();if(!j)return null;if(/^#([0-9a-fA-F]{6})$/.test(j)){const ue=j.slice(1);return{r:parseInt(ue.slice(0,2),16),g:parseInt(ue.slice(2,4),16),b:parseInt(ue.slice(4,6),16),a:1}}if(/^#([0-9a-fA-F]{3})$/.test(j)){const ue=j.slice(1);return{r:parseInt(ue[0]+ue[0],16),g:parseInt(ue[1]+ue[1],16),b:parseInt(ue[2]+ue[2],16),a:1}}const Q=j.match(/^rgba?\(([^)]+)\)$/i);if(Q){const ue=Q[1].split(",").map(ie=>ie.trim());if(ue.length>=3){const ie=Number(ue[0]),De=Number(ue[1]),ze=Number(ue[2]);if(Number.isFinite(ie)&&Number.isFinite(De)&&Number.isFinite(ze)){const lt=ue.length>=4&&Number.isFinite(Number(ue[3]))?dn(Number(ue[3])):1;return{r:ie,g:De,b:ze,a:lt}}}}return null}function zs(S){if(!S)return 1;if(typeof S.opacity=="number")return dn(S.opacity/100);if(typeof S.alpha=="number"){const j=S.alpha;return dn(j>1?j/100:j)}return 1}function Hr(S,j,Q){const ue=Math.max(0,Math.min(255,Math.round(S))).toString(16).padStart(2,"0"),ie=Math.max(0,Math.min(255,Math.round(j))).toString(16).padStart(2,"0"),De=Math.max(0,Math.min(255,Math.round(Q))).toString(16).padStart(2,"0");return`#${ue}${ie}${De}`}function Ul(S){if(!S||!Array.isArray(S.stops)||!S.stops.length)return"";const j=[...S.stops].sort((kn,as)=>(kn.position??kn.offset??0)-(as.position??as.offset??0)),Q=j[0],ue=j[j.length-1],ie=((Q==null?void 0:Q.color)||"").trim(),De=((ue==null?void 0:ue.color)||"").trim(),ze=uo(ie),lt=uo(De);if(!ze&&!lt)return De||ie||"";if(!ze)return De||"";if(!lt)return ie||"";const wt=.5,qt=Math.round(ze.r*(1-wt)+lt.r*wt),sn=Math.round(ze.g*(1-wt)+lt.g*wt),Ot=Math.round(ze.b*(1-wt)+lt.b*wt),vn=zs(Q)*ze.a*(1-wt)+zs(ue)*lt.a*wt;return vn<1?`rgba(${qt}, ${sn}, ${Ot}, ${dn(vn)})`:Hr(qt,sn,Ot)}function Oi(){var S,j,Q,ue,ie,De,ze,lt,wt,qt,sn,Ot;if(!Wo){ia=!0;try{const vn=s().styles;if(!vn)return;const kn=up(s().theme),as=wn.get(kn,"pane.backgroundColor")||(s().theme==="dark"?"#0A0F1A":"#ffffff"),Ls=s().theme==="dark"?"#ffffff":"#0A0F1A",Ys=vn.backgroundType||"solid",yn=document.querySelector(".duty-main"),Vt=document.querySelector(".duty-widget");let Pn="";const Hn=Ys==="gradient"&&!!vn.backgroundGradient;if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!Hn){const Hs=Xt=>{if(!Xt)return"";const jn=Xt,Kt=(window.getComputedStyle(jn).getPropertyValue("--chart-background-color")||"").trim(),Zt=(jn.style.background||jn.style.backgroundColor||"").trim();return Kt||Zt||""};Pn=Hs(yn)||Hs(Vt)}if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!Hn&&Pn)[yn,Vt].forEach(Hs=>{Hs&&(Hs.style.background=Pn,Hs.style.backgroundColor=Pn,Hs.style.setProperty("--chart-background-color",Pn))}),m("🎨 Preserved live preview background:",Pn);else if(Ys==="solid"){let Hs=vn.backgroundColor||as;const Xt=(vn.backgroundOpacity??100)/100,jn=typeof vn.backgroundColor=="string"&&vn.backgroundColor.trim().toLowerCase()===Ls.toLowerCase(),Jn=!!vn.backgroundType||!!vn.backgroundGradient||typeof vn.backgroundOpacity=="number";jn&&!Jn&&(Hs=as);let Kt=Hs;if(Xt!==1&&Hs.startsWith("#")){const Zt=parseInt(Hs.slice(1,3),16),an=parseInt(Hs.slice(3,5),16),rs=parseInt(Hs.slice(5,7),16);Kt=`rgba(${Zt}, ${an}, ${rs}, ${Xt})`}[yn,Vt].forEach(Zt=>{Zt&&(Zt.style.background=Kt,Zt.style.backgroundColor=Kt,Zt.style.setProperty("--chart-background-color",Kt))}),m("🎨 Applied saved background color:",Kt)}else if(Ys==="gradient"&&vn.backgroundGradient){const Hs=vn.backgroundGradient,Xt=Hs.css||rn(Hs);[yn,Vt].forEach(jn=>{jn&&(jn.style.background=Xt,jn.style.backgroundColor=Xt,jn.style.setProperty("--chart-background-color",Xt))}),m("🎨 Applied saved gradient background:",Xt)}const Tn=vn.gridType||"solid",bn=wn.get(kn,"grid.horizontal.color")||(s().theme==="dark"?"#111B2B":"#F3F3F3"),In=s().theme==="dark"?"#F3F3F3":"#111B2B";if(o()&&Tn==="solid"){const Hs=((j=(S=o()).getStyles)==null?void 0:j.call(S))??{},Xt=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:wn.get(Hs,"grid.horizontal.color")||wn.get(Hs,"grid.vertical.color"),jn=((ue=(Q=vn.grid)==null?void 0:Q.horizontal)==null?void 0:ue.color)||((De=(ie=vn.grid)==null?void 0:ie.vertical)==null?void 0:De.color),Jn=typeof vn.gridOpacity=="number"?vn.gridOpacity:100,Kt=Math.max(0,Math.min(100,Jn))/100;let Zt=Xt||jn||bn;const an=!Xt&&typeof jn=="string"&&jn.trim().toLowerCase()===In.toLowerCase(),rs=!!vn.gridType||!!vn.gridGradient||typeof vn.gridOpacity=="number";if(an&&!rs&&(Zt=bn),!Xt&&typeof Zt=="string"&&Zt.startsWith("#")&&Kt!==1){const Xs=parseInt(Zt.slice(1,3),16),Ni=parseInt(Zt.slice(3,5),16),Qn=parseInt(Zt.slice(5,7),16);Zt=`rgba(${Xs}, ${Ni}, ${Qn}, ${Kt})`}const Sn=wn.cloneDeep(Hs);wn.set(Sn,"grid.horizontal.color",Zt),wn.set(Sn,"grid.vertical.color",Zt),(lt=(ze=s().styles)==null?void 0:ze.candle)!=null&&lt.type&&wn.set(Sn,"candle.type",s().styles.candle.type),_l?_l(qd(Sn)):o().setStyles(qd(Sn)),m("🎨 Applied grid color (preserving preview when available):",Zt)}else if(o()&&Tn==="gradient"&&vn.gridGradient){const Hs=((qt=(wt=o()).getStyles)==null?void 0:qt.call(wt))??{},Xt=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:wn.get(Hs,"grid.horizontal.color")||wn.get(Hs,"grid.vertical.color"),jn=vn.gridGradient,Jn=Ul(jn),Kt=Xt||Jn||bn,Zt=wn.cloneDeep(Hs);wn.set(Zt,"grid.horizontal.color",Kt),wn.set(Zt,"grid.vertical.color",Kt),(Ot=(sn=s().styles)==null?void 0:sn.candle)!=null&&Ot.type&&wn.set(Zt,"candle.type",s().styles.candle.type),_l?_l(qd(Zt)):o().setStyles(qd(Zt)),m("🎨 Applied gradient grid (solid fallback):",Kt)}}catch(vn){console.error("Error applying canvas colors:",vn)}finally{ia=!1,window.__forceApplyThemeDefaults&&(window.__forceApplyThemeDefaults=!1),window.__forceApplySavedCanvasColors&&(window.__forceApplySavedCanvasColors=!1)}}}Fc(O(),Ao(a).applyCanvasColors=Oi,Ao(a)),vc.setApplyCanvasColorsFunction(Oi),za.setApplyCanvasColorsFunction(Oi);const Nd=S=>S?!(S.__alwaysOnTop||S.__forceOnTop||S.alwaysOnTop):!0,hr=(S,j)=>{var ue;if(!(S!=null&&S.getIndicators)||!(S!=null&&S.overrideIndicator))return;const Q=S.getIndicators(j??{})||[];if(!(!Array.isArray(Q)||!Q.length))for(const ie of Q){if(!ie||!Nd(ie))continue;const De=ie.paneId??(j==null?void 0:j.paneId)??"candle_pane";if((typeof ie.zLevel=="number"?ie.zLevel:0)===g)continue;const lt={paneId:De,zLevel:g};ie.id?lt.id=ie.id:ie.name&&(lt.name=ie.name),(ue=S.overrideIndicator)==null||ue.call(S,lt)}};let vr=null,_l=null,ia=!1,Zl=null;wr(()=>{var S;if(o()&&o()!==vr){vr=o(),_l=o().setStyles.bind(o());const j=o().resize.bind(o());Zl=((S=o().createIndicator)==null?void 0:S.bind(o()))??null,Fc(Te,Ao(o).setStyles=function(Q){const ue=_l(Q);return ia||gl.requestKey("canvas:reapply",()=>Oi()),ue},Ao(o)),Fc(Te,Ao(o).resize=function(){const Q=j();return gl.requestKey("canvas:reapply",()=>Oi()),Q},Ao(o)),Zl&&Fc(Te,Ao(o).createIndicator=function(Q,ue,ie){var qt,sn,Ot,vn;const De=this;md(De);let ze=[];try{const kn=(qt=De.getPaneOptions)==null?void 0:qt.call(De);Array.isArray(kn)&&(ze=kn)}catch{}const lt=Zl(Q,ue,ie);if(lt)try{hr(De,{id:lt})}catch{}let wt=[];try{const kn=(sn=De.getPaneOptions)==null?void 0:sn.call(De);Array.isArray(kn)&&(wt=kn)}catch{return lt}try{const kn=new Set(ze.map(Tn=>Tn==null?void 0:Tn.id).filter(Boolean)),as=Tn=>(Tn==null?void 0:Tn.id)&&Tn.id!=="candle_pane"&&Tn.id!=="x_axis_pane",Ls=ze.filter(as),Ys=wt.filter(as),yn=Ys.filter(Tn=>(Tn==null?void 0:Tn.id)&&!kn.has(Tn.id));if(yn.length===0)return lt;const Vt=Xd(De),Pn=xu(De);let Hn=0;if(Ls.length===0){const Tn=Pn||(typeof((Ot=yn[0])==null?void 0:Ot.height)=="number"?yn[0].height:0);Hn=vo(Tn,Vt)}else{const Tn=((vn=Ls.find(bn=>typeof bn.height=="number"&&bn.height>0))==null?void 0:vn.height)||Pn;Hn=vo(Tn*.8,Vt)}if(Hn>0){const Tn=Ys.map(bn=>bn==null?void 0:bn.id).filter(Boolean);go(De,Tn,Hn)}}catch{}return lt},Ao(o));try{hr(o())}catch{}}});let Bo=`${((Vv=s().period)==null?void 0:Vv.timespan)||""}_${((ug=s().period)==null?void 0:ug.multiplier)||""}`;wr(()=>{const S=s().period;if(!o()||!S||!S.timespan)return;const Q={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[S.timespan]??"day",ue=Number(S.multiplier)||1,ie=`${Q}_${ue}`;if(ie!==Bo){Bo=ie;try{o().setPeriod({type:Q,span:ue});const De=up(s().theme);wn.merge(De,p0(s().styles)),o().setStyles(qd(De))}catch{}}}),Yc().then(()=>{m("📊 allSymbols length:",s().allSymbols.length)}).catch(S=>{console.error("❌ loadSymbols failed:",S)}),Mh(async()=>{var qt,sn,Ot,vn,kn,as,Ls,Ys,yn,Vt,Pn,Hn,Tn,bn,In,Hs;if(!J){console.error("❌ chartRef is not available");return}rg||(rg=()=>{if(!ev("interactionV2"))return;const{endedId:Xt}=yw();Xt&&(x(Rm,""),x(Nh,"")),Xt&&bu()},window.addEventListener("mouseup",rg)),sp||(sp=()=>{if(!ev("interactionV2"))return;const{endedId:Xt}=yw();Xt&&(x(Rm,""),x(Nh,"")),Xt&&bu()},window.addEventListener("touchend",sp)),!Ev&&J&&(Ev=Xt=>{if(!ev("interactionV2")||Xt.button!==0)return;const jn=_u(Xt),Jn=!!(jn&&(jn.selectedId||jn.draggingId||jn.resizingId));Xt.__interactionV2Handled=Jn,Jn&&(Xt.preventDefault(),Xt.stopPropagation(),Xt.stopImmediatePropagation())},J.addEventListener("mousedown",Ev,{capture:!0})),!lh&&J&&(lh=Xt=>{Xt.preventDefault(),Xt.stopPropagation(),Xt.stopImmediatePropagation(),dp(Xt)},J.addEventListener("contextmenu",lh,{capture:!0})),!ch&&J&&(ch=Xt=>{Xt.preventDefault(),Xt.stopPropagation(),Xt.stopImmediatePropagation(),Jr(Xt)},J.addEventListener("dblclick",ch,{capture:!0})),!ig&&J&&(ig=Xt=>{Xt.button!==2||!(typeof window<"u"&&window.__overlayHover)||(Xt.preventDefault(),Xt.stopPropagation(),Xt.stopImmediatePropagation())},J.addEventListener("mousedown",ig,{capture:!0})),bv||(bv=Xt=>{if(!ev("interactionV2")||!i(Rm)&&!i(Nh)||J&&Xt.target instanceof Node&&J.contains(Xt.target))return;const jn=J==null?void 0:J.getBoundingClientRect();if(!jn)return;const Jn=Xt.clientX-jn.left,Kt=Xt.clientY-jn.top,Zt=Gk(Xt),{hoverId:an,draggingId:rs,resizingId:Sn,cursor:Xs}=Jk(Jn,Kt,Lv,Zt);x(vf,V(an??"")),x(Rm,V(rs??"")),x(Nh,V(Sn??"")),bu(Xs),Pl(),Xt.preventDefault(),Xt.stopPropagation(),Xt.stopImmediatePropagation()},window.addEventListener("mousemove",bv)),!Sg&&J&&(Sg=Xt=>{if(!ev("interactionV2")||!i(Dm))return;const jn=Xt.key;jn!=="Escape"&&jn!=="Delete"&&jn!=="Backspace"&&!(jn==="ArrowLeft"||jn==="ArrowRight"||jn==="ArrowUp"||jn==="ArrowDown")||ba(Xt)},J.addEventListener("keydown",Sg,{capture:!0}));try{let Xt=!1;typeof window<"u"&&(Xt=!!localStorage.getItem("chart.activeSaveId")),Xt&&Wa.set(!0)}catch{}(sn=(qt=s().styles)==null?void 0:qt.candle)!=null&&sn.type||D().update(Xt=>(Xt.styles=Xt.styles||{},Xt.styles.candle=Xt.styles.candle||{},Xt.styles.candle.type="candle_solid",Xt.styles.candle.renko||(Xt.styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),Xt));const S=up(s().theme),j=wn.merge({},S,s().styles);if(m("🎨 onMount - Theme styles:",JSON.stringify(S,null,2)),m("💾 onMount - Saved styles:",JSON.stringify(s().styles,null,2)),m("🔄 onMount - Merged styles:",JSON.stringify(j,null,2)),s3(Te,V(Y7(J,{styles:(()=>{var Xt,jn,Jn,Kt,Zt,an,rs,Sn,Xs,Ni,Qn,Fo,ps,Po,Go,Ps,Ns,si,Ec,yc,Pc,rc,Mc,$c;try{if((jn=(Xt=j==null?void 0:j.candle)==null?void 0:Xt.tooltip)!=null&&jn.legend){const bl=j.candle.tooltip.legend.color;j.candle.tooltip.legend.template=({current:fl,prev:$u},sd)=>{var Pp,Dp;const Bl=(sd==null?void 0:sd.bar)||{},Sp=((Dp=(Pp=sd==null?void 0:sd.tooltip)==null?void 0:Pp.legend)==null?void 0:Dp.color)??bl,Xc=(fl==null?void 0:fl.open)??0,xl=(fl==null?void 0:fl.close)??0,_d=(Bl.compareRule||"current_open")==="current_open"?Xc:($u==null?void 0:$u.close)??xl,jh=Xc===xl||xl>=_d?Bl.upBorderColor||Sp:Bl.downBorderColor||Sp,gp=_p=>({text:_p,color:jh});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:gp("{open}")},{title:"H",value:gp("{high}")},{title:"L",value:gp("{low}")},{title:"C",value:gp("{close}")},{title:"V",value:gp("{volume}")}]:[{title:"O",value:gp("{open}")},{title:"H",value:gp("{high}")},{title:"L",value:gp("{low}")},{title:"C",value:gp("{close}")},{title:"V",value:gp("{volume}")}]}}}catch{}try{const bl=(Zt=(Kt=(Jn=S==null?void 0:S.xAxis)==null?void 0:Jn.tickText)==null?void 0:Kt.style)==null?void 0:Zt.color,fl=(Sn=(rs=(an=S==null?void 0:S.yAxis)==null?void 0:an.tickText)==null?void 0:rs.style)==null?void 0:Sn.color;if(bl&&((Ni=(Xs=j==null?void 0:j.xAxis)==null?void 0:Xs.tickText)!=null&&Ni.style)&&(j.xAxis.tickText.style.color=bl,(Qn=j==null?void 0:j.xAxis)!=null&&Qn.tickText)){delete j.xAxis.tickText.color,delete j.xAxis.tickText.opacity,j.xAxis.tickText.color=bl;try{D().update(Bl=>(Bl.styles||(Bl.styles={}),wn.unset(Bl.styles,"xAxis.tickText.color"),wn.unset(Bl.styles,"xAxis.tickText.opacity"),wn.set(Bl.styles,"xAxis.tickText.style.color",bl),Bl))}catch{}}if(fl&&((ps=(Fo=j==null?void 0:j.yAxis)==null?void 0:Fo.tickText)!=null&&ps.style)&&(j.yAxis.tickText.style.color=fl,(Po=j==null?void 0:j.yAxis)!=null&&Po.tickText)){delete j.yAxis.tickText.color,delete j.yAxis.tickText.opacity,j.yAxis.tickText.color=fl;try{D().update(Bl=>(Bl.styles||(Bl.styles={}),wn.unset(Bl.styles,"yAxis.tickText.color"),wn.unset(Bl.styles,"yAxis.tickText.opacity"),wn.set(Bl.styles,"yAxis.tickText.style.color",fl),Bl))}catch{}}const $u=(Ns=(Ps=(Go=S==null?void 0:S.candle)==null?void 0:Go.tooltip)==null?void 0:Ps.legend)==null?void 0:Ns.color,sd=(yc=(Ec=(si=S==null?void 0:S.indicator)==null?void 0:si.tooltip)==null?void 0:Ec.legend)==null?void 0:yc.color;if($u&&((rc=(Pc=j==null?void 0:j.candle)==null?void 0:Pc.tooltip)!=null&&rc.legend)){j.candle.tooltip.legend.color=$u;try{D().update(Bl=>(Bl.styles||(Bl.styles={}),wn.set(Bl.styles,"candle.tooltip.legend.color",$u),Bl))}catch{}}if(sd&&(($c=(Mc=j==null?void 0:j.indicator)==null?void 0:Mc.tooltip)!=null&&$c.legend)){j.indicator.tooltip.legend.color=sd;try{D().update(Bl=>(Bl.styles||(Bl.styles={}),wn.set(Bl.styles,"indicator.tooltip.legend.color",sd),Bl))}catch{}}}catch{}try{const bl=j.crosshair??{},fl=bl.vertical??{},$u=fl.text??{};j.crosshair={...bl,show:bl.show??!0},j.crosshair.vertical={...fl,show:fl.show??!0},j.crosshair.vertical.text={...$u,show:!0}}catch{}return qd(j)})(),decimalFold:{threshold:999,format:P},formatter:{formatDate:({timestamp:Xt,template:jn,type:Jn})=>ik(s().period.timespan)(Xt,jn,Jn)}}))),o()){const Xt=Kt=>(Kt||"").toUpperCase(),jn=Kt=>{var rs,Sn;const Zt=(Sn=(rs=s().allSymbols)==null?void 0:rs.find)==null?void 0:Sn.call(rs,Xs=>Xt(Xs.ticker)===Xt(Kt));return Zt!=null&&Zt.name?Zt.name:{GP:"Grameen Phone",DSEBD:"DSE Board Index",DSEX:"Dhaka Stock Exchange"}[Xt(Kt)]||""},Jn={...s().symbol,ticker:s().symbol.ticker,name:s().symbol.name||jn(s().symbol.ticker)||s().symbol.ticker,pricePrecision:$_(s().symbol),volumePrecision:s().symbol.volumePrecision};o().setSymbol(Jn);try{const Kt=s().period;if(Kt!=null&&Kt.timespan&&(Kt!=null&&Kt.multiplier)){const an={second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month",year:"year",s:"second",m:"minute",h:"hour",d:"day",w:"week"}[Kt.timespan]??"day",rs=Number(Kt.multiplier)||1;o().setPeriod({type:an,span:rs})}}catch{}}if(Ll(),o()){const Xt=jn=>{var Sn,Xs,Ni,Qn;const Jn=typeof jn=="object"&&jn&&"paneId"in jn?jn.paneId:void 0;if(!Jn)return;const Kt=Jn.startsWith("pane_script")||Ue.some(Fo=>Fo.paneId===Jn),Zt=Kt?eu(Jn):null,an=(Xs=(Sn=Zt==null?void 0:Zt.axis)==null?void 0:Sn.getRange)==null?void 0:Xs.call(Sn),rs=(Qn=(Ni=Zt==null?void 0:Zt.axis)==null?void 0:Ni.getAutoCalcTickFlag)==null?void 0:Qn.call(Ni);xo.has(Jn)&&qf(Jn),Kt&&requestAnimationFrame(()=>{var Fo,ps,Po,Go,Ps,Ns;Zt!=null&&Zt.axis&&an&&Kt&&((ps=(Fo=Zt.axis).setRange)==null||ps.call(Fo,an),(Go=(Po=Zt.axis).buildTicks)==null||Go.call(Po,!0),rs&&((Ns=(Ps=Zt.axis).setAutoCalcTickFlag)==null||Ns.call(Ps,!0)))})};(vn=(Ot=o()).subscribeAction)==null||vn.call(Ot,Zg.OnPaneDrag,Xt),ql=()=>{var jn,Jn;return(Jn=(jn=o())==null?void 0:jn.unsubscribeAction)==null?void 0:Jn.call(jn,Zg.OnPaneDrag,Xt)}}try{const Xt=(as=(kn=s().styles)==null?void 0:kn.candle)==null?void 0:as.type;o()&&(Xt==="renko_atr"||Xt==="point_and_figure"||Xt==="heikin_ashi")&&vc.switchChartType({chart:o(),newType:Xt,reloadDataFn:async()=>{await oc()}})}catch{}if(o()){const Xt=new OZ(o()),jn=new VZ(o()),Jn=new WZ(o());Oc=Xt,Va=Jn;const Kt=L8(o());KZ(Kt),jn.setProjectionManager(Xt),jn.setCreationManager(Jn),jn.initialize(),sl=CB({chart:o(),persistenceKey:s().key+"_drawings",onDrawingCreated:an=>{m("✅ Drawing created:",an.id,"for symbol:",an.symbolKey)},onDrawingRemoved:(an,rs)=>{},onSymbolChanged:(an,rs)=>{}});const Zt=D0(s().symbol);sl.setCurrentSymbol(Zt),Jn.setCurrentSymbolKey(Zt),typeof window<"u"&&(window.overlayCreationManager=Jn)}Fc(O(),Ao(a).cloudIndLoaded+=1,Ao(a)),n5.set(s().symbol),xw.set(s().period),await Yc();try{window.__datafeed=T,window.__pipelineMetrics=()=>{var Xt;return(Xt=T.getPipelineMetrics)==null?void 0:Xt.call(T)}}catch{}window.addEventListener("resize",Fl);let Q=o();try{la=new ResizeObserver(()=>{Fl()}),J&&la.observe(J),i(mt)&&la.observe(i(mt)),i(ct)&&la.observe(i(ct))}catch{}const ue=()=>{ur||Ue.length&&(ur=!0,gl.requestKey("script-view:redraw",()=>{var Xt;ur=!1;try{(Xt=o())==null||Xt.updatePane(ix.Drawer)}catch{}try{Pd()}catch{}}))},ie=()=>{o()&&gl.requestKey("chart:redraw",()=>{try{o().updatePane(ix.All)}catch{}})},De=()=>{ue(),Wu(),ie()},ze=()=>{ue(),Wu(),ie()},lt=Xt=>{var rs,Sn;const jn=!Xt||Xt&&Xt.x==null&&Xt.y==null;if(!jn&&Xt&&typeof Xt.x=="number"&&typeof Xt.y=="number"&&(x(ov,V(Xt.x)),x($m,V(Xt.y)),We.length&&ol()),!jn||!J)return;const Jn=J.getBoundingClientRect();if(!(i(og)>=Jn.left&&i(og)<=Jn.right&&i(sm)>=Jn.top&&i(sm)<=Jn.bottom))return;const Zt=i(og)-Jn.left,an=i(sm)-Jn.top;try{(Sn=(rs=o())==null?void 0:rs.getChartStore)==null||Sn.call(rs).setCrosshair({x:Zt,y:an,paneId:"candle_pane"},{forceInvalidate:!0})}catch{}};if(o()&&((Ys=(Ls=o()).subscribeAction)==null||Ys.call(Ls,Zg.OnZoom,De),(Vt=(yn=o()).subscribeAction)==null||Vt.call(yn,Zg.OnScroll,ze),(Hn=(Pn=o()).subscribeAction)==null||Hn.call(Pn,Zg.OnCrosshairChange,lt),kc=()=>{var Xt,jn;return(jn=(Xt=o())==null?void 0:Xt.unsubscribeAction)==null?void 0:jn.call(Xt,Zg.OnZoom,De)},uc=()=>{var Xt,jn;return(jn=(Xt=o())==null?void 0:Xt.unsubscribeAction)==null?void 0:jn.call(Xt,Zg.OnScroll,ze)},Tl=()=>{var Xt,jn;return(jn=(Xt=o())==null?void 0:Xt.unsubscribeAction)==null?void 0:jn.call(Xt,Zg.OnCrosshairChange,lt)}),setTimeout(()=>{var Xt,jn;if(Q)try{const Jn=((Xt=Q.getDataList)==null?void 0:Xt.call(Q))??[];Array.isArray(Jn)&&Jn.length>0&&x(st,!0);const Kt=(jn=Q.getVisibleRange)==null?void 0:jn.call(Q);(Array.isArray(Jn)&&Jn.length>0&&Kt&&typeof Kt.to=="number"?Kt.to>=Jn.length-2:!1)&&Q.scrollToRealTime()}catch{}},100),qs){try{qs()}catch{}qs=null}qs=Mf(Q);const wt=up(s().theme);wn.merge(wt,p0(s().styles)),(Tn=o())==null||Tn.setStyles(qd(wt)),Oi();try{const Xt=()=>{var Qn,Fo,ps,Po,Go,Ps,Ns,si,Ec,yc,Pc,rc,Mc;if(!o())return;const Sn=o();let Xs=[];try{Xs=((Qn=Sn.getIndicators)==null?void 0:Qn.call(Sn))??[]}catch{Xs=[]}const Ni=Object.entries(s().saveInds||{});for(const[,$c]of Ni){const bl=$c==null?void 0:$c.name;if(!bl)continue;const fl=($c==null?void 0:$c.pane_id)||"";if(Xs.some(Xc=>Xc.name===bl&&(!fl||Xc.paneId===fl)))continue;let sd;if(Array.isArray($c.styles)&&$c.styles.length>0){const Xc=xl=>xl==="dashed"||xl==="dotted"?{style:vt.Dashed,dashedValue:xl==="dotted"?[2,2]:[4,4]}:{style:vt.Solid,dashedValue:[2,2]};sd={lines:$c.styles.map(xl=>{const Du=Xc(xl==null?void 0:xl.lineStyle);return{color:xl==null?void 0:xl.color,size:(xl==null?void 0:xl.thickness)??1,style:Du.style,dashedValue:Du.dashedValue}})}}let Bl;if(bl==="SMARTTREND"){const Xc=$c.superTrendGroup;if(Bl=Xc?{showLabels:!!Xc.showLabels,uptrendColor:((ps=(Fo=Xc.styles)==null?void 0:Fo.uptrend)==null?void 0:ps.color)??"#00FF00",downtrendColor:((Go=(Po=Xc.styles)==null?void 0:Po.downtrend)==null?void 0:Go.color)??"#FF0000",uptrendThickness:((Ns=(Ps=Xc.styles)==null?void 0:Ps.uptrend)==null?void 0:Ns.thickness)??1,downtrendThickness:((Ec=(si=Xc.styles)==null?void 0:si.downtrend)==null?void 0:Ec.thickness)??1,uptrendLineStyle:((Pc=(yc=Xc.styles)==null?void 0:yc.uptrend)==null?void 0:Pc.lineStyle)??"dashed",downtrendLineStyle:((Mc=(rc=Xc.styles)==null?void 0:rc.downtrend)==null?void 0:Mc.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!sd){const xl=Bl.uptrendLineStyle==="dotted"||Bl.uptrendLineStyle==="dashed";sd={lines:[{color:Bl.uptrendColor,size:Bl.uptrendThickness,style:xl?vt.Dashed:vt.Solid,dashedValue:Bl.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const Sp=fl==="candle_pane";try{Sn.createIndicator({name:bl,calcParams:$c==null?void 0:$c.params,styles:sd,...Bl?{extendData:Bl}:{}},Sp,fl?{id:fl}:void 0)}catch(Xc){console.warn("⚠️ Failed to restore indicator:",bl,Xc)}}};let jn=null;try{jn=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null}catch{}const Jn=(()=>{if(typeof window>"u")return!1;try{const Sn=localStorage.getItem("chart.saves.v1")||localStorage.getItem("chart.saves.v0");if(!Sn)return!1;const Xs=JSON.parse(Sn);return Array.isArray(Xs)&&Xs.length>0}catch{return!1}})();m(jn?"ℹ️ Active layout detected, SaveSystem will restore indicators.":"ℹ️ No active layout, will add default indicators if needed.");async function Kt(Sn,Xs,Ni,Qn=1200){var ps;const Fo=Date.now();for(;Date.now()-Fo<Qn;){try{const Po=Ni?{name:Xs,paneId:Ni}:{name:Xs},Go=((ps=Sn.getIndicators)==null?void 0:ps.call(Sn,Po))??[];if(Go.length>0&&Go.some(Ns=>(Ns==null?void 0:Ns.result)&&Object.keys(Ns.result).length>0))return!0}catch{}await new Promise(Po=>setTimeout(Po,16))}return!1}async function Zt(Sn,Xs){const Ni=[];Ni.push(Kt(Sn,"MACD","pane_MACD")),Xs||Ni.push(Kt(Sn,"RSI","pane_RSI")),Xs&&Ni.push(Kt(Sn,"SMARTTREND","candle_pane")),Ni.push(Kt(Sn,"VOL","candle_pane")),await Promise.all(Ni)}const an=async Sn=>{let Xs=!1;try{if(!o())return;const Ni=o();m("🎨 Adding default indicators...");const Qn="candle_pane",Fo=yt();if(x(fo,!0),Xs=!0,Fo)try{Ni.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:vt.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"}},!0,{id:Qn})&&D().update(Po=>(Po.saveInds[`${Qn}_SMARTTREND`]={name:"SMARTTREND",pane_id:Qn,params:[10,3]},Po))}catch{}try{const ps="pane_MACD",Po=[12,26,9];Ni.createIndicator({name:"MACD",calcParams:Po},!1,{id:ps,axis:{gap:{bottom:2}}})&&D().update(Ps=>(Ps.saveInds[`${ps}_MACD`]={name:"MACD",pane_id:ps,params:Po},Ps))}catch{}if(!Fo)try{const ps="pane_RSI",Po=[14];Ni.createIndicator({name:"RSI",calcParams:Po},!1,{id:ps,axis:{gap:{bottom:2}}})&&D().update(Ps=>(Ps.saveInds[`${ps}_RSI`]={name:"RSI",pane_id:ps,params:Po},Ps))}catch{}try{const ps="candle_pane";Ni.createIndicator({name:"VOL",calcParams:[20],styles:{lines:[]}},!0,{id:ps})&&D().update(Go=>(Go.saveInds[`${ps}_VOL`]={name:"VOL",pane_id:ps,params:[20]},Go))}catch{}m("✅ Default indicators applied",{force:Sn}),await Zt(Ni,Fo)}catch(Ni){console.warn("⚠️ Failed to add default indicators:",Ni)}finally{Xs&&x(fo,!1)}};let rs=!1;try{const Sn=(bn=performance.getEntriesByType)==null?void 0:bn.call(performance,"navigation");Sn&&Sn.length>0?rs=Sn[0].type==="reload":performance.navigation&&(rs=performance.navigation.type===1)}catch{}D().update(Sn=>(Sn.saveInds={},Sn)),jn?(m("✅ Active saved layout will be restored by SaveSystem"),setTimeout(()=>{var Sn,Xs;try{const Ni=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null,Qn=((Xs=(Sn=o())==null?void 0:Sn.getIndicators)==null?void 0:Xs.call(Sn))??[];!Ni&&(!Qn||Qn.length===0)&&(m("🛟 No active layout after restore attempt; applying default indicators"),an(!0))}catch{}},500)):Jn?(m("🎨 No active layout yet; waiting before adding defaults"),setTimeout(()=>{try{(typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null)?m("ℹ️ activeSaveId appeared; skipping default indicators"):an(!0)}catch{an(!0)}},250)):(m("🎨 No saved layouts found, adding default indicators now"),an(!0))}catch(Xt){console.warn("⚠️ Indicator restore failed:",Xt)}if(((Hs=(In=s().styles)==null?void 0:In.candle)==null?void 0:Hs.type)==="point_and_figure"&&o())try{o().createIndicator("PNF",!1,{id:"candle_pane"}),m("📊 Added PNF indicator for initial Point & Figure chart")}catch(Xt){console.warn("Failed to add initial PNF indicator:",Xt)}Fc(O(),Ao(a).initDone+=1,Ao(a)),$()||setTimeout(()=>{o()&&!a().loadingDuty&&oc()},100),Yc(),setTimeout(()=>{m("🔍 Current allSymbols:",s().allSymbols),m("🔍 allSymbols length:",s().allSymbols.length)},3e3),J==null||J.focus();try{typeof window<"u"&&(window.drawBarRef=i(Be),window.sidebarHostRef=i(Ce),window.predictNextCandle=()=>qm(),window.getAutoPlayState=()=>i(Ts),window.getPlaybackSpeed=()=>i(_i),window.setPlaybackSpeed=Xt=>ag(Xt),window.stopPrediction=()=>$p())}catch{}Il=Xt=>{if(!_x())return;(Xt.key==="F5"||(Xt.metaKey||Xt.ctrlKey)&&(Xt.key==="r"||Xt.key==="R"))&&(Xt.preventDefault(),Xt.stopPropagation(),x(Pi,!0))},window.addEventListener("keydown",Il,{capture:!0}),cl=Xt=>{var jn,Jn;if(_x()){try{const Kt=(((jn=s())==null?void 0:jn.key)||"chart")+"_drawings";localStorage.removeItem(Kt)}catch{}try{const Kt=(((Jn=s())==null?void 0:Jn.key)||"chart")+"_overlays";localStorage.removeItem(Kt)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}Xt.preventDefault(),Xt.returnValue=""}},window.addEventListener("beforeunload",cl),setTimeout(()=>{const Xt=J==null?void 0:J.querySelectorAll(".dutycharts-pane-separator");Xt==null||Xt.forEach(jn=>{const Jn=jn;Jn.style.transition="background-color 0.2s ease, transform 0.1s ease",Jn.addEventListener("mouseenter",()=>{Jn.style.cursor="row-resize",Jn.style.transform="scaleY(1.2)"}),Jn.addEventListener("mouseleave",()=>{Jn.style.transform="scaleY(1)"}),Jn.addEventListener("mousedown",()=>{Jn.classList.add("dragging"),document.body.style.cursor="row-resize"});const Kt=()=>{Jn.classList.remove("dragging"),document.body.style.cursor=""};document.addEventListener("mouseup",Kt),Jn.addEventListener("touchstart",Zt=>{Zt.preventDefault(),Jn.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(10)}),Jn.addEventListener("touchend",()=>{Jn.classList.remove("dragging")})})},500)}),b0(()=>{$p(),Za&&(clearTimeout(Za),Za=null),vi&&(cancelAnimationFrame(vi),vi=null),Il&&window.removeEventListener("keydown",Il,{capture:!0}),cl&&window.removeEventListener("beforeunload",cl);try{const S=$f}catch{}try{window.removeEventListener("resize",Fl)}catch{}if(kc){try{kc()}catch{}kc=null}if(uc){try{uc()}catch{}uc=null}if(Tl){try{Tl()}catch{}Tl=null}if(rg&&(window.removeEventListener("mouseup",rg),rg=null),sp&&(window.removeEventListener("touchend",sp),sp=null),Ev&&J&&(J.removeEventListener("mousedown",Ev,{capture:!0}),Ev=null),bv&&(window.removeEventListener("mousemove",bv),bv=null),Sg&&J&&(J.removeEventListener("keydown",Sg,{capture:!0}),Sg=null),lh&&J&&(J.removeEventListener("contextmenu",lh,{capture:!0}),lh=null),ch&&J&&(J.removeEventListener("dblclick",ch,{capture:!0}),ch=null),ig&&J&&(J.removeEventListener("mousedown",ig,{capture:!0}),ig=null),ql){try{ql()}catch{}ql=null}if(la){try{la.disconnect()}catch{}la=null}if(qs){try{qs()}catch{}qs=null}o()&&K(o())});function Mf(S){let j=null,Q=!1,ue=0;const ie=800;let De=0;const ze=5;let lt=null,wt=!1;const qt=()=>{try{if(wt)return;const vn=S.getVisibleRange();if(!vn||Q)return;const kn=S.getDataList();if(kn.length===0)return;const as=kn.length-1;Al=vn.to>=as-1;const Ys=vn.to-vn.from;lt=Ys;const yn=Math.max(3,Math.min(15,Math.floor(Ys*.15))),Vt=j&&vn.from<j.from,Pn=vn.from<=yn,Hn=!j||Math.abs(vn.from-j.from)>1,Tn=Date.now(),bn=De>=ze?ie*3:ie,In=Tn-ue>bn;if(vn.from<=Math.max(1,Math.floor(yn/2))&&In||Pn&&In){const Jn=kn[0];m(`🚀 Infinite scroll triggered: from=${vn.from}, threshold=${yn}, dataLength=${kn.length}, consecutive=${De}`),sn(Jn.timestamp),ue=Tn,De+=1,setTimeout(()=>{De=Math.max(0,De-1)},ie*1.5)}j={...vn}}catch(vn){console.error("❌ Error checking scroll position:",vn)}},sn=async vn=>{var kn,as,Ls,Ys,yn,Vt,Pn,Hn,Tn,bn,In,Hs;if(!(Q||a().loadingDuty||i(Ji))){Q=!0,x(Ji,!0),x(Gi,null);try{const jn=((as=(kn=s().styles)==null?void 0:kn.candle)==null?void 0:as.type)==="renko_atr"?Ii??vn:vn,Jn=await T.loadMoreHistoricalData(s().symbol,s().period,jn);if(Jn.data.length>0){let Kt=Jn.data;if(((Ys=(Ls=s().styles)==null?void 0:Ls.candle)==null?void 0:Ys.type)==="heikin_ashi")Kt=Ib(Kt);else if(((Vt=(yn=s().styles)==null?void 0:yn.candle)==null?void 0:Vt.type)==="renko_atr"){const Sn=((Hn=(Pn=s().styles)==null?void 0:Pn.candle)==null?void 0:Hn.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Kt=Pb(Kt,Sn);try{const Xs=Dd(Jn.data);Xs!=null&&(!Ii||Xs<Ii)&&(Ii=Xs)}catch{}}else if(((bn=(Tn=s().styles)==null?void 0:Tn.candle)==null?void 0:bn.type)==="point_and_figure"){const Sn=((Hs=(In=s().styles)==null?void 0:In.candle)==null?void 0:Hs.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Kt=Mb(Kt,Sn)}const Zt=S.getDataList();Kt.sort((Sn,Xs)=>Sn.timestamp-Xs.timestamp);const an=new Set(Zt.map(Sn=>Sn.timestamp)),rs=Kt.filter(Sn=>!an.has(Sn.timestamp));if(rs.length>0){const Sn=S.getVisibleRange(),Xs=(Sn==null?void 0:Sn.to)??null,Ni=!Sn||!Zt.length?!1:Sn.to>=Zt.length-2,Qn=Xs!==null&&Zt[Xs]?Zt[Xs].timestamp:null,Fo=[...rs,...Zt].sort((ps,Po)=>ps.timestamp-Po.timestamp);S.applyNewData(Fo,{backward:!0,forward:!0});try{Hm()}catch{}try{Fo.length>0&&x(st,!0)}catch{}m(`✅ Successfully loaded and merged ${rs.length} more historical bars`),x(Gi,null),Sn&&requestAnimationFrame(()=>{var ps;try{if(Ni){S.scrollToDataIndex(Fo.length-1),m("🎯 Scroll anchored to right edge (pinned)");return}if(Qn){S.scrollToTimestamp(Qn),m(`🎯 Scroll anchored to timestamp ${Qn} (stable)`);return}const Po=(Xs??0)+rs.length;S.scrollToDataIndex(Po),m(`🎯 Scroll anchored to index ${Po} (fallback)`)}catch(Po){const Go=Qn??((ps=Fo[rs.length])==null?void 0:ps.timestamp);if(Go)try{S.scrollToTimestamp(Go)}catch{}console.warn("Could not maintain scroll position:",Po)}})}else m("📭 No new unique historical data to add");Jn.lays&&Jn.lays.length>0&&i(Be)&&Jn.lays.forEach(Sn=>{i(Be).addOverlay(Sn)})}else m("📭 No historical chunk available from cache at the moment"),wt=!T.hasMoreServerHistory(s().symbol,s().period)}catch(Xt){console.error("❌ Error loading more historical data:",Xt),x(Gi,V(Xt instanceof Error?Xt.message:"Failed to load historical data")),$t.addAlert("error",`Failed to load historical data: ${i(Gi)}`)}finally{Q=!1,x(Ji,!1)}}},Ot=setInterval(qt,100);return()=>{clearInterval(Ot)}}async function Yc(){s().allSymbols||Fc(D(),Ao(s).allSymbols=[],Ao(s)),m("🚀 loadSymbols function called. loadingPairs:",a().loadingPairs,"allSymbols length:",s().allSymbols.length),Fc(O(),Ao(a).loadingPairs=!0,Ao(a));const S=await T.getSymbols();m("📊 Symbols loaded count:",S.length),Fc(D(),Ao(s).allSymbols=S,Ao(s));try{const Q=s().symbol,ue=String((Q==null?void 0:Q.ticker)||"").trim().toUpperCase();if(ue){const ie=S.find(ze=>String((ze==null?void 0:ze.ticker)||"").trim().toUpperCase()===ue),De=M(ie?{...ie,...Q}:Q);De&&D().update(ze=>(ze.symbol=De,ze))}}catch{}const j=new Set;S.forEach(Q=>{Q.exchange&&j.add(Q.exchange)}),D().update(Q=>(j.forEach(ue=>{Q.allExgs.add(ue)}),Q)),Fc(O(),Ao(a).loadingPairs=!1,Ao(a))}async function Lu(S,j,Q,ue,ie=!0,De=mi){var yn,Vt,Pn,Hn,Tn,bn,In,Hs,Xt,jn,Jn;const ze=o();if(!ze)return;N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},De===mi&&Fc(O(),Ao(a).loadingDuty=!0,Ao(a));const lt=l().url.searchParams.get("strategy"),wt=Bc(),qt=await T.getHistoryDutyData({symbol:S,period:j,from:Q,to:ue,strategy:lt,sessionMode:wt.sessionMode,adjustMode:wt.adjustMode,timezone:wt.timezone});let Ot=(qt.data||[]).slice(Math.max(0,(qt.data||[]).length-600));if(!Ot||Ot.length===0){De===mi&&Fc(O(),Ao(a).loadingDuty=!1,Ao(a));return}const vn=((Vt=(yn=s().styles)==null?void 0:yn.candle)==null?void 0:Vt.type)||vx((Hn=(Pn=o())==null?void 0:Pn.getStyles)==null?void 0:Hn.call(Pn),s().styles),kn=Ab(S),as=vn;if(as==="heikin_ashi")Ot=Ib(Ot);else if(as==="renko_atr"){try{const Zt=Dd(qt.data);Zt!=null&&(!Ii||Zt<Ii)&&(Ii=Zt)}catch{}const Kt=((bn=(Tn=s().styles)==null?void 0:Tn.candle)==null?void 0:bn.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Ot=Pb(Ot,Kt)}else if(as==="point_and_figure"){const Kt=((Hs=(In=s().styles)==null?void 0:In.candle)==null?void 0:Hs.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Ot=Mb(Ot,Kt)}if(Ot=Ot.map((Kt,Zt)=>((!Kt.timestamp||isNaN(Kt.timestamp)||Kt.timestamp<=0)&&(console.warn(`Invalid timestamp in dutys at index ${Zt}:`,Kt.timestamp),Kt.timestamp=Date.now()-(Ot.length-Zt)*6e4),Kt)),De!==mi)return;try{let Kt=$_(S,qt.data);try{const rs=Array.isArray(qt.data)?qt.data[qt.data.length-1]:null,Sn=rs&&typeof rs=="object"?Number(rs.close):Array.isArray(rs)?Number(rs[4]):NaN;(Number.isFinite(Sn)&&Math.abs(Sn)>=1e4||kn==="crypto"&&Number.isFinite(Sn)&&Math.abs(Sn)>=1e3)&&(Kt=2)}catch{}((jn=(Xt=ze==null?void 0:ze.getSymbol)==null?void 0:Xt.call(ze))==null?void 0:jn.pricePrecision)!==Kt&&(ze==null||ze.setSymbol({pricePrecision:Kt}));const an=S==null?void 0:S.pricePrecision;(!Number.isFinite(an)||an!==Kt)&&D().update(rs=>(rs.symbol&&rs.symbol.ticker===S.ticker&&(rs.symbol.pricePrecision=Kt),rs))}catch{}const Ls=as==="renko_atr",Ys=!Ls&&ie&&Ot.length>0;ze.applyNewData(Ot,!!Ys);try{Hm()}catch{}try{(Ot??[]).length>0&&x(st,!0)}catch{}try{T.startBackgroundPrefetch(S,{timeframe:j.timeframe})}catch{}if(qt.lays&&qt.lays.length>0&&i(Be)&&qt.lays.forEach(Kt=>{i(Be).addOverlay(Kt)}),De===mi&&Fc(O(),Ao(a).loadingDuty=!1,Ao(a)),Fc(O(),Ao(a).dutyLoaded+=1,Ao(a)),Ot.length){const Kt=mp(j.timeframe)*1e3,Zt=new Date().getTime(),an=Ot[Ot.length-1].timestamp+Kt;!Ls&&an+Kt>Zt&&(((Jn=s().options)==null?void 0:Jn.enableRealtime)===!0||r().playing===!0)&&T.subscribe(S,Sn=>{var Mc,$c;const Xs=Sn;if(!(S.exchange==="DSEBD"?(()=>{var Xc,xl,Du;const bl=new Date,fl=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Dhaka",hour12:!1,weekday:"short",hour:"2-digit",minute:"2-digit"}).formatToParts(bl),$u=((Xc=fl.find(_d=>_d.type==="weekday"))==null?void 0:Xc.value)??"",sd=Number(((xl=fl.find(_d=>_d.type==="hour"))==null?void 0:xl.value)??"0"),Bl=Number(((Du=fl.find(_d=>_d.type==="minute"))==null?void 0:Du.value)??"0"),Sp=sd*60+Bl;return["Sun","Mon","Tue","Wed","Thu"].includes($u)&&Sp>=600&&Sp<=870})():!0))return;const Qn=ze.getDataList(),Fo=Qn[Qn.length-1],ps=Fo&&Fo.timestamp?[Fo.timestamp,Fo.open,Fo.high,Fo.low,Fo.close,Fo.volume??0]:null,Po=bB(Xs.bars,Xs.secs*1e3,Kt,ps),Go=ze.getChartStore(),Ps=ze.getVisibleRange(),Ns=ze.getDataList(),si=Ps&&Ns[Ps.from]?Ns[Ps.from].timestamp:null,Ec=Ns.length-1,yc=Ps?Ps.to>=Ec-1:!0,Pc=Ns&&Ns.length?Number(((Mc=Ns[Ns.length-1])==null?void 0:Mc.timestamp)??0):0,rc=Po.map(([bl,fl,$u,sd,Bl,Sp])=>({timestamp:bl,open:fl,high:$u,low:sd,close:Bl,volume:Sp}));Go.addData(rc,"backward",{forward:yc,backward:!1});try{const bl=ze.getDataList();Array.isArray(bl)&&bl.length>0&&x(st,!0);const fl=bl&&bl.length?Number((($c=bl[bl.length-1])==null?void 0:$c.timestamp)??0):0;if(fl>0){const $u=fl>Pc;N.active=!0,N.lastUpdateAt=Date.now(),N.lastBarTs=fl,$u&&(N.lastNewBarIndex=bl.length-1),N.lastNewBarIndex<0&&(N.lastNewBarIndex=bl.length-1)}}catch{}!yc&&Ps&&si&&requestAnimationFrame(()=>{try{const fl=ze.getDataList().findIndex($u=>$u.timestamp===si);fl!==-1?ze.scrollToDataIndex(fl):ze.scrollToDataIndex(Ps.from)}catch{}})})}}async function Ju(){x(st,!1);const S=sk(s().dateStart);let j=sk(s().dateEnd);if(!S||!j){$t.addAlert("error","invalid time, please use: 202301011200");return}const Q=mp(s().period.timeframe)*1e3;(j-S)/Q>z&&(j=S+Q*z),await Lu(s().symbol,s().period,S,j,!1)}const Dd=S=>{if(!Array.isArray(S)||S.length===0)return null;let j=1/0;for(const Q of S){const ue=Q==null?void 0:Q.timestamp,ie=typeof ue=="number"?ue:Number(ue);Number.isFinite(ie)&&ie<j&&(j=ie)}return Number.isFinite(j)?j:null};async function oc(S){x(st,!1);const j=s().symbol,Q=s().period;m("🔄 Loading symbol:",j.ticker,"period:",Q.timeframe);const ue=new Date().getTime(),[ie,De]=nP(Q,ue,It),ze=S??mi,lt=j.ticker,wt=Q.timeframe;try{await Lu(j,Q,ie,ue,!$(),ze)}catch(qt){console.warn("⚠️ loadSymbolPeriod failed:",qt)}try{setTimeout(()=>{var qt;try{if(ze!==mi||lt!==s().symbol.ticker||wt!==s().period.timeframe)return;const sn=o(),Ot=((qt=sn==null?void 0:sn.getDataList)==null?void 0:qt.call(sn))??[];if(!Array.isArray(Ot)||Ot.length===0){const vn=ze;m("🔁 Retrying loadSymbolPeriod due to empty data after TF change"),Lu(j,Q,ie,ue,!$(),vn)}}catch{}},250)}catch{}}hp(D(),S=>S.period.timeframe).subscribe(async S=>{var Q,ue,ie,De,ze,lt,wt,qt,sn,Ot,vn;const j=((ue=(Q=s().styles)==null?void 0:Q.candle)==null?void 0:ue.type)==="renko_atr";try{if(!j){const kn=`${s().period.timespan}`;if(Ba!==kn){const as=ik(s().period.timespan),Ls=new Map,Ys=800,yn=({timestamp:Hn,template:Tn,type:bn})=>{const In=`${bn}|${Tn}|${Hn}`,Hs=Ls.get(In);if(Hs)return Hs;const Xt=as(Hn,Tn,bn);return Ls.size>=Ys&&Ls.clear(),Ls.set(In,Xt),Xt},Vt=o(),Pn=(ie=Vt==null?void 0:Vt.getChartStore)==null?void 0:ie.call(Vt);Pn!=null&&Pn.setFormatter&&(Pn.setFormatter({formatDate:yn}),Ba=kn)}}}catch{}xw.set(s().period);try{const kn=s().period,Ls={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[kn.timespan]??"day",Ys=Number(kn.multiplier)||1;((ze=(De=s().styles)==null?void 0:De.candle)==null?void 0:ze.type)!=="renko_atr"&&((lt=o())==null||lt.setPeriod({type:Ls,span:Ys}))}catch{}if(Ii=null,!($()||!o())){if(gf()){try{T.unsubscribe()}catch{}if(N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},qs){try{qs()}catch{}qs=null}$p(),Xv(!1);return}try{T.unsubscribe()}catch{}if(N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},!j&&Wo&&(Wo=!1),j){To+=1;const kn=To,as=Er();Wo=!0;try{try{(wt=o())==null||wt.setScrollEnabled(!1),(qt=o())==null||qt.setZoomEnabled(!1)}catch{}try{x(st,!1)}catch{}try{(sn=o())==null||sn.applyNewData([],!1)}catch{}try{const Ls=T;typeof Ls.stopSymbolPipelines=="function"&&Ls.stopSymbolPipelines(s().symbol.ticker)}catch{}await oc(as),mi===as&&To===kn&&(Wo=!1,gl.requestKey("renko:resize",()=>{var Ls;try{(Ls=o())==null||Ls.resize()}catch{}Oi()}))}catch(Ls){console.warn("⚠️ Renko timeframe refresh failed:",Ls)}finally{try{(Ot=o())==null||Ot.setScrollEnabled(!0),(vn=o())==null||vn.setZoomEnabled(!0)}catch{}To===kn&&(Wo=!1)}}else vc.changeTimeframe({chart:o(),period:s().period,loadDataFn:async()=>{const kn=Er();try{x(st,!1)}catch{}await oc(kn)}});if(qs){try{qs()}catch{}qs=null}o()&&(qs=Mf(o()))}}),hp(D(),S=>S.symbol.ticker).subscribe(S=>{var De,ze,lt,wt,qt,sn,Ot,vn,kn;m("📊 Current symbol:",s().symbol),m("📊 Loading state:",a().loadingDuty,"Custom load:",$()),n5.set(s().symbol);const j=ni(s().symbol);j!==s().symbol&&D().update(as=>(as.symbol=j,as));const Q={...j,ticker:s().symbol.ticker,pricePrecision:$_(s().symbol),volumePrecision:s().symbol.volumePrecision};try{h3({logo:j.logo,logo2:j.logo2})}catch{}if((De=o())==null||De.setSymbol(Q),Ii=null,sl){const as=D0(s().symbol);sl.setCurrentSymbol(as),sl.renderCurrentSymbolDrawings()}try{const as=Va||window.overlayCreationManager;as&&as.setCurrentSymbolKey(D0(s().symbol))}catch{}if($())return;if(gf()){try{T.unsubscribe()}catch{}if(N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},qs){try{qs()}catch{}qs=null}$p(),Xv(!1);return}const ue=L;L=s().symbol,ue&&ue.ticker!==s().symbol.ticker?T.unsubscribe(ue):T.unsubscribe(),N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1};try{x(st,!1)}catch{}try{const as=T==null?void 0:T.getHistorySnapshot;if(o()&&typeof as=="function"){const Ls=as(s().symbol,s().period.timeframe),Ys=Ls==null?void 0:Ls.candles;if(Array.isArray(Ys)&&Ys.length>0){let Vt=Ys.slice(Math.max(0,Ys.length-600));const Pn=((lt=(ze=s().styles)==null?void 0:ze.candle)==null?void 0:lt.type)||vx((qt=(wt=o())==null?void 0:wt.getStyles)==null?void 0:qt.call(wt),s().styles);if(Pn==="heikin_ashi")Vt=Ib(Vt);else if(Pn==="renko_atr"){try{const Tn=Dd(Ys);Tn!=null&&(!Ii||Tn<Ii)&&(Ii=Tn)}catch{}const Hn=((Ot=(sn=s().styles)==null?void 0:sn.candle)==null?void 0:Ot.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Vt=Pb(Vt,Hn)}else if(Pn==="point_and_figure"){const Hn=((kn=(vn=s().styles)==null?void 0:vn.candle)==null?void 0:kn.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Vt=Mb(Vt,Hn)}o().applyNewData(Vt,!1),x(st,!0)}}}catch{}if(qs){try{qs()}catch{}qs=null}o()&&(qs=Mf(o()));const ie=Er();oc(ie)}),wr(()=>{if(!gf()){wd&&(wd=!1,cg());return}wd=!0;const j=Number(r().replayFrom),Q=Number(r().replayTo);if(!Number.isFinite(j)||!Number.isFinite(Q))return;const ue=`${s().symbol.ticker}|${s().period.timeframe}|${j}|${Q}`;ue!==Gl&&(Gl=ue,Xv(!1),Um(j,Q))}),wr(()=>{const S=r().mode;fc!=="none"&&S==="none"&&($p(),Fh()),fc=S});const Yf=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],An=[...Yf,"SMARTTREND"];function yt(){var j;const S=(j=c())==null?void 0:j.data;return(S==null?void 0:S.isPremium)===!0||(S==null?void 0:S.isTrial)===!0}function Rn(S){var qt,sn,Ot,vn,kn,as,Ls,Ys,yn,Vt,Pn,Hn,Tn;if(!o())return;const j=o(),Q=S==null?void 0:S.name;if(!Q)return;const ue=(S==null?void 0:S.pane_id)||"";let ie=[];try{ie=((qt=j.getIndicators)==null?void 0:qt.call(j))??[]}catch{ie=[]}if(ie.some(bn=>bn.name===Q&&(!ue||bn.paneId===ue)))return;let ze;if(Array.isArray(S.styles)&&S.styles.length>0){const bn=In=>In==="dashed"||In==="dotted"?{style:vt.Dashed,dashedValue:In==="dotted"?[2,2]:[4,4]}:{style:vt.Solid,dashedValue:[2,2]};ze={lines:S.styles.map(In=>{const Hs=bn(In==null?void 0:In.lineStyle);return{color:In==null?void 0:In.color,size:(In==null?void 0:In.thickness)??1,style:Hs.style,dashedValue:Hs.dashedValue}})}}let lt;if(Q==="SMARTTREND"){const bn=S.superTrendGroup;if(lt=bn?{showLabels:!!bn.showLabels,uptrendColor:((Ot=(sn=bn.styles)==null?void 0:sn.uptrend)==null?void 0:Ot.color)??"#00FF00",downtrendColor:((kn=(vn=bn.styles)==null?void 0:vn.downtrend)==null?void 0:kn.color)??"#FF0000",uptrendThickness:((Ls=(as=bn.styles)==null?void 0:as.uptrend)==null?void 0:Ls.thickness)??1,downtrendThickness:((yn=(Ys=bn.styles)==null?void 0:Ys.downtrend)==null?void 0:yn.thickness)??1,uptrendLineStyle:((Pn=(Vt=bn.styles)==null?void 0:Vt.uptrend)==null?void 0:Pn.lineStyle)??"dashed",downtrendLineStyle:((Tn=(Hn=bn.styles)==null?void 0:Hn.downtrend)==null?void 0:Tn.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!ze){const In=lt.uptrendLineStyle==="dotted"||lt.uptrendLineStyle==="dashed";ze={lines:[{color:lt.uptrendColor,size:lt.uptrendThickness,style:In?vt.Dashed:vt.Solid,dashedValue:lt.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const wt=ue==="candle_pane";j.createIndicator({name:Q,calcParams:S==null?void 0:S.params,styles:ze,...lt?{extendData:lt}:{}},wt,ue?{id:ue}:void 0)}function _n(){var j;if(!o()||yt())return;const S=o();try{const Q=((j=S.getIndicators)==null?void 0:j.call(S))??[];for(const ue of Q)if(ue.name&&Yf.includes(ue.name))try{S.removeIndicator({paneId:ue.paneId||"candle_pane",name:ue.name}),m(`✅ Removed AI indicator: ${ue.name} from pane: ${ue.paneId}`)}catch(ie){console.warn(`⚠️ Failed to remove indicator ${ue.name}:`,ie)}}catch(Q){console.error("❌ Error removing AI indicators:",Q)}}function Vs(){var j;if(!o()||yt())return;const S=o();try{const Q=((j=S.getIndicators)==null?void 0:j.call(S))??[];for(const ue of Q)ue.name==="SMARTTREND"&&(S.removeIndicator({paneId:ue.paneId||"candle_pane",name:ue.name}),m(`✅ Removed Smart Trend indicator from pane: ${ue.paneId}`))}catch(Q){console.error("❌ Error removing Smart Trend:",Q)}}function Ms(){if(!(!o()||!yt()))try{const S=Object.entries(s().saveInds||{});for(const[,j]of S)!(j!=null&&j.name)||!An.includes(j.name)||Rn(j)}catch(S){console.error("❌ Error restoring premium indicators:",S)}}let $s=xe(null),wo=xe(!1);wr(()=>{var ue;if(!o()||((ue=c())==null?void 0:ue.data)===void 0)return;const j=yt();(!i(wo)||i($s)===!0&&j===!1)&&j===!1&&setTimeout(()=>{_n(),Vs()},1e3),i($s)===!1&&j===!0&&setTimeout(()=>{Ms()},800),x($s,V(j)),x(wo,!0)});const Zo=hp(D(),S=>S.theme);let ao=s().theme;Zo.subscribe(S=>{var ze,lt,wt,qt,sn,Ot,vn,kn,as,Ls,Ys,yn,Vt,Pn,Hn,Tn,bn,In,Hs,Xt,jn,Jn,Kt,Zt,an,rs,Sn,Xs,Ni,Qn,Fo,ps,Po,Go,Ps,Ns,si,Ec,yc,Pc,rc,Mc,$c,bl,fl,$u,sd,Bl,Sp;if(S===ao||(ao=S,Io)||a().isApplyingManualStyles)return;S=="light"?(Fc(D(),Ao(s).colorLong="green",Ao(s)),Fc(D(),Ao(s).colorShort="red",Ao(s))):(Fc(D(),Ao(s).colorLong="green",Ao(s)),Fc(D(),Ao(s).colorShort="rgb(255,135,8)",Ao(s)));const j=up(s().theme);m("🎨 Theme styles from getThemeStyles:",JSON.stringify(j,null,2)),m("💾 Current save.styles:",JSON.stringify(s().styles,null,2));const Q=p0(s().styles),ue=(ze=Q==null?void 0:Q.candle)==null?void 0:ze.type,ie=wn.merge({},j,Q);m("🎨 theme axis colors:",(qt=(wt=(lt=j==null?void 0:j.xAxis)==null?void 0:lt.tickText)==null?void 0:wt.style)==null?void 0:qt.color,(vn=(Ot=(sn=j==null?void 0:j.yAxis)==null?void 0:sn.tickText)==null?void 0:Ot.style)==null?void 0:vn.color),m("💾 saved axis colors:",wn.get(Q,"xAxis.tickText.style.color"),wn.get(Q,"yAxis.tickText.style.color")),ue&&ie.candle&&(ie.candle.type=ue);try{const Xc=(Ls=(as=(kn=j==null?void 0:j.candle)==null?void 0:kn.tooltip)==null?void 0:as.title)==null?void 0:Ls.color;if(Xc&&((yn=(Ys=ie==null?void 0:ie.candle)==null?void 0:Ys.tooltip)!=null&&yn.title)){ie.candle.tooltip.title.color=Xc;try{D().update(xl=>(xl.styles||(xl.styles={}),wn.set(xl.styles,"candle.tooltip.title.color",Xc),xl))}catch{}}}catch{}try{const Xc=(Hn=(Pn=(Vt=j==null?void 0:j.candle)==null?void 0:Vt.tooltip)==null?void 0:Pn.legend)==null?void 0:Hn.color,xl=(In=(bn=(Tn=j==null?void 0:j.indicator)==null?void 0:Tn.tooltip)==null?void 0:bn.legend)==null?void 0:In.color;if(Xc&&((Xt=(Hs=ie==null?void 0:ie.candle)==null?void 0:Hs.tooltip)!=null&&Xt.legend)){ie.candle.tooltip.legend.color=Xc;try{D().update(Du=>(Du.styles||(Du.styles={}),wn.set(Du.styles,"candle.tooltip.legend.color",Xc),Du))}catch{}}if(xl&&((Jn=(jn=ie==null?void 0:ie.indicator)==null?void 0:jn.tooltip)!=null&&Jn.legend)){ie.indicator.tooltip.legend.color=xl;try{D().update(Du=>(Du.styles||(Du.styles={}),wn.set(Du.styles,"indicator.tooltip.legend.color",xl),Du))}catch{}}}catch{}try{const Xc=(an=(Zt=(Kt=j==null?void 0:j.xAxis)==null?void 0:Kt.tickText)==null?void 0:Zt.style)==null?void 0:an.color,xl=(Xs=(Sn=(rs=j==null?void 0:j.yAxis)==null?void 0:rs.tickText)==null?void 0:Sn.style)==null?void 0:Xs.color;Xc&&((Qn=(Ni=ie==null?void 0:ie.xAxis)==null?void 0:Ni.tickText)!=null&&Qn.style)&&(ie.xAxis.tickText.style.color=Xc,(Fo=ie==null?void 0:ie.xAxis)!=null&&Fo.tickText&&(delete ie.xAxis.tickText.color,delete ie.xAxis.tickText.opacity,ie.xAxis.tickText.color=Xc)),xl&&((Po=(ps=ie==null?void 0:ie.yAxis)==null?void 0:ps.tickText)!=null&&Po.style)&&(ie.yAxis.tickText.style.color=xl,(Go=ie==null?void 0:ie.yAxis)!=null&&Go.tickText&&(delete ie.yAxis.tickText.color,delete ie.yAxis.tickText.opacity,ie.yAxis.tickText.color=xl))}catch{}try{if((Ns=(Ps=ie==null?void 0:ie.candle)==null?void 0:Ps.tooltip)!=null&&Ns.legend){const Xc=ie.candle.tooltip.legend.color;ie.candle.tooltip.legend.template=({current:xl,prev:Du},_d)=>{var Ir,kd;const yh=(_d==null?void 0:_d.bar)||{},jh=((kd=(Ir=_d==null?void 0:_d.tooltip)==null?void 0:Ir.legend)==null?void 0:kd.color)??Xc,gp=(xl==null?void 0:xl.open)??0,Sm=(xl==null?void 0:xl.close)??0,Dp=(yh.compareRule||"current_open")==="current_open"?gp:(Du==null?void 0:Du.close)??Sm,Wg=gp===Sm||Sm>=Dp?yh.upBorderColor||jh:yh.downBorderColor||jh,_f=Rp=>({text:Rp,color:Wg});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:_f("{open}")},{title:"H",value:_f("{high}")},{title:"L",value:_f("{low}")},{title:"C",value:_f("{close}")},{title:"V",value:_f("{volume}")}]:[{title:"O",value:_f("{open}")},{title:"H",value:_f("{high}")},{title:"L",value:_f("{low}")},{title:"C",value:_f("{close}")},{title:"V",value:_f("{volume}")}]}}}catch{}m("🔄 Merged styles (theme + saved):",JSON.stringify(ie,null,2)),m("🔄 merged axis colors before process:",(yc=(Ec=(si=ie==null?void 0:ie.xAxis)==null?void 0:si.tickText)==null?void 0:Ec.style)==null?void 0:yc.color,(Mc=(rc=(Pc=ie==null?void 0:ie.yAxis)==null?void 0:Pc.tickText)==null?void 0:rc.style)==null?void 0:Mc.color);const De=qd(ie);m("✨ Final processed styles:",JSON.stringify(De,null,2)),m("✨ processed axis colors:",(fl=(bl=($c=De==null?void 0:De.xAxis)==null?void 0:$c.tickText)==null?void 0:bl.style)==null?void 0:fl.color,(Bl=(sd=($u=De==null?void 0:De.yAxis)==null?void 0:$u.tickText)==null?void 0:sd.style)==null?void 0:Bl.color),(Sp=o())==null||Sp.setStyles(De),setTimeout(()=>{Oi()},100),setTimeout(()=>{var xl,Du,_d;const Xc=(xl=o())==null?void 0:xl.getStyles();m("  - Current chart styles:",JSON.stringify(Xc,null,2)),m("  - Saved chart type in $save.styles:",(_d=(Du=s().styles)==null?void 0:Du.candle)==null?void 0:_d.type)},200)}),hp(D(),S=>S.timezone).subscribe(S=>{var j;(j=o())==null||j.setTimezone(S),rk(S);try{Oc==null||Oc.onTimezoneChange()}catch{}});const so=hp(D(),S=>{var j,Q;return(Q=(j=S.styles)==null?void 0:j.candle)==null?void 0:Q.type});let Wi=((dg=(Wv=s().styles)==null?void 0:Wv.candle)==null?void 0:dg.type)||null;so.subscribe(S=>{if(a().loadingDuty||$())return;const j=o();if(!j)return;Ii=null;const Q=Wi==="point_and_figure",ue=S==="point_and_figure";if(ue&&!Q)try{j.createIndicator("PNF",!1,{id:"candle_pane"}),m("📊 Added PNF indicator for Point & Figure chart")}catch(ie){console.warn("Failed to add PNF indicator:",ie)}else if(!ue&&Q)try{j.removeIndicator({paneId:"candle_pane",name:"PNF"}),m("📊 Removed PNF indicator (switched from P&F)");const ie=up(s().theme),De=wn.merge({},ie,p0(s().styles)),ze=qd(De);j.setStyles(ze),m("🎨 Refreshed styles after P&F exit - candle colors restored")}catch(ie){console.warn("Failed to cleanup after P&F:",ie)}Wi=S||null,(S==="heikin_ashi"||S==="renko_atr"||S==="point_and_figure"||S!=="heikin_ashi"&&S!=="renko_atr"&&S!=="point_and_figure"&&j.getDataList().length>0)&&vc.switchChartType({chart:j,newType:S||"candle_solid",reloadDataFn:async()=>{await oc()}})}),hp(D(),S=>{var Q,ue;const j=((ue=(Q=S.styles)==null?void 0:Q.candle)==null?void 0:ue.renko)||{};return JSON.stringify(j)}).subscribe(S=>{var Q,ue;if(a().loadingDuty||$()||((ue=(Q=s().styles)==null?void 0:Q.candle)==null?void 0:ue.type)!=="renko_atr")return;const j=o();j&&vc.switchChartType({chart:j,newType:"renko_atr",reloadDataFn:async()=>{await oc()}})}),hp(D(),S=>{var Q,ue;const j=((ue=(Q=S.styles)==null?void 0:Q.candle)==null?void 0:ue.pnf)||{};return JSON.stringify(j)}).subscribe(S=>{var Q,ue;if(a().loadingDuty||$()||((ue=(Q=s().styles)==null?void 0:Q.candle)==null?void 0:ue.type)!=="point_and_figure")return;const j=o();j&&vc.switchChartType({chart:j,newType:"point_and_figure",reloadDataFn:async()=>{await oc()}})}),hp(O(),S=>S.fireOhlcv).subscribe(async S=>{a().timeStart&&a().timeEnd?(await Lu(s().symbol,s().period,a().timeStart,a().timeEnd),Fc(O(),Ao(a).timeStart=0,Ao(a)),Fc(O(),Ao(a).timeEnd=0,Ao(a))):await Ju()});function fu(){return o()}function Cr(S){Io=S}function ba(S){var j;if(ev("interactionV2")){const Q=S.target;if(Q&&(Q.closest("input, textarea, select")||Q.closest("[contenteditable='true']")||Q.closest(".monaco-editor")||Q.closest("[role='textbox']")||Q.isContentEditable))return;if(S.key==="Escape"){S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation(),gR(),x(Dm,""),x(vf,""),x(Rm,""),x(Nh,""),bu();return}if((S.key==="Delete"||S.key==="Backspace")&&i(Dm)){S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation();const ie=o_(i(Dm));L0(i(Dm),{box:ie==null?void 0:ie.box,label:ie==null?void 0:ie.label,hidden:!0}),x(Dm,""),x(vf,""),x(Rm,""),x(Nh,""),bu();return}if((S.key==="ArrowLeft"||S.key==="ArrowRight"||S.key==="ArrowUp"||S.key==="ArrowDown")&&i(Dm)){const ie=Lv.find(qt=>qt.id===i(Dm)&&(qt.type==="box"||qt.type==="label"));if(!ie)return;S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation();const De=S.shiftKey?5:1;let ze=0,lt=0;if(S.key==="ArrowLeft"&&(ze=-De),S.key==="ArrowRight"&&(ze=De),S.key==="ArrowUp"||S.key==="ArrowDown"){const qt=ie.axis,sn=qh.y*De;if(qt&&typeof qt.toValue=="function"&&typeof qt.toY=="function"){let Ot=NaN;if(ie.type==="box"&&ie.box){const vn=(ie.box.topValue+ie.box.bottomValue)/2;Ot=qt.toY(vn)}else ie.type==="label"&&ie.label&&(Ot=qt.toY(ie.label.value));if(Number.isFinite(Ot)){const vn=qt.toValue(Ot+(S.key==="ArrowUp"?-sn:sn))-qt.toValue(Ot);Number.isFinite(vn)&&(lt=vn)}}}const{nudgedId:wt}=_R(ie,ze,lt);wt&&Pl();return}}(S.key==="Delete"||S.key==="Backspace")&&(S.preventDefault(),(j=i(Be))==null||j.clickRemove())}function Pl(){o()&&gl.requestKey("interaction:redraw",()=>{try{o().updatePane(ix.Drawer)}catch{}})}function _u(S){if(!ev("interactionV2"))return null;const j=J==null?void 0:J.getBoundingClientRect();if(!j)return null;const Q=S.clientX-j.left,ue=S.clientY-j.top,De=vR(Q,ue,Lv);if(x(Dm,V(De.selectedId??"")),x(Rm,V(De.draggingId??"")),x(Nh,V(De.resizingId??"")),De.selectedId||x(vf,""),J){try{J.focus({preventScroll:!0})}catch{J.focus()}bu(De.cursor)}return Pl(),De}const Zr=16,Qi=8,os=6,mo=1200,er=50,gr=g,fr=new Map,pr=ZZ;let yu=xe(null),Kc=xe(null),fd=xe(null);const Rr=S=>typeof S=="number"&&Number.isFinite(S),ic=S=>{if(typeof S=="number")return Number.isFinite(S)?S:null;if(typeof S=="string"){const Q=Number(S);return Number.isFinite(Q)?Q:null}const j=Number(S);return Number.isFinite(j)?j:null},Lc=(S,j)=>`${S}::${j}`,Ad=S=>Array.isArray(S)?S:Array.isArray(S==null?void 0:S.__rows)?S.__rows:[],Gu=(S,j)=>{if(!S||typeof S.convertToPixel!="function")return null;const Q=S.convertToPixel(j);if(!Rr(Q))return null;const ue=S.convertToPixel(j-1),ie=S.convertToPixel(j+1),De=[Math.abs(Q-ue),Math.abs(ie-Q)].filter(wt=>Number.isFinite(wt)),ze=De.length?Math.max(...De):6,lt=Math.max(2,Math.min(14,ze*.7))/2;return{x:Q,half:lt}},lf=(S,j,Q)=>{const ue=(S==null?void 0:S.result)||{},ie=Ad(ue);if(ie.length)return ie[j]??null;const De=Q[j],ze=(De==null?void 0:De.timestamp)??(De==null?void 0:De.time)??(De==null?void 0:De.t);return ze==null?null:ue[ze]??ue[String(ze)]??null},pd=S=>String((S==null?void 0:S.name)||(S==null?void 0:S.shortName)||"").toUpperCase()==="ZIGZAG",Df=S=>{const j=String((S==null?void 0:S.name)||(S==null?void 0:S.shortName)||"").toUpperCase();return j==="VOL"||j==="VOLUME"},Li=S=>{const Q=Math.max(10,Math.floor(S.height*.22)),ue=S.height-1,De=Math.max(1,Math.floor(Q*.56));return{bandBottom:ue,effectiveBandHeight:De}},nm=(S,j,Q,ue)=>{var De;if(!(S!=null&&S.result)||!Array.isArray(j))return 0;let ie=0;for(let ze=Q;ze<=ue&&ze<j.length;ze+=1){const lt=(De=j[ze])==null?void 0:De.timestamp;if(lt==null)continue;const wt=S.result[lt];if(!wt)continue;const qt=ic(wt.volume),sn=ic(wt.ema);Rr(qt)&&(ie=Math.max(ie,qt)),Rr(sn)&&(ie=Math.max(ie,sn))}return ie},Nf=(S,j,Q,ue)=>{if(!Array.isArray(S)||!S.length)return null;let ie=0;for(let De=j;De>=0&&De<S.length&&ie<=ue;De+=Q,ie+=1){const ze=S[De],lt=ic(ze==null?void 0:ze.zigzag);if(Rr(lt))return{index:De,price:lt}}return null},nt=(S,j)=>{if(!Array.isArray(S)||!S.length)return null;const Q=S[j],ue=ic(Q==null?void 0:Q.zigzag);if(Rr(ue))return ue;const ie=Nf(S,j,-1,800),De=Nf(S,j,1,800);if(!ie||!De||ie.index===De.index)return null;const ze=(j-ie.index)/(De.index-ie.index);return ie.price+(De.price-ie.price)*ze},yv=(S,j,Q)=>{if(!Array.isArray(S)||!S.length)return[];const ue=Math.max(0,j-50),ie=Math.min(S.length-1,Q+50),De=[];for(let ze=ue;ze<=ie;ze+=1){const lt=S[ze],wt=ic(lt==null?void 0:lt.zigzag);Rr(wt)&&De.push({index:ze,price:wt})}return De},Tv=(S,j)=>{if(!S.length)return null;let Q=0;for(;Q<S.length-1&&j>S[Q+1].index;)Q+=1;const ue=S[Q],ie=S[Math.min(Q+1,S.length-1)];if(!ue||!ie||ue.index===ie.index)return(ue==null?void 0:ue.price)??null;if(j<ue.index||j>ie.index)return null;const De=(j-ue.index)/(ie.index-ue.index);return ue.price+(ie.price-ue.price)*De},Fp=(S,j)=>{const Q=zc();for(const[ue,ie]of Object.entries(Q)){if(!ie||ue==="x_axis_pane")continue;const De=S>=ie.left&&S<=ie.left+ie.width,ze=j>=ie.top&&j<=ie.top+ie.height;if(De&&ze)return{paneId:ue,rect:ie}}return null},pu=(S,j)=>{var Hs,Xt,jn,Jn,Kt,Zt,an,rs,Sn,Xs,Ni;if(!o()||!J)return null;const Q=J.getBoundingClientRect();if(S<0||j<0||S>Q.width||j>Q.height)return null;const ue=Fp(S,j);if(!ue)return null;const{paneId:ie,rect:De}=ue,ze=o(),lt=((Hs=ze.getDataList)==null?void 0:Hs.call(ze))||[],wt=(Jn=(jn=(Xt=ze.getXAxisPane)==null?void 0:Xt.call(ze))==null?void 0:jn.getAxisComponent)==null?void 0:Jn.call(jn),qt=S-De.left;if(!lt.length)return null;const sn=(Kt=ze.getChartStore)==null?void 0:Kt.call(ze),Ot=typeof(sn==null?void 0:sn.coordinateToFloatIndex)=="function"?sn.coordinateToFloatIndex(qt):(Zt=wt==null?void 0:wt.convertFromPixel)==null?void 0:Zt.call(wt,qt),vn=typeof(sn==null?void 0:sn.coordinateToDataIndex)=="function"?sn.coordinateToDataIndex(qt):null;if(!Rr(Ot)&&!Rr(vn))return null;let kn=0;const as=new Set;if(Rr(Ot)&&(as.add(Math.max(0,Math.min(lt.length-1,Math.round(Ot)))),as.add(Math.max(0,Math.min(lt.length-1,Math.floor(Ot)))),as.add(Math.max(0,Math.min(lt.length-1,Math.ceil(Ot))))),Rr(vn)&&as.add(Math.max(0,Math.min(lt.length-1,Math.round(vn)))),wt!=null&&wt.convertToPixel&&as.size){let Qn=-1,Fo=Number.POSITIVE_INFINITY;for(const ps of as){const Po=wt.convertToPixel(ps);if(!Rr(Po))continue;const Go=Math.abs(qt-Po);Go<Fo&&(Fo=Go,Qn=ps)}Qn>=0?kn=Qn:kn=Math.max(0,Math.min(lt.length-1,Math.round(Number(Ot||vn))))}else kn=Math.max(0,Math.min(lt.length-1,Math.round(Rr(vn)?vn:Ot)));const Ls=eu(ie);if(!(Ls!=null&&Ls.axis))return null;const Ys=Ls.axis,yn=j-De.top;let Vt=null,Pn=Number.POSITIVE_INFINITY;const Hn=Gu(wt,kn),Tn=Hn&&Number.isFinite(qt)?Math.abs(qt-Hn.x)<=Hn.half+Qi||Math.abs(S-(Hn.x+De.left))<=Hn.half+Qi:!0,bn=((an=ze.getIndicators)==null?void 0:an.call(ze,{paneId:ie}))||[],In=new Set(["line","bar","circle","rect"]);for(const Qn of bn){const Fo=Qn==null?void 0:Qn.__plotMeta,ps=Array.isArray(Fo==null?void 0:Fo.plots)?Fo.plots:[],Po=Array.isArray(Fo==null?void 0:Fo.plotKeys)?Fo.plotKeys:[],Go=lf(Qn,kn,lt);if(!(!Go&&!pd(Qn))){if(ps.length)ps.forEach((Ps,Ns)=>{var Mc;const si=String((Ps==null?void 0:Ps.type)||"line").toLowerCase();if(si==="candles"||si==="ohlc"||!pr.has(si)&&si!=="line")return;const Ec=Po[Ns]||(Ps==null?void 0:Ps.key);if(!Ec||String(Ec).startsWith("__"))return;const yc=ic(Go[Ec]);if(!Rr(yc))return;const Pc=Ys.convertToPixel(yc);if(!Rr(Pc))return;let rc=Math.abs(yn-Pc);if(si==="histogram"||si==="bar"){const $c=(Mc=Ys.getRange)==null?void 0:Mc.call(Ys),bl=(Ps==null?void 0:Ps.baseValue)??($c&&Number.isFinite($c.from)?$c.from:0),fl=Ys.convertToPixel(bl);if(Rr(fl)){const $u=Math.min(Pc,fl),sd=Math.max(Pc,fl);rc=Tn&&yn>=$u-1&&yn<=sd+1?0:rc}}rc>Zr+4||rc<Pn&&(Pn=rc,Vt={kind:"indicator",paneId:ie,barIndex:kn,indicatorId:Qn==null?void 0:Qn.id,indicatorName:(Qn==null?void 0:Qn.name)||(Fo==null?void 0:Fo.legend)||"indicator",plotKey:Ec,distance:rc})});else if(Array.isArray(Qn==null?void 0:Qn.figures))for(const Ps of Qn.figures){const Ns=String((Ps==null?void 0:Ps.type)||"line").toLowerCase();if(!In.has(Ns))continue;const si=Ps==null?void 0:Ps.key;if(!si)continue;const Ec=ic(Go[si]);if(!Rr(Ec))continue;const yc=Ys.convertToPixel(Ec);if(!Rr(yc))continue;let Pc=Math.abs(yn-yc);if(Ns==="bar"){const rc=(rs=Ys.getRange)==null?void 0:rs.call(Ys),Mc=(Ps==null?void 0:Ps.baseValue)??(rc&&Number.isFinite(rc.from)?rc.from:0),$c=Ys.convertToPixel(Mc);if(Rr($c)){const bl=Math.min(yc,$c),fl=Math.max(yc,$c);Pc=Tn&&yn>=bl-1&&yn<=fl+1?0:Pc}}Pc>Zr+4||Pc<Pn&&(Pn=Pc,Vt={kind:"indicator",paneId:ie,barIndex:kn,indicatorId:Qn==null?void 0:Qn.id,indicatorName:(Qn==null?void 0:Qn.name)||"indicator",plotKey:si,distance:Pc})}if(!ps.length&&(!Array.isArray(Qn==null?void 0:Qn.figures)||Qn.figures.length===0)){if(Df(Qn)){const Ps=(Sn=ze.getVisibleRange)==null?void 0:Sn.call(ze),Ns=Number.isFinite(Ps==null?void 0:Ps.from)?Ps.from:Math.max(0,kn-200),si=Number.isFinite(Ps==null?void 0:Ps.to)?Ps.to:Math.min(lt.length-1,kn+200),Ec=nm(Qn,lt,Ns,si);if(Ec>0){const yc=(Xs=lt[kn])==null?void 0:Xs.timestamp,Pc=yc!=null?(Ni=Qn.result)==null?void 0:Ni[yc]:null,rc=ic(Pc==null?void 0:Pc.volume);if(Rr(rc)){const Mc=Li(De),$c=Math.min(1,rc/Ec),bl=Math.max(1,Math.floor($c*Mc.effectiveBandHeight)),fl=Mc.bandBottom-bl;Tn&&yn>=fl-1&&yn<=Mc.bandBottom+1&&(Pn=0,Vt={kind:"indicator",paneId:ie,barIndex:kn,indicatorId:Qn==null?void 0:Qn.id,indicatorName:(Qn==null?void 0:Qn.name)||"VOL",plotKey:"volume",distance:0})}}}else if(pd(Qn)){const Ps=nt(Array.isArray(Qn==null?void 0:Qn.result)?Qn.result:[],kn);if(Rr(Ps)){const Ns=Ys.convertToPixel(Ps);if(Rr(Ns)){const si=Math.abs(yn-Ns);Tn&&si<=Zr+6&&si<Pn&&(Pn=si,Vt={kind:"indicator",paneId:ie,barIndex:kn,indicatorId:Qn==null?void 0:Qn.id,indicatorName:(Qn==null?void 0:Qn.name)||"ZIGZAG",plotKey:"zigzag",distance:si})}}}}}}if(ie==="candle_pane"){const Qn=lt[kn],Fo=ic((Qn==null?void 0:Qn.open)??(Qn==null?void 0:Qn.o)??(Qn==null?void 0:Qn.price)??(Qn==null?void 0:Qn.value)),ps=ic((Qn==null?void 0:Qn.close)??(Qn==null?void 0:Qn.c)??(Qn==null?void 0:Qn.price)??(Qn==null?void 0:Qn.value)),Po=ic((Qn==null?void 0:Qn.high)??(Qn==null?void 0:Qn.h)),Go=ic((Qn==null?void 0:Qn.low)??(Qn==null?void 0:Qn.l));if(Rr(Fo)&&Rr(ps)&&Rr(Po)&&Rr(Go)&&Hn){const Ps=Ys.convertToPixel(Math.max(Fo,ps)),Ns=Ys.convertToPixel(Math.min(Fo,ps)),si=Ys.convertToPixel(Po),Ec=Ys.convertToPixel(Go),yc=Math.min(si,Ec,Ps,Ns),Pc=Math.max(si,Ec,Ps,Ns);if(Tn&&yn>=yc-6&&yn<=Pc+6){const rc=(Fo+ps)/2,Mc=Ys.convertToPixel(rc);Rr(Mc)&&Math.abs(yn-Mc)<Pn&&(Pn=Math.abs(yn-Mc),Vt={kind:"candle",paneId:ie,barIndex:kn,distance:Pn})}}}return Vt},Em=()=>{var ie;if(!o()||!i(fd))return;const S=o(),j=Lc(i(fd).paneId,i(fd).id),Q=fr.get(j);if(Q==null)return;const ue={paneId:i(fd).paneId,zLevel:Q};i(fd).id?ue.id=i(fd).id:i(fd).name&&(ue.name=i(fd).name),(ie=S.overrideIndicator)==null||ie.call(S,ue)},Vg=S=>{var Ot,vn,kn,as,Ls;const j=(S==null?void 0:S.kind)==="indicator"?S.indicatorId:"",Q=(S==null?void 0:S.kind)==="indicator"?S.indicatorName:"",ue=(S==null?void 0:S.kind)==="indicator"?S.paneId:"",ie=((Ot=i(fd))==null?void 0:Ot.id)||"",De=((vn=i(fd))==null?void 0:vn.paneId)||"";if(j===ie&&ue===De||(ie&&Em(),x(fd,V(j?{id:j,name:Q,paneId:ue}:null)),!o()||!j))return;const ze=o(),lt=Lc(ue,j),qt=(((kn=ze.getIndicators)==null?void 0:kn.call(ze,{id:j,paneId:ue}))||((as=ze.getIndicators)==null?void 0:as.call(ze,{name:Q,paneId:ue}))||[])[0];if(!qt)return;fr.has(lt)||fr.set(lt,qt.zLevel);const sn={paneId:ue,zLevel:Math.max(er,qt.zLevel)};j?sn.id=j:Q&&(sn.name=Q),(Ls=ze.overrideIndicator)==null||Ls.call(ze,sn)},kg=S=>{x(yu,V(S)),Vg(S)},Fv=()=>{i(fd)&&Em(),x(fd,null),x(yu,null)},Op=S=>{x(Kc,V(S?{kind:S.kind,paneId:S.paneId,barIndex:S.barIndex,indicatorId:S.indicatorId,indicatorName:S.indicatorName,plotKey:S.plotKey}:null))},bu=S=>{var De;if(!J)return;const j=o(),Q=((De=j==null?void 0:j.getDrawPanes)==null?void 0:De.call(j))??(j==null?void 0:j._drawPanes)??[],ue=typeof window<"u"&&!!window.__overlayHover,ie=S||(i(Rm)||i(Nh)?"grabbing":i(vf)||i(yu)||ue?"pointer":null);Q.forEach(ze=>{var lt,wt,qt;try{(qt=(wt=(lt=ze==null?void 0:ze.getMainWidget)==null?void 0:lt.call(ze))==null?void 0:wt.setForceCursor)==null||qt.call(wt,ie)}catch{}}),J.style.cursor=ie??""};let ov=xe(0),$m=xe(0),og=xe(0),sm=xe(0),vf=xe(""),Dm=xe(""),Rm=xe(""),Nh=xe(""),qh={x:6,y:4};const ah=new Map;let Lv=[],x0=0,Sg=null,Ev=null,bv=null,lh=null,ch=null,ig=null;const uh=new Map;let rg=null,sp=null;const O0=()=>!1;let Cg=xe(!1),ne=xe(0),fe=xe(0),qe=xe(""),ot,Wt=xe(!1),Ct=xe(""),un=0,Ln=0,Un=null,Ws=xe(V([])),bo=xe(0),Ts=xe(!1),Oo=null,_i=xe(1),to=xe(V([])),Ha=xe(0),Ta=xe(!1),dl=xe(!1),yl=0,Ml="",Gl="",wd=!1,fc="none";const md=S=>{var j;try{const Q=(j=S==null?void 0:S.getPaneOptions)==null?void 0:j.call(S);if(!Array.isArray(Q)||!Q.some(ie=>(ie==null?void 0:ie.state)==="maximize"))return;Q.forEach(ie=>{var De;(ie==null?void 0:ie.state)==="maximize"&&((De=S.setPaneOptions)==null||De.call(S,{id:ie.id,state:"normal"}))}),Fl()}catch{}},Yp=S=>{var ue,ie,De,ze,lt,wt;const j=((ie=(ue=S.getSize)==null?void 0:ue.call(S))==null?void 0:ie.height)??(J==null?void 0:J.clientHeight)??((De=J==null?void 0:J.getBoundingClientRect)==null?void 0:De.call(J).height)??0;return{width:((lt=(ze=S.getSize)==null?void 0:ze.call(S))==null?void 0:lt.width)??(J==null?void 0:J.clientWidth)??((wt=J==null?void 0:J.getBoundingClientRect)==null?void 0:wt.call(J).width)??0,height:j}},xu=S=>{const{width:j,height:Q}=Yp(S);if(!Q)return 0;if(am()){const ie=j>0&&Q>0&&j>Q?.3:.25;return Math.round(Q*ie)}return Math.round(Q*.3)},Xd=S=>{const{height:j}=Yp(S),Q=j>0?Math.round(j*.06):0;return Math.max(ny,Q)},vo=(S,j)=>Math.max(j,Math.round(S||0)),go=(S,j,Q)=>{var ie;Array.from(new Set(j.filter(Boolean))).forEach(De=>{var lt,wt,qt,sn,Ot;const ze=((lt=S.getDrawPaneById)==null?void 0:lt.call(S,De))??((wt=S._drawPanes)==null?void 0:wt.find(vn=>{var kn;return((kn=vn==null?void 0:vn.getId)==null?void 0:kn.call(vn))===De}));if(ze){try{(qt=ze.setOptions)==null||qt.call(ze,{height:Q})}catch{}try{(sn=ze.setOriginalBounding)==null||sn.call(ze,{height:Q})}catch{}try{(Ot=ze.setBounding)==null||Ot.call(ze,{height:Q})}catch{}}});try{(ie=S.layout)==null||ie.call(S,{measureHeight:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})}catch{}};function yi(S){var j,Q;if(o())try{const ue=o(),ie=((j=ue.getPaneOptions)==null?void 0:j.call(ue,S))||null,De=(ie==null?void 0:ie.state)||"normal",ze=De==="maximize"?"normal":"maximize";(Q=ue.setPaneOptions)==null||Q.call(ue,{id:S,state:ze}),Fl(),m("🖱️ Pane double-click toggle",{paneId:S,from:De,to:ze})}catch(ue){console.warn("⚠️ Failed to toggle pane state",S,ue)}}function Jr(S){var ze;if(!o()||!J)return;const j=o();try{if(!(((ze=j.getIndicators)==null?void 0:ze.call(j))??[]).some(qt=>qt.paneId&&qt.paneId!=="candle_pane"))return}catch{return}const Q=j._drawPanes;if(!Array.isArray(Q)||Q.length===0){yi("candle_pane");return}const ue=J.getBoundingClientRect(),ie=S.clientY-ue.top;let De=null;for(const lt of Q){if(!lt||typeof lt.getId!="function"||typeof lt.getBounding!="function")continue;const wt=lt.getId();if(wt==="x_axis_pane")continue;const qt=lt.getBounding();if(!qt||typeof qt.height!="number")continue;const sn=typeof qt.top=="number"?qt.top:0,Ot=qt.height;if(ie>=sn&&ie<=sn+Ot){De=wt;break}}De||(De="candle_pane"),yi(De)}function Yl(S){const j=J==null?void 0:J.getBoundingClientRect();if(j){x(ov,S.clientX-j.left),x($m,S.clientY-j.top);let Q;if(ev("interactionV2")){const De=Gk(S),{hoverId:ze,draggingId:lt,resizingId:wt,cursor:qt}=Jk(i(ov),i($m),Lv,De);x(vf,V(ze??"")),x(Rm,V(lt??"")),x(Nh,V(wt??"")),Q=qt,(lt||wt)&&(S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation(),Pl())}const ue=typeof window<"u"&&!!window.__overlayHover,ie=!!(i(Rm)||i(Nh)||i(vf));x5({interactionActive:ie,overlayHover:ue})?kg(pu(i(ov),i($m))):kg(null),bu(Q)}x(og,V(S.clientX)),x(sm,V(S.clientY)),We.length&&ol()}function Eu(S){if(S.__interactionV2Handled)return;const j=_u(S);if(j&&(j.selectedId||j.draggingId||j.resizingId)){S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation();return}if(S.button!==0)return;const Q=J==null?void 0:J.getBoundingClientRect();if(!Q)return;const ue=typeof window<"u"&&!!window.__overlayHover,ie=!!(i(Rm)||i(Nh)||i(vf));if(!x5({interactionActive:ie,overlayHover:ue}))return;const De=S.clientX-Q.left,ze=S.clientY-Q.top,lt=pu(De,ze);Op(lt),Pl()}function nd(){x(ov,-1),x($m,-1),x(og,-1),x(sm,-1),ev("interactionV2")&&x(vf,""),Fv(),bu(),af()}function dp(S){var ue;if(S.preventDefault(),am()&&Date.now()-i(iv)<1e3)return;const j=J==null?void 0:J.getBoundingClientRect(),Q=(ue=i(ct))==null?void 0:ue.getBoundingClientRect();if(j&&Q){const ie=S.clientX-Q.left,De=S.clientY-Q.top,ze=S.clientX-j.left,lt=S.clientY-j.top,wt=Fp(ze,lt);x(Bm,V({x:ze,y:lt,paneId:(wt==null?void 0:wt.paneId)||"candle_pane"}));const sn=typeof window<"u"&&!!window.__overlayHover&&typeof window<"u"?window.__overlayHoverId:null,Ot=typeof window<"u"?window.__overlayRightClickId:null,vn=typeof window<"u"?window.__overlayRightClickAt:null,kn=Date.now(),as=Ot&&typeof vn=="number"&&kn-vn<500,Ls=as?Ot:sn;x(ne,ie),x(fe,De),x(qe,V(rv())),as&&typeof window<"u"&&(window.__overlayRightClickId=null,window.__overlayRightClickAt=null),Wm(ie,De,Ls??null)}}function Ic(S){var j;if(S.touches.length===1){const Q=S.touches[0];x(iv,V(Date.now()));const ue=J==null?void 0:J.getBoundingClientRect();ue&&(x(ov,Q.clientX-ue.left),x($m,Q.clientY-ue.top)),x(og,V(Q.clientX)),x(sm,V(Q.clientY));const ie=S.target;if(i(Cg)&&ie&&(ie.closest(".modal-content")||ie.closest(".action-btn")))return;const De=Date.now(),ze=De-un;if(ze<300&&ze>0){if(Ln+=1,Ln===2){S.preventDefault();const lt=(j=i(ct))==null?void 0:j.getBoundingClientRect();if(ue&&lt){const wt=Q.clientX-lt.left,qt=Q.clientY-lt.top,sn=Q.clientX-ue.left,Ot=Q.clientY-ue.top,vn=Fp(sn,Ot);x(Bm,V({x:sn,y:Ot,paneId:(vn==null?void 0:vn.paneId)||"candle_pane"})),x(qe,V(rv())),Wm(wt,qt,null)}Ln=0;return}}else if(Ln=1,i(Cg)){S.preventDefault(),zp(),Ln=0;return}un=De,Un&&clearTimeout(Un),Un=setTimeout(()=>{Ln=0},300)}}function zp(){x(Cg,!1)}let nu=xe(!1),zi=xe(0),jm=xe(0),op=xe(null),_m=xe(!1),dh=xe(0),Kp=xe(0),Xp=xe(!0),ym=xe(""),Ah=xe(""),Rf=xe(""),Bm=xe(null),Om=xe(""),Uh=xe(""),om=xe(""),bm=xe(""),zm=xe("");const fp=8,Td="__SMARTCHART_OVERLAY__:";let iv=xe(0);function $v(){var S,j;try{const Q=(S=s())==null?void 0:S.styles;if((Q==null?void 0:Q.backgroundType)==="gradient"&&Q.backgroundGradient){const ue=Ul(Q.backgroundGradient);if(ue)return ue}if(Q!=null&&Q.backgroundColor)return Q.backgroundColor}catch{}{const Q=document.querySelector(".duty-widget")||document.querySelector(".duty-main");if(Q){const ue=window.getComputedStyle(Q),ie=(ue.getPropertyValue("--chart-background-color")||"").trim();if(ie&&!/gradient/i.test(ie))return ie;const De=(ue.backgroundColor||"").trim();if(De&&De!=="transparent"&&De!=="rgba(0, 0, 0, 0)")return De}}return((j=s())==null?void 0:j.theme)==="dark"?"#0A0F1A":"#ffffff"}function Vm(){const S=$v(),j=Md(S);x(Om,V(j));const ue=Vc(tu(j))>.5;x(Uh,V(ue?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.12)")),x(om,V(ue?"rgba(255, 255, 255, 0.28)":"rgba(0, 0, 0, 0.2)")),x(bm,V(ue?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)"))}function fh(){const S=[`left: ${i(zi)}px`,`top: ${i(jm)}px`];i(Om)&&S.push(`--menu-text: ${i(Om)}`),i(Uh)&&S.push(`--menu-btn-border: ${i(Uh)}`),i(om)&&S.push(`--menu-btn-hover-border: ${i(om)}`),i(bm)&&S.push(`--menu-hover-bg: ${i(bm)}`),x(zm,V(S.join("; ")))}async function Gh(){var j,Q,ue;x(ym,""),x(Ah,""),x(Rf,"");const S=!!((Q=(j=i(Be))==null?void 0:j.hasCopiedOverlay)!=null&&Q.call(j));if(!((ue=navigator==null?void 0:navigator.clipboard)!=null&&ue.readText)){S&&x(ym,"overlay");return}try{const De=(await navigator.clipboard.readText()).trim();if(De&&De.startsWith(Td)){x(ym,"overlay"),x(Rf,V(De));return}if(De){x(ym,"text"),x(Ah,V(De)),x(Rf,V(De));return}}catch{}S&&x(ym,"overlay")}function wu(S){if(!S)return!0;const j=wn.get(S,"grid.show");if(typeof j=="boolean")return j;const Q=wn.get(S,"grid.horizontal.show"),ue=wn.get(S,"grid.vertical.show");return typeof Q=="boolean"||typeof ue=="boolean"?(typeof Q=="boolean"?Q:!0)&&(typeof ue=="boolean"?ue:!0):!0}function Lp(){var De,ze,lt;const S=o();if(!S){Af();return}const j=((De=S.getStyles)==null?void 0:De.call(S))??{},ue=!wu(j),ie=wn.cloneDeep(j);(lt=(ze=s().styles)==null?void 0:ze.candle)!=null&&lt.type&&wn.set(ie,"candle.type",s().styles.candle.type),wn.set(ie,"grid.show",ue),wn.set(ie,"grid.horizontal.show",ue),wn.set(ie,"grid.vertical.show",ue);try{S.setStyles(qd(ie))}catch{S.setStyles(ie)}try{D().update(wt=>(wt.styles||(wt.styles={}),wn.set(wt.styles,"grid.show",ue),wn.set(wt.styles,"grid.horizontal.show",ue),wn.set(wt.styles,"grid.vertical.show",ue),wt))}catch{}x(Xp,ue),Af()}function ph(){if(!i(Mt)||!J||!i(ct))return;const S=i(Mt).getBoundingClientRect(),j=i(ct).getBoundingClientRect(),Q=J.getBoundingClientRect(),ue=Q.left-j.left,ie=Q.top-j.top,De=ue+Q.width,ze=ie+Q.height;let lt=i(zi),wt=i(jm);lt+S.width+fp>De&&(lt=De-S.width-fp),lt<ue+fp&&(lt=ue+fp),wt+S.height+fp>ze&&(wt=ze-S.height-fp),wt<ie+fp&&(wt=ie+fp),(lt!==i(zi)||wt!==i(jm))&&(x(zi,V(Math.round(lt))),x(jm,V(Math.round(wt))),fh())}function im(){requestAnimationFrame(()=>{ph()})}function Wm(S,j,Q){var ue,ie,De,ze;if(x(zi,V(Math.round(S))),x(jm,V(Math.round(j))),x(op,V(Q??null)),x(_m,!1),x(dh,0),x(Kp,0),i(op)&&((ue=i(Be))!=null&&ue.getOverlayLockInfo)){const lt=i(Be).getOverlayLockInfo(i(op));lt?x(_m,V(!!lt.manualLock)):x(op,null)}try{const lt=o();if(lt!=null&&lt.getIndicators){const wt=lt.getIndicators()||[];x(dh,V(Array.isArray(wt)?wt.length:0))}}catch{}try{let lt=0,wt=0;if(sl&&(lt=sl.getCurrentSymbolDrawings().length),(ie=o())!=null&&ie.getOverlays){const qt=o().getOverlays({groupId:"drawing_tools"})||[];wt=Array.isArray(qt)?qt.length:0}x(Kp,V(Math.max(lt,wt)))}catch{}try{x(Xp,V(wu((ze=(De=o())==null?void 0:De.getStyles)==null?void 0:ze.call(De))))}catch{}i(op)?(x(ym,""),x(Ah,""),x(Rf,"")):Gh(),Vm(),fh(),x(nu,!0),im()}function Af(){x(nu,!1),x(op,null),x(_m,!1),x(dh,0),x(Kp,0),x(Xp,!0),x(ym,""),x(Ah,""),x(Rf,""),x(Bm,null),x(Om,""),x(Uh,""),x(om,""),x(bm,""),x(zm,"")}function xm(){x(Yt,!i(Yt)),i(Yt)||x(qn,!1),gi()}function rm(){var j;if(!o())return;const S=o();try{(((j=S.getIndicators)==null?void 0:j.call(S))??[]).forEach(ue=>{const ie=ue.paneId||"candle_pane";try{if(ue.id){S.removeIndicator({id:ue.id,paneId:ie});return}}catch{}try{ue.name&&S.removeIndicator({name:ue.name,paneId:ie})}catch{}})}catch{}try{D().update(Q=>(Q.saveInds={},Q)),vv()}catch{}Af()}function mh(){var S,j,Q,ue;try{sl&&sl.clearCurrentSymbolDrawings()}catch{}try{const ie=((j=(S=o())==null?void 0:S.getOverlays)==null?void 0:j.call(S,{groupId:"drawing_tools"}))||[];for(const De of ie)try{(ue=(Q=o())==null?void 0:Q.removeOverlay)==null||ue.call(Q,{id:De.id})}catch{}}catch{}Af()}function Hm(){var S;try{if(i(xt))return;const j=o();if(!j)return;const Q=j.getVisibleRange(),ue=((S=j.getDataList)==null?void 0:S.call(j))??[];if(!Q||!Array.isArray(ue)||ue.length===0)return;const ie=Q.to-Q.from+1;x(Je,ie),x(Xe,Q.to>=ue.length-2),x(xt,!0)}catch{}}function $l(){var j,Q,ue;const S=o();if(S)try{Hm();const ie=J==null?void 0:J.getBoundingClientRect(),De=ie?ie.width:((j=S.getSize())==null?void 0:j.width)??0,ze=S.getDataList(),lt=Math.min(180,Array.isArray(ze)?ze.length:180),wt=Math.max(1,i(Je)??lt),qt=S.getChartStore(),sn=De>0?Math.floor(De/wt):qt.getBarSpace().bar,Ot=Math.max(1,Math.min(50,sn));qt.setBarSpace(Ot);const vn=((Q=qt.getInitialOffsetRightDistance)==null?void 0:Q.call(qt))??qt.getOffsetRightDistance();qt.setOffsetRightDistance(vn,!0),S.scrollToRealTime(),(ue=S._drawPanes)==null||ue.forEach(as=>{var Ys,yn,Vt;const Ls=(Ys=as==null?void 0:as.getAxisComponent)==null?void 0:Ys.call(as);(yn=Ls==null?void 0:Ls.setAutoCalcTickFlag)==null||yn.call(Ls,!0),(Vt=Ls==null?void 0:Ls.buildTicks)==null||Vt.call(Ls,!0)})}finally{Af()}}function am(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}async function hh(S){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(S),m("✅ Copied using modern clipboard API"),!0}catch(j){console.warn("Modern clipboard API failed:",j)}try{const j=document.createElement("textarea");j.value=S,j.style.position="fixed",j.style.left="-999999px",j.style.top="-999999px",j.style.opacity="0",j.style.pointerEvents="none",j.setAttribute("readonly",""),document.body.appendChild(j),j.focus(),j.select(),j.setSelectionRange(0,S.length);const Q=document.execCommand("copy");if(document.body.removeChild(j),Q)return m("✅ Copied using fallback method"),!0}catch(j){console.error("Fallback copy method failed:",j)}try{const j=window.getSelection();if(j){const Q=document.createRange(),ue=document.createElement("span");ue.textContent=S,ue.style.position="fixed",ue.style.left="-999999px",ue.style.opacity="0",document.body.appendChild(ue),Q.selectNode(ue),j.removeAllRanges(),j.addRange(Q);const ie=document.execCommand("copy");if(document.body.removeChild(ue),j.removeAllRanges(),ie)return m("✅ Copied using selection API fallback"),!0}}catch(j){console.error("Selection API fallback failed:",j)}return console.error("❌ All copy methods failed"),!1}function Zp(){const S=o();if(!S)return console.error("Chart not initialized"),!1;try{const j=S.getDataList();if(j.length<10)return console.warn("⚠️ Need more historical data for prediction"),!1;const Q=j[j.length-1],ie=mp(s().period.timeframe)*1e3;if(!CJ(Q.timestamp,ie)&&i(bo)===0){const as=Date.now()-Q.timestamp,Ls=Math.floor(as/6e4);console.info(`ℹ️ Market appears to be open (last candle ${Ls}m ago). Prediction is most useful when market is closed.`)}const ze=j,lt=SJ(ze);if(!lt)return console.error("❌ Failed to generate prediction"),!1;x(Ws,V([...i(Ws),lt])),AC(bo);const wt=[...ze,lt],qt=S.getVisibleRange(),sn=qt?qt.to>=ze.length-2:!0;S.applyNewData(wt,!1);try{(wt??[]).length>0&&x(st,!0)}catch{}sn&&setTimeout(()=>{S.scrollToRealTime()},50);const Ot=ze[ze.length-1].close,vn=(lt.close-Ot)/Ot*100,kn=vn>0?"📈":"📉";return m(`${kn} Prediction #${i(bo)}: ${vn>0?"+":""}${vn.toFixed(2)}% (Close: ${lt.close.toFixed(2)})`),m("✅ Prediction added:",lt),m("📊 Total predictions so far:",i(bo)),!0}catch(j){return console.error("❌ Prediction error:",j),!1}}function Th(){return Math.round(2e3/i(_i))}function xv(){if(!i(Ts))return;Oo&&(clearInterval(Oo),Oo=null);const S=Th();Oo=setInterval(()=>{i(Ts)&&(gf()?Kh():Zp())},S),m(`⚡ Speed changed: ${i(_i)}x (${S}ms interval)`)}function ag(S){x(_i,V(S)),xv()}async function Ep(){if(i(Ts))return;if(gf()&&!await wv()){Xv(!1);return}x(Ts,!0),gf()?Kh():Zp();const S=Th();Oo=setInterval(()=>{i(Ts)&&(gf()?Kh():Zp())},S)}function $p(){x(Ts,!1),Oo&&(clearInterval(Oo),Oo=null)}async function qm(){i(Ts)?$p():await Ep()}function Fh(){const S=o();if(!(!S||i(Ws).length===0)){$p();try{const j=S.getDataList(),Q=new Set(i(Ws).map(ie=>ie.timestamp)),ue=j.filter(ie=>!Q.has(ie.timestamp));S.applyNewData(ue,!1),x(Ws,V([])),x(bo,0),m("🧹 Predictions cleared")}catch(j){console.error("❌ Error clearing predictions:",j)}}}const Yh=S=>{try{return new Date(S).toLocaleDateString()}catch{return String(S)}},lg=(S,j)=>`${Yh(S)} - ${Yh(j)}`;function gf(){const S=r().replayFrom,j=r().replayTo;return!!(r().replayActive&&Number.isFinite(S)&&Number.isFinite(j))}async function wm(S){let j=null;for(const Q of te)try{const ue=await T.ensureHistoryBefore(S,Q.timeframe,0,1200),ie=Array.isArray(ue==null?void 0:ue.candles)?ue.candles:[];if(!ie.length)continue;const De=ie[ie.length-1].timestamp-ie[0].timestamp,ze=ie.length;(!j||De>j.span||De===j.span&&ze>j.count)&&(j={period:Q,span:De,count:ze})}catch{}return(j==null?void 0:j.period)??null}const Dv=S=>{var ue,ie,De,ze,lt,wt,qt,sn;if(!S.length)return S;let j=S.slice();const Q=((ie=(ue=s().styles)==null?void 0:ue.candle)==null?void 0:ie.type)||vx((ze=(De=o())==null?void 0:De.getStyles)==null?void 0:ze.call(De),s().styles);if(Q==="heikin_ashi")j=Ib(j);else if(Q==="renko_atr"){try{const vn=Dd(S);vn!=null&&(!Ii||vn<Ii)&&(Ii=vn)}catch{}const Ot=((wt=(lt=s().styles)==null?void 0:lt.candle)==null?void 0:wt.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};j=Pb(j,Ot)}else if(Q==="point_and_figure"){const Ot=((sn=(qt=s().styles)==null?void 0:qt.candle)==null?void 0:sn.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};j=Mb(j,Ot)}return j};async function Rv(S){const{symbol:j,timeframe:Q,available:ue}=S;if(ue){const De=`${j.ticker}|${Q}|${ue.earliest}|${ue.latest}`;if(De!==Ml){Ml=De;const ze=`Historical data not available for ${j.ticker} (${Q}). Available range: ${lg(ue.earliest,ue.latest)}.
OK = continue with available data. Cancel = change timeframe.`;if(typeof window<"u"?window.confirm(ze):!1){m8(ue.earliest,ue.latest);return}}}const ie=await wm(j);if(ie){D().update(De=>(De.period=ie,De));return}$t.addAlert("warning",`No historical data available for ${j.ticker}. Simulator stopped.`),c6()}async function Um(S,j){const Q=o();if(Q&&!(!Number.isFinite(S)||!Number.isFinite(j))){x(dl,!0),x(Ta,!1),x(to,V([])),x(Ha,0),$p(),Xv(!1),Fh();try{if(qs){try{qs()}catch{}qs=null}try{T.unsubscribe()}catch{}N={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1};const ue=yl+=1,ie=s().symbol,De=s().period.timeframe,ze=await T.ensureHistoryCovers(ie,De,S,j,3500);if(ue!==yl)return;const lt=Array.isArray(ze==null?void 0:ze.candles)?ze.candles.slice():[];if(!lt.length){await Rv({symbol:ie,timeframe:De,available:null});return}lt.sort((Ot,vn)=>Ot.timestamp-vn.timestamp);const wt={earliest:lt[0].timestamp,latest:lt[lt.length-1].timestamp},qt=lt.filter(Ot=>Ot.timestamp>=S&&Ot.timestamp<=j);if(!qt.length){await Rv({symbol:ie,timeframe:De,available:wt});return}let sn=Dv(qt);sn=sn.slice().sort((Ot,vn)=>Ot.timestamp-vn.timestamp),x(to,V(sn)),x(Ta,!0),x(Ha,0);try{Q.applyNewData([],!1),x(st,!0)}catch{}m("✅ Replay data prepared",{symbol:ie.ticker,timeframe:De,bars:i(to).length})}catch(ue){console.error("❌ Failed to prepare replay data:",ue),$t.addAlert("error","Failed to load historical data for simulator.")}finally{x(dl,!1)}}}function Kh(){var ue;const S=o();if(!S||!i(Ta))return!1;if(i(Ha)>=i(to).length)return $p(),Xv(!1),$t.addAlert("info","Simulation complete (last candle reached)."),!1;const j=i(to)[i(Ha)];x(Ha,i(Ha)+1);const Q=((ue=S.getDataList)==null?void 0:ue.call(S))??[];if(Q.length)try{S.getChartStore().addData([j],"backward",{forward:!0,backward:!1})}catch{const ie=[...Q,j].sort((De,ze)=>De.timestamp-ze.timestamp);S.applyNewData(ie,!1)}else{S.applyNewData([j],!1);try{Hm()}catch{}x(st,!0)}try{requestAnimationFrame(()=>{var ie;(ie=S.scrollToRealTime)==null||ie.call(S)})}catch{}return i(Ha)>=i(to).length&&($p(),Xv(!1),$t.addAlert("info","Simulation complete (last candle reached).")),!0}async function wv(){if(!gf())return!1;if(i(Ta))return!0;if(i(dl)){const Q=Date.now();for(;i(dl)&&Date.now()-Q<8e3;)await new Promise(ue=>setTimeout(ue,150));return i(Ta)}const S=Number(r().replayFrom),j=Number(r().replayTo);return!Number.isFinite(S)||!Number.isFinite(j)?!1:(await Um(S,j),i(Ta))}function cg(S){if($p(),x(Ta,!1),x(to,V([])),x(Ha,0),Ml="",Gl="",!$()){const j=Er();oc(j),o()&&(qs=Mf(o()))}}function rv(){var j,Q,ue,ie;const S=o();if(!S||i(ov)===null||i($m)===null)return"";try{const De=(bn,In)=>{if(!Number.isFinite(bn)||bn===0)return`${bn}`;const Hs=bn<0?"-":"",Xt=Math.abs(bn),jn=Math.floor(Math.log10(Xt))+1;let Jn=Xt/Math.pow(10,jn),Kt=jn;const Zt=Number(Jn.toFixed(In));return Zt>=1?(Jn=Zt/10,Kt=jn+1):Jn=Zt,`${Hs}${Jn.toFixed(In)}e${Kt}`},ze=bn=>{var jn,Jn;const In=Number((Jn=(jn=S==null?void 0:S.getSymbol)==null?void 0:jn.call(S))==null?void 0:Jn.pricePrecision);let Hs=Number.isFinite(In)?Math.max(0,Math.min(12,Math.trunc(In))):$_(s().symbol);const Xt=Ab(s().symbol);if(Number.isFinite(bn)&&Math.abs(bn)>=1e4)Hs=2;else if(Xt==="crypto"&&Number.isFinite(bn)){const Kt=Math.abs(bn);Kt>=1e3?Hs=2:Kt>=1?Hs=Math.min(Math.max(Hs,2),4):Kt>=.01?Hs=Math.min(Math.max(Hs,4),8):Hs=Math.min(Math.max(Hs,6),12)}return Math.max(0,Math.min(12,Math.trunc(Hs)))},lt=bn=>{try{const In=Ab(s().symbol);if((In==="stock"||In==="crypto")&&Number.isFinite(bn)){const Hs=Math.abs(bn);if(Hs>0&&Hs<1e-4)return De(bn,5)}}catch{}return bn.toFixed(ze(bn))},wt=Fp(i(ov),i($m)),qt=(ie=(ue=(j=S.getChartStore)==null?void 0:(Q=j.call(S)).getCrosshair)==null?void 0:ue.call(Q))==null?void 0:ie.paneId,sn=(wt==null?void 0:wt.paneId)||qt||"candle_pane",Ot=sn==="candle_pane",vn=bn=>{var In,Hs,Xt,jn;if(!Number.isFinite(bn))return"";try{const Kt=(((In=S.getIndicators)==null?void 0:In.call(S,{paneId:sn}))||[]).reduce((rs,Sn)=>{const Xs=Number(Sn==null?void 0:Sn.precision);return Number.isFinite(Xs)?Math.max(rs,Xs):rs},2),Zt=((Hs=S.getDrawPaneById)==null?void 0:Hs.call(S,sn))??((Xt=S._drawPanes)==null?void 0:Xt.find(rs=>{var Sn;return((Sn=rs==null?void 0:rs.getId)==null?void 0:Sn.call(rs))===sn})),an=(jn=Zt==null?void 0:Zt.getAxisComponent)==null?void 0:jn.call(Zt);return an!=null&&an.displayValueToText?an.displayValueToText(bn,Kt):bn.toFixed(Math.max(0,Math.min(12,Kt)))}catch{return bn.toFixed(2)}};if(S&&typeof S.convertFromPixel=="function")try{const bn=S.convertFromPixel([{x:i(ov),y:i($m)}],{paneId:sn,absolute:!0});if(bn&&Array.isArray(bn)&&bn[0]&&typeof bn[0].value=="number")return Ot?lt(bn[0].value):vn(bn[0].value)}catch{}if(!Ot)return"";const kn=S.getVisibleRange(),as=S.getDataList();if(!as||as.length===0||!kn)return"";const Ls=as.slice(kn.from,kn.to+1);if(Ls.length===0)return"";let Ys=1/0,yn=-1/0;Ls.forEach(bn=>{Ys=Math.min(Ys,bn.low),yn=Math.max(yn,bn.high)});const Vt=yn-Ys;if(Vt<=0)return"";const Pn=J==null?void 0:J.getBoundingClientRect();if(!Pn)return"";const Hn=i($m)/Pn.height,Tn=yn-Hn*Vt;return lt(Tn)}catch{return""}}var vh=Yoe();vh.__click=[$oe,a,O];var lm=y(vh);Ro(lm,5,f,S=>S.id,(S,j)=>{FC(S,{get type(){return i(j).type},get text(){return i(j).text}})}),_(lm);var Ig=v(lm,2);ep(RZ(Ig,{get customLoad(){return $()},get mainContainer(){return i(ct)},set mainContainer(S){x(ct,V(S))},get sidebarHost(){return i(Ce)},set sidebarHost(S){x(Ce,V(S))},onToggleScriptStudio:xm}),S=>x(Qe,V(S)),()=>i(Qe));var cm=v(Ig,2),av=y(cm),lv=y(av),jv=y(lv),jf=y(jv);ep(VO(jf,{}),S=>x(Be,V(S)),()=>i(Be)),_(jv);var Wl=v(jv,2);Ye(Wl,()=>!i(st)||i(fo),S=>{var j=Doe();Y(S,j)});var Dl=v(Wl,2);Dl.__keydown=ba,Dl.__contextmenu=dp,Dl.__mousemove=Yl,Dl.__mousedown=Eu,Dl.__mouseup=[Ioe,Rm,Nh,bu],Dl.__dblclick=Jr,Dl.__touchstart=Ic,Dl.__click=[Poe,Cg,zp,nu,Af];var gd=y(Dl);ep(gd,S=>de=S,()=>de);var Lh=v(gd,2);ep(Lh,S=>le=S,()=>le);var gh=v(Lh,2);ep(gh,S=>he=S,()=>he),_(Dl),ep(Dl,S=>J=S,()=>J);var Bv=v(Dl,2);FJ(Bv,{}),_(lv);var Eh=v(lv,2);const Ip=At(()=>`height: ${i(Yt)?`${Math.round(i(Dn)*100)}%`:"0px"};`);var Vp=y(Eh);Vp.__mousedown=Xi,Vp.__touchstart=Xi;var $h=v(Vp,2);$h.__touchmove=[Roe];var cv=y($h);LC(cv,()=>i(ro),S=>{var j=At(()=>i(cc)?d()[i(cc)]:null),Q=At(()=>i(cc)?h()[i(cc)]||[]:[]);ep(Pse(S,{get code(){return i(Cs)},set code(ue){x(Cs,V(ue))},get codeVersion(){return i(ro)},get status(){return i(zt)},get error(){return i(Qt)},get runtimeDiagnostics(){return i(ho)},get backtest(){return i(j)},get signalEvents(){return i(Q)},get isRunning(){return i(ri)},get isOpen(){return i(Yt)},get paneTarget(){return i(ou)},get labelsEnabled(){return i(nr)},$$events:{fullpage:ue=>{var ie;x(qn,V(!!((ie=ue==null?void 0:ue.detail)!=null&&ie.enabled)))},run:ue=>{var ie,De,ze;return dr(ue.detail.code,((ie=ue==null?void 0:ue.detail)==null?void 0:ie.params)||null,(De=ue==null?void 0:ue.detail)==null?void 0:De.lang,((ze=ue==null?void 0:ue.detail)==null?void 0:ze.backtest)||null)},reset:Fu,saveStatus:ue=>{var ie;return x(zt,V(((ie=ue==null?void 0:ue.detail)==null?void 0:ie.status)||i(zt)))},close:Yi,pane:ue=>x(ou,V(ue.detail.target)),labels:ue=>x(nr,V(ue.detail.enabled)),selectTrade:ue=>{var De;const ie=(De=ue==null?void 0:ue.detail)==null?void 0:De.trade;ie?jl(ie):va()},focusIndex:ue=>{var lt,wt;const ie=(lt=ue==null?void 0:ue.detail)==null?void 0:lt.index,De=(wt=ue==null?void 0:ue.detail)==null?void 0:wt.timestamp;let ze=!1;typeof ie=="number"&&Number.isFinite(ie)&&(ze=Mu(ie)),!ze&&typeof De=="number"&&Number.isFinite(De)&&Zu(De)},focusOrder:ue=>{var De;const ie=(De=ue==null?void 0:ue.detail)==null?void 0:De.order;ie&&Xl(ie)},guide:()=>x(Vn,!0)}}),ue=>x(bs,V(ue)),()=>i(bs))}),_($h),_(Eh),_(av),ep(av,S=>x(mt,S),()=>i(mt));var Dh=v(av,2);ep(zV(Dh,{$$events:{"sidebar:toggle":Fl,"sidebar:resize:move":Fl,"sidebar:resize:end":Fl}}),S=>x(Ce,V(S)),()=>i(Ce)),_(cm);var um=v(cm,2);Ye(um,()=>i(Ji),S=>{var j=joe();Y(S,j)});var Ov=v(um,2);Wse(Ov,{get show(){return i(Vn)},$$events:{close:()=>x(Vn,!1),insert:S=>{const j=S.detail||{};x(Cs,V(j.code)),x(ro,i(ro)+1),x(Vn,!1),Dr(),setTimeout(()=>{var Q,ue,ie,De;try{j.mode?(ue=(Q=i(bs))==null?void 0:Q.setEditorCodeWithMode)==null||ue.call(Q,i(Cs),j.mode):(De=(ie=i(bs))==null?void 0:ie.setEditorCode)==null||De.call(ie,i(Cs))}catch{}gi()},0)}}});var Rh=v(Ov,2);BZ(Rh,{get isOpen(){return i(Cg)},set isOpen(S){x(Cg,V(S))},get x(){return i(ne)},get y(){return i(fe)},get currentPrice(){return i(qe)},$$events:{copy:async S=>{S.detail.price&&(await hh(S.detail.price)?(x(Ct,`Price ${S.detail.price} copied!`),ot==null||ot.showToast(),zp()):(x(Ct,"Failed to copy price"),ot==null||ot.showToast()))},reset:$l,close:zp}});var zv=v(Rh,2);Ye(zv,()=>i(nu),S=>{var j=Goe(),Q=y(j);Ye(Q,()=>i(op),ue=>{var ie=Voe(),De=tn(ie);De.__click=[Noe,op,Be,Af];var ze=v(De,2);ze.__click=[Aoe,op,Be,Af];var lt=v(ze,2);lt.__click=[Boe,op,Be,_m];var wt=y(lt),qt=v(y(wt));Ye(qt,()=>i(_m),kn=>{var as=Ooe();Y(kn,as)},kn=>{var as=zoe();Y(kn,as)}),_(wt);var sn=v(wt,2),Ot=y(sn,!0);_(sn),_(lt);var vn=v(lt,2);vn.__click=[Toe,op,Be,Af],Ne(()=>tt(Ot,i(_m)?"Unlock Drawing":"Lock Drawing")),Y(ue,ie)},ue=>{var ie=Uoe(),De=tn(ie);De.__click=$l;var ze=v(De,2);ze.__click=async()=>{await hh(i(qe))?x(Ct,`Price ${i(qe)} copied!`):x(Ct,"Failed to copy price"),ot==null||ot.showToast(),Af()};var lt=v(y(ze),2),wt=y(lt);_(lt),_(ze);var qt=v(ze,2);Ye(qt,()=>i(ym),Vt=>{var Pn=Woe();Pn.__click=[Moe,Bm,ym,Rf,Td,Be,Ah,Af],Y(Vt,Pn)});var sn=v(qt,2);sn.__click=Lp;var Ot=v(y(sn),2),vn=y(Ot,!0);_(Ot),_(sn);var kn=v(sn,2);kn.__click=[Loe,Qe,Af];var as=v(kn,2);as.__click=[Eoe,xm,Af];var Ls=v(as,2);Ye(Ls,()=>i(dh)>0,Vt=>{var Pn=Hoe();Pn.__click=rm;var Hn=v(y(Pn),2),Tn=y(Hn);_(Hn),_(Pn),Ne(()=>tt(Tn,`Remove ${i(dh)??""} Indicator${(i(dh)===1?"":"s")??""}`)),Y(Vt,Pn)});var Ys=v(Ls,2);Ye(Ys,()=>i(Kp)>0,Vt=>{var Pn=qoe();Pn.__click=mh;var Hn=v(y(Pn),2),Tn=y(Hn);_(Hn),_(Pn),Ne(()=>tt(Tn,`Remove ${i(Kp)??""} Drawing${(i(Kp)===1?"":"s")??""}`)),Y(Vt,Pn)});var yn=v(Ys,2);yn.__click=[Foe,Qe,Af],Ne(()=>{tt(wt,`Copy Price ${(i(qe)?`(${i(qe)})`:"")??""}`),tt(vn,i(Xp)?"Hide Grid":"Show Grid")}),Y(ue,ie)}),_(j),ep(j,ue=>x(Mt,ue),()=>i(Mt)),Ne(()=>Dt(j,"style",i(zm))),Y(S,j)});var kv=v(zv,2);ep(R8(kv,{get visible(){return i(Wt)},set visible(S){x(Wt,V(S))},get message(){return i(Ct)},duration:2e3}),S=>ot=S,()=>ot);var _h=v(kv,2);hJ(_h,{get show(){return i(Pi)},title:"Unsaved changes",message:"You made changes but did not save. Refresh will discard them.",$$events:{cancel:()=>{x(Pi,!1)},confirm:()=>{var S;x(Pi,!1);try{if(sl&&_x()){sl.clearPersistedStorage();try{const j=(((S=s())==null?void 0:S.key)||"chart")+"_overlays";localStorage.removeItem(j)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}}}catch{}location.reload()}}});var km=v(_h,2);vW(km,{});var uv=v(km,2);return dJ(uv,{}),_(vh),ep(vh,S=>x(ct,S),()=>i(ct)),Ne(()=>{Dt(vh,"data-theme",s().theme),rr(av,"restoring",u()),Fi(Eh,`${`script-dock ${i(Yt)?"open":""} ${i(qn)?"fullpage":""}`??""} svelte-1ddlfai`),Dt(Eh,"style",i(Ip)),Dt(Eh,"aria-hidden",!i(Yt)),Dt($h,"style",`opacity:${i(Yt)?1:0}; pointer-events:${i(Yt)?"auto":"none"}; transform: ${i(Yt)?"none":"translateY(6px)"};`)}),ld("mouseleave",Dl,nd),ld("wheel",$h,S=>S.stopPropagation()),Y(n,vh),Ed({getChart:fu,setManualStylesFlag:Cr})}Tp(["click","keydown","contextmenu","mousemove","mousedown","mouseup","dblclick","touchstart","touchmove"]);function sie(n,e){Ld(e,!1);const t=tm(),s=()=>vl(o3,"$page",t),o=()=>vl(l,"$save",t);console.log("📄 +page.svelte loaded");const r=Fm(new h4);let a;try{const w=sessionStorage.getItem("chart.tabId");w?a=w:(a=`${Date.now()}-${Math.random().toString(36).slice(2)}`,sessionStorage.setItem("chart.tabId",a))}catch{a=`${Date.now()}-${Math.random().toString(36).slice(2)}`}const l=Uw(`chart:${a}`,new Ob);let c=vd(!1),f="light";function u(w){f=w,document.documentElement.classList.toggle("dark",w==="dark"),document.documentElement.setAttribute("data-theme",w),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:w}})),console.log("🖌️ Applied theme to document:",w)}function d(){window.location.href="https://dutyai.app/chart"}let h=null;Mh(()=>((async()=>{var D,$,z,te;const w=$j(s().url);let C=w.userId;if(w.fromUrl&&C)if(console.log("👤 User ID parameter found in URL:",C),w.persisted){console.log("✅ User ID saved to storage:",C);const pe=new URL(window.location.href);o8.forEach(J=>pe.searchParams.delete(J)),pe.toString()!==window.location.href&&window.history.replaceState({},"",pe.toString()),console.log("🔗 User ID parameter removed from URL")}else console.warn("⚠️ User ID could not be persisted. Keeping URL parameter for reload safety.");else C&&console.log("👤 User ID found in storage:",C);if(!C){console.warn("⚠️ No userId found in URL or localStorage. Redirecting..."),d();return}hB(!0);try{console.log("📡 Fetching user preferences for userId:",C);const pe=s().url.searchParams.get("isFree")==="true",J=await dB(C,pe,{retries:3,baseDelayMs:350,maxDelayMs:1500,bootstrapMissing:!0});console.log("✅ User preferences fetched successfully:",J),t5(J)}catch(pe){console.error("❌ Failed to fetch user preferences:",pe);const J=mB(C);console.warn("⚠️ Using fallback preferences:",J),t5(J)}const M=s().url.searchParams.get("theme"),P=(z=($=(D=mm(B0))==null?void 0:D.data)==null?void 0:$.theme)==null?void 0:z.toLowerCase(),T=(te=mm(l))==null?void 0:te.theme,N=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,L=M==="dark"||M==="light"?M:P==="dark"||P==="light"?P==="dark"?"dark":"light":T==="dark"||T==="light"?T:N?"dark":"light";l.update(pe=>(pe.theme=L,pe)),u(L),h=l.subscribe(pe=>{const J=pe.theme==="dark"||pe.theme==="light"?pe.theme:N?"dark":"light";J!==f&&u(J)});const O=s().url.searchParams.get("symbol");if(O){console.log("🔗 Symbol parameter found in URL:",O);let pe=0;const J=50,le=()=>{pe+=1;const de=o();if(de.allSymbols&&de.allSymbols.length>0){const he=de.allSymbols.find(ge=>ge.ticker.toLowerCase()===O.toLowerCase());if(he)console.log("✅ Found symbol from URL parameter:",he),l.update(ge=>(ge.symbol=he,ge));else{console.warn("⚠️ Symbol not found in available symbols:",O),console.log("📊 Available symbols:",de.allSymbols.map(ae=>ae.ticker).join(", "));const ge=de.allSymbols.slice(0,10).map(ae=>ae.ticker).join(", ");console.log(`💡 Try one of these symbols: ${ge}${de.allSymbols.length>10?"...":""}`)}}else pe<J?(console.log(`⏳ Waiting for symbols to load... (attempt ${pe}/${J})`),setTimeout(le,100)):console.error("❌ Timeout waiting for symbols to load. Symbol parameter will be ignored.")};le()}x(c,!0)})(),()=>{h&&h()})),_v();var m=Yn(),g=tn(m);Ye(g,()=>i(c),w=>{Koe(w,{ctx:r,save:l})}),Y(n,m),Ed()}export{sie as component};
