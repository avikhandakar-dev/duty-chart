const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/editor.api.BiPlqzrK.js","../chunks/iconRegistry.BJgxFQLY.js","../chunks/editorContextKeys.Cdn_dJhV.js","../assets/iconRegistry.DaOXeWeJ.css","../chunks/stableEditorScroll.DHPB0mmN.js","../chunks/codeEditorWidget.CXeIzSuq.js","../assets/codeEditorWidget.Bg48Qpty.css","../chunks/preload-helper.Fmm1kQxB.js","../chunks/entry.C7I2X-K0.js","../chunks/toolbar.BTiJf7ch.js","../assets/toolbar.CglUw5ev.css","../chunks/editorBrowser.CzkYJKPy.js","../chunks/clipboardService.BTmHAzm-.js","../chunks/format.Bb1_og6G.js","../assets/editor.BcE45i8R.css","../chunks/monaco.contribution.hU7iWkca.js","../chunks/monaco.contribution.CPuGIZ1w.js","../chunks/monaco.contribution.C7yQ60ma.js","../chunks/monaco.contribution.aFG-n5X_.js","../chunks/suggestController.TAqXY2ko.js","../chunks/resizable.CSJhciM7.js","../assets/resizable.BfBUCCsp.css","../assets/suggestController.ChoziUlt.css","../chunks/parameterHints.StIp-S_A.js","../assets/parameterHints.BBE0dURY.css","../chunks/hoverContribution.CisGEAg6.js","../assets/hoverContribution.NSOZYWNZ.css","../chunks/formatActions.BuL_rer4.js"])))=>i.map(i=>d[i]);
var T4=Object.defineProperty;var F4=Object.getPrototypeOf;var L4=Reflect.get;var tw=s=>{throw TypeError(s)};var E4=(s,e,t)=>e in s?T4(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Pe=(s,e,t)=>E4(s,typeof e!="symbol"?e+"":e,t),sw=(s,e,t)=>e.has(s)||tw("Cannot "+t);var Ah=(s,e,t)=>(sw(s,e,"read from private field"),t?t.call(s):e.get(s)),G_=(s,e,t)=>e.has(s)?tw("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);var q1=(s,e,t)=>(sw(s,e,"access private method"),t);var nw=(s,e,t)=>L4(F4(s),t,e);import{r as P2,v as $4,w as ow,x as D4,y as pb,e as Qs,a as Y,z as ga,b as st,l as $p,s as lh,A as pd,t as be,c as Ml,B as Fc,n as $6,C as Nb,D as D6,f as I0,E as R4,p as R6}from"../chunks/stores.D78Phzey.js";import{v as j4,E as B4,w as O4,F as j6,J as rg,K as Hy,H as B6,Q as y1,aB as z4,aS as V4,aR as W4,O as M2,at as O6,as as z6,L as V6,al as H4,P as iw,C as N2,aY as W6,I as q4,G as U4,l as hb,e as Ro,aZ as G4,a_ as Y4,a$ as K4,a6 as X4,q as A2,aC as i_,b0 as Z4,b1 as J4,aK as rw,Z as aw,av as Q4,ai as e8,m as _x,aL as H6,B as t8,A as b,aJ as Th,c as y,f as _s,b2 as Oi,r as _,t as we,ag as vh,p as Yd,af as bd,ad as _h,ae as c0,i,s as m,a as Kd,j as jh,ab as _e,k as Lt,b3 as lw,a2 as Mm,aI as hd,b as Xr,b4 as pp,b5 as U1,aa as qy,b6 as Ng,y as __,b7 as s8,aH as Qg,a5 as n8}from"../chunks/entry.C7I2X-K0.js";import{b as q6,l as so,p as bi,i as Ve,a as H,c as yh,s as Oh}from"../chunks/runtime.9hl-glaH.js";import{i as $m}from"../chunks/lifecycle.D3PaPRj0.js";import{s as Dt,t as yr,e as qo,i as yi,r as Ts,h as $i,j as qf,l as b1,f as o8,m as O0,b as Fh,n as cw,o as qm,p as i8,A as r8,k as a8,q as l8}from"../chunks/alert.y1FD3de1.js";import{c as fm,o as sm,a as Rg,b as hp,_ as Vv}from"../chunks/preload-helper.Fmm1kQxB.js";const c8=[];function Ag(s,e=!1){return wy(s,new Map,"",c8)}function wy(s,e,t,n,o=null){if(typeof s=="object"&&s!==null){const a=e.get(s);if(a!==void 0)return a;if(s instanceof Map)return new Map(s);if(s instanceof Set)return new Set(s);if(j4(s)){const l=[];e.set(s,l),o!==null&&e.set(o,l);for(let c=0;c<s.length;c+=1)l.push(wy(s[c],e,t,n));return l}if(B4(s)===O4){const l={};e.set(s,l),o!==null&&e.set(o,l);for(var r in s)l[r]=wy(s[r],e,t,n);return l}if(s instanceof Date)return structuredClone(s);if(typeof s.toJSON=="function")return wy(s.toJSON(),e,t,n,s)}if(s instanceof EventTarget)return s;try{return structuredClone(s)}catch{return s}}function u8(s,e,t,n,o){var r=s,a="",l;j6(()=>{if(a===(a=e()??"")){rg&&Hy();return}l!==void 0&&(z6(l),l=void 0),a!==""&&(l=B6(()=>{if(rg){y1.data;for(var c=Hy(),f=c;c!==null&&(c.nodeType!==8||c.data!=="");)f=c,c=z4(c);if(c===null)throw V4(),W4;P2(y1,f),r=M2(c);return}var u=a+"",d=$4(u);P2(O6(d),d.lastChild),r.before(d)}))})}function d8(s,e,t,n,o,r){let a=rg;rg&&Hy();var l,c,f=null;rg&&y1.nodeType===1&&(f=y1,Hy());var u=rg?y1:s,d;j6(()=>{const h=e()||null;var p=W6;h!==l&&(d&&(h===null?q4(d,()=>{d=null,c=null}):h===c?U4(d):(z6(d),ow(!1))),h&&h!==c&&(d=B6(()=>{if(f=rg?f:document.createElementNS(p,h),P2(f,f),n){var v=rg?O6(f):f.appendChild(H4());rg&&(v===null?iw(!1):M2(v)),n(f,v)}N2.nodes_end=f,u.before(f)})),l=h,l&&(c=l),ow(!0))},V6),a&&(iw(!0),M2(u))}function uw(s,e,t){hb(()=>{var n=Ro(()=>e(s,t==null?void 0:t())||{});if(n!=null&&n.destroy)return()=>n.destroy()})}const f8=()=>performance.now(),A0={tick:s=>requestAnimationFrame(s),now:()=>f8(),tasks:new Set};function U6(s){A0.tasks.forEach(e=>{e.c(s)||(A0.tasks.delete(e),e.f())}),A0.tasks.size!==0&&A0.tick(U6)}function p8(s){let e;return A0.tasks.size===0&&A0.tick(U6),{promise:new Promise(t=>{A0.tasks.add(e={c:s,f:t})}),abort(){A0.tasks.delete(e)}}}function G1(s,e){s.dispatchEvent(new CustomEvent(e))}function h8(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function dw(s){const e={},t=s.split(";");for(const n of t){const[o,r]=n.split(":");if(!o||r===void 0)break;const a=h8(o.trim());e[a]=r.trim()}return e}const m8=s=>s;function Sv(s,e,t,n){var o=(s&K4)!==0,r=(s&Z4)!==0,a=o&&r,l=(s&J4)!==0,c=a?"both":o?"in":"out",f,u=e.inert,d,h;function p(){var I=Q4,A=N2;rw(null),aw(null);try{return f??(f=t()(e,(n==null?void 0:n())??{},{direction:c}))}finally{rw(I),aw(A)}}var v={is_global:l,in(){var I;if(e.inert=u,!o){h==null||h.abort(),(I=h==null?void 0:h.reset)==null||I.call(h);return}r||d==null||d.abort(),G1(e,"introstart"),d=T2(e,p(),h,1,()=>{G1(e,"introend"),d==null||d.abort(),d=f=void 0})},out(I){if(!r){I==null||I(),f=void 0;return}e.inert=!0,G1(e,"outrostart"),h=T2(e,p(),d,0,()=>{G1(e,"outroend"),I==null||I()})},stop:()=>{d==null||d.abort(),h==null||h.abort()}},x=N2;if((x.transitions??(x.transitions=[])).push(v),o&&D4){var S=l;if(!S){for(var C=x.parent;C&&C.f&V6;)for(;(C=C.parent)&&!(C.f&G4););S=!C||(C.f&Y4)!==0}S&&hb(()=>{Ro(()=>v.in())})}}function T2(s,e,t,n,o){var r=n===1;if(X4(e)){var a,l=!1;return A2(()=>{if(!l){var S=e({direction:r?"in":"out"});a=T2(s,S,t,n,o)}}),{abort:()=>{l=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return o(),{abort:i_,deactivate:i_,reset:i_,t:()=>n};const{delay:c=0,css:f,tick:u,easing:d=m8}=e;var h=[];if(r&&t===void 0&&(u&&u(0,1),f)){var p=dw(f(0,1));h.push(p,p)}var v=()=>1-n,x=s.animate(h,{duration:c});return x.onfinish=()=>{var S=(t==null?void 0:t.t())??1-n;t==null||t.abort();var C=n-S,I=e.duration*Math.abs(C),A=[];if(I>0){if(f)for(var P=Math.ceil(I/16.666666666666668),T=0;T<=P;T+=1){var j=S+C*d(T/P),E=f(j,1-j);A.push(dw(E))}v=()=>{var L=x.currentTime;return S+C*d(L/I)},u&&p8(()=>{if(x.playState!=="running")return!1;var L=v();return u(L,1-L),!0})}x=s.animate(A,{duration:I,fill:"forwards"}),x.onfinish=()=>{v=()=>n,u==null||u(n,1-n),o()}},{abort:()=>{x&&(x.cancel(),x.effect=null,x.onfinish=i_)},deactivate:()=>{o=i_},reset:()=>{n===0&&(u==null||u(1,0))},t:()=>v()}}function Fn(s,e,t=e){var n=e8();pb(s,"input",()=>{var o=Tb(s)?Fb(s.value):s.value;t(o),n&&o!==(o=e())&&(s.value=o??"")}),_x(()=>{var o=e();if(rg&&s.defaultValue!==s.value){t(Tb(s)?Fb(s.value):s.value);return}Tb(s)&&o===Fb(s.value)||s.type==="date"&&!o&&!s.value||o!==s.value&&(s.value=o??"")})}const Ab=new Set;function v8(s,e,t,n,o=n){var r=t.getAttribute("type")==="checkbox",a=s;let l=!1;if(e!==null)for(var c of e)a=a[c]??(a[c]=[]);a.push(t),pb(t,"change",()=>{var f=t.__value;r&&(f=fw(a,f,t.checked)),o(f)},()=>o(r?[]:null)),_x(()=>{var f=n();if(rg&&t.defaultChecked!==t.checked){l=!0;return}r?(f=f||[],t.checked=f.includes(t.__value)):t.checked=q6(t.__value,f)}),H6(()=>{var f=a.indexOf(t);f!==-1&&a.splice(f,1)}),Ab.has(a)||(Ab.add(a),A2(()=>{a.sort((f,u)=>f.compareDocumentPosition(u)===4?-1:1),Ab.delete(a)})),A2(()=>{if(l){var f;if(r)f=fw(a,f,t.checked);else{var u=a.find(d=>d.checked);f=u==null?void 0:u.__value}o(f)}})}function Wv(s,e,t=e){pb(s,"change",()=>{var n=s.checked;t(n)}),e()==null&&t(!1),_x(()=>{var n=e();s.checked=!!n})}function fw(s,e,t){for(var n=new Set,o=0;o<s.length;o+=1)s[o].checked&&n.add(s[o].__value);return t||n.delete(e),Array.from(n)}function Tb(s){var e=s.type;return e==="number"||e==="range"}function Fb(s){return s===""?null:+s}function pw(s,e,t){var n=t8(s,e);n&&n.set&&(s[e]=t,H6(()=>{s[e]=null}))}function $g(s,e,t){if(s.multiple)return g8(s,e);for(var n of s.options){var o=x1(n);if(q6(o,e)){n.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function L0(s,e){let t=!0;hb(()=>{e&&$g(s,Ro(e),t),t=!1;var n=new MutationObserver(()=>{var o=s.__value;$g(s,o)});return n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function co(s,e,t=e){var n=!0;pb(s,"change",()=>{var o;if(s.multiple)o=[].map.call(s.querySelectorAll(":checked"),x1);else{var r=s.querySelector(":checked");o=r&&x1(r)}t(o)}),hb(()=>{var o=e();if($g(s,o,n),n&&o===void 0){var r=s.querySelector(":checked");r!==null&&(o=x1(r),t(o))}s.__value=o,n=!1}),L0(s)}function g8(s,e){for(var t of s.options)t.selected=~e.indexOf(x1(t))}function x1(s){return"__value"in s?s.__value:s.value}function Y_(s){b(s,s.v+1)}const L_={},Y1={},ky={},Sy={};function _8(s){if(s)return L_[s]}function y8(s){const e=Sy[s];!e||e.size===0||e.forEach(t=>{try{t()}catch{}})}async function b8(s,e=2){if(L_[s])return L_[s];if(Y1[s])return Y1[s];ky[s]="loading";const t=new Promise((n,o)=>{let r=0;const a=()=>{const l=new Image;l.crossOrigin="anonymous";try{l.referrerPolicy="no-referrer"}catch{}const c=async()=>{var u;try{await((u=l.decode)==null?void 0:u.call(l))}catch{}L_[s]=l,ky[s]="loaded",y8(s),n(l)},f=()=>{if(r+=1,r<=e){const u=Math.min(500*r,1500);setTimeout(a,u)}else ky[s]="error",o(new Error("load error"))};l.onload=c,l.onerror=f,l.src=s};a()});Y1[s]=t;try{return await t}finally{delete Y1[s]}}function F2(s){if(s&&!(L_[s]||ky[s]==="loading"))try{b8(s)}catch{}}function x8(s,e){if(Sy[s]||(Sy[s]=new Set),Sy[s].add(e),L_[s])try{e()}catch{}}function G6(s){s&&(F2(s.logo),F2(s.logo2))}function Bh(s,e){if(!(!Cv(s)&&!Cv(e))){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=s[t],o=e[t];Cv(o)&&Cv(n)?Bh(n,o):Rn(e[t])&&(s[t]=B_(e[t]))}}}function B_(s){if(!Cv(s))return s;let e=null;lg(s)?e=[]:e={};for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)){const n=s[t];Cv(n)?e[t]=B_(n):e[t]=n}return e}function lg(s){return Object.prototype.toString.call(s)==="[object Array]"}function cv(s){return typeof s=="function"}function Cv(s){return typeof s=="object"&&Rn(s)}function ul(s){return typeof s=="number"&&Number.isFinite(s)}function Rn(s){return s!=null}function A1(s){return typeof s=="boolean"}function Mf(s){return typeof s=="string"}const w8=/\\(\\)?/g,k8=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function em(s,e,t){if(Rn(s)){const n=[];e.replace(k8,(l,...c)=>{let f=l;return Rn(c[1])?f=c[2].replace(w8,"$1"):Rn(c[0])&&(f=c[0].trim()),n.push(f),""});let o=s,r=0;const a=n.length;for(;Rn(o)&&r<a;)o=o==null?void 0:o[n[r++]];return Rn(o)?o:t??"--"}return t??"--"}function Y6(s,e){const t={};return s.formatToParts(new Date(e)).forEach(({type:n,value:o})=>{switch(n){case"year":{t.YYYY=o;break}case"month":{t.MM=o;break}case"day":{t.DD=o;break}case"hour":{t.HH=o==="24"?"00":o;break}case"minute":{t.mm=o;break}case"second":{t.ss=o;break}}}),t}function K6(s,e,t){const n=Y6(s,e);return t.replace(/YYYY|MM|DD|HH|mm|ss/g,o=>n[o])}function Im(s,e){const t=+s;return ul(t)?t.toFixed(e??2):`${s}`}function X6(s){const e=+s;if(ul(e)){if(e>1e9)return`${+(e/1e9).toFixed(3)}B`;if(e>1e6)return`${+(e/1e6).toFixed(3)}M`;if(e>1e3)return`${+(e/1e3).toFixed(3)}K`}return`${s}`}function Z6(s,e){const t=`${s}`;if(e.length===0)return t;if(t.includes(".")){const n=t.split(".");return`${n[0].replace(/(\d)(?=(\d{3})+$)/g,o=>`${o}${e}`)}.${n[1]}`}return t.replace(/(\d)(?=(\d{3})+$)/g,n=>`${n}${e}`)}function J6(s,e){const t=`${s}`;if(new RegExp("\\.0{"+e+",}[1-9][0-9]*$").test(t)){const o=t.split("."),r=o.length-1,a=o[r],l=/0*/.exec(a);if(Rn(l)){const c=l[0].length;return o[r]=a.replace(/0*/,`0{${c}}`),o.join(".")}}return t}function hw(s,e){return s.replace(/\{(\w+)\}/g,(t,n)=>{const o=e[n];return Rn(o)?o:`{${n}}`})}let K_=null;function E0(s){var e;return((e=s.ownerDocument.defaultView)==null?void 0:e.devicePixelRatio)??1}function r0(s,e,t){return`${e??"normal"} ${s??12}px ${t??"Helvetica Neue"}`}function tm(s,e,t,n){if(!Rn(K_)){const o=document.createElement("canvas"),r=E0(o);K_=o.getContext("2d"),K_.scale(r,r)}return K_.font=r0(e,t,n),Math.round(K_.measureText(s).width)}function Uy(s){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return Rn(s)&&Bh(e,s),e}var zf=(s=>(s[s.Main=0]="Main",s[s.Overlay=1]="Overlay",s[s.Separator=2]="Separator",s[s.Drawer=3]="Drawer",s[s.All=4]="All",s))(zf||{});const Lb=-1;function $0(s){return cv(window.requestAnimationFrame)?window.requestAnimationFrame(s):window.setTimeout(s,20)}function Eb(s){cv(window.cancelAnimationFrame)?window.cancelAnimationFrame(s):window.clearTimeout(s)}class L2{constructor(e){Pe(this,"_options",{duration:500,iterationCount:1});Pe(this,"_doFrameCallback");Pe(this,"_currentIterationCount",0);Pe(this,"_running",!1);Pe(this,"_time",0);Bh(this._options,e)}_loop(){this._running=!0;const e=()=>{var t;if(this._running){const n=new Date().getTime()-this._time;n<this._options.duration?((t=this._doFrameCallback)==null||t.call(this,n),$0(e)):(this.stop(),this._currentIterationCount++,this._currentIterationCount<this._options.iterationCount&&this.start())}};$0(e)}doFrame(e){return this._doFrameCallback=e,this}setDuration(e){return this._options.duration=e,this}setIterationCount(e){return this._options.iterationCount=e,this}start(){this._running||(this._time=new Date().getTime(),this._loop())}stop(){var e;this._running&&((e=this._doFrameCallback)==null||e.call(this,this._options.duration)),this._running=!1}}let $b=1,mw=new Date().getTime();function d1(s){const e=new Date().getTime();return e===mw?++$b:$b=1,mw=e,`${s??""}${e}_${$b}`}function l0(s,e){const t=document.createElement(s),n=e??{};for(const o in n)t.style[o]=n[o]??"";return t}function E2(s,e,t){let n=0,o=0;for(o=s.length-1;n!==o;){const r=Math.floor((o+n)/2),a=o-n,l=s[r][e];if(t===s[n][e])return n;if(t===s[o][e])return o;if(t===l)return r;if(t>l?n=r:o=r,a<=2)break}return n}function vw(s,e){e=Math.max(0,e??0);const t=Math.pow(10,e);return Math.round(s*t)/t}function S8(s){const e=s.toString(),t=e.indexOf("e");if(t>0){const o=+e.slice(t+1);return o<0?-o:0}const n=e.indexOf(".");return n<0?0:e.length-1-n}function Q6(s,e,t){const n=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],o=s.length;let r=0;for(;r<o;){const a=s[r];n[0]=Math.max(a[e]??Number.MIN_SAFE_INTEGER,n[0]),n[1]=Math.min(a[t]??Number.MAX_SAFE_INTEGER,n[1]),++r}return n}function k0(s){return s===0?0:Math.log10(s)}function C_(s){return Math.pow(10,s)}function gw(){return{from:0,to:0,realFrom:0,realTo:0}}function _w(...s){return s.join("_")}const C8=5;class I8{constructor(e){Pe(this,"_limit");Pe(this,"_running",0);Pe(this,"_queue",[]);Pe(this,"_taskMap",new Map);this._limit=e??C8}async add(e){return await new Promise((t,n)=>{const{id:o,handler:r}=e,a=()=>{this._running++,r().then(c=>{t(c)}).catch(()=>{n("failed")}).finally(()=>{this._running--,this._taskMap.delete(o),this._next()})},l=this._taskMap.get(o);if(Rn(l)){l.reject("canceled");const c=this._queue.indexOf(l.run);c>-1&&this._queue.splice(c,1)}this._taskMap.set(o,{run:a,reject:n}),this._queue.push(a),this._next()})}_next(){for(;this._running<this._limit&&this._queue.length>0;){const e=this._queue.shift();e==null||e()}}remove(e){const t=this._taskMap.get(e);if(Rn(t)){this._taskMap.delete(e);const n=this._queue.indexOf(t.run);n>-1&&this._queue.splice(n,1),t.reject("canceled")}}clear(){for(const[,{reject:e}]of this._taskMap)e("canceled");this._taskMap.clear(),this._queue=[]}}const dm={PRICE:2,VOLUME:0};class P8{constructor(){Pe(this,"_callbacks",[])}subscribe(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)}unsubscribe(e){if(cv(e)){const t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}else this._callbacks=[]}execute(e){this._callbacks.forEach(t=>{t(e)})}isEmpty(){return this._callbacks.length===0}}function u_(s){return s==="transparent"||s==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(s)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(s)}function D0(s,e){const t=s.replace(/^#/,""),n=parseInt(t,16),o=n>>16&255,r=n>>8&255,a=n&255;return`rgba(${o}, ${r}, ${a}, ${e??1})`}function Db(s){return Number.isNaN(s)?0:Math.max(0,Math.min(255,s))}function M8(s){const e=s.replace(/^#/,"").trim();if(![3,4,6,8].includes(e.length))return null;const t=e.length<=4?e.split("").map(r=>`${r}${r}`).join(""):e,n=t.length===8?t:`${t}ff`,o=Number.parseInt(n,16);return Number.isFinite(o)?{r:o>>>24&255,g:o>>>16&255,b:o>>>8&255,a:(o&255)/255}:null}function N8(s){const e=s.trim().match(/^rgba?\(([^)]+)\)$/i);if(!e)return null;const t=e[1].split(",").map(l=>l.trim());if(t.length<3)return null;const n=Db(Number(t[0])),o=Db(Number(t[1])),r=Db(Number(t[2])),a=t.length>=4&&t[3]!==""?Math.max(0,Math.min(1,Number(t[3]))):1;return{r:n,g:o,b:r,a}}function A8(s){return s?s.startsWith("#")?M8(s):s.toLowerCase().startsWith("rgb")?N8(s):null:null}function T0(s,e,{light:t="#FFFFFF",dark:n="#111111",threshold:o=.6}={}){if(!s||u_(s))return e;const r=A8(s);return!r||r.a===0?e:(.2126*r.r+.7152*r.g+.0722*r.b)/255>o?n:t}const zc={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function T8(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}}}function F8(){const s={show:!0,color:zc.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:"candle_solid",bar:{compareRule:"current_open",upColor:zc.GREEN,downColor:zc.RED,noChangeColor:zc.GREY,upBorderColor:zc.GREEN,downBorderColor:zc.RED,noChangeBorderColor:zc.GREY,upWickColor:zc.GREEN,downWickColor:zc.RED,noChangeWickColor:zc.GREY},area:{lineSize:2,lineColor:zc.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:D0(zc.BLUE,.01)},{offset:1,color:D0(zc.BLUE,.2)}],point:{show:!0,color:zc.BLUE,radius:4,rippleColor:D0(zc.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:{...s},low:{...s},last:{show:!0,compareRule:"current_open",upColor:zc.GREEN,downColor:zc.RED,noChangeColor:zc.GREY,line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:zc.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2},extendTexts:[]}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",rect:{position:"fixed",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},title:{show:!0,size:14,family:"Helvetica Neue",weight:"normal",color:zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,template:"{ticker} · {period}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:[{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]},features:[]}}}function L8(){const s=D0(zc.GREEN,.7),e=D0(zc.RED,.7);return{ohlc:{compareRule:"current_open",upColor:s,downColor:e,noChangeColor:zc.GREY},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:s,downColor:e,noChangeColor:zc.GREY}],lines:["#FF9600","#935EBD",zc.BLUE,"#E11D74","#01C5C4"].map(t=>({style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:t})),circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:s,downColor:e,noChangeColor:zc.GREY}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",title:{show:!0,showName:!0,showParams:!0,size:12,family:"Helvetica Neue",weight:"normal",color:zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:zc.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a"},features:[]}}}function yw(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:zc.GREY,size:14,family:'"IBM Plex Sans", "Helvetica Neue", Arial, sans-serif',weight:"normal",marginStart:4,marginEnd:6},ticduty:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function E8(){return{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:zc.GREY},text:{show:!0,style:"fill",color:zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:zc.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:zc.GREY},features:[]},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:zc.GREY},text:{show:!0,style:"fill",color:zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:zc.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:zc.GREY}}}}function $8(){const s=D0(zc.BLUE,.35),e=D0(zc.BLUE,.25);function t(){return{style:"fill",color:zc.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:zc.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:zc.BLUE}}return{point:{color:zc.BLUE,borderColor:s,borderSize:1,radius:5,activeColor:zc.BLUE,activeBorderColor:s,activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:zc.BLUE,size:1,dashedValue:[2,2]},rect:{style:"fill",color:e,borderColor:zc.BLUE,borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:zc.BLUE,borderColor:zc.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:e,borderColor:zc.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:zc.BLUE,size:1,dashedValue:[2,2]},text:t()}}function D8(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:D0(zc.BLUE,.08)}}function R8(){const s=yw(),e=yw();return e.tickText.family="sans-serif",e.tickText.size=12,e.tickText.weight="normal",e.tickText.color="#6b7280",e.tickText.weight="normal",{grid:T8(),candle:F8(),indicator:L8(),xAxis:s,yAxis:e,separator:D8(),crosshair:E8(),overlay:$8()}}function yx(s,e,t,n){const o=s.result,r=s.figures,a=s.styles,l=em(a,"circles",t.circles),c=l.length,f=em(a,"bars",t.bars),u=f.length,d=em(a,"lines",t.lines),h=d.length;let p=0,v=0,x=0,S,C=0;r.forEach(I=>{var A;switch(I.type){case"circle":{C=p;const P=l[p%c];S={...P,color:P.noChangeColor},p++;break}case"bar":{C=v;const P=f[v%u];S={...P,color:P.noChangeColor},v++;break}case"line":{C=x,S=d[x%h],x++;break}}if(Rn(I.type)){const P=(A=I.styles)==null?void 0:A.call(I,{data:{prev:o[e.prev??""],current:o[e.current??""],next:o[e.next??""]},indicator:s,defaultStyles:t});n(I,{...S,...P},C)}})}class mb{constructor(e){Pe(this,"id");Pe(this,"paneId");Pe(this,"name");Pe(this,"shortName");Pe(this,"precision",4);Pe(this,"calcParams",[]);Pe(this,"shouldOhlc",!1);Pe(this,"shouldFormatBigNumber",!1);Pe(this,"visible",!0);Pe(this,"zLevel",-10);Pe(this,"extendData");Pe(this,"series","normal");Pe(this,"figures",[]);Pe(this,"minValue",null);Pe(this,"maxValue",null);Pe(this,"styles",null);Pe(this,"shouldUpdate",(e,t)=>{const n=JSON.stringify(e.calcParams)!==JSON.stringify(t.calcParams)||e.figures!==t.figures||e.calc!==t.calc,o=n||e.shortName!==t.shortName||e.series!==t.series||e.minValue!==t.minValue||e.maxValue!==t.maxValue||e.precision!==t.precision||e.shouldOhlc!==t.shouldOhlc||e.shouldFormatBigNumber!==t.shouldFormatBigNumber||e.visible!==t.visible||e.zLevel!==t.zLevel||e.extendData!==t.extendData||e.regenerateFigures!==t.regenerateFigures||e.createTooltipDataSource!==t.createTooltipDataSource||e.draw!==t.draw;return{calc:n,draw:o}});Pe(this,"calc",()=>({}));Pe(this,"regenerateFigures",null);Pe(this,"createTooltipDataSource",null);Pe(this,"draw",null);Pe(this,"onDataStateChange",null);Pe(this,"result",{});Pe(this,"_prevIndicator");Pe(this,"_lockSeriesPrecision",!1);this.override(e),this._lockSeriesPrecision=!1}override(e){const{result:t,...n}=this;this._prevIndicator={...B_(n),result:t};const{id:o,name:r,shortName:a,precision:l,styles:c,figures:f,calcParams:u,...d}=e;!Mf(this.id)&&Mf(o)&&(this.id=o),Mf(this.name)||(this.name=r??""),this.shortName=a??this.shortName??this.name,ul(l)&&(this.precision=l,this._lockSeriesPrecision=!0),Rn(c)&&(this.styles??(this.styles={}),Bh(this.styles,c)),Bh(this,d),Rn(u)&&(this.calcParams=u,cv(this.regenerateFigures)&&(this.figures=this.regenerateFigures(this.calcParams))),this.figures=f??this.figures}setSeriesPrecision(e){this._lockSeriesPrecision||(this.precision=e)}shouldUpdateImp(){const e=this._prevIndicator.zLevel!==this.zLevel,t=this.shouldUpdate(this._prevIndicator,this);return A1(t)?{calc:t,draw:t,sort:e}:{...t,sort:e}}async calcImp(e){try{const t=await this.calc(e,this);return this.result=t,!0}catch{return!1}}static extend(e){class t extends mb{constructor(){super(e)}}return t}}const j8={name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:s=>{let e=0,t=0;return s.reduce((n,o)=>{const r={},a=o.turnover??0,l=o.volume??0;return e+=a,t+=l,t!==0&&(r.avp=e/t),n[o.timestamp]=r,n},{})}},B8={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:s,indicator:e,defaultStyles:t})=>{const{prev:n,current:o}=s,r=(n==null?void 0:n.ao)??Number.MIN_SAFE_INTEGER,a=(o==null?void 0:o.ao)??Number.MIN_SAFE_INTEGER;let l="";a>r?l=em(e.styles,"bars[0].upColor",t.bars[0].upColor):l=em(e.styles,"bars[0].downColor",t.bars[0].downColor);const c=a>r?"stroke":"fill";return{color:l,style:c,borderColor:l}}}],calc:(s,e)=>{const t=e.calcParams,n=Math.max(t[0],t[1]);let o=0,r=0,a=0,l=0;return s.reduce((c,f,u)=>{const d={},h=(f.low+f.high)/2;if(o+=h,r+=h,u>=t[0]-1){a=o/t[0];const p=s[u-(t[0]-1)];o-=(p.low+p.high)/2}if(u>=t[1]-1){l=r/t[1];const p=s[u-(t[1]-1)];r-=(p.low+p.high)/2}return u>=n-1&&(d.ao=a-l),c[f.timestamp]=d,c},{})}},O8={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:s=>s.map((e,t)=>({key:`bias${t+1}`,title:`BIAS${e}: `,type:"line"})),calc:(s,e)=>{const{calcParams:t,figures:n}=e,o=[];return s.reduce((r,a,l)=>{const c={},f=a.close;return t.forEach((u,d)=>{if(o[d]=(o[d]??0)+f,l>=u-1){const h=o[d]/t[d];c[n[d].key]=(f-h)/h*100,o[d]-=s[l-(u-1)].close}}),r[a.timestamp]=c,r},{})}};function z8(s,e){const t=s.length;let n=0;return s.forEach(o=>{const r=o.close-e;n+=r*r}),n=Math.abs(n),Math.sqrt(n/t)}const V8={name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=t[0]-1;let o=0;return s.reduce((r,a,l)=>{const c=a.close,f={};if(o+=c,l>=n){f.mid=o/t[0];const u=z8(s.slice(l-n,l+1),f.mid);f.up=f.mid+t[1]*u,f.dn=f.mid-t[1]*u,o-=s[l-n].close}return r[a.timestamp]=f,r},{})}},W8={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0,r=0,a=0;return s.reduce((l,c,f)=>{const u={},d=c.high,h=c.low,p=c.open,v=(s[f-1]??c).close;if(r+=d-p,a+=p-h,n+=d-v,o+=v-h,f>=t[0]-1){a!==0?u.ar=r/a*100:u.ar=0,o!==0?u.br=n/o*100:u.br=0;const x=s[f-(t[0]-1)],S=x.high,C=x.low,I=x.open,A=(s[f-t[0]]??s[f-(t[0]-1)]).close;n-=S-A,o-=A-C,r-=S-I,a-=I-C}return l[c.timestamp]=u,l},{})}},H8={name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=Math.max(...t),o=[],r=[];return s.reduce((a,l,c)=>{const f={},u=l.close;if(t.forEach((d,h)=>{o[h]=(o[h]??0)+u,c>=d-1&&(r[h]=o[h]/d,o[h]-=s[c-(d-1)].close)}),c>=n-1){let d=0;r.forEach(h=>{d+=h}),f.bbi=d/4}return a[l.timestamp]=f,a},{})}},q8={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=t[0]-1;let o=0;const r=[];return s.reduce((a,l,c)=>{const f={},u=(l.high+l.low+l.close)/3;if(o+=u,r.push(u),c>=n){const d=o/t[0],h=r.slice(c-n,c+1);let p=0;h.forEach(S=>{p+=Math.abs(S-d)});const v=p/t[0];f.cci=v!==0?(u-d)/v/.015:0;const x=(s[c-n].high+s[c-n].low+s[c-n].close)/3;o-=x}return a[l.timestamp]=f,a},{})}},U8={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=Math.ceil(t[1]/2.5+1),o=Math.ceil(t[2]/2.5+1),r=Math.ceil(t[3]/2.5+1),a=Math.ceil(t[4]/2.5+1);let l=0;const c=[];let f=0;const u=[];let d=0;const h=[];let p=0;const v=[],x=[],S={};return s.forEach((C,I)=>{const A={},P=s[I-1]??C,T=(P.high+P.close+P.low+P.open)/4,j=Math.max(0,C.high-T),E=Math.max(0,T-C.low);I>=t[0]-1&&(E!==0?A.cr=j/E*100:A.cr=0,l+=A.cr,f+=A.cr,d+=A.cr,p+=A.cr,I>=t[0]+t[1]-2&&(c.push(l/t[1]),I>=t[0]+t[1]+n-3&&(A.ma1=c[c.length-1-n]),l-=x[I-(t[1]-1)].cr??0),I>=t[0]+t[2]-2&&(u.push(f/t[2]),I>=t[0]+t[2]+o-3&&(A.ma2=u[u.length-1-o]),f-=x[I-(t[2]-1)].cr??0),I>=t[0]+t[3]-2&&(h.push(d/t[3]),I>=t[0]+t[3]+r-3&&(A.ma3=h[h.length-1-r]),d-=x[I-(t[3]-1)].cr??0),I>=t[0]+t[4]-2&&(v.push(p/t[4]),I>=t[0]+t[4]+a-3&&(A.ma4=v[v.length-1-a]),p-=x[I-(t[4]-1)].cr??0)),x.push(A),S[C.timestamp]=A}),S}},G8={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=Math.max(t[0],t[1]);let o=0,r=0,a=0;const l=[],c={};return s.forEach((f,u)=>{const d={},h=f.close;o+=h,r+=h;let p=0,v=0;if(u>=t[0]-1&&(p=o/t[0],o-=s[u-(t[0]-1)].close),u>=t[1]-1&&(v=r/t[1],r-=s[u-(t[1]-1)].close),u>=n-1){const x=p-v;d.dma=x,a+=x,u>=n+t[2]-2&&(d.ama=a/t[2],a-=l[u-(t[2]-1)].dma??0)}l.push(d),c[f.timestamp]=d}),c}},Y8={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0,r=0,a=0,l=0,c=0,f=0,u=0;const d=[],h={};return s.forEach((p,v)=>{const x={},S=s[v-1]??p,C=S.close,I=p.high,A=p.low,P=I-A,T=Math.abs(I-C),j=Math.abs(C-A),E=I-S.high,L=S.low-A,D=Math.max(Math.max(P,T),j),X=E>0&&E>L?E:0,ne=L>0&&L>E?L:0;if(n+=D,o+=X,r+=ne,v>=t[0]-1){v>t[0]-1?(a=a-a/t[0]+D,l=l-l/t[0]+X,c=c-c/t[0]+ne):(a=n,l=o,c=r);let de=0,ie=0;a!==0&&(de=l*100/a,ie=c*100/a),x.pdi=de,x.mdi=ie;let te=0;ie+de!==0&&(te=Math.abs(ie-de)/(ie+de)*100),f+=te,v>=t[0]*2-2&&(v>t[0]*2-2?u=(u*(t[0]-1)+te)/t[0]:u=f/t[0],x.adx=u,v>=t[0]*2+t[1]-3&&(x.adxr=((d[v-(t[1]-1)].adx??0)+u)/2))}d.push(x),h[p.timestamp]=x}),h}},K8={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0;const o=[];return s.reduce((r,a,l)=>{const c={};if(l>0){const f=s[l-1],u=a.high,d=a.low,h=a.volume??0,p=(u+d)/2-(f.high+f.low)/2;if(h===0||u-d===0)c.emv=0;else{const v=h/1e8/(u-d);c.emv=p/v}n+=c.emv,o.push(c.emv),l>=t[0]&&(c.maEmv=n/t[0],n-=o[l-t[0]])}return r[a.timestamp]=c,r},{})}},X8={name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:s=>s.map((e,t)=>({key:`ema${t+1}`,title:`EMA${e}: `,type:"line"})),calc:(s,e)=>{const{calcParams:t,figures:n}=e;let o=0;const r=[];return s.reduce((a,l,c)=>{const f={},u=l.close;return o+=u,t.forEach((d,h)=>{c>=d-1&&(c>d-1?r[h]=(2*u+(d-1)*r[h])/(d+1):r[h]=o/d,f[n[h].key]=r[h])}),a[l.timestamp]=f,a},{})}},Z8={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0;const o=[],r={};return s.forEach((a,l)=>{const c={};if(l>=t[0]){const f=a.close,u=s[l-t[0]].close;c.mtm=f-u,n+=c.mtm,l>=t[0]+t[1]-1&&(c.maMtm=n/t[1],n-=o[l-(t[1]-1)].mtm??0)}o.push(c),r[a.timestamp]=c}),r}},J8={name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA30: ",type:"line"},{key:"ma4",title:"MA60: ",type:"line"}],regenerateFigures:s=>s.map((e,t)=>({key:`ma${t+1}`,title:`MA${e}: `,type:"line"})),calc:(s,e)=>{const{calcParams:t,figures:n}=e,o=[];return s.reduce((r,a,l)=>{const c={},f=a.close;return t.forEach((u,d)=>{o[d]=(o[d]??0)+f,l>=u-1&&(c[n[d].key]=o[d]/u,o[d]-=s[l-(u-1)].close)}),r[a.timestamp]=c,r},{})}},Q8={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:({data:s,indicator:e,defaultStyles:t})=>{const{prev:n,current:o}=s,r=(n==null?void 0:n.macd)??Number.MIN_SAFE_INTEGER,a=(o==null?void 0:o.macd)??Number.MIN_SAFE_INTEGER;let l="";return a>0?l=em(e.styles,"bars[0].upColor",t.bars[0].upColor):a<0?l=em(e.styles,"bars[0].downColor",t.bars[0].downColor):l=em(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor),{style:r<a?"stroke":"fill",color:l,borderColor:l}}}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0,r=0,a=0,l=0,c=0;const f=Math.max(t[0],t[1]);return s.reduce((u,d,h)=>{const p={},v=d.close;return n+=v,h>=t[0]-1&&(h>t[0]-1?o=(2*v+(t[0]-1)*o)/(t[0]+1):o=n/t[0]),h>=t[1]-1&&(h>t[1]-1?r=(2*v+(t[1]-1)*r)/(t[1]+1):r=n/t[1]),h>=f-1&&(a=o-r,p.dif=a,l+=a,h>=f+t[2]-2&&(h>f+t[2]-2?c=(a*2+c*(t[2]-1))/(t[2]+1):c=l/t[2],p.macd=(a-c)*2,p.dea=c)),u[d.timestamp]=p,u},{})}},eC={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0;const r=[],a={};return s.forEach((l,c)=>{const f=s[c-1]??l;l.close<f.close?o-=l.volume??0:l.close>f.close&&(o+=l.volume??0);const u={obv:o};n+=o,c>=t[0]-1&&(u.maObv=n/t[0],n-=r[c-(t[0]-1)].obv??0),r.push(u),a[l.timestamp]=u}),a}},tC={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:s=>{let e=0;return s.reduce((t,n,o)=>{const r={},a=n.close,l=n.volume??1,c=(s[o-1]??n).close;let f=0;const u=c*l;return u!==0&&(f=(a-c)/u),e+=f,r.pvt=e,t[n.timestamp]=r,t},{})}},sC={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0;const r=[],a=[],l={};return s.forEach((c,f)=>{const u={},d=(s[f-1]??c).close,h=c.close-d>0?1:0;r.push(h),n+=h,f>=t[0]-1&&(u.psy=n/t[0]*100,o+=u.psy,f>=t[0]+t[1]-2&&(u.maPsy=o/t[1],o-=a[f-(t[1]-1)].psy??0),n-=r[f-(t[0]-1)]),a.push(u),l[c.timestamp]=u}),l}},nC={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=[],o={};let r=0;return s.forEach((a,l)=>{const c={};if(l>=t[0]-1){const f=a.close,u=(s[l-t[0]]??s[l-(t[0]-1)]).close;u!==0?c.roc=(f-u)/u*100:c.roc=0,r+=c.roc,l>=t[0]-1+t[1]-1&&(c.maRoc=r/t[1],r-=n[l-(t[1]-1)].roc??0)}n.push(c),o[a.timestamp]=c}),o}},oC={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:s=>s.map((e,t)=>{const n=t+1;return{key:`rsi${n}`,title:`RSI${n}: `,type:"line"}}),calc:(s,e)=>{const{calcParams:t,figures:n}=e,o=[],r=[];return s.reduce((a,l,c)=>{const f={},u=(s[c-1]??l).close,d=l.close-u;return t.forEach((h,p)=>{if(d>0?o[p]=(o[p]??0)+d:r[p]=(r[p]??0)+Math.abs(d),c>=h-1){r[p]!==0?f[n[p].key]=100-100/(1+o[p]/r[p]):f[n[p].key]=0;const v=s[c-(h-1)],x=s[c-h]??v,S=v.close-x.close;S>0?o[p]-=S:r[p]-=Math.abs(S)}}),a[l.timestamp]=f,a},{})}},iC={name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(s,e)=>{const t=e.calcParams;let n=0,o=0;return s.reduce((r,a,l)=>{const c={},f=a.close;return n+=f,l>=t[0]-1&&(l>t[0]-1?o=(f*t[1]+o*(t[0]-t[1]+1))/(t[0]+1):o=n/t[0],c.sma=o),r[a.timestamp]=c,r},{})}},rC={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams,n=[],o={};return s.forEach((r,a)=>{var f,u;const l={},c=r.close;if(a>=t[0]-1){const d=Q6(s.slice(a-(t[0]-1),a+1),"high","low"),h=d[0],p=d[1],v=h-p,x=(c-p)/(v===0?1:v)*100;l.k=((t[1]-1)*(((f=n[a-1])==null?void 0:f.k)??50)+x)/t[1],l.d=((t[2]-1)*(((u=n[a-1])==null?void 0:u.d)??50)+l.k)/t[2],l.j=3*l.k-2*l.d}n.push(l),o[r.timestamp]=l}),o}},aC={name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:({data:s,indicator:e,defaultStyles:t})=>{const{current:n}=s,o=(n==null?void 0:n.sar)??Number.MIN_SAFE_INTEGER,r=(((n==null?void 0:n.high)??0)+((n==null?void 0:n.low)??0))/2;return{color:o<r?em(e.styles,"circles[0].upColor",t.circles[0].upColor):em(e.styles,"circles[0].downColor",t.circles[0].downColor)}}}],calc:(s,e)=>{const t=e.calcParams,n=t[0]/100,o=t[1]/100,r=t[2]/100;let a=n,l=-100,c=!1,f=0;return s.reduce((u,d,h)=>{const p=f,v=d.high,x=d.low;if(c){(l===-100||l<v)&&(l=v,a=Math.min(a+o,r)),f=p+a*(l-p);const S=Math.min(s[Math.max(1,h)-1].low,x);f>d.low?(f=l,a=n,l=-100,c=!c):f>S&&(f=S)}else{(l===-100||l>x)&&(l=x,a=Math.min(a+o,r)),f=p+a*(l-p);const S=Math.max(s[Math.max(1,h)-1].high,v);f<d.high?(f=l,a=0,l=-100,c=!c):f<S&&(f=S)}return u[d.timestamp]={high:v,low:x,sar:f},u},{})}},lC={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0,r=0,a=0,l=0,c=0,f=0;const u=[],d={};return s.forEach((h,p)=>{const v={},x=h.close;if(n+=x,p>=t[0]-1&&(p>t[0]-1?o=(2*x+(t[0]-1)*o)/(t[0]+1):o=n/t[0],l+=o,p>=t[0]*2-2&&(p>t[0]*2-2?r=(2*o+(t[0]-1)*r)/(t[0]+1):r=l/t[0],c+=r,p>=t[0]*3-3))){let S=0,C=0;p>t[0]*3-3?(S=(2*r+(t[0]-1)*a)/(t[0]+1),C=(S-a)/a*100):S=c/t[0],a=S,v.trix=C,f+=C,p>=t[0]*3+t[1]-4&&(v.maTrix=f/t[1],f-=u[p-(t[1]-1)].trix??0)}u.push(v),d[h.timestamp]=v}),d}};function bw(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:({data:s,indicator:e,defaultStyles:t})=>{const n=s.current;let o=em(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor);return Rn(n)&&(n.close>n.open?o=em(e.styles,"bars[0].upColor",t.bars[0].upColor):n.close<n.open&&(o=em(e.styles,"bars[0].downColor",t.bars[0].downColor))),{color:o}}}}const cC={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},bw()],regenerateFigures:s=>{const e=s.map((t,n)=>({key:`ma${n+1}`,title:`MA${t}: `,type:"line"}));return e.push(bw()),e},calc:(s,e)=>{const{calcParams:t,figures:n}=e,o=[];return s.reduce((r,a,l)=>{const c=a.volume??0,f={volume:c,open:a.open,close:a.close};return t.forEach((u,d)=>{o[d]=(o[d]??0)+c,l>=u-1&&(f[n[d].key]=o[d]/u,o[d]-=s[l-(u-1)].volume??0)}),r[a.timestamp]=f,r},{})}},uC={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(s,e)=>{const t=e.calcParams;let n=0,o=0,r=0,a=0;const l=[],c={};return s.forEach((f,u)=>{const d={},h=f.close,p=(s[u-1]??f).close,v=f.volume??0;if(h>p?n+=v:h<p?o+=v:r+=v,u>=t[0]-1){const x=r/2;o+x===0?d.vr=0:d.vr=(n+x)/(o+x)*100,a+=d.vr,u>=t[0]+t[1]-2&&(d.maVr=a/t[1],a-=l[u-(t[1]-1)].vr??0);const S=s[u-(t[0]-1)],C=s[u-t[0]]??S,I=S.close,A=S.volume??0;I>C.close?n-=A:I<C.close?o-=A:r-=A}l.push(d),c[f.timestamp]=d}),c}},dC={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:s=>s.map((e,t)=>({key:`wr${t+1}`,title:`WR${t+1}: `,type:"line"})),calc:(s,e)=>{const{calcParams:t,figures:n}=e;return s.reduce((o,r,a)=>{const l={},c=r.close;return t.forEach((f,u)=>{const d=f-1;if(a>=d){const h=Q6(s.slice(a-d,a+1),"high","low"),p=h[0],v=h[1],x=p-v;l[n[u].key]=x===0?0:(c-p)/x*100}}),o[r.timestamp]=l,o},{})}},bx={},fC=[j8,B8,O8,V8,W8,H8,q8,U8,G8,Y8,K8,X8,Z8,J8,Q8,eC,tC,sC,nC,oC,iC,rC,aC,lC,cC,uC,dC];fC.forEach(s=>{bx[s.name]=mb.extend(s)});function Rb(s){bx[s.name]=mb.extend(s)}function e5(s){return bx[s]??null}function eg(s,e){const t=(e==null?void 0:e.ignoreEvent)??!1;return A1(t)?!t:!t.includes(s)}const xw=1,X_=-1,pC="overlay_",y_="overlay_figure_";class vb{constructor(e){Pe(this,"id");Pe(this,"groupId","");Pe(this,"paneId");Pe(this,"name");Pe(this,"totalStep",1);Pe(this,"currentStep",xw);Pe(this,"lock",!1);Pe(this,"visible",!0);Pe(this,"zLevel",0);Pe(this,"needDefaultPointFigure",!1);Pe(this,"needDefaultXAxisFigure",!1);Pe(this,"needDefaultYAxisFigure",!1);Pe(this,"mode","normal");Pe(this,"modeSensitivity",8);Pe(this,"points",[]);Pe(this,"extendData");Pe(this,"styles",null);Pe(this,"createPointFigures",null);Pe(this,"createXAxisFigures",null);Pe(this,"createYAxisFigures",null);Pe(this,"performEventPressedMove",null);Pe(this,"performEventMoveForDrawing",null);Pe(this,"onDrawStart",null);Pe(this,"onDrawing",null);Pe(this,"onDrawEnd",null);Pe(this,"onClick",null);Pe(this,"onDoubleClick",null);Pe(this,"onRightClick",null);Pe(this,"onPressedMoveStart",null);Pe(this,"onPressedMoving",null);Pe(this,"onPressedMoveEnd",null);Pe(this,"onMouseMove",null);Pe(this,"onMouseEnter",null);Pe(this,"onMouseLeave",null);Pe(this,"onRemoved",null);Pe(this,"onSelected",null);Pe(this,"onDeselected",null);Pe(this,"_prevZLevel",0);Pe(this,"_prevOverlay");Pe(this,"_prevPressedPoint",null);Pe(this,"_prevPressedPoints",[]);this.override(e)}override(e){var c;this._prevOverlay=B_(this);const{id:t,name:n,currentStep:o,points:r,styles:a,...l}=e;if(Bh(this,l),Mf(this.name)||(this.name=n??""),!Mf(this.id)&&Mf(t)&&(this.id=t),Rn(a)&&(this.styles??(this.styles={}),Bh(this.styles,a)),lg(r)&&r.length>0){let f=0;if(this.points=[...r],r.length>=this.totalStep-1?(this.currentStep=X_,f=this.totalStep-1):(this.currentStep=r.length+1,f=r.length),cv(this.performEventMoveForDrawing))for(let u=0;u<f;u++)this.performEventMoveForDrawing({currentStep:u+2,mode:this.mode,points:this.points,performPointIndex:u,performPoint:this.points[u]});this.currentStep===X_&&((c=this.performEventPressedMove)==null||c.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}))}}getPrevZLevel(){return this._prevZLevel}setPrevZLevel(e){this._prevZLevel=e}shouldUpdate(){const e=this._prevOverlay.zLevel!==this.zLevel,t=e||JSON.stringify(this._prevOverlay.points)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles;return{sort:e,draw:t}}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=X_:this.currentStep++}forceComplete(){this.currentStep=X_}isDrawing(){return this.currentStep!==X_}isStart(){return this.currentStep===xw}eventMoveForDrawing(e){var o;const t=this.currentStep-1,n={};ul(e.timestamp)&&(n.timestamp=e.timestamp),ul(e.dataIndex)&&(n.dataIndex=e.dataIndex),ul(e.value)&&(n.value=e.value),this.points[t]=n,(o=this.performEventMoveForDrawing)==null||o.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:t,performPoint:n})}eventPressedPointMove(e,t){var n;this.points[t].timestamp=e.timestamp,ul(e.value)&&(this.points[t].value=e.value),(n=this.performEventPressedMove)==null||n.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})}startPressedMove(e){this._prevPressedPoint={...e},this._prevPressedPoints=B_(this.points)}eventPressedOtherMove(e,t){if(this._prevPressedPoint!==null){let n=null;ul(e.dataIndex)&&ul(this._prevPressedPoint.dataIndex)&&(n=e.dataIndex-this._prevPressedPoint.dataIndex);let o=null;ul(e.value)&&ul(this._prevPressedPoint.value)&&(o=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(r=>{ul(r.timestamp)&&(r.dataIndex=t.timestampToDataIndex(r.timestamp));const a={...r};return ul(n)&&ul(r.dataIndex)&&(a.dataIndex=r.dataIndex+n,a.timestamp=t.dataIndexToTimestamp(a.dataIndex)??void 0),ul(o)&&ul(r.value)&&(a.value=r.value+o),a})}}static extend(e){class t extends vb{constructor(){super(e)}}return t}}const hC={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:s,coordinates:e,bounding:t,overlay:n,yAxis:o})=>{var a;const r=n.points;if(e.length>0){let l=0;(o==null?void 0:o.isInCandle())??!0?l=((a=s.getSymbol())==null?void 0:a.pricePrecision)??dm.PRICE:s.getIndicators({paneId:n.paneId}).forEach(p=>{l=Math.max(l,p.precision)});const c=[],f=[],u=0,d=t.width;if(e.length>1&&ul(r[0].value)&&ul(r[1].value)){const h=[1,.786,.618,.5,.382,.236,0],p=e[0].y-e[1].y,v=r[0].value-r[1].value;h.forEach(x=>{const S=e[1].y+p*x,C=s.getDecimalFold().format(s.getThousandsSeparator().format(((r[1].value??0)+v*x).toFixed(l)));c.push({coordinates:[{x:u,y:S},{x:d,y:S}]}),f.push({x:u,y:S,text:`${C} (${(x*100).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:c},{type:"text",isCheckEvent:!1,attrs:f}]}return[]}},mC={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{const n={x:0,y:s[0].y};Rn(s[1])&&s[0].x<s[1].x&&(n.x=e.width);const o=[s[0],n];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]},performEventPressedMove:({points:s,performPoint:e})=>{s[0].value=e.value,s[1].value=e.value},performEventMoveForDrawing:({currentStep:s,points:e,performPoint:t})=>{s===2&&(e[0].value=t.value)}},vC={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>{const t=[];return s.length===2&&t.push({coordinates:s}),[{type:"line",attrs:t,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:t}]},performEventPressedMove:({points:s,performPoint:e})=>{s[0].value=e.value,s[1].value=e.value},performEventMoveForDrawing:({currentStep:s,points:e,performPoint:t})=>{s===2&&(e[0].value=t.value)}},gC={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{const n=[{x:0,y:s[0].y},{x:e.width,y:s[0].y}];return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]}},Rh=(s,e,t,n)=>{if(!t||!t.from&&!t.to)return null;const o=t.from||n,r=t.to||n;if(!o&&!r)return null;const a=Number.isFinite(e.minX)?e.minX:0,l=Number.isFinite(e.maxX)&&e.maxX!==e.minX?e.maxX:a+1,c=Number.isFinite(e.minY)?e.minY:0,f=Number.isFinite(e.maxY)&&e.maxY!==e.minY?e.maxY:c+1,u=String(t.mode||"vertical").toLowerCase();let d;if(u==="horizontal")d=s.createLinearGradient(a,c,l,c);else if(u==="radial"){const h=(a+l)/2,p=(c+f)/2,v=Math.max(l-a,f-c)/2;d=s.createRadialGradient(h,p,0,h,p,Math.max(1,v))}else d=s.createLinearGradient(a,c,a,f);return d.addColorStop(0,o),d.addColorStop(1,r),d};class xx{constructor(){Pe(this,"_children",[]);Pe(this,"_callbacks",new Map)}registerEvent(e,t){return this._callbacks.set(e,t),this}onEvent(e,t){const n=this._callbacks.get(e);return Rn(n)&&this.checkEventOn(t)?n(t):!1}dispatchEventToChildren(e,t){const n=this._children.length-1;if(n>-1){for(let o=n;o>-1;o--)if(this._children[o].dispatchEvent(e,t))return!0}return!1}dispatchEvent(e,t){return this.dispatchEventToChildren(e,t)?!0:this.onEvent(e,t)}addChild(e){return this._children.push(e),this}clear(){this._children=[]}}const _C=8,yC=12;function H_(s){return s.isTouch?yC:_C}class gb extends xx{constructor(t){super();Pe(this,"attrs");Pe(this,"styles");this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}setAttrs(t){return this.attrs=t,this}setStyles(t){return this.styles=t,this}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){class n extends gb{checkEventOnImp(r,a,l){return t.checkEventOn(r,a,l)}drawImp(r,a,l){t.draw(r,a,l)}}return n}}function t5(s,e,t){let n=[];n=n.concat(e);const o=H_(s),r=Math.max(0,ul(t==null?void 0:t.size)?t.size:0),a=o+(r>1?r/2:0);for(const l of n){const{coordinates:c}=l;if(c.length>1)for(let f=1;f<c.length;f++){const u=c[f-1],d=c[f];if(u.x===d.x){if(Math.abs(u.y-s.y)+Math.abs(d.y-s.y)-Math.abs(u.y-d.y)<a+a&&Math.abs(s.x-u.x)<a)return!0}else{const h=_b(u,d),p=wx(h,s),v=Math.abs(p-s.y);if(Math.abs(u.x-s.x)+Math.abs(d.x-s.x)-Math.abs(u.x-d.x)<a+a&&v*v/(h[0]*h[0]+1)<a*a)return!0}}}return!1}function wx(s,e){return s!==null?e.x*s[0]+s[1]:e.y}function T1(s,e,t){const n=_b(s,e);return wx(n,t)}function _b(s,e){const t=s.x-e.x;if(t!==0){const n=(s.y-e.y)/t,o=s.y-n*s.x;return[n,o]}return null}function s5(s,e,t){const n=e.length,o=ul(t)?t>0&&t<1?t:0:t?.5:0;if(o>0&&n>2){let r=e[0].x,a=e[0].y;for(let c=1;c<n-1;c++){const f=e[c-1],u=e[c],d=e[c+1],h=u.x-f.x,p=u.y-f.y,v=d.x-u.x,x=d.y-u.y;let S=d.x-f.x,C=d.y-f.y;const I=Math.sqrt(h*h+p*p),A=Math.sqrt(v*v+x*x),P=A/(A+I);let T=u.x+S*o*P,j=u.y+C*o*P;T=Math.min(T,Math.max(d.x,u.x)),j=Math.min(j,Math.max(d.y,u.y)),T=Math.max(T,Math.min(d.x,u.x)),j=Math.max(j,Math.min(d.y,u.y)),S=T-u.x,C=j-u.y;let E=u.x-S*I/A,L=u.y-C*I/A;E=Math.min(E,Math.max(f.x,u.x)),L=Math.min(L,Math.max(f.y,u.y)),E=Math.max(E,Math.min(f.x,u.x)),L=Math.max(L,Math.min(f.y,u.y)),S=u.x-E,C=u.y-L,T=u.x+S*A/I,j=u.y+C*A/I,s.bezierCurveTo(r,a,E,L,u.x,u.y),r=T,a=j}const l=e[n-1];s.bezierCurveTo(r,a,l.x,l.y,l.x,l.y)}else for(let r=1;r<n;r++)s.lineTo(e[r].x,e[r].y)}function bC(s,e,t){let n=[];n=n.concat(e);const{style:o="solid",smooth:r=!1,size:a=1,color:l="currentColor",gradient:c,dashedValue:f=[2,2]}=t,u=!!(c&&(c.from||c.to));s.lineWidth=a,o==="dashed"?s.setLineDash(f):s.setLineDash([]);const d=a%2===1?.5:0;n.forEach(({coordinates:h})=>{if(h.length>1){if(u){let p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;for(const I of h)!Number.isFinite(I.x)||!Number.isFinite(I.y)||(I.x<p&&(p=I.x),I.x>v&&(v=I.x),I.y<x&&(x=I.y),I.y>S&&(S=I.y));const C=Rh(s,{minX:Number.isFinite(p)?p:0,maxX:Number.isFinite(v)&&v!==p?v:Number.isFinite(p)?p+1:1,minY:Number.isFinite(x)?x:0,maxY:Number.isFinite(S)&&S!==x?S:Number.isFinite(x)?x+1:1},c,String(l||"#000000"));C?s.strokeStyle=C:s.strokeStyle=l}else s.strokeStyle=l;h.length===2&&(h[0].x===h[1].x||h[0].y===h[1].y)?(s.beginPath(),h[0].x===h[1].x?(s.moveTo(h[0].x+d,h[0].y),s.lineTo(h[1].x+d,h[1].y)):(s.moveTo(h[0].x,h[0].y+d),s.lineTo(h[1].x,h[1].y+d)),s.stroke(),s.closePath()):(s.save(),a%2===1&&s.translate(.5,.5),s.beginPath(),s.moveTo(h[0].x,h[0].y),s5(s,h,r),s.stroke(),s.closePath(),s.restore())}})}const xC={name:"line",checkEventOn:t5,draw:(s,e,t)=>{bC(s,e,t)}};function n5(s,e,t){const n=t??0,o=[];if(s.length>1)if(s[0].x===s[1].x){const a=e.height;if(o.push({coordinates:[{x:s[0].x,y:0},{x:s[0].x,y:a}]}),s.length>2){o.push({coordinates:[{x:s[2].x,y:0},{x:s[2].x,y:a}]});const l=s[0].x-s[2].x;for(let c=0;c<n;c++){const f=l*(c+1);o.push({coordinates:[{x:s[0].x+f,y:0},{x:s[0].x+f,y:a}]})}}}else{const a=e.width,l=_b(s[0],s[1]),c=l[0],f=l[1];if(o.push({coordinates:[{x:0,y:0*c+f},{x:a,y:a*c+f}]}),s.length>2){const u=s[2].y-c*s[2].x;o.push({coordinates:[{x:0,y:0*c+u},{x:a,y:a*c+u}]});const d=f-u;for(let h=0;h<n;h++){const p=f+d*(h+1);o.push({coordinates:[{x:0,y:0*c+p},{x:a,y:a*c+p}]})}}}return o}const wC={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{const n=n5(s,e);return[{type:"line",attrs:n,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:n}]}},kC={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{const n=n5(s,e,1);return[{type:"line",attrs:n,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:n}]}},SC={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:s,coordinates:e,bounding:t,overlay:n,yAxis:o})=>{var f;let a=0;(o==null?void 0:o.isInCandle())??!0?a=((f=s.getSymbol())==null?void 0:f.pricePrecision)??dm.PRICE:s.getIndicators({paneId:n.paneId}).forEach(d=>{a=Math.max(a,d.precision)});const{value:l=0}=n.points[0],c=[e[0],{x:t.width,y:e[0].y}];return[{type:"line",attrs:{coordinates:c},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:c}},{type:"text",ignoreEvent:!0,attrs:{x:e[0].x,y:e[0].y,text:s.getDecimalFold().format(s.getThousandsSeparator().format(l.toFixed(a))),baseline:"bottom"}}]}};function CC(s,e){if(s.length>1){let t={x:0,y:0};return s[0].x===s[1].x&&s[0].y!==s[1].y?s[0].y<s[1].y?t={x:s[0].x,y:e.height}:t={x:s[0].x,y:0}:s[0].x>s[1].x?t={x:0,y:T1(s[0],s[1],{x:0,y:s[0].y})}:t={x:e.width,y:T1(s[0],s[1],{x:e.width,y:s[0].y})},{coordinates:[s[0],t]}}return[]}const IC={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{const n=CC(s,e);return[{type:"line",attrs:n,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:n}]}},PC={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>s.length===2?[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]:[]},MC={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{if(s.length===2){if(s[0].x===s[1].x){const o=[{x:s[0].x,y:0},{x:s[0].x,y:e.height}];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]}const n=[{x:0,y:T1(s[0],s[1],{x:0,y:s[0].y})},{x:e.width,y:T1(s[0],s[1],{x:e.width,y:s[0].y})}];return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]}return[]}},NC={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{if(s.length===2){const n={x:s[0].x,y:0};s[0].y<s[1].y&&(n.y=e.height);const o=[s[0],n];return[{type:"line",attrs:{coordinates:o},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:o}}]}return[]},performEventPressedMove:({points:s,performPoint:e})=>{s[0].timestamp=e.timestamp,s[0].dataIndex=e.dataIndex,s[1].timestamp=e.timestamp,s[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:s,points:e,performPoint:t})=>{s===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},AC={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>s.length===2?[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}}]:[],performEventPressedMove:({points:s,performPoint:e})=>{s[0].timestamp=e.timestamp,s[0].dataIndex=e.dataIndex,s[1].timestamp=e.timestamp,s[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:s,points:e,performPoint:t})=>{s===2&&(e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex)}},TC={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{const n=[{x:s[0].x,y:0},{x:s[0].x,y:e.height}];return[{type:"line",attrs:{coordinates:n},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:n}}]}},FC={name:"simpleAnnotation",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({overlay:s,coordinates:e})=>{let t="";Rn(s.extendData)&&(cv(s.extendData)?t=s.extendData(s):t=s.extendData??"");const n=e[0].x,o=e[0].y-6,r=o-50,a=r-5;return[{type:"line",attrs:{coordinates:[{x:n,y:o},{x:n,y:r}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:n,y:r},{x:n-4,y:a},{x:n+4,y:a}]},ignoreEvent:!0},{type:"text",attrs:{x:n,y:a,text:t,align:"center",baseline:"bottom"},ignoreEvent:!0}]}},LC={name:"simpleTag",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({bounding:s,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:s.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({chart:s,overlay:e,coordinates:t,bounding:n,yAxis:o})=>{var f;const r=(o==null?void 0:o.isFromZero())??!1;let a="left",l=0;r?(a="left",l=0):(a="right",l=n.width);let c="";return Rn(e.extendData)&&(cv(e.extendData)?c=e.extendData(e):c=e.extendData??""),!Rn(c)&&ul(e.points[0].value)&&(c=Im(e.points[0].value,((f=s.getSymbol())==null?void 0:f.pricePrecision)??dm.PRICE)),{type:"text",attrs:{x:l,y:t[0].y,text:c,align:a,baseline:"middle"}}}},kx={},EC=[hC,mC,vC,gC,wC,kC,SC,IC,PC,MC,NC,AC,TC,FC,LC];EC.forEach(s=>{kx[s.name]=vb.extend(s)});function o5(s){kx[s.name]=vb.extend(s)}function $C(s){return kx[s]??null}const DC={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},title:{color:"#76808F"},legend:{color:"#76808F"}}},indicator:{tooltip:{title:{color:"#76808F"},legend:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},ticduty:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#6b7280"},ticduty:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},RC={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},title:{color:"#929AA5"},legend:{color:"#929AA5"}}},indicator:{tooltip:{title:{color:"#929AA5"},legend:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},ticduty:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#9aa0a6"},ticduty:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},jC={light:DC,dark:RC};function BC(s){return jC[s]??null}const Cy=30,i5=100,yd={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},ww={MIN:1,MAX:900},OC=10,zC=80,VC=.2,$2=10,K1=Number.MAX_SAFE_INTEGER,WC=-1e4,Lp=24*60*60*1e3;function jb(s){if(s.length===0)return 0;const e=s.slice().sort((t,n)=>t-n);return e[Math.floor(e.length/2)]}function Bb(s,e){if(s.length===0)return 0;const t=Math.max(0,Math.min(1,e)),n=Math.floor(t*(s.length-1));return s[n]}function HC(s){if(s.length===0)return 0;let e=0,t=0;for(const r of s){const a=2*Math.PI*(r/Lp);e+=Math.sin(a),t+=Math.cos(a)}const n=Math.atan2(e/s.length,t/s.length);return(n<0?n+2*Math.PI:n)/(2*Math.PI)*Lp}function d_(s,e){return Math.floor((s-e)/Lp)*Lp+e}function O_(s){return new Date(s).getUTCDay()}function r5(s,e,t){if(e<=0)return 0;const n=t.reduce((l,c)=>l+(c?1:0),0);if(n<=0)return 0;let r=Math.floor(e/7)*n;const a=e%7;for(let l=0;l<a;l++){const c=(s+1+l)%7;t[c]&&r++}return r}function qC(s,e,t){if(e<=0)return 0;const n=t.reduce((l,c)=>l+(c?1:0),0);if(n<=0)return 0;let r=Math.floor(e/7)*n;const a=e%7;for(let l=0;l<a;l++){const c=(s+7-(1+l)%7)%7;t[c]&&r++}return r}function UC(s){try{if(!Array.isArray(s)||s.length<20)return null;const e=s.slice(Math.max(0,s.length-2500)),t=[];for(const P of e){const T=P==null?void 0:P.timestamp;typeof T=="number"&&isFinite(T)&&t.push(T)}if(t.length<20)return null;t.sort((P,T)=>P-T);const n=[];for(let P=1;P<t.length;P++){const T=t[P]-t[P-1];T>0&&isFinite(T)&&n.push(T)}if(n.length<10)return null;n.sort((P,T)=>P-T);const o=Bb(n,.1)||n[0];if(!o||!isFinite(o)||o<=0)return null;const r=Math.max(o*6,o*3+6e4),a=[];for(let P=1;P<t.length;P++)if(t[P]-t[P-1]>r){const E=((t[P]+t[P-1])/2%Lp+Lp)%Lp;a.push(E)}const l=a.length>=4?HC(a):0,c=new Map;for(const P of t){const T=d_(P,l),j=c.get(T);j?(j.count++,P<j.minTs&&(j.minTs=P),P>j.maxTs&&(j.maxTs=P)):c.set(T,{minTs:P,maxTs:P,count:1})}const f=Array.from(c.keys()).sort((P,T)=>P-T),u=f.slice(Math.max(0,f.length-40)),d=[],h=[],p=new Array(7).fill(!1),v=[];for(const P of u){const T=c.get(P);T!=null&&T.count&&v.push(T.count)}const x=jb(v.filter(P=>P>0)),S=Math.max(2,Math.floor(x*.6));for(const P of u){const T=c.get(P);if(!T)continue;const j=O_(P);p[j]=!0;const E=T.minTs-P,L=T.maxTs-P+o;T.count>=S&&isFinite(E)&&isFinite(L)&&E>=0&&L>=0&&E<Lp&&L<=Lp&&L>E&&(d.push(E),h.push(L))}let C=0,I=Lp;if(d.length>=5&&h.length>=5)C=jb(d),I=jb(h);else{const P=[];for(const E of t){const L=((E-l)%Lp+Lp)%Lp;P.push(L)}P.sort((E,L)=>E-L);const T=Bb(P,.05),j=Bb(P,.95);C=T,I=Math.min(Lp,j+o)}if(C>=0&&I>C&&I<=Lp||(C=0,I=Lp),I-C>Lp*.92&&(C=0,I=Lp),!p.some(Boolean))for(let P=0;P<7;P++)p[P]=!0;return{boundaryOffsetMs:l,openMs:C,closeMs:I,activeWeekdays:p}}catch{return null}}function Ob(s,e,t){if(s===e)return 0;let n=1,o=s,r=e;o>r&&(n=-1,o=e,r=s);const{boundaryOffsetMs:a,openMs:l,closeMs:c,activeWeekdays:f}=t,u=Math.max(0,c-l);if(u<=0)return 0;const d=d_(o,a),h=d_(r,a),p=o-d,v=r-h,x=O_(d),S=O_(h);if(d===h){if(!f[x])return 0;const P=Math.max(p,l),T=Math.min(v,c);return n*Math.max(0,T-P)}let C=0;f[x]&&(C+=Math.max(0,c-Math.max(p,l))),f[S]&&(C+=Math.max(0,Math.min(v,c)-l));const I=Math.max(0,Math.round((h-d)/Lp)),A=Math.max(0,I-1);if(A>0){const P=r5(x,A,f);C+=P*u}return n*C}function w1(s,e,t){let n=s,o=e;for(let r=0;r<14;r++)if(n+=Lp,o=(o+1)%7,t[o])return{dayStart:n,weekday:o};return{dayStart:s+Lp,weekday:(e+1)%7}}function k1(s,e,t){let n=s,o=e;for(let r=0;r<14;r++)if(n-=Lp,o=(o+6)%7,t[o])return{dayStart:n,weekday:o};return{dayStart:s-Lp,weekday:(e+6)%7}}function zb(s,e,t){if(e===0||!Number.isFinite(e))return s;const{boundaryOffsetMs:n,openMs:o,closeMs:r,activeWeekdays:a}=t;if(Math.max(0,r-o)<=0)return s;let c=s,f=e;const u=f>0;for(f=Math.abs(f);f>0;){let d=d_(c,n),h=O_(d),p=c-d;if(!a[h]){const v=u?w1(d,h,a):k1(d,h,a);d=v.dayStart,h=v.weekday,p=u?o:r,c=d+p}if(u){if(p<o)p=o,c=d+p;else if(p>=r){const S=w1(d,h,a);d=S.dayStart,h=S.weekday,p=o,c=d+p}const v=Math.max(0,r-p);if(f<v)return c+f;f-=v,c=w1(d,h,a).dayStart+o}else{if(p>r)p=r,c=d+p;else if(p<=o){const S=k1(d,h,a);d=S.dayStart,h=S.weekday,p=r,c=d+p}const v=Math.max(0,p-o);if(f<v)return c-f;f-=v,c=k1(d,h,a).dayStart+r}}return c}function GC(s,e,t){if(s===e)return 0;const{boundaryOffsetMs:n,activeWeekdays:o}=t,r=d_(s,n),a=d_(e,n);if(r===a)return 0;const l=O_(r),c=Math.round((a-r)/Lp);return c>0?r5(l,c,o):-qC(l,Math.abs(c),o)}function YC(s,e,t){if(e===0||!Number.isFinite(e))return s;const{boundaryOffsetMs:n,activeWeekdays:o}=t,r=o.reduce((h,p)=>h+(p?1:0),0);if(r<=0)return s;let a=d_(s,n),l=O_(a),c=s-a;if(!o[l])if(e>0){const h=w1(a,l,o);a=h.dayStart,l=h.weekday}else{const h=k1(a,l,o);a=h.dayStart,l=h.weekday}let f=Math.abs(e);const u=e>0,d=Math.floor(f/r);for(d>0&&(a+=(u?1:-1)*d*7*Lp,f-=d*r);f>0;){const h=u?w1(a,l,o):k1(a,l,o);a=h.dayStart,l=h.weekday,f--}return c=Math.max(0,Math.min(Lp-1,c)),a+c}class KC{constructor(e,t){Pe(this,"_chart");Pe(this,"_styles",R8());Pe(this,"_formatter",{formatDate:({dateTimeFormat:e,timestamp:t,template:n})=>K6(e,t,n),formatBigNumber:X6,formatExtendText:e=>""});Pe(this,"_innerFormatter",{formatDate:(e,t,n)=>this._formatter.formatDate({dateTimeFormat:this._dateTimeFormat,timestamp:e,template:t,type:n}),formatBigNumber:e=>this._formatter.formatBigNumber(e),formatExtendText:e=>this._formatter.formatExtendText(e)});Pe(this,"_locale","en-US");Pe(this,"_thousandsSeparator",{sign:",",format:e=>Z6(e,this._thousandsSeparator.sign)});Pe(this,"_decimalFold",{threshold:3,format:e=>J6(e,this._decimalFold.threshold)});Pe(this,"_symbol",null);Pe(this,"_period",null);Pe(this,"_sessionCacheKey",null);Pe(this,"_sessionCache",null);Pe(this,"_sessionBySymbol",new Map);Pe(this,"_dataList",[]);Pe(this,"_dataLoader",null);Pe(this,"_loading",!1);Pe(this,"_dataLoadMore",{forward:!1,backward:!1});Pe(this,"_dateTimeFormat");Pe(this,"_zoomEnabled",!0);Pe(this,"_scrollEnabled",!0);Pe(this,"_totalBarSpace",0);Pe(this,"_barSpace",OC);Pe(this,"_gapBarSpace",0);Pe(this,"_offsetRightDistance",zC);Pe(this,"_lastBarRightSideDiffBarCount");Pe(this,"_startLastBarRightSideDiffBarCount",0);Pe(this,"_scrollLimitRole","bar_count");Pe(this,"_minVisibleBarCount",{left:2,right:2});Pe(this,"_maxOffsetDistance",{left:50,right:50});Pe(this,"_visibleRange",gw());Pe(this,"_visibleRangeDataList",[]);Pe(this,"_visibleRangeHighLowPrice",[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}]);Pe(this,"_crosshair",{});Pe(this,"_actions",new Map);Pe(this,"_indicators",new Map);Pe(this,"_taskScheduler",new I8);Pe(this,"_overlays",new Map);Pe(this,"_progressOverlayInfo",null);Pe(this,"_lastPriceMarkExtendTextUpdateTimers",[]);Pe(this,"_pressedOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Pe(this,"_hoverOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Pe(this,"_clickOverlayInfo",{paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null});Pe(this,"_layoutRafId",null);Pe(this,"_pendingLayoutOptions",{measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1});Pe(this,"_overlayRafId",null);Pe(this,"_perfScrollCalls",0);Pe(this,"_perfZoomCalls",0);Pe(this,"_perfLayoutSchedules",0);Pe(this,"_perfLastWindowTs",typeof performance<"u"?performance.now():Date.now());this._chart=e,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;const{styles:n,locale:o,timezone:r,formatter:a,thousandsSeparator:l,decimalFold:c}=t??{};Rn(n)&&this.setStyles(n),Mf(o)&&this.setLocale(o),this.setTimezone(r??""),Rn(a)&&this.setFormatter(a),Rn(l)&&this.setThousandsSeparator(l),Rn(c)&&this.setDecimalFold(c)}setStyles(e){var n,o,r,a,l,c;let t=null;if(Mf(e)?t=BC(e):t=e,Bh(this._styles,t),lg((r=(o=(n=t==null?void 0:t.candle)==null?void 0:n.tooltip)==null?void 0:o.legend)==null?void 0:r.template)&&(this._styles.candle.tooltip.legend.template=t.candle.tooltip.legend.template),Rn((c=(l=(a=t==null?void 0:t.candle)==null?void 0:a.priceMark)==null?void 0:l.last)==null?void 0:c.extendTexts)){this._clearLastPriceMarkExtendTextUpdateTimer();const f=[];this._styles.candle.priceMark.last.extendTexts.forEach(u=>{const d=u.updateInterval;if(u.show&&d>0&&!f.includes(d)){f.push(d);const h=setInterval(()=>{this._chart.updatePane(zf.Main,yd.CANDLE)},d);this._lastPriceMarkExtendTextUpdateTimers.push(h)}})}}getStyles(){return this._styles}setFormatter(e){Bh(this._formatter,e)}getFormatter(){return this._formatter}getInnerFormatter(){return this._innerFormatter}setLocale(e){this._locale=e}getLocale(){return this._locale}setTimezone(e){if(!Rn(this._dateTimeFormat)||this.getTimezone()!==e){const t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};e.length>0&&(t.timeZone=e);let n=null;try{n=new Intl.DateTimeFormat("en",t)}catch{}n!==null&&(this._dateTimeFormat=n)}}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getDateTimeFormat(){return this._dateTimeFormat}setThousandsSeparator(e){Bh(this._thousandsSeparator,e)}getThousandsSeparator(){return this._thousandsSeparator}setDecimalFold(e){Bh(this._decimalFold,e)}getDecimalFold(){return this._decimalFold}setSymbol(e){this.resetData(()=>{this._symbol={pricePrecision:dm.PRICE,volumePrecision:dm.VOLUME,...this._symbol,...e},this._synchronizeIndicatorSeriesPrecision()})}getSymbol(){return this._symbol}setPeriod(e){this.resetData(()=>{this._period=e})}getPeriod(){return this._period}_getSessionSymbolKey(){var n,o;const e=(n=this._symbol)==null?void 0:n.ticker;if(!e||typeof e!="string")return"";const t=(o=this._symbol)==null?void 0:o.exchange;return`${typeof t=="string"?t:""}:${e}`}_getInferredSession(){var e,t;try{const n=this._getSessionSymbolKey(),o=this._dataList.length,r=o>0?(e=this._dataList[0])==null?void 0:e.timestamp:0,a=o>0?(t=this._dataList[o-1])==null?void 0:t.timestamp:0,l=`${n}|${o}|${r}|${a}`;if(this._sessionCacheKey===l)return this._sessionCache;let c=UC(this._dataList);return c&&n?this._sessionBySymbol.set(n,c):!c&&n&&(c=this._sessionBySymbol.get(n)??null),this._sessionCacheKey=l,this._sessionCache=c,c}catch{return null}}_refineDataIndexByTimestamp(e,t,n){const o=Math.max(0,Math.min(50,Math.floor(n)));let r=t,a=Number.POSITIVE_INFINITY;for(let l=t-o;l<=t+o;l++){const c=this.dataIndexToTimestamp(l);if(!ul(c))continue;const f=Math.abs(c-e);f<a&&(a=f,r=l)}return r}_inferPeriodFromData(){const e=this._dataList.length;if(e<2)return null;const t=this._dataList[e-2].timestamp,n=this._dataList[e-1].timestamp,o=Math.max(1,n-t),r=1e3,a=60*r,l=60*a,c=24*l,f=7*c,u=30*c,d=365*c,h=[{type:"second",unit:r},{type:"minute",unit:a},{type:"hour",unit:l},{type:"day",unit:c},{type:"week",unit:f},{type:"month",unit:u},{type:"year",unit:d}];let p=null,v=Number.MAX_VALUE;for(const x of h){const S=Math.max(1,Math.round(o/x.unit)),C=S*x.unit,I=Math.abs(C-o);I<v&&(v=I,p={type:x.type,span:S})}return p}getDataList(){return this._dataList}getVisibleRangeDataList(){return this._visibleRangeDataList}getVisibleRangeHighLowPrice(){return this._visibleRangeHighLowPrice}_addData(e,t,n){let o=!1,r=!1,a=0;if(lg(e)){const l={backward:!1,forward:!1};switch(A1(n)?(l.backward=n,l.forward=n):(l.backward=(n==null?void 0:n.backward)??!1,l.forward=(n==null?void 0:n.forward)??!1),a=e.length,t){case"init":{this._clearData(),this._dataList=e,this._dataLoadMore.backward=l.backward,this._dataLoadMore.forward=l.forward,this.setOffsetRightDistance(this._offsetRightDistance),r=!0;break}case"backward":{this._dataList=this._dataList.concat(e),this._dataLoadMore.backward=l.backward,this._lastBarRightSideDiffBarCount-=a,r=a>0;break}case"forward":{this._dataList=e.concat(this._dataList),this._dataLoadMore.forward=l.forward,r=a>0;break}}o=!0}else{const l=this._dataList.length,c=e.timestamp,f=em(this._dataList[l-1],"timestamp",0);if(c>f){this._dataList.push(e);let u=this.getLastBarRightSideDiffBarCount();u<0&&this.setLastBarRightSideDiffBarCount(--u),a=1,o=!0,r=!0}else c===f&&(this._dataList[l-1]=e,o=!0,r=!0)}o&&r&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this.getIndicatorsByFilter({}).forEach(c=>{this._addIndicatorCalcTask(c,t)}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}))}setDataLoader(e){this.resetData(()=>{this._dataLoader=e})}_calcOptimalBarSpace(){const t=1-VC*Math.atan(Math.max(4,this._barSpace)-4)/(Math.PI*.5);let n=Math.min(Math.floor(this._barSpace*t),Math.floor(this._barSpace));n%2===0&&n+2>=this._barSpace&&--n,this._gapBarSpace=Math.max(1,n)}_adjustVisibleRange(){const e=this._dataList.length,t=this._totalBarSpace/this._barSpace;let n=0,o=0;this._scrollLimitRole==="distance"?(n=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,o=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(n=this._minVisibleBarCount.left,o=this._minVisibleBarCount.right),n=Math.max(0,n),o=Math.max(0,o);const r=t-Math.min(n,e);this._lastBarRightSideDiffBarCount>r&&(this._lastBarRightSideDiffBarCount=r);const a=-e+Math.min(o,e);this._lastBarRightSideDiffBarCount<a&&(this._lastBarRightSideDiffBarCount=a);let l=Math.round(this._lastBarRightSideDiffBarCount+e+.5);const c=l;l>e&&(l=e);let f=Math.round(l-t)-1;f<0&&(f=0);const u=this._lastBarRightSideDiffBarCount>0?Math.round(e+this._lastBarRightSideDiffBarCount-t)-1:f;this._visibleRange={from:f,to:l,realFrom:u,realTo:c},this.executeAction("onVisibleRangeChange",this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(let d=u;d<c;d++){const h=this._dataList[d],p=this.dataIndexToCoordinate(d);this._visibleRangeDataList.push({dataIndex:d,x:p,data:{prev:this._dataList[d-1]??h,current:h,next:this._dataList[d+1]??h}}),Rn(h)&&(this._visibleRangeHighLowPrice[0].price<h.high&&(this._visibleRangeHighLowPrice[0].price=h.high,this._visibleRangeHighLowPrice[0].x=p),this._visibleRangeHighLowPrice[1].price>h.low&&(this._visibleRangeHighLowPrice[1].price=h.low,this._visibleRangeHighLowPrice[1].x=p))}f===0?this._dataLoadMore.forward&&this._processDataLoad("forward"):l===e&&this._dataLoadMore.backward&&this._processDataLoad("backward")}_processDataLoad(e){var t,n;if(!this._loading&&Rn(this._dataLoader)&&Rn(this._symbol)&&Rn(this._period)){this._loading=!0;const o={type:e,symbol:this._symbol,period:this._period,timestamp:null,callback:(r,a)=>{var c,f;this._loading=!1,!(lg(r)&&r.length>0)&&(e==="forward"?this._dataLoadMore.forward=!1:e==="backward"&&(this._dataLoadMore.backward=!1)),this._addData(r,e,a),e==="init"&&((f=(c=this._dataLoader)==null?void 0:c.subscribeBar)==null||f.call(c,{symbol:this._symbol,period:this._period,callback:u=>{this._addData(u,"update")}}))}};switch(e){case"backward":{o.timestamp=((t=this._dataList[this._dataList.length-1])==null?void 0:t.timestamp)??null;break}case"forward":{o.timestamp=((n=this._dataList[0])==null?void 0:n.timestamp)??null;break}}try{this._dataLoader.getBars(o)}catch{this._loading=!1}}}_processDataUnsubscribe(){var e,t;Rn(this._dataLoader)&&Rn(this._symbol)&&Rn(this._period)&&((t=(e=this._dataLoader).unsubscribeBar)==null||t.call(e,{symbol:this._symbol,period:this._period}))}resetData(e){this._processDataUnsubscribe(),e==null||e(),this._loading=!1,this._processDataLoad("init")}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}}setBarSpace(e,t){e<ww.MIN||e>ww.MAX||this._barSpace===e||(this._barSpace=e,this._calcOptimalBarSpace(),t==null||t(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setTotalBarSpace(e){this._totalBarSpace!==e&&(this._totalBarSpace=e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setOffsetRightDistance(e,t){return this._offsetRightDistance=this._scrollLimitRole==="distance"?Math.min(this._maxOffsetDistance.right,e):e,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(t??!1)&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})),this}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)}getLastBarRightSideDiffBarCount(){return this._lastBarRightSideDiffBarCount}setLastBarRightSideDiffBarCount(e){this._lastBarRightSideDiffBarCount=e}setMaxOffsetLeftDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.left=e}setMaxOffsetRightDistance(e){this._scrollLimitRole="distance",this._maxOffsetDistance.right=e}setLeftMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.left=e}setRightMinVisibleBarCount(e){this._scrollLimitRole="bar_count",this._minVisibleBarCount.right=e}getVisibleRange(){return this._visibleRange}startScroll(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount}scroll(e){if(!this._scrollEnabled)return;const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfScrollCalls++;const n=e/this._barSpace,o=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-n;const r=Math.round(o-this._lastBarRightSideDiffBarCount*this._barSpace);r!==0&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._scheduleLayout({update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}),this.executeAction("onScroll",{distance:r}))}getDataByDataIndex(e){return this._dataList[e]??null}coordinateToFloatIndex(e){const t=this._dataList.length,n=(this._totalBarSpace-e)/this._barSpace,o=t+this._lastBarRightSideDiffBarCount-n;return Math.round(o*1e6)/1e6}dataIndexToTimestamp(e){const t=this._dataList.length;if(t===0)return null;const n=this.getDataByDataIndex(e);if(Rn(n))return n.timestamp;if(Rn(this._period)||this._dataList.length>0){const o=t-1;let r=null,a=0;if(e>o?(r=this._dataList[o].timestamp,a=e-o):e<0&&(r=this._dataList[0].timestamp,a=e),ul(r)){const l=this._period??this._inferPeriodFromData();if(Rn(l)){const{type:c,span:f}=l;switch(c){case"second":{const u=this._getInferredSession();return u?zb(r,f*1e3*a,u):r+f*1e3*a}case"minute":{const u=this._getInferredSession();return u?zb(r,f*60*1e3*a,u):r+f*60*1e3*a}case"hour":{const u=this._getInferredSession();return u?zb(r,f*60*60*1e3*a,u):r+f*60*60*1e3*a}case"day":{const u=this._getInferredSession();return u?YC(r,f*a,u):r+f*24*60*60*1e3*a}case"week":return r+f*7*24*60*60*1e3*a;case"month":{const u=new Date(r),d=u.getDate();u.setDate(1),u.setMonth(u.getMonth()+f*a);const h=new Date(u.getFullYear(),u.getMonth()+1,0).getDate();return u.setDate(Math.min(d,h)),u.getTime()}case"year":{const u=new Date(r);return u.setFullYear(u.getFullYear()+f*a),u.getTime()}}}}}return null}timestampToDataIndex(e){const t=this._dataList.length;if(t===0)return 0;if(Rn(this._period)||this._dataList.length>0){let n=null,o=0;const r=t-1,a=this._dataList[r].timestamp;e>a&&(n=a,o=r);const l=this._dataList[0].timestamp;if(e<l&&(n=l,o=0),ul(n)){const c=this._period??this._inferPeriodFromData();if(Rn(c)){const{type:f,span:u}=c;switch(f){case"second":{const d=this._getInferredSession();if(d){const h=Ob(n,e,d),p=u*1e3,v=o+h/p;return Math.round(v*1e6)/1e6}return o+(e-n)/(u*1e3)}case"minute":{const d=this._getInferredSession();if(d){const h=Ob(n,e,d),p=u*60*1e3,v=o+h/p;return Math.round(v*1e6)/1e6}return o+(e-n)/(u*60*1e3)}case"hour":{const d=this._getInferredSession();if(d){const h=Ob(n,e,d),p=u*60*60*1e3,v=o+h/p;return Math.round(v*1e6)/1e6}return o+(e-n)/(u*60*60*1e3)}case"day":{const d=this._getInferredSession();if(d){const h=GC(n,e,d),p=o+Math.floor(h/u);return this._refineDataIndexByTimestamp(e,p,6)}return o+Math.floor((e-n)/(u*24*60*60*1e3))}case"week":return o+Math.floor((e-n)/(u*7*24*60*60*1e3));case"month":{const d=new Date(n),h=new Date(e),p=d.getFullYear(),v=h.getFullYear(),x=d.getMonth(),S=h.getMonth();return o+Math.floor(((v-p)*12+(S-x))/u)}case"year":{const d=new Date(n).getFullYear(),h=new Date(e).getFullYear();return o+Math.floor((h-d)/u)}}}}}return E2(this._dataList,"timestamp",e)}dataIndexToCoordinate(e){const n=this._dataList.length+this._lastBarRightSideDiffBarCount-e;return Math.floor(this._totalBarSpace-(n-.5)*this._barSpace+.5)}coordinateToDataIndex(e){return Math.ceil(this.coordinateToFloatIndex(e))-1}zoom(e,t){if(!this._zoomEnabled)return;const n=typeof performance<"u"?performance.now():Date.now();n-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=n),this._perfZoomCalls++;let o=t??null;ul(o==null?void 0:o.x)||(o={x:this._crosshair.x??this._totalBarSpace/2});const r=Number.isFinite(this._totalBarSpace)&&this._totalBarSpace>0?this._totalBarSpace:o.x,a=this.coordinateToFloatIndex(r),l=this._barSpace,c=this._barSpace+e*(this._barSpace/$2);this.setBarSpace(c,()=>{this._lastBarRightSideDiffBarCount+=a-this.coordinateToFloatIndex(r)});const f=this._barSpace/l;f!==1&&this.executeAction("onZoom",{scale:f})}setZoomEnabled(e){this._zoomEnabled=e}isZoomEnabled(){return this._zoomEnabled}setScrollEnabled(e){this._scrollEnabled=e}isScrollEnabled(){return this._scrollEnabled}setCrosshair(e,t){const{notInvalidate:n,notExecuteAction:o,forceInvalidate:r}=t??{},a=e??{};let l=0,c=0;ul(a.x)?(l=this.coordinateToDataIndex(a.x),l<0?c=0:l>this._dataList.length-1?c=this._dataList.length-1:c=l):(l=this._dataList.length-1,c=l);const f=this._dataList[c],u=this.dataIndexToCoordinate(l),d={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair={...a,realX:u,dutyData:f,realDataIndex:l,dataIndex:c,timestamp:this.dataIndexToTimestamp(l)??void 0},(d.x!==a.x||d.y!==a.y||d.paneId!==a.paneId||(r??!1))&&(Rn(f)&&!(o??!1)&&this.hasAction("onCrosshairChange")&&Mf(this._crosshair.paneId)&&this.executeAction("onCrosshairChange",e),(n??!1)||this._scheduleOverlayUpdate())}getCrosshair(){return this._crosshair}executeAction(e,t){var n;(n=this._actions.get(e))==null||n.execute(t)}subscribeAction(e,t){var n;this._actions.has(e)||this._actions.set(e,new P8),(n=this._actions.get(e))==null||n.subscribe(t)}unsubscribeAction(e,t){const n=this._actions.get(e);Rn(n)&&(n.unsubscribe(t),n.isEmpty()&&this._actions.delete(e))}hasAction(e){const t=this._actions.get(e);return Rn(t)&&!t.isEmpty()}_sortIndicators(e){var t;Mf(e)?(t=this._indicators.get(e))==null||t.sort((n,o)=>n.zLevel-o.zLevel):this._indicators.forEach(n=>{n.sort((o,r)=>o.zLevel-r.zLevel)})}_addIndicatorCalcTask(e,t){var n;(n=e.onDataStateChange)==null||n.call(e,{state:"loading",type:t,indicator:e}),this._taskScheduler.add({id:_w(e.id),handler:async()=>{typeof performance<"u"?performance.now():Date.now();const o=await e.calcImp(this._dataList).then(r=>r);return typeof performance<"u"?performance.now():Date.now(),o}}).then(o=>{var r;o&&(this._scheduleLayout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:t!=="init"}),(r=e.onDataStateChange)==null||r.call(e,{state:"ready",type:t,indicator:e}))}).catch(o=>{var r;o!=="canceled"&&((r=e.onDataStateChange)==null||r.call(e,{state:"error",type:t,indicator:e}))})}addIndicator(e,t,n){const{name:o}=e;if(this.getIndicatorsByFilter(e).length>0)return!1;let a=this.getIndicatorsByPaneId(t);const l=e5(o),c=new l;return this._synchronizeIndicatorSeriesPrecision(c),c.paneId=t,c.override(e),n||(this.removeIndicator({paneId:t}),a=[]),a.push(c),this._indicators.set(t,a),this._sortIndicators(t),this._addIndicatorCalcTask(c,"init"),!0}getIndicatorsByPaneId(e){return this._indicators.get(e)??[]}getIndicatorsByFilter(e){const{paneId:t,name:n,id:o}=e,r=Rn(n)?n.split("(")[0].trim():void 0,a=c=>Rn(o)?c.id===o:Rn(r)?c.name===r||c.shortName===r:!0;let l=[];return Rn(t)?l=l.concat(this.getIndicatorsByPaneId(t).filter(a)):this._indicators.forEach(c=>{l=l.concat(c.filter(a))}),l}removeIndicator(e){let t=!1;return this.getIndicatorsByFilter(e??{}).forEach(o=>{const r=this.getIndicatorsByPaneId(o.paneId),a=r.findIndex(l=>l.id===o.id);a>-1&&(this._taskScheduler.remove(_w(o.id)),r.splice(a,1),t=!0),r.length===0&&this._indicators.delete(o.paneId)}),t}hasIndicators(e){return this._indicators.has(e)}_synchronizeIndicatorSeriesPrecision(e){if(Rn(this._symbol)){const{pricePrecision:t=dm.PRICE,volumePrecision:n=dm.VOLUME}=this._symbol,o=r=>{switch(r.series){case"price":{r.setSeriesPrecision(t);break}case"volume":{r.setSeriesPrecision(n);break}}};Rn(e)?o(e):this._indicators.forEach(r=>{r.forEach(a=>{o(a)})})}}overrideIndicator(e){let t=!1,n=!1;return this.getIndicatorsByFilter(e).forEach(r=>{r.override(e);const{calc:a,draw:l,sort:c}=r.shouldUpdateImp();c&&(n=!0),a?this._addIndicatorCalcTask(r,"update"):l&&(t=!0)}),n&&this._sortIndicators(),t?(this._scheduleLayout({update:!0}),!0):!1}_scheduleLayout(e){this._pendingLayoutOptions.measureWidth=this._pendingLayoutOptions.measureWidth||(e.measureWidth??!1),this._pendingLayoutOptions.update=this._pendingLayoutOptions.update||(e.update??!1),this._pendingLayoutOptions.buildYAxisTick=this._pendingLayoutOptions.buildYAxisTick||(e.buildYAxisTick??!1),this._pendingLayoutOptions.cacheYAxisWidth=this._pendingLayoutOptions.cacheYAxisWidth||(e.cacheYAxisWidth??!1);const t=typeof performance<"u"?performance.now():Date.now();t-this._perfLastWindowTs>500&&(this._perfScrollCalls=0,this._perfZoomCalls=0,this._perfLayoutSchedules=0,this._perfLastWindowTs=t),this._perfLayoutSchedules++,this._layoutRafId===null&&(this._layoutRafId=$0(()=>{const n={...this._pendingLayoutOptions};this._pendingLayoutOptions={measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1},this._layoutRafId=null,this._chart.layout(n)}))}_scheduleOverlayUpdate(){this._overlayRafId===null&&(this._overlayRafId=$0(()=>{this._overlayRafId=null,this._chart.updatePane(zf.Overlay)}))}getOverlaysByFilter(e){var f;const{id:t,groupId:n,paneId:o,name:r}=e,a=u=>Rn(t)?u.id===t:Rn(n)?u.groupId===n&&(!Rn(r)||u.name===r):!Rn(r)||u.name===r;let l=[];Rn(o)?l=l.concat(this.getOverlaysByPaneId(o).filter(a)):this._overlays.forEach(u=>{l=l.concat(u.filter(a))});const c=(f=this._progressOverlayInfo)==null?void 0:f.overlay;return Rn(c)&&a(c)&&l.push(c),l}getOverlaysByPaneId(e){if(!Mf(e)){let t=[];return this._overlays.forEach(n=>{t=t.concat(n)}),t}return this._overlays.get(e)??[]}_sortOverlays(e){var t;Mf(e)?(t=this._overlays.get(e))==null||t.sort((n,o)=>n.zLevel-o.zLevel):this._overlays.forEach(n=>{n.sort((o,r)=>o.zLevel-r.zLevel)})}addOverlays(e,t){const n=[],o=e.map((r,a)=>{var c,f;if(Rn(r.id)){let u=null;for(const d of this._overlays){const p=d[1].find(v=>v.id===r.id);if(Rn(p)){u=p;break}}if(Rn(u))return r.id}const l=$C(r.name);if(Rn(l)){const u=r.id??d1(pC),d=new l,h=r.paneId??yd.CANDLE;r.id=u,r.groupId??(r.groupId=u);const p=this.getOverlaysByPaneId(h).length;if(!Rn(r.zLevel)){const v=r.extendData,x=(v==null?void 0:v.origin)==="user";r.zLevel=x?WC+p:p}return d.override(r),n.includes(h)||n.push(h),d.isDrawing()?this._progressOverlayInfo={paneId:h,overlay:d,appointPaneFlag:t[a]}:(this._overlays.has(h)||this._overlays.set(h,[]),(c=this._overlays.get(h))==null||c.push(d)),d.isStart()&&((f=d.onDrawStart)==null||f.call(d,{overlay:d,chart:this._chart})),u}return null});return n.length>0&&(this._sortOverlays(),n.forEach(r=>{this._chart.updatePane(zf.Overlay,r)}),this._chart.updatePane(zf.Overlay,yd.X_AXIS)),o}getProgressOverlayInfo(){return this._progressOverlayInfo}progressOverlayComplete(){var e;if(this._progressOverlayInfo!==null){const{overlay:t,paneId:n}=this._progressOverlayInfo;t.isDrawing()||(this._overlays.has(n)||this._overlays.set(n,[]),(e=this._overlays.get(n))==null||e.push(t),this._sortOverlays(n),this._progressOverlayInfo=null)}}updateProgressOverlayInfo(e,t){this._progressOverlayInfo!==null&&(A1(t)&&t&&(this._progressOverlayInfo.appointPaneFlag=t),this._progressOverlayInfo.paneId=e,this._progressOverlayInfo.overlay.override({paneId:e}))}overrideOverlay(e){let t=!1;const n=[];return this.getOverlaysByFilter(e).forEach(r=>{r.override(e);const{sort:a,draw:l}=r.shouldUpdate();a&&(t=!0),(a||l)&&(n.includes(r.paneId)||n.push(r.paneId))}),t&&this._sortOverlays(),n.length>0?(n.forEach(r=>{this._chart.updatePane(zf.Overlay,r)}),this._chart.updatePane(zf.Overlay,yd.X_AXIS),!0):!1}removeOverlay(e){const t=[];return this.getOverlaysByFilter(e??{}).forEach(o=>{var l;const r=o.paneId,a=this.getOverlaysByPaneId(o.paneId);if((l=o.onRemoved)==null||l.call(o,{overlay:o,chart:this._chart}),t.includes(r)||t.push(r),o.isDrawing())this._progressOverlayInfo=null;else{const c=a.findIndex(f=>f.id===o.id);c>-1&&a.splice(c,1)}a.length===0&&this._overlays.delete(r)}),t.length>0?(t.forEach(o=>{this._chart.updatePane(zf.Overlay,o)}),this._chart.updatePane(zf.Overlay,yd.X_AXIS),!0):!1}setPressedOverlayInfo(e){this._pressedOverlayInfo=e}getPressedOverlayInfo(){return this._pressedOverlayInfo}setHoverOverlayInfo(e,t,n){const{overlay:o,figureType:r,figureIndex:a,figure:l}=this._hoverOverlayInfo,c=e.overlay;if(((o==null?void 0:o.id)!==(c==null?void 0:c.id)||r!==e.figureType||a!==e.figureIndex)&&(this._hoverOverlayInfo=e,(o==null?void 0:o.id)!==(c==null?void 0:c.id))){let f=!1,u=!1;const d=this._clickOverlayInfo.overlay;o!==null&&(o.id!==(d==null?void 0:d.id)&&(o.override({zLevel:o.getPrevZLevel()}),u=!0),n(o,l)&&(f=!0)),c!==null&&(c.id!==(d==null?void 0:d.id)&&(c.zLevel!==K1&&c.setPrevZLevel(c.zLevel),c.override({zLevel:K1}),u=!0),t(c,e.figure)&&(f=!0)),u&&this._sortOverlays(),f||this._chart.updatePane(zf.Overlay)}}getHoverOverlayInfo(){return this._hoverOverlayInfo}setClickOverlayInfo(e,t,n){const{paneId:o,overlay:r,figureType:a,figure:l,figureIndex:c}=this._clickOverlayInfo,f=e.overlay;if(((r==null?void 0:r.id)!==(f==null?void 0:f.id)||a!==e.figureType||c!==e.figureIndex)&&(this._clickOverlayInfo=e,(r==null?void 0:r.id)!==(f==null?void 0:f.id))){let u=!1;const d=this._hoverOverlayInfo.overlay;Rn(r)&&(n(r,l),r.id!==(d==null?void 0:d.id)&&(r.override({zLevel:r.getPrevZLevel()}),u=!0)),Rn(f)&&(t(f,e.figure),f.zLevel!==K1&&(f.setPrevZLevel(f.zLevel),f.override({zLevel:K1}),u=!0)),u&&this._sortOverlays(),this._chart.updatePane(zf.Overlay,e.paneId),o!==e.paneId&&this._chart.updatePane(zf.Overlay,o),this._chart.updatePane(zf.Overlay,yd.X_AXIS)}}getClickOverlayInfo(){return this._clickOverlayInfo}isOverlayEmpty(){return this._overlays.size===0&&this._progressOverlayInfo===null}isOverlayDrawing(){var e;return((e=this._progressOverlayInfo)==null?void 0:e.overlay.isDrawing())??!1}_clearLastPriceMarkExtendTextUpdateTimer(){this._lastPriceMarkExtendTextUpdateTimers.forEach(e=>{clearInterval(e)}),this._lastPriceMarkExtendTextUpdateTimers=[]}_clearData(){this._dataLoadMore.backward=!1,this._dataLoadMore.forward=!1,this._loading=!1,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange=gw(),this._crosshair={}}getChart(){return this._chart}destroy(){this._clearData(),this._clearLastPriceMarkExtendTextUpdateTimer(),this._taskScheduler.clear(),this._overlays.clear(),this._indicators.clear(),this._actions.clear()}applyNewData(e,t){this._addData(e,"init",t)}addData(e,t,n){this._addData(e,t,n)}}const id={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator"},Iy=7;async function XC(){return await new Promise(s=>{const e=new ResizeObserver(t=>{s(t.every(n=>"devicePixelContentBoxSize"in n)),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(()=>!1)}class Vb{constructor(e,t){Pe(this,"_element");Pe(this,"_resizeObserver");Pe(this,"_mediaQueryList");Pe(this,"_ctx");Pe(this,"_listener");Pe(this,"_supportedDevicePixelContentBox",!1);Pe(this,"_width",0);Pe(this,"_height",0);Pe(this,"_pixelWidth",0);Pe(this,"_pixelHeight",0);Pe(this,"_nextPixelWidth",0);Pe(this,"_nextPixelHeight",0);Pe(this,"_requestAnimationId",Lb);Pe(this,"_mediaQueryListener",()=>{const e=E0(this._element);this._nextPixelWidth=Math.round(this._element.clientWidth*e),this._nextPixelHeight=Math.round(this._element.clientHeight*e),this._resetPixelRatio()});this._listener=t,this._element=l0("canvas",e),this._ctx=this._element.getContext("2d"),XC().then(n=>{this._supportedDevicePixelContentBox=n,n?(this._resizeObserver=new ResizeObserver(o=>{const r=o.find(l=>l.target===this._element),a=r==null?void 0:r.devicePixelContentBoxSize[0];Rn(a)&&(this._nextPixelWidth=a.inlineSize,this._nextPixelHeight=a.blockSize,(this._pixelWidth!==this._nextPixelWidth||this._pixelHeight!==this._nextPixelHeight)&&this._resetPixelRatio())}),this._resizeObserver.observe(this._element,{box:"device-pixel-content-box"})):(this._mediaQueryList=window.matchMedia(`(resolution: ${E0(this._element)}dppx)`),this._mediaQueryList.addListener(this._mediaQueryListener))}).catch(n=>!1)}_resetPixelRatio(){this._executeListener(()=>{const e=this._element.clientWidth,t=this._element.clientHeight;if(this._width=e,this._height=t,this._pixelWidth=this._nextPixelWidth,this._pixelHeight=this._nextPixelHeight,this._element.width=this._nextPixelWidth,this._element.height=this._nextPixelHeight,e<=0||t<=0||this._nextPixelWidth<=0||this._nextPixelHeight<=0)return;const n=this._nextPixelWidth/e,o=this._nextPixelHeight/t;this._ctx.scale(n,o)})}_executeListener(e){this._requestAnimationId===Lb&&(this._requestAnimationId=$0(()=>{try{this._ctx.clearRect(0,0,this._width,this._height),e==null||e(),this._listener()}catch(t){console.error("Canvas draw error",t)}finally{this._requestAnimationId=Lb}}))}update(e,t){if(this._width!==e||this._height!==t){this._element.style.width=`${e}px`,this._element.style.height=`${t}px`;const n=E0(this._element);this._nextPixelWidth=Math.round(e*n),this._nextPixelHeight=Math.round(t*n),this._resetPixelRatio()}else this._executeListener()}getElement(){return this._element}getContext(){return this._ctx}destroy(){Rn(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),Rn(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)}}class a5 extends xx{constructor(t,n){super();Pe(this,"_rootContainer");Pe(this,"_pane");Pe(this,"_container");Pe(this,"_bounding",Uy());Pe(this,"_cursor","crosshair");Pe(this,"_forceCursor",null);this._pane=n,this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)}setBounding(t){return Bh(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}checkEventOn(t){return!0}setCursor(t){Mf(this._forceCursor)||t!==this._cursor&&(this._cursor=t,this._container.style.cursor=this._cursor)}setForceCursor(t){t!==this._forceCursor&&(this._forceCursor=t,this._container.style.cursor=this._forceCursor??this._cursor)}getForceCursor(){return this._forceCursor}update(t){this.updateImp(this._container,this._bounding,t??zf.Drawer)}destroy(){this._rootContainer.removeChild(this._container)}}class Sx extends a5{constructor(t,n){super(t,n);Pe(this,"_underlayCanvas");Pe(this,"_mainCanvas");Pe(this,"_overlayCanvas");this._underlayCanvas=new Vb({position:"absolute",top:"0",left:"0",zIndex:"1",boxSizing:"border-box"},()=>{this.updateUnderlay(this._underlayCanvas.getContext())}),this._mainCanvas=new Vb({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateMain(this._mainCanvas.getContext())}),this._overlayCanvas=new Vb({position:"absolute",top:"0",left:"0",zIndex:"3",boxSizing:"border-box"},()=>{this.updateOverlay(this._overlayCanvas.getContext())});const o=this.getContainer();o.appendChild(this._underlayCanvas.getElement()),o.appendChild(this._mainCanvas.getElement()),o.appendChild(this._overlayCanvas.getElement())}createContainer(){return l0("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})}updateImp(t,n,o){const{width:r,height:a,left:l}=n;t.style.left=`${l}px`;let c=o;const f=t.clientWidth,u=t.clientHeight;switch((r!==f||a!==u)&&(t.style.width=`${r}px`,t.style.height=`${a}px`,c=zf.Drawer),c){case zf.Main:{this._underlayCanvas.update(r,a),this._mainCanvas.update(r,a);break}case zf.Overlay:{this._underlayCanvas.update(r,a),this._overlayCanvas.update(r,a);break}case zf.Drawer:case zf.All:{this._underlayCanvas.update(r,a),this._mainCanvas.update(r,a),this._overlayCanvas.update(r,a);break}}}destroy(){this._underlayCanvas.destroy(),this._mainCanvas.destroy(),this._overlayCanvas.destroy()}getImage(t){const{width:n,height:o}=this.getBounding(),r=l0("canvas",{width:`${n}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=E0(r);return r.width=n*l,r.height=o*l,a.scale(l,l),t&&a.drawImage(this._underlayCanvas.getElement(),0,0,n,o),a.drawImage(this._mainCanvas.getElement(),0,0,n,o),t&&a.drawImage(this._overlayCanvas.getElement(),0,0,n,o),r}}function l5(s,e){let t=[];t=t.concat(e);const n=H_(s);for(const o of t){const{x:r,y:a,r:l}=o,c=l+n,f=s.x-r,u=s.y-a;if(!(f*f+u*u>c*c))return!0}return!1}function ZC(s,e,t){let n=[];n=n.concat(e);const{style:o="fill",color:r="currentColor",gradient:a,borderSize:l=1,borderColor:c="currentColor",borderStyle:f="solid",borderDashedValue:u=[2,2]}=t,d=!!(a&&(a.from||a.to)),h=(o==="fill"||t.style==="stroke_fill")&&(d||!Mf(r)||!u_(r));h&&n.forEach(({x:p,y:v,r:x})=>{if(d){const S=Rh(s,{minX:p-x,maxX:p+x,minY:v-x,maxY:v+x},a,Mf(r)?r:"#000000");S&&(s.fillStyle=S)}else s.fillStyle=r;s.beginPath(),s.arc(p,v,x,0,Math.PI*2),s.closePath(),s.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!u_(c)&&(s.strokeStyle=c,s.lineWidth=l,f==="dashed"?s.setLineDash(u):s.setLineDash([]),n.forEach(({x:p,y:v,r:x})=>{(!h||x>l)&&(s.beginPath(),s.arc(p,v,x,0,Math.PI*2),s.closePath(),s.stroke())}))}const JC={name:"circle",checkEventOn:l5,draw:(s,e,t)=>{ZC(s,e,t)}};function c5(s,e){let t=[];t=t.concat(e);const n=H_(s);for(const o of t){let r=!1;const{coordinates:a}=o;for(let l=0,c=a.length-1;l<a.length;c=l++)a[l].y>s.y!=a[c].y>s.y&&s.x<(a[c].x-a[l].x)*(s.y-a[l].y)/(a[c].y-a[l].y)+a[l].x&&(r=!r);if(r)return!0;for(let l=0;l<a.length;l++){const c=a[l],f=a[(l+1)%a.length],u=f.x-c.x,d=f.y-c.y,h=u*u+d*d;let p=0;h>0&&(p=((s.x-c.x)*u+(s.y-c.y)*d)/h,p=Math.max(0,Math.min(1,p)));const v=c.x+p*u,x=c.y+p*d,S=s.x-v,C=s.y-x;if(S*S+C*C<=n*n)return!0}}return!1}function QC(s,e,t){let n=[];n=n.concat(e);const{style:o="fill",color:r="currentColor",gradient:a,borderSize:l=1,borderColor:c="currentColor",borderStyle:f="solid",borderDashedValue:u=[2,2]}=t,d=!!(a&&(a.from||a.to));(o==="fill"||t.style==="stroke_fill")&&(d||!Mf(r)||!u_(r))&&n.forEach(({coordinates:h})=>{if(d){let p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;for(const I of h)!Number.isFinite(I.x)||!Number.isFinite(I.y)||(I.x<p&&(p=I.x),I.x>v&&(v=I.x),I.y<x&&(x=I.y),I.y>S&&(S=I.y));const C=Rh(s,{minX:Number.isFinite(p)?p:0,maxX:Number.isFinite(v)&&v!==p?v:Number.isFinite(p)?p+1:1,minY:Number.isFinite(x)?x:0,maxY:Number.isFinite(S)&&S!==x?S:Number.isFinite(x)?x+1:1},a,Mf(r)?r:"#000000");C&&(s.fillStyle=C)}else s.fillStyle=r;s.beginPath(),s.moveTo(h[0].x,h[0].y);for(let p=1;p<h.length;p++)s.lineTo(h[p].x,h[p].y);s.closePath(),s.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!u_(c)&&(s.strokeStyle=c,s.lineWidth=l,f==="dashed"?s.setLineDash(u):s.setLineDash([]),n.forEach(({coordinates:h})=>{s.beginPath(),s.moveTo(h[0].x,h[0].y);for(let p=1;p<h.length;p++)s.lineTo(h[p].x,h[p].y);s.closePath(),s.stroke()}))}const e9={name:"polygon",checkEventOn:c5,draw:(s,e,t)=>{QC(s,e,t)}};function Cx(s,e){let t=[];t=t.concat(e);const n=H_(s);for(const o of t){let r=o.x,a=o.width;a<n*2&&(r-=n,a=n*2);let l=o.y,c=o.height;if(c<n*2&&(l-=n,c=n*2),s.x>=r&&s.x<=r+a&&s.y>=l&&s.y<=l+c)return!0}return!1}function u5(s,e,t){let n=[];n=n.concat(e);const{style:o="fill",color:r="transparent",gradient:a,borderSize:l=1,borderColor:c="transparent",borderStyle:f="solid",borderRadius:u=0,borderDashedValue:d=[2,2]}=t,h=s.roundRect??s.rect,p=!!(a&&(a.from||a.to)),v=(o==="fill"||t.style==="stroke_fill")&&(p||!Mf(r)||!u_(r));if(v&&n.forEach(({x,y:S,width:C,height:I})=>{if(p){const A=Rh(s,{minX:x,maxX:x+C,minY:S,maxY:S+I},a,Mf(r)?r:"#000000");A&&(s.fillStyle=A)}else s.fillStyle=r;s.beginPath(),h.call(s,x,S,C,I,u),s.closePath(),s.fill()}),(o==="stroke"||t.style==="stroke_fill")&&l>0&&!u_(c)){s.strokeStyle=c,s.fillStyle=c,s.lineWidth=l,f==="dashed"?s.setLineDash(d):s.setLineDash([]);const x=l%2===1?.5:0,S=Math.round(x*2);n.forEach(({x:C,y:I,width:A,height:P})=>{A>l*2&&P>l*2?(s.beginPath(),h.call(s,C+x,I+x,A-S,P-S,u),s.closePath(),s.stroke()):v||s.fillRect(C,I,A,P)})}}const t9={name:"rect",checkEventOn:Cx,draw:(s,e,t)=>{u5(s,e,t)}};function Ix(s,e){const{size:t=12,paddingLeft:n=0,paddingTop:o=0,paddingRight:r=0,paddingBottom:a=0,weight:l="normal",family:c}=e,{x:f,y:u,text:d,align:h="left",baseline:p="top",width:v,height:x}=s,S=v??n+tm(d,t,l,c)+r,C=x??o+t+a;let I=0;switch(h){case"left":case"start":{I=f;break}case"right":case"end":{I=f-S;break}default:{I=f-S/2;break}}let A=0;switch(p){case"top":case"hanging":{A=u;break}case"bottom":case"ideographic":case"alphabetic":{A=u-C;break}default:{A=u-C/2;break}}return{x:I,y:A,width:S,height:C}}function d5(s,e,t){let n=[];n=n.concat(e);const o=H_(s);for(const r of n){const{x:a,y:l,width:c,height:f}=Ix(r,t);if(s.x>=a-o&&s.x<=a+c+o&&s.y>=l-o&&s.y<=l+f+o)return!0}return!1}function s9(s,e,t){let n=[];n=n.concat(e);const{color:o="currentColor",size:r=12,family:a,weight:l,paddingLeft:c=0,paddingTop:f=0,paddingRight:u=0}=t,d=n.map(h=>Ix(h,t));u5(s,d,{...t,color:t.backgroundColor}),s.textAlign="left",s.textBaseline="top",s.font=r0(r,l,a),s.fillStyle=o,n.forEach((h,p)=>{const v=d[p];s.fillText(h.text,v.x+c,v.y+f,v.width-c-u)})}const n9={name:"text",checkEventOn:d5,draw:(s,e,t)=>{s9(s,e,t)}};function o9(s,e){const t=s.x-e.x,n=s.y-e.y;return Math.sqrt(t*t+n*n)}function f5(s,e){let t=[];t=t.concat(e);const n=H_(s);for(const o of t)if(Math.abs(o9(s,o)-o.r)<n){const{r,startAngle:a,endAngle:l}=o,c=r*Math.cos(a)+o.x,f=r*Math.sin(a)+o.y,u=r*Math.cos(l)+o.x,d=r*Math.sin(l)+o.y;if(s.x<=Math.max(c,u)+n&&s.x>=Math.min(c,u)-n&&s.y<=Math.max(f,d)+n&&s.y>=Math.min(f,d)-n)return!0}return!1}function i9(s,e,t){let n=[];n=n.concat(e);const{style:o="solid",size:r=1,color:a="currentColor",dashedValue:l=[2,2]}=t;s.lineWidth=r,s.strokeStyle=a,o==="dashed"?s.setLineDash(l):s.setLineDash([]),n.forEach(({x:c,y:f,r:u,startAngle:d,endAngle:h})=>{s.beginPath(),s.arc(c,f,u,d,h),s.stroke(),s.closePath()})}const r9={name:"arc",checkEventOn:f5,draw:(s,e,t)=>{i9(s,e,t)}};function kw(s,e,t,n,o,r,a){const[l,c,f,u,d,h,p]=n,v=a?e+h:h+o,x=a?t+p:p+r;a9(e,t,l,c,f,u,d,v,x).forEach(C=>{s.bezierCurveTo(C[0],C[1],C[2],C[3],C[4],C[5])})}function a9(s,e,t,n,o,r,a,l,c){const{cx:f,cy:u,startAngle:d,deltaAngle:h}=l9(s,e,t,n,o,r,a,l,c),p=[],v=Math.ceil(Math.abs(h)/(Math.PI/2));for(let x=0;x<v;x++){const S=d+x*h/v,C=d+(x+1)*h/v,I=c9(f,u,t,n,o,S,C);p.push(I)}return p}function l9(s,e,t,n,o,r,a,l,c){const f=o*Math.PI/180,u=(s-l)/2,d=(e-c)/2,h=Math.cos(f)*u+Math.sin(f)*d,p=-Math.sin(f)*u+Math.cos(f)*d,v=h**2/t**2+p**2/n**2;v>1&&(t*=Math.sqrt(v),n*=Math.sqrt(v));const x=r===a?-1:1,S=t**2*n**2-t**2*p**2-n**2*h**2,C=t**2*p**2+n**2*h**2,I=x*Math.sqrt(Math.abs(S/C))*(t*p/n),A=x*Math.sqrt(Math.abs(S/C))*(-n*h/t),P=Math.cos(f)*I-Math.sin(f)*A+(s+l)/2,T=Math.sin(f)*I+Math.cos(f)*A+(e+c)/2,j=Math.atan2((p-A)/n,(h-I)/t);let E=Math.atan2((-p-A)/n,(-h-I)/t)-j;return E<0&&a===1?E+=2*Math.PI:E>0&&a===0&&(E-=2*Math.PI),{cx:P,cy:T,startAngle:j,deltaAngle:E}}function c9(s,e,t,n,o,r,a){const l=Math.sin(a-r)*(Math.sqrt(4+3*Math.tan((a-r)/2)**2)-1)/3,c=Math.cos(o),f=Math.sin(o),u=s+t*Math.cos(r)*c-n*Math.sin(r)*f,d=e+t*Math.cos(r)*f+n*Math.sin(r)*c,h=s+t*Math.cos(a)*c-n*Math.sin(a)*f,p=e+t*Math.cos(a)*f+n*Math.sin(a)*c,v=u+l*(-t*Math.sin(r)*c-n*Math.cos(r)*f),x=d+l*(-t*Math.sin(r)*f+n*Math.cos(r)*c),S=h-l*(-t*Math.sin(a)*c-n*Math.cos(a)*f),C=p-l*(-t*Math.sin(a)*f+n*Math.cos(a)*c);return[v,x,S,C,h,p]}function u9(s,e,t){let n=[];n=n.concat(e);const{lineWidth:o=1,color:r="currentColor"}=t;s.lineWidth=o,s.strokeStyle=r,s.setLineDash([]),n.forEach(({x:a,y:l,path:c})=>{const f=c.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if(Rn(f)){const u=a,d=l;s.beginPath(),f.forEach(h=>{let p=0,v=0,x=0,S=0;const C=h[0],I=h.slice(1).trim().split(/[\s,]+/).map(Number);switch(C){case"M":p=I[0]+u,v=I[1]+d,s.moveTo(p,v),x=p,S=v;break;case"m":p+=I[0],v+=I[1],s.moveTo(p,v),x=p,S=v;break;case"L":p=I[0]+u,v=I[1]+d,s.lineTo(p,v);break;case"l":p+=I[0],v+=I[1],s.lineTo(p,v);break;case"H":p=I[0]+u,s.lineTo(p,v);break;case"h":p+=I[0],s.lineTo(p,v);break;case"V":v=I[0]+d,s.lineTo(p,v);break;case"v":v+=I[0],s.lineTo(p,v);break;case"C":s.bezierCurveTo(I[0]+u,I[1]+d,I[2]+u,I[3]+d,I[4]+u,I[5]+d),p=I[4]+u,v=I[5]+d;break;case"c":s.bezierCurveTo(p+I[0],v+I[1],p+I[2],v+I[3],p+I[4],v+I[5]),p+=I[4],v+=I[5];break;case"S":s.bezierCurveTo(p,v,I[0]+u,I[1]+d,I[2]+u,I[3]+d),p=I[2]+u,v=I[3]+d;break;case"s":s.bezierCurveTo(p,v,p+I[0],v+I[1],p+I[2],v+I[3]),p+=I[2],v+=I[3];break;case"Q":s.quadraticCurveTo(I[0]+u,I[1]+d,I[2]+u,I[3]+d),p=I[2]+u,v=I[3]+d;break;case"q":s.quadraticCurveTo(p+I[0],v+I[1],p+I[2],v+I[3]),p+=I[2],v+=I[3];break;case"T":s.quadraticCurveTo(p,v,I[0]+u,I[1]+d),p=I[0]+u,v=I[1]+d;break;case"t":s.quadraticCurveTo(p,v,p+I[0],v+I[1]),p+=I[0],v+=I[1];break;case"A":kw(s,p,v,I,u,d,!1),p=I[5]+u,v=I[6]+d;break;case"a":kw(s,p,v,I,u,d,!0),p+=I[5],v+=I[6];break;case"Z":case"z":s.closePath(),p=x,v=S;break}}),t.style==="fill"?s.fill():s.stroke()}})}const d9={name:"path",checkEventOn:Cx,draw:(s,e,t)=>{u9(s,e,t)}},f9={name:"image",draw:(s,e)=>{const{x:t,y:n,width:o,height:r,image:a,borderRadius:l=0}=e;if(!(!a||!a.complete||a.naturalWidth===0))if(l&&l>0){s.save();const c=Math.min(l,Math.floor(Math.min(o,r)/2));s.beginPath(),s.moveTo(t+c,n),s.arcTo(t+o,n,t+o,n+r,c),s.arcTo(t+o,n+r,t,n+r,c),s.arcTo(t,n+r,t,n,c),s.arcTo(t,n,t+o,n,c),s.closePath(),s.clip(),s.drawImage(a,t,n,o,r),s.restore()}else s.drawImage(a,t,n,o,r)},checkEventOn:(s,e)=>!1},Px={},p9=[JC,xC,e9,t9,n9,r9,d9,f9];p9.forEach(s=>{Px[s.name]=gb.extend(s)});function h9(s){Px[s.name]=gb.extend(s)}function m9(s){return Px[s]??null}class qv extends xx{constructor(t){super();Pe(this,"_widget");this._widget=t}getWidget(){return this._widget}createFigure(t,n){const o=m9(t.name);if(o!==null){const r=new o(t);if(Rn(n)){for(const a in n)n.hasOwnProperty(a)&&r.registerEvent(a,n[a]);this.addChild(r)}return r}return null}draw(t,...n){this.clear(),this.drawImp(t,n)}checkEventOn(t){return!0}}class v9 extends qv{drawImp(e){var c,f;const t=this.getWidget(),n=this.getWidget().getPane(),o=n.getChart(),r=t.getBounding(),a=o.getStyles().grid;if(a.show){e.save(),e.globalCompositeOperation="destination-over";const u=a.horizontal;if(u.show){const x=n.getAxisComponent().getTicks(),S=x.map(C=>({coordinates:[{x:0,y:C.coord},{x:r.width,y:C.coord}]}));if(x.length>=2){const C=[],I=[...x].sort((A,P)=>A.coord-P.coord);for(let A=1;A<I.length;A+=1){const P=I[A].coord-I[A-1].coord;P>0&&C.push(P)}if(C.length>0){C.sort((E,L)=>E-L);const A=Math.floor(C.length/2),P=C.length%2===0?(C[A-1]+C[A])/2:C[A],T=I[0].coord,j=I[I.length-1].coord;if(P>0){let E=T-P;for(;E>=0;)S.push({coordinates:[{x:0,y:E},{x:r.width,y:E}]}),E-=P;let L=j+P;for(;L<=r.height;)S.push({coordinates:[{x:0,y:L},{x:r.width,y:L}]}),L+=P}}}(c=this.createFigure({name:"line",attrs:S,styles:u}))==null||c.draw(e)}const h=a.vertical;if(h.show){const x=o.getXAxisPane().getAxisComponent().getTicks(),S=x.map(C=>({coordinates:[{x:C.coord,y:0},{x:C.coord,y:r.height}]}));if(x.length>=2){const C=[],I=[...x].sort((A,P)=>A.coord-P.coord);for(let A=1;A<I.length;A+=1){const P=I[A].coord-I[A-1].coord;P>0&&C.push(P)}if(C.length>0){C.sort((E,L)=>E-L);const A=Math.floor(C.length/2),P=C.length%2===0?(C[A-1]+C[A])/2:C[A],T=I[0].coord,j=I[I.length-1].coord;if(P>0){let E=T-P;for(;E>=0;)S.push({coordinates:[{x:E,y:0},{x:E,y:r.height}]}),E-=P;let L=j+P;for(;L<=r.width;)S.push({coordinates:[{x:L,y:0},{x:L,y:r.height}]}),L+=P}}}(f=this.createFigure({name:"line",attrs:S,styles:h}))==null||f.draw(e)}e.restore()}}}class p5 extends qv{eachChildren(e){const n=this.getWidget().getPane().getChart().getChartStore(),o=n.getVisibleRangeDataList(),r=n.getBarSpace(),a=o.length;let l=0;for(;l<a;)e(o[l],r,l),++l}}class h5 extends p5{constructor(){super(...arguments);Pe(this,"_boundCandleBarClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCandleBarClick",t),!1))}drawImp(t){const n=this.getWidget().getPane(),o=n.getId()===yd.CANDLE,r=n.getChart().getChartStore(),a=this.getCandleBarOptions();if(a!==null){const{type:l,styles:c}=a;let f=0,u=0;if(a.type==="ohlc"){const{gapBar:h}=r.getBarSpace();f=Math.min(Math.max(Math.round(h*.2),1),8),f>2&&f%2===1&&f--,u=Math.floor(f/2)}const d=n.getAxisComponent();this.eachChildren((h,p)=>{const{x:v,data:{current:x,prev:S}}=h;if(Rn(x)){const{open:C,high:I,low:A,close:P}=x,T=c.compareRule==="current_open"?C:(S==null?void 0:S.close)??P,j=P>T?c.upGradient:P<T?c.downGradient:c.noChangeGradient,E=[];P>T?(E[0]=c.upColor,E[1]=c.upBorderColor,E[2]=c.upWickColor):P<T?(E[0]=c.downColor,E[1]=c.downBorderColor,E[2]=c.downWickColor):(E[0]=c.noChangeColor,E[1]=c.noChangeBorderColor,E[2]=c.noChangeWickColor);const L=d.convertToPixel(C),D=d.convertToPixel(P),X=[L,D,d.convertToPixel(I),d.convertToPixel(A)];X.sort((ie,te)=>ie-te);const ne=p.gapBar%2===0?1:0;let de=[];switch(l){case"candle_solid":{de=this._createSolidBar(v,X,p,E,ne,j);break}case"candle_stroke":{de=this._createStrokeBar(v,X,p,E,ne);break}case"candle_up_stroke":{P>C?de=this._createStrokeBar(v,X,p,E,ne):de=this._createSolidBar(v,X,p,E,ne,j);break}case"candle_down_stroke":{C>P?de=this._createStrokeBar(v,X,p,E,ne):de=this._createSolidBar(v,X,p,E,ne,j);break}case"ohlc":{de=[{name:"rect",attrs:[{x:v-u,y:X[0],width:f,height:X[3]-X[0]},{x:v-p.halfGapBar,y:L+f>X[3]?X[3]-f:L,width:p.halfGapBar-u,height:f},{x:v+u,y:D+f>X[3]?X[3]-f:D,width:p.halfGapBar-u,height:f}],styles:{color:E[0]}}];break}}de.forEach(ie=>{var le;let te=null;o&&(te={mouseClickEvent:this._boundCandleBarClickEvent(h)}),(le=this.createFigure(ie,te??void 0))==null||le.draw(t)})}})}}getCandleBarOptions(){const t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}}_createSolidBar(t,n,o,r,a,l){return[{name:"rect",attrs:{x:t,y:n[0],width:1,height:n[3]-n[0]},styles:{color:r[2]}},{name:"rect",attrs:{x:t-o.halfGapBar,y:n[1],width:o.gapBar+a,height:Math.max(1,n[2]-n[1])},styles:{style:"stroke_fill",color:r[0],gradient:l,borderColor:r[1]}}]}_createStrokeBar(t,n,o,r,a){return[{name:"rect",attrs:[{x:t,y:n[0],width:1,height:n[1]-n[0]},{x:t,y:n[2],width:1,height:n[3]-n[2]}],styles:{color:r[2]}},{name:"rect",attrs:{x:t-o.halfGapBar,y:n[1],width:o.gapBar+a,height:Math.max(1,n[2]-n[1])},styles:{style:"stroke",borderColor:r[1]}}]}}class g9 extends h5{getCandleBarOptions(){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const n=e.getChart().getChartStore(),o=n.getIndicatorsByPaneId(e.getId());for(const r of o)if(r.shouldOhlc&&r.visible){const a=r.styles,l=n.getStyles().indicator,c=em(a,"ohlc.compareRule",l.ohlc.compareRule),f=em(a,"ohlc.upColor",l.ohlc.upColor),u=em(a,"ohlc.downColor",l.ohlc.downColor),d=em(a,"ohlc.noChangeColor",l.ohlc.noChangeColor);return{type:"ohlc",styles:{compareRule:c,upColor:f,downColor:u,noChangeColor:d,upBorderColor:f,downBorderColor:u,noChangeBorderColor:d,upWickColor:f,downWickColor:u,noChangeWickColor:d}}}}return null}drawImp(e){super.drawImp(e);const t=this.getWidget(),n=t.getPane(),o=n.getChart(),r=t.getBounding(),a=o.getXAxisPane().getAxisComponent(),l=n.getAxisComponent(),c=o.getChartStore(),f=c.getIndicatorsByPaneId(n.getId()),u=c.getStyles().indicator;e.save(),f.forEach(d=>{if(d.visible){d.zLevel<0?e.globalCompositeOperation="destination-over":e.globalCompositeOperation="source-over";let h=!1;if(d.draw!==null&&(e.save(),h=d.draw({ctx:e,chart:o,indicator:d,bounding:r,xAxis:a,yAxis:l}),e.restore()),!h){const p=d.result,v=[];this.eachChildren((x,S)=>{var ie,te,le,pe,re,xe;const{halfGapBar:C}=S,{dataIndex:I,x:A,data:P}=x,T=a.convertToPixel(I-1),j=a.convertToPixel(I+1),E=p[((ie=P.prev)==null?void 0:ie.timestamp)??""]??{},L=p[((te=P.current)==null?void 0:te.timestamp)??""]??{},D=p[((le=P.next)==null?void 0:le.timestamp)??""]??{},X={x:T},ne={x:A},de={x:j};d.figures.forEach(({key:se})=>{const Ne=E[se];ul(Ne)&&(X[se]=l.convertToPixel(Ne));const Te=L[se];ul(Te)&&(ne[se]=l.convertToPixel(Te));const Me=D[se];ul(Me)&&(de[se]=l.convertToPixel(Me))}),yx(d,{prev:((pe=P.prev)==null?void 0:pe.timestamp)??null,current:((re=P.current)==null?void 0:re.timestamp)??null,next:((xe=P.next)==null?void 0:xe.timestamp)??null},u,(se,Ne,Te)=>{var Me,De;if(Rn(L[se.key])){const Oe=ne[se.key];let Ke=(Me=se.attrs)==null?void 0:Me.call(se,{data:{prev:E,current:L,next:D},coordinate:{prev:X,current:ne,next:de},bounding:r,barSpace:S,xAxis:a,yAxis:l});if(!Rn(Ke))switch(se.type){case"circle":{Ke={x:A,y:Oe,r:Math.max(1,C)};break}case"rect":case"bar":{const pt=se.baseValue??l.getRange().from,Rt=l.convertToPixel(pt);let Ht=Math.abs(Rt-Oe);pt!==L[se.key]&&(Ht=Math.max(1,Ht));let Ft=0;Oe>Rt?Ft=Rt:Ft=Oe,Ke={x:A-C,y:Ft,width:Math.max(1,C*2),height:Ht};break}case"line":{Rn(v[Te])||(v[Te]=[]),ul(ne[se.key])&&ul(de[se.key])&&v[Te].push({coordinates:[{x:ne.x,y:ne[se.key]},{x:de.x,y:de[se.key]}],styles:Ne});break}}const kt=se.type;Rn(Ke)&&kt!=="line"&&((De=this.createFigure({name:kt==="bar"?"rect":kt,attrs:Ke,styles:Ne}))==null||De.draw(e))}})}),v.forEach(x=>{var S,C,I,A,P,T,j,E,L,D;if(x.length>1){const X=[{coordinates:[x[0].coordinates[0],x[0].coordinates[1]],styles:x[0].styles}];for(let ne=1;ne<x.length;ne++){const de=X[X.length-1],ie=x[ne],te=de.coordinates[de.coordinates.length-1];te.x===ie.coordinates[0].x&&te.y===ie.coordinates[0].y&&de.styles.style===ie.styles.style&&de.styles.color===ie.styles.color&&((S=de.styles.gradient)==null?void 0:S.from)===((C=ie.styles.gradient)==null?void 0:C.from)&&((I=de.styles.gradient)==null?void 0:I.to)===((A=ie.styles.gradient)==null?void 0:A.to)&&((P=de.styles.gradient)==null?void 0:P.mode)===((T=ie.styles.gradient)==null?void 0:T.mode)&&de.styles.size===ie.styles.size&&de.styles.smooth===ie.styles.smooth&&((j=de.styles.dashedValue)==null?void 0:j[0])===((E=ie.styles.dashedValue)==null?void 0:E[0])&&((L=de.styles.dashedValue)==null?void 0:L[1])===((D=ie.styles.dashedValue)==null?void 0:D[1])?de.coordinates.push(ie.coordinates[1]):X.push({coordinates:[ie.coordinates[0],ie.coordinates[1]],styles:ie.styles})}X.forEach(({coordinates:ne,styles:de})=>{var ie;(ie=this.createFigure({name:"line",attrs:{coordinates:ne},styles:de}))==null||ie.draw(e)})}})}}}),e.restore()}}class _9 extends qv{drawImp(e){const t=this.getWidget(),n=t.getPane(),o=t.getBounding(),r=t.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=r.getStyles().crosshair;if(Mf(a.paneId)&&l.show){if(a.paneId===n.getId()){const f=a.y;this._drawLine(e,[{x:0,y:f},{x:o.width,y:f}],l.horizontal)}const c=a.realX;this._drawLine(e,[{x:c,y:0},{x:c,y:o.height}],l.vertical)}}_drawLine(e,t,n){var o;if(n.show){const r=n.line;r.show&&((o=this.createFigure({name:"line",attrs:{coordinates:t},styles:r}))==null||o.draw(e))}}}class m5 extends qv{constructor(t){super(t);Pe(this,"_activeFeatureInfo",null);Pe(this,"_featureClickEvent",(t,n)=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction(t,n),!0));Pe(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,!0));this.registerEvent("mouseMoveEvent",n=>(this._activeFeatureInfo=null,!1))}drawImp(t){const n=this.getWidget(),r=n.getPane().getChart().getChartStore(),a=r.getCrosshair();if(Rn(a.dutyData)){const l=n.getBounding(),{offsetLeft:c,offsetTop:f,offsetRight:u}=r.getStyles().indicator.tooltip;this.drawIndicatorTooltip(t,c,f,l.width-u)}}drawIndicatorTooltip(t,n,o,r){const a=this.getWidget().getPane(),l=a.getChart().getChartStore(),f=l.getStyles().indicator.tooltip;if(this.isDrawTooltip(l.getCrosshair(),f)){const u=l.getIndicatorsByPaneId(a.getId()),d=f.title,h=f.legend;u.forEach(p=>{let v=0;const x={x:n,y:o},{name:S,calcParamsText:C,legends:I,features:A}=this.getIndicatorTooltipData(p),P=S.length>0,T=I.length>0;if(P||T){const j=this.classifyTooltipFeatures(A);if(v=this.drawStandardTooltipFeatures(t,j[0],x,p,n,v,r),P){let E=S;C.length>0&&(E=`${E}${C}`);const L=d.color;v=this.drawStandardTooltipLegends(t,[{title:{text:"",color:L},value:{text:E,color:L}}],x,n,v,r,d)}v=this.drawStandardTooltipFeatures(t,j[1],x,p,n,v,r),T&&(v=this.drawStandardTooltipLegends(t,I,x,n,v,r,h)),v=this.drawStandardTooltipFeatures(t,j[2],x,p,n,v,r),o=x.y+v}})}return o}drawStandardTooltipFeatures(t,n,o,r,a,l,c){if(n.length>0){let f=0,u=0;n.forEach(p=>{const{marginLeft:v=0,marginTop:x=0,marginRight:S=0,marginBottom:C=0,paddingLeft:I=0,paddingTop:A=0,paddingRight:P=0,paddingBottom:T=0,size:j=0,type:E,content:L}=p;let D=0;if(E==="icon_font"){const X=L;t.font=r0(j,"normal",X.family),D=t.measureText(X.code).width}else D=j;f+=v+I+D+P+S,u=Math.max(u,x+A+j+T+C)}),o.x+f>c?(o.x=a,o.y+=l,l=u):l=Math.max(l,u);const h=this.getWidget().getPane().getId();n.forEach(p=>{var se,Ne,Te,Me,De;const{marginLeft:v=0,marginTop:x=0,marginRight:S=0,paddingLeft:C=0,paddingTop:I=0,paddingRight:A=0,paddingBottom:P=0,backgroundColor:T,activeBackgroundColor:j,borderRadius:E,size:L=0,color:D,activeColor:X,type:ne,content:de}=p;let ie=D,te=T;((se=this._activeFeatureInfo)==null?void 0:se.paneId)===h&&((Ne=this._activeFeatureInfo.indicator)==null?void 0:Ne.id)===(r==null?void 0:r.id)&&this._activeFeatureInfo.feature.id===p.id&&(ie=X??D,te=j??T);let le="onCandleTooltipFeatureClick";const pe={paneId:h,feature:p};Rn(r)&&(le="onIndicatorTooltipFeatureClick",pe.indicator=r);const re={mouseClickEvent:this._featureClickEvent(le,pe),mouseMoveEvent:this._featureMouseMoveEvent(pe)};let xe=0;if(ne==="icon_font"){const Oe=de;(Te=this.createFigure({name:"text",attrs:{text:Oe.code,x:o.x+v,y:o.y+x},styles:{paddingLeft:C,paddingTop:I,paddingRight:A,paddingBottom:P,borderRadius:E,size:L,family:Oe.family,color:ie,backgroundColor:te}},re))==null||Te.draw(t),xe=t.measureText(Oe.code).width}else{(Me=this.createFigure({name:"rect",attrs:{x:o.x+v,y:o.y+x,width:L,height:L},styles:{paddingLeft:C,paddingTop:I,paddingRight:A,paddingBottom:P,color:te}},re))==null||Me.draw(t);const Oe=de;(De=this.createFigure({name:"path",attrs:{path:Oe.path,x:o.x+v+C,y:o.y+x+I,width:L,height:L},styles:{style:Oe.style,lineWidth:Oe.lineWidth,color:ie}}))==null||De.draw(t),xe=L}o.x+=v+C+xe+A+S})}return l}drawStandardTooltipLegends(t,n,o,r,a,l,c){if(n.length>0){const{marginLeft:f,marginTop:u,marginRight:d,marginBottom:h,size:p,family:v,weight:x}=c;t.font=r0(p,x,v),n.forEach(S=>{var L,D;const C=S.title,I=S.value,A=t.measureText(C.text).width,P=t.measureText(I.text).width,T=C.text.length>0&&I.text.length>0?2:0,j=A+T+P,E=u+p+h;o.x+f+j+d>l?(o.x=r,o.y+=a,a=E):a=Math.max(a,E),C.text.length>0&&((L=this.createFigure({name:"text",attrs:{x:o.x+f,y:o.y+u,text:C.text},styles:{color:C.color,size:p,family:v,weight:x}}))==null||L.draw(t)),(D=this.createFigure({name:"text",attrs:{x:o.x+f+A+T,y:o.y+u,text:I.text},styles:{color:I.color,size:p,family:v,weight:x}}))==null||D.draw(t),o.x+=f+j+d})}return a}isDrawTooltip(t,n){const o=n.showRule;return o==="always"||o==="follow_cross"&&Mf(t.paneId)}getIndicatorTooltipData(t){var S;const n=this.getWidget().getPane().getChart().getChartStore(),o=n.getStyles().indicator,r=o.tooltip,a=r.title;let l="",c="";if(a.show&&(a.showName&&(l=t.shortName),a.showParams)){const C=t.calcParams;C.length>0&&(c=`(${C.join(",")})`)}const f={name:l,calcParamsText:c,legends:[],features:r.features},u=n.getCrosshair().dataIndex,d=t.result,h=n.getInnerFormatter(),p=n.getDecimalFold(),v=n.getThousandsSeparator(),x=[];if(t.visible){const C=n.getDataList(),I=C[u]??{},A=C[u-1]??{};let P=d[I.timestamp];!Rn(P)&&u===C.length-1&&(P=d[A.timestamp]);const T=r.legend.defaultValue;yx(t,{prev:A.timestamp,current:I.timestamp,next:(S=C[u])==null?void 0:S.timestamp},o,(j,E)=>{if(Mf(j.title)){const L=E.color;let D=P==null?void 0:P[j.key];ul(D)&&(D=Im(D,t.precision),t.shouldFormatBigNumber&&(D=h.formatBigNumber(D)),D=p.format(v.format(D))),x.push({title:{text:j.title,color:L},value:{text:D??T,color:L}})}}),f.legends=x}if(cv(t.createTooltipDataSource)){const C=this.getWidget(),I=C.getPane(),A=I.getChart(),{name:P,calcParamsText:T,legends:j,features:E}=t.createTooltipDataSource({chart:A,indicator:t,crosshair:n.getCrosshair(),bounding:C.getBounding(),xAxis:I.getChart().getXAxisPane().getAxisComponent(),yAxis:I.getAxisComponent()});if(a.show&&(Mf(P)&&a.showName&&(f.name=P),Mf(T)&&a.showParams&&(f.calcParamsText=T)),Rn(E)&&(f.features=E),Rn(j)&&t.visible){const L=[],D=o.tooltip.legend.color;j.forEach(X=>{let ne={text:"",color:D};Cv(X.title)?ne=X.title:ne.text=X.title;let de={text:"",color:D};Cv(X.value)?de=X.value:de.text=X.value,ul(Number(de.text))&&(de.text=p.format(v.format(de.text))),L.push({title:ne,value:de})}),f.legends=L}}return f}classifyTooltipFeatures(t){const n=[],o=[],r=[];return t.forEach(a=>{switch(a.position){case"left":{n.push(a);break}case"middle":{o.push(a);break}case"right":{r.push(a);break}}}),[n,o,r]}}class D2 extends qv{constructor(t,n){super(t);Pe(this,"_overlayFilter");this._overlayFilter=n==null?void 0:n.overlayFilter,((n==null?void 0:n.enableBaseEvent)??!0)&&this._initEvent()}_initEvent(){const t=this.getWidget(),n=t.getPane(),o=n.getId(),r=n.getChart(),a=r.getChartStore();this.registerEvent("mouseMoveEvent",l=>{var f;const c=a.getProgressOverlayInfo();if(c!==null){const u=c.overlay;let d=c.paneId;u.isStart()&&(a.updateProgressOverlayInfo(o),d=o);const h=u.points.length-1;if(u.isDrawing()&&d===o){const p=this._coordinateToPoint(u,l);u.eventMoveForDrawing(p),(f=u.onDrawing)==null||f.call(u,{chart:r,overlay:u,...l})}return this._figureMouseMoveEvent(u,"point",h,{key:`${y_}point_${h}`,type:"circle",attrs:{}})(l)}return a.setHoverOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(u,d)=>this._processOverlayMouseEnterEvent(u,d,l),(u,d)=>this._processOverlayMouseLeaveEvent(u,d,l)),t.setForceCursor(null),!1}).registerEvent("mouseClickEvent",l=>{var f,u;const c=a.getProgressOverlayInfo();if(c!==null){const d=c.overlay;let h=c.paneId;d.isStart()&&(a.updateProgressOverlayInfo(o,!0),h=o);const p=d.points.length-1;if(d.isDrawing()&&h===o){const v=this._coordinateToPoint(d,l);d.eventMoveForDrawing(v),(f=d.onDrawing)==null||f.call(d,{chart:r,overlay:d,...l}),d.nextStep(),d.isDrawing()||(a.progressOverlayComplete(),(u=d.onDrawEnd)==null||u.call(d,{chart:r,overlay:d,...l}))}return this._figureMouseClickEvent(d,"point",p,{key:`${y_}point_${p}`,type:"circle",attrs:{}})(l)}return a.setClickOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null},(d,h)=>this._processOverlaySelectedEvent(d,h,l),(d,h)=>this._processOverlayDeselectedEvent(d,h,l)),!1}).registerEvent("mouseDoubleClickEvent",l=>{var f;const c=a.getProgressOverlayInfo();if(c!==null){const u=c.overlay,d=c.paneId;u.isDrawing()&&d===o&&(u.forceComplete(),u.isDrawing()||(a.progressOverlayComplete(),(f=u.onDrawEnd)==null||f.call(u,{chart:r,overlay:u,...l})));const h=u.points.length-1;return this._figureMouseClickEvent(u,"point",h,{key:`${y_}point_${h}`,type:"circle",attrs:{}})(l)}return!1}).registerEvent("mouseRightClickEvent",l=>{const c=a.getProgressOverlayInfo();if(c!==null){const f=c.overlay;if(f.isDrawing()){const u=f.points.length-1;return this._figureMouseRightClickEvent(f,"point",u,{key:`${y_}point_${u}`,type:"circle",attrs:{}})(l)}}return!1}).registerEvent("mouseUpEvent",l=>{var u;const{overlay:c,figure:f}=a.getPressedOverlayInfo();return c!==null&&eg("onPressedMoveEnd",f)&&((u=c.onPressedMoveEnd)==null||u.call(c,{chart:r,overlay:c,figure:f??void 0,...l})),a.setPressedOverlayInfo({paneId:o,overlay:null,figureType:"none",figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",l=>{var h;const{overlay:c,figureType:f,figureIndex:u,figure:d}=a.getPressedOverlayInfo();if(c!==null&&eg("onPressedMoving",d)){if(!c.lock){const p=this._coordinateToPoint(c,l);f==="point"?c.eventPressedPointMove(p,u):c.eventPressedOtherMove(p,this.getWidget().getPane().getChart().getChartStore());let v=!1;(h=c.onPressedMoving)==null||h.call(c,{chart:r,overlay:c,figure:d??void 0,...l,preventDefault:()=>{v=!0}}),v?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return!0}return this.getWidget().setForceCursor(null),!1})}_createFigureEvents(t,n,o,r){return t.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(t,n,o,r),mouseDownEvent:this._figureMouseDownEvent(t,n,o,r),mouseClickEvent:this._figureMouseClickEvent(t,n,o,r),mouseRightClickEvent:this._figureMouseRightClickEvent(t,n,o,r),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,n,o,r)}}_processOverlayMouseEnterEvent(t,n,o){return cv(t.onMouseEnter)&&eg("onMouseEnter",n)?(t.onMouseEnter({chart:this.getWidget().getPane().getChart(),overlay:t,figure:n??void 0,...o}),!0):!1}_processOverlayMouseLeaveEvent(t,n,o){return cv(t.onMouseLeave)&&eg("onMouseLeave",n)?(t.onMouseLeave({chart:this.getWidget().getPane().getChart(),overlay:t,figure:n??void 0,...o}),!0):!1}_processOverlaySelectedEvent(t,n,o){var r;return eg("onSelected",n)?((r=t.onSelected)==null||r.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:n??void 0,...o}),!0):!1}_processOverlayDeselectedEvent(t,n,o){var r;return eg("onDeselected",n)?((r=t.onDeselected)==null||r.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:n??void 0,...o}),!0):!1}_figureMouseMoveEvent(t,n,o,r){return a=>{var f;const l=this.getWidget().getPane(),c=!t.isDrawing()&&eg("onMouseMove",r);if(c){let u=!1;(f=t.onMouseMove)==null||f.call(t,{chart:l.getChart(),overlay:t,figure:r,...a,preventDefault:()=>{u=!0}}),u?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return l.getChart().getChartStore().setHoverOverlayInfo({paneId:l.getId(),overlay:t,figureType:n,figure:r,figureIndex:o},(u,d)=>this._processOverlayMouseEnterEvent(u,d,a),(u,d)=>this._processOverlayMouseLeaveEvent(u,d,a)),c}}_figureMouseDownEvent(t,n,o,r){return a=>{var f;const l=this.getWidget().getPane(),c=l.getId();return t.startPressedMove(this._coordinateToPoint(t,a)),eg("onPressedMoveStart",r)?((f=t.onPressedMoveStart)==null||f.call(t,{chart:l.getChart(),overlay:t,figure:r,...a}),l.getChart().getChartStore().setPressedOverlayInfo({paneId:c,overlay:t,figureType:n,figureIndex:o,figure:r}),!t.isDrawing()):!1}}_figureMouseClickEvent(t,n,o,r){return a=>{var u;const l=this.getWidget().getPane(),c=l.getId(),f=!t.isDrawing()&&eg("onClick",r);return f&&((u=t.onClick)==null||u.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...a})),l.getChart().getChartStore().setClickOverlayInfo({paneId:c,overlay:t,figureType:n,figureIndex:o,figure:r},(d,h)=>this._processOverlaySelectedEvent(d,h,a),(d,h)=>this._processOverlayDeselectedEvent(d,h,a)),f}}_figureMouseDoubleClickEvent(t,n,o,r){return a=>{var l;return eg("onDoubleClick",r)?((l=t.onDoubleClick)==null||l.call(t,{...a,chart:this.getWidget().getPane().getChart(),figure:r,overlay:t}),!t.isDrawing()):!1}}_figureMouseRightClickEvent(t,n,o,r){return a=>{var l;if(eg("onRightClick",r)){let c=!1;return(l=t.onRightClick)==null||l.call(t,{chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...a,preventDefault:()=>{c=!0}}),c||this.getWidget().getPane().getChart().getChartStore().removeOverlay(t),!t.isDrawing()}return!1}}_coordinateToPoint(t,n){const o={},r=this.getWidget().getPane(),a=r.getChart(),l=r.getId(),c=a.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){const u=a.getXAxisPane().getAxisComponent().convertFromPixel(n.x),d=c.dataIndexToTimestamp(u)??void 0;o.timestamp=d,o.dataIndex=u}if(this.coordinateToPointValueFlag()){const f=r.getAxisComponent();let u=f.convertFromPixel(n.y);if(t.mode!=="normal"&&l===yd.CANDLE&&ul(o.dataIndex)){const d=c.getDataByDataIndex(o.dataIndex);if(d!==null){const h=t.modeSensitivity;if(u>d.high)if(t.mode==="weak_magnet"){const p=f.convertToPixel(d.high),v=f.convertFromPixel(p-h);u<v&&(u=d.high)}else u=d.high;else if(u<d.low)if(t.mode==="weak_magnet"){const p=f.convertToPixel(d.low),v=f.convertFromPixel(p-h);u>v&&(u=d.low)}else u=d.low;else{const p=Math.max(d.open,d.close),v=Math.min(d.open,d.close);u>p?u-p<d.high-u?u=p:u=d.high:u<v?u-d.low<v-u?u=d.low:u=v:p-u<u-v?u=p:u=v}}}o.value=u}return o}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,n){return this.getWidget().getPane().getChart().getChartStore().isOverlayDrawing()?this.onEvent(t,n):super.dispatchEvent(t,n)}drawImp(t){this.getCompleteOverlays().forEach(r=>{r.visible&&this._allowOverlay(r)&&this._drawOverlay(t,r)});const o=this.getProgressOverlay();Rn(o)&&o.visible&&this._allowOverlay(o)&&this._drawOverlay(t,o)}_allowOverlay(t){return this._overlayFilter?this._overlayFilter(t):!0}_drawOverlay(t,n){const{points:o}=n,r=this.getWidget().getPane(),a=r.getChart(),l=a.getChartStore(),c=r.getAxisComponent(),f=a.getXAxisPane().getAxisComponent(),d=l.getDataList().length,h=d-1,p=o.map((v,x)=>{let S=null;ul(v.timestamp)?S=l.timestampToDataIndex(v.timestamp):ul(v.dataIndex)?S=v.dataIndex:d>0&&(S=h);const C={x:0,y:0};return ul(S)&&(C.x=f.convertToPixel(S)),ul(v.value)&&(C.y=(c==null?void 0:c.convertToPixel(v.value))??0),C});if(p.length>0){const v=[].concat(this.getFigures(n,p));this.drawFigures(t,n,v)}this.drawDefaultFigures(t,n,p)}drawFigures(t,n,o){const r=this.getWidget().getPane().getChart().getStyles().overlay;o.forEach((a,l)=>{const{type:c,styles:f,attrs:u}=a;[].concat(u).forEach(h=>{var x,S;const p=this._createFigureEvents(n,"other",l,a),v={...r[c],...(x=n.styles)==null?void 0:x[c],...f};(S=this.createFigure({name:c,attrs:h,styles:v},p??void 0))==null||S.draw(t)})})}getCompleteOverlays(){const t=this.getWidget().getPane();return t.getChart().getChartStore().getOverlaysByPaneId(t.getId())}getProgressOverlay(){const t=this.getWidget().getPane(),n=t.getChart().getChartStore().getProgressOverlayInfo();return Rn(n)&&n.paneId===t.getId()?n.overlay:null}getFigures(t,n){var u;const o=this.getWidget(),r=o.getPane(),a=r.getChart(),l=r.getAxisComponent(),c=a.getXAxisPane().getAxisComponent(),f=o.getBounding();return((u=t.createPointFigures)==null?void 0:u.call(t,{chart:a,overlay:t,coordinates:n,bounding:f,xAxis:c,yAxis:l}))??[]}drawDefaultFigures(t,n,o){var r,a;if(n.needDefaultPointFigure){const l=this.getWidget().getPane().getChart().getChartStore(),c=l.getHoverOverlayInfo(),f=l.getClickOverlayInfo();if(((r=c.overlay)==null?void 0:r.id)===n.id&&c.figureType!=="none"||((a=f.overlay)==null?void 0:a.id)===n.id&&f.figureType!=="none"){const u=l.getStyles().overlay,d=n.styles,h={...u.point,...d==null?void 0:d.point};o.forEach(({x:p,y:v},x)=>{var P,T,j,E;let S=h.radius,C=h.color,I=h.borderColor,A=h.borderSize;((P=c.overlay)==null?void 0:P.id)===n.id&&c.figureType==="point"&&((T=c.figure)==null?void 0:T.key)===`${y_}point_${x}`&&(S=h.activeRadius,C=h.activeColor,I=h.activeBorderColor,A=h.activeBorderSize),(j=this.createFigure({name:"circle",attrs:{x:p,y:v,r:S+A},styles:{color:I}},this._createFigureEvents(n,"point",x,{key:`${y_}point_${x}`,type:"circle",attrs:{x:p,y:v,r:S+A},styles:{color:I}})??void 0))==null||j.draw(t),(E=this.createFigure({name:"circle",attrs:{x:p,y:v,r:S},styles:{color:C}}))==null||E.draw(t)})}}}}class v5 extends Sx{constructor(t,n){super(t,n);Pe(this,"_gridView",new v9(this));Pe(this,"_indicatorView",new g9(this));Pe(this,"_crosshairLineView",new _9(this));Pe(this,"_tooltipView",this.createTooltipView());Pe(this,"_overlayView",new D2(this,{overlayFilter:t=>t.isDrawing()||t.zLevel>=0}));Pe(this,"_overlayBackgroundView",new D2(this,{overlayFilter:t=>!t.isDrawing()&&t.zLevel<0,enableBaseEvent:!1}));this.addChild(this._tooltipView),this.addChild(this._overlayBackgroundView),this.addChild(this._overlayView)}getName(){return id.MAIN}updateMain(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._indicatorView.draw(t))}createTooltipView(){return new m5(this)}updateMainContent(t){}updateOverlayContent(t){}updateUnderlay(t){this.getPane().getOptions().state!=="minimize"&&(this._gridView.draw(t),this._overlayBackgroundView.draw(t))}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}}class y9 extends p5{constructor(){super(...arguments);Pe(this,"_ripplePoint",this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}));Pe(this,"_animationFrameTime",0);Pe(this,"_animation",new L2({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const n=this.getWidget().getPane();n.getChart().updatePane(zf.Main,n.getId())}))}drawImp(t){var S,C,I;const n=this.getWidget(),o=n.getPane(),r=o.getChart(),l=r.getDataList().length-1,c=n.getBounding(),f=o.getAxisComponent(),u=r.getStyles().candle.area,d=[];let h=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,v=null;if(this.eachChildren(A=>{const P=A.x,{current:T}=A.data,j=T==null?void 0:T[u.value];if(ul(j)){const E=f.convertToPixel(j);p===Number.MIN_SAFE_INTEGER&&(p=P),d.push({x:P,y:E}),h=Math.min(h,E),A.dataIndex===l&&(v={x:P,y:E})}}),d.length>0){(S=this.createFigure({name:"line",attrs:{coordinates:d},styles:{color:u.lineColor,size:u.lineSize,smooth:u.smooth}}))==null||S.draw(t);const A=u.backgroundColor;let P="";if(lg(A)){const T=t.createLinearGradient(0,c.height,0,h);try{A.forEach(({offset:j,color:E})=>{T.addColorStop(j,E)})}catch{}P=T}else P=A;t.fillStyle=P,t.beginPath(),t.moveTo(p,c.height),t.lineTo(d[0].x,d[0].y),s5(t,d,u.smooth),t.lineTo(d[d.length-1].x,c.height),t.closePath(),t.fill()}const x=u.point;if(x.show&&Rn(v)){(C=this.createFigure({name:"circle",attrs:{x:v.x,y:v.y,r:x.radius},styles:{style:"fill",color:x.color}}))==null||C.draw(t);let A=x.rippleRadius;x.animation&&(A=x.radius+this._animationFrameTime/x.animationDuration*(x.rippleRadius-x.radius),this._animation.setDuration(x.animationDuration).start()),(I=this._ripplePoint)==null||I.setAttrs({x:v.x,y:v.y,r:A}).setStyles({style:"fill",color:x.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}class b9 extends qv{drawImp(e){var c;const n=this.getWidget().getPane(),o=n.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.high,l=r.low;if(r.show&&(a.show||l.show)){const f=o.getVisibleRangeHighLowPrice(),u=((c=o.getSymbol())==null?void 0:c.pricePrecision)??dm.PRICE,d=n.getAxisComponent(),{price:h,x:p}=f[0],{price:v,x}=f[1],S=d.convertToPixel(h),C=d.convertToPixel(v),I=o.getDecimalFold(),A=o.getThousandsSeparator();a.show&&h!==Number.MIN_SAFE_INTEGER&&this._drawMark(e,I.format(A.format(Im(h,u))),{x:p,y:S},S<C?[-2,-5]:[2,5],a),l.show&&v!==Number.MAX_SAFE_INTEGER&&this._drawMark(e,I.format(A.format(Im(v,u))),{x,y:C},S<C?[2,5]:[-2,-5],l)}}_drawMark(e,t,n,o,r){var p,v,x;const a=n.x,l=n.y+o[0];(p=this.createFigure({name:"line",attrs:{coordinates:[{x:a-2,y:l+o[0]},{x:a,y:l},{x:a+2,y:l+o[0]}]},styles:{color:r.color}}))==null||p.draw(e);let c=0,f=0,u="left";const{width:d}=this.getWidget().getBounding();a>d/2?(c=a-5,f=c-r.textOffset,u="right"):(c=a+5,u="left",f=c+r.textOffset);const h=l+o[1];(v=this.createFigure({name:"line",attrs:{coordinates:[{x:a,y:l},{x:a,y:h},{x:c,y:h}]},styles:{color:r.color}}))==null||v.draw(e),(x=this.createFigure({name:"text",attrs:{x:f,y:h,text:t,align:u,baseline:"middle"},styles:{color:r.color,size:r.textSize,family:r.textFamily,weight:r.textWeight}}))==null||x.draw(e)}}class x9 extends qv{drawImp(e){var f,u;const t=this.getWidget(),n=t.getPane(),o=t.getBounding(),r=n.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.line;if(a.show&&l.show&&c.show){const d=n.getAxisComponent(),h=r.getDataList(),p=h[h.length-1];if(Rn(p)){const{close:v,open:x}=p,S=l.compareRule==="current_open"?x:((f=h[h.length-2])==null?void 0:f.close)??v,C=d.convertToPixel(v);let I="";v>S?I=l.upColor:v<S?I=l.downColor:I=l.noChangeColor,(u=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:C},{x:o.width,y:C}]},styles:{style:c.style,color:I,size:c.size,dashedValue:c.dashedValue}}))==null||u.draw(e)}}}}const g5={second:"HH:mm:ss",minute:"YYYY-MM-DD HH:mm",hour:"YYYY-MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},w9={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅：",second:"秒",minute:"",hour:"小时",day:"天",week:"周",month:"月",year:"年"},k9={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: ",second:"S",minute:"",hour:"H",day:"D",week:"W",month:"M",year:"Y"},S9={"zh-CN":w9,"en-US":k9};function C9(s,e){return S9[e][s]??s}class I9 extends m5{constructor(){super(...arguments);Pe(this,"_logoCache",{});Pe(this,"_logoSubscribed",{})}drawImp(t){const n=this.getWidget(),o=n.getPane().getChart().getChartStore(),r=o.getCrosshair();if(Rn(r.dutyData)){const a=n.getBounding(),l=o.getStyles(),c=l.candle,f=l.indicator;if(c.tooltip.showType==="rect"&&f.tooltip.showType==="rect"){const u=this.isDrawTooltip(r,c.tooltip),d=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,u,d,c.tooltip.offsetTop)}else if(c.tooltip.showType==="standard"&&f.tooltip.showType==="standard"){const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,p=a.width-h,v=this._drawCandleStandardTooltip(t,u,d,p);this.drawIndicatorTooltip(t,u,v,p)}else if(c.tooltip.showType==="rect"&&f.tooltip.showType==="standard"){const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,p=a.width-h,v=this.drawIndicatorTooltip(t,u,d,p),x=this.isDrawTooltip(r,c.tooltip);this._drawRectTooltip(t,x,!1,v)}else{const{offsetLeft:u,offsetTop:d,offsetRight:h}=c.tooltip,p=a.width-h,v=this._drawCandleStandardTooltip(t,u,d,p),x=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,!1,x,v)}}}_drawCandleStandardTooltip(t,n,o,r){var p;const a=this.getWidget().getPane().getChart().getChartStore(),c=a.getStyles().candle.tooltip,f=c.legend;let u=0;const d={x:n,y:o},h=a.getCrosshair();if(this.isDrawTooltip(h,c)){const v=c.title;if(v.show){const{type:C="",span:I=""}=a.getPeriod()??{},A=a.getSymbol(),P=((A==null?void 0:A.type)||"").toLowerCase(),T=((A==null?void 0:A.exchange)||"").toUpperCase();let j=P;(j==="forex"||j==="crypto")&&(j="");const E={second:"s",minute:"m",hour:"h",day:"d",week:"w",month:"mo",year:"y"},L=(I?`${I}`:"")+(E[C]??"");let D=v.template;!j&&typeof D=="string"&&(D=D.replace(/(?:\s*[·\.]\s*)\{segment\}/i,""));let X=hw(D,{...A,period:L,exchange:T,segment:j});try{if(typeof window<"u"&&window.innerWidth<=768){const le=(A==null?void 0:A.name)||(A==null?void 0:A.ticker)||"",pe=v.marginLeft??0,re=v.marginRight??0,xe=20,Ne=!!(A!=null&&A.logo2)?xe*2-6+6:xe+6,Te=Math.max(0,r-Ne-pe-re),Me=v.size??14,De=v.family,Oe=v.weight,Ke="...",kt=tm(Ke,Me,Oe,De);let pt=le;if(tm(pt,Me,Oe,De)>Te&&Te>kt){let Ht=0,Ft=pt.length;for(;Ht<Ft;){const ut=Math.floor((Ht+Ft)/2),nt=pt.slice(0,ut)+Ke;tm(nt,Me,Oe,De)<=Te?Ht=ut+1:Ft=ut}const zt=Math.max(1,Ht-1);pt=pt.slice(0,zt)+Ke}X=pt}}catch{}const ne=v.color;let de={...v};try{const te=(A==null?void 0:A.logo)||"",le=(A==null?void 0:A.logo2)||"",pe=20,re=Math.floor(d.x+(de.marginLeft??0)),xe=Math.floor(d.y+(de.marginTop??0)+Math.max(0,Math.floor(((de.size??12)-pe)/2))),se=[te].filter(Boolean);le&&se.push(le);const Ne=a.getStyles(),Te=((p=Ne==null?void 0:Ne.pane)==null?void 0:p.backgroundColor)||"#ffffff";let Me=255,De=255,Oe=255;if(Te.startsWith("#")){const Ft=Te.replace(/^#/,""),zt=parseInt(Ft.length===3?Ft.split("").map(ut=>ut+ut).join(""):Ft,16);Me=zt>>16&255,De=zt>>8&255,Oe=zt&255}else if(/rgba?\(/i.test(Te)){const Ft=Te.match(/rgba?\(([^)]+)\)/i);if(Ft){const zt=Ft[1].split(",").map(ut=>parseFloat(ut.trim()));Me=zt[0]??Me,De=zt[1]??De,Oe=zt[2]??Oe}}const Ke=.299*Me+.587*De+.114*Oe,kt=Ke>186?"#CBD5E1":"#4B5563",pt=Ke>186?"rgba(255,255,255,0.7)":"rgba(17,24,39,0.6)",Rt=Ft=>{var xt,jt;const ut=((A==null?void 0:A.shortName)||(A==null?void 0:A.ticker)||(A==null?void 0:A.name)||""||"").toString().trim().charAt(0).toUpperCase(),nt=2,Je=Math.max(8,pe-nt*2),it=tm(ut,Je,de.weight,de.family),ze=Math.max(0,Math.floor((pe-nt*2-it)/2)),Ge=nt;(xt=this.createFigure({name:"rect",attrs:{x:Ft,y:xe,width:pe,height:pe},styles:{style:"stroke_fill",color:pt,borderColor:kt,borderSize:1,borderRadius:pe/2}}))==null||xt.draw(t),(jt=this.createFigure({name:"text",attrs:{x:Ft+nt,y:xe+nt,text:ut,width:pe-nt*2,height:pe-nt*2},styles:{backgroundColor:pt,borderRadius:(pe-nt*2)/2,size:Je,family:de.family,weight:de.weight,color:kt,paddingLeft:ze,paddingTop:Ge,paddingRight:0,paddingBottom:0}}))==null||jt.draw(t)};let Ht=pe;se.forEach((Ft,zt)=>{var nt,Je;const ut=Math.floor(re+(zt===0?0:pe-8));if(Ft){if(!this._logoSubscribed[Ft]){this._logoSubscribed[Ft]=!0;try{x8(Ft,()=>{try{this.getWidget().getPane().getChart().updatePane(zf.Overlay,yd.CANDLE)}catch{}})}catch{}}F2(Ft);let it=_8(Ft)||this._logoCache[Ft];it.complete&&it.naturalWidth>0?((nt=this.createFigure({name:"rect",attrs:{x:ut,y:xe,width:pe,height:pe},styles:{style:"stroke_fill",color:pt,borderColor:kt,borderSize:1,borderRadius:pe/2}}))==null||nt.draw(t),(Je=this.createFigure({name:"image",attrs:{x:ut+2,y:xe+2,width:pe-4,height:pe-4,image:it,borderRadius:(pe-4)/2},styles:{}}))==null||Je.draw(t)):Rt(ut)}else Rt(ut)}),Ht=se.length===2?pe*2-8:pe,de.marginLeft=(de.marginLeft??0)+Ht+6}catch{}const ie=this.drawStandardTooltipLegends(t,[{title:{text:"",color:ne},value:{text:X,color:ne}}],d,n,0,typeof window<"u"&&window.innerWidth<=768?r-(A!=null&&A.logo2?20*2-6:20):r,de);u=Math.max(u,ie)}const x=this._getCandleTooltipLegends(),S=this.classifyTooltipFeatures(c.features);u=this.drawStandardTooltipFeatures(t,S[0],d,null,n,u,r),u=this.drawStandardTooltipFeatures(t,S[1],d,null,n,u,r);try{typeof window<"u"&&window.innerWidth<=768&&(d.x=n,d.y+=u,u=0)}catch{}if(x.length>0){let C={...f};try{if(typeof window<"u"&&window.innerWidth<=768){let P=C.size;const T=C.family,j=C.weight;let E=C.marginLeft??0,L=C.marginRight??0;for(E=Math.min(E,4),L=Math.min(L,4),C.marginLeft=E,C.marginRight=L;P>8;){t.font=r0(P,j,T);let D=0;if(x.forEach(X=>{const ne=X.title,de=X.value,ie=ne.text.length>0?t.measureText(ne.text).width:0,te=t.measureText(de.text).width,le=ne.text.length>0&&de.text.length>0?2:0;D+=E+ie+le+te+L}),d.x+D<=r)break;P-=1}C.size=P}}catch{}const I={...C,marginTop:Math.max(C.marginTop??0,Math.floor((u-C.size)/2))};u=this.drawStandardTooltipLegends(t,x,d,n,u,r,I)}u=this.drawStandardTooltipFeatures(t,S[2],d,null,n,u,r)}return d.y+u}_drawRectTooltip(t,n,o,r){var v;const a=this.getWidget(),l=a.getPane(),c=l.getChart().getChartStore(),f=c.getStyles(),u=f.candle,d=f.indicator,h=u.tooltip,p=d.tooltip;if(n||o){const x=this._getCandleTooltipLegends(),{offsetLeft:S,offsetTop:C,offsetRight:I,offsetBottom:A}=h,{marginLeft:P,marginRight:T,marginTop:j,marginBottom:E,size:L,weight:D,family:X}=h.legend,{position:ne,paddingLeft:de,paddingRight:ie,paddingTop:te,paddingBottom:le,offsetLeft:pe,offsetRight:re,offsetTop:xe,offsetBottom:se,borderSize:Ne,borderRadius:Te,borderColor:Me,color:De}=h.rect;let Oe=0,Ke=0,kt=0;n&&(t.font=r0(L,D,X),x.forEach(it=>{const ze=it.title,Ge=it.value,xt=`${ze.text}${Ge.text}`,jt=t.measureText(xt).width+P+T;Oe=Math.max(Oe,jt)}),kt+=(E+j+L)*x.length);const{marginLeft:pt,marginRight:Rt,marginTop:Ht,marginBottom:Ft,size:zt,weight:ut,family:nt}=p.legend,Je=[];if(o){const it=c.getIndicatorsByPaneId(l.getId());t.font=r0(zt,ut,nt),it.forEach(ze=>{const Ge=this.getIndicatorTooltipData(ze).legends;Je.push(Ge),Ge.forEach(xt=>{const jt=xt.title,ft=xt.value,ke=`${jt.text}${ft.text}`,Se=t.measureText(ke).width+pt+Rt;Oe=Math.max(Oe,Se),kt+=Ht+Ft+zt})})}if(Ke+=Oe,Ke!==0&&kt!==0){const it=c.getCrosshair(),ze=a.getBounding(),Ge=l.getYAxisWidget().getBounding();Ke+=Ne*2+de+ie,kt+=Ne*2+te+le;const xt=ze.width/2,jt=ne==="pointer"&&it.paneId===yd.CANDLE,ft=(it.realX??0)>xt;let ke=0;if(jt){const Ls=it.realX;ft?ke=Ls-re-Ke:ke=Ls+pe}else{const Ls=this.getWidget().getPane().getAxisComponent();ft?(ke=pe+S,Ls.inside&&Ls.position==="left"&&(ke+=Ge.width)):(ke=ze.width-re-Ke-I,Ls.inside&&Ls.position==="right"&&(ke-=Ge.width))}let Se=r+xe;jt&&(Se=it.y-kt/2,Se+kt>ze.height-se-A&&(Se=ze.height-se-kt-A),Se<r+xe&&(Se=r+xe+C)),(v=this.createFigure({name:"rect",attrs:{x:ke,y:Se,width:Ke,height:kt},styles:{style:"stroke_fill",color:De,borderColor:Me,borderSize:Ne,borderRadius:Te}}))==null||v.draw(t);const Et=ke+Ne+de+P;let wt=Se+Ne+te;if(n&&x.forEach(Ls=>{var an,Es;wt+=j;const tn=Ls.title;(an=this.createFigure({name:"text",attrs:{x:Et,y:wt,text:tn.text},styles:{color:tn.color,size:L,family:X,weight:D}}))==null||an.draw(t);const Gs=Ls.value;(Es=this.createFigure({name:"text",attrs:{x:ke+Ke-Ne-T-ie,y:wt,text:Gs.text,align:"right"},styles:{color:Gs.color,size:L,family:X,weight:D}}))==null||Es.draw(t),wt+=L+E}),o){const Ls=ke+Ne+de+pt;Je.forEach(tn=>{tn.forEach(Gs=>{var Ns,Hs;wt+=Ht;const an=Gs.title,Es=Gs.value;(Ns=this.createFigure({name:"text",attrs:{x:Ls,y:wt,text:an.text},styles:{color:an.color,size:zt,family:nt,weight:ut}}))==null||Ns.draw(t),(Hs=this.createFigure({name:"text",attrs:{x:ke+Ke-Ne-Rt-ie,y:wt,text:Es.text,align:"right"},styles:{color:Es.color,size:zt,family:nt,weight:ut}}))==null||Hs.draw(t),wt+=zt+Ft})})}}}}_getCandleTooltipLegends(){const t=this.getWidget().getPane().getChart().getChartStore(),n=t.getStyles().candle,o=t.getDataList(),r=t.getInnerFormatter(),a=t.getDecimalFold(),l=t.getThousandsSeparator(),c=t.getLocale(),{pricePrecision:f=dm.PRICE,volumePrecision:u=dm.VOLUME}=t.getSymbol()??{},d=t.getPeriod(),h=t.getCrosshair().dataIndex??0,p=t.getSymbol(),x=((p==null?void 0:p.type)||"").toLowerCase()==="stock",C=n.tooltip.legend,{color:I,defaultValue:A}=C,P=C.template,T=o[h-1]??null,j=o[h],E=(T==null?void 0:T.close)??j.close,L=j.close-E,D={...j,time:r.formatDate(j.timestamp,g5[(d==null?void 0:d.type)??"day"],"tooltip"),open:a.format(l.format(Im(j.open,f))),high:a.format(l.format(Im(j.high,f))),low:a.format(l.format(Im(j.low,f))),close:a.format(l.format(Im(j.close,f))),volume:a.format(l.format(r.formatBigNumber(Im(j.volume??A,u)))),turnover:a.format(l.format(Im(j.turnover??A,f))),change:E===0?A:`${l.format(Im(L/E*100))}%`},X=cv(P)?P({prev:T,current:j,next:o[h+1]??null},n):P;return(x?X:X.filter(de=>{const ie=Cv(de.title)?de.title.text:de.title,te=Cv(de.value)?de.value.text:de.value,le=(ie||"").toString().trim().toLowerCase(),pe=(te||"").toString();return!(le==="volume"||/\{volume\}/i.test(pe))})).map(de=>{const{title:ie,value:te}=de;let le={text:"",color:I};Cv(ie)?le=ie:le.text=ie,le.text=C9(le.text,c);let pe={text:A,color:I};return Cv(te)?pe=te:pe.text=te,Rn(/{change}/.exec(pe.text))&&(pe.color=L===0?n.priceMark.last.noChangeColor:L>0?n.priceMark.last.upColor:n.priceMark.last.downColor),pe.text=hw(pe.text,D),{title:le,value:pe}})}}class P9 extends qv{constructor(t){super(t);Pe(this,"_activeFeatureInfo",null);Pe(this,"_featureClickEvent",t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCrosshairFeatureClick",t),!0));Pe(this,"_featureMouseMoveEvent",t=>()=>(this._activeFeatureInfo=t,this.getWidget().setForceCursor("pointer"),!0));this.registerEvent("mouseMoveEvent",n=>(this._activeFeatureInfo=null,this.getWidget().setForceCursor(null),!1))}drawImp(t){var f;const n=this.getWidget(),o=n.getPane(),r=n.getPane().getChart().getChartStore(),a=r.getCrosshair(),l=this.getWidget(),c=l.getPane().getAxisComponent();if(Mf(a.paneId)&&a.paneId===o.getId()&&c.isInCandle()){const u=r.getStyles().crosshair,d=u.horizontal.features;if(u.show&&u.horizontal.show&&d.length>0){const h=c.position==="right",p=l.getBounding();let v=0;const x=u.horizontal.text;if(c.inside&&x.show){const I=c.convertFromPixel(a.y),A=c.getRange();let P=c.displayValueToText(c.realValueToDisplayValue(c.valueToRealValue(I,{range:A}),{range:A}),((f=r.getSymbol())==null?void 0:f.pricePrecision)??dm.PRICE);P=r.getDecimalFold().format(r.getThousandsSeparator().format(P)),v=x.paddingLeft+tm(P,x.size,x.weight,x.family)+x.paddingRight}let S=v;h&&(S=p.width-v);const C=a.y;d.forEach(I=>{var Me,De,Oe,Ke;const{marginLeft:A=0,marginTop:P=0,marginRight:T=0,paddingLeft:j=0,paddingTop:E=0,paddingRight:L=0,paddingBottom:D=0,color:X,activeColor:ne,backgroundColor:de,activeBackgroundColor:ie,borderRadius:te,size:le=0,type:pe,content:re}=I;let xe=le;if(pe==="icon_font"){const kt=re;xe=j+tm(kt.code,le,"normal",kt.family)+L}h?S-=xe+T:S+=A;let se=X,Ne=de;((Me=this._activeFeatureInfo)==null?void 0:Me.feature.id)===I.id&&(se=ne??X,Ne=ie??de);const Te={mouseClickEvent:this._featureClickEvent({crosshair:a,feature:I}),mouseMoveEvent:this._featureMouseMoveEvent({crosshair:a,feature:I})};if(pe==="icon_font"){const kt=re;(De=this.createFigure({name:"text",attrs:{text:kt.code,x:S,y:C+P,baseline:"middle"},styles:{paddingLeft:j,paddingTop:E,paddingRight:L,paddingBottom:D,borderRadius:te,size:le,family:kt.family,color:se,backgroundColor:Ne}},Te))==null||De.draw(t)}else{(Oe=this.createFigure({name:"rect",attrs:{x:S,y:C+P-le/2,width:le,height:le},styles:{paddingLeft:j,paddingTop:E,paddingRight:L,paddingBottom:D,color:Ne}},Te))==null||Oe.draw(t);const kt=re;(Ke=this.createFigure({name:"path",attrs:{path:kt.path,x:S,y:C+P+E-le/2,width:le,height:le},styles:{style:kt.style,lineWidth:kt.lineWidth,color:se}}))==null||Ke.draw(t)}h?S-=A:S+=xe+T})}}}}class M9 extends v5{constructor(t,n){super(t,n);Pe(this,"_candleBarView",new h5(this));Pe(this,"_candleAreaView",new y9(this));Pe(this,"_candleHighLowPriceView",new b9(this));Pe(this,"_candleLastPriceLineView",new x9(this));Pe(this,"_crosshairFeatureView",new P9(this));this.addChild(this._candleBarView),this.addChild(this._crosshairFeatureView)}updateMainContent(t){this.getPane().getChart().getStyles().candle.type!=="area"?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)}updateOverlayContent(t){this._crosshairFeatureView.draw(t)}createTooltipView(){return new I9(this)}}class _5 extends qv{drawImp(e,t){var c,f;const n=this.getWidget(),o=n.getPane(),r=n.getBounding(),a=o.getAxisComponent(),l=this.getAxisStyles(o.getChart().getStyles());if(l.show&&(l.axisLine.show&&((c=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||c.draw(e)),!t[0])){const u=a.getTicks();if(l.ticduty.show&&this.createTicdutys(u,r,l).forEach(h=>{var p;(p=this.createFigure({name:"line",attrs:h,styles:l.ticduty}))==null||p.draw(e)}),l.tickText.show){const d=this.createTickTexts(u,r,l);(f=this.createFigure({name:"text",attrs:d,styles:l.tickText}))==null||f.draw(e)}}}}class N9 extends _5{getAxisStyles(e){return e.yAxis}createAxisLine(e,t){const n=this.getWidget().getPane().getAxisComponent(),o=t.axisLine.size;let r=0;return n.isFromZero()?r=0:r=e.width-o,{coordinates:[{x:r,y:0},{x:r,y:e.height}]}}createTicdutys(e,t,n){const o=this.getWidget().getPane().getAxisComponent(),r=n.axisLine,a=n.ticduty;let l=0,c=0;return o.isFromZero()?(l=0,r.show&&(l+=r.size),c=l+a.length):(l=t.width,r.show&&(l-=r.size),c=l-a.length),e.map(f=>({coordinates:[{x:l,y:f.coord},{x:c,y:f.coord}]}))}createTickTexts(e,t,n){const o=this.getWidget().getPane().getAxisComponent(),r=n.axisLine,a=n.ticduty,l=n.tickText;let c=0;o.isFromZero()?(c=l.marginStart,r.show&&(c+=r.size),a.show&&(c+=a.length)):(c=t.width-l.marginEnd,r.show&&(c-=r.size),a.show&&(c-=a.length));const f=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return e.map(u=>({x:c,y:u.coord,text:u.text,align:f,baseline:"middle"}))}}class A9 extends qv{drawImp(e){var f,u,d,h,p,v;const t=this.getWidget(),n=t.getPane(),o=t.getBounding(),r=n.getChart().getChartStore(),a=r.getStyles().candle.priceMark,l=a.last,c=l.text;if(a.show&&l.show&&c.show){const x=r.getStyles().yAxis,S=x.axisLine.show?x.axisLine.size:0,C=x.ticduty.show?x.ticduty.length:0,I=x.tickText.marginStart,A=x.tickText.marginEnd,P=1,T=((f=r.getSymbol())==null?void 0:f.pricePrecision)??dm.PRICE,j=n.getAxisComponent(),E=r.getVisibleRangeDataList(),L=j.position==="right"?E.length-1:0,D=r.getDataList(),X=D[D.length-1];if(Rn(X)){const{close:ne,open:de}=X,ie=l.compareRule==="current_open"?de:((u=D[D.length-2])==null?void 0:u.close)??ne,te=j.convertToPixel(ne);let le="";ne>ie?le=l.upColor:ne<ie?le=l.downColor:le=l.noChangeColor;let pe=0,re="left";const xe=c.color,se={...c};if(j.isFromZero())pe=S+P,re="left",se.paddingLeft=C+I-P;else{pe=o.width-S-P,re="right";const xt=o.width-S-P,jt=o.width-(x.axisLine.show?x.axisLine.size:0)-(x.ticduty.show?x.ticduty.length:0)-A;se.paddingRight=xt-jt}const Ne=[],Te=j.getRange();let Me=j.displayValueToText(j.realValueToDisplayValue(j.valueToRealValue(ne,{range:Te}),{range:Te}),T);Me=r.getDecimalFold().format(r.getThousandsSeparator().format(Me));const{paddingLeft:De,paddingRight:Oe,paddingTop:Ke,paddingBottom:kt,size:pt,family:Rt,weight:Ht}=se;let Ft=De+tm(Me,pt,Ht,Rt)+Oe;const zt=Ke+pt+kt,ut=T0(le,xe);Ne.push({name:"text",attrs:{x:pe,y:te,width:Ft,height:zt,text:Me,align:re,baseline:"middle"},styles:{...se,color:ut,backgroundColor:le}});const nt=r.getInnerFormatter().formatExtendText,Je=pt/2;let it=te-Je-Ke,ze=te+Je+kt;l.extendTexts.forEach((xt,jt)=>{const ft=nt({type:"last_price",data:X,index:jt});if(ft.length>0&&xt.show){const ke=xt.size/2;let Se=0;xt.position==="above_price"?(it-=xt.paddingBottom+ke,Se=it,it-=ke+xt.paddingTop):(ze+=xt.paddingTop+ke,Se=ze,ze+=ke+xt.paddingBottom),Ft=Math.max(Ft,xt.paddingLeft+tm(ft,xt.size,xt.weight,xt.family)+xt.paddingRight),Ne.push({name:"text",attrs:{x:pe,y:Se,width:Ft,height:xt.paddingTop+xt.size+xt.paddingBottom,text:ft,align:re,baseline:"middle"},styles:{...xt,color:T0(le,xt.color??xe),backgroundColor:le}})}});const Ge=(d=E[L])==null?void 0:d.data.current;if(Rn(Ge)&&Ge.timestamp!==X.timestamp){const{close:xt,open:jt}=Ge,ft=j.position==="right"?(h=E[L-1])==null?void 0:h.data.current:(p=E[L+1])==null?void 0:p.data.current,ke=l.compareRule==="current_open"?jt:(ft==null?void 0:ft.close)??((v=D[D.length-2])==null?void 0:v.close)??xt,Se=j.convertToPixel(xt);let Et="";xt>ke?Et=l.upColor:xt<ke?Et=l.downColor:Et=l.noChangeColor;let wt=j.displayValueToText(j.realValueToDisplayValue(j.valueToRealValue(xt,{range:Te}),{range:Te}),T);wt=r.getDecimalFold().format(r.getThousandsSeparator().format(wt));let Ls=De+tm(wt,pt,Ht,Rt)+Oe;const tn=Ke+pt+kt;Ne.push({name:"text",attrs:{x:pe,y:Se,width:Ls,height:tn,text:wt,align:re,baseline:"middle"},styles:{...se,color:T0(Et,xe),backgroundColor:Et}});const Gs=pt/2;let an=Se-Gs-Ke,Es=Se+Gs+kt;l.extendTexts.forEach((Ns,Hs)=>{const ns=nt({type:"last_price",data:Ge,index:Hs});if(ns.length>0&&Ns.show){const fs=Ns.size/2;let Mn=0;Ns.position==="above_price"?(an-=Ns.paddingBottom+fs,Mn=an,an-=fs+Ns.paddingTop):(Es+=Ns.paddingTop+fs,Mn=Es,Es+=fs+Ns.paddingBottom),Ls=Math.max(Ls,Ns.paddingLeft+tm(ns,Ns.size,Ns.weight,Ns.family)+Ns.paddingRight),Ne.push({name:"text",attrs:{x:pe,y:Mn,width:Ls,height:Ns.paddingTop+Ns.size+Ns.paddingBottom,text:ns,align:re,baseline:"middle"},styles:{...Ns,color:T0(Et,Ns.color??xe),backgroundColor:Et}})}})}Ne.forEach(xt=>{var Ls,tn,Gs,an;const jt=xt.attrs,ft=jt.y,ke=jt.height??(((Ls=xt.styles)==null?void 0:Ls.paddingTop)??0)+(((tn=xt.styles)==null?void 0:tn.size)??0)+(((Gs=xt.styles)==null?void 0:Gs.paddingBottom)??0),Se=ke/2,wt=ft<-Se||ft>o.height+Se?ft:n.placeYAxisLabel(ft,ke,o.height);wt!==null&&((an=this.createFigure({...xt,attrs:{...jt,y:jt.y+(wt-ft)}}))==null||an.draw(e))})}}}}class T9 extends qv{drawImp(e){var f,u;const t=this.getWidget(),n=t.getPane(),o=t.getBounding(),r=n.getChart().getChartStore(),a=r.getStyles().indicator,l=a.lastValueMark,c=l.text;if(l.show){const d=r.getStyles().yAxis,h=d.axisLine.show?d.axisLine.size:0,p=d.ticduty.show?d.ticduty.length:0,v=d.tickText.marginStart,x=d.tickText.marginEnd,S=1,C=n.getAxisComponent(),I=C.getRange(),A=r.getVisibleRangeDataList(),P=C.position==="right"?A.length-1:0,T=r.getDataList(),j=((f=A[P])==null?void 0:f.data.current)??T[T.length-1]??{},E=((u=A[P-(C.position==="right"?1:-1)])==null?void 0:u.data.current)??T[T.length-2]??{},L=r.getIndicatorsByPaneId(n.getId()),D=r.getInnerFormatter(),X=r.getDecimalFold(),ne=r.getThousandsSeparator(),de=[];L.forEach(ie=>{var pe;const te=ie.result,le=te[j.timestamp]??te[E.timestamp]??{};if(Rn(le)&&ie.visible){let re=ie.precision;C.isInCandle()&&(re=((pe=r.getSymbol())==null?void 0:pe.pricePrecision)??dm.PRICE),yx(ie,{prev:E.timestamp,current:j.timestamp,next:null},a,(xe,se)=>{const Ne=le[xe.key];if(ul(Ne)){const Te=C.convertToPixel(Ne);let Me=C.displayValueToText(C.realValueToDisplayValue(C.valueToRealValue(Ne,{range:I}),{range:I}),re);ie.shouldFormatBigNumber&&(Me=D.formatBigNumber(Me)),Me=X.format(ne.format(Me));let De=0,Oe="left";const Ke={...c};if(C.isFromZero())De=h+S,Oe="left",Ke.paddingLeft=p+v-S;else{De=o.width-h-S,Oe="right";const ze=o.width-h-S,Ge=o.width-(d.axisLine.show?d.axisLine.size:0)-(d.ticduty.show?d.ticduty.length:0)-x;Ke.paddingRight=ze-Ge}const{paddingLeft:kt,paddingRight:pt,paddingTop:Rt,paddingBottom:Ht,size:Ft,weight:zt,family:ut}=Ke,nt=kt+tm(Me,Ft,zt,ut)+pt,Je=Rt+Ft+Ht,it=Math.max(nt,o.width-h-S);de.push({desiredY:Te,x:De,y:Te,text:Me,align:Oe,width:it,height:Je,styles:{...Ke,color:T0(se.color,Ke.color),backgroundColor:se.color}})}})}}),de.length>0&&de.sort((ie,te)=>ie.desiredY-te.desiredY).forEach(ie=>{var re;const te=ie.height/2,pe=ie.desiredY<-te||ie.desiredY>o.height+te?ie.desiredY:n.placeYAxisLabel(ie.desiredY,ie.height,o.height);pe!==null&&((re=this.createFigure({name:"text",attrs:{x:ie.x,y:pe,text:ie.text,width:ie.width,height:ie.height,align:ie.align,baseline:"middle"},styles:ie.styles}))==null||re.draw(e))})}}}class y5 extends D2{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(e,t,n){this.drawFigures(e,t,this.getDefaultFigures(t,n))}getDefaultFigures(e,t){var c;const n=this.getWidget(),o=n.getPane(),r=o.getChart().getChartStore(),a=r.getClickOverlayInfo(),l=[];if(e.needDefaultYAxisFigure&&e.id===((c=a.overlay)==null?void 0:c.id)&&a.paneId===o.getId()){const f=o.getAxisComponent(),u=n.getBounding();let d=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const p=f.isFromZero();let v="left",x=0;p?(v="left",x=0):(v="right",x=u.width);const S=r.getDecimalFold(),C=r.getThousandsSeparator();t.forEach((I,A)=>{var T;const P=e.points[A];if(ul(P.value)){d=Math.min(d,I.y),h=Math.max(h,I.y);const j=S.format(C.format(Im(P.value,((T=r.getSymbol())==null?void 0:T.pricePrecision)??dm.PRICE)));l.push({type:"text",attrs:{x,y:I.y,text:j,align:v,baseline:"middle"},ignoreEvent:!0})}}),t.length>1&&l.unshift({type:"rect",attrs:{x:0,y:d,width:u.width,height:h-d},ignoreEvent:!0})}return l}drawFigures(e,t,n){const o=this.getWidget().getPane().getChart().getStyles().overlay,r=this.getWidget().getBounding(),a=this.getWidget().getPane(),l=n.flatMap(c=>{var h;if(c.type!=="text")return[c];const f=[].concat(c.attrs),u={...o.text,...(h=t.styles)==null?void 0:h.text,...c.styles};typeof u.backgroundColor=="string"&&(u.color=T0(u.backgroundColor,u.color));const d=f.map(p=>{const v=Ix(p,u),x=v.y+v.height/2,S=a.placeYAxisLabel(x,v.height,r.height);return S===null?null:{...p,y:p.y+(S-x)}}).filter(Boolean);return d.length===0?[]:[{...c,attrs:Array.isArray(c.attrs)?d:d[0]}]});super.drawFigures(e,t,l)}getFigures(e,t){var f;const n=this.getWidget(),o=n.getPane(),r=o.getChart(),a=o.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=n.getBounding();return((f=e.createYAxisFigures)==null?void 0:f.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class b5 extends qv{drawImp(e){var a;const t=this.getWidget(),n=t.getPane(),o=t.getPane().getChart().getChartStore(),r=o.getCrosshair();if(Mf(r.paneId)&&this.compare(r,n.getId())){const l=o.getStyles().crosshair;if(l.show){const c=this.getDirectionStyles(l),f=c.text;if(c.show&&f.show){const u=t.getBounding(),d=n.getAxisComponent(),h=this.getText(r,o,d),p=o.getStyles().yAxis,v=p.axisLine.show?p.axisLine.size:0,x=p.ticduty.show?p.ticduty.length:0,S=p.tickText.marginStart,C=p.tickText.marginEnd,I=1,A=d,P={...f};if(A.isFromZero())P.paddingLeft=x+S-I;else{const T=u.width-v-I,j=u.width-(p.axisLine.show?p.axisLine.size:0)-(p.ticduty.show?p.ticduty.length:0)-C;P.paddingRight=T-j}e.font=r0(P.size,P.weight,P.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(h,e.measureText(h).width,r,u,d,P),styles:P}))==null||a.draw(e)}}}}compare(e,t){return e.paneId===t}getDirectionStyles(e){return e.horizontal}getText(e,t,n){var u;const o=n,r=n.convertFromPixel(e.y);let a=0,l=!1;o.isInCandle()?a=((u=t.getSymbol())==null?void 0:u.pricePrecision)??dm.PRICE:t.getIndicatorsByPaneId(e.paneId).forEach(h=>{a=Math.max(h.precision,a),l||(l=h.shouldFormatBigNumber)});const c=o.getRange();let f=o.displayValueToText(o.realValueToDisplayValue(o.valueToRealValue(r,{range:c}),{range:c}),a);return l&&(f=t.getInnerFormatter().formatBigNumber(f)),t.getDecimalFold().format(t.getThousandsSeparator().format(f))}getTextAttrs(e,t,n,o,r,a){const l=r,c=this.getWidget().getPane().getChart().getStyles(),f=c.yAxis.axisLine.show?c.yAxis.axisLine.size:0,u=1;let d=0,h="left";return l.isFromZero()?(d=f+u,h="left"):(d=o.width-f-u,h="right"),{x:d,y:n.y,text:e,align:h,baseline:"middle"}}}class F9 extends Sx{constructor(t,n){super(t,n);Pe(this,"_yAxisView",new N9(this));Pe(this,"_candleLastPriceLabelView",new A9(this));Pe(this,"_indicatorLastValueView",new T9(this));Pe(this,"_overlayYAxisView",new y5(this));Pe(this,"_crosshairHorizontalLabelView",new b5(this));this.setCursor("ns-resize"),this.addChild(this._overlayYAxisView)}getName(){return id.Y_AXIS}updateMain(t){const n=this.getPane().getOptions().state==="minimize";this.getPane().resetYAxisLabelSlots(),this._yAxisView.draw(t,n),n||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)),n||this.getPane().commitYAxisLabelSlots()}updateUnderlay(t){}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this.getPane().resetYAxisOverlaySlots(),this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))}}const n_=[1,2,2.5,5,10];function L9(s,e,t){return Math.min(Math.max(s,e),t)}function Sw(s,e){if(!Number.isFinite(s)||s<=0)return 0;const t=Math.floor(Math.log10(s)),n=Math.pow(10,t),o=s/n;let r=n_[n_.length-1];if(e==="floor")for(let a=n_.length-1;a>=0;a--){const l=n_[a];if(o>=l){r=l;break}}else for(let a=0;a<n_.length;a++){const l=n_[a];if(o<=l){r=l;break}}return r*n}function E9({pixelPerValue:s,targetPx:e=60,minPx:t=45,maxPx:n=75,hysteresis:o=.15,prevInterval:r=null}){const a=Math.max(1e-12,s),l=e/a,c=Math.floor(Math.log10(l));let f=l,u=l*a,d=Number.POSITIVE_INFINITY,h=!1;for(let p=c-6;p<=c+6;p++){const v=Math.pow(10,p);for(const x of n_){const S=x*v,C=S*a;if(!Number.isFinite(C))continue;const I=C>=t&&C<=n,A=Math.abs(C-e);(I&&(!h||A<d)||!h&&A<d)&&(f=S,u=C,d=A,h=I)}}if(u<t?(f=Sw(t/a,"ceil"),u=f*a):u>n&&(f=Sw(n/a,"floor"),u=f*a),r&&r>0){const p=r*a,v=t*(1-o),x=n*(1+o);if(p>=v&&p<=x)return{interval:r,stepPx:L9(p,0,Number.POSITIVE_INFINITY),changed:!1}}return{interval:f,stepPx:u,changed:!0}}function Cw(){return{from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0}}class x5{constructor(e){Pe(this,"name");Pe(this,"scrollZoomEnabled",!0);Pe(this,"createTicks");Pe(this,"_parent");Pe(this,"_range",Cw());Pe(this,"_prevRange",Cw());Pe(this,"_ticks",[]);Pe(this,"_autoCalcTickFlag",!0);this._parent=e}getParent(){return this._parent}buildTicks(e){return this._autoCalcTickFlag&&(this._range=this.createRangeImp()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||e?(this._prevRange=this._range,typeof performance<"u"?performance.now():Date.now(),this._ticks=this.createTicksImp(),typeof performance<"u"?performance.now():Date.now(),!0):!1}getTicks(){return this._ticks}setRange(e){this._autoCalcTickFlag=!1,this._range=e}getRange(){return this._range}setAutoCalcTickFlag(e){this._autoCalcTickFlag=e}getAutoCalcTickFlag(){return this._autoCalcTickFlag}}const Wb=8;class E_ extends x5{constructor(t,n){super(t);Pe(this,"_gridInterval",null);Pe(this,"reverse",!1);Pe(this,"inside",!1);Pe(this,"position","right");Pe(this,"gap",{top:.2,bottom:.1});Pe(this,"createRange",t=>t.defaultRange);Pe(this,"minSpan",t=>C_(-t));Pe(this,"valueToRealValue",t=>t);Pe(this,"realValueToDisplayValue",t=>t);Pe(this,"displayValueToRealValue",t=>t);Pe(this,"realValueToValue",t=>t);Pe(this,"displayValueToText",(t,n)=>Im(t,n));this.override(n)}override(t){const{name:n,gap:o,...r}=t;Mf(this.name)||(this.name=n),Bh(this.gap,o),Bh(this,r)}createRangeImp(){var Te;const t=this.getParent(),n=t.getChart(),o=n.getChartStore(),r=t.getId();let a=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,c=!1,f=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;const h=o.getIndicatorsByPaneId(r);let p=4;const v=this.isInCandle(),x=!v;h.forEach(Me=>{c||(c=Me.shouldOhlc),d=Math.min(d,Me.precision),x&&(ul(Me.minValue)&&(f=Math.min(f,Me.minValue)),ul(Me.maxValue)&&(u=Math.max(u,Me.maxValue)))}),v?p=((Te=o.getSymbol())==null?void 0:Te.pricePrecision)??dm.PRICE:d!==Number.MAX_SAFE_INTEGER&&(p=d);const S=o.getVisibleRangeDataList(),C=n.getStyles().candle,I=C.type==="area",A=C.area.value,P=v&&!I||!v&&c;S.forEach(Me=>{const De=Me.data.current;if(Rn(De)){if(P){const Oe=De.low,Ke=De.high;a=Math.min(a,Oe),l=Math.max(l,Ke)}if(v&&I){const Oe=De[A];ul(Oe)&&(a=Math.min(a,Oe),l=Math.max(l,Oe))}x&&h.forEach(({result:Oe,figures:Ke})=>{const kt=Oe[De.timestamp]??{};Ke.forEach(pt=>{const Rt=kt[pt.key];ul(Rt)&&(a=Math.min(a,Rt),l=Math.max(l,Rt))})})}}),a!==Number.MAX_SAFE_INTEGER&&l!==Number.MIN_SAFE_INTEGER?(a=Math.min(f,a),l=Math.max(u,l)):(a=0,l=10);const T=l-a,j={from:a,to:l,range:T,realFrom:a,realTo:l,realRange:T,displayFrom:a,displayTo:l,displayRange:T},E=this.createRange({chart:n,paneId:r,defaultRange:j});let L=E.realFrom,D=E.realTo,X=E.realRange;const ne=this.minSpan(p);if(L===D||X<ne){const Me=f===L,De=u===D,Oe=Wb/2;L=Me?L:De?L-Wb*ne:L-Oe*ne,D=De?D:Me?D+Wb*ne:D+Oe*ne}const de=this.getEffectiveHeight(),{top:ie,bottom:te}=this.gap;let le=ie;le>=1&&(le=le/de);let pe=te;pe>=1&&(pe=pe/de),X=D-L,L=L-X*pe,D=D+X*le;const re=this.realValueToValue(L,{range:E}),xe=this.realValueToValue(D,{range:E}),se=this.realValueToDisplayValue(L,{range:E}),Ne=this.realValueToDisplayValue(D,{range:E});return{from:re,to:xe,range:xe-re,realFrom:L,realTo:D,realRange:D-L,displayFrom:se,displayTo:Ne,displayRange:Ne-se}}isInCandle(){return this.getParent().getId()===yd.CANDLE}isFromZero(){return this.position==="left"&&this.inside||this.position==="right"&&!this.inside}createTicksImp(){var ie;const t=this.getRange(),{displayFrom:n,displayTo:o}=t,r=Math.min(n,o),a=Math.max(n,o),l=this.getParent(),c=this.getEffectiveHeight(),f=40,u=50,d=45,h=c/Math.max(1e-12,t.realRange);let v=E9({pixelPerValue:h,targetPx:d,minPx:f,maxPx:u,hysteresis:.15,prevInterval:this._gridInterval}).interval;if(this._gridInterval=v,globalThis.__SMARTCHART_GRID_DEBUG__){const te=v*h;console.log("[grid:y]",{interval:v,stepPx:Math.round(te*100)/100,height:c})}const x=S8(v),S=[];if(v>0){let te=vw(Math.floor(r/v)*v,x);const le=vw(Math.ceil(a/v)*v,x);let pe=0;const re=Math.ceil(c/Math.max(1,f))+10;for(;te<=le&&pe<re;){const xe=te.toFixed(x);S.push({text:xe,coord:0,value:xe}),te+=v,pe+=1}}const C=l.getChart().getChartStore(),I=[],A=C.getIndicatorsByPaneId(l.getId()),P=C.getStyles();let T=0,j=!1;this.isInCandle()?T=((ie=C.getSymbol())==null?void 0:ie.pricePrecision)??dm.PRICE:A.forEach(te=>{T=Math.max(T,te.precision),j||(j=te.shouldFormatBigNumber)});const E=C.getInnerFormatter(),L=C.getThousandsSeparator(),D=C.getDecimalFold(),X=P.yAxis.tickText.size,ne=Math.max(2,Math.round(X*.35));S.forEach(({value:te})=>{let le=this.displayValueToText(+te,T);const pe=this.convertToPixel(this.realValueToValue(this.displayValueToRealValue(+te,{range:t}),{range:t}));j&&(le=E.formatBigNumber(te)),le=D.format(L.format(le)),pe>=-ne&&pe<=c+ne&&I.push({text:le,coord:pe,value:te})});const de=$9({ticks:I,height:c,interval:v,shouldFormatBigNumber:j,formatter:E,thousandsSeparator:L,decimalFold:D,displayValueToText:te=>this.displayValueToText(te,T),valueToRealValue:te=>this.valueToRealValue(te,{range:t}),realValueToDisplayValue:te=>this.realValueToDisplayValue(te,{range:t}),convertFromPixel:te=>this.convertFromPixel(te)});return cv(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:de}):de}getAutoSize(){var x;const t=this.getParent(),o=t.getChart().getChartStore(),r=o.getStyles(),a=r.yAxis,l=a.size;if(l!=="auto")return l;let c=0;if(a.show&&(a.axisLine.show&&(c+=a.axisLine.size),a.ticduty.show&&(c+=a.ticduty.length),a.tickText.show)){let S=0;this.getTicks().forEach(C=>{S=Math.max(S,tm(C.text,a.tickText.size,a.tickText.weight,a.tickText.family))}),c+=a.tickText.marginStart+a.tickText.marginEnd+S}const f=r.candle.priceMark,u=f.show&&f.last.show&&f.last.text.show;let d=0;const h=r.crosshair,p=h.show&&h.horizontal.show&&h.horizontal.text.show;let v=0;if(u||p){const S=((x=o.getSymbol())==null?void 0:x.pricePrecision)??dm.PRICE,C=this.getRange().displayTo;if(u){const I=o.getDataList(),A=I[I.length-1];if(Rn(A)){const{paddingLeft:P,paddingRight:T,size:j,family:E,weight:L}=f.last.text;d=P+tm(Im(A.close,S),j,L,E)+T;const D=o.getInnerFormatter().formatExtendText;f.last.extendTexts.forEach((X,ne)=>{const de=D({type:"last_price",data:A,index:ne});de.length>0&&X.show&&(d=Math.max(d,X.paddingLeft+tm(de,X.size,X.weight,X.family)+X.paddingRight))})}}if(p){const I=o.getIndicatorsByPaneId(t.getId());let A=0,P=!1;I.forEach(E=>{A=Math.max(E.precision,A),P||(P=E.shouldFormatBigNumber)});let T=2;if(this.isInCandle()){const E=r.indicator.lastValueMark;E.show&&E.text.show?T=Math.max(A,S):T=S}else T=A;let j=Im(C,T);P&&(j=o.getInnerFormatter().formatBigNumber(j)),j=o.getDecimalFold().format(j),v+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+h.horizontal.text.borderSize*2+tm(j,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}}return Math.max(c,d,v)}getBounding(){return this.getParent().getYAxisWidget().getBounding()}convertFromPixel(t){const n=this.getEffectiveHeight(),o=this.getRange(),{realFrom:r,realRange:a}=o;if(!Number.isFinite(n)||n<=0||!Number.isFinite(a)||a===0)return this.realValueToValue(r,{range:o});const c=(this.reverse?t/n:1-t/n)*a+r;return this.realValueToValue(c,{range:o})}convertToPixel(t){const n=this.getRange(),o=this.valueToRealValue(t,{range:n}),r=this.getEffectiveHeight(),{realFrom:a,realRange:l}=n;if(!Number.isFinite(r)||r<=0||!Number.isFinite(l)||l===0)return 0;const c=(o-a)/l;return this.reverse?Math.round(c*r):Math.round((1-c)*r)}convertToNicePixel(t){const n=this.getEffectiveHeight(),o=this.convertToPixel(t);return Math.round(Math.max(n*.05,Math.min(o,n*.98)))}getEffectiveHeight(){var o,r;const t=this.getParent(),n=((o=t.getYAxisWidget())==null?void 0:o.getBounding().height)??0;return n>0?n:((r=t.getMainWidget())==null?void 0:r.getBounding().height)??0}static extend(t){class n extends E_{constructor(r){super(r,t)}}return n}}function $9({ticks:s,height:e,interval:t,shouldFormatBigNumber:n,formatter:o,thousandsSeparator:r,decimalFold:a,displayValueToText:l,valueToRealValue:c,realValueToDisplayValue:f,convertFromPixel:u}){if(s.length<2||e<=0||!Number.isFinite(t))return s;const d=[...s].sort((P,T)=>P.coord-T.coord),h=[];for(let P=1;P<d.length;P+=1){const T=d[P].coord-d[P-1].coord;T>0&&h.push(T)}if(h.length===0)return s;h.sort((P,T)=>P-T);const p=Math.floor(h.length/2),v=h.length%2===0?(h[p-1]+h[p])/2:h[p];if(!Number.isFinite(v)||v<=0)return s;const x=new Set;d.forEach(P=>x.add(Math.round(P.coord)));const S=[],C=P=>{const T=Math.round(P);if(x.has(T)||P<0||P>e)return;const j=u(P),E=f(c(j));let L=l(E);n&&(L=o.formatBigNumber(E)),L=a.format(r.format(L)),S.push({text:L,coord:P,value:E}),x.add(T)};let I=d[0].coord-v;for(;I>=0;)C(I),I-=v;let A=d[d.length-1].coord+v;for(;A<=e;)C(A),A+=v;return S.length===0?s:[...d,...S].sort((P,T)=>P.coord-T.coord)}const D9={name:"normal"},R9={name:"percentage",minSpan:()=>Math.pow(10,-2),displayValueToText:s=>`${Im(s,2)}%`,valueToRealValue:(s,{range:e})=>(s-e.from)/e.range*e.realRange+e.realFrom,realValueToValue:(s,{range:e})=>(s-e.realFrom)/e.realRange*e.range+e.from,createRange:({chart:s,defaultRange:e})=>{const t=s.getDataList(),n=s.getVisibleRange(),o=t[n.from];if(Rn(o)){const{from:r,to:a,range:l}=e,c=(e.from-o.close)/o.close*100,f=(e.to-o.close)/o.close*100,u=f-c;return{from:r,to:a,range:l,realFrom:c,realTo:f,realRange:u,displayFrom:c,displayTo:f,displayRange:u}}return e}},j9={name:"logarithm",minSpan:s=>.05*C_(-s),valueToRealValue:s=>s<0?-k0(Math.abs(s)):k0(s),realValueToDisplayValue:s=>s<0?-C_(Math.abs(s)):C_(s),displayValueToRealValue:s=>s<0?-k0(Math.abs(s)):k0(s),realValueToValue:s=>s<0?-C_(Math.abs(s)):C_(s),createRange:({defaultRange:s})=>{const{from:e,to:t,range:n}=s,o=e<0?-k0(Math.abs(e)):k0(e),r=t<0?-k0(Math.abs(t)):k0(t);return{from:e,to:t,range:n,realFrom:o,realTo:r,realRange:r-o,displayFrom:e,displayTo:t,displayRange:n}}},Iw={normal:E_.extend(D9),percentage:E_.extend(R9),logarithm:E_.extend(j9)};function B9(s){return Iw[s]??Iw.normal}class w5{constructor(e,t){Pe(this,"_container");Pe(this,"_id");Pe(this,"_chart");Pe(this,"_bounding",Uy());Pe(this,"_originalBounding",Uy());Pe(this,"_visible",!0);this._chart=e,this._id=t,this._container=l0("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._container.classList.add("dutycharts-pane",`dutycharts-pane-${t}`),this._container.setAttribute("data-pane-id",t)}getContainer(){return this._container}setVisible(e){this._visible!==e&&(this._container.style.display=e?"block":"none",this._visible=e)}getVisible(){return this._visible}getId(){return this._id}getChart(){return this._chart}getBounding(){return this._bounding}setOriginalBounding(e){Bh(this._originalBounding,e)}getOriginalBounding(){return this._originalBounding}update(e){this._bounding.height!==this._container.clientHeight&&(this._container.style.height=`${this._bounding.height}px`),this.updateImp(e??zf.Drawer,this._container,this._bounding)}}class k5 extends w5{constructor(t,n,o){super(t,n);Pe(this,"_mainWidget");Pe(this,"_yAxisWidget",null);Pe(this,"_yAxisLabelSlots",[]);Pe(this,"_yAxisBaseLabelSlots",[]);Pe(this,"_axis");Pe(this,"_options",{id:"",minHeight:Cy,dragEnabled:!0,order:0,height:i5,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}});const r=this.getContainer();this._mainWidget=this.createMainWidget(r),this._yAxisWidget=this.createYAxisWidget(r),this.setOptions(o)}setOptions(t){var a,l,c;const n=this.getId();if(n===yd.CANDLE||n===yd.X_AXIS){const f=(a=t.axis)==null?void 0:a.name;(!Rn(this._axis)||Rn(f)&&this._options.axis.name!==f)&&(this._axis=this.createAxisComponent(f??"normal"))}else Rn(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof E_&&this._axis.setAutoCalcTickFlag(!0),Bh(this._options,t),this._axis.override({...this._options.axis,name:((l=t.axis)==null?void 0:l.name)??"normal"});let o=null,r="default";return this.getId()===yd.X_AXIS?(o=this.getMainWidget().getContainer(),r="ew-resize"):(o=this.getYAxisWidget().getContainer(),r="ns-resize"),((c=t.axis)==null?void 0:c.scrollZoomEnabled)??!0?o.style.cursor=r:o.style.cursor="default",this}getOptions(){return this._options}getAxisComponent(){return this._axis}setBounding(t,n,o,r){Bh(this.getBounding(),t);const a={};Rn(t.height)&&(a.height=t.height),Rn(t.top)&&(a.top=t.top),this._mainWidget.setBounding(a);const l=Rn(n);return l&&this._mainWidget.setBounding(n),Rn(this._yAxisWidget)&&(this._yAxisWidget.setBounding(a),this._axis.position==="left"?Rn(o)&&this._yAxisWidget.setBounding({...o,left:0}):Rn(r)&&(this._yAxisWidget.setBounding(r),l&&this._yAxisWidget.setBounding({left:(n.left??0)+(n.width??0)+(n.right??0)-(r.width??0)}))),this}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}resetYAxisLabelSlots(){this._yAxisLabelSlots=[],this._yAxisBaseLabelSlots=[]}commitYAxisLabelSlots(){this._yAxisBaseLabelSlots=this._yAxisLabelSlots.map(t=>({top:t.top,bottom:t.bottom}))}resetYAxisOverlaySlots(){this._yAxisLabelSlots=this._yAxisBaseLabelSlots.map(t=>({top:t.top,bottom:t.bottom}))}placeYAxisLabel(t,n,o){const r=n/2,a=r,l=o-r;if(!Number.isFinite(a)||!Number.isFinite(l)||a>l)return null;const c=2,f=this._yAxisLabelSlots.map(x=>({start:x.top-c-r,end:x.bottom+c+r})).sort((x,S)=>x.start-S.start),u=[];f.forEach(x=>{const S=Math.max(x.start,a),C=Math.min(x.end,l);if(C<=a||S>=l)return;const I=u[u.length-1];I&&S<=I.end?I.end=Math.max(I.end,C):u.push({start:S,end:C})});const d=[];let h=a;if(u.forEach(x=>{x.start>h&&d.push({start:h,end:x.start}),h=Math.max(h,x.end)}),h<l&&d.push({start:h,end:l}),d.length===0)return null;let p=null,v=Number.POSITIVE_INFINITY;return d.forEach(x=>{let S=t;S<x.start&&(S=x.start),S>x.end&&(S=x.end);const C=Math.abs(S-t);C<v&&(v=C,p=S)}),p===null?null:(this._yAxisLabelSlots.push({top:p-r,bottom:p+r}),p)}updateImp(t){var n;this._mainWidget.update(t),(n=this._yAxisWidget)==null||n.update(t)}destroy(){var t;this._mainWidget.destroy(),(t=this._yAxisWidget)==null||t.destroy()}getImage(t){const{width:n,height:o}=this.getBounding(),r=l0("canvas",{width:`${n}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=E0(r);r.width=n*l,r.height=o*l,a.scale(l,l);const c=this._mainWidget.getBounding();if(a.drawImage(this._mainWidget.getImage(t),c.left,0,c.width,c.height),this._yAxisWidget!==null){const f=this._yAxisWidget.getBounding();a.drawImage(this._yAxisWidget.getImage(t),f.left,0,f.width,f.height)}return r}createYAxisWidget(t){return null}}class S5 extends k5{createAxisComponent(e){const t=B9(e??"default");return new t(this)}createMainWidget(e){return new v5(e,this)}createYAxisWidget(e){return new F9(e,this)}}class O9 extends S5{createMainWidget(e){return new M9(e,this)}}class z9 extends _5{drawImp(e,t){var f,u,d;const n=this.getWidget(),o=n.getPane(),r=n.getBounding(),a=o.getAxisComponent(),l=this.getAxisStyles(o.getChart().getStyles());if(!l.show||(l.axisLine.show&&((f=this.createFigure({name:"line",attrs:this.createAxisLine(r,l),styles:l.axisLine}))==null||f.draw(e)),t[0]))return;const c=a.getTicks();if(l.ticduty.show&&this.createTicdutys(c,r,l).forEach(p=>{var v;(v=this.createFigure({name:"line",attrs:p,styles:l.ticduty}))==null||v.draw(e)}),l.tickText.show){const h=this.createTickTexts(c,r,l),p=h.filter((x,S)=>{var C;return(C=c[S])==null?void 0:C.isYear}),v=h.filter((x,S)=>{var C;return!((C=c[S])!=null&&C.isYear)});v.length>0&&((u=this.createFigure({name:"text",attrs:v,styles:l.tickText}))==null||u.draw(e)),p.length>0&&((d=this.createFigure({name:"text",attrs:p,styles:{...l.tickText,weight:"600"}}))==null||d.draw(e))}}getAxisStyles(e){return e.xAxis}createAxisLine(e){return{coordinates:[{x:0,y:0},{x:e.width,y:0}]}}createTicdutys(e,t,n){const o=n.ticduty,r=n.axisLine.size;return e.map(a=>({coordinates:[{x:a.coord,y:0},{x:a.coord,y:r+o.length}]}))}createTickTexts(e,t,n){const o=n.tickText,r=n.axisLine.size,a=n.ticduty.length;return e.map(l=>({x:l.coord,y:r+a+o.marginStart+(l.textOffset??0),text:l.text,align:"center",baseline:"top"}))}}class V9 extends y5{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()}getProgressOverlay(){var e;return((e=this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo())==null?void 0:e.overlay)??null}getDefaultFigures(e,t){var c;const n=[],o=this.getWidget(),a=o.getPane().getChart().getChartStore(),l=a.getClickOverlayInfo();if(e.needDefaultXAxisFigure&&e.id===((c=l.overlay)==null?void 0:c.id)){let f=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;t.forEach((d,h)=>{f=Math.min(f,d.x),u=Math.max(u,d.x);const p=e.points[h];if(ul(p.timestamp)){const v=a.getInnerFormatter().formatDate(p.timestamp,"YYYY-MM-DD HH:mm","crosshair");n.push({type:"text",attrs:{x:d.x,y:0,text:v,align:"center"},ignoreEvent:!0})}}),t.length>1&&n.unshift({type:"rect",attrs:{x:f,y:0,width:u-f,height:o.getBounding().height},ignoreEvent:!0})}return n}getFigures(e,t){var f;const n=this.getWidget(),o=n.getPane(),r=o.getChart(),a=o.getAxisComponent(),l=r.getXAxisPane().getAxisComponent(),c=n.getBounding();return((f=e.createXAxisFigures)==null?void 0:f.call(e,{chart:r,overlay:e,coordinates:t,bounding:c,xAxis:l,yAxis:a}))??[]}}class W9 extends b5{drawImp(e){var a;const t=this.getWidget(),n=t.getPane().getChart().getChartStore(),o=n.getCrosshair(),r=n.getStyles().crosshair;if(r.show){const l=this.getDirectionStyles(r),c=l.text;if(l.show&&c.show&&this.compare(o)){const f=t.getBounding(),u=t.getPane().getAxisComponent(),d=this.getText(o,n),h=n.getStyles().xAxis.tickText,p={...c,size:h.size,family:h.family,weight:h.weight};e.font=r0(p.size,p.weight,p.family),(a=this.createFigure({name:"text",attrs:this.getTextAttrs(d,e.measureText(d).width,o,f,u,p),styles:p}))==null||a.draw(e)}}}compare(e){return Rn(e.timestamp)}getDirectionStyles(e){return e.vertical}getText(e,t){var o;const n=e.timestamp;return t.getInnerFormatter().formatDate(n,g5[((o=t.getPeriod())==null?void 0:o.type)??"day"],"crosshair")}getTextAttrs(e,t,n,o,r,a){const c=this.getWidget().getPane().getChart().getStyles().xAxis,f=c.axisLine.size,u=c.ticduty.length,d=f+u+c.tickText.marginStart-(a.paddingTop??0),h=n.realX;let p=0,v="center";return h-t/2-a.paddingLeft<0?(p=0,v="left"):h+t/2+a.paddingRight>o.width?(p=o.width,v="right"):p=h,{x:p,y:d,text:e,align:v,baseline:"top"}}}class H9 extends Sx{constructor(t,n){super(t,n);Pe(this,"_xAxisView",new z9(this));Pe(this,"_overlayXAxisView",new V9(this));Pe(this,"_crosshairVerticalLabelView",new W9(this));this.setCursor("ew-resize"),this.addChild(this._overlayXAxisView)}getName(){return id.X_AXIS}updateMain(t){this._xAxisView.draw(t)}updateUnderlay(t){}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}var o0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function R1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var C5={exports:{}};(function(s,e){(function(t,n){s.exports=n()})(o0,function(){var t=1e3,n=6e4,o=36e5,r="millisecond",a="second",l="minute",c="hour",f="day",u="week",d="month",h="quarter",p="year",v="date",x="Invalid Date",S=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,C=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,I={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(te){var le=["th","st","nd","rd"],pe=te%100;return"["+te+(le[(pe-20)%10]||le[pe]||le[0])+"]"}},A=function(te,le,pe){var re=String(te);return!re||re.length>=le?te:""+Array(le+1-re.length).join(pe)+te},P={s:A,z:function(te){var le=-te.utcOffset(),pe=Math.abs(le),re=Math.floor(pe/60),xe=pe%60;return(le<=0?"+":"-")+A(re,2,"0")+":"+A(xe,2,"0")},m:function te(le,pe){if(le.date()<pe.date())return-te(pe,le);var re=12*(pe.year()-le.year())+(pe.month()-le.month()),xe=le.clone().add(re,d),se=pe-xe<0,Ne=le.clone().add(re+(se?-1:1),d);return+(-(re+(pe-xe)/(se?xe-Ne:Ne-xe))||0)},a:function(te){return te<0?Math.ceil(te)||0:Math.floor(te)},p:function(te){return{M:d,y:p,w:u,d:f,D:v,h:c,m:l,s:a,ms:r,Q:h}[te]||String(te||"").toLowerCase().replace(/s$/,"")},u:function(te){return te===void 0}},T="en",j={};j[T]=I;var E="$isDayjsObject",L=function(te){return te instanceof de||!(!te||!te[E])},D=function te(le,pe,re){var xe;if(!le)return T;if(typeof le=="string"){var se=le.toLowerCase();j[se]&&(xe=se),pe&&(j[se]=pe,xe=se);var Ne=le.split("-");if(!xe&&Ne.length>1)return te(Ne[0])}else{var Te=le.name;j[Te]=le,xe=Te}return!re&&xe&&(T=xe),xe||!re&&T},X=function(te,le){if(L(te))return te.clone();var pe=typeof le=="object"?le:{};return pe.date=te,pe.args=arguments,new de(pe)},ne=P;ne.l=D,ne.i=L,ne.w=function(te,le){return X(te,{locale:le.$L,utc:le.$u,x:le.$x,$offset:le.$offset})};var de=function(){function te(pe){this.$L=D(pe.locale,null,!0),this.parse(pe),this.$x=this.$x||pe.x||{},this[E]=!0}var le=te.prototype;return le.parse=function(pe){this.$d=function(re){var xe=re.date,se=re.utc;if(xe===null)return new Date(NaN);if(ne.u(xe))return new Date;if(xe instanceof Date)return new Date(xe);if(typeof xe=="string"&&!/Z$/i.test(xe)){var Ne=xe.match(S);if(Ne){var Te=Ne[2]-1||0,Me=(Ne[7]||"0").substring(0,3);return se?new Date(Date.UTC(Ne[1],Te,Ne[3]||1,Ne[4]||0,Ne[5]||0,Ne[6]||0,Me)):new Date(Ne[1],Te,Ne[3]||1,Ne[4]||0,Ne[5]||0,Ne[6]||0,Me)}}return new Date(xe)}(pe),this.init()},le.init=function(){var pe=this.$d;this.$y=pe.getFullYear(),this.$M=pe.getMonth(),this.$D=pe.getDate(),this.$W=pe.getDay(),this.$H=pe.getHours(),this.$m=pe.getMinutes(),this.$s=pe.getSeconds(),this.$ms=pe.getMilliseconds()},le.$utils=function(){return ne},le.isValid=function(){return this.$d.toString()!==x},le.isSame=function(pe,re){var xe=X(pe);return this.startOf(re)<=xe&&xe<=this.endOf(re)},le.isAfter=function(pe,re){return X(pe)<this.startOf(re)},le.isBefore=function(pe,re){return this.endOf(re)<X(pe)},le.$g=function(pe,re,xe){return ne.u(pe)?this[re]:this.set(xe,pe)},le.unix=function(){return Math.floor(this.valueOf()/1e3)},le.valueOf=function(){return this.$d.getTime()},le.startOf=function(pe,re){var xe=this,se=!!ne.u(re)||re,Ne=ne.p(pe),Te=function(Ht,Ft){var zt=ne.w(xe.$u?Date.UTC(xe.$y,Ft,Ht):new Date(xe.$y,Ft,Ht),xe);return se?zt:zt.endOf(f)},Me=function(Ht,Ft){return ne.w(xe.toDate()[Ht].apply(xe.toDate("s"),(se?[0,0,0,0]:[23,59,59,999]).slice(Ft)),xe)},De=this.$W,Oe=this.$M,Ke=this.$D,kt="set"+(this.$u?"UTC":"");switch(Ne){case p:return se?Te(1,0):Te(31,11);case d:return se?Te(1,Oe):Te(0,Oe+1);case u:var pt=this.$locale().weekStart||0,Rt=(De<pt?De+7:De)-pt;return Te(se?Ke-Rt:Ke+(6-Rt),Oe);case f:case v:return Me(kt+"Hours",0);case c:return Me(kt+"Minutes",1);case l:return Me(kt+"Seconds",2);case a:return Me(kt+"Milliseconds",3);default:return this.clone()}},le.endOf=function(pe){return this.startOf(pe,!1)},le.$set=function(pe,re){var xe,se=ne.p(pe),Ne="set"+(this.$u?"UTC":""),Te=(xe={},xe[f]=Ne+"Date",xe[v]=Ne+"Date",xe[d]=Ne+"Month",xe[p]=Ne+"FullYear",xe[c]=Ne+"Hours",xe[l]=Ne+"Minutes",xe[a]=Ne+"Seconds",xe[r]=Ne+"Milliseconds",xe)[se],Me=se===f?this.$D+(re-this.$W):re;if(se===d||se===p){var De=this.clone().set(v,1);De.$d[Te](Me),De.init(),this.$d=De.set(v,Math.min(this.$D,De.daysInMonth())).$d}else Te&&this.$d[Te](Me);return this.init(),this},le.set=function(pe,re){return this.clone().$set(pe,re)},le.get=function(pe){return this[ne.p(pe)]()},le.add=function(pe,re){var xe,se=this;pe=Number(pe);var Ne=ne.p(re),Te=function(Oe){var Ke=X(se);return ne.w(Ke.date(Ke.date()+Math.round(Oe*pe)),se)};if(Ne===d)return this.set(d,this.$M+pe);if(Ne===p)return this.set(p,this.$y+pe);if(Ne===f)return Te(1);if(Ne===u)return Te(7);var Me=(xe={},xe[l]=n,xe[c]=o,xe[a]=t,xe)[Ne]||1,De=this.$d.getTime()+pe*Me;return ne.w(De,this)},le.subtract=function(pe,re){return this.add(-1*pe,re)},le.format=function(pe){var re=this,xe=this.$locale();if(!this.isValid())return xe.invalidDate||x;var se=pe||"YYYY-MM-DDTHH:mm:ssZ",Ne=ne.z(this),Te=this.$H,Me=this.$m,De=this.$M,Oe=xe.weekdays,Ke=xe.months,kt=xe.meridiem,pt=function(Ft,zt,ut,nt){return Ft&&(Ft[zt]||Ft(re,se))||ut[zt].slice(0,nt)},Rt=function(Ft){return ne.s(Te%12||12,Ft,"0")},Ht=kt||function(Ft,zt,ut){var nt=Ft<12?"AM":"PM";return ut?nt.toLowerCase():nt};return se.replace(C,function(Ft,zt){return zt||function(ut){switch(ut){case"YY":return String(re.$y).slice(-2);case"YYYY":return ne.s(re.$y,4,"0");case"M":return De+1;case"MM":return ne.s(De+1,2,"0");case"MMM":return pt(xe.monthsShort,De,Ke,3);case"MMMM":return pt(Ke,De);case"D":return re.$D;case"DD":return ne.s(re.$D,2,"0");case"d":return String(re.$W);case"dd":return pt(xe.weekdaysMin,re.$W,Oe,2);case"ddd":return pt(xe.weekdaysShort,re.$W,Oe,3);case"dddd":return Oe[re.$W];case"H":return String(Te);case"HH":return ne.s(Te,2,"0");case"h":return Rt(1);case"hh":return Rt(2);case"a":return Ht(Te,Me,!0);case"A":return Ht(Te,Me,!1);case"m":return String(Me);case"mm":return ne.s(Me,2,"0");case"s":return String(re.$s);case"ss":return ne.s(re.$s,2,"0");case"SSS":return ne.s(re.$ms,3,"0");case"Z":return Ne}return null}(Ft)||Ne.replace(":","")})},le.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},le.diff=function(pe,re,xe){var se,Ne=this,Te=ne.p(re),Me=X(pe),De=(Me.utcOffset()-this.utcOffset())*n,Oe=this-Me,Ke=function(){return ne.m(Ne,Me)};switch(Te){case p:se=Ke()/12;break;case d:se=Ke();break;case h:se=Ke()/3;break;case u:se=(Oe-De)/6048e5;break;case f:se=(Oe-De)/864e5;break;case c:se=Oe/o;break;case l:se=Oe/n;break;case a:se=Oe/t;break;default:se=Oe}return xe?se:ne.a(se)},le.daysInMonth=function(){return this.endOf(d).$D},le.$locale=function(){return j[this.$L]},le.locale=function(pe,re){if(!pe)return this.$L;var xe=this.clone(),se=D(pe,re,!0);return se&&(xe.$L=se),xe},le.clone=function(){return ne.w(this.$d,this)},le.toDate=function(){return new Date(this.valueOf())},le.toJSON=function(){return this.isValid()?this.toISOString():null},le.toISOString=function(){return this.$d.toISOString()},le.toString=function(){return this.$d.toUTCString()},te}(),ie=de.prototype;return X.prototype=ie,[["$ms",r],["$s",a],["$m",l],["$H",c],["$W",f],["$M",d],["$y",p],["$D",v]].forEach(function(te){ie[te[1]]=function(le){return this.$g(le,te[0],te[1])}}),X.extend=function(te,le){return te.$i||(te(le,de,X),te.$i=!0),X},X.locale=D,X.isDayjs=L,X.unix=function(te){return X(1e3*te)},X.en=j[T],X.Ls=j,X.p={},X})})(C5);var q9=C5.exports;const xp=R1(q9);var I5={exports:{}};(function(s,e){(function(t,n){s.exports=n()})(o0,function(){var t="minute",n=/[+-]\d\d(?::?\d\d)?/g,o=/([+-]|\d\d)/g;return function(r,a,l){var c=a.prototype;l.utc=function(x){var S={date:x,utc:!0,args:arguments};return new a(S)},c.utc=function(x){var S=l(this.toDate(),{locale:this.$L,utc:!0});return x?S.add(this.utcOffset(),t):S},c.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var f=c.parse;c.parse=function(x){x.utc&&(this.$u=!0),this.$utils().u(x.$offset)||(this.$offset=x.$offset),f.call(this,x)};var u=c.init;c.init=function(){if(this.$u){var x=this.$d;this.$y=x.getUTCFullYear(),this.$M=x.getUTCMonth(),this.$D=x.getUTCDate(),this.$W=x.getUTCDay(),this.$H=x.getUTCHours(),this.$m=x.getUTCMinutes(),this.$s=x.getUTCSeconds(),this.$ms=x.getUTCMilliseconds()}else u.call(this)};var d=c.utcOffset;c.utcOffset=function(x,S){var C=this.$utils().u;if(C(x))return this.$u?0:C(this.$offset)?d.call(this):this.$offset;if(typeof x=="string"&&(x=function(T){T===void 0&&(T="");var j=T.match(n);if(!j)return null;var E=(""+j[0]).match(o)||["-",0,0],L=E[0],D=60*+E[1]+ +E[2];return D===0?0:L==="+"?D:-D}(x),x===null))return this;var I=Math.abs(x)<=16?60*x:x,A=this;if(S)return A.$offset=I,A.$u=x===0,A;if(x!==0){var P=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(A=this.local().add(I+P,t)).$offset=I,A.$x.$localOffset=P}else A=this.utc();return A};var h=c.format;c.format=function(x){var S=x||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,S)},c.valueOf=function(){var x=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*x},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var p=c.toDate;c.toDate=function(x){return x==="s"&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():p.call(this)};var v=c.diff;c.diff=function(x,S,C){if(x&&this.$u===x.$u)return v.call(this,x,S,C);var I=this.local(),A=l(x).local();return v.call(I,A,S,C)}}})})(I5);var U9=I5.exports;const Mx=R1(U9);var P5={exports:{}};(function(s,e){(function(t,n){s.exports=n()})(o0,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},n={};return function(o,r,a){var l,c=function(h,p,v){v===void 0&&(v={});var x=new Date(h),S=function(C,I){I===void 0&&(I={});var A=I.timeZoneName||"short",P=C+"|"+A,T=n[P];return T||(T=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:C,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:A}),n[P]=T),T}(p,v);return S.formatToParts(x)},f=function(h,p){for(var v=c(h,p),x=[],S=0;S<v.length;S+=1){var C=v[S],I=C.type,A=C.value,P=t[I];P>=0&&(x[P]=parseInt(A,10))}var T=x[3],j=T===24?0:T,E=x[0]+"-"+x[1]+"-"+x[2]+" "+j+":"+x[4]+":"+x[5]+":000",L=+h;return(a.utc(E).valueOf()-(L-=L%1e3))/6e4},u=r.prototype;u.tz=function(h,p){h===void 0&&(h=l);var v,x=this.utcOffset(),S=this.toDate(),C=S.toLocaleString("en-US",{timeZone:h}),I=Math.round((S-new Date(C))/1e3/60),A=15*-Math.round(S.getTimezoneOffset()/15)-I;if(!Number(A))v=this.utcOffset(0,p);else if(v=a(C,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(A,!0),p){var P=v.utcOffset();v=v.add(x-P,"minute")}return v.$x.$timezone=h,v},u.offsetName=function(h){var p=this.$x.$timezone||a.tz.guess(),v=c(this.valueOf(),p,{timeZoneName:h}).find(function(x){return x.type.toLowerCase()==="timezonename"});return v&&v.value};var d=u.startOf;u.startOf=function(h,p){if(!this.$x||!this.$x.$timezone)return d.call(this,h,p);var v=a(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return d.call(v,h,p).tz(this.$x.$timezone,!0)},a.tz=function(h,p,v){var x=v&&p,S=v||p||l,C=f(+a(),S);if(typeof h!="string")return a(h).tz(S);var I=function(j,E,L){var D=j-60*E*1e3,X=f(D,L);if(E===X)return[D,E];var ne=f(D-=60*(X-E)*1e3,L);return X===ne?[D,X]:[j-60*Math.min(X,ne)*1e3,Math.max(X,ne)]}(a.utc(h,x).valueOf(),C,S),A=I[0],P=I[1],T=a(A).utcOffset(P);return T.$x.$timezone=S,T},a.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},a.tz.setDefault=function(h){l=h}}})})(P5);var G9=P5.exports;const Nx=R1(G9);xp.extend(Mx);xp.extend(Nx);const Gy=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Yy=["minute","hour","day","month","year"],R2={minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,year:365*24*60*60*1e3},Pw={minute:[1,2,5,10,15,30],hour:[1,2,3,4,6,8,12],day:[1],month:[1],year:[1]},X1={year:"2024",month:"Sep",day:"30",time:"00:00"};function f1(s){const e=Yy.indexOf(s);return e===-1?0:e}function Y9(s){return Yy.includes(s)?s:"minute"}function K9(s){switch(s){case"hour":return"hour";case"day":case"week":return"day";case"month":return"month";case"year":return"year";case"minute":case"second":default:return"minute"}}function M5(s){const e=Number((s==null?void 0:s.size)??12);return Math.max(6,Math.round(e*.45))}function X9(s,e){const t=s(X1.year,e),n=s(X1.month,e),o=s(X1.day,e),r=s(X1.time,e),a=M5(e);return{padding:a,minLabelPxByUnit:{minute:r+a,hour:r+a,day:Math.max(o,n,t)+a,month:Math.max(n,t)+a,year:t+a}}}function Z9(s,e,t,n){const o=n.targetPx,r=n.minPx,a=n.maxPx,l=f1(e);let c=null;for(let d=l;d<Yy.length;d++){const h=Yy[d],p=Pw[h],v=R2[h],x=Math.max(t[h],r);let S=null,C=Number.POSITIVE_INFINITY,I=!1;if(p.forEach(A=>{const P=v*A*s;if(P<x)return;const T=P>=r&&P<=a,j=Math.abs(P-o);(T&&(!I||j<C)||!I&&j<C)&&(S=A,C=j,I=T)}),S!==null){if(I)return{unit:h,step:S,minLabelPx:x};c||(c={unit:h,step:S,minLabelPx:x})}}if(c)return c;const f="year",u=Pw[f];return{unit:f,step:u[u.length-1],minLabelPx:Math.max(t[f],r)}}function J9(s,e,t,n,o,r){if(!s)return e;const a=f1(o);if(f1(s.unit)<a)return e;const l=r.hysteresis,c=s.unit,f=e.unit,u=R2[c]*s.step*t,d=R2[f]*e.step*t,h=Math.max(n[c],r.minPx),p=Math.max(n[f],r.minPx),v=f1(c),x=f1(f),S=r.minPx,C=r.maxPx,I=u>=S*(1-l)&&u<=C*(1+l);if(x>v){if(u>=h*(1-l)&&I)return{...s,minLabelPx:h}}else if(x<v){if(d<p*(1+l)&&I)return{...s,minLabelPx:h}}else if(e.step!==s.step&&u>=Math.max(h,S)*(1-l)&&u<=Math.max(h,S)*(1+l))return{...s,minLabelPx:h};return e}function Mw(s){const e=s.date(),t=s.month();return e===1?t===0?String(s.year()):Gy[t]:String(e)}function Q9(s,e){switch(e){case"year":return{text:String(s.year()),isMajor:!0,isYear:!0};case"month":return s.month()===0?{text:String(s.year()),isMajor:!0,isYear:!0}:{text:Gy[s.month()],isMajor:!1,isYear:!1};case"day":{const t=s.date();return t===1?s.month()===0?{text:String(s.year()),isMajor:!0,isYear:!0}:{text:Mw(s),isMajor:!0,isYear:!1}:{text:String(t),isMajor:!1,isYear:!1}}case"hour":case"minute":return s.hour()===0&&s.minute()===0?s.date()===1&&s.month()===0?{text:String(s.year()),isMajor:!0,isYear:!0}:{text:Mw(s),isMajor:!0,isYear:!1}:{text:s.format("HH:mm"),isMajor:!1,isYear:!1};default:return{text:"",isMajor:!1,isYear:!1}}}function eI(s,e,t,n){if(n&&e.isYearBoundary)return{text:String(s.year()),isMajor:!0,isYear:!0,labelType:"year"};if(n&&e.isMonthBoundary)return{text:Gy[s.month()],isMajor:!0,isYear:!1,labelType:"month"};if(n&&e.isDayBoundary&&(t.unit==="hour"||t.unit==="minute"))return{text:String(s.date()),isMajor:!0,isYear:!1,labelType:"day"};if(n&&t.unit==="year"&&!e.isYearBoundary)return{text:Gy[s.month()],isMajor:!1,isYear:!1,labelType:"fallback-month"};if(n&&t.unit==="month"&&!e.isMonthBoundary)return{text:String(s.date()),isMajor:!1,isYear:!1,labelType:"fallback-day"};const o=Q9(s,t.unit);return o.text?{text:o.text,isMajor:o.isMajor,isYear:o.isYear,labelType:t.unit}:{text:"",isMajor:!1,isYear:!1,labelType:""}}function tI(s,e,t){return Number.isFinite(s)?s<-t||s>e+t:!0}function sI({from:s,to:e,width:t,textStyles:n,measureText:o,minUnit:r,prevState:a,gridTargetPx:l=60,gridMinPx:c=45,gridMaxPx:f=75,gridHysteresis:u=.15,pxPerMsOverride:d}){if(!Number.isFinite(s)||!Number.isFinite(e)||!Number.isFinite(t)||t<=0)return{state:a??null,padding:0,pxPerMs:0};const h=Math.min(s,e),p=Math.max(s,e),v=Math.max(1,p-h),x=Number.isFinite(d)?d:t/v,S=Y9(r??"minute"),{padding:C,minLabelPxByUnit:I}=X9(o,n),A={targetPx:l,minPx:c,maxPx:f,hysteresis:u},P=Z9(x,S,I,A);return{state:J9(a,P,x,I,S,A),padding:C,pxPerMs:x}}function nI({ticks:s,timezone:e,width:t,textStyles:n,measureText:o,state:r,paddingOverride:a}){if(!r||!Array.isArray(s)||s.length===0)return s;const l=e||xp.tz.guess(),c=typeof a=="number"?a:M5(n);s.sort((u,d)=>u.coord-d.coord),s.forEach(u=>{u.text="",u.textOffset=0,u.isMajor=!1,u.isYear=!1});let f=s.some(u=>u.isYearBoundary||u.isMonthBoundary||u.isDayBoundary);if(!f){s.forEach(d=>{d.isYearBoundary=!1,d.isMonthBoundary=!1,d.isDayBoundary=!1});let u=null;s.forEach(d=>{const h=d.value;if(!Number.isFinite(h))return;const p=xp.tz(h,l),v={year:p.year(),month:p.month(),day:p.date()};u&&(v.year!==u.year?(d.isYearBoundary=!0,d.isMonthBoundary=!0,d.isDayBoundary=!0):v.month!==u.month?(d.isMonthBoundary=!0,d.isDayBoundary=!0):v.day!==u.day&&(d.isDayBoundary=!0)),u=v}),f=s.some(d=>d.isYearBoundary||d.isMonthBoundary||d.isDayBoundary)}return s.forEach(u=>{const d=u.value;if(!Number.isFinite(d)||tI(u.coord,t,c))return;const h=xp.tz(d,l),p=eI(h,u,r,f);p.text&&(u.text=p.text,u.textOffset=0,u.isMajor=p.isMajor,u.isYear=p.isYear)}),s}class Ax extends x5{constructor(t,n){super(t);Pe(this,"_timeAxisState",null);this.override(n)}override(t){const{name:n,scrollZoomEnabled:o,createTicks:r}=t;Mf(this.name)||(this.name=n),this.scrollZoomEnabled=o??this.scrollZoomEnabled,this.createTicks=r??this.createTicks}createRangeImp(){const n=this.getParent().getChart().getChartStore().getVisibleRange(),{realFrom:o,realTo:r}=n,a=o,l=r,c=r-o+1;return{from:a,to:l,range:c,realFrom:a,realTo:l,realRange:c,displayFrom:a,displayTo:l,displayRange:c}}createTicksImp(){const{realFrom:t,realTo:n}=this.getRange(),o=this.getParent().getChart().getChartStore(),r=o.getPeriod(),a=o.getStyles().xAxis.tickText,l=this.getBounding().width,c=o.dataIndexToTimestamp(t),f=o.dataIndexToTimestamp(n);if(!ul(c)||!ul(f)||l<=0)return[];const u=o.getBarSpace().bar,d=oI(r),h=ul(d)&&d>0?u/d:void 0,p=K9(r==null?void 0:r.type),v=60,x=50,S=140,I=sI({from:c,to:f,width:l,textStyles:a,minUnit:p,prevState:this._timeAxisState,gridTargetPx:v,gridMinPx:x,gridMaxPx:S,gridHysteresis:.15,pxPerMsOverride:h,measureText:T=>tm(T,a.size,a.weight,a.family)});this._timeAxisState=I.state;const A=[],P=o.getDateTimeFormat();return iI({ticks:A,barSpace:u,chartStore:o,dateTimeFormat:P,state:I.state,width:l,fromTimestamp:c,toTimestamp:f,gridMinPx:x,gridMaxPx:S}),lI({ticks:A,chartStore:o,barSpace:u,width:l,minSpacingPx:Math.max(50,x),gapThresholdPx:Math.max(90,x*1.6),targetSpacingPx:Math.max(60,v)}),nI({ticks:A,timezone:o.getTimezone(),width:l,textStyles:a,measureText:T=>tm(T,a.size,a.weight,a.family),state:I.state,paddingOverride:I.padding}),cv(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:A}):A}getAutoSize(){const t=this.getParent().getChart().getStyles(),n=t.xAxis,o=n.size;if(o!=="auto")return o;const r=t.crosshair;let a=0;n.show&&(n.axisLine.show&&(a+=n.axisLine.size),n.ticduty.show&&(a+=n.ticduty.length),n.tickText.show&&(a+=n.tickText.marginStart+n.tickText.marginEnd+n.tickText.size));let l=0;return r.show&&r.vertical.show&&r.vertical.text.show&&(l+=r.vertical.text.paddingTop+r.vertical.text.paddingBottom+r.vertical.text.borderSize*2+r.vertical.text.size),Math.max(a,l)}getBounding(){return this.getParent().getMainWidget().getBounding()}convertTimestampFromPixel(t){const n=this.getParent().getChart().getChartStore(),o=n.coordinateToDataIndex(t);return n.dataIndexToTimestamp(o)}convertTimestampToPixel(t){const n=this.getParent().getChart().getChartStore(),o=n.timestampToDataIndex(t);return n.dataIndexToCoordinate(o)}convertFromPixel(t){return this.getParent().getChart().getChartStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(t)}static extend(t){class n extends Ax{constructor(r){super(r,t)}}return n}}function oI(s){if(!s||!ul(s.span))return 0;const e=s.span;switch(s.type){case"second":return e*1e3;case"minute":return e*60*1e3;case"hour":return e*60*60*1e3;case"day":return e*24*60*60*1e3;case"week":return e*7*24*60*60*1e3;case"month":return e*30*24*60*60*1e3;case"year":return e*365*24*60*60*1e3;default:return 0}}function Nw(s,e){const t=Y6(e,s),n=Number(t.YYYY),o=Number(t.MM),r=Number(t.DD);return{year:Number.isFinite(n)?n:0,month:Number.isFinite(o)?o:0,day:Number.isFinite(r)?r:0}}function Tx(s,e,t){const n=s.getDataByDataIndex(e);if(!n||!ul(n.timestamp))return null;const o=Nw(n.timestamp,t),r=s.getDataByDataIndex(e-1);let a=!1,l=!1,c=!1;if(r&&ul(r.timestamp)){const f=Nw(r.timestamp,t);o.year!==f.year?(a=!0,l=!0,c=!0):o.month!==f.month?(l=!0,c=!0):o.day!==f.day&&(c=!0)}else a=!0,l=!0,c=!0;return{timestamp:n.timestamp,isYearBoundary:a,isMonthBoundary:l,isDayBoundary:c}}xp.extend(Mx);xp.extend(Nx);function iI({ticks:s,barSpace:e,chartStore:t,dateTimeFormat:n,state:o,width:r,fromTimestamp:a,toTimestamp:l,gridMinPx:c,gridMaxPx:f}){var D,X,ne;if(!o)return;const u=t.getDataList();if(!Array.isArray(u)||u.length===0)return;const d=(D=u[0])==null?void 0:D.timestamp,h=(X=u[u.length-1])==null?void 0:X.timestamp,p=Math.min(a,l),v=Math.max(a,l);if(!Number.isFinite(p)||!Number.isFinite(v)||p>v)return;const x=o.unit,S=o.step,C=t.getTimezone()||xp.tz.guess();let I=uI(xp.tz(p,C),x,S);const A=xp.tz(v,C).add(S,x).valueOf(),P=Math.max(50,c),T=Math.max(r,e);let j=null,E=null,L=-1;for(;I.valueOf()<=A;){const de=I.valueOf(),ie=A5({boundaryTs:de,dataList:u,firstTs:d,lastTs:h,chartStore:t});if(ie){const te=ie.index;if(j===null||te!==j){const le=t.dataIndexToCoordinate(te);if(le>=-T&&le<=r+T){const pe=ie.fromData?Tx(t,te,n):N5(de,x,C),re=t.dataIndexToTimestamp(te)??((ne=u[te])==null?void 0:ne.timestamp);if(ul(re)){const xe=rI(pe),se=E===null||Math.abs(le-E)>=P;!se&&xe>L?(s.pop(),s.push({coord:le,value:re,text:"",isYearBoundary:(pe==null?void 0:pe.isYearBoundary)??!1,isMonthBoundary:(pe==null?void 0:pe.isMonthBoundary)??!1,isDayBoundary:(pe==null?void 0:pe.isDayBoundary)??!1,dataIndex:te}),j=te,E=le,L=xe):se&&(s.push({coord:le,value:re,text:"",isYearBoundary:(pe==null?void 0:pe.isYearBoundary)??!1,isMonthBoundary:(pe==null?void 0:pe.isMonthBoundary)??!1,isDayBoundary:(pe==null?void 0:pe.isDayBoundary)??!1,dataIndex:te}),j=te,E=le,L=xe)}}}}I=I.add(S,x)}aI({ticks:s,primaryUnit:x,chartStore:t,dateTimeFormat:n,timezoneId:C,dataList:u,firstTs:d,lastTs:h,barSpace:e,width:r,minSpacingPx:Math.max(50,c),maxGapPx:Math.max(f,120)})}function rI(s){return s?s.isYearBoundary?3:s.isMonthBoundary?2:s.isDayBoundary?1:0:0}function N5(s,e,t){const n=xp.tz(s,t),o=n.hour()===0&&n.minute()===0;let r=e==="day",a=e==="month",l=e==="year";return(e==="hour"||e==="minute")&&(r=o),r&&n.date()===1&&(a=!0),a&&n.month()===0&&(l=!0),e==="month"&&(r=!0),e==="year"&&(a=!0,r=!0),{isYearBoundary:l,isMonthBoundary:a,isDayBoundary:r}}function aI({ticks:s,primaryUnit:e,chartStore:t,dateTimeFormat:n,timezoneId:o,dataList:r,firstTs:a,lastTs:l,barSpace:c,width:f,minSpacingPx:u,maxGapPx:d}){var S;const h=e==="year"?"month":e==="month"?"day":null;if(!h||s.length<2)return;const p=[...s].sort((C,I)=>C.coord-I.coord),v=new Set;p.forEach(C=>{Number.isFinite(C.dataIndex)&&v.add(C.dataIndex)});const x=[];for(let C=0;C<p.length-1;C+=1){const I=p[C],A=p[C+1];if(!Number.isFinite(I.value)||!Number.isFinite(A.value))continue;const P=A.coord-I.coord;if(P<=d)continue;const T=xp.tz(I.value,o).startOf(h),j=xp.tz(A.value,o).startOf(h),E=j.diff(T,h);if(E<=1)continue;const L=P/E,D=Math.max(1,Math.ceil(u/L));let X=T.add(D,h),ne=I.coord;for(;X.isBefore(j);){const de=X.valueOf(),ie=A5({boundaryTs:de,dataList:r,firstTs:a,lastTs:l,chartStore:t});if(!ie||v.has(ie.index)){X=X.add(D,h);continue}const te=ie.index,le=t.dataIndexToCoordinate(te);if(le<-c||le>f+c){X=X.add(D,h);continue}if(le-ne<u||A.coord-le<u){X=X.add(D,h);continue}const pe=ie.fromData?Tx(t,te,n):N5(de,h,o),re=t.dataIndexToTimestamp(te)??((S=r[te])==null?void 0:S.timestamp);ul(re)&&(x.push({coord:le,value:re,text:"",isYearBoundary:(pe==null?void 0:pe.isYearBoundary)??!1,isMonthBoundary:(pe==null?void 0:pe.isMonthBoundary)??!1,isDayBoundary:(pe==null?void 0:pe.isDayBoundary)??!1,dataIndex:te}),v.add(te),ne=le),X=X.add(D,h)}}x.length>0&&s.push(...x)}function lI({ticks:s,chartStore:e,barSpace:t,width:n,minSpacingPx:o,gapThresholdPx:r,targetSpacingPx:a}){if(s.length<2)return;const l=[...s].sort((u,d)=>u.coord-d.coord),c=new Set;l.forEach(u=>{Number.isFinite(u.dataIndex)&&c.add(u.dataIndex)});const f=[];for(let u=0;u<l.length-1;u+=1){const d=l[u],p=l[u+1].coord-d.coord;if(!Number.isFinite(p)||p<=r)continue;let v=Math.max(2,Math.round(p/a)),x=p/v;if(x<o){if(v=Math.floor(p/o),v<2)continue;x=p/v}for(let S=1;S<v;S+=1){const C=d.coord+x*S;if(C<-t||C>n+t)continue;const I=e.coordinateToDataIndex(C);if(c.has(I))continue;const A=e.dataIndexToTimestamp(I);if(!ul(A))continue;const P=Tx(e,I,e.getDateTimeFormat());f.push({coord:C,value:A,text:"",isYearBoundary:(P==null?void 0:P.isYearBoundary)??!1,isMonthBoundary:(P==null?void 0:P.isMonthBoundary)??!1,isDayBoundary:(P==null?void 0:P.isDayBoundary)??!1,dataIndex:I}),c.add(I)}}f.length>0&&s.push(...f)}function A5({boundaryTs:s,dataList:e,firstTs:t,lastTs:n,chartStore:o}){if(ul(t)&&ul(n)&&s>=t&&s<=n){const a=cI(e,s);if(a!==null)return{index:a,fromData:!0}}const r=o.timestampToDataIndex(s);return Number.isFinite(r)?{index:Math.ceil(r),fromData:!1}:null}function cI(s,e){var r;let t=0,n=s.length-1,o=s.length;for(;t<=n;){const a=Math.floor((t+n)/2),l=(r=s[a])==null?void 0:r.timestamp;if(!ul(l))return null;l>=e?(o=a,n=a-1):t=a+1}return o>=s.length?null:o}function uI(s,e,t){let n=s.startOf(e);switch(e){case"year":{const o=n.year(),r=o-o%t;n=n.year(r).startOf("year");break}case"month":{const o=n.month(),r=o-o%t;n=n.month(r).startOf("month");break}case"day":{const o=n.date(),r=o-(o-1)%t;n=n.date(r).startOf("day");break}case"hour":{const o=n.hour(),r=o-o%t;n=n.hour(r).startOf("hour");break}case"minute":{const o=n.minute(),r=o-o%t;n=n.minute(r).startOf("minute");break}}return n}const dI={name:"normal"},Aw={normal:Ax.extend(dI)};function fI(s){return Aw[s]??Aw.normal}class pI extends k5{createAxisComponent(e){const t=fI(e);return new t(this)}createMainWidget(e){return new H9(e,this)}}function hI(s,e){let t=0;return function(){const n=Date.now();n-t>e&&(s.apply(this,arguments),t=n)}}class mI extends a5{constructor(t,n){super(t,n);Pe(this,"_dragFlag",!1);Pe(this,"_dragStartY",0);Pe(this,"_topPaneHeight",0);Pe(this,"_bottomPaneHeight",0);Pe(this,"_topPane",null);Pe(this,"_bottomPane",null);Pe(this,"_pressedMouseMoveEvent",hI(this._pressedTouchMouseMoveEvent,20));this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return id.SEPARATOR}_mouseDownEvent(t){this._dragFlag=!0,this._dragStartY=t.pageY;const n=this.getPane(),o=n.getChart();this._topPane=n.getTopPane(),this._bottomPane=n.getBottomPane();const r=o.getDrawPanes();if(this._topPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._topPane)==null?void 0:c.getId())});for(let l=a-1;l>-1;l--){const c=r[l];if(c.getOptions().state!=="minimize"){this._topPane=c;break}}}if(this._bottomPane.getOptions().state==="minimize"){const a=r.findIndex(l=>{var c;return l.getId()===((c=this._bottomPane)==null?void 0:c.getId())});for(let l=a+1;l<r.length;l++){const c=r[l];if(c.getOptions().state!=="minimize"){this._bottomPane=c;break}}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0}_mouseUpEvent(){this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0;try{this.getPane().getChart().layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}catch{}return this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const n=t.pageY-this._dragStartY,o=n<0;if(Rn(this._topPane)&&Rn(this._bottomPane)){const r=this._bottomPane.getOptions();if(this._topPane.getOptions().state!=="minimize"&&r.state!=="minimize"&&r.dragEnabled){let a=null,l=null,c=0,f=0;o?(a=this._topPane,l=this._bottomPane,c=this._topPaneHeight,f=this._bottomPaneHeight):(a=this._bottomPane,l=this._topPane,c=this._bottomPaneHeight,f=this._topPaneHeight);const u=a.getOptions().minHeight;if(c>u){const d=Math.max(c-Math.abs(n),u),h=c-d;a.setBounding({height:d}),l.setBounding({height:f+h});const p=this.getPane(),v=p.getChart();v.getChartStore().executeAction("onPaneDrag",{paneId:p.getId()}),v.layout({measureHeight:!0,update:!0,cacheYAxisWidth:!0})}}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getBottomPane().getOptions().dragEnabled){const r=t.getChart().getStyles().separator;return this.getContainer().style.background=r.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return this._dragFlag?!1:(this.getContainer().style.background="transparent",!0)}createContainer(){const t=l0("div",{width:"100%",height:`${Iy}px`,margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize",touchAction:"none"});return t.classList.add("dutycharts-pane-separator"),t}updateImp(t,n,o){if(o===zf.All||o===zf.Separator){const r=this.getPane().getChart().getStyles().separator;t.style.top=`${-Math.floor((Iy-r.size)/2)}px`,t.style.height=`${Iy}px`}}}class vI extends w5{constructor(t,n,o,r){super(t,n);Pe(this,"_topPane");Pe(this,"_bottomPane");Pe(this,"_separatorWidget");this.getContainer().style.overflow="",this._topPane=o,this._bottomPane=r,this._separatorWidget=new mI(this.getContainer(),this)}setBounding(t){return Bh(this.getBounding(),t),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getWidget(){return this._separatorWidget}getImage(t){const{width:n,height:o}=this.getBounding(),r=this.getChart().getStyles().separator,a=l0("canvas",{width:`${n}px`,height:`${o}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=E0(a);return a.width=n*c,a.height=o*c,l.scale(c,c),l.fillStyle=r.color,l.fillRect(0,0,n,o),a}updateImp(t,n,o){if(t===zf.All||t===zf.Separator){const r=this.getChart().getStyles().separator;n.style.backgroundColor=r.color,n.style.height=`${o.height}px`,n.style.marginLeft=`${o.left}px`,n.style.width=`${o.width}px`,this._separatorWidget.update(t)}}}function Tw(){return typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes("firefox")}function Hb(){return typeof window>"u"?!1:/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}const Z1={ResetClick:500,LongTap:500,PreventFiresTouchEvents:500},b_={CancelClick:5,CancelTap:5,DoubleClick:5,DoubleTap:30},Z_={Left:0,Middle:1,Right:2},gI=10;class _I{constructor(e,t,n){Pe(this,"_target");Pe(this,"_handler");Pe(this,"_options");Pe(this,"_clickCount",0);Pe(this,"_clickTimeoutId",null);Pe(this,"_clickCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});Pe(this,"_tapCount",0);Pe(this,"_tapTimeoutId",null);Pe(this,"_tapCoordinate",{x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY});Pe(this,"_longTapTimeoutId",null);Pe(this,"_longTapActive",!1);Pe(this,"_mouseMoveStartCoordinate",null);Pe(this,"_touchMoveStartCoordinate",null);Pe(this,"_touchMoveExceededManhattanDistance",!1);Pe(this,"_cancelClick",!1);Pe(this,"_cancelTap",!1);Pe(this,"_unsubscribeOutsideMouseEvents",null);Pe(this,"_unsubscribeOutsideTouchEvents",null);Pe(this,"_unsubscribeMobileSafariEvents",null);Pe(this,"_unsubscribeMousemove",null);Pe(this,"_unsubscribeMouseWheel",null);Pe(this,"_unsubscribeContextMenu",null);Pe(this,"_unsubscribeRootMouseEvents",null);Pe(this,"_unsubscribeRootTouchEvents",null);Pe(this,"_startPinchMiddleCoordinate",null);Pe(this,"_startPinchDistance",0);Pe(this,"_pinchPrevented",!1);Pe(this,"_preventTouchDragProcess",!1);Pe(this,"_mousePressed",!1);Pe(this,"_lastTouchEventTimeStamp",0);Pe(this,"_activeTouchId",null);Pe(this,"_acceptMouseLeave",!Hb());Pe(this,"_onFirefoxOutsideMouseUp",e=>{this._mouseUpHandler(e)});Pe(this,"_onMobileSafariDoubleClick",e=>{if(this._firesTouchEvents(e)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<b_.DoubleTap&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(e),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);t<b_.DoubleClick&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}});this._target=e,this._handler=t,this._options=n,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){var r,a,l;(r=this._unsubscribeMousemove)==null||r.call(this),(a=this._unsubscribeMouseWheel)==null||a.call(this),(l=this._unsubscribeContextMenu)==null||l.call(this);const t=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t);const n=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",n)},this._target.addEventListener("wheel",n,{passive:!1});const o=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",o)},this._target.addEventListener("contextmenu",o,{passive:!1}),!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(!Rn(this._handler.mouseWheelHortEvent)||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(!Rn(this._handler.mouseWheelVertEvent))return;let t=-(e.deltaY/100);if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:{t*=120;break}case e.DOM_DELTA_LINE:{t*=32;break}}if(t!==0){const n=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),n)}}}_contextMenuHandler(e){this._preventDefault(e)}_touchMoveHandler(e){const t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const n=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),{xOffset:o,yOffset:r,manhattanDistance:a}=n;if(!(!this._touchMoveExceededManhattanDistance&&a<b_.CancelTap)){if(!this._touchMoveExceededManhattanDistance){const l=o*.5,c=r>=l&&!this._options.treatVertDragAsPageScroll(),f=l>r&&!this._options.treatHorzDragAsPageScroll();!c&&!f&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(e){if(e.button!==Z_.Left)return;const t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),{manhattanDistance:n}=t;n>=b_.CancelClick&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(e,t){const n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),r=n+o;return{xOffset:n,yOffset:o,manhattanDistance:r}}_touchEndHandler(e){let t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const n=this._makeCompatEvent(e,t);if(this._processEvent(n,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:o}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);o<b_.DoubleTap&&!this._cancelTap&&this._processEvent(n,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(n,this._handler.tapEvent),Rn(this._handler.tapEvent)&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}_mouseUpHandler(e){if(e.button!==Z_.Left)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Tw()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:n}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate);n<b_.DoubleClick&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(this._activeTouchId!==null)return;const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);const n=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const o=this._touchMoveHandler.bind(this),r=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{n.removeEventListener("touchmove",o),n.removeEventListener("touchend",r)},n.addEventListener("touchmove",o,{passive:!1}),n.addEventListener("touchend",r,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),Z1.LongTap)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),Z1.ResetClick),this._tapCoordinate=this._getCoordinate(t))}_mouseDownHandler(e){if(e.button===Z_.Right){this._preventDefault(e),this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);return}if(e.button!==Z_.Left)return;const t=this._target.ownerDocument.documentElement;Tw()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const n=this._mouseMoveWithDownHandler.bind(this),o=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",n),t.removeEventListener("mouseup",o)},t.addEventListener("mousemove",n),t.addEventListener("mouseup",o)}this._mousePressed=!0,!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),Z1.ResetClick),this._clickCoordinate=this._getCoordinate(e)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const e=this._target.ownerDocument,t=n=>{this._handler.mouseDownOutsideEvent!=null&&(n.composed&&this._target.contains(n.composedPath()[0])||n.target!==null&&this._target.contains(n.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",t)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",t)},e.addEventListener("mousedown",t),e.addEventListener("touchstart",t,{passive:!0})}Hb()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",e=>{if(e.button===Z_.Middle)return e.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){!Rn(this._handler.pinchStartEvent)&&!Rn(this._handler.pinchEvent)&&!Rn(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",e=>{this._checkPinchState(e.touches)},{passive:!0}),this._target.addEventListener("touchmove",e=>{if(!(e.touches.length!==2||this._startPinchMiddleCoordinate===null)&&Rn(this._handler.pinchEvent)){const n=this._getTouchDistance(e.touches[0],e.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},n),this._preventDefault(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{this._checkPinchState(e.touches)}))}_checkPinchState(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){const t=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),Rn(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,Rn(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(e){var t,n,o;(t=this._unsubscribeMousemove)==null||t.call(this),(n=this._unsubscribeMouseWheel)==null||n.call(this),(o=this._unsubscribeContextMenu)==null||o.call(this),!this._firesTouchEvents(e)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!Hb())}_longTapHandler(e){const t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(e){var t;return Rn((t=e.sourceCapabilities)==null?void 0:t.firesTouchEvents)?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+Z1.PreventFiresTouchEvents}_processEvent(e,t){t==null||t.call(this._handler,e)}_makeCompatEvent(e,t){const n=t??e,o=this._target.getBoundingClientRect();return{x:n.clientX-o.left,y:n.clientY-o.top,pageX:n.pageX,pageY:n.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click"&&e.type!=="wheel",preventDefault:()=>{e.type!=="touchstart"&&this._preventDefault(e)}}}_getTouchDistance(e,t){const n=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(n*n+o*o)}_preventDefault(e){e.cancelable&&e.preventDefault()}_getCoordinate(e){return{x:e.pageX,y:e.pageY}}_eventTimeStamp(e){return e.timeStamp??performance.now()}_touchWithId(e,t){for(let n=0;n<e.length;++n)if(e[n].identifier===t)return e[n];return null}}class yI{constructor(e,t){Pe(this,"_container");Pe(this,"_chart");Pe(this,"_event");Pe(this,"_flingStartTime",new Date().getTime());Pe(this,"_flingScrollRequestId",null);Pe(this,"_startScrollCoordinate",null);Pe(this,"_touchCoordinate",null);Pe(this,"_touchCancelCrosshair",!1);Pe(this,"_touchZoomed",!1);Pe(this,"_pinchScale",1);Pe(this,"_mouseDownWidget",null);Pe(this,"_prevYAxisRange",null);Pe(this,"_xAxisStartScaleCoordinate",null);Pe(this,"_xAxisStartScaleDistance",0);Pe(this,"_xAxisScale",1);Pe(this,"_yAxisStartScaleDistance",0);Pe(this,"_mouseMoveTriggerWidgetInfo",{pane:null,widget:null});Pe(this,"_wheelScrollAccum",0);Pe(this,"_wheelScrollRafId",null);Pe(this,"_wheelZoomAccum",0);Pe(this,"_wheelZoomRafId",null);Pe(this,"_wheelZoomLastCoord",null);Pe(this,"_overlayUpdateRafId",null);Pe(this,"_yAxisScaleLayoutTimer",null);Pe(this,"_boundKeyBoardDownEvent",e=>{if(e.shiftKey)switch(e.code){case"Equal":{this._chart.getChartStore().zoom(.5);break}case"Minus":{this._chart.getChartStore().zoom(-.5);break}case"ArrowLeft":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}});this._container=e,this._chart=t,this._event=new _I(e,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(e,t){const{pane:n,widget:o}=this._findWidgetByEvent(e);if((n==null?void 0:n.getId())!==yd.X_AXIS&&(o==null?void 0:o.getName())===id.MAIN){const r=this._makeWidgetEvent(e,o),a=(t-this._pinchScale)*5;return this._pinchScale=t,this._chart.getChartStore().zoom(a,{x:r.x,y:r.y}),!0}return!1}mouseWheelHortEvent(e,t){if(this._wheelScrollAccum+=t,this._wheelScrollRafId===null){const n=this._chart.getChartStore();this._wheelScrollRafId=$0(()=>{const o=this._wheelScrollAccum;this._wheelScrollAccum=0,this._wheelScrollRafId=null,n.startScroll(),n.scroll(o)})}return!0}mouseWheelVertEvent(e,t){const{widget:n}=this._findWidgetByEvent(e),o=this._makeWidgetEvent(e,n);return(n==null?void 0:n.getName())===id.MAIN?(this._wheelZoomAccum+=t,this._wheelZoomLastCoord={x:o.x,y:o.y},this._wheelZoomRafId===null&&(this._wheelZoomRafId=$0(()=>{const a=this._wheelZoomAccum,l=this._wheelZoomLastCoord??{x:o.x,y:o.y};this._wheelZoomAccum=0,this._wheelZoomLastCoord=null,this._wheelZoomRafId=null,this._chart.getChartStore().zoom(a,l)})),!0):!1}mouseDownEvent(e){const{pane:t,widget:n}=this._findWidgetByEvent(e);if(this._mouseDownWidget=n,n!==null){const o=this._makeWidgetEvent(e,n);switch(n.getName()){case id.SEPARATOR:return n.dispatchEvent("mouseDownEvent",o);case id.MAIN:{const a=t.getAxisComponent();if(!a.getAutoCalcTickFlag()){const l=a.getRange();this._prevYAxisRange={...l}}return this._startScrollCoordinate={x:o.x,y:o.y},this._chart.getChartStore().startScroll(),n.dispatchEvent("mouseDownEvent",o)}case id.X_AXIS:return this._processXAxisScrollStartEvent(n,o);case id.Y_AXIS:return this._processYAxisScaleStartEvent(n,o)}}return!1}mouseMoveEvent(e){var r,a,l;const{pane:t,widget:n}=this._findWidgetByEvent(e),o=this._makeWidgetEvent(e,n);if((((r=this._mouseMoveTriggerWidgetInfo.pane)==null?void 0:r.getId())!==(t==null?void 0:t.getId())||((a=this._mouseMoveTriggerWidgetInfo.widget)==null?void 0:a.getName())!==(n==null?void 0:n.getName()))&&(n==null||n.dispatchEvent("mouseEnterEvent",o),(l=this._mouseMoveTriggerWidgetInfo.widget)==null||l.dispatchEvent("mouseLeaveEvent",o),this._mouseMoveTriggerWidgetInfo={pane:t,widget:n}),n!==null){const c=n.getName();switch(c){case id.MAIN:{const f=n.dispatchEvent("mouseMoveEvent",o);let u={x:o.x,y:o.y,paneId:t==null?void 0:t.getId()};return f?(n.getForceCursor()!=="pointer"&&(u=void 0),n.setCursor("pointer")):n.setCursor("crosshair"),this._chart.getChartStore().setCrosshair(u),f}case id.SEPARATOR:case id.X_AXIS:case id.Y_AXIS:{const f=n.dispatchEvent("mouseMoveEvent",o);return c===id.X_AXIS?this._chart.getChartStore().setCrosshair({x:o.x,paneId:t==null?void 0:t.getId()}):this._chart.getChartStore().setCrosshair(),f}}}return!1}pressedMouseMoveEvent(e){var o,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===id.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);const{pane:t,widget:n}=this._findWidgetByEvent(e);if(n!==null&&((o=this._mouseDownWidget)==null?void 0:o.getPane().getId())===(t==null?void 0:t.getId())&&((r=this._mouseDownWidget)==null?void 0:r.getName())===n.getName()){const a=this._makeWidgetEvent(e,n);switch(n.getName()){case id.MAIN:{let c;const f=n.dispatchEvent("pressedMouseMoveEvent",a);return f||this._processMainScrollingEvent(n,a),(!f||n.getForceCursor()==="pointer")&&(c={x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}),this._chart.getChartStore().setCrosshair(c,{forceInvalidate:!0}),f}case id.X_AXIS:return this._processXAxisScrollingEvent(n,a);case id.Y_AXIS:return this._processYAxisScalingEvent(n,a)}}return!1}mouseUpEvent(e){const{widget:t}=this._findWidgetByEvent(e),n=this._mouseDownWidget??t;let o=!1;if(n!==null){const r=this._makeWidgetEvent(e,n);switch(n.getName()){case id.MAIN:case id.SEPARATOR:case id.X_AXIS:case id.Y_AXIS:{o=n.dispatchEvent("mouseUpEvent",r);break}}o&&this._scheduleOverlayUpdate()}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout(),o}mouseClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const n=this._makeWidgetEvent(e,t);return t.dispatchEvent("mouseClickEvent",n)}return!1}mouseRightClickEvent(e){const{widget:t}=this._findWidgetByEvent(e);let n=!1;if(t!==null){const o=this._makeWidgetEvent(e,t);switch(t.getName()){case id.MAIN:case id.X_AXIS:case id.Y_AXIS:{n=t.dispatchEvent("mouseRightClickEvent",o);break}}n&&this._scheduleOverlayUpdate()}return!1}mouseDoubleClickEvent(e){const{pane:t,widget:n}=this._findWidgetByEvent(e);if(n!==null)switch(n.getName()){case id.MAIN:{const r=this._makeWidgetEvent(e,n);return n.dispatchEvent("mouseDoubleClickEvent",r)}case id.Y_AXIS:{const r=t.getAxisComponent();if(!r.getAutoCalcTickFlag())return r.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().setCrosshair(),!0}touchStartEvent(e){var o;const{pane:t,widget:n}=this._findWidgetByEvent(e);if(n!==null){const r=this._makeWidgetEvent(e,n);switch((o=r.preventDefault)==null||o.call(r),n.getName()){case id.SEPARATOR:return this._flingScrollRequestId!==null&&(Eb(this._flingScrollRequestId),this._flingScrollRequestId=null),this._mouseDownWidget=n,n.dispatchEvent("touchStartEvent",r);case id.MAIN:{const l=this._chart.getChartStore();if(n.dispatchEvent("mouseDownEvent",r))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(zf.Overlay),!0;this._flingScrollRequestId!==null&&(Eb(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime();const c=t.getAxisComponent();if(!c.getAutoCalcTickFlag()){const f=c.getRange();this._prevYAxisRange={...f}}if(this._startScrollCoordinate={x:r.x,y:r.y},l.startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const f=r.x-this._touchCoordinate.x,u=r.y-this._touchCoordinate.y;Math.sqrt(f*f+u*u)<gI?(this._touchCoordinate={x:r.x,y:r.y},l.setCrosshair({x:r.x,y:r.y,paneId:t==null?void 0:t.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,l.setCrosshair())}return!0}case id.X_AXIS:return this._processXAxisScrollStartEvent(n,r);case id.Y_AXIS:return this._processYAxisScaleStartEvent(n,r)}}return!1}touchMoveEvent(e){var o,r;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===id.SEPARATOR){const a=this._makeWidgetEvent(e,this._mouseDownWidget);return(o=a.preventDefault)==null||o.call(a),this._mouseDownWidget.dispatchEvent("touchMoveEvent",a)}const{pane:t,widget:n}=this._findWidgetByEvent(e);if(n!==null){const a=this._makeWidgetEvent(e,n);(r=a.preventDefault)==null||r.call(a);const l=n.getName(),c=this._chart.getChartStore();switch(l){case id.MAIN:return n.dispatchEvent("pressedMouseMoveEvent",a)?(c.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(zf.Overlay),!0):(this._touchCoordinate!==null?c.setCrosshair({x:a.x,y:a.y,paneId:t==null?void 0:t.getId()}):this._processMainScrollingEvent(n,a),!0);case id.X_AXIS:return this._processXAxisScrollingEvent(n,a);case id.Y_AXIS:return this._processYAxisScalingEvent(n,a);case id.SEPARATOR:return n.dispatchEvent("touchMoveEvent",a)}}return!1}touchEndEvent(e){if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===id.SEPARATOR){const n=this._makeWidgetEvent(e,this._mouseDownWidget),o=this._mouseDownWidget.dispatchEvent("touchEndEvent",n);return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout(),o}const{widget:t}=this._findWidgetByEvent(e);if(t!==null){const n=this._makeWidgetEvent(e,t);switch(t.getName()){case id.MAIN:{if(t.dispatchEvent("mouseUpEvent",n),this._startScrollCoordinate!==null){const r=new Date().getTime()-this._flingStartTime;let l=(n.x-this._startScrollCoordinate.x)/(r>0?r:1)*20;if(r<200&&Math.abs(l)>0){const c=this._chart.getChartStore(),f=()=>{this._flingScrollRequestId=$0(()=>{c.startScroll(),c.scroll(l),l=l*(1-.025),Math.abs(l)<1?this._flingScrollRequestId!==null&&(Eb(this._flingScrollRequestId),this._flingScrollRequestId=null):f()})};f()}}return!0}case id.X_AXIS:case id.Y_AXIS:{t.dispatchEvent("mouseUpEvent",n)&&this._chart.updatePane(zf.Overlay);break}case id.SEPARATOR:{t.dispatchEvent("touchEndEvent",n);break}}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._finalizeYAxisScaleLayout()}return!1}tapEvent(e){const{pane:t,widget:n}=this._findWidgetByEvent(e);let o=!1;if(n!==null){const r=this._makeWidgetEvent(e,n),a=n.dispatchEvent("mouseClickEvent",r);if(n.getName()===id.MAIN){const l=this._makeWidgetEvent(e,n),c=this._chart.getChartStore();a?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,{notInvalidate:!0}),o=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},c.setCrosshair({x:l.x,y:l.y,paneId:t==null?void 0:t.getId()},{notInvalidate:!0}),o=!0),this._touchCancelCrosshair=!1)}(o||a)&&this._scheduleOverlayUpdate()}return o}doubleTapEvent(e){return this.mouseDoubleClickEvent(e)}longTapEvent(e){const{pane:t,widget:n}=this._findWidgetByEvent(e);if(n!==null&&n.getName()===id.MAIN){const o=this._makeWidgetEvent(e,n);return this._touchCoordinate={x:o.x,y:o.y},this._chart.getChartStore().setCrosshair({x:o.x,y:o.y,paneId:t==null?void 0:t.getId()}),!0}return!1}_processMainScrollingEvent(e,t){if(this._startScrollCoordinate!==null){const n=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&!n.getAutoCalcTickFlag()&&n.scrollZoomEnabled){const{from:r,to:a,range:l}=this._prevYAxisRange;let c=0;n.reverse?c=this._startScrollCoordinate.y-t.y:c=t.y-this._startScrollCoordinate.y;const f=e.getBounding(),u=c/f.height,d=l*u,h=r+d,p=a+d,v=n.valueToRealValue(h,{range:this._prevYAxisRange}),x=n.valueToRealValue(p,{range:this._prevYAxisRange}),S=n.realValueToDisplayValue(v,{range:this._prevYAxisRange}),C=n.realValueToDisplayValue(x,{range:this._prevYAxisRange});n.setRange({from:h,to:p,range:p-h,realFrom:v,realTo:x,realRange:x-v,displayFrom:S,displayTo:C,displayRange:C-S}),n.buildTicks(!0),this._chart.updatePane(zf.All,e.getPane().getId())}const o=t.x-this._startScrollCoordinate.x;o!==0&&this._chart.getChartStore().scroll(o)}}_processXAxisScrollStartEvent(e,t){const n=e.dispatchEvent("mouseDownEvent",t);return n&&this._scheduleOverlayUpdate(),this._xAxisStartScaleCoordinate={x:t.x,y:t.y},this._xAxisStartScaleDistance=t.pageX,n}_processXAxisScrollingEvent(e,t){const n=e.dispatchEvent("pressedMouseMoveEvent",t);if(n)this._scheduleOverlayUpdate();else if(e.getPane().getAxisComponent().scrollZoomEnabled&&this._xAxisStartScaleDistance!==0){const r=this._xAxisStartScaleDistance/t.pageX;if(Number.isFinite(r)){const a=(r-this._xAxisScale)*10;this._xAxisScale=r,this._chart.getChartStore().zoom(a,this._xAxisStartScaleCoordinate??void 0)}}return n}_processYAxisScaleStartEvent(e,t){const n=e.dispatchEvent("mouseDownEvent",t);n&&this._scheduleOverlayUpdate();const o=e.getPane().getAxisComponent().getRange();return this._prevYAxisRange={...o},this._yAxisStartScaleDistance=t.pageY,n}_processYAxisScalingEvent(e,t){const n=e.dispatchEvent("pressedMouseMoveEvent",t);if(n)this._chart.updatePane(zf.Overlay);else{const o=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&o.scrollZoomEnabled&&this._yAxisStartScaleDistance!==0){const{from:r,to:a,range:l}=this._prevYAxisRange,c=t.pageY/this._yAxisStartScaleDistance,f=Number.isFinite(c)?Math.min(5,Math.max(.2,c)):1,u=l*f,d=(u-l)/2,h=r-d,p=a+d,v=o.valueToRealValue(h,{range:this._prevYAxisRange}),x=o.valueToRealValue(p,{range:this._prevYAxisRange}),S=o.realValueToDisplayValue(v,{range:this._prevYAxisRange}),C=o.realValueToDisplayValue(x,{range:this._prevYAxisRange});o.setRange({from:h,to:p,range:u,realFrom:v,realTo:x,realRange:x-v,displayFrom:S,displayTo:C,displayRange:C-S}),o.buildTicks(!0),this._chart.updatePane(zf.All,e.getPane().getId()),this._scheduleYAxisScaleLayout()}}return n}_findWidgetByEvent(e){const{x:t,y:n}=e,o=this._chart.getSeparatorPanes(),r=this._chart.getStyles().separator.size,a=Iy,l=e.isTouch?Math.max(a,r+14):Math.max(a,r+6);for(const d of o){const h=d[1],p=h.getBounding(),v=p.top-Math.round((l-r)/2);if(t>=p.left&&t<=p.left+p.width&&n>=v&&n<=v+l)return{pane:h,widget:h.getWidget()}}const c=this._chart.getDrawPanes();let f=null;for(const d of c){const h=d.getBounding();if(t>=h.left&&t<=h.left+h.width&&n>=h.top&&n<=h.top+h.height){f=d;break}}let u=null;if(f!==null){if(!Rn(u)){const d=f.getMainWidget(),h=d.getBounding();t>=h.left&&t<=h.left+h.width&&n>=h.top&&n<=h.top+h.height&&(u=d)}if(!Rn(u)){const d=f.getYAxisWidget();if(d!==null){const h=d.getBounding();t>=h.left&&t<=h.left+h.width&&n>=h.top&&n<=h.top+h.height&&(u=d)}}}return{pane:f,widget:u}}_makeWidgetEvent(e,t){const n=(t==null?void 0:t.getBounding())??null;return{...e,x:e.x-((n==null?void 0:n.left)??0),y:e.y-((n==null?void 0:n.top)??0)}}_scheduleYAxisScaleLayout(){this._yAxisScaleLayoutTimer!==null&&clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=window.setTimeout(()=>{this._yAxisScaleLayoutTimer=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})},60)}_finalizeYAxisScaleLayout(){this._yAxisScaleLayoutTimer!==null&&(clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=null,this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}))}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._yAxisScaleLayoutTimer!==null&&(clearTimeout(this._yAxisScaleLayoutTimer),this._yAxisScaleLayoutTimer=null),this._event.destroy()}}class bI{constructor(e,t){Pe(this,"id");Pe(this,"_container");Pe(this,"_chartContainer");Pe(this,"_chartBounding",Uy());Pe(this,"_chartEvent");Pe(this,"_chartStore");Pe(this,"_drawPanes",[]);Pe(this,"_candlePane");Pe(this,"_xAxisPane");Pe(this,"_separatorPanes",new Map);Pe(this,"_layoutOptions",{sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1});Pe(this,"_layoutPending",!1);Pe(this,"_cacheYAxisWidth",{left:0,right:0});this.id=d1("chart"),this._initContainer(e),this._chartEvent=new yI(this._chartContainer,this),this._chartStore=new KC(this,t),this._initPanes(t),this._layout()}_initContainer(e){this._container=e,this._chartContainer=l0("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer),this._cacheChartBounding()}_cacheChartBounding(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)}_initPanes(e){const t=(e==null?void 0:e.layout)??[{type:"candle"}],n=r=>{if(!Rn(this._candlePane)){const a=r.options??{};Bh(a,{id:yd.CANDLE}),this._candlePane=this._createPane(O9,yd.CANDLE,a),(r.content??[]).forEach(c=>{this.createIndicator(c,!0,a)})}},o=r=>{if(!Rn(this._xAxisPane)){const a=this._createPane(pI,yd.X_AXIS,r??{});this._xAxisPane=a}};t.forEach(r=>{var a;switch(r.type){case"candle":{n(r);break}case"indicator":{const l=r.content??[];if(l.length>0){let c=((a=r.options)==null?void 0:a.id)??null;Rn(c)&&(c=d1(yd.INDICATOR));const f={...r.options,id:c};l.forEach(u=>{this.createIndicator(u,!0,f)})}break}case"xAxis":{o(r.options);break}}}),n({type:"candle"}),o({order:Number.MAX_SAFE_INTEGER})}_createPane(e,t,n){const o=new e(this,t,n??{});return this._drawPanes.push(o),o}_recalculatePaneHeight(e,t,n){if(n===0)return!1;const o=this._drawPanes.filter(a=>{const l=a.getId();return a.getOptions().state==="normal"&&l!==e.getId()&&l!==yd.X_AXIS}),r=o.length;if(r===0)return!1;if(e.getId()!==yd.CANDLE&&Rn(this._candlePane)&&this._candlePane.getOptions().state==="normal"){const a=this._candlePane.getBounding().height;if(a>0){const l=this._candlePane.getOptions().minHeight;let c=a+n;c<l&&(c=l,t-=a+n-c),this._candlePane.setBounding({height:c})}}else{let a=n;const l=Math.floor(n/r);o.forEach((c,f)=>{const u=c.getBounding().height;let d=0;f===r-1?d=u+a:d=u+l,d<c.getOptions().minHeight&&(d=c.getOptions().minHeight),c.setBounding({height:d}),a-=d-u}),Math.abs(a)>0&&(t-=a)}return e.setBounding({height:t}),!0}getDrawPaneById(e){return e===yd.CANDLE?this._candlePane:e===yd.X_AXIS?this._xAxisPane:this._drawPanes.find(n=>n.getId()===e)??null}getContainer(){return this._container}getChartStore(){return this._chartStore}getXAxisPane(){return this._xAxisPane}getDrawPanes(){return this._drawPanes}getSeparatorPanes(){return this._separatorPanes}layout(e){(e.sort??!1)&&(this._layoutOptions.sort=e.sort),(e.measureHeight??!1)&&(this._layoutOptions.measureHeight=e.measureHeight),(e.measureWidth??!1)&&(this._layoutOptions.measureWidth=e.measureWidth),(e.update??!1)&&(this._layoutOptions.update=e.update),(e.buildYAxisTick??!1)&&(this._layoutOptions.buildYAxisTick=e.buildYAxisTick),(e.cacheYAxisWidth??!1)&&(this._layoutOptions.cacheYAxisWidth=e.cacheYAxisWidth),(e.buildYAxisTick??!1)&&(this._layoutOptions.forceBuildYAxisTick=e.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(t=>{try{this._layout()}finally{this._layoutPending=!1}}).catch(t=>{}))}_layout(){const{sort:e,measureHeight:t,measureWidth:n,update:o,buildYAxisTick:r,cacheYAxisWidth:a,forceBuildYAxisTick:l}=this._layoutOptions;if(typeof performance<"u"?performance.now():Date.now(),e){for(;Rn(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort((u,d)=>u.getOptions().order-d.getOptions().order);let f=null;this._drawPanes.forEach(u=>{if(u.getId()!==yd.X_AXIS){if(Rn(f)){const d=new vI(this,"",f,u);this._chartContainer.appendChild(d.getContainer()),this._separatorPanes.set(u,d)}f=u}this._chartContainer.appendChild(u.getContainer())})}if(t){const f=this._chartBounding.height,u=this.getStyles().separator.size,d=this._xAxisPane.getAxisComponent().getAutoSize();let h=f-d;h<0&&(h=0),this._drawPanes.forEach(v=>{const x=v.getId();if(Rn(this._separatorPanes.get(v))&&(h-=u),x!==yd.X_AXIS&&x!==yd.CANDLE&&v.getVisible()){let S=v.getBounding().height;S>h?(S=h,h=0):h-=S,v.setBounding({height:S})}}),this._candlePane.setBounding({height:Math.max(h,0)}),this._xAxisPane.setBounding({height:d});let p=0;this._drawPanes.forEach(v=>{const x=this._separatorPanes.get(v);Rn(x)&&(x.setBounding({height:u,top:p}),p+=u),v.setBounding({top:p}),p+=v.getBounding().height})}let c=n;if((r||l)&&this._drawPanes.forEach(f=>{const u=f.getAxisComponent().buildTicks(l);c||(c=u)}),c){const f=this._chartBounding.width,u=this.getStyles();let d=0,h=!0,p=0,v=!0;this._drawPanes.forEach(L=>{if(L.getId()!==yd.X_AXIS&&L.getVisible()){const D=L.getAxisComponent(),X=D.inside,ne=D.getAutoSize();D.position==="left"?(d=Math.max(d,ne),X&&(h=!1)):(p=Math.max(p,ne),X&&(v=!1))}}),a&&(d=Math.max(this._cacheYAxisWidth.left,d),p=Math.max(this._cacheYAxisWidth.right,p)),this._cacheYAxisWidth.left=d,this._cacheYAxisWidth.right=p;let x=f,S=0,C=0;h&&(x-=d,S=d),v&&(x-=p,C=p),this._chartStore.setTotalBarSpace(x);const I={width:f},A={width:x,left:S,right:C},P={width:d},T={width:p},j=u.separator.fill;let E={};j?E=I:E=A,this._drawPanes.forEach(L=>{var D;(D=this._separatorPanes.get(L))==null||D.setBounding(E),L.setBounding(I,A,P,T)})}o&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(zf.All)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1},typeof performance<"u"?performance.now():Date.now()}updatePane(e,t){if(Rn(t)){const n=this.getDrawPaneById(t);n==null||n.update(e)}else this._drawPanes.forEach(n=>{var o;n.update(e),(o=this._separatorPanes.get(n))==null||o.update(e)})}getDom(e,t){var n;if(Rn(e)){const o=this.getDrawPaneById(e);if(Rn(o))switch(t??"root"){case"root":return o.getContainer();case"main":return o.getMainWidget().getContainer();case"yAxis":return((n=o.getYAxisWidget())==null?void 0:n.getContainer())??null}}else return this._chartContainer;return null}getSize(e,t){var n;if(Rn(e)){const o=this.getDrawPaneById(e);if(Rn(o))switch(t??"root"){case"root":return o.getBounding();case"main":return o.getMainWidget().getBounding();case"yAxis":return((n=o.getYAxisWidget())==null?void 0:n.getBounding())??null}}else return this._chartBounding;return null}_resetYAxisAutoCalcTickFlag(){this._drawPanes.forEach(e=>{e.getAxisComponent().setAutoCalcTickFlag(!0)})}setSymbol(e){e!==this.getSymbol()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setSymbol(e))}getSymbol(){return this._chartStore.getSymbol()}setPeriod(e){e!==this.getPeriod()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setPeriod(e))}getPeriod(){return this._chartStore.getPeriod()}setStyles(e){this._setOptions(()=>{this._chartStore.setStyles(e)})}getStyles(){return this._chartStore.getStyles()}setFormatter(e){this._setOptions(()=>{this._chartStore.setFormatter(e)})}getFormatter(){return this._chartStore.getFormatter()}setLocale(e){this._setOptions(()=>{this._chartStore.setLocale(e)})}getLocale(){return this._chartStore.getLocale()}setTimezone(e){this._setOptions(()=>{this._chartStore.setTimezone(e)})}getTimezone(){return this._chartStore.getTimezone()}setThousandsSeparator(e){this._setOptions(()=>{this._chartStore.setThousandsSeparator(e)})}getThousandsSeparator(){return this._chartStore.getThousandsSeparator()}setDecimalFold(e){this._setOptions(()=>{this._chartStore.setDecimalFold(e)})}getDecimalFold(){return this._chartStore.getDecimalFold()}_setOptions(e){e(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}setOffsetRightDistance(e){this._chartStore.setOffsetRightDistance(e,!0)}getOffsetRightDistance(){return this._chartStore.getOffsetRightDistance()}setMaxOffsetLeftDistance(e){e<0||this._chartStore.setMaxOffsetLeftDistance(e)}setMaxOffsetRightDistance(e){e<0||this._chartStore.setMaxOffsetRightDistance(e)}setLeftMinVisibleBarCount(e){e<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(e))}setRightMinVisibleBarCount(e){e<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(e))}setBarSpace(e){this._chartStore.setBarSpace(e)}getBarSpace(){return this._chartStore.getBarSpace()}getVisibleRange(){return this._chartStore.getVisibleRange()}resetData(){this._chartStore.resetData()}applyNewData(e,t){this._chartStore.applyNewData(e,t)}addData(e,t,n){this._chartStore.addData(e,t,n)}getDataList(){return this._chartStore.getDataList()}setDataLoader(e){this._resetYAxisAutoCalcTickFlag(),this._chartStore.setDataLoader(e)}createIndicator(e,t,n){const o=Mf(e)?{name:e}:e;if(e5(o.name)===null)return null;const r=n??{};if(Mf(r.id)||(r.id=d1(yd.INDICATOR)),Mf(o.id)||(o.id=d1(o.name)),this._chartStore.addIndicator(o,r.id,t??!1)){let l=!1;return Rn(this.getDrawPaneById(r.id))||(this._createPane(S5,r.id,r),r.height??(r.height=i5),l=!0),this.setPaneOptions(r),this.layout({sort:l,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),o.id}return null}overrideIndicator(e){return this._chartStore.overrideIndicator(e)}getIndicators(e){return this._chartStore.getIndicatorsByFilter(e??{})}removeIndicator(e){let t=this._chartStore.removeIndicator(e??{});if(!t&&e){const{name:n,id:o}=e,r=typeof n=="string"?n.split("(")[0].trim():void 0;if(o||r){const a={};o&&(a.id=o),r&&(a.name=r),t=this._chartStore.removeIndicator(a),!t&&r&&(t=this._chartStore.removeIndicator({name:r}))}}if(t){let n=!1;const o=[];this._drawPanes.forEach(r=>{const a=r.getId();a!==yd.CANDLE&&a!==yd.X_AXIS&&o.push(a)}),o.forEach(r=>{if(!this._chartStore.hasIndicators(r)){const a=this._drawPanes.findIndex(c=>c.getId()===r),l=this._drawPanes[a];Rn(l)&&(n=!0,this._recalculatePaneHeight(l,0,l.getBounding().height),this._drawPanes.splice(a,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:n,measureHeight:n,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return t}createOverlay(e){const t=[],n=[],o=a=>{!Rn(a.paneId)||this.getDrawPaneById(a.paneId)===null?(a.paneId=yd.CANDLE,n.push(!1)):n.push(!0),t.push(a)};Mf(e)?o({name:e}):lg(e)?e.forEach(a=>{let l=null;Mf(a)?l={name:a}:l=a,o(l)}):o(e);const r=this._chartStore.addOverlays(t,n);return lg(e)?r:r[0]}getOverlays(e){return this._chartStore.getOverlaysByFilter(e??{})}overrideOverlay(e){return this._chartStore.overrideOverlay(e)}removeOverlay(e){return this._chartStore.removeOverlay(e??{})}setPaneOptions(e){let t=!1,n=!1;const o=Rn(e.id);for(const r of this._drawPanes){const a=r.getId();if(o&&e.id===a||!o){if(a!==yd.X_AXIS){if(ul(e.height)&&e.height>0){const c=Math.max(e.minHeight??r.getOptions().minHeight,0),f=Math.max(c,e.height);n=!0,t=!0,r.setOriginalBounding({height:f}),this._recalculatePaneHeight(r,f,-f)}if(Rn(e.state)&&r.getOptions().state!==e.state){t=!0,n=!0;const c=e.state;switch(c){case"maximize":{const f=this._drawPanes.find(u=>{const d=u.getId();return u.getOptions().state==="maximize"&&d!==yd.X_AXIS});if(!Rn(f)){r.getOptions().state==="normal"&&r.setOriginalBounding({height:r.getBounding().height}),r.setOptions({state:c});const u=this._chartBounding.height;r.setBounding({height:u-this._xAxisPane.getBounding().height}),this._drawPanes.forEach(d=>{var h;d.getId()!==yd.X_AXIS&&d.getId()!==a&&(d.setBounding({height:d.getOriginalBounding().height}),d.setVisible(!1),(h=this._separatorPanes.get(d))==null||h.setVisible(!1))})}break}case"minimize":{const f=r.getBounding().height,u=r.getOptions().state;let d=f-Cy;u==="maximize"&&(d=r.getOriginalBounding().height-Cy),this._recalculatePaneHeight(r,Cy,d)&&(u==="normal"&&r.setOriginalBounding({height:f}),r.setOptions({state:c})),this._drawPanes.forEach(h=>{var p;h.getId()!==yd.X_AXIS&&(h.setVisible(!0),(p=this._separatorPanes.get(h))==null||p.setVisible(!0))});break}default:{const f=r.getOriginalBounding().height;r.getOptions().state==="maximize"?(r.setOptions({state:c}),this._drawPanes.forEach(d=>{var h;d.getId()!==yd.X_AXIS&&(d.setBounding({height:d.getOriginalBounding().height}),d.setVisible(!0),(h=this._separatorPanes.get(d))==null||h.setVisible(!0))})):this._recalculatePaneHeight(r,f,r.getBounding().height-f)&&(r.setOptions({state:c}),this._drawPanes.forEach(d=>{var h;d.getId()!==yd.X_AXIS&&(d.setVisible(!0),(h=this._separatorPanes.get(d))==null||h.setVisible(!0))}));break}}}}Rn(e.axis)&&(n=!0);const l={...e};if(delete l.state,r.setOptions(l),a===e.id)break}}n&&this.layout({measureHeight:t,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}getPaneOptions(e){if(Rn(e)){const t=this.getDrawPaneById(e);return(t==null?void 0:t.getOptions())??null}return this._drawPanes.map(t=>t.getOptions())}setZoomEnabled(e){this._chartStore.setZoomEnabled(e)}isZoomEnabled(){return this._chartStore.isZoomEnabled()}setScrollEnabled(e){this._chartStore.setScrollEnabled(e)}isScrollEnabled(){return this._chartStore.isScrollEnabled()}scrollByDistance(e,t){const n=ul(t)&&t>0?t:0;if(this._chartStore.startScroll(),n>0){const o=new L2({duration:n});o.doFrame(r=>{const a=e*(r/n);this._chartStore.scroll(a)}),o.start()}else this._chartStore.scroll(e)}scrollToRealTime(e){const{bar:t}=this._chartStore.getBarSpace(),o=(this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/t)*t;this.scrollByDistance(o,e)}scrollToDataIndex(e,t){const n=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-e))*this._chartStore.getBarSpace().bar;this.scrollByDistance(n,t)}scrollToTimestamp(e,t){const n=E2(this.getDataList(),"timestamp",e);this.scrollToDataIndex(n,t)}zoomAtCoordinate(e,t,n){const o=ul(n)&&n>0?n:0,{bar:r}=this._chartStore.getBarSpace(),l=r*e-r;if(o>0){let c=0;const f=new L2({duration:o});f.doFrame(u=>{const d=l*(u/o),h=(d-c)/this._chartStore.getBarSpace().bar*$2;this._chartStore.zoom(h,t),c=d}),f.start()}else this._chartStore.zoom(l/r*$2,t)}zoomAtDataIndex(e,t,n){const o=this._chartStore.dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:o,y:0},n)}zoomAtTimestamp(e,t,n){const o=E2(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,o,n)}convertToPixel(e,t){const{paneId:n=yd.CANDLE,absolute:o=!1}=t??{};let r=[];if(n!==yd.X_AXIS){const a=this.getDrawPaneById(n);if(a!==null){const l=a.getBounding(),c=[].concat(e),f=this._xAxisPane.getAxisComponent(),u=a.getAxisComponent();r=c.map(d=>{const h={};let p=d.dataIndex;if(ul(d.timestamp)&&(p=this._chartStore.timestampToDataIndex(d.timestamp)),ul(p)&&(h.x=f.convertToPixel(p)),ul(d.value)){const v=u.convertToPixel(d.value);h.y=o?l.top+v:v}return h})}}return lg(e)?r:r[0]??{}}convertFromPixel(e,t){const{paneId:n=yd.CANDLE,absolute:o=!1}=t??{};let r=[];if(n!==yd.X_AXIS){const a=this.getDrawPaneById(n);if(a!==null){const l=a.getBounding(),c=[].concat(e),f=this._xAxisPane.getAxisComponent(),u=a.getAxisComponent();r=c.map(d=>{const h={};if(ul(d.x)){const p=f.convertFromPixel(d.x);h.dataIndex=p,h.timestamp=this._chartStore.dataIndexToTimestamp(p)??void 0}if(ul(d.y)){const p=o?d.y-l.top:d.y;h.value=u.convertFromPixel(p)}return h})}}return lg(e)?r:r[0]??{}}executeAction(e,t){switch(e){case"onCrosshairChange":{const n={...t};n.paneId??(n.paneId=yd.CANDLE),this._chartStore.setCrosshair(n,{notExecuteAction:!0});break}}}subscribeAction(e,t){this._chartStore.subscribeAction(e,t)}unsubscribeAction(e,t){this._chartStore.unsubscribeAction(e,t)}getConvertPictureUrl(e,t,n){const{width:o,height:r}=this._chartBounding,a=l0("canvas",{width:`${o}px`,height:`${r}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=E0(a);a.width=o*c,a.height=r*c,l.scale(c,c),l.fillStyle=n??"#FFFFFF",l.fillRect(0,0,o,r);const f=e??!1;return this._drawPanes.forEach(u=>{const d=this._separatorPanes.get(u);if(Rn(d)){const p=d.getBounding();l.drawImage(d.getImage(f),p.left,p.top,p.width,p.height)}const h=u.getBounding();l.drawImage(u.getImage(f),0,h.top,o,h.height)}),a.toDataURL(`image/${t??"jpeg"}`)}resize(){this._cacheChartBounding(),!(this._chartBounding.width<=0||this._chartBounding.height<=0)&&this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}destroy(){this._chartEvent.destroy(),this._drawPanes.forEach(e=>{e.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._chartStore.destroy(),this._container.removeChild(this._chartContainer)}}const qb={Main:0,Overlay:1,Separator:2,Drawer:3,All:4},Fw=new Map;let xI=1;function wI(s,e){let t=null;if(Mf(s)?t=document.getElementById(s):t=s,t===null)return null;let n=Fw.get(t.id);if(Rn(n))return n;const o=`k_line_chart_${xI++}`;return n=new bI(t,e),n.id=o,t.setAttribute("duty-chart-id",o),Fw.set(o,n),n}const iv={clone:B_,merge:Bh,isString:Mf,isNumber:ul,isValid:Rn,isObject:Cv,isArray:lg,isFunction:cv,isBoolean:A1,formatValue:em,formatPrecision:Im,formatBigNumber:X6,formatDate:K6,formatThousands:Z6,formatFoldDecimal:J6,calcTextWidth:tm,getLinearSlopeIntercept:_b,getLinearYFromSlopeIntercept:wx,getLinearYFromCoordinates:T1,checkCoordinateOnArc:f5,checkCoordinateOnCircle:l5,checkCoordinateOnLine:t5,checkCoordinateOnPolygon:c5,checkCoordinateOnRect:Cx,checkCoordinateOnText:d5},mt={Solid:"solid",Dashed:"dashed"},I_={Fill:"fill",Stroke:"stroke",StrokeFill:"stroke_fill"},ig={OnZoom:"onZoom",OnScroll:"onScroll",OnVisibleRangeChange:"onVisibleRangeChange",OnCandleTooltipFeatureClick:"onCandleTooltipFeatureClick",OnIndicatorTooltipFeatureClick:"onIndicatorTooltipFeatureClick",OnCrosshairFeatureClick:"onCrosshairFeatureClick",OnCrosshairChange:"onCrosshairChange",OnCandleBarClick:"onCandleBarClick",OnPaneDrag:"onPaneDrag"},kI={Normal:"normal",WeakMagnet:"weak_magnet",StrongMagnet:"strong_magnet"},SI={Left:"left",Middle:"middle",Right:"right"},Lw={Always:"always",FollowCross:"follow_cross",None:"none"},CI={CandleSolid:"candle_solid",CandleStroke:"candle_stroke",CandleUpStroke:"candle_up_stroke",CandleDownStroke:"candle_down_stroke",Ohlc:"ohlc",Area:"area"},II={Tooltip:"tooltip",Crosshair:"crosshair",XAxis:"xAxis"};var Ub={local:{},session:{}};function PI(s){return s==="local"?localStorage:sessionStorage}function Fx(s,e,t){var n,o,r,a,l,c,f,u;const d=(n=void 0)!=null?n:JSON,h=(o=void 0)!=null?o:"local",p=(r=void 0)!=null?r:!0,v=(l=(a=void 0)!=null?a:void 0)!=null?l:j=>console.error(`Error when writing value from persisted store "${s}" to ${h}`,j),x=(c=void 0)!=null?c:(j,E)=>console.error(`Error when parsing ${j?'"'+j+'"':"value"} from persisted store "${s}"`,E),S=(f=void 0)!=null?f:j=>j,C=(u=void 0)!=null?u:j=>j,I=typeof window<"u"&&typeof document<"u",A=I?PI(h):null;function P(j,E){const L=C(E);try{A==null||A.setItem(j,d.stringify(L))}catch(D){v(D)}}function T(){function j(X){try{return d.parse(X)}catch(ne){x(X,ne)}}const E=A==null?void 0:A.getItem(s);if(E==null)return e;const L=j(E);return L==null?e:S(L)}if(!Ub[h][s]){const j=T(),E=Th(j,X=>{if(I&&h=="local"&&p){const ne=de=>{if(de.key===s&&de.newValue){let ie;try{ie=d.parse(de.newValue)}catch(le){x(de.newValue,le);return}const te=S(ie);X(te)}};return window.addEventListener("storage",ne),()=>window.removeEventListener("storage",ne)}}),{subscribe:L,set:D}=E;Ub[h][s]={set(X){D(X),P(s,X)},update(X){return E.update(ne=>{const de=X(ne);return P(s,de),de})},reset(){this.set(e)},subscribe:L}}return Ub[h][s]}const J_=II,Ov=iv.formatDate;let Lx=!0,Ex="UTC";xp.extend(Nx);xp.extend(Mx);xp.tz.setDefault("UTC");const j2=60,B2=j2*60,F1=B2*24,Ew=F1*7,$w=F1*30,Dw=F1*365,MI={"Africa/Abidjan":"utc","Pacific/Honolulu":"honolulu","America/Juneau":"juneau","America/Los_Angeles":"los_angeles","America/Chicago":"chicago","America/Toronto":"toronto","America/Sao_Paulo":"sao_paulo","Europe/London":"london","Europe/Berlin":"berlin","Asia/Bahrain":"bahrain","Asia/Dubai":"dubai","Asia/Ashkhabad":"ashkhabad","Asia/Almaty":"almaty","Asia/Bangkok":"bangkok","Asia/Shanghai":"shanghai","Asia/Tokyo":"tokyo","Australia/Sydney":"sydney","Pacific/Guadalcanal":"guadalcanal","Pacific/Auckland":"auckland"};function NI(){return xp().valueOf()}function Rw(s){if(!s)return 0;s=s.trim();const e=/^\d+$/.test(s);let t=null;if(e){const n=s.length;if(n==4){const o=new Date().getFullYear();t=xp(`${o}${s}`,"YYYYMMDD")}else if(n==6){const o=parseInt(s.substring(0,2)),r=o>50?1900+o:2e3+o,a=s.substring(2);t=xp(`${r}${a}`,"YYYYMMDD")}else if(n==8)t=xp(s,"YYYYMMDD");else if(n==10)t=xp.unix(parseInt(s));else if(n==12)t=xp(s,"YYYYMMDDHHmm");else if(n==13)t=xp(parseInt(s));else if(n==14)t=xp(s,"YYYYMMDDHHmmss");else return console.error("invalid date format:",s),0}else t=xp(s,["YYYY/MM/DD","YYYY/MM/DD HH:mm","YYYY/MM/DD HH:mm:ss","YYYY-MM-DD","YYYY-MM-DD HH:mm","YYYY-MM-DD HH:mm:ss"],!0);return!t||!t.isValid()?(console.error("Invalid date format or value:",s),0):(Lx||console.error("local timezone not applied"),t=t.tz(Ex,!0),t.valueOf())}function jw(s,e="YYYY-MM-DD HH:mm:ss",t=void 0){if(!s)return"--";let n=null;return s>1e12?n=xp(s):n=xp.unix(s),n=n.tz(t||Ex,!0),Lx||console.error("local timezone not applied"),n.format(e)}function AI(s,e,t){let n=e,o=n;switch(s.timespan){case"minute":{n=n-n%(60*1e3),o=n-t*s.multiplier*60*1e3;break}case"hour":{n=n-n%(60*60*1e3),o=n-t*s.multiplier*60*60*1e3;break}case"day":{n=n-n%(60*60*1e3),o=n-t*s.multiplier*24*60*60*1e3;break}case"week":{const a=new Date(n).getDay(),l=a===0?6:a-1;n=n-l*60*60*24;const c=new Date(n);n=new Date(`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`).getTime(),o=t*s.multiplier*7*24*60*60*1e3;break}case"month":{const r=new Date(n),a=r.getFullYear(),l=r.getMonth()+1;n=new Date(`${a}-${l}-01`).getTime(),o=t*s.multiplier*30*24*60*60*1e3;const c=new Date(o);o=new Date(`${c.getFullYear()}-${c.getMonth()+1}-01`).getTime();break}}return[o,n]}function fp(s){if(!s)return 0;const e=s.substring(s.length-1),t=parseInt(s.substring(0,s.length-1));let n=0;if(e=="y")n=31536e3;else if(e=="M")n=2592e3;else if(e=="w")n=604800;else if(e=="d")n=86400;else if(e=="h")n=3600;else if(e=="m")n=60;else if(e=="s")n=1;else throw Error(`unsupport timeframe: ${s}`);return n*t}function TI(s){return s>Dw?`${Math.floor(s/Dw)}y`:s>$w?`${Math.floor(s/$w)}M`:s>Ew?`${Math.floor(s/Ew)}w`:s>F1?`${Math.floor(s/F1)}d`:s>B2?`${Math.floor(s/B2)}h`:s>j2?`${Math.floor(s/j2)}m`:`${Math.floor(s)}s`}function FI(s){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};let t=null;try{t=new Intl.DateTimeFormat("en",e)}catch{console.error("","","Timezone is error!!!")}return t}const zv=FI();function Bw(s){function e(t,n,o){if(!t||isNaN(t)||t<=0)return new Date().toISOString().slice(0,19).replace("T"," ");switch(s){case"second":return o===J_.XAxis?Ov(zv,t,"HH:mm:ss"):Ov(zv,t,"YYYY-MM-DD HH:mm:ss");case"minute":return o===J_.XAxis?Ov(zv,t,"HH:mm"):Ov(zv,t,"YYYY-MM-DD HH:mm");case"hour":return o===J_.XAxis?Ov(zv,t,"MM-DD HH:mm"):Ov(zv,t,"YYYY-MM-DD HH:mm");case"day":case"week":return Ov(zv,t,"YYYY-MM-DD");case"month":return o===J_.XAxis?Ov(zv,t,"YYYY-MM"):Ov(zv,t,"YYYY-MM-DD");case"year":return o===J_.XAxis?Ov(zv,t,"YYYY"):Ov(zv,t,"YYYY-MM-DD")}return Ov(zv,t,"YYYY-MM-DD HH:mm")}return e}async function Ow(s){s&&(s=="Africa/Abidjan"||s.toLowerCase().indexOf("utc")>=0)&&(s="UTC"),xp.tz.setDefault(s),Ex=s,Lx=!0}function LI(){return Object.entries(MI).map(([s,e])=>({key:s,text:e}))}const EI=()=>"Time",$I=()=>"时间",DI=(s={},e={})=>({en:EI,"zh-CN":$I})[e.languageTag??so()](),RI=()=>"O",jI=()=>"开",BI=(s={},e={})=>({en:RI,"zh-CN":jI})[e.languageTag??so()](),OI=()=>"H",zI=()=>"高",VI=(s={},e={})=>({en:OI,"zh-CN":zI})[e.languageTag??so()](),WI=()=>"L",HI=()=>"低",qI=(s={},e={})=>({en:WI,"zh-CN":HI})[e.languageTag??so()](),UI=()=>"C",GI=()=>"收",YI=(s={},e={})=>({en:UI,"zh-CN":GI})[e.languageTag??so()](),KI=()=>"vol",XI=()=>"量",ZI=(s={},e={})=>({en:KI,"zh-CN":XI})[e.languageTag??so()](),JI=()=>"Chg",QI=()=>"涨跌",eP=(s={},e={})=>({en:JI,"zh-CN":QI})[e.languageTag??so()](),tP=()=>"Timeframe",sP=()=>"周期",T5=(s={},e={})=>({en:tP,"zh-CN":sP})[e.languageTag??so()](),nP=()=>"No Data",oP=()=>"数据为空",iP=(s={},e={})=>({en:nP,"zh-CN":oP})[e.languageTag??so()](),rP=()=>"Indicator",aP=()=>"指标",$x=(s={},e={})=>({en:rP,"zh-CN":aP})[e.languageTag??so()](),lP=()=>"Timezone",cP=()=>"时区",F5=(s={},e={})=>({en:lP,"zh-CN":cP})[e.languageTag??so()](),uP=()=>"Setting",dP=()=>"设置",fP=(s={},e={})=>({en:uP,"zh-CN":dP})[e.languageTag??so()](),pP=()=>"Confirm",hP=()=>"确认",mP=(s={},e={})=>({en:pP,"zh-CN":hP})[e.languageTag??so()](),vP=()=>"Cancel",gP=()=>"取消",_P=(s={},e={})=>({en:vP,"zh-CN":gP})[e.languageTag??so()](),yP=()=>"Search Symbol",bP=()=>"搜索品种",L5=(s={},e={})=>({en:yP,"zh-CN":bP})[e.languageTag??so()](),xP=()=>"This indicator has no parameters",wP=()=>"该指标没有参数",E5=(s={},e={})=>({en:xP,"zh-CN":wP})[e.languageTag??so()](),kP=()=>"Search",SP=()=>"搜索",$5=(s={},e={})=>({en:kP,"zh-CN":SP})[e.languageTag??so()](),CP=()=>"Settings",IP=()=>"设置",D5=(s={},e={})=>({en:CP,"zh-CN":IP})[e.languageTag??so()](),PP=()=>"Screenshot",MP=()=>"截图",NP=(s={},e={})=>({en:PP,"zh-CN":MP})[e.languageTag??so()](),AP=()=>"Grid Show",TP=()=>"显示网格",FP=(s={},e={})=>({en:AP,"zh-CN":TP})[e.languageTag??so()](),LP=()=>"Restore",EP=()=>"恢复",$P=(s={},e={})=>({en:LP,"zh-CN":EP})[e.languageTag??so()](),DP=()=>"Reset",RP=()=>"重置",jP=(s={},e={})=>({en:DP,"zh-CN":RP})[e.languageTag??so()](),BP=()=>"Candlestick Type",OP=()=>"蜡烛图类型",zP=(s={},e={})=>({en:BP,"zh-CN":OP})[e.languageTag??so()](),VP=()=>"Candlestick",WP=()=>"全实心",HP=(s={},e={})=>({en:VP,"zh-CN":WP})[e.languageTag??so()](),qP=()=>"Hollow",UP=()=>"全空心",GP=(s={},e={})=>({en:qP,"zh-CN":UP})[e.languageTag??so()](),YP=()=>"Up Hollow",KP=()=>"涨空心",XP=(s={},e={})=>({en:YP,"zh-CN":KP})[e.languageTag??so()](),ZP=()=>"Down Hollow",JP=()=>"跌空心",QP=(s={},e={})=>({en:ZP,"zh-CN":JP})[e.languageTag??so()](),eM=()=>"OHLC",tM=()=>"OHLC",sM=(s={},e={})=>({en:eM,"zh-CN":tM})[e.languageTag??so()](),nM=()=>"Area",oM=()=>"面积图",iM=(s={},e={})=>({en:nM,"zh-CN":oM})[e.languageTag??so()](),rM=()=>"Price Axis Type",aM=()=>"价格轴类型",lM=(s={},e={})=>({en:rM,"zh-CN":aM})[e.languageTag??so()](),cM=()=>"Reverse Coordinate",uM=()=>"反转坐标",dM=(s={},e={})=>({en:cM,"zh-CN":uM})[e.languageTag??so()](),fM=()=>"Show Last Price",pM=()=>"显示最新价",hM=(s={},e={})=>({en:fM,"zh-CN":pM})[e.languageTag??so()](),mM=()=>"Show High Price",vM=()=>"显示最高价",gM=(s={},e={})=>({en:mM,"zh-CN":vM})[e.languageTag??so()](),_M=()=>"Show Low Price",yM=()=>"显示最低价",bM=(s={},e={})=>({en:_M,"zh-CN":yM})[e.languageTag??so()](),xM=()=>"Show Indicator Last Value",wM=()=>"显示指标最新值",kM=(s={},e={})=>({en:xM,"zh-CN":wM})[e.languageTag??so()](),SM=()=>"Param ",CM=()=>"参数",R5=(s={},e={})=>({en:SM,"zh-CN":CM})[e.languageTag??so()](),IM=()=>"Period",PM=()=>"周期",O2=(s={},e={})=>({en:IM,"zh-CN":PM})[e.languageTag??so()](),MM=()=>"StdDev",NM=()=>"标准差",j5=(s={},e={})=>({en:MM,"zh-CN":NM})[e.languageTag??so()](),AM=()=>"Normal",TM=()=>"正常",FM=(s={},e={})=>({en:AM,"zh-CN":TM})[e.languageTag??so()](),LM=()=>"Percentage",EM=()=>"百分比",$M=(s={},e={})=>({en:LM,"zh-CN":EM})[e.languageTag??so()](),DM=()=>"Log",RM=()=>"对数",jM=(s={},e={})=>({en:DM,"zh-CN":RM})[e.languageTag??so()](),BM=()=>" Bars",OM=()=>"根",B5=(s={},e={})=>({en:BM,"zh-CN":OM})[e.languageTag??so()](),zM=()=>"days",VM=()=>"天",O5=(s={},e={})=>({en:zM,"zh-CN":VM})[e.languageTag??so()](),WM=()=>"hours",HM=()=>"时",z5=(s={},e={})=>({en:WM,"zh-CN":HM})[e.languageTag??so()](),qM=()=>"mins",UM=()=>"分",z2=(s={},e={})=>({en:qM,"zh-CN":UM})[e.languageTag??so()](),GM=()=>"Minutes",YM=()=>"分钟",V5=(s={},e={})=>({en:GM,"zh-CN":YM})[e.languageTag??so()](),KM=()=>"Hours",XM=()=>"小时",W5=(s={},e={})=>({en:KM,"zh-CN":XM})[e.languageTag??so()](),ZM=()=>"Days",JM=()=>"日",H5=(s={},e={})=>({en:ZM,"zh-CN":JM})[e.languageTag??so()](),QM=()=>"Weeks",e7=()=>"周",q5=(s={},e={})=>({en:QM,"zh-CN":e7})[e.languageTag??so()](),t7=()=>"Months",s7=()=>"月",U5=(s={},e={})=>({en:t7,"zh-CN":s7})[e.languageTag??so()](),n7=()=>"Horizontal Straight Line",o7=()=>"水平直线",i7=(s={},e={})=>({en:n7,"zh-CN":o7})[e.languageTag??so()](),r7=()=>"Horizontal Ray Line",a7=()=>"水平射线",l7=(s={},e={})=>({en:r7,"zh-CN":a7})[e.languageTag??so()](),c7=()=>"Horizontal Segment",u7=()=>"水平线段",d7=(s={},e={})=>({en:c7,"zh-CN":u7})[e.languageTag??so()](),f7=()=>"Vertical Straight Line",p7=()=>"垂直直线",h7=(s={},e={})=>({en:f7,"zh-CN":p7})[e.languageTag??so()](),m7=()=>"Vertical Ray Line",v7=()=>"垂直射线",g7=(s={},e={})=>({en:m7,"zh-CN":v7})[e.languageTag??so()](),_7=()=>"Vertical Segment",y7=()=>"垂直线段",b7=(s={},e={})=>({en:_7,"zh-CN":y7})[e.languageTag??so()](),x7=()=>"Straight Line",w7=()=>"直线",k7=(s={},e={})=>({en:x7,"zh-CN":w7})[e.languageTag??so()](),S7=()=>"Ray Line",C7=()=>"射线",I7=(s={},e={})=>({en:S7,"zh-CN":C7})[e.languageTag??so()](),P7=()=>"Segment",M7=()=>"线段",N7=(s={},e={})=>({en:P7,"zh-CN":M7})[e.languageTag??so()](),A7=()=>"Arrow",T7=()=>"箭头",F7=(s={},e={})=>({en:A7,"zh-CN":T7})[e.languageTag??so()](),L7=()=>"Price Line",E7=()=>"价格线",$7=(s={},e={})=>({en:L7,"zh-CN":E7})[e.languageTag??so()](),D7=()=>"Price Channel Line",R7=()=>"价格通道线",j7=(s={},e={})=>({en:D7,"zh-CN":R7})[e.languageTag??so()](),B7=()=>"Parallel Straight Line",O7=()=>"平行直线",z7=(s={},e={})=>({en:B7,"zh-CN":O7})[e.languageTag??so()](),V7=()=>"Fibonacci Retracement Segment",W7=()=>"斐波那契回调线段",H7=(s={},e={})=>({en:V7,"zh-CN":W7})[e.languageTag??so()](),q7=()=>"Fibonacci Circle",U7=()=>"斐波那契圆环",G7=(s={},e={})=>({en:q7,"zh-CN":U7})[e.languageTag??so()](),Y7=()=>"Fibonacci Spiral",K7=()=>"斐波那契螺旋",X7=(s={},e={})=>({en:Y7,"zh-CN":K7})[e.languageTag??so()](),Z7=()=>"Fibonacci Speed Resistance Fan",J7=()=>"斐波那契速度阻力扇",Q7=(s={},e={})=>({en:Z7,"zh-CN":J7})[e.languageTag??so()](),eN=()=>"Fibonacci Extension",tN=()=>"斐波那契趋势扩展",sN=(s={},e={})=>({en:eN,"zh-CN":tN})[e.languageTag??so()](),nN=()=>"Gann Box",oN=()=>"江恩箱",iN=(s={},e={})=>({en:nN,"zh-CN":oN})[e.languageTag??so()](),rN=()=>"Rectangle",aN=()=>"矩形",lN=(s={},e={})=>({en:rN,"zh-CN":aN})[e.languageTag??so()](),cN=()=>"Parallelogram",uN=()=>"平行四边形",dN=(s={},e={})=>({en:cN,"zh-CN":uN})[e.languageTag??so()](),fN=()=>"Circle",pN=()=>"圆",hN=(s={},e={})=>({en:fN,"zh-CN":pN})[e.languageTag??so()](),mN=()=>"Triangle",vN=()=>"三角形",gN=(s={},e={})=>({en:mN,"zh-CN":vN})[e.languageTag??so()](),_N=()=>"Three Waves",yN=()=>"三浪",bN=(s={},e={})=>({en:_N,"zh-CN":yN})[e.languageTag??so()](),xN=()=>"Five Waves",wN=()=>"五浪",kN=(s={},e={})=>({en:xN,"zh-CN":wN})[e.languageTag??so()](),SN=()=>"Eight Waves",CN=()=>"八浪",IN=(s={},e={})=>({en:SN,"zh-CN":CN})[e.languageTag??so()](),PN=()=>"Any Waves",MN=()=>"任意浪",NN=(s={},e={})=>({en:PN,"zh-CN":MN})[e.languageTag??so()](),AN=()=>"ABCD Pattern",TN=()=>"ABCD形态",FN=(s={},e={})=>({en:AN,"zh-CN":TN})[e.languageTag??so()](),LN=()=>"XABCD Pattern",EN=()=>"XABCD形态",$N=(s={},e={})=>({en:LN,"zh-CN":EN})[e.languageTag??so()](),DN=()=>"Weak Magnet Mode",RN=()=>"弱磁模式",jN=(s={},e={})=>({en:DN,"zh-CN":RN})[e.languageTag??so()](),BN=()=>"Strong Magnet Mode",ON=()=>"强磁模式",zN=(s={},e={})=>({en:BN,"zh-CN":ON})[e.languageTag??so()](),VN=()=>"Moving Average",WN=()=>"移动平均",HN=(s={},e={})=>({en:VN,"zh-CN":WN})[e.languageTag??so()](),qN=()=>"Exponential Moving Average",UN=()=>"指数移动平均",GN=(s={},e={})=>({en:qN,"zh-CN":UN})[e.languageTag??so()](),YN=()=>"Simple Moving Average",KN=()=>"简单移动平均",XN=(s={},e={})=>({en:YN,"zh-CN":KN})[e.languageTag??so()](),ZN=()=>"Bollinger Bands",JN=()=>"布林线",QN=(s={},e={})=>({en:ZN,"zh-CN":JN})[e.languageTag??so()](),eA=()=>"Parabolic SAR",tA=()=>"抛物线转向",sA=(s={},e={})=>({en:eA,"zh-CN":tA})[e.languageTag??so()](),nA=()=>"Bull and Bear Index",oA=()=>"多空指标",iA=(s={},e={})=>({en:nA,"zh-CN":oA})[e.languageTag??so()](),rA=()=>"Volume",aA=()=>"成交量",lA=(s={},e={})=>({en:rA,"zh-CN":aA})[e.languageTag??so()](),cA=()=>"Moving Average Convergence Divergence",uA=()=>"平滑异同移动平均线",dA=(s={},e={})=>({en:cA,"zh-CN":uA})[e.languageTag??so()](),fA=()=>"KDJ Index",pA=()=>"随机指标",hA=(s={},e={})=>({en:fA,"zh-CN":pA})[e.languageTag??so()](),mA=()=>"Relative Strength Index",vA=()=>"相对强弱指数",gA=(s={},e={})=>({en:mA,"zh-CN":vA})[e.languageTag??so()](),_A=()=>"Bias",yA=()=>"乖离率",bA=(s={},e={})=>({en:_A,"zh-CN":yA})[e.languageTag??so()](),xA=()=>"Bull and Bear Ratio",wA=()=>"人气意愿指标",kA=(s={},e={})=>({en:xA,"zh-CN":wA})[e.languageTag??so()](),SA=()=>"Commodity Channel Index",CA=()=>"顺势指标",IA=(s={},e={})=>({en:SA,"zh-CN":CA})[e.languageTag??so()](),PA=()=>"Energy",MA=()=>"能量指标",NA=(s={},e={})=>({en:PA,"zh-CN":MA})[e.languageTag??so()](),AA=()=>"Psychological Line",TA=()=>"心理线",FA=(s={},e={})=>({en:AA,"zh-CN":TA})[e.languageTag??so()](),LA=()=>"Parallel Line Difference",EA=()=>"平行线差指标",$A=(s={},e={})=>({en:LA,"zh-CN":EA})[e.languageTag??so()](),DA=()=>"Triple Exponential Moving Average",RA=()=>"三重指数平滑移动平均线",jA=(s={},e={})=>({en:DA,"zh-CN":RA})[e.languageTag??so()](),BA=()=>"On Balance Volume",OA=()=>"能量潮",zA=(s={},e={})=>({en:BA,"zh-CN":OA})[e.languageTag??so()](),VA=()=>"Volume Variation Rate",WA=()=>"成交量变异率",HA=(s={},e={})=>({en:VA,"zh-CN":WA})[e.languageTag??so()](),qA=()=>"Williams Percentage Range",UA=()=>"威廉指标",GA=(s={},e={})=>({en:qA,"zh-CN":UA})[e.languageTag??so()](),YA=()=>"Momentum",KA=()=>"动量指标",XA=(s={},e={})=>({en:YA,"zh-CN":KA})[e.languageTag??so()](),ZA=()=>"Ease of Movement",JA=()=>"简易波动指标",QA=(s={},e={})=>({en:ZA,"zh-CN":JA})[e.languageTag??so()](),eT=()=>"Rate of Change",tT=()=>"变动率指标",sT=(s={},e={})=>({en:eT,"zh-CN":tT})[e.languageTag??so()](),nT=()=>"Price Volume Trend",oT=()=>"量价趋势",iT=(s={},e={})=>({en:nT,"zh-CN":oT})[e.languageTag??so()](),rT=()=>"Awesome Oscillator",aT=()=>"震荡指标",lT=(s={},e={})=>({en:rT,"zh-CN":aT})[e.languageTag??so()](),cT=()=>"Directional Movement Index",uT=()=>"趋向指标",dT=(s={},e={})=>({en:cT,"zh-CN":uT})[e.languageTag??so()](),fT=()=>"Coordinated Universal Time (UTC)",pT=()=>"世界统一时间",hT=(s={},e={})=>({en:fT,"zh-CN":pT})[e.languageTag??so()](),mT=()=>"(UTC-10) Honolulu",vT=()=>"(UTC-10) 檀香山",gT=(s={},e={})=>({en:mT,"zh-CN":vT})[e.languageTag??so()](),_T=()=>"(UTC-8) Juneau",yT=()=>"(UTC-8) 朱诺",bT=(s={},e={})=>({en:_T,"zh-CN":yT})[e.languageTag??so()](),xT=()=>"(UTC-7) Los Angeles",wT=()=>"(UTC-7) 洛杉矶",kT=(s={},e={})=>({en:xT,"zh-CN":wT})[e.languageTag??so()](),ST=()=>"(UTC-5) Chicago",CT=()=>"(UTC-5) 芝加哥",IT=(s={},e={})=>({en:ST,"zh-CN":CT})[e.languageTag??so()](),PT=()=>"(UTC-4) Toronto",MT=()=>"(UTC-4) 多伦多",NT=(s={},e={})=>({en:PT,"zh-CN":MT})[e.languageTag??so()](),AT=()=>"(UTC-3) São Paulo",TT=()=>"(UTC-3) 圣保罗",FT=(s={},e={})=>({en:AT,"zh-CN":TT})[e.languageTag??so()](),LT=()=>"(UTC+1) London",ET=()=>"(UTC+1) 伦敦",$T=(s={},e={})=>({en:LT,"zh-CN":ET})[e.languageTag??so()](),DT=()=>"(UTC+2) Berlin",RT=()=>"(UTC+2) 柏林",jT=(s={},e={})=>({en:DT,"zh-CN":RT})[e.languageTag??so()](),BT=()=>"(UTC+3) Bahrain",OT=()=>"(UTC+3) 巴林",zT=(s={},e={})=>({en:BT,"zh-CN":OT})[e.languageTag??so()](),VT=()=>"(UTC+4) Dubai",WT=()=>"(UTC+4) 迪拜",HT=(s={},e={})=>({en:VT,"zh-CN":WT})[e.languageTag??so()](),qT=()=>"(UTC+5) Ashkhabad",UT=()=>"(UTC+5) 阿什哈巴德",GT=(s={},e={})=>({en:qT,"zh-CN":UT})[e.languageTag??so()](),YT=()=>"(UTC+6) Almaty",KT=()=>"(UTC+6) 阿拉木图",XT=(s={},e={})=>({en:YT,"zh-CN":KT})[e.languageTag??so()](),ZT=()=>"(UTC+7) Bangkok",JT=()=>"(UTC+7) 曼谷",QT=(s={},e={})=>({en:ZT,"zh-CN":JT})[e.languageTag??so()](),eF=()=>"(UTC+8) Shanghai",tF=()=>"(UTC+8) 上海",sF=(s={},e={})=>({en:eF,"zh-CN":tF})[e.languageTag??so()](),nF=()=>"(UTC+9) Tokyo",oF=()=>"(UTC+9) 东京",iF=(s={},e={})=>({en:nF,"zh-CN":oF})[e.languageTag??so()](),rF=()=>"(UTC+10) Sydney",aF=()=>"(UTC+10) 悉尼",lF=(s={},e={})=>({en:rF,"zh-CN":aF})[e.languageTag??so()](),cF=()=>"(UTC+11) Solomon Islands",uF=()=>"(UTC+11) 所罗门群岛",dF=(s={},e={})=>({en:cF,"zh-CN":uF})[e.languageTag??so()](),fF=()=>"(UTC+12) Auckland",pF=()=>"(UTC+12) 奥克兰",hF=(s={},e={})=>({en:fF,"zh-CN":pF})[e.languageTag??so()](),Hv=Object.freeze(Object.defineProperty({__proto__:null,AO:lT,BBI:iA,BIAS:bA,BOLL:QN,BRAR:kA,CCI:IA,CR:NA,DMA:$A,DMI:dT,EMA:GN,EMV:QA,KDJ:hA,MA:HN,MACD:dA,MTM:XA,OBV:zA,PSY:FA,PVT:iT,ROC:sT,RSI:gA,SAR:sA,SMA:XN,TRIX:jA,VOL:lA,VR:HA,WR:GA,abcd:FN,almaty:XT,any_waves:NN,area:iM,arrow:F7,ashkhabad:GT,auckland:hF,bahrain:zT,bangkok:QT,berlin:jT,cancel:_P,candle_down_stroke:QP,candle_solid:HP,candle_stroke:GP,candle_type:zP,candle_up_stroke:XP,change_:eP,chicago:IT,circle:hN,close_:YI,confirm:mP,day:H5,days:O5,dubai:HT,eight_waves:IN,fibonacci_circle:G7,fibonacci_extension:sN,fibonacci_segment:H7,fibonacci_speed_resistance_fan:Q7,fibonacci_spiral:X7,five_waves:kN,gann_box:iN,grid_show:FP,guadalcanal:dF,high_:VI,high_price_show:gM,honolulu:gT,horizontal_ray_line:l7,horizontal_segment:d7,horizontal_straight_line:i7,hour:W5,hours:z5,indicator:$x,indicator_last_value_show:kM,juneau:bT,last_price_show:hM,log:jM,london:$T,los_angeles:kT,low_:qI,low_price_show:bM,mins:z2,minute:V5,month:U5,no_data:iP,no_ind_params:E5,normal:FM,num_bar:B5,ohlc:sM,open_:BI,parallel_straight_line:z7,parallelogram:dN,param:R5,percentage:$M,period:O2,price_axis_type:lM,price_channel_line:j7,price_line:$7,ray_line:I7,rect:lN,reset:jP,restore:$P,reverse_coordinate:dM,sao_paulo:FT,screenshot:NP,search:$5,segment:N7,setting:fP,settings:D5,shanghai:sF,standard_deviation:j5,straight_line:k7,strongMagnet:zN,sydney:lF,symbol_search:L5,three_waves:bN,time_:DI,timeframe:T5,timezone:F5,tokyo:iF,toronto:NT,triangle:gN,utc:hT,vertical_ray_line:g7,vertical_segment:b7,vertical_straight_line:h7,volume_:ZI,weakMagnet:jN,week:q5,xabcd:$N},Symbol.toStringTag,{value:"Module"})),mF=["MA","EMA","SMA","BOLL","SAR","BBI"],vF=["VOL","MACD","KDJ","RSI","BIAS","BRAR","CCI","DMI","CR","PSY","TRIX","OBV","VR","WR","MTM","EMV","ROC","PVT","AO"];class G5{constructor(){Pe(this,"editPaneId");Pe(this,"editIndName");Pe(this,"modalIndCfg");Pe(this,"fireOhlcv");Pe(this,"dutyLoaded");Pe(this,"cloudIndLoaded");Pe(this,"initDone");Pe(this,"clickChart");Pe(this,"loadingDuty");Pe(this,"loadingPairs");Pe(this,"timeStart");Pe(this,"timeEnd");Pe(this,"allInds");Pe(this,"isApplyingManualStyles");Pe(this,"applyCanvasColors");Pe(this,"clearCciGroups");Pe(this,"clearEmvGroups");Pe(this,"clearMtmGroups");Pe(this,"clearObvGroups");Pe(this,"clearPsyGroups");Pe(this,"clearPvtGroups");Pe(this,"clearRocGroups");Pe(this,"clearVolGroups");Pe(this,"clearWrGroups");this.editPaneId="",this.editIndName="",this.modalIndCfg=!1,this.fireOhlcv=0,this.dutyLoaded=0,this.cloudIndLoaded=0,this.initDone=0,this.clickChart=0,this.loadingDuty=!1,this.loadingPairs=!1,this.timeStart=0,this.timeEnd=0,this.allInds=[],this.isApplyingManualStyles=!1,this.clearCciGroups=0,this.clearEmvGroups=0,this.clearMtmGroups=0,this.clearObvGroups=0,this.clearPsyGroups=0,this.clearPvtGroups=0,this.clearRocGroups=0,this.clearVolGroups=0,this.clearWrGroups=0;for(let e of mF){const t=`${e} (${Hv[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!0})}for(let e of vF){const t=`${e} (${Hv[e]()})`;this.allInds.push({name:e,title:t,cloud:!1,is_main:!1})}}}class Py{constructor(){Pe(this,"showDrawBar");Pe(this,"showSidebar");Pe(this,"period");Pe(this,"symbol");Pe(this,"dateStart");Pe(this,"dateEnd");Pe(this,"timezone");Pe(this,"curSymbols");Pe(this,"allSymbols");Pe(this,"allExgs");Pe(this,"colorLong");Pe(this,"colorShort");Pe(this,"saveInds");Pe(this,"key");Pe(this,"theme");Pe(this,"styles");Pe(this,"options");this.showDrawBar=!0,this.showSidebar=!0,this.symbol={name:"Grameen Phone Limited",ticker:"GP",market:"stock",exchange:"DSEBD",type:"stock",priceCurrency:"BDT"},this.period={multiplier:1,timespan:"day",timeframe:"1d",secs:86400};const e=NI();this.dateEnd=jw(e,"YYYYMMDD");const t=e-this.period.secs*1e3*500;this.dateStart=jw(t,"YYYYMMDD"),this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,this.curSymbols=[],this.allSymbols=[],this.allExgs=new Set,this.colorLong="#0000FF",this.colorShort="#FF0000",this.saveInds={},this.key="",this.theme="dark",this.styles={pane:{backgroundColor:"#0A0F1A"},candle:{pane:{backgroundColor:"#0A0F1A"},type:"renko_atr",bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",upBorderColor:"#26A69A",downBorderColor:"#EF5350",noChangeBorderColor:"#888888",upWickColor:"#26A69A",downWickColor:"#EF5350",noChangeWickColor:"#888888"},renko:{method:"ATR",atrLength:14,source:"close",wick:!1},pnf:{boxSizeMode:"absolute",boxSize:1,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}},grid:{horizontal:{color:"#111B2B"},vertical:{color:"#111B2B"}}},this.options={enableRealtime:!1,datafeed:{sessionMode:"regular",adjustMode:"none"}}}}function V2(s,e){const t=e.x>s.x?0:1,n=iv.getLinearSlopeIntercept(s,e);let o;n?o=Math.atan(n[0])+Math.PI*t:e.y>s.y?o=Math.PI/2:o=Math.PI/2*3;const r=S1({x:e.x-8,y:e.y+4},e,o),a=S1({x:e.x-8,y:e.y-4},e,o);return[{type:"line",attrs:{coordinates:[s,e]}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[r,e,a]}}]}function S1(s,e,t){const n=(s.x-e.x)*Math.cos(t)-(s.y-e.y)*Math.sin(t)+e.x,o=(s.x-e.x)*Math.sin(t)+(s.y-e.y)*Math.cos(t)+e.y;return{x:n,y:o}}function W2(s,e){if(s.length>1){let t;const n=s[0],o=s[1];return n.x===o.x&&n.y!==o.y?n.y<o.y?t={x:n.x,y:e.height}:t={x:n.x,y:0}:n.x>o.x?t={x:0,y:iv.getLinearYFromCoordinates(n,o,{x:0,y:n.y})}:t={x:e.width,y:iv.getLinearYFromCoordinates(n,o,{x:e.width,y:n.y})},{coordinates:[n,t]}}return[]}function Y5(s,e){const t=Math.abs(s.x-e.x),n=Math.abs(s.y-e.y);return Math.sqrt(t*t+n*n)}function Dx(s,e,t){let n=2;try{(t==null?void 0:t.isInCandle())??!0?n=2:n=4}catch{n=2}return n}const K5={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>s.length>1?V2(s[0],s[1]):[]},X5={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:s})=>{if(s.length>1){const e=Y5(s[0],s[1]),t=[];return t.push({type:"circle",attrs:{...s[0],r:e+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),t.push({type:"circle",attrs:{...s[0],r:e},styles:{style:"stroke_fill"}}),t}return[]}},Z5={name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:s})=>{if(s.length>1){const e=[],n=[{x:s[0].x-30,y:s[0].y-30},{x:s[1].x+30,y:s[0].y-30},{x:s[1].x+30,y:s[1].y+30},{x:s[0].x-30,y:s[1].y+30}];return e.push({type:"polygon",attrs:{coordinates:n},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),e.push({type:"polygon",attrs:{coordinates:[s[0],{x:s[1].x,y:s[0].y},s[1],{x:s[0].x,y:s[1].y}]},styles:{style:"stroke_fill"}}),e}return[]}},J5={name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:s})=>{if(s.length===2)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:s}}];if(s.length===3){const e={x:s[0].x+(s[2].x-s[1].x),y:s[2].y};return[{type:"polygon",attrs:{coordinates:[s[0],s[1],s[2],e]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:({points:s,performPointIndex:e,performPoint:t})=>{e<2&&(s[0].price=t.price,s[1].price=t.price)},performEventMoveForDrawing:({currentStep:s,points:e,performPoint:t})=>{s===2&&(e[0].price=t.price)}},Q5={name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:s})=>[{type:"polygon",attrs:{coordinates:s},styles:{style:"stroke_fill"}}]},e3={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,overlay:e})=>{var t,n,o,r;if(s.length>1){const a=Math.abs(s[0].x-s[1].x),l=Math.abs(s[0].y-s[1].y),c=Math.sqrt(a*a+l*l),f=[.236,.382,.5,.618,.786,1],u=[],d=[];return f.forEach(h=>{const p=c*h;u.push({...s[0],r:p}),d.push({x:s[0].x,y:s[0].y+p+6,text:`${(h*100).toFixed(1)}%`})}),[{type:"circle",attrs:u,styles:{style:"stroke",borderSize:((n=(t=e.styles)==null?void 0:t.line)==null?void 0:n.size)??2}},{type:"text",ignoreEvent:!0,attrs:d,styles:{color:((r=(o=e.styles)==null?void 0:o.line)==null?void 0:r.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}return[]}},gF=[{value:0,color:"#FF6B6B",visible:!0},{value:.236,color:"#4ECDC4",visible:!0},{value:.382,color:"#45B7D1",visible:!0},{value:.5,color:"#96CEB4",visible:!0},{value:.618,color:"#FFEAA7",visible:!0},{value:1,color:"#98D8C8",visible:!0},{value:1.618,color:"#85C1E9",visible:!0}],_F=15;function t3(s){return typeof s!="number"||Number.isNaN(s)?_F:Math.max(0,Math.min(100,s))}function yF(s){const e=(s||"").trim();if(!e)return null;if(/^#([0-9a-f]{6})$/i.test(e))return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(e)){const n=e[1],o=e[2],r=e[3];return{r:parseInt(n+n,16),g:parseInt(o+o,16),b:parseInt(r+r,16)}}const t=e.match(/^rgba?\(([^)]+)\)$/i);if(t){const n=t[1].split(",").map(o=>parseFloat(o.trim()));if(n.length>=3&&n.every(o=>!Number.isNaN(o)))return{r:Math.round(n[0]),g:Math.round(n[1]),b:Math.round(n[2])}}return null}function bF(s,e){const t=yF(s);if(!t)return s;const n=t3(e)/100;return`rgba(${t.r}, ${t.g}, ${t.b}, ${n})`}const s3={name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{line:{size:1,color:"#1e88e5"},polygon:{color:"rgba(30, 136, 229, 0.1)"}},createPointFigures:({chart:s,coordinates:e,overlay:t,yAxis:n})=>{var a,l,c,f,u,d,h,p,v,x,S,C,I;const o=Dx(s,t,n),r=[];if(e.length>1){const A=t.points,P=(a=A[0])==null?void 0:a.value,T=(l=A[1])==null?void 0:l.value;if(P===void 0||T===void 0)return r;const j=T-P,E=e[0].y,L=e[1].y,D=L-E,ne=(((c=t.extendData)==null?void 0:c.fibonacciLevels)||t.fibonacciLevels||gF).filter(De=>De.visible);for(let De=0;De<ne.length-1;De++){const Oe=ne[De],Ke=ne[De+1],kt=L-D*Oe.value,pt=L-D*Ke.value,Rt=t3(Oe.opacity);r.push({type:"polygon",attrs:{coordinates:[{x:e[0].x,y:kt},{x:e[1].x,y:kt},{x:e[1].x,y:pt},{x:e[0].x,y:pt}]},styles:{style:"fill",color:bF(Oe.color,Rt)}})}const de=[],ie=[],te=t.extendData||{},le=String(te.labelSide??te.labelPosition??"left").trim().toLowerCase(),pe=te.labelGap??te.labelOffset??12,re=typeof pe=="number"&&Number.isFinite(pe)?Math.max(0,pe):12,xe=String(te.labelAlign||"").trim().toLowerCase(),se=Math.min(e[0].x,e[1].x),Ne=Math.max(e[0].x,e[1].x),Te=le==="right"?Ne+re:se-re,Me=xe==="left"||xe==="center"||xe==="right"?xe:le==="right"?"left":"right";ne.forEach(De=>{const Oe=L-D*De.value,Ke=(T-j*De.value).toFixed(o);de.push({coordinates:[{x:e[0].x,y:Oe},{x:e[1].x,y:Oe}]}),ie.push({x:Te,y:Oe,text:`${(De.value*100).toFixed(1)}% (${Ke})`,baseline:"middle",align:Me})}),r.push({type:"line",attrs:de,styles:{size:24,color:"transparent"}}),r.push({type:"line",attrs:de,styles:{size:((u=(f=t.styles)==null?void 0:f.line)==null?void 0:u.size)||1,color:((h=(d=t.styles)==null?void 0:d.line)==null?void 0:h.color)||"#1e88e5"}}),r.push({type:"text",ignoreEvent:!0,attrs:ie,styles:{color:((v=(p=t.styles)==null?void 0:p.text)==null?void 0:v.color)||"#666666",backgroundColor:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"solid",size:24,color:"transparent"}}),r.push({type:"line",attrs:{coordinates:[e[0],e[1]]},styles:{style:"dashed",size:((S=(x=t.styles)==null?void 0:x.line)==null?void 0:S.size)||1,color:((I=(C=t.styles)==null?void 0:C.line)==null?void 0:I.color)||"#1e88e5"}})}return r}},n3={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e})=>{if(s.length>1){const t=Y5(s[0],s[1])/Math.sqrt(24),n=s[1].x>s[0].x?0:1,o=iv.getLinearSlopeIntercept(s[0],s[1]);let r;o?r=Math.atan(o[0])+Math.PI*n:s[1].y>s[0].y?r=Math.PI/2:r=Math.PI/2*3;const a=S1({x:s[0].x-t,y:s[0].y},s[0],r),l=S1({x:s[0].x-t,y:s[0].y-t},s[0],r),c=[{...a,r:t,startAngle:r,endAngle:r+Math.PI/2},{...l,r:t*2,startAngle:r+Math.PI/2,endAngle:r+Math.PI}];let f=s[0].x-t,u=s[0].y-t;for(let d=2;d<9;d++){const h=c[d-2].r+c[d-1].r;let p=0;switch(d%4){case 0:{p=r,f-=c[d-2].r;break}case 1:{p=r+Math.PI/2,u-=c[d-2].r;break}case 2:{p=r+Math.PI,f+=c[d-2].r;break}case 3:{p=r+Math.PI/2*3,u+=c[d-2].r;break}}const v=p+Math.PI/2,x=S1({x:f,y:u},s[0],r);c.push({...x,r:h,startAngle:p,endAngle:v})}return[{type:"arc",attrs:c,styles:{size:2}},{type:"line",attrs:W2(s,e),styles:{size:2}}]}return[]}},o3={name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,bounding:e,overlay:t})=>{var a,l,c,f,u,d;const n=[];let o=[];const r=[];if(s.length>1){const h=s[1].x>s[0].x?-38:4,p=s[1].y>s[0].y?-2:20,v=s[1].x-s[0].x,x=s[1].y-s[0].y;[1,.75,.618,.5,.382,.25,0].forEach(C=>{const I=s[1].x-v*C,A=s[1].y-x*C;n.push({coordinates:[{x:I,y:s[0].y},{x:I,y:s[1].y}]}),n.push({coordinates:[{x:s[0].x,y:A},{x:s[1].x,y:A}]}),o=o.concat(W2([s[0],{x:I,y:s[1].y}],e)),o=o.concat(W2([s[0],{x:s[1].x,y:A}],e)),r.unshift({x:s[0].x+h,y:A+10,text:`${C.toFixed(3)}`}),r.unshift({x:I-18,y:s[0].y+p,text:`${C.toFixed(3)}`})})}return[{type:"line",attrs:n,styles:{size:((l=(a=t.styles)==null?void 0:a.line)==null?void 0:l.size)??2}},{type:"line",attrs:o,styles:{size:((f=(c=t.styles)==null?void 0:c.line)==null?void 0:f.size)??2}},{type:"text",ignoreEvent:!0,attrs:r,styles:{color:((d=(u=t.styles)==null?void 0:u.line)==null?void 0:d.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},i3={name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:s,coordinates:e,overlay:t,yAxis:n})=>{var l,c,f,u,d,h;const o=Dx(s,t,n),r=[],a=[];if(e.length>2){const p=t.points,v=p[1].value-p[0].value,x=e[1].y-e[0].y,S=[0,.236,.382,.5,.618,.786,1,1.618,2.618],I=Math.min(e[1].x,e[2].x)-16;S.forEach(A=>{const P=e[2].y+x*A,T=(p[2].value+v*A).toFixed(o);r.push({coordinates:[{x:e[1].x,y:P},{x:e[2].x,y:P}]}),a.push({x:I,y:P,text:`${T} (${(A*100).toFixed(1)}%)`,baseline:"middle",align:"right"})})}return[{type:"line",attrs:{coordinates:e},styles:{style:"dashed",size:((c=(l=t.styles)==null?void 0:l.line)==null?void 0:c.size)??2}},{type:"line",attrs:r,styles:{size:((u=(f=t.styles)==null?void 0:f.line)==null?void 0:u.size)??2}},{type:"text",ignoreEvent:!0,attrs:a,styles:{color:((h=(d=t.styles)==null?void 0:d.line)==null?void 0:h.color)??"#666666",backgroundColor:"transparent",backgroundOpacity:0,borderSize:0,borderColor:"transparent"}}]}},r3={name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:s,overlay:e})=>{var t,n,o,r;if(s.length>1){const a=(s[1].y-s[0].y)/4,l=s[1].x-s[0].x,c=[{coordinates:[s[0],{x:s[1].x,y:s[1].y-a}]},{coordinates:[s[0],{x:s[1].x,y:s[1].y-a*2}]},{coordinates:[{x:s[0].x,y:s[1].y},{x:s[1].x,y:s[0].y+a}]},{coordinates:[{x:s[0].x,y:s[1].y},{x:s[1].x,y:s[0].y+a*2}]},{coordinates:[{...s[0]},{x:s[0].x+l*.236,y:s[1].y}]},{coordinates:[{...s[0]},{x:s[0].x+l*.5,y:s[1].y}]},{coordinates:[{x:s[0].x,y:s[1].y},{x:s[0].x+l*.236,y:s[0].y}]},{coordinates:[{x:s[0].x,y:s[1].y},{x:s[0].x+l*.5,y:s[0].y}]}],f=[{coordinates:[s[0],s[1]]},{coordinates:[{x:s[0].x,y:s[1].y},{x:s[1].x,y:s[0].y}]}];return[{type:"line",attrs:[{coordinates:[s[0],{x:s[1].x,y:s[0].y}]},{coordinates:[{x:s[1].x,y:s[0].y},s[1]]},{coordinates:[s[1],{x:s[0].x,y:s[1].y}]},{coordinates:[{x:s[0].x,y:s[1].y},s[0]]}]},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[s[0],{x:s[1].x,y:s[0].y},s[1],{x:s[0].x,y:s[1].y}]},styles:{style:"fill"}},{type:"line",attrs:c,styles:{style:"dashed",size:((n=(t=e.styles)==null?void 0:t.line)==null?void 0:n.size)??1}},{type:"line",attrs:f,styles:{size:((r=(o=e.styles)==null?void 0:o.line)==null?void 0:r.size)??1}}]}return[]}},a3={name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>{const t=s.map((n,o)=>({...n,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}},{type:"text",ignoreEvent:!0,attrs:t}]}},l3={name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>{const t=s.map((n,o)=>({...n,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}},{type:"text",ignoreEvent:!0,attrs:t}]}},c3={name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>{const t=s.map((n,o)=>({...n,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}},{type:"text",ignoreEvent:!0,attrs:t}]}},u3={name:"anyWaves",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>{const t=s.map((n,o)=>({...n,text:`(${o})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}},{type:"text",ignoreEvent:!0,attrs:t}]}},d3={name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s})=>{let t=[],n=[];const o=["A","B","C","D"],r=s.map((a,l)=>({...a,baseline:"bottom",text:`(${o[l]})`}));return s.length>2&&(t=[s[0],s[2]],s.length>3&&(n=[s[1],s[3]])),[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:[{coordinates:t},{coordinates:n}],styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}},{type:"line",attrs:[{coordinates:t},{coordinates:n}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:r}]}},f3={name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:s,overlay:e})=>{const n=[],o=[],r=["X","A","B","C","D"],a=s.map((l,c)=>({...l,baseline:"bottom",text:`(${r[c]})`}));return s.length>2&&(n.push({coordinates:[s[0],s[2]]}),o.push({coordinates:[s[0],s[1],s[2]]}),s.length>3&&(n.push({coordinates:[s[1],s[3]]}),s.length>4&&(n.push({coordinates:[s[2],s[4]]}),o.push({coordinates:[s[2],s[3],s[4]]})))),[{type:"line",attrs:{coordinates:s},styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:n,styles:{color:"transparent",size:24,style:"solid"}},{type:"line",attrs:{coordinates:s}},{type:"line",attrs:n,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:o},{type:"text",ignoreEvent:!0,attrs:a}]}};function xF(s,e,t,n){const o=e==="bottom"?1:-1,r=s.x,a=r+200,l=s.y+3*o,c=l+50*o,f=c+5*o,u=n?{color:n}:{},d=n?{backgroundColor:n,borderColor:n}:{};return[{type:"line",attrs:{coordinates:[{x:r,y:l},{x:r,y:c}]},ignoreEvent:!0},{type:"line",attrs:{coordinates:[{x:r,y:s.y},{x:a,y:s.y}]},ignoreEvent:!0,styles:{...u}},{type:"polygon",attrs:{coordinates:[{x:r,y:c},{x:r-4,y:f},{x:r+4,y:f}]},ignoreEvent:!0,styles:u},{type:"rectText",attrs:{x:r,y:f,text:t??"",align:"center",baseline:"bottom"},ignoreEvent:!0,styles:d}]}const p3={name:"barSignal",totalStep:2,createPointFigures:({overlay:s,coordinates:e})=>{let{postion:t,text:n,bgColor:o}=s.extendData,r=[];return e.forEach(a=>{r.push(...xF(a,t,n,o))}),r}};function wF(s){let o=[];if(s>86400){const r=Math.floor(s/86400);o.push(r.toString(),O5()),s=s%86400}if(s>3600){const r=Math.floor(s/3600);o.push(r.toString(),z5()),s=s%3600}if(s>60){const r=Math.floor(s/60);o.push(r.toString(),z2()),s=s%60}return s>0&&o.push("1",z2()),o.join("")}const h3={name:"ruler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},onDeselected:s=>{var e;return(e=s.chart)==null||e.removeOverlay({id:s.overlay.id}),!0},createPointFigures:({chart:s,coordinates:e,overlay:t,yAxis:n})=>{const o=Dx(s,t,n);if(e.length>1){const r=e[0],a=e[1],l=(r.x+a.x)/2,c=(r.y+a.y)/2,f=V2({x:l,y:r.y},{x:l,y:a.y}),u=V2({x:r.x,y:c},{x:a.x,y:c}),d=r.y>a.y?"#F7525F":"#2962FF",h={color:"#ffffff",backgroundColor:d,borderColor:d,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},p=t.points,v=p[0].value-p[1].value,x=v.toFixed(o),S=(v/p[0].value*100).toFixed(2),C=p[1].dataIndex-p[0].dataIndex,I=(p[1].timestamp-p[0].timestamp)/1e3,A=`${x} (${S}%)
${C}${B5()}, ${wF(I)}`;let P=a.y+10,T="top";r.y>a.y&&(P=a.y-10,T="bottom");const j=[],E=30,L=[{x:r.x-E,y:r.y-E},{x:a.x+E,y:r.y-E},{x:a.x+E,y:a.y+E},{x:r.x-E,y:a.y+E}];return j.push({type:"polygon",attrs:{coordinates:L},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),j.push({type:"polygon",attrs:{coordinates:[r,{x:a.x,y:r.y},a,{x:r.x,y:a.y}]},styles:{style:"stroke_fill"}}),j.push({type:"textBox",attrs:{x:l,y:P,text:A,align:"center",baseline:T},ignoreEvent:!0,styles:h}),j.push(...f),j.push(...u),j}return[]}},Q_=(s,e)=>{try{const t=typeof window<"u"?window.drawBarRef:null,n=t==null?void 0:t[s];typeof n=="function"&&n(e)}catch{}},zw=s=>{try{typeof document<"u"&&(document.body.style.cursor=s)}catch{}},Vw=s=>{try{typeof window<"u"&&(window.__overlayHover=s)}catch{}},Ww={color:"#ffffff",paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},m3={name:"trade",lock:!1,zLevel:90,totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,overlay:e})=>{if(s.length<=1)return[];const t=e.extendData,n=s[0],o=s[1],r={size:.5};t&&t.line_color&&(r.color=t.line_color);const a=[],l={type:"line",attrs:{coordinates:[n,o]},styles:{color:"transparent",size:40},ignoreEvent:!1};a.push(l);const c={type:"line",attrs:{coordinates:[n,o]},styles:r};if(a.push(c),!t.active&&!t.selected)return a;const f=t.distance??15;let u="bottom",d=n.y-f,h="top",p=o.y+f;n.y>o.y&&(u="top",d=n.y+f,h="bottom",p=o.y-f);const v={type:"textBox",attrs:{x:n.x,y:d,text:t.in_text,align:"center",baseline:u},ignoreEvent:!0,styles:{...Ww,backgroundColor:t.in_color,borderColor:t.in_color}},x={type:"textBox",attrs:{x:o.x,y:p,text:t.out_text,align:"center",baseline:h},ignoreEvent:!0,styles:{...Ww,backgroundColor:t.out_color,borderColor:t.out_color}},S={type:"line",attrs:{coordinates:[n,{x:n.x,y:d}]},ignoreEvent:!0,styles:r},C={type:"line",attrs:{coordinates:[o,{x:o.x,y:p}]},ignoreEvent:!0,styles:r};return[l,c,v,x,S,C]},onSelected:s=>{const e=s.overlay.extendData;return e.selected=!0,Q_("externalSelectOverlay",s.overlay),!0},onClick:s=>{const e=s.overlay.extendData;return e.selected=!0,Q_("externalSelectOverlay",s.overlay),!0},onDeselected:s=>{const e=s.overlay.extendData;return e.selected=!1,Q_("externalDeselectOverlay",s.overlay),!0},onMouseEnter:s=>{const e=s.overlay.extendData;return e.active=!0,Vw(!0),zw("pointer"),!0},onMouseLeave:s=>{const e=s.overlay.extendData;return e.active=!1,Vw(!1),zw(""),!0},onPressedMoveEnd:s=>(Q_("externalSyncOverlay",s.overlay),!0),onRemoved:s=>(Q_("externalRemoved",s.overlay.id),!0)},e1={color:"#ffffff",size:12,paddingLeft:6,paddingTop:6,paddingRight:6,paddingBottom:6},Gb=(s,e)=>{try{const t=s.extendData||{};t.selected=e,s.extendData=t}catch{}},t1=(s,e)=>{try{const t=typeof window<"u"?window.drawBarRef:null,n=t==null?void 0:t[s];typeof n=="function"&&n(e)}catch{}},Hw=s=>{try{typeof document<"u"&&(document.body.style.cursor=s)}catch{}},qw=s=>{try{typeof window<"u"&&(window.__overlayHover=s)}catch{}},v3={name:"note",lock:!1,zLevel:100,totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:s,overlay:e})=>{if(s.length==0)return[];const t=e.extendData,n=s[0],o={size:.5};t&&t.line_color&&(o.color=t.line_color);const r=t.distance??15,a=typeof t.offsetX=="number"?t.offsetX:0,l=typeof t.offsetY=="number"?t.offsetY:0;let c="bottom",f=n.y-r+l;const u=t.align||(a>0?"left":a<0?"right":"center"),d=(t==null?void 0:t.in_text)??"",h={type:"textBox",attrs:{x:n.x+a,y:f,text:d,align:u,baseline:c},ignoreEvent:!1,styles:{...e1,backgroundColor:t.in_color,borderColor:t.in_color}},p=12,v=Math.round(p*1.4),x=iv.calcTextWidth(d,p),S=Math.max(36,x+(e1.paddingLeft+e1.paddingRight)+12),C=Math.max(18,v+(e1.paddingTop+e1.paddingBottom)),I=u==="left"?n.x+a:u==="right"?n.x+a-S:n.x+a-S/2,A=c==="top"?f:c==="bottom"?f-C:f-C/2,P={type:"rect",attrs:{x:I,y:A,width:S,height:C},ignoreEvent:!1,styles:{style:"fill",color:"transparent"}},T={type:"line",attrs:{coordinates:[n,{x:n.x+a,y:f}]},ignoreEvent:!0,styles:o};return[P,h,T]},onSelected:s=>{var e;return Gb(s.overlay,!0),(e=s.chart)==null||e.overrideOverlay({id:s.overlay.id,extendData:s.overlay.extendData}),t1("externalSelectOverlay",s.overlay),!0},onClick:s=>{var e;return Gb(s.overlay,!0),(e=s.chart)==null||e.overrideOverlay({id:s.overlay.id,extendData:s.overlay.extendData}),t1("externalSelectOverlay",s.overlay),!0},onDeselected:s=>{var e;return Gb(s.overlay,!1),(e=s.chart)==null||e.overrideOverlay({id:s.overlay.id,extendData:s.overlay.extendData}),t1("externalDeselectOverlay",s.overlay),!0},onPressedMoveEnd:s=>(t1("externalSyncOverlay",s.overlay),!0),onRemoved:s=>(t1("externalRemoved",s.overlay.id),!0),onMouseEnter:()=>(qw(!0),Hw("pointer"),!0),onMouseLeave:()=>(qw(!1),Hw(""),!0)},g3={name:"emoji",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},createPointFigures:({coordinates:s,overlay:e})=>{if(s.length===0)return[];const t=e.extendData;if(!t||!t.emoji)return[];const n=s[0],o=t.size||24;t.rotation;const r=t.selected||!1;t.active;const a=[],l=e.styles||{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}},c={type:"text",attrs:{x:n.x,y:n.y,text:t.emoji,align:"center",baseline:"middle"},styles:{size:o,family:"Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif",weight:"normal",backgroundColor:"transparent"}};if(a.push(c),r){const f=o/2,u=4,d={type:"rect",attrs:{x:n.x-f-u,y:n.y-f-u,width:o+u*2,height:o+u*2},styles:{stroke:l.box.stroke,strokeWidth:l.box.width,fill:"transparent",backgroundColor:"transparent"}};a.push(d);const h=l.handles.size,p=f+u;[{x:n.x-p-h/2,y:n.y-p-h/2},{x:n.x+p-h/2,y:n.y-p-h/2},{x:n.x-p-h/2,y:n.y+p-h/2},{x:n.x+p-h/2,y:n.y+p-h/2}].forEach(x=>{const S={type:"rect",attrs:{x:x.x,y:x.y,width:h,height:h},styles:{fill:l.handles.fill,stroke:l.handles.stroke,strokeWidth:1,backgroundColor:"transparent"}};a.push(S)})}return a},onDrawStart:s=>!0,onDrawing:s=>!0,onDrawEnd:s=>!0,onPressedMoveStart:s=>!0,onPressedMoving:s=>!0,onPressedMoveEnd:s=>!0,onSelected:s=>{const e=s.overlay.extendData;return e&&(e.selected=!0),!1},onDeselected:s=>{const e=s.overlay.extendData;return e&&(e.selected=!1),!1},onMouseEnter:s=>{const e=s.overlay.extendData;return e&&(e.active=!0),!1},onMouseLeave:s=>{const e=s.overlay.extendData;return e&&(e.active=!1),!1}},e_="Add text";class kF{constructor(){Pe(this,"editor",null);Pe(this,"chart",null);Pe(this,"overlay",null);Pe(this,"pos",{x:0,y:0});Pe(this,"raf",null);Pe(this,"lastCommitted","");Pe(this,"boundPointerHandler",null);Pe(this,"boundKeydownShield",null);Pe(this,"placeholderCssInjected",!1)}startEditing(e,t){var n;this.chart=e,this.overlay=t,this.lastCommitted=((n=t.extendData)==null?void 0:n.text)??"",this.ensureEditor(),this.updateOverlayEditing(!0),this.syncPosition(),this.addOutsideListeners(),this.addKeydownShield(),setTimeout(()=>{var a,l;(a=this.editor)==null||a.focus();const o=((l=t.extendData)==null?void 0:l.text)??"",r=!o||o===e_;this.editor&&(this.editor.innerText=r?"":o,this.editor.setAttribute("data-placeholder",e_),this.editor.classList.add("kc-inline-text-editor"),this.injectPlaceholderCss());try{const c=window.getSelection();if(c&&this.editor){const f=this.editor.innerText.length;this.editor.firstChild&&c.collapse(this.editor.firstChild,Math.min(f,(this.editor.firstChild.textContent||"").length))}}catch{}},0),this.loop()}reEdit(e,t){this.startEditing(e,t)}updateEditorStyle(e){e&&(this.overlay=e),this.applyStylesFromOverlay()}ensureEditor(){if(this.editor)return;const e=document.createElement("div");e.contentEditable="true",e.style.position="fixed",e.style.zIndex="10000",e.style.outline="none",e.style.padding="8px",e.style.whiteSpace="pre-wrap",e.style.wordBreak="break-word",e.style.userSelect="text",e.style.transform="translate(0, -50%)",e.style.boxSizing="border-box",e.addEventListener("keydown",t=>this.onKeyDown(t)),e.addEventListener("input",()=>this.onInput()),e.addEventListener("blur",()=>this.commit()),document.body.appendChild(e),this.editor=e,this.applyStylesFromOverlay()}applyStylesFromOverlay(){var c;if(!this.editor||!this.overlay)return;const e=this.overlay.extendData||{},t=((c=this.overlay.styles)==null?void 0:c.text)||{},n=e.fontSize??t.size??32,o=e.fontWeight??t.weight??"bold",r=e.textColor??t.color??"#FFFFFF",a=e.backgroundColor??t.backgroundColor??"#00000033",l=e.fontFamily??t.family??'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif';this.editor.style.fontSize=`${n}px`,this.editor.style.lineHeight=`${Math.round(n*1.4)}px`,this.editor.style.fontWeight=o,this.editor.style.color=r,this.editor.style.background=a,this.editor.style.border="none",this.editor.style.fontFamily=l,this.editor.style.minWidth="0px",this.editor.style.minHeight=`${Math.round(n*1.4)}px`}loop(){this.raf&&cancelAnimationFrame(this.raf);const e=()=>{this.syncPosition(),this.raf=requestAnimationFrame(e)};this.raf=requestAnimationFrame(e)}syncPosition(){var n;if(!this.chart||!this.overlay||!((n=this.overlay.points)!=null&&n.length))return;const e=this.overlay.paneId||"candle_pane",t=this.chart.convertToPixel(this.overlay.points[0],{paneId:e});t&&typeof t.x=="number"&&typeof t.y=="number"&&(this.pos={x:t.x,y:t.y},this.editor&&(this.editor.style.left=`${this.pos.x}px`,this.editor.style.top=`${this.pos.y}px`))}addOutsideListeners(){if(this.boundPointerHandler)return;const e=t=>{const n=t.target;if(!this.editor||n&&this.editor.contains(n))return;const o=n;o&&(o.closest(".context-menu-container")||o.closest(".premium-submenu"))||this.finishFromOutside()};this.boundPointerHandler=e,document.addEventListener("pointerdown",e,{capture:!0}),document.addEventListener("touchstart",e,{capture:!0}),document.addEventListener("mousedown",e,{capture:!0})}removeOutsideListeners(){this.boundPointerHandler&&(document.removeEventListener("pointerdown",this.boundPointerHandler,{capture:!0}),document.removeEventListener("touchstart",this.boundPointerHandler,{capture:!0}),document.removeEventListener("mousedown",this.boundPointerHandler,{capture:!0}),this.boundPointerHandler=null)}addKeydownShield(){if(this.boundKeydownShield)return;const e=t=>{if(!this.editor)return;const n=t.target;n&&(n===this.editor||this.editor.contains(n))&&t.stopPropagation()};this.boundKeydownShield=e,document.addEventListener("keydown",e,{capture:!0})}removeKeydownShield(){this.boundKeydownShield&&(document.removeEventListener("keydown",this.boundKeydownShield,{capture:!0}),this.boundKeydownShield=null)}finishFromOutside(){if(!this.editor)return;const e=this.editor.innerText||"";try{this.editor.blur()}catch{}!e||e===e_?this.deleteOverlay():this.commit()}onKeyDown(e){var t;if(e.stopPropagation(),e.key==="Escape"){e.preventDefault();const n=(((t=this.editor)==null?void 0:t.innerText)||"").trim();!n||n===e_?this.deleteOverlay():this.revert()}e.key==="Backspace"||e.key==="Delete"||e.key}onInput(){if(!this.editor||!this.chart||!this.overlay)return;this.editor.innerText.length>0?this.editor.setAttribute("data-placeholder",e_):this.editor.setAttribute("data-placeholder",e_);const e=Math.max(12,this.editor.scrollWidth),t=Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)),n=getComputedStyle(this.editor),o=parseFloat(n.paddingLeft||"0")+parseFloat(n.paddingRight||"0"),r=parseFloat(n.paddingTop||"0")+parseFloat(n.paddingBottom||"0"),a=Math.max(0,e-o),l=Math.max(0,t-r),c={...this.overlay.extendData||{},text:this.editor.innerText,boxWidth:e,boxHeight:t,contentWidth:a,contentHeight:l};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:c})}catch{}}updateOverlayEditing(e){if(!this.chart||!this.overlay)return;const t={...this.overlay.extendData||{},editing:e};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:t})}catch{}}commit(){var c;if(!this.chart||!this.overlay){this.cleanup();return}const e=((c=this.editor)==null?void 0:c.innerText)||"";if(!e||e===e_){this.deleteOverlay();return}this.lastCommitted=e;const t=this.editor?Math.max(12,this.editor.scrollWidth):void 0,n=this.editor?Math.max(this.editor.scrollHeight,Math.round(parseInt(this.editor.style.lineHeight)||32)):void 0,o=this.editor?getComputedStyle(this.editor):null,r=o?parseFloat(o.paddingLeft||"0")+parseFloat(o.paddingRight||"0"):0,a=o?parseFloat(o.paddingTop||"0")+parseFloat(o.paddingBottom||"0"):0,l={...this.overlay.extendData||{},text:e,editing:!1,...t?{boxWidth:t}:{},...n?{boxHeight:n}:{},...t?{contentWidth:Math.max(0,t-r)}:{},...n?{contentHeight:Math.max(0,n-a)}:{}};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:l})}catch{}this.cleanup()}revert(){if(!this.chart||!this.overlay){this.cleanup();return}const e={...this.overlay.extendData||{},text:this.lastCommitted,editing:!1};try{this.chart.overrideOverlay({id:this.overlay.id,extendData:e})}catch{}this.cleanup()}deleteOverlay(){var e;if(!this.chart||!this.overlay){this.cleanup();return}try{(e=this.editor)==null||e.blur()}catch{}try{this.chart.removeOverlay({id:this.overlay.id})}catch{}this.cleanup()}cleanup(){if(this.raf&&cancelAnimationFrame(this.raf),this.raf=null,this.overlay=null,this.removeOutsideListeners(),this.removeKeydownShield(),this.editor)try{this.editor.remove()}catch{}this.editor=null}getEditorRect(){try{return this.editor?this.editor.getBoundingClientRect():null}catch{return null}}injectPlaceholderCss(){if(!this.placeholderCssInjected)try{const e="kc-inline-text-editor-placeholder-style";if(document.getElementById(e)){this.placeholderCssInjected=!0;return}const t=document.createElement("style");t.id=e,t.textContent=`
        .kc-inline-text-editor:empty::before {
          content: attr(data-placeholder);
          color: rgba(255,255,255,0.6);
        }
      `,document.head.appendChild(t),this.placeholderCssInjected=!0}catch{}}}const P_=new kF,Uw="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif",_3={name:"text",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,zLevel:100,styles:{text:{color:"#FFFFFF",backgroundColor:"#00000033",borderColor:"#1677FF",size:32,weight:"bold",family:Uw,paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:8,borderSize:1},box:{stroke:"#1677FF",width:1,fill:"transparent"},handles:{size:6,fill:"#1677FF",stroke:"#1677FF"}},createPointFigures:({coordinates:s,overlay:e})=>{var le,pe,re,xe,se,Ne,Te,Me,De,Oe,Ke,kt,pt,Rt,Ht,Ft,zt,ut;if(s.length===0)return[];const t=s[0],n=e.extendData||{},o=!!n.editing,r=n.text??"",a=n.fontSize??((pe=(le=e.styles)==null?void 0:le.text)==null?void 0:pe.size)??32,l=n.fontWeight??((xe=(re=e.styles)==null?void 0:re.text)==null?void 0:xe.weight)??"bold",c=n.fontFamily??((Ne=(se=e.styles)==null?void 0:se.text)==null?void 0:Ne.family)??Uw,f=n.textColor??((Me=(Te=e.styles)==null?void 0:Te.text)==null?void 0:Me.color)??"#FFFFFF",u=n.backgroundColor??((Oe=(De=e.styles)==null?void 0:De.text)==null?void 0:Oe.backgroundColor)??"#00000033",d=((kt=(Ke=e.styles)==null?void 0:Ke.text)==null?void 0:kt.paddingLeft)??8,h=((Rt=(pt=e.styles)==null?void 0:pt.text)==null?void 0:Rt.paddingRight)??8,p=((Ft=(Ht=e.styles)==null?void 0:Ht.text)==null?void 0:Ft.paddingTop)??4,v=((ut=(zt=e.styles)==null?void 0:zt.text)==null?void 0:ut.paddingBottom)??4;if(o)return[];if(!(r&&r.length>0&&r!=="Add text"))return[];const S=Math.round(a*1.4),C=String(r).split(/\r?\n/),I=C.map(nt=>iv.calcTextWidth(nt,a,l,c)),P=I.length?Math.max(...I):iv.calcTextWidth(r,a,l,c),T=(C.length||1)*S,j=P+d+h,E=T+p+v,L=j,D=E,X=t.x,ne=t.y-Math.round(D/2),de=[];de.push({type:"rect",attrs:{x:X,y:ne,width:L,height:D},styles:{style:I_.Fill,color:u,borderColor:"transparent",borderSize:0}});const ie=X+Math.round(L/2),te=ne+p+Math.round(S/2);return C.forEach((nt,Je)=>{const it=te+Je*S;de.push({type:"text",attrs:{x:ie,y:it,text:nt,align:"center",baseline:"middle"},styles:{size:a,family:c,weight:l,color:f,backgroundColor:"transparent"}})}),de},onSelected:s=>{var t;const e=s.overlay.extendData||{};e.selected=!0,(t=s.chart)==null||t.overrideOverlay({id:s.overlay.id,extendData:e});try{typeof navigator<"u"&&(navigator.maxTouchPoints||0)>0&&s.chart&&P_.startEditing(s.chart,s.overlay)}catch{}return!0},onDeselected:s=>{var t;const e=s.overlay.extendData||{};return e.selected=!1,(t=s.chart)==null||t.overrideOverlay({id:s.overlay.id,extendData:e}),!0},onPressedMoveStart:s=>{const e=s.overlay.extendData||{};if(e.editing||s.overlay.lock)return!1;const t=s.overlay.paneId;try{const n=s.chart.convertToPixel(s.overlay.points[0],{paneId:t});n&&typeof s.x=="number"&&typeof s.y=="number"&&(e.__dragOffX=s.x-(n.x||0),e.__dragOffY=s.y-(n.y||0),s.chart.overrideOverlay({id:s.overlay.id,extendData:e}))}catch{}return!0},onPressedMoving:s=>{const e=s.overlay.extendData||{};if(e.editing||s.overlay.lock)return!1;const t=e.__dragOffX||0,n=e.__dragOffY||0,o=s.overlay.paneId;if(typeof s.x!="number"||typeof s.y!="number")return!0;const r=s.x-t,a=s.y-n;try{const l=s.chart.convertFromPixel([{x:r,y:a}],{paneId:o}),c=Array.isArray(l)?l[0]:l;c&&s.chart.overrideOverlay({id:s.overlay.id,points:[{timestamp:c.timestamp,value:c.value}]})}catch{}return!0},onPressedMoveEnd:s=>{const e=s.overlay.extendData||{};if(e.editing||s.overlay.lock)return!1;if("__dragOffX"in e||"__dragOffY"in e){delete e.__dragOffX,delete e.__dragOffY;try{s.chart.overrideOverlay({id:s.overlay.id,extendData:e})}catch{}}return!0}};function SF(s,e){if(s.length>0){const t=s[0].y;return{coordinates:[{x:0,y:t},{x:e.width,y:t}]}}return{coordinates:[]}}function CF(s,e){if(s.length>1){const t=s[0].y,n=s[0],o=s[1];return n.x>o.x?{coordinates:[{x:0,y:t},n]}:{coordinates:[n,{x:e.width,y:t}]}}return{coordinates:[]}}const y3={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:s,overlay:e,bounding:t})=>{var l,c,f;if(s.length<1)return[];console.log("horizontalStraightLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const n=e.extendData,o=n.interactive!==!1,r=[],a=SF(s,t);if(a.coordinates.length>0){r.push({type:"line",attrs:a,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!o}),r.push({type:"line",attrs:a,ignoreEvent:!o});const u=e.selected===!0;if(n.showDot||u){const d=t.width/2,h=s[0].y,p=((c=(l=e.styles)==null?void 0:l.line)==null?void 0:c.color)||((f=e.styles)==null?void 0:f.color)||"#1677FF";console.log("Drawing dot for horizontalStraightLine:",{x:d,y:h,showDot:n.showDot,selected:u,color:p}),r.push({type:"circle",attrs:{x:d,y:h,r:6},styles:{style:"fill",color:p}}),r.push({type:"circle",attrs:{x:d,y:h,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return r},createYAxisFigures:({chart:s,overlay:e,coordinates:t,yAxis:n,bounding:o})=>{var j,E,L,D,X,ne;if(t.length<1||!e.points||e.points.length<1)return[];const r=(j=e.points[0])==null?void 0:j.value;if(r===void 0)return[];const a=s.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,f=l.ticduty.show?l.ticduty.length:0,u=l.tickText.marginStart,d=l.tickText.marginEnd,h=1,v={...a.crosshair.horizontal.text};let x=0,S="left";if((E=n==null?void 0:n.isFromZero)!=null&&E.call(n))x=c+h,S="left",v.paddingLeft=f+u-h;else{x=((o==null?void 0:o.width)??0)-c-h,S="right";const de=((o==null?void 0:o.width)??0)-c-h,ie=((o==null?void 0:o.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.ticduty.show?l.ticduty.length:0)-d;v.paddingRight=de-ie}const C=n.getRange();let I=n.displayValueToText(n.realValueToDisplayValue(n.valueToRealValue(r,{range:C}),{range:C}),((L=s.getSymbol())==null?void 0:L.pricePrecision)??2);I=s.getDecimalFold().format(s.getThousandsSeparator().format(I));const A=((X=(D=e.styles)==null?void 0:D.line)==null?void 0:X.color)||((ne=e.styles)==null?void 0:ne.color)||"#1677FF",P=T0(A,v.color),T=t[0].y;return typeof(o==null?void 0:o.height)=="number"&&(T<0||T>o.height)?[]:[{type:"text",attrs:{x,y:T,text:I,align:S,baseline:"middle"},styles:{...v,color:P,backgroundColor:A},ignoreEvent:!0}]},onClick:s=>{console.log("🟢 horizontalStraightLine onClick called",{overlayId:s.overlay.id,overlayName:s.overlay.name,hasExtendData:!!s.overlay.extendData,extendData:s.overlay.extendData}),!s.overlay.extendData||typeof s.overlay.extendData!="object"?s.overlay.extendData={showDot:!1}:"showDot"in s.overlay.extendData||(s.overlay.extendData.showDot=!1);const e=s.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",s.overlay),s.chart&&(console.log("Attempting to override overlay to force redraw..."),s.chart.overrideOverlay({id:s.overlay.id,extendData:e})),!0},onSelected:s=>{console.log("🟢 horizontalStraightLine onSelected called",{overlayId:s.overlay.id,overlayName:s.overlay.name,hasExtendData:!!s.overlay.extendData,extendData:s.overlay.extendData}),!s.overlay.extendData||typeof s.overlay.extendData!="object"?s.overlay.extendData={showDot:!1}:"showDot"in s.overlay.extendData||(s.overlay.extendData.showDot=!1);const e=s.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",s.overlay),s.chart&&(console.log("Attempting to override overlay to force redraw..."),s.chart.overrideOverlay({id:s.overlay.id,extendData:e})),!0},onDeselected:s=>{console.log("🔴 horizontalStraightLine onDeselected called"),!s.overlay.extendData||typeof s.overlay.extendData!="object"?s.overlay.extendData={showDot:!1}:"showDot"in s.overlay.extendData||(s.overlay.extendData.showDot=!1);const e=s.overlay.extendData;return e.showDot=!1,s.chart&&s.chart.overrideOverlay({id:s.overlay.id,extendData:e}),!0}},b3={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:s,overlay:e,bounding:t})=>{var a,l,c;if(s.length<2)return[];console.log("horizontalRayLine createPointFigures called",{overlayId:e.id,hasExtendData:!!e.extendData,extendData:e.extendData,selected:e.selected===!0}),!e.extendData||typeof e.extendData!="object"?e.extendData={showDot:!1}:"showDot"in e.extendData||(e.extendData.showDot=!1);const n=e.extendData,o=[],r=CF(s,t);if(r.coordinates.length>0){o.push({type:"line",attrs:r,styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),o.push({type:"line",attrs:r});const f=e.selected===!0;if(n.showDot||f){const u=s[0].x,d=s[0].y,h=((l=(a=e.styles)==null?void 0:a.line)==null?void 0:l.color)||((c=e.styles)==null?void 0:c.color)||"#1677FF";console.log("Drawing dot for horizontalRayLine:",{x:u,y:d,showDot:n.showDot,selected:f,color:h}),o.push({type:"circle",attrs:{x:u,y:d,r:6},styles:{style:"fill",color:h}}),o.push({type:"circle",attrs:{x:u,y:d,r:7},styles:{style:"stroke",color:"#ffffff",borderSize:2}})}}return o},createYAxisFigures:({chart:s,overlay:e,coordinates:t,yAxis:n,bounding:o})=>{var j,E,L,D,X,ne;if(t.length<1||!e.points||e.points.length<1)return[];const r=(j=e.points[0])==null?void 0:j.value;if(r===void 0)return[];const a=s.getStyles(),l=a.yAxis,c=l.axisLine.show?l.axisLine.size:0,f=l.ticduty.show?l.ticduty.length:0,u=l.tickText.marginStart,d=l.tickText.marginEnd,h=1,v={...a.crosshair.horizontal.text};let x=0,S="left";if((E=n==null?void 0:n.isFromZero)!=null&&E.call(n))x=c+h,S="left",v.paddingLeft=f+u-h;else{x=((o==null?void 0:o.width)??0)-c-h,S="right";const de=((o==null?void 0:o.width)??0)-c-h,ie=((o==null?void 0:o.width)??0)-(l.axisLine.show?l.axisLine.size:0)-(l.ticduty.show?l.ticduty.length:0)-d;v.paddingRight=de-ie}const C=n.getRange();let I=n.displayValueToText(n.realValueToDisplayValue(n.valueToRealValue(r,{range:C}),{range:C}),((L=s.getSymbol())==null?void 0:L.pricePrecision)??2);I=s.getDecimalFold().format(s.getThousandsSeparator().format(I));const A=((X=(D=e.styles)==null?void 0:D.line)==null?void 0:X.color)||((ne=e.styles)==null?void 0:ne.color)||"#1677FF",P=T0(A,v.color),T=t[0].y;return typeof(o==null?void 0:o.height)=="number"&&(T<0||T>o.height)?[]:[{type:"text",attrs:{x,y:T,text:I,align:S,baseline:"middle"},styles:{...v,color:P,backgroundColor:A},ignoreEvent:!0}]},onClick:s=>{console.log("🟢 horizontalRayLine onClick called",{overlayId:s.overlay.id,overlayName:s.overlay.name,hasExtendData:!!s.overlay.extendData,extendData:s.overlay.extendData}),!s.overlay.extendData||typeof s.overlay.extendData!="object"?s.overlay.extendData={showDot:!1}:"showDot"in s.overlay.extendData||(s.overlay.extendData.showDot=!1);const e=s.overlay.extendData;return e.showDot=!e.showDot,console.log("✅ Toggled showDot to:",e.showDot,"overlay:",s.overlay),s.chart&&(console.log("Attempting to override overlay to force redraw..."),s.chart.overrideOverlay({id:s.overlay.id,extendData:e})),!0},onSelected:s=>{console.log("🟢 horizontalRayLine onSelected called",{overlayId:s.overlay.id,overlayName:s.overlay.name,hasExtendData:!!s.overlay.extendData,extendData:s.overlay.extendData}),!s.overlay.extendData||typeof s.overlay.extendData!="object"?s.overlay.extendData={showDot:!1}:"showDot"in s.overlay.extendData||(s.overlay.extendData.showDot=!1);const e=s.overlay.extendData;return e.showDot=!0,console.log("✅ Set showDot to true:",e,"overlay:",s.overlay),s.chart&&(console.log("Attempting to override overlay to force redraw..."),s.chart.overrideOverlay({id:s.overlay.id,extendData:e})),!0},onDeselected:s=>{console.log("🔴 horizontalRayLine onDeselected called"),!s.overlay.extendData||typeof s.overlay.extendData!="object"?s.overlay.extendData={showDot:!1}:"showDot"in s.overlay.extendData||(s.overlay.extendData.showDot=!1);const e=s.overlay.extendData;return e.showDot=!1,s.chart&&s.chart.overrideOverlay({id:s.overlay.id,extendData:e}),!0}};function IF(s,e,t,n,o,r,a){const l=n*.4,c=o*.4;s.save(),s.strokeStyle=r,s.lineWidth=a,s.lineCap="round",s.lineJoin="round",s.beginPath(),s.moveTo(e-l,t-c),s.lineTo(e+l,t+c),s.moveTo(e+l,t-c),s.lineTo(e-l,t+c),s.stroke(),s.restore()}function PF(s,e,t,n,o,r,a){const l=n*.4,c=o*.4;s.save(),s.strokeStyle=r,s.lineWidth=a,s.lineCap="round",s.beginPath(),s.ellipse(e,t,l,c,0,0,Math.PI*2),s.stroke(),s.restore()}const x3={name:"pointAndFigure",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:()=>[],draw:s=>{var C,I,A;const{ctx:e,chart:t,bounding:n,xAxis:o,yAxis:r,overlay:a}=s;if(!t||!e||!(o!=null&&o.convertToPixel)||!(r!=null&&r.convertToPixel))return[];const l=(C=t.getVisibleRange)==null?void 0:C.call(t);if(!l)return[];const c=((I=t.getDataList)==null?void 0:I.call(t))||[];if(c.length===0)return[];const f=o.convertToPixel(0),u=o.convertToPixel(1),d=Math.max(1,Math.abs(u-f));let h=d;for(let P=l.from;P<=l.to&&P<c.length;P++){const T=(A=c[P])==null?void 0:A._pnf;if(T!=null&&T.boxes&&T.boxes.length>=2){const j=r.convertToPixel(T.boxes[0].price),E=r.convertToPixel(T.boxes[1].price);if(j!==void 0&&E!==void 0&&!isNaN(j)&&!isNaN(E)){const L=Math.abs(j-E);if(L>0){h=L;break}}}}const p=d*.85,v=h*.85,x=(p+v)/2,S=Math.max(.8,x*.08);for(let P=l.from;P<=l.to&&P<c.length;P++){const T=c[P];if(!T)continue;const j=T==null?void 0:T._pnf;if(!j||!j.boxes)continue;const{direction:E,boxes:L,upColor:D="#00E6D8",downColor:X="#FF4D4D"}=j,ne=o.convertToPixel(P);if(!(ne==null||isNaN(ne)))for(const de of L){const ie=r.convertToPixel(de.price);ie==null||isNaN(ie)||(E==="up"?IF(e,ne,ie,p,v,D,S):PF(e,ne,ie,p,v,X,S))}}return[]}},w3={name:"script-layer",totalStep:0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{},createPointFigures:()=>[]},MF=[K5,X5,Z5,Q5,J5,e3,s3,n3,o3,i3,r3,a3,l3,c3,u3,d3,f3,p3,h3,m3,v3,g3,_3,y3,b3,x3,w3],J1={arrow:K5,circle:X5,rect:Z5,triangle:Q5,parallelogram:J5,fibonacciCircle:e3,fibonacciSegment:s3,fibonacciSpiral:n3,fibonacciSpeedResistanceFan:o3,fibonacciExtension:i3,gannBox:r3,threeWaves:a3,fiveWaves:l3,eightWaves:c3,anyWaves:u3,abcd:d3,xabcd:f3,barSignal:p3,ruler:h3,trade:m3,note:v3,emoji:g3,text:_3,horizontalStraightLine:y3,horizontalRayLine:b3,pointAndFigure:x3,scriptLayer:w3};function k3(s,e,t){const{size:n=12,paddingLeft:o=0,paddingTop:r=0,paddingRight:a=0,paddingBottom:l=0}=e,{x:c,y:f,text:u,align:d="left",baseline:h="top"}=s;t=t??n*u.length;let p;switch(d){case"left":case"start":{p=c;break}case"right":case"end":{p=c-a-t-o;break}default:{p=c-t/2-o;break}}return p}function S3(s,e,t,n,o){const{size:r=12,paddingLeft:a=0,paddingTop:l=0,paddingRight:c=0,paddingBottom:f=0}=e,{x:u,y:d,text:h,align:p="left",baseline:v="top"}=s,x=h.length;t=t??r*x,n=n??1,o=o??1.5;const S=r*n*o-(o-1)*r,C=k3(s,e,t);let I;switch(v){case"top":case"hanging":{I=d;break}case"bottom":case"ideographic":case"alphabetic":{I=d-S-l-f;break}default:{I=d-S/2-l;break}}return{x:C,y:I,width:a+t+c,height:l+S+f}}const C3=iv.calcTextWidth;function NF(s,e,t){return`${e??"normal"} ${s??12}px ${t??"Helvetica Neue"}`}function AF(s){return typeof s=="string"}function Gw(s){return s==="transparent"||s==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(s)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(s)}function TF(s,e,t){let n=[];n=n.concat(e);const{style:o=I_.Fill,color:r="transparent",borderSize:a=1,borderColor:l="transparent",borderStyle:c=mt.Solid,borderRadius:f=0,borderDashedValue:u=[2,2]}=t,d=s.roundRect??s.rect,h=(o===I_.Fill||t.style===I_.StrokeFill)&&(!AF(r)||!Gw(r));if(h&&(s.fillStyle=r,n.forEach(({x:p,y:v,width:x,height:S})=>{s.beginPath(),d.call(s,p,v,x,S,f),s.closePath(),s.fill()})),(o===I_.Stroke||t.style===I_.StrokeFill)&&a>0&&!Gw(l)){s.strokeStyle=l,s.fillStyle=l,s.lineWidth=a,c===mt.Dashed?s.setLineDash(u):s.setLineDash([]);const p=a%2===1?.5:0,v=Math.round(p*2);n.forEach(({x,y:S,width:C,height:I})=>{C>a*2&&I>a*2?(s.beginPath(),d.call(s,x+p,S+p,C-v,I-v,f),s.closePath(),s.stroke()):h||s.fillRect(x,S,C,I)})}}function FF(s,e,t){const{text:n}=e,{size:o=12,family:r,weight:a,paddingLeft:l=0,paddingTop:c=0,paddingRight:f=0}=t,u=n.split(`
`),d=u.map(C=>C3(C,o,a,r)),h=1.5,p=o*h,v=Math.max(...d),x=S3(e,t,v,u.length,h);TF(s,x,{...t,color:t.backgroundColor});let S=x.y+c;u.forEach((C,I)=>{const A=k3(e,t,d[I])+l;s.textAlign="left",s.textBaseline="top",s.font=NF(o,a,r),s.fillStyle=t.color||"currentColor",s.fillText(C,A,S,x.width-l-f),S+=p})}function LF(s,e,t){const{size:n=12,family:o,weight:r,paddingLeft:a=0,paddingTop:l=0}=t,c=e.text.split(`
`),f=c.map(S=>C3(S,n,r,o)),u=1.5,d=Math.max(...f),{x:h,y:p,width:v,height:x}=S3(e,t,d,c.length,u);return s.x>=h&&s.x<=h+v&&s.y>=p&&s.y<=p+x}const EF={name:"textBox",checkEventOn:(s,e,t)=>LF(s,e,t),draw:(s,e,t)=>{FF(s,e,t)}},$F=[EF],DF={name:"BIAS",shortName:"BIAS",precision:2,calcParams:[6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"bias",title:"BIAS: ",type:"line"}],styles:{lines:[{color:"#2196F3",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||6;return s.reduce((n,o,r)=>{if(r>=t-1){let a=0;for(let c=r-t+1;c<=r;c++)a+=s[c].close;const l=a/t;n[o.timestamp]={bias:(o.close-l)/l*100}}else n[o.timestamp]={};return n},{})}},RF={name:"CCI",shortName:"CCI",precision:2,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cci",title:"CCI: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const{calcParams:t}=e,[n]=t;return s.reduce((o,r,a)=>(o[r.timestamp]={cci:jF(s,a,n)},o),{})}};function jF(s,e,t){if(e<t-1)return null;const n=[];for(let f=e-t+1;f<=e;f++){const u=s[f],d=(u.high+u.low+u.close)/3;n.push(d)}const o=n.reduce((f,u)=>f+u,0)/t,r=n.reduce((f,u)=>f+Math.abs(u-o),0)/t;if(r===0)return 0;const a=s[e];return((a.high+a.low+a.close)/3-o)/(.015*r)}const BF={name:"ICHIMOKU",shortName:"ICHIMOKU",precision:4,calcParams:[9,26,52],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"tenkan",title:"Tenkan: ",type:"line"},{key:"kijun",title:"Kijun: ",type:"line"},{key:"senkouA",title:"Senkou A: ",type:"line"},{key:"senkouB",title:"Senkou B: ",type:"line"},{key:"chikou",title:"Chikou: ",type:"line"}],styles:{lines:[{color:"#FF6B6B",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4ECDC4",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#45B7D1",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#FFA07A",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#9B59B6",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||9,n=e.calcParams[1]||26,o=e.calcParams[2]||52,r=n,a=[],l=(f,u)=>{let d=-1/0,h=1/0;for(let p=f;p<f+u&&p<s.length;p++)s[p].high>d&&(d=s[p].high),s[p].low<h&&(h=s[p].low);return{high:d,low:h}};for(let f=0;f<s.length;f++){const u={};if(f>=t-1){const{high:d,low:h}=l(f-t+1,t);u.tenkan=(d+h)/2}if(f>=n-1){const{high:d,low:h}=l(f-n+1,n);u.kijun=(d+h)/2}if(f>=n-1){const d=f,h=f;if(d>=t-1&&h>=n-1){const{high:p,low:v}=l(d-t+1,t),{high:x,low:S}=l(h-n+1,n),C=(p+v)/2,I=(x+S)/2;u.senkouA=(C+I)/2}}if(f>=o-1){const{high:d,low:h}=l(f-o+1,o);u.senkouB=(d+h)/2}u.chikou=s[f].close,a.push(u)}const c=a.map((f,u)=>{var h,p,v;const d={...f};return u>=r?(d.senkouA=(h=a[u-r])==null?void 0:h.senkouA,d.senkouB=(p=a[u-r])==null?void 0:p.senkouB):(d.senkouA=void 0,d.senkouB=void 0),u+r<a.length?d.chikou=(v=s[u+r])==null?void 0:v.close:d.chikou=void 0,d});return s.reduce((f,u,d)=>(f[u.timestamp]=c[d],f),{})},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var h;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l,u=t.result;s.save();const d=[];for(let p=c;p<f;p++){const v=(h=a[p])==null?void 0:h.timestamp,x=u[v];if(x&&x.senkouA!==void 0&&x.senkouB!==void 0){const S=o.convertToPixel(p),C=r.convertToPixel(x.senkouA),I=r.convertToPixel(x.senkouB);d.push({x:S,yA:C,yB:I})}}if(d.length>1){s.globalAlpha=.2;const p=d[0].yA<d[0].yB;s.fillStyle=p?"#4CAF50":"#F44336",s.beginPath(),s.moveTo(d[0].x,Math.min(d[0].yA,d[0].yB));for(let v=1;v<d.length;v++)s.lineTo(d[v].x,Math.min(d[v].yA,d[v].yB));for(let v=d.length-1;v>=0;v--)s.lineTo(d[v].x,Math.max(d[v].yA,d[v].yB));s.closePath(),s.fill()}return s.restore(),!1}},OF={name:"PVT",shortName:"PVT",precision:2,calcParams:[],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"pvt",title:"PVT: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t={};if(s.length===0)return t;let n=0;for(let o=0;o<s.length;o++){const r=s[o];if(o===0){t[r.timestamp]={pvt:0};continue}const a=s[o-1];if(r.close==null||a.close==null||r.volume==null||r.close<=0||a.close<=0){t[r.timestamp]={};continue}const l=(r.close-a.close)/a.close,c=n+(r.volume||0)*l;t[r.timestamp]={pvt:c},n=c}return t}},Sm=new Map,My=s=>({id:s,period:14,lineColor:"#8B5CF6",lineThickness:2,lineStyle:"solid",overboughtLevel:70,oversoldLevel:30,middleLevel:50,overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",overboughtFillColor:"#EF4444",oversoldFillColor:"#22C55E",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed",fillOpacity:.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:70,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"70",visible:!0},{id:"middle",value:50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"50",visible:!0},{id:"oversold",value:30,color:"#22C55E",lineStyle:"dashed",thickness:1,label:"30",visible:!0}]}),zF=(s,e)=>{const t=[];if(s.length<e+1)return s.map(()=>NaN);let n=[],o=[];for(let f=1;f<=e;f++){const u=s[f].close-s[f-1].close;n.push(u>0?u:0),o.push(u<0?Math.abs(u):0)}let r=n.reduce((f,u)=>f+u,0)/e,a=o.reduce((f,u)=>f+u,0)/e;for(let f=0;f<e;f++)t.push(NaN);let l=r/(a||1e-4),c=100-100/(1+l);t.push(c);for(let f=e+1;f<s.length;f++){const u=s[f].close-s[f-1].close,d=u>0?u:0,h=u<0?Math.abs(u):0;r=(r*(e-1)+d)/e,a=(a*(e-1)+h)/e,l=r/(a||1e-4),c=100-100/(1+l),t.push(c)}return t};function VF(s){if(!s)return null;const e=s.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i);if(e)return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)};const t=s.match(/^#?([a-f\d])([a-f\d])([a-f\d])$/i);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16)};const n=s.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*[\d.]+\s*)?\)/i);return n?{r:parseInt(n[1],10),g:parseInt(n[2],10),b:parseInt(n[3],10)}:null}function Q1(s,e,t,n,o){if(e<=o&&n>=o||e>=o&&n<=o){if(e===n)return null;const r=(o-e)/(n-e);return{x:s+r*(t-s),y:o}}return null}const I3={name:"RSI",shortName:"RSI",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"rsi",title:"RSI: ",type:"line"}],styles:{lines:[{color:"#8B5CF6",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||14,n=zF(s,t);return s.reduce((o,r,a)=>{const l=n[a];return o[r.timestamp]={rsi:isNaN(l)?null:l},o},{})},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var v,x,S,C;const a=t.paneId||"default";let l=Sm.get(a);l||(l=My(a),Sm.set(a,l));const{left:c,width:f}=n,u=e.getVisibleRange(),d=e.getDataList();s.save();const h=r.convertToPixel(l.overboughtLevel),p=r.convertToPixel(l.oversoldLevel);if(l.showFill){const I=[],A=[];let P=!1,T=!1;for(let j=u.from;j<=u.to;j++){const E=(v=d[j])==null?void 0:v.timestamp,L=t.result[E];if(!L||L.rsi===null||L.rsi===void 0)continue;const D=o.convertToPixel(j),X=r.convertToPixel(L.rsi);if(D===null||X===null)continue;const ne=(x=d[j-1])==null?void 0:x.timestamp,de=j>0?t.result[ne]:null,ie=de==null?void 0:de.rsi,te=j>0?o.convertToPixel(j-1):null,le=ie!=null?r.convertToPixel(ie):null;if(L.rsi>l.overboughtLevel){if(!P&&(P=!0,te!==null&&le!==null&&ie!==null&&ie!==void 0&&ie<=l.overboughtLevel)){const pe=Q1(te,le,D,X,h);pe&&(I.push({x:pe.x,y:h}),pe.x)}I.push({x:D,y:X})}else if(P){if(te!==null&&le!==null&&ie!==null&&ie!==void 0){const pe=Q1(te,le,D,X,h);pe&&I.push({x:pe.x,y:h})}I.length>=2&&ey(s,I,h,l.overboughtFillColor,l.fillOpacity,"above"),I.length=0,P=!1}if(L.rsi<l.oversoldLevel){if(!T&&(T=!0,te!==null&&le!==null&&ie!==null&&ie!==void 0&&ie>=l.oversoldLevel)){const pe=Q1(te,le,D,X,p);pe&&(A.push({x:pe.x,y:p}),pe.x)}A.push({x:D,y:X})}else if(T){if(te!==null&&le!==null&&ie!==null&&ie!==void 0){const pe=Q1(te,le,D,X,p);pe&&A.push({x:pe.x,y:p})}A.length>=2&&ey(s,A,p,l.oversoldFillColor,l.fillOpacity,"below"),A.length=0,T=!1}}P&&I.length>=2&&ey(s,I,h,l.overboughtFillColor,l.fillOpacity,"above"),T&&A.length>=2&&ey(s,A,p,l.oversoldFillColor,l.fillOpacity,"below")}l.showLevels&&l.levels.forEach(I=>{if(!I.visible)return;const A=r.convertToPixel(I.value);if(A===null)return;s.save(),s.strokeStyle=I.color;let P=1,T="dashed";I.id==="overbought"?(P=l.overboughtThickness??1,T=l.overboughtLineStyle??"dashed"):I.id==="oversold"?(P=l.oversoldThickness??1,T=l.oversoldLineStyle??"dashed"):I.id==="middle"&&(P=l.middleLineThickness??1,T=l.middleLineStyle??"dashed"),P=Math.max(1,Math.round(P)),s.lineWidth=P;const j=P%2===1?Math.floor(A)+.5:Math.round(A);T==="dashed"?s.setLineDash([6*P,4*P]):T==="dotted"?s.setLineDash([P,P*2]):s.setLineDash([]),s.beginPath(),s.moveTo(Math.floor(c),j),s.lineTo(Math.floor(c+f),j),s.stroke(),s.restore()}),s.lineCap="round",s.lineJoin="round";for(let I=u.from;I<u.to;I++){const A=(S=d[I])==null?void 0:S.timestamp,P=(C=d[I+1])==null?void 0:C.timestamp,T=t.result[A],j=t.result[P];if(!T||!j||T.rsi===null||T.rsi===void 0||j.rsi===null||j.rsi===void 0)continue;const E=o.convertToPixel(I),L=o.convertToPixel(I+1),D=r.convertToPixel(T.rsi),X=r.convertToPixel(j.rsi);if(E===null||L===null||D===null||X===null)continue;let ne=l.lineColor;T.rsi>l.overboughtLevel?ne=l.overboughtColor:T.rsi<l.oversoldLevel&&(ne=l.oversoldColor),s.strokeStyle=ne,s.lineWidth=l.lineThickness,l.lineStyle==="dashed"?s.setLineDash([6,4]):l.lineStyle==="dotted"?s.setLineDash([2,2]):s.setLineDash([]),s.beginPath(),s.moveTo(E,D),s.lineTo(L,X),s.stroke()}return s.restore(),!0}};function ey(s,e,t,n,o,r){if(e.length<2)return;s.save();let a=VF(n);a||(a=r==="above"?{r:239,g:68,b:68}:{r:34,g:197,b:94});const l=Math.min(...e.map(u=>u.y)),c=Math.max(...e.map(u=>u.y));let f;r==="above"?(f=s.createLinearGradient(0,t,0,l),f.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),f.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${o*.5})`),f.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${o})`)):(f=s.createLinearGradient(0,t,0,c),f.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, 0.02)`),f.addColorStop(.5,`rgba(${a.r}, ${a.g}, ${a.b}, ${o*.5})`),f.addColorStop(1,`rgba(${a.r}, ${a.g}, ${a.b}, ${o})`)),s.fillStyle=f,s.beginPath(),s.moveTo(e[0].x,e[0].y);for(let u=1;u<e.length;u++)s.lineTo(e[u].x,e[u].y);s.lineTo(e[e.length-1].x,t),s.lineTo(e[0].x,t),s.closePath(),s.fill(),s.restore()}const Tg={createInstance:(s,e)=>{const t=My(s);return e&&(e.levels&&(t.levels=e.levels),Object.keys(e).forEach(n=>{n!=="levels"&&e[n]!==void 0&&(t[n]=e[n])})),Sm.set(s,t),t},getInstance:s=>Sm.get(s),getInstanceConfig:s=>Sm.get(s)||null,updateInstance:(s,e)=>{const t=Sm.get(s);if(!t){const n=My(s);return Object.assign(n,e),Sm.set(s,n),!0}return e.levels&&(t.levels=e.levels),Object.keys(e).forEach(n=>{n!=="levels"&&e[n]!==void 0&&(t[n]=e[n])}),Sm.set(s,t),!0},deleteInstance:s=>Sm.delete(s),getAllInstances:()=>new Map(Sm),clearAllInstances:()=>{Sm.clear()},resetInstance:s=>{const e=My(s);Sm.set(s,e)},exportInstanceConfig:s=>Sm.get(s)||null,importInstanceConfig:s=>{try{if(!s||!s.id)return!1;const e={id:s.id,period:s.period??14,lineColor:s.lineColor??"#8B5CF6",lineThickness:s.lineThickness??2,lineStyle:s.lineStyle??"solid",overboughtLevel:s.overboughtLevel??70,oversoldLevel:s.oversoldLevel??30,middleLevel:s.middleLevel??50,overboughtColor:s.overboughtColor??"#EF4444",overboughtThickness:s.overboughtThickness??1,overboughtLineStyle:s.overboughtLineStyle??"dashed",oversoldColor:s.oversoldColor??"#22C55E",oversoldThickness:s.oversoldThickness??1,oversoldLineStyle:s.oversoldLineStyle??"dashed",overboughtFillColor:s.overboughtFillColor??s.overboughtColor??"#EF4444",oversoldFillColor:s.oversoldFillColor??s.oversoldColor??"#22C55E",middleLineColor:s.middleLineColor??"#6B7280",middleLineThickness:s.middleLineThickness??1,middleLineStyle:s.middleLineStyle??"dashed",fillOpacity:s.fillOpacity??.15,showLevels:s.showLevels??!0,showFill:s.showFill??!0,levels:s.levels??[{id:"overbought",value:s.overboughtLevel??70,color:s.overboughtColor??"#EF4444",lineStyle:s.overboughtLineStyle??"dashed",thickness:s.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:s.middleLevel??50,color:s.middleLineColor??"#6B7280",lineStyle:s.middleLineStyle??"dashed",thickness:s.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:s.oversoldLevel??30,color:s.oversoldColor??"#22C55E",lineStyle:s.oversoldLineStyle??"dashed",thickness:s.oversoldThickness??1,label:"30",visible:!0}]};return Sm.set(s.id,e),!0}catch(e){return console.error("Failed to import RSI instance config:",e),!1}},updateLevel:(s,e,t)=>{const n=Sm.get(s);if(!n)return!1;const o=n.levels.find(r=>r.id===e);return o?(Object.assign(o,t),e==="overbought"&&t.value!==void 0?n.overboughtLevel=t.value:e==="oversold"&&t.value!==void 0?n.oversoldLevel=t.value:e==="middle"&&t.value!==void 0&&(n.middleLevel=t.value),!0):!1},addLevel:(s,e)=>{const t=Sm.get(s);if(!t)throw new Error(`RSI instance ${s} not found`);const n=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...e,id:n,value:Math.max(0,Math.min(100,e.value))};return t.levels.push(o),n},removeLevel:(s,e)=>{const t=Sm.get(s);if(!t)return!1;const n=t.levels.findIndex(o=>o.id===e);return n===-1?!1:(t.levels.splice(n,1),!0)}},Yw=Object.freeze(Object.defineProperty({__proto__:null,RSIManager:Tg,rsi:I3},Symbol.toStringTag,{value:"Module"})),WF={name:"SAR",shortName:"SAR",precision:4,calcParams:[.02,.02,.2],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sar",title:"SAR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||.02,n=e.calcParams[1]||.02,o=e.calcParams[2]||.2,r={};if(s.length<2)return s.map(()=>({}));let a=!0,l=t,c=s[0].high,f=s[0].low;r[s[0].timestamp]={sar:f};for(let u=1;u<s.length;u++){const d=s[u],h=s[u-1];a?(f=f+l*(c-f),f=Math.min(f,d.low,h.low),d.low<=f?(a=!1,f=c,c=d.low,l=t):d.high>c&&(c=d.high,l=Math.min(l+n,o))):(f=f-l*(f-c),f=Math.max(f,d.high,h.high),d.high>=f?(a=!0,f=c,c=d.high,l=t):d.low<c&&(c=d.low,l=Math.min(l+n,o))),r[s[u].timestamp]={sar:f}}return r},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var h,p,v;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;s.save();const u=((p=(h=t.styles)==null?void 0:h.lines)==null?void 0:p[0])||{color:"#2563eb",size:1},d=u.size||1;for(let x=c;x<=f;x++){const S=(v=a[x])==null?void 0:v.timestamp,C=t.result[S];if(!C||typeof C.sar!="number")continue;const I=o.convertToPixel(x),A=r.convertToPixel(C.sar);I>=n.left&&I<=n.left+n.width&&A>=n.top&&A<=n.top+n.height&&(s.beginPath(),s.arc(I,A,d,0,2*Math.PI),s.fillStyle=u.color,s.fill(),s.strokeStyle=u.color,s.lineWidth=1,s.stroke())}return s.restore(),!0}},Qh=new Map,H2=s=>({id:s,period:14,lineColor:"#2563eb",lineThickness:1,lineStyle:"solid",showLevels:!0,showZones:!0,yAxisSync:!0,enableDynamicColoring:!0,overboughtColor:"#EF4444",oversoldColor:"#10B981",overboughtThreshold:-20,oversoldThreshold:-80,levels:[{id:"overbought",value:-20,color:"#EF4444",lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"middle",value:-50,color:"#6B7280",lineStyle:"dashed",thickness:1,label:"Middle",visible:!0},{id:"oversold",value:-80,color:"#10B981",lineStyle:"solid",thickness:1,label:"Oversold",visible:!0}],zones:[{id:"overbought_zone",topLevel:0,bottomLevel:-20,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:-80,bottomLevel:-100,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),HF=(s,e)=>{const t=[];if(s.length<e)return s.map(()=>NaN);for(let n=0;n<s.length;n++){if(n<e-1){t.push(NaN);continue}let o=s[n-e+1].high,r=s[n-e+1].low;for(let c=n-e+2;c<=n;c++)s[c].high>o&&(o=s[c].high),s[c].low<r&&(r=s[c].low);const a=s[n].close,l=(o-a)/(o-r)*-100;t.push(isNaN(l)?0:l)}return t},qF={name:"WR",shortName:"WR",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:-100,maxValue:0,figures:[{key:"wr",title:"WR: ",type:"line"}],styles:{lines:[{color:"#2563eb",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||14,n=HF(s,t);return s.reduce((o,r,a)=>{const l=n[a];return o[r.timestamp]={wr:isNaN(l)?null:l},o},{})},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var p,v;const a=t.paneId||"default";let l=Qh.get(a);l||(l=H2(a),Qh.set(a,l));const{left:c,top:f,width:u,height:d}=n,h=e.getVisibleRange();if(s.save(),l.showZones&&l.zones.forEach(x=>{if(!x.visible)return;const S=r.convertToPixel(x.topLevel),C=r.convertToPixel(x.bottomLevel);if(S!==null&&C!==null){s.save();const I=Math.abs(S-C),A=Math.min(S,C),P=s.createLinearGradient(c,A,c,A+I),j=x.fillColor.match(/\w\w/g);if(j){const E=parseInt(j[0],16),L=parseInt(j[1],16),D=parseInt(j[2],16);P.addColorStop(0,`rgba(${E}, ${L}, ${D}, ${x.fillOpacity*.8})`),P.addColorStop(.3,`rgba(${E}, ${L}, ${D}, ${x.fillOpacity*.6})`),P.addColorStop(.7,`rgba(${E}, ${L}, ${D}, ${x.fillOpacity*.3})`),P.addColorStop(1,`rgba(${E}, ${L}, ${D}, ${x.fillOpacity*.1})`)}else P.addColorStop(0,x.fillColor+Math.floor(x.fillOpacity*255).toString(16).padStart(2,"0")),P.addColorStop(.5,x.fillColor+Math.floor(x.fillOpacity*128).toString(16).padStart(2,"0")),P.addColorStop(1,x.fillColor+Math.floor(x.fillOpacity*32).toString(16).padStart(2,"0"));s.fillStyle=P,s.fillRect(c,A,u,I),s.strokeStyle=x.fillColor+"40",s.lineWidth=.5,s.strokeRect(c,A,u,I),s.restore()}}),l.showLevels&&l.levels.forEach(x=>{if(!x.visible)return;const S=r.convertToPixel(x.value);S!==null&&(s.save(),s.strokeStyle=x.color,s.lineWidth=x.thickness,x.lineStyle==="dashed"?s.setLineDash([4,4]):x.lineStyle==="dotted"?s.setLineDash([2,2]):s.setLineDash([]),s.beginPath(),s.moveTo(c,S),s.lineTo(c+u,S),s.stroke(),l.yAxisSync&&(s.font="11px Arial",s.textAlign="left",s.fillStyle=x.color,s.fillText(`WR ${x.value}`,c+u+5,S+4)),s.restore())}),l.enableDynamicColoring&&t.result){const{from:x,to:S}=h,C=e.getDataList();for(let I=x;I<S;I++){const A=(p=C[I])==null?void 0:p.timestamp,P=(v=t.result[A])==null?void 0:v.wr;if(P!=null){const T=o.convertToPixel(I),j=r.convertToPixel(P);if(T!==null&&j!==null){s.save();let E=l.lineColor;P>l.overboughtThreshold?E=l.overboughtColor:P<l.oversoldThreshold&&(E=l.oversoldColor),s.fillStyle=E,s.beginPath(),s.arc(T,j,1,0,2*Math.PI),s.fill(),s.restore()}}}}return s.restore(),!1}},Yb={createInstance:(s,e)=>{const t=H2(s);return e&&Object.assign(t,e),Qh.set(s,t),t},getInstance:s=>Qh.get(s),updateInstance:(s,e)=>{const t=Qh.get(s);return t?(Object.assign(t,e),Qh.set(s,t),!0):!1},deleteInstance:s=>Qh.delete(s),addLevel:(s,e)=>{const t=Qh.get(s);if(!t)throw new Error(`WR instance ${s} not found`);const n=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...e,id:n,value:Math.max(-100,Math.min(0,e.value))};return t.levels.push(o),n},removeLevel:(s,e)=>{const t=Qh.get(s);if(!t)return!1;const n=t.levels.findIndex(o=>o.id===e);return n===-1?!1:(t.levels.splice(n,1),!0)},updateLevel:(s,e,t)=>{const n=Qh.get(s);if(!n)return!1;const o=n.levels.find(r=>r.id===e);return o?(t.value!==void 0&&(t.value=Math.max(-100,Math.min(0,t.value))),t.thickness!==void 0&&(t.thickness=Math.max(1,Math.min(5,t.thickness))),Object.assign(o,t),!0):!1},addZone:(s,e)=>{const t=Qh.get(s);if(!t)throw new Error(`WR instance ${s} not found`);const n=Math.max(-100,Math.min(0,Math.max(e.topLevel,e.bottomLevel))),o=Math.max(-100,Math.min(0,Math.min(e.topLevel,e.bottomLevel))),r=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={...e,id:r,topLevel:n,bottomLevel:o,fillOpacity:Math.max(0,Math.min(1,e.fillOpacity||.15))};return t.zones.push(a),r},removeZone:(s,e)=>{const t=Qh.get(s);if(!t)return!1;const n=t.zones.findIndex(o=>o.id===e);return n===-1?!1:(t.zones.splice(n,1),!0)},updateZone:(s,e,t)=>{const n=Qh.get(s);if(!n)return!1;const o=n.zones.find(r=>r.id===e);if(!o)return!1;if(t.topLevel!==void 0&&(t.topLevel=Math.max(-100,Math.min(0,t.topLevel))),t.bottomLevel!==void 0&&(t.bottomLevel=Math.max(-100,Math.min(0,t.bottomLevel))),t.fillOpacity!==void 0&&(t.fillOpacity=Math.max(0,Math.min(1,t.fillOpacity))),Object.assign(o,t),o.topLevel<o.bottomLevel){const r=o.topLevel;o.topLevel=o.bottomLevel,o.bottomLevel=r}return!0},getInstanceConfig:s=>Qh.get(s)||null,resetInstance:s=>{const e=H2(s);Qh.set(s,e)},exportInstanceConfig:s=>{const e=Qh.get(s);return e?{id:s,period:e.period,lineColor:e.lineColor,lineThickness:e.lineThickness,lineStyle:e.lineStyle,showLevels:e.showLevels,showZones:e.showZones,yAxisSync:e.yAxisSync,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:s=>{try{const e={id:s.id,period:s.period||14,lineColor:s.lineColor||"#FF6B35",lineThickness:s.lineThickness||2,lineStyle:s.lineStyle||"solid",showLevels:s.showLevels??!0,showZones:s.showZones??!0,yAxisSync:s.yAxisSync??!0,enableDynamicColoring:s.enableDynamicColoring??!0,overboughtColor:s.overboughtColor||"#EF4444",oversoldColor:s.oversoldColor||"#10B981",overboughtThreshold:s.overboughtThreshold||-20,oversoldThreshold:s.oversoldThreshold||-80,levels:s.levels||[],zones:s.zones||[]};return Qh.set(s.id,e),!0}catch(e){return console.error("Failed to import WR instance config:",e),!1}},getAllInstances:()=>new Map(Qh),clearAllInstances:()=>{Qh.clear()}},UF={name:"VR",shortName:"VR",precision:2,calcParams:[26,6,12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:100-1e-9,maxValue:100+1e-9,figures:[{key:"vr",title:"VR: ",type:"line"},{key:"vrShort",title:"VR Short: ",type:"line"},{key:"vrLong",title:"VR Long: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#4CAF50",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||26,n=e.calcParams[1]||6,o=e.calcParams[2]||12,r={};if(s.length<Math.max(t,n,o)+1)return s.reduce((l,c)=>(l[c.timestamp]={},l),{});const a=(l,c)=>{if(l<c)return 100;let f=0,u=0,d=0;for(let v=l-c+1;v<=l;v++){if(v===0)continue;const x=s[v],S=s[v-1];x.close>S.close?f+=x.volume||0:x.close<S.close?u+=x.volume||0:d+=x.volume||0}const h=f+d/2,p=u+d/2;return p===0?100:h/p*100};for(let l=0;l<s.length;l++){const c=a(l,t),f=a(l,n),u=a(l,o);r[s[l].timestamp]={vr:c,vrShort:f,vrLong:u}}return r},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{e.getVisibleRange(),s.save(),s.lineWidth=1,s.setLineDash([2,2]),s.strokeStyle="rgba(107, 114, 128, 0.6)",s.beginPath();const a=r.convertToPixel(100);s.moveTo(n.left,a),s.lineTo(n.left+n.width,a),s.stroke(),s.strokeStyle="rgba(239, 68, 68, 0.6)",s.beginPath();const l=r.convertToPixel(150);s.moveTo(n.left,l),s.lineTo(n.left+n.width,l),s.stroke(),s.strokeStyle="rgba(34, 197, 94, 0.6)",s.beginPath();const c=r.convertToPixel(70);return s.moveTo(n.left,c),s.lineTo(n.left+n.width,c),s.stroke(),s.restore(),!1}},GF={name:"ROC",shortName:"ROC",precision:2,calcParams:[14],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"roc",title:"ROC: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#FF6B6B",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const{calcParams:t}=e,[n]=t;return s.reduce((o,r,a)=>(o[r.timestamp]={roc:YF(s,a,n)},o),{})}};function YF(s,e,t){if(e<t)return null;const n=s[e].close,o=s[e-t].close;return o===0?null:(n-o)/o*100}const KF={name:"PSY",shortName:"PSY",precision:2,calcParams:[12,6],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"mapsy",title:"MAPSY: ",type:"line"}],minValue:0,maxValue:100,styles:{lines:[{color:"#2563eb",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const{calcParams:t}=e,[n,o]=t;return s.reduce((r,a,l)=>(r[a.timestamp]={psy:P3(s,l,n),mapsy:XF(s,l,n,o)},r),{})}};function P3(s,e,t){if(e<t)return null;let n=0;for(let o=e-t+1;o<=e;o++)o>0&&s[o].close>s[o-1].close&&n++;return n/t*100}function XF(s,e,t,n){if(e<t+n-1)return null;let o=0,r=0;for(let a=e-n+1;a<=e;a++){const l=P3(s,a,t);l!==null&&(o+=l,r++)}return r>0?o/r:null}const ZF={name:"OBV",shortName:"OBV",precision:0,calcParams:[30,10],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maobv",title:"MAOBV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[1]||10,n={};if(s.length===0)return n;let o=0;const r=[];for(let a=0;a<s.length;a++){const l=s[a];if(a===0)o=0;else{const f=s[a-1],u=l.volume||0;l.close>f.close?o+=u:l.close<f.close&&(o-=u)}r.push(o);let c;if(a>=t-1){let f=0;for(let u=a-t+1;u<=a;u++)f+=r[u];c=f/t}n[l.timestamp]={obv:o,maobv:c}}return n}},JF={name:"ZIGZAG",shortName:"ZIGZAG",precision:2,calcParams:[5,5],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:1,extendData:void 0,figures:[],styles:{lines:[{color:"#2962FF",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}],circles:[{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888"}]},calc:(s,e)=>{const t=(e.calcParams[0]||5)/100,n=e.calcParams[1]||5,o=[];if(s.length<n*2)return s.map(()=>({}));let r=0,a=s[0].high,l="high",c=!1;for(let f=0;f<s.length;f++)o.push({});o[0]={zigzag:s[0].close};for(let f=n;f<s.length;f++){const u=s[f].high,d=s[f].low,h=Math.abs(u-a)/a,p=Math.abs(d-a)/a;if(h>=t){r=f,a=u,l="high",c=!1,o[f]={zigzag:u,isHigh:!0};break}else if(p>=t){r=f,a=d,l="low",c=!0,o[f]={zigzag:d,isLow:!0};break}}for(let f=r+n;f<s.length;f++){const u=s[f].high,d=s[f].low;c?(u-a)/a>=t?(r=f,a=u,l="high",c=!1,o[f]={zigzag:u,isHigh:!0}):l==="low"&&d<a&&(o[r]={},r=f,a=d,o[f]={zigzag:d,isLow:!0}):(a-d)/a>=t?(r=f,a=d,l="low",c=!0,o[f]={zigzag:d,isLow:!0}):l==="high"&&u>a&&(o[r]={},r=f,a=u,o[f]={zigzag:u,isHigh:!0})}return o},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var p,v,x,S;if(!t.result||t.result.length===0)return!1;const a=e.getVisibleRange(),{from:l,to:c}=a,f=t.result;s.save();const u=((v=(p=t.styles)==null?void 0:p.lines)==null?void 0:v[0])||{color:"#2962FF",size:2,style:mt.Solid,dashedValue:[2,2]},d=((S=(x=t.styles)==null?void 0:x.circles)==null?void 0:S[0])||{upColor:"#26A69A",downColor:"#EF5350"},h=[];for(let C=Math.max(0,l-50);C<Math.min(c+1,f.length);C++){const I=f[C];I&&typeof I.zigzag=="number"&&h.push({index:C,price:I.zigzag,isHigh:I.isHigh||!1,isLow:I.isLow||!1})}if(s.strokeStyle=u.color||"#2962FF",s.lineWidth=u.size||2,u.style===mt.Dashed){const C=Array.isArray(u.dashedValue)?u.dashedValue:[4,4];s.setLineDash(C)}else s.setLineDash([]);for(let C=0;C<h.length-1;C++){const I=h[C],A=h[C+1],P=o.convertToPixel(I.index),T=r.convertToPixel(I.price),j=o.convertToPixel(A.index),E=r.convertToPixel(A.price);s.beginPath(),s.moveTo(P,T),s.lineTo(j,E),s.stroke()}return h.forEach(C=>{if(C.index<l||C.index>=c)return;const I=o.convertToPixel(C.index),A=r.convertToPixel(C.price);I>=n.left&&I<=n.left+n.width&&A>=n.top&&A<=n.top+n.height&&(s.beginPath(),s.arc(I,A,4,0,2*Math.PI),C.isHigh?s.fillStyle=d.downColor:C.isLow?s.fillStyle=d.upColor:s.fillStyle=u.color,s.fill(),s.strokeStyle="#FFFFFF",s.lineWidth=1.5,s.stroke())}),s.restore(),!0}},QF={name:"Custom Momentum",shortName:"CM",calcParams:[12,26],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{lines:[{color:"#26a69a",size:2,style:"solid"}],bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid"}]},figures:[{key:"momentum",title:"Momentum: ",type:"line",baseValue:0},{key:"histogram",title:"Histogram: ",type:"bar",baseValue:0,styles:{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575"}}],calc:(s,e)=>{const t=e.calcParams[0]||12,n=e.calcParams[1]||26,o=[];for(let r=0;r<s.length;r++){const l=s[r].close;if(r>=n-1){let c=0;if(r===n-1){let h=0;for(let p=r-t+1;p<=r;p++)h+=s[p].close;c=h/t}else{const h=2/(t+1);c=l*h+(o[r-1].momentum||0)*(1-h)}let f=0;if(r===n-1){let h=0;for(let p=r-n+1;p<=r;p++)h+=s[p].close;f=h/n}else{const h=2/(n+1);f=l*h+(o[r-1].momentum||0)*(1-h)}const u=c-f,d=u;o.push({momentum:u,histogram:d})}else o.push({})}return o}},eL={name:"AO",shortName:"AO",calcParams:[5,34],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:5,styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#757575",reverseColor:"#c4c4c4",size:3,borderColor:"#26a69a",borderSize:0,borderStyle:"solid",fillColor:"#26a69a",strokeColor:"#26a69a"}]},figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:s,indicator:e,defaultStyles:t})=>{var h,p,v,x,S,C;const{prev:n,current:o}=s,r=typeof(n==null?void 0:n.ao)=="number"?n.ao:null,a=typeof(o==null?void 0:o.ao)=="number"?o.ao:null,l=iv.formatValue(e.styles,"bars[0].upColor",((p=(h=t==null?void 0:t.bars)==null?void 0:h[0])==null?void 0:p.upColor)??"#26a69a"),c=iv.formatValue(e.styles,"bars[0].downColor",((x=(v=t==null?void 0:t.bars)==null?void 0:v[0])==null?void 0:x.downColor)??"#ef5350"),f=iv.formatValue(e.styles,"bars[0].noChangeColor",((C=(S=t==null?void 0:t.bars)==null?void 0:S[0])==null?void 0:C.noChangeColor)??"#757575"),u=iv.formatValue(e.styles,"bars[0].reverseColor",f);let d=u;return a!==null&&(a>=0?r===null||a>=r?d=l:d=u:r===null||a<=r?d=c:d=u),{color:d,style:"fill",borderColor:d}}}],calc:(s,e)=>{const t=e.calcParams[0]||5,n=e.calcParams[1]||34,o={};for(let r=0;r<s.length;r++){const a=s[r].timestamp;if(r>=n-1){const l=[],c=[];for(let h=r-t+1;h<=r;h++){const p=(s[h].high+s[h].low)/2;l.push(p)}for(let h=r-n+1;h<=r;h++){const p=(s[h].high+s[h].low)/2;c.push(p)}const f=l.reduce((h,p)=>h+p,0)/t,u=c.reduce((h,p)=>h+p,0)/n,d=f-u;o[a]={ao:d}}else o[a]={}}return o}},tL={name:"BOLL",shortName:"BOLL",precision:2,calcParams:[20,2],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"upper",title:"Upper: ",type:"line"},{key:"middle",title:"Middle: ",type:"line"},{key:"lower",title:"Lower: ",type:"line"}],styles:{lines:[{color:"#f23645",size:1,style:mt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#2962ff",size:1,style:mt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#089981",size:1,style:mt.Solid,smooth:!1,dashedValue:[0,0]}],fill:{color:"#2196F3",opacity:.05}},calc:(s,e)=>{const t=e.calcParams[0]||20,n=e.calcParams[1]||2,o={};for(let r=0;r<s.length;r++){const a=s[r].timestamp;if(r<t-1){o[a]={};continue}let l=0;for(let p=r-t+1;p<=r;p++)l+=s[p].close;const c=l/t;let f=0;for(let p=r-t+1;p<=r;p++)f+=Math.pow(s[p].close-c,2);const u=Math.sqrt(f/t),d=c+n*u,h=c-n*u;o[a]={upper:d,middle:c,lower:h}}return o},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var x,S,C,I,A,P,T,j,E,L,D,X,ne,de,ie,te,le,pe,re,xe,se,Ne,Te,Me,De,Oe,Ke,kt,pt,Rt,Ht,Ft,zt,ut,nt,Je;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(l.from,0),f=Math.min(l.to,a.length-1);s.save();const u={color:((C=(S=(x=t.styles)==null?void 0:x.lines)==null?void 0:S[0])==null?void 0:C.color)||"#2196F3",size:((P=(A=(I=t.styles)==null?void 0:I.lines)==null?void 0:A[0])==null?void 0:P.size)||1,style:((E=(j=(T=t.styles)==null?void 0:T.lines)==null?void 0:j[0])==null?void 0:E.style)||mt.Solid},d={color:((X=(D=(L=t.styles)==null?void 0:L.lines)==null?void 0:D[1])==null?void 0:X.color)||"#FF9800",size:((ie=(de=(ne=t.styles)==null?void 0:ne.lines)==null?void 0:de[1])==null?void 0:ie.size)||1,style:((pe=(le=(te=t.styles)==null?void 0:te.lines)==null?void 0:le[1])==null?void 0:pe.style)||mt.Solid},h={color:((se=(xe=(re=t.styles)==null?void 0:re.lines)==null?void 0:xe[2])==null?void 0:se.color)||"#2196F3",size:((Me=(Te=(Ne=t.styles)==null?void 0:Ne.lines)==null?void 0:Te[2])==null?void 0:Me.size)||1,style:((Ke=(Oe=(De=t.styles)==null?void 0:De.lines)==null?void 0:Oe[2])==null?void 0:Ke.style)||mt.Solid},p={color:((pt=(kt=t.styles)==null?void 0:kt.fill)==null?void 0:pt.color)||"rgba(33, 150, 243, 0.1)",opacity:((Ht=(Rt=t.styles)==null?void 0:Rt.fill)==null?void 0:Ht.opacity)||.1};s.beginPath();let v=!0;for(let it=c;it<=f;it++){const ze=(Ft=a[it])==null?void 0:Ft.timestamp,Ge=t.result[ze];if(!Ge||typeof Ge.upper!="number")continue;const xt=o.convertToPixel(it),jt=r.convertToPixel(Ge.upper);v?(s.moveTo(xt,jt),v=!1):s.lineTo(xt,jt)}for(let it=f;it>=c;it--){const ze=(zt=a[it])==null?void 0:zt.timestamp,Ge=t.result[ze];if(!Ge||typeof Ge.lower!="number")continue;const xt=o.convertToPixel(it),jt=r.convertToPixel(Ge.lower);s.lineTo(xt,jt)}s.closePath(),s.globalAlpha=p.opacity,s.fillStyle=p.color,s.fill(),s.globalAlpha=1,s.beginPath(),v=!0;for(let it=c;it<=f;it++){const ze=(ut=a[it])==null?void 0:ut.timestamp,Ge=t.result[ze];if(!Ge||typeof Ge.upper!="number")continue;const xt=o.convertToPixel(it),jt=r.convertToPixel(Ge.upper);v?(s.moveTo(xt,jt),v=!1):s.lineTo(xt,jt)}s.strokeStyle=u.color,s.lineWidth=u.size,s.setLineDash(u.style===mt.Dashed?[4,4]:[]),s.stroke(),s.beginPath(),v=!0;for(let it=c;it<=f;it++){const ze=(nt=a[it])==null?void 0:nt.timestamp,Ge=t.result[ze];if(!Ge||typeof Ge.lower!="number")continue;const xt=o.convertToPixel(it),jt=r.convertToPixel(Ge.lower);v?(s.moveTo(xt,jt),v=!1):s.lineTo(xt,jt)}s.strokeStyle=h.color,s.lineWidth=h.size,s.setLineDash(h.style===mt.Dashed?[4,4]:[]),s.stroke(),s.beginPath(),v=!0;for(let it=c;it<=f;it++){const ze=(Je=a[it])==null?void 0:Je.timestamp,Ge=t.result[ze];if(!Ge||typeof Ge.middle!="number")continue;const xt=o.convertToPixel(it),jt=r.convertToPixel(Ge.middle);v?(s.moveTo(xt,jt),v=!1):s.lineTo(xt,jt)}return s.strokeStyle=d.color,s.lineWidth=d.size,s.setLineDash(d.style===mt.Dashed?[4,4]:[]),s.stroke(),s.restore(),!0}};function sL(s,e){const t=e.calcParams||[26,10,20,40,60],[n,o,r,a,l]=t,c={};if(s.length<n+1)return s.reduce((u,d,h)=>(u[d.timestamp]={},u),{});const f=[];for(let u=1;u<s.length;u++){s[u];const d=s[u-1];(d.high+d.low+d.close)/3;let h=0,p=0;const v=Math.max(0,u-n+1);for(let P=v;P<=u;P++){const T=s[P],j=P>0?s[P-1]:T,E=(j.high+j.low+j.close)/3,L=T.high-E,D=E-T.low;L>0&&(h+=L),D>0&&(p+=D)}const x=p!==0?h/p*100:100;f.push(x);const S=ty(f,o),C=ty(f,r),I=ty(f,a),A=ty(f,l);c[s[u].timestamp]={cr:x,ma1:S!==null?S:void 0,ma2:C!==null?C:void 0,ma3:I!==null?I:void 0,ma4:A!==null?A:void 0}}return c}function ty(s,e){return s.length<e?null:s.slice(-e).reduce((n,o)=>n+o,0)/e}const nL={name:"CR",shortName:"CR",precision:2,calcParams:[26,10,20,40,60],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:sL,regenerateFigures:s=>{const[,e,t,n,o]=s;return[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:`MA${e}: `,type:"line"},{key:"ma2",title:`MA${t}: `,type:"line"},{key:"ma3",title:`MA${n}: `,type:"line"},{key:"ma4",title:`MA${o}: `,type:"line"}]},styles:{lines:[{color:"#FF6B35",size:2,style:mt.Solid},{color:"#2196F3",size:1,style:mt.Solid},{color:"#4CAF50",size:1,style:mt.Solid},{color:"#FF9800",size:1,style:mt.Solid},{color:"#9C27B0",size:1,style:mt.Solid}]}},oL={name:"EMV",shortName:"EMV",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#2196F3",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{e.calcParams[0];const t=e.calcParams[1]||9,n={};if(s.length<2)return s.reduce((r,a)=>(r[a.timestamp]={},r),{});const o=[];for(let r=0;r<s.length;r++){const a=s[r];if(r===0){n[a.timestamp]={};continue}const l=s[r-1],c=(a.high+a.low)/2,f=(l.high+l.low)/2,u=c-f,d=a.high-a.low,h=a.volume||0;let p=0;if(d>0&&h>0){const x=h/d;p=u/x}o.push(p);let v;if(o.length>=t){let x=0;for(let S=o.length-t;S<o.length;S++)x+=o[S];v=x/t}n[a.timestamp]={emv:p,maEmv:v}}return n},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{e.getVisibleRange(),s.save(),s.lineWidth=1,s.setLineDash([2,2]),s.strokeStyle="rgba(107, 114, 128, 0.6)",s.beginPath();const a=r.convertToPixel(0);return s.moveTo(n.left,a),s.lineTo(n.left+n.width,a),s.stroke(),s.restore(),!1}},iL={name:"MTM",shortName:"MTM",precision:4,calcParams:[12],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"mtm",title:"MTM: ",type:"line"}],styles:{lines:[{color:"#FF6B35",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||12;return s.reduce((n,o,r)=>{if(r>=t){const a=o.close,l=s[r-t].close;n[o.timestamp]={mtm:a-l}}else n[o.timestamp]={};return n},{})}},rL={name:"TRIX",shortName:"TRIX",precision:4,calcParams:[14,9],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"signal",title:"Signal: ",type:"line"}],minValue:void 0,maxValue:void 0,styles:{lines:[{color:"#2563eb",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]},{color:"#dc2626",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const{calcParams:t}=e,[n,o]=t,r=aL(s,n),a=Ny(r,o);return s.reduce((l,c,f)=>(l[c.timestamp]={trix:r[f],signal:a[f]},l),{})}};function aL(s,e){const t=s.map(l=>l.close),n=Ny(t,e),o=Ny(n,e),r=Ny(o,e),a=[];for(let l=0;l<r.length;l++)if(l===0||r[l]===null||r[l-1]===null||r[l-1]===0)a.push(null);else{const c=(r[l]-r[l-1])/r[l-1]*1e4;a.push(c)}return a}function Ny(s,e){const t=[],n=2/(e+1);let o=null;for(let r=0;r<s.length;r++){if(s[r]===null){t.push(null);continue}if(o===null){if(r>=e-1){let a=0,l=0;for(let c=r-e+1;c<=r;c++)s[c]!==null&&(a+=s[c],l++);o=l>0?a/l:null}}else o=s[r]*n+o*(1-n);t.push(o)}return t}const lL={name:"VOL",shortName:"VOL",precision:10,calcParams:[20],shouldOhlc:!1,shouldFormatBigNumber:!0,visible:!0,zLevel:-1,extendData:void 0,figures:[],styles:{bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{var r,a;const n=e.calcParams[0]||20,o={};for(let l=0;l<s.length;l++){const c=s[l],f=c.volume||0;let u=0;if(l===0)u=f;else{const d=2/(n+1),h=(r=s[l-1])==null?void 0:r.timestamp,p=(h!=null?(a=o[h])==null?void 0:a.ema:void 0)??f;u=f*d+p*(1-d)}o[c.timestamp]={volume:f,ema:u}}return o},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o})=>{var P,T,j,E,L,D,X,ne,de,ie,te,le,pe,re,xe,se,Ne,Te,Me,De,Oe,Ke,kt,pt,Rt,Ht,Ft,zt,ut,nt;if(!t.result||Object.keys(t.result).length===0)return!1;const r=e.getVisibleRange();if(!r)return!1;const{from:a,to:l}=r,c=e.getDataList();if(!c||c.length===0)return!1;const f=((j=(T=(P=t.styles)==null?void 0:P.bars)==null?void 0:T[0])==null?void 0:j.upColor)||"#26a69a",u=((D=(L=(E=t.styles)==null?void 0:E.bars)==null?void 0:L[0])==null?void 0:D.downColor)||"#ef5350",d=((de=(ne=(X=t.styles)==null?void 0:X.bars)==null?void 0:ne[0])==null?void 0:de.noChangeColor)||"#26a69a",h=((le=(te=(ie=t.styles)==null?void 0:ie.lines)==null?void 0:te[0])==null?void 0:le.color)||"#8B5CF6";s.save();let p=0;for(let Je=a;Je<=l&&Je<c.length;Je++){const it=(pe=c[Je])==null?void 0:pe.timestamp,ze=it!=null?t.result[it]:void 0;ze&&(ze.volume!=null&&ze.volume>p&&(p=ze.volume),ze.ema!=null&&ze.ema>p&&(p=Math.max(p,ze.ema)))}if(p<=0)return s.restore(),!0;const x=Math.max(10,Math.floor(n.height*.22)),S=n.top+n.height-1,I=Math.max(1,Math.floor(x*.56));for(let Je=a;Je<=l&&Je<c.length;Je++){const it=(re=c[Je])==null?void 0:re.timestamp,ze=it!=null?t.result[it]:void 0;if(!ze||ze.volume==null)continue;const Ge=c[Je],xt=Je>0&&Je-1<c.length?c[Je-1]:null;let jt=d;xt&&Ge&&typeof Ge.close=="number"&&typeof xt.close=="number"&&(Ge.close>xt.close?jt=f:Ge.close<xt.close&&(jt=u));const ft=o.convertToPixel(Je),ke=Math.min(1,ze.volume/p),Se=Math.max(1,Math.floor(ke*I)),Et=S-Se,wt=Math.max(1,(o.convertToPixel(1)-o.convertToPixel(0))*.8),Ls=(Ne=(se=(xe=t==null?void 0:t.styles)==null?void 0:xe.bars)==null?void 0:se[0])==null?void 0:Ne.opacity;let tn=typeof Ls=="number"?Ls:void 0;if(tn==null){const Gs=(jt||"").toString().match(/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+(?:\s*,\s*([0-9]*\.?[0-9]+))?\s*\)$/i);if(Gs){const an=Gs[1]!=null?parseFloat(Gs[1]):1;tn=isNaN(an)?.7:an}else tn=.7}s.globalAlpha=Math.max(0,Math.min(1,tn)),s.fillStyle=jt,s.fillRect(ft-wt/2,Et,wt,Se)}if(s.globalAlpha=1,((De=(Me=(Te=t==null?void 0:t.styles)==null?void 0:Te.lines)==null?void 0:Me[0])==null?void 0:De.visible)===!0){const Je=((kt=(Ke=(Oe=t.styles)==null?void 0:Oe.lines)==null?void 0:Ke[0])==null?void 0:kt.style)||mt.Solid,it=((Ht=(Rt=(pt=t.styles)==null?void 0:pt.lines)==null?void 0:Rt[0])==null?void 0:Ht.size)||1,ze=((ut=(zt=(Ft=t.styles)==null?void 0:Ft.lines)==null?void 0:zt[0])==null?void 0:ut.dashedValue)||[2,2];s.lineWidth=it,s.strokeStyle=h,Je===mt.Dashed?s.setLineDash(ze):s.setLineDash([]);const Ge=[];for(let xt=a;xt<=l&&xt<c.length;xt++){const jt=(nt=c[xt])==null?void 0:nt.timestamp,ft=jt!=null?t.result[jt]:void 0;if(!ft||ft.ema==null)continue;const ke=o.convertToPixel(xt),Se=Math.min(1,ft.ema/p),Et=S-Math.floor(Se*I);Ge.push({x:ke,y:Et})}if(Ge.length>1){s.save(),s.beginPath(),s.moveTo(Ge[0].x,S);for(const xt of Ge)s.lineTo(xt.x,xt.y);s.lineTo(Ge[Ge.length-1].x,S),s.closePath(),s.globalAlpha=.25,s.fillStyle=h,s.fill(),s.globalAlpha=1,s.restore(),s.beginPath(),s.moveTo(Ge[0].x,Ge[0].y);for(let xt=1;xt<Ge.length;xt++)s.lineTo(Ge[xt].x,Ge[xt].y);s.stroke()}}return s.restore(),!0}},cL={name:"SMA",shortName:"SMA",precision:2,calcParams:[20],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,figures:[{key:"sma",title:"SMA: ",type:"line"}],styles:{lines:[{color:"#FF6C37",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams[0]||20,n={};for(let o=0;o<s.length;o++){const r=s[o].timestamp;if(o<t-1){n[r]={};continue}let a=0;for(let c=o-t+1;c<=o;c++)a+=s[c].close;const l=a/t;n[r]={sma:l}}return n},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var h,p,v,x,S,C,I,A,P,T;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;s.save();const u={color:((v=(p=(h=t.styles)==null?void 0:h.lines)==null?void 0:p[0])==null?void 0:v.color)??"#FF6C37",size:((C=(S=(x=t.styles)==null?void 0:x.lines)==null?void 0:S[0])==null?void 0:C.size)??2,style:((P=(A=(I=t.styles)==null?void 0:I.lines)==null?void 0:A[0])==null?void 0:P.style)??mt.Solid};s.beginPath();let d=!0;for(let j=c;j<=f;j++){const E=(T=a[j])==null?void 0:T.timestamp,L=t.result[E];if(!L||typeof L.sma!="number")continue;const D=o.convertToPixel(j),X=r.convertToPixel(L.sma);d?(s.moveTo(D,X),d=!1):s.lineTo(D,X)}return s.strokeStyle=u.color,s.lineWidth=u.size,u.style===mt.Dashed?s.setLineDash([8,4]):s.setLineDash([]),s.stroke(),s.restore(),!0}},um=new Map,p1=s=>({id:s,kPeriod:14,dPeriod:3,dutyColor:"#1E90FF",dutyThickness:2,dutyStyle:"solid",dLineColor:"#FF1493",dLineThickness:2,dLineStyle:"dashed",showLevels:!0,showZones:!0,overboughtLevel:80,oversoldLevel:20,midlineLevel:50,showOverbought:!0,showOversold:!0,showMidline:!1,levels:[{id:"overbought",value:80,color:"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:20,color:"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:50,color:"#6B7280",lineStyle:"dotted",thickness:1,label:"Midline",visible:!1}],zones:[{id:"overbought_zone",topLevel:100,bottomLevel:80,fillColor:"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold_zone",topLevel:20,bottomLevel:0,fillColor:"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}]}),uL=(s,e,t)=>{const n=[],o=[];if(s.length<e)return{k:s.map(()=>NaN),d:s.map(()=>NaN)};for(let r=0;r<s.length;r++){if(r<e-1){n.push(NaN);continue}let a=s[r-e+1].high,l=s[r-e+1].low;for(let u=r-e+2;u<=r;u++)s[u].high>a&&(a=s[u].high),s[u].low<l&&(l=s[u].low);const c=s[r].close,f=a-l;if(f===0)n.push(50);else{const u=100*((c-l)/f);n.push(u)}}for(let r=0;r<n.length;r++){if(r<e-1+t-1){o.push(NaN);continue}let a=0,l=0;for(let c=r-t+1;c<=r;c++)isNaN(n[c])||(a+=n[c],l++);l===0?o.push(NaN):o.push(a/l)}return{k:n,d:o}},dL={name:"STOCH",shortName:"Stoch",precision:2,calcParams:[14,3],shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,extendData:void 0,minValue:0,maxValue:100,figures:[{key:"k",title:"%K: ",type:"line"},{key:"d",title:"%D: ",type:"line"}],styles:{lines:[{color:"#1E90FF",size:2,style:mt.Solid,smooth:!1,dashedValue:[0,0]},{color:"#FF1493",size:2,style:mt.Dashed,smooth:!1,dashedValue:[4,4]}]},calc:(s,e)=>{const t=e.calcParams[0]||14,n=e.calcParams[1]||3,{k:o,d:r}=uL(s,t,n);return s.reduce((a,l,c)=>{const f=o[c],u=r[c];return a[l.timestamp]={k:isNaN(f)?null:f,d:isNaN(u)?null:u},a},{})},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{const a=t.paneId||"default";let l=um.get(a);l||(l=p1(a),um.set(a,l));const{left:c,top:f,width:u,height:d}=n;return e.getVisibleRange(),s.save(),l.showZones&&l.zones.forEach(h=>{if(!h.visible)return;const p=r.convertToPixel(h.topLevel),v=r.convertToPixel(h.bottomLevel);if(p!==null&&v!==null&&isFinite(p)&&isFinite(v)&&isFinite(c)&&isFinite(u)){s.save();const x=Math.abs(p-v),S=Math.min(p,v);if(!isFinite(x)||!isFinite(S)||x===0){s.restore();return}const C=s.createLinearGradient(c,S,c,S+x),A=h.fillColor.match(/\w\w/g);if(A){const P=parseInt(A[0],16),T=parseInt(A[1],16),j=parseInt(A[2],16);C.addColorStop(0,`rgba(${P}, ${T}, ${j}, ${h.fillOpacity*.8})`),C.addColorStop(.3,`rgba(${P}, ${T}, ${j}, ${h.fillOpacity*.6})`),C.addColorStop(.7,`rgba(${P}, ${T}, ${j}, ${h.fillOpacity*.3})`),C.addColorStop(1,`rgba(${P}, ${T}, ${j}, ${h.fillOpacity*.1})`)}else C.addColorStop(0,h.fillColor+Math.floor(h.fillOpacity*255).toString(16).padStart(2,"0")),C.addColorStop(.5,h.fillColor+Math.floor(h.fillOpacity*128).toString(16).padStart(2,"0")),C.addColorStop(1,h.fillColor+Math.floor(h.fillOpacity*32).toString(16).padStart(2,"0"));s.fillStyle=C,s.fillRect(c,S,u,x),s.strokeStyle=h.fillColor+"40",s.lineWidth=.5,s.strokeRect(c,S,u,x),s.restore()}}),l.showLevels&&l.levels.forEach(h=>{if(!h.visible)return;const p=r.convertToPixel(h.value);p!==null&&isFinite(p)&&p>=f&&p<=f+d&&isFinite(c)&&isFinite(u)&&(s.save(),s.strokeStyle=h.color,s.lineWidth=h.thickness,h.lineStyle==="dashed"?s.setLineDash([4,4]):h.lineStyle==="dotted"?s.setLineDash([2,6]):s.setLineDash([]),s.beginPath(),s.moveTo(c,p),s.lineTo(c+u,p),s.stroke(),s.fillStyle=h.color,s.font="10px Arial",s.textAlign="left",s.fillText(`${h.value}`,c+5,p-3),s.restore())}),s.restore(),!1}},sy={createInstance:(s,e)=>{const t={...p1(s),...e};return um.set(s,t),t},getInstance:s=>um.get(s),updateInstance:(s,e)=>{const t=um.get(s);return t?(Object.assign(t,e),!0):!1},deleteInstance:s=>um.delete(s),addLevel:(s,e)=>{const t=um.get(s);if(t){const n=`level_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:n,...e};return t.levels.push(o),n}throw new Error(`Stochastic instance ${s} not found`)},removeLevel:(s,e)=>{const t=um.get(s);if(t){const n=t.levels.findIndex(o=>o.id===e);if(n!==-1)return t.levels.splice(n,1),!0}return!1},updateLevel:(s,e,t)=>{const n=um.get(s);if(n){const o=n.levels.find(r=>r.id===e);if(o)return Object.assign(o,t),e==="overbought"?n.overboughtLevel=o.value:e==="oversold"?n.oversoldLevel=o.value:e==="midline"&&(n.midlineLevel=o.value),!0}return!1},addZone:(s,e)=>{const t=um.get(s);if(t){const n=`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:n,...e};return t.zones.push(o),n}throw new Error(`Stochastic instance ${s} not found`)},removeZone:(s,e)=>{const t=um.get(s);if(t){const n=t.zones.findIndex(o=>o.id===e);if(n!==-1)return t.zones.splice(n,1),!0}return!1},updateZone:(s,e,t)=>{const n=um.get(s);if(n){const o=n.zones.find(r=>r.id===e);if(o)return Object.assign(o,t),!0}return!1},getInstanceConfig:s=>um.get(s)||null,resetInstance:s=>{const e=p1(s);um.set(s,e)},exportInstanceConfig:s=>{const e=um.get(s);return e?{id:e.id,kPeriod:e.kPeriod,dPeriod:e.dPeriod,dutyColor:e.dutyColor,dutyThickness:e.dutyThickness,dutyStyle:e.dutyStyle,dLineColor:e.dLineColor,dLineThickness:e.dLineThickness,dLineStyle:e.dLineStyle,showLevels:e.showLevels,showZones:e.showZones,overboughtLevel:e.overboughtLevel,oversoldLevel:e.oversoldLevel,midlineLevel:e.midlineLevel,showOverbought:e.showOverbought,showOversold:e.showOversold,showMidline:e.showMidline,levels:e.levels.map(t=>({...t})),zones:e.zones.map(t=>({...t}))}:null},importInstanceConfig:s=>{try{const e={id:s.id,kPeriod:s.kPeriod||14,dPeriod:s.dPeriod||3,dutyColor:s.dutyColor||"#1E90FF",dutyThickness:s.dutyThickness||2,dutyStyle:s.dutyStyle||"solid",dLineColor:s.dLineColor||"#FF1493",dLineThickness:s.dLineThickness||2,dLineStyle:s.dLineStyle||"dashed",showLevels:s.showLevels!==!1,showZones:s.showZones!==!1,overboughtLevel:s.overboughtLevel||80,oversoldLevel:s.oversoldLevel||20,midlineLevel:s.midlineLevel||50,showOverbought:s.showOverbought!==!1,showOversold:s.showOversold!==!1,showMidline:s.showMidline||!1,levels:s.levels||p1(s.id).levels,zones:s.zones||p1(s.id).zones};return um.set(s.id,e),!0}catch(e){return console.error("Failed to import Stochastic instance config:",e),!1}},getAllInstances:()=>new Map(um),clearAllInstances:()=>{um.clear()}},fL={name:"SMARTTREND",shortName:"Smart Trend",precision:2,calcParams:[10,3],shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,extendData:{showLabels:!0},figures:[{key:"superTrend",title:"Smart Trend: ",type:"line"}],styles:{lines:[{color:"#00FF00",size:2,style:mt.Solid,smooth:!1,dashedValue:[0,0]}]},calc:(s,e)=>{var v;const t=e.calcParams[0]||10,n=e.calcParams[1]||3,o={},r=(x,S)=>{if(!S)return x.high-x.low;const C=x.high-x.low,I=Math.abs(x.high-S.close),A=Math.abs(x.low-S.close);return Math.max(C,I,A)},a=x=>{if(x<t-1)return 0;let S=0;for(let C=x-t+1;C<=x;C++){const I=s[C],A=C>0?s[C-1]:void 0;S+=r(I,A)}return S/t};let l=1,c=0,f=0,u=-1,d,h=-1,p;for(let x=0;x<s.length;x++){const S=s[x].timestamp;if(x<t-1){o[S]={};continue}const C=s[x],I=x>0?s[x-1]:C,A=a(x),P=(C.high+C.low)/2,T=P+n*A,j=P-n*A;if(x===t-1)c=T,f=j;else{o[x-1];const re=I.close;(T<c||re>c)&&(c=T),(j>f||re<f)&&(f=j)}let E=l,L=0,D,X,ne,de,ie,te,le,pe;if(x>t-1){const re=s[x-1].timestamp;if((v=o[re])!=null&&v.superTrend,l===1&&C.close<=f?E=-1:l===-1&&C.close>=c&&(E=1),E!==l){if(E===1){if(D=f,ne=C.close,u=x,d=C.close,p!==void 0&&h>=0){te=C.close,pe=p-te;const xe=s[h].timestamp,se=o[xe];se.sellExit=te,se.sellProfit=pe,p=void 0,h=-1}}else if(X=c,de=C.close,h=x,p=C.close,d!==void 0&&u>=0){ie=C.close,le=ie-d;const xe=s[u].timestamp,se=o[xe];se.buyExit=ie,se.buyProfit=le,d=void 0,u=-1}}}E===1?L=f:L=c,o[S]={superTrend:L,trend:E,buySignal:D,sellSignal:X,buyEntry:ne,sellEntry:de,buyExit:ie,sellExit:te,buyProfit:le,sellProfit:pe},l=E}return o},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var L,D,X,ne,de,ie,te;const a=e.getDataList();if(!t.result||a.length===0)return!1;const l=e.getVisibleRange(),{from:c,to:f}=l;s.save();const u=(le,pe,re,xe,se,Ne)=>{const Te=Math.min(Ne,xe/2,se/2);le.beginPath(),le.moveTo(pe+Te,re),le.arcTo(pe+xe,re,pe+xe,re+se,Te),le.arcTo(pe+xe,re+se,pe,re+se,Te),le.arcTo(pe,re+se,pe,re,Te),le.arcTo(pe,re,pe+xe,re,Te),le.closePath()},d=(le,pe)=>{if(!le)return`rgba(0,0,0,${pe})`;if(le.startsWith("rgb"))return le.startsWith("rgba")?le.replace(/rgba\(([^)]+)\)/,(Te,Me)=>{const De=Me.split(",").map(Oe=>Oe.trim());return`rgba(${De[0]}, ${De[1]}, ${De[2]}, ${pe})`}):le.replace(/rgb\(([^)]+)\)/,(Te,Me)=>`rgba(${Me}, ${pe})`);const re=le.replace("#",""),xe=parseInt(re.substring(0,2),16),se=parseInt(re.substring(2,4),16),Ne=parseInt(re.substring(4,6),16);return`rgba(${xe}, ${se}, ${Ne}, ${pe})`},h=(le,pe,re,xe)=>{const se="bold 10px Arial";s.font=se;const Ne=s.measureText(re),Te=Ne.actualBoundingBoxAscent&&Ne.actualBoundingBoxDescent?Ne.actualBoundingBoxAscent+Ne.actualBoundingBoxDescent:10,Me=6,De=4,Oe=Math.ceil(Ne.width)+Me*2,Ke=Math.ceil(Te)+De*2,kt=Math.round(le-Oe/2),pt=Math.round(pe-Ke/2),Rt=typeof performance<"u"?performance.now():Date.now(),Ht=.35+.25*Math.sin(Rt/450);s.save(),s.shadowColor=d(xe,Math.max(0,Ht)),s.shadowBlur=12,s.fillStyle=d(xe,.14),u(s,kt,pt,Oe,Ke,6),s.fill(),s.restore(),s.lineWidth=1,s.strokeStyle=d(xe,.9),u(s,kt,pt,Oe,Ke,6),s.stroke(),s.fillStyle=d(xe,.95),s.textAlign="center",s.textBaseline="middle",s.font=se,s.fillText(re,le,pe+.5)},p=t.extendData,v=(p==null?void 0:p.showLabels)!==!1,x=(p==null?void 0:p.uptrendColor)||"#00FF00",S=(p==null?void 0:p.downtrendColor)||"#FF0000",C=(p==null?void 0:p.uptrendThickness)??2,I=(p==null?void 0:p.downtrendThickness)??2,A=(p==null?void 0:p.uptrendLineStyle)||"solid",P=(p==null?void 0:p.downtrendLineStyle)||"solid";let T=[],j=c,E=((D=t.result[(L=a[c])==null?void 0:L.timestamp])==null?void 0:D.trend)||1;for(let le=c+1;le<=f;le++){const pe=(X=a[le])==null?void 0:X.timestamp,re=t.result[pe],xe=(re==null?void 0:re.trend)??E,se=le===f;if(xe!==E||se){const Ne=se&&xe===E?le:le-1;T.push({start:j,end:Ne,trend:E}),j=le,E=xe}}if(T.forEach(le=>{var Te,Me;const pe=le.trend===1,re=pe?x:S,xe=pe?C:I,se=pe?A:P;s.strokeStyle=re,s.lineWidth=Number(xe)||2,s.lineCap="round",s.lineJoin="round",se==="dashed"?s.setLineDash([4,4]):se==="dotted"?s.setLineDash([2,6]):s.setLineDash([]),s.beginPath();let Ne=!0;for(let De=le.start;De<=le.end;De++){const Oe=(Te=a[De])==null?void 0:Te.timestamp,Ke=t.result[Oe];if(Ke&&typeof Ke.superTrend=="number"){const kt=o.convertToPixel(De),pt=r.convertToPixel(Ke.superTrend);Ne?(s.moveTo(kt,pt),Ne=!1):s.lineTo(kt,pt)}}if(s.stroke(),v){const De=(Me=a[le.end])==null?void 0:Me.timestamp,Oe=t.result[De];if(Oe&&typeof Oe.superTrend=="number"){const kt=le===T[T.length-1]?"HOLD":"EXIT",pt=o.convertToPixel(le.end),Rt=r.convertToPixel(Oe.superTrend);h(pt,Rt+(pe?22:-22),kt,re)}}}),v){let le=0;try{const re=(ne=e==null?void 0:e.getDataList)==null?void 0:ne.call(e);if(re&&re.length>0)le=((de=re[re.length-1])==null?void 0:de.close)??0;else{const xe=(ie=a[f])==null?void 0:ie.timestamp,se=t.result[xe];le=(se==null?void 0:se.superTrend)??0}}catch{}const pe=(t==null?void 0:t.precision)??2;for(let re=c;re<=f;re++){const xe=(te=a[re])==null?void 0:te.timestamp,se=t.result[xe];if(!se)continue;const Ne=o.convertToPixel(re);if(se.buySignal!==void 0){const Te=r.convertToPixel(se.buySignal);s.fillStyle="#00FF00",s.beginPath(),s.arc(Ne,Te-10,4,0,2*Math.PI),s.fill();const Me=se.buyEntry??se.buySignal,De=se.buyExit!==void 0?se.buyExit-Me:le?le-Me:0,Oe=`${De>=0?"+":""}${Number(De).toFixed(pe)}`;h(Ne,Te+22,`BUY ${Oe}`,"#10B981")}if(se.sellSignal!==void 0){const Te=r.convertToPixel(se.sellSignal);s.fillStyle="#FF0000",s.beginPath(),s.arc(Ne,Te+10,4,0,2*Math.PI),s.fill();const Me=se.sellEntry??se.sellSignal,De=se.sellExit!==void 0?Me-se.sellExit:le?Me-le:0,Oe=`${De>=0?"+":""}${Number(De).toFixed(pe)}`;h(Ne,Te-22,`SELL ${Oe}`,"#EF4444")}}}return s.restore(),!0}},pL={name:"MACD",shortName:"MACD",calcParams:[12,26,9],shouldOhlc:!1,shouldFormatBigNumber:!1,precision:4,minValue:-1e-9,maxValue:1e-9,styles:{lines:[{color:"#2563eb",size:1,style:mt.Solid,dashedValue:[2,2]},{color:"#dc2626",size:1,style:mt.Solid,dashedValue:[2,2]}],bars:[{upColor:"#2563eb",downColor:"#ef4444",noChangeColor:"#2563eb",reverseColor:"#c4c4c4"}]},figures:[{key:"macd",title:"MACD: ",type:"line",baseValue:0},{key:"signal",title:"Signal: ",type:"line",baseValue:0},{key:"hist",title:"Hist: ",type:"bar",baseValue:0}],calc:(s,e)=>{var h,p,v;const t=((h=e.calcParams)==null?void 0:h[0])||12,n=((p=e.calcParams)==null?void 0:p[1])||26,o=((v=e.calcParams)==null?void 0:v[2])||9,r=(x,S)=>{const C=2/(x+1),I=[];let A;for(let P=0;P<S.length;P++){const T=S[P];A===void 0?A=T:A=T*C+A*(1-C),I.push(A)}return I},a=s.map(x=>x.close),l=r(t,a),c=r(n,a),f=a.map((x,S)=>(l[S]??NaN)-(c[S]??NaN)),u=r(o,f.map(x=>Number.isFinite(x)?x:0)),d={};for(let x=0;x<s.length;x++){const S=s[x].timestamp;if(!Number.isFinite(f[x])||!Number.isFinite(u[x])){d[S]={};continue}const C=f[x],I=u[x],A=C-I;d[S]={macd:C,signal:I,hist:A}}return d},draw:({ctx:s,chart:e,indicator:t,xAxis:n,yAxis:o})=>{var x,S,C,I,A,P,T,j,E,L;const r=e.getDataList();if(!t.result||r.length===0)return!1;const a=t.styles||{},l=((S=(x=a==null?void 0:a.bars)==null?void 0:x[0])==null?void 0:S.upColor)||"#2563eb",c=((I=(C=a==null?void 0:a.bars)==null?void 0:C[0])==null?void 0:I.downColor)||"#ef4444",f=((P=(A=a==null?void 0:a.bars)==null?void 0:A[0])==null?void 0:P.reverseColor)||((j=(T=a==null?void 0:a.bars)==null?void 0:T[0])==null?void 0:j.noChangeColor)||"#c4c4c4",u=(a==null?void 0:a.lines)||[],d=e.getVisibleRange(),h=Math.max(d.from,0),p=Math.min(d.to,r.length-1);s.save();for(let D=h;D<=p;D++){const X=(E=r[D])==null?void 0:E.timestamp,ne=t.result[X];if(!ne||typeof ne.hist!="number")continue;const de=n.convertToPixel(D),ie=o.convertToPixel(0),te=o.convertToPixel(ne.hist),le=n.convertToPixel(1)-n.convertToPixel(0),pe=Math.max(1,Math.floor(le*.8)),re=Math.min(ie,te),xe=Math.abs(ie-te);let se=f;const Ne=(L=r[D-1])==null?void 0:L.timestamp,Te=Ne!=null?t.result[Ne]:void 0,Me=Te&&typeof Te.hist=="number"?Te.hist:null;ne.hist>=0?Me===null||ne.hist>=Me?se=l:se=f:Me===null||ne.hist<=Me?se=c:se=f,s.fillStyle=se;const De=Math.round(de-pe/2),Oe=Math.round(re),Ke=Math.max(1,Math.round(xe));s.fillRect(De,Oe,pe,Ke)}s.restore();const v=(D,X)=>{var te;s.save(),s.beginPath(),s.lineWidth=(X==null?void 0:X.size)??1,(X==null?void 0:X.style)===mt.Dashed?s.setLineDash((X==null?void 0:X.dashedValue)??[4,4]):s.setLineDash([]),s.strokeStyle=(X==null?void 0:X.color)||"#ffffff";const de=s.lineWidth%2?.5:0;s.lineCap="butt",s.lineJoin="miter";let ie=!0;for(let le=h;le<=p;le++){const pe=(te=r[le])==null?void 0:te.timestamp,re=t.result[pe];if(!re||typeof re[D]!="number")continue;const xe=Math.round(n.convertToPixel(le))+de,se=Math.round(o.convertToPixel(re[D]))+de;ie?(s.moveTo(xe,se),ie=!1):s.lineTo(xe,se)}s.stroke(),s.restore()};return v("macd",u[0]),v("signal",u[1]),!0}};function Cg(s,e,t){return Math.max(e,Math.min(t,s))}function hL(s,e){const t=new Array(s.length).fill(0);if(e<=1){for(let o=0;o<s.length;o++)t[o]=s[o]??0;return t}let n=0;for(let o=0;o<s.length;o++)n+=s[o]??0,o>=e&&(n-=s[o-e]??0),t[o]=o>=e-1?n/e:0;return t}function mL(s,e,t){const n=Math.max(0,e-t);let o=-1/0;for(let r=n;r<e;r++)s[r]&&s[r].high>o&&(o=s[r].high);return o===-1/0?0:o}function vL(s,e,t){const n=Math.max(0,e-t);let o=1/0;for(let r=n;r<e;r++)s[r]&&s[r].low<o&&(o=s[r].low);return o===1/0?0:o}function ny(s){const e=Math.max(0,(s.high??0)-(s.low??0)),t=Math.abs((s.close??0)-(s.open??0)),n=Math.max(0,(s.high??0)-Math.max(s.open??0,s.close??0)),o=Math.max(0,Math.min(s.open??0,s.close??0)-(s.low??0)),r=e>0?n/e:0,a=e>0?o/e:0;return{range:e,body:t,upperWick:n,lowerWick:o,upperWickRatio:r,lowerWickRatio:a}}const gL={name:"TRAP_HUNTER",shortName:"TRAP",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(s,e)=>{var T,j;const t=e.calcParams||[],n=t[0]??20,o=t[1]??20,r=Math.max(1,t[2]??3),a=Math.max(1,t[3]??5),l=Math.max(1,t[4]??20),c=t[5]??1.3,f=t[6]??7e-4,u=t[7]??.35,d=t[8]??.5,h=(t[9]??1)>0?1:0,p=Math.max(1,t[10]??5),v=s.map(E=>(E==null?void 0:E.volume)??0),x=hL(v,l),S=new Array(s.length).fill(null).map(()=>({}));let C=-1e3,I=-1e3,A=-1e3,P=-1e3;for(let E=0;E<s.length;E++){const L=s[E];if(!L||E===0)continue;const D=mL(s,E,n),X=vL(s,E,o);if(D===0||X===0)continue;const ne=x[E]||0,de=ne>0?(L.volume??0)/ne:0,{range:ie,upperWickRatio:te,lowerWickRatio:le}=ny(L),pe=ie>0?(L.high-L.close)/ie<.4:!1,re=ie>0?(L.close-L.low)/ie<.4:!1,xe=(L.high??0)>=D*(1+f),se=(L.close??0)>(L.open??0)||pe,Ne=de>=c;if(xe&&se&&Ne){let kt=-1;(L.close??0)<D&&(kt=E);const pt=Math.min(s.length-1,E+r);if(kt===-1){for(let Rt=E+1;Rt<=pt;Rt++)if((((T=s[Rt])==null?void 0:T.close)??0)<D){kt=Rt;break}}if(kt!==-1){const Rt=Math.min(kt,E+a);let Ht=te,Ft=!1;for(let Ge=E;Ge<=Rt;Ge++){const xt=ny(s[Ge]);xt.upperWickRatio>Ht&&(Ht=xt.upperWickRatio),(s[Ge].close??0)<(s[Ge].open??0)&&(xt.range>0&&xt.body/xt.range>=.45)&&(Ft=!0)}const zt=Cg((L.high-D)/Math.max(1e-8,D)/(f*3),0,1),ut=Cg(de/(c*2),0,1),nt=Cg(Ht,0,1),Je=Cg((L.high-(s[kt].close??0))/Math.max(1e-8,L.high),0,1),it=Cg(.3*zt+.3*ut+.2*nt+.2*Je,0,1);(Ht>=u||Ft)&&it>=d&&kt-C>=2&&(C=kt,A=kt,S[kt]={...S[kt],bullTrap:!0,type:"bull",score:it,breakoutLevel:D,reversalClose:s[kt].close,time:s[kt].timestamp})}}const Te=f*.85,Me=c*.9,De=(L.low??0)<=X*(1-Te),Oe=(L.close??0)<(L.open??0)||re||le>=u,Ke=de>=Me;if(De&&Oe&&Ke){const kt=Math.min(s.length-1,E+r);let pt=-1;if((L.close??0)>X&&(pt=E),pt===-1){for(let Rt=E+1;Rt<=kt;Rt++)if((((j=s[Rt])==null?void 0:j.close)??0)>X){pt=Rt;break}}if(pt!==-1){const Rt=Math.min(pt,E+a);let Ht=le,Ft=!1;for(let Ge=E;Ge<=Rt;Ge++){const xt=ny(s[Ge]);xt.lowerWickRatio>Ht&&(Ht=xt.lowerWickRatio),(s[Ge].close??0)>(s[Ge].open??0)&&(xt.range>0&&xt.body/xt.range>=.45)&&(Ft=!0)}const zt=Cg((X-L.low)/Math.max(1e-8,X)/(Te*3),0,1),ut=Cg(de/(Me*2),0,1),nt=Cg(Ht,0,1),Je=Cg(((s[pt].close??0)-L.low)/Math.max(1e-8,s[pt].close??0),0,1),it=Cg(.3*zt+.3*ut+.2*nt+.2*Je,0,1);(Ht>=u||Ft)&&it>=d&&pt-I>=2&&(I=pt,A=pt,S[pt]={...S[pt],bearTrap:!0,type:"bear",score:it,breakoutLevel:X,reversalClose:s[pt].close,time:s[pt].timestamp})}}if(h){const kt=x[E]>0?(L.volume??0)/x[E]:0,{upperWickRatio:pt,lowerWickRatio:Rt}=ny(L),Ht=Math.max(.1,u*.8),Ft=Math.max(1,c*.85),zt=(L.close??0)<=D*(1+f*.5)&&(L.close??0)>=X*(1-f*.5),ut=kt<=Ft&&pt<=Ht&&Rt<=Ht&&zt,nt=E-A,Je=E-P,it=Math.max(8,p);ut&&nt>=p&&Je>=it&&(P=E,S[E]={...S[E],normal:!0,time:s[E].timestamp})}}return S},draw:({ctx:s,chart:e,indicator:t,xAxis:n,yAxis:o})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(r.length-1,l.to);function u(p,v,x,S){s.save(),s.fillStyle=x,s.strokeStyle=x,s.lineWidth=1,S==="normal"?(s.beginPath(),s.arc(p,v,3.5,0,2*Math.PI),s.fill()):(s.beginPath(),S==="bull"?(s.moveTo(p,v-6),s.lineTo(p-5,v+4),s.lineTo(p+5,v+4)):(s.moveTo(p,v+6),s.lineTo(p-5,v-4),s.lineTo(p+5,v-4)),s.closePath(),s.fill()),s.restore()}function d(p,v,x,S){s.save(),s.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",s.textAlign="center",s.textBaseline="middle",s.fillStyle=S,s.strokeStyle="rgba(0,0,0,0.2)";const C=6,I=s.measureText(x),A=Math.ceil(I.width)+C*2,P=16,T=4,j=p-A/2,E=v-P/2;s.beginPath(),s.moveTo(j+T,E),s.lineTo(j+A-T,E),s.quadraticCurveTo(j+A,E,j+A,E+T),s.lineTo(j+A,E+P-T),s.quadraticCurveTo(j+A,E+P,j+A-T,E+P),s.lineTo(j+T,E+P),s.quadraticCurveTo(j,E+P,j,E+P-T),s.lineTo(j,E+T),s.quadraticCurveTo(j,E,j+T,E),s.closePath(),s.fillStyle="rgba(0,0,0,0.6)",s.fill(),s.fillStyle=S,s.fillText(x,p,v+.5),s.restore()}function h(p,v,x){s.save(),s.strokeStyle=x,s.lineWidth=1,s.setLineDash([4,3]),s.beginPath(),s.moveTo(p-10,v),s.lineTo(p+10,v),s.stroke(),s.setLineDash([]),s.restore()}for(let p=c;p<=f;p++){const v=r[p];if(!v||!v.bullTrap&&!v.bearTrap&&!v.normal)continue;const x=n.convertToPixel(p),S=a[p];if(S){if(v.bullTrap){const C=o.convertToPixel(S.high)-12;u(x,C,"#EF4444","bull");const A=C-16,P=`Bull Trap ${((v.score??0)*100).toFixed(0)}%`;if(d(x,A,P,"#F59E0B"),v.breakoutLevel){const T=o.convertToPixel(v.breakoutLevel);h(x,T,"#F59E0B")}}if(v.bearTrap){const C=o.convertToPixel(S.low)+12;u(x,C,"#10B981","bear");const A=C+16,P=`Bear Trap ${((v.score??0)*100).toFixed(0)}%`;if(d(x,A,P,"#34D399"),v.breakoutLevel){const T=o.convertToPixel(v.breakoutLevel);h(x,T,"#34D399")}}if(v.normal){const C=(S.high+S.low)/2,I=o.convertToPixel(C);u(x,I,"#3B82F6","normal"),d(x,I-16,"Stable","#60A5FA")}}}return!0},createTooltipDataSource:({dataIndex:s,indicator:e,defaultStyles:t})=>{var c;const n=(c=e.result)==null?void 0:c[s];if(!n||!n.bullTrap&&!n.bearTrap&&!n.normal)return{values:[]};const o=n.normal?"Stable":n.bullTrap?"Bull Trap":"Bear Trap",r=n.score!==void 0?Number(n.score).toFixed(2):"—",a=n.breakoutLevel!==void 0?Number(n.breakoutLevel).toFixed(e.precision??2):"—",l=n.reversalClose!==void 0?Number(n.reversalClose).toFixed(e.precision??2):"—";return{styles:t,values:[{title:"Trap",value:o},...n.normal?[]:[{title:"Score",value:r},{title:"Level",value:a},{title:"Reversal",value:l}]]}}};function e0(s,e,t){return Math.max(e,Math.min(t,s))}function M3(s,e){const t=s.length,n=new Array(t).fill(0);if(e<=1){for(let r=0;r<t;r++)n[r]=s[r]??0;return n}let o=0;for(let r=0;r<t;r++)o+=s[r]??0,r>=e&&(o-=s[r-e]??0),n[r]=r>=e-1?o/e:0;return n}function _L(s,e){var o,r,a;const t=s.length,n=new Array(t).fill(0);for(let l=0;l<t;l++){const c=((o=s[l])==null?void 0:o.high)??0,f=((r=s[l])==null?void 0:r.low)??0;if(l===0)n[l]=Math.max(0,c-f);else{const u=((a=s[l-1])==null?void 0:a.close)??0;n[l]=Math.max(c-f,Math.abs(c-u),Math.abs(f-u))}}return M3(n,Math.max(1,e))}function yL(s){var o,r,a;const e=s.length,t=new Array(e).fill(0);let n=0;for(let l=0;l<e;l++){if(l===0)n=0;else{const c=((o=s[l])==null?void 0:o.close)??0,f=((r=s[l-1])==null?void 0:r.close)??0,u=((a=s[l])==null?void 0:a.volume)??0;c>f?n+=u:c<f&&(n-=u)}t[l]=n}return t}function Kb(s,e,t){let n=0,o=0;for(let r=e;r<=t;r++)n+=s[r]??0,o++;return o>0?n/o:0}function bL(s,e,t,n){if(t<=e)return 0;const o=(s[t]-s[e])/(t-e),r=n>0?o/(n*5):0;return e0(r,-1,1)}function xL(s,e,t){var l,c;const n=Math.max(0,e-t),o=Math.max(0,e-1),r=((l=s[n])==null?void 0:l.close)??0,a=((c=s[o])==null?void 0:c.close)??0;return r<=0?0:(a-r)/r}function Kw(s,e,t,n,o,r,a){var Me,De,Oe,Ke,kt,pt,Rt,Ht,Ft;const l=[],c=[],f=[];for(let zt=o;zt<=r;zt++)l.push(((Me=s[zt])==null?void 0:Me.high)??0),c.push(((De=s[zt])==null?void 0:De.low)??0),f.push(((Oe=s[zt])==null?void 0:Oe.close)??0);const u=Math.max(...l),d=Math.min(...c),h=(u+d)/2,p=u-d;if(h<=0)return null;const v=p/h;if(!isFinite(v)||v<=0||v>a.maxZoneWidthPct)return null;const x=Kb(n,o,r);if(!(x>=a.minVolumeFactor))return null;const S=[];for(let zt=o;zt<=r;zt++)S.push((((Ke=s[zt])==null?void 0:Ke.high)??0)-(((kt=s[zt])==null?void 0:kt.low)??0));const C=S.length?S.reduce((zt,ut)=>zt+ut,0)/S.length:0,I=Kb(t,o,r);if(I>0&&C/I>1.8)return null;let A=0;for(let zt=o;zt<=r;zt++){const ut=((pt=s[zt])==null?void 0:pt.close)??0;(Rt=s[zt])==null||Rt.open;const nt=p>0?e0((ut-d)/p,0,1):.5;A+=nt}const P=A/Math.max(1,r-o+1)||.5,T=xL(s,o,a.priorTrendLookback),j=T<=-.05,E=T>=.05,L=j?e0(Math.abs(T)/.15,0,1):0,D=E?e0(Math.abs(T)/.15,0,1):0,X=Kb(s.map(zt=>(zt==null?void 0:zt.volume)??0),o,r),ne=bL(e,o,r,X),de=e0((P-.5)/.3+.5,0,1),ie=e0((x-a.minVolumeFactor)/Math.max(1e-6,a.minVolumeFactor),0,1),te=.3,le=.3,pe=.2,re=.2,xe=te*L+le*e0((ne-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+pe*de+re*ie,se=te*D+le*e0((-ne-a.minOBVTrendStrength)/(1-a.minOBVTrendStrength),0,1)+pe*(1-de)+re*ie,Ne=e0(Math.max(xe,se),0,1);if(Ne<a.minZoneScore)return null;const Te=xe>se?"accumulation":"distribution";return{startIndex:o,endIndex:r,startTime:((Ht=s[o])==null?void 0:Ht.timestamp)??0,endTime:((Ft=s[r])==null?void 0:Ft.timestamp)??0,low:d,high:u,type:Te,score:Ne,priorReturn:T,avgVolumeFactor:x,obvTrendScore:ne}}function Xw(s,e){if(!e.mergeNearbyZones||s.length<=1)return s.slice(0,e.maxZonesDisplayed);const t=s.slice().sort((l,c)=>l.startIndex-c.startIndex),n=[],o=Math.max(2,Math.floor(e.minZoneBars/2)),r=Math.max(.01,e.maxZoneWidthPct*1.5);function a(l,c){const f=(l.low+l.high)/2,u=(c.low+c.high)/2;return f<=0||u<=0?!1:Math.abs(f-u)/((f+u)/2)<=r}for(const l of t){if(n.length===0){n.push(l);continue}const c=n[n.length-1];if(l.startIndex<=c.endIndex+o&&l.type===c.type&&a(c,l)){const u=Math.min(c.low,l.low),d=Math.max(c.high,l.high);n[n.length-1]={startIndex:Math.min(c.startIndex,l.startIndex),endIndex:Math.max(c.endIndex,l.endIndex),startTime:Math.min(c.startTime,l.startTime),endTime:Math.max(c.endTime,l.endTime),low:u,high:d,type:c.type,score:Math.max(c.score,l.score),priorReturn:Math.abs(l.score)>=Math.abs(c.score)?l.priorReturn:c.priorReturn,avgVolumeFactor:(c.avgVolumeFactor+l.avgVolumeFactor)/2,obvTrendScore:(c.obvTrendScore+l.obvTrendScore)/2}}else n.push(l)}return n.sort((l,c)=>c.score-l.score).slice(0,e.maxZonesDisplayed).sort((l,c)=>l.startIndex-c.startIndex)}const wL={name:"SMART_MONEY",shortName:"SMF",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{},calc:(s,e)=>{const t=e.calcParams||[],n={zoneLookbackBars:Math.max(10,t[0]??40),minZoneBars:Math.max(3,t[1]??5),maxZoneBars:Math.max(5,t[2]??25),atrPeriod:Math.max(1,t[3]??14),volumeMAPeriod:Math.max(1,t[4]??20),minVolumeFactor:t[5]??1.2,maxZoneWidthPct:t[6]??.03,priorTrendLookback:Math.max(1,t[7]??20),minOBVTrendStrength:t[8]??.2,minZoneScore:t[9]??.6,mergeNearbyZones:(t[10]??1)>0,maxZonesDisplayed:Math.max(1,t[11]??20),showLabels:(t[12]??1)>0},o=s.length,r=new Array(o).fill({});if(o===0)return e.zones=[],e.cfg=n,r;const a=_L(s,n.atrPeriod),l=s.map(p=>(p==null?void 0:p.volume)??0),c=M3(l,n.volumeMAPeriod),f=l.map((p,v)=>{const x=c[v]||0;return x>0?p/x:0}),u=yL(s);let d=[];for(let p=0;p<o;p++){const v=p,x=Math.min(n.zoneLookbackBars,v+1),S=[],C=n.minZoneBars,I=Math.min(n.maxZoneBars,x);if(I>=C){const A=Math.floor((C+I)/2);S.push(C),A!==C&&A!==I&&S.push(A),I!==C&&S.push(I)}for(const A of S){const P=v-A+1;if(P<0)continue;const T=Kw(s,u,a,f,P,v,n);T&&d.push(T)}}let h=Xw(d,n);if(h.length===0&&o>=Math.max(60,n.minZoneBars*4)){const p={...n,maxZoneWidthPct:n.maxZoneWidthPct*2,minVolumeFactor:Math.min(n.minVolumeFactor,.9),minOBVTrendStrength:Math.max(.05,n.minOBVTrendStrength*.5),minZoneScore:Math.max(.4,n.minZoneScore-.15)};d=[];for(let v=0;v<o;v++){const x=v,S=Math.min(p.zoneLookbackBars,x+1),C=[],I=p.minZoneBars,A=Math.min(p.maxZoneBars,S);if(A>=I){const P=Math.floor((I+A)/2);C.push(I),P!==I&&P!==A&&C.push(P),A!==I&&C.push(A)}for(const P of C){const T=x-P+1;if(T<0)continue;const j=Kw(s,u,a,f,T,x,p);j&&d.push(j)}}h=Xw(d,p)}return e.zones=h,e.cfg=n,r},draw:({ctx:s,chart:e,indicator:t,xAxis:n,yAxis:o})=>{const r=t.zones||[];if(!r.length)return!1;const a=t.cfg||{},l=e.getVisibleRange(),c=Math.max(0,l.from),f=l.to,u="rgba(16, 185, 129, 0.28)",d="rgba(16, 185, 129, 0.7)",h="rgba(239, 68, 68, 0.28)",p="rgba(239, 68, 68, 0.7)";s.save();for(const v of r){if(v.endIndex<c||v.startIndex>f)continue;const x=n.convertToPixel(v.startIndex),S=n.convertToPixel(v.endIndex),C=o.convertToPixel(v.high),I=o.convertToPixel(v.low);if(!isFinite(x)||!isFinite(S)||C==null||I==null)continue;const A=Math.min(x,S),P=Math.max(1,Math.abs(S-x)),T=Math.min(C,I),j=Math.abs(C-I);s.fillStyle=v.type==="accumulation"?u:h;const E=s.roundRect??s.rect;s.beginPath();try{E.call(s,A,T,P,j,4)}catch{s.rect(A,T,P,j)}if(s.closePath(),s.fill(),s.strokeStyle=v.type==="accumulation"?d:p,s.lineWidth=1.5,s.setLineDash([]),s.stroke(),a.showLabels){const L=`${v.type==="accumulation"?"Accumulation":"Distribution"} (${v.score.toFixed(2)})`,D=A+P+6,X=T+j/2;s.save(),s.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",s.textAlign="left",s.textBaseline="middle";const ne=v.type==="accumulation"?"#10B981":"#EF4444",de="rgba(0,0,0,0.55)",ie=6,te=s.measureText(L),le=Math.ceil(te.width)+ie*2,pe=16,re=4,xe=D,se=X-pe/2;s.beginPath(),s.moveTo(xe+re,se),s.lineTo(xe+le-re,se),s.quadraticCurveTo(xe+le,se,xe+le,se+re),s.lineTo(xe+le,se+pe-re),s.quadraticCurveTo(xe+le,se+pe,xe+le-re,se+pe),s.lineTo(xe+re,se+pe),s.quadraticCurveTo(xe,se+pe,xe,se+pe-re),s.lineTo(xe,se+re),s.quadraticCurveTo(xe,se,xe+re,se),s.closePath(),s.fillStyle=de,s.fill(),s.fillStyle=ne,s.fillText(L,xe+ie,X+.5),s.restore()}}return s.restore(),!0},createTooltipDataSource:({dataIndex:s,indicator:e,defaultStyles:t})=>{const o=(e.zones||[]).find(l=>s>=l.startIndex&&s<=l.endIndex);if(!o)return{values:[]};const r=o.type==="accumulation"?"Accumulation":"Distribution",a=o.endIndex-o.startIndex+1;return{styles:t,values:[{title:"Footprint",value:r},{title:"Score",value:o.score.toFixed(2)},{title:"Price",value:`${o.low.toFixed(e.precision??2)}–${o.high.toFixed(e.precision??2)}`},{title:"Duration",value:`${a} bars`},{title:"Prior Trend",value:`${(o.priorReturn*100).toFixed(1)}%`},{title:"Avg Volume x",value:o.avgVolumeFactor.toFixed(2)},{title:"OBV Trend",value:o.obvTrendScore>.05?"Up":o.obvTrendScore<-.05?"Down":"Flat"}]}}},Gd={bbPeriod:16,bbStdDev:2,atrPeriod:14,volMAPeriod:20,lookbackForNorm:60,pressureSMA:2,minPressureForAlert:.55,eruptionConfirmBars:1,minVolExpansion:1,minRangeExpansion:1,minBreakoutBodyPct:.5,breakoutLookback:10,w1:.5,w2:.3,w3:.2,minBarsBetweenEruptions:1,trendEMAPeriod:30,requireTrendAlign:0,breakoutBufferPct:7e-4,requireBBBandBreak:0,retestWindow:1};function Ay(s,e,t){return Math.max(e,Math.min(t,s))}function Xb(s,e){const t=new Array(s.length).fill(0);if(e<=1){for(let o=0;o<s.length;o++)t[o]=s[o]??0;return t}let n=0;for(let o=0;o<s.length;o++)n+=s[o]??0,o>=e&&(n-=s[o-e]??0),t[o]=o>=e-1?n/e:NaN;return t}function kL(s,e){const t=new Array(s.length).fill(NaN);if(e<=1)return s.map(()=>0);for(let n=0;n<s.length;n++){if(n<e-1)continue;let o=0;for(let l=n-e+1;l<=n;l++)o+=s[l]??0;const r=o/e;let a=0;for(let l=n-e+1;l<=n;l++){const c=(s[l]??0)-r;a+=c*c}t[n]=Math.sqrt(a/e)}return t}function SL(s,e){const t=new Array(s.length).fill(NaN);if(e<=1)return s.slice();const n=2/(e+1);let o=NaN;for(let r=0;r<s.length;r++){const a=s[r]??0;if(Number.isFinite(o))o=a*n+o*(1-n),t[r]=o;else if(r>=e-1){let l=0;for(let c=r-e+1;c<=r;c++)l+=s[c]??0;o=l/e,t[r]=o}}return t}function N3(s,e){if(!s)return 0;const t=s.high??0,n=s.low??0,o=(e==null?void 0:e.close)??s.close??0;return Math.max(t-n,Math.abs(t-o),Math.abs(n-o))}function CL(s,e){const t=s.map((r,a)=>N3(r,a>0?s[a-1]:void 0)),n=new Array(s.length).fill(NaN);if(e<=1)return t;let o=0;for(let r=0;r<t.length;r++)o+=t[r]??0,r===e-1?n[r]=o/e:r>=e&&(n[r]=((n[r-1]??0)*(e-1)+(t[r]??0))/e);return n}function Zw(s,e){const t=new Array(s.length).fill(NaN);for(let n=0;n<s.length;n++){const o=Math.max(0,n-e+1);let r=1/0;for(let a=o;a<=n;a++)Number.isFinite(s[a])&&s[a]<r&&(r=s[a]);t[n]=r===1/0?NaN:r}return t}function Jw(s,e){const t=new Array(s.length).fill(NaN);for(let n=0;n<s.length;n++){const o=Math.max(0,n-e+1);let r=-1/0;for(let a=o;a<=n;a++)Number.isFinite(s[a])&&s[a]>r&&(r=s[a]);t[n]=r===-1/0?NaN:r}return t}function Qw(s,e,t){return!Number.isFinite(e)||!Number.isFinite(t)||t===e?.5:Ay((s-e)/(t-e),0,1)}function IL(s,e,t){const n=Math.max(0,e-t);let o=-1/0;for(let r=n;r<e;r++)s[r]&&(s[r].high??-1/0)>o&&(o=s[r].high);return o===-1/0?NaN:o}function PL(s,e,t){const n=Math.max(0,e-t);let o=1/0;for(let r=n;r<e;r++)s[r]&&(s[r].low??1/0)<o&&(o=s[r].low);return o===1/0?NaN:o}function A3(s,e){const t={...Gd,...e},n=s.length,o=s.map(se=>(se==null?void 0:se.close)??0),r=s.map(se=>(se==null?void 0:se.volume)??0);if(n===0)return{pressure:[],pressureSmoothed:[],eruptions:[]};const a=Xb(o,t.bbPeriod),l=kL(o,t.bbPeriod),c=new Array(n).fill(NaN),f=new Array(n).fill(NaN),u=new Array(n).fill(NaN);for(let se=0;se<n;se++)if(Number.isFinite(a[se])&&Number.isFinite(l[se])){c[se]=a[se]+t.bbStdDev*l[se],f[se]=a[se]-t.bbStdDev*l[se];const Ne=c[se]-f[se],Te=o[se]||1;u[se]=Te!==0?Ne/Math.abs(Te):0}const d=Math.max(2,t.trendEMAPeriod??50),h=SL(o,d),p=CL(s,t.atrPeriod),v=p.map((se,Ne)=>{const Te=o[Ne]||1;return Te!==0?(se??0)/Math.abs(Te):0}),x=Xb(r,t.volMAPeriod),S=r.map((se,Ne)=>{const Te=x[Ne]??0;return Te>0?se/Te:0}),C=Math.max(10,t.lookbackForNorm),I=Zw(u,C),A=Jw(u,C),P=Zw(v,C),T=Jw(v,C),j=new Array(n).fill(0),E=new Array(n).fill(0),L=new Array(n).fill(0);for(let se=0;se<n;se++){const Ne=Qw(u[se]??0,I[se],A[se]),Te=Qw(v[se]??0,P[se],T[se]);j[se]=1-Ne,E[se]=1-Te;const Me=Math.max(S[se]??0,1e-8),De=Ay(1/Me,0,2);L[se]=Ay(De/2,0,1)}const D=t.w1??.5,X=t.w2??.3,ne=t.w3??.2,de=new Array(n).fill(0);for(let se=0;se<n;se++){const Ne=D*j[se]+X*E[se]+ne*L[se];de[se]=Ay(Ne,0,1)}const ie=Xb(de,Math.max(1,t.pressureSMA)).map(se=>Number.isFinite(se)?se:0),te=[],le=Math.max(1,t.minBarsBetweenEruptions??8);let pe=-1e4,re=!1,xe=-1;for(let se=0;se<n;se++){const Ne=ie[se]??0;if(Ne>=t.minPressureForAlert?re||(re=!0,xe=se):re=!1,!(re||xe>=0&&se-xe<=t.eruptionConfirmBars+2)||se-pe<le)continue;const Me=N3(s[se],se>0?s[se-1]:void 0),De=p[se]??Me,Oe=De>0?Me/De:0;if(Oe<t.minRangeExpansion)continue;const Ke=S[se]??0;if(Ke<t.minVolExpansion)continue;const kt=s[se],pt=Math.max(0,(kt.high??0)-(kt.low??0)),Rt=Math.abs((kt.close??0)-(kt.open??0));if((pt>0?Rt/pt:0)<t.minBreakoutBodyPct)continue;const Ft=IL(s,se,t.breakoutLookback),zt=PL(s,se,t.breakoutLookback),ut=Math.max(0,t.breakoutBufferPct??.001),nt=(t.requireBBBandBreak??1)>0,Je=(t.requireTrendAlign??1)>0,it=h[se],ze=se>0?h[se-1]:it,Ge=Number.isFinite(it)&&Number.isFinite(ze)&&(kt.close??0)>it&&it>=ze,xt=Number.isFinite(it)&&Number.isFinite(ze)&&(kt.close??0)<it&&it<=ze,jt=c[se],ft=f[se];let ke=Number.isFinite(Ft)&&(kt.close??0)>Ft*(1+ut),Se=Number.isFinite(zt)&&(kt.close??0)<zt*(1-ut);if(nt&&(ke=ke&&Number.isFinite(jt)&&(kt.close??0)>jt,Se=Se&&Number.isFinite(ft)&&(kt.close??0)<ft),Je&&(ke=ke&&Ge,Se=Se&&xt),!ke&&!Se)continue;const Et=se,wt=Math.min(n-1,Et+Math.max(1,t.eruptionConfirmBars));let Ls=0,tn=!0;const Gs=Math.max(1,t.retestWindow??2);if(ke)for(let Es=Et;Es<=wt;Es++){const Ns=s[Es];(Ns.close??0)>=(kt.high??0)&&Ls++,Es<=Et+Gs&&Number.isFinite(Ft)&&(Ns.close??0)<Ft&&(tn=!1)}else if(Se)for(let Es=Et;Es<=wt;Es++){const Ns=s[Es];(Ns.close??0)<=(kt.low??0)&&Ls++,Es<=Et+Gs&&Number.isFinite(zt)&&(Ns.close??0)>zt&&(tn=!1)}const an=Math.ceil((wt-Et+1)/2);if(tn&&Ls>=an){const Es=ke?"bullish":"bearish",Ns=ke?Ft:zt;te.push({index:Et,time:kt.timestamp??0,direction:Es,pressureAtSignal:Ne,rangeExpansion:Oe,volumeFactor:Ke,breakoutLevel:Ns}),pe=Et}}return{pressure:de,pressureSmoothed:ie,eruptions:te}}const ML={name:"VOLCANIC",shortName:"VOLC",precision:2,shouldOhlc:!1,shouldFormatBigNumber:!1,visible:!0,zLevel:0,minValue:0,maxValue:1,figures:[{key:"pressure",title:"Pressure: ",type:"line"}],styles:{lines:[{color:"#60A5FA",size:2,style:mt.Solid,smooth:!1,dashedValue:[2,2]}]},calc:(s,e)=>{const t=e.calcParams,n={bbPeriod:(t==null?void 0:t[0])??Gd.bbPeriod,bbStdDev:(t==null?void 0:t[1])??Gd.bbStdDev,atrPeriod:(t==null?void 0:t[2])??Gd.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??Gd.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??Gd.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??Gd.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??Gd.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??Gd.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??Gd.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??Gd.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??Gd.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??Gd.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??Gd.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??Gd.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??Gd.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??Gd.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??Gd.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??Gd.retestWindow??1},{pressureSmoothed:o}=A3(s,n);return o.map(r=>({pressure:Number.isFinite(r)?r:null}))},draw:({ctx:s,chart:e,indicator:t,bounding:n,xAxis:o,yAxis:r})=>{var A,P,T,j,E,L,D;const a=t.result;if(!a||a.length===0)return!1;const l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(a.length-1,l.to),u=t.calcParams,d=(u==null?void 0:u[6])??Gd.minPressureForAlert,h=((T=(P=(A=t.styles)==null?void 0:A.lines)==null?void 0:P[0])==null?void 0:T.color)||"#60A5FA",p="#F59E0B",v=((L=(E=(j=t.styles)==null?void 0:j.lines)==null?void 0:E[0])==null?void 0:L.size)||2;s.save(),s.lineCap="round",s.lineJoin="round";const x=r.convertToPixel(d);x!==null&&(s.strokeStyle="#9CA3AF",s.lineWidth=1,s.setLineDash([4,4]),s.beginPath(),s.moveTo(n.left,x),s.lineTo(n.left+n.width,x),s.stroke(),s.setLineDash([]));let S=null,C=null,I=null;for(let X=c;X<=f;X++){const ne=((D=a[X])==null?void 0:D.pressure)??null;if(ne==null){S=C=I=null;continue}const de=o.convertToPixel(X),ie=r.convertToPixel(ne);if(de===null||ie===null){S=C=I=null;continue}if(S!==null&&C!==null&&I!==null){const te=(I+ne)/2;s.strokeStyle=te>=d?p:h,s.lineWidth=v,s.beginPath(),s.moveTo(S,C),s.lineTo(de,ie),s.stroke()}S=de,C=ie,I=ne}return s.restore(),!0},createTooltipDataSource:({dataIndex:s,indicator:e,defaultStyles:t})=>{const n=e.result[s];if(!n)return{values:[]};const o=e.calcParams,r=(o==null?void 0:o[6])??Gd.minPressureForAlert,a=n.pressure!==null&&n.pressure!==void 0?Number(n.pressure).toFixed(2):"—";return{styles:t,values:[{title:"Pressure",value:a},{title:"Alert ≥",value:Number(r).toFixed(2)}]}}},NL={name:"VOLCANIC_SIG",shortName:"VOLCSIG",precision:2,shouldOhlc:!0,shouldFormatBigNumber:!1,visible:!0,zLevel:0,__alwaysOnTop:!0,figures:[],styles:{texts:[{color:"#ffffff",size:10}]},calc:(s,e)=>{const t=e.calcParams,n={bbPeriod:(t==null?void 0:t[0])??Gd.bbPeriod,bbStdDev:(t==null?void 0:t[1])??Gd.bbStdDev,atrPeriod:(t==null?void 0:t[2])??Gd.atrPeriod,volMAPeriod:(t==null?void 0:t[3])??Gd.volMAPeriod,lookbackForNorm:(t==null?void 0:t[4])??Gd.lookbackForNorm,pressureSMA:(t==null?void 0:t[5])??Gd.pressureSMA,minPressureForAlert:(t==null?void 0:t[6])??Gd.minPressureForAlert,eruptionConfirmBars:(t==null?void 0:t[7])??Gd.eruptionConfirmBars,minVolExpansion:(t==null?void 0:t[8])??Gd.minVolExpansion,minRangeExpansion:(t==null?void 0:t[9])??Gd.minRangeExpansion,minBreakoutBodyPct:(t==null?void 0:t[10])??Gd.minBreakoutBodyPct,breakoutLookback:(t==null?void 0:t[11])??Gd.breakoutLookback,minBarsBetweenEruptions:(t==null?void 0:t[12])??Gd.minBarsBetweenEruptions,trendEMAPeriod:(t==null?void 0:t[13])??Gd.trendEMAPeriod??30,requireTrendAlign:(t==null?void 0:t[14])??Gd.requireTrendAlign??0,breakoutBufferPct:(t==null?void 0:t[15])??Gd.breakoutBufferPct??7e-4,requireBBBandBreak:(t==null?void 0:t[16])??Gd.requireBBBandBreak??0,retestWindow:(t==null?void 0:t[17])??Gd.retestWindow??1},{eruptions:o}=A3(s,n),r=new Array(s.length).fill(null).map(()=>({}));return o.forEach(a=>{const l=r[a.index]||{};a.direction==="bullish"&&(l.bull=!0),a.direction==="bearish"&&(l.bear=!0),l.pressure=a.pressureAtSignal,l.rangeExpansion=a.rangeExpansion,l.volumeFactor=a.volumeFactor,l.breakoutLevel=a.breakoutLevel,r[a.index]=l}),r},draw:({ctx:s,chart:e,indicator:t,xAxis:n,yAxis:o})=>{const r=t.result;if(!r||r.length===0)return!1;const a=e.getDataList(),l=e.getVisibleRange(),c=Math.max(0,l.from),f=Math.min(r.length-1,l.to);function u(h,p,v,x){s.save(),s.fillStyle=v,s.beginPath(),x?(s.moveTo(h,p+6),s.lineTo(h-5,p-4),s.lineTo(h+5,p-4)):(s.moveTo(h,p-6),s.lineTo(h-5,p+4),s.lineTo(h+5,p+4)),s.closePath(),s.fill(),s.restore()}function d(h,p,v,x){s.save(),s.font="11px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",s.textAlign="center",s.textBaseline="middle";const S=6,C=16,I=s.measureText(v),A=Math.ceil(I.width)+S*2,P=4,T=h-A/2,j=p-C/2;s.fillStyle="rgba(0,0,0,0.6)",s.beginPath(),s.moveTo(T+P,j),s.lineTo(T+A-P,j),s.quadraticCurveTo(T+A,j,T+A,j+P),s.lineTo(T+A,j+C-P),s.quadraticCurveTo(T+A,j+C,T+A-P,j+C),s.lineTo(T+P,j+C),s.quadraticCurveTo(T,j+C,T,j+C-P),s.lineTo(T,j+P),s.quadraticCurveTo(T,j,T+P,j),s.closePath(),s.fill(),s.fillStyle=x,s.fillText(v,h,p+.5),s.restore()}for(let h=c;h<=f;h++){const p=r[h];if(!p||!p.bull&&!p.bear)continue;const v=n.convertToPixel(h),x=a[h];if(x){if(p.bull){const S=o.convertToPixel(x.low)+12;u(v,S,"#F59E0B",!0),d(v,S+16,"Volcanic Move (Bullish)","#F59E0B")}if(p.bear){const S=o.convertToPixel(x.high)-12;u(v,S,"#EF4444",!1),d(v,S-16,"Volcanic Move (Bearish)","#EF4444")}}}return!0},createTooltipDataSource:({dataIndex:s,indicator:e,defaultStyles:t})=>{var c;const n=(c=e.result)==null?void 0:c[s];if(!n||!n.bull&&!n.bear)return{values:[]};const o=n.bull?"Bullish":"Bearish",r=n.pressure!==void 0?Number(n.pressure).toFixed(2):"—",a=n.rangeExpansion!==void 0?Number(n.rangeExpansion).toFixed(2):"—",l=n.volumeFactor!==void 0?Number(n.volumeFactor).toFixed(2):"—";return{styles:t,values:[{title:"Eruption",value:o},{title:"Pressure",value:r},{title:"Range x",value:a},{title:"Volume x",value:l}]}}};function AL(s,e,t,n,o,r,a){const l=n*.4,c=o*.4;s.save(),s.strokeStyle=r,s.lineWidth=a,s.lineCap="round",s.lineJoin="round",s.beginPath(),s.moveTo(e-l,t-c),s.lineTo(e+l,t+c),s.moveTo(e+l,t-c),s.lineTo(e-l,t+c),s.stroke(),s.restore()}function TL(s,e,t,n,o,r,a){const l=n*.4,c=o*.4;s.save(),s.strokeStyle=r,s.lineWidth=a,s.lineCap="round",s.beginPath(),s.ellipse(e,t,l,c,0,0,Math.PI*2),s.stroke(),s.restore()}const FL={name:"PNF",shortName:"P&F",calcParams:[],figures:[],calc:(s,e)=>s.map(t=>{const n=t==null?void 0:t._pnf;return n?{direction:n.direction,boxes:n.boxes,upColor:n.upColor,downColor:n.downColor,boxSize:n.boxSize}:{}}),draw:s=>{var C,I;const{ctx:e,visibleRange:t,indicator:n,xAxis:o,yAxis:r}=s,a=n.result||[];if(!(o!=null&&o.convertToPixel)||!(r!=null&&r.convertToPixel))return!1;const l=o.convertToPixel(0),c=o.convertToPixel(1),f=Math.max(1,Math.abs(c-l));let u=f;for(const A of a)if(A!=null&&A.boxes&&A.boxes.length>=2&&(r!=null&&r.convertToPixel)){const P=A.boxes[0],T=A.boxes[1],j=r.convertToPixel(P.price),E=r.convertToPixel(T.price);if(j!==void 0&&E!==void 0&&!isNaN(j)&&!isNaN(E)){const L=Math.abs(j-E);if(L>0){u=L;break}}}if(u===f){const A=a.find(P=>(P==null?void 0:P.boxSize)&&P.boxSize>0);if(A!=null&&A.boxSize){const P=((I=(C=A.boxes)==null?void 0:C[0])==null?void 0:I.price)||100,T=r.convertToPixel(P),j=r.convertToPixel(P+A.boxSize);if(T!==void 0&&j!==void 0&&!isNaN(T)&&!isNaN(j)){const E=Math.abs(T-j);E>0&&(u=E)}}}const d=f*.85,h=u*.85,p=(d+h)/2,v=Math.max(.8,p*.08),x=(t==null?void 0:t.from)||0,S=(t==null?void 0:t.to)||a.length;for(let A=x;A<S;A++){const P=a[A];if(!P||!P.boxes||!Array.isArray(P.boxes))continue;const{direction:T,boxes:j,upColor:E="#00E6D8",downColor:L="#FF4D4D"}=P,D=o.convertToPixel(A);if(!(D===void 0||isNaN(D)))for(const X of j){const ne=r.convertToPixel(X.price);ne===void 0||isNaN(ne)||(T==="up"?AL(e,D,ne,d,h,E,v):TL(e,D,ne,d,h,L,v))}}return!1}},LL=[DF,RF,BF,OF,I3,WF,qF,UF,GF,KF,ZF,JF,QF,eL,tL,nL,oL,iL,rL,lL,cL,dL,fL,pL,gL,wL,ML,NL,FL];function EL(s,e){e?console.log(s,e):console.log(s)}function s1(){return Date.now()}function oy(s,e){const t=s.country||"__";return`${s.ticker}_${t}_${e}`}function iy(s){return{key:s.key,symbol:s.symbol.ticker,timeframe:s.timeframe,candles:s.candles,oldestTimestampLoaded:s.oldest,newestTimestampLoaded:s.newest,isComplete:s.isComplete,isRunning:s.isRunning,pipelineStarts:s.starts,apiCalls:s.apiCalls,lastUpdatedAt:s.lastUpdatedAt,error:s.error}}function $L(s,e){var o;let t=0,n=s.length;for(;t<n;){const r=t+n>>>1;(((o=s[r])==null?void 0:o.timestamp)??0)>=e?n=r:t=r+1}return t}function ek(s,e){return s<=0?Promise.resolve():new Promise((t,n)=>{const o=setTimeout(t,s);if(!e)return;const r=()=>{clearTimeout(o),n(new DOMException("Aborted","AbortError"))};if(e.aborted)return r();e.addEventListener("abort",r,{once:!0})})}class DL{constructor(e,t={}){Pe(this,"entries",new Map);Pe(this,"fetchPage");Pe(this,"opt");this.fetchPage=e,this.opt={maxKeys:t.maxKeys??16,ttlMs:t.ttlMs??20*6e4,initialLimit:t.initialLimit??600,pageLimit:t.pageLimit??800,pageDelayMs:t.pageDelayMs??75,maxRetries:t.maxRetries??2,retryBaseDelayMs:t.retryBaseDelayMs??400,log:t.log??EL}}start(e,t){const n=oy(e,t),o=this.getOrCreate(e,t);return this.touch(o),this.ensureRunning(o),{key:n,getSnapshot:()=>this.getSnapshot(e,t),subscribe:r=>this.subscribe(e,t,r)}}getSnapshot(e,t){const n=oy(e,t),o=this.entries.get(n);return o?(this.touch(o),iy(o)):{key:n,symbol:e.ticker,timeframe:t,candles:[],oldestTimestampLoaded:null,newestTimestampLoaded:null,isComplete:!1,isRunning:!1,pipelineStarts:0,apiCalls:0,lastUpdatedAt:0,error:null}}async waitForInitial(e,t){const n=this.getOrCreate(e,t);return this.touch(n),this.ensureRunning(n),await this.ensureInitialLoaded(n,n.generation),iy(n)}requestVisibleRange(e){const t=this.entries.get(oy(e.symbol,e.timeframe));if(!t||t.candles.length===0)return[];this.touch(t);const n=$L(t.candles,e.beforeTimestamp),o=Math.max(0,n-Math.max(1,e.limit));return t.candles.slice(o,n)}stopSymbol(e){for(const t of this.entries.values())t.symbol.ticker===e&&this.stopEntry(t)}stopAll(){for(const e of this.entries.values())this.stopEntry(e)}clear(){this.stopAll(),this.entries.clear()}subscribe(e,t,n){const o=this.getOrCreate(e,t);this.touch(o),o.subs.add(n);try{n(iy(o))}catch{}return()=>{o.subs.delete(n)}}getMetrics(){const e=[];for(const t of this.entries.values())e.push({key:t.key,pipelineStarts:t.starts,apiCalls:t.apiCalls,isRunning:t.isRunning,isComplete:t.isComplete,error:t.error});return e}emit(e){const t=iy(e);for(const n of e.subs)try{n(t)}catch{}}touch(e){e.lastAccessAt=s1(),this.entries.get(e.key)===e&&(this.entries.delete(e.key),this.entries.set(e.key,e)),this.evictIfNeeded()}evictIfNeeded(){const e=s1()-this.opt.ttlMs;for(;;){const t=this.entries.keys().next().value;if(!t)break;const n=this.entries.get(t);if(!n){this.entries.delete(t);continue}if(n.lastAccessAt>=e)break;this.stopEntry(n),this.entries.delete(t)}for(;this.entries.size>this.opt.maxKeys;){const t=this.entries.keys().next().value;if(!t)break;const n=this.entries.get(t);if(!n){this.entries.delete(t);continue}this.stopEntry(n),this.entries.delete(t)}}getOrCreate(e,t){const n=oy(e,t),o=this.entries.get(n);if(o)return o;const r={key:n,symbol:e,timeframe:t,candles:[],ts:new Set,oldest:null,newest:null,isComplete:!1,isRunning:!1,starts:0,apiCalls:0,lastUpdatedAt:0,lastAccessAt:s1(),error:null,nextSkip:0,generation:0,initialPromise:null,runPromise:null,abort:null,subs:new Set};return this.entries.set(n,r),r}ensureRunning(e){if(e.isComplete||e.runPromise)return;e.isRunning=!0,e.error=null,e.generation+=1,e.starts+=1,e.abort||(e.abort=new AbortController);const t=e.generation;this.opt.log("📡 [pipeline:start]",{key:e.key,gen:t});const n=this.runLoop(e,t).finally(()=>{e.runPromise===n&&(e.runPromise=null),e.isRunning=!1,e.abort=null,this.emit(e),this.opt.log("⏹️ [pipeline:stop]",{key:e.key,gen:t,complete:e.isComplete})});e.runPromise=n}stopEntry(e){var t;e.generation+=1,e.isRunning=!1,e.initialPromise=null;try{(t=e.abort)==null||t.abort()}catch{}e.abort=null}async ensureInitialLoaded(e,t){e.candles.length>0||e.isComplete||(e.initialPromise||(e.initialPromise=(async()=>{const n=e.abort??new AbortController;e.abort=n;const o=e.nextSkip,r=this.opt.initialLimit;try{const a=await this.fetchPageWithRetry(e,{skip:o,limit:r,gen:t,signal:n.signal});if(e.generation!==t)return;this.mergePage(e,a),e.nextSkip=o+a.length,this.emit(e)}finally{e.initialPromise=null}})()),await e.initialPromise.catch(()=>{}))}async runLoop(e,t){for(await this.ensureInitialLoaded(e,t);e.isRunning&&!e.isComplete&&e.generation===t;){const n=e.abort??new AbortController;e.abort=n;const o=e.nextSkip,r=this.opt.pageLimit;let a=[];try{a=await this.fetchPageWithRetry(e,{skip:o,limit:r,gen:t,signal:n.signal})}catch(l){if(e.generation!==t||l instanceof DOMException&&l.name==="AbortError")return;e.error=l instanceof Error?l.message:"Fetch failed",this.emit(e);return}if(e.generation!==t)return;if(!a||a.length===0){e.isComplete=!0,this.emit(e);return}this.mergePage(e,a),e.nextSkip=o+a.length,this.emit(e),await ek(this.opt.pageDelayMs,n.signal).catch(()=>{})}}async fetchPageWithRetry(e,t){let n=0;for(;;)try{e.apiCalls+=1,this.opt.log("🌐 [pipeline:page]",{key:e.key,skip:t.skip,limit:t.limit,calls:e.apiCalls});const o=await this.fetchPage({symbol:e.symbol,timeframe:e.timeframe,skip:t.skip,limit:t.limit,signal:t.signal});return e.lastUpdatedAt=s1(),e.error=null,Array.isArray(o)?o:[]}catch(o){if(o instanceof DOMException&&o.name==="AbortError"||e.generation!==t.gen||n>=this.opt.maxRetries)throw o;const r=this.opt.retryBaseDelayMs*Math.pow(2,n);n+=1,await ek(r,t.signal)}}mergePage(e,t){if(!Array.isArray(t)||t.length===0)return;const n=[];for(const o of t){const r=o==null?void 0:o.timestamp;typeof r=="number"&&(e.ts.has(r)||(e.ts.add(r),n.push(o),(e.oldest==null||r<e.oldest)&&(e.oldest=r),(e.newest==null||r>e.newest)&&(e.newest=r)))}if(n.length>0){if(n.sort((o,r)=>o.timestamp-r.timestamp),e.candles.length===0)e.candles=n;else{const o=new Array(e.candles.length+n.length);let r=0,a=0,l=0;for(;r<e.candles.length&&a<n.length;)e.candles[r].timestamp<=n[a].timestamp?o[l++]=e.candles[r++]:o[l++]=n[a++];for(;r<e.candles.length;)o[l++]=e.candles[r++];for(;a<n.length;)o[l++]=n[a++];o.length=l,e.candles=o}e.lastUpdatedAt=s1()}}}const T3=s=>{if(s==null)return 0;if(typeof s=="number")return Number.isFinite(s)?s<1e12?s*1e3:s:0;const e=String(s).trim();if(!e)return 0;const t=Number(e);if(Number.isFinite(t))return t<1e12?t*1e3:t;const n=Date.parse(e);return Number.isFinite(n)?n:0},tk=s=>{if(!Number.isFinite(s))return 1;const e=Number(s);return e>0?e:1};function RL(s){if(!Array.isArray(s)||s.length===0)return[];const e=[];for(const t of s){const n=(t==null?void 0:t.type)??"adjustment",o=T3(t==null?void 0:t.date);if(!o)continue;let r=1,a=1,l=0;if(n==="split"){let c=Number(t==null?void 0:t.ratio);if(!Number.isFinite(c)||c<=0){const f=Number(t==null?void 0:t.numerator),u=Number(t==null?void 0:t.denominator);Number.isFinite(f)&&Number.isFinite(u)&&u!==0&&(c=f/u)}Number.isFinite(t==null?void 0:t.factor)&&Number(t.factor)>0?r=tk(Number(t.factor)):Number.isFinite(c)&&c>0&&(r=1/c),a=r>0?1/r:1}else n==="dividend"?l=Number((t==null?void 0:t.cash)??0)||0:r=tk(Number(t==null?void 0:t.factor));e.push({type:n,ts:o,priceFactor:r,volumeFactor:a,cash:l})}return e.sort((t,n)=>t.ts-n.ts),e}function jL(s,e,t){if(!Array.isArray(s)||s.length===0||!e||e.length===0)return s;const n=t||"none";if(n==="none")return s;const o=RL(e);return o.length?s.map(r=>{const a=T3((r==null?void 0:r.timestamp)??(r==null?void 0:r.time));if(!a)return r;let l=r.open,c=r.high,f=r.low,u=r.close,d=r.volume;for(const h of o)if(!(a>=h.ts)){if(h.type==="split"&&(n==="split"||n==="all")){const p=h.priceFactor,v=h.volumeFactor;Number.isFinite(l)&&(l=Number(l)*p),Number.isFinite(c)&&(c=Number(c)*p),Number.isFinite(f)&&(f=Number(f)*p),Number.isFinite(u)&&(u=Number(u)*p),Number.isFinite(d)&&(d=Number(d)*v)}else if(h.type==="dividend"&&(n==="dividend"||n==="all")){const p=h.cash;Number.isFinite(p)&&p!==0&&(Number.isFinite(l)&&(l=Number(l)-p),Number.isFinite(c)&&(c=Number(c)-p),Number.isFinite(f)&&(f=Number(f)-p),Number.isFinite(u)&&(u=Number(u)-p))}else if(h.type==="adjustment"&&n==="all"){const p=h.priceFactor;Number.isFinite(l)&&(l=Number(l)*p),Number.isFinite(c)&&(c=Number(c)*p),Number.isFinite(f)&&(f=Number(f)*p),Number.isFinite(u)&&(u=Number(u)*p)}}return{...r,open:l,high:c,low:f,close:u,volume:d}}):s}const BL={BD:{timezone:"Asia/Dhaka",regular:"1000-1430"},US:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},GB:{timezone:"Europe/London",regular:"0800-1630"},JP:{timezone:"Asia/Tokyo",regular:"0900-1500"},SG:{timezone:"Asia/Singapore",regular:"0900-1700"},HK:{timezone:"Asia/Hong_Kong",regular:"0930-1600"}},OL={DSEBD:{timezone:"Asia/Dhaka",regular:"1000-1430"},NYSE:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},NASDAQ:{timezone:"America/New_York",regular:"0930-1600",extended:"0400-2000"},LSE:{timezone:"Europe/London",regular:"0800-1630"},TSE:{timezone:"Asia/Tokyo",regular:"0900-1500"},HKEX:{timezone:"Asia/Hong_Kong",regular:"0930-1600"}},sk=s=>{const e=s.trim();if(!e)return null;const t=e.match(/^(\d{1,2}):?(\d{2})$/);if(!t)return null;const n=Math.max(0,Math.min(23,Number(t[1]))),o=Math.max(0,Math.min(59,Number(t[2])));return`${String(n).padStart(2,"0")}${String(o).padStart(2,"0")}`};function Ky(s){const e=String(s??"").trim();if(!e)return;if(e.toLowerCase()==="24x7"||e==="0000-2359")return"24x7";const t=e.split(/[;,]/).map(o=>o.trim()).filter(Boolean),n=[];for(const o of t){const r=o.match(/(\d{1,2}:?\d{2})\s*-\s*(\d{1,2}:?\d{2})/);if(!r)continue;const a=sk(r[1]),l=sk(r[2]);!a||!l||n.push(`${a}-${l}`)}if(n.length)return n.join(";")}function zL(s){const e=s.exchange?OL[String(s.exchange).toUpperCase()]:void 0;if(e)return e;const t=s.country?BL[String(s.country).toUpperCase()]:void 0;return t||{}}function n1(s,e){return s.timezone||s.sessionTimezone||e||"UTC"}function VL(s,e){const t=Ky(s.session),n=Ky(s.sessionExtended);return e==="all"?"24x7":e==="extended"?n||t||"24x7":t||"24x7"}const o1=s=>s>="0"&&s<="9",nk=s=>s>="a"&&s<="z"||s>="A"&&s<="Z"||s==="_"||s==="$";class WL{constructor(e){Pe(this,"pos",0);this.input=e}next(){const e=this.input,t=e.length;for(;this.pos<t&&/\s/.test(e[this.pos]??"");)this.pos++;if(this.pos>=t)return{type:"eof",start:this.pos,end:this.pos};const n=e[this.pos],o=this.pos;if(n==='"'||n==="'"){const r=n;this.pos++;let a="",l=!1;for(;this.pos<t;){const c=e[this.pos];if(this.pos++,l){switch(c){case"n":a+=`
`;break;case"t":a+="	";break;case"r":a+="\r";break;case"\\":case"'":case'"':a+=c;break;default:a+=c;break}l=!1;continue}if(c==="\\"){l=!0;continue}if(c===r)break;a+=c}return{type:"string",value:a,start:o,end:this.pos}}if(o1(n)||n==="."&&o1(e[this.pos+1]??"")){let r=n===".";for(this.pos++;this.pos<t;){const a=e[this.pos];if(o1(a))this.pos++;else if(a==="."&&!r)r=!0,this.pos++;else break}if(e[this.pos]==="e"||e[this.pos]==="E"){let l=this.pos+1;(e[l]==="+"||e[l]==="-")&&l++;const c=l;for(;l<t&&o1(e[l]);)l++;l>c&&(this.pos=l)}return{type:"number",value:e.slice(o,this.pos),start:o,end:this.pos}}if(nk(n)){for(this.pos++;this.pos<t;){const l=e[this.pos];if(nk(l)||o1(l))this.pos++;else break}const r=e.slice(o,this.pos),a=r.toLowerCase();return a==="and"?{type:"and",start:o,end:this.pos}:a==="or"?{type:"or",start:o,end:this.pos}:a==="not"?{type:"not",start:o,end:this.pos}:a==="true"||a==="false"?{type:"boolean",value:a,start:o,end:this.pos}:{type:"identifier",value:r,start:o,end:this.pos}}switch(this.pos++,n){case".":return{type:"dot",start:o,end:this.pos};case">":return e[this.pos]==="="?(this.pos++,{type:"gte",start:o,end:this.pos}):{type:"gt",start:o,end:this.pos};case"<":return e[this.pos]==="="?(this.pos++,{type:"lte",start:o,end:this.pos}):{type:"lt",start:o,end:this.pos};case"=":if(e[this.pos]==="=")return this.pos++,{type:"eq",start:o,end:this.pos};throw new Error(`Unexpected '=' at position ${o}`);case"!":if(e[this.pos]==="=")return this.pos++,{type:"neq",start:o,end:this.pos};throw new Error(`Unexpected '!' at position ${o}`);case"+":return{type:"plus",start:o,end:this.pos};case"-":return{type:"minus",start:o,end:this.pos};case"*":return{type:"star",start:o,end:this.pos};case"/":return{type:"slash",start:o,end:this.pos};case"%":return{type:"percent",start:o,end:this.pos};case"(":return{type:"lparen",start:o,end:this.pos};case")":return{type:"rparen",start:o,end:this.pos};case",":return{type:"comma",start:o,end:this.pos};case"?":return{type:"qmark",start:o,end:this.pos};case":":return{type:"colon",start:o,end:this.pos};case"[":return{type:"lbracket",start:o,end:this.pos};case"]":return{type:"rbracket",start:o,end:this.pos};default:throw new Error(`Unexpected character "${n}" at position ${o}`)}}}class rv extends Error{constructor(e,t){super(e),this.position=t,this.name="ParseError"}}class HL{constructor(e){Pe(this,"current");this.tokenizer=e,this.current=e.next()}eat(e){if(this.current.type!==e)throw new rv(`Expected ${e} but found ${this.current.type}`,this.current.start);const t=this.current;return this.current=this.tokenizer.next(),t}match(e){return this.current.type===e?(this.current=this.tokenizer.next(),!0):!1}parseExpression(){return this.parseTernary()}parseTernary(){const e=this.parseOr();if(this.current.type==="qmark"){this.current=this.tokenizer.next();const t=this.parseExpression();this.eat("colon");const n=this.parseExpression();return{kind:"CallExpression",callee:"iff",args:[e,t,n]}}return e}parseOr(){let e=this.parseAnd();for(;this.current.type==="or";){this.current=this.tokenizer.next();const t=this.parseAnd();e={kind:"BinaryExpression",operator:"or",left:e,right:t}}return e}parseAnd(){let e=this.parseComparison();for(;this.current.type==="and";){this.current=this.tokenizer.next();const t=this.parseComparison();e={kind:"BinaryExpression",operator:"and",left:e,right:t}}return e}parseComparison(){let e=this.parseAddSub();for(;this.current.type==="gt"||this.current.type==="lt"||this.current.type==="gte"||this.current.type==="lte"||this.current.type==="eq"||this.current.type==="neq";){const t=this.current;this.current=this.tokenizer.next();const n=this.parseAddSub();let o="==";t.type==="gt"?o=">":t.type==="lt"?o="<":t.type==="gte"?o=">=":t.type==="lte"?o="<=":t.type==="neq"&&(o="!="),e={kind:"BinaryExpression",operator:o,left:e,right:n}}return e}parseAddSub(){let e=this.parseTerm();for(;this.current.type==="plus"||this.current.type==="minus";){const t=this.current;this.current=this.tokenizer.next();const n=this.parseTerm();e={kind:"BinaryExpression",operator:t.type==="plus"?"+":"-",left:e,right:n}}return e}parseTerm(){let e=this.parseFactor();for(;this.current.type==="star"||this.current.type==="slash"||this.current.type==="percent";){const t=this.current;this.current=this.tokenizer.next();const n=this.parseFactor();e={kind:"BinaryExpression",operator:t.type==="star"?"*":t.type==="slash"?"/":"%",left:e,right:n}}return e}parseFactor(){if(this.current.type==="not")return this.current=this.tokenizer.next(),{kind:"UnaryExpression",operator:"not",expr:this.parseFactor()};if(this.current.type==="plus"||this.current.type==="minus"){const e=this.current.type==="minus";this.current=this.tokenizer.next();const t=this.parseFactor();return e?{kind:"BinaryExpression",operator:"*",left:{kind:"NumberLiteral",value:-1},right:t}:t}return this.parsePostfix(this.parsePrimary())}parsePostfix(e){var n;let t=e;for(;;){if(this.current.type==="dot"){if(this.current=this.tokenizer.next(),this.current.type!=="identifier")throw new rv("Expected identifier after '.'",this.current.start);const o=((n=this.current.value)==null?void 0:n.toString())??"";this.current=this.tokenizer.next(),t={kind:"MemberExpression",object:t,property:{kind:"Identifier",name:o}};continue}if(this.current.type==="lbracket"){this.current=this.tokenizer.next();const o=this.parseExpression();this.eat("rbracket"),t={kind:"IndexExpression",object:t,index:o};continue}break}return t}parsePrimary(){const e=this.current;switch(e.type){case"number":{this.current=this.tokenizer.next();const t=Number(e.value);if(!Number.isFinite(t))throw new rv("Invalid number literal",e.start);return{kind:"NumberLiteral",value:t}}case"string":return this.current=this.tokenizer.next(),{kind:"StringLiteral",value:String(e.value??"")};case"boolean":return this.current=this.tokenizer.next(),{kind:"NumberLiteral",value:String(e.value||"").toLowerCase()==="true"?1:0};case"identifier":{this.current=this.tokenizer.next();const t=(e.value||"").toString();if(this.current.type==="lparen"){this.eat("lparen");const n=[];if(this.current.type!=="rparen")for(;n.push(this.parseExpression()),!!this.match("comma"););return this.eat("rparen"),{kind:"CallExpression",callee:t,args:n}}return{kind:"Identifier",name:t}}case"lparen":{this.eat("lparen");const t=this.parseExpression();return this.eat("rparen"),t}default:throw new rv(`Unexpected token ${e.type}`,e.start)}}}function Ep(s){const e=new HL(new WL(s)),t=e.parseExpression();if(e.current.type!=="eof")throw new rv("Unexpected input after end of expression",e.current.start);return t}function f_(s,e){const t=[];let n=0;for(let o=0;o<s.length;o++){const r=s[o];n+=r??0,o>=e&&(n-=s[o-e]??0),t.push(o>=e-1?n/e:void 0)}return t}function qL(s,e){const t=[],n=e*(e+1)/2;for(let o=0;o<s.length;o++){if(o<e-1){t.push(void 0);continue}let r=0;for(let a=0;a<e;a++)r+=(s[o-a]??0)*(e-a);t.push(r/n)}return t}function UL(s,e){const t=[];let n,o=0;for(let r=0;r<s.length;r++){const a=s[r];if(a==null){t.push(void 0);continue}if(n===void 0){if(o+=a,r<e-1){t.push(void 0);continue}n=o/e,t.push(n);continue}n=(n*(e-1)+a)/e,t.push(n)}return t}function cg(s,e){const t=[],n=2/(e+1);let o;for(let r=0;r<s.length;r++){const a=s[r];if(a==null){t.push(void 0);continue}o=o===void 0?a:a*n+o*(1-n),t.push(o)}return t}function GL(s,e){const t=[];let n,o=0,r=0,a=!1;const l=[],c=[];for(let f=0;f<s.length;f++){const u=s[f];if(u==null){t.push(void 0);continue}if(n===void 0){n=u,t.push(void 0);continue}const d=u-n;n=u;const h=d>0?d:0,p=d<0?-d:0;if(a)o=(o*(e-1)+h)/e,r=(r*(e-1)+p)/e;else{if(l.push(h),c.push(p),l.length<e){t.push(void 0);continue}o=l.reduce((v,x)=>v+x,0)/e,r=c.reduce((v,x)=>v+x,0)/e,a=!0}if(r===0)t.push(100);else{const v=o/r;t.push(100-100/(1+v))}}return t}function Xy(s,e,t,n){const o=t.length,r=new Array(o).fill(0);let a;for(let f=0;f<o;f++){const u=s[f]??t[f]??NaN,d=e[f]??t[f]??NaN,h=t[f]??NaN;let p=Math.max(0,u-d);a!==void 0&&(p=Math.max(p,Math.abs(u-a),Math.abs(d-a))),r[f]=p,a=h}const l=new Array(o);let c=0;for(let f=0;f<o;f++)c+=r[f],f===n-1?l[f]=c/n:f>=n?l[f]=(l[f-1]*(n-1)+r[f])/n:l[f]=void 0;return l}function F3(s,e){const t=new Array(s.length);let n=0,o;for(let r=0;r<s.length;r++){const a=s[r],l=e[r]??0;if(o===void 0||a===void 0){t[r]=void 0,o=a;continue}a>o?n+=l:a<o&&(n-=l),t[r]=n,o=a}return t}function L3(s,e,t,n){const o=t.length,r=new Array(o);for(let c=0;c<o;c++)r[c]=((s[c]??t[c]??0)+(e[c]??t[c]??0)+(t[c]??0))/3;const a=f_(r.map(c=>c),n).map(c=>c),l=new Array(o);for(let c=0;c<o;c++){if(c<n-1){l[c]=void 0;continue}let f=0;for(let d=c-n+1;d<=c;d++)f+=Math.abs(r[d]-a[c]);f=f/n;const u=.015*f;l[c]=u===0?void 0:(r[c]-a[c])/u}return l}function E3(s,e,t,n,o){const r=t.length,a=new Array(r),l=new Array(r);for(let f=0;f<r;f++)l[f]=((s[f]??t[f]??0)+(e[f]??t[f]??0)+(t[f]??0))/3;const c=new Array(r);for(let f=0;f<r;f++)c[f]=l[f]*(n[f]??0);for(let f=0;f<r;f++){if(f<o){a[f]=void 0;continue}let u=0,d=0;for(let p=f-o+1;p<=f;p++)l[p]>=l[p-1]?u+=c[p]:d+=c[p];const h=d===0?1/0:u/d;a[f]=100-100/(1+h)}return a}function YL(s,e){const t=s.map((a,l)=>((a??0)+(e[l]??0))/2),n=f_(t,5),o=f_(t,34),r=new Array(t.length);for(let a=0;a<t.length;a++){const l=n[a],c=o[a];r[a]=l===void 0||c===void 0?void 0:l-c}return r}function KL(s,e){const t=cg(s,e).map(a=>a??NaN),n=cg(t,e).map(a=>a??NaN),o=cg(n,e).map(a=>a??NaN),r=new Array(s.length);for(let a=1;a<s.length;a++){const l=o[a-1],c=o[a];r[a]=l===void 0||c===void 0||l===0?void 0:(c/l-1)*100}return r[0]=void 0,r}function ok(s,e){const t=new Array(s.length);let n=0,o=0;for(let r=0;r<s.length;r++){const a=s[r],l=e[r]??0;if(a===void 0){t[r]=void 0;continue}n+=a*l,o+=l,t[r]=o===0?void 0:n/o}return t}function XL(s,e,t){const n=new Array(s.length);let o=0,r=0;for(let a=0;a<s.length;a++){const l=s[a],c=e[a]??0;if(l!==void 0&&(o+=l*c,r+=c),a>=t){const f=s[a-t],u=e[a-t]??0;f!==void 0&&(o-=f*u,r-=u)}n[a]=a>=t-1&&r!==0?o/r:void 0}return n}function q2(s,e,t){const n=s.map(c=>c??NaN),o=f_(n,e),r=[];for(let c=0;c<n.length;c++){if(c<e-1){r.push(void 0);continue}let f=0;for(let h=c-e+1;h<=c;h++)f+=n[h];const u=f/e;let d=0;for(let h=c-e+1;h<=c;h++){const p=n[h]-u;d+=p*p}r.push(Math.sqrt(d/e))}const a=new Array(n.length),l=new Array(n.length);for(let c=0;c<n.length;c++){const f=o[c],u=r[c];a[c]=f===void 0||u===void 0?void 0:f+t*u,l[c]=f===void 0||u===void 0?void 0:f-t*u}return{mid:o,upper:a,lower:l}}function ZL(s,e,t,n,o){const r=t.length,a=Xy(s,e,t,n).map(p=>p??NaN),l=new Array(r),c=new Array(r);for(let p=0;p<r;p++){const v=((s[p]??t[p]??0)+(e[p]??t[p]??0))/2,x=a[p];l[p]=v+o*x,c[p]=v-o*x}const f=new Array(r);let u=NaN,d=NaN,h=!0;for(let p=0;p<r;p++){u=Number.isFinite(u)?Math.min(l[p],u):l[p],d=Number.isFinite(d)?Math.max(c[p],d):c[p];const v=t[p]??NaN;if(!Number.isFinite(v)){f[p]=void 0;continue}h?(v<d&&(h=!1,u=l[p]),f[p]=d):(v>u&&(h=!0,d=c[p]),f[p]=u)}return f}function JL(s,e,t,n,o){const r=cg(t,n).map(u=>u??NaN),a=Xy(s,e,t,n).map(u=>u??NaN),l=t.length,c=new Array(l),f=new Array(l);for(let u=0;u<l;u++){const d=r[u],h=a[u];c[u]=Number.isFinite(d)&&Number.isFinite(h)?d+o*h:void 0,f[u]=Number.isFinite(d)&&Number.isFinite(h)?d-o*h:void 0}return{mid:r,upper:c,lower:f}}function QL(s,e,t){const n=s.length,o=new Array(n),r=new Array(n),a=new Array(n);for(let l=0;l<n;l++){if(l<t-1){o[l]=void 0,r[l]=void 0,a[l]=void 0;continue}let c=-1/0,f=1/0;for(let u=l-t+1;u<=l;u++){const d=s[u]??e[u]??NaN,h=e[u]??s[u]??NaN;Number.isFinite(d)&&d>c&&(c=d),Number.isFinite(h)&&h<f&&(f=h)}o[l]=c,r[l]=f,a[l]=Number.isFinite(c)&&Number.isFinite(f)?(c+f)/2:void 0}return{upper:o,lower:r,mid:a}}function $3(s,e){const t=s.length,n=new Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=void 0;continue}let r=0;for(let u=o-e+1;u<=o;u++)r+=s[u]??0;const a=r/e;let l=0;for(let u=o-e+1;u<=o;u++){const d=(s[u]??0)-a;l+=d*d}const c=Math.sqrt(l/e),f=s[o]??NaN;n[o]=Number.isFinite(c)&&c!==0?(f-a)/c:void 0}return n}function ik(s,e){const t=s.length,n=new Array(t);let o=s[0];for(let r=0;r<t;r++){const a=s[r],l=e[r]??0;if(a==null){n[r]=void 0;continue}const c=a>=(o??a)?1:-1;n[r]=c*l,o=a}return n}function eE(s){const e=s.length,t=new Array(e);let n=0;for(let o=0;o<e;o++){const r=s[o];if(r==null){t[o]=void 0;continue}n+=r,t[o]=n}return t}function tE(s,e){const t=s.length,n=new Array(t),o=new Array(t),r=new Array(t);for(let a=0;a<t;a++){if(a<e-1){n[a]=void 0,o[a]=void 0,r[a]=void 0;continue}let l=0,c=0,f=0,u=0,d=0;for(let A=a-e+1;A<=a;A++){const P=A-(a-e+1),T=s[A]??NaN;Number.isFinite(T)&&(l+=P,c+=T,f+=P*P,u+=P*T,d++)}const h=d*f-l*l;if(h===0||d===0){n[a]=void 0,o[a]=void 0,r[a]=void 0;continue}const p=(d*u-l*c)/h,v=(c-p*l)/d,x=e-1,S=p*x+v;n[a]=S;const C=$3(s.slice(a-e+1,a+1).map(A=>A??NaN),e).pop(),I=Number(C)*(s[a]??0?1:0);o[a]=Number.isFinite(S)?S+Math.abs(I||0):void 0,r[a]=Number.isFinite(S)?S-Math.abs(I||0):void 0}return{mid:n,upper:o,lower:r}}function D3(s,e,t){const n=s.length,o=new Array(n);let r=0;for(let a=0;a<n;a++){const l=s[a],c=e[a]??0;if(l==null){o[a]=void 0;continue}const f=c/Math.max(1,e[a-1]??c);r=(r*(t-1)+l*f)/t,o[a]=r}return o}function Em(s){if(!s)return 0;let e=2166136261;for(let n=0;n<s.length;n++)e^=s.charCodeAt(n),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function j1(s){return Number.isFinite(s)?s.toFixed(2):""}function U2(s,e){if(!Number.isFinite(s))return"";if(!e)return j1(s);const t=String(e),n=t.includes("%"),o=t.split(".");let r=0;o.length>1&&(r=o[1].replace(/[^0-9#]/g,"").length);const a=n?s*100:s,l=r>0?a.toFixed(r):String(Math.round(a));return n?`${l}%`:l}class Pt extends Error{constructor(e){super(e),this.name="ExpressionEngineError"}}function ov(s,e){const t=s.length,n=new Float32Array(t);let o=0;for(let r=0;r<t;r++){const a=s[r];if(Number.isFinite(a)&&(o+=a),r>=e){const l=s[r-e];Number.isFinite(l)&&(o-=l)}n[r]=r>=e-1?o:NaN}return n}function R3(s,e,t){const n=s.length,o=new Float32Array(n),r=e-1,a=t==="rising";for(let l=0;l<n;l++){if(l<r){o[l]=NaN;continue}let c=!0,f=!0;const u=l-r;for(let d=u;d<=l;d++){const h=s[d];if(!Number.isFinite(h)){f=!1;break}if(d===u)continue;const p=s[d-1];if(!Number.isFinite(p)){f=!1;break}(a?!(h>p):!(h<p))&&(c=!1)}o[l]=f?c?1:0:NaN}return o}function j3(s,e,t){let n=-1/0;for(let o=e;o<=t;o++){const r=s[o];Number.isFinite(r)&&r>n&&(n=r)}return n}function B3(s,e,t){let n=1/0;for(let o=e;o<=t;o++){const r=s[o];Number.isFinite(r)&&r<n&&(n=r)}return n}function sE(s,e){const t=s.length,n=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=s[r],c=a>=0?s[a]:NaN;n[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return n}function h1(s,e){const t=s.length,n=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=s[r],c=a>=0?s[a]:NaN;!Number.isFinite(l)||!Number.isFinite(c)||c===0?n[r]=NaN:n[r]=(l-c)/c*100}return n}function nE(s,e){const t=s.length,n=new Float32Array(t),o=Math.max(1,Math.floor(e));for(let r=0;r<t;r++){const a=r-o,l=s[r],c=a>=0?s[a]:NaN;n[r]=Number.isFinite(l)&&Number.isFinite(c)?l-c:NaN}return n}function xv(s){const e=new Array(s.length);for(let t=0;t<s.length;t++){const n=s[t];e[t]=Number.isFinite(n)?n:void 0}return e}function Eg(s){const e=new Float32Array(s.length);for(let t=0;t<s.length;t++){const n=s[t];e[t]=n==null||!Number.isFinite(n)?NaN:n}return e}function oE(s,e,t,n){const o=xv(s),r=cg(o,e),a=cg(o,t),l=new Array(o.length);for(let u=0;u<o.length;u++){const d=r[u],h=a[u];l[u]=d==null||h==null?void 0:d-h}const c=cg(l,n),f=new Array(o.length);for(let u=0;u<o.length;u++){const d=l[u],h=c[u];f[u]=d==null||h==null?void 0:d-h}return{line:Eg(l),signal:Eg(c),hist:Eg(f)}}function iE(s,e,t,n,o){const r=t.length,a=new Array(r);for(let u=0;u<r;u++){const d=Math.max(0,u-n+1);let h=-1/0,p=1/0;for(let S=d;S<=u;S++){const C=Number.isFinite(s[S])?s[S]:t[S],I=Number.isFinite(e[S])?e[S]:t[S];Number.isFinite(C)&&C>h&&(h=C),Number.isFinite(I)&&I<p&&(p=I)}const v=t[u],x=h-p;!Number.isFinite(v)||!Number.isFinite(h)||!Number.isFinite(p)||x===0?a[u]=void 0:a[u]=100*((v-p)/x)}const l=a.map(u=>u??NaN),c=f_(l,o),f=new Array(r);for(let u=0;u<r;u++){const d=c[u];f[u]=Number.isFinite(d)?d:void 0}return{k:Eg(a),d:Eg(f)}}function O3(s,e,t,n){const o=t.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=Math.max(0,a-n+1);let c=-1/0,f=1/0,u=!1;for(let p=l;p<=a;p++){const v=Number.isFinite(s[p])?s[p]:t[p],x=Number.isFinite(e[p])?e[p]:t[p];Number.isFinite(v)&&(v>c&&(c=v),u=!0),Number.isFinite(x)&&(x<f&&(f=x),u=!0)}const d=t[a],h=c-f;if(!u||!Number.isFinite(d)||!Number.isFinite(c)||!Number.isFinite(f)||h===0){r[a]=NaN;continue}r[a]=-100*((c-d)/h)}return r}function Zy(s,e,t){const n=SS(s,t),o=CS(e,t),r=s.length,a=new Float32Array(r),l=new Float32Array(r);for(let c=0;c<r;c++){const f=n[c],u=o[c];if(!Number.isFinite(f)||!Number.isFinite(u)){a[c]=NaN,l[c]=NaN;continue}a[c]=100*((t-f)/t),l[c]=100*((t-u)/t)}return{up:a,down:l}}function rE(s,e,t){const{up:n,down:o}=Zy(s,e,t),r=n.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=n[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?c-f:NaN}return a}function M0(s,e,t,n,o){const r=t.length,a=new Float32Array(r),l=new Float32Array(r),c=new Float32Array(r);for(let S=0;S<r;S++){const C=s[S],I=e[S],A=t[S];if(!Number.isFinite(C)||!Number.isFinite(I)||!Number.isFinite(A)){a[S]=NaN,l[S]=NaN,c[S]=NaN;continue}if(S===0){a[S]=Math.max(0,C-I),l[S]=0,c[S]=0;continue}const P=s[S-1],T=e[S-1],j=t[S-1];if(!Number.isFinite(P)||!Number.isFinite(T)||!Number.isFinite(j)){a[S]=NaN,l[S]=NaN,c[S]=NaN;continue}const E=C-P,L=T-I;l[S]=E>L&&E>0?E:0,c[S]=L>E&&L>0?L:0;const D=C-I,X=Math.abs(C-j),ne=Math.abs(I-j);a[S]=Math.max(0,D,X,ne)}const f=M_(a,n),u=M_(l,n),d=M_(c,n),h=new Float32Array(r),p=new Float32Array(r),v=new Float32Array(r);for(let S=0;S<r;S++){const C=f[S],I=u[S],A=d[S];if(!Number.isFinite(C)||C===0||!Number.isFinite(I)||!Number.isFinite(A)){h[S]=NaN,p[S]=NaN,v[S]=NaN;continue}h[S]=100*(I/C),p[S]=100*(A/C);const P=h[S]+p[S];v[S]=P===0?NaN:100*(Math.abs(h[S]-p[S])/P)}const x=M_(v,o);return{plus:h,minus:p,adx:x}}function z3(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){const r=s[o],a=e[o],l=r+a;n[o]=Number.isFinite(r)&&Number.isFinite(a)&&l!==0?100*(Math.abs(r-a)/l):NaN}return n}function V3(s,e,t,n){const o=s.length,r=new Float32Array(o),a=Math.max(1,t+1),l=new Array(a);let c=0,f=0;const u=n||(d=>Number.isFinite(d)&&d!==0);for(let d=0;d<o;d++){const h=s[d];if(u(h)&&(l[f]=d,f=(f+1)%a,c<a&&(c+=1)),c>t){const p=l[(f-1-t+a)%a],v=e[p];r[d]=Number.isFinite(v)?v:NaN}else r[d]=NaN}return r}function W3(s,e){if(!Number.isFinite(s)||!Number.isFinite(e)||!Number.isInteger(s)||!Number.isInteger(e)||s<1||e<1)throw new Pt("pivot left/right must be positive integers");return{left:s,right:e}}function aE(s,e,t,n){const o=s.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=a-t;if(l-e<0){r[a]=NaN;continue}const c=s[l];if(!Number.isFinite(c)){r[a]=NaN;continue}const f=l-e,u=l+t;let d=!0;for(let h=f;h<=u;h++){const p=s[h];if(!Number.isFinite(p)){d=!1;break}if(n==="high"){if(p>c){d=!1;break}}else if(p<c){d=!1;break}}r[a]=d?c:NaN}return r}const H3="time function args must be integers",q3="timestamp month out of range";function G2(s){return Number.isFinite(s)?(new Date(s).getUTCDay()+6)%7+1:NaN}function Y2(s,e){if(!Number.isFinite(s))return NaN;const t=new Date(s);switch(e){case"year":return t.getUTCFullYear();case"month":return t.getUTCMonth()+1;case"hour":return t.getUTCHours();case"minute":return t.getUTCMinutes();default:return t.getUTCSeconds()}}function P0(s){if(!Number.isFinite(s)||!Number.isInteger(s))throw new Pt(H3)}function rk(s){for(let e=0;e<s.length;e++){const t=s[e];if(Number.isFinite(t)&&!Number.isInteger(t))throw new Pt(H3)}}function U3(s,e,t,n,o,r){if(P0(s),P0(e),P0(t),P0(n),P0(o),P0(r),e<1||e>12)throw new Pt(q3);return Date.UTC(s,e-1,t,n,o,r)}function G3(s){var n,o;const e=(n=s.scalars)==null?void 0:n.__bardurationms;if(Number.isFinite(e)&&e>0)return e;const t=(o=s.series)==null?void 0:o.time;if(t&&t.length>1)for(let r=t.length-1;r>0;r--){const a=t[r],l=t[r-1];if(!Number.isFinite(a)||!Number.isFinite(l))continue;const c=a-l;if(Number.isFinite(c)&&c>0)return c}return 0}function Y3(s){var t;const e=(t=s.scalars)==null?void 0:t.__nowms;return Number.isFinite(e)?e:Date.now()}const Jy="session.isin session must be in HHMM-HHMM",K2="session.isin time must be a number",ak=new Map;function K3(s){const e=String(s||"").trim(),t=ak.get(e);if(t)return t;const n=e.match(/^(\d{2})(\d{2})-(\d{2})(\d{2})$/);if(!n)throw new Pt(Jy);const o=Number(n[1]),r=Number(n[2]),a=Number(n[3]),l=Number(n[4]);if(![o,r,a,l].every(Number.isFinite)||o<0||o>23||a<0||a>23||r<0||r>59||l<0||l>59)throw new Pt(Jy);const c=o*60+r,f=a*60+l,u={start:c,end:f};return ak.set(e,u),u}function X2(s){const e=new Date(s);return e.getUTCHours()*60+e.getUTCMinutes()}function Z2(s,e,t){return e<=t?s>=e&&s<=t:s>=e||s<=t}function Wn(s,e){if(s.kind==="series")return s.value;const t=new Float32Array(e.length);return t.fill(s.value),t}function di(s){if(s.kind==="scalar")return s.value;const e=s.value;return e.length?e[e.length-1]:NaN}function i1(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++)n[o]=e(s[o]);return n}function ry(s,e,t){const n=s.length,o=new Float32Array(n);for(let r=0;r<n;r++)o[r]=t(s[r],e[r]);return o}const lE="unsafe division: divisor is 0/na",R0="math domain error: sqrt/log/pow/asin/acos",X3="ternary branches must both be numeric or both non-numeric",C1="history index must be integer >= 0",Z3="array index must be integer >= 0",cE="array index must be an integer",uE="Negative array index not allowed",dE="array.set index must be within array size",J3="array.push value must be a string",fE="condition is na; treated as false",Qy="condition must be bool or number",pE="math.mod divisor is 0/na",hE="math.fmod divisor is 0/na",mE="atr length must be integer >= 1",Q3="williamsr length must be integer >= 1",eS="aroon length must be integer >= 1",tS="dmi length must be integer >= 1",sS="dmi smoothing must be integer >= 1",nS="adx length must be integer >= 1",oS="plus_di length must be integer >= 1",iS="minus_di length must be integer >= 1",rS="dx length must be integer >= 1",aS="aroonosc length must be integer >= 1",lS="highest length must be integer >= 1",cS="lowest length must be integer >= 1",uS="sum length must be integer >= 1",dS="rising length must be integer >= 1",fS="falling length must be integer >= 1",eb="valuewhen occurrence must be integer >= 0",vE=new Set(["syminfo","strategy","barstate","timeframe"]),m_=s=>{const e=[];let t=s;for(;t.kind==="MemberExpression";)e.unshift(t.property.name),t=t.object;if(t.kind!=="Identifier")return null;const n=t.name.toLowerCase();return vE.has(n)?[n,...e].join("_"):null},B0=s=>Number.isFinite(s)?s===0?0:1:NaN,J2=s=>{const e=B0(s);return Number.isFinite(e)?e===0?1:0:NaN},$_=(s,e)=>{const t=B0(s);if(t===0)return 0;const n=B0(e);return t===1?n:n===0?0:Number.isFinite(n)?NaN:NaN},D_=(s,e)=>{const t=B0(s);if(t===1)return 1;const n=B0(e);return t===0?n:n===1?1:Number.isFinite(n)?NaN:NaN},Dg=(s,e,t)=>Number.isFinite(s)?s!==0:(e&&t&&e.emitOnce(t,fE),!1),Q2=(s,e,t)=>Dg(s,e==null?void 0:e.diagnostics,t),Bd=(s,e,t)=>{var n;(n=s==null?void 0:s.diagnostics)==null||n.emitOnce(e,t)},gE=s=>Number.isFinite(s)&&Math.floor(s)===s,yb=s=>s===">"||s==="<"||s===">="||s==="<="||s==="=="||s==="!=",p_=(s,e,t,n)=>t?Number.isFinite(s)?!Number.isFinite(e)||e===0?(Bd(n,"div_zero",lE),NaN):s/e:NaN:e===0?NaN:s/e,pS=(s,e,t,n)=>t&&(!Number.isFinite(s)||!Number.isFinite(e)||e===0)?(Bd(n,"fmod_div_zero",hE),NaN):s%e,hS=(s,e,t,n)=>t&&(!Number.isFinite(s)||!Number.isFinite(e)||e===0)?(Bd(n,"mod_div_zero",pE),NaN):(s%e+e)%e,ex=(s,e,t,n)=>{if(!t)return Math.pow(s,e);if(!Number.isFinite(s)||!Number.isFinite(e))return Bd(n,"math_domain",R0),NaN;if(s<0&&!gE(e))return Bd(n,"math_domain",R0),NaN;const o=Math.pow(s,e);return Number.isFinite(o)?o:(Bd(n,"math_domain",R0),NaN)},mS=(s,e,t)=>e&&(!Number.isFinite(s)||s<0)?(Bd(t,"math_domain",R0),NaN):Math.sqrt(s),vS=(s,e,t)=>{if(!e)return Math.log(s);if(!Number.isFinite(s)||s<=0)return Bd(t,"math_domain",R0),NaN;const n=Math.log(s);return Number.isFinite(n)?n:NaN},gS=(s,e,t)=>{if(!e)return Math.log10(s);if(!Number.isFinite(s)||s<=0)return Bd(t,"math_domain",R0),NaN;const n=Math.log10(s);return Number.isFinite(n)?n:NaN},_S=(s,e,t)=>e&&(!Number.isFinite(s)||s<-1||s>1)?(Bd(t,"math_domain",R0),NaN):Math.asin(s),yS=(s,e,t)=>e&&(!Number.isFinite(s)||s<-1||s>1)?(Bd(t,"math_domain",R0),NaN):Math.acos(s),bS=(s,e)=>{if(!e)return Math.tan(s);if(!Number.isFinite(s))return NaN;const t=Math.tan(s);return Number.isFinite(t)?t:NaN},xS=(s,e)=>{if(!e)return Math.exp(s);if(!Number.isFinite(s))return NaN;const t=Math.exp(s);return Number.isFinite(t)?t:NaN},N0=(s,e,t,n)=>!Number.isFinite(s)||!Number.isInteger(s)||s<0?(Bd(n,e,t),NaN):s,tb=(s,e,t)=>!Number.isFinite(s)||!Number.isInteger(s)?(Bd(t,`${e}:int`,cE),NaN):s<0?(Bd(t,`${e}:neg`,uE),NaN):s,tx=(s,e,t,n)=>{const o=tb(s,t,n);return!Number.isFinite(o)||!Number.isFinite(e)?0:o>=e?(Bd(n,`${t}:oob`,dE),0):1},eh=(s,e,t,n)=>!Number.isFinite(s)||!Number.isInteger(s)||s<1?(Bd(n,e,t),NaN):s,tv=s=>{const e=new Float32Array(s);return e.fill(NaN),e},_E=new Set(["tostring","format","upper","lower","trim","replace","replace_all","contains","startswith","endswith","length","substring","repeat"]),yE=new Set(["tostring","format","upper","lower","trim","replace","replace_all","substring","repeat"]),lk=new WeakMap,jd=s=>{const e=lk.get(s);if(e)return e;let t="";switch(s.kind){case"NumberLiteral":t=`n:${s.value}`;break;case"StringLiteral":t=`s:${s.value}`;break;case"Identifier":t=`id:${s.name}`;break;case"UnaryExpression":t=`u:${s.operator}:${jd(s.expr)}`;break;case"BinaryExpression":t=`b:${s.operator}:${jd(s.left)}:${jd(s.right)}`;break;case"CallExpression":t=`c:${s.callee}:${s.args.map(jd).join(",")}`;break;case"MemberExpression":t=`m:${jd(s.object)}:${s.property.name}`;break;case"IndexExpression":t=`i:${jd(s.object)}:${jd(s.index)}`;break;default:t="expr"}return lk.set(s,t),t},t0=s=>{switch(s.kind){case"Identifier":return s.name;case"NumberLiteral":return Number.isFinite(s.value)?String(s.value):"na";case"StringLiteral":return JSON.stringify(s.value);case"MemberExpression":return`${t0(s.object)}.${s.property.name}`;case"IndexExpression":return`${t0(s.object)}[${t0(s.index)}]`;case"CallExpression":return`${s.callee}(${s.args.map(t0).join(", ")})`;case"UnaryExpression":return`${s.operator} ${t0(s.expr)}`;case"BinaryExpression":return`${t0(s.left)} ${s.operator} ${t0(s.right)}`;default:return"expr"}},Rx=(s,e)=>{Bd(s,`member:${jd(e)}`,`Unsupported member access: ${t0(e)}`)},jx=(s,e)=>{Bd(s,`index:${jd(e)}`,`Unsupported indexing: ${t0(e)}`)},ck=new WeakMap,dg=s=>{const e=ck.get(s);if(e!=null)return e;let t=!1;switch(s.kind){case"StringLiteral":t=!0;break;case"CallExpression":{const n=s.callee.toLowerCase();if(yE.has(n)){t=!0;break}(n==="iff"||n==="iif"||n==="if")&&s.args.length===3&&(t=dg(s.args[1])||dg(s.args[2]));break}default:t=!1}return ck.set(s,t),t},F0=(s,e,t)=>`cond:${e!=null&&e.selfKey?e.selfKey:"cond"}:${jd(s)}:${t}`,bE=(s,e)=>{let t=!1;const n=o=>{if(!t)switch(o.kind){case"Identifier":{const r=o.name.replace(/\s+/g,"_").toLowerCase();e.series[r]&&(t=!0);return}case"MemberExpression":{const r=m_(o);if(r){const a=r.replace(/\s+/g,"_").toLowerCase();e.series[a]&&(t=!0);return}n(o.object);return}case"IndexExpression":n(o.object),n(o.index);return;case"UnaryExpression":n(o.expr);return;case"BinaryExpression":n(o.left),n(o.right);return;case"CallExpression":o.args.forEach(r=>n(r));return;default:return}};return n(s),t},z_=s=>{switch(s.kind){case"StringLiteral":return"nonNumeric";case"NumberLiteral":return"numeric";case"Identifier":{const e=s.name.replace(/\s+/g,"_").toLowerCase();return e==="true"||e==="false"?"nonNumeric":"numeric"}case"MemberExpression":{const e=m_(s);if(e){const t=e.replace(/\s+/g,"_").toLowerCase();if(t==="true"||t==="false")return"nonNumeric"}return"numeric"}case"IndexExpression":return"numeric";case"UnaryExpression":return s.operator==="not"?"nonNumeric":"numeric";case"BinaryExpression":return yb(s.operator)||s.operator==="and"||s.operator==="or"?"nonNumeric":"numeric";case"CallExpression":{const e=s.callee.toLowerCase();if((e==="iff"||e==="iif"||e==="if")&&s.args.length===3){const t=z_(s.args[1]),n=z_(s.args[2]);return t===n?t:"numeric"}return _E.has(e)?"nonNumeric":"numeric"}default:return"numeric"}};function wS(s,e,t,n){var p;const o=e.kind==="series",r=t.kind==="series",a=((p=n.scalars)==null?void 0:p.__pinev2)===1,l=a&&yb(s),c=v=>Number.isFinite(v)&&v!==0;if(!o&&!r){const v=e.value,x=t.value;if(l&&(!Number.isFinite(v)||!Number.isFinite(x)))return{kind:"scalar",value:NaN};switch(s){case"+":return{kind:"scalar",value:v+x};case"-":return{kind:"scalar",value:v-x};case"*":return{kind:"scalar",value:v*x};case"/":return{kind:"scalar",value:p_(v,x,a,n)};case"%":return{kind:"scalar",value:x===0?NaN:v%x};case">":return{kind:"scalar",value:Number.isFinite(v)&&Number.isFinite(x)&&v>x?1:0};case"<":return{kind:"scalar",value:Number.isFinite(v)&&Number.isFinite(x)&&v<x?1:0};case">=":return{kind:"scalar",value:Number.isFinite(v)&&Number.isFinite(x)&&v>=x?1:0};case"<=":return{kind:"scalar",value:Number.isFinite(v)&&Number.isFinite(x)&&v<=x?1:0};case"==":return{kind:"scalar",value:Number.isFinite(v)&&Number.isFinite(x)&&Math.abs(v-x)<1e-9?1:0};case"!=":return{kind:"scalar",value:Number.isFinite(v)&&Number.isFinite(x)&&Math.abs(v-x)>=1e-9?1:0};case"and":return{kind:"scalar",value:a?$_(v,x):c(v)&&c(x)?1:0};case"or":return{kind:"scalar",value:a?D_(v,x):c(v)||c(x)?1:0}}}const f=Wn(e,n),u=Wn(t,n),d=n.length,h=new Float32Array(d);for(let v=0;v<d;v++){const x=f[v],S=u[v];if(l&&(!Number.isFinite(x)||!Number.isFinite(S))){h[v]=NaN;continue}switch(s){case"+":h[v]=x+S;break;case"-":h[v]=x-S;break;case"*":h[v]=x*S;break;case"/":h[v]=p_(x,S,a,n);break;case"%":h[v]=S===0?NaN:x%S;break;case">":h[v]=Number.isFinite(x)&&Number.isFinite(S)&&x>S?1:0;break;case"<":h[v]=Number.isFinite(x)&&Number.isFinite(S)&&x<S?1:0;break;case">=":h[v]=Number.isFinite(x)&&Number.isFinite(S)&&x>=S?1:0;break;case"<=":h[v]=Number.isFinite(x)&&Number.isFinite(S)&&x<=S?1:0;break;case"==":h[v]=Number.isFinite(x)&&Number.isFinite(S)&&Math.abs(x-S)<1e-9?1:0;break;case"!=":h[v]=Number.isFinite(x)&&Number.isFinite(S)&&Math.abs(x-S)>=1e-9?1:0;break;case"and":h[v]=a?$_(x,S):c(x)&&c(S)?1:0;break;case"or":h[v]=a?D_(x,S):c(x)||c(S)?1:0;break}}return{kind:"series",value:h}}function xE(s,e){var f;if(!(((f=e.scalars)==null?void 0:f.__pinev2)===1)||s.operator!=="and"&&s.operator!=="or")return wS(s.operator,ug(s.left,e),ug(s.right,e),e);const n=ug(s.left,e),o=s.operator;if(n.kind==="scalar"){const u=B0(n.value);if(o==="and"&&u===0)return{kind:"scalar",value:0};if(o==="or"&&u===1)return{kind:"scalar",value:1};const d=ug(s.right,e);if(d.kind==="scalar")return{kind:"scalar",value:o==="and"?$_(u,d.value):D_(u,d.value)};const h=Wn(d,e),p=new Float32Array(h.length);for(let v=0;v<h.length;v++){const x=h[v];p[v]=o==="and"?$_(u,x):D_(u,x)}return{kind:"series",value:p}}const r=Wn(n,e),a=r.length,l=new Float32Array(a),c={series:e.series,scalars:e.scalars,strings:e.strings,draw:e.draw,diagnostics:e.diagnostics,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime,length:a,index:0};for(let u=0;u<a;u++){const d=r[u],h=B0(d);if(o==="and"&&h===0){l[u]=0;continue}if(o==="or"&&h===1){l[u]=1;continue}c.index=u;const p=_r(s.right,c);l[u]=o==="and"?$_(d,p):D_(d,p)}return{kind:"series",value:l}}function Lm(s,e){const t=s.length,n=new Float32Array(t);let o=0,r=0;for(let a=0;a<t;a++){const l=s[a];if(Number.isFinite(l)&&(o+=l,r+=1),a>=e){const c=s[a-e];Number.isFinite(c)&&(o-=c,r-=1)}a>=e-1?n[a]=r>0?o/r:NaN:n[a]=NaN}return n}function gh(s,e){const t=s.length,n=new Float32Array(t),o=2/(e+1);let r;for(let a=0;a<t;a++){const l=s[a];if(!Number.isFinite(l)){n[a]=r===void 0?NaN:r;continue}if(r===void 0||!Number.isFinite(r)){r=l,n[a]=l;continue}r=l*o+r*(1-o),n[a]=r}return n}function Bx(s,e,t){const n=s.length,o=new Float32Array(n);let r=NaN;for(let a=0;a<n;a++){const l=s[a],c=e[a],f=t[a];let u=Math.max(0,l-c);Number.isFinite(r)&&(u=Math.max(u,Math.abs(l-r),Math.abs(c-r))),o[a]=u,r=f}return o}function M_(s,e){const t=s.length,n=new Float32Array(t);let o,r=0,a=0;for(let l=0;l<t;l++){const c=s[l];if(o===void 0){if(Number.isFinite(c)&&(r+=c,a+=1),a<e){n[l]=NaN;continue}o=r/e,n[l]=o;continue}Number.isFinite(c)&&(o=(o*(e-1)+c)/e),n[l]=o}return n}function kS(s,e){const t=s.length,n=new Float32Array(t);let o,r=0,a=0,l=!1;const c=[],f=[];for(let u=0;u<t;u++){const d=s[u];if(!Number.isFinite(d)){n[u]=NaN;continue}if(o===void 0){o=d,n[u]=NaN;continue}if(!Number.isFinite(o)){o=d,n[u]=NaN;continue}const h=d-o;o=d;const p=h>0?h:0,v=h<0?-h:0;if(l)r=(r*(e-1)+p)/e,a=(a*(e-1)+v)/e;else{c.push(p),f.push(v);const x=c.length,S=Math.max(1,Math.min(e,x));r=c.reduce((C,I)=>C+I,0)/S,a=f.reduce((C,I)=>C+I,0)/S,x>=e&&(l=!0)}if(a===0)n[u]=100;else{const x=r/a;n[u]=100-100/(1+x)}}return n}function Ox(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=0,a=0;for(let f=o-e+1;f<=o;f++){const u=s[f];Number.isFinite(u)&&(r+=u,a+=1)}if(a<2){n[o]=NaN;continue}const l=r/a;let c=0;for(let f=o-e+1;f<=o;f++){const u=s[f];if(!Number.isFinite(u))continue;const d=u-l;c+=d*d}n[o]=Math.sqrt(c/a)}return n}function Ty(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=s[o-l],f=e-l;Number.isFinite(c)&&(r+=c*f,a+=f)}n[o]=a>0?r/a:NaN}return n}function wE(s,e){const t=gh(s,e),n=gh(t,e),o=s.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=t[a],c=n[a];r[a]=Number.isFinite(l)&&Number.isFinite(c)?2*l-c:NaN}return r}function kE(s,e){const t=gh(s,e),n=gh(t,e),o=gh(n,e),r=s.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=t[l],f=n[l],u=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&Number.isFinite(u)?3*c-3*f+u:NaN}return a}function SE(s,e){const t=Math.ceil((e+1)/2),n=Math.floor((e+1)/2);return Lm(Lm(s,t),n)}function CE(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=0,a=0;for(let l=0;l<e;l++){const c=s[o-l];if(!Number.isFinite(c))continue;const f=Math.min(l+1,e-l);r+=c*f,a+=f}n[o]=a>0?r/a:NaN}return n}function IE(s,e){const t=Math.max(1,Math.floor(e/2)),n=Math.max(1,Math.round(Math.sqrt(e))),o=Ty(s,t),r=Ty(s,e),a=s.length,l=new Float32Array(a);for(let c=0;c<a;c++){const f=o[c],u=r[c];l[c]=Number.isFinite(f)&&Number.isFinite(u)?2*f-u:NaN}return Ty(l,n)}function PE(s,e,t,n){const o=s.length,r=new Float32Array(o),a=2/(t+1),l=2/(n+1);let c=NaN;for(let f=0;f<o;f++){const u=s[f];if(!Number.isFinite(u)||f<e){r[f]=NaN;continue}const d=s[f-e];if(!Number.isFinite(d)){r[f]=NaN;continue}let h=0,p=!0;for(let C=f-e+1;C<=f;C++){const I=s[C],A=s[C-1];if(!Number.isFinite(I)||!Number.isFinite(A)){p=!1;break}h+=Math.abs(I-A)}if(!p||h===0){r[f]=NaN;continue}const x=Math.abs(u-d)/h,S=Math.pow(x*(a-l)+l,2);Number.isFinite(c)||(c=u),c=c+S*(u-c),r[f]=c}return r}function ME(s,e,t,n){const o=s.length,r=new Float32Array(o),a=t*(e-1),l=e/n,c=[];for(let f=0;f<e;f++){const u=Math.exp(-((f-a)*(f-a))/(2*l*l));c.push(u)}for(let f=0;f<o;f++){if(f<e-1){r[f]=NaN;continue}let u=0,d=0;for(let h=0;h<e;h++){const p=s[f-e+1+h];if(!Number.isFinite(p))continue;const v=c[h];u+=p*v,d+=v}r[f]=d>0?u/d:NaN}return r}function NE(s,e,t){const n=gh(s,e),o=gh(n,e),r=gh(o,e),a=gh(r,e),l=gh(a,e),c=gh(l,e),f=t,u=f*f,d=u*f,h=-d,p=3*u+3*d,v=-6*u-3*f-3*d,x=1+3*f+d+3*u,S=s.length,C=new Float32Array(S);for(let I=0;I<S;I++){const A=r[I],P=l[I],T=c[I],j=a[I];C[I]=Number.isFinite(A)&&Number.isFinite(j)&&Number.isFinite(P)&&Number.isFinite(T)?h*T+p*P+v*j+x*A:NaN}return C}function zx(s,e,t,n){const o=Bx(s,e,t),r=o.length,a=new Float32Array(r);let l=0;for(let c=0;c<r;c++)l+=o[c],c===n-1?a[c]=l/n:c>=n?a[c]=(a[c-1]*(n-1)+o[c])/n:a[c]=NaN;return a}function AE(s,e,t,n){const o=zx(s,e,t,n),r=o.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=o[l],f=t[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&f!==0?c/f*100:NaN}return a}function TE(s,e){const t=s.length,n=new Float32Array(t),o=[],r=[];for(let a=0;a<t;a++){const l=s[a],c=a>0?s[a-1]:NaN;if(!Number.isFinite(l)||!Number.isFinite(c))o.push(0),r.push(0);else{const h=l-c;o.push(h>0?h:0),r.push(h<0?-h:0)}if(a<e){n[a]=NaN;continue}let f=0,u=0;for(let h=a-e+1;h<=a;h++)f+=o[h],u+=r[h];const d=f+u;n[a]=d===0?NaN:100*(f-u)/d}return n}function FE(s,e,t){const n=s.length,o=new Float32Array(n);for(let d=0;d<n;d++){const h=s[d],p=d>0?s[d-1]:NaN;o[d]=Number.isFinite(h)&&Number.isFinite(p)?h-p:NaN}const r=gh(o,e),a=gh(r,t),l=new Float32Array(n);for(let d=0;d<n;d++)l[d]=Math.abs(o[d]);const c=gh(l,e),f=gh(c,t),u=new Float32Array(n);for(let d=0;d<n;d++){const h=a[d],p=f[d];u[d]=Number.isFinite(h)&&Number.isFinite(p)&&p!==0?100*h/p:NaN}return u}function LE(s,e,t,n){const o=kS(s,e),r=V_(o,e),a=W_(o,e),l=s.length,c=new Float32Array(l);for(let u=0;u<l;u++){const d=o[u],h=r[u],p=a[u],v=h-p;c[u]=Number.isFinite(d)&&Number.isFinite(v)&&v!==0?(d-p)/v*100:NaN}let f=c;return t&&t>1&&(f=Lm(f,t)),n&&n>1&&(f=Lm(f,n)),f}function EE(s,e,t){const n=gh(s,e),o=gh(s,t),r=s.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=n[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&f!==0?(c-f)/f*100:NaN}return a}function $E(s,e){const t=s.length,n=new Float32Array(t);for(let l=0;l<t;l++)n[l]=(s[l]+e[l])/2;const o=Lm(n,5),r=Lm(n,34),a=new Float32Array(t);for(let l=0;l<t;l++){const c=o[l],f=r[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?c-f:NaN}return a}function DE(s,e){const t=gh(s,e),n=gh(t,e),o=gh(n,e),r=s.length,a=new Float32Array(r);a[0]=NaN;for(let l=1;l<r;l++){const c=o[l-1],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&c!==0?(f/c-1)*100:NaN}return a}function RE(s,e){const t=Lm(s,e),n=Ox(s,e),o=s.length,r=new Float32Array(o);for(let a=0;a<o;a++){const l=t[a],c=n[a],f=s[a];r[a]=Number.isFinite(f)&&Number.isFinite(l)&&Number.isFinite(c)&&c!==0?(f-l)/c:NaN}return r}function jE(s,e,t,n){const o=t.length,r=new Float32Array(o);let a=0;for(let l=0;l<o;l++){const c=s[l],f=e[l],u=t[l],d=n[l];if(!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)){r[l]=NaN;continue}const h=c-f,p=Number.isFinite(h)&&h!==0?(2*u-c-f)/h:0;Number.isFinite(d)&&(a+=p*d),r[l]=a}return r}function BE(s,e,t,n,o){const r=t.length,a=new Float32Array(r);for(let u=0;u<r;u++){const d=s[u],h=e[u],p=t[u],v=n[u];if(!Number.isFinite(d)||!Number.isFinite(h)||!Number.isFinite(p)){a[u]=NaN;continue}const x=d-h,S=Number.isFinite(x)&&x!==0?(2*p-d-h)/x:0;a[u]=Number.isFinite(v)?S*v:NaN}const l=ov(a,o),c=ov(n,o),f=new Float32Array(r);for(let u=0;u<r;u++){const d=l[u],h=c[u];f[u]=Number.isFinite(d)&&Number.isFinite(h)&&h!==0?d/h:NaN}return f}function OE(s,e,t,n,o){const r=t.length,a=zx(s,e,t,n),l=new Float32Array(r),c=new Float32Array(r);let f=NaN,u=NaN,d=!0;for(let h=0;h<r;h++){const p=s[h],v=e[h],x=t[h],S=a[h];if(!Number.isFinite(p)||!Number.isFinite(v)||!Number.isFinite(S)){l[h]=NaN,c[h]=NaN;continue}const C=(p+v)/2,I=C+o*S,A=C-o*S;if(f=Number.isFinite(f)?Math.min(I,f):I,u=Number.isFinite(u)?Math.max(A,u):A,!Number.isFinite(x)){l[h]=NaN,c[h]=NaN;continue}d?x<u?(d=!1,f=I,l[h]=f,c[h]=-1):(l[h]=u,c[h]=1):x>f?(d=!0,u=A,l[h]=u,c[h]=1):(l[h]=f,c[h]=-1)}return{line:l,dir:c}}function zE(s,e,t,n,o){const r=gh(t,n),a=zx(s,e,t,n),l=t.length,c=new Float32Array(l),f=new Float32Array(l);for(let u=0;u<l;u++){const d=r[u],h=a[u];c[u]=Number.isFinite(d)&&Number.isFinite(h)?d+o*h:NaN,f[u]=Number.isFinite(d)&&Number.isFinite(h)?d-o*h:NaN}return{mid:r,upper:c,lower:f}}function VE(s,e,t){const n=V_(s,t),o=W_(e,t),r=s.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=n[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)?(c+f)/2:NaN}return{upper:n,lower:o,mid:a}}function WE(s,e,t,n,o){const r=s.length,a=new Float32Array(r);if(!r)return a;let l=!0;r>1&&Number.isFinite(s[1])&&Number.isFinite(s[0])&&(l=s[1]>=s[0]);let c=t,f=l?s[0]:e[0],u=l?e[0]:s[0];a[0]=u;for(let d=1;d<r;d++){const h=s[d],p=e[d];if(!Number.isFinite(h)||!Number.isFinite(p)){a[d]=NaN;continue}if(u=u+c*(f-u),l){const v=e[d-1],x=d>1?e[d-2]:v;Number.isFinite(v)&&(u=Math.min(u,v)),Number.isFinite(x)&&(u=Math.min(u,x)),p<u?(l=!1,u=f,f=p,c=t):h>f&&(f=h,c=Math.min(c+n,o))}else{const v=s[d-1],x=d>1?s[d-2]:v;Number.isFinite(v)&&(u=Math.max(u,v)),Number.isFinite(x)&&(u=Math.max(u,x)),h>u?(l=!0,u=f,f=h,c=t):p<f&&(f=p,c=Math.min(c+n,o))}a[d]=u}return a}function HE(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=0,a=0,l=!0;for(let c=0;c<e;c++){const f=s[o-c];if(!Number.isFinite(f)){l=!1;break}const u=c+1;r+=f,a+=f*u}if(!l||r===0){n[o]=NaN;continue}n[o]=-(a/r)+(e+1)/2}return n}function qE(s,e,t,n,o,r){const a=V_(s,n),l=W_(e,n),c=t.length,f=new Float32Array(c);for(let p=0;p<c;p++){const v=t[p],x=a[p],S=l[p],C=x-S;f[p]=Number.isFinite(v)&&Number.isFinite(x)&&Number.isFinite(S)&&C!==0?(v-S)/C*100:NaN}const u=Lm(f,o),d=Lm(u,r),h=new Float32Array(c);for(let p=0;p<c;p++){const v=u[p],x=d[p];h[p]=Number.isFinite(v)&&Number.isFinite(x)?3*v-2*x:NaN}return{k:u,d,j:h}}function UE(s,e,t,n,o,r,a,l,c,f){const u=h1(s,e),d=h1(s,t),h=h1(s,n),p=h1(s,o),v=Lm(u,r),x=Lm(d,a),S=Lm(h,l),C=Lm(p,c),I=s.length,A=new Float32Array(I);for(let T=0;T<I;T++){const j=v[T],E=x[T],L=S[T],D=C[T];A[T]=Number.isFinite(j)&&Number.isFinite(E)&&Number.isFinite(L)&&Number.isFinite(D)?j+2*E+3*L+4*D:NaN}const P=Lm(A,f);return{kst:A,signal:P}}function GE(s,e,t,n,o,r){const a=t.length,l=new Float32Array(a),c=new Float32Array(a);let f=NaN;for(let C=0;C<a;C++){const I=s[C],A=e[C],P=t[C];if(!Number.isFinite(I)||!Number.isFinite(A)||!Number.isFinite(P)){l[C]=NaN,c[C]=NaN,f=P;continue}const T=Math.min(A,Number.isFinite(f)?f:A),j=Math.max(I,Number.isFinite(f)?f:I);l[C]=P-T,c[C]=j-T,f=P}const u=ov(l,n),d=ov(l,o),h=ov(l,r),p=ov(c,n),v=ov(c,o),x=ov(c,r),S=new Float32Array(a);for(let C=0;C<a;C++){const I=u[C],A=d[C],P=h[C],T=p[C],j=v[C],E=x[C];if(!Number.isFinite(I)||!Number.isFinite(A)||!Number.isFinite(P)||!Number.isFinite(T)||!Number.isFinite(j)||!Number.isFinite(E)||T===0||j===0||E===0){S[C]=NaN;continue}const L=I/T,D=A/j,X=P/E;S[C]=100*(4*L+2*D+X)/7}return S}function YE(s,e,t){const n=Lm(s,e),o=Ox(s,e),r=s.length,a=new Float32Array(r);for(let l=0;l<r;l++){const c=n[l],f=o[l];a[l]=Number.isFinite(c)&&Number.isFinite(f)&&c!==0?2*t*f/c:NaN}return a}function KE(s,e,t){const n=s.length,o=new Float32Array(n);let r=t;o[0]=r;for(let a=1;a<n;a++){const l=s[a],c=s[a-1],f=e[a],u=e[a-1];if(!Number.isFinite(l)||!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)||c===0){o[a]=r;continue}f>u&&(r=r+(l-c)/c*r),o[a]=r}return o}function XE(s,e,t){const n=s.length,o=new Float32Array(n);let r=t;o[0]=r;for(let a=1;a<n;a++){const l=s[a],c=s[a-1],f=e[a],u=e[a-1];if(!Number.isFinite(l)||!Number.isFinite(c)||!Number.isFinite(f)||!Number.isFinite(u)||c===0){o[a]=r;continue}f<u&&(r=r+(l-c)/c*r),o[a]=r}return o}function ZE(s,e,t,n){const o=t.length,r=new Float32Array(o),a=new Float32Array(o);for(let p=0;p<o;p++){if(p===0){r[p]=NaN,a[p]=NaN;continue}const v=s[p],x=e[p],S=s[p-1],C=e[p-1];r[p]=Number.isFinite(v)&&Number.isFinite(C)?Math.abs(v-C):NaN,a[p]=Number.isFinite(x)&&Number.isFinite(S)?Math.abs(x-S):NaN}const l=Bx(s,e,t),c=ov(r,n),f=ov(a,n),u=ov(l,n),d=new Float32Array(o),h=new Float32Array(o);for(let p=0;p<o;p++){const v=c[p],x=f[p],S=u[p];d[p]=Number.isFinite(v)&&Number.isFinite(S)&&S!==0?v/S:NaN,h[p]=Number.isFinite(x)&&Number.isFinite(S)&&S!==0?x/S:NaN}return{plus:d,minus:h}}function V_(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){let r=-1/0,a=!1;const l=Math.max(0,o-e+1);for(let c=l;c<=o;c++){const f=s[c];Number.isFinite(f)&&(a=!0,f>r&&(r=f))}n[o]=a?r:NaN}return n}function W_(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){let r=1/0,a=!1;const l=Math.max(0,o-e+1);for(let c=l;c<=o;c++){const f=s[c];Number.isFinite(f)&&(a=!0,f<r&&(r=f))}n[o]=a?r:NaN}return n}function SS(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=-1/0,a=NaN;for(let l=0;l<e;l++){const c=o-l,f=s[c];Number.isFinite(f)&&f>r&&(r=f,a=l)}n[o]=Number.isFinite(a)?a:NaN}return n}function CS(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=1/0,a=NaN;for(let l=0;l<e;l++){const c=o-l,f=s[c];Number.isFinite(f)&&f<r&&(r=f,a=l)}n[o]=Number.isFinite(a)?a:NaN}return n}function JE(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){if(o<e-1){n[o]=NaN;continue}let r=0,a=0,l=0;const c=o-e+1;for(let d=c;d<=o;d++){const h=s[d];Number.isFinite(h)&&(r+=h,a+=h*h,l+=1)}if(l<2){n[o]=NaN;continue}const f=r/l,u=a/l-f*f;n[o]=Number.isFinite(u)?u:NaN}return n}function QE(s,e,t){const n=s.length,o=new Float32Array(n);for(let r=0;r<n;r++){if(r<t-1){o[r]=NaN;continue}let a=0,l=0,c=0,f=0,u=0,d=0;const h=r-t+1;for(let A=h;A<=r;A++){const P=s[A],T=e[A];!Number.isFinite(P)||!Number.isFinite(T)||(a+=P,l+=T,c+=P*P,f+=T*T,u+=P*T,d+=1)}if(d<2){o[r]=NaN;continue}const p=a/d,v=l/d,x=u/d-p*v,S=c/d-p*p,C=f/d-v*v,I=Math.sqrt(S*C);o[r]=I>0?x/I:NaN}return o}function e$(s,e,t){const n=s.length,o=new Float32Array(n),r=Math.max(1,Math.floor(e)),a=Math.floor(t),l=(r-1)*r/2,c=(r-1)*r*(2*r-1)/6,f=r*c-l*l;for(let u=0;u<n;u++){if(u<r-1||f===0){o[u]=NaN;continue}let d=0,h=0,p=0;for(let C=0;C<r;C++){const I=u-(r-1-C),A=s[I];Number.isFinite(A)&&(d+=A,h+=A*C,p+=1)}if(p<2){o[u]=NaN;continue}const v=(r*h-l*d)/f,x=(d-v*l)/r,S=r-1+a;o[u]=x+v*S}return o}function IS(s,e){var f;const t=e.funcRuntime;if(t){const u=t.funcs.get(s.callee.toLowerCase());if(u){const d=e.length,h=new Float32Array(d),p={series:e.series,scalars:e.scalars,strings:e.strings,diagnostics:e.diagnostics,draw:e.draw,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime,length:d,index:0};for(let v=0;v<d;v++)p.index=v,h[v]=MS(u,s,p);return{kind:"series",value:h}}}const n=((f=e.scalars)==null?void 0:f.__pinev2)===1,o=Hx(s.callee.toLowerCase(),n),r=Wx(o);if(r){if(!e.draw)return{kind:"scalar",value:NaN};const u=s.args[0];let d="";if(u&&u.kind==="Identifier"&&(d=u.name),u&&u.kind==="StringLiteral"&&(d=u.value),!d)return{kind:"scalar",value:NaN};const h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++){const x=e.draw.get(r.kind,r.prop,d,v);typeof x=="string"?p[v]=Em(x):typeof x=="number"&&Number.isFinite(x)?p[v]=x:p[v]=NaN}return{kind:"series",value:p}}const a=s.args.map(u=>ug(u,e)),l=NS(o);if(l){if(!e.strategy)return{kind:"scalar",value:NaN};if(!a.length)throw new Pt(`${s.callee} expects (index)`);const u=Wn(a[0],e),d=e.length,h=new Float32Array(d);for(let p=0;p<d;p++){const v=u[p],x=Number.isFinite(v)?Math.floor(v):NaN;if(!Number.isFinite(x)){h[p]=NaN;continue}h[p]=AS(e,l.kind,l.prop,p,x)}return{kind:"series",value:h}}const c=()=>{if(a.length!==2)throw new Pt(`${o} expects (series, period)`);const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1])));return[u,d]};switch(o){case"__hist_index":case"__arr_index":{if(a.length!==1)throw new Pt(`${s.callee} expects (index)`);const u=a[0];if(!n)return u;const d=o==="__hist_index"?"history_index":"array_index",h=o==="__hist_index"?C1:Z3;if(u.kind==="scalar")return{kind:"scalar",value:N0(u.value,d,h,e)};const p=Wn(u,e),v=new Float32Array(e.length);for(let x=0;x<v.length;x++)v[x]=N0(p[x],d,h,e);return{kind:"series",value:v}}case"__arr_index_str":{if(a.length!==1)throw new Pt(`${s.callee} expects (index)`);const u=a[0];if(!n)return u;const d=`arr_idx_str:${jd(s)}`;if(u.kind==="scalar")return{kind:"scalar",value:tb(u.value,d,e)};const h=Wn(u,e),p=new Float32Array(e.length);for(let v=0;v<p.length;v++)p[v]=tb(h[v],d,e);return{kind:"series",value:p}}case"__arr_set_guard":{if(a.length!==2)throw new Pt(`${s.callee} expects (index, size)`);if(!n)return{kind:"scalar",value:1};const u=a[0],d=a[1],h=`arr_set_guard:${jd(s)}`;if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:tx(u.value,d.value,h,e)};const p=Wn(u,e),v=Wn(d,e),x=new Float32Array(e.length);for(let S=0;S<x.length;S++)x[S]=tx(p[S],v[S],h,e);return{kind:"series",value:x}}case"__arr_str_valid":{if(a.length!==1)throw new Pt(`${s.callee} expects (value)`);if(!n)return{kind:"scalar",value:1};const u=dg(s.args[0]);return u||Bd(e,`arr_str_val:${jd(s)}`,J3),{kind:"scalar",value:u?1:0}}case"__str_num":{if(a.length!==1)throw new Pt(`${s.callee} expects (value)`);return a[0]}case"iff":case"iif":case"if":{if(a.length!==3)throw new Pt(`${s.callee} expects (cond, a, b)`);const u=a[0],d=a[1],h=a[2],p=s.args[0];if(n){const L=z_(s.args[1]),D=z_(s.args[2]);if(L!==D){if(Bd(e,"ternary_type",X3),u.kind==="scalar"&&d.kind==="scalar"&&h.kind==="scalar")return{kind:"scalar",value:NaN};const X=new Float32Array(e.length);return X.fill(NaN),{kind:"series",value:X}}}const v=n&&dg(p),x=n?F0(p,e,"na"):void 0;v&&Bd(e,F0(p,e,"type"),Qy);const S=u.kind==="series",C=d.kind==="series",I=h.kind==="series";if(!S&&!C&&!I){const L=u.value;return v?{kind:"scalar",value:h.value}:{kind:"scalar",value:Q2(L,e,x)?d.value:h.value}}const A=Wn(u,e),P=Wn(d,e),T=Wn(h,e),j=e.length,E=new Float32Array(j);for(let L=0;L<j;L++){if(v){E[L]=T[L];continue}const D=A[L],X=Q2(D,e,x);E[L]=X?P[L]:T[L]}return{kind:"series",value:E}}case"nz":{if(a.length<1||a.length>2)throw new Pt("nz expects (series[, fallback])");const u=a[0],d=a[1]??{kind:"scalar",value:0};if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Number.isFinite(u.value)?u.value:d.value};const h=Wn(u,e),p=Wn(d,e),v=e.length,x=new Float32Array(v);for(let S=0;S<v;S++){const C=h[S];x[S]=Number.isFinite(C)?C:p[S]}return{kind:"series",value:x}}case"between":{if(a.length!==3)throw new Pt("between expects (x, a, b)");const u=Wn(a[0],e),d=Wn(a[1],e),h=Wn(a[2],e),p=e.length,v=new Float32Array(p);for(let x=0;x<p;x++){const S=u[x],C=d[x],I=h[x];if(!Number.isFinite(S)||!Number.isFinite(C)||!Number.isFinite(I)){v[x]=n?NaN:0;continue}const A=Math.min(C,I),P=Math.max(C,I);v[x]=S>=A&&S<=P?1:0}return{kind:"series",value:v}}case"above":case"below":{if(a.length<2||a.length>3)throw new Pt(`${o} expects (a, b[, tol])`);const u=Wn(a[0],e),d=Wn(a[1],e),h=a[2]?Wn(a[2],e):null,p=e.length,v=new Float32Array(p);for(let x=0;x<p;x++){const S=u[x],C=d[x],I=h?h[x]:0,A=Number.isFinite(I)?Math.max(0,I):0;if(!Number.isFinite(S)||!Number.isFinite(C)){v[x]=n?NaN:0;continue}v[x]=o==="above"?S>C+A?1:0:S<C-A?1:0}return{kind:"series",value:v}}case"higherhigh":{const u=a.length?Math.max(1,Math.floor(di(a[0]))):1,d=e.series.high;if(!d)throw new Pt("higherhigh requires high series");const h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++){const x=d[v];if(!Number.isFinite(x)){p[v]=n?NaN:0;continue}const S=Math.max(0,v-u),C=j3(d,S,Math.max(0,v-1));p[v]=x>C?1:0}return{kind:"series",value:p}}case"lowerlow":{const u=a.length?Math.max(1,Math.floor(di(a[0]))):1,d=e.series.low;if(!d)throw new Pt("lowerlow requires low series");const h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++){const x=d[v];if(!Number.isFinite(x)){p[v]=n?NaN:0;continue}const S=Math.max(0,v-u),C=B3(d,S,Math.max(0,v-1));p[v]=x<C?1:0}return{kind:"series",value:p}}case"swinghigh":{const u=a.length?Math.max(1,Math.floor(di(a[0]))):3,d=e.series.high;if(!d)throw new Pt("swinghigh requires high series");const h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++){const x=d[v];if(!Number.isFinite(x)){p[v]=n?NaN:0;continue}let S=!0;for(let C=v-u;C<=v+u;C++){if(C===v||C<0||C>=h)continue;const I=d[C];if(Number.isFinite(I)&&I>=x){S=!1;break}}p[v]=S?1:0}return{kind:"series",value:p}}case"swinglow":{const u=a.length?Math.max(1,Math.floor(di(a[0]))):3,d=e.series.low;if(!d)throw new Pt("swinglow requires low series");const h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++){const x=d[v];if(!Number.isFinite(x)){p[v]=n?NaN:0;continue}let S=!0;for(let C=v-u;C<=v+u;C++){if(C===v||C<0||C>=h)continue;const I=d[C];if(Number.isFinite(I)&&I<=x){S=!1;break}}p[v]=S?1:0}return{kind:"series",value:p}}case"volspike":{const u=a.length?Math.max(1,di(a[0])):1,d=e.series.volume;if(!d)throw new Pt("volspike requires volume series");const h=e.length,p=new Float32Array(h),v=20;for(let x=0;x<h;x++){const S=d[x];if(!Number.isFinite(S)){p[x]=n?NaN:0;continue}const C=Math.max(0,x-v+1);let I=0,A=0;for(let T=C;T<=x;T++){const j=d[T];Number.isFinite(j)&&(I+=j,A+=1)}const P=A?I/A:NaN;p[x]=Number.isFinite(P)&&S>u*P?1:0}return{kind:"series",value:p}}case"atrspike":{const u=a.length?Math.max(1,di(a[0])):1,d=e.series.high,h=e.series.low,p=e.series.close;if(!d||!h||!p)throw new Pt("atrspike requires high/low/close series");const v=e.length,x=new Float32Array(v),S=14,C=I=>{const A=d[I],P=h[I],T=I>0?p[I-1]:NaN;let j=Number.isFinite(A)&&Number.isFinite(P)?Math.max(0,A-P):NaN;return Number.isFinite(T)&&(j=Math.max(j,Math.abs(A-T),Math.abs(P-T))),j};for(let I=0;I<v;I++){let A=NaN,P=0;for(let L=0;L<=I;L++){const D=C(L);P+=Number.isFinite(D)?D:0,L===S-1?A=P/S:L>=S&&(A=(A*(S-1)+D)/S)}let T=NaN,j=0,E=0;for(let L=Math.max(0,I-S+1);L<=I;L++){const D=C(L);Number.isFinite(D)&&(j+=D,E+=1)}E&&(T=j/E),x[I]=Number.isFinite(A)&&Number.isFinite(T)&&A>u*T?1:0}return{kind:"series",value:x}}case"trend":{const u=s.args[0],d=u&&u.kind==="StringLiteral"?u.value:u&&u.kind==="Identifier"?u.name:"",h=String(d||"").toLowerCase()||"up",p=e.series.close;if(!p)throw new Pt("trend requires close series");const v=e.length,x=new Float32Array(v),S=10;for(let C=0;C<v;C++){const I=Math.max(0,C-S+1);let A=0,P=0,T=0,j=0,E=0;for(let X=I;X<=C;X++){const ne=X-I,de=p[X];Number.isFinite(de)&&(A+=ne,P+=de,T+=ne*ne,j+=ne*de,E+=1)}const L=E*T-A*A,D=L===0||E===0?0:(E*j-A*P)/L;x[C]=h==="up"?D>0?1:0:D<0?1:0}return{kind:"series",value:x}}case"add":case"sub":case"mul":case"div":{if(a.length!==2)throw new Pt(`${o} expects 2 arguments`);const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar"){const S=u.value,C=d.value;return o==="add"?{kind:"scalar",value:S+C}:o==="sub"?{kind:"scalar",value:S-C}:o==="mul"?{kind:"scalar",value:S*C}:{kind:"scalar",value:p_(S,C,n,e)}}const h=Wn(u,e),p=Wn(d,e),v=e.length,x=new Float32Array(v);for(let S=0;S<v;S++){const C=h[S],I=p[S];o==="add"?x[S]=C+I:o==="sub"?x[S]=C-I:o==="mul"?x[S]=C*I:x[S]=p_(C,I,n,e)}return{kind:"series",value:x}}case"mod":case"fmod":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==2)throw new Pt(`${s.callee} expects 2 arguments`);const u=a[0],d=a[1],h=o==="mod"?hS:pS;if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:h(u.value,d.value,!0,e)};const p=Wn(u,e),v=Wn(d,e);return{kind:"series",value:ry(p,v,(x,S)=>h(x,S,!0,e))}}case"pow":{if(a.length!==2)throw new Pt("pow expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:ex(u.value,d.value,n,e)};const h=Wn(u,e),p=Wn(d,e);return{kind:"series",value:ry(h,p,(v,x)=>ex(v,x,n,e))}}case"sqrt":case"log":case"ln":case"log10":case"exp":case"floor":case"ceil":case"round":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"sign":{if(a.length!==1)throw new Pt(`${o} expects 1 argument`);const u=o==="sqrt"?h=>mS(h,n,e):o==="log"||o==="ln"?h=>vS(h,n,e):o==="log10"?h=>gS(h,n,e):o==="exp"?h=>xS(h,n):o==="floor"?Math.floor:o==="ceil"?Math.ceil:o==="round"?Math.round:o==="sin"?Math.sin:o==="cos"?Math.cos:o==="tan"?h=>bS(h,n):o==="asin"?h=>_S(h,n,e):o==="acos"?h=>yS(h,n,e):o==="atan"?Math.atan:Math.sign,d=a[0];return d.kind==="scalar"?{kind:"scalar",value:u(d.value)}:{kind:"series",value:i1(Wn(d,e),u)}}case"todegrees":case"toradians":{if(a.length!==1)throw new Pt(`${o} expects 1 argument`);const u=a[0],d=o==="todegrees"?180/Math.PI:Math.PI/180;return u.kind==="scalar"?{kind:"scalar",value:u.value*d}:{kind:"series",value:i1(Wn(u,e),h=>h*d)}}case"atan2":{if(a.length!==2)throw new Pt("atan2 expects (y, x)");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.atan2(u.value,d.value)};const h=Wn(u,e),p=Wn(d,e);return{kind:"series",value:ry(h,p,(v,x)=>Math.atan2(v,x))}}case"avg":{if(a.length!==2)throw new Pt("avg expects (a, b)");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:(u.value+d.value)/2};const h=Wn(u,e),p=Wn(d,e);return{kind:"series",value:ry(h,p,(v,x)=>(v+x)/2)}}case"clamp":{if(a.length!==3)throw new Pt("clamp expects (x, min, max)");const u=a[0],d=a[1],h=a[2],p=(A,P,T)=>Math.min(T,Math.max(P,A));if(u.kind==="scalar"&&d.kind==="scalar"&&h.kind==="scalar")return{kind:"scalar",value:p(u.value,d.value,h.value)};const v=Wn(u,e),x=Wn(d,e),S=Wn(h,e),C=e.length,I=new Float32Array(C);for(let A=0;A<C;A++)I[A]=p(v[A],x[A],S[A]);return{kind:"series",value:I}}case"cum":case"cumsum":{if(a.length!==1)throw new Pt(`${o} expects 1 argument`);const u=Wn(a[0],e),d=e.length,h=new Float32Array(d);let p=0;for(let v=0;v<d;v++){const x=u[v];Number.isFinite(x)&&(p+=x),h[v]=p}return{kind:"series",value:h}}case"barssince":{if(a.length!==1)throw new Pt("barssince expects (condition)");const u=Wn(a[0],e),d=e.length,h=new Float32Array(d);let p=NaN;for(let v=0;v<d;v++){const x=u[v];Number.isFinite(x)&&x!==0?(p=0,h[v]=0):Number.isFinite(p)?(p+=1,h[v]=p):h[v]=NaN}return{kind:"series",value:h}}case"sma":{const[u,d]=c();return{kind:"series",value:Lm(u,d)}}case"wma":{const[u,d]=c();return{kind:"series",value:Ty(u,d)}}case"ema":{const[u,d]=c();return{kind:"series",value:gh(u,d)}}case"smma":{const[u,d]=c();return{kind:"series",value:M_(u,d)}}case"rsi":{const[u,d]=c();return{kind:"series",value:kS(u,d)}}case"rma":{const[u,d]=c();return{kind:"series",value:M_(u,d)}}case"dema":{const[u,d]=c();return{kind:"series",value:wE(u,d)}}case"tema":{const[u,d]=c();return{kind:"series",value:kE(u,d)}}case"trima":{const[u,d]=c();return{kind:"series",value:SE(u,d)}}case"swma":{const[u,d]=c();return{kind:"series",value:CE(u,d)}}case"hma":{const[u,d]=c();return{kind:"series",value:IE(u,d)}}case"kama":{if(a.length<2||a.length>4)throw new Pt("kama expects (series, period[, fast, slow])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=a[2]?Math.max(1,Math.floor(di(a[2]))):2,p=a[3]?Math.max(1,Math.floor(di(a[3]))):30;return{kind:"series",value:PE(u,d,h,p)}}case"alma":{if(a.length<2||a.length>4)throw new Pt("alma expects (series, period[, offset, sigma])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=a[2]?di(a[2]):.85,p=a[3]?Math.max(.1,di(a[3])):6;return{kind:"series",value:ME(u,d,h,p)}}case"t3":{if(a.length<2||a.length>3)throw new Pt("t3 expects (series, period[, factor])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=a[2]?di(a[2]):.7;return{kind:"series",value:NE(u,d,h)}}case"cmo":{const[u,d]=c();return{kind:"series",value:TE(u,d)}}case"tsi":{if(a.length!==3)throw new Pt("tsi expects (series, long, short)");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=Math.max(1,Math.floor(di(a[2])));return{kind:"series",value:FE(u,d,h)}}case"stochrsi":{if(a.length<2||a.length>4)throw new Pt("stochrsi expects (series, length[, smoothK, smoothD])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=a[2]?Math.max(1,Math.floor(di(a[2]))):0,p=a[3]?Math.max(1,Math.floor(di(a[3]))):0;return{kind:"series",value:LE(u,d,h||void 0,p||void 0)}}case"ppo":{if(a.length!==3)throw new Pt("ppo expects (series, fast, slow)");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=Math.max(1,Math.floor(di(a[2])));return{kind:"series",value:EE(u,d,h)}}case"cog":{if(a.length!==1&&a.length!==2)throw new Pt("cog expects (length) or (series, length)");const u=a.length===1?e.series.close:Wn(a[0],e);if(!u)throw new Pt("cog requires a source series");const d=Math.max(1,Math.floor(di(a[a.length===1?0:1])));return{kind:"series",value:kv(e,`cog:${d}:${jd(s)}`,()=>HE(u,d))}}case"bbw":{if(a.length!==2&&a.length!==3)throw new Pt("bbw expects (length, mult) or (series, length, mult)");const u=a.length===2?e.series.close:Wn(a[0],e);if(!u)throw new Pt("bbw requires a source series");const d=Math.max(1,Math.floor(di(a[a.length===2?0:1]))),h=di(a[a.length===2?1:2]);return{kind:"series",value:kv(e,`bbw:${d}:${jd(s)}`,()=>YE(u,d,h))}}case"uo":{if(a.length!==3&&a.length!==6)throw new Pt("uo expects (len1, len2, len3) or (high, low, close, len1, len2, len3)");const u=a.length===6?Wn(a[0],e):e.series.high,d=a.length===6?Wn(a[1],e):e.series.low,h=a.length===6?Wn(a[2],e):e.series.close;if(!u||!d||!h)throw new Pt("uo requires high/low/close series");const p=Math.max(1,Math.floor(di(a[a.length===6?3:0]))),v=Math.max(1,Math.floor(di(a[a.length===6?4:1]))),x=Math.max(1,Math.floor(di(a[a.length===6?5:2])));return{kind:"series",value:kv(e,`uo:${p}:${v}:${x}:${jd(s)}`,()=>GE(u,d,h,p,v,x))}}case"pvi":case"nvi":{if(a.length!==0&&a.length!==2&&a.length!==3)throw new Pt(`${s.callee} expects () or (close, volume[, start])`);const u=a.length?Wn(a[0],e):e.series.close,d=a.length?Wn(a[1],e):e.series.volume,h=a.length===3?di(a[2]):1e3;if(!u||!d)throw new Pt(`${s.callee} requires close/volume series`);const p=`${o}:${jd(s)}`;return{kind:"series",value:kv(e,p,()=>o==="pvi"?KE(u,d,h):XE(u,d,h))}}case"kdj":{const u=a.length===6||a.length===7,d=a.length===3||a.length===4;if(!u&&!d)throw new Pt("kdj expects (len, smoothK, smoothD[, output]) or (high, low, close, len, smoothK, smoothD[, output])");const h=u,p=h?Wn(a[0],e):e.series.high,v=h?Wn(a[1],e):e.series.low,x=h?Wn(a[2],e):e.series.close;if(!p||!v||!x)throw new Pt("kdj requires high/low/close series");const S=h?3:0,C=Math.max(1,Math.floor(di(a[S+0]))),I=Math.max(1,Math.floor(di(a[S+1]))),A=Math.max(1,Math.floor(di(a[S+2]))),P=a[S+3]?Math.floor(di(a[S+3])):0;if(!Number.isFinite(P)||P<0||P>2)throw new Pt("kdj output must be 0, 1, or 2");const T=`kdj:${C}:${I}:${A}:${jd(s)}`,j=Fy(e,T,()=>{const L=qE(p,v,x,C,I,A);return{a:L.k,b:L.d,c:L.j}});return{kind:"series",value:P===0?j.a:P===1?j.b:j.c}}case"kst":{if(a.length<9||a.length>11)throw new Pt("kst expects (src, r1, r2, r3, r4, n1, n2, n3, n4[, signal, output])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=Math.max(1,Math.floor(di(a[2]))),p=Math.max(1,Math.floor(di(a[3]))),v=Math.max(1,Math.floor(di(a[4]))),x=Math.max(1,Math.floor(di(a[5]))),S=Math.max(1,Math.floor(di(a[6]))),C=Math.max(1,Math.floor(di(a[7]))),I=Math.max(1,Math.floor(di(a[8]))),A=a[9]?Math.max(1,Math.floor(di(a[9]))):9,P=a[10]?Math.floor(di(a[10])):0;if(!Number.isFinite(P)||P<0||P>1)throw new Pt("kst output must be 0 or 1");const T=`kst:${d}:${h}:${p}:${v}:${x}:${S}:${C}:${I}:${A}:${jd(s)}`,j=sb(e,T,()=>{const E=UE(u,d,h,p,v,x,S,C,I,A);return{a:E.kst,b:E.signal}});return{kind:"series",value:P===0?j.a:j.b}}case"vortex":{const u=a.length===4||a.length===5,d=a.length===1||a.length===2;if(!u&&!d)throw new Pt("vortex expects (length[, output]) or (high, low, close, length[, output])");const h=u,p=h?Wn(a[0],e):e.series.high,v=h?Wn(a[1],e):e.series.low,x=h?Wn(a[2],e):e.series.close;if(!p||!v||!x)throw new Pt("vortex requires high/low/close series");const S=h?3:0,C=Math.max(1,Math.floor(di(a[S]))),I=a[S+1]?Math.floor(di(a[S+1])):0;if(!Number.isFinite(I)||I<0||I>1)throw new Pt("vortex output must be 0 or 1");const A=`vortex:${C}:${jd(s)}`,P=sb(e,A,()=>{const T=ZE(p,v,x,C);return{a:T.plus,b:T.minus}});return{kind:"series",value:I===0?P.a:P.b}}case"linreg":{if(a.length<2||a.length>3)throw new Pt("linreg expects (series, period[, offset])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=a[2]?Math.floor(di(a[2])):0;return{kind:"series",value:e$(u,d,h)}}case"tr":case"trange":case"true_range":{if(a.length!==0&&a.length!==3)throw new Pt("tr expects () or (high, low, close)");const u=a.length===3?Wn(a[0],e):e.series.high,d=a.length===3?Wn(a[1],e):e.series.low,h=a.length===3?Wn(a[2],e):e.series.close;if(!u||!d||!h)throw new Pt("tr requires high/low/close series");const p=e.length,v=new Float32Array(p);let x=NaN;for(let S=0;S<p;S++){const C=u[S],I=d[S],A=h[S];let P=Math.max(0,C-I);Number.isFinite(x)&&(P=Math.max(P,Math.abs(C-x),Math.abs(I-x))),v[S]=P,x=A}return{kind:"series",value:v}}case"atr":{if(a.length!==1&&a.length!==4)throw new Pt("atr expects (length) or (high, low, close, length)");const u=di(a[a.length===1?0:3]),d=n?eh(u,`atr_len:${jd(s)}`,mE,e):Math.max(1,Math.floor(u));if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=a.length===1?e.series.high:Wn(a[0],e),p=a.length===1?e.series.low:Wn(a[1],e),v=a.length===1?e.series.close:Wn(a[2],e);if(!h||!p||!v)throw new Pt("atr requires high/low/close series");const x=e.length,S=Bx(h,p,v),C=new Float32Array(x);let I=0;for(let A=0;A<x;A++)I+=S[A],A===d-1?C[A]=I/d:A>=d?C[A]=(C[A-1]*(d-1)+S[A])/d:C[A]=NaN;return{kind:"series",value:C}}case"atrp":case"natr":{if(a.length!==1&&a.length!==4)throw new Pt(`${s.callee} expects (length) or (high, low, close, length)`);const u=di(a[a.length===1?0:3]),d=Math.max(1,Math.floor(u));if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=a.length===1?e.series.high:Wn(a[0],e),p=a.length===1?e.series.low:Wn(a[1],e),v=a.length===1?e.series.close:Wn(a[2],e);if(!h||!p||!v)throw new Pt(`${s.callee} requires high/low/close series`);return{kind:"series",value:AE(h,p,v,d)}}case"stdev":case"stddev":case"dev":{const[u,d]=c();return{kind:"series",value:Ox(u,d)}}case"variance":case"var":{const[u,d]=c();return{kind:"series",value:JE(u,d)}}case"zscore":{const[u,d]=c();return{kind:"series",value:RE(u,d)}}case"correlation":case"corr":{if(a.length!==3)throw new Pt(`${s.callee} expects (a, b, period)`);const u=Wn(a[0],e),d=Wn(a[1],e),h=Math.max(1,Math.floor(di(a[2])));return{kind:"series",value:QE(u,d,h)}}case"highest":{if(!n){const[p,v]=c();return{kind:"series",value:V_(p,v)}}if(a.length!==2)throw new Pt("highest expects (series, period)");const u=Wn(a[0],e),d=di(a[1]),h=eh(d,`highest_len:${jd(s)}`,lS,e);return Number.isFinite(h)?{kind:"series",value:V_(u,h)}:{kind:"series",value:tv(e.length)}}case"highestbars":{const[u,d]=c();return{kind:"series",value:SS(u,d)}}case"lowest":{if(!n){const[p,v]=c();return{kind:"series",value:W_(p,v)}}if(a.length!==2)throw new Pt("lowest expects (series, period)");const u=Wn(a[0],e),d=di(a[1]),h=eh(d,`lowest_len:${jd(s)}`,cS,e);return Number.isFinite(h)?{kind:"series",value:W_(u,h)}:{kind:"series",value:tv(e.length)}}case"lowestbars":{const[u,d]=c();return{kind:"series",value:CS(u,d)}}case"sum":{if(!n){const[p,v]=c();return{kind:"series",value:ov(p,v)}}if(a.length!==2)throw new Pt("sum expects (series, period)");const u=Wn(a[0],e),d=di(a[1]),h=eh(d,`sum_len:${jd(s)}`,uS,e);if(!Number.isFinite(h)){const p=new Float32Array(e.length);return p.fill(NaN),{kind:"series",value:p}}return{kind:"series",value:ov(u,h)}}case"rising":case"falling":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==2)throw new Pt(`${s.callee} expects (series, length)`);const u=Wn(a[0],e),d=di(a[1]),h=`${o}_len:${jd(s)}`,v=eh(d,h,o==="rising"?dS:fS,e);if(!Number.isFinite(v)){const x=new Float32Array(e.length);return x.fill(NaN),{kind:"series",value:x}}return{kind:"series",value:R3(u,v,o)}}case"lag":{if(a.length!==2)throw new Pt("lag expects (series, n)");const u=Wn(a[0],e),d=di(a[1]);if(n){const p=N0(d,"history_index",C1,e);if(!Number.isFinite(p)){const v=new Float32Array(e.length);return v.fill(NaN),{kind:"series",value:v}}return{kind:"series",value:ly(u,p)}}const h=Math.max(1,Math.floor(d));return{kind:"series",value:ly(u,h)}}case"prev":{if(a.length<1||a.length>2)throw new Pt("prev expects (series[, n])");const u=Wn(a[0],e),d=di(a[1]??{kind:"scalar",value:1});if(n){const p=N0(d,"history_index",C1,e);if(!Number.isFinite(p)){const v=new Float32Array(e.length);return v.fill(NaN),{kind:"series",value:v}}return{kind:"series",value:ly(u,p)}}const h=Math.max(1,Math.floor(d));return{kind:"series",value:ly(u,h)}}case"change":{if(a.length<1||a.length>2)throw new Pt("change expects (series[, n])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:sE(u,d)}}case"roc":{if(a.length<1||a.length>2)throw new Pt("roc expects (series[, n])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:h1(u,d)}}case"mom":case"momentum":{if(a.length<1||a.length>2)throw new Pt("mom expects (series[, n])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]??{kind:"scalar",value:1})));return{kind:"series",value:nE(u,d)}}case"crossover":case"crossunder":{if(a.length<2||a.length>3)throw new Pt(`${s.callee} expects (series, series[, tol])`);const u=Wn(a[0],e),d=a[1],h=d.kind==="series",p=Wn(d,e),v=a[2]?Math.max(0,di(a[2])):0,x=e.length,S=new Float32Array(x);S[0]=0;for(let C=1;C<x;C++){const I=u[C-1],A=u[C],P=h?p[C-1]:p[0],T=h?p[C]:p[0];if(![I,A,P,T].every(Number.isFinite)){S[C]=0;continue}o==="crossover"?S[C]=I<=P+v&&A>T+v?1:0:S[C]=I>=P-v&&A<T-v?1:0}return{kind:"series",value:S}}case"hl2":{if(a.length!==0)throw new Pt("hl2 expects no arguments");const u=e.series.high,d=e.series.low;if(!u||!d)throw new Pt("hl2 requires high/low series");const h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++)p[v]=(u[v]+d[v])/2;return{kind:"series",value:p}}case"hlc3":{if(a.length!==0)throw new Pt("hlc3 expects no arguments");const u=e.series.high,d=e.series.low,h=e.series.close;if(!u||!d||!h)throw new Pt("hlc3 requires high/low/close series");const p=e.length,v=new Float32Array(p);for(let x=0;x<p;x++)v[x]=(u[x]+d[x]+h[x])/3;return{kind:"series",value:v}}case"ohlc4":{if(a.length!==0)throw new Pt("ohlc4 expects no arguments");const u=e.series.open,d=e.series.high,h=e.series.low,p=e.series.close;if(!u||!d||!h||!p)throw new Pt("ohlc4 requires open/high/low/close series");const v=e.length,x=new Float32Array(v);for(let S=0;S<v;S++)x[S]=(u[S]+d[S]+h[S]+p[S])/4;return{kind:"series",value:x}}case"vwap":{if(a.length!==0&&a.length!==2)throw new Pt("vwap expects () or (close, volume)");const u=a.length===0?e.series.close:Wn(a[0],e),d=a.length===0?e.series.volume:Wn(a[1],e);if(!u||!d)throw new Pt("vwap requires close/volume series");const h=a.length===0?e.series.high:void 0,p=a.length===0?e.series.low:void 0,v=a.length===0?e.series.time:void 0;if(a.length===0&&(!h||!p))throw new Pt("vwap requires high/low/close series");const x=e.length,S=new Float32Array(x);let C=0,I=0,A=Number.NaN;for(let P=0;P<x;P++){if(a.length===0&&v){const E=v[P];if(Number.isFinite(E)){const L=Math.floor(E/864e5);(!Number.isFinite(A)||L!==A)&&(C=0,I=0,A=L)}}const T=d[P],j=a.length===0?(h[P]+p[P]+u[P])/3:u[P];if(!Number.isFinite(j)||!Number.isFinite(T)){S[P]=NaN;continue}C+=j*T,I+=T,S[P]=I===0?NaN:C/I}return{kind:"series",value:S}}case"vwma":{if(a.length!==3)throw new Pt("vwma expects (close, volume, period)");const u=Wn(a[0],e),d=Wn(a[1],e),h=Math.max(1,Math.floor(di(a[2]))),p=e.length,v=new Float32Array(p);let x=0,S=0;for(let C=0;C<p;C++){const I=u[C],A=d[C];if(Number.isFinite(I)&&Number.isFinite(A)&&(x+=I*A,S+=A),C>=h){const P=u[C-h],T=d[C-h];Number.isFinite(P)&&Number.isFinite(T)&&(x-=P*T,S-=T)}v[C]=C>=h-1&&S!==0?x/S:NaN}return{kind:"series",value:v}}case"evwma":{if(a.length!==3)throw new Pt("evwma expects (close, volume, period)");const u=Wn(a[0],e),d=Wn(a[1],e),h=Math.max(1,Math.floor(di(a[2]))),p=D3(xv(u),xv(d),h);return{kind:"series",value:Eg(p)}}case"bbands":case"bollinger":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length<3||a.length>4)throw new Pt("bbands expects (series, period, mult[, output])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=di(a[2]),p=a[3]?Math.floor(di(a[3])):0;if(!Number.isFinite(p)||p<0||p>2)throw new Pt("bbands output must be 0, 1, or 2");const v=q2(xv(u),d,h),x=p===0?v.mid:p===1?v.upper:v.lower;return{kind:"series",value:Eg(x)}}case"keltner":case"kc":{if(a.length<2||a.length>6)throw new Pt("keltner expects (period, mult[, output]) or (high, low, close, period, mult[, output])");let u,d,h,p=0,v=1,x=2;if(a.length>=5?(u=Wn(a[0],e),d=Wn(a[1],e),h=Wn(a[2],e),p=3,v=4,x=5):(u=e.series.high,d=e.series.low,h=e.series.close),!u||!d||!h)throw new Pt("keltner requires high/low/close series");const S=Math.max(1,Math.floor(di(a[p]))),C=di(a[v]),I=a[x]?Math.floor(di(a[x])):0;if(!Number.isFinite(I)||I<0||I>2)throw new Pt("keltner output must be 0, 1, or 2");const A=zE(u,d,h,S,C);return{kind:"series",value:I===0?A.mid:I===1?A.upper:A.lower}}case"donchian":{if(a.length<1||a.length>4)throw new Pt("donchian expects (period[, output]) or (high, low, period[, output])");let u,d,h=0,p=1;if(a.length>=3?(u=Wn(a[0],e),d=Wn(a[1],e),h=2,p=3):(u=e.series.high,d=e.series.low),!u||!d)throw new Pt("donchian requires high/low series");const v=Math.max(1,Math.floor(di(a[h]))),x=a[p]?Math.floor(di(a[p])):0;if(!Number.isFinite(x)||x<0||x>2)throw new Pt("donchian output must be 0, 1, or 2");const S=VE(u,d,v);return{kind:"series",value:x===0?S.upper:x===1?S.lower:S.mid}}case"supertrend":{if(a.length<2||a.length>3)throw new Pt("supertrend expects (factor, period[, output])");const u=di(a[0]),d=Math.max(1,Math.floor(di(a[1]))),h=a[2]?Math.floor(di(a[2])):0;if(!Number.isFinite(h)||h<0||h>1)throw new Pt("supertrend output must be 0 or 1");const p=e.series.high,v=e.series.low,x=e.series.close;if(!p||!v||!x)throw new Pt("supertrend requires high/low/close series");const S=OE(p,v,x,d,u);return{kind:"series",value:h===0?S.line:S.dir}}case"sar":{if(a.length!==0&&a.length!==3)throw new Pt("sar expects () or (start, increment, maximum)");const u=a.length===3?di(a[0]):.02,d=a.length===3?di(a[1]):.02,h=a.length===3?di(a[2]):.2,p=e.series.high,v=e.series.low;if(!p||!v)throw new Pt("sar requires high/low series");return{kind:"series",value:WE(p,v,u,d,h)}}case"macd":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length<4||a.length>5)throw new Pt("macd expects (series, fast, slow, signal[, output])");const u=Wn(a[0],e),d=Math.max(1,Math.floor(di(a[1]))),h=Math.max(1,Math.floor(di(a[2]))),p=Math.max(1,Math.floor(di(a[3]))),v=a[4]?Math.floor(di(a[4])):0;if(!Number.isFinite(v)||v<0||v>2)throw new Pt("macd output must be 0, 1, or 2");const x=oE(u,d,h,p);return{kind:"series",value:v===0?x.line:v===1?x.signal:x.hist}}case"stoch":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length<5||a.length>6)throw new Pt("stoch expects (high, low, close, k, d[, output])");const u=Wn(a[0],e),d=Wn(a[1],e),h=Wn(a[2],e),p=Math.max(1,Math.floor(di(a[3]))),v=Math.max(1,Math.floor(di(a[4]))),x=a[5]?Math.floor(di(a[5])):0;if(!Number.isFinite(x)||x<0||x>1)throw new Pt("stoch output must be 0 or 1");const S=iE(u,d,h,p,v);return{kind:"series",value:x===0?S.k:S.d}}case"ao":{if(a.length!==0&&a.length!==2)throw new Pt("ao expects () or (high, low)");const u=a.length===2?Wn(a[0],e):e.series.high,d=a.length===2?Wn(a[1],e):e.series.low;if(!u||!d)throw new Pt("ao requires high/low series");return{kind:"series",value:$E(u,d)}}case"trix":{const[u,d]=c();return{kind:"series",value:DE(u,d)}}case"williamsr":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1&&a.length!==4)throw new Pt("williamsr expects (length) or (high, low, close, length)");const u=a.length===1?di(a[0]):di(a[3]),d=eh(u,"williamsr_len",Q3,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=a.length===1?e.series.high:Wn(a[0],e),p=a.length===1?e.series.low:Wn(a[1],e),v=a.length===1?e.series.close:Wn(a[2],e);if(!h||!p||!v)throw new Pt("williamsr requires high/low/close series");return{kind:"series",value:O3(h,p,v,d)}}case"aroon":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length<1||a.length>2)throw new Pt("aroon expects (length[, output])");const u=di(a[0]),d=eh(u,"aroon_len",eS,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=a[1]?Math.floor(di(a[1])):0;if(!Number.isFinite(h)||h<0||h>1)throw new Pt("aroon output must be 0 or 1");const p=e.series.high,v=e.series.low;if(!p||!v)throw new Pt("aroon requires high/low series");const x=Zy(p,v,d);return{kind:"series",value:h===0?x.up:x.down}}case"aroonosc":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1)throw new Pt("aroonosc expects (length)");const u=di(a[0]),d=eh(u,"aroonosc_len",aS,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=e.series.high,p=e.series.low;if(!h||!p)throw new Pt("aroonosc requires high/low series");return{kind:"series",value:rE(h,p,d)}}case"dmi":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length<2||a.length>3)throw new Pt("dmi expects (length, smoothing[, output])");const u=di(a[0]),d=di(a[1]),h=eh(u,"dmi_len",tS,e),p=eh(d,"dmi_smooth",sS,e);if(!Number.isFinite(h)||!Number.isFinite(p))return{kind:"series",value:tv(e.length)};const v=a[2]?Math.floor(di(a[2])):0;if(!Number.isFinite(v)||v<0||v>2)throw new Pt("dmi output must be 0, 1, or 2");const x=e.series.high,S=e.series.low,C=e.series.close;if(!x||!S||!C)throw new Pt("dmi requires high/low/close series");const I=M0(x,S,C,h,p);return{kind:"series",value:v===0?I.plus:v===1?I.minus:I.adx}}case"plus_di":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1)throw new Pt("plus_di expects (length)");const u=di(a[0]),d=eh(u,"plus_di_len",oS,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=e.series.high,p=e.series.low,v=e.series.close;if(!h||!p||!v)throw new Pt("plus_di requires high/low/close series");return{kind:"series",value:M0(h,p,v,d,d).plus}}case"minus_di":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1)throw new Pt("minus_di expects (length)");const u=di(a[0]),d=eh(u,"minus_di_len",iS,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=e.series.high,p=e.series.low,v=e.series.close;if(!h||!p||!v)throw new Pt("minus_di requires high/low/close series");return{kind:"series",value:M0(h,p,v,d,d).minus}}case"dx":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1)throw new Pt("dx expects (length)");const u=di(a[0]),d=eh(u,"dx_len",rS,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=e.series.high,p=e.series.low,v=e.series.close;if(!h||!p||!v)throw new Pt("dx requires high/low/close series");const x=M0(h,p,v,d,d);return{kind:"series",value:z3(x.plus,x.minus)}}case"adx":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1)throw new Pt("adx expects (length)");const u=di(a[0]),d=eh(u,"adx_len",nS,e);if(!Number.isFinite(d))return{kind:"series",value:tv(e.length)};const h=e.series.high,p=e.series.low,v=e.series.close;if(!h||!p||!v)throw new Pt("adx requires high/low/close series");return{kind:"series",value:M0(h,p,v,d,d).adx}}case"valuewhen":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==3)throw new Pt("valuewhen expects (condition, source, occurrence)");const u=s.args[0],d=dg(u);d&&Bd(e,F0(u,e,"type"),Qy);const h=`valuewhen_occ:${jd(s)}`;if(a[2].kind!=="scalar")return Bd(e,h,eb),{kind:"series",value:tv(e.length)};const p=N0(a[2].value,h,eb,e);if(!Number.isFinite(p)||d)return{kind:"series",value:tv(e.length)};const v=Wn(a[0],e),x=Wn(a[1],e),S=F0(u,e,"na");return{kind:"series",value:V3(v,x,p,A=>Dg(A,e.diagnostics,S))}}case"pivothigh":case"pivotlow":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==3)throw new Pt(`${s.callee} expects (source, left, right)`);const u=di(a[1]),d=di(a[2]),{left:h,right:p}=W3(u,d),v=Wn(a[0],e);return{kind:"series",value:aE(v,h,p,o==="pivothigh"?"high":"low")}}case"year":case"month":case"dayofweek":case"hour":case"minute":case"second":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1)throw new Pt(`${s.callee} expects (time)`);const u=a[0];if(u.kind==="scalar"){if(P0(u.value),o==="dayofweek")return{kind:"scalar",value:G2(u.value)};const p=o==="year"||o==="month"?o:o==="hour"?"hour":o==="minute"?"minute":"second";return{kind:"scalar",value:Y2(u.value,p)}}const d=Wn(u,e);if(rk(d),o==="dayofweek")return{kind:"series",value:i1(d,G2)};const h=o==="year"||o==="month"?o:o==="hour"?"hour":o==="minute"?"minute":"second";return{kind:"series",value:i1(d,p=>Y2(p,h))}}case"timestamp":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length<5||a.length>6)throw new Pt("timestamp expects (year, month, day, hour, minute[, second])");const u=a.length===6?a[5]:{kind:"scalar",value:0};if([a[0],a[1],a[2],a[3],a[4],u].every(P=>(P==null?void 0:P.kind)==="scalar")){const P=a[0].value,T=a[1].value,j=a[2].value,E=a[3].value,L=a[4].value,D=u.value;return{kind:"scalar",value:U3(P,T,j,E,L,D)}}const h=Wn(a[0],e),p=Wn(a[1],e),v=Wn(a[2],e),x=Wn(a[3],e),S=Wn(a[4],e),C=Wn(u,e);[h,p,v,x,S,C].forEach(rk);const I=e.length,A=new Float32Array(I);for(let P=0;P<I;P++){const T=h[P],j=p[P],E=v[P],L=x[P],D=S[P],X=C[P];if(![T,j,E,L,D,X].every(Number.isFinite)){A[P]=NaN;continue}if(j<1||j>12)throw new Pt(q3);A[P]=Date.UTC(T,j-1,E,L,D,X)}return{kind:"series",value:A}}case"timenow":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==0)throw new Pt("timenow expects ()");return{kind:"scalar",value:Y3(e)}}case"time_close":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==0)throw new Pt("time_close expects ()");const u=e.series.time;if(!u)throw new Pt("time_close requires time series");const d=G3(e);return{kind:"series",value:i1(u,h=>Number.isFinite(h)?h+d:NaN)}}case"isin":case"session_isin":case"session.isin":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==2)throw new Pt("session.isin expects (time, session)");const u=s.args[1];if(!u||u.kind!=="StringLiteral")throw new Pt(Jy);const{start:d,end:h}=K3(u.value),p=a[0];if(p.kind==="scalar"){const S=p.value;if(!Number.isFinite(S))throw new Pt(K2);const C=X2(S);return{kind:"scalar",value:Z2(C,d,h)?1:0}}const v=Wn(p,e),x=new Float32Array(v.length);for(let S=0;S<v.length;S++){const C=v[S];if(!Number.isFinite(C))throw new Pt(K2);const I=X2(C);x[S]=Z2(I,d,h)?1:0}return{kind:"series",value:x}}case"cci":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==4)throw new Pt("cci expects (high, low, close, period)");const u=Wn(a[0],e),d=Wn(a[1],e),h=Wn(a[2],e),p=Math.max(1,Math.floor(di(a[3]))),v=L3(xv(u),xv(d),xv(h),p);return{kind:"series",value:Eg(v)}}case"mfi":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==5)throw new Pt("mfi expects (high, low, close, volume, period)");const u=Wn(a[0],e),d=Wn(a[1],e),h=Wn(a[2],e),p=Wn(a[3],e),v=Math.max(1,Math.floor(di(a[4]))),x=E3(xv(u),xv(d),xv(h),xv(p),v);return{kind:"series",value:Eg(x)}}case"obv":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==2)throw new Pt("obv expects (close, volume)");const u=Wn(a[0],e),d=Wn(a[1],e),h=F3(xv(u),xv(d));return{kind:"series",value:Eg(h)}}case"ad":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==0&&a.length!==4)throw new Pt("ad expects () or (high, low, close, volume)");const u=a.length===4?Wn(a[0],e):e.series.high,d=a.length===4?Wn(a[1],e):e.series.low,h=a.length===4?Wn(a[2],e):e.series.close,p=a.length===4?Wn(a[3],e):e.series.volume;if(!u||!d||!h||!p)throw new Pt("ad requires high/low/close/volume series");return{kind:"series",value:jE(u,d,h,p)}}case"cmf":{if(!n)throw new Pt(`Unknown function "${s.callee}"`);if(a.length!==1&&a.length!==5)throw new Pt("cmf expects (length) or (high, low, close, volume, length)");const u=Math.max(1,Math.floor(di(a[a.length===1?0:4]))),d=a.length===5?Wn(a[0],e):e.series.high,h=a.length===5?Wn(a[1],e):e.series.low,p=a.length===5?Wn(a[2],e):e.series.close,v=a.length===5?Wn(a[3],e):e.series.volume;if(!d||!h||!p||!v)throw new Pt("cmf requires high/low/close/volume series");return{kind:"series",value:BE(d,h,p,v,u)}}case"min":{if(a.length!==2)throw new Pt("min expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.min(u.value,d.value)};const h=Wn(u,e),p=Wn(d,e),v=e.length,x=new Float32Array(v);for(let S=0;S<v;S++)x[S]=Math.min(h[S],p[S]);return{kind:"series",value:x}}case"max":{if(a.length!==2)throw new Pt("max expects 2 arguments");const u=a[0],d=a[1];if(u.kind==="scalar"&&d.kind==="scalar")return{kind:"scalar",value:Math.max(u.value,d.value)};const h=Wn(u,e),p=Wn(d,e),v=e.length,x=new Float32Array(v);for(let S=0;S<v;S++)x[S]=Math.max(h[S],p[S]);return{kind:"series",value:x}}case"abs":{if(a.length!==1)throw new Pt("abs expects 1 argument");const u=a[0];if(u.kind==="scalar")return{kind:"scalar",value:Math.abs(u.value)};const d=u.value,h=e.length,p=new Float32Array(h);for(let v=0;v<h;v++)p[v]=Math.abs(d[v]);return{kind:"series",value:p}}default:throw new Pt(`Unknown function "${s.callee}"`)}}function ug(s,e){var t,n;switch(s.kind){case"NumberLiteral":return{kind:"scalar",value:s.value};case"StringLiteral":return{kind:"scalar",value:Em(s.value)};case"Identifier":{const o=s.name.replace(/\s+/g,"_").toLowerCase();if(o==="na"||o==="nan")return{kind:"scalar",value:NaN};if(o==="pi")return{kind:"scalar",value:Math.PI};if(o==="e")return{kind:"scalar",value:Math.E};const r=e.series[o];if(r)return{kind:"series",value:r};const a=(t=e.scalars)==null?void 0:t[o];if(typeof a=="number"&&Number.isFinite(a))return{kind:"scalar",value:a};throw e.seriesNames.has(o)?new Pt(`Series "${s.name}" is used before it is defined (circular or forward reference)`):new Pt(`Unknown identifier "${s.name}"`)}case"MemberExpression":{const o=m_(s);return o?ug({kind:"Identifier",name:o},e):(Rx(e,s),{kind:"scalar",value:NaN})}case"IndexExpression":return jx(e,s),{kind:"scalar",value:NaN};case"UnaryExpression":{const o=ug(s.expr,e);if(s.operator==="not"){const r=((n=e.scalars)==null?void 0:n.__pinev2)===1;if(o.kind==="scalar"){const c=o.value;return{kind:"scalar",value:r?J2(c):Number.isFinite(c)&&c!==0?0:1}}const a=o.value,l=new Float32Array(a.length);for(let c=0;c<a.length;c++){const f=a[c];l[c]=r?J2(f):Number.isFinite(f)&&f!==0?0:1}return{kind:"series",value:l}}throw new Pt("Unsupported unary operator")}case"BinaryExpression":return s.operator==="and"||s.operator==="or"?xE(s,e):wS(s.operator,ug(s.left,e),ug(s.right,e),e);case"CallExpression":return IS(s,e);default:throw new Pt("Unsupported expression node")}}function l_(s,e,t,n,o,r){var L;const a=new Set;for(const D of s){const X=D.name.replace(/\s+/g,"_").toLowerCase();a.add(X)}const l=Object.entries(e),c=((L=l[0])==null?void 0:L[1].length)??0;for(const[,D]of l)if(D.length!==c)throw new Pt("All base series must have the same length");const f=s.map(D=>{try{const X=Ep(D.expr);return{name:D.name.replace(/\s+/g,"_").toLowerCase(),expr:D.expr,ast:X}}catch(X){throw X instanceof rv?new Pt(`Syntax error in series "${D.name}" at position ${X.position}: ${X.message}`):X}}),u=(()=>{if(!t||typeof t!="object")return;const D={};return Object.entries(t).forEach(([X,ne])=>{const de=X.replace(/\s+/g,"_").toLowerCase();if(typeof ne=="number"&&Number.isFinite(ne)){D[de]=ne;return}if(typeof ne=="string"){const ie=Number(ne);D[de]=Number.isFinite(ie)?ie:Em(ne)}}),Object.keys(D).length?D:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const D={};return Object.entries(t).forEach(([X,ne])=>{typeof ne=="string"&&(D[X.replace(/\s+/g,"_").toLowerCase()]=ne)}),Object.keys(D).length?D:void 0})(),h=bb(r==null?void 0:r.loopPlans,u,!!(r!=null&&r.userFunctions)),p=xb(r==null?void 0:r.userFunctions),v={length:c,series:{...e},seriesNames:a,scalars:u,diagnostics:o,strategy:n,strings:d,loopRuntime:h,funcRuntime:p},x={},S=D=>{const X=new Set,ne=de=>{switch(de.kind){case"Identifier":{const ie=de.name.replace(/\s+/g,"_").toLowerCase();X.add(ie);break}case"MemberExpression":{const ie=m_(de);if(ie){const te=ie.replace(/\s+/g,"_").toLowerCase();X.add(te);break}ne(de.object);break}case"IndexExpression":ne(de.object),ne(de.index);break;case"BinaryExpression":ne(de.left),ne(de.right);break;case"UnaryExpression":ne(de.expr);break;case"CallExpression":de.args.forEach(ie=>ne(ie));break}};return ne(D),X},C=new Set(f.map(D=>D.name)),I={},A={};f.forEach(D=>{I[D.name]=new Set,A[D.name]=new Set}),f.forEach(D=>{S(D.ast).forEach(ne=>{C.has(ne)&&ne!==D.name&&(I[D.name].add(ne),A[ne].add(D.name))})});const P={};Object.keys(I).forEach(D=>{var X;P[D]=((X=I[D])==null?void 0:X.size)??0});const T=Object.keys(P).filter(D=>(P[D]||0)===0),j=[];for(;T.length;){const D=T.shift();j.push(D);for(const X of A[D]||[])P[X]=(P[X]||0)-1,P[X]===0&&T.push(X)}if(j.length!==f.length){const D=f.map(X=>X.name).filter(X=>!j.includes(X));throw new Pt(`Circular dependency detected among series: ${D.join(" -> ")}`)}const E={};f.forEach(D=>{E[D.name]=D});for(const D of j){const X=E[D];if(v.series[X.name])throw new Pt(`Series name "${X.name}" conflicts with an existing base series`);const ne=ug(X.ast,v),de=Wn(ne,v);v.series[X.name]=de,x[X.name]=de}return x}const kv=(s,e,t)=>{if(!s.memo)return t();const n=s.memo.get(e);if(n)return n;const o=t();return s.memo.set(e,o),o},S0=(s,e)=>{if(s.kind==="Identifier"){const t=s.name.replace(/\s+/g,"_").toLowerCase();return e.series[t]??null}if(s.kind==="MemberExpression"){const t=m_(s);if(!t)return null;const n=t.replace(/\s+/g,"_").toLowerCase();return e.series[n]??null}if(s.kind==="NumberLiteral")return kv(e,`const:${s.value}`,()=>{const t=new Float32Array(e.length);return t.fill(s.value),t});if(s.kind==="StringLiteral"){const t=Em(s.value);return kv(e,`const_str:${s.value}`,()=>{const n=new Float32Array(e.length);return n.fill(t),n})}return null},sb=(s,e,t)=>{if(!s.memo)return t();const n=`${e}:a`,o=s.memo.get(n);if(o)return{a:o,b:s.memo.get(`${e}:b`)};const r=t();return s.memo.set(n,r.a),s.memo.set(`${e}:b`,r.b),r},Fy=(s,e,t)=>{if(!s.memo)return t();const n=`${e}:a`,o=s.memo.get(n);if(o)return{a:o,b:s.memo.get(`${e}:b`),c:s.memo.get(`${e}:c`)};const r=t();return s.memo.set(n,r.a),s.memo.set(`${e}:b`,r.b),s.memo.set(`${e}:c`,r.c),r};function uk(s,e){var r;const t=s.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.locals&&Object.prototype.hasOwnProperty.call(e.locals,t))return e.locals[t];if(e.selfKey&&e.selfOut&&t===e.selfKey){if(e.selfMode==="current"){const l=e.selfOut[e.index];if(Number.isFinite(l))return l}const a=e.index-1;return a>=0?e.selfOut[a]:NaN}const n=e.series[t];if(n)return n[e.index]??NaN;const o=(r=e.scalars)==null?void 0:r[t];if(typeof o=="number"&&Number.isFinite(o))return o;throw new Pt(`Unknown identifier "${s}"`)}const Vx=1e3,t$=1e6,PS=(s,e,t)=>{if(!Number.isFinite(s)||!Number.isFinite(e)||!Number.isFinite(t)||t===0)return null;if(t>0){if(s>e)return 0;const n=(e-s)/t;return Math.floor(n+1+1e-12)}if(t<0){if(s<e)return 0;const n=(s-e)/Math.abs(t);return Math.floor(n+1+1e-12)}return null},Pm=(s,e)=>{try{return Ep(s)}catch(t){throw t instanceof rv?new Pt(`Syntax error in ${e} at position ${t.position}: ${t.message}`):t}},Ly=s=>s.map(e=>e.kind==="assign"?{kind:"assign",name:e.name,expr:Pm(e.expr,`loop assignment "${e.name}"`),lineNo:e.lineNo}:e.kind==="if"?{kind:"if",lineNo:e.lineNo,branches:e.branches.map(t=>({cond:t.cond?Pm(t.cond,"loop if condition"):void 0,body:Ly(t.body),lineNo:t.lineNo}))}:e.kind==="for"?{kind:"for",lineNo:e.lineNo,varName:e.varName,startExpr:Pm(e.startExpr,"loop for start"),endExpr:Pm(e.endExpr,"loop for end"),stepExpr:Pm(e.stepExpr,"loop for step"),body:Ly(e.body)}:e.kind==="while"?{kind:"while",lineNo:e.lineNo,condExpr:Pm(e.condExpr,"loop while condition"),body:Ly(e.body)}:{kind:e.kind,lineNo:e.lineNo}),sx=(s,e)=>{for(const t of s){if(t.kind==="assign"){e.add(t.name);continue}if(t.kind==="if"){t.branches.forEach(n=>sx(n.body,e));continue}(t.kind==="for"||t.kind==="while")&&sx(t.body,e)}},s$=s=>{const e=Ly(s.body||[]),t=new Set;return sx(e,t),{id:s.id,kind:s.kind,lineNo:s.lineNo,varName:s.varName,startExpr:s.startExpr?Pm(s.startExpr,"loop start"):void 0,endExpr:s.endExpr?Pm(s.endExpr,"loop end"):void 0,stepExpr:s.stepExpr?Pm(s.stepExpr,"loop step"):void 0,condExpr:s.condExpr?Pm(s.condExpr,"loop condition"):void 0,body:e,targets:Array.from(t)}},bb=(s,e,t)=>{if((!s||!s.length)&&!t)return;const n=e==null?void 0:e.__loop_max_iters,o=typeof n=="number"&&Number.isFinite(n),r=o&&n<=0?Number.POSITIVE_INFINITY:o?Math.min(t$,Math.max(1,Math.floor(n))):Vx,a=new Map;return(s||[]).forEach(l=>{if(!l||typeof l!="object")return;const c=String(l.id||"").trim();c&&a.set(c,s$(l))}),{plans:a,maxIters:r,hasCustomMax:o,running:new Set}},Ey=s=>s.map(e=>e.kind==="assign"?{kind:"assign",name:e.name,op:e.op,decl:e.decl,expr:Pm(e.expr,`function assignment "${e.name}"`),lineNo:e.lineNo}:e.kind==="return"?{kind:"return",expr:Pm(e.expr,"function return"),lineNo:e.lineNo}:e.kind==="if"?{kind:"if",lineNo:e.lineNo,branches:e.branches.map(t=>({cond:t.cond?Pm(t.cond,"function if condition"):void 0,body:Ey(t.body),lineNo:t.lineNo}))}:e.kind==="for"?{kind:"for",lineNo:e.lineNo,varName:e.varName,startExpr:Pm(e.startExpr,"function for start"),endExpr:Pm(e.endExpr,"function for end"),stepExpr:Pm(e.stepExpr,"function for step"),body:Ey(e.body)}:e.kind==="while"?{kind:"while",lineNo:e.lineNo,condExpr:Pm(e.condExpr,"function while condition"),body:Ey(e.body)}:{kind:e.kind,lineNo:e.lineNo}),nx=(s,e)=>{for(const t of s){if(t.kind==="assign"){if(t.decl==="var"||t.decl==="varip"){const n=t.name.replace(/\s+/g,"_").toLowerCase();e.add(n)}continue}if(t.kind==="if"){t.branches.forEach(n=>nx(n.body,e));continue}(t.kind==="for"||t.kind==="while")&&nx(t.body,e)}},n$=s=>{const e=Ey(s.body||[]),t=new Set;return nx(e,t),{name:s.name,args:s.args||[],lineNo:s.lineNo,body:e,statefulVars:t}},xb=s=>{if(!s||!s.length)return;const e=new Map;return s.forEach(t=>{if(!t||typeof t!="object")return;const n=String(t.name||"").trim();if(n)try{e.set(n.toLowerCase(),n$(t))}catch{}}),{funcs:e,callState:new WeakMap,running:new Set}},N_=(s,e,t,n,o)=>_r(s,{...e,locals:t,selfKey:n,selfOut:o,selfMode:"current"}),ox=(s,e,t)=>{for(const n of s){if(n.kind==="assign"){const o=n.name.replace(/\s+/g,"_").toLowerCase();let r=e.series[o];r||(r=new Float32Array(e.length),r.fill(NaN),e.series[o]=r);const a=N_(n.expr,e,t,o,r);r[e.index]=a;continue}if(n.kind==="break")return"break";if(n.kind==="continue")return"continue";if(n.kind==="if"){let o=!1;for(const r of n.branches){if(o)break;if(r.cond){const l=N_(r.cond,e,t);if(!Dg(l,e.diagnostics,`loop_cond_na:${n.lineNo}`))continue}o=!0;const a=ox(r.body,e,t);if(a!=="none")return a}continue}if(n.kind==="for"){nb({kind:"for",varName:n.varName,startExpr:n.startExpr,endExpr:n.endExpr,stepExpr:n.stepExpr,body:n.body,lineNo:n.lineNo},e,t);continue}if(n.kind==="while"){nb({kind:"while",condExpr:n.condExpr,body:n.body,lineNo:n.lineNo},e,t);continue}}return"none"},nb=(s,e,t)=>{const n=e.loopRuntime,o=(n==null?void 0:n.maxIters)??Vx,r=(n==null?void 0:n.hasCustomMax)??!1,a=`loop_max:${s.lineNo}`,l=`Loop exceeded max iterations (${o})`;if(s.kind==="for"){const u=Object.prototype.hasOwnProperty.call(t,s.varName)?t[s.varName]:void 0,d=N_(s.startExpr,e,t),h=N_(s.endExpr,e,t),p=N_(s.stepExpr,e,t);if(!Number.isFinite(p)||p===0){Bd(e,`loop_step_zero:${s.lineNo}`,"for-loop step must not be 0");return}const v=PS(d,h,p),x=Number.isFinite(o)?o:null;let S=null,C=!1;r&&x!=null?v==null?(S=x,C=!0):(S=Math.min(x,v),C=v>x):v!=null&&(S=v);const I=p>0;let A=d,P=0;for(;(S==null||P<S)&&!(!Number.isFinite(A)||!Number.isFinite(h)||I&&A>h+1e-12||!I&&A<h-1e-12);){t[s.varName]=A;const T=ox(s.body,e,t);if(T==="break")break;A+=p,P+=1}C&&S!=null&&P>=S&&Bd(e,a,l),u===void 0?delete t[s.varName]:t[s.varName]=u;return}let c=0;const f=Number.isFinite(o)?o:null;for(;f==null||c<f;){const u=N_(s.condExpr,e,t);if(!Dg(u,e.diagnostics,`loop_cond_na:${s.lineNo}`))break;const h=ox(s.body,e,t);if(h==="break")break;c+=1}f!=null&&c>=f&&Bd(e,a,l)},o$=(s,e)=>{const t=e.locals?{...e.locals}:{},n=e.scalars??{};s.targets.forEach(r=>{const a=r.replace(/\s+/g,"_").toLowerCase();let l=e.series[a];l||(l=new Float32Array(e.length),l.fill(NaN),e.series[a]=l);const c=l[e.index];if(Number.isFinite(c))return;const f=n[a];if(typeof f=="number"&&Number.isFinite(f)){l[e.index]=f;return}if(e.index>0){const u=l[e.index-1];Number.isFinite(u)&&(l[e.index]=u)}}),s.kind==="for"?s.varName&&s.startExpr&&s.endExpr&&s.stepExpr&&nb({kind:"for",varName:s.varName,startExpr:s.startExpr,endExpr:s.endExpr,stepExpr:s.stepExpr,body:s.body,lineNo:s.lineNo??0},{...e,locals:t},t):s.condExpr&&nb({kind:"while",condExpr:s.condExpr,body:s.body,lineNo:s.lineNo??0},{...e,locals:t},t);const o={};return s.targets.forEach(r=>{const a=r.replace(/\s+/g,"_").toLowerCase(),l=e.series[a];o[a]=l?l[e.index]??NaN:NaN}),o},a_=(s,e,t)=>_r(s,{...e,locals:t,selfMode:"current"}),ob=(s,e,t,n,o,r)=>{const a=(l,c)=>Bd(e,l,c);for(const l of s){if(l.kind==="assign"){const c=l.name.replace(/\s+/g,"_").toLowerCase(),f=a_(l.expr,e,t);l.decl==="var"||l.decl==="varip"||o.has(c)?l.decl&&l.op==="="?(n.inited.has(c)||(n.vars[c]=f,n.inited.add(c)),t[c]=n.vars[c]??NaN):(!n.inited.has(c)&&l.op===":="&&a(`fn_var_uninit:${c}`,`Function var "${l.name}" is used before initialization`),n.vars[c]=f,n.inited.add(c),t[c]=f):(l.op===":="&&!Object.prototype.hasOwnProperty.call(t,c)&&a(`fn_local_uninit:${c}`,`Function local "${l.name}" is used before initialization`),t[c]=f);continue}if(l.kind==="return")return{kind:"return",value:a_(l.expr,e,t)};if(l.kind==="break"){if(!r){a(`fn_break_outside:${l.lineNo}`,"break used outside of a loop");continue}return{kind:"break"}}if(l.kind==="continue"){if(!r){a(`fn_continue_outside:${l.lineNo}`,"continue used outside of a loop");continue}return{kind:"continue"}}if(l.kind==="if"){let c=!1;for(const f of l.branches){if(c)break;if(f.cond){const d=a_(f.cond,e,t);if(!Dg(d,e.diagnostics,`fn_cond_na:${l.lineNo}`))continue}c=!0;const u=ob(f.body,e,t,n,o,r);if(u.kind!=="none")return u}continue}if(l.kind==="for"){const c=dk({kind:"for",varName:l.varName,startExpr:l.startExpr,endExpr:l.endExpr,stepExpr:l.stepExpr,body:l.body,lineNo:l.lineNo},e,t,n,o);if(c.kind==="return")return c;continue}if(l.kind==="while"){const c=dk({kind:"while",condExpr:l.condExpr,body:l.body,lineNo:l.lineNo},e,t,n,o);if(c.kind==="return")return c;continue}}return{kind:"none"}},dk=(s,e,t,n,o)=>{const r=e.loopRuntime,a=(r==null?void 0:r.maxIters)??Vx,l=(r==null?void 0:r.hasCustomMax)??!1,c=`fn_loop_max:${s.lineNo}`,f=`Loop exceeded max iterations (${a})`;if(s.kind==="for"){const h=s.varName.replace(/\s+/g,"_").toLowerCase(),p=Object.prototype.hasOwnProperty.call(t,h),v=t[h],x=a_(s.startExpr,e,t),S=a_(s.endExpr,e,t),C=a_(s.stepExpr,e,t);if(!Number.isFinite(C)||C===0)return Bd(e,`fn_loop_step_zero:${s.lineNo}`,"for-loop step must not be 0"),{kind:"none"};const I=PS(x,S,C),A=Number.isFinite(a)?a:null;let P=null,T=!1;l&&A!=null?I==null?(P=A,T=!0):(P=Math.min(A,I),T=I>A):I!=null&&(P=I);const j=C>0;let E=x,L=0;for(;(P==null||L<P)&&!(!Number.isFinite(E)||!Number.isFinite(S)||j&&E>S+1e-12||!j&&E<S-1e-12);){t[h]=E;const D=ob(s.body,e,t,n,o,!0);if(D.kind==="return")return D;if(D.kind==="break")break;E+=C,L+=1,D.kind}return T&&P!=null&&L>=P&&Bd(e,c,f),p?t[h]=v:delete t[h],{kind:"none"}}let u=0;const d=Number.isFinite(a)?a:null;for(;d==null||u<d;){const h=a_(s.condExpr,e,t);if(!Dg(h,e.diagnostics,`fn_loop_cond_na:${s.lineNo}`))break;const v=ob(s.body,e,t,n,o,!0);if(v.kind==="return")return v;if(v.kind==="break")break;u+=1,v.kind}return d!=null&&u>=d&&Bd(e,c,f),{kind:"none"}},MS=(s,e,t)=>{const n=t.funcRuntime;if(!n)return NaN;const o=n.callState.get(e)??(()=>{const f={vars:{},inited:new Set};return n.callState.set(e,f),f})();if(o.lastIndex===t.index)return o.lastValue??NaN;const r=s.name.toLowerCase();if(n.running.has(r))return Bd(t,`fn_recursion:${r}`,`Function "${s.name}" is recursive`),NaN;n.running.add(r);const a={};s.args.forEach((f,u)=>{const d=f.replace(/\s+/g,"_").toLowerCase(),h=e.args[u];a[d]=h?_r(h,t):NaN}),s.statefulVars.forEach(f=>{Object.prototype.hasOwnProperty.call(o.vars,f)&&(a[f]=o.vars[f])});const l=ob(s.body,t,a,o,s.statefulVars,!1);n.running.delete(r);const c=l.kind==="return"?l.value:NaN;return o.lastIndex=t.index,o.lastValue=c,c};function Wx(s){const e=s.match(/^(line|label|box|table)_get_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function NS(s){const e=s.match(/^strategy_(closedtrades|opentrades)_([a-z0-9_]+)$/i);return e?{kind:e[1].toLowerCase(),prop:e[2].toLowerCase()}:null}function Hx(s,e){return e?s==="session.isin"?"session_isin":s.startsWith("ta_")?s.slice(3):s.startsWith("math_")?s.slice(5):s:s}const i$={profit_pct:"profit_percent",pnl:"profit",net_pnl:"net_profit",net_pnl_pct:"net_profit_percent",net_pnl_percent:"net_profit_percent",fee:"fees",max_profit:"max_runup",max_profit_pct:"max_runup_percent",max_profit_percent:"max_runup_percent",max_runup_pct:"max_runup_percent",max_drawdown_pct:"max_drawdown_percent",max_loss:"max_drawdown",max_loss_pct:"max_drawdown_percent",max_loss_percent:"max_drawdown_percent"};function r$(s){const e=s.toLowerCase();return i$[e]??e}function AS(s,e,t,n,o){const r=r$(t),a=s.strategy;if(!a)return NaN;if(o<0)return NaN;if(e==="closedtrades"){const X=a.closedTrades||[];if(!X.length)return 0;const ne=s.series.strategy_closedtrades,de=ne?ne[n]:NaN,te=(typeof de=="number"&&Number.isFinite(de)?Math.floor(de):0)-1-o;if(te<0||te>=X.length)return 0;const le=X[te],pe=Number.isFinite(le.entryPrice)&&Number.isFinite(le.qty)&&le.entryPrice>0&&le.qty>0?le.entryPrice*le.qty:NaN,re=Number.isFinite(le.netPnl)?le.netPnl:Number.isFinite(le.pnl)?le.pnl-(le.fees??0):NaN,xe=Number.isFinite(pe)&&pe!==0?re/pe*100:NaN;switch(r){case"entry_price":return le.entryPrice;case"entry_time":return le.entryTimestamp;case"entry_bar_index":return le.entryIndex;case"exit_price":return le.exitPrice;case"exit_time":return le.exitTimestamp;case"exit_bar_index":return le.exitIndex;case"size":return le.qty;case"profit":return Number.isFinite(le.pnl)?le.pnl:0;case"profit_percent":return Number.isFinite(le.pnlPct)?le.pnlPct:0;case"net_profit":return Number.isFinite(re)?re:0;case"net_profit_percent":return Number.isFinite(xe)?xe:0;case"fees":return Number.isFinite(le.fees)?le.fees:0;case"entry_fee":return Number.isFinite(le.entryFee)?le.entryFee:0;case"exit_fee":return Number.isFinite(le.exitFee)?le.exitFee:0;case"max_runup":return typeof le.mfePct!="number"||!Number.isFinite(le.mfePct)?0:le.mfePct/100*le.entryPrice*le.qty;case"max_runup_percent":return typeof le.mfePct=="number"&&Number.isFinite(le.mfePct)?le.mfePct:0;case"max_drawdown":return typeof le.maePct!="number"||!Number.isFinite(le.maePct)?0:le.maePct/100*le.entryPrice*le.qty;case"max_drawdown_percent":return typeof le.maePct=="number"&&Number.isFinite(le.maePct)?le.maePct:0;case"is_long":return le.side==="long"?1:0;case"is_short":return le.side==="short"?1:0;case"entry_id":return Em(String(le.entryOrderId??le.entrySignalId??""));case"exit_id":return Em(String(le.exitOrderId??le.exitSignalId??""));default:return 0}}const l=a.openTradesByBar||[];if(n<0||n>=l.length)return 0;const c=l[n]||[];if(o>=c.length)return 0;const f=c[o],u=s.series.close,d=u&&Number.isFinite(u[n])?u[n]:NaN,h=f.qty,p=f.entryPrice,v=p>0&&h>0?p*h:NaN,x=typeof f.entryFee=="number"&&Number.isFinite(f.entryFee)?f.entryFee:0,S=Number.isFinite(d)&&Number.isFinite(p)?f.side==="long"?(d-p)*h:(p-d)*h:NaN,C=Number.isFinite(v)&&v!==0?S/v*100:NaN,I=Number.isFinite(S)&&Number.isFinite(x)?S-x:NaN,A=Number.isFinite(v)&&v!==0?I/v*100:NaN,P=f.maxFav,T=f.maxAdv,j=Number.isFinite(p)&&Number.isFinite(h)&&Number.isFinite(P)?f.side==="long"?(P-p)*h:(p-P)*h:NaN,E=Number.isFinite(p)&&p>0&&Number.isFinite(P)?f.side==="long"?(P-p)/p*100:(p-P)/p*100:NaN,L=Number.isFinite(p)&&Number.isFinite(h)&&Number.isFinite(T)?f.side==="long"?(T-p)*h:(p-T)*h:NaN,D=Number.isFinite(p)&&p>0&&Number.isFinite(T)?f.side==="long"?(T-p)/p*100:(p-T)/p*100:NaN;switch(r){case"entry_price":return p;case"entry_time":return f.entryTimestamp;case"entry_bar_index":return f.entryIndex;case"size":return h;case"profit":return Number.isFinite(S)?S:0;case"profit_percent":return Number.isFinite(C)?C:0;case"net_profit":return Number.isFinite(I)?I:0;case"net_profit_percent":return Number.isFinite(A)?A:0;case"fees":return Number.isFinite(x)?x:0;case"entry_fee":return Number.isFinite(x)?x:0;case"max_runup":return Number.isFinite(j)?j:0;case"max_runup_percent":return Number.isFinite(E)?E:0;case"max_drawdown":return Number.isFinite(L)?L:0;case"max_drawdown_percent":return Number.isFinite(D)?D:0;case"is_long":return f.side==="long"?1:0;case"is_short":return f.side==="short"?1:0;case"entry_id":return Em(String(f.entryOrderId??f.entrySignalId??""));default:return 0}}function _r(s,e){var n,o,r,a,l,c,f,u,d,h;const t=((n=e.scalars)==null?void 0:n.__pinev2)===1;switch(s.kind){case"NumberLiteral":return s.value;case"StringLiteral":return Em(s.value);case"Identifier":return uk(s.name,e);case"MemberExpression":{const p=m_(s);return p?uk(p,e):(Rx(e,s),NaN)}case"IndexExpression":return jx(e,s),NaN;case"UnaryExpression":{if(s.operator==="not"){const p=_r(s.expr,e);return t?J2(p):Number.isFinite(p)&&p!==0?0:1}return NaN}case"BinaryExpression":{if(s.operator==="and"||s.operator==="or"){if(t){const C=_r(s.left,e),I=B0(C);if(s.operator==="and"){if(I===0)return 0;const P=_r(s.right,e);return $_(C,P)}if(I===1)return 1;const A=_r(s.right,e);return D_(C,A)}const x=_r(s.left,e),S=_r(s.right,e);return s.operator==="and"?Number.isFinite(x)&&x!==0&&Number.isFinite(S)&&S!==0?1:0:Number.isFinite(x)&&x!==0||Number.isFinite(S)&&S!==0?1:0}const p=_r(s.left,e),v=_r(s.right,e);if(t&&yb(s.operator)&&(!Number.isFinite(p)||!Number.isFinite(v)))return NaN;switch(s.operator){case"+":return p+v;case"-":return p-v;case"*":return p*v;case"/":return p_(p,v,t,e);case"%":return v===0?NaN:p%v;case">":return Number.isFinite(p)&&Number.isFinite(v)&&p>v?1:0;case"<":return Number.isFinite(p)&&Number.isFinite(v)&&p<v?1:0;case">=":return Number.isFinite(p)&&Number.isFinite(v)&&p>=v?1:0;case"<=":return Number.isFinite(p)&&Number.isFinite(v)&&p<=v?1:0;case"==":return Number.isFinite(p)&&Number.isFinite(v)&&Math.abs(p-v)<1e-9?1:0;case"!=":return Number.isFinite(p)&&Number.isFinite(v)&&Math.abs(p-v)>=1e-9?1:0;default:return NaN}}case"CallExpression":{const p=e.funcRuntime;if(p){const P=p.funcs.get(s.callee.toLowerCase());if(P)return MS(P,s,e)}const v=Hx(s.callee.toLowerCase(),t);if(v==="__loop_exec"){const P=X=>X?X.kind==="StringLiteral"?X.value:X.kind==="Identifier"?X.name:null:null,T=P(s.args[0]);if(!T)return Bd(e,`loop_exec_missing:${jd(s)}`,"__loop_exec requires loop id"),NaN;const j=e.loopRuntime;if(!j)return Bd(e,`loop_runtime_missing:${T}`,"Loop runtime not configured"),NaN;const E=j.plans.get(T);if(!E)return Bd(e,`loop_missing:${T}`,`Unknown loop "${T}"`),NaN;if(E.lastIndex!==e.index){if(j.running.has(T))return Bd(e,`loop_recursion:${T}`,`Loop "${T}" is recursive`),NaN;j.running.add(T);const X=o$(E,e);E.lastIndex=e.index,E.lastValues=X,j.running.delete(T)}const L=P(s.args[1]);if(!L)return 0;const D=L.replace(/\s+/g,"_").toLowerCase();return((o=E.lastValues)==null?void 0:o[D])??NaN}const x=Wx(v);if(x&&e.draw){const P=s.args[0];let T="";if(P&&P.kind==="Identifier"&&(T=P.name),P&&P.kind==="StringLiteral"&&(T=P.value),!T)return NaN;const j=e.draw.get(x.kind,x.prop,T,e.index);return typeof j=="string"?Em(j):typeof j=="number"&&Number.isFinite(j)?j:NaN}const S=NS(v);if(S){if(!e.strategy)return NaN;if(!s.args.length)throw new Pt(`${s.callee} expects (index)`);const P=_r(s.args[0],e),T=Number.isFinite(P)?Math.floor(P):NaN;return Number.isFinite(T)?AS(e,S.kind,S.prop,e.index,T):NaN}const C=s.args[0],I=s.args[1];if(v==="__hist_index"||v==="__arr_index"){if(s.args.length!==1)throw new Pt(`${s.callee} expects (index)`);const P=_r(C,e);return t?N0(P,v==="__hist_index"?"history_index":"array_index",v==="__hist_index"?C1:Z3,e):P}if(v==="__arr_index_str"){if(s.args.length!==1)throw new Pt(`${s.callee} expects (index)`);const P=_r(C,e);if(!t)return P;const T=`arr_idx_str:${jd(s)}`;return tb(P,T,e)}if(v==="__arr_set_guard"){if(s.args.length!==2)throw new Pt(`${s.callee} expects (index, size)`);if(!t)return 1;const P=_r(C,e),T=_r(I,e),j=`arr_set_guard:${jd(s)}`;return tx(P,T,j,e)}if(v==="__arr_str_valid"){if(s.args.length!==1)throw new Pt(`${s.callee} expects (value)`);if(!t)return 1;const P=dg(s.args[0]);return P||Bd(e,`arr_str_val:${jd(s)}`,J3),P?1:0}if(v==="__str_num"){if(s.args.length!==1)throw new Pt(`${s.callee} expects (value)`);return _r(C,e)}if(v==="nz"){if(s.args.length<1||s.args.length>2)throw new Pt("nz expects (x[, fallback])");const P=_r(C,e);return Number.isFinite(P)?P:s.args.length===2?_r(I,e):0}if(v==="between"){if(s.args.length!==3)throw new Pt("between expects (x, a, b)");const P=_r(C,e),T=_r(I,e),j=_r(s.args[2],e);if(!Number.isFinite(P)||!Number.isFinite(T)||!Number.isFinite(j))return t?NaN:0;const E=Math.min(T,j),L=Math.max(T,j);return P>=E&&P<=L?1:0}if(v==="above"||v==="below"){if(s.args.length<2||s.args.length>3)throw new Pt(`${s.callee} expects (a, b[, tol])`);const P=_r(C,e),T=_r(I,e),j=s.args.length===3?_r(s.args[2],e):0,E=Number.isFinite(j)?Math.max(0,j):0;return!Number.isFinite(P)||!Number.isFinite(T)?t?NaN:0:v==="above"?P>T+E?1:0:P<T-E?1:0}if(v==="higherhigh"){const P=s.args.length>=1?Math.max(1,Math.floor(_r(s.args[0],e))):1,T=e.series.high;if(!T)throw new Pt("higherhigh requires high series");const j=T[e.index];if(!Number.isFinite(j))return t?NaN:0;const E=Math.max(0,e.index-P),L=j3(T,E,Math.max(0,e.index-1));return j>L?1:0}if(v==="lowerlow"){const P=s.args.length>=1?Math.max(1,Math.floor(_r(s.args[0],e))):1,T=e.series.low;if(!T)throw new Pt("lowerlow requires low series");const j=T[e.index];if(!Number.isFinite(j))return t?NaN:0;const E=Math.max(0,e.index-P),L=B3(T,E,Math.max(0,e.index-1));return j<L?1:0}if(v==="swinghigh"){const P=s.args.length>=1?Math.max(1,Math.floor(_r(s.args[0],e))):3,T=e.series.high;if(!T)throw new Pt("swinghigh requires high series");const j=T[e.index];if(!Number.isFinite(j))return t?NaN:0;for(let E=e.index-P;E<=e.index+P;E++){if(E===e.index||E<0||E>=T.length)continue;const L=T[E];if(Number.isFinite(L)&&L>=j)return 0}return 1}if(v==="swinglow"){const P=s.args.length>=1?Math.max(1,Math.floor(_r(s.args[0],e))):3,T=e.series.low;if(!T)throw new Pt("swinglow requires low series");const j=T[e.index];if(!Number.isFinite(j))return t?NaN:0;for(let E=e.index-P;E<=e.index+P;E++){if(E===e.index||E<0||E>=T.length)continue;const L=T[E];if(Number.isFinite(L)&&L<=j)return 0}return 1}if(v==="volspike"){const P=s.args.length>=1?Math.max(1,_r(s.args[0],e)):1,T=e.series.volume;if(!T)throw new Pt("volspike requires volume series");const j=T[e.index];if(!Number.isFinite(j))return t?NaN:0;const L=Math.max(0,e.index-20+1);let D=0,X=0;for(let de=L;de<=e.index;de++){const ie=T[de];Number.isFinite(ie)&&(D+=ie,X+=1)}const ne=X?D/X:NaN;return Number.isFinite(ne)&&j>P*ne?1:0}if(v==="atrspike"){const P=s.args.length>=1?Math.max(1,_r(s.args[0],e)):1,T=e.series.high,j=e.series.low,E=e.series.close;if(!T||!j||!E)throw new Pt("atrspike requires high/low/close series");const L=te=>{const le=T[te],pe=j[te],re=te>0?E[te-1]:NaN;let xe=Number.isFinite(le)&&Number.isFinite(pe)?Math.max(0,le-pe):NaN;return Number.isFinite(re)&&(xe=Math.max(xe,Math.abs(le-re),Math.abs(pe-re))),xe};let D=NaN,X=0;for(let te=0;te<=e.index;te++){const le=L(te);X+=Number.isFinite(le)?le:0,te===13?D=X/14:te>=14&&(D=(D*13+le)/14)}let ne=NaN,de=0,ie=0;for(let te=Math.max(0,e.index-13);te<=e.index;te++){const le=L(te);Number.isFinite(le)&&(de+=le,ie+=1)}return ie&&(ne=de/ie),Number.isFinite(D)&&Number.isFinite(ne)&&D>P*ne?1:0}if(v==="trend"){const P=s.args[0],T=P&&P.kind==="StringLiteral"?P.value:P&&P.kind==="Identifier"?P.name:"",j=String(T||"").toLowerCase()||"up",E=e.series.close;if(!E)throw new Pt("trend requires close series");const D=Math.max(0,e.index-10+1);let X=0,ne=0,de=0,ie=0,te=0;for(let re=D;re<=e.index;re++){const xe=re-D,se=E[re];Number.isFinite(se)&&(X+=xe,ne+=se,de+=xe*xe,ie+=xe*se,te+=1)}const le=te*de-X*X,pe=le===0||te===0?0:(te*ie-X*ne)/le;return j==="up"?pe>0?1:0:pe<0?1:0}if(v==="iff"||v==="iif"||v==="if"){if(s.args.length!==3)throw new Pt(`${s.callee} expects (cond, a, b)`);if(t){const ne=z_(s.args[1]),de=z_(s.args[2]);if(ne!==de)return Bd(e,"ternary_type",X3),NaN}const P=s.args[0],T=t&&dg(P),j=t?F0(P,e,"na"):void 0;T&&Bd(e,F0(P,e,"type"),Qy);const E=_r(C,e),L=T?!1:Q2(E,e,j),D=_r(s.args[1],e),X=_r(s.args[2],e);return L?D:X}if(v==="tostring"||v==="format"||v==="upper"||v==="lower"||v==="trim"||v==="replace"||v==="replace_all"||v==="contains"||v==="startswith"||v==="endswith"||v==="length"||v==="substring"||v==="repeat"){const P=E=>Number.isFinite(E)?String(E):"",T=E=>Em(E),j=E=>{var X;const L=s.args[E];if(!L)return"";if(L.kind==="StringLiteral")return L.value;if(L.kind==="Identifier"){const ne=L.name.replace(/\s+/g,"_").toLowerCase(),de=(X=e.strings)==null?void 0:X[ne];if(typeof de=="string")return de}const D=_r(L,e);return P(D)};if(v==="tostring"){if(s.args.length<1||s.args.length>2)throw new Pt("tostring expects (x[, format])");const E=_r(s.args[0],e),L=s.args[1];let D="";if(L){if(L.kind==="StringLiteral")D=L.value;else if(L.kind==="Identifier"){const ne=L.name.replace(/\s+/g,"_").toLowerCase(),de=(r=e.strings)==null?void 0:r[ne];typeof de=="string"&&(D=de)}}const X=U2(E,D||void 0);return T(X)}if(v==="format"){if(s.args.length<1)throw new Pt("format expects (fmt, ...)");const E=j(0),L=s.args.slice(1).map(X=>j1(_r(X,e))),D=E.replace(/\{(\d+)\}/g,(X,ne)=>L[Number(ne)]??"");return T(D.replace(/{{/g,"{").replace(/}}/g,"}"))}if(v==="upper")return T(j(0).toUpperCase());if(v==="lower")return T(j(0).toLowerCase());if(v==="trim")return T(j(0).trim());if(v==="replace"||v==="replace_all"){if(s.args.length<3)throw new Pt("replace expects (s, from, to)");const E=j(0),L=j(1),D=j(2);return T(E.split(L).join(D))}if(v==="contains"){if(s.args.length<2)throw new Pt("contains expects (s, sub)");const E=j(0),L=j(1);return E.includes(L)?1:0}if(v==="startswith"){if(s.args.length<2)throw new Pt("startswith expects (s, sub)");const E=j(0),L=j(1);return E.startsWith(L)?1:0}if(v==="endswith"){if(s.args.length<2)throw new Pt("endswith expects (s, sub)");const E=j(0),L=j(1);return E.endsWith(L)?1:0}if(v==="length"){if(s.args.length!==1)throw new Pt("length expects (s)");return j(0).length}if(v==="substring"){if(s.args.length<2)throw new Pt("substring expects (s, from[, to])");const E=j(0),L=_r(s.args[1],e),D=s.args.length>2?_r(s.args[2],e):NaN,X=Math.max(0,Math.floor(L)),ne=Number.isFinite(D)?Math.max(X,Math.floor(D)):void 0;return T(ne==null?E.slice(X):E.slice(X,ne))}if(v==="repeat"){if(s.args.length<2)throw new Pt("repeat expects (s, count)");const E=j(0),L=Math.max(0,Math.floor(_r(s.args[1],e)));return T(E.repeat(L))}}if(v==="add"||v==="sub"||v==="mul"||v==="div"){if(s.args.length!==2)throw new Pt(`${s.callee} expects 2 arguments`);const P=_r(C,e),T=_r(I,e);return v==="add"?P+T:v==="sub"?P-T:v==="mul"?P*T:p_(P,T,t,e)}if(v==="mod"||v==="fmod"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==2)throw new Pt(`${s.callee} expects 2 arguments`);const P=_r(C,e),T=_r(I,e);return v==="mod"?hS(P,T,!0,e):pS(P,T,!0,e)}if(v==="min"||v==="max"){if(s.args.length!==2)throw new Pt(`${s.callee} expects 2 arguments`);const P=_r(C,e),T=_r(I,e);return v==="min"?Math.min(P,T):Math.max(P,T)}if(v==="abs"){if(s.args.length!==1)throw new Pt("abs expects 1 argument");return Math.abs(_r(C,e))}if(v==="pow"){if(s.args.length!==2)throw new Pt("pow expects 2 arguments");const P=_r(C,e),T=_r(I,e);return ex(P,T,t,e)}if(v==="sqrt"||v==="log"||v==="ln"||v==="log10"||v==="exp"||v==="floor"||v==="ceil"||v==="round"||v==="sin"||v==="cos"||v==="tan"||v==="asin"||v==="acos"||v==="atan"||v==="sign"){if(s.args.length!==1)throw new Pt(`${s.callee} expects 1 argument`);const P=_r(C,e);switch(v){case"sqrt":return mS(P,t,e);case"log":case"ln":return vS(P,t,e);case"log10":return gS(P,t,e);case"exp":return xS(P,t);case"floor":return Math.floor(P);case"ceil":return Math.ceil(P);case"round":return Math.round(P);case"sin":return Math.sin(P);case"cos":return Math.cos(P);case"tan":return bS(P,t);case"asin":return _S(P,t,e);case"acos":return yS(P,t,e);case"atan":return Math.atan(P);default:return Math.sign(P)}}if(v==="cum"||v==="cumsum"){if(s.args.length!==1)throw new Pt(`${s.callee} expects 1 argument`);const P=C;if(P.kind!=="Identifier")throw new Pt(`${s.callee} expects a series identifier`);const T=P.name.replace(/\s+/g,"_").toLowerCase(),j=e.series[T];if(!j)throw new Pt(`Unknown identifier "${P.name}"`);let E=0;for(let L=0;L<=e.index;L++){const D=j[L];Number.isFinite(D)&&(E+=D)}return E}if(v==="barssince"){if(s.args.length!==1)throw new Pt("barssince expects (condition)");const P=C;if(P.kind!=="Identifier")throw new Pt("barssince expects a series identifier");const T=P.name.replace(/\s+/g,"_").toLowerCase(),j=e.series[T];if(!j)throw new Pt(`Unknown identifier "${P.name}"`);for(let E=e.index;E>=0;E--){const L=j[E];if(Number.isFinite(L)&&L!==0)return e.index-E}return NaN}if(v==="tr"){if(s.args.length!==0&&s.args.length!==3)throw new Pt("tr expects () or (high, low, close)");const P=(de,ie)=>{if(!de){const pe=e.series[ie];if(!pe)throw new Pt(`Unknown identifier "${ie}"`);return pe}if(de.kind!=="Identifier")throw new Pt("tr expects series identifiers");const te=de.name.replace(/\s+/g,"_").toLowerCase(),le=e.series[te];if(!le)throw new Pt(`Unknown identifier "${de.name}"`);return le},T=P(s.args[0],"high"),j=P(s.args[1],"low"),E=P(s.args[2],"close"),L=T[e.index],D=j[e.index],X=e.index>0?E[e.index-1]:NaN;let ne=Math.max(0,L-D);return Number.isFinite(X)&&(ne=Math.max(ne,Math.abs(L-X),Math.abs(D-X))),ne}if(v==="prev"||v==="lag"||v==="change"){if(s.args.length!==2)throw new Pt(`${s.callee} expects (series, n)`);const P=C;if(P.kind!=="Identifier")throw new Pt(`${s.callee} expects first argument to be a series identifier`);const T=P.name.replace(/\s+/g,"_").toLowerCase(),j=_r(I,e),E=t?N0(j,"history_index",C1,e):Math.max(1,Math.floor(j));if(!Number.isFinite(E))return NaN;const L=e.index-E,D=de=>{if(de<0)return NaN;if(e.selfKey&&e.selfOut&&T===e.selfKey)return e.selfOut[de]??NaN;const ie=e.series[T];if(!ie)throw new Pt(`Unknown identifier "${P.name}"`);return ie[de]??NaN};if(v==="prev"||v==="lag")return D(L);const X=D(e.index),ne=D(L);return Number.isFinite(X)&&Number.isFinite(ne)?X-ne:NaN}if(v==="sum"){if(s.args.length!==2)throw new Pt("sum expects (series, period)");const P=S0(C,e);if(!P)throw new Pt("sum expects first argument to be a series identifier");const T=_r(I,e),j=t?eh(T,`sum_len:${jd(s)}`,uS,e):Math.max(1,Math.floor(T));return Number.isFinite(j)?kv(e,`sum:${j}:${jd(C)}`,()=>ov(P,j))[e.index]??NaN:NaN}if(v==="highest"||v==="lowest"){if(s.args.length!==2)throw new Pt(`${s.callee} expects (series, period)`);const P=S0(C,e);if(!P)throw new Pt(`${s.callee} expects first argument to be a series identifier`);const T=_r(I,e),j=`${v}_len:${jd(s)}`,L=t?eh(T,j,v==="highest"?lS:cS,e):Math.max(1,Math.floor(T));return Number.isFinite(L)?kv(e,`${v}:${L}:${jd(C)}`,()=>v==="highest"?V_(P,L):W_(P,L))[e.index]??NaN:NaN}if(v==="rising"||v==="falling"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==2)throw new Pt(`${s.callee} expects (series, length)`);const P=S0(C,e);if(!P)throw new Pt(`${s.callee} expects first argument to be a series identifier`);const T=_r(I,e),j=`${v}_len:${jd(s)}`,L=eh(T,j,v==="rising"?dS:fS,e);return Number.isFinite(L)?kv(e,`${v}:${L}:${jd(C)}`,()=>R3(P,L,v))[e.index]??NaN:NaN}if(v==="crossover"||v==="crossunder"){if(s.args.length<2||s.args.length>3)throw new Pt(`${s.callee} expects (series, series[, tol])`);const P=C;if(P.kind!=="Identifier")throw new Pt(`${s.callee} expects first argument to be a series identifier`);const T=P.name.replace(/\s+/g,"_").toLowerCase(),j=e.series[T];if(!j)throw new Pt(`Unknown identifier "${P.name}"`);const E=s.args[1];let L=null,D=NaN;if(E.kind==="Identifier"){const le=E.name.replace(/\s+/g,"_").toLowerCase();if(L=e.series[le]||null,!L){const pe=Number(E.name);D=Number.isFinite(pe)?pe:NaN}}else D=_r(E,e);const X=s.args[2]?Math.max(0,_r(s.args[2],e)):0;if(e.index<=0)return 0;const ne=j[e.index-1],de=j[e.index],ie=L?L[e.index-1]:D,te=L?L[e.index]:D;return[ne,de,ie,te].every(Number.isFinite)?v==="crossover"?ne<=ie+X&&de>te+X?1:0:ne>=ie-X&&de<te-X?1:0:0}if(v==="williamsr"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==1&&s.args.length!==4)throw new Pt("williamsr expects (length) or (high, low, close, length)");const P=s.args.length===1?_r(s.args[0],e):_r(s.args[3],e),T=eh(P,"williamsr_len",Q3,e);if(!Number.isFinite(T))return NaN;const j=s.args.length===1?e.series.high:S0(s.args[0],e),E=s.args.length===1?e.series.low:S0(s.args[1],e),L=s.args.length===1?e.series.close:S0(s.args[2],e);if(!j||!E||!L)throw new Pt("williamsr requires high/low/close series");const D=s.args.length===1?`williamsr:${T}`:`williamsr:${T}:${s.args.map(ne=>ne.kind==="Identifier"?ne.name:ne.kind==="NumberLiteral"||ne.kind==="StringLiteral"?ne.value:"expr").join("|")}`;return kv(e,D,()=>O3(j,E,L,T))[e.index]??NaN}if(v==="aroon"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length<1||s.args.length>2)throw new Pt("aroon expects (length[, output])");const P=_r(s.args[0],e),T=eh(P,"aroon_len",eS,e);if(!Number.isFinite(T))return NaN;const j=s.args[1]?Math.floor(_r(s.args[1],e)):0;if(!Number.isFinite(j)||j<0||j>1)throw new Pt("aroon output must be 0 or 1");const E=e.series.high,L=e.series.low;if(!E||!L)throw new Pt("aroon requires high/low series");const D=`aroon:${T}`,X=sb(e,D,()=>{const de=Zy(E,L,T);return{a:de.up,b:de.down}});return(j===0?X.a:X.b)[e.index]??NaN}if(v==="aroonosc"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==1)throw new Pt("aroonosc expects (length)");const P=_r(s.args[0],e),T=eh(P,"aroonosc_len",aS,e);if(!Number.isFinite(T))return NaN;const j=e.series.high,E=e.series.low;if(!j||!E)throw new Pt("aroonosc requires high/low series");const L=`aroon:${T}`,D=sb(e,L,()=>{const de=Zy(j,E,T);return{a:de.up,b:de.down}}),X=D.a[e.index],ne=D.b[e.index];return Number.isFinite(X)&&Number.isFinite(ne)?X-ne:NaN}if(v==="dmi"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length<2||s.args.length>3)throw new Pt("dmi expects (length, smoothing[, output])");const P=_r(s.args[0],e),T=_r(s.args[1],e),j=eh(P,"dmi_len",tS,e),E=eh(T,"dmi_smooth",sS,e);if(!Number.isFinite(j)||!Number.isFinite(E))return NaN;const L=s.args[2]?Math.floor(_r(s.args[2],e)):0;if(!Number.isFinite(L)||L<0||L>2)throw new Pt("dmi output must be 0, 1, or 2");const D=e.series.high,X=e.series.low,ne=e.series.close;if(!D||!X||!ne)throw new Pt("dmi requires high/low/close series");const de=`dmi:${j}:${E}`,ie=Fy(e,de,()=>{const le=M0(D,X,ne,j,E);return{a:le.plus,b:le.minus,c:le.adx}});return(L===0?ie.a:L===1?ie.b:ie.c)[e.index]??NaN}if(v==="plus_di"||v==="minus_di"||v==="dx"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==1)throw new Pt(`${s.callee} expects (length)`);const P=_r(s.args[0],e),E=eh(P,v==="plus_di"?"plus_di_len":v==="minus_di"?"minus_di_len":"dx_len",v==="plus_di"?oS:v==="minus_di"?iS:rS,e);if(!Number.isFinite(E))return NaN;const L=e.series.high,D=e.series.low,X=e.series.close;if(!L||!D||!X)throw new Pt(`${v} requires high/low/close series`);const ne=`dmi:${E}:${E}`,de=Fy(e,ne,()=>{const te=M0(L,D,X,E,E);return{a:te.plus,b:te.minus,c:te.adx}});return v==="plus_di"?de.a[e.index]??NaN:v==="minus_di"?de.b[e.index]??NaN:kv(e,`dx:${E}`,()=>z3(de.a,de.b))[e.index]??NaN}if(v==="adx"){if(!t)throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==1)throw new Pt("adx expects (length)");const P=_r(s.args[0],e),T=eh(P,"adx_len",nS,e);if(!Number.isFinite(T))return NaN;const j=e.series.high,E=e.series.low,L=e.series.close;if(!j||!E||!L)throw new Pt("adx requires high/low/close series");const D=`dmi:${T}:${T}`;return Fy(e,D,()=>{const ne=M0(j,E,L,T,T);return{a:ne.plus,b:ne.minus,c:ne.adx}}).c[e.index]??NaN}if(v==="valuewhen"){if(!(((a=e.scalars)==null?void 0:a.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==3)throw new Pt("valuewhen expects (condition, source, occurrence)");const T=s.args[0],j=dg(T);j&&Bd(e,F0(T,e,"type"),Qy);const E=s.args[2],L=`valuewhen_occ:${jd(s)}`;if(bE(E,e))return Bd(e,L,eb),NaN;const D=_r(E,e),X=N0(D,L,eb,e);if(!Number.isFinite(X)||j)return NaN;const ne=F0(T,e,"na"),de=pe=>Dg(pe,e.diagnostics,ne),ie=S0(T,e),te=S0(s.args[1],e);if(ie&&te)return kv(e,`valuewhen:${X}:${jd(T)}:${jd(s.args[1])}`,()=>V3(ie,te,X,de))[e.index]??NaN;let le=0;for(let pe=e.index;pe>=0;pe--){const re={...e,index:pe},xe=_r(T,re);if(de(xe)){if(le===X)return _r(s.args[1],re);le+=1}}return NaN}if(v==="pivothigh"||v==="pivotlow"){if(!(((l=e.scalars)==null?void 0:l.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==3)throw new Pt(`${s.callee} expects (source, left, right)`);const T=_r(s.args[1],e),j=_r(s.args[2],e),{left:E,right:L}=W3(T,j),D=e.index-L;if(D-E<0)return NaN;const X=le=>_r(s.args[0],{...e,index:le}),ne=X(D);if(!Number.isFinite(ne))return NaN;const de=D-E,ie=D+L,te=v==="pivothigh";for(let le=de;le<=ie;le++){const pe=X(le);if(!Number.isFinite(pe))return NaN;if(te){if(pe>ne)return NaN}else if(pe<ne)return NaN}return ne}if(v==="isin"||v==="session_isin"||v==="session.isin"){if(!(((c=e.scalars)==null?void 0:c.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==2)throw new Pt("session.isin expects (time, session)");const T=s.args[1];if(!T||T.kind!=="StringLiteral")throw new Pt(Jy);const{start:j,end:E}=K3(T.value),L=_r(s.args[0],e);if(!Number.isFinite(L))throw new Pt(K2);const D=X2(L);return Z2(D,j,E)?1:0}if(v==="year"||v==="month"||v==="dayofweek"||v==="hour"||v==="minute"||v==="second"){if(!(((f=e.scalars)==null?void 0:f.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==1)throw new Pt(`${s.callee} expects (time)`);const T=_r(s.args[0],e);return P0(T),v==="dayofweek"?G2(T):Y2(T,v==="year"||v==="month"?v:v==="hour"?"hour":v==="minute"?"minute":"second")}if(v==="timestamp"){if(!(((u=e.scalars)==null?void 0:u.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length<5||s.args.length>6)throw new Pt("timestamp expects (year, month, day, hour, minute[, second])");const T=_r(s.args[0],e),j=_r(s.args[1],e),E=_r(s.args[2],e),L=_r(s.args[3],e),D=_r(s.args[4],e),X=s.args[5]?_r(s.args[5],e):0;return U3(T,j,E,L,D,X)}if(v==="timenow"){if(!(((d=e.scalars)==null?void 0:d.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==0)throw new Pt("timenow expects ()");return Y3(e)}if(v==="time_close"){if(!(((h=e.scalars)==null?void 0:h.__pinev2)===1))throw new Pt(`Unknown function "${s.callee}"`);if(s.args.length!==0)throw new Pt("time_close expects ()");const T=e.series.time;if(!T)throw new Pt("time_close requires time series");const j=G3(e),E=T[e.index];return Number.isFinite(E)?E+j:NaN}const A={length:e.length,series:e.series,seriesNames:new Set(Object.keys(e.series)),scalars:e.scalars,strings:e.strings,diagnostics:e.diagnostics,draw:e.draw,strategy:e.strategy,loopRuntime:e.loopRuntime,funcRuntime:e.funcRuntime};try{const P=`call:${jd(s)}`;return kv(e,P,()=>{const j=IS(s,A);if(j.kind==="series")return j.value;const E=new Float32Array(e.length);return E.fill(j.value),E})[e.index]??NaN}catch(P){if(P instanceof Pt)throw P}throw new Pt(`Unknown function "${s.callee}"`)}default:return NaN}}function fk(s,e,t,n,o){var C;const r=Object.entries(e),a=((C=r[0])==null?void 0:C[1].length)??0;for(const[,I]of r)if(I.length!==a)throw new Pt("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,P])=>{const T=A.replace(/\s+/g,"_").toLowerCase();if(typeof P=="number"&&Number.isFinite(P)){I[T]=P;return}if(typeof P=="string"){const j=Number(P);I[T]=Number.isFinite(j)?j:Em(P)}}),Object.keys(I).length?I:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,P])=>{typeof P=="string"&&(I[A.replace(/\s+/g,"_").toLowerCase()]=P)}),Object.keys(I).length?I:void 0})(),f=s.map(I=>{const A=I.name.replace(/\s+/g,"_").toLowerCase();try{const P=I.initExpr?Ep(I.initExpr):null,T=Ep(I.updateExpr);return{name:A,initAst:P,updateAst:T,initExpr:I.initExpr,updateExpr:I.updateExpr,selfMode:I.selfMode}}catch(P){throw P instanceof rv?new Pt(`Syntax error in series "${I.name}" at position ${P.position}: ${P.message}`):P}}),u=(()=>{if(!(o!=null&&o.autoSort)||f.length<=1)return f;const I=new Set(f.map(te=>te.name)),A={},P={},T=new Map;f.forEach((te,le)=>{A[te.name]=new Set,P[te.name]=new Set,T.set(te.name,le)});const j=te=>te.replace(/\s+/g,"_").toLowerCase(),E=te=>{const le=new Set,pe=(re,xe)=>{switch(re.kind){case"Identifier":{const se=j(re.name);xe||le.add(se);break}case"BinaryExpression":pe(re.left,xe),pe(re.right,xe);break;case"UnaryExpression":pe(re.expr,xe);break;case"CallExpression":{const se=String(re.callee||"").toLowerCase(),Ne=se==="prev"||se==="lag";re.args.forEach((Te,Me)=>{pe(Te,xe||Ne&&Me===0)});break}}};return te&&pe(te,!1),{direct:le}},L=(te,le)=>{if(!le)return;const{direct:pe}=E(le);pe.forEach(re=>{!I.has(re)||re===te||(A[te].add(re),P[re].add(te))})};f.forEach(te=>{L(te.name,te.updateAst),L(te.name,te.initAst)});const D={};Object.keys(A).forEach(te=>{var le;D[te]=((le=A[te])==null?void 0:le.size)??0});const X=Object.keys(D).filter(te=>(D[te]||0)===0);X.sort((te,le)=>(T.get(te)??0)-(T.get(le)??0));const ne=[],de=te=>{const le=X.findIndex(pe=>(T.get(pe)??0)>(T.get(te)??0));le===-1?X.push(te):X.splice(le,0,te)};for(;X.length;){const te=X.shift();ne.push(te);const le=Array.from(P[te]||[]).sort((pe,re)=>(T.get(pe)??0)-(T.get(re)??0));for(const pe of le)D[pe]=(D[pe]||0)-1,D[pe]===0&&de(pe)}if(ne.length!==f.length){const te=f.map(le=>le.name).filter(le=>!ne.includes(le));throw new Pt(`Circular dependency detected among state series: ${te.join(" -> ")}`)}const ie={};return f.forEach(te=>{ie[te.name]=te}),ne.map(te=>ie[te])})(),d={},h={...e},p=new Set(Object.keys(e));for(const I of f){if(p.has(I.name))throw new Pt(`Series name "${I.name}" conflicts with an existing base series`);if(h[I.name])d[I.name]||(d[I.name]=h[I.name]);else{const A=new Float32Array(a);A.fill(NaN),h[I.name]=A,d[I.name]=A}}const v=o==null?void 0:o.diagnostics,x=bb(o==null?void 0:o.loopPlans,l,!!(o!=null&&o.userFunctions)),S=xb(o==null?void 0:o.userFunctions);for(let I=0;I<a;I++)for(const A of u){const P=d[A.name],T={series:h,scalars:l,strings:c,diagnostics:v,length:a,index:I,selfKey:A.name,selfOut:P,selfMode:A.selfMode,strategy:n,loopRuntime:x,funcRuntime:S},j=I===0&&A.initAst?A.initAst:A.updateAst,E=_r(j,T);P[I]=E}return d}function ay(s,e,t,n,o,r){var x;const a=Object.entries(e),l=((x=a[0])==null?void 0:x[1].length)??0;for(const[,S]of a)if(S.length!==l)throw new Pt("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const S={};return Object.entries(t).forEach(([C,I])=>{const A=C.replace(/\s+/g,"_").toLowerCase();if(typeof I=="number"&&Number.isFinite(I)){S[A]=I;return}if(typeof I=="string"){const P=Number(I);S[A]=Number.isFinite(P)?P:Em(I)}}),Object.keys(S).length?S:void 0})(),f=(()=>{if(!t||typeof t!="object")return;const S={};return Object.entries(t).forEach(([C,I])=>{typeof I=="string"&&(S[C.replace(/\s+/g,"_").toLowerCase()]=I)}),Object.keys(S).length?S:void 0})(),u=bb(r==null?void 0:r.loopPlans,c,!!(r!=null&&r.userFunctions)),d=xb(r==null?void 0:r.userFunctions);let h;try{h=Ep(s)}catch(S){throw S instanceof rv?new Pt(`Syntax error at position ${S.position}: ${S.message}`):S}const p=new Float32Array(l),v=new Map;for(let S=0;S<l;S++){const C={series:e,scalars:c,strings:f,diagnostics:o,memo:v,length:l,index:S,strategy:n,loopRuntime:u,funcRuntime:d};p[S]=_r(h,C)}return p}function a$(s,e,t,n,o,r,a,l){var C;const c=Object.entries(e),f=((C=c[0])==null?void 0:C[1].length)??0;if(n<0||n>=f)return NaN;for(const[,I]of c)if(I.length!==f)throw new Pt("All base series must have the same length");const u=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,P])=>{const T=A.replace(/\s+/g,"_").toLowerCase();if(typeof P=="number"&&Number.isFinite(P)){I[T]=P;return}if(typeof P=="string"){const j=Number(P);I[T]=Number.isFinite(j)?j:Em(P)}}),Object.keys(I).length?I:void 0})(),d=(()=>{if(!t||typeof t!="object")return;const I={};return Object.entries(t).forEach(([A,P])=>{typeof P=="string"&&(I[A.replace(/\s+/g,"_").toLowerCase()]=P)}),Object.keys(I).length?I:void 0})(),h=bb(l==null?void 0:l.loopPlans,u,!!(l!=null&&l.userFunctions)),p=xb(l==null?void 0:l.userFunctions);let v;if(typeof s=="string")try{v=Ep(s)}catch(I){throw I instanceof rv?new Pt(`Syntax error at position ${I.position}: ${I.message}`):I}else v=s;return _r(v,{series:e,scalars:u,strings:d,diagnostics:a,memo:new Map,length:f,index:n,draw:o,strategy:r,loopRuntime:h,funcRuntime:p})}function pk(s,e){var a,l;const t=s.replace(/\s+/g,"_").toLowerCase();if(t==="na"||t==="nan")return NaN;if(t==="pi")return Math.PI;if(t==="e")return Math.E;if(e.locals&&Object.prototype.hasOwnProperty.call(e.locals,t))return e.locals[t];const n=e.series[t];if(n)return n[e.index]??NaN;const o=(a=e.strings)==null?void 0:a[t];if(typeof o=="string")return o;const r=(l=e.scalars)==null?void 0:l[t];if(typeof r=="number"&&Number.isFinite(r))return r;throw new Pt(`Unknown identifier "${s}"`)}function rp(s,e,t,n){var f;const o=((f=t.scalars)==null?void 0:f.__pinev2)===1,r=u=>typeof u=="number"?u:Em(u),a=u=>typeof u=="string"?u:Number.isFinite(u)?String(u):"",l=(u,d)=>typeof u=="string"?u:U2(u,d),c=u=>{let d=n.get(u);return d||(d=ug(u,t),n.set(u,d)),d.kind==="scalar"?d.value:d.value[e.index]??NaN};switch(s.kind){case"NumberLiteral":return s.value;case"StringLiteral":return s.value;case"Identifier":return pk(s.name,e);case"MemberExpression":{const u=m_(s);return u?pk(u,e):(Rx(t,s),NaN)}case"IndexExpression":return jx(t,s),NaN;case"UnaryExpression":{if(s.operator==="not"){const u=r(rp(s.expr,e,t,n));return Number.isFinite(u)&&u!==0?0:1}return NaN}case"BinaryExpression":{const u=rp(s.left,e,t,n),d=rp(s.right,e,t,n);if(s.operator==="+")return typeof u=="string"||typeof d=="string"?`${a(u)}${a(d)}`:r(u)+r(d);const h=r(u),p=r(d);if(o&&yb(s.operator)&&(!Number.isFinite(h)||!Number.isFinite(p)))return NaN;switch(s.operator){case"-":return h-p;case"*":return h*p;case"/":return p_(h,p,o,t);case"%":return p===0?NaN:h%p;case">":return Number.isFinite(h)&&Number.isFinite(p)&&h>p?1:0;case"<":return Number.isFinite(h)&&Number.isFinite(p)&&h<p?1:0;case">=":return Number.isFinite(h)&&Number.isFinite(p)&&h>=p?1:0;case"<=":return Number.isFinite(h)&&Number.isFinite(p)&&h<=p?1:0;case"==":return Number.isFinite(h)&&Number.isFinite(p)&&Math.abs(h-p)<1e-9?1:0;case"!=":return Number.isFinite(h)&&Number.isFinite(p)&&Math.abs(h-p)>=1e-9?1:0;case"and":return Number.isFinite(h)&&h!==0&&Number.isFinite(p)&&p!==0?1:0;case"or":return Number.isFinite(h)&&h!==0||Number.isFinite(p)&&p!==0?1:0;default:return NaN}}case"CallExpression":{const u=Hx(s.callee.toLowerCase(),o),d=Wx(u);if(d&&e.draw){const h=s.args[0];let p="";if(h&&h.kind==="Identifier"&&(p=h.name),h&&h.kind==="StringLiteral"&&(p=h.value),!p)return"";const v=e.draw.get(d.kind,d.prop,p,e.index);return v??""}if(u==="iff"||u==="iif"||u==="if"){if(s.args.length!==3)throw new Pt(`${s.callee} expects (cond, a, b)`);const h=r(rp(s.args[0],e,t,n)),p=o?Number.isFinite(h)&&h!==0:h!==0;return rp(p?s.args[1]:s.args[2],e,t,n)}if(u==="tostring"){if(s.args.length<1||s.args.length>2)throw new Pt("tostring expects (x[, format])");const h=rp(s.args[0],e,t,n);let p;if(s.args[1]){const v=rp(s.args[1],e,t,n);p=typeof v=="string"?v:String(v)}return l(h,p)}if(u==="format"){if(s.args.length<1)throw new Pt("format expects (fmt, ...)");const h=rp(s.args[0],e,t,n),p=a(h),v=s.args.slice(1).map(S=>rp(S,e,t,n));return p.replace(/\{(\d+)(?:,([^,}]+))?(?:,([^}]+))?\}/g,(S,C,I,A)=>{const P=Number(C),T=v[P];return T==null?"":typeof T=="number"?I&&String(I).trim().toLowerCase()==="number"?U2(T,String(A??"")):j1(T):String(T)}).replace(/{{/g,"{").replace(/}}/g,"}")}if(u==="upper")return a(rp(s.args[0],e,t,n)).toUpperCase();if(u==="lower")return a(rp(s.args[0],e,t,n)).toLowerCase();if(u==="trim")return a(rp(s.args[0],e,t,n)).trim();if(u==="replace"||u==="replace_all"){if(s.args.length<3)throw new Pt("replace expects (s, from, to)");const h=a(rp(s.args[0],e,t,n)),p=a(rp(s.args[1],e,t,n)),v=a(rp(s.args[2],e,t,n));return h.split(p).join(v)}if(u==="contains"){if(s.args.length<2)throw new Pt("contains expects (s, sub)");const h=a(rp(s.args[0],e,t,n)),p=a(rp(s.args[1],e,t,n));return h.includes(p)?1:0}if(u==="startswith"){if(s.args.length<2)throw new Pt("startswith expects (s, sub)");const h=a(rp(s.args[0],e,t,n)),p=a(rp(s.args[1],e,t,n));return h.startsWith(p)?1:0}if(u==="endswith"){if(s.args.length<2)throw new Pt("endswith expects (s, sub)");const h=a(rp(s.args[0],e,t,n)),p=a(rp(s.args[1],e,t,n));return h.endsWith(p)?1:0}if(u==="length"){if(s.args.length!==1)throw new Pt("length expects (s)");return a(rp(s.args[0],e,t,n)).length}if(u==="substring"){if(s.args.length<2)throw new Pt("substring expects (s, from[, to])");const h=a(rp(s.args[0],e,t,n)),p=r(rp(s.args[1],e,t,n)),v=s.args.length>2?r(rp(s.args[2],e,t,n)):NaN,x=Math.max(0,Math.floor(p)),S=Number.isFinite(v)?Math.max(x,Math.floor(v)):void 0;return S==null?h.slice(x):h.slice(x,S)}if(u==="repeat"){if(s.args.length<2)throw new Pt("repeat expects (s, count)");const h=a(rp(s.args[0],e,t,n)),p=r(rp(s.args[1],e,t,n)),v=Math.max(0,Math.floor(p));return h.repeat(v)}return c(s)}default:return c(s)}}function hk(s,e,t,n,o){var p;const r=Object.entries(e),a=((p=r[0])==null?void 0:p[1].length)??0;for(const[,v]of r)if(v.length!==a)throw new Pt("All base series must have the same length");const l=(()=>{if(!t||typeof t!="object")return;const v={};return Object.entries(t).forEach(([x,S])=>{const C=x.replace(/\s+/g,"_").toLowerCase();if(typeof S=="number"&&Number.isFinite(S)){v[C]=S;return}if(typeof S=="string"){const I=Number(S);v[C]=Number.isFinite(I)?I:Em(S)}}),Object.keys(v).length?v:void 0})(),c=(()=>{if(!t||typeof t!="object")return;const v={};return Object.entries(t).forEach(([x,S])=>{typeof S=="string"&&(v[x.replace(/\s+/g,"_").toLowerCase()]=S)}),Object.keys(v).length?v:void 0})();let f;try{f=Ep(s)}catch(v){throw v instanceof rv?new Pt(`Syntax error at position ${v.position}: ${v.message}`):v}const u={length:a,series:e,seriesNames:new Set(Object.keys(e)),scalars:l,diagnostics:o,strategy:n},d=new WeakMap,h=new Array(a);for(let v=0;v<a;v++){const S=rp(f,{series:e,scalars:l,strings:c,length:a,index:v,strategy:n},u,d);typeof S=="string"?h[v]=S:h[v]=j1(S)}return h}function l$(s,e,t,n,o,r){var x;const a=Object.entries(e),l=((x=a[0])==null?void 0:x[1].length)??0;if(n<0||n>=l)return"";for(const[,S]of a)if(S.length!==l)throw new Pt("All base series must have the same length");const c=(()=>{if(!t||typeof t!="object")return;const S={};return Object.entries(t).forEach(([C,I])=>{const A=C.replace(/\s+/g,"_").toLowerCase();if(typeof I=="number"&&Number.isFinite(I)){S[A]=I;return}if(typeof I=="string"){const P=Number(I);S[A]=Number.isFinite(P)?P:Em(I)}}),Object.keys(S).length?S:void 0})(),f=(()=>{if(!t||typeof t!="object")return;const S={};return Object.entries(t).forEach(([C,I])=>{typeof I=="string"&&(S[C.replace(/\s+/g,"_").toLowerCase()]=I)}),Object.keys(S).length?S:void 0})();let u;if(typeof s=="string")try{u=Ep(s)}catch(S){throw S instanceof rv?new Pt(`Syntax error at position ${S.position}: ${S.message}`):S}else u=s;const d={length:l,series:e,seriesNames:new Set(Object.keys(e)),scalars:c,strategy:r},v=rp(u,{series:e,scalars:c,strings:f,length:l,index:n,draw:o,strategy:r},d,new WeakMap);return typeof v=="string"?v:j1(v)}function ly(s,e){const t=s.length,n=new Float32Array(t);for(let o=0;o<t;o++){const r=o-e;n[o]=r>=0?s[r]:NaN}return n}const $y=s=>/[A-Za-z_$]/.test(s),Dy=s=>/[A-Za-z0-9_$]/.test(s);function c$(s){return String(s||"").replace(/\u00A0/g," ")}function qx(s){const e=String(s||"");let t="",n=null,o=!1;for(let r=0;r<e.length;r++){const a=e[r],l=e[r+1];if(n){if(t+=a,o){o=!1;continue}if(a==="\\"){o=!0;continue}a===n&&(n=null);continue}if(a==="'"||a==='"'){n=a,t+=a;continue}if(a==="/"&&l==="/"){for(r+=1;r+1<e.length;){const c=e[r+1];if(c===`
`||c==="\r")break;r+=1}continue}t+=a}return t}function u$(s,e){const t=String(s||""),n=t.length;let o="",r=null,a=0;for(;a<n;){const l=t[a];if(r){o+=l,l===r&&t[a-1]!=="\\"&&(r=null),a+=1;continue}if(l==="'"||l==='"'){r=l,o+=l,a+=1;continue}if($y(l)){let c=a+1;for(;c<n&&Dy(t[c]);)c+=1;const f=t.slice(a,c),u=f.toLowerCase();let d=c;for(;d<n&&/\s/.test(t[d]);)d+=1;if(t[d]==="."){let h=d+1;for(;h<n&&/\s/.test(t[h]);)h+=1;if(h<n&&$y(t[h])){let p=h+1;for(;p<n&&Dy(t[p]);)p+=1;const v=t.slice(h,p),x=v.toLowerCase();if(u==="strategy"&&(x==="closedtrades"||x==="opentrades")){let C=p;for(;C<n&&/\s/.test(t[C]);)C+=1;if(t[C]==="."){let I=C+1;for(;I<n&&/\s/.test(t[I]);)I+=1;if(I<n&&$y(t[I])){let A=I+1;for(;A<n&&Dy(t[A]);)A+=1;const P=t.slice(I,A);o+=`strategy_${x}_${P}`,a=A;continue}}}if(u==="barstate"||u==="timeframe"||u==="syminfo"||u==="strategy"){o+=`${u}_${v}`,a=p;continue}if(e){if(u==="ta"||u==="math"||u==="session"||u==="color"){o+=`${u}_${v}`,a=p;continue}}else if(u==="ta"||u==="math"){o+=v,a=p;continue}}}o+=f,a=c;continue}o+=l,a+=1}return o}function d$(s,e){const t=String(s||"");let n="",o=null,r=0;for(;r<t.length;){const a=t[r];if(o){n+=a,a===o&&t[r-1]!=="\\"&&(o=null),r+=1;continue}if(a==="'"||a==='"'){o=a,n+=a,r+=1;continue}if($y(a)){let l=r+1;for(;l<t.length&&Dy(t[l]);)l+=1;const c=t.slice(r,l);let f=r-1;for(;f>=0&&/\s/.test(t[f]);)f-=1;if(f>=0&&t[f]==="."){n+=c,r=l;continue}let u=l;for(;u<t.length&&/\s/.test(t[u]);)u+=1;if(t[u]==="["&&e){let d=0,h=u,p=null;for(;h<t.length;h++){const v=t[h];if(p){v===p&&t[h-1]!=="\\"&&(p=null);continue}if(v==="'"||v==='"'){p=v;continue}if(v==="[")d+=1;else if(v==="]"&&(d-=1,d===0))break}if(h<t.length&&d===0){const v=t.slice(u+1,h).trim();if(v){n+=`prev(${c}, __hist_index(${v}))`,r=h+1;continue}}}else if(t[u]==="["){let d=u+1;for(;d<t.length&&/\s/.test(t[d]);)d+=1;let h=1;t[d]==="-"&&(h=-1,d+=1);let p=d;for(;p<t.length&&/[0-9]/.test(t[p]);)p+=1;const v=t.slice(d,p);for(;p<t.length&&/\s/.test(t[p]);)p+=1;if(v&&t[p]==="]"){const x=h*Number(v);if(Number.isFinite(x)&&x>=1){n+=`prev(${c}, ${Math.floor(x)})`,r=p+1;continue}if(Number.isFinite(x)&&x===0){n+=c,r=p+1;continue}}}n+=c,r=l;continue}n+=a,r+=1}return n}function f$(s){if(!s)return 0;let e=2166136261;for(let n=0;n<s.length;n++)e^=s.charCodeAt(n),e=Math.imul(e,16777619);const t=e>>>0;return t===0?1:t}function p$(s){const e=String(s||"");let t="",n=0;for(;n<e.length;){const o=e[n];if(o==='"'||o==="'"){const r=o;n+=1;let a="",l=!1;for(;n<e.length;){const c=e[n];if(l){a+=c,l=!1,n+=1;continue}if(c==="\\"){l=!0,n+=1;continue}if(c===r){n+=1;break}a+=c,n+=1}t+=String(f$(a));continue}t+=o,n+=1}return t}function R_(s,e){const t=!!(e!=null&&e.pineV2);let n=c$(String(s||""));return n=qx(n),n=u$(n,t),t||(n=p$(n)),n=d$(n,t),{expr:n}}function s0(s){return!Number.isFinite(s)||s<=0?0:s<1e12?s*1e3:s}function h$(s){const e=new Date(s);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)}function m$(s){const e=new Date(s);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1,0,0,0,0)}function v$(s){const e=String(s||"").trim(),t=e.toUpperCase();if(!t)return null;if(t==="D"||t==="1D")return{kind:"calendar",unit:"D"};if(t==="W"||t==="1W")return{kind:"calendar",unit:"W"};if(e==="M"||e==="1M")return{kind:"calendar",unit:"M"};if(/^\d+$/.test(t))return{kind:"fixed",ms:Math.max(1,Number(t))*60*1e3};const n=t.match(/^(\d+)\s*([A-Z]+)$/);if(n){const o=Math.max(1,Number(n[1])),r=n[2];if(r==="S"||r==="SEC"||r==="SECS"||r==="SECOND"||r==="SECONDS")return{kind:"fixed",ms:o*1e3};if(r==="H"||r==="HR"||r==="HRS")return{kind:"fixed",ms:o*60*60*1e3};if(r==="MIN"||r==="MINS")return{kind:"fixed",ms:o*60*1e3};if(r==="M"&&e.toLowerCase().endsWith("m"))return{kind:"fixed",ms:o*60*1e3};if(r==="D"||r==="DAY"||r==="DAYS")return{kind:"fixed",ms:o*24*60*60*1e3};if(r==="W"||r==="WK"||r==="WEEK"||r==="WEEKS")return{kind:"fixed",ms:o*7*24*60*60*1e3}}return null}const mk=new Map,vk=new Map;function g$(s){const e=s||"UTC",t=mk.get(e);if(t)return t;const n=new Intl.DateTimeFormat("en-GB",{timeZone:e,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return mk.set(e,n),n}function _$(s){const e=s||"UTC",t=vk.get(e);if(t)return t;const n=new Intl.DateTimeFormat("en-GB",{timeZone:e,weekday:"short"});return vk.set(e,n),n}function wb(s,e){if(!Number.isFinite(s))return null;const n=g$(e).formatToParts(new Date(s)),o={};for(const d of n)(d.type==="year"||d.type==="month"||d.type==="day"||d.type==="hour"||d.type==="minute"||d.type==="second")&&(o[d.type]=d.value);const r=Number(o.year),a=Number(o.month),l=Number(o.day),c=Number(o.hour),f=Number(o.minute),u=Number(o.second);return[r,a,l,c,f,u].every(d=>Number.isFinite(d))?{y:r,m:a,d:l,h:c,min:f,s:u}:null}function y$(s,e){const n=_$(e).format(new Date(s));return{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}[n]??null}function ib(s,e){const t=wb(s,e);return t?Date.UTC(t.y,t.m-1,t.d,t.h,t.min,t.s,0)-s:0}function TS(s,e){const t=wb(s,e);if(!t)return h$(s);let n=Date.UTC(t.y,t.m-1,t.d,0,0,0,0);const o=ib(n,e);n=n-o;const r=ib(n,e);return n-r}function b$(s,e){const t=TS(s,e),n=y$(s,e);return t-(typeof n=="number"?n:0)*24*60*60*1e3}function x$(s,e){const t=wb(s,e);if(!t)return m$(s);let n=Date.UTC(t.y,t.m-1,1,0,0,0,0);const o=ib(n,e);n=n-o;const r=ib(n,e);return n-r}function r1(s,e,t){if(!e)return s;if(e.kind==="fixed")return Math.floor(s/e.ms)*e.ms;const n=t||"UTC";return e.unit==="D"?TS(s,n):e.unit==="W"?b$(s,n):x$(s,n)}function w$(s){const e=String(s||"").trim();if(!e)return[];if(e.toLowerCase()==="24x7"||e==="0000-2359")return[];const t=e.split(/[;,]/).map(o=>o.trim()).filter(Boolean),n=[];for(const o of t){const r=o.match(/(\d{1,2}):?(\d{2})\s*-\s*(\d{1,2}):?(\d{2})/);if(!r)continue;const a=Number(r[1]),l=Number(r[2]),c=Number(r[3]),f=Number(r[4]);if([a,l,c,f].some(h=>!Number.isFinite(h)))continue;const u=a*60+l,d=c*60+f;n.push({start:u,end:d})}return n}function Ry(s,e,t){const n=w$(e);if(!n.length)return!0;const r=wb(s,t||"UTC");if(!r)return!0;const a=r.h*60+r.min;for(const l of n)if(l.start<=l.end){if(a>=l.start&&a<=l.end)return!0}else if(a>=l.start||a<=l.end)return!0;return!1}function gk(s){const e=[];let t=null;for(let n=0;n<s.length;n++){const o=s0(s[n]??0);if(o){if(t!=null){const r=o-t;r>0&&Number.isFinite(r)&&e.push(r)}if(t=o,e.length>=200)break}}return e.length<3?null:(e.sort((n,o)=>n-o),e[Math.floor(e.length/2)]??null)}function k$(s,e){let t=0,n=s.length;for(;t<n;){const o=t+n>>>1;s[o]>e?n=o:t=o+1}return t}function S$(s){const e=s.length,t=new Float32Array(e),n=new Float32Array(e),o=new Float32Array(e),r=new Float32Array(e),a=new Float32Array(e),l=new Float32Array(e);for(let c=0;c<e;c++){const f=s[c],u=s0((f==null?void 0:f.timestamp)??(f==null?void 0:f.time)??(f==null?void 0:f.t)??0),d=Number(f==null?void 0:f.close),h=Number(f==null?void 0:f.open),p=Number(f==null?void 0:f.high),v=Number(f==null?void 0:f.low);t[c]=Number.isFinite(h)?h:Number.isFinite(d)?d:NaN,r[c]=Number.isFinite(d)?d:NaN,n[c]=Number.isFinite(p)?p:Number.isFinite(d)?d:t[c],o[c]=Number.isFinite(v)?v:Number.isFinite(d)?d:t[c];const x=Number(f==null?void 0:f.volume);a[c]=Number.isFinite(x)?x:0,l[c]=u||0}return{open:t,high:n,low:o,close:r,volume:a,time:l}}function C$(s){var D,X,ne,de;const e=s.timestamps.length,t=s.lookahead||"off",n=s.gaps||"off",o=String(s.timeframe||"").trim(),r=((D=s.scalars)==null?void 0:D.__pinev2)===1,a=String(s.expr||"close"),l=ie=>r?R_(ie,{pineV2:!0}).expr:String(ie??"");if(/\b(?:request\.)?security(?:_lower_tf)?\s*\(/i.test(a))throw new Error("request.security: nested request.security inside security expression is not supported");if(!o||o.toLowerCase()==="current"||o==="__CURRENT__"){const ie={open:new Float32Array(e),high:new Float32Array(e),low:new Float32Array(e),close:new Float32Array(e),volume:new Float32Array(e),time:new Float32Array(e)};for(let re=0;re<e;re++)ie.open[re]=s.open[re]??NaN,ie.high[re]=s.high[re]??NaN,ie.low[re]=s.low[re]??NaN,ie.close[re]=s.close[re]??NaN,ie.volume[re]=((X=s.volume)==null?void 0:X[re])??0,ie.time[re]=s0(s.timestamps[re]??0);const le=l_([{name:"__out",expr:l(a)}],ie,s.scalars,void 0,void 0,{userFunctions:s.userFunctions}).__out||new Float32Array(e),pe=new Array(e);for(let re=0;re<e;re++){const xe=le[re],se=s0(s.timestamps[re]??0);if(n==="on"&&!Ry(se,s.session,s.timezone)){pe[re]=void 0;continue}pe[re]=Number.isFinite(xe)?xe:void 0}return pe}const c=v$(o);if(!c)throw new Error(`request.security: invalid timeframe "${o}"`);if(s.sourceCandles&&s.sourceCandles.length>1){const ie=s.sourceCandles,te=ie.length,le=S$(ie),re=l_([{name:"__out",expr:l(a)}],le,s.scalars,void 0,void 0,{userFunctions:s.userFunctions}).__out||new Float32Array(te),xe=le.time,se=gk(s.timestamps),Ne=new Array(e);for(let De=0;De<e;De++){const Oe=s0(s.timestamps[De]??0);if(!Oe){Ne[De]=-1;continue}let Ke=Oe;if(De+1<e){const pt=s0(s.timestamps[De+1]??0);pt&&pt>Oe&&(Ke=pt-1)}else se!=null&&se>0&&(Ke=Oe+se-1);const kt=k$(xe,Ke);Ne[De]=kt-1}const Te=new Array(e);for(let De=0;De<e;De++){const Oe=Ne[De],Ke=De+1<e?Ne[De+1]:Oe;Te[De]=Oe>=0&&De+1<e&&Oe!==Ke}const Me=new Array(e);for(let De=0;De<e;De++){const Oe=Ne[De];if(Oe<0||Oe>=te){Me[De]=void 0;continue}const Ke=s0(s.timestamps[De]??0);if(n==="on"&&!Ry(Ke,s.session,s.timezone)){Me[De]=void 0;continue}const kt=t==="on"||Te[De]?re[Oe]:Oe>0?re[Oe-1]:NaN;let pt=Number.isFinite(kt)?kt:void 0;if(n==="on"){const Rt=r1(Ke,c,s.timezone),Ht=r1(xe[Oe]??0,c,s.timezone);Rt!==Ht&&(pt=void 0)}Me[De]=pt}return Me}const f=gk(s.timestamps);if(c.kind==="fixed"&&f!=null&&c.ms<f)throw new Error(`request.security: lower timeframe "${o}" is not available from current chart data (base ~${Math.round(f/6e4)}m). Switch chart timeframe lower or provide lower-TF datafeed.`);const u=new Array(e),d=new Array(e),h=[],p=[],v=[],x=[],S=[],C=[];let I=NaN,A=-1;for(let ie=0;ie<e;ie++){const te=s0(s.timestamps[ie]??0);if(!te){u[ie]=-1;continue}const le=r1(te,c,s.timezone);if(!Number.isFinite(I)||le!==I){I=le,A+=1,C[A]=le,h[A]=s.open[ie]??s.close[ie]??NaN;const pe=s.close[ie]??NaN;p[A]=s.high[ie]??pe,v[A]=s.low[ie]??pe,x[A]=s.close[ie]??NaN,S[A]=((ne=s.volume)==null?void 0:ne[ie])??0}else{const pe=s.high[ie],re=s.low[ie],xe=s.close[ie];pe!=null&&Number.isFinite(pe)&&(p[A]=Math.max(p[A],pe)),re!=null&&Number.isFinite(re)&&(v[A]=Math.min(v[A],re)),xe!=null&&Number.isFinite(xe)&&(x[A]=xe);const se=(de=s.volume)==null?void 0:de[ie];se!=null&&Number.isFinite(se)&&(S[A]+=se)}u[ie]=A}for(let ie=0;ie<e;ie++){const te=u[ie],le=ie+1<e?u[ie+1]:te;d[ie]=te>=0&&ie+1<e&&te!==le}const P=A+1;if(P<=0)return new Array(e);const T={open:new Float32Array(P),high:new Float32Array(P),low:new Float32Array(P),close:new Float32Array(P),volume:new Float32Array(P),time:new Float32Array(P)};for(let ie=0;ie<P;ie++)T.open[ie]=h[ie]??NaN,T.high[ie]=p[ie]??NaN,T.low[ie]=v[ie]??NaN,T.close[ie]=x[ie]??NaN,T.volume[ie]=S[ie]??0,T.time[ie]=C[ie]??0;const E=l_([{name:"__out",expr:l(a)}],T,s.scalars,void 0,void 0,{userFunctions:s.userFunctions}).__out||new Float32Array(P),L=new Array(e);for(let ie=0;ie<e;ie++){const te=u[ie];if(te<0){L[ie]=void 0;continue}const le=s0(s.timestamps[ie]??0);if(n==="on"&&!Ry(le,s.session,s.timezone)){L[ie]=void 0;continue}const pe=t==="on"||d[ie]?E[te]:te>0?E[te-1]:NaN,re=Number.isFinite(pe)?pe:void 0;if(n==="on"){const xe=r1(le,c,s.timezone),se=r1(C[te]??0,c,s.timezone);L[ie]=xe===se?re:void 0}else L[ie]=re}return L}const _k=s=>`https://noti.dutyai.app${s}`,yk=s=>{const e=typeof s=="number"?s:Number(s);return!Number.isFinite(e)||e<=0?null:e<1e12?e*1e3:e},I$=s=>{if(!s)return null;if(Array.isArray(s)){if(s.length<5)return null;let e,t,n,o,r,a;if(s.length>=6){const c=Number(s[0]),f=Number(s[s.length-1]),u=Number.isFinite(c)&&Math.abs(c)>1e10,d=Number.isFinite(f)&&Math.abs(f)>1e10;u&&!d?(e=s[0],t=s[1],n=s[2],o=s[3],r=s[4],a=s[5]):!u&&d?(t=s[0],n=s[1],o=s[2],r=s[3],a=s[4],e=s[5]):(e=s[0],t=s[1],n=s[2],o=s[3],r=s[4],a=s[5])}else e=s[0],t=s[1],n=s[2],o=s[3],r=s[4],a=0;const l=yk(e);return l?{timestamp:l,open:Number(t)||0,high:Number(n)||0,low:Number(o)||0,close:Number(r)||0,volume:Number(a)||0}:null}if(typeof s=="object"){const e=yk(s.timestamp??s.time??s.t??s.ts??s.date);return e?{timestamp:e,open:Number(s.open??s.o)||0,high:Number(s.high??s.h)||0,low:Number(s.low??s.l)||0,close:Number(s.close??s.c)||0,volume:Number(s.volume??s.v)||0}:null}return null};class P${constructor(){Pe(this,"_prevSymbol");Pe(this,"_ws");Pe(this,"listens",{});Pe(this,"polygonApiKey","k2hPDhLy8gIpP4lMCU0gwo92xNRxE2XI");Pe(this,"currentPriceCache",new Map);Pe(this,"pipeline");Pe(this,"corporateActionsCache",new Map);Pe(this,"corporateActionsInflight",new Map);Pe(this,"dataOptions",{sessionMode:"regular",adjustMode:"none",timezone:"UTC"});this.pipeline=new DL(this.fetchHistoryPage.bind(this),{initialLimit:800,pageLimit:1e3,pageDelayMs:60,maxKeys:24,ttlMs:25*6e4})}async getHistoryDutyData({symbol:e,period:t,from:n,to:o,strategy:r,sessionMode:a,adjustMode:l,timezone:c}){const f=(t==null?void 0:t.timeframe)||"1m",u=this.normalizeSessionMode(a||e.sessionMode||this.dataOptions.sessionMode),d=this.normalizeAdjustMode(l||e.adjustMode||this.dataOptions.adjustMode),h=n1(e,c||this.dataOptions.timezone);this.dataOptions={sessionMode:u,adjustMode:d,timezone:h};const p=await this.pipeline.waitForInitial(e,f);await this.ensureCorporateActions(e);const v=this.applyTransforms(p.candles.slice(),e,u,d,h,f);if(v.length>0){const x=v[v.length-1].close;this.currentPriceCache.set(e.ticker,x)}return{data:v.slice(),lays:[]}}startBackgroundPrefetch(e,t){this.pipeline.start(e,t.timeframe)}hasMoreServerHistory(e,t){return!this.pipeline.getSnapshot(e,t.timeframe).isComplete}async loadMoreHistoricalData(e,t,n,o=2){const a=this.pipeline.requestVisibleRange({symbol:e,timeframe:t.timeframe,beforeTimestamp:n,limit:350}),l=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),c=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),f=n1(e,this.dataOptions.timezone);return await this.ensureCorporateActions(e),{data:this.applyTransforms(a.slice(),e,l,c,f,t.timeframe),lays:[]}}removeDuplicateData(e){const t=new Set;return e.filter(n=>t.has(n[0])?!1:(t.add(n[0]),!0))}getTimeframeInMs(e){return e.endsWith("m")?parseInt(e.slice(0,-1))*60*1e3:e.endsWith("h")?parseInt(e.slice(0,-1))*60*60*1e3:e.endsWith("d")?parseInt(e.slice(0,-1))*24*60*60*1e3:e.endsWith("w")?parseInt(e.slice(0,-1))*7*24*60*60*1e3:60*1e3}shouldFilterBySession(e){const t=String(e||"").trim();if(!t)return!0;const n=t.slice(-1);return!(n==="d"||n==="D"||n==="w"||n==="W"||n==="M"||n==="y"||n==="Y")}canLoadMoreData(e,t){const n=this.pipeline.getSnapshot(e,t.timeframe);return n.candles.length>0&&!n.isComplete}convertResolutionForStockNow(e){return e==="1d"?"1D":e==="1w"?"1W":e==="1M"?"1M":e.endsWith("m")?e.slice(0,-1):e.endsWith("h")?(parseInt(e.slice(0,-1))*60).toString():e.endsWith("d")?(parseInt(e.slice(0,-1))*24*60).toString():e.endsWith("w")?(parseInt(e.slice(0,-1))*7*24*60).toString():e}async fetchHistoryPage(e){const t=this.convertResolutionForStockNow(e.timeframe),n=encodeURIComponent(e.symbol.ticker),o=e.symbol.country||"BD",r=`/finance/get/chart/${n}/${t}?skip=${e.skip}&limit=${e.limit}&country=${o}`,a=_k(r),l=await fetch(a,{signal:e.signal});if(!l.ok)return[];const c=await l.text();if(!c||c.trim()==="")return[];try{const f=JSON.parse(c),u=Array.isArray(f)?f:Array.isArray(f==null?void 0:f.data)?f.data:Array.isArray(f==null?void 0:f.candles)?f.candles:Array.isArray(f==null?void 0:f.result)?f.result:[],d=Array.isArray(u)?u:[];if(!d.length)return[];const h=[];for(const p of d){const v=I$(p);v&&h.push(v)}return h}catch{return[]}}async getSymbols(){console.log("🚀 getSymbols() method called");try{console.log("🌐 Fetching symbols from API...");const t=await fetch(_k("/finance/get/stock/list/latest"));if(!t.ok)return console.warn(`⚠️ API request failed with status: ${t.status}`),[];let n=await t.json();const o=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.symbols)?n.symbols:null;if(!o||!Array.isArray(o))return console.warn("⚠️ API response is not an array, using fallback symbols"),[];o.push({ticker:"DSEX",name:"Dhaka Stock Exchange",shortName:"DSEX",market:"stock",exchange:"DSEBD",priceCurrency:"BDT",type:"stock",logo:"",country:"BD"}),console.log(`📊 Received ${o.length} symbols from API`);const a=o.map(l=>{const c={ticker:l.symbol||l.ticker||"",name:l.description||l.fullName||l.name||l.symbol||l.ticker||"",shortName:l.name||l.symbol||l.ticker||"",market:l.market||"stock",country:l.country||"BD",exchange:l.exchange||"UNKNOWN",priceCurrency:l.currency||(l.country==="US"?"USD":"BDT"),type:l.type||"stock",logo:l.logo?l.logo.trim():l.symbol||l.ticker?`https://s3-api.bayah.app/cdn/symbol/logo/${l.symbol||l.ticker}.svg`:"",logo2:l.logo2,pricePrecision:l.pricePrecision,volumePrecision:l.volumePrecision,tickSize:l.tickSize??l.minTick??l.priceStep,lotSize:l.lotSize,contractSize:l.contractSize,minOrderSize:l.minOrderSize,corporateActions:Array.isArray(l.corporateActions)?l.corporateActions:Array.isArray(l.corporate_actions)?l.corporate_actions:void 0,corporateActionsUrl:l.corporateActionsUrl||l.corporate_actions_url||l.corporateActionsURL,adjustMode:l.adjustMode||l.adjust_mode},f=zL(c),u=Ky(l.sessionRegular||l.session||f.regular)||void 0,d=Ky(l.sessionExtended||l.extendedSession||f.extended)||void 0;return{...c,timezone:l.timezone||l.exchangeTimezone||f.timezone,session:u,sessionExtended:d,sessionTimezone:l.sessionTimezone||l.timezone}}).filter(l=>l.ticker&&l.ticker.trim()!=="");return console.log(`✅ Successfully processed ${a.length} valid symbols`),console.log("📋 Sample symbols:",a.slice(0,5)),a.length>0?a:[]}catch(e){return console.error("❌ Error fetching symbols from API:",e),console.log("🔄 Falling back to hardcoded symbols"),[]}}watch(e,t){var n;this._ws&&((n=this._ws)==null||n.send(JSON.stringify({action:"watch",key:e})),this.listens[e]=t)}subscribe(e,t){var o;if(((o=this._prevSymbol)==null?void 0:o.ticker)===e.ticker)return;this._prevSymbol=e,this.unsubscribe(),console.log(`Subscribing to real-time updates for ${e.ticker}`);const n=setInterval(()=>{const r=this.currentPriceCache.get(e.ticker)||Math.random()*100+10,a=(Math.random()-.5)*2,l=r+a;this.currentPriceCache.set(e.ticker,l);const f=[Date.now(),r,Math.max(r,l)+Math.random()*.5,Math.min(r,l)-Math.random()*.5,l,Math.random()*1e3];t({bars:[f],secs:1})},2e3);this.listens[e.ticker]=n}unsubscribe(e){this._ws&&(this._ws.close(),this._ws=void 0),Object.values(this.listens).forEach(n=>{typeof n=="number"&&clearInterval(n)}),this.listens={};const t=e==null?void 0:e.ticker;t&&this.pipeline.stopSymbol(t)}getCurrentPrice(e){return this.currentPriceCache.get(e)||null}clearCache(){this.pipeline.clear(),this.currentPriceCache.clear()}getPipelineMetrics(){return this.pipeline.getMetrics()}stopSymbolPipelines(e){this.pipeline.stopSymbol(e)}stopAllPipelines(){this.pipeline.stopAll()}getHistorySnapshot(e,t){const n=this.pipeline.getSnapshot(e,t);if(!n.candles.length)return n;const o=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),r=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),a=n1(e,this.dataOptions.timezone),l=this.applyTransforms(n.candles.slice(),e,o,r,a,t);return{...n,candles:l}}async ensureHistoryBefore(e,t,n,o=2500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const r=l=>{const c=l.oldestTimestampLoaded;return typeof n!="number"||!Number.isFinite(n)||n<=0?l.candles.length>0:c!=null&&c<=n},a=this.pipeline.getSnapshot(e,t);return r(a)||a.isComplete?a:await new Promise(l=>{let c=!1,f=null,u=null;const d=h=>{if(c)return;c=!0;try{f&&clearTimeout(f)}catch{}try{u==null||u()}catch{}const p=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),v=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),x=n1(e,this.dataOptions.timezone),S=this.applyTransforms(h.candles.slice(),e,p,v,x,t);l({...h,candles:S})};u=this.pipeline.subscribe(e,t,h=>{(r(h)||h.isComplete||h.error)&&d(h)}),f=setTimeout(()=>{d(this.pipeline.getSnapshot(e,t))},Math.max(100,o))})}async ensureHistoryCovers(e,t,n,o,r=3500){if(!(e!=null&&e.ticker))return this.pipeline.getSnapshot(e,t);this.pipeline.start(e,t);const a=c=>{const f=c.oldestTimestampLoaded,u=c.newestTimestampLoaded;return typeof n!="number"||!Number.isFinite(n)||n<=0||typeof o!="number"||!Number.isFinite(o)||o<=0?c.candles.length>0:f!=null&&u!=null&&f<=n&&u>=o},l=this.pipeline.getSnapshot(e,t);return a(l)||l.isComplete?l:await new Promise(c=>{let f=!1,u=null,d=null;const h=p=>{if(f)return;f=!0;try{u&&clearTimeout(u)}catch{}try{d==null||d()}catch{}const v=this.normalizeSessionMode(e.sessionMode||this.dataOptions.sessionMode),x=this.normalizeAdjustMode(e.adjustMode||this.dataOptions.adjustMode),S=n1(e,this.dataOptions.timezone),C=this.applyTransforms(p.candles.slice(),e,v,x,S,t);c({...p,candles:C})};d=this.pipeline.subscribe(e,t,p=>{(a(p)||p.isComplete||p.error)&&h(p)}),u=setTimeout(()=>{h(this.pipeline.getSnapshot(e,t))},Math.max(100,r))})}normalizeSessionMode(e){const t=String(e||"").toLowerCase();return t==="extended"?"extended":t==="all"?"all":"regular"}normalizeAdjustMode(e){const t=String(e||"").toLowerCase();return t==="split"?"split":t==="dividend"?"dividend":t==="all"||t==="split_dividend"||t==="split+dividend"?"all":"none"}async ensureCorporateActions(e){const t=`${e.ticker}@${e.exchange||e.market||""}`,n=this.corporateActionsCache.get(t);if(n)return n;if(Array.isArray(e.corporateActions))return this.corporateActionsCache.set(t,e.corporateActions),e.corporateActions;if(this.corporateActionsInflight.has(t))return await this.corporateActionsInflight.get(t);const o=e.corporateActionsUrl;if(!o)return this.corporateActionsCache.set(t,[]),[];const r=(async()=>{try{const a=await fetch(o);if(!a.ok)return[];const l=await a.json(),c=Array.isArray(l)?l:Array.isArray(l==null?void 0:l.actions)?l.actions:Array.isArray(l==null?void 0:l.corporateActions)?l.corporateActions:[],f=Array.isArray(c)?c:[];return this.corporateActionsCache.set(t,f),f}catch{return this.corporateActionsCache.set(t,[]),[]}finally{this.corporateActionsInflight.delete(t)}})();return this.corporateActionsInflight.set(t,r),await r}applyTransforms(e,t,n,o,r,a){if(!e.length)return e;const l=VL(t,n);let c=e;this.shouldFilterBySession(a)&&n!=="all"&&l&&l!=="24x7"&&(c=this.filterBySession(c,l,r));const f=`${t.ticker}@${t.exchange||t.market||""}`,u=this.corporateActionsCache.get(f)||t.corporateActions;return u&&u.length&&o!=="none"&&(c=jL(c,u,o)),c}filterBySession(e,t,n){const o=[];for(const r of e){const a=(r==null?void 0:r.timestamp)??(r==null?void 0:r.time)??0,l=typeof a=="number"?a:Number(a),c=Number.isFinite(l)?l<1e12?l*1e3:l:0;c&&Ry(c,t,n)&&o.push(r)}return o}}function bk(s){const{xVal:e,xloc:t,len:n,timeSeriesMs:o,tsIndex:r,config:a,warn:l,meta:c}=s;if(!Number.isFinite(e))return null;const f=!!(a!=null&&a.strictXloc),u=!!(a!=null&&a.allowFloatIndex),d=f&&t==="time"?0:Math.max(0,Number((a==null?void 0:a.futureBars)||0));if(t!=="time"){if(f&&!Number.isInteger(e))return null;const te=f||!u?Math.round(e):e;return!Number.isFinite(te)||te<0?null:te>n-1&&te<=n-1+d||te>=0&&te<n?te:null}const h=e<1e12?Math.floor(e*1e3):Math.floor(e),p=o.length;if(!p)return null;const v=f?0:Math.max(0,Number((a==null?void 0:a.toleranceBars)||0)),x=f?0:Math.max(0,Number((a==null?void 0:a.toleranceMs)||0)),S=Math.max(0,Number((a==null?void 0:a.avgIntervalMs)||0)),C=S>0?v*S:0,I=Math.max(x,C),A=o[p-1];o[0];const P=te=>{if(!l)return;const le=["[ScriptStudio] time anchor miss",c!=null&&c.kind?`kind=${c.kind}`:"",(c==null?void 0:c.id)!=null?`id=${c.id}`:"",`ts=${h}`,`mode=${(a==null?void 0:a.mode)||"nearest"}`,`tolBars=${v}`,`tolMs=${x}`,`reason=${te}`].filter(Boolean);l(le.join(" "))};if(h>A&&d>0){const te=h-A,le=S>0?Math.max(1,Math.round(te/S)):1;return le<=d?n-1+le:(P("future_out_of_range"),null)}let T=0,j=p;for(;T<j;){const te=T+j>>1;o[te]<h?T=te+1:j=te}const E=T<p?T:null,L=T-1>=0?T-1:null;let D=null;const X=f?"prev":(a==null?void 0:a.mode)||"nearest";if(X==="prev")D=L??E;else if(X==="next")D=E??L;else{const te=L!=null?Math.abs(o[L]-h):Number.POSITIVE_INFINITY,le=E!=null?Math.abs(o[E]-h):Number.POSITIVE_INFINITY;te<=le?D=L:D=E}if(D==null)return P("no_match"),null;const ne=o[D],de=Math.abs(ne-h),ie=S>0?de/S:Math.abs(D-(T<p?T:p-1));return I>0&&de>I?(P("beyond_tolerance_ms"),null):v>0&&ie>v?(P("beyond_tolerance_bars"),null):D}function Zb(s,e,t){if(!Array.isArray(s)||s.length<=2)return s||[];const n=Math.max(1,Math.floor(t||1)),o=[];let r=null,a=null;for(let l=0;l<s.length;l++){const c=s[l];if(!c)continue;const{x:f,y:u}=e(c)||{};if(!Number.isFinite(f)||!Number.isFinite(u))continue;if(o.length===0){o.push(c),r={x:f,y:u};continue}const d=f-r.x,h=u-r.y,p=d!==0?h/d:null,v=Math.abs(d)>=n||Math.abs(h)>=n,x=p!=null&&a!=null?p*a<0:!1;(v||x||l===s.length-1)&&(o.push(c),r={x:f,y:u},a=p??a)}return o[o.length-1]!==s[s.length-1]&&o.push(s[s.length-1]),o}function xk(s){const{baseLeft:e,baseRight:t,extend:n,vpLeft:o,vpRight:r,lastIndex:a}=s||{};if(!Number.isFinite(e)||!Number.isFinite(t))return null;const l=Number.isFinite(a)?Math.max(0,a):Math.max(e,t),c=v=>Math.max(0,Math.min(l,v)),f=Number.isFinite(o)?c(o):c(e),u=Number.isFinite(r)?c(r):c(t),d=String(n||"none").toLowerCase();let h=e,p=t;return d==="both"?(h=f,p=u):d==="left"?h=f:d==="right"&&(p=u),{leftExt:c(h),rightExt:c(p)}}function cy(s){const{startIndex:e,endIndex:t,startValue:n,endValue:o,slope:r,intercept:a,extend:l,fromIndex:c,toIndex:f,yRange:u,toX:d,toY:h}=s||{};if(!Number.isFinite(e)||!Number.isFinite(t)||!Number.isFinite(n)||!Number.isFinite(o))return null;const p=String(l||"none").toLowerCase(),v={x1:e,y1:n,x2:t,y2:o},x=e===t,S=Number.isFinite(c)?c:e,C=Number.isFinite(f)?f:t;let I=r,A=a;!x&&(!Number.isFinite(I)||!Number.isFinite(A))&&(I=(o-n)/(t-e),A=n-I*e);let P={...v};if(p!=="none"){if(x){const E=Number(u==null?void 0:u.from),L=Number(u==null?void 0:u.to),D=Number.isFinite(E)&&Number.isFinite(L)?Math.min(E,L):Math.min(n,o),X=Number.isFinite(E)&&Number.isFinite(L)?Math.max(E,L):Math.max(n,o);P={x1:e,y1:X,x2:e,y2:D}}else if(Number.isFinite(I)&&Number.isFinite(A)){let E=e,L=t;p==="left"?E=S:p==="right"?L=C:p==="both"&&(E=S,L=C),P={x1:E,y1:I*E+A,x2:L,y2:I*L+A}}}const T={x1:d(v.x1),y1:h(v.y1),x2:d(v.x2),y2:h(v.y2)},j={x1:d(P.x1),y1:h(P.y1),x2:d(P.x2),y2:h(P.y2)};return!Number.isFinite(T.x1)||!Number.isFinite(T.y1)||!Number.isFinite(T.x2)||!Number.isFinite(T.y2)||!Number.isFinite(j.x1)||!Number.isFinite(j.y1)||!Number.isFinite(j.x2)||!Number.isFinite(j.y2)?null:{mode:p,vertical:x,base:T,extended:j,baseData:v,extendedData:P}}function wk(s,e){const t=String(s||"solid").toLowerCase(),n=Number(e),o=Number.isFinite(n)&&n>=3;return t==="dashed"?o?[8,5]:[6,4]:t==="dotted"?o?[3,5]:[2,4]:[]}const kk=new Map,Jb=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function uy(s,e){return Jb?(Jb.font=e,Jb.measureText(s).width):s.length*8}function m1(s){const e=s.text??"",t=s.font||'12px "Inter", system-ui, sans-serif',n=Number.isFinite(s.maxWidth)?Math.max(0,Number(s.maxWidth)):0,o=s.wrap===!0,r=(()=>{const x=t.match(/(\d+(?:\.\d+)?)px/),S=x?Number(x[1]):12;return Math.max(S+2,S*1.2)})(),a=Number.isFinite(s.lineHeight)?Number(s.lineHeight):r,l=`${t}|${n}|${o?"w":"n"}|${a}|${e}`,c=kk.get(l);if(c)return c;const f=String(e).split(/\n/),u=[],d=x=>{if(!o||n<=0){u.push(x);return}const S=x.split(/\s+/).filter(Boolean);let C="";const I=()=>{C&&(u.push(C),C="")},A=P=>{if(!P)return;if(uy(P,t)>n&&n>4){I();let E="";for(const L of P){const D=E+L;uy(D,t)>n&&E?(u.push(E),E=L):E=D}E&&u.push(E);return}const j=C?`${C} ${P}`:P;uy(j,t)>n&&C?(I(),C=P):C=j};for(const P of S)A(P);I()};f.forEach(x=>d(x)),u.length||u.push("");let h=0;for(const x of u)h=Math.max(h,uy(x,t));const p=u.length*a,v={lines:u,width:h,height:p,lineHeight:a};return kk.set(l,v),v}const M$=1200,o_=new Map,N$=()=>{if(typeof window>"u")return 1;const s=window.devicePixelRatio||1;return Number.isFinite(s)&&s>0?s:1},A$=(s,e,t)=>JSON.stringify([s,e.font,e.color,e.strokeColor??"",Number.isFinite(e.strokeWidth)?e.strokeWidth:0,Number.isFinite(e.maxWidth)?e.maxWidth:"",e.wrap?1:0,Number.isFinite(e.lineHeight)?e.lineHeight:"",e.align||"left",t]),Sk=(s,e)=>{if(o_.has(s)&&o_.delete(s),o_.set(s,e),o_.size<=M$)return;const t=o_.keys().next().value;t&&o_.delete(t)},dy=(s,e)=>{if(typeof document>"u")return null;const t=String(s??"");if(!t)return{canvas:document.createElement("canvas"),width:0,height:0,lineHeight:Number.isFinite(e.lineHeight)?Number(e.lineHeight):14,lines:[],dpr:1};const n=N$(),o=A$(t,e,n),r=o_.get(o);if(r)return Sk(o,r),r;const a=m1({text:t,font:e.font,maxWidth:e.maxWidth,wrap:e.wrap===!0,lineHeight:e.lineHeight}),l=Math.max(1,Math.ceil(a.width)),c=Math.max(1,Math.ceil(a.height)),f=document.createElement("canvas");f.width=Math.ceil(l*n),f.height=Math.ceil(c*n);const u=f.getContext("2d");if(!u)return null;u.scale(n,n),u.font=e.font,u.textBaseline="top";const d=e.align||"left";u.textAlign=d,u.fillStyle=e.color,e.strokeWidth&&e.strokeWidth>0&&(u.lineWidth=e.strokeWidth,u.strokeStyle=e.strokeColor||"rgba(0,0,0,0.45)");const h=d==="center"?l/2:d==="right"?l:0;let p=0;for(const x of a.lines)e.strokeWidth&&e.strokeWidth>0&&u.strokeText(x,h,p),u.fillText(x,h,p),p+=a.lineHeight;const v={canvas:f,width:l,height:c,lineHeight:a.lineHeight,lines:a.lines,dpr:n};return Sk(o,v),v},FS=Object.freeze({interactionV2:!0,heatmapRasterV1:!0,webglRuntimeDrawV1:!0}),T$=FS,F$=s=>{},Cm=s=>{const e=T$[s]??!1;return F$()??e},Ux=new Map;function i0(s,e){s&&Ux.set(s,e)}function j0(s){if(s)return Ux.get(s)}function Ck(s){s&&Ux.delete(s)}const Qb=6,Wm=s=>typeof s=="number"&&Number.isFinite(s),a1=(s,e,t)=>s>=t.x&&e>=t.y&&s<=t.x+t.width&&e<=t.y+t.height,L$=s=>{if(!s)return null;const e=s.width,t=s.height;if(!Wm(e)||!Wm(t))return null;let n=s.x,o=s.y;const r=s.align||"center",a=s.valign||"middle";return r==="center"?n-=e/2:r==="right"&&(n-=e),a==="middle"?o-=t/2:a==="bottom"&&(o-=t),{x:n,y:o,width:e,height:t}},E$=s=>{if(!s||s.length<3)return null;let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const r of s)!Wm(r.x)||!Wm(r.y)||(r.x<e&&(e=r.x),r.x>n&&(n=r.x),r.y<t&&(t=r.y),r.y>o&&(o=r.y));return!Wm(e)||!Wm(t)||!Wm(n)||!Wm(o)?null:{x:e,y:t,width:n-e,height:o-t}},$$=(s,e)=>{let t=!1;for(let n=0,o=e.length-1;n<e.length;o=n++){const r=e[n],a=e[o];if(!r||!a)continue;r.y>s.y!=a.y>s.y&&s.x<(a.x-r.x)*(s.y-r.y)/(a.y-r.y+1e-7)+r.x&&(t=!t)}return t},e2=(s,e,t)=>{const n=t.x-e.x,o=t.y-e.y;if(n===0&&o===0)return Math.hypot(s.x-e.x,s.y-e.y);const r=((s.x-e.x)*n+(s.y-e.y)*o)/(n*n+o*o),a=Math.max(0,Math.min(1,r)),l=e.x+a*n,c=e.y+a*o;return Math.hypot(s.x-l,s.y-c)};function D$(s,e){return s.zIndex!==e.zIndex?e.zIndex-s.zIndex:s.createdAt!==e.createdAt?e.createdAt-s.createdAt:s.id<e.id?-1:s.id>e.id?1:0}function R$(s){return!Array.isArray(s)||s.length===0?null:s.reduce((e,t)=>e?D$(t,e)<0?t:e:t,null)}function LS(s,e,t){if(!Array.isArray(s)||!Wm(e)||!Wm(t))return null;const n=[],o={x:e,y:t};for(const r of s){if(!r||!Wm(r.zIndex)||!Wm(r.createdAt))continue;const a=r.id,l=r.type;if(l==="handle"){if(!r.rect)continue;a1(e,t,r.rect)&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="label"){const c=r.rect??L$(r.anchor);if(!c)continue;a1(e,t,c)&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="box"){if(!r.rect)continue;a1(e,t,r.rect)&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}if(l==="line"||l==="lineSegment"){if(!r.segment)continue;const c=e2(o,r.segment.a,r.segment.b),f=Wm(r.tolerance)?r.tolerance:Qb;c<=f&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:c});continue}if(l==="polyline"||l==="path"){const c=r.segments||[];if(!c.length){r.rect&&a1(e,t,r.rect)&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}const f=Wm(r.tolerance)?r.tolerance:Qb;let u=1/0;for(const d of c){const h=e2(o,d.a,d.b);if(h<u&&(u=h),u<=f)break}u<=f&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:u});continue}if(l==="polygon"){const c=r.polygon||[];if(c.length<3)continue;const f=r.rect??E$(c);if(f&&!a1(e,t,f))continue;if($$(o,c)){n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt});continue}const u=Wm(r.tolerance)?r.tolerance:Qb;let d=1/0;for(let h=0;h<c.length;h++){const p=c[h],v=c[(h+1)%c.length];if(!p||!v)continue;const x=e2(o,p,v);if(x<d&&(d=x),d<=u)break}d<=u&&n.push({id:a,type:l,zIndex:r.zIndex,createdAt:r.createdAt,distance:d});continue}}return R$(n)}const Ik=s=>typeof s=="number"&&Number.isFinite(s),A_=(s,e)=>!Ik(s)||!Ik(e)||e<=0?s:Math.round(s/e)*e;function Pk(s){return{snapOff:!!(s!=null&&s.altKey),axisLock:!!(s!=null&&s.shiftKey),strong:!1}}function Mk(s,e,t){return!e||t.snapOff?{time:s.time,price:s.price}:{time:A_(s.time,e.timeStep),price:A_(s.price,e.priceStep)}}function Nk(s,e,t){return!e||t.snapOff?{leftTime:s.leftTime,rightTime:s.rightTime,top:s.top,bottom:s.bottom}:{leftTime:A_(s.leftTime,e.timeStep),rightTime:A_(s.rightTime,e.timeStep),top:A_(s.top,e.priceStep),bottom:A_(s.bottom,e.priceStep)}}const j$=new Set(["box","label","line","lineSegment","polyline","polygon","path"]),ES=new Set(["n","s","e","w","ne","nw","se","sw"]);let Uc=null,Hu=null;const B$={snapOff:!1,axisLock:!1,strong:!1},ap=s=>typeof s=="number"&&Number.isFinite(s),Ak=s=>!!(s&&typeof s.toIndex=="function"&&typeof s.toValue=="function"&&typeof s.toX=="function"&&typeof s.toY=="function"),rb=s=>!!(s&&ap(s.leftIndex)&&ap(s.rightIndex)&&ap(s.topValue)&&ap(s.bottomValue)),ix=s=>!!(s&&ap(s.index)&&ap(s.value)),ab=(s,e,t)=>({x:s-t.x,y:e-t.y}),jy=s=>s==="n"||s==="s"?"ns-resize":s==="e"||s==="w"?"ew-resize":s==="ne"||s==="sw"?"nesw-resize":"nwse-resize",O$=s=>s??B$,Tk=(s,e,t)=>t.axisLock?Math.abs(s)>=Math.abs(e)?{lockX:!1,lockY:!0}:{lockX:!0,lockY:!1}:{lockX:!1,lockY:!1},fy=(s,e,t)=>s?{timeStep:e?s.timeStep:Number.NaN,priceStep:t?s.priceStep:Number.NaN}:null;function Fk(s,e,t,n){var a;if(!Cm("interactionV2"))return{};const o=O$(n);if(Hu){const l=ab(s,e,Hu.offset);let c=l.x-Hu.startX,f=l.y-Hu.startY;const u=Hu.handle.includes("e")||Hu.handle.includes("w"),d=Hu.handle.includes("n")||Hu.handle.includes("s");u||(c=0),d||(f=0);const{lockX:h,lockY:p}=Tk(c,f,o);h&&(c=0),p&&(f=0);let v=Hu.basePx.left,x=Hu.basePx.right,S=Hu.basePx.top,C=Hu.basePx.bottom;Hu.handle.includes("w")&&(v+=c),Hu.handle.includes("e")&&(x+=c),Hu.handle.includes("n")&&(S+=f),Hu.handle.includes("s")&&(C+=f);const I=Hu.axis.toIndex(v),A=Hu.axis.toIndex(x),P=Hu.axis.toValue(S),T=Hu.axis.toValue(C);if(!ap(I)||!ap(A)||!ap(P)||!ap(T))return{hoverId:Hu.targetId,resizingId:Hu.targetId,cursor:jy(Hu.handle)};const j=fy(Hu.snap,u&&!h,d&&!p),E=Nk({leftTime:I,rightTime:A,top:P,bottom:T},j,o);let L=E.leftTime,D=E.rightTime,X=E.top,ne=E.bottom;const de=Math.max(2,Hu.minWidthIndex),ie=Math.max(0,Hu.minHeightValue);D-L<de&&(Hu.handle.includes("w")?L=D-de:D=L+de),X-ne<ie&&(Hu.handle.includes("n")?X=ne+ie:ne=X-ie);const te=j0(Hu.targetId);return i0(Hu.targetId,{box:{leftIndex:L,rightIndex:D,topValue:X,bottomValue:ne},hidden:te==null?void 0:te.hidden}),{hoverId:Hu.targetId,resizingId:Hu.targetId,cursor:jy(Hu.handle)}}if(Uc){const l=ab(s,e,Uc.offset);let c=l.x-Uc.startX,f=l.y-Uc.startY;const{lockX:u,lockY:d}=Tk(c,f,o);u&&(c=0),d&&(f=0);const h=j0(Uc.id);if(Uc.type==="box"&&Uc.baseBox&&Uc.basePx){const p=Uc.axis.toIndex(Uc.basePx.left+c),v=Uc.axis.toIndex(Uc.basePx.right+c),x=Uc.axis.toValue(Uc.basePx.top+f),S=Uc.axis.toValue(Uc.basePx.bottom+f);if(ap(p)&&ap(v)&&ap(x)&&ap(S)){const C=fy(Uc.snap,!u,!d),I=Nk({leftTime:p,rightTime:v,top:x,bottom:S},C,o);i0(Uc.id,{box:{leftIndex:I.leftTime,rightIndex:I.rightTime,topValue:I.top,bottomValue:I.bottom},hidden:h==null?void 0:h.hidden})}}else if(Uc.type==="label"&&Uc.baseLabel&&Uc.baseAnchorPx){const p=Uc.axis.toIndex(Uc.baseAnchorPx.x+c),v=Uc.axis.toValue(Uc.baseAnchorPx.y+f);if(ap(p)&&ap(v)){const x=fy(Uc.snap,!u,!d),S=Mk({time:p,price:v},x,o);i0(Uc.id,{label:{index:S.time,value:S.price},hidden:h==null?void 0:h.hidden})}}else if(Uc.type==="shape"){const p=Uc.baseIndex,v=Uc.baseValue;if(ap(p)&&ap(v)){let x=Uc.axis.toIndex(l.x),S=Uc.axis.toValue(l.y);if(u&&(x=p),d&&(S=v),ap(x)&&ap(S)){const C=fy(Uc.snap,!u,!d),I=Mk({time:x,price:S},C,o),A=I.time-p,P=I.price-v,T=Uc.baseTranslate||{dxIndex:0,dyValue:0};i0(Uc.id,{translate:{dxIndex:T.dxIndex+A,dyValue:T.dyValue+P},hidden:h==null?void 0:h.hidden})}}}return{hoverId:Uc.id,draggingId:Uc.id,cursor:"grabbing"}}const r=LS(t,s,e);if(!r)return{};if(r.type==="handle"){const l=t.find(f=>f.id===r.id&&f.type===r.type),c=(a=l==null?void 0:l.handle)==null?void 0:a.position;if(c&&ES.has(c))return{hoverId:r.id,cursor:jy(c)}}return{hoverId:r.id}}function z$(s,e,t){if(!Cm("interactionV2"))return{};const n=LS(t,s,e);if(!n)return Uc=null,Hu=null,{};if(Uc=null,Hu=null,n.type==="handle"){const r=t.find(l=>l.id===n.id&&l.type===n.type),a=r==null?void 0:r.handle;if(a&&ES.has(a.position)){const l=t.find(x=>x.id===a.targetId&&x.type==="box"),c=l==null?void 0:l.axis,f=(l==null?void 0:l.offset)??{x:0,y:0},u=l==null?void 0:l.box,d=(l==null?void 0:l.snap)??null;if(!l||!Ak(c)||!rb(u))return{};const h=ab(s,e,f),p=j0(a.targetId),v=a.boundsPx;return Hu={targetId:a.targetId,handle:a.position,startX:h.x,startY:h.y,offset:f,axis:c,baseBounds:{...u},basePx:{left:v.left,right:v.right,top:v.top,bottom:v.bottom},minWidthIndex:Number(a.minWidthIndex)||2,minHeightValue:Number(a.minHeightValue)||0,originalEdit:p?{...p}:void 0,snap:d},{selectedId:a.targetId,resizingId:a.targetId,cursor:jy(a.position)}}}const o=t.find(r=>r.id===n.id&&r.type===n.type);if(o&&j$.has(n.type)){const r=o.axis,a=o.offset??{x:0,y:0};if(!Ak(r))return{selectedId:n.id};const l=ab(s,e,a);if(n.type==="box"&&rb(o.box)){const c=r.toX(o.box.leftIndex),f=r.toX(o.box.rightIndex),u=r.toY(o.box.topValue),d=r.toY(o.box.bottomValue);ap(c)&&ap(f)&&ap(u)&&ap(d)&&(Uc={id:n.id,type:"box",startX:l.x,startY:l.y,offset:a,axis:r,baseBox:{...o.box},basePx:{left:c,right:f,top:u,bottom:d},snap:o.snap??null})}else if(n.type==="label"&&ix(o.label)){const c=r.toX(o.label.index),f=r.toY(o.label.value);ap(c)&&ap(f)&&(Uc={id:n.id,type:"label",startX:l.x,startY:l.y,offset:a,axis:r,baseLabel:{...o.label},baseAnchorPx:{x:c,y:f},snap:o.snap??null})}else{const c=r.toIndex(l.x),f=r.toValue(l.y);if(ap(c)&&ap(f)){const u=j0(n.id);Uc={id:n.id,type:"shape",startX:l.x,startY:l.y,offset:a,axis:r,baseIndex:c,baseValue:f,baseTranslate:u!=null&&u.translate?{...u.translate}:{dxIndex:0,dyValue:0},snap:o.snap??null}}}Hu=null}else Uc=null,Hu=null;return{selectedId:n.id,draggingId:Uc==null?void 0:Uc.id}}function rx(){if(!Cm("interactionV2"))return{};if(Hu){const e=Hu.targetId;return Hu=null,{endedId:e}}if(!Uc)return{};const s=Uc.id;return Uc=null,{endedId:s}}function V$(s){if(Cm("interactionV2")){if(Hu){const e=Hu.targetId;Hu.originalEdit?i0(e,Hu.originalEdit):Ck(e),Hu=null;return}Uc&&(Ck(Uc.id),Uc=null)}}function W$(s,e,t){if(!Cm("interactionV2"))return{};if(!s||!s.id)return{};if(!ap(e)||!ap(t))return{};if(e===0&&t===0)return{};const n=j0(s.id),o=n!=null&&n.box&&rb(n.box)?n.box:s.box,r=n!=null&&n.label&&ix(n.label)?n.label:s.label;if(s.type==="box"&&rb(o))return i0(s.id,{box:{leftIndex:o.leftIndex+e,rightIndex:o.rightIndex+e,topValue:o.topValue+t,bottomValue:o.bottomValue+t},hidden:n==null?void 0:n.hidden}),{nudgedId:s.id};if(s.type==="label"&&ix(r))return i0(s.id,{label:{index:r.index+e,value:r.value+t},hidden:n==null?void 0:n.hidden}),{nudgedId:s.id};if(s.type==="line"||s.type==="lineSegment"||s.type==="polyline"||s.type==="polygon"||s.type==="path"){const a=(n==null?void 0:n.translate)??{dxIndex:0,dyValue:0};return i0(s.id,{translate:{dxIndex:a.dxIndex+e,dyValue:a.dyValue+t},hidden:n==null?void 0:n.hidden}),{nudgedId:s.id}}return{}}var H$=ga('<path d="M12.41465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L12.41465,12C12.20873,12.5826,11.65311,13,11,13C10.34689,13,9.79127,12.5826,9.58535,12L3.5,12C3.223857,12,3,11.77614,3,11.5C3,11.22386,3.223857,11,3.5,11L9.58535,11C9.79127,10.417404,10.34689,10,11,10C11.65311,10,12.20873,10.417404,12.41465,11Z" stroke-opacity="0" stroke="none"></path>'),q$=ga('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" d="M2 9.75a1.5 1.5 0 0 0-1.5 1.5v5.5a1.5 1.5 0 0 0 1.5 1.5h24a1.5 1.5 0 0 0 1.5-1.5v-5.5a1.5 1.5 0 0 0-1.5-1.5zm0 1h3v2.5h1v-2.5h3.25v3.9h1v-3.9h3.25v2.5h1v-2.5h3.25v3.9h1v-3.9H22v2.5h1v-2.5h3a.5.5 0 0 1 .5.5v5.5a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-5.5a.5.5 0 0 1 .5-.5z" transform="rotate(-45 14 14)"></path></g>'),U$=ga('<path d="M21,5.5C21,6.32843,20.3284,7,19.5,7C19.4136,7,19.3289,6.99269,19.2465,6.97866L15.6257,15.5086C15.8587,15.7729,16,16.119999999999997,16,16.5C16,17.328400000000002,15.3284,18,14.5,18C13.8469,18,13.2913,17.5826,13.0854,17L3.91465,17C3.70873,17.5826,3.15311,18,2.5,18C1.671573,18,1,17.328400000000002,1,16.5C1,15.6716,1.671573,15,2.5,15C2.5840199999999998,15,2.66643,15.0069,2.74668,15.0202L6.36934,6.48574C6.13933,6.22213,6,5.87733,6,5.5C6,4.671573,6.67157,4,7.5,4C8.15311,4,8.70873,4.417404,8.91465,5L18.0854,5C18.2913,4.417404,18.8469,4,19.5,4C20.3284,4,21,4.671573,21,5.5ZM18.0854,6L8.91465,6C8.892579999999999,6.06243,8.8665,6.12296,8.83672,6.18128L13.9814,15.0921C14.143,15.0325,14.3177,15,14.5,15C14.584,15,14.6664,15.0069,14.7467,15.0202L18.3693,6.48574C18.2462,6.3446,18.149,6.1802,18.0854,6ZM13.2036,15.745L8.0861,6.8811800000000005C7.90605,6.95768,7.70797,7,7.5,7C7.41359,7,7.32888,6.99269,7.24647,6.97866L3.62571,15.5086C3.7512,15.651,3.8501,15.8174,3.91465,16L13.0854,16C13.1169,15.9108,13.1566,15.8255,13.2036,15.745Z" stroke-opacity="0" stroke="none"></path>'),G$=ga('<path d="M9.474616630859375,7.494615087890625L8.844736630859375,7.494615087890625L8.844736630859375,4.149892087890625L8.000006630859374,4.634915087890625L8.004896630859374,4.005035087890625L9.020516630859376,3.414215087890625L9.474616630859375,3.414215087890625L9.474616630859375,7.494615087890625ZM18.529296630859378,4.8318550878906255Q18.307996630859375,5.028795087890625,18.122396630859377,5.385245087890625Q17.868496630859376,5.019035087890625,17.629196630859376,4.8269750878906255Q17.389996630859375,4.634915087890625,17.168596630859376,4.634915087890625Q16.794296630859375,4.634915087890625,16.522496630859376,4.976715087890625Q16.252296630859377,5.3168850878906255,16.252296630859377,5.7856350878906255Q16.252296630859377,6.218575087890625,16.502896630859375,6.521315087890625Q16.755196630859373,6.822415087890625,17.114896630859377,6.822415087890625Q17.368796630859375,6.822415087890625,17.588596630859374,6.625475087890624Q17.809896630859377,6.428535087890625,17.998696630859374,6.0688350878906245Q18.249396630859373,6.439935087890625,18.488596630859377,6.631985087890625Q18.727896630859377,6.822415087890625,18.952496630859375,6.822415087890625Q19.326796630859373,6.822415087890625,19.596996630859376,6.482245087890625Q19.868796630859375,6.140455087890626,19.868796630859375,5.671705087890626Q19.868796630859375,5.238755087890625,19.618196630859376,4.937655087890625Q19.367496630859375,4.634915087890625,19.006196630859375,4.634915087890625Q18.750696630859377,4.634915087890625,18.529296630859378,4.8318550878906255ZM18.337296630859377,5.674955087890625L18.278696630859375,5.596835087890625Q18.449596630859375,5.272935087890625,18.622096630859374,5.1101750878906245Q18.794596630859374,4.947415087890625,18.967096630859373,4.947415087890625Q19.194996630859375,4.947415087890625,19.346396630859374,5.1345950878906255Q19.497696630859377,5.320135087890625,19.497696630859377,5.598455087890625Q19.497696630859377,5.8914250878906245,19.360996630859376,6.096505087890625Q19.224296630859374,6.301585087890626,19.027396630859375,6.301585087890626Q18.915096630859374,6.301585087890626,18.742496630859375,6.146965087890624Q18.569996630859375,5.992335087890625,18.337296630859377,5.674955087890625ZM17.785496630859377,5.779125087890625L17.842496630859372,5.857245087890625Q17.668296630859373,6.186025087890625,17.495796630859374,6.348785087890625Q17.324896630859374,6.509915087890625,17.153996630859375,6.509915087890625Q16.926096630859377,6.509915087890625,16.774796630859377,6.324375087890624Q16.623396630859375,6.137195087890625,16.623396630859375,5.858875087890625Q16.623396630859375,5.565905087890625,16.761696630859376,5.360825087890625Q16.900096630859373,5.1557550878906255,17.095396630859376,5.1557550878906255Q17.228896630859374,5.1557550878906255,17.365596630859375,5.2778250878906245Q17.502296630859377,5.399895087890625,17.785496630859377,5.779125087890625ZM10.710296630859375,10.634915087890626C10.710296630859375,11.024655087890626,10.561656630859375,11.379685087890625,10.317976630859375,11.646395087890625L12.879196630859376,15.171615087890626C12.985696630859374,15.147615087890625,13.096496630859376,15.134915087890626,13.210296630859375,15.134915087890626C13.306796630859376,15.134915087890626,13.401096630859374,15.144015087890624,13.492596630859374,15.161415087890624L16.819096630859377,11.196955087890625C16.748996630859374,11.023375087890624,16.710296630859375,10.833655087890625,16.710296630859375,10.634915087890626C16.710296630859375,9.806495087890625,17.381896630859373,9.134915087890626,18.210296630859375,9.134915087890626C19.038696630859373,9.134915087890626,19.710296630859375,9.806495087890625,19.710296630859375,10.634915087890626C19.710296630859375,11.463345087890625,19.038696630859373,12.134915087890626,18.210296630859375,12.134915087890626C17.949796630859375,12.134915087890626,17.704796630859377,12.068505087890625,17.491296630859374,11.951675087890624L14.364996630859375,15.677415087890624C14.580596630859375,15.937215087890625,14.710296630859375,16.270915087890625,14.710296630859375,16.634915087890626C14.710296630859375,17.463315087890624,14.038696630859375,18.134915087890626,13.210296630859375,18.134915087890626C12.381866630859374,18.134915087890626,11.710296630859375,17.463315087890624,11.710296630859375,16.634915087890626C11.710296630859375,16.284415087890626,11.830486630859374,15.962015087890626,12.031896630859375,15.706715087890625L9.425686630859374,12.119565087890624C9.355346630859376,12.129685087890625,9.283436630859375,12.134915087890626,9.210296630859375,12.134915087890626C8.872396630859374,12.134915087890626,8.560596630859376,12.023195087890626,8.309816630859375,11.834665087890626L5.215876630859375,15.521915087890624C5.519506630859375,15.796415087890624,5.710296630859375,16.193415087890624,5.710296630859375,16.634915087890626C5.710296630859375,17.463315087890624,5.038726630859375,18.134915087890626,4.210296630859375,18.134915087890626C3.381869630859375,18.134915087890626,2.710296630859375,17.463315087890624,2.710296630859375,16.634915087890626C2.710296630859375,15.806515087890626,3.381869630859375,15.134915087890626,4.210296630859375,15.134915087890626C4.218546630859375,15.134915087890626,4.226776630859375,15.135015087890626,4.234996630859375,15.135115087890625L7.744116630859375,10.953115087890625C7.721966630859375,10.850565087890626,7.710296630859375,10.744105087890624,7.710296630859375,10.634915087890626C7.710296630859375,9.806495087890625,8.381866630859374,9.134915087890626,9.210296630859375,9.134915087890626C10.038726630859376,9.134915087890626,10.710296630859375,9.806495087890625,10.710296630859375,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),Y$=ga('<path d="M17.0643,7.033864912109375L18,3.585784912109375L14.5078,4.509695912109375L15.3537,5.344934912109375L6.02026,14.560584912109375C5.87635,14.517484912109374,5.72366,14.494284912109375,5.5655,14.494284912109375C4.7009,14.494284912109375,4,15.186384912109375,4,16.040084912109375C4,16.893784912109375,4.7009,17.585784912109375,5.5655,17.585784912109375C6.43011,17.585784912109375,7.13101,16.893784912109375,7.13101,16.040084912109375C7.13101,15.722284912109375,7.03392,15.426984912109376,6.86744,15.181384912109374L16.0917,6.073604912109375L17.0643,7.033864912109375Z" stroke-opacity="0" stroke="none"></path>'),K$=ga('<g transform="scale(0.7857142857)" fill="none"><path stroke="currentColor" d="M16 14a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4.5 14a9.5 9.5 0 0 1 18.7-2.37 2.5 2.5 0 0 0 0 4.74A9.5 9.5 0 0 1 4.5 14Zm19.7 2.5a10.5 10.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path><path fill="currentColor" d="M22.5 14a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></g>'),X$=ga('<path d="M18.8532,7.020985087890625Q19.0257,6.734525087890625,19.0257,6.369945087890625Q19.0257,6.020005087890625,18.8499,5.754705087890625Q18.6758,5.489415087890626,18.3649,5.339675087890625Q18.5944,5.209465087890625,18.7214,4.994615087890625Q18.8499,4.779775087890625,18.8499,4.5193550878906255Q18.8499,4.2003480878906245,18.7002,3.951324087890625Q18.5505,3.700673087890625,18.277,3.557444087890625Q18.0052,3.414215087890625,17.6455,3.414215087890625Q17.285800000000002,3.414215087890625,17.0107,3.557444087890625Q16.7357,3.700673087890625,16.5843,3.951324087890625Q16.4346,4.2003480878906245,16.4346,4.5193550878906255Q16.4346,4.779775087890625,16.561500000000002,4.994615087890625Q16.6901,5.209465087890625,16.919600000000003,5.339675087890625Q16.6055,5.489415087890626,16.4297,5.757965087890625Q16.255499999999998,6.024895087890625,16.255499999999998,6.369945087890625Q16.255499999999998,6.734525087890625,16.4297,7.020985087890625Q16.6055,7.305815087890625,16.919600000000003,7.465325087890625Q17.2354,7.624825087890625,17.6455,7.624825087890625Q18.0557,7.624825087890625,18.3682,7.465325087890625Q18.6807,7.305815087890625,18.8532,7.020985087890625ZM8.76432,7.559725087890625L8.13444,7.559725087890625L8.13444,4.214996087890625L7.28971,4.700025087890625L7.2946,4.070139087890625L8.310220000000001,3.479319087890625L8.76432,3.479319087890625L8.76432,7.559725087890625ZM17.1816,4.955555087890625Q17.0042,4.784655087890625,17.0042,4.5095950878906255Q17.0042,4.229645087890625,17.18,4.057119087890625Q17.355800000000002,3.884592087890625,17.6455,3.884592087890625Q17.935200000000002,3.884592087890625,18.1077,4.057119087890625Q18.2803,4.229645087890625,18.2803,4.5095950878906255Q18.2803,4.784655087890625,18.1045,4.955555087890625Q17.930300000000003,5.124825087890625,17.6455,5.124825087890625Q17.3607,5.124825087890625,17.1816,4.955555087890625ZM18.2217,5.7953950878906255Q18.4398,6.005365087890625,18.4398,6.3552950878906245Q18.4398,6.705235087890625,18.2217,6.915195087890625Q18.0052,7.125155087890625,17.6455,7.125155087890625Q17.285800000000002,7.125155087890625,17.067700000000002,6.915195087890625Q16.849600000000002,6.705235087890625,16.849600000000002,6.3552950878906245Q16.849600000000002,6.005365087890625,17.064500000000002,5.7953950878906255Q17.2793,5.585435087890625,17.6455,5.585435087890625Q18.0052,5.585435087890625,18.2217,5.7953950878906255ZM9.60768,11.711495087890626C9.85136,11.444785087890626,10,11.089765087890626,10,10.700025087890625C10,9.871595087890626,9.32843,9.200025087890625,8.5,9.200025087890625C7.67157,9.200025087890625,7,9.871595087890626,7,10.700025087890625C7,10.809205087890625,7.01167,10.915665087890625,7.03382,11.018215087890624L3.5247,15.200215087890625C3.51648,15.200115087890625,3.5082500000000003,15.200015087890625,3.5,15.200015087890625C2.671573,15.200015087890625,2,15.871615087890625,2,16.700015087890627C2,17.528415087890625,2.671573,18.200015087890627,3.5,18.200015087890627C4.32843,18.200015087890627,5,17.528415087890625,5,16.700015087890627C5,16.258515087890625,4.80921,15.861515087890625,4.50558,15.587015087890626L7.59952,11.899765087890625C7.8503,12.088295087890625,8.162099999999999,12.200025087890625,8.5,12.200025087890625C8.57314,12.200025087890625,8.645050000000001,12.194785087890626,8.71539,12.184675087890625L11.3216,15.771815087890625C11.12019,16.027215087890625,11,16.349515087890623,11,16.700015087890627C11,17.528415087890625,11.67157,18.200015087890627,12.5,18.200015087890627C13.3284,18.200015087890627,14,17.528415087890625,14,16.700015087890627C14,16.336015087890623,13.8703,16.002315087890626,13.6547,15.742515087890625L16.781,12.016775087890625C16.994500000000002,12.133605087890626,17.2395,12.200025087890625,17.5,12.200025087890625C18.3284,12.200025087890625,19,11.528445087890624,19,10.700025087890625C19,9.871595087890626,18.3284,9.200025087890625,17.5,9.200025087890625C16.671599999999998,9.200025087890625,16,9.871595087890626,16,10.700025087890625C16,10.898765087890624,16.0387,11.088475087890625,16.108800000000002,11.262055087890625L12.7823,15.226515087890625C12.6908,15.209115087890625,12.5965,15.200015087890625,12.5,15.200015087890625C12.3862,15.200015087890625,12.2754,15.212715087890626,12.1689,15.236715087890625L9.60768,11.711495087890626Z" stroke-opacity="0" stroke="none"></path>'),Z$=ga('<ellipse cx="10.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="17.5" cy="11.5" rx="1.5" ry="1.5" stroke-opacity="0" stroke="none"></ellipse><ellipse cx="10.5" cy="11.5" rx="7" ry="7" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse><ellipse cx="10.5" cy="11.5" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="0.5"></ellipse>',1),J$=ga('<path d="M17,4.5C17,5.32843,16.328400000000002,6,15.5,6C15.0931,6,14.7241,5.83802,14.4539,5.57503L5.98992,8.32515C5.99658,8.38251,6,8.440850000000001,6,8.5C6,9.15311,5.582599999999999,9.70873,5,9.91465L5,11.08535C5.42621,11.236,5.763999999999999,11.57379,5.91465,12L19.5,12C19.7761,12,20,12.22386,20,12.5C20,12.77614,19.7761,13,19.5,13L5.91465,13C5.70873,13.5826,5.15311,14,4.5,14C3.671573,14,3,13.3284,3,12.5C3,11.84689,3.417404,11.29127,4,11.08535L4,9.91465C3.417404,9.70873,3,9.15311,3,8.5C3,7.67157,3.671573,7,4.5,7C4.90411,7,5.2709,7.15981,5.5406200000000005,7.41967L14.0093,4.66802C14.0032,4.6128599999999995,14,4.5568,14,4.5C14,3.671573,14.6716,3,15.5,3C16.328400000000002,3,17,3.671573,17,4.5ZM4,15.5C4,15.2239,4.22386,15,4.5,15L19.5,15C19.7761,15,20,15.2239,20,15.5C20,15.7761,19.7761,16,19.5,16L4.5,16C4.22386,16,4,15.7761,4,15.5ZM4,18.5C4,18.2239,4.22386,18,4.5,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L4.5,19C4.22386,19,4,18.7761,4,18.5Z" stroke-opacity="0" stroke="none"></path>'),Q$=ga('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M21 15H3a1 1 0 0 1 0-2h18a1 1 0 0 1 0 2Zm-2-3a2.99 2.99 0 0 1-2.816-2H3a1 1 0 0 1 0-2h13.184A2.995 2.995 0 1 1 19 12Zm0-4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm2-3H3a1 1 0 0 1 0-2h18a1 1 0 1 1 0 2ZM5 16a2.99 2.99 0 0 1 2.816 2H21a1 1 0 0 1 0 2H7.816A2.995 2.995 0 1 1 5 16Zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"></path></g>'),eD=ga('<path d="M4,17.0854L4,3.5C4,3.223858,4.22386,3,4.5,3C4.77614,3,5,3.223858,5,3.5L5,10L7.57584,10L9.8127,4.46359C9.91614,4.20756,10.20756,4.08386,10.46359,4.1873000000000005C10.71963,4.29075,10.84333,4.58216,10.73988,4.8382000000000005L8.65438,10L11.08535,10C11.29127,9.4174,11.84689,9,12.5,9C12.65154,9,12.79784,9.02247,12.93573,9.06427L16.6464,5.35355C16.8417,5.15829,17.1583,5.15829,17.3536,5.35355C17.5488,5.54882,17.5488,5.8654,17.3536,6.06066L13.7475,9.66675C13.907,9.90508,14,10.19168,14,10.5C14,11.15311,13.5826,11.70873,13,11.91465L13,14.3638L18.3714,12.1936C18.6274,12.09015,18.918799999999997,12.21385,19.0222,12.46989C19.1257,12.72592,19.002,13.0173,18.746000000000002,13.1208L13,15.4423L13,18L19.5,18C19.7761,18,20,18.2239,20,18.5C20,18.7761,19.7761,19,19.5,19L5.91465,19C5.70873,19.5826,5.15311,20,4.5,20C3.671573,20,3,19.3284,3,18.5C3,17.846899999999998,3.417404,17.2913,4,17.0854ZM6.3729499999999994,17.0413L12,14.7678L12,11.91465C11.88136,11.87271,11.76956,11.81627,11.66675,11.74746L6.3729499999999994,17.0413ZM12,15.8463L6.6694700000000005,18L12,18L12,15.8463ZM6.38629,15.6137L8.250350000000001,11L11,11L6.38629,15.6137ZM5,11L7.17182,11L5,16.3754L5,11Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),tD=ga('<path d="M3,7.32468C5.90649,3.3893050000000002,11.49833,2.81306,14.6674,6.31944C14.9056,6.1554199999999994,15.192,6.05979,15.5,6.05979C15.845,6.05979,16.1628,6.17974,16.4162,6.381349999999999L18.4509,4.23827L19,4.816615L16.8945,7.03429C16.962600000000002,7.21075,17,7.40319,17,7.60463C17,8.45782,16.328400000000002,9.14947,15.5,9.14947C14.6716,9.14947,14,8.45782,14,7.60463C14,7.36402,14.0534,7.13625,14.1487,6.93322C11.32695,3.748365,6.25159,4.253956,3.612785,7.82695L3,7.32468ZM14.09,15.4717C15.7427,13.78985,16.244500000000002,11.524740000000001,15.5633,9.30134L15.5618,9.30134L16.3012,9.0502C17.072400000000002,11.56646,16.497700000000002,14.158,14.6282,16.0599C12.28737,18.442,8.62386,18.6988,6.41348,16.4501C4.5526,14.5572,4.52076,11.19671,6.36766,9.3177C7.89069,7.76754,10.07544,7.706189999999999,11.56741,9.22363C11.95453,9.61742,12.24817,10.08363,12.43369,10.57677L14.1451,8.77421L14.6942,9.35256L12.64982,11.50582C12.65827,11.59712,12.66295,11.68839,12.66378,11.77936C12.87398,12.04523,13,12.38451,13,12.7541C13,13.60729,12.32843,14.2989,11.5,14.2989C10.67157,14.2989,10,13.60729,10,12.7541C10,11.90091,10.67157,11.20926,11.5,11.20926C11.60387,11.20926,11.70528,11.220130000000001,11.8032,11.240829999999999L11.81763,11.22564C11.69858,10.71874,11.42858,10.21929,11.0284,9.81179C9.844000000000001,8.60765,8.136890000000001,8.65592,6.90822,9.90586C5.37975,11.460930000000001,5.40693,14.288,6.95404,15.8619C8.84598,17.7867,12.03496,17.5626,14.09,15.4717Z" stroke-opacity="0" stroke="none"></path>'),sD=ga('<path d="M8.13444,7.494615087890625L8.76432,7.494615087890625L8.76432,3.414215087890625L8.310220000000001,3.414215087890625L7.2946,4.005035087890625L7.28971,4.634915087890625L8.13444,4.149892087890625L8.13444,7.494615087890625ZM18.832,6.929835087890625Q19.0046,6.635245087890625,19.0046,6.2543850878906255Q19.0046,5.889805087890625,18.8451,5.5952050878906245Q18.6855,5.3006050878906255,18.3975,5.132965087890625Q18.1094,4.9653250878906245,17.7399,4.9653250878906245Q17.435499999999998,4.9653250878906245,17.1556,5.149245087890625L17.2793,3.939931087890625L18.8304,3.939931087890625L18.8304,3.414215087890625L16.7406,3.414215087890625L16.5094,5.665195087890625L17.0156,5.795405087890625Q17.095399999999998,5.655425087890626,17.2516,5.570795087890625Q17.4095,5.484525087890625,17.6357,5.484525087890625Q17.9694,5.484525087890625,18.1842,5.697745087890625Q18.4007,5.909335087890625,18.4007,6.2543850878906255Q18.4007,6.604315087890625,18.1842,6.822415087890625Q17.9694,7.0405150878906255,17.6292,7.0405150878906255Q17.3298,7.0405150878906255,17.119799999999998,6.890775087890625Q16.9098,6.739415087890626,16.825200000000002,6.474115087890625L16.3597,6.749175087890626Q16.470399999999998,7.110505087890624,16.807299999999998,7.335115087890625Q17.144199999999998,7.559725087890625,17.6292,7.559725087890625Q18.0296,7.559725087890625,18.3438,7.392075087890625Q18.6595,7.224435087890625,18.832,6.929835087890625ZM10,10.634915087890626C10,11.024655087890626,9.85136,11.379685087890625,9.60768,11.646395087890625L12.1689,15.171615087890626C12.2754,15.147615087890625,12.3862,15.134915087890626,12.5,15.134915087890626C12.5965,15.134915087890626,12.6908,15.144015087890624,12.7823,15.161415087890624L16.108800000000002,11.196955087890625C16.0387,11.023375087890624,16,10.833655087890625,16,10.634915087890626C16,9.806495087890625,16.671599999999998,9.134915087890626,17.5,9.134915087890626C18.3284,9.134915087890626,19,9.806495087890625,19,10.634915087890626C19,11.463345087890625,18.3284,12.134915087890626,17.5,12.134915087890626C17.2395,12.134915087890626,16.994500000000002,12.068505087890625,16.781,11.951675087890624L13.6547,15.677415087890624C13.8703,15.937215087890625,14,16.270915087890625,14,16.634915087890626C14,17.463315087890624,13.3284,18.134915087890626,12.5,18.134915087890626C11.67157,18.134915087890626,11,17.463315087890624,11,16.634915087890626C11,16.284415087890626,11.12019,15.962015087890626,11.3216,15.706715087890625L8.71539,12.119565087890624C8.645050000000001,12.129685087890625,8.57314,12.134915087890626,8.5,12.134915087890626C8.162099999999999,12.134915087890626,7.8503,12.023195087890626,7.59952,11.834665087890626L4.50558,15.521915087890624C4.80921,15.796415087890624,5,16.193415087890624,5,16.634915087890626C5,17.463315087890624,4.32843,18.134915087890626,3.5,18.134915087890626C2.671573,18.134915087890626,2,17.463315087890624,2,16.634915087890626C2,15.806515087890626,2.671573,15.134915087890626,3.5,15.134915087890626C3.5082500000000003,15.134915087890626,3.51648,15.135015087890626,3.5247,15.135115087890625L7.03382,10.953115087890625C7.01167,10.850565087890626,7,10.744105087890624,7,10.634915087890626C7,9.806495087890625,7.67157,9.134915087890626,8.5,9.134915087890626C9.32843,9.134915087890626,10,9.806495087890625,10,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),nD=ga('<path d="M20,3.5C20,4.15311,19.5826,4.70873,19,4.91465L19,18.5C19,18.7761,18.7761,19,18.5,19L4.91465,19C4.70873,19.5826,4.15311,20,3.5,20C2.671573,20,2,19.3284,2,18.5C2,17.846899999999998,2.417404,17.2913,3,17.0854L3,3.5C3,3.22386,3.22386,3,3.5,3L17.0854,3C17.2913,2.417404,17.846899999999998,2,18.5,2C19.3284,2,20,2.671573,20,3.5ZM17.0854,4C17.236,4.42621,17.5738,4.763999999999999,18,4.91465L18,8L14,8L14,4L17.0854,4ZM13,4L13,8L9,8L9,4L13,4ZM13,9L9,9L9,13L13,13L13,9ZM13,14L9,14L9,18L13,18L13,14ZM14,18L14,14L18,14L18,18L14,18ZM18,13L14,13L14,9L18,9L18,13ZM4.91465,18C4.763999999999999,17.5738,4.42621,17.236,4,17.0854L4,14L8,14L8,18L4.91465,18ZM4,8L4,4L8,4L8,8L4,8ZM8,9L8,13L4,13L4,9L8,9Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),oD=ga('<path d="M6.91465,11L11.08535,11C11.29127,10.417404,11.84689,10,12.5,10C13.15311,10,13.70873,10.417404,13.91465,11L18.5,11C18.7761,11,19,11.22386,19,11.5C19,11.77614,18.7761,12,18.5,12L13.91465,12C13.70873,12.5826,13.15311,13,12.5,13C11.84689,13,11.29127,12.5826,11.08535,12L6.91465,12C6.70873,12.5826,6.15311,13,5.5,13C4.671573,13,4,12.32843,4,11.5C4,10.671573,4.671573,10,5.5,10C6.15311,10,6.70873,10.417404,6.91465,11Z" stroke-opacity="0" stroke="none"></path>'),iD=ga('<path d="M6.91465,12.5C6.70873,13.0826,6.15311,13.5,5.5,13.5C4.671573,13.5,4,12.82843,4,12C4,11.171573,4.671573,10.5,5.5,10.5C6.15311,10.5,6.70873,10.917404,6.91465,11.5L16.0853,11.5C16.2913,10.917404,16.846899999999998,10.5,17.5,10.5C18.328400000000002,10.5,19,11.171573,19,12C19,12.82843,18.328400000000002,13.5,17.5,13.5C16.846899999999998,13.5,16.2913,13.0826,16.0853,12.5L6.91465,12.5Z" stroke-opacity="0" stroke="none"></path>'),rD=ga('<path d="M5.80417,14.9887L4.62563,16.167299999999997C4.43037,16.3625,4.43037,16.6791,4.62563,16.8744C4.82089,17.0696,5.13748,17.0696,5.332739999999999,16.8744L6.62638,15.5807C7.75595,16.290100000000002,9.19328,16.7929,11,16.7929C16.165399999999998,16.7929,18.3323,12.64289,18.8866,11.36789C19.0378,10.99289,19.0378,10.59289,18.8866,10.21789C18.5549,9.45486,17.6456,7.66212,15.8617,6.34545L17.3536,4.853553C17.5488,4.658291,17.5488,4.341709,17.3536,4.146447C17.1583,3.9511845,16.8417,3.9511845,16.6464,4.146447L15.0014,5.7915399999999995C13.9314,5.1969,12.61166,4.792893,11,4.792893C5.80945,4.792893,3.667717,8.94289,3.113386,10.21789C2.9622049,10.59289,2.9622049,10.99289,3.113386,11.36789C3.424435,12.08333,4.2353000000000005,13.70399,5.80417,14.9887ZM7.36012,14.847C8.32327,15.4074,9.52286,15.7929,11,15.7929C15.5606,15.7929,17.4756,12.11789,17.9543,10.99289C18.0047,10.86789,18.0047,10.74289,17.9543,10.61789C17.659,9.90846,16.8171,8.23812,15.1447,7.06241L12.96929,9.23782C13.3134,9.66543,13.5197,10.20642,13.5197,10.79289C13.5197,12.16789,12.38583,13.29289,11,13.29289C10.41596,13.29289,9.87667,13.09308,9.44815,12.75896L7.36012,14.847ZM8.794609999999999,11.99829L6.520099999999999,14.2728C5.06905,13.12119,4.32057,11.628250000000001,4.04567,10.96789C3.995275,10.84289,3.995275,10.71789,4.04567,10.59289C4.52441,9.46789,6.43937,5.79289,11,5.79289C12.28868,5.79289,13.3661,6.086320000000001,14.2596,6.53329L12.19759,8.5953C11.84086,8.40257,11.43271,8.29289,11,8.29289C9.61417,8.29289,8.480319999999999,9.41789,8.480319999999999,10.79289C8.480319999999999,11.22918,8.594470000000001,11.64029,8.794609999999999,11.99829ZM10.16528,12.04183C10.404869999999999,12.20032,10.692070000000001,12.29289,11,12.29289C11.8315,12.29289,12.51181,11.61789,12.51181,10.79289C12.51181,10.48318,12.41593,10.194600000000001,12.25216,9.95494L10.16528,12.04183ZM11.43602,9.35687L9.55616,11.236740000000001C9.512,11.09633,9.48819,10.94724,9.48819,10.79289C9.48819,9.96789,10.1685,9.29289,11,9.29289C11.15142,9.29289,11.29782,9.31528,11.43602,9.35687Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),aD=ga('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),lD=ga('<defs><clipPath id="master_svg0_151_625"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_625)"><path d="M14.5385,9.76923L15.6538,9.76923C16.6538,9.76923,17.4615,10.576920000000001,17.4615,11.576920000000001L17.4615,17.1923C17.4615,18.1923,16.6538,19,15.6538,19L5.80769,19C4.807692,19,4,18.1923,4,17.1923L4,11.576920000000001C4,10.576920000000001,4.807692,9.76923,5.80769,9.76923L7.23077,9.76923L7.23077,7.576919999999999C7.23077,5.61538,8.88462,4,10.88462,4C12.88462,4,14.5385,5.61538,14.5385,7.576919999999999L14.5385,9.76923ZM10.88461,5.15385C9.5,5.15385,8.38461,6.23077,8.38461,7.576919999999999L8.38461,9.76923L13.38462,9.76923L13.38462,7.576919999999999C13.38462,6.23077,12.26923,5.15385,10.88461,5.15385ZM15.6538,17.8462C16,17.8462,16.3077,17.5385,16.3077,17.1923L16.3077,11.576920000000001C16.3077,11.23077,16,10.923079999999999,15.6538,10.923079999999999L5.80769,10.923079999999999C5.46154,10.923079999999999,5.15385,11.23077,5.15385,11.576920000000001L5.15385,17.1923C5.15385,17.5385,5.46154,17.8462,5.80769,17.8462L15.6538,17.8462ZM10.153839999999999,12.65385C10.153839999999999,12.34615,10.42307,12.07692,10.73076,12.07692C11.038450000000001,12.07692,11.307680000000001,12.34615,11.307680000000001,12.65385L11.307680000000001,14.5769C11.307680000000001,14.8846,11.038450000000001,15.1538,10.73076,15.1538C10.42307,15.1538,10.153839999999999,14.8846,10.153839999999999,14.5769L10.153839999999999,12.65385Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),cD=ga('<path d="M19.6401,7.99355C20.4028,7.92291,21,7.2811900000000005,21,6.5C21,5.671573,20.3284,5,19.5,5C18.8469,5,18.2913,5.417404,18.0854,6L7.62067,6C7.34453,6,7.12067,6.22386,7.12067,6.5C7.12067,6.5479,7.12741,6.59423,7.13999,6.63809L3.2294099999999997,15.0243C2.530138,15.1517,2,15.764,2,16.5C2,17.328400000000002,2.671573,18,3.5,18C4.15311,18,4.70873,17.5826,4.91465,17L14.5963,17C14.6456,17.076,14.7162,17.1396,14.8044,17.1807C15.0546,17.2974,15.3521,17.1891,15.4688,16.9388L19.6401,7.99355ZM14.7896,16.0293L18.6551,7.739599999999999C18.3942,7.56144,18.1925,7.30307,18.0854,7L8.0746,7L4.25044,15.2009C4.55701,15.3784,4.79493,15.6613,4.91465,16L14.6207,16C14.68,16,14.7368,16.0103,14.7896,16.0293Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),uD=ga('<path d="M3.3367688759765626,12.63173C3.5320318759765623,12.82699,3.8486138759765627,12.82699,4.043876875976562,12.63173L11.822052875976562,4.853553C12.017312875976563,4.658291,12.017312875976563,4.341708,11.822052875976562,4.146446C11.626792875976562,3.9511843,11.310202875976563,3.9511843,11.114942875976563,4.146446L3.3367688759765626,11.92462C3.1415071759765625,12.11988,3.1415071759765625,12.43647,3.3367688759765626,12.63173ZM5.001492875976562,17.0351C4.806232875976562,16.8399,4.806232875976562,16.5233,5.001492875976562,16.328L7.304532875976562,14.025C7.210822875976563,13.82916,7.158352875976563,13.60984,7.158352875976563,13.37827C7.158352875976563,12.54984,7.829922875976562,11.87827,8.658352875976561,11.87827C8.889922875976563,11.87827,9.109232875976563,11.93075,9.305052875976562,12.02446L11.304532875976562,10.02498C11.210822875976563,9.82916,11.158352875976561,9.60984,11.158352875976561,9.37827C11.158352875976561,8.54984,11.829922875976562,7.8782700000000006,12.658352875976563,7.8782700000000006C12.889922875976563,7.8782700000000006,13.109232875976563,7.93075,13.305022875976562,8.024460000000001L15.608122875976562,5.72142C15.803322875976562,5.5261499999999995,16.119922875976563,5.5261499999999995,16.315222875976563,5.72142C16.510422875976563,5.9166799999999995,16.510422875976563,6.23326,16.315222875976563,6.42852L14.012122875976562,8.73156C14.105822875976562,8.92738,14.158322875976562,9.1467,14.158322875976562,9.37827C14.158322875976562,10.2067,13.486822875976562,10.87827,12.658352875976563,10.87827C12.426772875976562,10.87827,12.207452875976562,10.82579,12.011642875976563,10.73209L10.012162875976562,12.73156C10.105872875976562,12.92738,10.158352875976561,13.1467,10.158352875976561,13.37827C10.158352875976561,14.2067,9.486772875976563,14.8783,8.658352875976561,14.8783C8.426772875976562,14.8783,8.207452875976562,14.8258,8.011642875976563,14.7321L5.708602875976562,17.0351C5.513342875976562,17.2304,5.196752875976562,17.2304,5.001492875976562,17.0351ZM10.415712875976563,18.328C10.220452875976562,18.5233,9.903862875976563,18.5233,9.708602875976563,18.328C9.513342875976562,18.1328,9.513342875976562,17.816200000000002,9.708602875976563,17.6209L12.304532875976562,15.025C12.210822875976563,14.8292,12.158352875976563,14.6098,12.158352875976563,14.3783C12.158352875976563,13.54984,12.829922875976562,12.87827,13.658322875976562,12.87827C13.889922875976563,12.87827,14.109222875976563,12.93075,14.305022875976562,13.02446L17.486822875976564,9.84274C17.682022875976564,9.64747,17.99862287597656,9.64747,18.19392287597656,9.84274C18.38912287597656,10.038,18.38912287597656,10.35458,18.19392287597656,10.54984L15.012122875976562,13.73156C15.105822875976562,13.92738,15.158322875976562,14.1467,15.158322875976562,14.3783C15.158322875976562,15.2067,14.486822875976562,15.8783,13.658322875976562,15.8783C13.426822875976562,15.8783,13.207422875976562,15.8258,13.011642875976563,15.7321L10.415712875976563,18.328Z" stroke-opacity="0" stroke="none"></path>'),dD=ga('<path d="M3.146447,14.178126025390625C2.9511847,13.982826025390626,2.9511847,13.666226025390625,3.146447,13.470926025390625L7.39146,9.225966025390626C7.35417,9.095106025390624,7.33421,8.956946025390625,7.33421,8.814116025390625C7.33421,7.985696025390625,8.00578,7.314116025390625,8.834209999999999,7.314116025390625C8.97703,7.314116025390625,9.11519,7.334086025390625,9.24605,7.371366025390625L13.753,2.864373025390625C13.9483,2.669110325390625,14.2649,2.669110325390625,14.4602,2.864373025390625C14.6554,3.059635025390625,14.6554,3.376217025390625,14.4602,3.571479025390625L10.06916,7.962476025390625C10.23631,8.204386025390626,10.334209999999999,8.497826025390625,10.334209999999999,8.814116025390625C10.334209999999999,9.642546025390626,9.66264,10.314116025390625,8.834209999999999,10.314116025390625C8.51791,10.314116025390625,8.22448,10.216226025390625,7.98256,10.049076025390626L3.853554,14.178126025390625C3.658291,14.373326025390625,3.341709,14.373326025390625,3.146447,14.178126025390625ZM7.67736,19.188526025390626C7.4821,18.993226025390626,7.4821,18.676626025390625,7.67736,18.481426025390626L9.9804,16.178326025390625C9.88669,15.982526025390625,9.834209999999999,15.763226025390624,9.834209999999999,15.531626025390626C9.834209999999999,14.703226025390626,10.50578,14.031626025390626,11.33421,14.031626025390626C11.56579,14.031626025390626,11.78511,14.084126025390624,11.98093,14.177826025390624L13.9804,12.178356025390626C13.8867,11.982536025390624,13.8342,11.763216025390625,13.8342,11.531636025390625C13.8342,10.703206025390624,14.5058,10.031636025390625,15.3342,10.031636025390625C15.5658,10.031636025390625,15.7851,10.084116025390625,15.9809,10.177826025390626L18.284,7.874796025390625C18.4792,7.679536025390625,18.7958,7.679536025390625,18.9911,7.874796025390625C19.1863,8.070056025390624,19.1863,8.386636025390626,18.9911,8.581906025390625L16.688000000000002,10.884936025390624C16.7817,11.080756025390626,16.8342,11.300066025390626,16.8342,11.531636025390625C16.8342,12.360066025390624,16.162599999999998,13.031626025390626,15.3342,13.031626025390626C15.1026,13.031626025390626,14.8833,12.979126025390626,14.6875,12.885426025390625L12.68803,14.884926025390625C12.78174,15.080726025390625,12.83421,15.300026025390626,12.83421,15.531626025390626C12.83421,16.360026025390624,12.16264,17.031626025390626,11.33421,17.031626025390626C11.10264,17.031626025390626,10.88333,16.979126025390627,10.68751,16.885426025390625L8.38446,19.188526025390626C8.1892,19.383726025390626,7.87262,19.383726025390626,7.67736,19.188526025390626Z" stroke-opacity="0" stroke="none"></path>'),fD=ga('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="m2.285 10.333 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382Zm10 10 8.048-8.048a.977.977 0 1 1 1.381 1.381l-8.048 8.049a.977.977 0 0 1-1.381-1.382ZM19 8a2.966 2.966 0 0 1-1.308-.312l-10 10c.202.408.307.857.308 1.312a3.03 3.03 0 1 1-1.693-2.689l10-10A2.993 2.993 0 1 1 19 8ZM5 18a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM19 4a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),pD=ga('<path d="M6.91465,13.00505L18.5,13.00505C18.7761,13.00505,19,13.228909999999999,19,13.50505C19,13.781189999999999,18.7761,14.00505,18.5,14.00505L6.91465,14.00505C6.70873,14.58765,6.15311,15.00505,5.5,15.00505C4.671573,15.00505,4,14.33348,4,13.50505C4,12.67662,4.671573,12.00505,5.5,12.00505C6.15311,12.00505,6.70873,12.422450000000001,6.91465,13.00505ZM7.81404,11.625L10.48591,11.625L10.48591,10.90625L9.65193,10.90625L9.65193,7.125L8.997630000000001,7.125C8.71443,7.306641,8.415600000000001,7.419922,7.96443,7.498047L7.96443,8.05078L8.77497,8.05078L8.77497,10.90625L7.81404,10.90625L7.81404,11.625ZM11.081620000000001,11.625L14.0562,11.625L14.0562,10.88281L13.09724,10.88281C12.8863,10.88281,12.59333,10.90625,12.36482,10.93555C13.17537,10.11328,13.84724,9.2207,13.84724,8.39062C13.84724,7.541016,13.28865,7,12.4488,7C11.84333,7,11.446850000000001,7.234375,11.03279,7.679688L11.52497,8.16797C11.747630000000001,7.914062,12.0113,7.697266,12.33552,7.697266C12.7613,7.697266,13.00154,7.982422,13.00154,8.43359C13.00154,9.14648,12.29255,10.00781,11.081620000000001,11.11523L11.081620000000001,11.625ZM15.9605,11.75C16.8121,11.75,17.526899999999998,11.2832,17.526899999999998,10.4375C17.526899999999998,9.82031,17.142200000000003,9.43945,16.6441,9.30078L16.6441,9.27148C17.1129,9.08594,17.3824,8.7207,17.3824,8.21289C17.3824,7.421875,16.8004,7,15.9429,7C15.4215,7,14.9957,7.210938,14.6109,7.541016L15.066,8.11133C15.3258,7.849609,15.5836,7.697266,15.9019,7.697266C16.2789,7.697266,16.4957,7.914062,16.4957,8.28125C16.4957,8.70898,16.2301,9,15.4215,9L15.4215,9.63672C16.3804,9.63672,16.6383,9.91992,16.6383,10.38086C16.6383,10.79688,16.3336,11.03125,15.8824,11.03125C15.4742,11.03125,15.1578,10.82227,14.8922,10.55078L14.4781,11.13281C14.7906,11.486329999999999,15.2652,11.75,15.9605,11.75Z" stroke-opacity="0" stroke="none"></path>'),hD=ga('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero"><path d="M8.354 20.354l5-5-.707-.707-5 5z"></path><path d="M16.354 12.354l8-8-.707-.707-8 8z"></path><path d="M14.5 15c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),mD=ga('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3 6C3 7.30622 3.83481 8.41746 5 8.82929V15.1707C3.83481 15.5825 3 16.6938 3 18C3 19.6569 4.34315 21 6 21C7.30622 21 8.41746 20.1652 8.82929 19H15.1707C15.5825 20.1652 16.6938 21 18 21C19.6569 21 21 19.6569 21 18C21 16.6938 20.1652 15.5825 19 15.1707V8.82929C20.1652 8.41746 21 7.30622 21 6C21 4.34315 19.6569 3 18 3C16.6938 3 15.5825 3.83481 15.1707 5H8.82929C8.41746 3.83481 7.30622 3 6 3C4.34315 3 3 4.34315 3 6ZM6 7C6.55228 7 7 6.55228 7 6C7 5.44772 6.55228 5 6 5C5.44772 5 5 5.44772 5 6C5 6.55228 5.44772 7 6 7ZM17 15.1707V8.82929C16.1476 8.52801 15.472 7.85242 15.1707 7H8.82929C8.52801 7.85241 7.85241 8.52801 7 8.82929V15.1707C7.85241 15.472 8.52801 16.1476 8.82929 17H15.1707C15.472 16.1476 16.1476 15.472 17 15.1707ZM18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5C17.4477 5 17 5.44772 17 6C17 6.55228 17.4477 7 18 7ZM7 18C7 18.5523 6.55228 19 6 19C5.44772 19 5 18.5523 5 18C5 17.4477 5.44772 17 6 17C6.55228 17 7 17.4477 7 18ZM19 18C19 18.5523 18.5523 19 18 19C17.4477 19 17 18.5523 17 18C17 17.4477 17.4477 17 18 17C18.5523 17 19 17.4477 19 18Z"></path></g>'),vD=ga('<path d="M16.966900000000003,8.67144C16.6669,8.67144,16.4247,8.91558,16.4247,9.21802L16.4247,16.631500000000003C16.4247,17.322,16.007199999999997,17.9068,15.5139,17.9068L13.93072,17.9068L13.93072,9.2162C13.93072,8.91741,13.68675,8.67144,13.38855,8.67144C13.09036,8.67144,12.84639,8.91741,12.84639,9.21802L12.84639,17.9068L10.151810000000001,17.9068L10.151810000000001,9.21802C10.151810000000001,8.91741,9.90783,8.67144,9.609639999999999,8.67144C9.31145,8.67144,9.06747,8.91741,9.06747,9.219850000000001L9.06747,17.9068L7.48614,17.9068C6.99277,17.9068,6.5753,17.322,6.5753,16.631500000000003L6.5753,9.21802C6.5753,8.91558,6.333130000000001,8.67144,6.03313,8.67144C5.73313,8.67144,5.49096,8.91558,5.49096,9.21802L5.49096,16.631500000000003C5.49096,17.9378,6.385540000000001,19,7.48614,19L15.512,19C16.6127,19,17.509,17.9378,17.509,16.631500000000003L17.509,9.21802C17.509,8.91558,17.2669,8.67144,16.966900000000003,8.67144ZM18.4578,6.21183L4.542169,6.21183C4.243976,6.21183,4,6.45779,4,6.75841C4,7.05903,4.243976,7.30499,4.542169,7.30499L18.4578,7.30499C18.756,7.30499,19,7.05903,19,6.75841C19,6.45779,18.756,6.21183,18.4578,6.21183ZM8.68072,5.10045L14.3193,5.10045C14.6175,5.10045,14.8614,4.852666,14.8614,4.550225C14.8614,4.247783,14.6175,4,14.3193,4L8.68072,4C8.38253,4,8.13855,4.247783,8.13855,4.550225C8.13855,4.852666,8.38253,5.10045,8.68072,5.10045Z" fill-opacity="1" stroke="currentColor" stroke-width="1"></path>'),gD=ga('<circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="1.5"></circle><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><circle cx="13.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M7.5 13.5 Q11 16.5 14.5 13.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>',1),_D=ga('<g fill="currentColor"><path d="M5 5h12v2h-5v10h-2V7H5z"></path></g>'),yD=ga('<g transform="scale(0.9166666667)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M19.054 7.988a2.988 2.988 0 0 1-1.31-.312l-10 10a3.027 3.027 0 1 1-1.38-1.381l10-10a2.994 2.994 0 1 1 2.69 1.693Zm-14 10a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm14-14a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"></path></g>'),bD=ga('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none"></path>'),xD=ga('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L19,12L16,15L12,11L8,15L4.5,18.5L3,20Z" stroke-opacity="0" stroke="none"></path>'),wD=ga('<path d="M3,18L4.5,16.5L8,13L12,17L16,13L19,16L21,14L21,20L3,20Z" stroke-opacity="0" stroke="none"></path>'),kD=ga('<path d="M6,4L6,8L4,8L4,16L6,16L6,20L8,20L8,16L10,16L10,8L8,8L8,4L6,4ZM14,2L14,6L12,6L12,14L14,14L14,18L16,18L16,14L18,14L18,6L16,6L16,2L14,2Z" stroke-opacity="0" stroke="none" fill="currentColor"></path>'),SD=ga('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),CD=ga('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect>',1),ID=ga('<path d="M6,4L6,8M6,16L6,20M14,2L14,6M14,14L14,18" stroke="currentColor" stroke-width="0.5" fill="none"></path><rect x="4" y="8" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="currentColor" fill-opacity="0.3"></rect><rect x="12" y="6" width="4" height="8" stroke="currentColor" stroke-width="0.5" fill="none"></rect>',1),PD=ga('<path d="M6,4L6,20M12,2L12,22M18,3L18,21" stroke="currentColor" stroke-width="0.5"></path><path d="M4,8L6,8M6,16L8,16M10,6L12,6M12,16L14,16M16,7L18,7M18,13L20,13" stroke="currentColor" stroke-width="0.5"></path>',1),MD=ga('<g stroke-width="1.2" fill="none"><g stroke="#00E6D8"><line x1="3" y1="13" x2="6" y2="16"></line><line x1="6" y1="13" x2="3" y2="16"></line><line x1="3" y1="9" x2="6" y2="12"></line><line x1="6" y1="9" x2="3" y2="12"></line><line x1="3" y1="5" x2="6" y2="8"></line><line x1="6" y1="5" x2="3" y2="8"></line></g><g stroke="#FF4D4D"><circle cx="10.5" cy="10.5" r="1.8"></circle><circle cx="10.5" cy="14.5" r="1.8"></circle><circle cx="10.5" cy="18.5" r="1.8"></circle></g><g stroke="#00E6D8"><line x1="15" y1="9" x2="18" y2="12"></line><line x1="18" y1="9" x2="15" y2="12"></line><line x1="15" y1="5" x2="18" y2="8"></line><line x1="18" y1="5" x2="15" y2="8"></line></g></g>'),ND=ga('<path d="M5.146447,15.753C4.9511845,15.9483,4.9511845,16.2649,5.146447,16.4602C5.341709,16.6554,5.658291,16.6554,5.853554,16.4602L8.156600000000001,14.15711C8.352409999999999,14.25082,8.57173,14.3033,8.8033,14.3033C9.631730000000001,14.3033,10.3033,13.63172,10.3033,12.80329C10.3033,12.57172,10.250820000000001,12.352409999999999,10.157119999999999,12.15659L12.156600000000001,10.15711C12.352409999999999,10.250820000000001,12.571729999999999,10.30329,12.8033,10.30329C13.63173,10.30329,14.3033,9.63172,14.3033,8.80329C14.3033,8.57172,14.25082,8.352409999999999,14.15712,8.15659L16.4602,5.853553C16.6554,5.658291,16.6554,5.341709,16.4602,5.146447C16.2649,4.9511843,15.9483,4.9511843,15.753,5.146447L13.45001,7.449479999999999C13.25419,7.35577,13.03487,7.3032900000000005,12.8033,7.3032900000000005C11.97487,7.3032900000000005,11.3033,7.97487,11.3033,8.80329C11.3033,9.03487,11.35578,9.254190000000001,11.44949,9.450009999999999L9.450009999999999,11.449480000000001C9.254190000000001,11.35577,9.03487,11.30329,8.8033,11.30329C7.97487,11.30329,7.3033,11.97487,7.3033,12.80329C7.3033,13.03487,7.35578,13.25419,7.44949,13.45001L5.146447,15.753Z" stroke-opacity="0" stroke="none"></path>'),AD=ga('<defs><clipPath id="master_svg0_151_615"><rect x="0" y="0" width="22" height="22" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_151_615)"><path d="M19.672,3.0673368C19.4417,2.9354008,19.1463,3.00292252,18.9994,3.2210900000000002L17.4588,5.50622L16.743299999999998,3.781253L13.9915,7.4662L13.9618,7.51108C13.8339,7.72862,13.8936,8.005659999999999,14.1004,8.15391L14.1462,8.183430000000001C14.3683,8.308720000000001,14.6511,8.25001,14.8022,8.047229999999999L16.4907,5.78571L17.246299999999998,7.60713L19.8374,3.7635389999999997L19.8651,3.717088C19.9871,3.484615,19.9023,3.199273,19.672,3.0673368ZM4.79974,8.462530000000001L10.117740000000001,3.252975C10.31381,3.0610145,10.63152,3.0610145,10.82759,3.252975L13.4115,5.78453C13.6076,5.976710000000001,13.6076,6.28833,13.4115,6.4805L8.093869999999999,11.69045C7.48847,12.28368,7.51659,13.3308,8.151309999999999,13.9528C8.786439999999999,14.5755,9.85421,14.6027,10.45961,14.0087L15.7768,8.79831C15.9729,8.60609,16.2909,8.60609,16.487099999999998,8.79831L19.0705,11.33026C19.2667,11.52244,19.2667,11.83406,19.0705,12.02623L13.7533,17.2366C11.32572,19.6158,7.30328,19.578,4.85679,17.1807C2.410298,14.7834,2.371331,10.84174,4.79974,8.462530000000001ZM12.3461,6.1325199999999995L10.47246,4.29654L5.51079,9.15889C3.477674,11.15076,3.510214,14.4688,5.56784,16.4847C7.62506,18.500999999999998,11.01117,18.5325,13.0439,16.540599999999998L15.6842,13.9529L14.2908,12.58718L15.0011,11.89161L16.394399999999997,13.2569L18.0056,11.67786L16.1323,9.84188L11.16985,14.7046C10.18764,15.6679,8.540980000000001,15.6494,7.51498,14.7184L7.44107,14.6487C6.4219,13.65,6.37771,11.98096,7.38362,10.994869999999999L10.02485,8.40693L8.624939999999999,7.03516L9.335180000000001,6.33919L10.73512,7.71099L12.3461,6.1325199999999995Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path></g>',1),TD=ga('<path d="M8.134443814697265,7.494615087890625L8.764323814697265,7.494615087890625L8.764323814697265,3.414215087890625L8.310223814697267,3.414215087890625L7.294603814697266,4.005035087890625L7.289713814697266,4.634915087890625L8.134443814697265,4.149892087890625L8.134443814697265,7.494615087890625ZM18.832003814697266,6.933095087890624Q19.004603814697266,6.635245087890625,19.004603814697266,6.2543850878906255Q19.004603814697266,5.884915087890625,18.845103814697264,5.593575087890625Q18.685503814697267,5.3006050878906255,18.399103814697266,5.136225087890625Q18.114303814697266,4.9702050878906245,17.754603814697266,4.9653250878906245L18.820603814697265,3.840647087890625L18.820603814697265,3.414215087890625L16.519203814697264,3.414215087890625L16.519203814697264,3.939931087890625L18.050803814697264,3.939931087890625L16.719403814697266,5.334785087890625L17.074203814697263,5.7205350878906245Q17.254903814697265,5.484525087890625,17.619503814697268,5.484525087890625Q17.980803814697268,5.484525087890625,18.187503814697266,5.689605087890625Q18.394203814697267,5.894685087890625,18.394203814697267,6.2543850878906255Q18.394203814697267,6.604315087890625,18.187503814697266,6.822415087890625Q17.980803814697268,7.0405150878906255,17.640603814697265,7.0405150878906255Q17.334603814697267,7.0405150878906255,17.124703814697266,6.890775087890625Q16.914703814697265,6.739415087890626,16.820303814697265,6.469225087890624L16.354803814697263,6.744295087890626Q16.480103814697266,7.125155087890625,16.821903814697265,7.341625087890625Q17.165403814697264,7.559725087890625,17.640603814697265,7.559725087890625Q18.039403814697266,7.559725087890625,18.348603814697267,7.393705087890625Q18.659503814697267,7.229315087890625,18.832003814697266,6.933095087890624ZM10.000003814697266,10.634915087890626C10.000003814697266,11.024655087890626,9.851363814697265,11.379685087890625,9.607683814697266,11.646395087890625L12.168903814697266,15.171615087890626C12.275403814697265,15.147615087890625,12.386203814697266,15.134915087890626,12.500003814697266,15.134915087890626C12.596503814697266,15.134915087890626,12.690803814697265,15.144015087890624,12.782303814697265,15.161415087890624L16.108803814697268,11.196955087890625C16.038703814697264,11.023375087890624,16.000003814697266,10.833655087890625,16.000003814697266,10.634915087890626C16.000003814697266,9.806495087890625,16.671603814697264,9.134915087890626,17.500003814697266,9.134915087890626C18.328403814697264,9.134915087890626,19.000003814697266,9.806495087890625,19.000003814697266,10.634915087890626C19.000003814697266,11.463345087890625,18.328403814697264,12.134915087890626,17.500003814697266,12.134915087890626C17.239503814697265,12.134915087890626,16.994503814697268,12.068495087890625,16.781003814697264,11.951675087890624L13.654703814697266,15.677415087890624C13.870303814697266,15.937215087890625,14.000003814697266,16.270915087890625,14.000003814697266,16.634915087890626C14.000003814697266,17.463315087890624,13.328403814697266,18.134915087890626,12.500003814697266,18.134915087890626C11.671573814697265,18.134915087890626,11.000003814697266,17.463315087890624,11.000003814697266,16.634915087890626C11.000003814697266,16.284415087890626,11.120193814697265,15.962015087890626,11.321603814697266,15.706715087890625L8.715393814697265,12.119565087890624C8.645053814697267,12.129685087890625,8.573143814697266,12.134915087890626,8.500003814697266,12.134915087890626C8.162103814697264,12.134915087890626,7.8503038146972655,12.023195087890626,7.599523814697266,11.834665087890626L4.505583814697266,15.521915087890624C4.809213814697266,15.796415087890624,5.000003814697266,16.193415087890624,5.000003814697266,16.634915087890626C5.000003814697266,17.463315087890624,4.328433814697266,18.134915087890626,3.5000038146972656,18.134915087890626C2.6715768146972656,18.134915087890626,2.0000038146972656,17.463315087890624,2.0000038146972656,16.634915087890626C2.0000038146972656,15.806515087890626,2.6715768146972656,15.134915087890626,3.5000038146972656,15.134915087890626C3.508253814697266,15.134915087890626,3.5164838146972657,15.135015087890626,3.524703814697266,15.135115087890625L7.033823814697266,10.953115087890625C7.011673814697265,10.850565087890626,7.000003814697266,10.744105087890624,7.000003814697266,10.634915087890626C7.000003814697266,9.806495087890625,7.671573814697266,9.134915087890626,8.500003814697266,9.134915087890626C9.328433814697267,9.134915087890626,10.000003814697266,9.806495087890625,10.000003814697266,10.634915087890626Z" stroke-opacity="0" stroke="none"></path>'),FD=ga('<path d="M11.57625,6.9981C11.55099,6.999359999999999,11.52557,7,11.5,7C11.34,7,11.18584,6.97495,11.04125,6.9285499999999995L5.55401,16.4327C5.713760000000001,16.5905,5.83826,16.7839,5.91465,17L16.0854,17C16.2187,16.622700000000002,16.4987,16.314700000000002,16.8569,16.1445L11.57625,6.9981ZM12.50759,6.611219999999999C12.81005,6.336790000000001,13,5.94058,13,5.5C13,4.671573,12.32843,4,11.5,4C10.67157,4,10,4.671573,10,5.5C10,5.80059,10.08841,6.08052,10.24066,6.31522L4.64514,16.0069C4.59738,16.002299999999998,4.54896,16,4.5,16C3.671573,16,3,16.671599999999998,3,17.5C3,18.328400000000002,3.671573,19,4.5,19C5.15311,19,5.70873,18.5826,5.91465,18L16.0854,18C16.2913,18.5826,16.846899999999998,19,17.5,19C18.328400000000002,19,19,18.328400000000002,19,17.5C19,16.8365,18.5691,16.2735,17.971899999999998,16.075699999999998L12.50759,6.611219999999999Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),LD=ga('<g transform="scale(0.7857142857)"><path fill="currentColor" stroke="currentColor" stroke-width="1" fill-rule="evenodd" d="M14 6a3 3 0 0 0-3 3v3h8.5a2.5 2.5 0 0 1 2.5 2.5v7a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 6 21.5v-7A2.5 2.5 0 0 1 8.5 12H10V9a4 4 0 0 1 8 0h-1a3 3 0 0 0-3-3zm-1 11a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6-2.5c0-.83.67-1.5 1.5-1.5h11c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 7 21.5v-7z"></path></g>'),ED=ga('<path d="M11.66558837890625,19C10.83716137890625,19,10.16558837890625,18.328400000000002,10.16558837890625,17.5C10.16558837890625,16.846899999999998,10.58298437890625,16.2913,11.16557337890625,16.0854L11.16557337890625,11.91464C10.58298437890625,11.70872,10.16558837890625,11.1531,10.16558837890625,10.5C10.16558837890625,9.8469,10.58298437890625,9.29128,11.16557337890625,9.08536L11.16557337890625,4.5C11.16557337890625,4.223857,11.38942837890625,4,11.66556837890625,4C11.94171837890625,4,12.16556837890625,4.223857,12.16556837890625,4.5L12.16556837890625,9.08535C12.74817837890625,9.291260000000001,13.16558837890625,9.846879999999999,13.16558837890625,10.5C13.16558837890625,11.153120000000001,12.74817837890625,11.708739999999999,12.16556837890625,11.91465L12.16556837890625,16.0854C12.74817837890625,16.2913,13.16558837890625,16.846899999999998,13.16558837890625,17.5C13.16558837890625,18.328400000000002,12.49401837890625,19,11.66558837890625,19Z" stroke-opacity="0" stroke="none"></path>'),$D=ga('<path d="M11.165603637695312,6.91465C11.748203637695312,6.70873,12.165603637695312,6.15311,12.165603637695312,5.5C12.165603637695312,4.671573,11.494033637695313,4,10.665603637695312,4C9.837176637695313,4,9.165603637695312,4.671573,9.165603637695312,5.5C9.165603637695312,6.15311,9.583007637695312,6.70873,10.165603637695312,6.91465L10.165603637695312,16.0854C9.583007637695312,16.2913,9.165603637695312,16.846899999999998,9.165603637695312,17.5C9.165603637695312,18.328400000000002,9.837176637695313,19,10.665603637695312,19C11.494033637695313,19,12.165603637695312,18.328400000000002,12.165603637695312,17.5C12.165603637695312,16.846899999999998,11.748203637695312,16.2913,11.165603637695312,16.0854L11.165603637695312,6.91465Z" stroke-opacity="0" fill-rule="evenodd" fill-opacity="1"></path>'),DD=ga('<path d="M11,12.41465L11,18.5C11,18.7761,11.22386,19,11.5,19C11.77614,19,12,18.7761,12,18.5L12,12.41465C12.5826,12.20873,13,11.65311,13,11C13,10.34689,12.5826,9.79127,12,9.58535L12,3.5C12,3.223857,11.77614,3,11.5,3C11.22386,3,11,3.223857,11,3.5L11,9.58535C10.417404,9.79127,10,10.34689,10,11C10,11.65311,10.417404,12.20873,11,12.41465Z" stroke-opacity="0" stroke="none"></path>'),RD=ga('<path d="M11,17C5.80945,17,3.667717,12.85,3.113386,11.575C2.9622047,11.2,2.9622047,10.8,3.113386,10.425C3.667717,9.15,5.80945,5,11,5C16.165399999999998,5,18.3323,9.15,18.8866,10.425C19.0378,10.8,19.0378,11.2,18.8866,11.575C18.3323,12.85,16.165399999999998,17,11,17ZM4.04567,10.8C3.995276,10.925,3.995276,11.05,4.04567,11.175C4.52441,12.325,6.43937,16,11,16C15.5606,16,17.4756,12.325,17.9543,11.2C18.0047,11.075,18.0047,10.95,17.9543,10.825C17.4756,9.675,15.5606,6,11,6C6.43937,6,4.52441,9.675,4.04567,10.8ZM11,13.5C9.61417,13.5,8.480319999999999,12.375,8.480319999999999,11C8.480319999999999,9.625,9.61417,8.5,11,8.5C12.38583,8.5,13.5197,9.625,13.5197,11C13.5197,12.375,12.38583,13.5,11,13.5ZM11,9.5C10.1685,9.5,9.48819,10.175,9.48819,11C9.48819,11.825,10.1685,12.5,11,12.5C11.8315,12.5,12.51181,11.825,12.51181,11C12.51181,10.175,11.8315,9.5,11,9.5Z" stroke-opacity="0" fill-opacity="1"></path>'),jD=ga('<path d="M4.727219638671875,8.007996215820313L9.973849638671876,2.7629472158203123C10.167279638671875,2.5696791158203123,10.480729638671875,2.5696791158203123,10.674169638671875,2.7629472158203123L13.223329638671874,5.311756215820313C13.416929638671874,5.505236215820313,13.416929638671874,5.8189862158203125,13.223329638671874,6.012466215820313L7.977129638671875,11.257906215820313C7.379859638671875,11.855176215820313,7.407609638671875,12.909396215820312,8.033809638671876,13.535596215820313C8.660409638671876,14.162596215820313,9.713849638671874,14.189996215820312,10.311129638671876,13.591896215820313L15.556929638671875,8.346066215820311C15.750429638671875,8.152526215820313,16.064229638671875,8.152526215820313,16.257629638671872,8.346066215820311L18.806529638671876,10.895266215820312C19.000029638671876,11.088746215820313,19.000029638671876,11.402496215820312,18.806529638671876,11.595976215820313L13.560629638671875,16.841796215820313C11.165619638671876,19.237196215820312,7.197149638671875,19.19919621582031,4.783499638671875,16.785496215820313C2.3698426386718747,14.371896215820312,2.331397638671875,10.403416215820313,4.727219638671875,8.007996215820313ZM12.172299638671875,5.662106215820312L10.323809638671875,3.8136162158203124L5.4287196386718755,8.709096215820313C3.422893638671875,10.714536215820312,3.4549956386718748,14.055196215820313,5.484999638671875,16.08479621582031C7.514609638671875,18.114796215820313,10.855289638671875,18.146496215820314,12.860719638671876,16.141096215820312L15.465629638671874,13.535796215820312L14.090929638671875,12.160756215820312L14.791629638671875,11.460436215820312L16.166229638671876,12.834996215820313L17.755829638671877,11.245226215820313L15.907729638671874,9.396736215820312L11.011839638671875,14.292596215820312C10.042809638671875,15.262396215820312,8.418249638671874,15.243796215820312,7.406019638671875,14.306496215820312L7.333099638671875,14.236296215820312C6.327599638671876,13.230796215820313,6.284009638671876,11.550396215820312,7.276419638671875,10.557586215820312L9.882199638671874,7.952026215820313L8.501079638671875,6.570906215820313L9.201789638671876,5.870186215820313L10.582939638671874,7.251336215820312L12.172299638671875,5.662106215820312Z" fill-rule="evenodd" fill-opacity="1" stroke="currentColor" stroke-width="0.5"></path>'),BD=ga('<g transform="scale(0.7857142857)" fill="currentColor" fill-rule="nonzero" stroke="currentColor" stroke-width="1"><path d="M20.449 8.505l2.103 9.112.974-.225-2.103-9.112zM13.943 14.011l7.631 4.856.537-.844-7.631-4.856zM14.379 11.716l4.812-3.609-.6-.8-4.812 3.609zM10.96 13.828l-4.721 6.744.819.573 4.721-6.744zM6.331 20.67l2.31-13.088-.985-.174-2.31 13.088zM9.041 7.454l1.995 3.492.868-.496-1.995-3.492z"></path><path d="M8.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM12.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g>'),OD=ga('<path d="m19.45,17.57l-3.78,-9.16a0.92,0.92 0 0 0 -1.71,0l-3.78,9.16a0.92,0.92 0 1 0 1.71,0.71l0.77,-1.86l4.31,0l0.77,1.86a0.92,0.92 0 0 0 0.85,0.57a0.92,0.92 0 0 0 0.85,-1.28l0,0zm-6.03,-3.01l1.39,-3.37l1.39,3.37l-2.79,0zm-2.81,-0.8a0.92,0.92 0 0 0 -0.21,-1.29c-0.01,-0.01 -0.63,-0.47 -1.53,-1.46c1.67,-2.25 2.61,-4.82 2.99,-6.03l1.36,0a0.92,0.92 0 0 0 0,-1.85l-4.87,0l0,-0.84a0.92,0.92 0 0 0 -1.85,0l0,0.84l-4.87,0a0.92,0.92 0 0 0 0,1.85l8.28,0c-0.4,1.13 -1.14,2.92 -2.26,4.55c-1.32,-1.75 -1.81,-2.88 -1.81,-2.89a0.92,0.92 0 0 0 -1.7,0.71c0.02,0.06 0.61,1.44 2.22,3.53c0.04,0.05 0.08,0.1 0.12,0.15c-1.65,1.86 -3.27,3.02 -3.94,3.39a0.92,0.92 0 1 0 0.88,1.62c0.09,-0.05 2.04,-1.13 4.27,-3.59c0.95,1.01 1.6,1.49 1.64,1.52a0.92,0.92 0 0 0 1.29,-0.21l0,0z" id="svg_1"></path>'),zD=ga('<g id="svg_7"><path d="m10.02,1.07c-4.98,0 -9.28,4.05 -9.02,9.02c0.35,6.79 8.26,2.87 8.97,8.2a0.9,0.9 0 0 0 0.99,0.77a9.02,9.02 0 0 0 -0.94,-18zm1.77,16.4a0.51,0.51 0 0 1 -0.62,-0.35a4.51,4.51 0 0 0 -1.61,-2.3c-1.03,-0.78 -2.27,-1.08 -3.46,-1.38c-2.39,-0.59 -3.55,-0.99 -3.67,-3.43c-0.1,-1.87 0.58,-3.67 1.93,-5.08a7.84,7.84 0 0 1 5.66,-2.43a7.59,7.59 0 0 1 1.77,14.97z" id="svg_1"></path><path d="m13.04,14.42m-1.38,0a1.38,1.38 0 1 0 2.77,0a1.38,1.38 0 1 0 -2.77,0z" id="svg_2"></path><path d="m15.28,9.07m-1.13,0a1.13,1.13 0 1 0 2.26,0a1.13,1.13 0 1 0 -2.26,0z" id="svg_3"></path><path d="m14.23,6.93a1.13,1.13 0 1 0 -1.58,-0.19a1.13,1.13 0 0 0 1.58,0.19z" id="svg_4"></path><path d="m10.29,4.73m-0.97,0.58a1.13,1.13 0 1 0 1.93,-1.16a1.13,1.13 0 1 0 -1.93,1.16z" id="svg_5"></path><path d="m6.47,4.66a1.13,1.13 0 1 0 1.49,0.58a1.13,1.13 0 0 0 -1.49,-0.58z" id="svg_6"></path></g>'),VD=ga('<path d="m15.1,6.75c0,-2.31 -1.89,-4.18 -4.21,-4.18c-2.33,0 -4.21,1.87 -4.21,4.18c0,2.31 1.89,4.18 4.21,4.18c2.33,0 4.21,-1.87 4.21,-4.18m5.9,13.26c0.03,0.09 0.05,0.18 0.05,0.28c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98l0,0l-0.03,0c-0.26,-4.12 -3.69,-7.39 -7.9,-7.39c-4.21,0 -7.65,3.27 -7.91,7.39l-0.02,0l0,0c0,0.54 -0.44,0.98 -0.99,0.98a0.99,0.99 0 0 1 -0.99,-0.98c0,-0.09 0.02,-0.18 0.04,-0.27c0.29,-3.74 2.66,-6.9 5.98,-8.3c-1.54,-1.12 -2.55,-2.92 -2.55,-4.97c0,-3.4 2.77,-6.15 6.19,-6.15c3.42,0 6.19,2.75 6.19,6.15a6.12,6.12 0 0 1 -2.39,4.85c3.48,1.33 6,4.56 6.31,8.41" fill="#515151" id="svg_1"></path>'),WD=ga('<g transform="scale(0.047 0.047)"><path d="M387.6 2.6C385.5 4.7 385 6.2 385 10C385 13.8 385.5 15.3 387.6 17.4L390.3 20H410.9H431.5L382.5 69L333.5 118L314.5 99C304.1 88.6 294.2 79.6 292.6 79C291 78.4 288.3 78.2 286.6 78.6C284.2 79 263.1 99.5 192.7 169.8C142.7 219.7 101.2 261.7 100.4 263.2C98.1 267.5 98.7 271.6 101.9 275.2C104.4 278 105.5 278.5 109.4 278.5H114L201.5 191L289 103.5L308.8 123.3L328.6 143H333.5H338.5L392.2 89.3L446 35.5V52.8C446 71.1 446.7 74.7 450.9 77C453.9 78.6 460.3 78.2 462.6 76.2C466.8 72.8 467 71.3 467 39C467 6.7 466.8 5.2 462.6 1.8C460.7 0.199996 457.1 -4.14997e-06 425.4 -4.14997e-06H390.3L387.6 2.6Z" fill="currentColor"></path><path d="M382.8 147.4C373.9 149.8 366 158.1 364.1 167.1C363.3 170.5 363 222 363 332V492H335.5H308L307.8 400.1L307.5 308.2L303.8 302.9C295.9 291.6 290.4 290.1 256.9 290C244 290 230.7 290.5 227.5 291.1C218.2 292.8 211 298.4 207.1 307C205.1 311.4 205 313.1 205 401.7V492H177.5H150V444.7C150 391.6 150 391.7 143 383.7C140.7 381.2 136.8 378.3 133.8 376.9C128.6 374.5 128 374.5 98 374.5H67.5L61.8 377.3C55.4 380.4 51.7 384.3 48.6 391C46.6 395.3 46.5 397.2 46.2 443.8L45.9 492H32.9C18.2 492 15.9 492.8 14 498.6C12.5 502.9 14.1 508.2 17.5 510.4C19.7 511.8 42.4 512 256 512C469.6 512 492.3 511.8 494.5 510.4C497.9 508.2 499.5 502.9 498 498.6C496.1 492.9 493.7 492 479.5 492H467V331.2C467 150.8 467.5 163.8 459.7 155.3C451.9 146.8 450.7 146.5 417 146.3C395.4 146.1 386.3 146.4 382.8 147.4ZM443.4 169.1L446 171.1V331.6V492H415H384V332V171.9L386.5 169.5L388.9 167H414.8C439.5 167 440.9 167.1 443.4 169.1ZM282.8 312.1C284.8 312.8 286.2 314.2 286.9 316.2C287.7 318.3 288 346.8 288 405.6V492H257H226V403.7C226 320.8 226.1 315.2 227.8 313.8C228.7 312.9 230.2 312 231 311.7C233.9 310.7 279.6 311 282.8 312.1ZM127.1 397.9C128.9 400.1 129 402.4 129 446.1V492H98H67L67.1 446.7C67.1 421.9 67.5 400.7 67.9 399.6C69.6 395.4 72.1 395 99.3 395.3C125.2 395.5 125.2 395.5 127.1 397.9Z" fill="currentColor"></path><path d="M69.2 295.5C65.3 298.7 64.4 302.7 66.4 307.4C69.3 314.4 78.6 315.6 83.5 309.8C91.5 300.3 78.6 287.5 69.2 295.5Z" fill="currentColor"></path><circle cx="2" cy="18" r="1" fill="currentColor"></circle></g>'),HD=ga('<g id="svg_4" transform="translate(-0.1 -0.1) scale(1.00914 1.00914) translate(0.1 0.1) scale(1.09 1.09) matrix(0.995 0 0 0.995 0 0)"><path d="m18.54,9.09c-0.21,-2.47 -1.25,-4.77 -2.96,-6.45c-1.73,-1.69 -3.96,-2.64 -6.3,-2.64c-1.25,0 -2.46,0.27 -3.61,0.78c-0.01,0 -0.01,0.02 -0.02,0.02c-0.02,0 -0.02,0.01 -0.03,0.01c-1.09,0.5 -2.06,1.21 -2.91,2.12c-0.86,0.92 -1.52,1.98 -1.99,3.18c-0.47,1.23 -0.72,2.54 -0.72,3.89c0,0.87 0.11,1.72 0.31,2.54c0,0.02 0.01,0.05 0.02,0.07c0.41,1.62 1.18,3.11 2.3,4.35c1.44,1.59 3.3,2.6 5.3,2.91c0.03,0 0.04,0.02 0.06,0.02c0.33,0.05 0.67,0.08 1.01,0.08l0.21,0c0.4,0 1.17,-0.03 1.8,-0.27c0.16,-0.07 0.29,-0.19 0.36,-0.36c0.07,-0.16 0.09,-0.35 0.03,-0.53c-0.1,-0.27 -0.34,-0.46 -0.61,-0.46c-0.07,0 -0.16,0.01 -0.23,0.03c-0.47,0.18 -1.1,0.21 -1.36,0.21l-0.1,0c0.1,-0.32 0.14,-0.67 0.05,-1.04c-0.15,-0.66 -0.64,-1.21 -1.57,-1.75l-0.39,-0.23c-0.62,-0.36 -0.96,-0.54 -1.16,-0.84c-0.2,-0.29 -0.34,-0.74 -0.51,-1.75c-0.13,-0.68 -0.47,-1.21 -1.01,-1.52c-0.37,-0.2 -0.8,-0.31 -1.32,-0.31c-0.36,0 -0.76,0.05 -1.18,0.15c-0.21,0.05 -0.41,0.11 -0.59,0.16c-0.08,-0.48 -0.12,-0.98 -0.12,-1.49c0,-3.04 1.47,-5.7 3.69,-7.24c0.01,0.28 0.07,0.57 0.19,0.84c0.3,0.7 0.92,1.14 1.84,1.33c0.05,0.01 0.08,0.01 0.12,0.01l0.04,0c0.09,0 0.39,0.01 0.71,0.14c0.43,0.19 0.68,0.51 0.76,1c0.2,1.56 0.42,4.38 0.14,5.29c-0.02,0.07 -0.03,0.15 -0.03,0.23c0,0.37 0.29,0.69 0.64,0.69c0.18,0 0.34,-0.08 0.46,-0.2c0.12,-0.13 2.76,-3.01 3.46,-3.97c0.08,-0.11 0.17,-0.21 0.26,-0.32c0.34,-0.43 0.69,-0.86 0.82,-1.51c0.15,-0.69 0,-1.46 -0.46,-2.41c-0.32,-0.68 -0.38,-0.98 -0.4,-1.1c0.02,-0.01 0.04,-0.02 0.06,-0.04c2.02,1.39 3.42,3.73 3.65,6.48c0.04,0.37 0.31,0.63 0.65,0.63l0.06,0c0.35,-0.01 0.61,-0.34 0.58,-0.73zm-15.35,3.47c0.3,0 0.53,0.05 0.71,0.15c0.18,0.12 0.29,0.28 0.34,0.56c0.2,1.07 0.37,1.79 0.76,2.34c0.38,0.53 0.86,0.79 1.58,1.21l0.03,0.01c0.1,0.06 0.23,0.13 0.35,0.2c0.74,0.43 0.9,0.72 0.94,0.86c0.03,0.14 -0.05,0.34 -0.15,0.54c-2.83,-0.58 -5.1,-2.74 -6.01,-5.6c0.42,-0.13 0.97,-0.27 1.45,-0.27zm9.6,-8.04c0.64,1.31 0.36,1.67 -0.21,2.37c-0.09,0.12 -0.19,0.23 -0.28,0.36c-0.35,0.48 -1.28,1.53 -2.09,2.43c0,-0.44 -0.02,-0.94 -0.06,-1.49c-0.08,-1.23 -0.22,-2.28 -0.22,-2.32l0,-0.04c-0.18,-0.99 -0.73,-1.71 -1.61,-2.07c-0.49,-0.2 -0.95,-0.22 -1.13,-0.22c-0.45,-0.11 -0.73,-0.3 -0.85,-0.55c-0.14,-0.3 -0.05,-0.74 0.04,-1.02c0.91,-0.38 1.88,-0.59 2.9,-0.59c1.11,0 2.16,0.24 3.13,0.67c-0.07,0.13 -0.13,0.3 -0.16,0.5c-0.04,0.49 0.12,1.1 0.54,1.97z" id="svg_1"></path><path d="m15.22,9.72c-2.63,0 -4.77,2.3 -4.77,5.14c0,2.84 2.13,5.14 4.77,5.14c2.64,0 4.78,-2.3 4.78,-5.14c0,-2.84 -2.15,-5.14 -4.78,-5.14zm0,8.88c-1.91,0 -3.48,-1.68 -3.48,-3.75c0,-2.07 1.56,-3.75 3.48,-3.75c1.93,0 3.49,1.68 3.49,3.75c0,2.07 -1.57,3.75 -3.49,3.75z" id="svg_2"></path><path d="m15.69,15.05l0,-2.37c0,-0.38 -0.29,-0.7 -0.64,-0.7c-0.36,0 -0.65,0.32 -0.65,0.7l0,2.66c0,0.19 0.07,0.35 0.19,0.49l1.16,1.27c0.12,0.12 0.28,0.2 0.46,0.2c0.17,0 0.33,-0.08 0.46,-0.2c0.11,-0.13 0.18,-0.31 0.18,-0.5c0,-0.19 -0.07,-0.36 -0.18,-0.49l-0.98,-1.06z" id="svg_3"></path></g>'),qD=ga('<path d="M8 5v14l11-7z" fill="currentColor"></path>'),UD=ga('<rect x="6" y="6" width="10" height="10" fill="currentColor"></rect>'),GD=ga('<path d="m21.62,13.73l-1.7,-1.37c0.08,-0.46 0.12,-0.94 0.12,-1.41c0,-0.47 -0.04,-0.94 -0.12,-1.41l1.7,-1.37c0.25,-0.21 0.35,-0.55 0.24,-0.85l-0.03,-0.07c-0.46,-1.24 -1.15,-2.38 -2.06,-3.37l-0.04,-0.05c-0.22,-0.24 -0.58,-0.34 -0.91,-0.23l-2.09,0.71c-0.78,-0.6 -1.64,-1.08 -2.57,-1.41l-0.41,-2.08c-0.07,-0.32 -0.33,-0.57 -0.67,-0.62l-0.08,-0.01c-1.34,-0.23 -2.76,-0.23 -4.1,0l-0.08,0.01c-0.34,0.05 -0.6,0.31 -0.67,0.62l-0.41,2.09c-0.93,0.33 -1.78,0.8 -2.55,1.4l-2.11,-0.71c-0.33,-0.11 -0.69,-0.02 -0.91,0.23l-0.04,0.05c-0.91,1.01 -1.6,2.14 -2.06,3.37l-0.03,0.07c-0.11,0.3 -0.01,0.65 0.24,0.85l1.72,1.38c-0.09,0.46 -0.12,0.93 -0.12,1.4c0,0.47 0.03,0.94 0.12,1.39l-1.72,1.39c-0.25,0.21 -0.35,0.55 -0.24,0.85l0.03,0.07c0.46,1.24 1.15,2.37 2.06,3.37l0.04,0.05c0.22,0.24 0.58,0.34 0.91,0.23l2.11,-0.71c0.77,0.6 1.62,1.07 2.55,1.4l0.41,2.09c0.07,0.32 0.33,0.57 0.67,0.62l0.08,0.01c0.67,0.12 1.36,0.18 2.05,0.18c0.69,0 1.38,-0.05 2.05,-0.18l0.08,-0.01c0.34,-0.05 0.6,-0.31 0.67,-0.62l0.41,-2.08c0.93,-0.33 1.8,-0.81 2.57,-1.41l2.09,0.71c0.33,0.11 0.69,0.01 0.91,-0.23l0.04,-0.05c0.91,-1.01 1.6,-2.14 2.06,-3.37l0.03,-0.07c0.11,-0.3 0.01,-0.64 -0.24,-0.85zm-3.53,-3.91c0.07,0.37 0.1,0.76 0.1,1.13c0,0.38 -0.03,0.77 -0.1,1.13l-0.18,0.99l1.93,1.55c-0.28,0.65 -0.66,1.25 -1.09,1.81l-2.4,-0.81l-0.81,0.64c-0.61,0.48 -1.3,0.85 -2.05,1.12l-0.99,0.35l-0.46,2.38c-0.72,0.08 -1.47,0.08 -2.19,0l-0.47,-2.38l-0.97,-0.36c-0.73,-0.26 -1.41,-0.64 -2.03,-1.12l-0.81,-0.64l-2.42,0.82c-0.44,-0.57 -0.8,-1.17 -1.09,-1.81l1.95,-1.58l-0.16,-0.97c-0.07,-0.36 -0.1,-0.74 -0.1,-1.12c0,-0.37 0.03,-0.74 0.1,-1.11l0.16,-0.97l-1.95,-1.58c0.3,-0.65 0.66,-1.25 1.09,-1.81l2.42,0.81l0.81,-0.62c0.61,-0.48 1.29,-0.85 2.03,-1.12l0.99,-0.35l0.46,-2.38c0.72,-0.09 1.47,-0.09 2.19,0l0.46,2.37l0.99,0.35c0.74,0.26 1.43,0.65 2.05,1.12l0.81,0.64l2.4,-0.81c0.44,0.57 0.81,1.17 1.11,1.81l-1.94,1.55l0.18,0.97zm-7.14,-3.42c-2.51,0 -4.54,1.93 -4.54,4.3c0,2.38 2.04,4.3 4.54,4.3c2.51,0 4.54,-1.93 4.54,-4.3c0,-2.38 -2.04,-4.3 -4.54,-4.3zm2.05,6.24c-0.55,0.51 -1.27,0.8 -2.05,0.8c-0.77,0 -1.5,-0.28 -2.05,-0.8c-0.54,-0.51 -0.84,-1.2 -0.84,-1.94c0,-0.73 0.31,-1.41 0.84,-1.94c0.55,-0.51 1.28,-0.8 2.05,-0.8c0.78,0 1.5,0.28 2.05,0.8c0.55,0.53 0.84,1.2 0.84,1.94c0,0.73 -0.3,1.42 -0.84,1.94z" id="svg_1"></path>'),YD=ga('<path d="m7.13,1l7.64,0c0.16,0 0.31,0.12 0.34,0.28l0.25,1.38c0.12,0.67 0.68,1.15 1.35,1.15l2.45,0c1.51,0 2.74,1.26 2.74,2.81l0,11.27c0,1.55 -1.23,2.81 -2.74,2.81l-16.43,0c-1.51,0 -2.74,-1.26 -2.74,-2.81l0,-11.27c0,-1.55 1.23,-2.81 2.74,-2.81l2.45,0c0.67,0 1.23,-0.48 1.35,-1.15l0.25,-1.38c0.03,-0.16 0.18,-0.28 0.34,-0.28zm9.58,4.23c-1.32,0 -2.45,-0.96 -2.69,-2.3l-0.1,-0.51l-5.93,0l-0.1,0.51c-0.24,1.34 -1.37,2.3 -2.69,2.3l-2.45,0c-0.76,0 -1.37,0.62 -1.37,1.4l0,11.27c0,0.78 0.61,1.4 1.37,1.4l16.43,0c0.76,0 1.37,-0.62 1.37,-1.4l0,-11.27c0,-0.78 -0.61,-1.4 -1.37,-1.4l-2.45,0zm-11.91,2.11l-1.37,0c-0.38,0 -0.69,-0.32 -0.69,-0.71c0,-0.38 0.31,-0.7 0.69,-0.7l1.37,0c0.37,0 0.68,0.32 0.68,0.7c0,0.39 -0.31,0.71 -0.68,0.71zm6.15,-0.71c-3.21,0 -5.81,2.68 -5.81,5.99c0,3.3 2.61,5.98 5.81,5.98c3.21,0 5.81,-2.68 5.81,-5.98c0,-3.31 -2.61,-5.99 -5.81,-5.99zm0,1.41c1.19,0 2.31,0.47 3.14,1.34c0.84,0.87 1.3,2.01 1.3,3.24c0,1.22 -0.46,2.37 -1.3,3.23c-0.83,0.87 -1.95,1.35 -3.14,1.35c-1.19,0 -2.31,-0.48 -3.14,-1.35c-0.84,-0.87 -1.3,-2.01 -1.3,-3.23c0,-1.23 0.46,-2.38 1.3,-3.24c0.83,-0.87 1.95,-1.34 3.14,-1.34zm0,2.46c-1.14,0 -2.05,0.94 -2.05,2.11c0,1.16 0.91,2.11 2.05,2.11c1.14,0 2.06,-0.95 2.06,-2.11c0,-1.17 -0.92,-2.11 -2.06,-2.11zm0,1.4c0.37,0 0.69,0.32 0.69,0.71c0,0.38 -0.32,0.7 -0.69,0.7c-0.37,0 -0.68,-0.32 -0.68,-0.7c0,-0.39 0.31,-0.71 0.68,-0.71z" id="svg_1"></path>'),KD=ga('<path d="m1.08,0l-1.08,1.08l4.19,4.2l-1.64,1.64l4.36,0l0,-4.36l-1.62,1.62l-4.21,-4.18zm14.73,5.28l4.19,-4.2l-1.08,-1.08l-4.21,4.18l-1.62,-1.62l0,4.36l4.36,0l-1.64,-1.64zm-11.64,9.42l-4.09,4.11l1.08,1.19l4.11,-4.2l1.64,1.64l0,-4.36l-4.36,0l1.62,1.62zm13.28,-1.62l-4.36,0l0,4.36l1.64,-1.64l4.11,4.2l1.08,-1.19l-4.09,-4.11l1.62,-1.62z" id="svg_1" transform="scale(1.09 1.09)"></path>'),XD=ga('<path d="m2.93,1.77l4.65,4.64l-1.19,1.19l-4.62,-4.67l-1.77,1.77l0,-4.7l4.7,0l-1.77,1.77zm3.48,10.63l-4.64,4.64l-1.77,-1.76l0,4.7l4.7,0l-1.77,-1.77l4.65,-4.64l-1.17,-1.17zm8.87,-12.4l1.76,1.77l-4.64,4.64l1.19,1.19l4.64,-4.64l1.77,1.76l0,-4.72l-4.72,0zm-1.71,12.4l-1.19,1.19l4.64,4.64l-1.77,1.77l4.73,0l0,-4.72l-1.77,1.76l-4.64,-4.64z" id="svg_1" transform="scale(1.095 1.095)"></path>'),ZD=ga('<path d="m12.24,4.81c2.72,0 4.93,2.2 4.93,4.92c0,0.01 0,0.03 0,0.05c-0.01,0.03 -0.01,0.07 -0.01,0.11l-0.02,0.75l0.75,0c1.81,0.01 3.27,1.48 3.27,3.28c0,1.8 -1.46,3.27 -3.26,3.28l-0.16,0l-13.36,0c-2.01,0 -3.65,-1.64 -3.65,-3.64c0,-1.56 0.99,-2.94 2.47,-3.45l0.41,-0.14l0.07,-0.42c0.18,-1.06 1.09,-1.83 2.16,-1.83c0.34,0 0.67,0.08 0.98,0.24l0.67,0.34l0.31,-0.68c0.82,-1.7 2.56,-2.81 4.44,-2.81l0,0.01zm0,-0.73c-2.24,0 -4.19,1.31 -5.1,3.22c-0.39,-0.2 -0.83,-0.31 -1.31,-0.31c-1.44,0 -2.64,1.05 -2.87,2.43c-1.72,0.59 -2.96,2.22 -2.96,4.14c0,2.42 1.96,4.37 4.37,4.37l13.52,0c2.2,-0.01 3.99,-1.8 3.99,-4.01c0,-2.21 -1.79,-4.01 -4,-4.01c0.01,-0.06 0.01,-0.12 0.01,-0.18c0,-3.12 -2.53,-5.65 -5.66,-5.65l0,0z" fill="#000000" id="svg_1"></path>'),JD=ga('<path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path>'),QD=ga('<g transform="scale(-1,1) translate(-24,0)"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"></path></g>'),eR=ga('<g transform="scale(0.9166666667)"><path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M20 13H15.874C15.5122 14.4056 14.4056 15.5122 13 15.874V20C13 20.2652 12.8946 20.5196 12.7071 20.7071C12.5196 20.8946 12.2652 21 12 21C11.7348 21 11.4804 20.8946 11.2929 20.7071C11.1054 20.5196 11 20.2652 11 20V15.874C9.59439 15.5122 8.4878 14.4056 8.12602 13H4C3.73478 13 3.48043 12.8946 3.29289 12.7071C3.10536 12.5196 3 12.2652 3 12C3 11.7348 3.10536 11.4804 3.29289 11.2929C3.48043 11.1054 3.73478 11 4 11H8.12602C8.4878 9.59439 9.59439 8.4878 11 8.12602V4C11 3.73478 11.1054 3.48043 11.2929 3.29289C11.4804 3.10536 11.7348 3 12 3C12.2652 3 12.5196 3.10536 12.7071 3.29289C12.8946 3.48043 13 3.73478 13 4V8.12602C14.4056 8.4878 15.5122 9.59439 15.874 11H20C20.2652 11 20.5196 11.1054 20.7071 11.2929C20.8946 11.4804 21 11.7348 21 12C21 12.2652 20.8946 12.5196 20.7071 12.7071C20.5196 12.8946 20.2652 13 20 13ZM12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10Z"></path></g>'),tR=ga('<rect x="3" y="4" width="16" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="0.5"></rect><rect x="13" y="4" width="6" height="14" rx="1" fill="currentColor" fill-opacity="0.3"></rect><line x1="13" y1="4" x2="13" y2="18" stroke="currentColor" stroke-width="0.5"></line>',1),sR=ga('<div class="icon-fallback"> </div>'),nR=ga('<svg class="icon-overlay fill-current svelte-19kzeyz" viewBox="0 0 22 22"><!></svg>');function nv(s,e){let t=bi(e,"name",3,"none"),n=bi(e,"active",3,!1),o=bi(e,"size",3,32);var r=nR(),a=y(r);Ve(a,()=>t()=="horizontalStraightLine",l=>{var c=H$();Y(l,c)},l=>{var c=Qs(),f=_s(c);Ve(f,()=>t()=="ruler",u=>{var d=q$();Y(u,d)},u=>{var d=Qs(),h=_s(d);Ve(h,()=>t()=="abcd",p=>{var v=U$();Y(p,v)},p=>{var v=Qs(),x=_s(v);Ve(x,()=>t()=="anyWaves",S=>{var C=G$();Y(S,C)},S=>{var C=Qs(),I=_s(C);Ve(I,()=>t()=="arrow",A=>{var P=Y$();Y(A,P)},A=>{var P=Qs(),T=_s(P);Ve(T,()=>t()=="circle",j=>{var E=K$();Y(j,E)},j=>{var E=Qs(),L=_s(E);Ve(L,()=>t()=="eightWaves",D=>{var X=X$();Y(D,X)},D=>{var X=Qs(),ne=_s(X);Ve(ne,()=>t()=="fibonacciCircle",de=>{var ie=Z$();Oi(4),Y(de,ie)},de=>{var ie=Qs(),te=_s(ie);Ve(te,()=>t()=="fibonacciExtension",le=>{var pe=J$();Y(le,pe)},le=>{var pe=Qs(),re=_s(pe);Ve(re,()=>t()=="fibonacciSegment",xe=>{var se=Q$();Y(xe,se)},xe=>{var se=Qs(),Ne=_s(se);Ve(Ne,()=>t()=="fibonacciSpeedResistanceFan",Te=>{var Me=eD();Y(Te,Me)},Te=>{var Me=Qs(),De=_s(Me);Ve(De,()=>t()=="fibonacciSpiral",Oe=>{var Ke=tD();Y(Oe,Ke)},Oe=>{var Ke=Qs(),kt=_s(Ke);Ve(kt,()=>t()=="fiveWaves",pt=>{var Rt=sD();Y(pt,Rt)},pt=>{var Rt=Qs(),Ht=_s(Rt);Ve(Ht,()=>t()=="gannBox",Ft=>{var zt=nD();Y(Ft,zt)},Ft=>{var zt=Qs(),ut=_s(zt);Ve(ut,()=>t()=="horizontalRayLine",nt=>{var Je=oD();Y(nt,Je)},nt=>{var Je=Qs(),it=_s(Je);Ve(it,()=>t()=="horizontalSegment",ze=>{var Ge=iD();Y(ze,Ge)},ze=>{var Ge=Qs(),xt=_s(Ge);Ve(xt,()=>t()=="invisible",jt=>{var ft=rD();Y(jt,ft)},jt=>{var ft=Qs(),ke=_s(ft);Ve(ke,()=>t()=="visible",Se=>{var Et=aD();Y(Se,Et)},Se=>{var Et=Qs(),wt=_s(Et);Ve(wt,()=>t()=="lock",Ls=>{var tn=lD();Oi(),Y(Ls,tn)},Ls=>{var tn=Qs(),Gs=_s(tn);Ve(Gs,()=>t()=="parallelogram",an=>{var Es=cD();Y(an,Es)},an=>{var Es=Qs(),Ns=_s(Es);Ve(Ns,()=>t()=="parallelStraightLine",Hs=>{var ns=uD();Y(Hs,ns)},Hs=>{var ns=Qs(),fs=_s(ns);Ve(fs,()=>t()=="priceChannelLine",Mn=>{var po=dD();Y(Mn,po)},Mn=>{var po=Qs(),Tn=_s(po);Ve(Tn,()=>t()=="priceChannelLineNew",Cn=>{var go=fD();Y(Cn,go)},Cn=>{var go=Qs(),no=_s(go);Ve(no,()=>t()=="priceLine",Bo=>{var Vo=pD();Y(Bo,Vo)},Bo=>{var Vo=Qs(),Rl=_s(Vo);Ve(Rl,()=>t()=="rayLine",aa=>{var tl=hD();Y(aa,tl)},aa=>{var tl=Qs(),Zr=_s(tl);Ve(Zr,()=>t()=="rect",zi=>{var Nl=mD();Y(zi,Nl)},zi=>{var Nl=Qs(),mu=_s(Nl);Ve(mu,()=>t()=="remove",Gc=>{var du=vD();Y(Gc,du)},Gc=>{var du=Qs(),Ju=_s(du);Ve(Ju,()=>t()=="emoji",rd=>{var Al=gD();Oi(3),Y(rd,Al)},rd=>{var Al=Qs(),sa=_s(Al);Ve(sa,()=>t()=="text",Vc=>{var vu=_D();Y(Vc,vu)},Vc=>{var vu=Qs(),Qc=_s(vu);Ve(Qc,()=>t()=="segment",To=>{var ec=yD();Y(To,ec)},To=>{var ec=Qs(),yl=_s(ec);Ve(yl,()=>t()=="candle",Dc=>{var jl=bD();Y(Dc,jl)},Dc=>{var jl=Qs(),qi=_s(jl);Ve(qi,()=>t()=="line",la=>{var El=xD();Y(la,El)},la=>{var El=Qs(),qu=_s(El);Ve(qu,()=>t()=="area",Td=>{var ki=wD();Y(Td,ki)},Td=>{var ki=Qs(),sl=_s(ki);Ve(sl,()=>t()=="candle_solid",br=>{var Wc=kD();Y(br,Wc)},br=>{var Wc=Qs(),Xd=_s(Wc);Ve(Xd,()=>t()=="candle_stroke",Uf=>{var xf=SD();Oi(2),Y(Uf,xf)},Uf=>{var xf=Qs(),Uu=_s(xf);Ve(Uu,()=>t()=="candle_up_stroke",tp=>{var wf=CD();Oi(2),Y(tp,wf)},tp=>{var wf=Qs(),Vs=_s(wf);Ve(Vs,()=>t()=="candle_down_stroke",kn=>{var Kn=ID();Oi(2),Y(kn,Kn)},kn=>{var Kn=Qs(),Bs=_s(Kn);Ve(Bs,()=>t()=="ohlc",bo=>{var lo=PD();Oi(),Y(bo,lo)},bo=>{var lo=Qs(),Qi=_s(lo);Ve(Qi,()=>t()=="point_and_figure",xr=>{var Ai=MD();Y(xr,Ai)},xr=>{var Ai=Qs(),ri=_s(Ai);Ve(ri,()=>t()=="straightLine",Ti=>{var Eo=ND();Y(Ti,Eo)},Ti=>{var Eo=Qs(),hr=_s(Eo);Ve(hr,()=>t()=="strongMagnet",ei=>{var ai=AD();Oi(),Y(ei,ai)},ei=>{var ai=Qs(),vi=_s(ai);Ve(vi,()=>t()=="threeWaves",_a=>{var dl=TD();Y(_a,dl)},_a=>{var dl=Qs(),ar=_s(dl);Ve(ar,()=>t()=="triangle",Jr=>{var nl=FD();Y(Jr,nl)},Jr=>{var nl=Qs(),tc=_s(nl);Ve(tc,()=>t()=="unlock",mc=>{var gu=LD();Y(mc,gu)},mc=>{var gu=Qs(),Bl=_s(gu);Ve(Bl,()=>t()=="verticalRayLine",Ui=>{var Ol=ED();Y(Ui,Ol)},Ui=>{var Ol=Qs(),fl=_s(Ol);Ve(fl,()=>t()=="verticalSegment",bl=>{var Ua=$D();Y(bl,Ua)},bl=>{var Ua=Qs(),er=_s(Ua);Ve(er,()=>t()=="verticalStraightLine",ba=>{var ol=DD();Y(ba,ol)},ba=>{var ol=Qs(),xd=_s(ol);Ve(xd,()=>t()=="visiable",_u=>{var eu=RD();Y(_u,eu)},_u=>{var eu=Qs(),ca=_s(eu);Ve(ca,()=>t()=="weakMagnet",vc=>{var rc=jD();Y(vc,rc)},vc=>{var rc=Qs(),wd=_s(rc);Ve(wd,()=>t()=="xabcd",zl=>{var Fd=BD();Y(zl,Fd)},zl=>{var Fd=Qs(),Tl=_s(Fd);Ve(Tl,()=>t()=="lang",xa=>{var ku=OD();Y(xa,ku)},xa=>{var ku=Qs(),Qu=_s(ku);Ve(Qu,()=>t()=="theme",ed=>{var td=zD();Y(ed,td)},ed=>{var td=Qs(),sp=_s(td);Ve(sp,()=>t()=="user",Gf=>{var kd=VD();Y(Gf,kd)},Gf=>{var kd=Qs(),Zd=_s(kd);Ve(Zd,()=>t()=="indicator",gc=>{var jf=WD();Y(gc,jf)},gc=>{var jf=Qs(),Nf=_s(jf);Ve(Nf,()=>t()=="timezone",Jd=>{var xl=HD();Y(Jd,xl)},Jd=>{var xl=Qs(),Su=_s(xl);Ve(Su,()=>t()=="play",ad=>{var Af=qD();Y(ad,Af)},ad=>{var Af=Qs(),fu=_s(Af);Ve(fu,()=>t()=="stop",$u=>{var yu=UD();Y($u,yu)},$u=>{var yu=Qs(),Yf=_s(yu);Ve(Yf,()=>t()=="setting",Ga=>{var nf=GD();Y(Ga,nf)},Ga=>{var nf=Qs(),Sd=_s(nf);Ve(Sd,()=>t()=="screenShot",wp=>{var ac=YD();Y(wp,ac)},wp=>{var ac=Qs(),Ld=_s(ac);Ve(Ld,()=>t()=="exitFullScreen",Cu=>{var Ie=KD();Y(Cu,Ie)},Cu=>{var Ie=Qs(),ge=_s(Ie);Ve(ge,()=>t()=="fullScreen",Re=>{var vt=XD();Y(Re,vt)},Re=>{var vt=Qs(),Bt=_s(vt);Ve(Bt,()=>t()=="cloud",Xt=>{var W=ZD();Y(Xt,W)},Xt=>{var W=Qs(),Q=_s(W);Ve(Q,()=>t()=="undo",O=>{var U=JD();Y(O,U)},O=>{var U=Qs(),ce=_s(U);Ve(ce,()=>t()=="redo",G=>{var ye=QD();Y(G,ye)},G=>{var ye=Qs(),Qe=_s(ye);Ve(Qe,()=>t()=="crosshair",Ue=>{var dt=eR();Y(Ue,dt)},Ue=>{var dt=Qs(),et=_s(dt);Ve(et,()=>t()=="sidebar",B=>{var ve=tR();Oi(2),Y(B,ve)},B=>{var ve=sR(),Fe=y(ve,!0);_(ve),we(()=>st(Fe,t())),Y(B,ve)},!0),Y(Ue,dt)},!0),Y(G,ye)},!0),Y(O,U)},!0),Y(Xt,W)},!0),Y(Re,vt)},!0),Y(Cu,Ie)},!0),Y(wp,ac)},!0),Y(Ga,nf)},!0),Y($u,yu)},!0),Y(ad,Af)},!0),Y(Jd,xl)},!0),Y(gc,jf)},!0),Y(Gf,kd)},!0),Y(ed,td)},!0),Y(xa,ku)},!0),Y(zl,Fd)},!0),Y(vc,rc)},!0),Y(_u,eu)},!0),Y(ba,ol)},!0),Y(bl,Ua)},!0),Y(Ui,Ol)},!0),Y(mc,gu)},!0),Y(Jr,nl)},!0),Y(_a,dl)},!0),Y(ei,ai)},!0),Y(Ti,Eo)},!0),Y(xr,Ai)},!0),Y(bo,lo)},!0),Y(kn,Kn)},!0),Y(tp,wf)},!0),Y(Uf,xf)},!0),Y(br,Wc)},!0),Y(Td,ki)},!0),Y(la,El)},!0),Y(Dc,jl)},!0),Y(To,ec)},!0),Y(Vc,vu)},!0),Y(rd,Al)},!0),Y(Gc,du)},!0),Y(zi,Nl)},!0),Y(aa,tl)},!0),Y(Bo,Vo)},!0),Y(Cn,go)},!0),Y(Mn,po)},!0),Y(Hs,ns)},!0),Y(an,Es)},!0),Y(Ls,tn)},!0),Y(Se,Et)},!0),Y(jt,ft)},!0),Y(ze,Ge)},!0),Y(nt,Je)},!0),Y(Ft,zt)},!0),Y(pt,Rt)},!0),Y(Oe,Ke)},!0),Y(Te,Me)},!0),Y(xe,se)},!0),Y(le,pe)},!0),Y(de,ie)},!0),Y(D,X)},!0),Y(j,E)},!0),Y(A,P)},!0),Y(S,C)},!0),Y(p,v)},!0),Y(u,d)},!0),Y(l,c)}),_(r),we(()=>{Dt(r,"style",`width: ${o()??""}px; height: ${o()??""}px;`),yr(r,"active",n())}),Y(s,r)}var lb={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */lb.exports;(function(s,e){(function(){var t,n="4.17.21",o=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",f=500,u="__lodash_placeholder__",d=1,h=2,p=4,v=1,x=2,S=1,C=2,I=4,A=8,P=16,T=32,j=64,E=128,L=256,D=512,X=30,ne="...",de=800,ie=16,te=1,le=2,pe=3,re=1/0,xe=9007199254740991,se=17976931348623157e292,Ne=NaN,Te=4294967295,Me=Te-1,De=Te>>>1,Oe=[["ary",E],["bind",S],["bindKey",C],["curry",A],["curryRight",P],["flip",D],["partial",T],["partialRight",j],["rearg",L]],Ke="[object Arguments]",kt="[object Array]",pt="[object AsyncFunction]",Rt="[object Boolean]",Ht="[object Date]",Ft="[object DOMException]",zt="[object Error]",ut="[object Function]",nt="[object GeneratorFunction]",Je="[object Map]",it="[object Number]",ze="[object Null]",Ge="[object Object]",xt="[object Promise]",jt="[object Proxy]",ft="[object RegExp]",ke="[object Set]",Se="[object String]",Et="[object Symbol]",wt="[object Undefined]",Ls="[object WeakMap]",tn="[object WeakSet]",Gs="[object ArrayBuffer]",an="[object DataView]",Es="[object Float32Array]",Ns="[object Float64Array]",Hs="[object Int8Array]",ns="[object Int16Array]",fs="[object Int32Array]",Mn="[object Uint8Array]",po="[object Uint8ClampedArray]",Tn="[object Uint16Array]",Cn="[object Uint32Array]",go=/\b__p \+= '';/g,no=/\b(__p \+=) '' \+/g,Bo=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Vo=/&(?:amp|lt|gt|quot|#39);/g,Rl=/[&<>"']/g,aa=RegExp(Vo.source),tl=RegExp(Rl.source),Zr=/<%-([\s\S]+?)%>/g,zi=/<%([\s\S]+?)%>/g,Nl=/<%=([\s\S]+?)%>/g,mu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Gc=/^\w*$/,du=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ju=/[\\^$.*+?()[\]{}|]/g,rd=RegExp(Ju.source),Al=/^\s+/,sa=/\s/,Vc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,vu=/\{\n\/\* \[wrapped with (.+)\] \*/,Qc=/,? & /,To=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ec=/[()=,{}\[\]\/\s]/,yl=/\\(\\)?/g,Dc=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jl=/\w*$/,qi=/^[-+]0x[0-9a-f]+$/i,la=/^0b[01]+$/i,El=/^\[object .+?Constructor\]$/,qu=/^0o[0-7]+$/i,Td=/^(?:0|[1-9]\d*)$/,ki=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,sl=/($^)/,br=/['\n\r\u2028\u2029\\]/g,Wc="\\ud800-\\udfff",Xd="\\u0300-\\u036f",Uf="\\ufe20-\\ufe2f",xf="\\u20d0-\\u20ff",Uu=Xd+Uf+xf,tp="\\u2700-\\u27bf",wf="a-z\\xdf-\\xf6\\xf8-\\xff",Vs="\\xac\\xb1\\xd7\\xf7",kn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Kn="\\u2000-\\u206f",Bs=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bo="A-Z\\xc0-\\xd6\\xd8-\\xde",lo="\\ufe0e\\ufe0f",Qi=Vs+kn+Kn+Bs,xr="['’]",Ai="["+Wc+"]",ri="["+Qi+"]",Ti="["+Uu+"]",Eo="\\d+",hr="["+tp+"]",ei="["+wf+"]",ai="[^"+Wc+Qi+Eo+tp+wf+bo+"]",vi="\\ud83c[\\udffb-\\udfff]",_a="(?:"+Ti+"|"+vi+")",dl="[^"+Wc+"]",ar="(?:\\ud83c[\\udde6-\\uddff]){2}",Jr="[\\ud800-\\udbff][\\udc00-\\udfff]",nl="["+bo+"]",tc="\\u200d",mc="(?:"+ei+"|"+ai+")",gu="(?:"+nl+"|"+ai+")",Bl="(?:"+xr+"(?:d|ll|m|re|s|t|ve))?",Ui="(?:"+xr+"(?:D|LL|M|RE|S|T|VE))?",Ol=_a+"?",fl="["+lo+"]?",bl="(?:"+tc+"(?:"+[dl,ar,Jr].join("|")+")"+fl+Ol+")*",Ua="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",er="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ba=fl+Ol+bl,ol="(?:"+[hr,ar,Jr].join("|")+")"+ba,xd="(?:"+[dl+Ti+"?",Ti,ar,Jr,Ai].join("|")+")",_u=RegExp(xr,"g"),eu=RegExp(Ti,"g"),ca=RegExp(vi+"(?="+vi+")|"+xd+ba,"g"),vc=RegExp([nl+"?"+ei+"+"+Bl+"(?="+[ri,nl,"$"].join("|")+")",gu+"+"+Ui+"(?="+[ri,nl+mc,"$"].join("|")+")",nl+"?"+mc+"+"+Bl,nl+"+"+Ui,er,Ua,Eo,ol].join("|"),"g"),rc=RegExp("["+tc+Wc+Uu+lo+"]"),wd=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,zl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fd=-1,Tl={};Tl[Es]=Tl[Ns]=Tl[Hs]=Tl[ns]=Tl[fs]=Tl[Mn]=Tl[po]=Tl[Tn]=Tl[Cn]=!0,Tl[Ke]=Tl[kt]=Tl[Gs]=Tl[Rt]=Tl[an]=Tl[Ht]=Tl[zt]=Tl[ut]=Tl[Je]=Tl[it]=Tl[Ge]=Tl[ft]=Tl[ke]=Tl[Se]=Tl[Ls]=!1;var xa={};xa[Ke]=xa[kt]=xa[Gs]=xa[an]=xa[Rt]=xa[Ht]=xa[Es]=xa[Ns]=xa[Hs]=xa[ns]=xa[fs]=xa[Je]=xa[it]=xa[Ge]=xa[ft]=xa[ke]=xa[Se]=xa[Et]=xa[Mn]=xa[po]=xa[Tn]=xa[Cn]=!0,xa[zt]=xa[ut]=xa[Ls]=!1;var ku={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Qu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ed={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},td={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},sp=parseFloat,Gf=parseInt,kd=typeof o0=="object"&&o0&&o0.Object===Object&&o0,Zd=typeof self=="object"&&self&&self.Object===Object&&self,gc=kd||Zd||Function("return this")(),jf=e&&!e.nodeType&&e,Nf=jf&&!0&&s&&!s.nodeType&&s,Jd=Nf&&Nf.exports===jf,xl=Jd&&kd.process,Su=function(){try{var ls=Nf&&Nf.require&&Nf.require("util").types;return ls||xl&&xl.binding&&xl.binding("util")}catch{}}(),ad=Su&&Su.isArrayBuffer,Af=Su&&Su.isDate,fu=Su&&Su.isMap,$u=Su&&Su.isRegExp,yu=Su&&Su.isSet,Yf=Su&&Su.isTypedArray;function Ga(ls,ws,Fs){switch(Fs.length){case 0:return ls.call(ws);case 1:return ls.call(ws,Fs[0]);case 2:return ls.call(ws,Fs[0],Fs[1]);case 3:return ls.call(ws,Fs[0],Fs[1],Fs[2])}return ls.apply(ws,Fs)}function nf(ls,ws,Fs,to){for(var cr=-1,io=ls==null?0:ls.length;++cr<io;){var Yl=ls[cr];ws(to,Yl,Fs(Yl),ls)}return to}function Sd(ls,ws){for(var Fs=-1,to=ls==null?0:ls.length;++Fs<to&&ws(ls[Fs],Fs,ls)!==!1;);return ls}function wp(ls,ws){for(var Fs=ls==null?0:ls.length;Fs--&&ws(ls[Fs],Fs,ls)!==!1;);return ls}function ac(ls,ws){for(var Fs=-1,to=ls==null?0:ls.length;++Fs<to;)if(!ws(ls[Fs],Fs,ls))return!1;return!0}function Ld(ls,ws){for(var Fs=-1,to=ls==null?0:ls.length,cr=0,io=[];++Fs<to;){var Yl=ls[Fs];ws(Yl,Fs,ls)&&(io[cr++]=Yl)}return io}function Cu(ls,ws){var Fs=ls==null?0:ls.length;return!!Fs&&G(ls,ws,0)>-1}function Ie(ls,ws,Fs){for(var to=-1,cr=ls==null?0:ls.length;++to<cr;)if(Fs(ws,ls[to]))return!0;return!1}function ge(ls,ws){for(var Fs=-1,to=ls==null?0:ls.length,cr=Array(to);++Fs<to;)cr[Fs]=ws(ls[Fs],Fs,ls);return cr}function Re(ls,ws){for(var Fs=-1,to=ws.length,cr=ls.length;++Fs<to;)ls[cr+Fs]=ws[Fs];return ls}function vt(ls,ws,Fs,to){var cr=-1,io=ls==null?0:ls.length;for(to&&io&&(Fs=ls[++cr]);++cr<io;)Fs=ws(Fs,ls[cr],cr,ls);return Fs}function Bt(ls,ws,Fs,to){var cr=ls==null?0:ls.length;for(to&&cr&&(Fs=ls[--cr]);cr--;)Fs=ws(Fs,ls[cr],cr,ls);return Fs}function Xt(ls,ws){for(var Fs=-1,to=ls==null?0:ls.length;++Fs<to;)if(ws(ls[Fs],Fs,ls))return!0;return!1}var W=dt("length");function Q(ls){return ls.split("")}function O(ls){return ls.match(To)||[]}function U(ls,ws,Fs){var to;return Fs(ls,function(cr,io,Yl){if(ws(cr,io,Yl))return to=io,!1}),to}function ce(ls,ws,Fs,to){for(var cr=ls.length,io=Fs+(to?1:-1);to?io--:++io<cr;)if(ws(ls[io],io,ls))return io;return-1}function G(ls,ws,Fs){return ws===ws?mf(ls,ws,Fs):ce(ls,Qe,Fs)}function ye(ls,ws,Fs,to){for(var cr=Fs-1,io=ls.length;++cr<io;)if(to(ls[cr],ws))return cr;return-1}function Qe(ls){return ls!==ls}function Ue(ls,ws){var Fs=ls==null?0:ls.length;return Fs?Fe(ls,ws)/Fs:Ne}function dt(ls){return function(ws){return ws==null?t:ws[ls]}}function et(ls){return function(ws){return ls==null?t:ls[ws]}}function B(ls,ws,Fs,to,cr){return cr(ls,function(io,Yl,na){Fs=to?(to=!1,io):ws(Fs,io,Yl,na)}),Fs}function ve(ls,ws){var Fs=ls.length;for(ls.sort(ws);Fs--;)ls[Fs]=ls[Fs].value;return ls}function Fe(ls,ws){for(var Fs,to=-1,cr=ls.length;++to<cr;){var io=ws(ls[to]);io!==t&&(Fs=Fs===t?io:Fs+io)}return Fs}function ot(ls,ws){for(var Fs=-1,to=Array(ls);++Fs<ls;)to[Fs]=ws(Fs);return to}function tt(ls,ws){return ge(ws,function(Fs){return[Fs,ls[Fs]]})}function St(ls){return ls&&ls.slice(0,Tf(ls)+1).replace(Al,"")}function Be(ls){return function(ws){return ls(ws)}}function je(ls,ws){return ge(ws,function(Fs){return ls[Fs]})}function Mt(ls,ws){return ls.has(ws)}function Ze(ls,ws){for(var Fs=-1,to=ls.length;++Fs<to&&G(ws,ls[Fs],0)>-1;);return Fs}function rs(ls,ws){for(var Fs=ls.length;Fs--&&G(ws,ls[Fs],0)>-1;);return Fs}function yn(ls,ws){for(var Fs=ls.length,to=0;Fs--;)ls[Fs]===ws&&++to;return to}var Qn=et(ku),wn=et(Qu);function xo(ls){return"\\"+td[ls]}function hi(ls,ws){return ls==null?t:ls[ws]}function Ln(ls){return rc.test(ls)}function pl(ls){return wd.test(ls)}function vn(ls){for(var ws,Fs=[];!(ws=ls.next()).done;)Fs.push(ws.value);return Fs}function mo(ls){var ws=-1,Fs=Array(ls.size);return ls.forEach(function(to,cr){Fs[++ws]=[cr,to]}),Fs}function Gi(ls,ws){return function(Fs){return ls(ws(Fs))}}function La(ls,ws){for(var Fs=-1,to=ls.length,cr=0,io=[];++Fs<to;){var Yl=ls[Fs];(Yl===ws||Yl===u)&&(ls[Fs]=u,io[cr++]=Fs)}return io}function lc(ls){var ws=-1,Fs=Array(ls.size);return ls.forEach(function(to){Fs[++ws]=to}),Fs}function wl(ls){var ws=-1,Fs=Array(ls.size);return ls.forEach(function(to){Fs[++ws]=[to,to]}),Fs}function mf(ls,ws,Fs){for(var to=Fs-1,cr=ls.length;++to<cr;)if(ls[to]===ws)return to;return-1}function mp(ls,ws,Fs){for(var to=Fs+1;to--;)if(ls[to]===ws)return to;return to}function _c(ls){return Ln(ls)?Oa(ls):W(ls)}function Ea(ls){return Ln(ls)?lr(ls):Q(ls)}function Tf(ls){for(var ws=ls.length;ws--&&sa.test(ls.charAt(ws)););return ws}var Sr=et(ed);function Oa(ls){for(var ws=ca.lastIndex=0;ca.test(ls);)++ws;return ws}function lr(ls){return ls.match(ca)||[]}function mr(ls){return ls.match(vc)||[]}var Cr=function ls(ws){ws=ws==null?gc:hl.defaults(gc.Object(),ws,hl.pick(gc,zl));var Fs=ws.Array,to=ws.Date,cr=ws.Error,io=ws.Function,Yl=ws.Math,na=ws.Object,Od=ws.RegExp,qr=ws.String,za=ws.TypeError,Yc=Fs.prototype,Na=io.prototype,Rc=na.prototype,Ir=ws["__core-js_shared__"],tu=Na.toString,jc=Rc.hasOwnProperty,su=0,sd=function(){var g=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),of=Rc.toString,Iu=tu.call(na),Qd=gc._,Hl=Od("^"+tu.call(jc).replace(Ju,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kp=Jd?ws.Buffer:t,Ks=ws.Symbol,Ct=ws.Uint8Array,xn=kp?kp.allocUnsafe:t,As=Gi(na.getPrototypeOf,na),gn=na.create,Sn=Rc.propertyIsEnumerable,Yn=Yc.splice,_o=Ks?Ks.isConcatSpreadable:t,si=Ks?Ks.iterator:t,Gn=Ks?Ks.toStringTag:t,Uo=function(){try{var g=Mo(na,"defineProperty");return g({},"",{}),g}catch{}}(),oo=ws.clearTimeout!==gc.clearTimeout&&ws.clearTimeout,Si=to&&to.now!==gc.Date.now&&to.now,cc=ws.setTimeout!==gc.setTimeout&&ws.setTimeout,bu=Yl.ceil,$l=Yl.floor,nu=na.getOwnPropertySymbols,$r=kp?kp.isBuffer:t,$a=ws.isFinite,wa=Yc.join,yc=Gi(na.keys,na),ti=Yl.max,fi=Yl.min,hn=to.now,uo=ws.parseInt,tr=Yl.random,Pr=Yc.reverse,Mr=Mo(ws,"DataView"),Or=Mo(ws,"Map"),ou=Mo(ws,"Promise"),md=Mo(ws,"Set"),Kf=Mo(ws,"WeakMap"),Pu=Mo(na,"create"),ld=Kf&&new Kf,iu={},Ed=Jm(Mr),Du=Jm(Or),kf=Jm(ou),$d=Jm(md),Bf=Jm(Kf),Di=Ks?Ks.prototype:t,bh=Di?Di.valueOf:t,rf=Di?Di.toString:t;function Xe(g){if(hs(g)&&!Ho(g)&&!(g instanceof sc)){if(g instanceof Sp)return g;if(jc.call(g,"__wrapped__"))return Wg(g)}return new Sp(g)}var Dp=function(){function g(){}return function(w){if(!Ut(w))return{};if(gn)return gn(w);g.prototype=w;var $=new g;return g.prototype=t,$}}();function nm(){}function Sp(g,w){this.__wrapped__=g,this.__actions__=[],this.__chain__=!!w,this.__index__=0,this.__values__=t}Xe.templateSettings={escape:Zr,evaluate:zi,interpolate:Nl,variable:"",imports:{_:Xe}},Xe.prototype=nm.prototype,Xe.prototype.constructor=Xe,Sp.prototype=Dp(nm.prototype),Sp.prototype.constructor=Sp;function sc(g){this.__wrapped__=g,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Te,this.__views__=[]}function Xf(){var g=new sc(this.__wrapped__);return g.__actions__=Vi(this.__actions__),g.__dir__=this.__dir__,g.__filtered__=this.__filtered__,g.__iteratees__=Vi(this.__iteratees__),g.__takeCount__=this.__takeCount__,g.__views__=Vi(this.__views__),g}function ch(){if(this.__filtered__){var g=new sc(this);g.__dir__=-1,g.__filtered__=!0}else g=this.clone(),g.__dir__*=-1;return g}function Vh(){var g=this.__wrapped__.value(),w=this.__dir__,$=Ho(g),ue=w<0,Le=$?g.length:0,gt=Ra(0,Le,this.__views__),ss=gt.start,ks=gt.end,Ws=ks-ss,vo=ue?ks:ss-1,Co=this.__iteratees__,Jo=Co.length,Yr=0,Dl=fi(Ws,this.__takeCount__);if(!$||!ue&&Le==Ws&&Dl==Ws)return ln(g,this.__actions__);var Cc=[];e:for(;Ws--&&Yr<Dl;){vo+=w;for(var Wu=-1,Ic=g[vo];++Wu<Jo;){var fd=Co[Wu],Ad=fd.iteratee,Xh=fd.type,Mh=Ad(Ic);if(Xh==le)Ic=Mh;else if(!Mh){if(Xh==te)continue e;break e}}Cc[Yr++]=Ic}return Cc}sc.prototype=Dp(nm.prototype),sc.prototype.constructor=sc;function Lh(g){var w=-1,$=g==null?0:g.length;for(this.clear();++w<$;){var ue=g[w];this.set(ue[0],ue[1])}}function cp(){this.__data__=Pu?Pu(null):{},this.size=0}function cd(g){var w=this.has(g)&&delete this.__data__[g];return this.size-=w?1:0,w}function u0(g){var w=this.__data__;if(Pu){var $=w[g];return $===c?t:$}return jc.call(w,g)?w[g]:t}function Iv(g){var w=this.__data__;return Pu?w[g]!==t:jc.call(w,g)}function Dm(g,w){var $=this.__data__;return this.size+=this.has(g)?0:1,$[g]=Pu&&w===t?c:w,this}Lh.prototype.clear=cp,Lh.prototype.delete=cd,Lh.prototype.get=u0,Lh.prototype.has=Iv,Lh.prototype.set=Dm;function xh(g){var w=-1,$=g==null?0:g.length;for(this.clear();++w<$;){var ue=g[w];this.set(ue[0],ue[1])}}function th(){this.__data__=[],this.size=0}function Um(g){var w=this.__data__,$=Cs(w,g);if($<0)return!1;var ue=w.length-1;return $==ue?w.pop():Yn.call(w,$,1),--this.size,!0}function dv(g){var w=this.__data__,$=Cs(w,g);return $<0?t:w[$][1]}function Bg(g){return Cs(this.__data__,g)>-1}function Wh(g,w){var $=this.__data__,ue=Cs($,g);return ue<0?(++this.size,$.push([g,w])):$[ue][1]=w,this}xh.prototype.clear=th,xh.prototype.delete=Um,xh.prototype.get=dv,xh.prototype.has=Bg,xh.prototype.set=Wh;function om(g){var w=-1,$=g==null?0:g.length;for(this.clear();++w<$;){var ue=g[w];this.set(ue[0],ue[1])}}function Og(){this.size=0,this.__data__={hash:new Lh,map:new(Or||xh),string:new Lh}}function hm(g){var w=$t(this,g).delete(g);return this.size-=w?1:0,w}function mm(g){return $t(this,g).get(g)}function zg(g){return $t(this,g).has(g)}function Gm(g,w){var $=$t(this,g),ue=$.size;return $.set(g,w),this.size+=$.size==ue?0:1,this}om.prototype.clear=Og,om.prototype.delete=hm,om.prototype.get=mm,om.prototype.has=zg,om.prototype.set=Gm;function Rm(g){var w=-1,$=g==null?0:g.length;for(this.__data__=new om;++w<$;)this.add(g[w])}function Hh(g){return this.__data__.set(g,c),this}function fg(g){return this.__data__.has(g)}Rm.prototype.add=Rm.prototype.push=Hh,Rm.prototype.has=fg;function qh(g){var w=this.__data__=new xh(g);this.size=w.size}function Uv(){this.__data__=new xh,this.size=0}function Zf(g){var w=this.__data__,$=w.delete(g);return this.size=w.size,$}function vm(g){return this.__data__.get(g)}function pg(g){return this.__data__.has(g)}function d0(g,w){var $=this.__data__;if($ instanceof xh){var ue=$.__data__;if(!Or||ue.length<o-1)return ue.push([g,w]),this.size=++$.size,this;$=this.__data__=new om(ue)}return $.set(g,w),this.size=$.size,this}qh.prototype.clear=Uv,qh.prototype.delete=Zf,qh.prototype.get=vm,qh.prototype.has=pg,qh.prototype.set=d0;function ee(g,w){var $=Ho(g),ue=!$&&cl(g),Le=!$&&!ue&&K(g),gt=!$&&!ue&&!Le&&ir(g),ss=$||ue||Le||gt,ks=ss?ot(g.length,qr):[],Ws=ks.length;for(var vo in g)(w||jc.call(g,vo))&&!(ss&&(vo=="length"||Le&&(vo=="offset"||vo=="parent")||gt&&(vo=="buffer"||vo=="byteLength"||vo=="byteOffset")||bc(vo,Ws)))&&ks.push(vo);return ks}function oe(g){var w=g.length;return w?g[$s(0,w-1)]:t}function $e(g,w){return jm(Vi(g),Go(w,0,g.length))}function at(g){return jm(Vi(g))}function Gt(g,w,$){($!==t&&!kr(g[w],$)||$===t&&!(w in g))&&ho(g,w,$)}function Nt(g,w,$){var ue=g[w];(!(jc.call(g,w)&&kr(ue,$))||$===t&&!(w in g))&&ho(g,w,$)}function Cs(g,w){for(var $=g.length;$--;)if(kr(g[$][0],w))return $;return-1}function nn(g,w,$,ue){return Ya(g,function(Le,gt,ss){w(ue,Le,$(Le),ss)}),ue}function Xs(g,w){return g&&Xl(w,Wf(w),g)}function Xn(g,w){return g&&Xl(w,qd(w),g)}function ho(g,w,$){w=="__proto__"&&Uo?Uo(g,w,{configurable:!0,enumerable:!0,value:$,writable:!0}):g[w]=$}function Zn(g,w){for(var $=-1,ue=w.length,Le=Fs(ue),gt=g==null;++$<ue;)Le[$]=gt?t:df(g,w[$]);return Le}function Go(g,w,$){return g===g&&($!==t&&(g=g<=$?g:$),w!==t&&(g=g>=w?g:w)),g}function mi(g,w,$,ue,Le,gt){var ss,ks=w&d,Ws=w&h,vo=w&p;if($&&(ss=Le?$(g,ue,Le,gt):$(g)),ss!==t)return ss;if(!Ut(g))return g;var Co=Ho(g);if(Co){if(ss=Qf(g),!ks)return Vi(g,ss)}else{var Jo=eo(g),Yr=Jo==ut||Jo==nt;if(K(g))return fo(g,ks);if(Jo==Ge||Jo==Ke||Yr&&!Le){if(ss=Ws||Yr?{}:Bp(g),!ks)return Ws?Da(g,Xn(ss,g)):Hc(g,Xs(ss,g))}else{if(!xa[Jo])return Le?g:{};ss=Gp(g,Jo,ks)}}gt||(gt=new qh);var Dl=gt.get(g);if(Dl)return Dl;gt.set(g,ss),Qo(g)?g.forEach(function(Ic){ss.add(mi(Ic,w,$,Ic,g,gt))}):Is(g)&&g.forEach(function(Ic,fd){ss.set(fd,mi(Ic,w,$,fd,g,gt))});var Cc=vo?Ws?Nr:Wi:Ws?qd:Wf,Wu=Co?t:Cc(g);return Sd(Wu||g,function(Ic,fd){Wu&&(fd=Ic,Ic=g[fd]),Nt(ss,fd,mi(Ic,w,$,fd,g,gt))}),ss}function $o(g){var w=Wf(g);return function($){return kl($,g,w)}}function kl(g,w,$){var ue=$.length;if(g==null)return!ue;for(g=na(g);ue--;){var Le=$[ue],gt=w[Le],ss=g[Le];if(ss===t&&!(Le in g)||!gt(ss))return!1}return!0}function Fl(g,w,$){if(typeof g!="function")throw new za(a);return Zm(function(){g.apply(t,$)},w)}function il(g,w,$,ue){var Le=-1,gt=Cu,ss=!0,ks=g.length,Ws=[],vo=w.length;if(!ks)return Ws;$&&(w=ge(w,Be($))),ue?(gt=Ie,ss=!1):w.length>=o&&(gt=Mt,ss=!1,w=new Rm(w));e:for(;++Le<ks;){var Co=g[Le],Jo=$==null?Co:$(Co);if(Co=ue||Co!==0?Co:0,ss&&Jo===Jo){for(var Yr=vo;Yr--;)if(w[Yr]===Jo)continue e;Ws.push(Co)}else gt(w,Jo,ue)||Ws.push(Co)}return Ws}var Ya=Ka(Hn),Kl=Ka(Oo,!0);function ru(g,w){var $=!0;return Ya(g,function(ue,Le,gt){return $=!!w(ue,Le,gt),$}),$}function vd(g,w,$){for(var ue=-1,Le=g.length;++ue<Le;){var gt=g[ue],ss=w(gt);if(ss!=null&&(ks===t?ss===ss&&!Do(ss):$(ss,ks)))var ks=ss,Ws=gt}return Ws}function nc(g,w,$,ue){var Le=g.length;for($=Ji($),$<0&&($=-$>Le?0:Le+$),ue=ue===t||ue>Le?Le:Ji(ue),ue<0&&(ue+=Le),ue=$>ue?0:Nu(ue);$<ue;)g[$++]=w;return g}function af(g,w){var $=[];return Ya(g,function(ue,Le,gt){w(ue,Le,gt)&&$.push(ue)}),$}function zd(g,w,$,ue,Le){var gt=-1,ss=g.length;for($||($=Ri),Le||(Le=[]);++gt<ss;){var ks=g[gt];w>0&&$(ks)?w>1?zd(ks,w-1,$,ue,Le):Re(Le,ks):ue||(Le[Le.length]=ks)}return Le}var lf=Gu(),ef=Gu(!0);function Hn(g,w){return g&&lf(g,w,Wf)}function Oo(g,w){return g&&ef(g,w,Wf)}function pi(g,w){return Ld(w,function($){return as(g[$])})}function ur(g,w){w=Fo(w,g);for(var $=0,ue=w.length;g!=null&&$<ue;)g=g[Ch(w[$++])];return $&&$==ue?g:t}function Mc(g,w,$){var ue=w(g);return Ho(g)?ue:Re(ue,$(g))}function Nc(g){return g==null?g===t?wt:ze:Gn&&Gn in na(g)?No(g):Ef(g)}function Vf(g,w){return g>w}function xu(g,w){return g!=null&&jc.call(g,w)}function nd(g,w){return g!=null&&w in na(g)}function Dd(g,w,$){return g>=fi(w,$)&&g<ti(w,$)}function Jf(g,w,$){for(var ue=$?Ie:Cu,Le=g[0].length,gt=g.length,ss=gt,ks=Fs(gt),Ws=1/0,vo=[];ss--;){var Co=g[ss];ss&&w&&(Co=ge(Co,Be(w))),Ws=fi(Co.length,Ws),ks[ss]=!$&&(w||Le>=120&&Co.length>=120)?new Rm(ss&&Co):t}Co=g[0];var Jo=-1,Yr=ks[0];e:for(;++Jo<Le&&vo.length<Ws;){var Dl=Co[Jo],Cc=w?w(Dl):Dl;if(Dl=$||Dl!==0?Dl:0,!(Yr?Mt(Yr,Cc):ue(vo,Cc,$))){for(ss=gt;--ss;){var Wu=ks[ss];if(!(Wu?Mt(Wu,Cc):ue(g[ss],Cc,$)))continue e}Yr&&Yr.push(Cc),vo.push(Dl)}}return vo}function fr(g,w,$,ue){return Hn(g,function(Le,gt,ss){w(ue,$(Le),gt,ss)}),ue}function sh(g,w,$){w=Fo(w,g),g=$f(g,w);var ue=g==null?g:g[Ch(Bu(w))];return ue==null?t:Ga(ue,g,$)}function gm(g){return hs(g)&&Nc(g)==Ke}function _m(g){return hs(g)&&Nc(g)==Gs}function wh(g){return hs(g)&&Nc(g)==Ht}function Uh(g,w,$,ue,Le){return g===w?!0:g==null||w==null||!hs(g)&&!hs(w)?g!==g&&w!==w:Nm(g,w,$,ue,Uh,Le)}function Nm(g,w,$,ue,Le,gt){var ss=Ho(g),ks=Ho(w),Ws=ss?kt:eo(g),vo=ks?kt:eo(w);Ws=Ws==Ke?Ge:Ws,vo=vo==Ke?Ge:vo;var Co=Ws==Ge,Jo=vo==Ge,Yr=Ws==vo;if(Yr&&K(g)){if(!K(w))return!1;ss=!0,Co=!1}if(Yr&&!Co)return gt||(gt=new qh),ss||ir(g)?Km(g,w,$,ue,Le,gt):Gv(g,w,Ws,$,ue,Le,gt);if(!($&v)){var Dl=Co&&jc.call(g,"__wrapped__"),Cc=Jo&&jc.call(w,"__wrapped__");if(Dl||Cc){var Wu=Dl?g.value():g,Ic=Cc?w.value():w;return gt||(gt=new qh),Le(Wu,Ic,$,ue,gt)}}return Yr?(gt||(gt=new qh),Xm(g,w,$,ue,Le,gt)):!1}function Ym(g){return hs(g)&&eo(g)==Je}function Rp(g,w,$,ue){var Le=$.length,gt=Le,ss=!ue;if(g==null)return!gt;for(g=na(g);Le--;){var ks=$[Le];if(ss&&ks[2]?ks[1]!==g[ks[0]]:!(ks[0]in g))return!1}for(;++Le<gt;){ks=$[Le];var Ws=ks[0],vo=g[Ws],Co=ks[1];if(ss&&ks[2]){if(vo===t&&!(Ws in g))return!1}else{var Jo=new qh;if(ue)var Yr=ue(vo,Co,Ws,g,w,Jo);if(!(Yr===t?Uh(Co,vo,v|x,ue,Jo):Yr))return!1}}return!0}function Eh(g){if(!Ut(g)||gd(g))return!1;var w=as(g)?Hl:El;return w.test(Jm(g))}function Am(g){return hs(g)&&Nc(g)==ft}function im(g){return hs(g)&&eo(g)==ke}function nh(g){return hs(g)&&ct(g.length)&&!!Tl[Nc(g)]}function fv(g){return typeof g=="function"?g:g==null?Ql:typeof g=="object"?Ho(g)?M(g[0],g[1]):Tm(g):zm(g)}function Gh(g){if(!Cf(g))return yc(g);var w=[];for(var $ in na(g))jc.call(g,$)&&$!="constructor"&&w.push($);return w}function Cp(g){if(!Ut(g))return $h(g);var w=Cf(g),$=[];for(var ue in g)ue=="constructor"&&(w||!jc.call(g,ue))||$.push(ue);return $}function vf(g,w){return g<w}function ym(g,w){var $=-1,ue=Fr(g)?Fs(g.length):[];return Ya(g,function(Le,gt,ss){ue[++$]=w(Le,gt,ss)}),ue}function Tm(g){var w=En(g);return w.length==1&&w[0][2]?zp(w[0][0],w[0][1]):function($){return $===g||Rp($,g,w)}}function M(g,w){return Sf(g)&&ep(w)?zp(Ch(g),w):function($){var ue=df($,g);return ue===t&&ue===w?ph($,g):Uh(w,ue,v|x)}}function V(g,w,$,ue,Le){g!==w&&lf(w,function(gt,ss){if(Le||(Le=new qh),Ut(gt))fe(g,w,ss,$,V,ue,Le);else{var ks=ue?ue(wm(g,ss),gt,ss+"",g,w,Le):t;ks===t&&(ks=gt),Gt(g,ss,ks)}},qd)}function fe(g,w,$,ue,Le,gt,ss){var ks=wm(g,$),Ws=wm(w,$),vo=ss.get(Ws);if(vo){Gt(g,$,vo);return}var Co=gt?gt(ks,Ws,$+"",g,w,ss):t,Jo=Co===t;if(Jo){var Yr=Ho(Ws),Dl=!Yr&&K(Ws),Cc=!Yr&&!Dl&&ir(Ws);Co=Ws,Yr||Dl||Cc?Ho(ks)?Co=ks:Mi(ks)?Co=Vi(ks):Dl?(Jo=!1,Co=fo(Ws,!0)):Cc?(Jo=!1,Co=Xo(Ws,!0)):Co=[]:_n(Ws)||cl(Ws)?(Co=ks,cl(ks)?Co=zu(ks):(!Ut(ks)||as(ks))&&(Co=Bp(Ws))):Jo=!1}Jo&&(ss.set(Ws,Co),Le(Co,Ws,ue,gt,ss),ss.delete(Ws)),Gt(g,$,Co)}function me(g,w){var $=g.length;if($)return w+=w<0?$:0,bc(w,$)?g[w]:t}function ae(g,w,$){w.length?w=ge(w,function(gt){return Ho(gt)?function(ss){return ur(ss,gt.length===1?gt[0]:gt)}:gt}):w=[Ql];var ue=-1;w=ge(w,Be(Yi()));var Le=ym(g,function(gt,ss,ks){var Ws=ge(w,function(vo){return vo(gt)});return{criteria:Ws,index:++ue,value:gt}});return ve(Le,function(gt,ss){return Sl(gt,ss,$)})}function We(g,w){return He(g,w,function($,ue){return ph(g,ue)})}function He(g,w,$){for(var ue=-1,Le=w.length,gt={};++ue<Le;){var ss=w[ue],ks=ur(g,ss);$(ks,ss)&&Nn(gt,Fo(ss,g),ks)}return gt}function At(g){return function(w){return ur(w,g)}}function Wt(g,w,$,ue){var Le=ue?ye:G,gt=-1,ss=w.length,ks=g;for(g===w&&(w=Vi(w)),$&&(ks=ge(g,Be($)));++gt<ss;)for(var Ws=0,vo=w[gt],Co=$?$(vo):vo;(Ws=Le(ks,Co,Ws,ue))>-1;)ks!==g&&Yn.call(ks,Ws,1),Yn.call(g,Ws,1);return g}function Jt(g,w){for(var $=g?w.length:0,ue=$-1;$--;){var Le=w[$];if($==ue||Le!==gt){var gt=Le;bc(Le)?Yn.call(g,Le,1):is(g,Le)}}return g}function $s(g,w){return g+$l(tr()*(w-g+1))}function Kt(g,w,$,ue){for(var Le=-1,gt=ti(bu((w-g)/($||1)),0),ss=Fs(gt);gt--;)ss[ue?gt:++Le]=g,g+=$;return ss}function Us(g,w){var $="";if(!g||w<1||w>xe)return $;do w%2&&($+=g),w=$l(w/2),w&&(g+=g);while(w);return $}function es(g,w){return Av(Cd(g,w,Ql),g+"")}function rn(g){return oe(gv(g))}function pn(g,w){var $=gv(g);return jm($,Go(w,0,$.length))}function Nn(g,w,$,ue){if(!Ut(g))return g;w=Fo(w,g);for(var Le=-1,gt=w.length,ss=gt-1,ks=g;ks!=null&&++Le<gt;){var Ws=Ch(w[Le]),vo=$;if(Ws==="__proto__"||Ws==="constructor"||Ws==="prototype")return g;if(Le!=ss){var Co=ks[Ws];vo=ue?ue(Co,Ws,ks):t,vo===t&&(vo=Ut(Co)?Co:bc(w[Le+1])?[]:{})}Nt(ks,Ws,vo),ks=ks[Ws]}return g}var js=ld?function(g,w){return ld.set(g,w),g}:Ql,qt=Uo?function(g,w){return Uo(g,"toString",{configurable:!0,enumerable:!1,value:Fu(w),writable:!0})}:Ql;function Os(g){return jm(gv(g))}function zs(g,w,$){var ue=-1,Le=g.length;w<0&&(w=-w>Le?0:Le+w),$=$>Le?Le:$,$<0&&($+=Le),Le=w>$?0:$-w>>>0,w>>>=0;for(var gt=Fs(Le);++ue<Le;)gt[ue]=g[ue+w];return gt}function mn(g,w){var $;return Ya(g,function(ue,Le,gt){return $=w(ue,Le,gt),!$}),!!$}function un(g,w,$){var ue=0,Le=g==null?ue:g.length;if(typeof w=="number"&&w===w&&Le<=De){for(;ue<Le;){var gt=ue+Le>>>1,ss=g[gt];ss!==null&&!Do(ss)&&($?ss<=w:ss<w)?ue=gt+1:Le=gt}return Le}return jn(g,w,Ql,$)}function jn(g,w,$,ue){var Le=0,gt=g==null?0:g.length;if(gt===0)return 0;w=$(w);for(var ss=w!==w,ks=w===null,Ws=Do(w),vo=w===t;Le<gt;){var Co=$l((Le+gt)/2),Jo=$(g[Co]),Yr=Jo!==t,Dl=Jo===null,Cc=Jo===Jo,Wu=Do(Jo);if(ss)var Ic=ue||Cc;else vo?Ic=Cc&&(ue||Yr):ks?Ic=Cc&&Yr&&(ue||!Dl):Ws?Ic=Cc&&Yr&&!Dl&&(ue||!Wu):Dl||Wu?Ic=!1:Ic=ue?Jo<=w:Jo<w;Ic?Le=Co+1:gt=Co}return fi(gt,Me)}function ro(g,w){for(var $=-1,ue=g.length,Le=0,gt=[];++$<ue;){var ss=g[$],ks=w?w(ss):ss;if(!$||!kr(ks,Ws)){var Ws=ks;gt[Le++]=ss===0?0:ss}}return gt}function ys(g){return typeof g=="number"?g:Do(g)?Ne:+g}function qs(g){if(typeof g=="string")return g;if(Ho(g))return ge(g,qs)+"";if(Do(g))return rf?rf.call(g):"";var w=g+"";return w=="0"&&1/g==-re?"-0":w}function Js(g,w,$){var ue=-1,Le=Cu,gt=g.length,ss=!0,ks=[],Ws=ks;if($)ss=!1,Le=Ie;else if(gt>=o){var vo=w?null:xm(g);if(vo)return lc(vo);ss=!1,Le=Mt,Ws=new Rm}else Ws=w?[]:ks;e:for(;++ue<gt;){var Co=g[ue],Jo=w?w(Co):Co;if(Co=$||Co!==0?Co:0,ss&&Jo===Jo){for(var Yr=Ws.length;Yr--;)if(Ws[Yr]===Jo)continue e;w&&Ws.push(Jo),ks.push(Co)}else Le(Ws,Jo,$)||(Ws!==ks&&Ws.push(Jo),ks.push(Co))}return ks}function is(g,w){return w=Fo(w,g),g=$f(g,w),g==null||delete g[Ch(Bu(w))]}function ts(g,w,$,ue){return Nn(g,w,$(ur(g,w)),ue)}function Ss(g,w,$,ue){for(var Le=g.length,gt=ue?Le:-1;(ue?gt--:++gt<Le)&&w(g[gt],gt,g););return $?zs(g,ue?0:gt,ue?gt+1:Le):zs(g,ue?gt+1:0,ue?Le:gt)}function ln(g,w){var $=g;return $ instanceof sc&&($=$.value()),vt(w,function(ue,Le){return Le.func.apply(Le.thisArg,Re([ue],Le.args))},$)}function on(g,w,$){var ue=g.length;if(ue<2)return ue?Js(g[0]):[];for(var Le=-1,gt=Fs(ue);++Le<ue;)for(var ss=g[Le],ks=-1;++ks<ue;)ks!=Le&&(gt[Le]=il(gt[Le]||ss,g[ks],w,$));return Js(zd(gt,1),w,$)}function yo(g,w,$){for(var ue=-1,Le=g.length,gt=w.length,ss={};++ue<Le;){var ks=ue<gt?w[ue]:t;$(ss,g[ue],ks)}return ss}function pr(g){return Mi(g)?g:[]}function dn(g){return typeof g=="function"?g:Ql}function Fo(g,w){return Ho(g)?g:Sf(g,w)?[g]:Yv(ta(g))}var Dn=es;function Yo(g,w,$){var ue=g.length;return $=$===t?ue:$,!w&&$>=ue?g:zs(g,w,$)}var Fi=oo||function(g){return gc.clearTimeout(g)};function fo(g,w){if(w)return g.slice();var $=g.length,ue=xn?xn($):new g.constructor($);return g.copy(ue),ue}function Pn(g){var w=new g.constructor(g.byteLength);return new Ct(w).set(new Ct(g)),w}function ii(g,w){var $=w?Pn(g.buffer):g.buffer;return new g.constructor($,g.byteOffset,g.byteLength)}function Dr(g){var w=new g.constructor(g.source,jl.exec(g));return w.lastIndex=g.lastIndex,w}function ni(g){return bh?na(bh.call(g)):{}}function Xo(g,w){var $=w?Pn(g.buffer):g.buffer;return new g.constructor($,g.byteOffset,g.length)}function sr(g,w){if(g!==w){var $=g!==t,ue=g===null,Le=g===g,gt=Do(g),ss=w!==t,ks=w===null,Ws=w===w,vo=Do(w);if(!ks&&!vo&&!gt&&g>w||gt&&ss&&Ws&&!ks&&!vo||ue&&ss&&Ws||!$&&Ws||!Le)return 1;if(!ue&&!gt&&!vo&&g<w||vo&&$&&Le&&!ue&&!gt||ks&&$&&Le||!ss&&Le||!Ws)return-1}return 0}function Sl(g,w,$){for(var ue=-1,Le=g.criteria,gt=w.criteria,ss=Le.length,ks=$.length;++ue<ss;){var Ws=sr(Le[ue],gt[ue]);if(Ws){if(ue>=ks)return Ws;var vo=$[ue];return Ws*(vo=="desc"?-1:1)}}return g.index-w.index}function Ru(g,w,$,ue){for(var Le=-1,gt=g.length,ss=$.length,ks=-1,Ws=w.length,vo=ti(gt-ss,0),Co=Fs(Ws+vo),Jo=!ue;++ks<Ws;)Co[ks]=w[ks];for(;++Le<ss;)(Jo||Le<gt)&&(Co[$[Le]]=g[Le]);for(;vo--;)Co[ks++]=g[Le++];return Co}function rl(g,w,$,ue){for(var Le=-1,gt=g.length,ss=-1,ks=$.length,Ws=-1,vo=w.length,Co=ti(gt-ks,0),Jo=Fs(Co+vo),Yr=!ue;++Le<Co;)Jo[Le]=g[Le];for(var Dl=Le;++Ws<vo;)Jo[Dl+Ws]=w[Ws];for(;++ss<ks;)(Yr||Le<gt)&&(Jo[Dl+$[ss]]=g[Le++]);return Jo}function Vi(g,w){var $=-1,ue=g.length;for(w||(w=Fs(ue));++$<ue;)w[$]=g[$];return w}function Xl(g,w,$,ue){var Le=!$;$||($={});for(var gt=-1,ss=w.length;++gt<ss;){var ks=w[gt],Ws=ue?ue($[ks],g[ks],ks,$,g):t;Ws===t&&(Ws=g[ks]),Le?ho($,ks,Ws):Nt($,ks,Ws)}return $}function Hc(g,w){return Xl(g,ka(g),w)}function Da(g,w){return Xl(g,Xc(g),w)}function gf(g,w){return function($,ue){var Le=Ho($)?nf:nn,gt=w?w():{};return Le($,g,Yi(ue,2),gt)}}function ju(g){return es(function(w,$){var ue=-1,Le=$.length,gt=Le>1?$[Le-1]:t,ss=Le>2?$[2]:t;for(gt=g.length>3&&typeof gt=="function"?(Le--,gt):t,ss&&Mu($[0],$[1],ss)&&(gt=Le<3?t:gt,Le=1),w=na(w);++ue<Le;){var ks=$[ue];ks&&g(w,ks,ue,gt)}return w})}function Ka(g,w){return function($,ue){if($==null)return $;if(!Fr($))return g($,ue);for(var Le=$.length,gt=w?Le:-1,ss=na($);(w?gt--:++gt<Le)&&ue(ss[gt],gt,ss)!==!1;);return $}}function Gu(g){return function(w,$,ue){for(var Le=-1,gt=na(w),ss=ue(w),ks=ss.length;ks--;){var Ws=ss[g?ks:++Le];if($(gt[Ws],Ws,gt)===!1)break}return w}}function tf(g,w,$){var ue=w&S,Le=vp(g);function gt(){var ss=this&&this!==gc&&this instanceof gt?Le:g;return ss.apply(ue?$:this,arguments)}return gt}function kh(g){return function(w){w=ta(w);var $=Ln(w)?Ea(w):t,ue=$?$[0]:w.charAt(0),Le=$?Yo($,1).join(""):w.slice(1);return ue[g]()+Le}}function oh(g){return function(w){return vt(Po(y0(w).replace(_u,"")),g,"")}}function vp(g){return function(){var w=arguments;switch(w.length){case 0:return new g;case 1:return new g(w[0]);case 2:return new g(w[0],w[1]);case 3:return new g(w[0],w[1],w[2]);case 4:return new g(w[0],w[1],w[2],w[3]);case 5:return new g(w[0],w[1],w[2],w[3],w[4]);case 6:return new g(w[0],w[1],w[2],w[3],w[4],w[5]);case 7:return new g(w[0],w[1],w[2],w[3],w[4],w[5],w[6])}var $=Dp(g.prototype),ue=g.apply($,w);return Ut(ue)?ue:$}}function Ff(g,w,$){var ue=vp(g);function Le(){for(var gt=arguments.length,ss=Fs(gt),ks=gt,Ws=Vd(Le);ks--;)ss[ks]=arguments[ks];var vo=gt<3&&ss[0]!==Ws&&ss[gt-1]!==Ws?[]:La(ss,Ws);if(gt-=vo.length,gt<$)return Yh(g,w,jp,Le.placeholder,t,ss,vo,t,t,$-gt);var Co=this&&this!==gc&&this instanceof Le?ue:g;return Ga(Co,this,ss)}return Le}function ih(g){return function(w,$,ue){var Le=na(w);if(!Fr(w)){var gt=Yi($,3);w=Wf(w),$=function(ks){return gt(Le[ks],ks,Le)}}var ss=g(w,$,ue);return ss>-1?Le[gt?w[ss]:ss]:t}}function bm(g){return up(function(w){var $=w.length,ue=$,Le=Sp.prototype.thru;for(g&&w.reverse();ue--;){var gt=w[ue];if(typeof gt!="function")throw new za(a);if(Le&&!ss&&Yu(gt)=="wrapper")var ss=new Sp([],!0)}for(ue=ss?ue:$;++ue<$;){gt=w[ue];var ks=Yu(gt),Ws=ks=="wrapper"?Kc(gt):t;Ws&&Op(Ws[0])&&Ws[1]==(E|A|T|L)&&!Ws[4].length&&Ws[9]==1?ss=ss[Yu(Ws[0])].apply(ss,Ws[3]):ss=gt.length==1&&Op(gt)?ss[ks]():ss.thru(gt)}return function(){var vo=arguments,Co=vo[0];if(ss&&vo.length==1&&Ho(Co))return ss.plant(Co).value();for(var Jo=0,Yr=$?w[Jo].apply(this,vo):Co;++Jo<$;)Yr=w[Jo].call(this,Yr);return Yr}})}function jp(g,w,$,ue,Le,gt,ss,ks,Ws,vo){var Co=w&E,Jo=w&S,Yr=w&C,Dl=w&(A|P),Cc=w&D,Wu=Yr?t:vp(g);function Ic(){for(var fd=arguments.length,Ad=Fs(fd),Xh=fd;Xh--;)Ad[Xh]=arguments[Xh];if(Dl)var Mh=Vd(Ic),Zh=yn(Ad,Mh);if(ue&&(Ad=Ru(Ad,ue,Le,Dl)),gt&&(Ad=rl(Ad,gt,ss,Dl)),fd-=Zh,Dl&&fd<vo){var Ip=La(Ad,Mh);return Yh(g,w,jp,Ic.placeholder,$,Ad,Ip,ks,Ws,vo-fd)}var Fm=Jo?$:this,Rv=Yr?Fm[g]:g;return fd=Ad.length,ks?Ad=uh(Ad,ks):Cc&&fd>1&&Ad.reverse(),Co&&Ws<fd&&(Ad.length=Ws),this&&this!==gc&&this instanceof Ic&&(Rv=Wu||vp(Rv)),Rv.apply(Fm,Ad)}return Ic}function Pv(g,w){return function($,ue){return fr($,g,w(ue),{})}}function gp(g,w){return function($,ue){var Le;if($===t&&ue===t)return w;if($!==t&&(Le=$),ue!==t){if(Le===t)return ue;typeof $=="string"||typeof ue=="string"?($=qs($),ue=qs(ue)):($=ys($),ue=ys(ue)),Le=g($,ue)}return Le}}function uc(g){return up(function(w){return w=ge(w,Be(Yi())),es(function($){var ue=this;return g(w,function(Le){return Ga(Le,ue,$)})})})}function vr(g,w){w=w===t?" ":qs(w);var $=w.length;if($<2)return $?Us(w,g):w;var ue=Us(w,bu(g/_c(w)));return Ln(w)?Yo(Ea(ue),0,g).join(""):ue.slice(0,g)}function Lf(g,w,$,ue){var Le=w&S,gt=vp(g);function ss(){for(var ks=-1,Ws=arguments.length,vo=-1,Co=ue.length,Jo=Fs(Co+Ws),Yr=this&&this!==gc&&this instanceof ss?gt:g;++vo<Co;)Jo[vo]=ue[vo];for(;Ws--;)Jo[vo++]=arguments[++ks];return Ga(Yr,Le?$:this,Jo)}return ss}function Mp(g){return function(w,$,ue){return ue&&typeof ue!="number"&&Mu(w,$,ue)&&($=ue=t),w=Ta(w),$===t?($=w,w=0):$=Ta($),ue=ue===t?w<$?1:-1:Ta(ue),Kt(w,$,ue,g)}}function Up(g){return function(w,$){return typeof w=="string"&&typeof $=="string"||(w=Pa(w),$=Pa($)),g(w,$)}}function Yh(g,w,$,ue,Le,gt,ss,ks,Ws,vo){var Co=w&A,Jo=Co?ss:t,Yr=Co?t:ss,Dl=Co?gt:t,Cc=Co?t:gt;w|=Co?T:j,w&=~(Co?j:T),w&I||(w&=~(S|C));var Wu=[g,w,Le,Dl,Jo,Cc,Yr,ks,Ws,vo],Ic=$.apply(t,Wu);return Op(g)&&Nv(Ic,Wu),Ic.placeholder=ue,hg(Ic,g,w)}function _p(g){var w=Yl[g];return function($,ue){if($=Pa($),ue=ue==null?0:fi(Ji(ue),292),ue&&$a($)){var Le=(ta($)+"e").split("e"),gt=w(Le[0]+"e"+(+Le[1]+ue));return Le=(ta(gt)+"e").split("e"),+(Le[0]+"e"+(+Le[1]-ue))}return w($)}}var xm=md&&1/lc(new md([,-0]))[1]==re?function(g){return new md(g)}:ah;function pv(g){return function(w){var $=eo(w);return $==Je?mo(w):$==ke?wl(w):tt(w,g(w))}}function Sh(g,w,$,ue,Le,gt,ss,ks){var Ws=w&C;if(!Ws&&typeof g!="function")throw new za(a);var vo=ue?ue.length:0;if(vo||(w&=~(T|j),ue=Le=t),ss=ss===t?ss:ti(Ji(ss),0),ks=ks===t?ks:Ji(ks),vo-=Le?Le.length:0,w&j){var Co=ue,Jo=Le;ue=Le=t}var Yr=Ws?t:Kc(g),Dl=[g,w,$,ue,Le,Co,Jo,gt,ss,ks];if(Yr&&np(Dl,Yr),g=Dl[0],w=Dl[1],$=Dl[2],ue=Dl[3],Le=Dl[4],ks=Dl[9]=Dl[9]===t?Ws?0:g.length:ti(Dl[9]-vo,0),!ks&&w&(A|P)&&(w&=~(A|P)),!w||w==S)var Cc=tf(g,w,$);else w==A||w==P?Cc=Ff(g,w,ks):(w==T||w==(S|T))&&!Le.length?Cc=Lf(g,w,$,ue):Cc=jp.apply(t,Dl);var Wu=Yr?js:Nv;return hg(Wu(Cc,Dl),g,w)}function Mv(g,w,$,ue){return g===t||kr(g,Rc[$])&&!jc.call(ue,$)?w:g}function hv(g,w,$,ue,Le,gt){return Ut(g)&&Ut(w)&&(gt.set(w,g),V(g,w,t,hv,gt),gt.delete(w)),g}function rm(g){return _n(g)?t:g}function Km(g,w,$,ue,Le,gt){var ss=$&v,ks=g.length,Ws=w.length;if(ks!=Ws&&!(ss&&Ws>ks))return!1;var vo=gt.get(g),Co=gt.get(w);if(vo&&Co)return vo==w&&Co==g;var Jo=-1,Yr=!0,Dl=$&x?new Rm:t;for(gt.set(g,w),gt.set(w,g);++Jo<ks;){var Cc=g[Jo],Wu=w[Jo];if(ue)var Ic=ss?ue(Wu,Cc,Jo,w,g,gt):ue(Cc,Wu,Jo,g,w,gt);if(Ic!==t){if(Ic)continue;Yr=!1;break}if(Dl){if(!Xt(w,function(fd,Ad){if(!Mt(Dl,Ad)&&(Cc===fd||Le(Cc,fd,$,ue,gt)))return Dl.push(Ad)})){Yr=!1;break}}else if(!(Cc===Wu||Le(Cc,Wu,$,ue,gt))){Yr=!1;break}}return gt.delete(g),gt.delete(w),Yr}function Gv(g,w,$,ue,Le,gt,ss){switch($){case an:if(g.byteLength!=w.byteLength||g.byteOffset!=w.byteOffset)return!1;g=g.buffer,w=w.buffer;case Gs:return!(g.byteLength!=w.byteLength||!gt(new Ct(g),new Ct(w)));case Rt:case Ht:case it:return kr(+g,+w);case zt:return g.name==w.name&&g.message==w.message;case ft:case Se:return g==w+"";case Je:var ks=mo;case ke:var Ws=ue&v;if(ks||(ks=lc),g.size!=w.size&&!Ws)return!1;var vo=ss.get(g);if(vo)return vo==w;ue|=x,ss.set(g,w);var Co=Km(ks(g),ks(w),ue,Le,gt,ss);return ss.delete(g),Co;case Et:if(bh)return bh.call(g)==bh.call(w)}return!1}function Xm(g,w,$,ue,Le,gt){var ss=$&v,ks=Wi(g),Ws=ks.length,vo=Wi(w),Co=vo.length;if(Ws!=Co&&!ss)return!1;for(var Jo=Ws;Jo--;){var Yr=ks[Jo];if(!(ss?Yr in w:jc.call(w,Yr)))return!1}var Dl=gt.get(g),Cc=gt.get(w);if(Dl&&Cc)return Dl==w&&Cc==g;var Wu=!0;gt.set(g,w),gt.set(w,g);for(var Ic=ss;++Jo<Ws;){Yr=ks[Jo];var fd=g[Yr],Ad=w[Yr];if(ue)var Xh=ss?ue(Ad,fd,Yr,w,g,gt):ue(fd,Ad,Yr,g,w,gt);if(!(Xh===t?fd===Ad||Le(fd,Ad,$,ue,gt):Xh)){Wu=!1;break}Ic||(Ic=Yr=="constructor")}if(Wu&&!Ic){var Mh=g.constructor,Zh=w.constructor;Mh!=Zh&&"constructor"in g&&"constructor"in w&&!(typeof Mh=="function"&&Mh instanceof Mh&&typeof Zh=="function"&&Zh instanceof Zh)&&(Wu=!1)}return gt.delete(g),gt.delete(w),Wu}function up(g){return Av(Cd(g,t,_g),g+"")}function Wi(g){return Mc(g,Wf,ka)}function Nr(g){return Mc(g,qd,Xc)}var Kc=ld?function(g){return ld.get(g)}:ah;function Yu(g){for(var w=g.name+"",$=iu[w],ue=jc.call(iu,w)?$.length:0;ue--;){var Le=$[ue],gt=Le.func;if(gt==null||gt==g)return Le.name}return w}function Vd(g){var w=jc.call(Xe,"placeholder")?Xe:g;return w.placeholder}function Yi(){var g=Xe.iteratee||If;return g=g===If?fv:g,arguments.length?g(arguments[0],arguments[1]):g}function $t(g,w){var $=g.__data__;return dp(w)?$[typeof w=="string"?"string":"hash"]:$.map}function En(g){for(var w=Wf(g),$=w.length;$--;){var ue=w[$],Le=g[ue];w[$]=[ue,Le,ep(Le)]}return w}function Mo(g,w){var $=hi(g,w);return Eh($)?$:t}function No(g){var w=jc.call(g,Gn),$=g[Gn];try{g[Gn]=t;var ue=!0}catch{}var Le=of.call(g);return ue&&(w?g[Gn]=$:delete g[Gn]),Le}var ka=nu?function(g){return g==null?[]:(g=na(g),Ld(nu(g),function(w){return Sn.call(g,w)}))}:Hp,Xc=nu?function(g){for(var w=[];g;)Re(w,ka(g)),g=As(g);return w}:Hp,eo=Nc;(Mr&&eo(new Mr(new ArrayBuffer(1)))!=an||Or&&eo(new Or)!=Je||ou&&eo(ou.resolve())!=xt||md&&eo(new md)!=ke||Kf&&eo(new Kf)!=Ls)&&(eo=function(g){var w=Nc(g),$=w==Ge?g.constructor:t,ue=$?Jm($):"";if(ue)switch(ue){case Ed:return an;case Du:return Je;case kf:return xt;case $d:return ke;case Bf:return Ls}return w});function Ra(g,w,$){for(var ue=-1,Le=$.length;++ue<Le;){var gt=$[ue],ss=gt.size;switch(gt.type){case"drop":g+=ss;break;case"dropRight":w-=ss;break;case"take":w=fi(w,g+ss);break;case"takeRight":g=ti(g,w-ss);break}}return{start:g,end:w}}function Xa(g){var w=g.match(vu);return w?w[1].split(Qc):[]}function Vl(g,w,$){w=Fo(w,g);for(var ue=-1,Le=w.length,gt=!1;++ue<Le;){var ss=Ch(w[ue]);if(!(gt=g!=null&&$(g,ss)))break;g=g[ss]}return gt||++ue!=Le?gt:(Le=g==null?0:g.length,!!Le&&ct(Le)&&bc(ss,Le)&&(Ho(g)||cl(g)))}function Qf(g){var w=g.length,$=new g.constructor(w);return w&&typeof g[0]=="string"&&jc.call(g,"index")&&($.index=g.index,$.input=g.input),$}function Bp(g){return typeof g.constructor=="function"&&!Cf(g)?Dp(As(g)):{}}function Gp(g,w,$){var ue=g.constructor;switch(w){case Gs:return Pn(g);case Rt:case Ht:return new ue(+g);case an:return ii(g,$);case Es:case Ns:case Hs:case ns:case fs:case Mn:case po:case Tn:case Cn:return Xo(g,$);case Je:return new ue;case it:case Se:return new ue(g);case ft:return Dr(g);case ke:return new ue;case Et:return ni(g)}}function ao(g,w){var $=w.length;if(!$)return g;var ue=$-1;return w[ue]=($>1?"& ":"")+w[ue],w=w.join($>2?", ":" "),g.replace(Vc,`{
/* [wrapped with `+w+`] */
`)}function Ri(g){return Ho(g)||cl(g)||!!(_o&&g&&g[_o])}function bc(g,w){var $=typeof g;return w=w??xe,!!w&&($=="number"||$!="symbol"&&Td.test(g))&&g>-1&&g%1==0&&g<w}function Mu(g,w,$){if(!Ut($))return!1;var ue=typeof w;return(ue=="number"?Fr($)&&bc(w,$.length):ue=="string"&&w in $)?kr($[w],g):!1}function Sf(g,w){if(Ho(g))return!1;var $=typeof g;return $=="number"||$=="symbol"||$=="boolean"||g==null||Do(g)?!0:Gc.test(g)||!mu.test(g)||w!=null&&g in na(w)}function dp(g){var w=typeof g;return w=="string"||w=="number"||w=="symbol"||w=="boolean"?g!=="__proto__":g===null}function Op(g){var w=Yu(g),$=Xe[w];if(typeof $!="function"||!(w in sc.prototype))return!1;if(g===$)return!0;var ue=Kc($);return!!ue&&g===ue[0]}function gd(g){return!!sd&&sd in g}var Zc=Ir?as:Zp;function Cf(g){var w=g&&g.constructor,$=typeof w=="function"&&w.prototype||Rc;return g===$}function ep(g){return g===g&&!Ut(g)}function zp(g,w){return function($){return $==null?!1:$[g]===w&&(w!==t||g in na($))}}function Np(g){var w=ma(g,function(ue){return $.size===f&&$.clear(),ue}),$=w.cache;return w}function np(g,w){var $=g[1],ue=w[1],Le=$|ue,gt=Le<(S|C|E),ss=ue==E&&$==A||ue==E&&$==L&&g[7].length<=w[8]||ue==(E|L)&&w[7].length<=w[8]&&$==A;if(!(gt||ss))return g;ue&S&&(g[2]=w[2],Le|=$&S?0:I);var ks=w[3];if(ks){var Ws=g[3];g[3]=Ws?Ru(Ws,ks,w[4]):ks,g[4]=Ws?La(g[3],u):w[4]}return ks=w[5],ks&&(Ws=g[5],g[5]=Ws?rl(Ws,ks,w[6]):ks,g[6]=Ws?La(g[5],u):w[6]),ks=w[7],ks&&(g[7]=ks),ue&E&&(g[8]=g[8]==null?w[8]:fi(g[8],w[8])),g[9]==null&&(g[9]=w[9]),g[0]=w[0],g[1]=Le,g}function $h(g){var w=[];if(g!=null)for(var $ in na(g))w.push($);return w}function Ef(g){return of.call(g)}function Cd(g,w,$){return w=ti(w===t?g.length-1:w,0),function(){for(var ue=arguments,Le=-1,gt=ti(ue.length-w,0),ss=Fs(gt);++Le<gt;)ss[Le]=ue[w+Le];Le=-1;for(var ks=Fs(w+1);++Le<w;)ks[Le]=ue[Le];return ks[w]=$(ss),Ga(g,this,ks)}}function $f(g,w){return w.length<2?g:ur(g,zs(w,0,-1))}function uh(g,w){for(var $=g.length,ue=fi(w.length,$),Le=Vi(g);ue--;){var gt=w[ue];g[ue]=bc(gt,$)?Le[gt]:t}return g}function wm(g,w){if(!(w==="constructor"&&typeof g[w]=="function")&&w!="__proto__")return g[w]}var Nv=mg(js),Zm=cc||function(g,w){return gc.setTimeout(g,w)},Av=mg(qt);function hg(g,w,$){var ue=w+"";return Av(g,ao(ue,Vg(Xa(ue),$)))}function mg(g){var w=0,$=0;return function(){var ue=hn(),Le=ie-(ue-$);if($=ue,Le>0){if(++w>=de)return arguments[0]}else w=0;return g.apply(t,arguments)}}function jm(g,w){var $=-1,ue=g.length,Le=ue-1;for(w=w===t?ue:w;++$<w;){var gt=$s($,Le),ss=g[gt];g[gt]=g[$],g[$]=ss}return g.length=w,g}var Yv=Np(function(g){var w=[];return g.charCodeAt(0)===46&&w.push(""),g.replace(du,function($,ue,Le,gt){w.push(Le?gt.replace(yl,"$1"):ue||$)}),w});function Ch(g){if(typeof g=="string"||Do(g))return g;var w=g+"";return w=="0"&&1/g==-re?"-0":w}function Jm(g){if(g!=null){try{return tu.call(g)}catch{}try{return g+""}catch{}}return""}function Vg(g,w){return Sd(Oe,function($){var ue="_."+$[0];w&$[1]&&!Cu(g,ue)&&g.push(ue)}),g.sort()}function Wg(g){if(g instanceof sc)return g.clone();var w=new Sp(g.__wrapped__,g.__chain__);return w.__actions__=Vi(g.__actions__),w.__index__=g.__index__,w.__values__=g.__values__,w}function vg(g,w,$){($?Mu(g,w,$):w===t)?w=1:w=ti(Ji(w),0);var ue=g==null?0:g.length;if(!ue||w<1)return[];for(var Le=0,gt=0,ss=Fs(bu(ue/w));Le<ue;)ss[gt++]=zs(g,Le,Le+=w);return ss}function Tv(g){for(var w=-1,$=g==null?0:g.length,ue=0,Le=[];++w<$;){var gt=g[w];gt&&(Le[ue++]=gt)}return Le}function f0(){var g=arguments.length;if(!g)return[];for(var w=Fs(g-1),$=arguments[0],ue=g;ue--;)w[ue-1]=arguments[ue];return Re(Ho($)?Vi($):[$],zd(w,1))}var Hg=es(function(g,w){return Mi(g)?il(g,zd(w,1,Mi,!0)):[]}),qg=es(function(g,w){var $=Bu(w);return Mi($)&&($=t),Mi(g)?il(g,zd(w,1,Mi,!0),Yi($,2)):[]}),Ap=es(function(g,w){var $=Bu(w);return Mi($)&&($=t),Mi(g)?il(g,zd(w,1,Mi,!0),t,$):[]});function p0(g,w,$){var ue=g==null?0:g.length;return ue?(w=$||w===t?1:Ji(w),zs(g,w<0?0:w,ue)):[]}function h0(g,w,$){var ue=g==null?0:g.length;return ue?(w=$||w===t?1:Ji(w),w=ue-w,zs(g,0,w<0?0:w)):[]}function m0(g,w){return g&&g.length?Ss(g,Yi(w,3),!0,!0):[]}function Ug(g,w){return g&&g.length?Ss(g,Yi(w,3),!0):[]}function Kv(g,w,$,ue){var Le=g==null?0:g.length;return Le?($&&typeof $!="number"&&Mu(g,w,$)&&($=0,ue=Le),nc(g,w,$,ue)):[]}function gg(g,w,$){var ue=g==null?0:g.length;if(!ue)return-1;var Le=$==null?0:Ji($);return Le<0&&(Le=ti(ue+Le,0)),ce(g,Yi(w,3),Le)}function Xv(g,w,$){var ue=g==null?0:g.length;if(!ue)return-1;var Le=ue-1;return $!==t&&(Le=Ji($),Le=$<0?ti(ue+Le,0):fi(Le,ue-1)),ce(g,Yi(w,3),Le,!0)}function _g(g){var w=g==null?0:g.length;return w?zd(g,1):[]}function Zv(g){var w=g==null?0:g.length;return w?zd(g,re):[]}function yg(g,w){var $=g==null?0:g.length;return $?(w=w===t?1:Ji(w),zd(g,w)):[]}function bg(g){for(var w=-1,$=g==null?0:g.length,ue={};++w<$;){var Le=g[w];ue[Le[0]]=Le[1]}return ue}function J(g){return g&&g.length?g[0]:t}function ms(g,w,$){var ue=g==null?0:g.length;if(!ue)return-1;var Le=$==null?0:Ji($);return Le<0&&(Le=ti(ue+Le,0)),G(g,w,Le)}function Ci(g){var w=g==null?0:g.length;return w?zs(g,0,-1):[]}var xi=es(function(g){var w=ge(g,pr);return w.length&&w[0]===g[0]?Jf(w):[]}),ko=es(function(g){var w=Bu(g),$=ge(g,pr);return w===Bu($)?w=t:$.pop(),$.length&&$[0]===g[0]?Jf($,Yi(w,2)):[]}),cf=es(function(g){var w=Bu(g),$=ge(g,pr);return w=typeof w=="function"?w:t,w&&$.pop(),$.length&&$[0]===g[0]?Jf($,t,w):[]});function Ac(g,w){return g==null?"":wa.call(g,w)}function Bu(g){var w=g==null?0:g.length;return w?g[w-1]:t}function dh(g,w,$){var ue=g==null?0:g.length;if(!ue)return-1;var Le=ue;return $!==t&&(Le=Ji($),Le=Le<0?ti(ue+Le,0):fi(Le,ue-1)),w===w?mp(g,w,Le):ce(g,Qe,Le,!0)}function Vp(g,w){return g&&g.length?me(g,Ji(w)):t}var mv=es(Qm);function Qm(g,w){return g&&g.length&&w&&w.length?Wt(g,w):g}function km(g,w,$){return g&&g.length&&w&&w.length?Wt(g,w,Yi($,2)):g}function Yp(g,w,$){return g&&g.length&&w&&w.length?Wt(g,w,t,$):g}var rh=up(function(g,w){var $=g==null?0:g.length,ue=Zn(g,w);return Jt(g,ge(w,function(Le){return bc(Le,$)?+Le:Le}).sort(sr)),ue});function ui(g,w){var $=[];if(!(g&&g.length))return $;var ue=-1,Le=[],gt=g.length;for(w=Yi(w,3);++ue<gt;){var ss=g[ue];w(ss,ue,g)&&($.push(ss),Le.push(ue))}return Jt(g,Le),$}function _d(g){return g==null?g:Pr.call(g)}function ql(g,w,$){var ue=g==null?0:g.length;return ue?($&&typeof $!="number"&&Mu(g,w,$)?(w=0,$=ue):(w=w==null?0:Ji(w),$=$===t?ue:Ji($)),zs(g,w,$)):[]}function zn(g,w){return un(g,w)}function qn(g,w,$){return jn(g,w,Yi($,2))}function ua(g,w){var $=g==null?0:g.length;if($){var ue=un(g,w);if(ue<$&&kr(g[ue],w))return ue}return-1}function oa(g,w){return un(g,w,!0)}function So(g,w,$){return jn(g,w,Yi($,2),!0)}function dr(g,w){var $=g==null?0:g.length;if($){var ue=un(g,w,!0)-1;if(kr(g[ue],w))return ue}return-1}function Zl(g){return g&&g.length?ro(g):[]}function Aa(g,w){return g&&g.length?ro(g,Yi(w,2)):[]}function Za(g){var w=g==null?0:g.length;return w?zs(g,1,w):[]}function Va(g,w,$){return g&&g.length?(w=$||w===t?1:Ji(w),zs(g,0,w<0?0:w)):[]}function da(g,w,$){var ue=g==null?0:g.length;return ue?(w=$||w===t?1:Ji(w),w=ue-w,zs(g,w<0?0:w,ue)):[]}function k(g,w){return g&&g.length?Ss(g,Yi(w,3),!1,!0):[]}function N(g,w){return g&&g.length?Ss(g,Yi(w,3)):[]}var R=es(function(g){return Js(zd(g,1,Mi,!0))}),F=es(function(g){var w=Bu(g);return Mi(w)&&(w=t),Js(zd(g,1,Mi,!0),Yi(w,2))}),z=es(function(g){var w=Bu(g);return w=typeof w=="function"?w:t,Js(zd(g,1,Mi,!0),t,w)});function q(g){return g&&g.length?Js(g):[]}function he(g,w){return g&&g.length?Js(g,Yi(w,2)):[]}function Ee(g,w){return w=typeof w=="function"?w:t,g&&g.length?Js(g,t,w):[]}function lt(g){if(!(g&&g.length))return[];var w=0;return g=Ld(g,function($){if(Mi($))return w=ti($.length,w),!0}),ot(w,function($){return ge(g,dt($))})}function Qt(g,w){if(!(g&&g.length))return[];var $=lt(g);return w==null?$:ge($,function(ue){return Ga(w,t,ue)})}var en=es(function(g,w){return Mi(g)?il(g,w):[]}),Zs=es(function(g){return on(Ld(g,Mi))}),xs=es(function(g){var w=Bu(g);return Mi(w)&&(w=t),on(Ld(g,Mi),Yi(w,2))}),Un=es(function(g){var w=Bu(g);return w=typeof w=="function"?w:t,on(Ld(g,Mi),t,w)}),jo=es(lt);function Lc(g,w){return yo(g||[],w||[],Nt)}function Id(g,w){return yo(g||[],w||[],Nn)}var sf=es(function(g){var w=g.length,$=w>1?g[w-1]:t;return $=typeof $=="function"?(g.pop(),$):t,Qt(g,$)});function au(g){var w=Xe(g);return w.__chain__=!0,w}function Wd(g,w){return w(g),g}function ud(g,w){return w(g)}var Hd=up(function(g){var w=g.length,$=w?g[0]:0,ue=this.__wrapped__,Le=function(gt){return Zn(gt,g)};return w>1||this.__actions__.length||!(ue instanceof sc)||!bc($)?this.thru(Le):(ue=ue.slice($,+$+(w?1:0)),ue.__actions__.push({func:ud,args:[Le],thisArg:t}),new Sp(ue,this.__chain__).thru(function(gt){return w&&!gt.length&&gt.push(t),gt}))});function dd(){return au(this)}function Rd(){return new Sp(this.value(),this.__chain__)}function Ou(){this.__values__===t&&(this.__values__=Ba(this.value()));var g=this.__index__>=this.__values__.length,w=g?t:this.__values__[this.__index__++];return{done:g,value:w}}function Pd(){return this}function Rr(g){for(var w,$=this;$ instanceof nm;){var ue=Wg($);ue.__index__=0,ue.__values__=t,w?Le.__wrapped__=ue:w=ue;var Le=ue;$=$.__wrapped__}return Le.__wrapped__=g,w}function Ul(){var g=this.__wrapped__;if(g instanceof sc){var w=g;return this.__actions__.length&&(w=new sc(this)),w=w.reverse(),w.__actions__.push({func:ud,args:[_d],thisArg:t}),new Sp(w,this.__chain__)}return this.thru(_d)}function Wa(){return ln(this.__wrapped__,this.__actions__)}var Wo=gf(function(g,w,$){jc.call(g,$)?++g[$]:ho(g,$,1)});function ji(g,w,$){var ue=Ho(g)?ac:ru;return $&&Mu(g,w,$)&&(w=t),ue(g,Yi(w,3))}function Jl(g,w){var $=Ho(g)?Ld:af;return $(g,Yi(w,3))}var zr=ih(gg),dc=ih(Xv);function Jc(g,w){return zd(cu(g,w),1)}function Vr(g,w){return zd(cu(g,w),re)}function ml(g,w,$){return $=$===t?1:Ji($),zd(cu(g,w),$)}function Bc(g,w){var $=Ho(g)?Sd:Ya;return $(g,Yi(w,3))}function Ja(g,w){var $=Ho(g)?wp:Kl;return $(g,Yi(w,3))}var xc=gf(function(g,w,$){jc.call(g,$)?g[$].push(w):ho(g,$,[w])});function lu(g,w,$,ue){g=Fr(g)?g:gv(g),$=$&&!ue?Ji($):0;var Le=g.length;return $<0&&($=ti(Le+$,0)),wi(g)?$<=Le&&g.indexOf(w,$)>-1:!!Le&&G(g,w,$)>-1}var fa=es(function(g,w,$){var ue=-1,Le=typeof w=="function",gt=Fr(g)?Fs(g.length):[];return Ya(g,function(ss){gt[++ue]=Le?Ga(w,ss,$):sh(ss,w,$)}),gt}),fc=gf(function(g,w,$){ho(g,$,w)});function cu(g,w){var $=Ho(g)?ge:ym;return $(g,Yi(w,3))}function Sa(g,w,$,ue){return g==null?[]:(Ho(w)||(w=w==null?[]:[w]),$=ue?t:$,Ho($)||($=$==null?[]:[$]),ae(g,w,$))}var vl=gf(function(g,w,$){g[$?0:1].push(w)},function(){return[[],[]]});function pc(g,w,$){var ue=Ho(g)?vt:B,Le=arguments.length<3;return ue(g,Yi(w,4),$,Le,Ya)}function ya(g,w,$){var ue=Ho(g)?Bt:B,Le=arguments.length<3;return ue(g,Yi(w,4),$,Le,Kl)}function Ur(g,w){var $=Ho(g)?Ld:af;return $(g,jr(Yi(w,3)))}function Wl(g){var w=Ho(g)?oe:rn;return w(g)}function pa(g,w,$){($?Mu(g,w,$):w===t)?w=1:w=Ji(w);var ue=Ho(g)?$e:pn;return ue(g,w)}function Bi(g){var w=Ho(g)?at:Os;return w(g)}function wc(g){if(g==null)return 0;if(Fr(g))return wi(g)?_c(g):g.length;var w=eo(g);return w==Je||w==ke?g.size:Gh(g).length}function nr(g,w,$){var ue=Ho(g)?Xt:mn;return $&&Mu(g,w,$)&&(w=t),ue(g,Yi(w,3))}var Ca=es(function(g,w){if(g==null)return[];var $=w.length;return $>1&&Mu(g,w[0],w[1])?w=[]:$>2&&Mu(w[0],w[1],w[2])&&(w=[w[0]]),ae(g,zd(w,1),[])}),Cl=Si||function(){return gc.Date.now()};function Qa(g,w){if(typeof w!="function")throw new za(a);return g=Ji(g),function(){if(--g<1)return w.apply(this,arguments)}}function el(g,w,$){return w=$?t:w,w=g&&w==null?g.length:w,Sh(g,E,t,t,t,t,w)}function Zi(g,w){var $;if(typeof w!="function")throw new za(a);return g=Ji(g),function(){return--g>0&&($=w.apply(this,arguments)),g<=1&&(w=t),$}}var Ki=es(function(g,w,$){var ue=S;if($.length){var Le=La($,Vd(Ki));ue|=T}return Sh(g,ue,w,$,Le)}),Ii=es(function(g,w,$){var ue=S|C;if($.length){var Le=La($,Vd(Ii));ue|=T}return Sh(w,ue,g,$,Le)});function Zo(g,w,$){w=$?t:w;var ue=Sh(g,A,t,t,t,t,t,w);return ue.placeholder=Zo.placeholder,ue}function ha(g,w,$){w=$?t:w;var ue=Sh(g,P,t,t,t,t,t,w);return ue.placeholder=ha.placeholder,ue}function al(g,w,$){var ue,Le,gt,ss,ks,Ws,vo=0,Co=!1,Jo=!1,Yr=!0;if(typeof g!="function")throw new za(a);w=Pa(w)||0,Ut($)&&(Co=!!$.leading,Jo="maxWait"in $,gt=Jo?ti(Pa($.maxWait)||0,w):gt,Yr="trailing"in $?!!$.trailing:Yr);function Dl(Ip){var Fm=ue,Rv=Le;return ue=Le=t,vo=Ip,ss=g.apply(Rv,Fm),ss}function Cc(Ip){return vo=Ip,ks=Zm(fd,w),Co?Dl(Ip):ss}function Wu(Ip){var Fm=Ip-Ws,Rv=Ip-vo,q_=w-Fm;return Jo?fi(q_,gt-Rv):q_}function Ic(Ip){var Fm=Ip-Ws,Rv=Ip-vo;return Ws===t||Fm>=w||Fm<0||Jo&&Rv>=gt}function fd(){var Ip=Cl();if(Ic(Ip))return Ad(Ip);ks=Zm(fd,Wu(Ip))}function Ad(Ip){return ks=t,Yr&&ue?Dl(Ip):(ue=Le=t,ss)}function Xh(){ks!==t&&Fi(ks),vo=0,ue=Ws=Le=ks=t}function Mh(){return ks===t?ss:Ad(Cl())}function Zh(){var Ip=Cl(),Fm=Ic(Ip);if(ue=arguments,Le=this,Ws=Ip,Fm){if(ks===t)return Cc(Ws);if(Jo)return Fi(ks),ks=Zm(fd,w),Dl(Ws)}return ks===t&&(ks=Zm(fd,w)),ss}return Zh.cancel=Xh,Zh.flush=Mh,Zh}var Pi=es(function(g,w){return Fl(g,1,w)}),Ar=es(function(g,w,$){return Fl(g,Pa(w)||0,$)});function ia(g){return Sh(g,D)}function ma(g,w){if(typeof g!="function"||w!=null&&typeof w!="function")throw new za(a);var $=function(){var ue=arguments,Le=w?w.apply(this,ue):ue[0],gt=$.cache;if(gt.has(Le))return gt.get(Le);var ss=g.apply(this,ue);return $.cache=gt.set(Le,ss)||gt,ss};return $.cache=new(ma.Cache||om),$}ma.Cache=om;function jr(g){if(typeof g!="function")throw new za(a);return function(){var w=arguments;switch(w.length){case 0:return!g.call(this);case 1:return!g.call(this,w[0]);case 2:return!g.call(this,w[0],w[1]);case 3:return!g.call(this,w[0],w[1],w[2])}return!g.apply(this,w)}}function Ha(g){return Zi(2,g)}var ll=Dn(function(g,w){w=w.length==1&&Ho(w[0])?ge(w[0],Be(Yi())):ge(zd(w,1),Be(Yi()));var $=w.length;return es(function(ue){for(var Le=-1,gt=fi(ue.length,$);++Le<gt;)ue[Le]=w[Le].call(this,ue[Le]);return Ga(g,this,ue)})}),li=es(function(g,w){var $=La(w,Vd(li));return Sh(g,T,t,w,$)}),wr=es(function(g,w){var $=La(w,Vd(wr));return Sh(g,j,t,w,$)}),Qr=up(function(g,w){return Sh(g,L,t,t,t,w)});function ea(g,w){if(typeof g!="function")throw new za(a);return w=w===t?w:Ji(w),es(g,w)}function ja(g,w){if(typeof g!="function")throw new za(a);return w=w==null?0:ti(Ji(w),0),es(function($){var ue=$[w],Le=Yo($,0,w);return ue&&Re(Le,ue),Ga(g,this,Le)})}function Ia(g,w,$){var ue=!0,Le=!0;if(typeof g!="function")throw new za(a);return Ut($)&&(ue="leading"in $?!!$.leading:ue,Le="trailing"in $?!!$.trailing:Le),al(g,w,{leading:ue,maxWait:w,trailing:Le})}function Li(g){return el(g,1)}function Tr(g,w){return li(dn(w),g)}function Il(){if(!arguments.length)return[];var g=arguments[0];return Ho(g)?g:[g]}function va(g){return mi(g,p)}function gr(g,w){return w=typeof w=="function"?w:t,mi(g,p,w)}function zo(g){return mi(g,d|p)}function oi(g,w){return w=typeof w=="function"?w:t,mi(g,d|p,w)}function Lr(g,w){return w==null||kl(g,w,Wf(w))}function kr(g,w){return g===w||g!==g&&w!==w}var or=Up(Vf),Hi=Up(function(g,w){return g>=w}),cl=gm(function(){return arguments}())?gm:function(g){return hs(g)&&jc.call(g,"callee")&&!Sn.call(g,"callee")},Ho=Fs.isArray,qa=ad?Be(ad):_m;function Fr(g){return g!=null&&ct(g.length)&&!as(g)}function Mi(g){return hs(g)&&Fr(g)}function Ll(g){return g===!0||g===!1||hs(g)&&Nc(g)==Rt}var K=$r||Zp,ht=Af?Be(Af):wh;function qe(g){return hs(g)&&g.nodeType===1&&!_n(g)}function Vt(g){if(g==null)return!0;if(Fr(g)&&(Ho(g)||typeof g=="string"||typeof g.splice=="function"||K(g)||ir(g)||cl(g)))return!g.length;var w=eo(g);if(w==Je||w==ke)return!g.size;if(Cf(g))return!Gh(g).length;for(var $ in g)if(jc.call(g,$))return!1;return!0}function Ye(g,w){return Uh(g,w)}function Ps(g,w,$){$=typeof $=="function"?$:t;var ue=$?$(g,w):t;return ue===t?Uh(g,w,t,$):!!ue}function vs(g){if(!hs(g))return!1;var w=Nc(g);return w==zt||w==Ft||typeof g.message=="string"&&typeof g.name=="string"&&!_n(g)}function ps(g){return typeof g=="number"&&$a(g)}function as(g){if(!Ut(g))return!1;var w=Nc(g);return w==ut||w==nt||w==pt||w==jt}function Zt(g){return typeof g=="number"&&g==Ji(g)}function ct(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=xe}function Ut(g){var w=typeof g;return g!=null&&(w=="object"||w=="function")}function hs(g){return g!=null&&typeof g=="object"}var Is=fu?Be(fu):Ym;function cs(g,w){return g===w||Rp(g,w,En(w))}function Ms(g,w,$){return $=typeof $=="function"?$:t,Rp(g,w,En(w),$)}function us(g){return Lo(g)&&g!=+g}function ds(g){if(Zc(g))throw new cr(r);return Eh(g)}function os(g){return g===null}function In(g){return g==null}function Lo(g){return typeof g=="number"||hs(g)&&Nc(g)==it}function _n(g){if(!hs(g)||Nc(g)!=Ge)return!1;var w=As(g);if(w===null)return!0;var $=jc.call(w,"constructor")&&w.constructor;return typeof $=="function"&&$ instanceof $&&tu.call($)==Iu}var sn=$u?Be($u):Am;function Ao(g){return Zt(g)&&g>=-xe&&g<=xe}var Qo=yu?Be(yu):im;function wi(g){return typeof g=="string"||!Ho(g)&&hs(g)&&Nc(g)==Se}function Do(g){return typeof g=="symbol"||hs(g)&&Nc(g)==Et}var ir=Yf?Be(Yf):nh;function Io(g){return g===t}function Bn(g){return hs(g)&&eo(g)==Ls}function gi(g){return hs(g)&&Nc(g)==tn}var wo=Up(vf),Ei=Up(function(g,w){return g<=w});function Ba(g){if(!g)return[];if(Fr(g))return wi(g)?Ea(g):Vi(g);if(si&&g[si])return vn(g[si]());var w=eo(g),$=w==Je?mo:w==ke?lc:gv;return $(g)}function Ta(g){if(!g)return g===0?g:0;if(g=Pa(g),g===re||g===-re){var w=g<0?-1:1;return w*se}return g===g?g:0}function Ji(g){var w=Ta(g),$=w%1;return w===w?$?w-$:w:0}function Nu(g){return g?Go(Ji(g),0,Te):0}function Pa(g){if(typeof g=="number")return g;if(Do(g))return Ne;if(Ut(g)){var w=typeof g.valueOf=="function"?g.valueOf():g;g=Ut(w)?w+"":w}if(typeof g!="string")return g===0?g:+g;g=St(g);var $=la.test(g);return $||qu.test(g)?Gf(g.slice(2),$?2:8):qi.test(g)?Ne:+g}function zu(g){return Xl(g,qd(g))}function Md(g){return g?Go(Ji(g),-xe,xe):g===0?g:0}function ta(g){return g==null?"":qs(g)}var uf=ju(function(g,w){if(Cf(w)||Fr(w)){Xl(w,Wf(w),g);return}for(var $ in w)jc.call(w,$)&&Nt(g,$,w[$])}),Ku=ju(function(g,w){Xl(w,qd(w),g)}),pu=ju(function(g,w,$,ue){Xl(w,qd(w),g,ue)}),kc=ju(function(g,w,$,ue){Xl(w,Wf(w),g,ue)}),Xu=up(Zn);function Nd(g,w){var $=Dp(g);return w==null?$:Xs($,w)}var Wr=es(function(g,w){g=na(g);var $=-1,ue=w.length,Le=ue>2?w[2]:t;for(Le&&Mu(w[0],w[1],Le)&&(ue=1);++$<ue;)for(var gt=w[$],ss=qd(gt),ks=-1,Ws=ss.length;++ks<Ws;){var vo=ss[ks],Co=g[vo];(Co===t||kr(Co,Rc[vo])&&!jc.call(g,vo))&&(g[vo]=gt[vo])}return g}),Au=es(function(g){return g.push(t,hv),Ga(od,t,g)});function Tp(g,w){return U(g,Yi(w,3),Hn)}function yp(g,w){return U(g,Yi(w,3),Oo)}function Kp(g,w){return g==null?g:lf(g,Yi(w,3),qd)}function bp(g,w){return g==null?g:ef(g,Yi(w,3),qd)}function fh(g,w){return g&&Hn(g,Yi(w,3))}function oc(g,w){return g&&Oo(g,Yi(w,3))}function _f(g){return g==null?[]:pi(g,Wf(g))}function Bm(g){return g==null?[]:pi(g,qd(g))}function df(g,w,$){var ue=g==null?t:ur(g,w);return ue===t?$:ue}function op(g,w){return g!=null&&Vl(g,w,xu)}function ph(g,w){return g!=null&&Vl(g,w,nd)}var Ih=Pv(function(g,w,$){w!=null&&typeof w.toString!="function"&&(w=of.call(w)),g[w]=$},Fu(Ql)),am=Pv(function(g,w,$){w!=null&&typeof w.toString!="function"&&(w=of.call(w)),jc.call(g,w)?g[w].push($):g[w]=[$]},Yi),vv=es(sh);function Wf(g){return Fr(g)?ee(g):Gh(g)}function qd(g){return Fr(g)?ee(g,!0):Cp(g)}function lm(g,w){var $={};return w=Yi(w,3),Hn(g,function(ue,Le,gt){ho($,w(ue,Le,gt),ue)}),$}function Fv(g,w){var $={};return w=Yi(w,3),Hn(g,function(ue,Le,gt){ho($,Le,w(ue,Le,gt))}),$}var Ud=ju(function(g,w,$){V(g,w,$)}),od=ju(function(g,w,$,ue){V(g,w,$,ue)}),xg=up(function(g,w){var $={};if(g==null)return $;var ue=!1;w=ge(w,function(gt){return gt=Fo(gt,g),ue||(ue=gt.length>1),gt}),Xl(g,Nr(g),$),ue&&($=mi($,d|h|p,rm));for(var Le=w.length;Le--;)is($,w[Le]);return $});function Jv(g,w){return Lv(g,jr(Yi(w)))}var Om=up(function(g,w){return g==null?{}:We(g,w)});function Lv(g,w){if(g==null)return{};var $=ge(Nr(g),function(ue){return[ue]});return w=Yi(w),He(g,$,function(ue,Le){return w(ue,Le[0])})}function Ev(g,w,$){w=Fo(w,g);var ue=-1,Le=w.length;for(Le||(Le=1,g=t);++ue<Le;){var gt=g==null?t:g[Ch(w[ue])];gt===t&&(ue=Le,gt=$),g=as(gt)?gt.call(g):gt}return g}function Fp(g,w,$){return g==null?g:Nn(g,w,$)}function z0(g,w,$,ue){return ue=typeof ue=="function"?ue:t,g==null?g:Nn(g,w,$,ue)}var Gg=pv(Wf),Yg=pv(qd);function v0(g,w,$){var ue=Ho(g),Le=ue||K(g)||ir(g);if(w=Yi(w,4),$==null){var gt=g&&g.constructor;Le?$=ue?new gt:[]:Ut(g)?$=as(gt)?Dp(As(g)):{}:$={}}return(Le?Sd:Hn)(g,function(ss,ks,Ws){return w($,ss,ks,Ws)}),$}function Kg(g,w){return g==null?!0:is(g,w)}function g0(g,w,$){return g==null?g:ts(g,w,dn($))}function wg(g,w,$,ue){return ue=typeof ue=="function"?ue:t,g==null?g:ts(g,w,dn($),ue)}function gv(g){return g==null?[]:je(g,Wf(g))}function V0(g){return g==null?[]:je(g,qd(g))}function W0(g,w,$){return $===t&&($=w,w=t),$!==t&&($=Pa($),$=$===$?$:0),w!==t&&(w=Pa(w),w=w===w?w:0),Go(Pa(g),w,$)}function _0(g,w,$){return w=Ta(w),$===t?($=w,w=0):$=Ta($),g=Pa(g),Dd(g,w,$)}function v_(g,w,$){if($&&typeof $!="boolean"&&Mu(g,w,$)&&(w=$=t),$===t&&(typeof w=="boolean"?($=w,w=t):typeof g=="boolean"&&($=g,g=t)),g===t&&w===t?(g=0,w=1):(g=Ta(g),w===t?(w=g,g=0):w=Ta(w)),g>w){var ue=g;g=w,w=ue}if($||g%1||w%1){var Le=tr();return fi(g+Le*(w-g+sp("1e-"+((Le+"").length-1))),w)}return $s(g,w)}var H0=oh(function(g,w,$){return w=w.toLowerCase(),g+($?Xg(w):w)});function Xg(g){return On(ta(g).toLowerCase())}function y0(g){return g=ta(g),g&&g.replace(ki,Qn).replace(eu,"")}function g_(g,w,$){g=ta(g),w=qs(w);var ue=g.length;$=$===t?ue:Go(Ji($),0,ue);var Le=$;return $-=w.length,$>=0&&g.slice($,Le)==w}function b0(g){return g=ta(g),g&&tl.test(g)?g.replace(Rl,wn):g}function x0(g){return g=ta(g),g&&rd.test(g)?g.replace(Ju,"\\$&"):g}var q0=oh(function(g,w,$){return g+($?"-":"")+w.toLowerCase()}),w0=oh(function(g,w,$){return g+($?" ":"")+w.toLowerCase()}),rt=kh("toLowerCase");function Ae(g,w,$){g=ta(g),w=Ji(w);var ue=w?_c(g):0;if(!w||ue>=w)return g;var Le=(w-ue)/2;return vr($l(Le),$)+g+vr(bu(Le),$)}function _t(g,w,$){g=ta(g),w=Ji(w);var ue=w?_c(g):0;return w&&ue<w?g+vr(w-ue,$):g}function bt(g,w,$){g=ta(g),w=Ji(w);var ue=w?_c(g):0;return w&&ue<w?vr(w-ue,$)+g:g}function Tt(g,w,$){return $||w==null?w=0:w&&(w=+w),uo(ta(g).replace(Al,""),w||0)}function It(g,w,$){return($?Mu(g,w,$):w===t)?w=1:w=Ji(w),Us(ta(g),w)}function Yt(){var g=arguments,w=ta(g[0]);return g.length<3?w:w.replace(g[1],g[2])}var fn=oh(function(g,w,$){return g+($?"_":"")+w.toLowerCase()});function Ds(g,w,$){return $&&typeof $!="number"&&Mu(g,w,$)&&(w=$=t),$=$===t?Te:$>>>0,$?(g=ta(g),g&&(typeof w=="string"||w!=null&&!sn(w))&&(w=qs(w),!w&&Ln(g))?Yo(Ea(g),0,$):g.split(w,$)):[]}var $n=oh(function(g,w,$){return g+($?" ":"")+On(w)});function Rs(g,w,$){return g=ta(g),$=$==null?0:Go(Ji($),0,g.length),w=qs(w),g.slice($,$+w.length)==w}function cn(g,w,$){var ue=Xe.templateSettings;$&&Mu(g,w,$)&&(w=t),g=ta(g),w=pu({},w,ue,Mv);var Le=pu({},w.imports,ue.imports,Mv),gt=Wf(Le),ss=je(Le,gt),ks,Ws,vo=0,Co=w.interpolate||sl,Jo="__p += '",Yr=Od((w.escape||sl).source+"|"+Co.source+"|"+(Co===Nl?Dc:sl).source+"|"+(w.evaluate||sl).source+"|$","g"),Dl="//# sourceURL="+(jc.call(w,"sourceURL")?(w.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Fd+"]")+`
`;g.replace(Yr,function(Ic,fd,Ad,Xh,Mh,Zh){return Ad||(Ad=Xh),Jo+=g.slice(vo,Zh).replace(br,xo),fd&&(ks=!0,Jo+=`' +
__e(`+fd+`) +
'`),Mh&&(Ws=!0,Jo+=`';
`+Mh+`;
__p += '`),Ad&&(Jo+=`' +
((__t = (`+Ad+`)) == null ? '' : __t) +
'`),vo=Zh+Ic.length,Ic}),Jo+=`';
`;var Cc=jc.call(w,"variable")&&w.variable;if(!Cc)Jo=`with (obj) {
`+Jo+`
}
`;else if(ec.test(Cc))throw new cr(l);Jo=(Ws?Jo.replace(go,""):Jo).replace(no,"$1").replace(Bo,"$1;"),Jo="function("+(Cc||"obj")+`) {
`+(Cc?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ks?", __e = _.escape":"")+(Ws?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Jo+`return __p
}`;var Wu=Ma(function(){return io(gt,Dl+"return "+Jo).apply(t,ss)});if(Wu.source=Jo,vs(Wu))throw Wu;return Wu}function Vn(g){return ta(g).toLowerCase()}function _i(g){return ta(g).toUpperCase()}function Gr(g,w,$){if(g=ta(g),g&&($||w===t))return St(g);if(!g||!(w=qs(w)))return g;var ue=Ea(g),Le=Ea(w),gt=Ze(ue,Le),ss=rs(ue,Le)+1;return Yo(ue,gt,ss).join("")}function An(g,w,$){if(g=ta(g),g&&($||w===t))return g.slice(0,Tf(g)+1);if(!g||!(w=qs(w)))return g;var ue=Ea(g),Le=rs(ue,Ea(w))+1;return Yo(ue,0,Le).join("")}function ra(g,w,$){if(g=ta(g),g&&($||w===t))return g.replace(Al,"");if(!g||!(w=qs(w)))return g;var ue=Ea(g),Le=Ze(ue,Ea(w));return Yo(ue,Le).join("")}function rr(g,w){var $=X,ue=ne;if(Ut(w)){var Le="separator"in w?w.separator:Le;$="length"in w?Ji(w.length):$,ue="omission"in w?qs(w.omission):ue}g=ta(g);var gt=g.length;if(Ln(g)){var ss=Ea(g);gt=ss.length}if($>=gt)return g;var ks=$-_c(ue);if(ks<1)return ue;var Ws=ss?Yo(ss,0,ks).join(""):g.slice(0,ks);if(Le===t)return Ws+ue;if(ss&&(ks+=Ws.length-ks),sn(Le)){if(g.slice(ks).search(Le)){var vo,Co=Ws;for(Le.global||(Le=Od(Le.source,ta(jl.exec(Le))+"g")),Le.lastIndex=0;vo=Le.exec(Co);)var Jo=vo.index;Ws=Ws.slice(0,Jo===t?ks:Jo)}}else if(g.indexOf(qs(Le),ks)!=ks){var Yr=Ws.lastIndexOf(Le);Yr>-1&&(Ws=Ws.slice(0,Yr))}return Ws+ue}function Hr(g){return g=ta(g),g&&aa.test(g)?g.replace(Vo,Sr):g}var ci=oh(function(g,w,$){return g+($?" ":"")+w.toUpperCase()}),On=kh("toUpperCase");function Po(g,w,$){return g=ta(g),w=$?t:w,w===t?pl(g)?mr(g):O(g):g.match(w)||[]}var Ma=es(function(g,w){try{return Ga(g,t,w)}catch($){return vs($)?$:new cr($)}}),ic=up(function(g,w){return Sd(w,function($){$=Ch($),ho(g,$,Ki(g[$],g))}),g});function wu(g){var w=g==null?0:g.length,$=Yi();return g=w?ge(g,function(ue){if(typeof ue[1]!="function")throw new za(a);return[$(ue[0]),ue[1]]}):[],es(function(ue){for(var Le=-1;++Le<w;){var gt=g[Le];if(Ga(gt[0],this,ue))return Ga(gt[1],this,ue)}})}function Tu(g){return $o(mi(g,d))}function Fu(g){return function(){return g}}function Gl(g,w){return g==null||g!==g?w:g}var Lu=bm(),Xi=bm(!0);function Ql(g){return g}function If(g){return fv(typeof g=="function"?g:mi(g,d))}function hu(g){return Tm(mi(g,d))}function gl(g,w){return M(g,mi(w,d))}var ff=es(function(g,w){return function($){return sh($,g,w)}}),_l=es(function(g,w){return function($){return sh(g,$,w)}});function Oc(g,w,$){var ue=Wf(w),Le=pi(w,ue);$==null&&!(Ut(w)&&(Le.length||!ue.length))&&($=w,w=g,g=this,Le=pi(w,Wf(w)));var gt=!(Ut($)&&"chain"in $)||!!$.chain,ss=as(g);return Sd(Le,function(ks){var Ws=w[ks];g[ks]=Ws,ss&&(g.prototype[ks]=function(){var vo=this.__chain__;if(gt||vo){var Co=g(this.__wrapped__),Jo=Co.__actions__=Vi(this.__actions__);return Jo.push({func:Ws,args:arguments,thisArg:g}),Co.__chain__=vo,Co}return Ws.apply(g,Re([this.value()],arguments))})}),g}function Df(){return gc._===this&&(gc._=Qd),this}function ah(){}function hh(g){return g=Ji(g),es(function(w){return me(w,g)})}var kg=uc(ge),_v=uc(ac),Ph=uc(Xt);function zm(g){return Sf(g)?dt(Ch(g)):At(g)}function Wp(g){return function(w){return g==null?t:ur(g,w)}}var Xp=Mp(),Hf=Mp(!0);function Hp(){return[]}function Zp(){return!1}function Qv(){return{}}function $v(){return""}function Dv(){return!0}function Kh(g,w){if(g=Ji(g),g<1||g>xe)return[];var $=Te,ue=fi(g,Te);w=Yi(w),g-=Te;for(var Le=ot(ue,w);++$<g;)w($);return Le}function Zu(g){return Ho(g)?ge(g,Ch):Do(g)?[g]:Vi(Yv(ta(g)))}function Vu(g){var w=++su;return ta(g)+w}var Tc=gp(function(g,w){return g+w},0),Of=_p("ceil"),Pf=gp(function(g,w){return g/w},1),mh=_p("floor");function Jp(g){return g&&g.length?vd(g,Ql,Vf):t}function U0(g,w){return g&&g.length?vd(g,Yi(w,2),Vf):t}function G0(g){return Ue(g,Ql)}function Sg(g,w){return Ue(g,Yi(w,2))}function Y0(g){return g&&g.length?vd(g,Ql,vf):t}function K0(g,w){return g&&g.length?vd(g,Yi(w,2),vf):t}var X0=gp(function(g,w){return g*w},1),Z0=_p("round"),Zg=gp(function(g,w){return g-w},0);function J0(g){return g&&g.length?Fe(g,Ql):0}function Q0(g,w){return g&&g.length?Fe(g,Yi(w,2)):0}return Xe.after=Qa,Xe.ary=el,Xe.assign=uf,Xe.assignIn=Ku,Xe.assignInWith=pu,Xe.assignWith=kc,Xe.at=Xu,Xe.before=Zi,Xe.bind=Ki,Xe.bindAll=ic,Xe.bindKey=Ii,Xe.castArray=Il,Xe.chain=au,Xe.chunk=vg,Xe.compact=Tv,Xe.concat=f0,Xe.cond=wu,Xe.conforms=Tu,Xe.constant=Fu,Xe.countBy=Wo,Xe.create=Nd,Xe.curry=Zo,Xe.curryRight=ha,Xe.debounce=al,Xe.defaults=Wr,Xe.defaultsDeep=Au,Xe.defer=Pi,Xe.delay=Ar,Xe.difference=Hg,Xe.differenceBy=qg,Xe.differenceWith=Ap,Xe.drop=p0,Xe.dropRight=h0,Xe.dropRightWhile=m0,Xe.dropWhile=Ug,Xe.fill=Kv,Xe.filter=Jl,Xe.flatMap=Jc,Xe.flatMapDeep=Vr,Xe.flatMapDepth=ml,Xe.flatten=_g,Xe.flattenDeep=Zv,Xe.flattenDepth=yg,Xe.flip=ia,Xe.flow=Lu,Xe.flowRight=Xi,Xe.fromPairs=bg,Xe.functions=_f,Xe.functionsIn=Bm,Xe.groupBy=xc,Xe.initial=Ci,Xe.intersection=xi,Xe.intersectionBy=ko,Xe.intersectionWith=cf,Xe.invert=Ih,Xe.invertBy=am,Xe.invokeMap=fa,Xe.iteratee=If,Xe.keyBy=fc,Xe.keys=Wf,Xe.keysIn=qd,Xe.map=cu,Xe.mapKeys=lm,Xe.mapValues=Fv,Xe.matches=hu,Xe.matchesProperty=gl,Xe.memoize=ma,Xe.merge=Ud,Xe.mergeWith=od,Xe.method=ff,Xe.methodOf=_l,Xe.mixin=Oc,Xe.negate=jr,Xe.nthArg=hh,Xe.omit=xg,Xe.omitBy=Jv,Xe.once=Ha,Xe.orderBy=Sa,Xe.over=kg,Xe.overArgs=ll,Xe.overEvery=_v,Xe.overSome=Ph,Xe.partial=li,Xe.partialRight=wr,Xe.partition=vl,Xe.pick=Om,Xe.pickBy=Lv,Xe.property=zm,Xe.propertyOf=Wp,Xe.pull=mv,Xe.pullAll=Qm,Xe.pullAllBy=km,Xe.pullAllWith=Yp,Xe.pullAt=rh,Xe.range=Xp,Xe.rangeRight=Hf,Xe.rearg=Qr,Xe.reject=Ur,Xe.remove=ui,Xe.rest=ea,Xe.reverse=_d,Xe.sampleSize=pa,Xe.set=Fp,Xe.setWith=z0,Xe.shuffle=Bi,Xe.slice=ql,Xe.sortBy=Ca,Xe.sortedUniq=Zl,Xe.sortedUniqBy=Aa,Xe.split=Ds,Xe.spread=ja,Xe.tail=Za,Xe.take=Va,Xe.takeRight=da,Xe.takeRightWhile=k,Xe.takeWhile=N,Xe.tap=Wd,Xe.throttle=Ia,Xe.thru=ud,Xe.toArray=Ba,Xe.toPairs=Gg,Xe.toPairsIn=Yg,Xe.toPath=Zu,Xe.toPlainObject=zu,Xe.transform=v0,Xe.unary=Li,Xe.union=R,Xe.unionBy=F,Xe.unionWith=z,Xe.uniq=q,Xe.uniqBy=he,Xe.uniqWith=Ee,Xe.unset=Kg,Xe.unzip=lt,Xe.unzipWith=Qt,Xe.update=g0,Xe.updateWith=wg,Xe.values=gv,Xe.valuesIn=V0,Xe.without=en,Xe.words=Po,Xe.wrap=Tr,Xe.xor=Zs,Xe.xorBy=xs,Xe.xorWith=Un,Xe.zip=jo,Xe.zipObject=Lc,Xe.zipObjectDeep=Id,Xe.zipWith=sf,Xe.entries=Gg,Xe.entriesIn=Yg,Xe.extend=Ku,Xe.extendWith=pu,Oc(Xe,Xe),Xe.add=Tc,Xe.attempt=Ma,Xe.camelCase=H0,Xe.capitalize=Xg,Xe.ceil=Of,Xe.clamp=W0,Xe.clone=va,Xe.cloneDeep=zo,Xe.cloneDeepWith=oi,Xe.cloneWith=gr,Xe.conformsTo=Lr,Xe.deburr=y0,Xe.defaultTo=Gl,Xe.divide=Pf,Xe.endsWith=g_,Xe.eq=kr,Xe.escape=b0,Xe.escapeRegExp=x0,Xe.every=ji,Xe.find=zr,Xe.findIndex=gg,Xe.findKey=Tp,Xe.findLast=dc,Xe.findLastIndex=Xv,Xe.findLastKey=yp,Xe.floor=mh,Xe.forEach=Bc,Xe.forEachRight=Ja,Xe.forIn=Kp,Xe.forInRight=bp,Xe.forOwn=fh,Xe.forOwnRight=oc,Xe.get=df,Xe.gt=or,Xe.gte=Hi,Xe.has=op,Xe.hasIn=ph,Xe.head=J,Xe.identity=Ql,Xe.includes=lu,Xe.indexOf=ms,Xe.inRange=_0,Xe.invoke=vv,Xe.isArguments=cl,Xe.isArray=Ho,Xe.isArrayBuffer=qa,Xe.isArrayLike=Fr,Xe.isArrayLikeObject=Mi,Xe.isBoolean=Ll,Xe.isBuffer=K,Xe.isDate=ht,Xe.isElement=qe,Xe.isEmpty=Vt,Xe.isEqual=Ye,Xe.isEqualWith=Ps,Xe.isError=vs,Xe.isFinite=ps,Xe.isFunction=as,Xe.isInteger=Zt,Xe.isLength=ct,Xe.isMap=Is,Xe.isMatch=cs,Xe.isMatchWith=Ms,Xe.isNaN=us,Xe.isNative=ds,Xe.isNil=In,Xe.isNull=os,Xe.isNumber=Lo,Xe.isObject=Ut,Xe.isObjectLike=hs,Xe.isPlainObject=_n,Xe.isRegExp=sn,Xe.isSafeInteger=Ao,Xe.isSet=Qo,Xe.isString=wi,Xe.isSymbol=Do,Xe.isTypedArray=ir,Xe.isUndefined=Io,Xe.isWeakMap=Bn,Xe.isWeakSet=gi,Xe.join=Ac,Xe.kebabCase=q0,Xe.last=Bu,Xe.lastIndexOf=dh,Xe.lowerCase=w0,Xe.lowerFirst=rt,Xe.lt=wo,Xe.lte=Ei,Xe.max=Jp,Xe.maxBy=U0,Xe.mean=G0,Xe.meanBy=Sg,Xe.min=Y0,Xe.minBy=K0,Xe.stubArray=Hp,Xe.stubFalse=Zp,Xe.stubObject=Qv,Xe.stubString=$v,Xe.stubTrue=Dv,Xe.multiply=X0,Xe.nth=Vp,Xe.noConflict=Df,Xe.noop=ah,Xe.now=Cl,Xe.pad=Ae,Xe.padEnd=_t,Xe.padStart=bt,Xe.parseInt=Tt,Xe.random=v_,Xe.reduce=pc,Xe.reduceRight=ya,Xe.repeat=It,Xe.replace=Yt,Xe.result=Ev,Xe.round=Z0,Xe.runInContext=ls,Xe.sample=Wl,Xe.size=wc,Xe.snakeCase=fn,Xe.some=nr,Xe.sortedIndex=zn,Xe.sortedIndexBy=qn,Xe.sortedIndexOf=ua,Xe.sortedLastIndex=oa,Xe.sortedLastIndexBy=So,Xe.sortedLastIndexOf=dr,Xe.startCase=$n,Xe.startsWith=Rs,Xe.subtract=Zg,Xe.sum=J0,Xe.sumBy=Q0,Xe.template=cn,Xe.times=Kh,Xe.toFinite=Ta,Xe.toInteger=Ji,Xe.toLength=Nu,Xe.toLower=Vn,Xe.toNumber=Pa,Xe.toSafeInteger=Md,Xe.toString=ta,Xe.toUpper=_i,Xe.trim=Gr,Xe.trimEnd=An,Xe.trimStart=ra,Xe.truncate=rr,Xe.unescape=Hr,Xe.uniqueId=Vu,Xe.upperCase=ci,Xe.upperFirst=On,Xe.each=Bc,Xe.eachRight=Ja,Xe.first=J,Oc(Xe,function(){var g={};return Hn(Xe,function(w,$){jc.call(Xe.prototype,$)||(g[$]=w)}),g}(),{chain:!1}),Xe.VERSION=n,Sd(["bind","bindKey","curry","curryRight","partial","partialRight"],function(g){Xe[g].placeholder=Xe}),Sd(["drop","take"],function(g,w){sc.prototype[g]=function($){$=$===t?1:ti(Ji($),0);var ue=this.__filtered__&&!w?new sc(this):this.clone();return ue.__filtered__?ue.__takeCount__=fi($,ue.__takeCount__):ue.__views__.push({size:fi($,Te),type:g+(ue.__dir__<0?"Right":"")}),ue},sc.prototype[g+"Right"]=function($){return this.reverse()[g]($).reverse()}}),Sd(["filter","map","takeWhile"],function(g,w){var $=w+1,ue=$==te||$==pe;sc.prototype[g]=function(Le){var gt=this.clone();return gt.__iteratees__.push({iteratee:Yi(Le,3),type:$}),gt.__filtered__=gt.__filtered__||ue,gt}}),Sd(["head","last"],function(g,w){var $="take"+(w?"Right":"");sc.prototype[g]=function(){return this[$](1).value()[0]}}),Sd(["initial","tail"],function(g,w){var $="drop"+(w?"":"Right");sc.prototype[g]=function(){return this.__filtered__?new sc(this):this[$](1)}}),sc.prototype.compact=function(){return this.filter(Ql)},sc.prototype.find=function(g){return this.filter(g).head()},sc.prototype.findLast=function(g){return this.reverse().find(g)},sc.prototype.invokeMap=es(function(g,w){return typeof g=="function"?new sc(this):this.map(function($){return sh($,g,w)})}),sc.prototype.reject=function(g){return this.filter(jr(Yi(g)))},sc.prototype.slice=function(g,w){g=Ji(g);var $=this;return $.__filtered__&&(g>0||w<0)?new sc($):(g<0?$=$.takeRight(-g):g&&($=$.drop(g)),w!==t&&(w=Ji(w),$=w<0?$.dropRight(-w):$.take(w-g)),$)},sc.prototype.takeRightWhile=function(g){return this.reverse().takeWhile(g).reverse()},sc.prototype.toArray=function(){return this.take(Te)},Hn(sc.prototype,function(g,w){var $=/^(?:filter|find|map|reject)|While$/.test(w),ue=/^(?:head|last)$/.test(w),Le=Xe[ue?"take"+(w=="last"?"Right":""):w],gt=ue||/^find/.test(w);Le&&(Xe.prototype[w]=function(){var ss=this.__wrapped__,ks=ue?[1]:arguments,Ws=ss instanceof sc,vo=ks[0],Co=Ws||Ho(ss),Jo=function(fd){var Ad=Le.apply(Xe,Re([fd],ks));return ue&&Yr?Ad[0]:Ad};Co&&$&&typeof vo=="function"&&vo.length!=1&&(Ws=Co=!1);var Yr=this.__chain__,Dl=!!this.__actions__.length,Cc=gt&&!Yr,Wu=Ws&&!Dl;if(!gt&&Co){ss=Wu?ss:new sc(this);var Ic=g.apply(ss,ks);return Ic.__actions__.push({func:ud,args:[Jo],thisArg:t}),new Sp(Ic,Yr)}return Cc&&Wu?g.apply(this,ks):(Ic=this.thru(Jo),Cc?ue?Ic.value()[0]:Ic.value():Ic)})}),Sd(["pop","push","shift","sort","splice","unshift"],function(g){var w=Yc[g],$=/^(?:push|sort|unshift)$/.test(g)?"tap":"thru",ue=/^(?:pop|shift)$/.test(g);Xe.prototype[g]=function(){var Le=arguments;if(ue&&!this.__chain__){var gt=this.value();return w.apply(Ho(gt)?gt:[],Le)}return this[$](function(ss){return w.apply(Ho(ss)?ss:[],Le)})}}),Hn(sc.prototype,function(g,w){var $=Xe[w];if($){var ue=$.name+"";jc.call(iu,ue)||(iu[ue]=[]),iu[ue].push({name:w,func:$})}}),iu[jp(t,C).name]=[{name:"wrapper",func:t}],sc.prototype.clone=Xf,sc.prototype.reverse=ch,sc.prototype.value=Vh,Xe.prototype.at=Hd,Xe.prototype.chain=dd,Xe.prototype.commit=Rd,Xe.prototype.next=Ou,Xe.prototype.plant=Rr,Xe.prototype.reverse=Ul,Xe.prototype.toJSON=Xe.prototype.valueOf=Xe.prototype.value=Wa,Xe.prototype.first=Xe.prototype.head,si&&(Xe.prototype[si]=Pd),Xe},hl=Cr();Nf?((Nf.exports=hl)._=hl,jf._=hl):gc._=hl}).call(o0)})(lb,lb.exports);var oR=lb.exports;const Ys=R1(oR),iR=["#b45309","#111827","#334155","#64748b","#16a34a","#2563eb","#7c3aed","#ef4444"],I1="smartchart.quickColors",Gx=30,h_=Th(iR);let Lk=!1;function $S(){if(typeof localStorage>"u")return I1;const s=localStorage.getItem("userId");return s?`${I1}.${s}`:I1}function rR(s){return Array.isArray(s)?s.filter(e=>typeof e=="string"&&e.trim().length>0).slice(0,Gx):[]}function t2(){if(typeof localStorage>"u")return;const s=$S();let e=localStorage.getItem(s);if(!e&&localStorage.getItem("userId")){const n=localStorage.getItem(I1);n&&(e=n,localStorage.setItem(s,n))}if(e)try{const t=JSON.parse(e);h_.set(rR(t))}catch{}}function DS(s){if(typeof localStorage>"u")return;const e=Array.isArray(s)?s:vh(h_);try{localStorage.setItem($S(),JSON.stringify(e))}catch{}}function aR(){Lk||typeof window>"u"||(Lk=!0,t2(),window.addEventListener("storage",s=>{if(s.key==="userId"){t2();return}s.key&&s.key.startsWith(I1)&&t2()}))}function lR(s){if(!s)return;const e=vh(h_);if(e.includes(s)||e.length>=Gx)return;const t=[...e,s];h_.set(t),DS(t)}function cR(s){if(!s)return;const e=vh(h_).filter(t=>t!==s);h_.set(e),DS(e)}function uR(s,e,t){const n=s.target;e(parseInt(n.value)),t("opacityChange",e())}function dR(s,e){s.stopPropagation(),b(e,!0)}function fR(s,e,t,n,o,r,a,l){if(/^#[0-9A-F]{6}$/i.test(i(e))){const c=t(i(e));b(n,c.h),b(o,c.s),b(r,c.l),a(i(e)),l("colorChange",i(e))}}function pR(s,e,t,n,o){i(e)&&/^#[0-9A-Fa-f]{6}$/.test(i(e))&&(t(i(e)),n("colorChange",i(e)),o(i(e)))}var hR=(s,e)=>{s.stopPropagation(),e()},mR=(s,e)=>e(!1),vR=(s,e,t)=>e(i(t)),gR=be("<button></button>"),_R=be('<div class="flex gap-[2px]"></div>'),yR=(s,e,t)=>e(i(t)),bR=(s,e,t)=>e(s,i(t)),xR=(s,e,t)=>e(s,i(t)),wR=be("<button></button>"),kR=be(`<button class="w-4 h-4 rounded-[2px] border border-dashed border-gray-300 dark:border-white/20 bg-white/60 dark:bg-white/5
                     flex items-center justify-center text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.25" d="M12 4v16m8-8H4"></path></svg></button>`),SR=s=>s.stopPropagation(),CR=(s,e,t)=>e(i(t).color),IR=be('<div class="absolute z-10"><button class="flex items-center gap-2 px-3 py-2 rounded-md bg-[#1E2329] text-white text-xs border border-white/10 shadow-lg"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-1 12a2 2 0 01-2 2H8a2 2 0 01-2-2L5 7m3 0h8m-6 0V5a1 1 0 011-1h2a1 1 0 011 1v2"></path></svg> <span>Remove color</span></button></div>'),PR=be('<div class="inline-flex flex-col items-stretch"><div class="flex items-center justify-between mb-3"><div class="flex items-center gap-2"><div class="w-7 h-7 rounded-md border border-gray-200/80 dark:border-white/10 shadow-inner"></div> <div class="leading-tight"><div class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Selected</div> <div class="text-sm font-semibold text-gray-900 dark:text-gray-100"> </div></div></div> <button class="px-3 py-1 rounded-md text-xs font-semibold bg-gray-900 text-white dark:bg-white dark:text-[#111827] hover:opacity-90 transition-opacity">Done</button></div> <div class="h-px bg-gray-200/80 dark:bg-white/10 mb-3"></div> <div class="mb-3 flex flex-col gap-[2px] border border-gray-300 dark:border-[#2E313A] bg-white dark:bg-[#111318] p-[2px] w-full"></div> <div class="mb-3"><div class="flex items-center justify-between mb-2"><span class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Quick</span> <span class="text-[10px] text-gray-400 dark:text-gray-500">Shortcuts</span></div> <div class="grid grid-cols-10 gap-[2px] p-[2px] border border-transparent"><!> <!></div></div> <div><div class="flex items-center justify-between mb-2"><span class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Opacity</span> <span class="text-xs font-semibold text-gray-900 dark:text-gray-100"> </span></div> <div class="relative"><div class="relative h-3 rounded-[2px] border border-gray-300 dark:border-[#2E313A] overflow-hidden" style="background-image: repeating-conic-gradient(#7a7a7a 0% 25%, #2b2b2b 0% 50%); background-size: 6px 6px; background-position: 0 0;"><div class="absolute inset-0"></div> <input type="range" min="0" max="100" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"></div> <div class="absolute top-1/2 w-3.5 h-3.5 bg-white dark:bg-[#1B1D23] border border-gray-300 dark:border-[#2E313A] rounded-full transform -translate-y-1/2 pointer-events-none"></div></div></div> <!></div>'),MR=(s,e)=>e(!1),NR=(s,e)=>b(e,!1),AR=be('<div class="mb-3 flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-7 h-7 rounded-md border border-gray-200/80 dark:border-white/10 shadow-inner"></div> <div class="leading-tight"><div class="text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400">Custom</div> <div class="text-sm font-semibold text-gray-900 dark:text-gray-100"> </div></div></div> <div class="flex items-center gap-2"><button class="px-3 py-1 rounded-md text-xs font-semibold bg-gray-900 text-white dark:bg-white dark:text-[#111827] hover:opacity-90 transition-opacity">Done</button> <button class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button></div></div> <div class="h-px bg-gray-200/80 dark:bg-white/10 mb-3"></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Hex</label> <input type="text" class="w-full px-3 py-2 bg-white/80 dark:bg-[#1A1A1A] border border-gray-200/80 dark:border-[#2E313A] rounded-lg text-gray-900 dark:text-white text-sm focus:border-gray-900/30 dark:focus:border-white/30 focus:outline-none" placeholder="#000000"></div> <div class="mb-3"><div class="w-full h-7 rounded-lg border border-gray-200/80 dark:border-[#2E313A] shadow-inner"></div></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Picker</label> <div class="relative w-full h-24 rounded-xl border border-gray-200/80 dark:border-[#2E313A] cursor-crosshair overflow-hidden"><div class="absolute w-3 h-3 border-2 border-white rounded-full transform -translate-x-1/2 -translate-y-1/2 pointer-events-none shadow-sm"></div></div></div> <div class="mb-3"><label class="block text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Hue</label> <div class="relative"><div class="relative h-3 rounded-full overflow-hidden border border-gray-200/80 dark:border-white/10"><div class="absolute inset-0" style="background: linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);"></div> <input type="range" min="0" max="360" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"></div> <div class="absolute top-1/2 w-4 h-4 bg-white dark:bg-[#1B1D23] border border-gray-300 dark:border-white/10 rounded-full transform -translate-y-1/2 pointer-events-none shadow-md"></div></div></div> <button class="w-full py-2 rounded-lg bg-gradient-to-r from-gray-900 to-gray-700 text-white text-sm font-semibold shadow-sm hover:opacity-95 transition-opacity">Add Color</button>',1),TR=be(`<div class="color-picker-container fixed z-[360000] bg-white dark:bg-[#1B1D23] border border-gray-200 dark:border-[#2E313A] rounded-lg shadow-[0_8px_20px_rgba(0,0,0,0.22)] p-4 transition-colors duration-150" style="
      left: 50%; 
      top: 50%; 
      transform: translate(-50%, -50%); 
      max-height: 90vh; 
      max-width: 90vw;
      overflow-y: auto;
    "><!></div>`);function sv(s,e){Yd(e,!1);const t=lh(),n=()=>Ml(h_,"$quickColors",t),o=fm();let r=bi(e,"selectedColor",12,"#1677FF"),a=bi(e,"show",12,!1),l=bi(e,"opacity",12,100),c=bd(),f=bd(),u=!1,d=bd(!1),h=bd({visible:!1,x:0,y:0,color:""}),p=null,v=bd(r()),x=bd(r()),S=bd("#000000"),C=bd(0),I=bd(100),A=bd(50);const P=te(),T=10,X=T*16+(T-1)*2+2*2+1*2;function ne(ut){r(ut),o("colorChange",ut),le()}function de(ut){lR(ut),b(d,!1)}function ie(ut,nt,Je){Je/=100;const it=nt*Math.min(Je,1-Je)/100,ze=Ge=>{const xt=(Ge+ut/30)%12,jt=Je-it*Math.max(Math.min(xt-3,9-xt,1),-1);return Math.round(255*jt).toString(16).padStart(2,"0")};return`#${ze(0)}${ze(8)}${ze(4)}`}function te(){const ut=["#ffffff","#e6e6e6","#cccccc","#b3b3b3","#999999","#808080","#666666","#4d4d4d","#333333","#000000"],nt=[0,15,30,45,60,120,180,210,240,300],Je=[50,88,78,68,58,42,28],it=90,ze=Je.map(Ge=>nt.map(xt=>ie(xt,it,Ge)));return[ut,...ze]}function le(){b(h,{visible:!1,x:0,y:0,color:""})}function pe(ut,nt,Je){let Ge=ut,xt=nt;if(i(c)){const{width:jt,height:ft}=i(c).getBoundingClientRect();Ge+140>jt&&(Ge=Math.max(8,jt-140-8)),xt+36>ft&&(xt=Math.max(8,ft-36-8))}b(h,{visible:!0,x:Ge,y:xt,color:Je})}function re(ut,nt){if(ut.preventDefault(),ut.stopPropagation(),!i(c))return;const Je=i(c).getBoundingClientRect();pe(ut.clientX-Je.left,ut.clientY-Je.top,nt)}function xe(ut){cR(ut),le()}function se(ut,nt){if(ut.pointerType==="mouse")return;p&&clearTimeout(p);const Je=ut.currentTarget;if(!Je||!i(c))return;const it=i(c).getBoundingClientRect(),ze=Je.getBoundingClientRect();p=setTimeout(()=>{const Ge=ze.right-it.left+8,xt=ze.top-it.top;pe(Ge,xt,nt)},450)}function Ne(){p&&(clearTimeout(p),p=null)}function Te(ut){const nt=(ut||"").trim();if(!nt)return null;if(/^#([0-9a-f]{6})$/i.test(nt))return{r:parseInt(nt.slice(1,3),16),g:parseInt(nt.slice(3,5),16),b:parseInt(nt.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(nt)){const it=nt[1],ze=nt[2],Ge=nt[3];return{r:parseInt(it+it,16),g:parseInt(ze+ze,16),b:parseInt(Ge+Ge,16)}}const Je=nt.match(/^rgba?\(([^)]+)\)$/i);if(Je){const it=Je[1].split(",").map(ze=>parseFloat(ze.trim()));if(it.length>=3&&it.every(ze=>!Number.isNaN(ze)))return{r:Math.round(it[0]),g:Math.round(it[1]),b:Math.round(it[2])}}return null}function Me(ut,nt){const Je=Te(ut);if(!Je)return null;const it=Math.max(0,Math.min(1,nt));return`rgba(${Je.r}, ${Je.g}, ${Je.b}, ${it})`}function De(ut){const nt=parseInt(ut.slice(1,3),16)/255,Je=parseInt(ut.slice(3,5),16)/255,it=parseInt(ut.slice(5,7),16)/255,ze=Math.max(nt,Je,it),Ge=Math.min(nt,Je,it);let xt=0,jt=0,ft=(ze+Ge)/2;if(ze!==Ge){const ke=ze-Ge;switch(jt=ft>.5?ke/(2-ze-Ge):ke/(ze+Ge),ze){case nt:xt=(Je-it)/ke+(Je<it?6:0);break;case Je:xt=(it-nt)/ke+2;break;case it:xt=(nt-Je)/ke+4;break}xt/=6}return{h:xt*360,s:jt*100,l:ft*100}}function Oe(){b(S,ie(i(C),i(I),i(A))),r(i(S)),o("colorChange",i(S))}function Ke(ut){u=!0,Rt(ut),document.addEventListener("mousemove",kt),document.addEventListener("mouseup",pt),ut.preventDefault()}function kt(ut){u&&i(f)&&Rt(ut)}function pt(){u=!1,document.removeEventListener("mousemove",kt),document.removeEventListener("mouseup",pt)}function Rt(ut){if(!i(f))return;const nt=i(f).getBoundingClientRect(),Je=Math.max(0,Math.min(1,(ut.clientX-nt.left)/nt.width)),it=Math.max(0,Math.min(1,(ut.clientY-nt.top)/nt.height));b(I,Je*100),b(A,(1-it)*100),Oe()}function Ht(ut){const nt=ut.target;i(c)&&!i(c).contains(nt)&&(a(!1),b(d,!1),o("close"))}sm(()=>{aR()}),Rg(()=>{typeof document<"u"&&document.removeEventListener("click",Ht,!0)}),_h(()=>(jh(r()),jh(l())),()=>{b(v,Me(r(),l()/100)||r())}),_h(()=>jh(r()),()=>{b(x,Me(r(),.6)||r())}),_h(()=>jh(a()),()=>{a()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("click",Ht,!0)},0)}),_h(()=>jh(a()),()=>{!a()&&typeof document<"u"&&document.removeEventListener("click",Ht,!0)}),c0(),$m();var Ft=Qs(),zt=_s(Ft);Ve(zt,a,ut=>{var nt=TR();nt.__click=[hR,le];var Je=y(nt);Ve(Je,()=>!i(d),it=>{var ze=PR();Dt(ze,"style",`width: ${X}px;`);var Ge=y(ze),xt=y(Ge),jt=y(xt),ft=m(jt,2),ke=m(y(ft),2),Se=y(ke,!0);_(ke),_(ft),_(xt);var Et=m(xt,2);Et.__click=[mR,a],_(Ge);var wt=m(Ge,4);qo(wt,5,()=>P,yi,(no,Bo)=>{var Vo=_R();qo(Vo,5,()=>i(Bo),yi,(Rl,aa)=>{var tl=gR();tl.__click=[vR,ne,aa],we(()=>{$i(tl,`w-4 h-4 rounded-[2px] focus:outline-none
                         ${(r()===i(aa)?"shadow-[inset_0_0_0_2px_rgba(0,0,0,0.65)] dark:shadow-[inset_0_0_0_2px_rgba(255,255,255,0.95)]":"")??""}`),Dt(tl,"style",`background-color: ${i(aa)??""};`)}),Y(Rl,tl)}),_(Vo),Y(no,Vo)}),_(wt);var Ls=m(wt,2),tn=m(y(Ls),2);Dt(tn,"style",`width: ${X}px;`);var Gs=y(tn);qo(Gs,1,n,yi,(no,Bo)=>{var Vo=wR();Vo.__click=[yR,ne,Bo],Vo.__contextmenu=[bR,re,Bo],Vo.__pointerdown=[xR,se,Bo],Vo.__pointerup=Ne,we(()=>{$i(Vo,`w-4 h-4 rounded-[2px] transition-colors focus:outline-none
                     ${(r()===i(Bo)?"shadow-[inset_0_0_0_2px_rgba(0,0,0,0.65)] dark:shadow-[inset_0_0_0_2px_rgba(255,255,255,0.95)]":"")??""}`),Dt(Vo,"style",`background-color: ${i(Bo)??""};`)}),pd("pointerleave",Vo,Ne),pd("pointercancel",Vo,Ne),Y(no,Vo)});var an=m(Gs,2);Ve(an,()=>n().length<Gx,no=>{var Bo=kR();Bo.__click=[dR,d],Y(no,Bo)}),_(tn),_(Ls);var Es=m(Ls,2),Ns=y(Es),Hs=m(y(Ns),2),ns=y(Hs);_(Hs),_(Ns);var fs=m(Ns,2),Mn=y(fs),po=y(Mn),Tn=m(po,2);Ts(Tn),Tn.__input=[uR,l,o],_(Mn);var Cn=m(Mn,2);_(fs),_(Es);var go=m(Es,2);Ve(go,()=>i(h).visible,no=>{var Bo=IR();Bo.__click=[SR];var Vo=y(Bo);Vo.__click=[CR,xe,h],_(Bo),we(()=>Dt(Bo,"style",`left: ${i(h).x??""}px; top: ${i(h).y??""}px;`)),Y(no,Bo)}),_(ze),we(()=>{Dt(jt,"style",`background-color: ${r()??""};`),st(Se,r()),st(ns,`${l()??""}%`),Dt(po,"style",`background: linear-gradient(to right, rgba(0,0,0,0), ${i(v)??""});`),Dt(Cn,"style",`left: calc(${l()??""}% - 7px); box-shadow: 0 0 0 1px rgba(0,0,0,0.25), 0 0 8px ${i(x)??""};`)}),Fn(Tn,l),Y(it,ze)},it=>{var ze=AR(),Ge=_s(ze),xt=y(Ge),jt=y(xt),ft=m(jt,2),ke=m(y(ft),2),Se=y(ke,!0);_(ke),_(ft),_(xt);var Et=m(xt,2),wt=y(Et);wt.__click=[MR,a];var Ls=m(wt,2);Ls.__click=[NR,d],_(Et),_(Ge);var tn=m(Ge,4),Gs=m(y(tn),2);Ts(Gs),Gs.__input=[fR,S,De,C,I,A,r,o],_(tn);var an=m(tn,2),Es=y(an);_(an);var Ns=m(an,2),Hs=m(y(Ns),2);Hs.__mousedown=Ke;var ns=y(Hs);_(Hs),hp(Hs,no=>b(f,no),()=>i(f)),_(Ns);var fs=m(Ns,2),Mn=m(y(fs),2),po=y(Mn),Tn=m(y(po),2);Ts(Tn),Tn.__input=Oe,_(po);var Cn=m(po,2);_(Mn),_(fs);var go=m(fs,2);go.__click=[pR,S,r,o,de],we(()=>{Dt(jt,"style",`background-color: ${i(S)??""};`),st(Se,i(S)),Dt(Es,"style",`background-color: ${i(S)??""};`),Dt(Hs,"style",`background: linear-gradient(to bottom, transparent, black), linear-gradient(to right, white, hsl(${i(C)??""}, 100%, 50%));`),Dt(ns,"style",`left: ${i(I)??""}%; top: ${100-i(A)}%;`),Dt(Cn,"style",`left: calc(${i(C)/360*100}% - 8px);`)}),Fn(Gs,()=>i(S),no=>b(S,no)),Fn(Tn,()=>i(C),no=>b(C,no)),Y(it,ze)}),_(nt),hp(nt,it=>b(c,it),()=>i(c)),we(()=>{yr(nt,"w-fit",!i(d)),yr(nt,"w-80",i(d))}),Y(ut,nt)}),Y(s,Ft),Kd()}$p(["click","contextmenu","pointerdown","pointerup","input","mousedown"]);const FR={data:null,loading:!1,error:null},jg=Th(FR);async function LR(s,e){const n=`${ER()}/auth/user/preference/${s}${e?"?isFree=true":""}`,o=await $R(n,{},8e3);if(!o.ok)throw o.status===404?new Error("User not found"):new Error(`Failed to fetch user preferences: ${o.statusText}`);return await o.json()}function ER(){var e,t;const s=(t=(e=import.meta)==null?void 0:e.env)==null?void 0:t.VITE_USER_PREFS_BASE_URL;return typeof s=="string"&&s.trim()?s.trim():"https://noti.dutyai.app"}async function $R(s,e={},t=8e3){const n=new AbortController,o=setTimeout(()=>n.abort(),t);try{return await fetch(s,{...e,signal:n.signal})}finally{clearTimeout(o)}}function DR(s){jg.set({data:s,loading:!1,error:null})}function RR(s){jg.update(e=>({...e,loading:s}))}function jR(s){jg.set({data:null,loading:!1,error:s})}async function BR(s,e){const t="https://noti.dutyai.app/auth/user/preference";try{const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clerkId:s,theme:e})});if(!n.ok)throw new Error(`Failed to save theme preference: ${n.statusText}`);console.log("✅ Theme preference saved successfully:",{clerkId:s,theme:e})}catch(n){console.error("❌ Failed to save theme preference:",n)}}const Ek=Th(null),ax=Th(null),OR=SI,py={},zR=[{tfsecs:604800,origin:345600,date:"1970-01-05"}];function VR(s){if(s=Math.abs(s),s>=1)return 0;let e=0;for(;s<1;)s=s*10,e+=1;return e}function wv(s){if(py[s])return py[s];const e=s.length-1,t=s.substring(e),n=s.substring(0,e),o=parseInt(n);let r="minute";if(t=="w")r="week";else if(t=="d")r="day";else if(t=="h")r="hour";else if(t=="m")r="minute";else if(t=="s")r="second";else throw new Error(`unsupport period: ${s}`);const a=fp(s);return py[s]={multiplier:o,timespan:r,timeframe:s,secs:a},py[s]}wv("1m"),wv("5m"),wv("15m"),wv("30m"),wv("1h"),wv("2h"),wv("4h"),wv("8h"),wv("12h"),wv("1d"),wv("3d"),wv("1w");function hy(s,e,t){return{id:s,position:OR.Middle,marginLeft:8,marginTop:2,marginRight:0,marginBottom:0,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,icon:e,fontFamily:"icomoon",size:14,color:t,activeColor:t,backgroundColor:"transparent",activeBackgroundColor:"rgba(22, 119, 255, 0.15)"}}function lp(s){let e=s==="dark"?"#929AA5":"#76808F",t=s==="dark"?"#555555":"#dddddd";const n=s==="dark"?"#111B2B":"#F3F3F3",o=s==="dark"?"#0A0F1A":"#ffffff",r=s==="dark"?"#b3b3b3":e,a=s==="dark"?"#FFFFFF":"#333333";try{if(typeof window<"u"){const p=document.querySelector(".menu-container")||document.documentElement,v=window.getComputedStyle(p),x=I=>(v.getPropertyValue(I)||"").trim(),S=x("--menu-text"),C=x("--menu-btn-border")||x("--menu-border");S&&(e=S),C&&(t=C)}}catch{}const l=typeof window<"u"&&window.innerWidth<=768,c=typeof window<"u"&&window.innerWidth<=480,f=c?10:l?11:12,u=c?10:l?11:12,d=c?2:l?3:4,h=c?2:l?3:4;return{pane:{backgroundColor:o},candle:{pane:{backgroundColor:o},type:CI.CandleSolid,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",upBorderColor:"#26A69A",downBorderColor:"#EF5350",noChangeBorderColor:"#888888",upWickColor:"#26A69A",downWickColor:"#EF5350",noChangeWickColor:"#888888"},priceMark:{last:{show:!0},high:{show:!0},low:{show:!0}},tooltip:{showRule:Lw.Always,text:{style:{fontSize:32,fontWeight:"bold",color:"#FFFFFF"}},title:{show:!0,size:18,family:"Helvetica Neue",weight:"normal",color:a,template:"{name} · {period} · {exchange} · {segment}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:e,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:({current:p})=>{const v="#32CD32",x="#FF0000",S=((p==null?void 0:p.close)??0)>((p==null?void 0:p.open)??0),C=((p==null?void 0:p.close)??0)<((p==null?void 0:p.open)??0),I=S?v:C?x:e,A=T=>({text:T,color:I});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:A("{open}")},{title:"H",value:A("{high}")},{title:"L",value:A("{low}")},{title:"C",value:A("{close}")},{title:"V",value:A("{volume}")}]:[{title:"O",value:A("{open}")},{title:"H",value:A("{high}")},{title:"L",value:A("{low}")},{title:"C",value:A("{close}")},{title:"V",value:A("{volume}")}]}}}},indicator:{lastValueMark:{show:!0},tooltip:{showRule:Lw.Always,icons:[hy("visible","",e),hy("invisible","",e),hy("setting","",e),hy("close","",e)]}},grid:{show:!0,horizontal:{show:!0,color:n,style:mt.Solid,size:1},vertical:{show:!0,color:n,style:mt.Solid,size:1}},xAxis:{show:!0,axisLine:{show:!0,color:t,size:5},ticduty:{show:!0,color:t},tickText:{show:!0,style:{fontSize:f,color:r,fontFamily:"Arial, sans-serif"},margin:d}},yAxis:{type:"normal",reverse:!1,show:!0,axisLine:{show:!0,color:t,size:4},ticduty:{show:!0,color:t},tickText:{show:!0,style:{fontSize:u,color:r,fontFamily:"Arial, sans-serif"},margin:h}},separator:{size:1,color:s==="dark"?"rgba(85, 85, 85, 0.3)":"rgba(221, 221, 221, 0.3)",fill:!0,activeBackgroundColor:s==="dark"?"rgba(85, 85, 85, 0.1)":"rgba(221, 221, 221, 0.1)"}}}const ip=R5(),cb={AO:[{title:"Short Period",precision:0,min:1,default:5},{title:"Long Period",precision:0,min:1,default:34},{title:"Increasing Color",type:"color",styleKey:"bars[0].upColor",default:"#26A69A"},{title:"Decreasing Color",type:"color",styleKey:"bars[0].downColor",default:"#EF5350"},{title:"Reverse Color",type:"color",styleKey:"bars[0].reverseColor",default:"#c4c4c4"}],BIAS:[{title:O2(),precision:0,min:1,default:6}],BOLL:[{title:O2(),precision:0,min:1,default:20},{title:j5(),precision:2,min:1,default:2}],BBI:[{title:ip+"1",precision:0,min:1,default:3},{title:ip+"2",precision:0,min:1,default:6},{title:ip+"3",precision:0,min:1,default:12},{title:ip+"4",precision:0,min:1,default:24}],CCI:[{title:ip+"1",precision:0,min:1,default:20}],CR:[{title:ip+"1",precision:0,min:1,default:26},{title:ip+"2",precision:0,min:1,default:10},{title:ip+"3",precision:0,min:1,default:20},{title:ip+"4",precision:0,min:1,default:40},{title:ip+"5",precision:0,min:1,default:60}],DMI:[{title:"DI Period",precision:0,min:1,default:14},{title:"ADX Period",precision:0,min:1,default:6}],EMV:[{title:ip+"1",precision:0,min:1,default:14},{title:ip+"2",precision:0,min:1,default:9}],EMA:[{title:"Period",precision:0,min:1,default:20},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],ICHIMOKU:[{title:"Tenkan Period",precision:0,min:1,default:9},{title:"Kijun Period",precision:0,min:1,default:26},{title:"Senkou B Period",precision:0,min:1,default:52}],MTM:[{title:ip+"1",precision:0,min:1,default:12},{title:ip+"2",precision:0,min:1,default:6}],MA:[{title:"MA1",precision:0,min:1,styleKey:"lines[0].color",default:5},{title:"MA2",precision:0,min:1,styleKey:"lines[1].color",default:10},{title:"MA3",precision:0,min:1,styleKey:"lines[2].color",default:30}],MACD:[{title:"Fast Period",precision:0,min:1,default:12},{title:"Slow Period",precision:0,min:1,default:26},{title:"Signal Period",precision:0,min:1,default:9}],OBV:[{title:ip+"1",precision:0,min:1,default:30},{title:ip+"2",precision:0,min:1,default:10}],PVT:[],PSY:[{title:ip+"1",precision:0,min:1,default:12},{title:ip+"2",precision:0,min:1,default:6}],ROC:[{title:ip+"1",precision:0,min:1,default:12},{title:ip+"2",precision:0,min:1,default:6}],RSI:[{title:"Period",precision:0,min:1,default:14},{title:"Overbought",precision:0,min:50,max:100,default:70},{title:"Middle",precision:0,min:30,max:70,default:50},{title:"Oversold",precision:0,min:0,max:50,default:30},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#FF6B35"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],SMA:[{title:ip+"1",precision:0,min:1,default:12},{title:ip+"2",precision:0,min:1,default:2}],SMARTTREND:[{title:"Period",precision:0,min:1,default:10},{title:"Multiplier",precision:1,min:.1,max:10,default:3},{title:"Uptrend Color",type:"color",styleKey:"lines[0].color",default:"#10B981"},{title:"Downtrend Color",type:"color",styleKey:"lines[1].color",default:"#EF4444"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:2}],KDJ:[{title:ip+"1",precision:0,min:1,default:9},{title:ip+"2",precision:0,min:1,default:3},{title:ip+"3",precision:0,min:1,default:3}],SAR:[{title:"Start",precision:3,min:.001,max:.1,default:.02},{title:"Increment",precision:3,min:.001,max:.1,default:.02},{title:"Max value",precision:2,min:.1,max:1,default:.2}],TRIX:[{title:ip+"1",precision:0,min:1,default:12},{title:ip+"2",precision:0,min:1,default:9}],VOL:[{title:"MA1",precision:0,min:1,default:5},{title:"MA2",precision:0,min:1,default:10},{title:"MA3",precision:0,min:1,default:20}],VR:[{title:ip+"1",precision:0,min:1,default:26},{title:ip+"2",precision:0,min:1,default:6},{title:ip+"3",precision:0,min:1,default:12}],WR:[{title:"Period",precision:0,min:1,default:14},{title:"Line Color",type:"color",styleKey:"lines[0].color",default:"#2563eb"},{title:"Line Thickness",precision:0,min:1,max:5,styleKey:"lines[0].size",default:1}],TRAP_HUNTER:[{title:"Resistance Lookback",precision:0,min:1,default:20},{title:"Support Lookback",precision:0,min:1,default:20},{title:"Confirmation Bars",precision:0,min:1,default:4},{title:"Max Trap Bars",precision:0,min:1,default:6},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Spike",precision:2,min:.1,default:1.2},{title:"Min Breakout Factor",precision:4,min:0,default:5e-4},{title:"Min Wick Ratio",precision:2,min:0,max:1,default:.35},{title:"Min Trap Score",precision:2,min:0,max:1,default:.5},{title:"Enable Normal Signal (0/1)",precision:0,min:0,max:1,default:1},{title:"Normal Quiet Bars",precision:0,min:1,default:5}],SMART_MONEY:[{title:"Zone Lookback Bars",precision:0,min:10,default:40},{title:"Min Zone Bars",precision:0,min:3,default:5},{title:"Max Zone Bars",precision:0,min:5,default:25},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Min Volume Factor",precision:2,min:.1,default:1.2},{title:"Max Zone Width %",precision:3,min:.001,default:.03},{title:"Prior Trend Lookback",precision:0,min:1,default:20},{title:"Min OBV Trend Strength",precision:2,min:0,default:.2},{title:"Min Zone Score",precision:2,min:0,max:1,default:.6},{title:"Merge Nearby Zones (0/1)",precision:0,min:0,max:1,default:1},{title:"Max Zones Displayed",precision:0,min:1,default:20},{title:"Show Labels (0/1)",precision:0,min:0,max:1,default:1}],VOLCANIC:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],VOLCANIC_SIG:[{title:"BB Period",precision:0,min:1,default:16},{title:"BB StdDev",precision:2,min:.1,default:2},{title:"ATR Period",precision:0,min:1,default:14},{title:"Volume MA Period",precision:0,min:1,default:20},{title:"Normalize Lookback",precision:0,min:10,default:60},{title:"Pressure SMA",precision:0,min:1,default:2},{title:"Min Pressure Alert",precision:2,min:0,max:1,default:.55},{title:"Confirm Bars",precision:0,min:1,default:1},{title:"Min Volume x",precision:2,min:.5,default:1},{title:"Min Range x",precision:2,min:.5,default:1},{title:"Min Body % of Range",precision:2,min:0,max:1,default:.5},{title:"Breakout Lookback",precision:0,min:5,default:10},{title:"Min Bars Between Signals",precision:0,min:1,default:1},{title:"Trend EMA Period",precision:0,min:2,default:30},{title:"Require Trend Align (0/1)",precision:0,min:0,max:1,default:0},{title:"Breakout Buffer %",precision:4,min:0,default:7e-4},{title:"Require BB Band Break (0/1)",precision:0,min:0,max:1,default:0},{title:"Retest Window (bars)",precision:0,min:1,default:1}],ZIGZAG:[{title:"Deviation %",precision:1,min:1,max:50,default:5},{title:"Depth",precision:0,min:1,max:50,default:5}]};function WR(s,e){if(s>1e12)throw Error("10 digit timestamp is require for align_tfsecs");let t=0;for(const n of zR){if(e<n.tfsecs)break;if(e%n.tfsecs==0){t=n.origin;break}}return t?Math.floor((s-t)/e)*e+t:Math.floor(s/e)*e}function $k(s,e){if((!s||isNaN(s)||s<=0)&&(console.warn("Invalid timestamp in align_tfmsecs:",s),s=Date.now()),s<1e12&&(console.warn("13 digit timestamp is require for align_tfmsecs, got:",s),s<1e9?s=s*1e3:s=Date.now()),e<1e3)throw Error("milliseconds tf_msecs is require for align_tfmsecs");const t=Math.floor(s/1e3),n=Math.floor(e/1e3);return WR(t,n)*1e3}function HR(s,e,t,n=null){if(s=s.map((a,l)=>{const c=a[0];return(!c||isNaN(c)||c<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs at index ${l}:`,c),a[0]=Date.now()),a}),n&&((!n[0]||isNaN(n[0])||n[0]<=0)&&(console.warn("Invalid timestamp in last_bar:",n[0]),n[0]=Date.now()),n[0]=$k(n[0],t)),e==t)return n&&s.length>0&&s[0][0]>n[0]&&s.splice(0,0,n),s;const o=n?[n]:[];let r=o.length-1;return s.forEach((a,l)=>{if((!a[0]||isNaN(a[0])||a[0]<=0)&&(console.warn(`Invalid timestamp in build_ohlcvs forEach at index ${l}:`,a[0]),a[0]=Date.now()),a[0]=$k(a[0],t),r<0||a[0]>o[r][0])o.push(a),r+=1;else{const c=o[r];c[2]=Math.max(c[2],a[2]),c[3]=Math.min(c[3],a[3]),c[4]=a[4],c[5]+=a[5]}}),o}function hf(s){var o,r,a,l,c,f,u,d;const e=s,t=Ys.cloneDeep(e),n=(o=t.candle)==null?void 0:o.type;if(n&&(t._originalChartType=n),t.candle&&t.candle.type==="area"&&!t.candle._isLineChart){t.candle.area||(t.candle.area={});const h=((r=t.candle.bar)==null?void 0:r.upColor)||((a=t.candle.bar)==null?void 0:a.downColor)||((f=(c=(l=t.candle.priceMark)==null?void 0:l.last)==null?void 0:c.text)==null?void 0:f.color)||((d=(u=t.candle.tooltip)==null?void 0:u.text)==null?void 0:d.color)||"#2196F3";t.candle.area={...t.candle.area,backgroundColor:[{offset:0,color:h+"60"},{offset:1,color:h+"10"}]}}if(e.yAxis&&(t.yAxis={...t.yAxis||{},...e.yAxis||{}}),e.xAxis&&(t.xAxis={...t.xAxis||{},...e.xAxis||{}}),e.grid&&(t.grid={...t.grid||{},...e.grid||{}}),e.indicator&&(t.indicator={...t.indicator||{},...e.indicator||{}}),t.candle&&t.candle.type==="heikin_ashi"&&(t.candle.type="candle_solid"),t.candle&&t.candle.type==="renko_atr"&&(t.candle.type="candle_solid"),t.candle&&!t.candle.bar&&(t.candle.bar={}),t.candle&&t.candle.type==="point_and_figure"){t.candle.type="candle_solid";const h="rgba(0,0,0,0)";t.candle.bar={...t.candle.bar,upColor:h,downColor:h,noChangeColor:h,upBorderColor:h,downBorderColor:h,noChangeBorderColor:h,upWickColor:h,downWickColor:h,noChangeWickColor:h},t.candle.priceMark||(t.candle.priceMark={}),t.candle.priceMark.high={show:!1},t.candle.priceMark.low={show:!1}}else if(t.candle&&t.candle.bar){const h=t.candle.bar,p=C=>!C||C==="transparent"||C==="rgba(0,0,0,0)",v="#26A69A",x="#EF5350",S="#888888";p(h.upColor)&&(h.upColor=v),p(h.downColor)&&(h.downColor=x),p(h.noChangeColor)&&(h.noChangeColor=S),p(h.upBorderColor)&&(h.upBorderColor=v),p(h.downBorderColor)&&(h.downBorderColor=x),p(h.noChangeBorderColor)&&(h.noChangeBorderColor=S),p(h.upWickColor)&&(h.upWickColor=v),p(h.downWickColor)&&(h.downWickColor=x),p(h.noChangeWickColor)&&(h.noChangeWickColor=S),t.candle.bar=h}return t}function Dk(s,e){var t,n;return(t=e==null?void 0:e.candle)!=null&&t.type?(console.log("✅ Using chart type from $save.styles:",e.candle.type),e.candle.type):s!=null&&s._originalChartType?(console.log("✅ Using original chart type from marker:",s._originalChartType),s._originalChartType):(n=s==null?void 0:s.candle)!=null&&n.type?(console.log("⚠️ Using chart type from chart.getStyles() (might be converted):",s.candle.type),s.candle.type):(console.log("⚠️ No chart type found, defaulting to candle_solid"),"candle_solid")}function s2(s){if(!s||s.length===0)return s;const e=[];let t=0,n=0;for(let o=0;o<s.length;o++){const r=s[o],a=(r.open+r.high+r.low+r.close)/4;let l;o===0?l=(r.open+r.close)/2:l=(t+n)/2;const c=Math.max(r.high,l,a),f=Math.min(r.low,l,a),u={...r,open:l,high:c,low:f,close:a};e.push(u),t=l,n=a}return e}function n2(s,e){if(!Array.isArray(s)||s.length===0)return s;const t=(e==null?void 0:e.method)||"ATR",n=Math.max(1,((e==null?void 0:e.atrLength)??14)|0),o=(e==null?void 0:e.source)||"close",r=!!(e!=null&&e.wick),a=ie=>{const te=Number(ie==null?void 0:ie.open),le=Number(ie==null?void 0:ie.high),pe=Number(ie==null?void 0:ie.low),re=Number(ie==null?void 0:ie.close);return!Number.isFinite(te)||!Number.isFinite(le)||!Number.isFinite(pe)||!Number.isFinite(re)?null:{...ie,open:te,high:le,low:pe,close:re,volume:Number.isFinite(Number(ie==null?void 0:ie.volume))?Number(ie.volume):ie==null?void 0:ie.volume}},l=s.map(a).filter(Boolean);if(l.length===0)return[];const c=ie=>{switch(o){case"open":return ie.open;case"high":return ie.high;case"low":return ie.low;default:return ie.close}},f=[];let u=null,d=1/0,h=-1/0,p=0;for(let ie=0;ie<l.length;ie++){const te=l[ie];d=Math.min(d,te.low),h=Math.max(h,te.high),p+=te.close;const le=u==null?Math.max(0,te.high-te.low):Math.max(te.high-te.low,Math.abs(te.high-u),Math.abs(te.low-u));f.push(Math.max(0,le)),u=te.close}const v=new Array(f.length).fill(0);let x=0;for(let ie=0;ie<f.length;ie++)x+=f[ie],ie===n-1?v[ie]=x/n:ie>=n?v[ie]=(v[ie-1]*(n-1)+f[ie])/n:v[ie]=f[ie];const S=p/Math.max(1,l.length),C=Number.isFinite(h-d)?Math.max(0,h-d):0,I=v[Math.min(v.length-1,Math.max(0,n-1))]||f.reduce((ie,te)=>ie+te,0)/Math.max(1,f.length);let A=t==="ATR"&&v[v.length-1]||I;if(!Number.isFinite(A)||A<=0){const ie=C>0?C/Math.max(50,l.length):Math.abs(S)*.001;A=ie>0?ie:1}const P=C>0?C/5e3:0,T=Number.isFinite(S)&&S!==0?Math.abs(S)*1e-6:0;A=Math.max(1e-12,A,P,T);const j=200,E=2e4,L=ie=>{if(!Number.isFinite(ie)||ie<=0)return 0;let te=0,le=c(l[0]);for(let pe=1;pe<l.length;pe++){const re=c(l[pe]);if(!Number.isFinite(re))continue;const xe=re-le,se=Math.floor(Math.abs(xe)/ie);if(se<=0)continue;const Ne=Math.min(se,j);if(te+=Ne,le+=Math.sign(xe)*Ne*ie,te>E*4)return te}return te};let D=L(A);for(let ie=0;ie<3&&D>E;ie++){const te=Math.max(1.2,D/E);A*=te,D=L(A)}const X=[];let ne=c(l[0]),de=l[0]&&typeof l[0].timestamp=="number"&&Number.isFinite(l[0].timestamp)?l[0].timestamp:Date.now();for(let ie=1;ie<l.length;ie++){const te=l[ie],le=c(te);if(!Number.isFinite(le))continue;const pe=le-ne,re=pe>0?1:pe<0?-1:0;if(re===0)continue;let xe=Math.floor(Math.abs(pe)/A);if(!(xe<=0)){xe=Math.min(xe,j);for(let se=0;se<xe;se++){const Ne=ne,Te=ne+re*A,Me=Math.max(Ne,Te),De=Math.min(Ne,Te),Oe=se===xe-1,Ke=r&&Oe&&re>0?Math.max(Me,te.high):Me,kt=r&&Oe&&re<0?Math.min(De,te.low):De,pt=typeof te.timestamp=="number"&&Number.isFinite(te.timestamp)?te.timestamp:de;de=Math.max(pt,de+1),X.push({timestamp:de,open:Ne,high:Ke,low:kt,close:Te,volume:te.volume??0}),ne=Te}}}if(X.length===0){const ie=l[l.length-1],te=ie.open,le=ie.close,pe=r?ie.high:Math.max(te,le),re=r?ie.low:Math.min(te,le);X.push({timestamp:typeof ie.timestamp=="number"&&Number.isFinite(ie.timestamp)?ie.timestamp:de||Date.now(),open:te,high:pe,low:re,close:le,volume:ie.volume??0})}return X}const qR={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};function o2(s,e){if(!Array.isArray(s)||s.length===0)return s;const t={...qR,...e};let n;if(t.boxSizeMode==="ATR"){const C=Math.max(1,t.atrLength||14),I=[];let A=null;for(let E=0;E<s.length;E++){const L=s[E],D=A==null?Math.max(0,L.high-L.low):Math.max(L.high-L.low,Math.abs(L.high-A),Math.abs(L.low-A));I.push(Math.max(0,D)),A=L.close}const P=new Array(I.length).fill(0);let T=0;for(let E=0;E<I.length;E++)T+=I[E],E===C-1?P[E]=T/C:E>=C?P[E]=(P[E-1]*(C-1)+I[E])/C:P[E]=I[E];const j=P[P.length-1]||I.reduce((E,L)=>E+L,0)/Math.max(1,I.length);n=Math.max(1e-4,j)}else if(t.boxSizeMode==="percent"){const C=s.reduce((I,A)=>I+A.close,0)/s.length;n=Math.max(1e-4,C*t.boxSize/100)}else n=Math.max(1e-4,t.boxSize);const o=n*t.reversalBoxes,r=s[0];let a=r.close>=r.open?"up":"down",l=Math.floor(r.high/n)*n,c=Math.ceil(r.low/n)*n;const f=[];let u=0,d={columnIndex:0,direction:a,boxes:[],highPrice:l,lowPrice:c,startTime:r.timestamp||Date.now(),endTime:r.timestamp||Date.now()};const h=Math.max(1,Math.round((l-c)/n));for(let C=0;C<=h;C++){const I=c+C*n;d.boxes.push({columnIndex:0,direction:a,boxIndex:C,price:I,startTime:d.startTime,endTime:d.endTime})}const p=500;for(let C=1;C<s.length;C++){const I=s[C],A=I.timestamp||Date.now();if(d.endTime=A,a==="up"){const P=Math.floor(I.high/n)*n;if(P>l){let T=Math.round((P-l)/n);T=Math.min(T,p-d.boxes.length);for(let j=1;j<=T;j++){const E=l+j*n;d.boxes.push({columnIndex:u,direction:"up",boxIndex:d.boxes.length,price:E,startTime:A,endTime:A})}l=P,d.highPrice=l}if(l-I.low>=o){const T=Math.ceil(I.low/n)*n;f.push(d),u++,a="down",c=T,d={columnIndex:u,direction:"down",boxes:[],highPrice:l-n,lowPrice:c,startTime:A,endTime:A};let j=Math.round((d.highPrice-c)/n);j=Math.min(j,p);for(let E=0;E<=j;E++){const L=d.highPrice-E*n;d.boxes.push({columnIndex:u,direction:"down",boxIndex:E,price:L,startTime:A,endTime:A})}l=d.highPrice}}else{const P=Math.ceil(I.low/n)*n;if(P<c){let T=Math.round((c-P)/n);T=Math.min(T,p-d.boxes.length);for(let j=1;j<=T;j++){const E=c-j*n;d.boxes.push({columnIndex:u,direction:"down",boxIndex:d.boxes.length,price:E,startTime:A,endTime:A})}c=P,d.lowPrice=c}if(I.high-c>=o){const T=Math.floor(I.high/n)*n;f.push(d),u++,a="up",l=T,d={columnIndex:u,direction:"up",boxes:[],highPrice:l,lowPrice:c+n,startTime:A,endTime:A};let j=Math.round((l-d.lowPrice)/n);j=Math.min(j,p);for(let E=0;E<=j;E++){const L=d.lowPrice+E*n;d.boxes.push({columnIndex:u,direction:"up",boxIndex:E,price:L,startTime:A,endTime:A})}c=d.lowPrice}}}if(d.boxes.length>0&&f.push(d),f.length===0)return s;const v=[],x=Date.now(),S=6e4;for(const C of f){const I=C.startTime||x+C.columnIndex*S;v.push({timestamp:I,open:C.direction==="up"?C.lowPrice:C.highPrice,high:C.highPrice,low:C.lowPrice,close:C.direction==="up"?C.highPrice:C.lowPrice,volume:C.boxes.length,_pnf:{columnIndex:C.columnIndex,direction:C.direction,boxes:C.boxes,boxCount:C.boxes.length,boxSize:n,upColor:t.upColor,downColor:t.downColor}})}return v}function a0(s){return s.exchange&&s.ticker?`${s.exchange.toUpperCase()}:${s.ticker.toUpperCase()}`:(s.ticker||s.name||"UNKNOWN").toUpperCase()}function UR(s,e){var r,a,l,c;const t=[];if(e)try{const f=((r=e.getChartStore)==null?void 0:r.call(e))||e;f&&typeof f.getPanes=="function"?f.getPanes().forEach((d,h)=>{t.push({id:d.id||`pane_${h}`,height:d.height,minHeight:d.minHeight,position:h,visible:d.visible!==!1})}):t.push({id:"candle_pane",height:400,position:0,visible:!0})}catch(f){console.warn("Error collecting pane configurations:",f),t.push({id:"candle_pane",height:400,position:0,visible:!0})}const n=[],o=new Map;if(Object.entries(s.saveInds).forEach(([f,u])=>{var x,S,C,I,A,P,T,j,E,L,D,X;const d={};u.params&&Array.isArray(u.params)&&u.params.forEach((ne,de)=>{d[`param_${de}`]=ne});const h={};u.styles&&Array.isArray(u.styles)?u.styles.forEach((ne,de)=>{h[`style_${de}`]=ne}):u.styles&&typeof u.styles=="object"&&Object.assign(h,u.styles);const p={id:f,type:u.name,params:d,styles:h,paneId:u.pane_id,visible:!0,...Object.fromEntries(Object.entries(u).filter(([ne])=>!["name","pane_id","params","styles"].includes(ne)))};if(p.type==="RSI"){const ne=p;if(!ne.rsiGroups||ne.rsiGroups.length===0){const de=p.paneId||"pane_RSI",ie=Tg.getInstance(de)||Tg.getInstanceConfig(de);if(ie){const te=ie.overboughtThreshold??((C=(S=(x=ie.levels)==null?void 0:x.find)==null?void 0:S.call(x,re=>re.id==="overbought"))==null?void 0:C.value)??70,le=((P=(A=(I=ie.levels)==null?void 0:I.find)==null?void 0:A.call(I,re=>re.id==="middle"))==null?void 0:P.value)??50,pe=ie.oversoldThreshold??((E=(j=(T=ie.levels)==null?void 0:T.find)==null?void 0:j.call(T,re=>re.id==="oversold"))==null?void 0:E.value)??30;ne.rsiGroups=[{period:ie.period??14,overboughtLevel:te,middleLevel:le,oversoldLevel:pe,styles:{rsi:{color:ie.lineColor??"#8B5CF6",thickness:ie.lineThickness??2,lineStyle:ie.lineStyle??"solid"},overboughtColor:ie.overboughtColor??"#EF4444",oversoldColor:ie.oversoldColor??"#10B981",middleLineColor:((X=(D=(L=ie.levels)==null?void 0:L.find)==null?void 0:D.call(L,re=>re.id==="middle"))==null?void 0:X.color)??"#6B7280"}}]}}}const v=`${u.name}_${u.pane_id||"candle_pane"}`;o.set(v,p)}),e)try{const f=((a=e.getIndicators)==null?void 0:a.call(e))??[];console.log("📊 Collecting indicators from chart:",f.length,"found"),f.forEach(u=>{if(!u.name)return;const d=u.paneId||"candle_pane",h=`${u.name}_${d}`;if(o.has(h)){console.log(`✅ Indicator ${u.name} (${d}) already in saveInds`);return}console.log(`⚠️ Indicator ${u.name} (${d}) on chart but not in saveInds`);let p=null,v=null;for(const[x,S]of Object.entries(s.saveInds))if(S.name===u.name&&(S.pane_id===d||!S.pane_id&&d==="candle_pane")){p=S,v=x;break}if(p&&v){console.log(`✅ Found matching saveInd for ${u.name} with key: ${v}`);const x={};p.params&&Array.isArray(p.params)&&p.params.forEach((I,A)=>{x[`param_${A}`]=I});const S={};p.styles&&Array.isArray(p.styles)?p.styles.forEach((I,A)=>{S[`style_${A}`]=I}):p.styles&&typeof p.styles=="object"&&Object.assign(S,p.styles);const C={id:v,type:p.name,params:x,styles:S,paneId:p.pane_id||d,visible:!0,...Object.fromEntries(Object.entries(p).filter(([I])=>!["name","pane_id","params","styles"].includes(I)))};o.set(h,C)}else{if(u.name==="RSI"){console.log(`♻️ Skipping fallback SavedIndicator creation for RSI on pane ${d} (no matching saveInd)`);return}console.log(`⚠️ No matching saveInd found for ${u.name}, creating basic entry`);const S={id:`${d}_${u.name}`,type:u.name,params:{},styles:{},paneId:d,visible:!0};o.set(h,S)}})}catch(f){console.warn("⚠️ Failed to get indicators from chart, using saveInds only:",f)}return n.push(...Array.from(o.values())),console.log(`✅ Collected ${n.length} indicators for saving (${Object.keys(s.saveInds).length} from saveInds, ${n.length-Object.keys(s.saveInds).length} from chart)`),{timezone:s.timezone,interval:s.period.timeframe,chartType:((c=(l=s.styles)==null?void 0:l.candle)==null?void 0:c.type)||"candle_solid",theme:s.theme,panes:t,indicators:n,styles:s.styles||{},options:s.options||{}}}async function GR(s,e,t){var n,o,r,a,l,c,f,u,d,h,p,v,x,S,C,I,A,P,T,j,E,L,D,X,ne,de,ie,te,le,pe,re,xe,se,Ne;try{if(console.log("🔄 Applying global state:",s),t){try{t.removeIndicator({}),console.log("🧹 Removed all existing indicators before applying new layout")}catch(pt){console.warn("Failed to clear existing indicators before applying layout:",pt)}try{const{RSIManager:pt}=await Vv(async()=>{const{RSIManager:Rt}=await Promise.resolve().then(()=>Yw);return{RSIManager:Rt}},void 0,import.meta.url);pt.clearAllInstances()}catch{}}const Te={},Me=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],De=(n=vh(jg))==null?void 0:n.data,Oe=De&&(De.isPremium===!0||De.isTrial===!0),Ke=[],kt=new Set;if(s.indicators.forEach(pt=>{if(pt.type==="RSI"){const Rt=pt.rsiGroups,Ht=Array.isArray(Rt)&&Rt.length>0&&(Rt[0].actualPaneId||Rt[0].paneId)||pt.paneId;if(Ht){if(kt.has(Ht)){console.log("♻️ Skipping duplicate RSI indicator for pane:",Ht);return}kt.add(Ht),pt.paneId=Ht,pt.id=`${Ht}_RSI`,Array.isArray(Rt)&&Rt.length>0&&(Rt[0].paneId=Ht,Rt[0].actualPaneId=Ht)}}Ke.push(pt)}),Ke.forEach(pt=>{if(!Oe&&pt.type&&Me.includes(pt.type)){console.log(`🔒 Skipping AI indicator ${pt.type} - user does not have premium access`);return}const Rt=[];pt.params&&typeof pt.params=="object"&&Object.entries(pt.params).forEach(([zt,ut])=>{if(zt.startsWith("param_")){const nt=parseInt(zt.replace("param_",""));Rt[nt]=ut}});const Ht=[];pt.styles&&typeof pt.styles=="object"&&Object.entries(pt.styles).forEach(([zt,ut])=>{if(zt.startsWith("style_")&&typeof ut=="object"){const nt=parseInt(zt.replace("style_",""));Ht[nt]=ut}});const Ft={name:pt.type,pane_id:pt.paneId,params:Rt.length>0?Rt:void 0,styles:Ht.length>0?Ht:void 0,...Object.fromEntries(Object.entries(pt).filter(([zt])=>!["id","type","paneId","params","styles","visible"].includes(zt)))};Te[pt.id]=Ft}),e.update(pt=>{pt.timezone=s.timezone,pt.period={...pt.period,timeframe:s.interval};const Rt=s.styles&&typeof s.styles=="object"?{...s.styles}:{},Ht=pt.theme||s.theme||"dark";if((s.theme||Ht)!==Ht)try{const zt=lp(Ht),ut=Ys.merge({},zt,Rt);delete ut.backgroundColor,delete ut.backgroundOpacity,delete ut.backgroundType,delete ut.backgroundGradient,delete ut.gridColor,delete ut.gridOpacity,delete ut.gridType,delete ut.gridGradient,pt.styles=ut}catch{pt.styles=Rt}else pt.styles=Rt;return pt.styles.candle||(pt.styles.candle={}),pt.styles.candle.type=s.chartType,pt.options=s.options&&typeof s.options=="object"?{...s.options}:{},pt.saveInds=Te,pt}),t)try{const pt=vh(e);t.setStyles&&pt.styles&&(t.setStyles(pt.styles),console.log("🎨 Applied saved styles to chart"))}catch(pt){console.warn("Failed to apply saved styles to chart:",pt)}if(t&&Ke.length>0){console.log("Creating indicators on chart:",Ke.length);for(const pt of Ke)try{const Rt=[];pt.params&&typeof pt.params=="object"&&Object.entries(pt.params).forEach(([nt,Je])=>{if(nt.startsWith("param_")){const it=parseInt(nt.replace("param_",""));Rt[it]=Je}});const Ht=[];pt.styles&&typeof pt.styles=="object"&&Object.entries(pt.styles).forEach(([nt,Je])=>{if(nt.startsWith("style_")&&typeof Je=="object"){const it=parseInt(nt.replace("style_",""));Ht[it]=Je}});const Ft={name:pt.type,calcParams:Rt.length>0?Rt:void 0,visible:pt.visible!==!1};if(Ht.length>0&&(Ft.styles={lines:Ht.map(nt=>{const Je=nt.lineStyle==="dashed"||nt.lineStyle==="dotted",it=nt.lineStyle==="dotted"?[2,2]:[4,4];return{color:nt.color,size:nt.thickness??1,style:Je?mt.Dashed:mt.Solid,dashedValue:Je?it:[2,2]}})}),pt.type==="SMARTTREND"){const nt=pt.superTrendGroup,Je=nt?{showLabels:!!nt.showLabels,uptrendColor:((r=(o=nt.styles)==null?void 0:o.uptrend)==null?void 0:r.color)??"#00FF00",downtrendColor:((l=(a=nt.styles)==null?void 0:a.downtrend)==null?void 0:l.color)??"#FF0000",uptrendThickness:((f=(c=nt.styles)==null?void 0:c.uptrend)==null?void 0:f.thickness)??1,downtrendThickness:((d=(u=nt.styles)==null?void 0:u.downtrend)==null?void 0:d.thickness)??1,uptrendLineStyle:((p=(h=nt.styles)==null?void 0:h.uptrend)==null?void 0:p.lineStyle)??"dashed",downtrendLineStyle:((x=(v=nt.styles)==null?void 0:v.downtrend)==null?void 0:x.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"};if(Ft.extendData=Je,!Ft.styles){const it=Je.uptrendLineStyle==="dotted"||Je.uptrendLineStyle==="dashed";Ft.styles={lines:[{color:Je.uptrendColor,size:Je.uptrendThickness,style:it?mt.Dashed:mt.Solid,dashedValue:Je.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}if(pt.type==="RSI"){const nt=pt.rsiGroups||[],Je=pt.paneId;if(Array.isArray(nt)&&nt.length>0){const it=nt[0],ze=((S=it.styles)==null?void 0:S.overboughtColor)??"#EF4444",Ge=((C=it.styles)==null?void 0:C.oversoldColor)??"#22C55E",xt=((I=it.styles)==null?void 0:I.middleLineColor)??"#6B7280",jt=it.fillOpacity??.15,ft=((A=it.styles)==null?void 0:A.overboughtThickness)??1,ke=((P=it.styles)==null?void 0:P.oversoldThickness)??1,Se=((T=it.styles)==null?void 0:T.middleLineThickness)??1,Et=((j=it.styles)==null?void 0:j.overboughtLineStyle)??"dashed",wt=((E=it.styles)==null?void 0:E.oversoldLineStyle)??"dashed",Ls=((L=it.styles)==null?void 0:L.middleLineStyle)??"dashed",tn={id:Je,period:it.period??14,lineColor:((X=(D=it.styles)==null?void 0:D.rsi)==null?void 0:X.color)??"#8B5CF6",lineThickness:((de=(ne=it.styles)==null?void 0:ne.rsi)==null?void 0:de.thickness)??2,lineStyle:((te=(ie=it.styles)==null?void 0:ie.rsi)==null?void 0:te.lineStyle)??"solid",overboughtLevel:it.overboughtLevel??70,oversoldLevel:it.oversoldLevel??30,middleLevel:it.middleLevel??50,overboughtColor:ze,overboughtThickness:ft,overboughtLineStyle:Et,oversoldColor:Ge,oversoldThickness:ke,oversoldLineStyle:wt,overboughtFillColor:ze,oversoldFillColor:Ge,middleLineColor:xt,middleLineThickness:Se,middleLineStyle:Ls,fillOpacity:jt,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:it.overboughtLevel??70,color:ze,lineStyle:Et,thickness:ft,label:String(it.overboughtLevel??70),visible:!0},{id:"middle",value:it.middleLevel??50,color:xt,lineStyle:Ls,thickness:Se,label:String(it.middleLevel??50),visible:!0},{id:"oversold",value:it.oversoldLevel??30,color:Ge,lineStyle:wt,thickness:ke,label:String(it.oversoldLevel??30),visible:!0}]};try{const{RSIManager:Es}=await Vv(async()=>{const{RSIManager:Ns}=await Promise.resolve().then(()=>Yw);return{RSIManager:Ns}},void 0,import.meta.url);Es.importInstanceConfig(tn)}catch{}Ft.calcParams=[it.period??14];const Gs={color:((pe=(le=it.styles)==null?void 0:le.rsi)==null?void 0:pe.color)??"#8B5CF6",size:((xe=(re=it.styles)==null?void 0:re.rsi)==null?void 0:xe.thickness)??2,style:mt.Solid,dashedValue:[2,2]},an=(Ne=(se=it.styles)==null?void 0:se.rsi)==null?void 0:Ne.lineStyle;an==="dashed"?(Gs.style=mt.Dashed,Gs.dashedValue=[6,4]):an==="dotted"&&(Gs.style=mt.Dashed,Gs.dashedValue=[2,2]),Ft.styles={lines:[Gs]}}}const zt=pt.paneId==="candle_pane",ut=t.createIndicator(Ft,zt,{id:pt.paneId});console.log(`Created indicator ${pt.type} with ID:`,ut)}catch(Rt){console.error(`Failed to create indicator ${pt.type}:`,Rt)}}console.log("Applied global state:",{timezone:s.timezone,interval:s.interval,chartType:s.chartType,theme:s.theme,indicatorCount:Ke.length,indicatorsCreated:t?Ke.length:0})}catch(Te){throw console.error("Error applying global state:",Te),Te}}function Rk(s){return a0(s.symbol)}class YR{constructor(e){Pe(this,"chart");Pe(this,"persistenceKey");Pe(this,"currentSymbol",null);Pe(this,"ephemeralMode",!0);Pe(this,"drawingsBySymbol",new Map);Pe(this,"renderedDrawingIds",new Set);Pe(this,"onDrawingCreated");Pe(this,"onDrawingRemoved");Pe(this,"onSymbolChanged");Pe(this,"symbolChangeCallbacks",new Set);this.chart=e.chart,this.persistenceKey=e.persistenceKey,this.onDrawingCreated=e.onDrawingCreated,this.onDrawingRemoved=e.onDrawingRemoved,this.onSymbolChanged=e.onSymbolChanged,this.ephemeralMode||this.loadFromStorage(),console.log("✅ DrawingManager initialized with key:",this.persistenceKey)}setCurrentSymbol(e){var o;const t=typeof e=="string"?e:a0(e);if(this.currentSymbol===t){console.log("🔄 Symbol unchanged, skipping reload:",t);return}const n=this.currentSymbol;this.currentSymbol=t,console.log(`🔄 Symbol changed: ${n} → ${t}`),this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol(),n&&((o=this.onSymbolChanged)==null||o.call(this,n,t),this.symbolChangeCallbacks.forEach(r=>r(t)))}getCurrentSymbol(){return this.currentSymbol}addDrawing(e){var o;if(!e.symbolKey)throw console.error("❌ Cannot add drawing without symbolKey:",e),new Error("Drawing must have a symbolKey");let t=this.drawingsBySymbol.get(e.symbolKey);t||(t=[],this.drawingsBySymbol.set(e.symbolKey,t));const n=t.findIndex(r=>r.id===e.id);n>=0?(t[n]=e,console.log("🔄 Updated drawing:",e.id,"for symbol:",e.symbolKey)):(t.push(e),console.log("➕ Added drawing:",e.id,"for symbol:",e.symbolKey)),this.saveToStorage(),e.symbolKey===this.currentSymbol&&e.visible!==!1&&this.renderDrawing(e),(o=this.onDrawingCreated)==null||o.call(this,e)}removeDrawing(e){var o,r;let t=!1,n=null;for(const[a,l]of this.drawingsBySymbol.entries()){const c=l.findIndex(f=>f.id===e);if(c>=0){l.splice(c,1),t=!0,n=a,console.log("🗑️ Removed drawing:",e,"from symbol:",a);break}}return t&&(n&&((o=this.drawingsBySymbol.get(n))==null?void 0:o.length)===0&&this.drawingsBySymbol.delete(n),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),n&&((r=this.onDrawingRemoved)==null||r.call(this,e,n))),t}removeDrawingForSymbol(e,t){var r;const n=this.drawingsBySymbol.get(t);if(!n)return!1;const o=n.findIndex(a=>a.id===e);return o<0?!1:(n.splice(o,1),n.length===0&&this.drawingsBySymbol.delete(t),this.saveToStorage(),this.renderedDrawingIds.has(e)&&(this.chart.removeOverlay({id:e}),this.renderedDrawingIds.delete(e)),(r=this.onDrawingRemoved)==null||r.call(this,e,t),!0)}getDrawingsForSymbol(e){return this.drawingsBySymbol.get(e)||[]}getCurrentSymbolDrawings(){return this.currentSymbol?this.getDrawingsForSymbol(this.currentSymbol):[]}getAllDrawings(){return new Map(this.drawingsBySymbol)}clearDrawingsForSymbol(e){const t=this.drawingsBySymbol.get(e);t&&(e===this.currentSymbol&&t.forEach(n=>{this.renderedDrawingIds.has(n.id)&&(this.chart.removeOverlay({id:n.id}),this.renderedDrawingIds.delete(n.id))}),this.drawingsBySymbol.delete(e),this.saveToStorage(),console.log("🗑️ Cleared all drawings for symbol:",e))}clearCurrentSymbolDrawings(){this.currentSymbol&&this.clearDrawingsForSymbol(this.currentSymbol)}clearRenderedDrawings(){this.renderedDrawingIds.forEach(e=>{try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Failed to remove overlay:",e,t)}}),this.renderedDrawingIds.clear(),console.log("🧹 Cleared rendered drawings from chart")}hideRenderedDrawings(){this.clearRenderedDrawings()}renderDrawingsForCurrentSymbol(){if(!this.currentSymbol){console.log("⚠️ No current symbol, skipping render");return}const e=this.getDrawingsForSymbol(this.currentSymbol);console.log(`🎨 Rendering ${e.length} drawings for symbol:`,this.currentSymbol),e.forEach(t=>{t.visible!==!1&&this.renderDrawing(t)})}renderCurrentSymbolDrawings(){this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()}renderDrawing(e){if(e.symbolKey!==this.currentSymbol){console.warn("⛔ Drawing symbolKey mismatch, skipping render:",{drawingSymbol:e.symbolKey,currentSymbol:this.currentSymbol});return}try{const t={id:e.id,groupId:"drawing_tools",name:e.type,points:e.points.map(o=>({timestamp:o.time,value:o.price,t:o.time,p:o.price})),styles:e.styles,lock:e.locked,visible:e.visible,onSelected:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalSelectOverlay&&r.externalSelectOverlay(o.overlay)}catch{}return!0},onDeselected:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalDeselectOverlay&&r.externalDeselectOverlay(o.overlay)}catch{}return!0},onPressedMoveEnd:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalSyncOverlay&&r.externalSyncOverlay(o.overlay)}catch{}return!0},onRemoved:o=>{try{const r=typeof window<"u"?window.drawBarRef:null;r!=null&&r.externalRemoved&&r.externalRemoved(o.overlay.id)}catch{}return!0},...Object.fromEntries(Object.entries(e).filter(([o])=>!["id","symbolKey","type","points","styles","locked","visible","seriesId"].includes(o)))};this.chart.createOverlay(t)&&(this.renderedDrawingIds.add(e.id),console.log("✅ Rendered drawing:",e.id,"for symbol:",e.symbolKey))}catch(t){console.error("❌ Failed to render drawing:",e.id,t)}}updateDrawing(e,t){for(const[n,o]of this.drawingsBySymbol.entries()){const r=o.findIndex(a=>a.id===e);if(r>=0){const a=o[r];return o[r]={...a,...t,symbolKey:a.symbolKey},this.saveToStorage(),console.log("🔄 Updated drawing:",e),!0}}return!1}loadDrawingsForSymbol(e,t){const n=t.filter(o=>o.symbolKey!==e?(console.warn("⚠️ Drawing symbolKey mismatch during bulk load:",{expected:e,actual:o.symbolKey,drawingId:o.id}),!1):!0);this.drawingsBySymbol.set(e,n),this.saveToStorage(),e===this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log(`📥 Loaded ${n.length} drawings for symbol:`,e)}loadAllDrawings(e){this.drawingsBySymbol.clear(),Object.entries(e).forEach(([t,n])=>{const o=n.filter(r=>(r.symbolKey||(console.warn("⚠️ Drawing missing symbolKey, assigning:",t),r.symbolKey=t),!0));this.drawingsBySymbol.set(t,o)}),this.saveToStorage(),this.currentSymbol&&(this.clearRenderedDrawings(),this.renderDrawingsForCurrentSymbol()),console.log("📥 Loaded drawings for",this.drawingsBySymbol.size,"symbols")}saveToStorage(){if(!this.ephemeralMode)try{const e={drawingsBySymbol:Object.fromEntries(this.drawingsBySymbol),version:1};localStorage.setItem(this.persistenceKey,JSON.stringify(e))}catch(e){console.error("❌ Failed to save drawings to storage:",e)}}clearPersistedStorage(){try{localStorage.removeItem(this.persistenceKey),console.log("🧹 Cleared persisted drawing storage for key:",this.persistenceKey)}catch(e){console.warn("Failed to clear persisted drawing storage:",e)}}loadFromStorage(){if(!this.ephemeralMode)try{const e=localStorage.getItem(this.persistenceKey);if(!e){console.log("📭 No stored drawings found");return}const t=JSON.parse(e);if(!t.version){console.log("🔄 Migrating legacy drawing storage..."),this.migrateLegacyStorage(t);return}Object.entries(t.drawingsBySymbol||{}).forEach(([n,o])=>{const r=o.map(a=>(a.symbolKey||(a.symbolKey=n),a));this.drawingsBySymbol.set(n,r)}),console.log("📂 Loaded drawings from storage:",this.drawingsBySymbol.size,"symbols")}catch(e){console.error("❌ Failed to load drawings from storage:",e),this.drawingsBySymbol.clear()}}migrateLegacyStorage(e){if(console.log("🔄 Starting migration of legacy overlay format..."),typeof e=="object"&&!e.drawingsBySymbol){const t={};Object.entries(e).forEach(([n,o])=>{try{const r=n.split("_");if(r.length<3){console.warn("⚠️ Invalid legacy key format:",n);return}const a=r[r.length-1],l=r[r.length-2],f=r.slice(0,-2).join("_").toUpperCase(),u=this.convertLegacyOverlayToDrawing(a,o,f);u&&(t[f]||(t[f]=[]),t[f].push(u))}catch(r){console.warn("⚠️ Failed to migrate legacy overlay:",n,r)}}),Object.entries(t).forEach(([n,o])=>{this.drawingsBySymbol.set(n,o)}),this.saveToStorage(),console.log("✅ Migration complete:",this.drawingsBySymbol.size,"symbols migrated")}}convertLegacyOverlayToDrawing(e,t,n){try{const o=[];return t.points&&Array.isArray(t.points)&&t.points.forEach(r=>{r&&typeof r=="object"&&(r.timestamp&&r.value!==void 0?o.push({time:r.timestamp,price:r.value}):r.time&&r.price!==void 0?o.push({time:r.time,price:r.price}):r.t&&r.p!==void 0&&o.push({time:r.t,price:r.p}))}),o.length===0?(console.warn("Legacy overlay has no valid data coordinates:",e),null):{id:e,symbolKey:n,type:t.name||"unknown",points:o,styles:t.styles||{},locked:!!t.lock,visible:t.visible!==!1,...Object.fromEntries(Object.entries(t).filter(([r])=>!["name","points","styles","lock","visible"].includes(r)))}}catch(o){return console.warn("Error converting legacy overlay to drawing:",e,o),null}}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}exportDrawings(){return Object.fromEntries(this.drawingsBySymbol)}getStats(){let e=0;return this.drawingsBySymbol.forEach(t=>{e+=t.length}),{totalSymbols:this.drawingsBySymbol.size,totalDrawings:e,currentSymbolDrawings:this.getCurrentSymbolDrawings().length,renderedDrawings:this.renderedDrawingIds.size}}destroy(){this.clearRenderedDrawings(),this.symbolChangeCallbacks.clear(),this.drawingsBySymbol.clear(),console.log("🗑️ DrawingManager destroyed")}}let v1=null;function KR(s){return v1&&(console.warn("⚠️ DrawingManager already initialized, destroying old instance"),v1.destroy()),v1=new YR(s),v1}function ag(){return v1}class XR{constructor(){Pe(this,"state",Th({undoStack:[],redoStack:[],maxHistorySize:50}));Pe(this,"chart",null);Pe(this,"saveStore",null);Pe(this,"overlaysStore",null)}init({chart:e,saveStore:t,overlaysStore:n}){this.chart=e,this.saveStore=t,this.overlaysStore=n}addAction(e){this.state.update(t=>(t.redoStack=[],t.undoStack.push(e),t.undoStack.length>t.maxHistorySize&&t.undoStack.shift(),t))}recordAddIndicator(e,t,n,o){const r={type:"ADD_INDICATOR",data:{name:e,paneId:t,params:n,saveKey:o},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordRemoveIndicator(e,t,n,o){const r={type:"REMOVE_INDICATOR",data:{name:e,paneId:t,params:n,saveKey:o},timestamp:Date.now(),id:`indicator_${e}_${t}_${Date.now()}`};this.addAction(r)}recordAddOverlay(e,t,n){const o={type:"ADD_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:n},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(o)}recordRemoveOverlay(e,t,n){const o={type:"REMOVE_OVERLAY",data:{overlayId:e,overlayData:t,overlayKey:n},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(o)}recordModifyOverlay(e,t,n,o){const r={type:"MODIFY_OVERLAY",data:{overlayId:e,prevData:t,nextData:n,overlayKey:o},timestamp:Date.now(),id:`overlay_${e}_${Date.now()}`};this.addAction(r)}undo(){const e=vh(this.state);if(e.undoStack.length===0)return!1;const t=e.undoStack[e.undoStack.length-1],n=this.executeUndo(t);return n&&this.state.update(o=>{const r=o.undoStack.pop();return r&&o.redoStack.push(r),o}),n}redo(){const e=vh(this.state);if(e.redoStack.length===0)return!1;const t=e.redoStack[e.redoStack.length-1],n=this.executeRedo(t);return n&&this.state.update(o=>{const r=o.redoStack.pop();return r&&o.undoStack.push(r),o}),n}executeUndo(e){var t,n,o,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(f=>(delete f.saveInds[e.data.saveKey],f));break;case"REMOVE_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(f=>(f.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},f));break;case"ADD_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(f=>(delete f[e.data.overlayKey],f));try{const f=ag();f&&f.removeDrawing(e.data.overlayId)}catch{}break;case"REMOVE_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.overlayData,f));try{const f=ag();if(f){const u=vh(this.saveStore),d=a0(u.symbol),h=e.data.overlayData,p=Array.isArray(h==null?void 0:h.points)?h.points.map(v=>({time:(v==null?void 0:v.timestamp)??(v==null?void 0:v.t)??0,price:(v==null?void 0:v.value)??(v==null?void 0:v.p)??0})):[];if(p.length>0){const v={id:e.data.overlayId,symbolKey:d,type:(h==null?void 0:h.name)||"unknown",points:p,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};f.addDrawing(v)}}}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.prevData)==null?void 0:t.styles,extendData:(n=e.data.prevData)==null?void 0:n.extendData,points:(o=e.data.prevData)==null?void 0:o.points,lock:(r=e.data.prevData)==null?void 0:r.lock,visible:(a=e.data.prevData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.prevData,f));try{const f=ag();if(f){const u=e.data.prevData,d=Array.isArray(u==null?void 0:u.points)?u.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];f.updateDrawing(e.data.overlayId,{points:d,styles:(u==null?void 0:u.styles)||{},extendData:u==null?void 0:u.extendData,locked:!!(u!=null&&u.lock),visible:(u==null?void 0:u.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing undo:",l),!1}}executeRedo(e){var t,n,o,r,a;if(!this.chart)return!1;try{switch(e.type){case"ADD_INDICATOR":const l=this.chart.createIndicator({name:e.data.name,calcParams:e.data.params},!1,{id:e.data.paneId});this.saveStore&&l&&this.saveStore.update(f=>(f.saveInds[e.data.saveKey]={name:e.data.name,pane_id:e.data.paneId,params:e.data.params},f));break;case"REMOVE_INDICATOR":this.chart.removeIndicator({paneId:e.data.paneId,name:e.data.name}),this.saveStore&&this.saveStore.update(f=>(delete f.saveInds[e.data.saveKey],f));break;case"ADD_OVERLAY":const c=this.chart.createOverlay(e.data.overlayData);this.overlaysStore&&c&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.overlayData,f));try{const f=ag();if(f){const u=vh(this.saveStore),d=a0(u.symbol),h=e.data.overlayData,p=Array.isArray(h==null?void 0:h.points)?h.points.map(v=>({time:(v==null?void 0:v.timestamp)??(v==null?void 0:v.t)??0,price:(v==null?void 0:v.value)??(v==null?void 0:v.p)??0})):[];if(p.length>0){const v={id:e.data.overlayId,symbolKey:d,type:(h==null?void 0:h.name)||"unknown",points:p,styles:(h==null?void 0:h.styles)||{},...h!=null&&h.extendData?{extendData:h.extendData}:{},locked:!!(h!=null&&h.lock),visible:(h==null?void 0:h.visible)!==!1};f.addDrawing(v)}}}catch{}break;case"REMOVE_OVERLAY":this.chart.removeOverlay({id:e.data.overlayId}),this.overlaysStore&&this.overlaysStore.update(f=>(delete f[e.data.overlayKey],f));try{const f=ag();f&&f.removeDrawing(e.data.overlayId)}catch{}break;case"MODIFY_OVERLAY":this.chart.overrideOverlay({id:e.data.overlayId,styles:(t=e.data.nextData)==null?void 0:t.styles,extendData:(n=e.data.nextData)==null?void 0:n.extendData,points:(o=e.data.nextData)==null?void 0:o.points,lock:(r=e.data.nextData)==null?void 0:r.lock,visible:(a=e.data.nextData)==null?void 0:a.visible}),this.overlaysStore&&this.overlaysStore.update(f=>(f[e.data.overlayKey]=e.data.nextData,f));try{const f=ag();if(f){const u=e.data.nextData,d=Array.isArray(u==null?void 0:u.points)?u.points.map(h=>({time:(h==null?void 0:h.timestamp)??(h==null?void 0:h.t)??0,price:(h==null?void 0:h.value)??(h==null?void 0:h.p)??0})):[];f.updateDrawing(e.data.overlayId,{points:d,styles:(u==null?void 0:u.styles)||{},extendData:u==null?void 0:u.extendData,locked:!!(u!=null&&u.lock),visible:(u==null?void 0:u.visible)!==!1})}}catch{}break;default:return!1}return!0}catch(l){return console.error("Error executing redo:",l),!1}}canUndo(){return vh(this.state).undoStack.length>0}canRedo(){return vh(this.state).redoStack.length>0}getState(){return this.state}clearHistory(){this.state.update(e=>({...e,undoStack:[],redoStack:[]}))}}const qp=new XR,ZR={"😀":{name:"grinning face",slug:"grinning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😃":{name:"grinning face with big eyes",slug:"grinning_face_with_big_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😄":{name:"grinning face with smiling eyes",slug:"grinning_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😁":{name:"beaming face with smiling eyes",slug:"beaming_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😆":{name:"grinning squinting face",slug:"grinning_squinting_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😅":{name:"grinning face with sweat",slug:"grinning_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤣":{name:"rolling on the floor laughing",slug:"rolling_on_the_floor_laughing",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😂":{name:"face with tears of joy",slug:"face_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙂":{name:"slightly smiling face",slug:"slightly_smiling_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙃":{name:"upside-down face",slug:"upside_down_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫠":{name:"melting face",slug:"melting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😉":{name:"winking face",slug:"winking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😊":{name:"smiling face with smiling eyes",slug:"smiling_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😇":{name:"smiling face with halo",slug:"smiling_face_with_halo",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥰":{name:"smiling face with hearts",slug:"smiling_face_with_hearts",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😍":{name:"smiling face with heart-eyes",slug:"smiling_face_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤩":{name:"star-struck",slug:"star_struck",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😘":{name:"face blowing a kiss",slug:"face_blowing_a_kiss",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😗":{name:"kissing face",slug:"kissing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☺️":{name:"smiling face",slug:"smiling_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😚":{name:"kissing face with closed eyes",slug:"kissing_face_with_closed_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😙":{name:"kissing face with smiling eyes",slug:"kissing_face_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥲":{name:"smiling face with tear",slug:"smiling_face_with_tear",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😋":{name:"face savoring food",slug:"face_savoring_food",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😛":{name:"face with tongue",slug:"face_with_tongue",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😜":{name:"winking face with tongue",slug:"winking_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤪":{name:"zany face",slug:"zany_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😝":{name:"squinting face with tongue",slug:"squinting_face_with_tongue",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤑":{name:"money-mouth face",slug:"money_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤗":{name:"smiling face with open hands",slug:"smiling_face_with_open_hands",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤭":{name:"face with hand over mouth",slug:"face_with_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫢":{name:"face with open eyes and hand over mouth",slug:"face_with_open_eyes_and_hand_over_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🫣":{name:"face with peeking eye",slug:"face_with_peeking_eye",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤫":{name:"shushing face",slug:"shushing_face",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤔":{name:"thinking face",slug:"thinking_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫡":{name:"saluting face",slug:"saluting_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🤐":{name:"zipper-mouth face",slug:"zipper_mouth_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤨":{name:"face with raised eyebrow",slug:"face_with_raised_eyebrow",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😐":{name:"neutral face",slug:"neutral_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😑":{name:"expressionless face",slug:"expressionless_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😶":{name:"face without mouth",slug:"face_without_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫥":{name:"dotted line face",slug:"dotted_line_face",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😶‍🌫️":{name:"face in clouds",slug:"face_in_clouds",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"😏":{name:"smirking face",slug:"smirking_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😒":{name:"unamused face",slug:"unamused_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙄":{name:"face with rolling eyes",slug:"face_with_rolling_eyes",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😬":{name:"grimacing face",slug:"grimacing_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😮‍💨":{name:"face exhaling",slug:"face_exhaling",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤥":{name:"lying face",slug:"lying_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫨":{name:"shaking face",slug:"shaking_face",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🙂‍↔️":{name:"head shaking horizontally",slug:"head_shaking_horizontally",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🙂‍↕️":{name:"head shaking vertically",slug:"head_shaking_vertically",group:"Smileys & Emotion",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"😌":{name:"relieved face",slug:"relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😔":{name:"pensive face",slug:"pensive_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😪":{name:"sleepy face",slug:"sleepy_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤤":{name:"drooling face",slug:"drooling_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"😴":{name:"sleeping face",slug:"sleeping_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫩":{name:"face with bags under eyes",slug:"face_with_bags_under_eyes",group:"Smileys & Emotion",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"😷":{name:"face with medical mask",slug:"face_with_medical_mask",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤒":{name:"face with thermometer",slug:"face_with_thermometer",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤕":{name:"face with head-bandage",slug:"face_with_head_bandage",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤢":{name:"nauseated face",slug:"nauseated_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤮":{name:"face vomiting",slug:"face_vomiting",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤧":{name:"sneezing face",slug:"sneezing_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥵":{name:"hot face",slug:"hot_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥶":{name:"cold face",slug:"cold_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥴":{name:"woozy face",slug:"woozy_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"😵":{name:"face with crossed-out eyes",slug:"face_with_crossed_out_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😵‍💫":{name:"face with spiral eyes",slug:"face_with_spiral_eyes",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"🤯":{name:"exploding head",slug:"exploding_head",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🤠":{name:"cowboy hat face",slug:"cowboy_hat_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥳":{name:"partying face",slug:"partying_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥸":{name:"disguised face",slug:"disguised_face",group:"Smileys & Emotion",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"😎":{name:"smiling face with sunglasses",slug:"smiling_face_with_sunglasses",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🤓":{name:"nerd face",slug:"nerd_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧐":{name:"face with monocle",slug:"face_with_monocle",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😕":{name:"confused face",slug:"confused_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫤":{name:"face with diagonal mouth",slug:"face_with_diagonal_mouth",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😟":{name:"worried face",slug:"worried_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🙁":{name:"slightly frowning face",slug:"slightly_frowning_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☹️":{name:"frowning face",slug:"frowning_face",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"😮":{name:"face with open mouth",slug:"face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😯":{name:"hushed face",slug:"hushed_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😲":{name:"astonished face",slug:"astonished_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😳":{name:"flushed face",slug:"flushed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥺":{name:"pleading face",slug:"pleading_face",group:"Smileys & Emotion",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥹":{name:"face holding back tears",slug:"face_holding_back_tears",group:"Smileys & Emotion",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"😦":{name:"frowning face with open mouth",slug:"frowning_face_with_open_mouth",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😧":{name:"anguished face",slug:"anguished_face",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😨":{name:"fearful face",slug:"fearful_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😰":{name:"anxious face with sweat",slug:"anxious_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😥":{name:"sad but relieved face",slug:"sad_but_relieved_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😢":{name:"crying face",slug:"crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😭":{name:"loudly crying face",slug:"loudly_crying_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😱":{name:"face screaming in fear",slug:"face_screaming_in_fear",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😖":{name:"confounded face",slug:"confounded_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😣":{name:"persevering face",slug:"persevering_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😞":{name:"disappointed face",slug:"disappointed_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😓":{name:"downcast face with sweat",slug:"downcast_face_with_sweat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😩":{name:"weary face",slug:"weary_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😫":{name:"tired face",slug:"tired_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥱":{name:"yawning face",slug:"yawning_face",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"😤":{name:"face with steam from nose",slug:"face_with_steam_from_nose",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😡":{name:"enraged face",slug:"enraged_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😠":{name:"angry face",slug:"angry_face",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤬":{name:"face with symbols on mouth",slug:"face_with_symbols_on_mouth",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"😈":{name:"smiling face with horns",slug:"smiling_face_with_horns",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"👿":{name:"angry face with horns",slug:"angry_face_with_horns",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💀":{name:"skull",slug:"skull",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☠️":{name:"skull and crossbones",slug:"skull_and_crossbones",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💩":{name:"pile of poo",slug:"pile_of_poo",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤡":{name:"clown face",slug:"clown_face",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"👹":{name:"ogre",slug:"ogre",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👺":{name:"goblin",slug:"goblin",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👻":{name:"ghost",slug:"ghost",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👽":{name:"alien",slug:"alien",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👾":{name:"alien monster",slug:"alien_monster",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤖":{name:"robot",slug:"robot",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"😺":{name:"grinning cat",slug:"grinning_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😸":{name:"grinning cat with smiling eyes",slug:"grinning_cat_with_smiling_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😹":{name:"cat with tears of joy",slug:"cat_with_tears_of_joy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😻":{name:"smiling cat with heart-eyes",slug:"smiling_cat_with_heart_eyes",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😼":{name:"cat with wry smile",slug:"cat_with_wry_smile",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😽":{name:"kissing cat",slug:"kissing_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙀":{name:"weary cat",slug:"weary_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😿":{name:"crying cat",slug:"crying_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"😾":{name:"pouting cat",slug:"pouting_cat",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙈":{name:"see-no-evil monkey",slug:"see_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙉":{name:"hear-no-evil monkey",slug:"hear_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🙊":{name:"speak-no-evil monkey",slug:"speak_no_evil_monkey",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💌":{name:"love letter",slug:"love_letter",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💘":{name:"heart with arrow",slug:"heart_with_arrow",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💝":{name:"heart with ribbon",slug:"heart_with_ribbon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💖":{name:"sparkling heart",slug:"sparkling_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💗":{name:"growing heart",slug:"growing_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💓":{name:"beating heart",slug:"beating_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💞":{name:"revolving hearts",slug:"revolving_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💕":{name:"two hearts",slug:"two_hearts",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💟":{name:"heart decoration",slug:"heart_decoration",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❣️":{name:"heart exclamation",slug:"heart_exclamation",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💔":{name:"broken heart",slug:"broken_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❤️‍🔥":{name:"heart on fire",slug:"heart_on_fire",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️‍🩹":{name:"mending heart",slug:"mending_heart",group:"Smileys & Emotion",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!1},"❤️":{name:"red heart",slug:"red_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩷":{name:"pink heart",slug:"pink_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🧡":{name:"orange heart",slug:"orange_heart",group:"Smileys & Emotion",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"💛":{name:"yellow heart",slug:"yellow_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💚":{name:"green heart",slug:"green_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💙":{name:"blue heart",slug:"blue_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩵":{name:"light blue heart",slug:"light_blue_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"💜":{name:"purple heart",slug:"purple_heart",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤎":{name:"brown heart",slug:"brown_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🖤":{name:"black heart",slug:"black_heart",group:"Smileys & Emotion",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🩶":{name:"grey heart",slug:"grey_heart",group:"Smileys & Emotion",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🤍":{name:"white heart",slug:"white_heart",group:"Smileys & Emotion",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💋":{name:"kiss mark",slug:"kiss_mark",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💯":{name:"hundred points",slug:"hundred_points",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💢":{name:"anger symbol",slug:"anger_symbol",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💥":{name:"collision",slug:"collision",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💫":{name:"dizzy",slug:"dizzy",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💦":{name:"sweat droplets",slug:"sweat_droplets",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💨":{name:"dashing away",slug:"dashing_away",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕳️":{name:"hole",slug:"hole",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💬":{name:"speech balloon",slug:"speech_balloon",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️‍🗨️":{name:"eye in speech bubble",slug:"eye_in_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗨️":{name:"left speech bubble",slug:"left_speech_bubble",group:"Smileys & Emotion",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🗯️":{name:"right anger bubble",slug:"right_anger_bubble",group:"Smileys & Emotion",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💭":{name:"thought balloon",slug:"thought_balloon",group:"Smileys & Emotion",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💤":{name:"ZZZ",slug:"zzz",group:"Smileys & Emotion",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👋":{name:"waving hand",slug:"waving_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤚":{name:"raised back of hand",slug:"raised_back_of_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🖐️":{name:"hand with fingers splayed",slug:"hand_with_fingers_splayed",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✋":{name:"raised hand",slug:"raised_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖖":{name:"vulcan salute",slug:"vulcan_salute",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫱":{name:"rightwards hand",slug:"rightwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫲":{name:"leftwards hand",slug:"leftwards_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫳":{name:"palm down hand",slug:"palm_down_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫴":{name:"palm up hand",slug:"palm_up_hand",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫷":{name:"leftwards pushing hand",slug:"leftwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"🫸":{name:"rightwards pushing hand",slug:"rightwards_pushing_hand",group:"People & Body",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!0,skin_tone_support_unicode_version:"15.0"},"👌":{name:"OK hand",slug:"ok_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤌":{name:"pinched fingers",slug:"pinched_fingers",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤏":{name:"pinching hand",slug:"pinching_hand",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"✌️":{name:"victory hand",slug:"victory_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤞":{name:"crossed fingers",slug:"crossed_fingers",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫰":{name:"hand with index finger and thumb crossed",slug:"hand_with_index_finger_and_thumb_crossed",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤟":{name:"love-you gesture",slug:"love_you_gesture",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤘":{name:"sign of the horns",slug:"sign_of_the_horns",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤙":{name:"call me hand",slug:"call_me_hand",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👈":{name:"backhand index pointing left",slug:"backhand_index_pointing_left",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👉":{name:"backhand index pointing right",slug:"backhand_index_pointing_right",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👆":{name:"backhand index pointing up",slug:"backhand_index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🖕":{name:"middle finger",slug:"middle_finger",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👇":{name:"backhand index pointing down",slug:"backhand_index_pointing_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"☝️":{name:"index pointing up",slug:"index_pointing_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫵":{name:"index pointing at the viewer",slug:"index_pointing_at_the_viewer",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👍":{name:"thumbs up",slug:"thumbs_up",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👎":{name:"thumbs down",slug:"thumbs_down",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✊":{name:"raised fist",slug:"raised_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👊":{name:"oncoming fist",slug:"oncoming_fist",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤛":{name:"left-facing fist",slug:"left_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤜":{name:"right-facing fist",slug:"right_facing_fist",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👏":{name:"clapping hands",slug:"clapping_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙌":{name:"raising hands",slug:"raising_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🫶":{name:"heart hands",slug:"heart_hands",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"👐":{name:"open hands",slug:"open_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤲":{name:"palms up together",slug:"palms_up_together",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤝":{name:"handshake",slug:"handshake",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🙏":{name:"folded hands",slug:"folded_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"✍️":{name:"writing hand",slug:"writing_hand",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💅":{name:"nail polish",slug:"nail_polish",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤳":{name:"selfie",slug:"selfie",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"💪":{name:"flexed biceps",slug:"flexed_biceps",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦾":{name:"mechanical arm",slug:"mechanical_arm",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦿":{name:"mechanical leg",slug:"mechanical_leg",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦵":{name:"leg",slug:"leg",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦶":{name:"foot",slug:"foot",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👂":{name:"ear",slug:"ear",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🦻":{name:"ear with hearing aid",slug:"ear_with_hearing_aid",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👃":{name:"nose",slug:"nose",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧠":{name:"brain",slug:"brain",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🫀":{name:"anatomical heart",slug:"anatomical_heart",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🫁":{name:"lungs",slug:"lungs",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦷":{name:"tooth",slug:"tooth",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦴":{name:"bone",slug:"bone",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👀":{name:"eyes",slug:"eyes",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👁️":{name:"eye",slug:"eye",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👅":{name:"tongue",slug:"tongue",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👄":{name:"mouth",slug:"mouth",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫦":{name:"biting lip",slug:"biting_lip",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"👶":{name:"baby",slug:"baby",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧒":{name:"child",slug:"child",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👦":{name:"boy",slug:"boy",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👧":{name:"girl",slug:"girl",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧑":{name:"person",slug:"person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👱":{name:"person blond hair",slug:"person_blond_hair",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👨":{name:"man",slug:"man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧔":{name:"person beard",slug:"person_beard",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧔‍♂️":{name:"man beard",slug:"man_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"🧔‍♀️":{name:"woman beard",slug:"woman_beard",group:"People & Body",emoji_version:"13.1",unicode_version:"13.1",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍🦰":{name:"man red hair",slug:"man_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦱":{name:"man curly hair",slug:"man_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦳":{name:"man white hair",slug:"man_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👨‍🦲":{name:"man bald",slug:"man_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"👩":{name:"woman",slug:"woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👩‍🦰":{name:"woman red hair",slug:"woman_red_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦰":{name:"person red hair",slug:"person_red_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦱":{name:"woman curly hair",slug:"woman_curly_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦱":{name:"person curly hair",slug:"person_curly_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦳":{name:"woman white hair",slug:"woman_white_hair",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦳":{name:"person white hair",slug:"person_white_hair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👩‍🦲":{name:"woman bald",slug:"woman_bald",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧑‍🦲":{name:"person bald",slug:"person_bald",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👱‍♀️":{name:"woman blond hair",slug:"woman_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👱‍♂️":{name:"man blond hair",slug:"man_blond_hair",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧓":{name:"older person",slug:"older_person",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👴":{name:"old man",slug:"old_man",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👵":{name:"old woman",slug:"old_woman",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍":{name:"person frowning",slug:"person_frowning",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙍‍♂️":{name:"man frowning",slug:"man_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙍‍♀️":{name:"woman frowning",slug:"woman_frowning",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎":{name:"person pouting",slug:"person_pouting",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙎‍♂️":{name:"man pouting",slug:"man_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙎‍♀️":{name:"woman pouting",slug:"woman_pouting",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅":{name:"person gesturing NO",slug:"person_gesturing_no",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙅‍♂️":{name:"man gesturing NO",slug:"man_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙅‍♀️":{name:"woman gesturing NO",slug:"woman_gesturing_no",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆":{name:"person gesturing OK",slug:"person_gesturing_ok",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙆‍♂️":{name:"man gesturing OK",slug:"man_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙆‍♀️":{name:"woman gesturing OK",slug:"woman_gesturing_ok",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁":{name:"person tipping hand",slug:"person_tipping_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💁‍♂️":{name:"man tipping hand",slug:"man_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💁‍♀️":{name:"woman tipping hand",slug:"woman_tipping_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋":{name:"person raising hand",slug:"person_raising_hand",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙋‍♂️":{name:"man raising hand",slug:"man_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙋‍♀️":{name:"woman raising hand",slug:"woman_raising_hand",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧏":{name:"deaf person",slug:"deaf_person",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♂️":{name:"deaf man",slug:"deaf_man",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧏‍♀️":{name:"deaf woman",slug:"deaf_woman",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🙇":{name:"person bowing",slug:"person_bowing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🙇‍♂️":{name:"man bowing",slug:"man_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🙇‍♀️":{name:"woman bowing",slug:"woman_bowing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦":{name:"person facepalming",slug:"person_facepalming",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤦‍♂️":{name:"man facepalming",slug:"man_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤦‍♀️":{name:"woman facepalming",slug:"woman_facepalming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷":{name:"person shrugging",slug:"person_shrugging",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤷‍♂️":{name:"man shrugging",slug:"man_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤷‍♀️":{name:"woman shrugging",slug:"woman_shrugging",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚕️":{name:"health worker",slug:"health_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚕️":{name:"man health worker",slug:"man_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚕️":{name:"woman health worker",slug:"woman_health_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎓":{name:"student",slug:"student",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎓":{name:"man student",slug:"man_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎓":{name:"woman student",slug:"woman_student",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏫":{name:"teacher",slug:"teacher",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏫":{name:"man teacher",slug:"man_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏫":{name:"woman teacher",slug:"woman_teacher",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍⚖️":{name:"judge",slug:"judge",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍⚖️":{name:"man judge",slug:"man_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍⚖️":{name:"woman judge",slug:"woman_judge",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🌾":{name:"farmer",slug:"farmer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🌾":{name:"man farmer",slug:"man_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🌾":{name:"woman farmer",slug:"woman_farmer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🍳":{name:"cook",slug:"cook",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🍳":{name:"man cook",slug:"man_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🍳":{name:"woman cook",slug:"woman_cook",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔧":{name:"mechanic",slug:"mechanic",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔧":{name:"man mechanic",slug:"man_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔧":{name:"woman mechanic",slug:"woman_mechanic",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🏭":{name:"factory worker",slug:"factory_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🏭":{name:"man factory worker",slug:"man_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🏭":{name:"woman factory worker",slug:"woman_factory_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💼":{name:"office worker",slug:"office_worker",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💼":{name:"man office worker",slug:"man_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💼":{name:"woman office worker",slug:"woman_office_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🔬":{name:"scientist",slug:"scientist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🔬":{name:"man scientist",slug:"man_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🔬":{name:"woman scientist",slug:"woman_scientist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍💻":{name:"technologist",slug:"technologist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍💻":{name:"man technologist",slug:"man_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍💻":{name:"woman technologist",slug:"woman_technologist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎤":{name:"singer",slug:"singer",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎤":{name:"man singer",slug:"man_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎤":{name:"woman singer",slug:"woman_singer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🎨":{name:"artist",slug:"artist",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🎨":{name:"man artist",slug:"man_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🎨":{name:"woman artist",slug:"woman_artist",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍✈️":{name:"pilot",slug:"pilot",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍✈️":{name:"man pilot",slug:"man_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍✈️":{name:"woman pilot",slug:"woman_pilot",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚀":{name:"astronaut",slug:"astronaut",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚀":{name:"man astronaut",slug:"man_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚀":{name:"woman astronaut",slug:"woman_astronaut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🚒":{name:"firefighter",slug:"firefighter",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"👨‍🚒":{name:"man firefighter",slug:"man_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👩‍🚒":{name:"woman firefighter",slug:"woman_firefighter",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮":{name:"police officer",slug:"police_officer",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👮‍♂️":{name:"man police officer",slug:"man_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👮‍♀️":{name:"woman police officer",slug:"woman_police_officer",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️":{name:"detective",slug:"detective",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🕵️‍♂️":{name:"man detective",slug:"man_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🕵️‍♀️":{name:"woman detective",slug:"woman_detective",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂":{name:"guard",slug:"guard",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💂‍♂️":{name:"man guard",slug:"man_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💂‍♀️":{name:"woman guard",slug:"woman_guard",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🥷":{name:"ninja",slug:"ninja",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👷":{name:"construction worker",slug:"construction_worker",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👷‍♂️":{name:"man construction worker",slug:"man_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👷‍♀️":{name:"woman construction worker",slug:"woman_construction_worker",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🫅":{name:"person with crown",slug:"person_with_crown",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤴":{name:"prince",slug:"prince",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"👸":{name:"princess",slug:"princess",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳":{name:"person wearing turban",slug:"person_wearing_turban",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👳‍♂️":{name:"man wearing turban",slug:"man_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👳‍♀️":{name:"woman wearing turban",slug:"woman_wearing_turban",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👲":{name:"person with skullcap",slug:"person_with_skullcap",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🧕":{name:"woman with headscarf",slug:"woman_with_headscarf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤵":{name:"person in tuxedo",slug:"person_in_tuxedo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤵‍♂️":{name:"man in tuxedo",slug:"man_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤵‍♀️":{name:"woman in tuxedo",slug:"woman_in_tuxedo",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰":{name:"person with veil",slug:"person_with_veil",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"👰‍♂️":{name:"man with veil",slug:"man_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👰‍♀️":{name:"woman with veil",slug:"woman_with_veil",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🤰":{name:"pregnant woman",slug:"pregnant_woman",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🫃":{name:"pregnant man",slug:"pregnant_man",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🫄":{name:"pregnant person",slug:"pregnant_person",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!0,skin_tone_support_unicode_version:"14.0"},"🤱":{name:"breast-feeding",slug:"breast_feeding",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"👩‍🍼":{name:"woman feeding baby",slug:"woman_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👨‍🍼":{name:"man feeding baby",slug:"man_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🧑‍🍼":{name:"person feeding baby",slug:"person_feeding_baby",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"👼":{name:"baby angel",slug:"baby_angel",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🎅":{name:"Santa Claus",slug:"santa_claus",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🤶":{name:"Mrs. Claus",slug:"mrs_claus",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🧑‍🎄":{name:"Mx Claus",slug:"mx_claus",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.0"},"🦸":{name:"superhero",slug:"superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♂️":{name:"man superhero",slug:"man_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦸‍♀️":{name:"woman superhero",slug:"woman_superhero",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹":{name:"supervillain",slug:"supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♂️":{name:"man supervillain",slug:"man_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🦹‍♀️":{name:"woman supervillain",slug:"woman_supervillain",group:"People & Body",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!0,skin_tone_support_unicode_version:"11.0"},"🧙":{name:"mage",slug:"mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♂️":{name:"man mage",slug:"man_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧙‍♀️":{name:"woman mage",slug:"woman_mage",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚":{name:"fairy",slug:"fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♂️":{name:"man fairy",slug:"man_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧚‍♀️":{name:"woman fairy",slug:"woman_fairy",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛":{name:"vampire",slug:"vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♂️":{name:"man vampire",slug:"man_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧛‍♀️":{name:"woman vampire",slug:"woman_vampire",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜":{name:"merperson",slug:"merperson",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♂️":{name:"merman",slug:"merman",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧜‍♀️":{name:"mermaid",slug:"mermaid",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝":{name:"elf",slug:"elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♂️":{name:"man elf",slug:"man_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧝‍♀️":{name:"woman elf",slug:"woman_elf",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧞":{name:"genie",slug:"genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♂️":{name:"man genie",slug:"man_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧞‍♀️":{name:"woman genie",slug:"woman_genie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟":{name:"zombie",slug:"zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♂️":{name:"man zombie",slug:"man_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧟‍♀️":{name:"woman zombie",slug:"woman_zombie",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧌":{name:"troll",slug:"troll",group:"People & Body",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"💆":{name:"person getting massage",slug:"person_getting_massage",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💆‍♂️":{name:"man getting massage",slug:"man_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💆‍♀️":{name:"woman getting massage",slug:"woman_getting_massage",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇":{name:"person getting haircut",slug:"person_getting_haircut",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"💇‍♂️":{name:"man getting haircut",slug:"man_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"💇‍♀️":{name:"woman getting haircut",slug:"woman_getting_haircut",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶":{name:"person walking",slug:"person_walking",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚶‍♂️":{name:"man walking",slug:"man_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍♀️":{name:"woman walking",slug:"woman_walking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚶‍➡️":{name:"person walking facing right",slug:"person_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♀️‍➡️":{name:"woman walking facing right",slug:"woman_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🚶‍♂️‍➡️":{name:"man walking facing right",slug:"man_walking_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧍":{name:"person standing",slug:"person_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♂️":{name:"man standing",slug:"man_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧍‍♀️":{name:"woman standing",slug:"woman_standing",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎":{name:"person kneeling",slug:"person_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♂️":{name:"man kneeling",slug:"man_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍♀️":{name:"woman kneeling",slug:"woman_kneeling",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"🧎‍➡️":{name:"person kneeling facing right",slug:"person_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♀️‍➡️":{name:"woman kneeling facing right",slug:"woman_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧎‍♂️‍➡️":{name:"man kneeling facing right",slug:"man_kneeling_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦯":{name:"person with white cane",slug:"person_with_white_cane",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦯‍➡️":{name:"person with white cane facing right",slug:"person_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦯":{name:"man with white cane",slug:"man_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦯‍➡️":{name:"man with white cane facing right",slug:"man_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦯":{name:"woman with white cane",slug:"woman_with_white_cane",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦯‍➡️":{name:"woman with white cane facing right",slug:"woman_with_white_cane_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦼":{name:"person in motorized wheelchair",slug:"person_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦼‍➡️":{name:"person in motorized wheelchair facing right",slug:"person_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦼":{name:"man in motorized wheelchair",slug:"man_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦼‍➡️":{name:"man in motorized wheelchair facing right",slug:"man_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦼":{name:"woman in motorized wheelchair",slug:"woman_in_motorized_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦼‍➡️":{name:"woman in motorized wheelchair facing right",slug:"woman_in_motorized_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🧑‍🦽":{name:"person in manual wheelchair",slug:"person_in_manual_wheelchair",group:"People & Body",emoji_version:"12.1",unicode_version:"12.1",skin_tone_support:!0,skin_tone_support_unicode_version:"12.1"},"🧑‍🦽‍➡️":{name:"person in manual wheelchair facing right",slug:"person_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👨‍🦽":{name:"man in manual wheelchair",slug:"man_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👨‍🦽‍➡️":{name:"man in manual wheelchair facing right",slug:"man_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"👩‍🦽":{name:"woman in manual wheelchair",slug:"woman_in_manual_wheelchair",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👩‍🦽‍➡️":{name:"woman in manual wheelchair facing right",slug:"woman_in_manual_wheelchair_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃":{name:"person running",slug:"person_running",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏃‍♂️":{name:"man running",slug:"man_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍♀️":{name:"woman running",slug:"woman_running",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏃‍➡️":{name:"person running facing right",slug:"person_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♀️‍➡️":{name:"woman running facing right",slug:"woman_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"🏃‍♂️‍➡️":{name:"man running facing right",slug:"man_running_facing_right",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!0,skin_tone_support_unicode_version:"15.1"},"💃":{name:"woman dancing",slug:"woman_dancing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🕺":{name:"man dancing",slug:"man_dancing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🕴️":{name:"person in suit levitating",slug:"person_in_suit_levitating",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"👯":{name:"people with bunny ears",slug:"people_with_bunny_ears",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👯‍♂️":{name:"men with bunny ears",slug:"men_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👯‍♀️":{name:"women with bunny ears",slug:"women_with_bunny_ears",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🧖":{name:"person in steamy room",slug:"person_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♂️":{name:"man in steamy room",slug:"man_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧖‍♀️":{name:"woman in steamy room",slug:"woman_in_steamy_room",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗":{name:"person climbing",slug:"person_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♂️":{name:"man climbing",slug:"man_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧗‍♀️":{name:"woman climbing",slug:"woman_climbing",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🤺":{name:"person fencing",slug:"person_fencing",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🏇":{name:"horse racing",slug:"horse_racing",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"⛷️":{name:"skier",slug:"skier",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏂":{name:"snowboarder",slug:"snowboarder",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏌️":{name:"person golfing",slug:"person_golfing",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♂️":{name:"man golfing",slug:"man_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏌️‍♀️":{name:"woman golfing",slug:"woman_golfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄":{name:"person surfing",slug:"person_surfing",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏄‍♂️":{name:"man surfing",slug:"man_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏄‍♀️":{name:"woman surfing",slug:"woman_surfing",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣":{name:"person rowing boat",slug:"person_rowing_boat",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚣‍♂️":{name:"man rowing boat",slug:"man_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚣‍♀️":{name:"woman rowing boat",slug:"woman_rowing_boat",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊":{name:"person swimming",slug:"person_swimming",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🏊‍♂️":{name:"man swimming",slug:"man_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏊‍♀️":{name:"woman swimming",slug:"woman_swimming",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️":{name:"person bouncing ball",slug:"person_bouncing_ball",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"⛹️‍♂️":{name:"man bouncing ball",slug:"man_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"⛹️‍♀️":{name:"woman bouncing ball",slug:"woman_bouncing_ball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️":{name:"person lifting weights",slug:"person_lifting_weights",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!0,skin_tone_support_unicode_version:"2.0"},"🏋️‍♂️":{name:"man lifting weights",slug:"man_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🏋️‍♀️":{name:"woman lifting weights",slug:"woman_lifting_weights",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴":{name:"person biking",slug:"person_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚴‍♂️":{name:"man biking",slug:"man_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚴‍♀️":{name:"woman biking",slug:"woman_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵":{name:"person mountain biking",slug:"person_mountain_biking",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🚵‍♂️":{name:"man mountain biking",slug:"man_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🚵‍♀️":{name:"woman mountain biking",slug:"woman_mountain_biking",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸":{name:"person cartwheeling",slug:"person_cartwheeling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤸‍♂️":{name:"man cartwheeling",slug:"man_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤸‍♀️":{name:"woman cartwheeling",slug:"woman_cartwheeling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤼":{name:"people wrestling",slug:"people_wrestling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🤼‍♂️":{name:"men wrestling",slug:"men_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤼‍♀️":{name:"women wrestling",slug:"women_wrestling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🤽":{name:"person playing water polo",slug:"person_playing_water_polo",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤽‍♂️":{name:"man playing water polo",slug:"man_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤽‍♀️":{name:"woman playing water polo",slug:"woman_playing_water_polo",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾":{name:"person playing handball",slug:"person_playing_handball",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤾‍♂️":{name:"man playing handball",slug:"man_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤾‍♀️":{name:"woman playing handball",slug:"woman_playing_handball",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹":{name:"person juggling",slug:"person_juggling",group:"People & Body",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!0,skin_tone_support_unicode_version:"3.0"},"🤹‍♂️":{name:"man juggling",slug:"man_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🤹‍♀️":{name:"woman juggling",slug:"woman_juggling",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧘":{name:"person in lotus position",slug:"person_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♂️":{name:"man in lotus position",slug:"man_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🧘‍♀️":{name:"woman in lotus position",slug:"woman_in_lotus_position",group:"People & Body",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!0,skin_tone_support_unicode_version:"5.0"},"🛀":{name:"person taking bath",slug:"person_taking_bath",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"1.0"},"🛌":{name:"person in bed",slug:"person_in_bed",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"4.0"},"🧑‍🤝‍🧑":{name:"people holding hands",slug:"people_holding_hands",group:"People & Body",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👭":{name:"women holding hands",slug:"women_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👫":{name:"woman and man holding hands",slug:"woman_and_man_holding_hands",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"👬":{name:"men holding hands",slug:"men_holding_hands",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!0,skin_tone_support_unicode_version:"12.0"},"💏":{name:"kiss",slug:"kiss",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👨":{name:"kiss woman, man",slug:"kiss_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍💋‍👨":{name:"kiss man, man",slug:"kiss_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍💋‍👩":{name:"kiss woman, woman",slug:"kiss_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"💑":{name:"couple with heart",slug:"couple_with_heart",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👨":{name:"couple with heart woman, man",slug:"couple_with_heart_woman_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍❤️‍👨":{name:"couple with heart man, man",slug:"couple_with_heart_man_man",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👩‍❤️‍👩":{name:"couple with heart woman, woman",slug:"couple_with_heart_woman_woman",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!0,skin_tone_support_unicode_version:"13.1"},"👨‍👩‍👦":{name:"family man, woman, boy",slug:"family_man_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧":{name:"family man, woman, girl",slug:"family_man_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👦":{name:"family man, woman, girl, boy",slug:"family_man_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👦‍👦":{name:"family man, woman, boy, boy",slug:"family_man_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👩‍👧‍👧":{name:"family man, woman, girl, girl",slug:"family_man_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦":{name:"family man, man, boy",slug:"family_man_man_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧":{name:"family man, man, girl",slug:"family_man_man_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👦":{name:"family man, man, girl, boy",slug:"family_man_man_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👦‍👦":{name:"family man, man, boy, boy",slug:"family_man_man_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👨‍👧‍👧":{name:"family man, man, girl, girl",slug:"family_man_man_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦":{name:"family woman, woman, boy",slug:"family_woman_woman_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧":{name:"family woman, woman, girl",slug:"family_woman_woman_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👦":{name:"family woman, woman, girl, boy",slug:"family_woman_woman_girl_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👦‍👦":{name:"family woman, woman, boy, boy",slug:"family_woman_woman_boy_boy",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👩‍👩‍👧‍👧":{name:"family woman, woman, girl, girl",slug:"family_woman_woman_girl_girl",group:"People & Body",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"👨‍👦":{name:"family man, boy",slug:"family_man_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👦‍👦":{name:"family man, boy, boy",slug:"family_man_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧":{name:"family man, girl",slug:"family_man_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👦":{name:"family man, girl, boy",slug:"family_man_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👨‍👧‍👧":{name:"family man, girl, girl",slug:"family_man_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦":{name:"family woman, boy",slug:"family_woman_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👦‍👦":{name:"family woman, boy, boy",slug:"family_woman_boy_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧":{name:"family woman, girl",slug:"family_woman_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👦":{name:"family woman, girl, boy",slug:"family_woman_girl_boy",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"👩‍👧‍👧":{name:"family woman, girl, girl",slug:"family_woman_girl_girl",group:"People & Body",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🗣️":{name:"speaking head",slug:"speaking_head",group:"People & Body",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"👤":{name:"bust in silhouette",slug:"bust_in_silhouette",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👥":{name:"busts in silhouette",slug:"busts_in_silhouette",group:"People & Body",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫂":{name:"people hugging",slug:"people_hugging",group:"People & Body",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👪":{name:"family",slug:"family",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧑‍🧑‍🧒":{name:"family adult, adult, child",slug:"family_adult_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧑‍🧒‍🧒":{name:"family adult, adult, child, child",slug:"family_adult_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒":{name:"family adult, child",slug:"family_adult_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🧑‍🧒‍🧒":{name:"family adult, child, child",slug:"family_adult_child_child",group:"People & Body",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"👣":{name:"footprints",slug:"footprints",group:"People & Body",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫆":{name:"fingerprint",slug:"fingerprint",group:"People & Body",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🐵":{name:"monkey face",slug:"monkey_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐒":{name:"monkey",slug:"monkey",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦍":{name:"gorilla",slug:"gorilla",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦧":{name:"orangutan",slug:"orangutan",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐶":{name:"dog face",slug:"dog_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐕":{name:"dog",slug:"dog",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦮":{name:"guide dog",slug:"guide_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐕‍🦺":{name:"service dog",slug:"service_dog",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐩":{name:"poodle",slug:"poodle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐺":{name:"wolf",slug:"wolf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦊":{name:"fox",slug:"fox",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦝":{name:"raccoon",slug:"raccoon",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐱":{name:"cat face",slug:"cat_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐈":{name:"cat",slug:"cat",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🐈‍⬛":{name:"black cat",slug:"black_cat",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦁":{name:"lion",slug:"lion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐯":{name:"tiger face",slug:"tiger_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐅":{name:"tiger",slug:"tiger",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐆":{name:"leopard",slug:"leopard",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐴":{name:"horse face",slug:"horse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫎":{name:"moose",slug:"moose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫏":{name:"donkey",slug:"donkey",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐎":{name:"horse",slug:"horse",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦄":{name:"unicorn",slug:"unicorn",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦓":{name:"zebra",slug:"zebra",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦌":{name:"deer",slug:"deer",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦬":{name:"bison",slug:"bison",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐮":{name:"cow face",slug:"cow_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐂":{name:"ox",slug:"ox",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐃":{name:"water buffalo",slug:"water_buffalo",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐄":{name:"cow",slug:"cow",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐷":{name:"pig face",slug:"pig_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐖":{name:"pig",slug:"pig",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐗":{name:"boar",slug:"boar",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐽":{name:"pig nose",slug:"pig_nose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐏":{name:"ram",slug:"ram",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐑":{name:"ewe",slug:"ewe",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐐":{name:"goat",slug:"goat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐪":{name:"camel",slug:"camel",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐫":{name:"two-hump camel",slug:"two_hump_camel",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦙":{name:"llama",slug:"llama",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦒":{name:"giraffe",slug:"giraffe",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐘":{name:"elephant",slug:"elephant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦣":{name:"mammoth",slug:"mammoth",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦏":{name:"rhinoceros",slug:"rhinoceros",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦛":{name:"hippopotamus",slug:"hippopotamus",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐭":{name:"mouse face",slug:"mouse_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐁":{name:"mouse",slug:"mouse",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐀":{name:"rat",slug:"rat",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐹":{name:"hamster",slug:"hamster",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐰":{name:"rabbit face",slug:"rabbit_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐇":{name:"rabbit",slug:"rabbit",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐿️":{name:"chipmunk",slug:"chipmunk",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦫":{name:"beaver",slug:"beaver",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦔":{name:"hedgehog",slug:"hedgehog",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦇":{name:"bat",slug:"bat",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐻":{name:"bear",slug:"bear",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐻‍❄️":{name:"polar bear",slug:"polar_bear",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐨":{name:"koala",slug:"koala",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐼":{name:"panda",slug:"panda",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦥":{name:"sloth",slug:"sloth",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦦":{name:"otter",slug:"otter",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦨":{name:"skunk",slug:"skunk",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦘":{name:"kangaroo",slug:"kangaroo",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦡":{name:"badger",slug:"badger",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🐾":{name:"paw prints",slug:"paw_prints",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦃":{name:"turkey",slug:"turkey",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐔":{name:"chicken",slug:"chicken",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐓":{name:"rooster",slug:"rooster",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐣":{name:"hatching chick",slug:"hatching_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐤":{name:"baby chick",slug:"baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐥":{name:"front-facing baby chick",slug:"front_facing_baby_chick",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐦":{name:"bird",slug:"bird",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐧":{name:"penguin",slug:"penguin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕊️":{name:"dove",slug:"dove",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦅":{name:"eagle",slug:"eagle",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦆":{name:"duck",slug:"duck",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦢":{name:"swan",slug:"swan",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦉":{name:"owl",slug:"owl",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦤":{name:"dodo",slug:"dodo",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪶":{name:"feather",slug:"feather",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦩":{name:"flamingo",slug:"flamingo",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦚":{name:"peacock",slug:"peacock",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦜":{name:"parrot",slug:"parrot",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪽":{name:"wing",slug:"wing",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍⬛":{name:"black bird",slug:"black_bird",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪿":{name:"goose",slug:"goose",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🐦‍🔥":{name:"phoenix",slug:"phoenix",group:"Animals & Nature",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🐸":{name:"frog",slug:"frog",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐊":{name:"crocodile",slug:"crocodile",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐢":{name:"turtle",slug:"turtle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦎":{name:"lizard",slug:"lizard",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐍":{name:"snake",slug:"snake",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐲":{name:"dragon face",slug:"dragon_face",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐉":{name:"dragon",slug:"dragon",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦕":{name:"sauropod",slug:"sauropod",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🦖":{name:"T-Rex",slug:"t_rex",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🐳":{name:"spouting whale",slug:"spouting_whale",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐋":{name:"whale",slug:"whale",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🐬":{name:"dolphin",slug:"dolphin",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦭":{name:"seal",slug:"seal",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐟":{name:"fish",slug:"fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐠":{name:"tropical fish",slug:"tropical_fish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐡":{name:"blowfish",slug:"blowfish",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦈":{name:"shark",slug:"shark",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐙":{name:"octopus",slug:"octopus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐚":{name:"spiral shell",slug:"spiral_shell",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪸":{name:"coral",slug:"coral",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪼":{name:"jellyfish",slug:"jellyfish",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🦀":{name:"crab",slug:"crab",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦞":{name:"lobster",slug:"lobster",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦐":{name:"shrimp",slug:"shrimp",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦑":{name:"squid",slug:"squid",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦪":{name:"oyster",slug:"oyster",group:"Animals & Nature",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🐌":{name:"snail",slug:"snail",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦋":{name:"butterfly",slug:"butterfly",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🐛":{name:"bug",slug:"bug",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐜":{name:"ant",slug:"ant",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🐝":{name:"honeybee",slug:"honeybee",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪲":{name:"beetle",slug:"beetle",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🐞":{name:"lady beetle",slug:"lady_beetle",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🦗":{name:"cricket",slug:"cricket",group:"Animals & Nature",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪳":{name:"cockroach",slug:"cockroach",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🕷️":{name:"spider",slug:"spider",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕸️":{name:"spider web",slug:"spider_web",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🦂":{name:"scorpion",slug:"scorpion",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦟":{name:"mosquito",slug:"mosquito",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪰":{name:"fly",slug:"fly",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪱":{name:"worm",slug:"worm",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🦠":{name:"microbe",slug:"microbe",group:"Animals & Nature",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💐":{name:"bouquet",slug:"bouquet",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌸":{name:"cherry blossom",slug:"cherry_blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💮":{name:"white flower",slug:"white_flower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪷":{name:"lotus",slug:"lotus",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏵️":{name:"rosette",slug:"rosette",group:"Animals & Nature",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌹":{name:"rose",slug:"rose",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥀":{name:"wilted flower",slug:"wilted_flower",group:"Animals & Nature",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌺":{name:"hibiscus",slug:"hibiscus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌻":{name:"sunflower",slug:"sunflower",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌼":{name:"blossom",slug:"blossom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌷":{name:"tulip",slug:"tulip",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪻":{name:"hyacinth",slug:"hyacinth",group:"Animals & Nature",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🌱":{name:"seedling",slug:"seedling",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪴":{name:"potted plant",slug:"potted_plant",group:"Animals & Nature",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🌲":{name:"evergreen tree",slug:"evergreen_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌳":{name:"deciduous tree",slug:"deciduous_tree",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌴":{name:"palm tree",slug:"palm_tree",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌵":{name:"cactus",slug:"cactus",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌾":{name:"sheaf of rice",slug:"sheaf_of_rice",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌿":{name:"herb",slug:"herb",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☘️":{name:"shamrock",slug:"shamrock",group:"Animals & Nature",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍀":{name:"four leaf clover",slug:"four_leaf_clover",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍁":{name:"maple leaf",slug:"maple_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍂":{name:"fallen leaf",slug:"fallen_leaf",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍃":{name:"leaf fluttering in wind",slug:"leaf_fluttering_in_wind",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪹":{name:"empty nest",slug:"empty_nest",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪺":{name:"nest with eggs",slug:"nest_with_eggs",group:"Animals & Nature",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🍄":{name:"mushroom",slug:"mushroom",group:"Animals & Nature",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪾":{name:"leafless tree",slug:"leafless_tree",group:"Animals & Nature",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍇":{name:"grapes",slug:"grapes",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍈":{name:"melon",slug:"melon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍉":{name:"watermelon",slug:"watermelon",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍊":{name:"tangerine",slug:"tangerine",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍋":{name:"lemon",slug:"lemon",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍋‍🟩":{name:"lime",slug:"lime",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🍌":{name:"banana",slug:"banana",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍍":{name:"pineapple",slug:"pineapple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥭":{name:"mango",slug:"mango",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍎":{name:"red apple",slug:"red_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍏":{name:"green apple",slug:"green_apple",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍐":{name:"pear",slug:"pear",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍑":{name:"peach",slug:"peach",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍒":{name:"cherries",slug:"cherries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍓":{name:"strawberry",slug:"strawberry",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫐":{name:"blueberries",slug:"blueberries",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥝":{name:"kiwi fruit",slug:"kiwi_fruit",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍅":{name:"tomato",slug:"tomato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫒":{name:"olive",slug:"olive",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥥":{name:"coconut",slug:"coconut",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥑":{name:"avocado",slug:"avocado",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍆":{name:"eggplant",slug:"eggplant",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥔":{name:"potato",slug:"potato",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥕":{name:"carrot",slug:"carrot",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🌽":{name:"ear of corn",slug:"ear_of_corn",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌶️":{name:"hot pepper",slug:"hot_pepper",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🫑":{name:"bell pepper",slug:"bell_pepper",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥒":{name:"cucumber",slug:"cucumber",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥬":{name:"leafy green",slug:"leafy_green",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥦":{name:"broccoli",slug:"broccoli",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧄":{name:"garlic",slug:"garlic",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧅":{name:"onion",slug:"onion",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥜":{name:"peanuts",slug:"peanuts",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫘":{name:"beans",slug:"beans",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🌰":{name:"chestnut",slug:"chestnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫚":{name:"ginger root",slug:"ginger_root",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🫛":{name:"pea pod",slug:"pea_pod",group:"Food & Drink",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🍄‍🟫":{name:"brown mushroom",slug:"brown_mushroom",group:"Food & Drink",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"🫜":{name:"root vegetable",slug:"root_vegetable",group:"Food & Drink",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🍞":{name:"bread",slug:"bread",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥐":{name:"croissant",slug:"croissant",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥖":{name:"baguette bread",slug:"baguette_bread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫓":{name:"flatbread",slug:"flatbread",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥨":{name:"pretzel",slug:"pretzel",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥯":{name:"bagel",slug:"bagel",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥞":{name:"pancakes",slug:"pancakes",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧇":{name:"waffle",slug:"waffle",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧀":{name:"cheese wedge",slug:"cheese_wedge",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍖":{name:"meat on bone",slug:"meat_on_bone",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍗":{name:"poultry leg",slug:"poultry_leg",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥩":{name:"cut of meat",slug:"cut_of_meat",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥓":{name:"bacon",slug:"bacon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍔":{name:"hamburger",slug:"hamburger",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍟":{name:"french fries",slug:"french_fries",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍕":{name:"pizza",slug:"pizza",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌭":{name:"hot dog",slug:"hot_dog",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥪":{name:"sandwich",slug:"sandwich",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🌮":{name:"taco",slug:"taco",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌯":{name:"burrito",slug:"burrito",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🫔":{name:"tamale",slug:"tamale",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥙":{name:"stuffed flatbread",slug:"stuffed_flatbread",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🧆":{name:"falafel",slug:"falafel",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥚":{name:"egg",slug:"egg",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍳":{name:"cooking",slug:"cooking",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥘":{name:"shallow pan of food",slug:"shallow_pan_of_food",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍲":{name:"pot of food",slug:"pot_of_food",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫕":{name:"fondue",slug:"fondue",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🥣":{name:"bowl with spoon",slug:"bowl_with_spoon",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥗":{name:"green salad",slug:"green_salad",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🍿":{name:"popcorn",slug:"popcorn",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧈":{name:"butter",slug:"butter",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧂":{name:"salt",slug:"salt",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥫":{name:"canned food",slug:"canned_food",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍱":{name:"bento box",slug:"bento_box",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍘":{name:"rice cracker",slug:"rice_cracker",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍙":{name:"rice ball",slug:"rice_ball",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍚":{name:"cooked rice",slug:"cooked_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍛":{name:"curry rice",slug:"curry_rice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍜":{name:"steaming bowl",slug:"steaming_bowl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍝":{name:"spaghetti",slug:"spaghetti",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍠":{name:"roasted sweet potato",slug:"roasted_sweet_potato",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍢":{name:"oden",slug:"oden",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍣":{name:"sushi",slug:"sushi",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍤":{name:"fried shrimp",slug:"fried_shrimp",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍥":{name:"fish cake with swirl",slug:"fish_cake_with_swirl",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥮":{name:"moon cake",slug:"moon_cake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🍡":{name:"dango",slug:"dango",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥟":{name:"dumpling",slug:"dumpling",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥠":{name:"fortune cookie",slug:"fortune_cookie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥡":{name:"takeout box",slug:"takeout_box",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍦":{name:"soft ice cream",slug:"soft_ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍧":{name:"shaved ice",slug:"shaved_ice",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍨":{name:"ice cream",slug:"ice_cream",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍩":{name:"doughnut",slug:"doughnut",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍪":{name:"cookie",slug:"cookie",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎂":{name:"birthday cake",slug:"birthday_cake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍰":{name:"shortcake",slug:"shortcake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧁":{name:"cupcake",slug:"cupcake",group:"Food & Drink",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥧":{name:"pie",slug:"pie",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍫":{name:"chocolate bar",slug:"chocolate_bar",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍬":{name:"candy",slug:"candy",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍭":{name:"lollipop",slug:"lollipop",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍮":{name:"custard",slug:"custard",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍯":{name:"honey pot",slug:"honey_pot",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍼":{name:"baby bottle",slug:"baby_bottle",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥛":{name:"glass of milk",slug:"glass_of_milk",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"☕":{name:"hot beverage",slug:"hot_beverage",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫖":{name:"teapot",slug:"teapot",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🍵":{name:"teacup without handle",slug:"teacup_without_handle",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍶":{name:"sake",slug:"sake",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍾":{name:"bottle with popping cork",slug:"bottle_with_popping_cork",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🍷":{name:"wine glass",slug:"wine_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍸":{name:"cocktail glass",slug:"cocktail_glass",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍹":{name:"tropical drink",slug:"tropical_drink",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍺":{name:"beer mug",slug:"beer_mug",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🍻":{name:"clinking beer mugs",slug:"clinking_beer_mugs",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥂":{name:"clinking glasses",slug:"clinking_glasses",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥃":{name:"tumbler glass",slug:"tumbler_glass",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🫗":{name:"pouring liquid",slug:"pouring_liquid",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🥤":{name:"cup with straw",slug:"cup_with_straw",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧋":{name:"bubble tea",slug:"bubble_tea",group:"Food & Drink",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧃":{name:"beverage box",slug:"beverage_box",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧉":{name:"mate",slug:"mate",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧊":{name:"ice",slug:"ice",group:"Food & Drink",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥢":{name:"chopsticks",slug:"chopsticks",group:"Food & Drink",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🍽️":{name:"fork and knife with plate",slug:"fork_and_knife_with_plate",group:"Food & Drink",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🍴":{name:"fork and knife",slug:"fork_and_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥄":{name:"spoon",slug:"spoon",group:"Food & Drink",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🔪":{name:"kitchen knife",slug:"kitchen_knife",group:"Food & Drink",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫙":{name:"jar",slug:"jar",group:"Food & Drink",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏺":{name:"amphora",slug:"amphora",group:"Food & Drink",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌍":{name:"globe showing Europe-Africa",slug:"globe_showing_europe_africa",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌎":{name:"globe showing Americas",slug:"globe_showing_americas",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌏":{name:"globe showing Asia-Australia",slug:"globe_showing_asia_australia",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌐":{name:"globe with meridians",slug:"globe_with_meridians",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗺️":{name:"world map",slug:"world_map",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗾":{name:"map of Japan",slug:"map_of_japan",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧭":{name:"compass",slug:"compass",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏔️":{name:"snow-capped mountain",slug:"snow_capped_mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛰️":{name:"mountain",slug:"mountain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌋":{name:"volcano",slug:"volcano",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗻":{name:"mount fuji",slug:"mount_fuji",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏕️":{name:"camping",slug:"camping",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏖️":{name:"beach with umbrella",slug:"beach_with_umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏜️":{name:"desert",slug:"desert",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏝️":{name:"desert island",slug:"desert_island",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏞️":{name:"national park",slug:"national_park",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏟️":{name:"stadium",slug:"stadium",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏛️":{name:"classical building",slug:"classical_building",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏗️":{name:"building construction",slug:"building_construction",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧱":{name:"brick",slug:"brick",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪨":{name:"rock",slug:"rock",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪵":{name:"wood",slug:"wood",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛖":{name:"hut",slug:"hut",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏘️":{name:"houses",slug:"houses",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏚️":{name:"derelict house",slug:"derelict_house",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏠":{name:"house",slug:"house",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏡":{name:"house with garden",slug:"house_with_garden",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏢":{name:"office building",slug:"office_building",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏣":{name:"Japanese post office",slug:"japanese_post_office",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏤":{name:"post office",slug:"post_office",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏥":{name:"hospital",slug:"hospital",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏦":{name:"bank",slug:"bank",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏨":{name:"hotel",slug:"hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏩":{name:"love hotel",slug:"love_hotel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏪":{name:"convenience store",slug:"convenience_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏫":{name:"school",slug:"school",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏬":{name:"department store",slug:"department_store",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏭":{name:"factory",slug:"factory",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏯":{name:"Japanese castle",slug:"japanese_castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏰":{name:"castle",slug:"castle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💒":{name:"wedding",slug:"wedding",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗼":{name:"Tokyo tower",slug:"tokyo_tower",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗽":{name:"Statue of Liberty",slug:"statue_of_liberty",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛪":{name:"church",slug:"church",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕌":{name:"mosque",slug:"mosque",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛕":{name:"hindu temple",slug:"hindu_temple",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🕍":{name:"synagogue",slug:"synagogue",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛩️":{name:"shinto shrine",slug:"shinto_shrine",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕋":{name:"kaaba",slug:"kaaba",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛲":{name:"fountain",slug:"fountain",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛺":{name:"tent",slug:"tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌁":{name:"foggy",slug:"foggy",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌃":{name:"night with stars",slug:"night_with_stars",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏙️":{name:"cityscape",slug:"cityscape",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌄":{name:"sunrise over mountains",slug:"sunrise_over_mountains",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌅":{name:"sunrise",slug:"sunrise",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌆":{name:"cityscape at dusk",slug:"cityscape_at_dusk",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌇":{name:"sunset",slug:"sunset",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌉":{name:"bridge at night",slug:"bridge_at_night",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♨️":{name:"hot springs",slug:"hot_springs",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎠":{name:"carousel horse",slug:"carousel_horse",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛝":{name:"playground slide",slug:"playground_slide",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🎡":{name:"ferris wheel",slug:"ferris_wheel",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎢":{name:"roller coaster",slug:"roller_coaster",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💈":{name:"barber pole",slug:"barber_pole",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎪":{name:"circus tent",slug:"circus_tent",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚂":{name:"locomotive",slug:"locomotive",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚃":{name:"railway car",slug:"railway_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚄":{name:"high-speed train",slug:"high_speed_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚅":{name:"bullet train",slug:"bullet_train",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚆":{name:"train",slug:"train",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚇":{name:"metro",slug:"metro",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚈":{name:"light rail",slug:"light_rail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚉":{name:"station",slug:"station",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚊":{name:"tram",slug:"tram",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚝":{name:"monorail",slug:"monorail",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚞":{name:"mountain railway",slug:"mountain_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚋":{name:"tram car",slug:"tram_car",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚌":{name:"bus",slug:"bus",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚍":{name:"oncoming bus",slug:"oncoming_bus",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚎":{name:"trolleybus",slug:"trolleybus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚐":{name:"minibus",slug:"minibus",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚑":{name:"ambulance",slug:"ambulance",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚒":{name:"fire engine",slug:"fire_engine",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚓":{name:"police car",slug:"police_car",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚔":{name:"oncoming police car",slug:"oncoming_police_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚕":{name:"taxi",slug:"taxi",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚖":{name:"oncoming taxi",slug:"oncoming_taxi",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚗":{name:"automobile",slug:"automobile",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚘":{name:"oncoming automobile",slug:"oncoming_automobile",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚙":{name:"sport utility vehicle",slug:"sport_utility_vehicle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛻":{name:"pickup truck",slug:"pickup_truck",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚚":{name:"delivery truck",slug:"delivery_truck",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚛":{name:"articulated lorry",slug:"articulated_lorry",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚜":{name:"tractor",slug:"tractor",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏎️":{name:"racing car",slug:"racing_car",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏍️":{name:"motorcycle",slug:"motorcycle",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛵":{name:"motor scooter",slug:"motor_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🦽":{name:"manual wheelchair",slug:"manual_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🦼":{name:"motorized wheelchair",slug:"motorized_wheelchair",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🛺":{name:"auto rickshaw",slug:"auto_rickshaw",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚲":{name:"bicycle",slug:"bicycle",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛴":{name:"kick scooter",slug:"kick_scooter",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🛹":{name:"skateboard",slug:"skateboard",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛼":{name:"roller skate",slug:"roller_skate",group:"Travel & Places",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚏":{name:"bus stop",slug:"bus_stop",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛣️":{name:"motorway",slug:"motorway",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛤️":{name:"railway track",slug:"railway_track",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛢️":{name:"oil drum",slug:"oil_drum",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛽":{name:"fuel pump",slug:"fuel_pump",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛞":{name:"wheel",slug:"wheel",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚨":{name:"police car light",slug:"police_car_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚥":{name:"horizontal traffic light",slug:"horizontal_traffic_light",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚦":{name:"vertical traffic light",slug:"vertical_traffic_light",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛑":{name:"stop sign",slug:"stop_sign",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚧":{name:"construction",slug:"construction",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚓":{name:"anchor",slug:"anchor",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛟":{name:"ring buoy",slug:"ring_buoy",group:"Travel & Places",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"⛵":{name:"sailboat",slug:"sailboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛶":{name:"canoe",slug:"canoe",group:"Travel & Places",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚤":{name:"speedboat",slug:"speedboat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛳️":{name:"passenger ship",slug:"passenger_ship",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛴️":{name:"ferry",slug:"ferry",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛥️":{name:"motor boat",slug:"motor_boat",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚢":{name:"ship",slug:"ship",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✈️":{name:"airplane",slug:"airplane",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛩️":{name:"small airplane",slug:"small_airplane",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛫":{name:"airplane departure",slug:"airplane_departure",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛬":{name:"airplane arrival",slug:"airplane_arrival",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪂":{name:"parachute",slug:"parachute",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💺":{name:"seat",slug:"seat",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚁":{name:"helicopter",slug:"helicopter",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚟":{name:"suspension railway",slug:"suspension_railway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚠":{name:"mountain cableway",slug:"mountain_cableway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚡":{name:"aerial tramway",slug:"aerial_tramway",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛰️":{name:"satellite",slug:"satellite",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🚀":{name:"rocket",slug:"rocket",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛸":{name:"flying saucer",slug:"flying_saucer",group:"Travel & Places",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🛎️":{name:"bellhop bell",slug:"bellhop_bell",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🧳":{name:"luggage",slug:"luggage",group:"Travel & Places",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"⌛":{name:"hourglass done",slug:"hourglass_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏳":{name:"hourglass not done",slug:"hourglass_not_done",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⌚":{name:"watch",slug:"watch",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏰":{name:"alarm clock",slug:"alarm_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏱️":{name:"stopwatch",slug:"stopwatch",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⏲️":{name:"timer clock",slug:"timer_clock",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕰️":{name:"mantelpiece clock",slug:"mantelpiece_clock",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕛":{name:"twelve o’clock",slug:"twelve_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕧":{name:"twelve-thirty",slug:"twelve_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕐":{name:"one o’clock",slug:"one_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕜":{name:"one-thirty",slug:"one_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕑":{name:"two o’clock",slug:"two_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕝":{name:"two-thirty",slug:"two_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕒":{name:"three o’clock",slug:"three_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕞":{name:"three-thirty",slug:"three_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕓":{name:"four o’clock",slug:"four_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕟":{name:"four-thirty",slug:"four_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕔":{name:"five o’clock",slug:"five_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕠":{name:"five-thirty",slug:"five_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕕":{name:"six o’clock",slug:"six_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕡":{name:"six-thirty",slug:"six_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕖":{name:"seven o’clock",slug:"seven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕢":{name:"seven-thirty",slug:"seven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕗":{name:"eight o’clock",slug:"eight_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕣":{name:"eight-thirty",slug:"eight_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕘":{name:"nine o’clock",slug:"nine_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕤":{name:"nine-thirty",slug:"nine_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕙":{name:"ten o’clock",slug:"ten_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕥":{name:"ten-thirty",slug:"ten_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🕚":{name:"eleven o’clock",slug:"eleven_o_clock",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕦":{name:"eleven-thirty",slug:"eleven_thirty",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌑":{name:"new moon",slug:"new_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌒":{name:"waxing crescent moon",slug:"waxing_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌓":{name:"first quarter moon",slug:"first_quarter_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌔":{name:"waxing gibbous moon",slug:"waxing_gibbous_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌕":{name:"full moon",slug:"full_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌖":{name:"waning gibbous moon",slug:"waning_gibbous_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌗":{name:"last quarter moon",slug:"last_quarter_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌘":{name:"waning crescent moon",slug:"waning_crescent_moon",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌙":{name:"crescent moon",slug:"crescent_moon",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌚":{name:"new moon face",slug:"new_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌛":{name:"first quarter moon face",slug:"first_quarter_moon_face",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌜":{name:"last quarter moon face",slug:"last_quarter_moon_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌡️":{name:"thermometer",slug:"thermometer",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☀️":{name:"sun",slug:"sun",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌝":{name:"full moon face",slug:"full_moon_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🌞":{name:"sun with face",slug:"sun_with_face",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪐":{name:"ringed planet",slug:"ringed_planet",group:"Travel & Places",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⭐":{name:"star",slug:"star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌟":{name:"glowing star",slug:"glowing_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌠":{name:"shooting star",slug:"shooting_star",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌌":{name:"milky way",slug:"milky_way",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☁️":{name:"cloud",slug:"cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛅":{name:"sun behind cloud",slug:"sun_behind_cloud",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛈️":{name:"cloud with lightning and rain",slug:"cloud_with_lightning_and_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌤️":{name:"sun behind small cloud",slug:"sun_behind_small_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌥️":{name:"sun behind large cloud",slug:"sun_behind_large_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌦️":{name:"sun behind rain cloud",slug:"sun_behind_rain_cloud",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌧️":{name:"cloud with rain",slug:"cloud_with_rain",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌨️":{name:"cloud with snow",slug:"cloud_with_snow",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌩️":{name:"cloud with lightning",slug:"cloud_with_lightning",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌪️":{name:"tornado",slug:"tornado",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌫️":{name:"fog",slug:"fog",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌬️":{name:"wind face",slug:"wind_face",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🌀":{name:"cyclone",slug:"cyclone",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌈":{name:"rainbow",slug:"rainbow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌂":{name:"closed umbrella",slug:"closed_umbrella",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☂️":{name:"umbrella",slug:"umbrella",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☔":{name:"umbrella with rain drops",slug:"umbrella_with_rain_drops",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛱️":{name:"umbrella on ground",slug:"umbrella_on_ground",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚡":{name:"high voltage",slug:"high_voltage",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❄️":{name:"snowflake",slug:"snowflake",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☃️":{name:"snowman",slug:"snowman",group:"Travel & Places",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⛄":{name:"snowman without snow",slug:"snowman_without_snow",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☄️":{name:"comet",slug:"comet",group:"Travel & Places",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔥":{name:"fire",slug:"fire",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💧":{name:"droplet",slug:"droplet",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🌊":{name:"water wave",slug:"water_wave",group:"Travel & Places",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎃":{name:"jack-o-lantern",slug:"jack_o_lantern",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎄":{name:"Christmas tree",slug:"christmas_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎆":{name:"fireworks",slug:"fireworks",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎇":{name:"sparkler",slug:"sparkler",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧨":{name:"firecracker",slug:"firecracker",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"✨":{name:"sparkles",slug:"sparkles",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎈":{name:"balloon",slug:"balloon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎉":{name:"party popper",slug:"party_popper",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎊":{name:"confetti ball",slug:"confetti_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎋":{name:"tanabata tree",slug:"tanabata_tree",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎍":{name:"pine decoration",slug:"pine_decoration",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎎":{name:"Japanese dolls",slug:"japanese_dolls",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎏":{name:"carp streamer",slug:"carp_streamer",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎐":{name:"wind chime",slug:"wind_chime",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎑":{name:"moon viewing ceremony",slug:"moon_viewing_ceremony",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧧":{name:"red envelope",slug:"red_envelope",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎀":{name:"ribbon",slug:"ribbon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎁":{name:"wrapped gift",slug:"wrapped_gift",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎗️":{name:"reminder ribbon",slug:"reminder_ribbon",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎟️":{name:"admission tickets",slug:"admission_tickets",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎫":{name:"ticket",slug:"ticket",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎖️":{name:"military medal",slug:"military_medal",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏆":{name:"trophy",slug:"trophy",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏅":{name:"sports medal",slug:"sports_medal",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥇":{name:"1st place medal",slug:"1st_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥈":{name:"2nd place medal",slug:"2nd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥉":{name:"3rd place medal",slug:"3rd_place_medal",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⚽":{name:"soccer ball",slug:"soccer_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚾":{name:"baseball",slug:"baseball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥎":{name:"softball",slug:"softball",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏀":{name:"basketball",slug:"basketball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏐":{name:"volleyball",slug:"volleyball",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏈":{name:"american football",slug:"american_football",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏉":{name:"rugby football",slug:"rugby_football",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎾":{name:"tennis",slug:"tennis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥏":{name:"flying disc",slug:"flying_disc",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎳":{name:"bowling",slug:"bowling",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏏":{name:"cricket game",slug:"cricket_game",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏑":{name:"field hockey",slug:"field_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏒":{name:"ice hockey",slug:"ice_hockey",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥍":{name:"lacrosse",slug:"lacrosse",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🏓":{name:"ping pong",slug:"ping_pong",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏸":{name:"badminton",slug:"badminton",group:"Activities",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🥊":{name:"boxing glove",slug:"boxing_glove",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥋":{name:"martial arts uniform",slug:"martial_arts_uniform",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🥅":{name:"goal net",slug:"goal_net",group:"Activities",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"⛳":{name:"flag in hole",slug:"flag_in_hole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛸️":{name:"ice skate",slug:"ice_skate",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎣":{name:"fishing pole",slug:"fishing_pole",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🤿":{name:"diving mask",slug:"diving_mask",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🎽":{name:"running shirt",slug:"running_shirt",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎿":{name:"skis",slug:"skis",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛷":{name:"sled",slug:"sled",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🥌":{name:"curling stone",slug:"curling_stone",group:"Activities",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🎯":{name:"bullseye",slug:"bullseye",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪀":{name:"yo-yo",slug:"yo_yo",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🪁":{name:"kite",slug:"kite",group:"Activities",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔫":{name:"water pistol",slug:"water_pistol",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎱":{name:"pool 8 ball",slug:"pool_8_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔮":{name:"crystal ball",slug:"crystal_ball",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪄":{name:"magic wand",slug:"magic_wand",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎮":{name:"video game",slug:"video_game",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕹️":{name:"joystick",slug:"joystick",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎰":{name:"slot machine",slug:"slot_machine",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎲":{name:"game die",slug:"game_die",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧩":{name:"puzzle piece",slug:"puzzle_piece",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧸":{name:"teddy bear",slug:"teddy_bear",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪅":{name:"piñata",slug:"pinata",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪩":{name:"mirror ball",slug:"mirror_ball",group:"Activities",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪆":{name:"nesting dolls",slug:"nesting_dolls",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"♠️":{name:"spade suit",slug:"spade_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♥️":{name:"heart suit",slug:"heart_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♦️":{name:"diamond suit",slug:"diamond_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♣️":{name:"club suit",slug:"club_suit",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♟️":{name:"chess pawn",slug:"chess_pawn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🃏":{name:"joker",slug:"joker",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🀄":{name:"mahjong red dragon",slug:"mahjong_red_dragon",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎴":{name:"flower playing cards",slug:"flower_playing_cards",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎭":{name:"performing arts",slug:"performing_arts",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖼️":{name:"framed picture",slug:"framed_picture",group:"Activities",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎨":{name:"artist palette",slug:"artist_palette",group:"Activities",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧵":{name:"thread",slug:"thread",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪡":{name:"sewing needle",slug:"sewing_needle",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧶":{name:"yarn",slug:"yarn",group:"Activities",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪢":{name:"knot",slug:"knot",group:"Activities",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👓":{name:"glasses",slug:"glasses",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕶️":{name:"sunglasses",slug:"sunglasses",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🥽":{name:"goggles",slug:"goggles",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥼":{name:"lab coat",slug:"lab_coat",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🦺":{name:"safety vest",slug:"safety_vest",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👔":{name:"necktie",slug:"necktie",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👕":{name:"t-shirt",slug:"t_shirt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👖":{name:"jeans",slug:"jeans",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧣":{name:"scarf",slug:"scarf",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧤":{name:"gloves",slug:"gloves",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧥":{name:"coat",slug:"coat",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🧦":{name:"socks",slug:"socks",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"👗":{name:"dress",slug:"dress",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👘":{name:"kimono",slug:"kimono",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥻":{name:"sari",slug:"sari",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩱":{name:"one-piece swimsuit",slug:"one_piece_swimsuit",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩲":{name:"briefs",slug:"briefs",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩳":{name:"shorts",slug:"shorts",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👙":{name:"bikini",slug:"bikini",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👚":{name:"woman’s clothes",slug:"woman_s_clothes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪭":{name:"folding hand fan",slug:"folding_hand_fan",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👛":{name:"purse",slug:"purse",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👜":{name:"handbag",slug:"handbag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👝":{name:"clutch bag",slug:"clutch_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛍️":{name:"shopping bags",slug:"shopping_bags",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎒":{name:"backpack",slug:"backpack",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩴":{name:"thong sandal",slug:"thong_sandal",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"👞":{name:"man’s shoe",slug:"man_s_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👟":{name:"running shoe",slug:"running_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🥾":{name:"hiking boot",slug:"hiking_boot",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🥿":{name:"flat shoe",slug:"flat_shoe",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"👠":{name:"high-heeled shoe",slug:"high_heeled_shoe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👡":{name:"woman’s sandal",slug:"woman_s_sandal",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩰":{name:"ballet shoes",slug:"ballet_shoes",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"👢":{name:"woman’s boot",slug:"woman_s_boot",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪮":{name:"hair pick",slug:"hair_pick",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"👑":{name:"crown",slug:"crown",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"👒":{name:"woman’s hat",slug:"woman_s_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎩":{name:"top hat",slug:"top_hat",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎓":{name:"graduation cap",slug:"graduation_cap",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧢":{name:"billed cap",slug:"billed_cap",group:"Objects",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🪖":{name:"military helmet",slug:"military_helmet",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⛑️":{name:"rescue worker’s helmet",slug:"rescue_worker_s_helmet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📿":{name:"prayer beads",slug:"prayer_beads",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💄":{name:"lipstick",slug:"lipstick",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💍":{name:"ring",slug:"ring",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💎":{name:"gem stone",slug:"gem_stone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔇":{name:"muted speaker",slug:"muted_speaker",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔈":{name:"speaker low volume",slug:"speaker_low_volume",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔉":{name:"speaker medium volume",slug:"speaker_medium_volume",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔊":{name:"speaker high volume",slug:"speaker_high_volume",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📢":{name:"loudspeaker",slug:"loudspeaker",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📣":{name:"megaphone",slug:"megaphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📯":{name:"postal horn",slug:"postal_horn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔔":{name:"bell",slug:"bell",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔕":{name:"bell with slash",slug:"bell_with_slash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎼":{name:"musical score",slug:"musical_score",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎵":{name:"musical note",slug:"musical_note",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎶":{name:"musical notes",slug:"musical_notes",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎙️":{name:"studio microphone",slug:"studio_microphone",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎚️":{name:"level slider",slug:"level_slider",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎛️":{name:"control knobs",slug:"control_knobs",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎤":{name:"microphone",slug:"microphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎧":{name:"headphone",slug:"headphone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📻":{name:"radio",slug:"radio",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎷":{name:"saxophone",slug:"saxophone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪗":{name:"accordion",slug:"accordion",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🎸":{name:"guitar",slug:"guitar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎹":{name:"musical keyboard",slug:"musical_keyboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎺":{name:"trumpet",slug:"trumpet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎻":{name:"violin",slug:"violin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪕":{name:"banjo",slug:"banjo",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🥁":{name:"drum",slug:"drum",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🪘":{name:"long drum",slug:"long_drum",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪇":{name:"maracas",slug:"maracas",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪈":{name:"flute",slug:"flute",group:"Objects",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"🪉":{name:"harp",slug:"harp",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"📱":{name:"mobile phone",slug:"mobile_phone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📲":{name:"mobile phone with arrow",slug:"mobile_phone_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☎️":{name:"telephone",slug:"telephone",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📞":{name:"telephone receiver",slug:"telephone_receiver",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📟":{name:"pager",slug:"pager",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📠":{name:"fax machine",slug:"fax_machine",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔋":{name:"battery",slug:"battery",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪫":{name:"low battery",slug:"low_battery",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🔌":{name:"electric plug",slug:"electric_plug",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💻":{name:"laptop",slug:"laptop",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖥️":{name:"desktop computer",slug:"desktop_computer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖨️":{name:"printer",slug:"printer",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⌨️":{name:"keyboard",slug:"keyboard",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🖱️":{name:"computer mouse",slug:"computer_mouse",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖲️":{name:"trackball",slug:"trackball",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💽":{name:"computer disk",slug:"computer_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💾":{name:"floppy disk",slug:"floppy_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💿":{name:"optical disk",slug:"optical_disk",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📀":{name:"dvd",slug:"dvd",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧮":{name:"abacus",slug:"abacus",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🎥":{name:"movie camera",slug:"movie_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎞️":{name:"film frames",slug:"film_frames",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📽️":{name:"film projector",slug:"film_projector",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🎬":{name:"clapper board",slug:"clapper_board",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📺":{name:"television",slug:"television",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📷":{name:"camera",slug:"camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📸":{name:"camera with flash",slug:"camera_with_flash",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📹":{name:"video camera",slug:"video_camera",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📼":{name:"videocassette",slug:"videocassette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔍":{name:"magnifying glass tilted left",slug:"magnifying_glass_tilted_left",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔎":{name:"magnifying glass tilted right",slug:"magnifying_glass_tilted_right",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🕯️":{name:"candle",slug:"candle",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💡":{name:"light bulb",slug:"light_bulb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔦":{name:"flashlight",slug:"flashlight",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏮":{name:"red paper lantern",slug:"red_paper_lantern",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪔":{name:"diya lamp",slug:"diya_lamp",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"📔":{name:"notebook with decorative cover",slug:"notebook_with_decorative_cover",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📕":{name:"closed book",slug:"closed_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📖":{name:"open book",slug:"open_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📗":{name:"green book",slug:"green_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📘":{name:"blue book",slug:"blue_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📙":{name:"orange book",slug:"orange_book",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📚":{name:"books",slug:"books",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📓":{name:"notebook",slug:"notebook",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📒":{name:"ledger",slug:"ledger",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📃":{name:"page with curl",slug:"page_with_curl",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📜":{name:"scroll",slug:"scroll",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📄":{name:"page facing up",slug:"page_facing_up",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📰":{name:"newspaper",slug:"newspaper",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗞️":{name:"rolled-up newspaper",slug:"rolled_up_newspaper",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📑":{name:"bookmark tabs",slug:"bookmark_tabs",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔖":{name:"bookmark",slug:"bookmark",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏷️":{name:"label",slug:"label",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"💰":{name:"money bag",slug:"money_bag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪙":{name:"coin",slug:"coin",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"💴":{name:"yen banknote",slug:"yen_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💵":{name:"dollar banknote",slug:"dollar_banknote",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💶":{name:"euro banknote",slug:"euro_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💷":{name:"pound banknote",slug:"pound_banknote",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💸":{name:"money with wings",slug:"money_with_wings",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💳":{name:"credit card",slug:"credit_card",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🧾":{name:"receipt",slug:"receipt",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"💹":{name:"chart increasing with yen",slug:"chart_increasing_with_yen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✉️":{name:"envelope",slug:"envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📧":{name:"e-mail",slug:"e_mail",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📨":{name:"incoming envelope",slug:"incoming_envelope",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📩":{name:"envelope with arrow",slug:"envelope_with_arrow",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📤":{name:"outbox tray",slug:"outbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📥":{name:"inbox tray",slug:"inbox_tray",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📦":{name:"package",slug:"package",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📫":{name:"closed mailbox with raised flag",slug:"closed_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📪":{name:"closed mailbox with lowered flag",slug:"closed_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📬":{name:"open mailbox with raised flag",slug:"open_mailbox_with_raised_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📭":{name:"open mailbox with lowered flag",slug:"open_mailbox_with_lowered_flag",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📮":{name:"postbox",slug:"postbox",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗳️":{name:"ballot box with ballot",slug:"ballot_box_with_ballot",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✏️":{name:"pencil",slug:"pencil",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✒️":{name:"black nib",slug:"black_nib",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖋️":{name:"fountain pen",slug:"fountain_pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖊️":{name:"pen",slug:"pen",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖌️":{name:"paintbrush",slug:"paintbrush",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🖍️":{name:"crayon",slug:"crayon",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📝":{name:"memo",slug:"memo",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💼":{name:"briefcase",slug:"briefcase",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📁":{name:"file folder",slug:"file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📂":{name:"open file folder",slug:"open_file_folder",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗂️":{name:"card index dividers",slug:"card_index_dividers",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📅":{name:"calendar",slug:"calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📆":{name:"tear-off calendar",slug:"tear_off_calendar",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗒️":{name:"spiral notepad",slug:"spiral_notepad",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗓️":{name:"spiral calendar",slug:"spiral_calendar",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📇":{name:"card index",slug:"card_index",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📈":{name:"chart increasing",slug:"chart_increasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📉":{name:"chart decreasing",slug:"chart_decreasing",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📊":{name:"bar chart",slug:"bar_chart",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📋":{name:"clipboard",slug:"clipboard",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📌":{name:"pushpin",slug:"pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📍":{name:"round pushpin",slug:"round_pushpin",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📎":{name:"paperclip",slug:"paperclip",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🖇️":{name:"linked paperclips",slug:"linked_paperclips",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"📏":{name:"straight ruler",slug:"straight_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📐":{name:"triangular ruler",slug:"triangular_ruler",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✂️":{name:"scissors",slug:"scissors",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗃️":{name:"card file box",slug:"card_file_box",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗄️":{name:"file cabinet",slug:"file_cabinet",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗑️":{name:"wastebasket",slug:"wastebasket",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔒":{name:"locked",slug:"locked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔓":{name:"unlocked",slug:"unlocked",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔏":{name:"locked with pen",slug:"locked_with_pen",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔐":{name:"locked with key",slug:"locked_with_key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔑":{name:"key",slug:"key",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🗝️":{name:"old key",slug:"old_key",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔨":{name:"hammer",slug:"hammer",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪓":{name:"axe",slug:"axe",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⛏️":{name:"pick",slug:"pick",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚒️":{name:"hammer and pick",slug:"hammer_and_pick",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛠️":{name:"hammer and wrench",slug:"hammer_and_wrench",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🗡️":{name:"dagger",slug:"dagger",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚔️":{name:"crossed swords",slug:"crossed_swords",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"💣":{name:"bomb",slug:"bomb",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪃":{name:"boomerang",slug:"boomerang",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏹":{name:"bow and arrow",slug:"bow_and_arrow",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛡️":{name:"shield",slug:"shield",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪚":{name:"carpentry saw",slug:"carpentry_saw",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔧":{name:"wrench",slug:"wrench",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪛":{name:"screwdriver",slug:"screwdriver",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🔩":{name:"nut and bolt",slug:"nut_and_bolt",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚙️":{name:"gear",slug:"gear",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🗜️":{name:"clamp",slug:"clamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⚖️":{name:"balance scale",slug:"balance_scale",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🦯":{name:"white cane",slug:"white_cane",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔗":{name:"link",slug:"link",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛓️‍💥":{name:"broken chain",slug:"broken_chain",group:"Objects",emoji_version:"15.1",unicode_version:"15.1",skin_tone_support:!1},"⛓️":{name:"chains",slug:"chains",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪝":{name:"hook",slug:"hook",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧰":{name:"toolbox",slug:"toolbox",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧲":{name:"magnet",slug:"magnet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪜":{name:"ladder",slug:"ladder",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪏":{name:"shovel",slug:"shovel",group:"Objects",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"⚗️":{name:"alembic",slug:"alembic",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧪":{name:"test tube",slug:"test_tube",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧫":{name:"petri dish",slug:"petri_dish",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧬":{name:"dna",slug:"dna",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🔬":{name:"microscope",slug:"microscope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔭":{name:"telescope",slug:"telescope",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📡":{name:"satellite antenna",slug:"satellite_antenna",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💉":{name:"syringe",slug:"syringe",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩸":{name:"drop of blood",slug:"drop_of_blood",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"💊":{name:"pill",slug:"pill",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🩹":{name:"adhesive bandage",slug:"adhesive_bandage",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩼":{name:"crutch",slug:"crutch",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🩺":{name:"stethoscope",slug:"stethoscope",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🩻":{name:"x-ray",slug:"x_ray",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🚪":{name:"door",slug:"door",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛗":{name:"elevator",slug:"elevator",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪞":{name:"mirror",slug:"mirror",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪟":{name:"window",slug:"window",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🛏️":{name:"bed",slug:"bed",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🛋️":{name:"couch and lamp",slug:"couch_and_lamp",group:"Objects",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🪑":{name:"chair",slug:"chair",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🚽":{name:"toilet",slug:"toilet",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪠":{name:"plunger",slug:"plunger",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🚿":{name:"shower",slug:"shower",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛁":{name:"bathtub",slug:"bathtub",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪤":{name:"mouse trap",slug:"mouse_trap",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪒":{name:"razor",slug:"razor",group:"Objects",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🧴":{name:"lotion bottle",slug:"lotion_bottle",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧷":{name:"safety pin",slug:"safety_pin",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧹":{name:"broom",slug:"broom",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧺":{name:"basket",slug:"basket",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧻":{name:"roll of paper",slug:"roll_of_paper",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪣":{name:"bucket",slug:"bucket",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧼":{name:"soap",slug:"soap",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🫧":{name:"bubbles",slug:"bubbles",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🪥":{name:"toothbrush",slug:"toothbrush",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🧽":{name:"sponge",slug:"sponge",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🧯":{name:"fire extinguisher",slug:"fire_extinguisher",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🛒":{name:"shopping cart",slug:"shopping_cart",group:"Objects",emoji_version:"3.0",unicode_version:"3.0",skin_tone_support:!1},"🚬":{name:"cigarette",slug:"cigarette",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚰️":{name:"coffin",slug:"coffin",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🪦":{name:"headstone",slug:"headstone",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"⚱️":{name:"funeral urn",slug:"funeral_urn",group:"Objects",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🧿":{name:"nazar amulet",slug:"nazar_amulet",group:"Objects",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🪬":{name:"hamsa",slug:"hamsa",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🗿":{name:"moai",slug:"moai",group:"Objects",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪧":{name:"placard",slug:"placard",group:"Objects",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🪪":{name:"identification card",slug:"identification_card",group:"Objects",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"🏧":{name:"ATM sign",slug:"atm_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚮":{name:"litter in bin sign",slug:"litter_in_bin_sign",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚰":{name:"potable water",slug:"potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"♿":{name:"wheelchair symbol",slug:"wheelchair_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚹":{name:"men’s room",slug:"men_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚺":{name:"women’s room",slug:"women_s_room",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚻":{name:"restroom",slug:"restroom",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚼":{name:"baby symbol",slug:"baby_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚾":{name:"water closet",slug:"water_closet",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛂":{name:"passport control",slug:"passport_control",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛃":{name:"customs",slug:"customs",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛄":{name:"baggage claim",slug:"baggage_claim",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🛅":{name:"left luggage",slug:"left_luggage",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚠️":{name:"warning",slug:"warning",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚸":{name:"children crossing",slug:"children_crossing",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⛔":{name:"no entry",slug:"no_entry",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚫":{name:"prohibited",slug:"prohibited",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚳":{name:"no bicycles",slug:"no_bicycles",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚭":{name:"no smoking",slug:"no_smoking",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚯":{name:"no littering",slug:"no_littering",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚱":{name:"non-potable water",slug:"non_potable_water",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🚷":{name:"no pedestrians",slug:"no_pedestrians",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📵":{name:"no mobile phones",slug:"no_mobile_phones",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔞":{name:"no one under eighteen",slug:"no_one_under_eighteen",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☢️":{name:"radioactive",slug:"radioactive",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☣️":{name:"biohazard",slug:"biohazard",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⬆️":{name:"up arrow",slug:"up_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↗️":{name:"up-right arrow",slug:"up_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➡️":{name:"right arrow",slug:"right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↘️":{name:"down-right arrow",slug:"down_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬇️":{name:"down arrow",slug:"down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↙️":{name:"down-left arrow",slug:"down_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬅️":{name:"left arrow",slug:"left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↖️":{name:"up-left arrow",slug:"up_left_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↕️":{name:"up-down arrow",slug:"up_down_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↔️":{name:"left-right arrow",slug:"left_right_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↩️":{name:"right arrow curving left",slug:"right_arrow_curving_left",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"↪️":{name:"left arrow curving right",slug:"left_arrow_curving_right",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤴️":{name:"right arrow curving up",slug:"right_arrow_curving_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⤵️":{name:"right arrow curving down",slug:"right_arrow_curving_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔃":{name:"clockwise vertical arrows",slug:"clockwise_vertical_arrows",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔄":{name:"counterclockwise arrows button",slug:"counterclockwise_arrows_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔙":{name:"BACK arrow",slug:"back_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔚":{name:"END arrow",slug:"end_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔛":{name:"ON! arrow",slug:"on_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔜":{name:"SOON arrow",slug:"soon_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔝":{name:"TOP arrow",slug:"top_arrow",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛐":{name:"place of worship",slug:"place_of_worship",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"⚛️":{name:"atom symbol",slug:"atom_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕉️":{name:"om",slug:"om",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✡️":{name:"star of David",slug:"star_of_david",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☸️":{name:"wheel of dharma",slug:"wheel_of_dharma",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☯️":{name:"yin yang",slug:"yin_yang",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"✝️":{name:"latin cross",slug:"latin_cross",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☦️":{name:"orthodox cross",slug:"orthodox_cross",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"☪️":{name:"star and crescent",slug:"star_and_crescent",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"☮️":{name:"peace symbol",slug:"peace_symbol",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🕎":{name:"menorah",slug:"menorah",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔯":{name:"dotted six-pointed star",slug:"dotted_six_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🪯":{name:"khanda",slug:"khanda",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"♈":{name:"Aries",slug:"aries",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♉":{name:"Taurus",slug:"taurus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♊":{name:"Gemini",slug:"gemini",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♋":{name:"Cancer",slug:"cancer",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♌":{name:"Leo",slug:"leo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♍":{name:"Virgo",slug:"virgo",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♎":{name:"Libra",slug:"libra",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♏":{name:"Scorpio",slug:"scorpio",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♐":{name:"Sagittarius",slug:"sagittarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♑":{name:"Capricorn",slug:"capricorn",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♒":{name:"Aquarius",slug:"aquarius",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♓":{name:"Pisces",slug:"pisces",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⛎":{name:"Ophiuchus",slug:"ophiuchus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔀":{name:"shuffle tracks button",slug:"shuffle_tracks_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔁":{name:"repeat button",slug:"repeat_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔂":{name:"repeat single button",slug:"repeat_single_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"▶️":{name:"play button",slug:"play_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏩":{name:"fast-forward button",slug:"fast_forward_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏭️":{name:"next track button",slug:"next_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏯️":{name:"play or pause button",slug:"play_or_pause_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"◀️":{name:"reverse button",slug:"reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏪":{name:"fast reverse button",slug:"fast_reverse_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏮️":{name:"last track button",slug:"last_track_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🔼":{name:"upwards button",slug:"upwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏫":{name:"fast up button",slug:"fast_up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔽":{name:"downwards button",slug:"downwards_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏬":{name:"fast down button",slug:"fast_down_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⏸️":{name:"pause button",slug:"pause_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏹️":{name:"stop button",slug:"stop_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏺️":{name:"record button",slug:"record_button",group:"Symbols",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"⏏️":{name:"eject button",slug:"eject_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🎦":{name:"cinema",slug:"cinema",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔅":{name:"dim button",slug:"dim_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔆":{name:"bright button",slug:"bright_button",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"📶":{name:"antenna bars",slug:"antenna_bars",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🛜":{name:"wireless",slug:"wireless",group:"Symbols",emoji_version:"15.0",unicode_version:"15.0",skin_tone_support:!1},"📳":{name:"vibration mode",slug:"vibration_mode",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📴":{name:"mobile phone off",slug:"mobile_phone_off",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"♀️":{name:"female sign",slug:"female_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♂️":{name:"male sign",slug:"male_sign",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"⚧️":{name:"transgender symbol",slug:"transgender_symbol",group:"Symbols",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"✖️":{name:"multiply",slug:"multiply",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➕":{name:"plus",slug:"plus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➖":{name:"minus",slug:"minus",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➗":{name:"divide",slug:"divide",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟰":{name:"heavy equals sign",slug:"heavy_equals_sign",group:"Symbols",emoji_version:"14.0",unicode_version:"14.0",skin_tone_support:!1},"♾️":{name:"infinity",slug:"infinity",group:"Symbols",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"‼️":{name:"double exclamation mark",slug:"double_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⁉️":{name:"exclamation question mark",slug:"exclamation_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❓":{name:"red question mark",slug:"red_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❔":{name:"white question mark",slug:"white_question_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❕":{name:"white exclamation mark",slug:"white_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❗":{name:"red exclamation mark",slug:"red_exclamation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"〰️":{name:"wavy dash",slug:"wavy_dash",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💱":{name:"currency exchange",slug:"currency_exchange",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💲":{name:"heavy dollar sign",slug:"heavy_dollar_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚕️":{name:"medical symbol",slug:"medical_symbol",group:"Symbols",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"♻️":{name:"recycling symbol",slug:"recycling_symbol",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚜️":{name:"fleur-de-lis",slug:"fleur_de_lis",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🔱":{name:"trident emblem",slug:"trident_emblem",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"📛":{name:"name badge",slug:"name_badge",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔰":{name:"Japanese symbol for beginner",slug:"japanese_symbol_for_beginner",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⭕":{name:"hollow red circle",slug:"hollow_red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✅":{name:"check mark button",slug:"check_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"☑️":{name:"check box with check",slug:"check_box_with_check",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✔️":{name:"check mark",slug:"check_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❌":{name:"cross mark",slug:"cross_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❎":{name:"cross mark button",slug:"cross_mark_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➰":{name:"curly loop",slug:"curly_loop",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"➿":{name:"double curly loop",slug:"double_curly_loop",group:"Symbols",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"〽️":{name:"part alternation mark",slug:"part_alternation_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✳️":{name:"eight-spoked asterisk",slug:"eight_spoked_asterisk",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"✴️":{name:"eight-pointed star",slug:"eight_pointed_star",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"❇️":{name:"sparkle",slug:"sparkle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"©️":{name:"copyright",slug:"copyright",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"®️":{name:"registered",slug:"registered",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"™️":{name:"trade mark",slug:"trade_mark",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🫟":{name:"splatter",slug:"splatter",group:"Symbols",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"#️⃣":{name:"keycap #",slug:"keycap_number_sign",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"*️⃣":{name:"keycap *",slug:"keycap_asterisk",group:"Symbols",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"0️⃣":{name:"keycap 0",slug:"keycap_0",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"1️⃣":{name:"keycap 1",slug:"keycap_1",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"2️⃣":{name:"keycap 2",slug:"keycap_2",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"3️⃣":{name:"keycap 3",slug:"keycap_3",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"4️⃣":{name:"keycap 4",slug:"keycap_4",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"5️⃣":{name:"keycap 5",slug:"keycap_5",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"6️⃣":{name:"keycap 6",slug:"keycap_6",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"7️⃣":{name:"keycap 7",slug:"keycap_7",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"8️⃣":{name:"keycap 8",slug:"keycap_8",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"9️⃣":{name:"keycap 9",slug:"keycap_9",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔟":{name:"keycap 10",slug:"keycap_10",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔠":{name:"input latin uppercase",slug:"input_latin_uppercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔡":{name:"input latin lowercase",slug:"input_latin_lowercase",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔢":{name:"input numbers",slug:"input_numbers",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔣":{name:"input symbols",slug:"input_symbols",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔤":{name:"input latin letters",slug:"input_latin_letters",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅰️":{name:"A button (blood type)",slug:"a_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆎":{name:"AB button (blood type)",slug:"ab_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅱️":{name:"B button (blood type)",slug:"b_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆑":{name:"CL button",slug:"cl_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆒":{name:"COOL button",slug:"cool_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆓":{name:"FREE button",slug:"free_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"ℹ️":{name:"information",slug:"information",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆔":{name:"ID button",slug:"id_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"Ⓜ️":{name:"circled M",slug:"circled_m",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆕":{name:"NEW button",slug:"new_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆖":{name:"NG button",slug:"ng_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅾️":{name:"O button (blood type)",slug:"o_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆗":{name:"OK button",slug:"ok_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🅿️":{name:"P button",slug:"p_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆘":{name:"SOS button",slug:"sos_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆙":{name:"UP! button",slug:"up_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🆚":{name:"VS button",slug:"vs_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈁":{name:"Japanese “here” button",slug:"japanese_here_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈂️":{name:"Japanese “service charge” button",slug:"japanese_service_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈷️":{name:"Japanese “monthly amount” button",slug:"japanese_monthly_amount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈶":{name:"Japanese “not free of charge” button",slug:"japanese_not_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈯":{name:"Japanese “reserved” button",slug:"japanese_reserved_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉐":{name:"Japanese “bargain” button",slug:"japanese_bargain_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈹":{name:"Japanese “discount” button",slug:"japanese_discount_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈚":{name:"Japanese “free of charge” button",slug:"japanese_free_of_charge_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈲":{name:"Japanese “prohibited” button",slug:"japanese_prohibited_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🉑":{name:"Japanese “acceptable” button",slug:"japanese_acceptable_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈸":{name:"Japanese “application” button",slug:"japanese_application_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈴":{name:"Japanese “passing grade” button",slug:"japanese_passing_grade_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈳":{name:"Japanese “vacancy” button",slug:"japanese_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊗️":{name:"Japanese “congratulations” button",slug:"japanese_congratulations_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"㊙️":{name:"Japanese “secret” button",slug:"japanese_secret_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈺":{name:"Japanese “open for business” button",slug:"japanese_open_for_business_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🈵":{name:"Japanese “no vacancy” button",slug:"japanese_no_vacancy_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔴":{name:"red circle",slug:"red_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟠":{name:"orange circle",slug:"orange_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟡":{name:"yellow circle",slug:"yellow_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟢":{name:"green circle",slug:"green_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🔵":{name:"blue circle",slug:"blue_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟣":{name:"purple circle",slug:"purple_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟤":{name:"brown circle",slug:"brown_circle",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⚫":{name:"black circle",slug:"black_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⚪":{name:"white circle",slug:"white_circle",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🟥":{name:"red square",slug:"red_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟧":{name:"orange square",slug:"orange_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟨":{name:"yellow square",slug:"yellow_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟩":{name:"green square",slug:"green_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟦":{name:"blue square",slug:"blue_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟪":{name:"purple square",slug:"purple_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"🟫":{name:"brown square",slug:"brown_square",group:"Symbols",emoji_version:"12.0",unicode_version:"12.0",skin_tone_support:!1},"⬛":{name:"black large square",slug:"black_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"⬜":{name:"white large square",slug:"white_large_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◼️":{name:"black medium square",slug:"black_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◻️":{name:"white medium square",slug:"white_medium_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◾":{name:"black medium-small square",slug:"black_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"◽":{name:"white medium-small square",slug:"white_medium_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▪️":{name:"black small square",slug:"black_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"▫️":{name:"white small square",slug:"white_small_square",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔶":{name:"large orange diamond",slug:"large_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔷":{name:"large blue diamond",slug:"large_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔸":{name:"small orange diamond",slug:"small_orange_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔹":{name:"small blue diamond",slug:"small_blue_diamond",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔺":{name:"red triangle pointed up",slug:"red_triangle_pointed_up",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔻":{name:"red triangle pointed down",slug:"red_triangle_pointed_down",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"💠":{name:"diamond with a dot",slug:"diamond_with_a_dot",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔘":{name:"radio button",slug:"radio_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔳":{name:"white square button",slug:"white_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🔲":{name:"black square button",slug:"black_square_button",group:"Symbols",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏁":{name:"chequered flag",slug:"chequered_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🚩":{name:"triangular flag",slug:"triangular_flag",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🎌":{name:"crossed flags",slug:"crossed_flags",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🏴":{name:"black flag",slug:"black_flag",group:"Flags",emoji_version:"1.0",unicode_version:"1.0",skin_tone_support:!1},"🏳️":{name:"white flag",slug:"white_flag",group:"Flags",emoji_version:"0.7",unicode_version:"0.7",skin_tone_support:!1},"🏳️‍🌈":{name:"rainbow flag",slug:"rainbow_flag",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🏳️‍⚧️":{name:"transgender flag",slug:"transgender_flag",group:"Flags",emoji_version:"13.0",unicode_version:"13.0",skin_tone_support:!1},"🏴‍☠️":{name:"pirate flag",slug:"pirate_flag",group:"Flags",emoji_version:"11.0",unicode_version:"11.0",skin_tone_support:!1},"🇦🇨":{name:"flag Ascension Island",slug:"flag_ascension_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇩":{name:"flag Andorra",slug:"flag_andorra",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇪":{name:"flag United Arab Emirates",slug:"flag_united_arab_emirates",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇫":{name:"flag Afghanistan",slug:"flag_afghanistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇬":{name:"flag Antigua & Barbuda",slug:"flag_antigua_barbuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇮":{name:"flag Anguilla",slug:"flag_anguilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇱":{name:"flag Albania",slug:"flag_albania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇲":{name:"flag Armenia",slug:"flag_armenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇴":{name:"flag Angola",slug:"flag_angola",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇶":{name:"flag Antarctica",slug:"flag_antarctica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇷":{name:"flag Argentina",slug:"flag_argentina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇸":{name:"flag American Samoa",slug:"flag_american_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇹":{name:"flag Austria",slug:"flag_austria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇺":{name:"flag Australia",slug:"flag_australia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇼":{name:"flag Aruba",slug:"flag_aruba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇽":{name:"flag Åland Islands",slug:"flag_aland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇦🇿":{name:"flag Azerbaijan",slug:"flag_azerbaijan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇦":{name:"flag Bosnia & Herzegovina",slug:"flag_bosnia_herzegovina",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇧":{name:"flag Barbados",slug:"flag_barbados",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇩":{name:"flag Bangladesh",slug:"flag_bangladesh",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇪":{name:"flag Belgium",slug:"flag_belgium",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇫":{name:"flag Burkina Faso",slug:"flag_burkina_faso",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇬":{name:"flag Bulgaria",slug:"flag_bulgaria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇭":{name:"flag Bahrain",slug:"flag_bahrain",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇮":{name:"flag Burundi",slug:"flag_burundi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇯":{name:"flag Benin",slug:"flag_benin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇱":{name:"flag St. Barthélemy",slug:"flag_st_barthelemy",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇲":{name:"flag Bermuda",slug:"flag_bermuda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇳":{name:"flag Brunei",slug:"flag_brunei",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇴":{name:"flag Bolivia",slug:"flag_bolivia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇶":{name:"flag Caribbean Netherlands",slug:"flag_caribbean_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇷":{name:"flag Brazil",slug:"flag_brazil",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇸":{name:"flag Bahamas",slug:"flag_bahamas",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇹":{name:"flag Bhutan",slug:"flag_bhutan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇻":{name:"flag Bouvet Island",slug:"flag_bouvet_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇼":{name:"flag Botswana",slug:"flag_botswana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇾":{name:"flag Belarus",slug:"flag_belarus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇧🇿":{name:"flag Belize",slug:"flag_belize",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇦":{name:"flag Canada",slug:"flag_canada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇨":{name:"flag Cocos (Keeling) Islands",slug:"flag_cocos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇩":{name:"flag Congo - Kinshasa",slug:"flag_congo_kinshasa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇫":{name:"flag Central African Republic",slug:"flag_central_african_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇬":{name:"flag Congo - Brazzaville",slug:"flag_congo_brazzaville",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇭":{name:"flag Switzerland",slug:"flag_switzerland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇮":{name:"flag Côte d’Ivoire",slug:"flag_cote_d_ivoire",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇰":{name:"flag Cook Islands",slug:"flag_cook_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇱":{name:"flag Chile",slug:"flag_chile",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇲":{name:"flag Cameroon",slug:"flag_cameroon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇳":{name:"flag China",slug:"flag_china",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇨🇴":{name:"flag Colombia",slug:"flag_colombia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇵":{name:"flag Clipperton Island",slug:"flag_clipperton_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇶":{name:"flag Sark",slug:"flag_sark",group:"Flags",emoji_version:"16.0",unicode_version:"16.0",skin_tone_support:!1},"🇨🇷":{name:"flag Costa Rica",slug:"flag_costa_rica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇺":{name:"flag Cuba",slug:"flag_cuba",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇻":{name:"flag Cape Verde",slug:"flag_cape_verde",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇼":{name:"flag Curaçao",slug:"flag_curacao",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇽":{name:"flag Christmas Island",slug:"flag_christmas_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇾":{name:"flag Cyprus",slug:"flag_cyprus",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇨🇿":{name:"flag Czechia",slug:"flag_czechia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇪":{name:"flag Germany",slug:"flag_germany",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇩🇬":{name:"flag Diego Garcia",slug:"flag_diego_garcia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇯":{name:"flag Djibouti",slug:"flag_djibouti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇰":{name:"flag Denmark",slug:"flag_denmark",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇲":{name:"flag Dominica",slug:"flag_dominica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇴":{name:"flag Dominican Republic",slug:"flag_dominican_republic",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇩🇿":{name:"flag Algeria",slug:"flag_algeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇦":{name:"flag Ceuta & Melilla",slug:"flag_ceuta_melilla",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇨":{name:"flag Ecuador",slug:"flag_ecuador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇪":{name:"flag Estonia",slug:"flag_estonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇬":{name:"flag Egypt",slug:"flag_egypt",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇭":{name:"flag Western Sahara",slug:"flag_western_sahara",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇷":{name:"flag Eritrea",slug:"flag_eritrea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇸":{name:"flag Spain",slug:"flag_spain",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇪🇹":{name:"flag Ethiopia",slug:"flag_ethiopia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇪🇺":{name:"flag European Union",slug:"flag_european_union",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇮":{name:"flag Finland",slug:"flag_finland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇯":{name:"flag Fiji",slug:"flag_fiji",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇰":{name:"flag Falkland Islands",slug:"flag_falkland_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇲":{name:"flag Micronesia",slug:"flag_micronesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇴":{name:"flag Faroe Islands",slug:"flag_faroe_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇫🇷":{name:"flag France",slug:"flag_france",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇦":{name:"flag Gabon",slug:"flag_gabon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇧":{name:"flag United Kingdom",slug:"flag_united_kingdom",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇬🇩":{name:"flag Grenada",slug:"flag_grenada",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇪":{name:"flag Georgia",slug:"flag_georgia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇫":{name:"flag French Guiana",slug:"flag_french_guiana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇬":{name:"flag Guernsey",slug:"flag_guernsey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇭":{name:"flag Ghana",slug:"flag_ghana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇮":{name:"flag Gibraltar",slug:"flag_gibraltar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇱":{name:"flag Greenland",slug:"flag_greenland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇲":{name:"flag Gambia",slug:"flag_gambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇳":{name:"flag Guinea",slug:"flag_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇵":{name:"flag Guadeloupe",slug:"flag_guadeloupe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇶":{name:"flag Equatorial Guinea",slug:"flag_equatorial_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇷":{name:"flag Greece",slug:"flag_greece",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇸":{name:"flag South Georgia & South Sandwich Islands",slug:"flag_south_georgia_south_sandwich_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇹":{name:"flag Guatemala",slug:"flag_guatemala",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇺":{name:"flag Guam",slug:"flag_guam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇼":{name:"flag Guinea-Bissau",slug:"flag_guinea_bissau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇬🇾":{name:"flag Guyana",slug:"flag_guyana",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇰":{name:"flag Hong Kong SAR China",slug:"flag_hong_kong_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇲":{name:"flag Heard & McDonald Islands",slug:"flag_heard_mcdonald_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇳":{name:"flag Honduras",slug:"flag_honduras",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇷":{name:"flag Croatia",slug:"flag_croatia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇹":{name:"flag Haiti",slug:"flag_haiti",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇭🇺":{name:"flag Hungary",slug:"flag_hungary",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇨":{name:"flag Canary Islands",slug:"flag_canary_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇩":{name:"flag Indonesia",slug:"flag_indonesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇪":{name:"flag Ireland",slug:"flag_ireland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇱":{name:"flag Israel",slug:"flag_israel",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇲":{name:"flag Isle of Man",slug:"flag_isle_of_man",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇳":{name:"flag India",slug:"flag_india",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇴":{name:"flag British Indian Ocean Territory",slug:"flag_british_indian_ocean_territory",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇶":{name:"flag Iraq",slug:"flag_iraq",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇷":{name:"flag Iran",slug:"flag_iran",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇸":{name:"flag Iceland",slug:"flag_iceland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇮🇹":{name:"flag Italy",slug:"flag_italy",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇯🇪":{name:"flag Jersey",slug:"flag_jersey",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇲":{name:"flag Jamaica",slug:"flag_jamaica",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇴":{name:"flag Jordan",slug:"flag_jordan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇯🇵":{name:"flag Japan",slug:"flag_japan",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇪":{name:"flag Kenya",slug:"flag_kenya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇬":{name:"flag Kyrgyzstan",slug:"flag_kyrgyzstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇭":{name:"flag Cambodia",slug:"flag_cambodia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇮":{name:"flag Kiribati",slug:"flag_kiribati",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇲":{name:"flag Comoros",slug:"flag_comoros",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇳":{name:"flag St. Kitts & Nevis",slug:"flag_st_kitts_nevis",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇵":{name:"flag North Korea",slug:"flag_north_korea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇷":{name:"flag South Korea",slug:"flag_south_korea",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇰🇼":{name:"flag Kuwait",slug:"flag_kuwait",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇾":{name:"flag Cayman Islands",slug:"flag_cayman_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇰🇿":{name:"flag Kazakhstan",slug:"flag_kazakhstan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇦":{name:"flag Laos",slug:"flag_laos",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇧":{name:"flag Lebanon",slug:"flag_lebanon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇨":{name:"flag St. Lucia",slug:"flag_st_lucia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇮":{name:"flag Liechtenstein",slug:"flag_liechtenstein",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇰":{name:"flag Sri Lanka",slug:"flag_sri_lanka",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇷":{name:"flag Liberia",slug:"flag_liberia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇸":{name:"flag Lesotho",slug:"flag_lesotho",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇹":{name:"flag Lithuania",slug:"flag_lithuania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇺":{name:"flag Luxembourg",slug:"flag_luxembourg",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇻":{name:"flag Latvia",slug:"flag_latvia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇱🇾":{name:"flag Libya",slug:"flag_libya",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇦":{name:"flag Morocco",slug:"flag_morocco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇨":{name:"flag Monaco",slug:"flag_monaco",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇩":{name:"flag Moldova",slug:"flag_moldova",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇪":{name:"flag Montenegro",slug:"flag_montenegro",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇫":{name:"flag St. Martin",slug:"flag_st_martin",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇬":{name:"flag Madagascar",slug:"flag_madagascar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇭":{name:"flag Marshall Islands",slug:"flag_marshall_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇰":{name:"flag North Macedonia",slug:"flag_north_macedonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇱":{name:"flag Mali",slug:"flag_mali",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇲":{name:"flag Myanmar (Burma)",slug:"flag_myanmar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇳":{name:"flag Mongolia",slug:"flag_mongolia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇴":{name:"flag Macao SAR China",slug:"flag_macao_sar_china",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇵":{name:"flag Northern Mariana Islands",slug:"flag_northern_mariana_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇶":{name:"flag Martinique",slug:"flag_martinique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇷":{name:"flag Mauritania",slug:"flag_mauritania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇸":{name:"flag Montserrat",slug:"flag_montserrat",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇹":{name:"flag Malta",slug:"flag_malta",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇺":{name:"flag Mauritius",slug:"flag_mauritius",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇻":{name:"flag Maldives",slug:"flag_maldives",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇼":{name:"flag Malawi",slug:"flag_malawi",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇽":{name:"flag Mexico",slug:"flag_mexico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇾":{name:"flag Malaysia",slug:"flag_malaysia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇲🇿":{name:"flag Mozambique",slug:"flag_mozambique",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇦":{name:"flag Namibia",slug:"flag_namibia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇨":{name:"flag New Caledonia",slug:"flag_new_caledonia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇪":{name:"flag Niger",slug:"flag_niger",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇫":{name:"flag Norfolk Island",slug:"flag_norfolk_island",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇬":{name:"flag Nigeria",slug:"flag_nigeria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇮":{name:"flag Nicaragua",slug:"flag_nicaragua",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇱":{name:"flag Netherlands",slug:"flag_netherlands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇴":{name:"flag Norway",slug:"flag_norway",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇵":{name:"flag Nepal",slug:"flag_nepal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇷":{name:"flag Nauru",slug:"flag_nauru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇺":{name:"flag Niue",slug:"flag_niue",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇳🇿":{name:"flag New Zealand",slug:"flag_new_zealand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇴🇲":{name:"flag Oman",slug:"flag_oman",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇦":{name:"flag Panama",slug:"flag_panama",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇪":{name:"flag Peru",slug:"flag_peru",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇫":{name:"flag French Polynesia",slug:"flag_french_polynesia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇬":{name:"flag Papua New Guinea",slug:"flag_papua_new_guinea",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇭":{name:"flag Philippines",slug:"flag_philippines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇰":{name:"flag Pakistan",slug:"flag_pakistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇱":{name:"flag Poland",slug:"flag_poland",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇲":{name:"flag St. Pierre & Miquelon",slug:"flag_st_pierre_miquelon",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇳":{name:"flag Pitcairn Islands",slug:"flag_pitcairn_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇷":{name:"flag Puerto Rico",slug:"flag_puerto_rico",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇸":{name:"flag Palestinian Territories",slug:"flag_palestinian_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇹":{name:"flag Portugal",slug:"flag_portugal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇼":{name:"flag Palau",slug:"flag_palau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇵🇾":{name:"flag Paraguay",slug:"flag_paraguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇶🇦":{name:"flag Qatar",slug:"flag_qatar",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇪":{name:"flag Réunion",slug:"flag_reunion",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇴":{name:"flag Romania",slug:"flag_romania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇸":{name:"flag Serbia",slug:"flag_serbia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇷🇺":{name:"flag Russia",slug:"flag_russia",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇷🇼":{name:"flag Rwanda",slug:"flag_rwanda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇦":{name:"flag Saudi Arabia",slug:"flag_saudi_arabia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇧":{name:"flag Solomon Islands",slug:"flag_solomon_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇨":{name:"flag Seychelles",slug:"flag_seychelles",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇩":{name:"flag Sudan",slug:"flag_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇪":{name:"flag Sweden",slug:"flag_sweden",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇬":{name:"flag Singapore",slug:"flag_singapore",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇭":{name:"flag St. Helena",slug:"flag_st_helena",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇮":{name:"flag Slovenia",slug:"flag_slovenia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇯":{name:"flag Svalbard & Jan Mayen",slug:"flag_svalbard_jan_mayen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇰":{name:"flag Slovakia",slug:"flag_slovakia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇱":{name:"flag Sierra Leone",slug:"flag_sierra_leone",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇲":{name:"flag San Marino",slug:"flag_san_marino",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇳":{name:"flag Senegal",slug:"flag_senegal",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇴":{name:"flag Somalia",slug:"flag_somalia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇷":{name:"flag Suriname",slug:"flag_suriname",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇸":{name:"flag South Sudan",slug:"flag_south_sudan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇹":{name:"flag São Tomé & Príncipe",slug:"flag_sao_tome_principe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇻":{name:"flag El Salvador",slug:"flag_el_salvador",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇽":{name:"flag Sint Maarten",slug:"flag_sint_maarten",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇾":{name:"flag Syria",slug:"flag_syria",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇸🇿":{name:"flag Eswatini",slug:"flag_eswatini",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇦":{name:"flag Tristan da Cunha",slug:"flag_tristan_da_cunha",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇨":{name:"flag Turks & Caicos Islands",slug:"flag_turks_caicos_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇩":{name:"flag Chad",slug:"flag_chad",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇫":{name:"flag French Southern Territories",slug:"flag_french_southern_territories",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇬":{name:"flag Togo",slug:"flag_togo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇭":{name:"flag Thailand",slug:"flag_thailand",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇯":{name:"flag Tajikistan",slug:"flag_tajikistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇰":{name:"flag Tokelau",slug:"flag_tokelau",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇱":{name:"flag Timor-Leste",slug:"flag_timor_leste",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇲":{name:"flag Turkmenistan",slug:"flag_turkmenistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇳":{name:"flag Tunisia",slug:"flag_tunisia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇴":{name:"flag Tonga",slug:"flag_tonga",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇷":{name:"flag Türkiye",slug:"flag_turkiye",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇹":{name:"flag Trinidad & Tobago",slug:"flag_trinidad_tobago",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇻":{name:"flag Tuvalu",slug:"flag_tuvalu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇼":{name:"flag Taiwan",slug:"flag_taiwan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇹🇿":{name:"flag Tanzania",slug:"flag_tanzania",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇦":{name:"flag Ukraine",slug:"flag_ukraine",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇬":{name:"flag Uganda",slug:"flag_uganda",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇲":{name:"flag U.S. Outlying Islands",slug:"flag_u_s_outlying_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇳":{name:"flag United Nations",slug:"flag_united_nations",group:"Flags",emoji_version:"4.0",unicode_version:"4.0",skin_tone_support:!1},"🇺🇸":{name:"flag United States",slug:"flag_united_states",group:"Flags",emoji_version:"0.6",unicode_version:"0.6",skin_tone_support:!1},"🇺🇾":{name:"flag Uruguay",slug:"flag_uruguay",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇺🇿":{name:"flag Uzbekistan",slug:"flag_uzbekistan",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇦":{name:"flag Vatican City",slug:"flag_vatican_city",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇨":{name:"flag St. Vincent & Grenadines",slug:"flag_st_vincent_grenadines",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇪":{name:"flag Venezuela",slug:"flag_venezuela",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇬":{name:"flag British Virgin Islands",slug:"flag_british_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇮":{name:"flag U.S. Virgin Islands",slug:"flag_u_s_virgin_islands",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇳":{name:"flag Vietnam",slug:"flag_vietnam",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇻🇺":{name:"flag Vanuatu",slug:"flag_vanuatu",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇫":{name:"flag Wallis & Futuna",slug:"flag_wallis_futuna",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇼🇸":{name:"flag Samoa",slug:"flag_samoa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇽🇰":{name:"flag Kosovo",slug:"flag_kosovo",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇪":{name:"flag Yemen",slug:"flag_yemen",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇾🇹":{name:"flag Mayotte",slug:"flag_mayotte",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇦":{name:"flag South Africa",slug:"flag_south_africa",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇲":{name:"flag Zambia",slug:"flag_zambia",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🇿🇼":{name:"flag Zimbabwe",slug:"flag_zimbabwe",group:"Flags",emoji_version:"2.0",unicode_version:"2.0",skin_tone_support:!1},"🏴󠁧󠁢󠁥󠁮󠁧󠁿":{name:"flag England",slug:"flag_england",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁳󠁣󠁴󠁿":{name:"flag Scotland",slug:"flag_scotland",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1},"🏴󠁧󠁢󠁷󠁬󠁳󠁿":{name:"flag Wales",slug:"flag_wales",group:"Flags",emoji_version:"5.0",unicode_version:"5.0",skin_tone_support:!1}};function JR(s,e){const t=s.target;b(e,H(t.value))}var QR=(s,e)=>e("recent"),ej=be("<button>Recent</button>"),tj=(s,e,t)=>e(t()),sj=be("<button> </button>"),nj=be('<div class="flex border-b border-base-content/20 overflow-x-auto"><!> <!></div>'),oj=(s,e,t)=>e(i(t).emoji),ij=be('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),rj=(s,e,t)=>e(i(t)),aj=be('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),lj=(s,e,t)=>e(i(t).emoji),cj=be('<button class="w-8 h-8 flex items-center justify-center text-lg hover:bg-base-200 rounded transition-colors"> </button>'),uj=be('<div class="text-center text-base-content/60 py-8">No emojis found</div>'),dj=be('<div class="emoji-picker fixed z-50 bg-base-100 border border-base-content/20 rounded-lg shadow-lg svelte-hsh18a"><div class="p-3 border-b border-base-content/20"><input type="text" placeholder="Search emojis..." class="input input-sm w-full bg-base-200"></div> <!> <div class="p-2 overflow-y-auto" style="height: calc(100% - 120px);"><div class="grid grid-cols-8 gap-1"><!></div> <!></div></div>');function fj(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(l,"$recentlyUsed",t),o=fm();let r=bi(e,"show",15,!1),a=bi(e,"position",27,()=>H({x:0,y:0}));const l=Fx("emoji-recently-used",[]);let c=_e(""),f=_e("smileys");const d=(()=>{const I={smileys:{name:"Smileys & Emotion",emojis:[]},people:{name:"People & Body",emojis:[]},animals:{name:"Animals & Nature",emojis:[]},food:{name:"Food & Drink",emojis:[]},activities:{name:"Activities",emojis:[]},travel:{name:"Travel & Places",emojis:[]},objects:{name:"Objects",emojis:[]},symbols:{name:"Symbols",emojis:[]},flags:{name:"Flags",emojis:[]}};return Object.entries(ZR).forEach(([A,P])=>{var L;if(!A||!P.name)return;const T={emoji:A,name:P.name,keywords:P.keywords||[]},j=((L=P.group)==null?void 0:L.toLowerCase())||"",E=P.name.toLowerCase();j.includes("smileys")||j.includes("emotion")||E.includes("face")||E.includes("smile")||E.includes("laugh")||E.includes("cry")?I.smileys.emojis.push(T):j.includes("people")||j.includes("body")||E.includes("hand")||E.includes("body")||E.includes("person")||E.includes("man")||E.includes("woman")?I.people.emojis.push(T):j.includes("animals")||j.includes("nature")||E.includes("animal")||E.includes("cat")||E.includes("dog")||E.includes("bird")||E.includes("plant")||E.includes("tree")?I.animals.emojis.push(T):j.includes("food")||j.includes("drink")||E.includes("food")||E.includes("fruit")||E.includes("drink")||E.includes("coffee")||E.includes("pizza")?I.food.emojis.push(T):j.includes("activities")||j.includes("sport")||E.includes("sport")||E.includes("ball")||E.includes("game")?I.activities.emojis.push(T):j.includes("travel")||j.includes("places")||E.includes("car")||E.includes("plane")||E.includes("train")||E.includes("building")?I.travel.emojis.push(T):j.includes("objects")||E.includes("phone")||E.includes("computer")||E.includes("book")||E.includes("tool")?I.objects.emojis.push(T):j.includes("flags")||E.includes("flag")?I.flags.emojis.push(T):I.symbols.emojis.push(T)}),I})(),h=Lt(()=>{var I;return i(c)?Object.values(d).flatMap(A=>A.emojis).filter(A=>A.emoji.includes(i(c))||A.name.toLowerCase().includes(i(c).toLowerCase())||A.keywords.some(P=>P.toLowerCase().includes(i(c).toLowerCase()))):((I=d[i(f)])==null?void 0:I.emojis)||[]});function p(I){l.update(A=>{const P=A.filter(T=>T!==I);return[I,...P].slice(0,20)}),o("select",{emoji:I}),r(!1)}function v(I){b(f,H(I)),b(c,"")}function x(I){I.target.closest(".emoji-picker")||r(!1)}sm(()=>{if(typeof document<"u")return document.addEventListener("click",x),()=>{document.removeEventListener("click",x)}});var S=Qs(),C=_s(S);Ve(C,r,I=>{var A=dj(),P=y(A),T=y(P);Ts(T),T.__input=[JR,c],_(P);var j=m(P,2);Ve(j,()=>!i(c),ne=>{var de=nj(),ie=y(de);Ve(ie,()=>n().length>0,le=>{var pe=ej();pe.__click=[QR,v],we(()=>$i(pe,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(i(f)==="recent"?"border-primary text-primary":"border-transparent hover:text-primary")??""}`)),Y(le,pe)});var te=m(ie,2);qo(te,17,()=>Object.entries(d),yi,(le,pe)=>{let re=()=>i(pe)[0],xe=()=>i(pe)[1];var se=sj();se.__click=[tj,v,re];var Ne=y(se,!0);_(se),we(()=>{$i(se,`px-3 py-2 text-xs whitespace-nowrap border-b-2 transition-colors ${(i(f)===re()?"border-primary text-primary":"border-transparent hover:text-primary")??""}`),st(Ne,xe().name)}),Y(le,se)}),_(de),Y(ne,de)});var E=m(j,2),L=y(E),D=y(L);Ve(D,()=>i(c),ne=>{var de=Qs(),ie=_s(de);qo(ie,17,()=>i(h),yi,(te,le)=>{var pe=ij();pe.__click=[oj,p,le];var re=y(pe,!0);_(pe),we(()=>{Dt(pe,"title",i(le).name),st(re,i(le).emoji)}),Y(te,pe)}),Y(ne,de)},ne=>{var de=Qs(),ie=_s(de);Ve(ie,()=>i(f)==="recent"&&n().length>0,te=>{var le=Qs(),pe=_s(le);qo(pe,1,n,yi,(re,xe)=>{var se=aj();se.__click=[rj,p,xe];var Ne=y(se,!0);_(se),we(()=>{Dt(se,"title",i(xe)),st(Ne,i(xe))}),Y(re,se)}),Y(te,le)},te=>{var le=Qs(),pe=_s(le);qo(pe,17,()=>i(h),yi,(re,xe)=>{var se=cj();se.__click=[lj,p,xe];var Ne=y(se,!0);_(se),we(()=>{Dt(se,"title",i(xe).name),st(Ne,i(xe).emoji)}),Y(re,se)}),Y(te,le)},!0),Y(ne,de)}),_(L);var X=m(L,2);Ve(X,()=>i(c)&&i(h).length===0,ne=>{var de=uj();Y(ne,de)}),_(E),_(A),we(()=>{Dt(A,"style",`left: ${a().x??""}px; top: ${a().y??""}px; width: 320px; height: 400px;`),qf(T,i(c))}),Y(I,A)}),Y(s,S),Kd()}$p(["input","click"]);function pj(s,e){e("reset")}function hj(s,e){e("confirm")}function mj(s,e){s.target.classList.contains("modal-backdrop")&&e()}var vj=s=>s.stopPropagation(),gj=be(`<div><input type="checkbox" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2
                       sm:w-4 sm:h-4 touch-manipulation"> <input type="number" step="0.001" min="0" max="10"> <button class="w-10 h-10 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors
                       sm:w-8 sm:h-8 touch-manipulation" title="Change color"></button> <span> </span></div>`),_j=be(`<div class="fixed inset-0 bg-transparent flex items-center justify-center z-[9999] modal-backdrop"><div><div><h3>Fibonacci Settings</h3> <button title="Close"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 max-h-[60vh] overflow-y-auto svelte-ah2kky"><div class="space-y-3"></div></div> <div><button>🔁 Reset</button> <div class="flex gap-3 w-full sm:w-auto sm:gap-2"><button>❌ Cancel</button> <button class="px-6 py-3 text-sm rounded bg-blue-600 hover:bg-blue-700 text-white transition-colors
                   touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]">✅ Confirm</button></div></div></div></div>`),yj=be('<div class="fixed z-[10000]"><!></div>'),bj=be("<!> <!>",1);function xj(s,e){Yd(e,!1);let t=bi(e,"visible",8,!1),n=bi(e,"levels",24,()=>[]),o=bi(e,"theme",8,"dark");const r=fm();let a=bd(!1),l=bd(-1),c=bd({x:0,y:0});function f(I,A,P){r("levelChange",{index:I,field:A,value:P})}function u(I,A){b(l,A),b(c,{x:I.clientX,y:I.clientY}),b(a,!0)}function d(I){i(l)>=0&&f(i(l),"color",I.detail)}function h(I){i(l)>=0&&f(i(l),"opacity",I.detail)}function p(){b(a,!1),b(l,-1)}function v(){r("cancel")}_h(()=>jh(t()),()=>{t()||(b(a,!1),b(l,-1))}),_h(()=>i(a),()=>{i(a)||b(l,-1)}),c0(),$m();var x=bj(),S=_s(x);Ve(S,t,I=>{var A=_j();A.__click=[mj,v];var P=y(A);P.__click=[vj];var T=y(P),j=y(T),E=m(j,2);E.__click=v;var L=y(E);_(E),_(T);var D=m(T,2),X=y(D);qo(X,5,n,yi,(pe,re,xe)=>{var se=gj(),Ne=y(se);Ts(Ne),Ne.__change=()=>f(xe,"visible",i(re).visible);var Te=m(Ne,2);Ts(Te),Te.__change=()=>f(xe,"value",i(re).value);var Me=m(Te,2);Me.__click=Ke=>u(Ke,xe);var De=m(Me,2),Oe=y(De,!0);we(()=>st(Oe,i(re).value===0?"Start":i(re).value===1?"End":`${(i(re).value*100).toFixed(1)}%`)),_(De),_(se),we(()=>{$i(se,`flex items-center gap-3 p-3 rounded-lg ${(o()==="dark"?"bg-[#2a2a2a]":"bg-gray-50")??""}
                        sm:gap-4 sm:p-4`),$i(Te,`w-24 px-3 py-2 text-sm rounded border touch-manipulation
                       sm:w-20 sm:px-2 sm:py-1
                       ${(o()==="dark"?"bg-[#3a3a3a] border-[#555] text-white focus:border-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500")??""} 
                       focus:outline-none focus:ring-1 focus:ring-blue-500`),Dt(Me,"style",`background-color: ${i(re).color??""}`),$i(De,`text-sm ${(o()==="dark"?"text-gray-300":"text-gray-700")??""} flex-1
                           sm:text-sm`)}),Wv(Ne,()=>i(re).visible,Ke=>(i(re).visible=Ke,lw(()=>n()))),Fn(Te,()=>i(re).value,Ke=>(i(re).value=Ke,lw(()=>n()))),Y(pe,se)}),_(X),_(D);var ne=m(D,2),de=y(ne);de.__click=[pj,r];var ie=m(de,2),te=y(ie);te.__click=v;var le=m(te,2);le.__click=[hj,r],_(ie),_(ne),_(P),_(A),we(()=>{$i(P,`relative ${(o()==="dark"?"bg-[#1a1a1a] border-[#404040]":"bg-white border-gray-200")??""} 
             rounded-lg shadow-xl border max-w-md w-full mx-4 max-h-[80vh] overflow-hidden
             sm:max-w-lg md:max-w-xl lg:max-w-2xl svelte-ah2kky`),$i(T,`flex items-center justify-between p-4 border-b ${(o()==="dark"?"border-[#404040]":"border-gray-200")??""}`),$i(j,`text-lg font-semibold ${(o()==="dark"?"text-white":"text-gray-900")??""}`),$i(E,`w-8 h-8 rounded-full ${(o()==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} 
                 flex items-center justify-center transition-colors`),b1(L,`w-5 h-5 ${(o()==="dark"?"text-gray-400":"text-gray-600")??""}`),$i(ne,`flex items-center justify-between p-4 border-t ${(o()==="dark"?"border-[#404040]":"border-gray-200")??""}
                  sm:flex-row flex-col gap-3 sm:gap-0`),$i(de,`px-6 py-3 text-sm rounded ${(o()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                 transition-colors touch-manipulation min-h-[44px] w-full sm:w-auto
                 sm:px-4 sm:py-2 sm:min-h-[36px]`),$i(te,`px-6 py-3 text-sm rounded ${(o()==="dark"?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700")??""} 
                   transition-colors touch-manipulation min-h-[44px] flex-1 sm:flex-none
                   sm:px-4 sm:py-2 sm:min-h-[36px]`)}),Y(I,A)});var C=m(S,2);Ve(C,()=>i(a),I=>{var A=yj(),P=y(A),T=Mm(()=>{var E;return((E=n()[i(l)])==null?void 0:E.color)||"#FF6B6B"}),j=Mm(()=>{var E;return((E=n()[i(l)])==null?void 0:E.opacity)??15});sv(P,{get show(){return i(a)},set show(E){b(a,E)},get selectedColor(){return i(T)},get opacity(){return i(j)},$$events:{colorChange:d,opacityChange:h,close:p},$$legacy:!0}),_(A),we(()=>Dt(A,"style",`left: ${i(c).x??""}px; top: ${i(c).y??""}px;`)),Y(I,A)}),Y(s,x),Kd()}$p(["click","change"]);const Yx=Th(!1);function Hm(){Yx.set(!0)}function i2(){Yx.set(!1)}function r2(){return vh(Yx)===!0}function wj(s,e,t,n,o,r){var d,h,p;if(!i(e)||!t())return;const l=!(((h=(d=i(e))==null?void 0:d.extendData)==null?void 0:h.manualLock)===!0),c=l?!0:!!i(o),f={...i(e).extendData||{},manualLock:l};(p=t())==null||p.overrideOverlay({id:i(e).id,lock:c,extendData:f});const u={...i(e),lock:c,extendData:f};b(e,H(u)),r(u)}function kj(s,e,t){i(e).fontWeight=i(e).fontWeight==="bold"?"normal":"bold",t()}function Sj(s,e){e(s)}function Cj(s,e,t,n,o,r,a){s.stopPropagation();const l=s.target.getBoundingClientRect();b(e,"line"),b(t,H(n.color)),b(o,H(n.opacity)),b(r,H({x:Math.max(10,Math.min(l.left,window.innerWidth-320)),y:Math.max(10,Math.min(l.bottom+5,window.innerHeight-400))})),b(a,!0)}function Ij(s,e,t,n,o,r,a){b(e,"textColor"),b(t,H(i(n).textColor)),b(o,H(i(r))),b(a,!0)}function Pj(s,e,t,n,o,r,a){b(e,"textBg"),b(t,H(i(n).backgroundColor)),b(o,H(i(r))),b(a,!0)}function Mj(s,e){s.preventDefault(),s.stopPropagation(),e()}var Nj=be('<div class="pro-active-indicator absolute bottom-[3px] left-1/2 transform -translate-x-1/2 w-[4px] h-[4px] rounded-full svelte-hffas6" style="background: var(--menu-accent);"></div>'),Aj=(s,e,t)=>e(i(t)),Tj=be('<div class="submenu-portal svelte-hffas6"></div>'),Fj=be(`<div class="pro-submenu-arrow flex items-center justify-center absolute top-1/2 right-0 transform -translate-y-1/2
               w-5 h-5 opacity-0 group-hover:opacity-100 hover:opacity-100 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1)
               bg-[var(--menu-btn-bg)] border border-[var(--menu-btn-border)] rounded-full
               hover:bg-[var(--menu-hover-bg)] hover:border-[var(--menu-btn-hover-border)] cursor-pointer z-20 backdrop-blur-[8px] svelte-hffas6" style="backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><svg class="w-2.5 h-2.5 transition-all duration-150 cubic-bezier(0.4, 0, 0.2, 1) text-[var(--menu-text)] svelte-hffas6" viewBox="0 0 8 12" fill="currentColor"><path d="M1.705 0.295C1.315 -0.095 0.685 -0.095 0.295 0.295C-0.095 0.685 -0.095 1.315 0.295 1.705L5.59 7L0.295 12.295C-0.095 12.685 -0.095 13.315 0.295 13.705C0.685 14.095 1.315 14.095 1.705 13.705L7.705 7.705C8.095 7.315 8.095 6.685 7.705 6.295L1.705 0.295Z" class="svelte-hffas6"></path></svg></div> <!>`,1),Lj=be(`<div class="group flex flex-row items-center justify-center relative w-full mt-2 cursor-pointer transition-all duration-200 ease-out svelte-hffas6"><div class="pro-draw-button w-[36px] h-[36px] rounded-[8px] flex items-center justify-center relative overflow-hidden transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)
             isolation-isolate svelte-hffas6" style="background: var(--menu-btn-bg); border: 1px solid var(--menu-btn-border); backdrop-filter: blur(16px) saturate(160%); -webkit-backdrop-filter: blur(16px) saturate(160%);"><div class="button-hover-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-[8px] svelte-hffas6" style="background: var(--menu-hover-bg);"></div> <!> <!></div> <!></div>`),Ej=be('<div class="w-full h-[2px] mt-3 mb-2 opacity-90 svelte-hffas6" style="background: linear-gradient(to right, transparent, var(--menu-accent), transparent); box-shadow: 0 0 10px var(--menu-glow);"></div>'),$j=s=>s.stopPropagation(),Dj=be("<!> <!>",1),Rj=s=>s.preventDefault(),jj=be('<button class="drawbar-scroll-arrow svelte-hffas6" title="Scroll to see more tools" aria-label="Scroll down" type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-hffas6"><polyline points="6 9 12 15 18 9"></polyline></svg></button>'),Bj=(s,e,t,n,o,r)=>i(e)==="mode"?t(i(n).key):o(r.findIndex(a=>a.key===i(e)),i(n).key),Oj=be(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                   text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-hffas6"><!> <span class="text-sm font-medium"> </span></li>`),zj=be(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
                bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-hffas6"></ul>`),Vj=(s,e,t)=>e(i(t).key),Wj=be(`<li class="px-4 py-3 flex flex-row items-center gap-3 transition-all duration-200 ease-in-out
                 text-[var(--menu-text)] hover:bg-[var(--menu-hover-bg)] hover:text-[var(--menu-glow)] cursor-pointer svelte-hffas6"><!> <span class="text-sm font-medium"> </span></li>`),Hj=be(`<ul class="premium-submenu fixed min-w-[140px] max-h-[70vh] z-[9999] rounded-lg shadow-2xl border border-[var(--menu-btn-border)] overflow-y-auto
              bg-[var(--menu-bg)] backdrop-blur-sm transition-all duration-300 ease-in-out svelte-hffas6"></ul>`),qj=be("<!> <!>",1),Uj=s=>s.stopPropagation(),Gj=be("<option> </option>"),Yj=be(`<select title="Font size"><option>8</option><option>10</option><option>11</option><option>12</option><option>14</option><option>16</option><option>18</option><option>20</option><option>22</option><option>24</option><option>32</option><option>40</option><option>52</option></select> <button title="Bold"><span class="text-xs font-bold">B</span></button> <div class="flex items-center gap-1 svelte-hffas6"><div class="flex items-center gap-1"><button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-hffas6" title="Text color"><!></button> <button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                       cursor-pointer hover:scale-105 transition-transform touch-manipulation flex items-center justify-center svelte-hffas6" title="Background color"><!></button></div> <select title="Font family"></select></div>`,1),Kj=be(`<button class="w-6 h-6 rounded-md border border-gray-400 dark:border-gray-600
                 cursor-pointer hover:scale-105 transition-transform touch-manipulation svelte-hffas6" title="Choose color"></button> <select title="Line thickness"><option>1px</option><option>2px</option><option>3px</option><option>4px</option><option>5px</option><option>6px</option><option>7px</option><option>8px</option></select> <select title="Line style"><option>Line</option><option>Dash</option><option>Dot</option></select>`,1),Xj=be('<div title="Drag to move"><div class="flex flex-col gap-0.5"><div class="flex gap-0.5"><div></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div> <div class="flex gap-0.5"><div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div> <div class="w-0.5 h-0.5 bg-gray-400 dark:bg-gray-500 rounded-full"></div></div></div></div> <!>',1),Zj=(s,e)=>{var t;return e(((t=s.target)==null?void 0:t.value)||"24")},Jj=be('<div class="flex items-center gap-3 svelte-hffas6"><div class="flex items-center justify-center w-8 h-8 text-lg"> </div> <div class="flex items-center gap-1 sm:gap-2 min-w-[100px] sm:min-w-[120px]"><span class="text-xs text-gray-500 dark:text-gray-400 hidden sm:inline">Size:</span> <input type="range" min="16" max="64" class="flex-1 h-2 sm:h-1 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer slider touch-manipulation svelte-hffas6"> <span class="text-xs text-gray-500 dark:text-gray-400 w-6 text-right"> </span></div></div>'),Qj=(s,e)=>{e()},eB=be('<button title="Fibonacci Settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>'),tB=(s,e)=>b(e,!i(e)),sB=s=>s.stopPropagation(),nB=(s,e,t)=>{e(),b(t,!1)},oB=(s,e,t)=>{e(),b(t,!1)},iB=(s,e,t)=>{e(),b(t,!1)},rB=be("<button>Paste</button>"),aB=be("<div><button>Clone</button> <button>Copy</button> <!></div>"),lB=(s,e,t,n)=>{e(),b(t,!1),b(n,null)},cB=be('<div><!> <!> <button><!></button> <div class="relative svelte-hffas6"><button title="More" aria-haspopup="true"><svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="12" cy="19" r="2"></circle></svg></button> <!></div> <button title="Delete"><svg fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),uB=be('<div class="fixed z-[200001] bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer shadow-lg transition-all duration-200" title="Delete selected drawing"><svg class="w-4 h-4" fill="none" stroke="currentColor" vector-effect="non-scaling-stroke" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></div>'),dB=be('<div class="drawbar-wrapper svelte-hffas6"><div class="drawbar-container h-full box-border border-r border-l-0 transition-all duration-200 ease-in-out overflow-y-auto scrollbar-hidden svelte-hffas6" style="background: var(--menu-bg); box-shadow: var(--menu-shadow); backdrop-filter: blur(18px) saturate(170%); -webkit-backdrop-filter: blur(18px) saturate(170%); border-left: none;"><!> <!> <!> <!> <!> <!> <!> <!></div> <!></div> <!> <!> <!> <!>  <!> <!>',1);function fB(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(ke,"$chart",t),o=()=>Ml(jt,"$save",t),r=()=>Ml(ec,"$undoRedoState",t),a=(Ie,ge=i_,Re=i_,vt,Bt,Xt,W)=>{let Q=Mm(()=>U1(vt==null?void 0:vt(),"")),O=Mm(()=>U1(Bt==null?void 0:Bt(),()=>[],!0)),U=Mm(()=>U1(Xt==null?void 0:Xt(),!1)),ce=Mm(()=>U1(W==null?void 0:W(),!1));var G=Lj(),ye=y(G);ye.__click=function(...ve){var Fe;(Fe=ge())==null||Fe.apply(this,ve)};var Qe=m(y(ye),2),Ue=Lt(()=>Kn(Re())),dt=Lt(()=>i(Q)==="mode"&&i(u)===i(f)||i(Q)==="lock"&&i(d));nv(Qe,{get name(){return i(Ue)},get active(){return i(dt)},size:24,class:"relative z-10 transition-all duration-200 group-hover:scale-[1.05]"});var et=m(Qe,2);Ve(et,()=>i(Q)==="mode"&&i(u)===i(f)||i(Q)==="lock"&&i(d)||i(Q)&&i(Q)===i(c),ve=>{var Fe=Nj();Y(ve,Fe)}),_(ye);var B=m(ye,2);Ve(B,()=>i(O).length>0,ve=>{var Fe=Fj(),ot=_s(Fe);ot.__click=[Aj,Xd,Q];var tt=y(ot);_(ot);var St=m(ot,2);Ve(St,()=>i(Q)===i(c),Be=>{var je=Tj();Y(Be,je)}),we(()=>yr(tt,"rotate-180",i(c)===i(Q))),Y(ve,Fe)}),_(G),we(()=>{Dt(G,"style",`margin-top: ${(i(U)||i(ce)?"12px":"")??""}`),Dt(ye,"title",i(Q)||Re()),Dt(ye,"aria-label",i(Q)||Re()),yr(ye,"active-btn",i(Q)==="mode"&&i(u)===i(f)||i(Q)==="lock"&&i(d)||i(Q)&&i(Q)===i(c))}),Y(Ie,G)},l=Ie=>{var ge=Ej();Y(Ie,ge)};let c=_e(""),f=_e("weakMagnet"),u=_e("normal"),d=_e(!1),h=_e(!0),p=H([]),v=_e(""),x=_e(null),S=_e(null),C=_e(!1),I=_e(!1),A=_e(null),P=H({thickness:"1",style:"solid",color:"#1677FF",opacity:100}),T=_e(!1),j=H({x:0,y:0}),E=_e(null),L=_e(0),D=_e(null),X=_e(!1),ne=_e(!1),de=_e(null),ie=0,te=_e(!1),le=_e("line"),pe=_e("#1677FF"),re=_e(100),xe=_e(!1),se=_e(H({x:0,y:0})),Ne=_e(H({x:0,y:0}));const Te="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif";let Me=_e(H({fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",backgroundColor:"#A00000",fontFamily:Te})),De=_e(100),Oe=_e(20),Ke=_e(!1),kt=_e(void 0);function pt(Ie){const ge=Ie.replace("#",""),Re=parseInt(ge.slice(0,2),16),vt=parseInt(ge.slice(2,4),16),Bt=parseInt(ge.slice(4,6),16);return{r:Re,g:vt,b:Bt}}function Rt(Ie){if(!Ie||typeof Ie!="string"||!Ie.startsWith("#"))return"#000000";const ge=Ie.length===9?Ie.slice(0,7):Ie,{r:Re,g:vt,b:Bt}=pt(ge);return .2126*Re+.7152*vt+.0722*Bt>128?"#000000":"#FFFFFF"}const Ht=[{label:"System",value:Te},{label:"Arial",value:"Arial, Helvetica, sans-serif"},{label:"Helvetica",value:"'Helvetica Neue', Arial, sans-serif"},{label:"Segoe UI",value:"'Segoe UI', Tahoma, Geneva, sans-serif"},{label:"Roboto",value:"Roboto, system-ui, -apple-system, 'Segoe UI', Arial, sans-serif"},{label:"Times New Roman",value:"'Times New Roman', Times, serif"},{label:"Georgia",value:"Georgia, 'Times New Roman', serif"},{label:"Garamond",value:"Garamond, 'Times New Roman', serif"},{label:"Palatino",value:"'Palatino Linotype', 'Book Antiqua', Palatino, serif"},{label:"Verdana",value:"Verdana, Geneva, sans-serif"},{label:"Tahoma",value:"Tahoma, Geneva, sans-serif"},{label:"Trebuchet MS",value:"'Trebuchet MS', 'Lucida Grande', sans-serif"},{label:"Impact",value:"Impact, Charcoal, sans-serif"},{label:"Lucida Sans",value:"'Lucida Sans Unicode', 'Lucida Grande', sans-serif"},{label:"Century Gothic",value:"'Century Gothic', AppleGothic, sans-serif"},{label:"Optima",value:"Optima, 'Segoe', 'Segoe UI', sans-serif"},{label:"Comic Sans MS",value:"'Comic Sans MS', 'Comic Sans', cursive, sans-serif"},{label:"Avenir",value:"'Avenir Next', Avenir, sans-serif"},{label:"Futura",value:"Futura, 'Trebuchet MS', Arial, sans-serif"},{label:"Menlo",value:"Menlo, Monaco, Consolas, 'Courier New', monospace"},{label:"Consolas",value:"Consolas, 'Liberation Mono', Menlo, Monaco, monospace"},{label:"Courier New",value:"'Courier New', Courier, monospace"}];let Ft=null;function zt(){var Re;Ft||(Ft=document.querySelector(".chart-container")||document.querySelector("[data-chart-container]")||document.querySelector(".duty-chart")||document.querySelector("#chart")||((Re=document.querySelector("canvas"))==null?void 0:Re.parentElement)||document.body);const Ie=Ft==null?void 0:Ft.getBoundingClientRect();if(!Ie)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};const ge=10;return{left:Ie.left+ge,top:Ie.top+ge,width:Ie.width-ge*2,height:Ie.height-ge*2}}function ut(Ie){try{const ge=zt();Ft&&(Ft.style.cursor=Ie??"default")}catch{}}function nt(Ie){var Mt,Ze,rs,yn,Qn;if(!Ie||!Ie.points||Ie.points.length===0||!n())return null;const ge=Ie.points[0],Re=Ie.paneId||"candle_pane",vt=(Mt=n())==null?void 0:Mt.convertToPixel(ge,{paneId:Re}),Bt=(Ft||document.body).getBoundingClientRect();if(!vt||typeof vt.x!="number"||typeof vt.y!="number"||!Bt)return null;const Xt=zt(),W=window.innerWidth<=768,Q=W?Math.min(300,window.innerWidth-40):300,O=W?48:60,U=W?32:24,ce=(Ze=Ie.extendData)!=null&&Ze.editing?P_.getEditorRect():null,G=ce?ce.width:((rs=Ie.extendData)==null?void 0:rs.boxWidth)??160,ye=ce?ce.height:((yn=Ie.extendData)==null?void 0:yn.boxHeight)??Math.round((((Qn=Ie.extendData)==null?void 0:Qn.fontSize)??32)*1.4)+8,Qe=vt.x-G/2,Ue=vt.x+G/2,dt=vt.y-Math.round(ye/2),et=ce?ce.left:Bt.left+Qe,B=ce?ce.right:Bt.left+Ue,ve=ce?ce.top:Bt.top+dt,Fe=ce?ce.bottom:ve+ye;let ot=[{x:B+U,y:ve},{x:et,y:Fe+U},{x:et-Q-U,y:ve},{x:et,y:ve-O-U}];W&&(ot=[{x:et,y:Fe+U},{x:et,y:ve-O-U},{x:B+U,y:ve},{x:et-Q-U,y:ve}]);const tt=Bt.left+(W?4:8),St=Bt.top+(W?4:8),Be=Bt.left+Xt.width-Q-(W?4:8),je=Bt.top+Xt.height-O-(W?4:8);for(const wn of ot){let xo=Math.max(tt,Math.min(wn.x,Be)),hi=Math.max(St,Math.min(wn.y,je));const Ln=hi<Fe&&hi+O>ve,pl=xo<B&&xo+Q>et;if(!(Ln&&pl))return{x:xo,y:hi}}if(W){let wn=Math.max(tt,Math.min(et,Be)),xo=Math.max(St,Math.min(Fe+U,je));return{x:wn,y:xo}}else{let wn=Math.max(tt,Math.min(B+U,Be)),xo=Math.max(St,Math.min(ve,je));return{x:wn,y:xo}}}function Je(Ie){function ge(vt){const Bt=Ie.scrollTop>0,Xt=Ie.scrollTop<Ie.scrollHeight-Ie.clientHeight;(vt.deltaY<0&&!Bt||vt.deltaY>0&&!Xt)&&vt.preventDefault(),vt.stopPropagation()}function Re(vt){vt.preventDefault(),vt.stopPropagation()}return Ie.addEventListener("wheel",ge,{passive:!1,capture:!0}),Ie.addEventListener("touchmove",Re,{passive:!1,capture:!0}),{destroy(){Ie.removeEventListener("wheel",ge,{capture:!0}),Ie.removeEventListener("touchmove",Re,{capture:!0})}}}function it(){var Ie,ge;if(i(I)&&i(A)&&i(E)&&!(i(A).name==="text"&&((Ie=i(A).extendData)!=null&&Ie.editing))&&i(A).points&&i(A).points.length>0){const Re=i(A).points[0],vt=(ge=n())==null?void 0:ge.convertToPixel(Re,{paneId:"candle_pane"});if(vt&&typeof vt=="object"&&"x"in vt&&"y"in vt&&vt.x!==void 0&&vt.y!==void 0){const W=Math.max(10,Math.min(vt.x-80,window.innerWidth-300)),Q=Math.max(10,Math.min(vt.y-30,window.innerHeight-200));b(E,H({x:W,y:Q}))}}i(te)&&b(Ne,H({x:Math.max(10,Math.min(i(Ne).x,window.innerWidth-320)),y:Math.max(10,Math.min(i(Ne).y,window.innerHeight-400))}))}function ze(){if(typeof localStorage<"u"){const Ie=localStorage.getItem("contextMenuPosition");if(Ie)try{b(de,H(JSON.parse(Ie)))}catch(ge){console.log("Error loading saved position:",ge)}}}function Ge(Ie){typeof localStorage<"u"&&(localStorage.setItem("contextMenuPosition",JSON.stringify(Ie)),b(de,H(Ie)))}const xt="drawing_tools",jt=hd("save"),ft=hd("ctx"),ke=hd("chart"),Se=Th({}),Et=hd("drawingManager"),wt=15,Ls="smartchart.drawingDefaults",tn="smartchart.fibonacciLevels",Gs={thickness:"1",style:"solid",color:"#1677FF",opacity:100},an={rect:{opacity:10}},Es={fontSize:"32",fontWeight:"bold",textColor:"#FFFFFF",textOpacity:100,backgroundColor:"#A00000",backgroundOpacity:20,fontFamily:Te},Ns=[{value:0,visible:!0,color:"#FF6B6B",opacity:wt},{value:.236,visible:!0,color:"#4ECDC4",opacity:wt},{value:.382,visible:!0,color:"#45B7D1",opacity:wt},{value:.5,visible:!0,color:"#96CEB4",opacity:wt},{value:.618,visible:!0,color:"#FFEAA7",opacity:wt},{value:1,visible:!0,color:"#98D8C8",opacity:wt},{value:1.618,visible:!0,color:"#85C1E9",opacity:wt},{value:.786,visible:!1,color:"#DDA0DD",opacity:wt},{value:1.272,visible:!1,color:"#F7DC6F",opacity:wt},{value:1.414,visible:!1,color:"#BB8FCE",opacity:wt},{value:2,visible:!1,color:"#FFB6C1",opacity:wt},{value:2.272,visible:!1,color:"#98FB98",opacity:wt},{value:2.414,visible:!1,color:"#F0E68C",opacity:wt},{value:2.618,visible:!1,color:"#F8C471",opacity:wt},{value:3,visible:!1,color:"#DEB887",opacity:wt},{value:3.618,visible:!1,color:"#CD853F",opacity:wt},{value:4,visible:!1,color:"#D2691E",opacity:wt},{value:4.236,visible:!1,color:"#A0522D",opacity:wt},{value:4.272,visible:!1,color:"#8B4513",opacity:wt},{value:4.618,visible:!1,color:"#654321",opacity:wt}];function Hs(Ie){return Ie.map(ge=>({...ge}))}function ns(Ie){if(!Array.isArray(Ie))return Hs(Ns);const ge=Ie.map((Re,vt)=>{const Bt=Ns[vt]||Ns[Ns.length-1],Xt=typeof(Re==null?void 0:Re.value)=="number"?Re.value:Bt.value,W=typeof(Re==null?void 0:Re.visible)=="boolean"?Re.visible:Bt.visible,Q=typeof(Re==null?void 0:Re.color)=="string"?Re.color:Bt.color,O=typeof(Re==null?void 0:Re.opacity)=="number"?Re.opacity:Bt.opacity,U=Math.max(0,Math.min(100,O??wt));return{value:Xt,visible:W,color:Q,opacity:U}});return ge.length?ge:Hs(Ns)}function fs(){if(typeof localStorage>"u")return Ls;const Ie=localStorage.getItem("userId");return Ie?`${Ls}.${Ie}`:Ls}function Mn(){if(typeof localStorage>"u")return null;try{const Ie=localStorage.getItem(fs());if(Ie)return JSON.parse(Ie);const ge=localStorage.getItem(Tn());if(ge){const vt={fibonacciLevels:JSON.parse(ge)};return po(vt),vt}return null}catch{return null}}function po(Ie){if(!(typeof localStorage>"u"))try{localStorage.setItem(fs(),JSON.stringify(Ie))}catch{}}function Tn(){if(typeof localStorage>"u")return tn;const Ie=localStorage.getItem("userId");return Ie?`${tn}.${Ie}`:tn}function Cn(Ie){const ge=(Ie||"").trim();if(!ge)return null;if(/^#([0-9a-f]{8})$/i.test(ge))return{r:parseInt(ge.slice(1,3),16),g:parseInt(ge.slice(3,5),16),b:parseInt(ge.slice(5,7),16),a:parseInt(ge.slice(7,9),16)/255};if(/^#([0-9a-f]{6})$/i.test(ge))return{r:parseInt(ge.slice(1,3),16),g:parseInt(ge.slice(3,5),16),b:parseInt(ge.slice(5,7),16)};if(/^#([0-9a-f]{3})$/i.test(ge)){const vt=ge[1],Bt=ge[2],Xt=ge[3];return{r:parseInt(vt+vt,16),g:parseInt(Bt+Bt,16),b:parseInt(Xt+Xt,16)}}const Re=ge.match(/^rgba?\(([^)]+)\)$/i);if(Re){const vt=Re[1].split(",").map(Bt=>parseFloat(Bt.trim()));if(vt.length>=3&&vt.every(Bt=>!Number.isNaN(Bt)))return{r:Math.round(vt[0]),g:Math.round(vt[1]),b:Math.round(vt[2]),a:vt.length>=4?Math.max(0,Math.min(1,vt[3])):void 0}}return null}function go(Ie){const ge=Re=>Math.max(0,Math.min(255,Math.round(Re))).toString(16).padStart(2,"0");return`#${ge(Ie.r)}${ge(Ie.g)}${ge(Ie.b)}`}function no(Ie,ge){const Re=Cn(Ie);return Re?go(Re):ge}function Bo(Ie,ge,Re){const vt=no(Ie,Re),Bt=Math.round(Math.max(0,Math.min(100,ge))/100*255).toString(16).padStart(2,"0");return`${vt}${Bt}`}function Vo(Ie){const ge=(Ie==null?void 0:Ie.style)==="dashed"||(Ie==null?void 0:Ie.style)==="dotted"?Ie.style:"solid",Re=typeof(Ie==null?void 0:Ie.opacity)=="number"?Math.max(0,Math.min(100,Ie.opacity)):Gs.opacity,vt=(Ie==null?void 0:Ie.thickness)??Gs.thickness,Bt=String(vt),Xt=no((Ie==null?void 0:Ie.color)||Gs.color,Gs.color);return{thickness:Bt,style:ge,color:Xt,opacity:Re}}function Rl(Ie){return{fontSize:String((Ie==null?void 0:Ie.fontSize)??Es.fontSize),fontWeight:(Ie==null?void 0:Ie.fontWeight)==="normal"?"normal":Es.fontWeight,textColor:no((Ie==null?void 0:Ie.textColor)||Es.textColor,Es.textColor),textOpacity:typeof(Ie==null?void 0:Ie.textOpacity)=="number"?Math.max(0,Math.min(100,Ie.textOpacity)):Es.textOpacity,backgroundColor:no((Ie==null?void 0:Ie.backgroundColor)||Es.backgroundColor,Es.backgroundColor),backgroundOpacity:typeof(Ie==null?void 0:Ie.backgroundOpacity)=="number"?Math.max(0,Math.min(100,Ie.backgroundOpacity)):Es.backgroundOpacity,fontFamily:String((Ie==null?void 0:Ie.fontFamily)||Es.fontFamily)}}function aa(Ie){b(Me,H({fontSize:Ie.fontSize,fontWeight:Ie.fontWeight,textColor:Ie.textColor,backgroundColor:Ie.backgroundColor,fontFamily:Ie.fontFamily})),b(De,H(Ie.textOpacity)),b(Oe,H(Ie.backgroundOpacity))}function tl(Ie){var ge;return((ge=Ie==null?void 0:Ie.extendData)==null?void 0:ge.origin)==="user"||(Ie==null?void 0:Ie.groupId)===xt}function Zr(){return Ys.get(o().options,"drawingDefaults")||{}}function zi(Ie,ge){return{lineByTool:{...ge.lineByTool||{},...Ie.lineByTool||{}},text:Ie.text||ge.text,fibonacciLevels:Ie.fibonacciLevels||ge.fibonacciLevels}}function Nl(){const Ie=Zr(),ge=Mn()||{};return zi(Ie,ge)}function mu(Ie,ge){const Re=Vo(ge);jt.update(Xt=>{Xt.options||(Xt.options={}),Xt.options.drawingDefaults||(Xt.options.drawingDefaults={});const W=Xt.options.drawingDefaults;return W.lineByTool||(W.lineByTool={}),W.lineByTool[Ie]=Re,Xt});const vt=Mn()||{},Bt={...vt,lineByTool:{...vt.lineByTool||{},[Ie]:Re}};po(Bt),Hm()}function Gc(Ie){var vt;const ge=Nl();if((vt=ge.lineByTool)!=null&&vt[Ie])return Vo(ge.lineByTool[Ie]);const Re=an[Ie];return Vo(Re?{...Gs,...Re}:Gs)}function du(Ie){const ge=Rl(Ie);jt.update(Bt=>(Bt.options||(Bt.options={}),Bt.options.drawingDefaults||(Bt.options.drawingDefaults={}),Bt.options.drawingDefaults.text=ge,Bt));const vt={...Mn()||{},text:ge};po(vt),Hm()}function Ju(){const Ie=Nl();return Rl(Ie.text)}function rd(Ie){if(!Ie)return{color:Gs.color,opacity:Gs.opacity};const ge=Ie.trim();if(/^#([0-9a-f]{8})$/i.test(ge)){const vt=`#${ge.slice(1,7)}`,Bt=parseInt(ge.slice(7,9),16),Xt=Math.round(Bt/255*100);return{color:vt,opacity:Xt}}const Re=Cn(ge);if(Re){const vt=typeof Re.a=="number"?Math.round(Re.a*100):100;return{color:go(Re),opacity:vt}}return{color:Gs.color,opacity:Gs.opacity}}function Al(Ie){var vt;const ge=(vt=Ie==null?void 0:Ie.styles)==null?void 0:vt.line;if(!ge)return;const Re=rd(ge.color||Gs.color);if(P.thickness=String(ge.size||Gs.thickness),P.color=Re.color,P.opacity=Re.opacity,ge.style===mt.Dashed){const Bt=ge.dashedValue;Bt&&Bt[0]===2&&(Bt[1]===6||Bt[1]===8)?P.style="dotted":P.style="dashed"}else P.style="solid"}function sa(){const Ie=Ys.get(o().options,"drawingDefaults.fibonacciLevels");if(Ie)return ns(Ie);const ge=Mn();return ge!=null&&ge.fibonacciLevels?ns(ge.fibonacciLevels):Hs(Ns)}function Vc(Ie){jt.update(vt=>(vt.options||(vt.options={}),vt.options.drawingDefaults||(vt.options.drawingDefaults={}),vt.options.drawingDefaults.fibonacciLevels=Hs(Ie),vt));const Re={...Mn()||{},fibonacciLevels:Hs(Ie)};po(Re),Hm()}let vu=_e(!1),Qc=_e(H(sa())),To=_e(H(Hs(i(Qc))));const ec=qp.getState();let yl=_e(!1),Dc=_e(!1);Xr(()=>{const Ie=r();b(yl,Ie.undoStack.length>0),b(Dc,Ie.redoStack.length>0)}),Xr(()=>{n()&&qp.init({chart:n(),saveStore:jt,overlaysStore:Se})});let jl=!1;Xr(()=>{n()&&!jl&&(jl=!0,setTimeout(()=>{Uu()},0))});function qi(Ie){const ge=o().symbol;return`${ge.shortName??ge.name??ge.ticker}_${o().period.timeframe}_${Ie}`}let la={};const br=H([{key:"single-line",icon:"segment",list:[{key:"segment",text:"segment"},{key:"arrow",text:"arrow"},{key:"rayLine",text:"ray_line"},{key:"straightLine",text:"straight_line"},{key:"priceLine",text:"price_line"},{key:"horizontalStraightLine",text:"horizontal_straight_line"},{key:"horizontalRayLine",text:"horizontal_ray_line"},{key:"horizontalSegment",text:"horizontal_segment"},{key:"verticalStraightLine",text:"vertical_straight_line"},{key:"verticalRayLine",text:"vertical_ray_line"},{key:"verticalSegment",text:"vertical_segment"}]},{key:"more-line",icon:"priceChannelLine",list:[{key:"priceChannelLine",text:"price_channel_line"},{key:"parallelStraightLine",text:"parallel_straight_line"}]},{key:"polygon",icon:"rect",list:[{key:"circle",text:"circle"},{key:"rect",text:"rect"},{key:"parallelogram",text:"parallelogram"},{key:"triangle",text:"triangle"}]},{key:"fibonacci",icon:"fibonacciSegment",list:[{key:"fibonacciSegment",text:"fibonacci_segment"},{key:"fibonacciCircle",text:"fibonacci_circle"},{key:"fibonacciSpiral",text:"fibonacci_spiral"},{key:"fibonacciSpeedResistanceFan",text:"fibonacci_speed_resistance_fan"},{key:"fibonacciExtension",text:"fibonacci_extension"},{key:"gannBox",text:"gann_box"}]},{key:"wave",icon:"xabcd",list:[{key:"xabcd",text:"xabcd"},{key:"abcd",text:"abcd"},{key:"threeWaves",text:"three_waves"},{key:"fiveWaves",text:"five_waves"},{key:"eightWaves",text:"eight_waves"},{key:"anyWaves",text:"any_waves"}]},{key:"emoji",icon:"emoji",list:[]},{key:"text",icon:"text",list:[]}]),Wc=H([{key:"weakMagnet",text:"weakMagnet"},{key:"strongMagnet",text:"strongMagnet"}]);function Xd(Ie){i(c)==Ie?b(c,""):b(c,H(Ie))}function Uf(Ie){if(!n()||!(Ie!=null&&Ie.id))return Ie;try{const ge=n().getOverlays({id:Ie.id});if(ge&&ge[0])return ge[0]}catch{}return Ie}function xf(Ie,ge={}){const Re=Ie?J1[Ie]??{}:{};let vt=!1;const Bt={onMouseEnter:Xt=>{Re.onMouseEnter&&Re.onMouseEnter(Xt);try{window.__overlayHover=!0}catch{}return ut("pointer"),!0},onMouseLeave:Xt=>{Re.onMouseLeave&&Re.onMouseLeave(Xt);try{window.__overlayHover=!1}catch{}return ut(null),!0},onPressedMoving:Xt=>{var W;Re.onPressedMoving&&Re.onPressedMoving(Xt),vt=!0;try{if(n()&&((W=Xt.overlay)!=null&&W.id)&&!la[Xt.overlay.id]){const Q=n().getOverlays({id:Xt.overlay.id});Q&&Q[0]&&(la[Xt.overlay.id]=JSON.parse(JSON.stringify(Q[0])))}}catch{}return!1},onPressedMoveEnd:Xt=>{var W;if(!vt)return!0;vt=!1,Ua(Xt.overlay);try{const Q=la[Xt.overlay.id],O=Xt.overlay;if(Q&&O){const U=qi(Xt.overlay.id);qp.recordModifyOverlay(Xt.overlay.id,Q,O,U)}}catch{}if(delete la[Xt.overlay.id],i(v)===Xt.overlay.id&&Xt.overlay.points&&Xt.overlay.points.length>0){const Q=Xt.overlay.points[0],O=Xt.overlay.paneId||"candle_pane",U=(W=n())==null?void 0:W.convertToPixel(Q,{paneId:O});U&&typeof U=="object"&&"x"in U&&"y"in U&&U.x!==void 0&&U.y!==void 0&&b(S,H({x:U.x-80,y:U.y-30}))}return!0},onSelected:Xt=>{Re.onSelected&&Re.onSelected(Xt),ie=Date.now();const W=Uf(Xt.overlay);if(b(v,H(W.id)),b(A,H(W)),Al(W),(W==null?void 0:W.name)==="text"&&ei(W),W.points&&W.points.length>0){const Q=nt(W),O=i(de)||Q;O&&(b(E,H({...O})),b(S,H({x:O.x,y:O.y})),b(I,!0),b(C,!1),Al(W))}return!0},onDeselected:Xt=>(Re.onDeselected&&Re.onDeselected(Xt),b(v,""),b(C,!1),b(I,!1),b(ne,!1),b(S,null),b(A,null),!0),onRemoved:Xt=>{Re.onRemoved&&Re.onRemoved(Xt),Se.update(Q=>(delete Q[qi(Xt.overlay.id)],Q));const W=Et.get();if(W)try{W.removeDrawing(Xt.overlay.id),console.log("🗑️ Removed drawing from DrawingManager:",Xt.overlay.id),Hm()}catch(Q){console.error("Error removing drawing from DrawingManager:",Q)}return!0}};return ge.includeDrawEnd&&(Bt.onDrawEnd=Xt=>{Re.onDrawEnd&&Re.onDrawEnd(Xt),Ua(Xt.overlay);const W=qi(Xt.overlay.id);if(qp.recordAddOverlay(Xt.overlay.id,Xt.overlay,W),i(x)===Xt.overlay.id&&b(x,null),Xt.overlay.name==="text")try{b(A,H(Xt.overlay)),b(v,H(Xt.overlay.id));const Q=nt(Xt.overlay),O=i(de)||Q;O&&(b(E,H({...O})),b(S,H({x:O.x,y:O.y})),b(I,!0),b(C,!1)),n()&&P_.startEditing(n(),Xt.overlay)}catch{}return!0}),Bt}function Uu(){var Ie,ge;if(n())try{(((ge=(Ie=n()).getOverlays)==null?void 0:ge.call(Ie))||[]).forEach(vt=>{const Bt=(vt==null?void 0:vt.name)||(vt==null?void 0:vt.type),Xt=(vt==null?void 0:vt.groupId)===xt||Bt&&J1[String(Bt)];if(!(vt!=null&&vt.id)||!Bt||!Xt)return;const W=xf(String(Bt),{includeDrawEnd:!0});try{n().overrideOverlay({id:vt.id,groupId:xt,...W})}catch{}})}catch{}}function tp(){var Ie,ge;if(!n())return null;try{return(((ge=(Ie=n()).getOverlays)==null?void 0:ge.call(Ie))||[]).find(Bt=>{var Xt,W;return((Bt==null?void 0:Bt.groupId)===xt||(Bt==null?void 0:Bt.name)&&J1[String(Bt.name)])&&((Bt==null?void 0:Bt.selected)===!0||((Xt=Bt==null?void 0:Bt.extendData)==null?void 0:Xt.selected)===!0||((W=Bt==null?void 0:Bt.extendData)==null?void 0:W.editing)===!0)})||null}catch{}return null}function wf(Ie){var vt;const ge={groupId:xt,...xf(Ie==null?void 0:Ie.name,{includeDrawEnd:!0})},Re=(vt=n())==null?void 0:vt.createOverlay(Ys.mergeWith({},ge,Ie,(Bt,Xt,W)=>{if(W.startsWith("on")&&Bt&&Xt)return Q=>(Xt(Q),Bt(Q))}));return Re&&(Array.isArray(Re)?(p.push(...Re),Re.length>0&&b(x,H(Re[0]))):(p.push(Re),b(x,H(Re)))),Re}function Vs(Ie){Ie==="text"&&ut("text"),i(d)&&(b(d,!1),Qi(!1,{preserveManualLock:!0}));const ge=Gc(Ie);let Re=mt.Solid,vt=[8,4];ge.style==="dashed"?(Re=mt.Dashed,vt=[8,4]):ge.style==="dotted"&&(Re=mt.Dashed,vt=[2,6]);const Bt=Number(ge.thickness)||1,Xt=Bo(ge.color,ge.opacity,Gs.color),W={line:{size:Bt,color:Xt,style:Re,dashedValue:vt},text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF"},polygon:{color:Xt}},Q={origin:"user"};if(Ie==="text"){const O=Ju(),U=Bo(O.textColor,O.textOpacity,Es.textColor),ce=Bo(O.backgroundColor,O.backgroundOpacity,Es.backgroundColor);Q.text=hr,Q.fontSize=Number(O.fontSize)||32,Q.fontWeight=O.fontWeight,Q.textColor=O.textColor,Q.backgroundColor=ce,Q.fontFamily=O.fontFamily,Q.textOpacity=O.textOpacity,Q.textBgOpacity=O.backgroundOpacity,W.text={...W.text,size:Number(O.fontSize)||32,weight:O.fontWeight,family:O.fontFamily,color:U,backgroundColor:ce}}Ie==="fibonacciSegment"&&(Q.fibonacciLevels=Hs(sa())),wf({name:Ie,visible:i(h),lock:i(d),mode:i(u),styles:W,extendData:Q})}function kn(Ie,ge){br[Ie].icon=ge,Vs(ge),b(c,"")}function Kn(Ie){return Ie==="priceChannelLine"?"priceChannelLineNew":Ie}function Bs(){var ge;let Ie=i(f);i(u)!=="normal"&&(Ie="normal"),b(u,H(Ie)),(ge=n())==null||ge.overrideOverlay({mode:Ie})}function bo(Ie){var ge;b(f,H(Ie)),b(u,H(Ie)),b(c,""),(ge=n())==null||ge.overrideOverlay({mode:Ie})}function lo(Ie){let Re=0;return Ie==="crosshair"?Re=0:br.find(vt=>vt.key===Ie)?Re=1+br.findIndex(vt=>vt.key===Ie):Ie==="ruler"?Re=1+br.length+1:Ie==="mode"?Re=1+br.length+2:Ie==="lock"?Re=1+br.length+3:Ie==="visible"?Re=1+br.length+4:Ie==="remove"&&(Re=1+br.length+5),Re*52}function Qi(Ie,ge={}){var Re,vt;if(n())try{(((vt=(Re=n()).getOverlays)==null?void 0:vt.call(Re))||[]).forEach(Xt=>{var O,U;const W=(Xt==null?void 0:Xt.name)||(Xt==null?void 0:Xt.type),Q=(Xt==null?void 0:Xt.groupId)===xt||W&&J1[String(W)];!(Xt!=null&&Xt.id)||!Q||!Ie&&ge.preserveManualLock&&((O=Xt==null?void 0:Xt.extendData)==null?void 0:O.manualLock)===!0||(U=n())==null||U.overrideOverlay({id:Xt.id,lock:Ie})})}catch(Bt){console.warn("setOverlayLock failed:",Bt)}}function xr(){b(d,!i(d)),i(d)?Qi(!0):Qi(!1,{preserveManualLock:!0})}function Ai(){var Ie;b(h,!i(h)),(Ie=n())==null||Ie.overrideOverlay({visible:i(h)})}function ri(){var Ie,ge;if(b(u,"normal"),b(f,"weakMagnet"),ut(null),i(x)){(Ie=n())==null||Ie.removeOverlay({id:i(x)});const Re=p.indexOf(i(x));Re>-1&&p.splice(Re,1),b(x,null)}(ge=n())==null||ge.overrideOverlay({mode:kI.Normal}),b(c,""),b(I,!1),b(C,!1),b(ne,!1),b(S,null),b(A,null),b(v,"")}function Ti(){var Re;let Ie={groupId:xt},ge=null;if(i(v))Ie.id=i(v),ge=i(A);else if(p.length>0){const vt=p.pop();if(Ie.id=vt,vt&&n()){const Bt=n().getOverlays({id:vt});Bt&&Bt.length>0&&(ge=Bt[0])}}if(ge){const vt=qi(ge.id);qp.recordRemoveOverlay(ge.id,ge,vt)}(Re=n())==null||Re.removeOverlay(Ie),b(I,!1),b(C,!1),b(ne,!1),b(S,null),b(A,null)}function Eo(){var Q;if(!i(A)||!n())return;const Ie=qi(i(A).id),ge=JSON.parse(JSON.stringify(i(A))),Re=Number(P.thickness)||1;let vt=mt.Solid,Bt=[8,4];P.style==="dashed"?(vt=mt.Dashed,Bt=[8,4]):P.style==="dotted"&&(vt=mt.Dashed,Bt=[2,6]);const Xt=Bo(P.color,P.opacity,Gs.color),W={line:{size:Re,color:Xt,style:vt,dashedValue:Bt},text:{color:"#FFFFFF",backgroundColor:"rgba(0, 100, 255, 0.7)",borderColor:"#FFFFFF"},polygon:{color:Xt}};try{n().overrideOverlay({id:i(A).id,styles:W})}catch(O){console.log("Error updating overlay styles:",O)}Ua({...i(A),styles:{...i(A).styles,...W}}),tl(i(A))&&((Q=i(A))!=null&&Q.name)&&mu(i(A).name,{thickness:P.thickness,style:P.style,color:P.color,opacity:P.opacity});try{const O={...i(A),styles:{...i(A).styles,...W}};qp.recordModifyOverlay(i(A).id,ge,O,Ie)}catch{}}const hr="Add text";function ei(Ie){const ge=Ie.extendData||{},vt=(Ie.styles||{}).text||{},Bt=ge.backgroundColor||vt.backgroundColor||"#A0000020";let Xt=Bt;if(typeof Bt=="string"&&Bt.startsWith("#")&&Bt.length===9){Xt=Bt.slice(0,7);try{b(Oe,H(Math.round(parseInt(Bt.slice(7,9),16)/255*100)))}catch{}}typeof ge.textBgOpacity=="number"&&b(Oe,H(Math.max(0,Math.min(100,ge.textBgOpacity))));const W=ge.textColor||vt.color||"#FFFFFF";let Q=W;if(typeof W=="string"&&W.startsWith("#")&&W.length===9){Q=W.slice(0,7);try{b(De,H(Math.round(parseInt(W.slice(7,9),16)/255*100)))}catch{}}typeof ge.textOpacity=="number"&&b(De,H(Math.max(0,Math.min(100,ge.textOpacity)))),i(Me).fontSize=String(ge.fontSize||vt.size||32),i(Me).fontWeight=ge.fontWeight||vt.weight||"bold",i(Me).textColor=no(Q,Es.textColor),i(Me).backgroundColor=no(Xt,Es.backgroundColor),i(Me).fontFamily=ge.fontFamily||vt.family||Te}function ai(){var Ue,dt,et,B,ve,Fe,ot;if(!i(A)||!n()||i(A).name!=="text")return;const Ie=qi(i(A).id),ge=JSON.parse(JSON.stringify(i(A))),Re=Number(i(Me).fontSize)||12,vt=i(Me).backgroundColor||Es.backgroundColor,Bt=i(Me).textColor||Es.textColor,Xt=Bo(vt,i(Oe),Es.backgroundColor),W=Bo(Bt,i(De),Es.textColor),Q=((Ue=i(A).styles)==null?void 0:Ue.text)||{},O=Q.size??((dt=i(A).extendData)==null?void 0:dt.fontSize),U=Q.weight??((et=i(A).extendData)==null?void 0:et.fontWeight),ce=Q.family??((B=i(A).extendData)==null?void 0:B.fontFamily),G=O!==Re||U!==i(Me).fontWeight||ce!==i(Me).fontFamily,ye={...i(A).extendData||{},fontSize:Re,fontWeight:i(Me).fontWeight,textColor:i(Me).textColor,backgroundColor:Xt,fontFamily:i(Me).fontFamily,...G?{boxWidth:0,boxHeight:0}:{}},Qe={...i(A).styles||{},text:{...((ve=i(A).styles)==null?void 0:ve.text)||{},size:Re,color:W,backgroundColor:Xt,family:i(Me).fontFamily,weight:i(Me).fontWeight,paddingLeft:8,paddingRight:8,paddingTop:4,paddingBottom:4,borderSize:0,borderColor:"transparent"},box:{...((Fe=i(A).styles)==null?void 0:Fe.box)||{},stroke:"#3b82f6",width:1,fill:"transparent"},handles:{...((ot=i(A).styles)==null?void 0:ot.handles)||{},size:6,fill:"#3b82f6",stroke:"#3b82f6"}};try{if(n().overrideOverlay({id:i(A).id,styles:Qe,extendData:{...ye,textColor:Bt,backgroundColor:Xt,textOpacity:i(De),textBgOpacity:i(Oe)}}),(i(A).extendData||{}).editing)try{P_.updateEditorStyle(i(A))}catch{}}catch(tt){console.log("Error updating text overlay styles:",tt)}b(A,H({...i(A),styles:Qe,extendData:ye})),Ua(i(A)),tl(i(A))&&du({fontSize:i(Me).fontSize,fontWeight:i(Me).fontWeight,textColor:i(Me).textColor,textOpacity:i(De),backgroundColor:i(Me).backgroundColor,backgroundOpacity:i(Oe),fontFamily:i(Me).fontFamily});try{const tt=JSON.parse(JSON.stringify(i(A)));qp.recordModifyOverlay(i(A).id,ge,tt,Ie)}catch{}}function vi(Ie){var Xt;b(T,!0),b(L,H(Date.now()));const ge=Ie instanceof MouseEvent?Ie.clientX:Ie.touches[0].clientX,Re=Ie instanceof MouseEvent?Ie.clientY:Ie.touches[0].clientY,vt=(Xt=Ie.target.closest(".context-menu-container"))==null?void 0:Xt.getBoundingClientRect();vt?(j.x=ge-vt.left,j.y=Re-vt.top):i(E)&&(j.x=ge-i(E).x,j.y=Re-i(E).y);const Bt=Ie;typeof Bt.preventDefault=="function"&&Bt.preventDefault(),typeof Bt.stopPropagation=="function"&&Bt.stopPropagation()}function _a(Ie){if(i(T)&&i(E)){b(L,H(Date.now()));const ge=Ie instanceof MouseEvent?Ie.clientX:Ie.touches[0].clientX,Re=Ie instanceof MouseEvent?Ie.clientY:Ie.touches[0].clientY,vt=window.innerWidth<=768,Bt=vt?Math.min(250,window.innerWidth-40):300,Xt=vt?40:60,W=vt?5:10,Q=Ft==null?void 0:Ft.getBoundingClientRect();let O=ge-j.x,U=Re-j.y;const ce=((Q==null?void 0:Q.left)||0)+W,G=(Q?Q.right:window.innerWidth)-Bt-W,ye=((Q==null?void 0:Q.top)||0)+W,Qe=(Q?Q.bottom:window.innerHeight)-Xt-W;i(E).x=Math.max(ce,Math.min(O,G)),i(E).y=Math.max(ye,Math.min(U,Qe))}}function dl(){i(T)&&i(E)&&Ge(i(E)),b(T,!1),b(L,H(Date.now()))}function ar(Ie){_a(Ie)}function Jr(){dl()}function nl(Ie){const ge=Ie.detail;i(le)==="line"?(P.color=ge,Eo()):i(le)==="textColor"?(i(Me).textColor=ge,ai()):i(le)==="textBg"&&(i(Me).backgroundColor=ge,ai())}function tc(Ie){const ge=Ie.detail;i(le)==="line"?(P.opacity=ge,b(re,H(ge)),Eo()):i(le)==="textColor"?(b(De,H(ge)),b(re,H(ge)),ai()):i(le)==="textBg"&&(b(Oe,H(ge)),b(re,H(ge)),ai())}function mc(){b(te,!1)}function gu(){const Ie=qp.undo();console.log(Ie?"Undo successful":"Nothing to undo")}function Bl(){const Ie=qp.redo();console.log(Ie?"Redo successful":"Nothing to redo")}function Ui(Ie){(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="z"&&!Ie.shiftKey?(Ie.preventDefault(),gu()):(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="y"||(Ie.ctrlKey||Ie.metaKey)&&Ie.shiftKey&&Ie.key==="z"?(Ie.preventDefault(),Bl()):(Ie.key==="Delete"||Ie.key==="Backspace")&&i(v)?(Ie.preventDefault(),Ti()):(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="c"&&i(A)?(Ie.preventDefault(),fl()):(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="v"&&i(D)&&(Ie.preventDefault(),bl(Ie))}function Ol(){if(!(!i(A)||!n())){b(X,!0);try{const Ie=JSON.parse(JSON.stringify(i(A))),ge=Date.now();Ie.id=`${i(A).name}_clone_${ge}`,Ie.points&&Array.isArray(Ie.points)&&(Ie.points=Ie.points.map(vt=>vt&&typeof vt=="object"?{...vt,timestamp:vt.timestamp?vt.timestamp+1e3*60*5:vt.timestamp,value:vt.value?vt.value*1.002:vt.value}:vt));const Re=wf(Ie);if(Re){const vt=Array.isArray(Re)?Re[0]:Re;if(vt){const Bt=qi(vt);qp.recordAddOverlay(vt,Ie,Bt),setTimeout(()=>{var W;const Xt=n().getOverlays({id:vt})[0];if(Xt&&(b(v,H(vt)),b(A,H(Xt)),Al(Xt),(Xt==null?void 0:Xt.name)==="text"&&ei(Xt),Xt.points&&Xt.points.length>0)){const Q=Xt.points[0],O=(W=n())==null?void 0:W.convertToPixel(Q,{paneId:"candle_pane"});O&&typeof O=="object"&&"x"in O&&"y"in O&&O.x!==void 0&&O.y!==void 0&&(b(S,H({x:O.x-80,y:O.y-30})),i(de)?b(E,H({...i(de)})):b(E,H({x:O.x-80,y:O.y-30})),b(I,!0),b(C,!1),b(ne,!1))}},100)}console.log("Overlay cloned successfully")}}catch(Ie){console.error("Error cloning overlay:",Ie)}finally{b(X,!1)}}}function fl(){if(i(A))try{b(D,H(JSON.parse(JSON.stringify(i(A))))),console.log("Overlay copied to clipboard"),b(I,!1),setTimeout(()=>{console.log("Copy operation completed")},100)}catch(Ie){console.error("Error copying overlay:",Ie)}}function bl(Ie){if(!(!i(D)||!n()))try{const ge=JSON.parse(JSON.stringify(i(D))),Re=Date.now();ge.id=`${i(D).name}_paste_${Re}`,Ie&&ge.points&&Array.isArray(ge.points)&&(ge.points=ge.points.map(Bt=>Bt&&typeof Bt=="object"?{...Bt,timestamp:Bt.timestamp?Bt.timestamp+1e3*60*10:Bt.timestamp,value:Bt.value?Bt.value*1.005:Bt.value}:Bt));const vt=wf(ge);if(vt){const Bt=Array.isArray(vt)?vt[0]:vt;if(Bt){const Xt=qi(Bt);qp.recordAddOverlay(Bt,ge,Xt),setTimeout(()=>{var Q;const W=n().getOverlays({id:Bt})[0];if(W&&(b(v,H(Bt)),b(A,H(W)),Al(W),(W==null?void 0:W.name)==="text"&&ei(W),W.points&&W.points.length>0)){const O=W.points[0],U=(Q=n())==null?void 0:Q.convertToPixel(O,{paneId:"candle_pane"});U&&typeof U=="object"&&"x"in U&&"y"in U&&U.x!==void 0&&U.y!==void 0&&(b(S,H({x:U.x-80,y:U.y-30})),i(de)?b(E,H({...i(de)})):b(E,H({x:U.x-80,y:U.y-30})),b(I,!0),b(C,!1),b(ne,!1))}},100)}console.log("Overlay pasted successfully")}}catch(ge){console.error("Error pasting overlay:",ge)}}function Ua(Ie){if(Ie.groupId!==xt)return;const ge=["extendData","groupId","id","lock","mode","name","paneId","points","styles","totalStep","visible","zLevel"],Re=qi(Ie.id);Se.update(Bt=>(Bt[Re]=Object.fromEntries(ge.map(Xt=>[Xt,Ie[Xt]])),Bt));const vt=Et.get();if(vt&&Ie.points&&Ie.points.length>0)try{const Bt=a0(o().symbol),Xt={id:Ie.id,symbolKey:Bt,type:Ie.name||"unknown",points:Ie.points.map(W=>({time:W.timestamp||W.t||0,price:W.value||W.p||0})),styles:Ie.styles||{},...Ie.extendData?{extendData:Ie.extendData}:{},locked:!!Ie.lock,visible:Ie.visible!==!1};vt.addDrawing(Xt),Hm()}catch(Bt){console.error("Error syncing overlay to DrawingManager:",Bt)}}function er(){if(b(xe,!i(xe)),i(xe)){const Ie=zt();b(se,H({x:Ie.left+60,y:Ie.top+100}))}}function ba(Ie){const{emoji:ge}=Ie.detail;console.log("Selected emoji:",ge),b(xe,!1),wf({name:"emoji",visible:i(h),lock:i(d),mode:i(u),extendData:{emoji:ge,size:24},styles:{box:{enabled:!1,stroke:"#3b82f6",width:1,fill:"transparent"},handles:{size:6,fill:"#3b82f6",stroke:"#3b82f6"}}})}function ol(Ie){if(!i(A)||i(A).name!=="emoji")return;const ge=qi(i(A).id),Re=JSON.parse(JSON.stringify(i(A))),vt=parseInt(Ie);if(!(isNaN(vt)||vt<16||vt>64)&&(i(A).extendData&&(i(A).extendData.size=vt),n()&&i(A).id)){n().overrideOverlay({id:i(A).id,extendData:i(A).extendData}),Ua(i(A));try{const Bt=JSON.parse(JSON.stringify(i(A)));qp.recordModifyOverlay(i(A).id,Re,Bt,ge)}catch{}}}function xd(){var Ie,ge;if(((Ie=i(A))==null?void 0:Ie.name)==="fibonacciSegment"){const Re=((ge=i(A).extendData)==null?void 0:ge.fibonacciLevels)||i(A).fibonacciLevels;Re?b(Qc,H(ns(Re))):b(Qc,H(sa())),b(To,H(Hs(i(Qc)))),b(vu,!0)}}function _u(){b(Qc,H(Hs(Ns))),vc()}function eu(){vc(),b(vu,!1)}function ca(){b(Qc,H(Hs(i(To)))),vc(),b(vu,!1)}function vc(){if(!i(A)||i(A).name!=="fibonacciSegment"||!n())return;const Ie=qi(i(A).id),ge=JSON.parse(JSON.stringify(i(A))),Re=Hs(i(Qc));n().overrideOverlay({id:i(A).id,extendData:{...i(A).extendData,fibonacciLevels:Re}}),i(A).extendData={...i(A).extendData||{},fibonacciLevels:Re},i(A).fibonacciLevels=Re,Ua(i(A)),Vc(Re);try{const vt=JSON.parse(JSON.stringify(i(A)));qp.recordModifyOverlay(i(A).id,ge,vt,Ie)}catch{}}function rc(Ie,ge,Re){Ie>=0&&Ie<i(Qc).length&&(i(Qc)[Ie]={...i(Qc)[Ie],[ge]:Re},vc())}pp(ft,Ie=>Ie.clickChart).subscribe(()=>{if(b(c,""),Date.now()-ie>150&&!i(T)){const ge=tp();if(ge&&(!i(A)||i(A).id!==ge.id)){Uu(),Tl(ge);return}!i(v)&&!i(A)&&(b(I,!1),b(C,!1),b(ne,!1),b(S,null))}}),sm(()=>{if(ze(),aa(Ju()),typeof document<"u"&&(document.addEventListener("mousemove",_a),document.addEventListener("mouseup",dl),document.addEventListener("touchmove",ar,{passive:!1}),document.addEventListener("touchend",Jr),document.addEventListener("touchcancel",Jr)),typeof window<"u"){window.addEventListener("resize",it);const Ie=ge=>{if(n()&&i(A)&&i(A).name==="text"){const Re=nt(i(A)),vt=i(de)||Re;vt&&(b(E,H({...vt})),b(S,H({x:vt.x,y:vt.y})),b(I,!0),b(C,!1)),P_.startEditing(n(),i(A))}};window.addEventListener("dblclick",Ie)}}),sm(()=>{typeof document<"u"&&document.addEventListener("keydown",Ui)});function zl(){if(!i(kt))return;const{scrollHeight:Ie,clientHeight:ge,scrollTop:Re}=i(kt),vt=Ie>ge,Bt=Re+ge>=Ie-5;b(Ke,H(vt&&!Bt))}function Fd(Ie){if(Ie&&(Ie.preventDefault(),Ie.stopPropagation()),!i(kt))return;const{scrollTop:ge,clientHeight:Re,scrollHeight:vt}=i(kt),Bt=Re*.7,Xt=Math.min(ge+Bt,vt-Re);i(kt).scrollTo({top:Xt,behavior:"smooth"})}sm(()=>{zl();const Ie=()=>{zl()},ge=()=>{zl()};return i(kt)&&i(kt).addEventListener("scroll",Ie),typeof window<"u"&&window.addEventListener("resize",ge),setTimeout(zl,500),()=>{i(kt)&&i(kt).removeEventListener("scroll",Ie),typeof window<"u"&&window.removeEventListener("resize",ge)}}),Rg(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",_a),document.removeEventListener("mouseup",dl),document.removeEventListener("keydown",Ui),document.removeEventListener("touchmove",ar),document.removeEventListener("touchend",Jr),document.removeEventListener("touchcancel",Jr)),typeof window<"u"&&window.removeEventListener("resize",it)});function Tl(Ie){try{ie=Date.now();const ge=Uf(Ie);if(b(v,H(ge.id)),b(A,H(ge)),Al(ge),(ge==null?void 0:ge.name)==="text"&&ei(ge),ge.points&&ge.points.length>0){const Re=nt(ge),vt=i(de)||Re;vt&&(b(E,H({...vt})),b(S,H({x:vt.x,y:vt.y})),b(I,!0),b(C,!1))}}catch(ge){console.warn("externalSelectOverlay failed:",ge)}}function xa(Ie){var ge;try{(i(v)===Ie.id||((ge=i(A))==null?void 0:ge.id)===Ie.id)&&(b(v,""),b(C,!1),b(I,!1),b(ne,!1),b(S,null),b(A,null))}catch(Re){console.warn("externalDeselectOverlay failed:",Re)}}function ku(Ie){try{Ua(Ie)}catch(ge){console.warn("externalSyncOverlay failed:",ge)}}function Qu(Ie){try{i(v)===Ie&&(b(v,""),b(C,!1),b(I,!1),b(ne,!1),b(S,null),b(A,null))}catch(ge){console.warn("externalRemoved failed:",ge)}}function ed(Ie={}){Vs("text"),wf({name:"text",visible:i(h),lock:i(d),mode:i(u),styles:{text:{color:"#FFFFFF",backgroundColor:"#A0000020",borderColor:"#1677FF",size:Ie.fontSize??32,weight:Ie.fontWeight??"bold",family:Ie.fontFamily??Te}},extendData:{text:Ie.text??hr,fontSize:Ie.fontSize??32,fontWeight:Ie.fontWeight??"bold",textColor:Ie.textColor??"#FFFFFF",backgroundColor:Ie.backgroundColor??"#A0000020",fontFamily:Ie.fontFamily??Te}})}function td(Ie,ge){n()&&n().overrideOverlay({id:Ie,...ge})}function sp(Ie){n()&&n().removeOverlay({id:Ie})}function Gf(Ie){b(v,H(Ie||""))}function kd(Ie){var Re;if(!n())return;const ge=(Re=n().getOverlays({id:Ie}))==null?void 0:Re[0];ge&&ge.name==="text"&&P_.startEditing(n(),ge)}function Zd(Ie){}var gc=dB(),jf=_s(gc),Nf=y(jf);Nf.__click=[$j];var Jd=y(Nf);a(Jd,()=>ri,()=>"crosshair",()=>"",()=>[],()=>!0);var xl=m(Jd,2);qo(xl,17,()=>br,yi,(Ie,ge)=>{var Re=Dj(),vt=_s(Re),Bt=Mm(()=>()=>i(ge).key==="emoji"?er():Vs(i(ge).icon));a(vt,()=>i(Bt),()=>i(ge).icon,()=>i(ge).key,()=>i(ge).list,()=>!0);var Xt=m(vt,2);Ve(Xt,()=>i(ge).key==="emoji",W=>{l(W)}),Y(Ie,Re)});var Su=m(xl,2),ad=Mm(()=>()=>Vs("ruler"));a(Su,()=>i(ad),()=>"ruler");var Af=m(Su,2);a(Af,()=>Bs,()=>i(f),()=>"mode",()=>Wc,()=>!1,()=>!0);var fu=m(Af,2);a(fu,()=>xr,()=>i(d)?"lock":"unlock",()=>"lock",()=>[],()=>!1,()=>!0);var $u=m(fu,2);a($u,()=>Ai,()=>i(h)?"visible":"invisible",()=>"",()=>[],()=>!1,()=>!0);var yu=m($u,2);l(yu);var Yf=m(yu,2);a(Yf,()=>Ti,()=>"remove"),_(Nf),hp(Nf,Ie=>b(kt,Ie),()=>i(kt));var Ga=m(Nf,2);Ve(Ga,()=>i(Ke),Ie=>{var ge=jj();ge.__click=Fd,ge.__touchstart=[Mj,Fd],ge.__touchend=[Rj],Y(Ie,ge)}),_(jf);var nf=m(jf,2);Ve(nf,()=>i(c),Ie=>{var ge=qj(),Re=_s(ge);qo(Re,17,()=>br,yi,(Bt,Xt)=>{var W=Qs(),Q=_s(W);Ve(Q,()=>i(Xt).key===i(c)&&i(Xt).list.length>0,O=>{var U=zj();const ce=Lt(()=>`left: 60px; top: ${lo(i(c))??""}px;`);qo(U,21,()=>i(Xt).list,yi,(G,ye)=>{var Qe=Oj();Qe.__click=[Bj,c,bo,ye,kn,br];var Ue=y(Qe),dt=Lt(()=>Kn(i(ye).key));nv(Ue,{get name(){return i(dt)},class:"w-4 h-4"});var et=m(Ue,2),B=y(et,!0);we(()=>st(B,Hv[i(ye).text]())),_(et),_(Qe),pd("mouseenter",Qe,ve=>ve.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),pd("mouseleave",Qe,ve=>ve.currentTarget.style.backgroundColor="transparent"),Y(G,Qe)}),_(U),uw(U,G=>Je(G)),we(()=>Dt(U,"style",i(ce))),Y(O,U)}),Y(Bt,W)});var vt=m(Re,2);Ve(vt,()=>i(c)==="mode",Bt=>{var Xt=Hj();const W=Lt(()=>`left: 60px; top: ${lo("mode")??""}px;`);qo(Xt,21,()=>Wc,yi,(Q,O)=>{var U=Wj();U.__click=[Vj,bo,O];var ce=y(U),G=Lt(()=>Kn(i(O).key));nv(ce,{get name(){return i(G)},class:"w-4 h-4"});var ye=m(ce,2),Qe=y(ye,!0);we(()=>st(Qe,Hv[i(O).text]())),_(ye),_(U),pd("mouseenter",U,Ue=>Ue.currentTarget.style.backgroundColor="var(--menu-hover-bg)"),pd("mouseleave",U,Ue=>Ue.currentTarget.style.backgroundColor="transparent"),Y(Q,U)}),_(Xt),uw(Xt,Q=>Je(Q)),we(()=>Dt(Xt,"style",i(W))),Y(Bt,Xt)}),Y(Ie,ge)});var Sd=m(nf,2);Ve(Sd,()=>i(I)&&i(E),Ie=>{var ge=cB();ge.__click=[Uj];var Re=y(ge);Ve(Re,()=>{var Ue;return((Ue=i(A))==null?void 0:Ue.name)!=="emoji"},Ue=>{var dt=Xj(),et=_s(dt);et.__mousedown=vi,et.__touchstart=[Sj,vi];var B=y(et),ve=y(B),Fe=y(ve);Oi(2),_(ve),Oi(4),_(B),_(et);var ot=m(et,2);Ve(ot,()=>{var tt;return((tt=i(A))==null?void 0:tt.name)==="text"},tt=>{var St=Yj(),Be=_s(St);Be.__change=ai;var je=y(Be);je.value=(je.__value="8")==null?"":"8";var Mt=m(je);Mt.value=(Mt.__value="10")==null?"":"10";var Ze=m(Mt);Ze.value=(Ze.__value="11")==null?"":"11";var rs=m(Ze);rs.value=(rs.__value="12")==null?"":"12";var yn=m(rs);yn.value=(yn.__value="14")==null?"":"14";var Qn=m(yn);Qn.value=(Qn.__value="16")==null?"":"16";var wn=m(Qn);wn.value=(wn.__value="18")==null?"":"18";var xo=m(wn);xo.value=(xo.__value="20")==null?"":"20";var hi=m(xo);hi.value=(hi.__value="22")==null?"":"22";var Ln=m(hi);Ln.value=(Ln.__value="24")==null?"":"24";var pl=m(Ln);pl.value=(pl.__value="32")==null?"":"32";var vn=m(pl);vn.value=(vn.__value="40")==null?"":"40";var mo=m(vn);mo.value=(mo.__value="52")==null?"":"52",_(Be);var Gi=m(Be,2);Gi.__click=[kj,Me,ai];var La=m(Gi,2),lc=y(La),wl=y(lc);const mf=Lt(()=>`background-color: ${i(Me).textColor??""}; color: ${Rt(i(Me).textColor)??""};`);wl.__click=[Ij,le,pe,Me,re,De,te];var mp=y(wl);nv(mp,{name:"text",size:12}),_(wl);var _c=m(wl,2);const Ea=Lt(()=>`background-color: ${i(Me).backgroundColor??""}; color: ${Rt(i(Me).backgroundColor)??""};`);_c.__click=[Pj,le,pe,Me,re,Oe,te];var Tf=y(_c);nv(Tf,{name:"rect",size:12}),_(_c),_(lc);var Sr=m(lc,2);Sr.__change=ai,qo(Sr,21,()=>Ht,yi,(Oa,lr)=>{var mr=Gj(),Cr={},hl=y(mr,!0);_(mr),we(()=>{Cr!==(Cr=i(lr).value)&&(mr.value=(mr.__value=i(lr).value)==null?"":i(lr).value),st(hl,i(lr).label)}),Y(Oa,mr)}),_(Sr),_(La),we(()=>{$i(Be,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-hffas6`),$i(Gi,`w-8 h-8 rounded flex items-center justify-center ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors svelte-hffas6`),Dt(wl,"style",i(mf)),Dt(_c,"style",i(Ea)),$i(Sr,`px-1 py-1 text-xs border rounded cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n max-w-[120px] svelte-hffas6`)}),co(Be,()=>i(Me).fontSize,Oa=>i(Me).fontSize=Oa),co(Sr,()=>i(Me).fontFamily,Oa=>i(Me).fontFamily=Oa),Y(tt,St)},tt=>{var St=Kj(),Be=_s(St);Be.__click=[Cj,le,pe,P,re,Ne,te];var je=m(Be,2);je.__change=Eo;var Mt=y(je);Mt.value=(Mt.__value="1")==null?"":"1";var Ze=m(Mt);Ze.value=(Ze.__value="2")==null?"":"2";var rs=m(Ze);rs.value=(rs.__value="3")==null?"":"3";var yn=m(rs);yn.value=(yn.__value="4")==null?"":"4";var Qn=m(yn);Qn.value=(Qn.__value="5")==null?"":"5";var wn=m(Qn);wn.value=(wn.__value="6")==null?"":"6";var xo=m(wn);xo.value=(xo.__value="7")==null?"":"7";var hi=m(xo);hi.value=(hi.__value="8")==null?"":"8",_(je);var Ln=m(je,2);Ln.__change=Eo;var pl=y(Ln);pl.value=(pl.__value="solid")==null?"":"solid";var vn=m(pl);vn.value=(vn.__value="dashed")==null?"":"dashed";var mo=m(vn);mo.value=(mo.__value="dotted")==null?"":"dotted",_(Ln),we(()=>{Dt(Be,"style",`background-color: ${P.color??""};`),$i(je,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[64px] h-[28px] svelte-hffas6`),$i(Ln,`px-1 py-1 text-xs border rounded-md cursor-pointer\\n ${(o().theme==="dark"?"bg-[#2C2C2C] border-[#3A3A3A] text-white":"bg-white border-gray-300 text-gray-900")??""} touch-manipulation\\n w-[72px] h-[28px] svelte-hffas6`)}),co(je,()=>P.thickness,Gi=>P.thickness=Gi),co(Ln,()=>P.style,Gi=>P.style=Gi),Y(tt,St)}),we(()=>{$i(et,`drag-handle cursor-grab hover:cursor-grabbing flex items-center justify-center
                 w-6 h-6 rounded ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors
                 touch-manipulation svelte-hffas6`),$i(Fe,`w-0.5 h-0.5 ${(o().theme==="dark"?"bg-gray-500":"bg-gray-400")??""} rounded-full`)}),Y(Ue,dt)},Ue=>{var dt=Jj(),et=y(dt),B=y(et,!0);_(et);var ve=m(et,2),Fe=m(y(ve),2);Ts(Fe),Fe.__input=[Zj,ol];var ot=m(Fe,2),tt=y(ot,!0);_(ot),_(ve),_(dt),we(()=>{var St,Be,je,Mt,Ze,rs,yn,Qn;st(B,((Be=(St=i(A))==null?void 0:St.extendData)==null?void 0:Be.emoji)||"😀"),qf(Fe,((Mt=(je=i(A))==null?void 0:je.extendData)==null?void 0:Mt.size)||24),Dt(Fe,"title",`Emoji size: ${(((rs=(Ze=i(A))==null?void 0:Ze.extendData)==null?void 0:rs.size)||24)??""}px`),st(tt,((Qn=(yn=i(A))==null?void 0:yn.extendData)==null?void 0:Qn.size)||24)}),Y(Ue,dt)});var vt=m(Re,2);Ve(vt,()=>{var Ue;return((Ue=i(A))==null?void 0:Ue.name)==="fibonacciSegment"},Ue=>{var dt=eB();dt.__click=[Qj,xd];var et=y(dt);_(dt),we(()=>{$i(dt,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-blue-900":"hover:bg-blue-100")??""} transition-colors duration-200
                 flex items-center justify-center svelte-hffas6`),b1(et,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-blue-500`)}),Y(Ue,dt)});var Bt=m(vt,2);Bt.__click=[wj,A,n,ke,d,Ua];var Xt=y(Bt),W=Lt(()=>{var Ue,dt;return(dt=(Ue=i(A))==null?void 0:Ue.extendData)!=null&&dt.manualLock?"lock":"unlock"}),Q=Lt(()=>`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""}`);nv(Xt,{get name(){return i(W)},get class(){return i(Q)}}),_(Bt);var O=m(Bt,2),U=y(O);U.__click=[tB,ne];var ce=y(U);_(U);var G=m(U,2);Ve(G,()=>i(ne),Ue=>{var dt=aB();dt.__click=[sB];var et=y(dt);et.__click=[nB,Ol,ne];var B=m(et,2);B.__click=[oB,fl,ne];var ve=m(B,2);Ve(ve,()=>i(D),Fe=>{var ot=rB();ot.__click=[iB,bl,ne],we(()=>$i(ot,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-hffas6`)),Y(Fe,ot)}),_(dt),we(()=>{$i(dt,`absolute right-0 top-full mt-1 min-w-[140px] rounded-md shadow-lg border ${(o().theme==="dark"?"bg-[#2B2B2B] border-[#3F3F3F]":"bg-white border-gray-200")??""} z-[200002]`),$i(et,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-hffas6`),$i(B,`w-full text-left px-3 py-2 text-sm ${(o().theme==="dark"?"hover:bg-gray-700 text-white":"hover:bg-gray-100 text-gray-800")??""} svelte-hffas6`)}),Y(Ue,dt)}),_(O);var ye=m(O,2);ye.__click=[lB,Ti,I,S];var Qe=y(ye);_(ye),_(ge),we(()=>{var Ue,dt,et,B;$i(ge,`context-menu-container fixed z-[200001] rounded-md shadow-lg flex items-center gap-1 space-x-1\\n ${(o().theme==="dark"?"bg-[#2B2B2B] border border-[#3F3F3F]":"bg-white border border-gray-200")??""} ${(i(T)?"cursor-grabbing":"")??""}\\n px-2 py-1 sm:px-3 sm:py-1\\n max-w-[85vw] sm:max-w-none svelte-hffas6`),Dt(ge,"data-theme",o().theme),Dt(ge,"style",`left: ${i(E).x??""}px; 
           top: ${i(E).y??""}px;`),$i(Bt,`w-8 h-8 rounded transition-colors duration-200 flex items-center justify-center
        ${((dt=(Ue=i(A))==null?void 0:Ue.extendData)!=null&&dt.manualLock?o().theme==="dark"?"bg-blue-900":"bg-blue-100":o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} svelte-hffas6`),Dt(Bt,"title",(B=(et=i(A))==null?void 0:et.extendData)!=null&&B.manualLock?"Unlock selected drawing":"Lock selected drawing"),$i(U,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-gray-700":"hover:bg-gray-100")??""} transition-colors duration-200 flex items-center justify-center svelte-hffas6`),Dt(U,"aria-expanded",i(ne)),b1(ce,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""}`),$i(ye,`w-8 h-8 rounded ${(o().theme==="dark"?"hover:bg-red-900":"hover:bg-red-100")??""} transition-colors duration-200
               flex items-center justify-center svelte-hffas6`),b1(Qe,`w-4 h-4 ${(o().theme==="dark"?"text-gray-300":"text-gray-600")??""} hover:text-red-500`)}),Y(Ie,ge)});var wp=m(Sd,2);Ve(wp,()=>i(C)&&i(S),Ie=>{var ge=uB();ge.__click=Ti,we(()=>Dt(ge,"style",`left: ${i(S).x??""}px; top: ${i(S).y??""}px;`)),Y(Ie,ge)});var ac=m(wp,2);sv(ac,{get selectedColor(){return i(pe)},set selectedColor(Ie){b(pe,H(Ie))},get opacity(){return i(re)},set opacity(Ie){b(re,H(Ie))},get show(){return i(te)},set show(Ie){b(te,H(Ie))},$$events:{colorChange:nl,opacityChange:tc,close:mc}});var Ld=m(ac,2);fj(Ld,{get show(){return i(xe)},set show(Ie){b(xe,H(Ie))},get position(){return i(se)},set position(Ie){b(se,H(Ie))},$$events:{select:ba}});var Cu=m(Ld,2);return xj(Cu,{get visible(){return i(vu)},set visible(Ie){b(vu,H(Ie))},get levels(){return i(Qc)},set levels(Ie){b(Qc,H(Ie))},get theme(){return o().theme},$$events:{levelChange:Ie=>rc(Ie.detail.index,Ie.detail.field,Ie.detail.value),reset:_u,confirm:eu,cancel:ca}}),Y(s,gc),Kd({addOverlay:wf,clickRemove:Ti,externalSelectOverlay:Tl,externalDeselectOverlay:xa,externalSyncOverlay:ku,externalRemoved:Qu,createTextDrawing:ed,updateTextDrawing:td,deleteTextDrawing:sp,setSelectedDrawing:Gf,enterEditMode:kd,exitEditMode:Zd})}$p(["click","touchstart","touchend","mousedown","change","input"]);const RS={mode:"none",playing:!1,speed:1,depositAmount:1e5,leverage:null,currency:"USD",balance:1e5,positions:[],history:[],sidebarOpen:!1,pendingOrders:[],onboardingDone:!1},pm=Th(RS);function jS(){pm.set(RS)}function BS(s){var t;const e=s.priceCurrency||((t=s.exchange)!=null&&t.toUpperCase().includes("DSE")?"BDT":"USD");pm.update(n=>({...n,currency:e}))}function OS(s){pm.update(e=>({...e,currency:s}))}function zS(s){pm.update(e=>({...e,depositAmount:s,balance:s}))}function VS(s){pm.update(e=>({...e,leverage:s}))}function WS(s){pm.update(e=>({...e,onboardingDone:s}))}function HS(s){pm.update(e=>({...e,mode:s}))}function B1(s){pm.update(e=>({...e,playing:s}))}function Kx(s){if(pm.update(e=>({...e,speed:s})),typeof window<"u"&&window.setPlaybackSpeed)try{window.setPlaybackSpeed(s)}catch{}}function qS(s){pm.update(e=>({...e,positions:[...e.positions,s],balance:e.balance-s.avgCost*s.quantity}))}function pB(s,e,t){pm.update(n=>{const o=n.positions.findIndex(d=>d.id===s);if(o===-1)return n;const r=n.positions[o],a=Math.min(e,r.quantity),l=(t-r.avgCost)*a*(r.leverage||1),c=r.quantity-a,f=[...n.positions];c>0?f[o]={...r,quantity:c}:f.splice(o,1);const u={id:s,symbol:r.symbol,quantity:a,avgCost:r.avgCost,closedAvg:t,pnl:l,closedAt:Date.now()};return{...n,positions:f,history:[u,...n.history],balance:n.balance+t*a+l}})}function hB(s){pm.update(e=>({...e,pendingOrders:[...e.pendingOrders||[],s]}))}function a2(s){pm.update(e=>({...e,pendingOrders:(e.pendingOrders||[]).filter(t=>t.id!==s)}))}function jk(s,e,t){e(!1),s.stopPropagation(),t.click&&t.click("close")}var mB=s=>s.stopPropagation(),vB=(s,e,t)=>e(i(t)),gB=be("<button> </button>"),_B=be('<div class="modal-action px-4 sm:px-6 py-4 sm:py-5 border-t modal-footer svelte-1a6y34w"><div class="flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end w-full"></div></div>'),yB=be('<div class="fixed inset-0 z-[350000] flex items-center justify-center px-3 sm:px-4 md:px-6 animate-in fade-in duration-200 modal-overlay svelte-1a6y34w"><div><div class="relative px-4 sm:px-6 py-4 sm:py-5 border-b modal-header svelte-1a6y34w"><div class="flex justify-between items-center gap-4"><div class="flex items-center gap-3 min-w-0 flex-1"><div class="icon-badge svelte-1a6y34w"><svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div> <h3 class="font-bold text-lg sm:text-xl md:text-2xl tracking-tight text-base-content truncate"> </h3></div> <button class="close-btn flex-shrink-0 svelte-1a6y34w" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div><!></div> <!></div></div>');function uv(s,e){Yd(e,!0);let t=bi(e,"width",3,600),n=bi(e,"maxWidth",3,"min(600px, 95vw)"),o=bi(e,"maxHeight",3,"90vh"),r=bi(e,"title",3,""),a=bi(e,"buttons",19,()=>["confirm"]),l=bi(e,"show",15,!1),c=bi(e,"center",3,!1),f=bi(e,"class",3,""),u=bi(e,"theme",3,"dark");function d(x){x==="close"&&l(!1),e.click&&e.click(x)}function h(x){switch(x){case"confirm":return"btn-primary";case"cancel":return"btn-ghost";default:return"btn-secondary"}}var p=Qs(),v=_s(p);Ve(v,l,x=>{var S=yB();S.__click=[jk,l,e];var C=y(S);C.__click=[mB];var I=y(C),A=y(I),P=y(A),T=m(y(P),2),j=y(T,!0);_(T),_(P);var E=m(P,2);E.__click=[jk,l,e],_(A),_(I);var L=m(I,2),D=y(L);Ve(D,()=>e.children,ne=>{var de=Qs(),ie=_s(de);o8(ie,()=>e.children),Y(ne,de)}),_(L);var X=m(L,2);Ve(X,()=>a().length>0,ne=>{var de=_B(),ie=y(de);qo(ie,21,a,yi,(te,le)=>{var pe=gB();const re=Lt(()=>`btn-premium ${h(i(le))??""} w-full sm:w-auto sm:min-w-[120px] svelte-1a6y34w`);pe.__click=[vB,d,le];var xe=y(pe,!0);we(()=>st(xe,Hv[i(le)]())),_(pe),we(()=>$i(pe,i(re))),Y(te,pe)}),_(ie),_(de),Y(ne,de)}),_(C),_(S),we(()=>{$i(C,`relative rounded-3xl shadow-luxury animate-in zoom-in-95 duration-300 overflow-hidden flex flex-col modal-container ${f()??""} svelte-1a6y34w`),Dt(C,"data-theme",u()),Dt(C,"style",`width: ${(typeof t()=="string"?t():t()+"px")??""}; max-width: ${n()??""}; max-height: ${o()??""};`),st(j,r()),$i(L,`flex-1 overflow-y-auto premium-scrollbar ${(c()?"flex justify-center items-center":"")??""} px-4 sm:px-6 py-4 sm:py-5 svelte-1a6y34w`)}),Y(x,S)}),Y(s,p),Kd()}$p(["click"]);const bB="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let US=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=bB[t[s]&63];return e};/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const xB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var wB=ga("<svg><!><!></svg>");function zh(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]),n=yh(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Yd(e,!1);let o=bi(e,"name",8,void 0),r=bi(e,"color",8,"currentColor"),a=bi(e,"size",8,24),l=bi(e,"strokeWidth",8,2),c=bi(e,"absoluteStrokeWidth",8,!1),f=bi(e,"iconNode",24,()=>[]);const u=(...I)=>I.filter((A,P,T)=>!!A&&T.indexOf(A)===P).join(" "),d=O0(),[h,p]=d;$m();var v=wB();let x;var S=y(v);qo(S,1,f,yi,(I,A)=>{let P=()=>i(A)[0],T=()=>i(A)[1];var j=Qs(),E=_s(j);const L=Mm(()=>`${P()}`=="button"?p({...T()},[{attribute_name:"formaction"}]):`${P()}`=="form"?p({...T()},[{attribute_name:"action"}]):`${P()}`=="a"?p({...T()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...T()});d8(E,P,!0,(D,X)=>{let ne;we(()=>ne=cw(D,ne,{...i(L)},void 0,D.namespaceURI===W6,D.nodeName.includes("-")))}),Y(I,j)});var C=m(S);Fh(C,e,"default",{}),_(v),we(()=>x=cw(v,x,{...xB,...n,width:a(),height:a(),stroke:r(),"stroke-width":c()?Number(l())*24/Number(a()):l(),class:u("lucide-icon","lucide",o()?`lucide-${o()}`:"",t.class)},void 0,!0)),Y(s,v),Kd()}function kB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"activity"},()=>t,{iconNode:[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function SB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"banknote"},()=>t,{iconNode:[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2"}],["circle",{cx:"12",cy:"12",r:"2"}],["path",{d:"M6 12h.01M18 12h.01"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function CB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"camera"},()=>t,{iconNode:[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function IB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"clock"},()=>t,{iconNode:[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function PB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"code-xml"},()=>t,{iconNode:[["path",{d:"m18 16 4-4-4-4"}],["path",{d:"m6 8-4 4 4 4"}],["path",{d:"m14.5 4-5 16"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function MB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"download"},()=>t,{iconNode:[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function NB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"flask-conical"},()=>t,{iconNode:[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2"}],["path",{d:"M6.453 15h11.094"}],["path",{d:"M8.5 2h7"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function AB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"gauge"},()=>t,{iconNode:[["path",{d:"m12 14 4-4"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function TB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"log-out"},()=>t,{iconNode:[["path",{d:"m16 17 5-5-5-5"}],["path",{d:"M21 12H9"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function FB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"maximize"},()=>t,{iconNode:[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function LB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"minimize"},()=>t,{iconNode:[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function EB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"moon"},()=>t,{iconNode:[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function $B(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"pause"},()=>t,{iconNode:[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function DB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"play"},()=>t,{iconNode:[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function RB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"save"},()=>t,{iconNode:[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function jB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"search"},()=>t,{iconNode:[["path",{d:"m21 21-4.34-4.34"}],["circle",{cx:"11",cy:"11",r:"8"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function BB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"settings"},()=>t,{iconNode:[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function OB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"sun"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function zB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"trending-up"},()=>t,{iconNode:[["path",{d:"M16 7h6v6"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}function VB(s,e){const t=yh(e,["children","$$slots","$$events","$$legacy"]);zh(s,Oh({name:"wallet"},()=>t,{iconNode:[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"}]],children:(o,r)=>{var a=Qs(),l=_s(a);Fh(l,e,"default",{}),Y(o,a)},$$slots:{default:!0}}))}const GS=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VES","VND","VUV","WST","XAF","XCD","XOF","XPF","YER","ZAR","ZMW","ZWL"],YS="smartchart.alerts.v1",x_={rules:{},logs:[],delivery:{},options:{backfill:!1,maxLogs:500},lastFired:{},firedOnce:{}},WB=()=>{if(typeof window>"u"||!window.localStorage)return{...x_};try{const s=localStorage.getItem(YS);if(!s)return{...x_};const e=JSON.parse(s);return{...x_,...e,options:{...x_.options,...e.options||{}},delivery:{...x_.delivery,...e.delivery||{}},rules:e.rules||{},logs:Array.isArray(e.logs)?e.logs:[],lastFired:e.lastFired||{},firedOnce:e.firedOnce||{}}}catch(s){return console.warn("Failed to load alerts state:",s),{...x_}}},HB=s=>{if(!(typeof window>"u"||!window.localStorage))try{localStorage.setItem(YS,JSON.stringify(s))}catch(e){console.warn("Failed to persist alerts state:",e)}},lv=Th(WB());lv.subscribe(s=>HB(s));const L1=Th(!1),ub=s=>({id:s,enabled:!0,frequency:"once_per_bar",channels:{app:!0,webhook:!1,email:!1,push:!1}}),qB=s=>{lv.update(e=>{const t={...e.rules};for(const n of s){const o=t[n.id];t[n.id]={...o||ub(n.id),...n,channels:{...(o==null?void 0:o.channels)||ub(n.id).channels,...n.channels||{}},enabled:n.enabled??(o==null?void 0:o.enabled)??!0,frequency:n.frequency||(o==null?void 0:o.frequency)||"once_per_bar"}}return e.rules=t,e})},kb=(s,e)=>{lv.update(t=>{const n=t.rules[s]||ub(s);return t.rules={...t.rules,[s]:{...n,...e,channels:{...n.channels,...e.channels||{}}}},t})},O1=s=>{lv.update(e=>(e.delivery={...e.delivery,...s},e))},KS=s=>{lv.update(e=>(e.options={...e.options,...s},e))},l2=()=>{lv.update(s=>(s.logs=[],s.lastFired={},s.firedOnce={},s))},UB=()=>{lv.update(s=>(s.lastFired={},s.firedOnce={},s))},GB=(s,e,t,n)=>{if(!e.enabled||!s.options.backfill&&t<n)return!1;if(e.frequency==="once")return!s.firedOnce[e.id];const o=s.lastFired[e.id];return!(o&&o.index===t)},YB=(s,e,t,n)=>{s.lastFired[e.id]={index:t,timestamp:n},e.frequency==="once"&&(s.firedOnce[e.id]=!0)},KB=(s,e,t)=>`${s}_${t}_${e}_${Math.random().toString(36).slice(2,8)}`,XS=s=>{lv.update(e=>{const t=[...s,...e.logs],n=e.options.maxLogs;return e.logs=n>0?t.slice(0,n):t,e})},XB=async s=>{const e=vh(lv),{events:t,context:n}=s;if(!t.length)return[];const o=[];for(const r of t){const a=String(r.signalId||r.title||r.message||"alert"),l=e.rules[a]||ub(a),c={...l,id:a,title:l.title??r.title,message:l.message??r.message,frequency:r.frequency||l.frequency};if(!GB(e,c,r.index,n.latestIndex))continue;YB(e,c,r.index,r.timestamp);const f=[];Object.keys(c.channels).forEach(u=>{const d=c.channels[u];f.push({channel:u,status:d?"pending":"skipped"})}),o.push({id:KB(a,r.timestamp,r.index),ruleId:a,timestamp:r.timestamp,barIndex:r.index,symbol:n.symbol,timeframe:n.timeframe,title:c.title,message:c.message,price:n.price,deliveries:f})}return o.length?(lv.set(e),XS(o),o):(lv.set(e),[])},ZS=async s=>{var n;const e=vh(lv),t=Object.keys(((n=e.rules[s.ruleId])==null?void 0:n.channels)||{}).filter(o=>{var r,a;return(a=(r=e.rules[s.ruleId])==null?void 0:r.channels)==null?void 0:a[o]});if(!t.length)return[];try{const o=await fetch("/api/alerts/deliver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:s,delivery:e.delivery,channels:t})});if(!o.ok)return t.map(a=>({channel:a,status:"failed",detail:`HTTP ${o.status}`}));const r=await o.json();return Array.isArray(r==null?void 0:r.deliveries)?r.deliveries:[]}catch(o){return t.map(r=>({channel:r,status:"failed",detail:(o==null?void 0:o.message)||"Delivery failed"}))}},JS=(s,e)=>{lv.update(t=>(t.logs=t.logs.map(n=>n.id!==s?n:{...n,deliveries:e.length?e:n.deliveries}),t))};function ZB(){L1.set(!0)}function JB(s,e,t,n){OS(i(e)),zS(Math.max(0,Number(i(t))||0)),b(n,2)}function QB(){var s;try{(s=window.predictNextCandle)==null||s.call(window)}catch{}B1(!0)}function eO(s){Kx(parseFloat(s.target.value))}function tO(s,e,t,n,o){var c,f;if(!(typeof window<"u"?window.confirm("Exit simulator?"):!0))return;e();const a=t().positions;for(const u of a){try{u.lineOverlayId&&((c=n())==null||c.removeOverlay({id:u.lineOverlayId}))}catch{}try{u.noteOverlayId&&((f=n())==null||f.removeOverlay({id:u.noteOverlayId}))}catch{}}jS();const l=window.sidebarHostRef;l&&l.closeSidebar&&l.closeSidebar()}function sO(s,e,t,n,o,r,a,l){b(e,!0),b(t,"instant"),b(n,1),b(o,null),b(r,1),b(a,null),b(l,null)}function nO(s,e,t,n,o,r,a,l,c,f,u,d,h){var T,j;b(e,null);const p=i(t),v=Math.max(0,Number(i(n))||0);if(v<=0||p<=0){b(e,"Invalid quantity");return}if(!o(v,p)){b(e,"Quantity exceeds balance");return}r();const x=US(),S=a(),C=(T=l())==null?void 0:T.createOverlay({name:"horizontalStraightLine",points:[{value:p}],styles:{line:{style:mt.Dashed,size:1}}}),I=(j=l())==null?void 0:j.createOverlay({name:"note",points:[{timestamp:S,value:p}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),A=Array.isArray(C)?C[0]??void 0:C??void 0,P=Array.isArray(I)?I[0]??void 0:I??void 0;qS({id:x,symbol:f().symbol,quantity:v,avgCost:p,leverage:d().leverage,openedAt:Date.now(),lineOverlayId:A,noteOverlayId:P}),b(h,!1)}function oO(s,e,t,n,o,r,a,l,c,f,u,d,h){var T,j;b(e,null);const p=Math.max(0,Number(i(t))||0),v=Math.max(0,Number(i(n))||0);if(v<=0||p<=0){b(e,"Quantity exceeds balance or invalid price");return}if(!o(v,p)){b(e,"Quantity exceeds balance or invalid price");return}const x=US(),S=p>=i(r),C=(T=a())==null?void 0:T.createOverlay({name:"horizontalStraightLine",points:[{value:p}],styles:{line:{style:mt.Dashed,size:1}}}),I=(j=a())==null?void 0:j.createOverlay({name:"note",points:[{timestamp:c(),value:p}],extendData:{in_text:"PENDING",in_color:"#f59e0b",line_color:"#f59e0b"}}),A=Array.isArray(C)?C[0]??void 0:C??void 0,P=Array.isArray(I)?I[0]??void 0:I??void 0;hB({id:x,symbol:f().symbol,quantity:v,price:p,leverage:d().leverage,createdAt:Date.now(),triggerUp:S,lineOverlayId:A,noteOverlayId:P}),b(h,!1)}var iO=be("<option> </option>"),rO=be('<div class="grid grid-cols-1 sm:grid-cols-3 gap-2 items-end w-full"><div class="flex flex-col gap-1"><div class="text-xs opacity-80">Currency</div> <select class="select select-bordered select-sm"></select></div> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm Deposit</button></div>'),aO=(s,e)=>b(e,!0),lO=(s,e)=>b(e,!1),cO=be('<div class="flex items-center gap-2 w-full"><select class="select select-bordered select-sm"><option>1:50</option><option>1:100</option><option>1:200</option><option>1:400</option><option>1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Confirm</button></div>'),uO=(s,e,t)=>{b(e,null),t()},dO=be('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm</button>'),fO=be('<div class="space-y-2 w-full"><div class="text-sm">Take leverage?</div> <div class="flex items-center gap-2 w-full"><label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">Yes</span></label> <label class="label cursor-pointer"><input type="radio" name="lev" class="radio radio-sm"> <span class="label-text ml-2">No</span></label></div> <!></div>'),pO=be('<span class="text-success"> </span>'),hO=be('<span class="text-error"> </span>'),mO=be("<span>No trades</span>"),vO=be('<button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button"><!></button>'),gO=be('<button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button"><!></button>'),_O=(s,e)=>Kx(e),yO=be('<button type="button"> </button>'),bO=(s,e)=>b(e,"portfolio"),xO=(s,e)=>b(e,"history"),wO=(s,e,t)=>e(i(t)),kO=be('<div class="flex items-center justify-between text-sm mt-2 gap-2"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><button class="btn btn-sm btn-premium-ghost svelte-112gz12" type="button">Cancel</button></div></div>'),SO=be('<div class="card lux-card shadow w-full mb-3 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="text-sm font-semibold">Pending Orders</div> <!></div></div>'),CO=(s,e,t)=>{b(e,""),b(t,0)},IO=be('<button class="btn btn-xs btn-premium-ghost svelte-112gz12" type="button">Cancel</button>'),PO=(s,e,t)=>e(i(t).id),MO=be('<button class="btn btn-xs btn-premium-outline svelte-112gz12" type="button">Sell</button>'),NO=(s,e)=>e(!0),AO=(s,e)=>e(!1),TO=be('<div class="sell-panel w-full mt-2 space-y-3 svelte-112gz12"><div class="sell-section svelte-112gz12"><div class="flex items-center justify-between"><div class="text-xs opacity-70"> </div> <button class="btn btn-sm btn-premium-primary svelte-112gz12" type="button">Close All</button></div></div> <div class="sell-section svelte-112gz12"><div class="text-xs opacity-70 mb-2">Close partial position</div> <div class="flex items-center gap-2"><input class="input input-bordered input-sm flex-1" type="number" min="0" placeholder="Partial qty"> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Confirm Partial</button></div> <div class="mt-2 text-xs opacity-70 flex items-center justify-between"><span> </span> <span> </span></div></div></div>'),FO=be('<div class="card lux-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div> <div class="truncate"> </div></div> <div class="flex items-center gap-2"><div> </div> <!></div></div> <!></div></div>'),LO=be("<!> <!>",1),EO=be('<div class="card trade-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 text-sm min-w-0"><div class="flex items-center justify-between"><div class="flex items-center gap-2 min-w-0"><div class="badge badge-outline truncate"> </div> <div class="truncate"> </div></div> <div> </div></div> <div class="mt-1 truncate"> </div></div></div>'),$O=be('<div class="card history-summary-card shadow w-full mb-2 svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="grid grid-cols-3 gap-2 items-stretch"><div class="summary-tile win svelte-112gz12"><div class="summary-title svelte-112gz12">Winning</div> <div class="summary-values svelte-112gz12"><div class="badge badge-success text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div class="summary-tile loss svelte-112gz12"><div class="summary-title svelte-112gz12">Losing</div> <div class="summary-values svelte-112gz12"><div class="badge badge-error text-[10px]"> </div> <div class="summary-amount svelte-112gz12"> </div></div></div> <div><div class="summary-title svelte-112gz12">Net</div> <div class="summary-values svelte-112gz12"><div class="summary-amount svelte-112gz12"> </div></div></div></div></div></div> <!>',1),DO=be('<div class="exit-bar svelte-112gz12"><div class="exit-copy svelte-112gz12">Practice live trading. Check your predictions and improve.</div> <button class="btn btn-sm btn-premium-danger exit-cta svelte-112gz12" type="button"><!> Exit</button></div> <div class="mini-stack grid grid-cols-1 gap-2 w-full svelte-112gz12"><div class="card glass lux-card shadow overflow-hidden mini-tile deposit-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Deposit</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile investment-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Investment <span class="badge badge-outline text-[9px] ml-1"> </span></div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"><!></div></div></div></div></div> <div class="card glass lux-card shadow overflow-hidden mini-tile available-tile svelte-112gz12"><div class="card-body p-3 min-w-0 svelte-112gz12"><div class="flex items-center gap-3 w-full"><div class="tile-icon svelte-112gz12"><div class="icon-wrap svelte-112gz12"><!></div></div> <div class="flex-1 min-w-0 tile-content svelte-112gz12"><div class="tile-title svelte-112gz12">Available</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div> <div class="tile-sub truncate svelte-112gz12"> </div></div></div></div></div></div> <div class="card speed-card w-full svelte-112gz12"><div class="card-body p-4"><div class="speed-header flex items-center justify-between svelte-112gz12"><div class="flex items-center gap-2"><div class="speed-icon svelte-112gz12"><!></div> <div class="speed-title svelte-112gz12">Playback Speed</div></div> <div class="speed-badge svelte-112gz12"> </div></div> <div class="mt-3 flex items-center gap-3"><input type="range" min="0.5" max="10" step="0.5" class="speed-range flex-1 svelte-112gz12"> <!></div> <div class="mt-2 speed-chips svelte-112gz12"></div></div></div> <div class="card trade-action-card w-full overflow-hidden svelte-112gz12"><div class="card-body p-4 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-extrabold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="badge badge-success badge-outline">LIVE</div></div> <div class="mt-3"><button class="btn btn-premium-primary w-full svelte-112gz12" type="button">Buy Stock</button></div></div></div> <div class="card lux-card shadow w-full svelte-112gz12"><div class="card-body p-3 min-w-0"><div class="flex items-center justify-between"><div><div class="text-xs opacity-70">Alerts</div> <div class="text-sm font-semibold">Script Alerts Center</div></div> <button class="btn btn-sm btn-premium-outline svelte-112gz12" type="button">Open</button></div></div></div> <div class="tabs tabs-boxed w-full mt-3 gap-3 svelte-112gz12"><button type="button">Portfolio</button> <button type="button">History</button></div> <!>',1),RO=(s,e)=>b(e,"instant"),jO=(s,e)=>b(e,"pending"),BO=be('<div class="text-error text-xs mt-1"> </div>'),OO=be('<div class="space-y-2"><div class="card buy-card svelte-112gz12"><div class="card-body p-3"><div class="flex items-center justify-between"><div class="text-xs opacity-70">Current Price</div> <div class="metric-value font-bold truncate whitespace-nowrap svelte-112gz12"> </div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 items-end mt-2"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Confirm Buy</button></div> <!></div></div></div>'),zO=be('<div class="text-error text-xs"> </div>'),VO=be('<div class="space-y-2"><div class="grid grid-cols-2 gap-2 items-end"><input class="input input-bordered input-sm" type="number" min="0" placeholder="Custom Price"> <input class="input input-bordered input-sm" type="number" min="0" placeholder="Quantity"></div> <button class="btn btn-sm btn-premium-primary w-full svelte-112gz12" type="button">Place Pending Buy</button> <!></div>'),WO=be('<div class="space-y-3"><div class="flex items-center gap-2"><div class="badge badge-outline">Mode</div> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Instant</span></label> <label class="label cursor-pointer"><input type="radio" name="buyMode" class="radio radio-sm"> <span class="label-text ml-2">Pending</span></label></div> <!></div>'),HO=be('<div class="p-4 space-y-4 w-full box-border"><!></div> <!>',1);function qO(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(pm,"$simulator",t),o=()=>Ml(l,"$save",t),r=()=>Ml(a,"$chart",t),a=hd("chart"),l=hd("save");let c=_e(H(n().depositAmount)),f=_e(H(n().currency||o().symbol.priceCurrency||"USD")),u=_e(!1),d=_e(null),h=_e(H(n().onboardingDone?3:1)),p=_e(0),v=null,x=_e(0),S=_e(""),C=_e("portfolio"),I=_e(!1),A=_e("instant"),P=_e(null),T=_e(1),j=_e(1),E=_e(null),L=_e(null);const D=Lt(()=>(n().positions||[]).length>0),X=Lt(()=>(n().positions||[]).reduce((nt,Je)=>nt+(i(p)-Je.avgCost)*Je.quantity*(Je.leverage||1),0)),ne=Lt(()=>n().history||[]),de=Lt(()=>i(ne).filter(nt=>(nt.pnl??0)>0).length),ie=Lt(()=>i(ne).filter(nt=>(nt.pnl??0)<0).length),te=Lt(()=>i(ne).reduce((nt,Je)=>nt+((Je.pnl??0)>0?Je.pnl??0:0),0)),le=Lt(()=>i(ne).reduce((nt,Je)=>nt+((Je.pnl??0)<0?Math.abs(Je.pnl??0):0),0)),pe=Lt(()=>i(te)-i(le)),re=Lt(()=>((n().speed||.5)-.5)/9.5*100);function xe(){var Je;const nt=((Je=r())==null?void 0:Je.getDataList())||[];return nt.length===0?0:nt[nt.length-1].close}function se(){var Je;const nt=((Je=r())==null?void 0:Je.getDataList())||[];return nt.length===0?Date.now():nt[nt.length-1].timestamp}function Ne(){VS(i(u)?i(d)||100:null),b(h,3),WS(!0)}function Te(){var nt;try{(nt=window.stopPrediction)==null||nt.call(window)}catch{}B1(!1)}function Me(){v||(v=setInterval(()=>{var jt,ft,ke,Se,Et;const nt=((jt=r())==null?void 0:jt.getDataList())||[],Je=nt.length>0?nt[nt.length-1]:null,it=Je?Je.close??0:0,ze=Je?Je.high??it:it,Ge=Je?Je.low??it:it;b(p,H(it));const xt=[...n().pendingOrders||[]];for(const wt of xt)if(wt.triggerUp?ze>=wt.price:Ge<=wt.price){const tn=n().leverage||1;if(wt.price*wt.quantity/tn<=n().balance){if(wt.lineOverlayId)try{(ft=r())==null||ft.removeOverlay({id:wt.lineOverlayId})}catch{}if(wt.noteOverlayId)try{(ke=r())==null||ke.removeOverlay({id:wt.noteOverlayId})}catch{}a2(wt.id);const an=se(),Es=(Se=r())==null?void 0:Se.createOverlay({name:"horizontalStraightLine",points:[{value:wt.price}],styles:{line:{style:mt.Dashed,size:1}}}),Ns=(Et=r())==null?void 0:Et.createOverlay({name:"note",points:[{timestamp:an,value:wt.price}],extendData:{in_text:"BUY",in_color:"#10b981",line_color:"#10b981"}}),Hs=Array.isArray(Es)?Es[0]??void 0:Es??void 0,ns=Array.isArray(Ns)?Ns[0]??void 0:Ns??void 0;qS({id:wt.id,symbol:wt.symbol,quantity:wt.quantity,avgCost:wt.price,leverage:wt.leverage,openedAt:Date.now(),lineOverlayId:Hs,noteOverlayId:ns})}else a2(wt.id)}},300))}function De(){v&&(clearInterval(v),v=null)}sm(()=>{b(p,H(xe()))}),Xr(()=>{n().playing?Me():De()});function Oe(nt,Je){const it=n().leverage||1;return Je*nt/it<=n().balance}function Ke(nt){var Je,it;try{nt.lineOverlayId&&((Je=r())==null||Je.removeOverlay({id:nt.lineOverlayId}))}catch{}try{nt.noteOverlayId&&((it=r())==null||it.removeOverlay({id:nt.noteOverlayId}))}catch{}a2(nt.id)}function kt(nt){b(S,H(nt)),b(x,0),b(C,"portfolio")}function pt(nt){var Ge,xt;const Je=n().positions.find(jt=>jt.id===i(S));if(!Je)return;const it=xe(),ze=nt?Je.quantity:Math.min(Je.quantity,Math.max(0,Number(i(x))||0));if(!(ze<=0)){if(pB(Je.id,ze,it),ze===Je.quantity){try{Je.lineOverlayId&&((Ge=r())==null||Ge.removeOverlay({id:Je.lineOverlayId}))}catch{}try{Je.noteOverlayId&&((xt=r())==null||xt.removeOverlay({id:Je.noteOverlayId}))}catch{}}b(S,""),b(x,0)}}function Rt(nt){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:n().currency||"USD",maximumFractionDigits:2}).format(nt)}catch{return`${nt.toFixed(2)} ${n().currency||""}`}}var Ht=HO(),Ft=_s(Ht),zt=y(Ft);Ve(zt,()=>i(h)===1,nt=>{var Je=rO(),it=y(Je),ze=m(y(it),2);qo(ze,21,()=>GS,yi,(jt,ft)=>{var ke=iO(),Se={},Et=y(ke,!0);_(ke),we(()=>{Se!==(Se=i(ft))&&(ke.value=(ke.__value=i(ft))==null?"":i(ft)),st(Et,i(ft))}),Y(jt,ke)}),_(ze),_(it);var Ge=m(it,2);Ts(Ge);var xt=m(Ge,2);xt.__click=[JB,f,c,h],_(Je),co(ze,()=>i(f),jt=>b(f,jt)),Fn(Ge,()=>i(c),jt=>b(c,jt)),Y(nt,Je)},nt=>{var Je=Qs(),it=_s(Je);Ve(it,()=>i(h)===2,ze=>{var Ge=fO(),xt=m(y(Ge),2),jt=y(xt),ft=y(jt);Ts(ft),ft.__click=[aO,u],Oi(2),_(jt);var ke=m(jt,2),Se=y(ke);Ts(Se),Se.__click=[lO,u],Oi(2),_(ke),_(xt);var Et=m(xt,2);Ve(Et,()=>i(u),wt=>{var Ls=cO(),tn=y(Ls),Gs=y(tn);Gs.value=(Gs.__value=50)==null?"":50;var an=m(Gs);an.value=(an.__value=100)==null?"":100;var Es=m(an);Es.value=(Es.__value=200)==null?"":200;var Ns=m(Es);Ns.value=(Ns.__value=400)==null?"":400;var Hs=m(Ns);Hs.value=(Hs.__value=500)==null?"":500,_(tn);var ns=m(tn,2);ns.__click=Ne,_(Ls),co(tn,()=>i(d),fs=>b(d,fs)),Y(wt,Ls)},wt=>{var Ls=dO();Ls.__click=[uO,d,Ne],Y(wt,Ls)}),_(Ge),we(()=>{qm(ft,i(u)),qm(Se,!i(u))}),Y(ze,Ge)},ze=>{var Ge=DO(),xt=_s(Ge),jt=m(y(xt),2);jt.__click=[tO,Te,n,r,a];var ft=y(jt);TB(ft,{size:16}),Oi(),_(jt),_(xt);var ke=m(xt,2),Se=y(ke),Et=y(Se),wt=y(Et),Ls=y(wt),tn=y(Ls),Gs=y(tn);VB(Gs,{size:14}),_(tn),_(Ls);var an=m(Ls,2),Es=m(y(an),2);we(()=>Dt(Es,"title",Rt(n().depositAmount)));var Ns=y(Es,!0);we(()=>st(Ns,Rt(n().depositAmount))),_(Es);var Hs=m(Es,2),ns=y(Hs);we(()=>st(ns,`${Rt(n().depositAmount)??""} • ${n().currency??""}`)),_(Hs),_(an),_(wt),_(Et),_(Se);var fs=m(Se,2),Mn=y(fs),po=y(Mn),Tn=y(po),Cn=y(Tn),go=y(Cn);zB(go,{size:14}),_(Cn),_(Tn);var no=m(Tn,2),Bo=y(no),Vo=m(y(Bo)),Rl=y(Vo);_(Vo),_(Bo);var aa=m(Bo,2);we(()=>Dt(aa,"title",Rt((n().positions||[]).reduce((Ai,ri)=>Ai+ri.avgCost*ri.quantity,0))));var tl=y(aa,!0);we(()=>st(tl,Rt((n().positions||[]).reduce((Ai,ri)=>Ai+ri.avgCost*ri.quantity,0)))),_(aa);var Zr=m(aa,2),zi=y(Zr);Ve(zi,()=>(n().positions||[]).length>0,Ai=>{var ri=Qs(),Ti=_s(ri);Ve(Ti,()=>(n().positions||[]).reduce((Eo,hr)=>Eo+(i(p)-hr.avgCost)*hr.quantity*(hr.leverage||1),0)>=0,Eo=>{var hr=pO(),ei=y(hr);we(()=>st(ei,`+${Rt((n().positions||[]).reduce((ai,vi)=>ai+(i(p)-vi.avgCost)*vi.quantity*(vi.leverage||1),0))??""}`)),_(hr),Y(Eo,hr)},Eo=>{var hr=hO(),ei=y(hr);we(()=>st(ei,`-${Rt(Math.abs((n().positions||[]).reduce((ai,vi)=>ai+(i(p)-vi.avgCost)*vi.quantity*(vi.leverage||1),0)))??""}`)),_(hr),Y(Eo,hr)}),Y(Ai,ri)},Ai=>{var ri=mO();Y(Ai,ri)}),_(Zr),_(no),_(po),_(Mn),_(fs);var Nl=m(fs,2),mu=y(Nl),Gc=y(mu),du=y(Gc),Ju=y(du),rd=y(Ju);SB(rd,{size:14}),_(Ju),_(du);var Al=m(du,2),sa=m(y(Al),2);we(()=>Dt(sa,"title",Rt(n().balance*(n().leverage||1))));var Vc=y(sa,!0);we(()=>st(Vc,Rt(n().balance*(n().leverage||1)))),_(sa);var vu=m(sa,2),Qc=y(vu);_(vu),_(Al),_(Gc),_(mu),_(Nl),_(ke);var To=m(ke,2),ec=y(To),yl=y(ec),Dc=y(yl),jl=y(Dc),qi=y(jl);AB(qi,{size:16}),_(jl),Oi(2),_(Dc);var la=m(Dc,2),El=y(la);_(la),_(yl);var qu=m(yl,2),Td=y(qu);Ts(Td),Td.__input=[eO];var ki=m(Td,2);Ve(ki,()=>n().playing,Ai=>{var ri=vO();ri.__click=Te;var Ti=y(ri);$B(Ti,{size:16}),_(ri),Y(Ai,ri)},Ai=>{var ri=gO();ri.__click=[QB];var Ti=y(ri);DB(Ti,{size:16}),_(ri),Y(Ai,ri)}),_(qu);var sl=m(qu,2);qo(sl,20,()=>[.5,1,2,5,10],yi,(Ai,ri)=>{var Ti=yO();Ti.__click=[_O,ri];var Eo=y(Ti);_(Ti),we(()=>{$i(Ti,`speed-chip ${(n().speed===ri?"active":"")??""} svelte-112gz12`),st(Eo,`${ri??""}x`)}),Y(Ai,Ti)}),_(sl),_(ec),_(To);var br=m(To,2),Wc=y(br),Xd=y(Wc),Uf=y(Xd),xf=m(y(Uf),2);we(()=>Dt(xf,"title",i(p).toFixed(2)));var Uu=y(xf,!0);we(()=>st(Uu,i(p).toFixed(2))),_(xf),_(Uf),Oi(2),_(Xd);var tp=m(Xd,2),wf=y(tp);wf.__click=[sO,I,A,T,P,j,E,L],_(tp),_(Wc),_(br);var Vs=m(br,2),kn=y(Vs),Kn=y(kn),Bs=m(y(Kn),2);Bs.__click=[ZB],_(Kn),_(kn),_(Vs);var bo=m(Vs,2),lo=y(bo);lo.__click=[bO,C];var Qi=m(lo,2);Qi.__click=[xO,C],_(bo);var xr=m(bo,2);Ve(xr,()=>i(C)==="portfolio",Ai=>{var ri=LO(),Ti=_s(ri);Ve(Ti,()=>(n().pendingOrders||[]).length>0,hr=>{var ei=SO(),ai=y(ei),vi=m(y(ai),2);qo(vi,1,()=>n().pendingOrders,yi,(_a,dl)=>{var ar=kO(),Jr=y(ar),nl=y(Jr),tc=y(nl,!0);_(nl);var mc=m(nl,2),gu=y(mc);_(mc);var Bl=m(mc,2),Ui=y(Bl);we(()=>st(Ui,`Price ${i(dl).price.toFixed(2)??""}`)),_(Bl),_(Jr);var Ol=m(Jr,2),fl=y(Ol);fl.__click=[wO,Ke,dl],_(Ol),_(ar),we(()=>{st(tc,i(dl).symbol.ticker),st(gu,`Qty ${i(dl).quantity??""}`)}),Y(_a,ar)}),_(ai),_(ei),Y(hr,ei)});var Eo=m(Ti,2);qo(Eo,1,()=>n().positions,yi,(hr,ei)=>{var ai=FO(),vi=y(ai),_a=y(vi),dl=y(_a),ar=y(dl),Jr=y(ar,!0);_(ar);var nl=m(ar,2),tc=y(nl);_(nl);var mc=m(nl,2),gu=y(mc);we(()=>st(gu,`Avg ${i(ei).avgCost.toFixed(2)??""}`)),_(mc);var Bl=m(mc,2),Ui=y(Bl);_(Bl),_(dl);var Ol=m(dl,2),fl=y(Ol),bl=y(fl);we(()=>st(bl,`${((i(p)-i(ei).avgCost)*i(ei).quantity*(i(ei).leverage||1)>=0?"+":"")??""}${((i(p)-i(ei).avgCost)*i(ei).quantity*(i(ei).leverage||1)).toFixed(2)??""}`)),_(fl);var Ua=m(fl,2);Ve(Ua,()=>i(S)===i(ei).id,ba=>{var ol=IO();ol.__click=[CO,S,x],Y(ba,ol)},ba=>{var ol=MO();ol.__click=[PO,kt,ei],Y(ba,ol)}),_(Ol),_(_a);var er=m(_a,2);Ve(er,()=>i(S)===i(ei).id,ba=>{var ol=TO(),xd=y(ol),_u=y(xd),eu=y(_u),ca=y(eu);_(eu);var vc=m(eu,2);vc.__click=[NO,pt],_(_u),_(xd);var rc=m(xd,2),wd=m(y(rc),2),zl=y(wd);Ts(zl);var Fd=m(zl,2);Fd.__click=[AO,pt],we(()=>Fd.disabled=!i(x)||Number(i(x))<=0||Number(i(x))>i(ei).quantity),_(wd);var Tl=m(wd,2),xa=y(Tl),ku=y(xa);_(xa);var Qu=m(xa,2),ed=y(Qu);we(()=>st(ed,`Est. PnL: ${((i(p)-i(ei).avgCost)*(Number(i(x))||0)*(i(ei).leverage||1)).toFixed(2)??""}`)),_(Qu),_(Tl),_(rc),_(ol),we(()=>{st(ca,`Close entire position (${i(ei).quantity??""})`),Dt(zl,"max",i(ei).quantity),st(ku,`Available: ${i(ei).quantity??""}`)}),Fn(zl,()=>i(x),td=>b(x,td)),Y(ba,ol)}),_(vi),_(ai),we(()=>{st(Jr,i(ei).symbol.ticker),st(tc,`Qty ${i(ei).quantity??""}`),st(Ui,`Lev ${(i(ei).leverage||1)??""}x`),$i(fl,`badge ${((i(p)-i(ei).avgCost)*i(ei).quantity*(i(ei).leverage||1)>=0?"badge-success":"badge-error")??""}`)}),Y(hr,ai)}),Y(Ai,ri)},Ai=>{var ri=$O(),Ti=_s(ri),Eo=y(Ti),hr=y(Eo),ei=y(hr),ai=m(y(ei),2),vi=y(ai),_a=y(vi,!0);_(vi);var dl=m(vi,2);we(()=>Dt(dl,"title",Rt(i(te))));var ar=y(dl,!0);we(()=>st(ar,Rt(i(te)))),_(dl),_(ai),_(ei);var Jr=m(ei,2),nl=m(y(Jr),2),tc=y(nl),mc=y(tc,!0);_(tc);var gu=m(tc,2);we(()=>Dt(gu,"title",Rt(i(le))));var Bl=y(gu,!0);we(()=>st(Bl,Rt(i(le)))),_(gu),_(nl),_(Jr);var Ui=m(Jr,2),Ol=m(y(Ui),2),fl=y(Ol);we(()=>Dt(fl,"title",Rt(i(pe))));var bl=y(fl);we(()=>st(bl,`${(i(pe)>=0?"+":"")??""}${Rt(i(pe))??""}`)),_(fl),_(Ol),_(Ui),_(hr),_(Eo),_(Ti);var Ua=m(Ti,2);qo(Ua,1,()=>n().history,yi,(er,ba)=>{var ol=EO(),xd=y(ol),_u=y(xd),eu=y(_u),ca=y(eu),vc=y(ca,!0);_(ca);var rc=m(ca,2),wd=y(rc);_(rc),_(eu);var zl=m(eu,2),Fd=y(zl);we(()=>st(Fd,`${(i(ba).pnl>=0?"+":"")??""}${i(ba).pnl.toFixed(2)??""}`)),_(zl),_(_u);var Tl=m(_u,2);const xa=Lt(()=>i(ba).avgCost.toFixed(2)??""),ku=Lt(()=>i(ba).closedAvg.toFixed(2)??"");var Qu=y(Tl);we(()=>st(Qu,`Buy ${i(xa)} • Sell ${i(ku)}`)),_(Tl),_(xd),_(ol),we(()=>{st(vc,i(ba).symbol.ticker),st(wd,`Qty ${i(ba).quantity??""}`),$i(zl,`badge ${(i(ba).pnl>=0?"badge-success":"badge-error")??""}`)}),Y(er,ol)}),we(()=>{st(_a,i(de)),st(mc,i(ie)),$i(Ui,`summary-tile net ${(i(pe)>=0?"pos":"neg")??""} svelte-112gz12`)}),Y(Ai,ri)}),we(()=>{yr(fs,"pos",i(D)&&i(X)>=0),yr(fs,"neg",i(D)&&i(X)<0),st(Rl,`Open ${(n().positions||[]).length??""}`),st(Qc,`Leverage ${(n().leverage||1)??""}x`),st(El,`${n().speed??""}x`),qf(Td,n().speed),Dt(Td,"style",`background: linear-gradient(to right, var(--menu-active-bg) ${i(re)}%, var(--menu-btn-bg) ${i(re)}%);`),$i(lo,`tab ${(i(C)==="portfolio"?"tab-active":"")??""} svelte-112gz12`),$i(Qi,`tab ${(i(C)==="history"?"tab-active":"")??""} svelte-112gz12`)}),Y(ze,Ge)},!0),Y(nt,Je)}),_(Ft);var ut=m(Ft,2);Ve(ut,()=>i(I),nt=>{uv(nt,{title:"Place Buy Order",buttons:[],get show(){return i(I)},set show(Je){b(I,H(Je))},get theme(){return o().theme},children:(Je,it)=>{var ze=WO(),Ge=y(ze),xt=m(y(Ge),2),jt=y(xt);Ts(jt),jt.__click=[RO,A],Oi(2),_(xt);var ft=m(xt,2),ke=y(ft);Ts(ke),ke.__click=[jO,A],Oi(2),_(ft),_(Ge);var Se=m(Ge,2);Ve(Se,()=>i(A)==="instant",Et=>{var wt=OO(),Ls=y(wt),tn=y(Ls),Gs=y(tn),an=m(y(Gs),2);we(()=>Dt(an,"title",i(p).toFixed(2)));var Es=y(an,!0);we(()=>st(Es,i(p).toFixed(2))),_(an),_(Gs);var Ns=m(Gs,2),Hs=y(Ns);Ts(Hs);var ns=m(Hs,2);ns.__click=[nO,E,p,T,Oe,Te,se,r,a,o,l,n,I],_(Ns);var fs=m(Ns,2);Ve(fs,()=>i(E),Mn=>{var po=BO(),Tn=y(po,!0);_(po),we(()=>st(Tn,i(E))),Y(Mn,po)}),_(tn),_(Ls),_(wt),Fn(Hs,()=>i(T),Mn=>b(T,Mn)),Y(Et,wt)},Et=>{var wt=VO(),Ls=y(wt),tn=y(Ls);Ts(tn);var Gs=m(tn,2);Ts(Gs),_(Ls);var an=m(Ls,2);an.__click=[oO,L,P,j,Oe,p,r,a,se,o,l,n,I];var Es=m(an,2);Ve(Es,()=>i(L),Ns=>{var Hs=zO(),ns=y(Hs,!0);_(Hs),we(()=>st(ns,i(L))),Y(Ns,Hs)}),_(wt),Fn(tn,()=>i(P),Ns=>b(P,Ns)),Fn(Gs,()=>i(j),Ns=>b(j,Ns)),Y(Et,wt)}),_(ze),we(()=>{qm(jt,i(A)==="instant"),qm(ke,i(A)==="pending")}),Y(Je,ze)},$$slots:{default:!0}})}),Y(s,Ht),Kd()}$p(["click","input"]);var UO=be('<div class="top-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Watch List"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M8 6H21M8 12H21M8 18H21M3 6H3.01M3 12H3.01M3 18H3.01" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Watch</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Alerts"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M18 8A6 6 0 0 0 6 8C6 15 3 17 3 17H21S18 15 18 8Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M13.73 21A2 2 0 0 1 10.27 21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Alerts</span></button> <button class="sidebar-icon ask-ai-btn svelte-3gnxyq" title="Ask AI"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" fill="currentColor" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Ask AI</span></button></div></div> <div class="bottom-section svelte-3gnxyq"><div class="section-card svelte-3gnxyq"><button class="sidebar-icon svelte-3gnxyq" title="Calendar"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" class="svelte-3gnxyq"></line><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></line></svg> <span class="sidebar-label svelte-3gnxyq">Calendar</span></button> <button class="sidebar-icon svelte-3gnxyq" title="Portfolio"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-3gnxyq"><rect x="2" y="7" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="0.5" class="svelte-3gnxyq"></rect><path d="M16 21V5A2 2 0 0 0 14 3H10A2 2 0 0 0 8 5V21" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-3gnxyq"></path></svg> <span class="sidebar-label svelte-3gnxyq">Portfolio</span></button></div></div>',1),GO=be("<div><!></div>");function YO(s,e){Yd(e,!1);const t=lh(),n=()=>Ml(a,"$save",t),o=()=>Ml(pm,"$simulator",t);let r=bi(e,"className",8,"");const a=hd("save");$m();var l=GO(),c=y(l);Ve(c,()=>o().mode==="strategy",f=>{qO(f,{})},f=>{var u=UO(),d=_s(u),h=y(d),p=m(y(h),2);Oi(2),_(h),_(d),Oi(2),pd("click",p,()=>L1.set(!0)),Y(f,u)}),_(l),we(()=>{$i(l,`right-sidebar hidden md:flex ${r()??""} svelte-3gnxyq`),Dt(l,"data-theme",n().theme)}),Y(s,l),Kd()}function KO(s,e){s.preventDefault(),s.stopPropagation(),e("double-click")}var XO=be('<div role="separator" aria-orientation="vertical" aria-label="Resize sidebar" tabindex="0"><div class="resize-indicator svelte-uwsrre"><div class="resize-dots svelte-uwsrre"><div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div> <div class="dot svelte-uwsrre"></div></div></div></div>');function ZO(s,e){Yd(e,!0);let t=bi(e,"className",3,"");const n=fm();let o=_e(!1),r=0,a=0,l;const c=180,f=480,u=12;function d(A){if(A.button!==0)return;A.preventDefault(),A.stopPropagation(),b(o,!0),r=A.clientX;const P=l.closest(".sidebar-container");P&&(a=P.offsetWidth),l.setPointerCapture(A.pointerId),document.body.style.userSelect="none",document.body.style.pointerEvents="none",l.style.pointerEvents="auto",n("resize:start",{widthPx:a})}function h(A){if(!i(o))return;A.preventDefault(),A.stopPropagation();const P=A.clientX-r,T=Math.max(c,Math.min(f,a-P));requestAnimationFrame(()=>{n("resize:move",{widthPx:T})})}function p(A){if(!i(o))return;A.preventDefault(),A.stopPropagation(),b(o,!1),l.releasePointerCapture(A.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="";const P=A.clientX-r,T=Math.max(c,Math.min(f,a-P));n("resize:end",{widthPx:T})}function v(A){i(o)&&(b(o,!1),l.releasePointerCapture(A.pointerId),document.body.style.userSelect="",document.body.style.pointerEvents="",l.style.pointerEvents="",n("resize:end",{widthPx:a}))}function x(A){if(!["ArrowLeft","ArrowRight"].includes(A.key))return;A.preventDefault(),A.stopPropagation();const P=l.closest(".sidebar-container");if(!P)return;const T=P.offsetWidth;let j=T;A.key==="ArrowLeft"?j=Math.min(f,T+u):A.key==="ArrowRight"&&(j=Math.max(c,T-u)),j!==T&&(n("resize:start",{widthPx:T}),n("resize:move",{widthPx:j}),n("resize:end",{widthPx:j}))}function S(){}function C(){}var I=XO();I.__pointerdown=d,I.__pointermove=h,I.__pointerup=p,I.__dblclick=[KO,n],I.__keydown=x,hp(I,A=>l=A,()=>l),we(()=>{$i(I,`sidebar-resize-handle ${t()??""} svelte-uwsrre`),yr(I,"dragging",i(o))}),pd("pointercancel",I,v),pd("focus",I,S),pd("blur",I,C),Y(s,I),Kd()}$p(["pointerdown","pointermove","pointerup","dblclick","keydown"]);const z1=180,Sb=480,E1=280;function QS(s,e=z1,t=Sb,n=E1){return isNaN(s)||s<e||s>t?n:s}function e4(){return typeof window<"u"&&window.__sidebarBootstrap?window.__sidebarBootstrap:{visible:!1,widthPx:0,transitionsEnabled:!1}}function Xx(s){if(typeof window<"u"){window.__sidebarBootstrap||(window.__sidebarBootstrap=e4()),window.__sidebarBootstrap={...window.__sidebarBootstrap,...s};const e=document.documentElement,t=window.__sidebarBootstrap,n=t.visible?t.widthPx+"px":"0px",o=t.visible?"1":"0";e.style.setProperty("--sidebar-width",n),e.style.setProperty("--sidebar-visible",o),e.style.setProperty("--chart-sidebar-width",n),e.style.setProperty("--chart-sidebar-visible",o)}}function JO(s,e){if(typeof window<"u"&&window.localStorage)try{if(localStorage.setItem("dutyai.chart.sidebar.visible","false"),s){const t=QS(e,z1,Sb,E1);localStorage.setItem("dutyai.chart.sidebar.widthPx",String(t))}}catch(t){console.warn("Failed to persist sidebar state:",t)}}function QO(){if(typeof window>"u")return!0;const s=window.innerWidth,n=z1+80+300;return s>=n}function Bk(){Xx({transitionsEnabled:!0})}function ez(){Xx({transitionsEnabled:!1})}function my(s,e){const t=e!==void 0?e:s?E1:0;Xx({visible:s,widthPx:s?QS(t,z1,Sb,E1):0}),JO(s,t)}const tz={MIN_WIDTH:z1,MAX_WIDTH:Sb,DEFAULT_WIDTH:E1,PRICE_SCALE_WIDTH:80};class sz{constructor(){Pe(this,"pending",!1);Pe(this,"callbacks",[]);Pe(this,"keyedCallbacks",new Map);Pe(this,"rafId",null)}request(e){this.callbacks.push(e),this.schedule()}requestKey(e,t){this.keyedCallbacks.set(e,t),this.schedule()}schedule(){this.pending||(this.pending=!0,this.rafId=requestAnimationFrame(()=>{this.flush()}))}async flush(){this.pending=!1,this.rafId=null;const e=this.callbacks;this.callbacks=[];const t=Array.from(this.keyedCallbacks.values());this.keyedCallbacks.clear();for(const n of e)try{await n()}catch(o){console.error("RenderScheduler: Error executing callback",o)}for(const n of t)try{await n()}catch(o){console.error("RenderScheduler: Error executing callback",o)}}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.callbacks=[],this.keyedCallbacks.clear()}isPending(){return this.pending}immediate(e){requestAnimationFrame(async()=>{try{await e()}catch(t){console.error("RenderScheduler: Error executing immediate callback",t)}})}}let c2=null;function Cb(){return c2||(c2=new sz),c2}class nz{constructor(){Pe(this,"scheduler",Cb());Pe(this,"inProgress",!1);Pe(this,"queue",[])}async run(e){if(this.inProgress){this.queue.push(e);return}this.inProgress=!0;try{await this.executeTransaction(e)}finally{if(this.inProgress=!1,this.queue.length>0){const t=this.queue.shift();this.run(t)}}}async executeTransaction(e){const{reason:t,chart:n,mutateState:o,measure:r,compute:a,draw:l,commit:c,cleanup:f,skipTransitions:u}=e;console.log(`🔄 RenderTransaction [${t}] starting...`);const d=performance.now();this.scheduler.request(async()=>{try{o&&await o(),r&&await r(),a&&await a(),l&&n&&await l(n),c&&await c();const h=performance.now()-d;console.log(`✅ RenderTransaction [${t}] completed in ${h.toFixed(2)}ms`)}catch(h){console.error(`❌ RenderTransaction [${t}] failed:`,h)}finally{f&&f()}})}async batch(e){if(e.length===0)return;const t={reason:e[0].reason,chart:e[0].chart,mutateState:async()=>{for(const n of e)n.mutateState&&await n.mutateState()},measure:async()=>{for(const n of e)n.measure&&await n.measure()},compute:async()=>{for(const n of e)n.compute&&await n.compute()},draw:async n=>{for(const o of e)o.draw&&await o.draw(n)},commit:async()=>{for(const n of e)n.commit&&await n.commit()},cleanup:()=>{for(const n of e)n.cleanup&&n.cleanup()}};await this.run(t)}isInProgress(){return this.inProgress}getQueueLength(){return this.queue.length}}let u2=null;function oz(){return u2||(u2=new nz),u2}class iz{constructor(){Pe(this,"states",new Map);Pe(this,"transitionProperty","transition")}register(e,t){this.states.set(e,{enabled:!1,element:t})}disable(e){const t=this.states.get(e);t&&(t.enabled=!1,t.element&&this.applyTransitionStyle(t.element,"none"))}enable(e){const t=this.states.get(e);t&&(t.enabled=!0,t.element&&this.applyTransitionStyle(t.element,""))}withoutTransitions(e,t){this.disable(e);const n=t();return requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})}),n}applyLayout(e,t,n=!0){this.disable(e),t(),n&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.enable(e)})})}isEnabled(e){var t;return((t=this.states.get(e))==null?void 0:t.enabled)??!1}updateElement(e,t){const n=this.states.get(e);n?(n.element=t,n.enabled?this.applyTransitionStyle(t,""):this.applyTransitionStyle(t,"none")):this.register(e,t)}applyTransitionStyle(e,t){e.style.setProperty(this.transitionProperty,t)}clear(){this.states.clear()}getKeys(){return Array.from(this.states.keys())}}let d2=null;function t4(){return d2||(d2=new iz),d2}class rz{constructor(){Pe(this,"rafId",null);Pe(this,"pending",!1);Pe(this,"lastArgs",null)}throttle(e,...t){this.lastArgs=t,!this.pending&&(this.pending=!0,this.rafId=requestAnimationFrame(async()=>{this.pending=!1,this.rafId=null;const n=this.lastArgs;this.lastArgs=null;try{await e(...n)}catch(o){console.error("Throttler: Error executing function",o)}}))}cancel(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pending=!1,this.lastArgs=null}isPending(){return this.pending}}class az{constructor(){Pe(this,"transaction",oz());Pe(this,"layoutManager",t4());Pe(this,"scheduler",Cb());Pe(this,"applyCanvasColorsFn",null)}async waitIndicatorReady(e,t,n,o=800){var a;const r=Date.now();for(;Date.now()-r<o;){try{const l=((a=e.getIndicators)==null?void 0:a.call(e,{name:t,paneId:n}))??[];if(l.length>0&&l.some(f=>f&&f.result&&Object.keys(f.result).length>0))return}catch{}await new Promise(l=>setTimeout(l,16))}}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e}reapplyCanvasColors(){this.applyCanvasColorsFn&&this.applyCanvasColorsFn()}async addIndicator(e){let t=null;return await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{t=e.chart.createIndicator({name:e.name,calcParams:e.params},e.isMain??!1,e.paneId?{id:e.paneId}:void 0)},compute:async()=>{await this.waitIndicatorReady(e.chart,e.name,e.paneId)},commit:()=>{console.log(`✅ Indicator added: ${e.name} (${t})`),this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}}),t}async removeIndicator(e){await this.transaction.run({reason:"indicator",chart:e.chart,mutateState:()=>{e.chart.removeIndicator({paneId:e.paneId,name:e.name})},commit:()=>{console.log(`✅ Indicator removed: ${e.name}`)}})}async changeTimeframe(e){let t=null;try{t=Promise.resolve(e.loadDataFn()).catch(n=>{throw console.error("❌ Timeframe load failed:",n),n})}catch(n){console.error("❌ Timeframe load failed to start:",n),t=Promise.reject(n)}await this.transaction.run({reason:"timeframe",chart:e.chart,compute:async()=>{t&&await t},commit:()=>{console.log("✅ Timeframe changed"),e.skipCanvasReapply||this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}})}async switchChartType(e){await this.transaction.run({reason:"type",chart:e.chart,mutateState:()=>{},compute:async()=>{await e.reloadDataFn()},commit:()=>{console.log(`✅ Chart type switched to: ${e.newType}`),this.scheduler.requestKey("canvas:reapply",()=>{this.reapplyCanvasColors()})}})}async sidebarOperation(e){const t="sidebar";this.layoutManager.register(t),await this.transaction.run({reason:"sidebar",chart:e.chart,skipTransitions:!0,mutateState:()=>{this.layoutManager.disable(t)},measure:()=>{},commit:()=>{this.scheduler.requestKey("sidebar:resize",()=>{e.chart.resize(),this.reapplyCanvasColors(),requestAnimationFrame(()=>{this.layoutManager.enable(t)})})}})}async changeTheme(e,t){await this.transaction.run({reason:"theme",chart:e,mutateState:()=>{t()},commit:()=>{console.log("✅ Theme changed")}})}resizeChart(e){this.scheduler.requestKey("chart:resize",()=>{e.resize()})}async batchIndicatorOperations(e){const t=e.map(n=>({reason:"indicator",chart:n.operation.chart,mutateState:()=>{n.type==="add"?n.operation.chart.createIndicator({name:n.operation.name,calcParams:n.operation.params},n.operation.isMain??!1,n.operation.paneId?{id:n.operation.paneId}:void 0):n.operation.chart.removeIndicator({paneId:n.operation.paneId,name:n.operation.name})}}));await this.transaction.batch(t)}}let f2=null;function Zx(){return f2||(f2=new az),f2}var lz=be('<div class="sidebar-container svelte-1chwdug"><!> <!></div>'),cz=be("<div><!></div>");function uz(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(c,"$chart",t),o=()=>Ml(x,"$sidebarWidth",t),r=()=>Ml(S,"$sidebarState",t),a=()=>Ml(f,"$save",t);let l=bi(e,"className",3,"");const c=hd("chart"),f=hd("save"),{MIN_WIDTH:u,MAX_WIDTH:d,DEFAULT_WIDTH:h,PRICE_SCALE_WIDTH:p}=tz,v=e4(),x=Th(v.widthPx);f.update(Oe=>(Oe.showSidebar=v.visible,Oe));const S=pp([f,x],([Oe,Ke])=>({visible:Oe.showSidebar,widthPx:Ke})),C=fm();let I=_e(!1);Zx();const A=Cb(),P=t4(),T=new rz;P.register("sidebar");function j(){var Oe;if(!QO())return!1;if(typeof window<"u"){const Ke=(Oe=window.matchMedia)==null?void 0:Oe.call(window,"(min-width: 768px)");if(Ke&&!Ke.matches)return!1}return!0}function E(){n()&&A.requestKey("sidebar:resize",()=>{var Oe;(Oe=n())==null||Oe.resize()})}function L(){n()&&T.throttle(()=>{A.requestKey("sidebar:resize",()=>{var Oe;(Oe=n())==null||Oe.resize()})})}function D(){if(!j()){f.update(Ke=>(Ke.showSidebar=!1,Ke)),my(!1,0),C("sidebar:toggle",{visible:!1});return}if(!n())return;const Oe=o()||h;P.enable("sidebar"),f.update(Ke=>(Ke.showSidebar=!0,Ke)),x.set(Oe),my(!0,Oe),C("sidebar:toggle",{visible:!0}),requestAnimationFrame(()=>{E(),setTimeout(()=>{E()},100),setTimeout(()=>{E()},250)})}function X(){f.update(Oe=>(Oe.showSidebar=!1,Oe)),my(!1,0),C("sidebar:toggle",{visible:!1}),n()&&(P.enable("sidebar"),requestAnimationFrame(()=>{E(),setTimeout(()=>{E()},100),setTimeout(()=>{E()},250)}))}function ne(){if(!j()){X();return}r().visible?X():D()}function de(Oe){const Ke=Math.max(u,Math.min(d,Oe));x.set(Ke),a().showSidebar&&my(!0,Ke),C("sidebar:resize:move",{widthPx:Ke}),L()}function ie(){return r()}function te(Oe){P.disable("sidebar"),ez(),C("sidebar:resize:start",{widthPx:o()})}function le(Oe){const Ke=Oe.detail.widthPx;de(Ke)}function pe(Oe){i(I)&&(P.enable("sidebar"),Bk()),C("sidebar:resize:end",{widthPx:o()})}function re(){de(h)}function xe(){!j()&&a().showSidebar&&X()}function se(Oe){if(Oe.key==="S"&&!Oe.ctrlKey&&!Oe.metaKey&&!Oe.altKey){const Ke=Oe.target;Ke.tagName!=="INPUT"&&Ke.tagName!=="TEXTAREA"&&!Ke.isContentEditable&&(Oe.preventDefault(),ne())}}sm(()=>{(async()=>(P.disable("sidebar"),await qy(),xe(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{b(I,!0),P.enable("sidebar"),Bk(),console.log("✨ Sidebar transitions enabled"),n()&&E()})})))();const Oe=()=>{xe()};return window.addEventListener("resize",Oe),window.addEventListener("keydown",se),()=>{window.removeEventListener("resize",Oe),window.removeEventListener("keydown",se),T.cancel()}});const Ne=Lt(()=>()=>{const Oe=r().visible?`${o()}px`:"0px";return{"--sidebar-width":Oe,"--sidebar-visible":r().visible?"1":"0","--sidebar-transitions":i(I)?"width 200ms cubic-bezier(0.4, 0, 0.2, 1)":"none",width:Oe}});var Te=cz();const Me=Lt(()=>Object.entries(i(Ne)).map(([Oe,Ke])=>`${Oe}: ${Ke}`).join("; "));var De=y(Te);return Ve(De,()=>r().visible,Oe=>{var Ke=lz(),kt=y(Ke);YO(kt,{});var pt=m(kt,2);ZO(pt,{$$events:{"resize:start":te,"resize:move":le,"resize:end":pe,"double-click":re}}),_(Ke),we(()=>Dt(Ke,"style",`width: ${o()??""}px;`)),Y(Oe,Ke)}),_(Te),we(()=>{$i(Te,`sidebar-host ${l()??""} svelte-1chwdug`),Dt(Te,"style",i(Me))}),Y(s,Te),Kd({openSidebar:D,closeSidebar:X,toggleSidebar:ne,setSidebarWidth:de,getSidebarState:ie})}var dz=(s,e)=>b(e,"rules"),fz=(s,e)=>b(e,"delivery"),pz=(s,e)=>b(e,"logs"),hz=be('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alert rules found</div> <div class="desc svelte-kd3mpt">Add alertcondition() or alert() in JS/Pine to populate rules.</div></div>'),mz=(s,e)=>kb(i(e).id,{enabled:s.target.checked}),vz=(s,e)=>kb(i(e).id,{frequency:s.target.value}),gz=be("<option> </option>"),_z=(s,e)=>kb(i(e).id,{message:s.target.value}),yz=(s,e,t)=>kb(i(e).id,{channels:{[i(t)]:s.target.checked}}),bz=be('<label class="channel svelte-kd3mpt"><input type="checkbox"> <span> </span></label>'),xz=(s,e,t)=>e(i(t)),wz=be('<div class="rule-card svelte-kd3mpt"><div class="rule-head svelte-kd3mpt"><div><div class="rule-title svelte-kd3mpt"> </div> <div class="rule-message svelte-kd3mpt"> </div></div> <label class="switch svelte-kd3mpt"><input type="checkbox" class="svelte-kd3mpt"> <span class="slider svelte-kd3mpt"></span></label></div> <div class="rule-row svelte-kd3mpt"><label>Frequency</label> <select class="svelte-kd3mpt"></select></div> <div class="rule-row svelte-kd3mpt"><label>Message</label> <input type="text" placeholder="Alert message" class="svelte-kd3mpt"></div> <div class="channels svelte-kd3mpt"></div> <button class="btn-test svelte-kd3mpt">Test alert</button></div>'),kz=be('<div class="rules-grid svelte-kd3mpt"></div>'),Sz=be('<div class="alerts-panel svelte-kd3mpt"><!></div>'),Cz=s=>O1({webhookUrl:s.target.value}),Iz=s=>O1({emailEndpoint:s.target.value}),Pz=s=>O1({emailTo:s.target.value}),Mz=s=>O1({pushEndpoint:s.target.value}),Nz=s=>O1({pushTarget:s.target.value}),Az=s=>KS({backfill:s.target.checked}),Tz=s=>KS({maxLogs:Number(s.target.value)||500}),Fz=be('<div class="alerts-panel svelte-kd3mpt"><div class="delivery-grid svelte-kd3mpt"><div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Webhook</div> <input type="text" placeholder="https://your-webhook-url" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Email (HTTP endpoint)</div> <input type="text" placeholder="https://email-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="to@example.com" class="svelte-kd3mpt"></div> <div class="delivery-card svelte-kd3mpt"><div class="card-title svelte-kd3mpt">Push (HTTP endpoint)</div> <input type="text" placeholder="https://push-gateway/send" class="svelte-kd3mpt"> <input type="text" placeholder="push target / token" class="svelte-kd3mpt"></div></div> <div class="options-row svelte-kd3mpt"><label class="option svelte-kd3mpt"><input type="checkbox"> <span>Backfill historical alerts</span></label> <label class="option svelte-kd3mpt"><span>Max logs</span> <input type="number" min="50" max="2000" class="svelte-kd3mpt"></label></div></div>'),Lz=be('<div class="empty-state svelte-kd3mpt"><div class="title svelte-kd3mpt">No alerts yet</div> <div class="desc svelte-kd3mpt">Triggered alerts will appear here.</div></div>'),Ez=be("<span> </span>"),$z=be('<div class="log-item svelte-kd3mpt"><div class="log-main"><div class="log-title svelte-kd3mpt"> </div> <div class="log-meta svelte-kd3mpt"> </div> <div class="log-message svelte-kd3mpt"> </div></div> <div class="log-deliveries svelte-kd3mpt"></div></div>'),Dz=be('<div class="logs-list svelte-kd3mpt"></div>'),Rz=be('<div class="alerts-panel logs-panel svelte-kd3mpt"><div class="logs-header svelte-kd3mpt"><div class="logs-title svelte-kd3mpt">Alert Logs</div> <button class="btn-clear svelte-kd3mpt">Clear</button></div> <!></div>'),jz=be('<div class="alerts-shell svelte-kd3mpt"><div class="alerts-tabs svelte-kd3mpt"><button class="svelte-kd3mpt">Rules</button> <button class="svelte-kd3mpt">Delivery</button> <button class="svelte-kd3mpt">Logs</button></div> <!></div>');function Bz(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(L1,"$alertCenterUi",t),o=()=>Ml(a,"$save",t),r=()=>Ml(lv,"$alertCenter",t),a=hd("save");let l=_e(!1),c=_e("rules");Xr(()=>{b(l,H(n()))}),Xr(()=>{n()!==i(l)&&L1.set(i(l))});const f={once_per_bar:"Once per bar",once_per_bar_close:"Once per bar close",once:"Once only"},u={app:"App",webhook:"Webhook",email:"Email",push:"Push"},d=v=>!v||!Number.isFinite(v)?"-":new Date(v).toLocaleString(),h=v=>v.title||v.id,p=async v=>{var I,A,P,T,j,E;const x=Date.now(),S={id:`${v.id}_${x}`,ruleId:v.id,timestamp:x,barIndex:void 0,symbol:((A=(I=o())==null?void 0:I.symbol)==null?void 0:A.ticker)||((T=(P=o())==null?void 0:P.symbol)==null?void 0:T.name),timeframe:(E=(j=o())==null?void 0:j.period)==null?void 0:E.timeframe,title:v.title||v.id,message:v.message||"Test alert",price:void 0,deliveries:Object.keys(v.channels||{}).map(L=>({channel:L,status:v.channels[L]?"pending":"skipped"}))};XS([S]);const C=await ZS(S);JS(S.id,C)};uv(s,{title:"Alerts Center",width:"min(980px, 96vw)",maxHeight:"90vh",get show(){return i(l)},set show(v){b(l,H(v))},get theme(){return o().theme},buttons:[],class:"alerts-center",children:(v,x)=>{var S=jz(),C=y(S),I=y(C);I.__click=[dz,c];var A=m(I,2);A.__click=[fz,c];var P=m(A,2);P.__click=[pz,c],_(C);var T=m(C,2);Ve(T,()=>i(c)==="rules",j=>{var E=Sz(),L=y(E);Ve(L,()=>Object.keys(r().rules).length===0,D=>{var X=hz();Y(D,X)},D=>{var X=kz();qo(X,5,()=>Object.values(r().rules),ne=>ne.id,(ne,de)=>{var ie=wz(),te=y(ie),le=y(te),pe=y(le),re=y(pe,!0);we(()=>st(re,h(i(de)))),_(pe);var xe=m(pe,2),se=y(xe,!0);_(xe),_(le);var Ne=m(le,2),Te=y(Ne);Ts(Te),Te.__change=[mz,de],Oi(2),_(Ne),_(te);var Me=m(te,2),De=m(y(Me),2);L0(De,()=>i(de).frequency);var Oe;De.__change=[vz,de],qo(De,21,()=>Object.entries(f),yi,(Ht,Ft)=>{let zt=()=>i(Ft)[0],ut=()=>i(Ft)[1];var nt=gz(),Je={},it=y(nt,!0);_(nt),we(()=>{Je!==(Je=zt())&&(nt.value=(nt.__value=zt())==null?"":zt()),st(it,ut())}),Y(Ht,nt)}),_(De),_(Me);var Ke=m(Me,2),kt=m(y(Ke),2);Ts(kt),kt.__change=[_z,de],_(Ke);var pt=m(Ke,2);qo(pt,21,()=>Object.keys(u),yi,(Ht,Ft)=>{var zt=bz(),ut=y(zt);Ts(ut),ut.__change=[yz,de,Ft];var nt=m(ut,2),Je=y(nt,!0);_(nt),_(zt),we(()=>{var it;qm(ut,(it=i(de).channels)==null?void 0:it[i(Ft)]),st(Je,u[i(Ft)])}),Y(Ht,zt)}),_(pt);var Rt=m(pt,2);Rt.__click=[xz,p,de],_(ie),we(()=>{st(se,i(de).message||"No message"),qm(Te,i(de).enabled),Oe!==(Oe=i(de).frequency)&&(De.value=(De.__value=i(de).frequency)==null?"":i(de).frequency,$g(De,i(de).frequency)),qf(kt,i(de).message||"")}),Y(ne,ie)}),_(X),Y(D,X)}),_(E),Y(j,E)},j=>{var E=Qs(),L=_s(E);Ve(L,()=>i(c)==="delivery",D=>{var X=Fz(),ne=y(X),de=y(ne),ie=m(y(de),2);Ts(ie),ie.__change=[Cz],_(de);var te=m(de,2),le=m(y(te),2);Ts(le),le.__change=[Iz];var pe=m(le,2);Ts(pe),pe.__change=[Pz],_(te);var re=m(te,2),xe=m(y(re),2);Ts(xe),xe.__change=[Mz];var se=m(xe,2);Ts(se),se.__change=[Nz],_(re),_(ne);var Ne=m(ne,2),Te=y(Ne),Me=y(Te);Ts(Me),Me.__change=[Az],Oi(2),_(Te);var De=m(Te,2),Oe=m(y(De),2);Ts(Oe),Oe.__change=[Tz],_(De),_(Ne),_(X),we(()=>{qf(ie,r().delivery.webhookUrl||""),qf(le,r().delivery.emailEndpoint||""),qf(pe,r().delivery.emailTo||""),qf(xe,r().delivery.pushEndpoint||""),qf(se,r().delivery.pushTarget||""),qm(Me,r().options.backfill),qf(Oe,r().options.maxLogs)}),Y(D,X)},D=>{var X=Rz(),ne=y(X),de=m(y(ne),2);de.__click=function(...te){l2==null||l2.apply(this,te)},_(ne);var ie=m(ne,2);Ve(ie,()=>r().logs.length===0,te=>{var le=Lz();Y(te,le)},te=>{var le=Dz();qo(le,5,()=>r().logs,pe=>pe.id,(pe,re)=>{var xe=$z(),se=y(xe),Ne=y(se),Te=y(Ne,!0);_(Ne);var Me=m(Ne,2),De=y(Me);we(()=>st(De,`${d(i(re).timestamp)??""} · ${(i(re).symbol||"-")??""} · ${(i(re).timeframe||"-")??""}`)),_(Me);var Oe=m(Me,2),Ke=y(Oe,!0);_(Oe),_(se);var kt=m(se,2);qo(kt,21,()=>i(re).deliveries,yi,(pt,Rt)=>{var Ht=Ez(),Ft=y(Ht);_(Ht),we(()=>{$i(Ht,`${`chip chip-${i(Rt).status}`??""} svelte-kd3mpt`),st(Ft,`${i(Rt).channel??""}:${i(Rt).status??""}`)}),Y(pt,Ht)}),_(kt),_(xe),we(()=>{st(Te,i(re).title||i(re).ruleId),st(Ke,i(re).message||"-")}),Y(pe,xe)}),_(le),Y(te,le)}),_(X),Y(D,X)},!0),Y(j,E)}),_(S),we(()=>{yr(I,"active",i(c)==="rules"),yr(A,"active",i(c)==="delivery"),yr(P,"active",i(c)==="logs")}),Y(v,S)},$$slots:{default:!0}}),Kd()}$p(["click","change"]);const Oz=["XAU","XAG","XPT","XPD","CNH"],Ok=new Set(["USD","EUR","GBP","JPY","CHF","CAD","AUD","NZD","SEK","NOK","DKK","SGD","HKD","CNY","INR","KRW","THB","MYR","IDR","PHP","MXN","BRL","ZAR","TRY","PLN","CZK","HUF","RON","ILS","RUB","AED","SAR","QAR","KWD",...Oz]),zz=["USDT","USDC","BUSD","DAI","TUSD","FDUSD","USD","BTC","ETH","BNB","SOL","XBT"],Vz=["BINANCE","COINBASE","KRAKEN","BYBIT","OKX","BITFINEX","KUCOIN","GATE","MEXC","BITGET"],Wz=["OANDA","FXCM","FOREX","FX","DUKASCOPY","PEPPERSTONE","ICMARKETS","IG"];function P1(s){if(typeof s=="number"&&Number.isFinite(s))return s;if(typeof s=="string"){const e=Number(s.trim());if(Number.isFinite(e))return e}}function p2(s){return typeof s=="number"&&Number.isFinite(s)}function Ig(s,e,t){return Math.min(t,Math.max(e,Math.trunc(s)))}function s4(s){const e=typeof s.exchange=="string"?s.exchange.trim():"",t=typeof s.ticker=="string"?s.ticker.trim():"";if(!e&&t.includes(":")){const n=t.indexOf(":"),o=t.slice(0,n).trim(),r=t.slice(n+1).trim();return{exchange:o?o.toUpperCase():void 0,ticker:r.toUpperCase()}}return{exchange:e?e.toUpperCase():void 0,ticker:t.toUpperCase()}}function n4(s){return(s||"").replace(/[^A-Z]/gi,"").toUpperCase()}function o4(s){const e=(s.market??s.type??"").toString().toLowerCase();if(e.includes("forex")||e==="fx")return"forex";if(e.includes("crypto")||e.includes("coin"))return"crypto";const{exchange:t,ticker:n}=s4(s),o=(t||"").toUpperCase();if(Vz.some(a=>o.includes(a)))return"crypto";if(Wz.some(a=>o.includes(a)))return"forex";const r=n4(n);if(r.length>=6){const a=r.slice(0,3),l=r.slice(3,6);if(Ok.has(a)&&Ok.has(l))return"forex"}return zz.some(a=>r.endsWith(a))?"crypto":e.includes("stock")||e.includes("equity")||e.includes("index")?"stock":"unknown"}function vy(s){return o4(s)}function Hz(s){const{ticker:e}=s4(s),t=n4(e),n=t.slice(0,3),o=t.slice(3,6);return n==="XAU"||n==="XAG"||n==="XPT"||n==="XPD"||o==="JPY"?3:5}function i4(s,e){if(!Number.isFinite(s))return 0;try{const t=s.toFixed(e).replace(/\.?0+$/,""),n=t.indexOf(".");return n===-1?0:t.length-n-1}catch{return 0}}function h2(s){if(!Array.isArray(s)||s.length===0)return;const e=s.slice(Math.max(0,s.length-200));let t=0;for(const n of e){const o=[n.open,n.high,n.low,n.close];for(const r of o){const a=P1(r);if(a!=null&&(t=Math.max(t,i4(a,12)),t>=12))return 12}}return t}function qz(s){var e;if(!(!Array.isArray(s)||s.length===0))for(let t=s.length-1;t>=0;t--){const n=(e=s[t])==null?void 0:e.close,o=P1(n);if(o!=null)return o}}function w_(s,e){const t=(s==null?void 0:s.tickSize)??(s==null?void 0:s.minTick)??(s==null?void 0:s.priceStep),n=P1(t),o=n!=null&&n>0?i4(n,12):void 0,r=o4(s);if(r==="forex"){const f=Hz(s),u=P1(s==null?void 0:s.pricePrecision),d=e?h2(e):void 0,h=Math.max(f,o??0,u??0,p2(d)?d:0);return Ig(h,0,12)}const a=s==null?void 0:s.pricePrecision,l=P1(a);if(r==="stock")return o!=null?Ig(o,0,12):l!=null?Ig(l,0,12):2;const c=e?h2(e):void 0;if(p2(c))return Ig(c,2,12);if(r==="crypto"){const f=e?h2(e):void 0,u=p2(f)?f:l??6,d=Math.abs(qz(e)??NaN);return Number.isFinite(d)?d>=1e3?Ig(u,2,2):d>=1?Ig(u,2,4):d>=.01?Ig(u,4,8):Ig(u,6,12):Ig(u,2,12)}return l!=null?Ig(l,0,12):2}var r4={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(s,e){(function(t,n){s.exports=n()})(o0,function t(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},o=!n.document&&!!n.postMessage,r=n.IS_PAPA_WORKER||!1,a={},l=0,c={parse:function(L,D){var X=(D=D||{}).dynamicTyping||!1;if(E(X)&&(D.dynamicTypingFunction=X,X={}),D.dynamicTyping=X,D.transform=!!E(D.transform)&&D.transform,D.worker&&c.WORKERS_SUPPORTED){var ne=function(){if(!c.WORKERS_SUPPORTED)return!1;var ie=(le=n.URL||n.webkitURL||null,pe=t.toString(),c.BLOB_URL||(c.BLOB_URL=le.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",pe,")();"],{type:"text/javascript"})))),te=new n.Worker(ie),le,pe;return te.onmessage=I,te.id=l++,a[te.id]=te}();return ne.userStep=D.step,ne.userChunk=D.chunk,ne.userComplete=D.complete,ne.userError=D.error,D.step=E(D.step),D.chunk=E(D.chunk),D.complete=E(D.complete),D.error=E(D.error),delete D.worker,void ne.postMessage({input:L,config:D,workerId:ne.id})}var de=null;return c.NODE_STREAM_INPUT,typeof L=="string"?(L=function(ie){return ie.charCodeAt(0)===65279?ie.slice(1):ie}(L),de=D.download?new d(D):new p(D)):L.readable===!0&&E(L.read)&&E(L.on)?de=new v(D):(n.File&&L instanceof File||L instanceof Object)&&(de=new h(D)),de.stream(L)},unparse:function(L,D){var X=!1,ne=!0,de=",",ie=`\r
`,te='"',le=te+te,pe=!1,re=null,xe=!1;(function(){if(typeof D=="object"){if(typeof D.delimiter!="string"||c.BAD_DELIMITERS.filter(function(Me){return D.delimiter.indexOf(Me)!==-1}).length||(de=D.delimiter),(typeof D.quotes=="boolean"||typeof D.quotes=="function"||Array.isArray(D.quotes))&&(X=D.quotes),typeof D.skipEmptyLines!="boolean"&&typeof D.skipEmptyLines!="string"||(pe=D.skipEmptyLines),typeof D.newline=="string"&&(ie=D.newline),typeof D.quoteChar=="string"&&(te=D.quoteChar),typeof D.header=="boolean"&&(ne=D.header),Array.isArray(D.columns)){if(D.columns.length===0)throw new Error("Option columns is empty");re=D.columns}D.escapeChar!==void 0&&(le=D.escapeChar+te),(typeof D.escapeFormulae=="boolean"||D.escapeFormulae instanceof RegExp)&&(xe=D.escapeFormulae instanceof RegExp?D.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var se=new RegExp(S(te),"g");if(typeof L=="string"&&(L=JSON.parse(L)),Array.isArray(L)){if(!L.length||Array.isArray(L[0]))return Ne(null,L,pe);if(typeof L[0]=="object")return Ne(re||Object.keys(L[0]),L,pe)}else if(typeof L=="object")return typeof L.data=="string"&&(L.data=JSON.parse(L.data)),Array.isArray(L.data)&&(L.fields||(L.fields=L.meta&&L.meta.fields||re),L.fields||(L.fields=Array.isArray(L.data[0])?L.fields:typeof L.data[0]=="object"?Object.keys(L.data[0]):[]),Array.isArray(L.data[0])||typeof L.data[0]=="object"||(L.data=[L.data])),Ne(L.fields||[],L.data||[],pe);throw new Error("Unable to serialize unrecognized input");function Ne(Me,De,Oe){var Ke="";typeof Me=="string"&&(Me=JSON.parse(Me)),typeof De=="string"&&(De=JSON.parse(De));var kt=Array.isArray(Me)&&0<Me.length,pt=!Array.isArray(De[0]);if(kt&&ne){for(var Rt=0;Rt<Me.length;Rt++)0<Rt&&(Ke+=de),Ke+=Te(Me[Rt],Rt);0<De.length&&(Ke+=ie)}for(var Ht=0;Ht<De.length;Ht++){var Ft=kt?Me.length:De[Ht].length,zt=!1,ut=kt?Object.keys(De[Ht]).length===0:De[Ht].length===0;if(Oe&&!kt&&(zt=Oe==="greedy"?De[Ht].join("").trim()==="":De[Ht].length===1&&De[Ht][0].length===0),Oe==="greedy"&&kt){for(var nt=[],Je=0;Je<Ft;Je++){var it=pt?Me[Je]:Je;nt.push(De[Ht][it])}zt=nt.join("").trim()===""}if(!zt){for(var ze=0;ze<Ft;ze++){0<ze&&!ut&&(Ke+=de);var Ge=kt&&pt?Me[ze]:ze;Ke+=Te(De[Ht][Ge],ze)}Ht<De.length-1&&(!Oe||0<Ft&&!ut)&&(Ke+=ie)}}return Ke}function Te(Me,De){if(Me==null)return"";if(Me.constructor===Date)return JSON.stringify(Me).slice(1,25);var Oe=!1;xe&&typeof Me=="string"&&xe.test(Me)&&(Me="'"+Me,Oe=!0);var Ke=Me.toString().replace(se,le);return(Oe=Oe||X===!0||typeof X=="function"&&X(Me,De)||Array.isArray(X)&&X[De]||function(kt,pt){for(var Rt=0;Rt<pt.length;Rt++)if(-1<kt.indexOf(pt[Rt]))return!0;return!1}(Ke,c.BAD_DELIMITERS)||-1<Ke.indexOf(de)||Ke.charAt(0)===" "||Ke.charAt(Ke.length-1)===" ")?te+Ke+te:Ke}}};if(c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!o&&!!n.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=C,c.ParserHandle=x,c.NetworkStreamer=d,c.FileStreamer=h,c.StringStreamer=p,c.ReadableStreamStreamer=v,n.jQuery){var f=n.jQuery;f.fn.parse=function(L){var D=L.config||{},X=[];return this.each(function(ie){if(!(f(this).prop("tagName").toUpperCase()==="INPUT"&&f(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var te=0;te<this.files.length;te++)X.push({file:this.files[te],inputElem:this,instanceConfig:f.extend({},D)})}),ne(),this;function ne(){if(X.length!==0){var ie,te,le,pe,re=X[0];if(E(L.before)){var xe=L.before(re.file,re.inputElem);if(typeof xe=="object"){if(xe.action==="abort")return ie="AbortError",te=re.file,le=re.inputElem,pe=xe.reason,void(E(L.error)&&L.error({name:ie},te,le,pe));if(xe.action==="skip")return void de();typeof xe.config=="object"&&(re.instanceConfig=f.extend(re.instanceConfig,xe.config))}else if(xe==="skip")return void de()}var se=re.instanceConfig.complete;re.instanceConfig.complete=function(Ne){E(se)&&se(Ne,re.file,re.inputElem),de()},c.parse(re.file,re.instanceConfig)}else E(L.complete)&&L.complete()}function de(){X.splice(0,1),ne()}}}function u(L){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(D){var X=T(D);X.chunkSize=parseInt(X.chunkSize),D.step||D.chunk||(X.chunkSize=null),this._handle=new x(X),(this._handle.streamer=this)._config=X}).call(this,L),this.parseChunk=function(D,X){if(this.isFirstChunk&&E(this._config.beforeFirstChunk)){var ne=this._config.beforeFirstChunk(D);ne!==void 0&&(D=ne)}this.isFirstChunk=!1,this._halted=!1;var de=this._partialLine+D;this._partialLine="";var ie=this._handle.parse(de,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var te=ie.meta.cursor;this._finished||(this._partialLine=de.substring(te-this._baseIndex),this._baseIndex=te),ie&&ie.data&&(this._rowCount+=ie.data.length);var le=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)n.postMessage({results:ie,workerId:c.WORKER_ID,finished:le});else if(E(this._config.chunk)&&!X){if(this._config.chunk(ie,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);ie=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(ie.data),this._completeResults.errors=this._completeResults.errors.concat(ie.errors),this._completeResults.meta=ie.meta),this._completed||!le||!E(this._config.complete)||ie&&ie.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),le||ie&&ie.meta.paused||this._nextChunk(),ie}this._halted=!0},this._sendError=function(D){E(this._config.error)?this._config.error(D):r&&this._config.error&&n.postMessage({workerId:c.WORKER_ID,error:D,finished:!1})}}function d(L){var D;(L=L||{}).chunkSize||(L.chunkSize=c.RemoteChunkSize),u.call(this,L),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(X){this._input=X,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(D=new XMLHttpRequest,this._config.withCredentials&&(D.withCredentials=this._config.withCredentials),o||(D.onload=j(this._chunkLoaded,this),D.onerror=j(this._chunkError,this)),D.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var X=this._config.downloadRequestHeaders;for(var ne in X)D.setRequestHeader(ne,X[ne])}if(this._config.chunkSize){var de=this._start+this._config.chunkSize-1;D.setRequestHeader("Range","bytes="+this._start+"-"+de)}try{D.send(this._config.downloadRequestBody)}catch(ie){this._chunkError(ie.message)}o&&D.status===0&&this._chunkError()}},this._chunkLoaded=function(){D.readyState===4&&(D.status<200||400<=D.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:D.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(X){var ne=X.getResponseHeader("Content-Range");return ne===null?-1:parseInt(ne.substring(ne.lastIndexOf("/")+1))}(D),this.parseChunk(D.responseText)))},this._chunkError=function(X){var ne=D.statusText||X;this._sendError(new Error(ne))}}function h(L){var D,X;(L=L||{}).chunkSize||(L.chunkSize=c.LocalChunkSize),u.call(this,L);var ne=typeof FileReader<"u";this.stream=function(de){this._input=de,X=de.slice||de.webkitSlice||de.mozSlice,ne?((D=new FileReader).onload=j(this._chunkLoaded,this),D.onerror=j(this._chunkError,this)):D=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var de=this._input;if(this._config.chunkSize){var ie=Math.min(this._start+this._config.chunkSize,this._input.size);de=X.call(de,this._start,ie)}var te=D.readAsText(de,this._config.encoding);ne||this._chunkLoaded({target:{result:te}})},this._chunkLoaded=function(de){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(de.target.result)},this._chunkError=function(){this._sendError(D.error)}}function p(L){var D;u.call(this,L=L||{}),this.stream=function(X){return D=X,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var X,ne=this._config.chunkSize;return ne?(X=D.substring(0,ne),D=D.substring(ne)):(X=D,D=""),this._finished=!D,this.parseChunk(X)}}}function v(L){u.call(this,L=L||{});var D=[],X=!0,ne=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(de){this._input=de,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){ne&&D.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),D.length?this.parseChunk(D.shift()):X=!0},this._streamData=j(function(de){try{D.push(typeof de=="string"?de:de.toString(this._config.encoding)),X&&(X=!1,this._checkIsFinished(),this.parseChunk(D.shift()))}catch(ie){this._streamError(ie)}},this),this._streamError=j(function(de){this._streamCleanUp(),this._sendError(de)},this),this._streamEnd=j(function(){this._streamCleanUp(),ne=!0,this._streamData("")},this),this._streamCleanUp=j(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function x(L){var D,X,ne,de=Math.pow(2,53),ie=-de,te=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,le=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,pe=this,re=0,xe=0,se=!1,Ne=!1,Te=[],Me={data:[],errors:[],meta:{}};if(E(L.step)){var De=L.step;L.step=function(Ht){if(Me=Ht,kt())Ke();else{if(Ke(),Me.data.length===0)return;re+=Ht.data.length,L.preview&&re>L.preview?X.abort():(Me.data=Me.data[0],De(Me,pe))}}}function Oe(Ht){return L.skipEmptyLines==="greedy"?Ht.join("").trim()==="":Ht.length===1&&Ht[0].length===0}function Ke(){return Me&&ne&&(Rt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),ne=!1),L.skipEmptyLines&&(Me.data=Me.data.filter(function(Ht){return!Oe(Ht)})),kt()&&function(){if(!Me)return;function Ht(zt,ut){E(L.transformHeader)&&(zt=L.transformHeader(zt,ut)),Te.push(zt)}if(Array.isArray(Me.data[0])){for(var Ft=0;kt()&&Ft<Me.data.length;Ft++)Me.data[Ft].forEach(Ht);Me.data.splice(0,1)}else Me.data.forEach(Ht)}(),function(){if(!Me||!L.header&&!L.dynamicTyping&&!L.transform)return Me;function Ht(zt,ut){var nt,Je=L.header?{}:[];for(nt=0;nt<zt.length;nt++){var it=nt,ze=zt[nt];L.header&&(it=nt>=Te.length?"__parsed_extra":Te[nt]),L.transform&&(ze=L.transform(ze,it)),ze=pt(it,ze),it==="__parsed_extra"?(Je[it]=Je[it]||[],Je[it].push(ze)):Je[it]=ze}return L.header&&(nt>Te.length?Rt("FieldMismatch","TooManyFields","Too many fields: expected "+Te.length+" fields but parsed "+nt,xe+ut):nt<Te.length&&Rt("FieldMismatch","TooFewFields","Too few fields: expected "+Te.length+" fields but parsed "+nt,xe+ut)),Je}var Ft=1;return!Me.data.length||Array.isArray(Me.data[0])?(Me.data=Me.data.map(Ht),Ft=Me.data.length):Me.data=Ht(Me.data,0),L.header&&Me.meta&&(Me.meta.fields=Te),xe+=Ft,Me}()}function kt(){return L.header&&Te.length===0}function pt(Ht,Ft){return zt=Ht,L.dynamicTypingFunction&&L.dynamicTyping[zt]===void 0&&(L.dynamicTyping[zt]=L.dynamicTypingFunction(zt)),(L.dynamicTyping[zt]||L.dynamicTyping)===!0?Ft==="true"||Ft==="TRUE"||Ft!=="false"&&Ft!=="FALSE"&&(function(ut){if(te.test(ut)){var nt=parseFloat(ut);if(ie<nt&&nt<de)return!0}return!1}(Ft)?parseFloat(Ft):le.test(Ft)?new Date(Ft):Ft===""?null:Ft):Ft;var zt}function Rt(Ht,Ft,zt,ut){var nt={type:Ht,code:Ft,message:zt};ut!==void 0&&(nt.row=ut),Me.errors.push(nt)}this.parse=function(Ht,Ft,zt){var ut=L.quoteChar||'"';if(L.newline||(L.newline=function(it,ze){it=it.substring(0,1048576);var Ge=new RegExp(S(ze)+"([^]*?)"+S(ze),"gm"),xt=(it=it.replace(Ge,"")).split("\r"),jt=it.split(`
`),ft=1<jt.length&&jt[0].length<xt[0].length;if(xt.length===1||ft)return`
`;for(var ke=0,Se=0;Se<xt.length;Se++)xt[Se][0]===`
`&&ke++;return ke>=xt.length/2?`\r
`:"\r"}(Ht,ut)),ne=!1,L.delimiter)E(L.delimiter)&&(L.delimiter=L.delimiter(Ht),Me.meta.delimiter=L.delimiter);else{var nt=function(it,ze,Ge,xt,jt){var ft,ke,Se,Et;jt=jt||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var wt=0;wt<jt.length;wt++){var Ls=jt[wt],tn=0,Gs=0,an=0;Se=void 0;for(var Es=new C({comments:xt,delimiter:Ls,newline:ze,preview:10}).parse(it),Ns=0;Ns<Es.data.length;Ns++)if(Ge&&Oe(Es.data[Ns]))an++;else{var Hs=Es.data[Ns].length;Gs+=Hs,Se!==void 0?0<Hs&&(tn+=Math.abs(Hs-Se),Se=Hs):Se=Hs}0<Es.data.length&&(Gs/=Es.data.length-an),(ke===void 0||tn<=ke)&&(Et===void 0||Et<Gs)&&1.99<Gs&&(ke=tn,ft=Ls,Et=Gs)}return{successful:!!(L.delimiter=ft),bestDelimiter:ft}}(Ht,L.newline,L.skipEmptyLines,L.comments,L.delimitersToGuess);nt.successful?L.delimiter=nt.bestDelimiter:(ne=!0,L.delimiter=c.DefaultDelimiter),Me.meta.delimiter=L.delimiter}var Je=T(L);return L.preview&&L.header&&Je.preview++,D=Ht,X=new C(Je),Me=X.parse(D,Ft,zt),Ke(),se?{meta:{paused:!0}}:Me||{meta:{paused:!1}}},this.paused=function(){return se},this.pause=function(){se=!0,X.abort(),D=E(L.chunk)?"":D.substring(X.getCharIndex())},this.resume=function(){pe.streamer._halted?(se=!1,pe.streamer.parseChunk(D,!0)):setTimeout(pe.resume,3)},this.aborted=function(){return Ne},this.abort=function(){Ne=!0,X.abort(),Me.meta.aborted=!0,E(L.complete)&&L.complete(Me),D=""}}function S(L){return L.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function C(L){var D,X=(L=L||{}).delimiter,ne=L.newline,de=L.comments,ie=L.step,te=L.preview,le=L.fastMode,pe=D=L.quoteChar===void 0||L.quoteChar===null?'"':L.quoteChar;if(L.escapeChar!==void 0&&(pe=L.escapeChar),(typeof X!="string"||-1<c.BAD_DELIMITERS.indexOf(X))&&(X=","),de===X)throw new Error("Comment character same as delimiter");de===!0?de="#":(typeof de!="string"||-1<c.BAD_DELIMITERS.indexOf(de))&&(de=!1),ne!==`
`&&ne!=="\r"&&ne!==`\r
`&&(ne=`
`);var re=0,xe=!1;this.parse=function(se,Ne,Te){if(typeof se!="string")throw new Error("Input must be a string");var Me=se.length,De=X.length,Oe=ne.length,Ke=de.length,kt=E(ie),pt=[],Rt=[],Ht=[],Ft=re=0;if(!se)return ns();if(L.header&&!Ne){var zt=se.split(ne)[0].split(X),ut=[],nt={},Je=!1;for(var it in zt){var ze=zt[it];E(L.transformHeader)&&(ze=L.transformHeader(ze,it));var Ge=ze,xt=nt[ze]||0;for(0<xt&&(Je=!0,Ge=ze+"_"+xt),nt[ze]=xt+1;ut.includes(Ge);)Ge=Ge+"_"+xt;ut.push(Ge)}if(Je){var jt=se.split(ne);jt[0]=ut.join(X),se=jt.join(ne)}}if(le||le!==!1&&se.indexOf(D)===-1){for(var ft=se.split(ne),ke=0;ke<ft.length;ke++){if(Ht=ft[ke],re+=Ht.length,ke!==ft.length-1)re+=ne.length;else if(Te)return ns();if(!de||Ht.substring(0,Ke)!==de){if(kt){if(pt=[],an(Ht.split(X)),fs(),xe)return ns()}else an(Ht.split(X));if(te&&te<=ke)return pt=pt.slice(0,te),ns(!0)}}return ns()}for(var Se=se.indexOf(X,re),Et=se.indexOf(ne,re),wt=new RegExp(S(pe)+S(D),"g"),Ls=se.indexOf(D,re);;)if(se[re]!==D)if(de&&Ht.length===0&&se.substring(re,re+Ke)===de){if(Et===-1)return ns();re=Et+Oe,Et=se.indexOf(ne,re),Se=se.indexOf(X,re)}else if(Se!==-1&&(Se<Et||Et===-1))Ht.push(se.substring(re,Se)),re=Se+De,Se=se.indexOf(X,re);else{if(Et===-1)break;if(Ht.push(se.substring(re,Et)),Hs(Et+Oe),kt&&(fs(),xe))return ns();if(te&&pt.length>=te)return ns(!0)}else for(Ls=re,re++;;){if((Ls=se.indexOf(D,Ls+1))===-1)return Te||Rt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:pt.length,index:re}),Ns();if(Ls===Me-1)return Ns(se.substring(re,Ls).replace(wt,D));if(D!==pe||se[Ls+1]!==pe){if(D===pe||Ls===0||se[Ls-1]!==pe){Se!==-1&&Se<Ls+1&&(Se=se.indexOf(X,Ls+1)),Et!==-1&&Et<Ls+1&&(Et=se.indexOf(ne,Ls+1));var tn=Es(Et===-1?Se:Math.min(Se,Et));if(se.substr(Ls+1+tn,De)===X){Ht.push(se.substring(re,Ls).replace(wt,D)),se[re=Ls+1+tn+De]!==D&&(Ls=se.indexOf(D,re)),Se=se.indexOf(X,re),Et=se.indexOf(ne,re);break}var Gs=Es(Et);if(se.substring(Ls+1+Gs,Ls+1+Gs+Oe)===ne){if(Ht.push(se.substring(re,Ls).replace(wt,D)),Hs(Ls+1+Gs+Oe),Se=se.indexOf(X,re),Ls=se.indexOf(D,re),kt&&(fs(),xe))return ns();if(te&&pt.length>=te)return ns(!0);break}Rt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:pt.length,index:re}),Ls++}}else Ls++}return Ns();function an(Mn){pt.push(Mn),Ft=re}function Es(Mn){var po=0;if(Mn!==-1){var Tn=se.substring(Ls+1,Mn);Tn&&Tn.trim()===""&&(po=Tn.length)}return po}function Ns(Mn){return Te||(Mn===void 0&&(Mn=se.substring(re)),Ht.push(Mn),re=Me,an(Ht),kt&&fs()),ns()}function Hs(Mn){re=Mn,an(Ht),Ht=[],Et=se.indexOf(ne,re)}function ns(Mn){return{data:pt,errors:Rt,meta:{delimiter:X,linebreak:ne,aborted:xe,truncated:!!Mn,cursor:Ft+(Ne||0)}}}function fs(){ie(ns()),pt=[],Rt=[]}},this.abort=function(){xe=!0},this.getCharIndex=function(){return re}}function I(L){var D=L.data,X=a[D.workerId],ne=!1;if(D.error)X.userError(D.error,D.file);else if(D.results&&D.results.data){var de={abort:function(){ne=!0,A(D.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:P,resume:P};if(E(X.userStep)){for(var ie=0;ie<D.results.data.length&&(X.userStep({data:D.results.data[ie],errors:D.results.errors,meta:D.results.meta},de),!ne);ie++);delete D.results}else E(X.userChunk)&&(X.userChunk(D.results,de,D.file),delete D.results)}D.finished&&!ne&&A(D.workerId,D.results)}function A(L,D){var X=a[L];E(X.userComplete)&&X.userComplete(D),X.terminate(),delete a[L]}function P(){throw new Error("Not implemented.")}function T(L){if(typeof L!="object"||L===null)return L;var D=Array.isArray(L)?[]:{};for(var X in L)D[X]=T(L[X]);return D}function j(L,D){return function(){L.apply(D,arguments)}}function E(L){return typeof L=="function"}return r&&(n.onmessage=function(L){var D=L.data;if(c.WORKER_ID===void 0&&D&&(c.WORKER_ID=D.workerId),typeof D.input=="string")n.postMessage({workerId:c.WORKER_ID,results:c.parse(D.input,D.config),finished:!0});else if(n.File&&D.input instanceof File||D.input instanceof Object){var X=c.parse(D.input,D.config);X&&n.postMessage({workerId:c.WORKER_ID,results:X,finished:!0})}}),(d.prototype=Object.create(u.prototype)).constructor=d,(h.prototype=Object.create(u.prototype)).constructor=h,(p.prototype=Object.create(p.prototype)).constructor=p,(v.prototype=Object.create(u.prototype)).constructor=v,c})})(r4);var Uz=r4.exports;const Gz=R1(Uz);function Yz(s,e,t,n,o){if(!(!e()||i(t).length===0))switch(s.key){case"ArrowDown":s.preventDefault(),b(n,H(Math.min(i(n)+1,i(t).length-1)));break;case"ArrowUp":s.preventDefault(),b(n,H(Math.max(i(n)-1,-1)));break;case"Enter":s.preventDefault(),i(n)>=0&&i(n)<i(t).length&&o(i(t)[i(n)]);break;case"Escape":s.preventDefault(),e(!1);break}}var Kz=be('<div class="flex justify-center py-16"><div class="relative"><div class="w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-12 h-12 border-4 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div></div>'),Xz=be('<div class="flex flex-col items-center justify-center py-16 text-center"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4"><svg class="w-8 h-8 text-base-content/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2">No symbols found</p> <p class="text-sm text-base-content/40">Try a different search term</p></div>'),Zz=(s,e,t)=>e(i(t)),Jz=be('<div class="absolute top-0 left-0 w-5 h-5 rounded-full overflow-hidden bg-base-200 ring-2 ring-base-100 z-10"><img class="w-full h-full object-cover"></div> <div class="absolute bottom-0 right-0 w-5 h-5 rounded-full overflow-hidden bg-base-200"><img class="w-full h-full object-cover"></div>',1),Qz=be('<div class="relative w-full h-full rounded-lg overflow-hidden bg-base-200/50"><img class="w-full h-full object-cover"> <div class="absolute inset-0 bg-base-200 flex items-center justify-center hidden"><span class="text-xs font-medium text-base-content/60"> </span></div></div>'),eV=be('<span class="text-xs px-1.5 py-0.5 rounded bg-base-200/60 border border-base-300/40 text-base-content/60"> </span>'),tV=be('<p class="text-sm text-base-content/60 truncate mt-0.5"> </p>'),sV=be('<div class="flex-shrink-0"><svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg></div>'),nV=be('<div><div class="relative w-8 h-8 flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><h3 class="font-medium text-base"> </h3> <span class="text-xs text-base-content/50"> </span> <!></div> <!></div> <!></div>'),oV=be('<div class="flex items-center justify-center py-4"><div class="flex items-center gap-3 text-base-content/60"><div class="relative"><div class="w-6 h-6 border-2 border-primary/20 border-t-primary rounded-full animate-spin"></div> <div class="absolute inset-0 w-6 h-6 border-2 border-transparent border-t-primary/60 rounded-full animate-spin" style="animation-delay: -0.15s;"></div></div> <span class="text-sm">Loading more symbols…</span></div></div>'),iV=be('<div class="divide-y divide-base-300/20"><!> <!></div>'),rV=be('<div class="flex flex-col gap-6"><div class="relative"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-base-content/50 pointer-events-none"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <input type="text" class="w-full pl-12 pr-4 py-3 text-sm bg-base-100 border border-base-300/50 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200 placeholder:text-base-content/50" placeholder="Search symbols..."></div> <div class="relative rounded-lg overflow-hidden bg-base-100 border border-base-300/30"><div class="h-96 overflow-y-auto luxury-scrollbar svelte-1r1pdks"><!></div></div> <div class="flex justify-center items-center py-2 mt-1"><div class="group relative cursor-pointer"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse" style="animation-delay: 0.5s;"></div></div></div></div></div>'),aV=be("<div><!></div>");function lV(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(A,"$save",t),o=()=>Ml(c,"$keyword",t),r=()=>Ml(I,"$ctx",t);let a=bi(e,"show",15);const l=L5();let c=Th(""),f=_e(H([]));const u=50;let d=_e(u),h=_e(!1),p,v=null,x=_e(H([])),S=_e(-1),C=!1;const I=hd("ctx"),A=hd("save"),P=hd("datafeed"),T=6,j=new Set;Xr(()=>{if(a()){if(console.log("🔍 Modal opened! Available symbols:",n().allSymbols.length),console.log("🔍 Current symbol:",n().symbol),b(f,H(n().allSymbols)),b(d,u),b(S,-1),!C){C=!0;const se=n().symbol.shortName||n().symbol.ticker||"";c.set(se),qy().then(()=>{v&&(v.focus(),v.select())})}}else C=!1}),Xr(()=>{b(x,H(i(f).slice(0,i(d))))}),Xr(()=>{if(!a())return;const se=i(x).slice(0,T);if(se.length)for(const Ne of se)te(Ne)}),typeof window<"u"&&(window.testSymbolChange=()=>{if(n().allSymbols.length>0){const se=n().allSymbols[1];console.log("🧪 Testing symbol change to:",se),ie(se)}else console.log("🧪 No symbols available for testing")});function E(se){return se.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim()}function L(se){return E(se).split(/\s+/).filter(Boolean).map(Te=>Te[0]).join("")}function D(se,Ne){const Te=se.length,Me=Ne.length;if(Te===0)return Me;if(Me===0)return Te;const De=new Array(Me+1);for(let Oe=0;Oe<=Me;(Oe+=1)-1)De[Oe]=Oe;for(let Oe=1;Oe<=Te;(Oe+=1)-1){let Ke=Oe-1;De[0]=Oe;for(let kt=1;kt<=Me;(kt+=1)-1){const pt=De[kt],Rt=se[Oe-1]===Ne[kt-1]?0:1;De[kt]=Math.min(De[kt]+1,De[kt-1]+1,Ke+Rt),Ke=pt}}return De[Me]}function X(se,Ne){const Te=Math.max(se.length,Ne.length);return Te===0?1:1-D(se,Ne)/Te}function ne(se,Ne){if(!Ne||!Ne.trim())return se;const Me=E(Ne).split(/\s+/).filter(Boolean);return se.map(Oe=>{const Ke=Oe.ticker.toLowerCase(),kt=Oe.shortName||"";kt.toLowerCase();const pt=E(kt),Rt=pt.split(/\s+/).filter(Boolean),Ht=(Oe.exchange||"").toLowerCase(),Ft=L(kt);let zt=0,ut=0;for(const nt of Me){let Je=0;Ke===nt?Je+=1200:Ke.startsWith(nt)?Je+=800:Ke.includes(nt)?Je+=600:Ft===nt||Ft.startsWith(nt)?Je+=450:pt.startsWith(nt)?Je+=500:pt.includes(nt)?Je+=300:Ht.includes(nt)?Je+=80:de(Ke,nt)?Je+=60:de(pt,nt)&&(Je+=40);const it=X(Ke,nt);it>.5&&(Je+=Math.floor(it*300));let ze=0;for(const Ge of Rt){const xt=X(Ge,nt);if(xt>ze&&(ze=xt),ze>=.92)break}ze>.5&&(Je+=Math.floor(ze*200)),Je>0&&(ut+=1),zt+=Je}return ut===Me.length?zt+=100:zt+=ut*50,zt>0&&Ke.length<=5&&(zt+=20),{symbol:Oe,score:zt}}).filter(Oe=>Oe.score>0).sort((Oe,Ke)=>Ke.score!==Oe.score?Ke.score-Oe.score:Oe.symbol.ticker.localeCompare(Ke.symbol.ticker)).map(Oe=>Oe.symbol)}function de(se,Ne){let Te=0;for(let Me=0;Me<se.length&&Te<Ne.length;(Me+=1)-1)se[Me]===Ne[Te]&&(Te+=1);return Te===Ne.length}c.subscribe(se=>{if(!se||!se.trim()){b(f,H(n().allSymbols)),b(d,u),b(S,-1);return}b(f,H(ne(n().allSymbols,se))),b(d,u),b(S,-1)});function ie(se){try{te(se)}catch{}try{G6({logo:se.logo,logo2:se.logo2})}catch{}Fc(A,Ro(n).symbol=se,Ro(n)),a(!1)}function te(se){var Me,De,Oe,Ke,kt,pt,Rt,Ht;if(!P||!(se!=null&&se.ticker))return;const Ne=((De=(Me=n())==null?void 0:Me.period)==null?void 0:De.timeframe)||"1m",Te=`${se.ticker}|${Ne}`;if(!j.has(Te)){j.add(Te);try{(Oe=P.startBackgroundPrefetch)==null||Oe.call(P,se,{timeframe:Ne})}catch{}try{const Ft=Number(((kt=(Ke=n())==null?void 0:Ke.period)==null?void 0:kt.secs)||60)*1e3,zt=Date.now()-Ft*600;(Ht=(Rt=(pt=P.ensureHistoryBefore)==null?void 0:pt.call(P,se,Ne,zt))==null?void 0:Rt.catch)==null||Ht.call(Rt,()=>{})}catch{}}}async function le(){i(h)||i(d)>=i(f).length||(b(h,!0),await new Promise(se=>setTimeout(se,250)),b(d,H(Math.min(i(d)+u,i(f).length))),b(h,!1))}function pe(se){const Ne=se.currentTarget;Ne.scrollTop+Ne.clientHeight>=Ne.scrollHeight-24&&le()}var re=aV();re.__keydown=[Yz,a,x,S,ie];var xe=y(re);uv(xe,{title:l,width:650,maxHeight:"85vh",get show(){return a()},set show(se){a(se)},get theme(){return n().theme},buttons:[],children:(se,Ne)=>{var Te=rV(),Me=y(Te),De=m(y(Me),2);Ts(De),$6(De,!0),hp(De,pt=>v=pt,()=>v),_(Me);var Oe=m(Me,2),Ke=y(Oe),kt=y(Ke);Ve(kt,()=>r().loadingPairs,pt=>{var Rt=Kz();Y(pt,Rt)},pt=>{var Rt=Qs(),Ht=_s(Rt);Ve(Ht,()=>i(f).length===0,Ft=>{var zt=Xz();Y(Ft,zt)},Ft=>{var zt=iV(),ut=y(zt);qo(ut,17,()=>i(x),yi,(Je,it,ze)=>{var Ge=nV();Ge.__click=[Zz,ie,it];var xt=y(Ge),jt=y(xt);Ve(jt,()=>i(it).logo2,Es=>{var Ns=Jz(),Hs=_s(Ns),ns=y(Hs);_(Hs);var fs=m(Hs,2),Mn=y(fs);_(fs),we(()=>{Dt(ns,"src",`${i(it).logo}`),Dt(ns,"alt",i(it).ticker),Dt(Mn,"src",`${i(it).logo2}`),Dt(Mn,"alt",i(it).ticker)}),pd("error",ns,po=>{po.target.style.display="none"}),Nb(ns),pd("error",Mn,po=>{po.target.style.display="none"}),Nb(Mn),Y(Es,Ns)},Es=>{var Ns=Qz(),Hs=y(Ns),ns=m(Hs,2),fs=y(ns),Mn=y(fs,!0);we(()=>st(Mn,i(it).ticker.charAt(0))),_(fs),_(ns),_(Ns),we(()=>{Dt(Hs,"src",`${i(it).logo}`),Dt(Hs,"alt",i(it).ticker)}),pd("error",Hs,po=>{const Tn=po.target;if(Tn){Tn.style.display="none";const Cn=Tn.nextElementSibling;Cn&&(Cn.style.display="flex")}}),Nb(Hs),Y(Es,Ns)}),_(xt);var ft=m(xt,2),ke=y(ft),Se=y(ke),Et=y(Se,!0);_(Se);var wt=m(Se,2),Ls=y(wt,!0);_(wt);var tn=m(wt,2);Ve(tn,()=>i(it).type,Es=>{var Ns=eV(),Hs=y(Ns,!0);_(Ns),we(()=>st(Hs,i(it).type)),Y(Es,Ns)}),_(ke);var Gs=m(ke,2);Ve(Gs,()=>i(it).shortName&&i(it).shortName!==i(it).ticker,Es=>{var Ns=tV(),Hs=y(Ns,!0);_(Ns),we(()=>st(Hs,i(it).shortName)),Y(Es,Ns)}),_(ft);var an=m(ft,2);Ve(an,()=>i(S)===ze,Es=>{var Ns=sV();Y(Es,Ns)}),_(Ge),we(()=>{$i(Ge,`group flex items-center gap-3 px-4 py-3 cursor-pointer transition-all duration-200
                         ${(i(S)===ze?"bg-primary/10 text-primary border-l-2 border-primary":"hover:bg-base-200/50 text-base-content")??""}`),st(Et,i(it).ticker),st(Ls,i(it).exchange)}),pd("mouseenter",Ge,()=>te(i(it))),Y(Je,Ge)});var nt=m(ut,2);Ve(nt,()=>i(h),Je=>{var it=oV();Y(Je,it)}),_(zt),Y(Ft,zt)},!0),Y(pt,Rt)}),_(Ke),hp(Ke,pt=>p=pt,()=>p),_(Oe),Oi(2),_(Te),Fn(De,o,pt=>D6(c,pt)),pd("scroll",Ke,pe),Y(se,Te)},$$slots:{default:!0}}),_(re),Y(s,re),Kd()}$p(["keydown","click"]);var cV=(s,e,t)=>e(i(t)),uV=be('<li class="w-[140px] h-[85px] flex items-center justify-center cursor-pointer rounded-lg svelte-18wwyns"><span> </span></li>'),dV=be('<div class="p-2"><ul class="flex flex-wrap justify-center gap-2"></ul></div>');function fV(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(l,"$save",t),o=()=>Ml(c,"$isRenkoActive",t);let r=bi(e,"show",15);const a=T5(),l=hd("save"),c=pp(l,h=>{var p,v;return((v=(p=h.styles)==null?void 0:p.candle)==null?void 0:v.type)==="renko_atr"}),f=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600},{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400},{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}];function u(h){var p;Fc(l,Ro(n).period=h,Ro(n));try{const v=(p=n())!=null&&p.key&&typeof n().key=="string"?n().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${v}.lastTimeframe`,(h==null?void 0:h.timeframe)||"")}catch{}try{ax.set(h)}catch{}r(!1)}function d(h){switch(h){case"minute":return V5();case"hour":return W5();case"day":return H5();case"week":return q5();case"month":return U5();default:return h}}uv(s,{title:a,width:500,get show(){return r()},set show(h){r(h)},get theme(){return n().theme},buttons:[],children:(h,p)=>{var v=dV(),x=y(v);qo(x,21,()=>f,yi,(S,C)=>{var I=Qs(),A=_s(I);Ve(A,()=>!(o()&&i(C).timeframe==="4h"),P=>{var T=uV();T.__click=[cV,u,C];var j=y(T),E=y(j);we(()=>st(E,`${i(C).multiplier??""} ${d(i(C).timespan)??""}`)),_(j),_(T),we(()=>{var L,D,X;yr(T,"hover:bg-base-200",i(C).timeframe!==((L=n().period)==null?void 0:L.timeframe)),yr(T,"bg-primary",i(C).timeframe===((D=n().period)==null?void 0:D.timeframe)),yr(T,"text-primary-content",i(C).timeframe===((X=n().period)==null?void 0:X.timeframe))}),Y(P,T)}),Y(S,I)}),_(x),_(v),Y(h,v)},$$slots:{default:!0}}),Kd()}$p(["click"]);const pV=s=>s;function a4(s){const e=s-1;return e*e*e+1}function zk(s){const e=typeof s=="string"&&s.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[s,"px"]}function c_(s,{delay:e=0,duration:t=400,easing:n=pV}={}){const o=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:n,css:r=>`opacity: ${r*o}`}}function $1(s,{delay:e=0,duration:t=400,easing:n=a4,x:o=0,y:r=0,opacity:a=0}={}){const l=getComputedStyle(s),c=+l.opacity,f=l.transform==="none"?"":l.transform,u=c*(1-a),[d,h]=zk(o),[p,v]=zk(r);return{delay:e,duration:t,easing:n,css:(x,S)=>`
			transform: ${f} translate(${(1-x)*d}${h}, ${(1-x)*p}${v});
			opacity: ${c-u*S}`}}function hV(s,{delay:e=0,duration:t=400,easing:n=a4,axis:o="y"}={}){const r=getComputedStyle(s),a=+r.opacity,l=o==="y"?"height":"width",c=parseFloat(r[l]),f=o==="y"?["top","bottom"]:["left","right"],u=f.map(C=>`${C[0].toUpperCase()}${C.slice(1)}`),d=parseFloat(r[`padding${u[0]}`]),h=parseFloat(r[`padding${u[1]}`]),p=parseFloat(r[`margin${u[0]}`]),v=parseFloat(r[`margin${u[1]}`]),x=parseFloat(r[`border${u[0]}Width`]),S=parseFloat(r[`border${u[1]}Width`]);return{delay:e,duration:t,easing:n,css:C=>`overflow: hidden;opacity: ${Math.min(C*20,1)*a};${l}: ${C*c}px;padding-${f[0]}: ${C*d}px;padding-${f[1]}: ${C*h}px;margin-${f[0]}: ${C*p}px;margin-${f[1]}: ${C*v}px;border-${f[0]}-width: ${C*x}px;border-${f[1]}-width: ${C*S}px;`}}function lx(s){const e=s-1;return e*e*e+1}const m2={CURRENT_VERSION:1,DEFAULT_FUTURE_MARGIN_MS:30*60*1e3,MAX_FUTURE_MARGIN_MS:24*60*60*1e3,MIN_FUTURE_MARGIN_MS:5*60*1e3,DEFAULT_FUTURE_MARGIN_PERCENT:.2,TIMESTAMP_PRECISION:1,PRICE_PRECISION:1e-6};function db(s,e){try{const{chart:t,paneId:n="candle_pane"}=e,o={timestamp:s.t,value:s.p},r=t.convertToPixel(o,{paneId:n,absolute:!0});if(!r||typeof r!="object")return null;const a=Array.isArray(r)?r[0]:r;return!a||typeof a!="object"||typeof a.x!="number"||typeof a.y!="number"||!isFinite(a.x)||!isFinite(a.y)?null:{x:a.x,y:a.y}}catch(t){return console.error("Error converting data-space to screen-space:",t),null}}function mV(s,e,t){try{const{chart:n,paneId:o="candle_pane"}=e,r=n.convertFromPixel([s],{paneId:o});if(!r||!Array.isArray(r)||r.length===0||!r[0])return null;const a=r[0];return typeof a.timestamp!="number"||typeof a.value!="number"||!isFinite(a.timestamp)||!isFinite(a.value)?null:{id:t||vV(),t:Math.round(a.timestamp),p:a.value}}catch(n){return console.error("Error converting screen-space to data-space:",n),null}}function l4(s,e){const t=[];let n=!0,o=!0;for(const r of s){const a=db(r,e);if(!a){o=!1,t.push({x:0,y:0});continue}t.push(a),(a.x<-100||a.x>1e4||a.y<-100||a.y>1e4)&&(n=!1)}return{screenPoints:t,isVisible:n,isValid:o}}function Vk(s,e,t={}){var n,o,r,a,l;try{const c={minMarginMs:m2.MIN_FUTURE_MARGIN_MS,maxMarginMs:m2.MAX_FUTURE_MARGIN_MS,defaultMarginPercent:m2.DEFAULT_FUTURE_MARGIN_PERCENT,...t},f=e.getDataList();if(!f||f.length===0)return;const u=f[f.length-1],d=typeof(u==null?void 0:u.timestamp)=="number"?u.timestamp:null;if(!d||!isFinite(d))return;let h=Number.NEGATIVE_INFINITY;for(const te of s)typeof te.t=="number"&&isFinite(te.t)&&te.t>h&&(h=te.t);if(!Number.isFinite(h)||h<=d)return;const p=Math.max(0,h-d);if(p<=0)return;const v=e.getVisibleRange();let x=0;if(v&&f.length>1){const te=(n=f[Math.max(0,Math.min(f.length-1,v.from))])==null?void 0:n.timestamp,le=(o=f[Math.max(0,Math.min(f.length-1,v.to))])==null?void 0:o.timestamp;typeof te=="number"&&typeof le=="number"&&isFinite(te)&&isFinite(le)&&(x=Math.max(0,le-te))}const S=x>0?Math.floor(x*c.defaultMarginPercent):Math.floor(p*c.defaultMarginPercent),C=Math.min(Math.max(c.minMarginMs,S),c.maxMarginMs),I=Math.min(p+C,c.maxMarginMs),A=d+I,P=u.timestamp;if(P>=A)return;const T=[];for(let te=Math.max(0,f.length-10);te<f.length-1;te++){const le=(r=f[te])==null?void 0:r.timestamp,pe=(a=f[te+1])==null?void 0:a.timestamp;if(typeof le=="number"&&typeof pe=="number"){const re=pe-le;isFinite(re)&&re>0&&T.push(re)}}const j=T.length?T.sort((te,le)=>te-le)[Math.floor(T.length/2)]:6e4;if(!j||!isFinite(j)||j<=0)return;const E=Math.max(0,Math.ceil((A-P)/j));if(E<=0)return;const L=typeof(u==null?void 0:u.close)=="number"?u.close:typeof(u==null?void 0:u.open)=="number"?u.open:0,D=[];for(let te=1;te<=E;te++){const le=P+te*j;D.push({timestamp:le,open:L,high:L,low:L,close:L,volume:0})}const X=e.getVisibleRange(),ne=X?X.to>=f.length-2:!0,de=[...f,...D];e.applyNewData(de,!1);try{(de??[]).length>0&&(window.hasFirstDataLoaded=!0)}catch{}const ie=ne?de.length-1:X?X.to:de.length-1;try{e.scrollToDataIndex(ie)}catch{const te=(l=de[ie])==null?void 0:l.timestamp;if(typeof te=="number")try{e.scrollToTimestamp(te)}catch{}}}catch{}}function vV(){return`point_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}class gV{constructor(e){Pe(this,"chart");Pe(this,"context");this.chart=e,this.context={chart:e}}enhanceTemplate(e){const t={...e,originalTemplate:e,createPointFigures:n=>{var a,l;const{overlay:o,coordinates:r}=n;if(this.isDataSpaceOverlay(o)){const c=o,f=l4(c.points,this.context);return f.isValid?t.createDataSpaceFigures?t.createDataSpaceFigures({overlay:c,chart:this.chart,projectionResult:f,screenCoordinates:f.screenPoints}):((a=e.createPointFigures)==null?void 0:a.call(e,{...n,coordinates:f.screenPoints}))||[]:[]}if(t.createDataSpaceFigures){const c={screenPoints:r||[],isVisible:!0,isValid:Array.isArray(r)&&r.length>0};return t.createDataSpaceFigures({overlay:o,chart:this.chart,projectionResult:c,screenCoordinates:c.screenPoints})}return((l=e.createPointFigures)==null?void 0:l.call(e,n))||[]}};return t}createDataSpaceTemplate(e,t){const n={name:e,totalStep:t.totalStep,needDefaultPointFigure:t.needDefaultPointFigure??!0,needDefaultXAxisFigure:t.needDefaultXAxisFigure??!0,needDefaultYAxisFigure:t.needDefaultYAxisFigure??!0,styles:t.styles,onDrawStart:t.onDrawStart,onDrawing:t.onDrawing,onDrawEnd:t.onDrawEnd,onClick:t.onClick,onDoubleClick:t.onDoubleClick,onRightClick:t.onRightClick,onPressedMoveStart:t.onPressedMoveStart,onPressedMoving:t.onPressedMoving,onPressedMoveEnd:t.onPressedMoveEnd,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,onSelected:t.onSelected,onDeselected:t.onDeselected};return this.enhanceTemplate({...n,createDataSpaceFigures:t.createDataSpaceFigures})}isDataSpaceOverlay(e){return e&&typeof e=="object"&&"points"in e&&Array.isArray(e.points)&&e.points.length>0&&e.points.every(t=>t&&typeof t=="object"&&"t"in t&&"p"in t&&"id"in t&&typeof t.t=="number"&&typeof t.p=="number"&&typeof t.id=="string")}screenToDataSpace(e){return[]}updateChart(e){this.chart=e,this.context={chart:e}}}let Wk=null;function c4(s){return Wk=new gV(s),Wk}const M1={windowBars:120,horizons:[5,10,20],topK:200,stride:1,distance:"cosine",halfLifeBars:500,atrLen:14,rsiLen:14,adxLen:14,avwapAnchors:["sessionOpen","prevHigh","prevLow","swingHi","swingLo"],candidateSL:[.6,.8,1,1.25,1.5],useSwingStop:!1,minMatches:100,winsor:.98,bandAlpha:.22,showTable:!0,showBothDirections:!0},u4="npo_mae_settings_v1";function _V(){try{const s=localStorage.getItem(u4);if(!s)return{...M1};const e=JSON.parse(s);return{...M1,...e}}catch{return{...M1}}}function Hk(s){try{localStorage.setItem(u4,JSON.stringify(s))}catch{}}function yV(s,e){const t=e.windowBars;if(s.length<t)return new Float32Array;const n=s.length-t,o=s.slice(n),r=A=>{const P=[];for(let T=A;T<o.length;T++){const j=(o[T].close-o[T-A].close)/Math.max(1e-8,o[T-A].close);P.push(j)}return P},a=r(1),l=r(2),c=r(3),f=r(5),u=[];for(let A=0;A<o.length;A++){const P=e.atrLen,T=Math.max(0,A-P+1);let j=0,E=0;for(let L=T;L<=A;L++){const D=o[L].high,X=o[L].low;j+=Math.max(0,D-X),E++}u.push(j/Math.max(1,E))}const h=((A,P)=>{const T=[];for(let j=0;j<A.length;j++){const E=Math.max(0,j-P+1),L=A[E],D=A[j];T.push(D-L)}return T})(u,5),p=[];for(let A=0;A<o.length;A++){const P=o[A],T=Math.max(1e-8,P.high-P.low),j=Math.abs(P.close-P.open);p.push(j/T)}const v=[...a,...l,...c,...f,...u,...h,...p],x=v.reduce((A,P)=>A+P,0)/Math.max(1,v.length),S=Math.sqrt(v.reduce((A,P)=>A+Math.pow(P-x,2),0)/Math.max(1,v.length)),I=v.map(A=>(A-x)/(S>1e-8?S:1)).map(A=>Math.max(-5,Math.min(5,A)));return new Float32Array(I)}function cx(s){const e=s.getDataList();if(!e||e.length===0)return null;const t=e[e.length-1];return{timestamp:t.timestamp,price:t.close}}function bV(s,e,t,n="candle_pane"){try{const o=s.convertToPixel({timestamp:e,value:t},{paneId:n}),r=Array.isArray(o)?o[0]:o;return(r==null?void 0:r.y)??null}catch{return null}}function xV(s){try{const e=s.getSize(),t=s.getVisibleRange();if(!e||!t)return 4;const n=Math.max(1,t.to-t.from+1);return e.width/n}catch{return 4}}function wV(s){try{const e=s.getDataList();if(!e||e.length<2)return 0;const t=Math.min(10,e.length-1);let n=0;for(let r=e.length-t;r<e.length-1;r++){const a=e[r],l=e[r+1],c=Math.max(0,((l==null?void 0:l.timestamp)??0)-((a==null?void 0:a.timestamp)??0));n+=c}const o=n/Math.max(1,t);return isFinite(o)&&o>0?o:0}catch{return 0}}function kV(s){return c4(s).createDataSpaceTemplate("NearestPatternOutcomeMaeStop",{totalStep:1,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createDataSpaceFigures:({overlay:n,screenCoordinates:o,chart:r})=>{var ne,de,ie,te,le,pe;const a=[];if(o.length<1)return a;const l=o[0],c=n.extendData;if(!c)return a;const f=xV(r),u=cx(r);if(!u)return a;const d=u.timestamp,h=u.price,p=c.forwardPathMedianR||[],v=c.forwardPathP10R||[],x=c.forwardPathP90R||[],S=p.map(re=>h+re),C=v.map(re=>h+re),I=x.map(re=>h+re),A=c.bandAlpha??M1.bandAlpha,P=re=>bV(r,d,re),T=wV(r),j=(re,xe)=>{const se=d+(T>0?re*T:0);try{const Ne=r.convertToPixel({timestamp:se,value:xe},{paneId:"candle_pane"}),Te=Array.isArray(Ne)?Ne[0]:Ne,Me=(Te==null?void 0:Te.y)??P(xe);return{x:(Te==null?void 0:Te.x)??l.x+re*f,y:Me??l.y}}catch{const Ne=P(xe);return{x:l.x+re*f,y:Ne??l.y}}};if(S.length>0){const re=c.styles&&c.styles.median||{},xe=typeof re.size=="number"?re.size:1,se=typeof re.style=="string"?re.style:"solid";for(let Ne=0;Ne<S.length-1;Ne++){const Te=j(Ne,S[Ne]),Me=j(Ne+1,S[Ne+1]);a.push({type:"line",attrs:{coordinates:[Te,Me]},styles:{color:((ne=c.colors)==null?void 0:ne.median)||"#66c2a5",size:xe,style:se}})}}if(C.length>0&&I.length>0&&c.showOutcomeBand!==!1){const re=[];for(let se=0;se<I.length;se++)re.push(j(se,I[se]));for(let se=C.length-1;se>=0;se--)re.push(j(se,C[se]));const xe=c.colors&&c.colors.band||`rgba(102, 194, 165, ${A})`;a.push({type:"polygon",attrs:{coordinates:re},styles:{color:xe}})}const E=c.selectedSL,L=c.lastAtr,D=E&&typeof L=="number"?h-E*L:void 0;if(c.showStopLines!==!1&&typeof D=="number"){const re=P(D);if(re!=null){const xe=r.getSize(),se=(xe==null?void 0:xe.width)??0,Ne=c.styles&&c.styles.slLong||{},Te=typeof Ne.size=="number"?Ne.size:1,Me=typeof Ne.style=="string"?Ne.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:re},{x:se,y:re}]},styles:{color:((de=c.colors)==null?void 0:de.slLong)||"#e67e22",style:Me,size:Te}});const De=(D??0).toFixed(2);a.push({type:"text",attrs:{x:se-4,y:re,text:`SL L ${De}`},styles:{color:((ie=c.colors)==null?void 0:ie.slLong)||"#e67e22",backgroundColor:"transparent",align:"right",size:11}})}}const X=E&&typeof L=="number"?h+E*L:void 0;if(c.showStopLines!==!1&&typeof X=="number"){const re=P(X);if(re!=null){const xe=r.getSize(),se=(xe==null?void 0:xe.width)??0,Ne=c.styles&&c.styles.slShort||{},Te=typeof Ne.size=="number"?Ne.size:1,Me=typeof Ne.style=="string"?Ne.style:"dashed";a.push({type:"line",attrs:{coordinates:[{x:0,y:re},{x:se,y:re}]},styles:{color:((te=c.colors)==null?void 0:te.slShort)||"#c0392b",style:Me,size:Te}});const De=(X??0).toFixed(2);a.push({type:"text",attrs:{x:se-4,y:re,text:`SL S ${De}`},styles:{color:((le=c.colors)==null?void 0:le.slShort)||"#c0392b",backgroundColor:"transparent",align:"right",size:11}})}}if(c.showTable&&Array.isArray(c.evTable)){const re=r.getSize(),xe=(re==null?void 0:re.width)??0,se=240,Ne=10,Te=10,Me=18,De=Math.min(c.evTable.length,6),Oe=20,Ke=Te*2+Oe+De*Me,kt=12,Rt=Math.max(kt,xe-se-kt-80),Ht=10,Ft=typeof document<"u"&&((pe=document==null?void 0:document.documentElement)==null?void 0:pe.getAttribute("data-theme"))||"",zt=String(Ft).toLowerCase().includes("dark"),ut=zt?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)",nt=zt?"rgba(140,160,220,0.35)":"rgba(80,100,160,0.35)",Je=zt?"rgba(28,34,50,0.90)":"rgba(232,236,250,0.90)",it=zt?"#a7b3d8":"#415277",ze=zt?"#cfd6ee":"#1f2937";a.push({type:"rect",attrs:{x:Rt,y:Ht,width:se,height:Ke},styles:{style:"fill",color:ut}}),a.push({type:"rect",attrs:{x:Rt,y:Ht,width:se,height:Ke},styles:{style:"stroke",color:nt,borderSize:1,borderStyle:"solid"}});const Ge=se-Ne*2,xt=Se=>Math.min(Rt+se-Ne-4,Se),jt={mark:xt(Rt+Ne),side:xt(Rt+Ne+12),mult:xt(Rt+Ne+Ge*.1),ev:xt(Rt+Ne+Ge*.35),pwin:xt(Rt+Ne+Ge*.55),winr:xt(Rt+Ne+Ge*.72),lossr:xt(Rt+Ne+Ge*.88)};let ft=Ht+Te+2;a.push({type:"rect",attrs:{x:Rt+1,y:Ht+1,width:se-2,height:Oe},styles:{style:"fill",color:Je}}),a.push({type:"text",attrs:{x:jt.mult,y:ft,text:"SL"},styles:{color:it,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.ev,y:ft,text:"EV"},styles:{color:it,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.pwin,y:ft,text:"pWin"},styles:{color:it,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.winr,y:ft,text:"winR"},styles:{color:it,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.lossr,y:ft,text:"lossR"},styles:{color:it,size:12,backgroundColor:"transparent"}}),ft+=Oe-6;for(let Se=0;Se<De;Se++){const Et=c.evTable[Se],wt=c.selectedSL===Et.mult;a.push({type:"text",attrs:{x:jt.mark,y:ft,text:wt?"▶":"•"},styles:{color:ze,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.side,y:ft,text:Et.side==="long"?"L":"S"},styles:{color:ze,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.mult,y:ft,text:`${Et.mult.toFixed(2)}×`},styles:{color:ze,size:12,backgroundColor:"transparent"}});const Ls=`${Et.ev>=0?"+":""}${Et.ev.toFixed(2)}`;a.push({type:"text",attrs:{x:jt.ev,y:ft,text:Ls},styles:{color:ze,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.pwin,y:ft,text:`${Math.round(Et.pWin*100)}%`},styles:{color:ze,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.winr,y:ft,text:Et.avgWinR.toFixed(2)},styles:{color:ze,size:12,backgroundColor:"transparent"}}),a.push({type:"text",attrs:{x:jt.lossr,y:ft,text:Et.avgLossR.toFixed(2)},styles:{color:ze,size:12,backgroundColor:"transparent"}}),ft+=Me}const ke=(()=>{const Se=c.selectedSide;return c.evTable.find(wt=>wt.mult===c.selectedSL&&(!Se||wt.side===Se))||c.evTable.find(wt=>wt.mult===c.selectedSL)||null})();if(ke){const Et=Ht+Ke+6,wt=86,Ls=ke.side==="long"?"Long":"Short",tn=`${ke.mult.toFixed(2)}× ATR`,Gs=h.toFixed(2),an=(ke.side==="long"?h-ke.mult*(L??0):h+ke.mult*(L??0)).toFixed(2),Es=Math.round((ke.pWin??0)*100);a.push({type:"rect",attrs:{x:Rt,y:Et,width:se,height:wt},styles:{style:"fill",color:zt?"rgba(16,20,30,0.85)":"rgba(245,247,255,0.95)"}}),a.push({type:"rect",attrs:{x:Rt,y:Et,width:se,height:wt},styles:{style:"stroke",color:nt,borderSize:1,borderStyle:"solid"}});let Ns=Et+8+2;a.push({type:"text",attrs:{x:Rt+8,y:Ns,text:`Active: ${Ls}`},styles:{color:it,size:12,backgroundColor:"transparent"}}),Ns+=18,a.push({type:"text",attrs:{x:Rt+8,y:Ns,text:`Anchor: ${Gs}`},styles:{color:ze,size:12,backgroundColor:"transparent"}}),Ns+=18,a.push({type:"text",attrs:{x:Rt+8,y:Ns,text:`Stop: ${an} (${tn})`},styles:{color:ze,size:12,backgroundColor:"transparent"}}),Ns+=18,a.push({type:"text",attrs:{x:Rt+8,y:Ns,text:`pWin ${Es}% • winR ${ke.avgWinR.toFixed(2)} • lossR ${ke.avgLossR.toFixed(2)}`},styles:{color:ze,size:12,backgroundColor:"transparent"}});const Hs=Math.abs(h-(ke.side==="long"?h-ke.mult*(L??0):h+ke.mult*(L??0))),ns=x.length&&v.length?Math.max(0,(x[0]??0)-(v[0]??0)):0,fs=ns<=1,Mn=ns>=2,po=ke.side==="long"&&(ke.ev??0)>=.15&&(ke.pWin??0)>=.52&&!Mn,Tn=ke.side==="short"&&(ke.ev??0)>=.1&&(ke.pWin??0)>=.5&&!Mn,Cn=po?"BUY":Tn?"SELL":"WAIT",go=po?"#10b981":Tn?"#ef4444":zt?"#f59e0b":"#b45309",no=Et+wt+6,Bo=74,Vo=zt?"rgba(20,24,32,0.85)":"rgba(240,244,255,0.95)";a.push({type:"rect",attrs:{x:Rt,y:no,width:se,height:Bo},styles:{style:"fill",color:Vo}}),a.push({type:"rect",attrs:{x:Rt,y:no,width:se,height:Bo},styles:{style:"stroke",color:nt,borderSize:1,borderStyle:"solid"}});let Rl=no+8+2;a.push({type:"text",attrs:{x:Rt+8,y:Rl,text:`Action: ${Cn}`},styles:{color:go,size:13,backgroundColor:"transparent"}}),Rl+=18;const aa=fs?"Band: Narrow":Mn?"Band: Wide":"Band: Normal",tl=`1R: ${Hs.toFixed(2)}`,Zr=po?"EV≥0.30, pWin≥55%":Tn?"EV≥0.20, pWin≥50%":"Low EV / Wide band / Low pWin";a.push({type:"text",attrs:{x:Rt+8,y:Rl,text:`${aa} • ${tl}`},styles:{color:ze,size:12,backgroundColor:"transparent"}}),Rl+=18,a.push({type:"text",attrs:{x:Rt+8,y:Rl,text:Zr},styles:{color:it,size:12,backgroundColor:"transparent"}})}}return a},onClick:n=>{var c;const o=n.overlay.extendData;if(!o||!Array.isArray(o.evTable))return!0;const a=(o.evTable.findIndex(f=>f.mult===o.selectedSL)+1)%o.evTable.length,l=o.evTable[a];return l&&(o.selectedSL=l.mult,o.selectedSide=l.side,(c=n.chart)==null||c.overrideOverlay({id:n.overlay.id,extendData:o})),!0}})}function SV(){return new Worker(new URL(""+new URL("../workers/npoMae.worker-DaGdsbjp.js",import.meta.url).href,import.meta.url),{type:"module"})}function CV(s,e){const t=kV(s);o5(t);let n={..._V()},o=null,r=!0,a=SV(),l=0,c=-1,f=0,u=!0,d=!0;function h(){var P;if(!o){const T=cx(s),j=T?[{timestamp:T.timestamp,value:T.price}]:[],E=s.createOverlay({name:"NearestPatternOutcomeMaeStop",points:j});o=Array.isArray(E)?(E==null?void 0:E[0])??null:E,p();try{const L=ag(),D=((P=L==null?void 0:L.getCurrentSymbol)==null?void 0:P.call(L))||null;L&&D&&o&&L.addDrawing({id:o,symbolKey:D,type:"NearestPatternOutcomeMaeStop",points:T?[{time:T.timestamp,price:T.price}]:[],styles:{},visible:!0})}catch{}}}function p(){var T,j;if(!o)return;const P=cx(s);if(P)try{const E=(T=s.getOverlays)==null?void 0:T.call(s,{id:o}),L=Array.isArray(E)&&E.length>0?E[0]:null,D=(j=L==null?void 0:L.points)==null?void 0:j[0],X=(D==null?void 0:D.timestamp)??(D==null?void 0:D.time)??(D==null?void 0:D.t),ne=(D==null?void 0:D.value)??(D==null?void 0:D.price)??(D==null?void 0:D.p);if(typeof X!="number"||typeof ne!="number"||X!==P.timestamp||Math.abs(ne-P.price)>1e-6){s.overrideOverlay({id:o,points:[{timestamp:P.timestamp,value:P.price}]});try{const ie=ag();ie&&o&&ie.updateDrawing(o,{points:[{time:P.timestamp,price:P.price}]})}catch{}}}catch{}}function v(P){if(!o)return;const T={...P,bandAlpha:n.bandAlpha,showTable:n.showTable,showStopLines:d,showOutcomeBand:u};f&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{s.overrideOverlay({id:o,extendData:T});try{const j=ag();j&&o&&j.updateDrawing(o,{extendData:T})}catch{}})}function x(){if(!r||!a)return;p();const P=s.getDataList();if(!P||P.length<Math.max(n.windowBars+Math.max(...n.horizons),10)){v({forwardPathMedian:[],forwardPathP10:[],forwardPathP90:[],evTable:[],suggestedSL:null});return}const T=P.map(D=>({time:D.timestamp,open:D.open,high:D.high,low:D.low,close:D.close,volume:D.volume})),j=yV(T,n),E=++l;c=E;const L={id:E,settings:n,features:j,bars:T};a.postMessage(L,[j.buffer])}function S(P){var X,ne;const T=P.data;if(!T||T.id!==c)return;const j=Math.max(...n.horizons),E=T.byHorizon[j];if(!E)return;const L=T.slSuggest||{},D=IV(s,n.atrLen);v({forwardPathMedianR:E.forwardPathMedian,forwardPathP10R:E.forwardPathP10,forwardPathP90R:E.forwardPathP90,evTable:L.evTable||[],selectedSL:((X=L.long)==null?void 0:X.mult)??((ne=L.short)==null?void 0:ne.mult),selectedSide:L.long?"long":L.short?"short":void 0,lastAtr:D})}a&&(a.onmessage=S),h(),x();const C=window.setInterval(()=>{h(),x()},500),I=P=>{P.key==="O"||P.key==="o"?(u=!u,v({})):(P.key==="S"||P.key==="s")&&(d=!d,v({}))};return window.addEventListener("keydown",I,{capture:!0}),{setEnabled(P){r=P,r&&x()},updateSettings(P){n={...n,...P},Hk(n),x()},setShowOutcomeBand(P){u=P,v({})},setShowStopLines(P){d=P,v({})},setColors(P){v({colors:P})},setStyles(P){v({styles:P})},resetSettings(){n={...M1},Hk(n),x()},getOverlayId(){return o},dispose(){if(window.removeEventListener("keydown",I,{capture:!0}),window.clearInterval(C),a&&(a.terminate(),a=null),o)try{s.removeOverlay({id:o})}catch{}}}}function IV(s,e){const t=s.getDataList();if(!t||t.length===0)return 1;const n=Math.min(e,t.length);let o=0;for(let r=t.length-n;r<t.length;r++){const a=t[r].high,l=t[r].low;o+=Math.max(0,a-l)}return o/Math.max(1,n)}var PV=(s,e)=>b(e,""),MV=be('<button class="absolute right-4 top-1/2 transform -translate-y-1/2 hover:scale-110 transition-all duration-300 z-10 clear-search-btn svelte-e5btcs" title="Clear search"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button>'),NV=(s,e,t,n)=>!i(e)&&t(i(n).is_main,i(n).name),AV=(s,e)=>{s.stopPropagation(),b(e,!0)},TV=be('<button class="w-8 h-8 rounded-full ml-2 opacity-0 group-hover:opacity-100 hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm info-btn svelte-e5btcs" title="How it works"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></button>'),FV=(s,e,t)=>{s.stopPropagation(),e(i(t).name)},LV=(s,e,t)=>{s.stopPropagation(),e(i(t).name)},EV=be('<div class="flex items-center gap-2 ml-4 opacity-100 transition-all duration-300 svelte-e5btcs"><button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm edit-btn svelte-e5btcs" title="Edit Parameters"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" class="svelte-e5btcs"></path></svg></button> <button class="w-8 h-8 rounded-full hover:scale-110 transition-all duration-300 flex items-center justify-center backdrop-blur-sm delete-btn svelte-e5btcs" title="Remove Indicator"><svg class="w-3.5 h-3.5 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-e5btcs"></path></svg></button></div>'),$V=be('<div><div></div> <div class="flex-1 min-w-0 svelte-e5btcs"><span> </span></div> <!> <!></div>'),DV=be('<div class="flex flex-col items-center justify-center py-16 text-center svelte-e5btcs"><div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mb-4 svelte-e5btcs"><svg class="w-8 h-8 text-base-content/40 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <p class="text-lg font-semibold text-base-content/60 mb-2 svelte-e5btcs">No indicators found</p> <p class="text-sm text-base-content/40 svelte-e5btcs">Try a different search term</p></div>'),RV=be(`<div class="flex flex-col gap-6 svelte-e5btcs"><div><div class="absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none z-10 transition-all duration-300 search-icon svelte-e5btcs"><svg class="w-4 h-4 svelte-e5btcs" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-e5btcs"></path></svg></div> <input type="text" class="w-full pl-12 pr-12 py-3.5 text-[15px] font-medium tracking-wide backdrop-blur-sm rounded-2xl
               focus:outline-none transition-all duration-500 ease-out
               placeholder:font-normal search-input svelte-e5btcs"> <!></div> <div class="relative rounded-2xl overflow-hidden backdrop-blur-sm indicator-list-container svelte-e5btcs"><div class="indicator-scroll ultra-minimal-scrollbar svelte-e5btcs"><!> <!></div></div> <div class="flex justify-center items-center py-2 mt-1 svelte-e5btcs"><div class="group relative cursor-pointer svelte-e5btcs"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-700 ease-out blur-xl svelte-e5btcs"></div> <div class="relative flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-base-100/80 to-base-200/60 backdrop-blur-sm border border-base-300/30 shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-500 ease-out svelte-e5btcs"><div class="w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse svelte-e5btcs"></div> <span class="text-sm font-medium text-base-content/70 group-hover:text-primary transition-colors duration-300 svelte-e5btcs">Powered by</span> <span class="text-sm font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent group-hover:from-secondary group-hover:to-primary transition-all duration-500 svelte-e5btcs">Duty AI</span> <div class="w-2 h-2 rounded-full bg-gradient-to-r from-secondary to-primary animate-pulse svelte-e5btcs" style="animation-delay: 0.5s;"></div></div></div></div></div>`),jV=(s,e)=>b(e,!1),BV=(s,e)=>b(e,"bn"),OV=(s,e)=>b(e,"en"),zV=(s,e)=>b(e,!1),VV=be(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">খুব সহজ ব্যাখ্যা</div> <p class="text-sm text-base-content/70 svelte-e5btcs">মনে করুন আপনি আগের দিনের ছবি দেখে আজকের দিনের কথা অনুমান করছেন।
                এই ইন্ডিকেটরটি ঠিক তেমনই করে—এখনকার দামের সঙ্গে খুব মিল‑থাকা
                আগের প্যাটার্ন খুঁজে নেয়, তাদের পথ ধরে সামনে কী হতে পারে তা
                অনুমান করে, আর অতীতে কতটা উল্টো দিকে গেছে সেটাকে ধরে নিরাপদ
                থামার জায়গা (স্টপ‑লস) বলে দেয়।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">উদাহরণ: ধরুন আজকের দামের গতি অনেকটা গত মাসের ১৫ তারিখের মতো।
                ইন্ডিকেটরটি তখন গত মাসের ১৫ তারিখের পরের দিনগুলো কী হয়েছিল সেটা
                দেখে আজকের পরের দিনগুলোর জন্য অনুমান করে।</p> <p class="text-sm text-base-content/70 svelte-e5btcs">চার্টে রঙের ব্যান্ডটি P10–P90 প্রত্যাশিত রেঞ্জ বোঝায়—মানে ১০০‑এর
                মধ্যে ৮০ বার দাম এই সীমার মধ্যে থাকতে পারে। মাঝের রেখাটি মাঝের
                রাস্তা (মিডিয়ান পথ)—দাম সাধারণত এই পথ ধরে চলতে পারে। আর ড্যাশড
                লাইনগুলো লং/শর্টের স্টপ—এগুলোতে পৌঁছালে থামার সংকেত।</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">চার্ট উপাদান</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">মাঝের রাস্তা: দাম সাধারণত কোন পথে যেতে পারে তার মাঝের লাইন।</li> <li class="svelte-e5btcs">রঙের ব্যান্ড: সম্ভাব্য ওঠা‑নামার এলাকা (P10–P90)। সরু মানে
                  পরিষ্কার পথ, প্রশস্ত মানে বেশি অনিশ্চয়তা।</li> <li class="svelte-e5btcs">স্টপের দাগ: লং/শর্টের প্রস্তাবিত স্টপ‑লসের ড্যাশড লাইন।</li> <li class="svelte-e5btcs">ইভি টেবিল: কোন স্টপ নিলে মোটের উপর লাভ‑ক্ষতি কেমন হতে পারে তা
                  দেখায়।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ওভারলে প্যানেলগুলো</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">তথ্য প্যানেল</span>: <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (বর্তমান
                  দাম), <span class="font-medium svelte-e5btcs">Stop</span> (SL মূল্য ও ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span> দেখায়—সিদ্ধান্তের জন্য দ্রুত
                  প্রেক্ষাপট দেয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">সিদ্ধান্ত প্যানেল</span>: বড় অক্ষরে <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> দেখায়। সঙ্গে <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> দূরত্ব ও <span class="font-medium svelte-e5btcs">শর্তের সারাংশ</span> দেখায়। <br class="svelte-e5btcs">BUY (লং): EV ≥ 0.30 ও pWin ≥ 55%, ব্যান্ড Wide না হলে। <br class="svelte-e5btcs">SELL (শর্ট): EV ≥ 0.20 ও pWin ≥ 50%, ব্যান্ড Wide না
                  হলে। <br class="svelte-e5btcs">অন্যথা: WAIT।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ইভি টেবিল (উদাহরণ)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">পজিশন</th><th class="svelte-e5btcs">এসএল (×এটিআর)</th><th class="svelte-e5btcs">ইভি (আর)</th><th class="svelte-e5btcs">জেতার সম্ভাবনা (%)</th><th class="svelte-e5btcs">উইন R</th><th class="svelte-e5btcs">লস R</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">লং</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">শর্ট</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি: মোটের উপর গড় প্রত্যাশা। জেতা‑হারা দুটো মিলিয়ে ফল কেমন
                  হবে।</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা (%): ১০০‑এর মধ্যে সংখ্যা। যত বেশি, জেতার
                  সম্ভাবনা তত বেশি।</li> <li class="svelte-e5btcs">উইন R ও লস R: জিতলে আনুমানিক কত, হারলে আনুমানিক কত। ভারসাম্য
                  দেখুন।</li> <li class="svelte-e5btcs">ইভি ≥ 0 হলে সারি বিবেচনা করুন; ইভি যত বেশি, মোট প্রত্যাশা তত
                  ভালো।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টেবিলের ▶ চিহ্ন (অ্যারো) কীভাবে কাজ করে</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">টেবিলের সারিতে ▶ দেখায় কোন এসএল মাল্টিপ্লায়ার এখন সক্রিয়।
                  ভেতরে ক্লিক করলে ▶ পরের সারিতে যায়।</li> <li class="svelte-e5btcs">▶ যে সারিতে থাকে, সেই সারির <span class="font-medium svelte-e5btcs">SL (×ATR)</span> অনুযায়ী চার্টের ড্যাশড স্টপ‑লাইন আপডেট হয়।</li> <li class="svelte-e5btcs">▶ যদি লং সারিতে থাকে: সিদ্ধান্ত লং বায়াসে ভাবুন; স্টপ সাধারণত
                  বর্তমান দামের নিচে (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">▶ যদি শর্ট সারিতে থাকে: সিদ্ধান্ত শর্ট বায়াসে ভাবুন; স্টপ
                  সাধারণত বর্তমান দামের উপরে (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">সেরা নির্বাচন: ▶ কে এমন সারিতে রাখুন যেখানে <span class="font-medium svelte-e5btcs">EV পজিটিভ</span>, <span class="font-medium svelte-e5btcs">pWin বেশি</span>, আর <span class="font-medium svelte-e5btcs">lossR নিয়ন্ত্রণে</span> থাকে।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (শর্ট)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ শর্ট সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1.5 × ATR</span> উপরে। দূর স্টপ → কম
                    স্টপ‑হিট; কিন্তু রিস্ক ইউনিট বড় হয়।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> মানে জিতলে গড় লাভ <span class="font-medium svelte-e5btcs">1.71R</span>। যদি 1R = 100 টাকা
                    রিস্ক ধরেন, জিতলে গড়ে 171 টাকা।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> মানে হারলে গড়
                    ক্ষতি <span class="font-medium svelte-e5btcs">1.46R</span> ≈ 146 টাকা।</li> <li class="svelte-e5btcs">সিদ্ধান্ত: pWin যদি ~55% হয়, তাহলে <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → গ্রহণযোগ্য।</li> <li class="svelte-e5btcs">যদি pWin 45%‑এর নিচে নামে বা lossR বেশি হয়, ▶ অন্য সারিতে
                    সরান (কম SL বা ভালো EV)।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">অ্যারো উদাহরণ (লং)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">ধরুন ▶ লং সারিতে আছে এবং <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>।</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> মানে স্টপ দূরত্ব <span class="font-medium svelte-e5btcs">1 × ATR</span> নিচে। কাছের স্টপ → ঝুঁকি
                    ছোট; কিন্তু স্টপ‑হিট হতে পারে বেশি।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> মানে জিতলে গড় লাভ
                    1.40R।</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> মানে হারলে গড় ক্ষতি
                    0.90R।</li> <li class="svelte-e5btcs">pWin যদি ~60% হয়, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → শক্ত সিদ্ধান্ত।</li> <li class="svelte-e5btcs">যদি ব্যান্ড খুব প্রশস্ত বা pWin কম হয়, ▶ কে এমন সারিতে নিন
                    যেখানে EV পজিটিভ ও lossR নিয়ন্ত্রিত।</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">ব্যান্ড ভিত্তিক সিদ্ধান্ত</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ব্যান্ড সরু: পথ পরিষ্কার—আত্মবিশ্বাস একটু বাড়ানো যেতে পারে।</li> <li class="svelte-e5btcs">ব্যান্ড প্রশস্ত: অনিশ্চয়তা বেশি—সাইজ কমান বা একটু অপেক্ষা
                  করুন।</li> <li class="svelte-e5btcs">ব্যান্ড যদি বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে যায়: সতর্ক
                  থাকুন, স্টপ দূরে রাখুন।</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">উদাহরণ</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">লং বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা উপরে দিকে। ইভি +0.30→+0.60, জেতার সম্ভাবনা
                    55–65%। এসএল 1.0×–1.25× নিলে সাধারণত জেতার সম্ভাবনা ও লস
                    R‑এর মধ্যে ভালো ভারসাম্য থাকে।</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">শর্ট বায়াস</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">মাঝের রাস্তা নিচের দিকে। শর্ট ইভি +0.20→+0.45। ব্যান্ড যদি
                    আগের নিচু জায়গার সঙ্গে মিলে যায়, এসএল 0.8×–1.0× নিলে সতর্ক
                    এন্ট্রির জন্য ভালো হয়।</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন কিনবেন/বিক্রি করবেন</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">কিনবেন কখন (লং)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">ইভি +0.30 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 55% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে (পরিষ্কার পথ)</li> <li class="svelte-e5btcs">মাঝের রাস্তা উপরের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 1.0×–1.25× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.45, pWin 62%, ব্যান্ড সরু → কিনুন</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">বিক্রি করবেন কখন (শর্ট)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">শর্ট ইভি +0.20 বা তার বেশি হলে</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 50% বা তার বেশি হলে</li> <li class="svelte-e5btcs">ব্যান্ড সরু হলে</li> <li class="svelte-e5btcs">মাঝের রাস্তা নিচের দিকে হলে</li> <li class="svelte-e5btcs">স্টপ-লস 0.8×–1.0× ATR হলে</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">উদাহরণ: ইভি +0.25, pWin 54%, ব্যান্ড সরু → বিক্রি করুন</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">কখন অপেক্ষা করবেন</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">ইভি নেগেটিভ হলে (−0.10 বা তার কম)</li> <li class="svelte-e5btcs">ব্যান্ড খুব প্রশস্ত হলে (অনিশ্চয়তা বেশি)</li> <li class="svelte-e5btcs">জেতার সম্ভাবনা 45% এর কম হলে</li> <li class="svelte-e5btcs">ব্যান্ড বড় সাপোর্ট/রেজিস্ট্যান্সের সঙ্গে মিলে গেলে</li> <li class="svelte-e5btcs">winR/lossR ভারসাম্য খারাপ হলে (winR ≤ 1.0 বা lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">উদাহরণ: ইভি −0.15, pWin 42%, ব্যান্ড প্রশস্ত → অপেক্ষা করুন</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">টিপস</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">এডিট পপআপে গিয়ে ব্যান্ডের রং, অপাসিটি ও লাইনের স্টাইল বদলাতে
                  পারেন।</li> <li class="svelte-e5btcs">ইভি টেবিলে ক্লিক করলে স্টপ পাল্টায়; চার্টের ড্যাশড লাইনও সাথে
                  সাথে বদলে যায়।</li> <li class="svelte-e5btcs">ট্রেন্ড ফিল্টার বা ভলিউমের সঙ্গে জোড়া দিলে সিদ্ধান্ত আরও শক্ত
                  হয়।</li> <li class="svelte-e5btcs">রিস্ক ম্যানেজমেন্ট: এক ট্রেডে 1–2% এর বেশি রিস্ক নেবেন না</li> <li class="svelte-e5btcs">কনফার্মেশন: ক্যান্ডেলস্টিক প্যাটার্ন বা ইন্ডিকেটর কনফার্মেশন
                  নিন</li></ul></div>`,1),WV=be(`<div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Simple Explanation</div> <p class="text-sm text-base-content/70 svelte-e5btcs">Think of it like looking at old pictures to guess today’s story.
                The indicator finds past patterns that look very similar to now,
                follows their path to estimate what might happen next, and uses
                historical MAE to suggest a safe place to stop (stop‑loss). The
                colored band is the expected range (P10–P90), the middle line is
                the median path, and the dashed lines are suggested long/short
                stops.</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Chart Elements</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Middle road: the central line showing the likely path.</li> <li class="svelte-e5btcs">Colored band: the area where price may move (P10–P90). Narrow
                  means clearer path; wide means more uncertainty.</li> <li class="svelte-e5btcs">Stop marks: dashed lines for suggested long/short stops.</li> <li class="svelte-e5btcs">EV table: shows overall gain‑loss balance for different stops.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Overlay Panels</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Info Panel</span>: shows <span class="font-medium svelte-e5btcs">Active</span> (Long/Short), <span class="font-medium svelte-e5btcs">Anchor</span> (current
                  price), <span class="font-medium svelte-e5btcs">Stop</span> (SL price and
                  ×ATR), <span class="font-medium svelte-e5btcs">pWin</span>, <span class="font-medium svelte-e5btcs">winR</span>, <span class="font-medium svelte-e5btcs">lossR</span>—quick context for
                  decisions.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">Decision Panel</span>: prominently
                  displays <span class="font-medium svelte-e5btcs">Action: BUY/SELL/WAIT</span> with <span class="font-medium svelte-e5btcs">Band</span> (Narrow/Normal/Wide), <span class="font-medium svelte-e5btcs">1R</span> distance, and <span class="font-medium svelte-e5btcs">criteria summary</span>. <br class="svelte-e5btcs">BUY (Long): EV ≥ 0.30 and pWin ≥ 55%, band not Wide. <br class="svelte-e5btcs">SELL (Short): EV ≥ 0.20 and pWin ≥ 50%, band not Wide. <br class="svelte-e5btcs">Otherwise: WAIT.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">EV Table (Example)</div> <div class="overflow-x-auto svelte-e5btcs"><table class="table table-xs svelte-e5btcs"><thead class="svelte-e5btcs"><tr class="svelte-e5btcs"><th class="svelte-e5btcs">Side</th><th class="svelte-e5btcs">SL (×ATR)</th><th class="svelte-e5btcs">EV (R)</th><th class="svelte-e5btcs">pWin (%)</th><th class="svelte-e5btcs">winR</th><th class="svelte-e5btcs">lossR</th></tr></thead><tbody class="svelte-e5btcs"><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">+0.45</td><td class="svelte-e5btcs">62</td><td class="svelte-e5btcs">1.60</td><td class="svelte-e5btcs">0.95</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">L</td><td class="svelte-e5btcs">1.25×</td><td class="svelte-e5btcs">+0.30</td><td class="svelte-e5btcs">68</td><td class="svelte-e5btcs">1.35</td><td class="svelte-e5btcs">0.80</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">0.80×</td><td class="svelte-e5btcs">+0.20</td><td class="svelte-e5btcs">54</td><td class="svelte-e5btcs">1.10</td><td class="svelte-e5btcs">0.85</td></tr><tr class="svelte-e5btcs"><td class="svelte-e5btcs">S</td><td class="svelte-e5btcs">1.00×</td><td class="svelte-e5btcs">−0.05</td><td class="svelte-e5btcs">48</td><td class="svelte-e5btcs">1.20</td><td class="svelte-e5btcs">1.10</td></tr></tbody></table></div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV: the overall expectancy—combines win and loss outcomes.</li> <li class="svelte-e5btcs">pWin (%): out of 100. Higher means better chance to win.</li> <li class="svelte-e5btcs">winR and lossR: how much you might win or lose. Balance them.</li> <li class="svelte-e5btcs">If EV ≥ 0, consider the row; higher EV means better overall
                  expectancy.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">How the ▶ arrow works</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">The ▶ in the table marks the <span class="font-medium svelte-e5btcs">active SL multiplier</span>. Click inside the table to move it to the next row.</li> <li class="svelte-e5btcs">Where ▶ sits, the chart’s dashed stop‑lines update using that
                  row’s <span class="font-medium svelte-e5btcs">SL (×ATR)</span>.</li> <li class="svelte-e5btcs">If ▶ is on a Long row: think with a long bias; the stop is
                  usually below current price (<span class="font-medium svelte-e5btcs">anchor − mult × ATR</span>).</li> <li class="svelte-e5btcs">If ▶ is on a Short row: think with a short bias; the stop is
                  usually above current price (<span class="font-medium svelte-e5btcs">anchor + mult × ATR</span>).</li> <li class="svelte-e5btcs">Best practice: place ▶ on rows with <span class="font-medium svelte-e5btcs">positive EV</span>, <span class="font-medium svelte-e5btcs">higher pWin</span>, and <span class="font-medium svelte-e5btcs">controlled lossR</span>.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Short)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Short row with <span class="font-medium svelte-e5btcs">SL = 1.50×</span>, <span class="font-medium svelte-e5btcs">winR = 1.71</span>, <span class="font-medium svelte-e5btcs">lossR = 1.46</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.50×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1.5 × ATR</span> above
                    anchor. Far stop → fewer stop‑hits; risk unit is larger.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.71</span> means average win
                    is <span class="font-medium svelte-e5btcs">1.71R</span>. If 1R = 100 units
                    risk, average win ≈ 171.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 1.46</span> means average
                    loss is <span class="font-medium svelte-e5btcs">1.46R</span>.</li> <li class="svelte-e5btcs">Decision: if pWin ≈ 55%, <span class="font-medium svelte-e5btcs">EV = pWin × winR − (1−pWin) × lossR</span> = 0.55×1.71 − 0.45×1.46 ≈ <span class="font-medium svelte-e5btcs">+0.28R</span> → acceptable.</li> <li class="svelte-e5btcs">If pWin drops below ~45% or lossR rises, move ▶ to a better
                    row (smaller SL or higher EV).</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Arrow Example (Long)</div> <div class="text-sm text-base-content/70 space-y-2 svelte-e5btcs"><p class="svelte-e5btcs">Suppose ▶ is on a Long row with <span class="font-medium svelte-e5btcs">SL = 1.00×</span>, <span class="font-medium svelte-e5btcs">winR = 1.40</span>, <span class="font-medium svelte-e5btcs">lossR = 0.90</span>.</p> <ul class="list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">SL 1.00×</span> means stop
                    distance is <span class="font-medium svelte-e5btcs">1 × ATR</span> below anchor.
                    Closer stop → smaller risk; may get hit more often.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">winR 1.40</span> means average win
                    is 1.40R.</li> <li class="svelte-e5btcs"><span class="font-medium svelte-e5btcs">lossR 0.90</span> means average loss
                    is 0.90R.</li> <li class="svelte-e5btcs">If pWin ≈ 60%, <span class="font-medium svelte-e5btcs">EV ≈ 0.60×1.40 − 0.40×0.90 = +0.54R</span> → strong setup.</li> <li class="svelte-e5btcs">If band is very wide or pWin is low, move ▶ to rows with
                    positive EV and controlled lossR.</li></ul></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Band‑Based Decisions</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Narrow band: clearer path—slightly increase conviction if
                  suitable.</li> <li class="svelte-e5btcs">Wide band: more uncertainty—reduce size or wait for clarity.</li> <li class="svelte-e5btcs">If band overlaps major support/resistance: be cautious; use a
                  safer stop.</li></ul></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Examples</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Long Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is upward. EV +0.30→+0.60, pWin 55–65%. SL
                    1.0×–1.25× often gives a good balance between win chance and
                    lossR.</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Short Bias</div> <p class="text-xs text-base-content/70 mt-1 svelte-e5btcs">Middle road is downward. Short EV +0.20→+0.45. If the band
                    overlaps prior lows, SL 0.8×–1.0× is a careful choice.</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Buy/Sell</div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-e5btcs"><div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Buy When (Long)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">EV +0.30 or higher</li> <li class="svelte-e5btcs">pWin 55% or higher</li> <li class="svelte-e5btcs">Band is narrow (clear path)</li> <li class="svelte-e5btcs">Middle road is upward</li> <li class="svelte-e5btcs">Stop-loss 1.0×–1.25× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.45, pWin 62%, narrow band → Buy</p></div> <div class="p-3 rounded-md border border-base-300 bg-base-50 svelte-e5btcs"><div class="text-xs font-semibold text-base-content svelte-e5btcs">Sell When (Short)</div> <ul class="text-xs text-base-content/70 mt-1 list-disc pl-4 space-y-1 svelte-e5btcs"><li class="svelte-e5btcs">Short EV +0.20 or higher</li> <li class="svelte-e5btcs">pWin 50% or higher</li> <li class="svelte-e5btcs">Band is narrow</li> <li class="svelte-e5btcs">Middle road is downward</li> <li class="svelte-e5btcs">Stop-loss 0.8×–1.0× ATR</li></ul> <p class="text-xs text-base-content/60 mt-2 svelte-e5btcs">Example: EV +0.25, pWin 54%, narrow band → Sell</p></div></div></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">When to Wait</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">EV is negative (−0.10 or worse)</li> <li class="svelte-e5btcs">Band is very wide (high uncertainty)</li> <li class="svelte-e5btcs">pWin below 45%</li> <li class="svelte-e5btcs">Band overlaps major support/resistance</li> <li class="svelte-e5btcs">Poor winR/lossR balance (winR ≤ 1.0 or lossR ≥ 1.2)</li></ul> <p class="text-sm text-base-content/70 mt-2 svelte-e5btcs">Example: EV −0.15, pWin 42%, wide band → Wait</p></div> <div class="space-y-2 svelte-e5btcs"><div class="text-sm font-semibold text-base-content svelte-e5btcs">Tips</div> <ul class="text-sm text-base-content/70 list-disc pl-5 svelte-e5btcs"><li class="svelte-e5btcs">Use the edit popup to change band opacity, colors, and line
                  styles.</li> <li class="svelte-e5btcs">Click inside the EV table to change stops; dashed lines update
                  instantly.</li> <li class="svelte-e5btcs">Pair with trend filters or volume to make decisions more
                  robust.</li> <li class="svelte-e5btcs">Risk management: Don't risk more than 1–2% per trade</li> <li class="svelte-e5btcs">Confirmation: Wait for candlestick pattern or indicator
                  confirmation</li></ul></div>`,1),HV=be('<div class="fixed inset-0 z-[60] svelte-e5btcs"><div class="absolute inset-0 bg-base-200/20 svelte-e5btcs"></div> <div class="absolute inset-0 flex items-center justify-center p-4 svelte-e5btcs"><div class="w-full max-w-3xl rounded-xl shadow-2xl border border-base-300 bg-base-100 overflow-hidden svelte-e5btcs"><div class="flex items-center justify-between px-5 py-4 border-b border-base-300 bg-base-50 svelte-e5btcs"><div class="flex items-center gap-3 svelte-e5btcs"><div class="w-8 h-8 rounded-lg flex items-center justify-center bg-primary/10 text-primary svelte-e5btcs"><svg class="w-5 h-5 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" class="svelte-e5btcs"></circle><line x1="12" y1="16" x2="12" y2="12" class="svelte-e5btcs"></line><line x1="12" y1="8" x2="12.01" y2="8" class="svelte-e5btcs"></line></svg></div> <div class="svelte-e5btcs"><div class="text-base font-semibold text-base-content svelte-e5btcs"> </div> <div class="text-xs text-base-content/60 svelte-e5btcs"> </div></div></div> <div class="flex items-center gap-2 svelte-e5btcs"><button>বাংলা</button> <button>English</button></div> <button class="btn btn-xs btn-ghost svelte-e5btcs" aria-label="Close"><svg class="w-4 h-4 svelte-e5btcs" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button></div> <div class="px-5 py-4 space-y-5 max-h-[70vh] overflow-y-auto svelte-e5btcs"><!></div></div></div></div>'),qV=(s,e)=>b(e,!1),UV=(s,e)=>b(e,!1),GV=be(`<div class="premium-modal-backdrop svelte-e5btcs" role="presentation"></div> <div class="premium-modal-container svelte-e5btcs" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-e5btcs"><div class="premium-orb premium-orb-1 svelte-e5btcs"></div> <div class="premium-orb premium-orb-2 svelte-e5btcs"></div></div> <div class="premium-content svelte-e5btcs"><button class="premium-close-btn svelte-e5btcs" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="18" y1="6" x2="6" y2="18" class="svelte-e5btcs"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-e5btcs"></line></svg></button> <div class="premium-icon-wrapper svelte-e5btcs"><div class="premium-icon svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-e5btcs"></path><path d="M2 17l10 5 10-5" class="svelte-e5btcs"></path><path d="M2 12l10 5 10-5" class="svelte-e5btcs"></path></svg> <div class="premium-icon-glow svelte-e5btcs"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-e5btcs">Premium Feature</h2> <p class="premium-message svelte-e5btcs">Smart Trend is an exclusive premium indicator. Upgrade to Premium to
        unlock this advanced trend-following tool and enhance your trading
        strategy.</p> <div class="premium-features svelte-e5btcs"><div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">Smart Trend Indicator</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">AI Indicators (Smart Money, Trap Hunter, Volcanic)</span></div> <div class="premium-feature-item svelte-e5btcs"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><polyline points="20 6 9 17 4 12" class="svelte-e5btcs"></polyline></svg> <span class="svelte-e5btcs">More premium features coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-e5btcs"><span class="svelte-e5btcs">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e5btcs"><line x1="5" y1="12" x2="19" y2="12" class="svelte-e5btcs"></line><polyline points="12 5 19 12 12 19" class="svelte-e5btcs"></polyline></svg></a></div></div>`,1),YV=be("<!> <!> <!>",1);function KV(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(u,"$chart",t),o=()=>Ml(f,"$save",t),r=()=>Ml(c,"$ctx",t),a=()=>Ml(jg,"$userPreferences",t);let l=bi(e,"show",15);const c=hd("ctx"),f=hd("save"),u=hd("chart"),d=Zx(),h=[{name:"BBI",title:"BBI (Bull and Bear Index)",is_main:!1},{name:"BOLL",title:"BOLL (Bollinger Bands)",is_main:!0},{name:"EMA",title:"EMA (Exponential Moving Average)",is_main:!0},{name:"ICHIMOKU",title:"ICHIMOKU (Ichimoku Kinko Hyo)",is_main:!0},{name:"MA",title:"MA (Moving Average)",is_main:!0},{name:"SAR",title:"SAR (Parabolic SAR)",is_main:!0},{name:"SMA",title:"SMA (Simple Moving Average)",is_main:!0},{name:"SMARTTREND",title:"Smart Trend",is_main:!0},{name:"ZIGZAG",title:"ZigZag (Trend Reversal Indicator)",is_main:!0},{name:"AO",title:"Awesome Oscillator",is_main:!1},{name:"BIAS",title:"BIAS (Bias)",is_main:!1},{name:"CCI",title:"CCI (Commodity Channel Index)",is_main:!1},{name:"CR",title:"CR (Energy)",is_main:!1},{name:"DMI",title:"DMI (Directional Movement Index)",is_main:!1},{name:"EMV",title:"EMV (Ease of Movement)",is_main:!1},{name:"KDJ",title:"KDJ (KDJ Index)",is_main:!1},{name:"MACD",title:"MACD (Moving Average Convergence Divergence)",is_main:!1},{name:"MTM",title:"MTM (Momentum)",is_main:!1},{name:"OBV",title:"OBV (On Balance Volume)",is_main:!1},{name:"PSY",title:"PSY (Psychological Line)",is_main:!1},{name:"PVT",title:"PVT (Price Volume Trend)",is_main:!1},{name:"ROC",title:"ROC (Rate of Change)",is_main:!1},{name:"RSI",title:"RSI (Relative Strength Index)",is_main:!1},{name:"STOCH",title:"STOCH (Stochastic Oscillator)",is_main:!1},{name:"TRIX",title:"TRIX (Triple Exponential Moving Average)",is_main:!1},{name:"VOL",title:"VOL (Volume)",is_main:!0},{name:"VR",title:"VR (Volume Variation Rate)",is_main:!1},{name:"WR",title:"WR (Williams Percentage Range)",is_main:!1}];h.push({name:"NPO_MAE",title:"Nearest‑Pattern Outcome + MAE‑Stop",is_main:!0});const p=h.slice().sort((ze,Ge)=>ze.name.localeCompare(Ge.name));function v(ze){const Ge=h.find(xt=>xt.name===ze);return Ge?Ge.title:ze}function x(ze,Ge){const xt=new Set;if(!(ze!=null&&ze.getIndicators))return xt;try{ze.getIndicators().forEach(ft=>{(ft==null?void 0:ft.name)===Ge&&(ft!=null&&ft.paneId)&&xt.add(ft.paneId)})}catch(jt){console.warn(`⚠️ Failed to read ${Ge} pane IDs from chart:`,jt)}return xt}function S(ze,Ge){if(!Ge.has(ze))return ze;let xt=2;for(;Ge.has(`${ze}_${xt}`)&&xt<1e3;)xt+=1;if(!Ge.has(`${ze}_${xt}`))return`${ze}_${xt}`;let jt=`${ze}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;Ge.has(jt);)jt=`${ze}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return jt}function C(ze,Ge,xt,jt){const ft=x(ze,Ge);for(const ke of ft)if(!xt.has(ke))return ke;return jt}let I=_e(H(new Set));function A(){var xt,jt,ft,ke,Se,Et;const ze=new Set;if(n())try{const wt=((jt=(xt=n()).getIndicators)==null?void 0:jt.call(xt))??[];wt.forEach(Gs=>{Gs&&Gs.name&&ze.add(Gs.name)}),console.log("📊 Indicator list - from chart.getIndicators:",wt.map(Gs=>Gs.name));const Ls=((ke=(ft=n()).getOverlays)==null?void 0:ke.call(ft))??[];(Ls==null?void 0:Ls.some(Gs=>(Gs==null?void 0:Gs.name)==="NearestPatternOutcomeMaeStop"))&&ze.add("NPO_MAE")}catch(wt){console.warn("⚠️ Indicator list - getIndicators failed, falling back to saveInds",wt)}if(ze.size===0&&o()&&o().saveInds){Object.values(o().saveInds).forEach(wt=>{wt&&wt.name&&ze.add(wt.name)}),console.log("📊 Indicator list - from saveInds (fallback):",Array.from(ze));try{(((Et=(Se=n())==null?void 0:Se.getOverlays)==null?void 0:Et.call(Se))??[]).some(Ls=>(Ls==null?void 0:Ls.name)==="NearestPatternOutcomeMaeStop")||ze.delete("NPO_MAE")}catch{}}const Ge=Array.from(ze).map(wt=>v(wt));console.log("🔄 selectedIndicators updated:",Ge),b(I,H(ze))}Xr(()=>{var ze;l(),n(),(ze=o())==null||ze.saveInds,A()}),sm(()=>{console.log("modalIndSearch mounted"),console.log("Available ActionTypes:",Object.keys(ig)),console.log("ActionType values:",Object.values(ig)),console.log("🔍 localStorage content:");for(let ze=0;ze<localStorage.length;(ze+=1)-1){const Ge=localStorage.key(ze);Ge&&console.log(`🔍 ${Ge}:`,localStorage.getItem(Ge))}window.debugChart=()=>{const ze=JSON.parse(localStorage.getItem("chart")||"{}");return console.log("🔍 localStorage chart data:",ze),console.log("🔍 saveInds keys:",Object.keys(ze.saveInds||{})),console.log("🔍 Current $save.saveInds keys:",Object.keys(o().saveInds)),console.log("🔍 Chart available:",n()?"Yes":"No chart"),{localStorage:ze,currentSave:o().saveInds}},setTimeout(()=>{console.log("🚀 Auto-debug on page load:"),window.debugChart()},2e3),console.log("🔍 Debug function added: window.debugChart()")});let P=_e(""),T=_e(!1),j=_e(H(new Set)),E=_e(!1),L=_e(!1),D=_e(!0),X=_e(0),ne,de=_e(!1),ie=_e("bn"),te=_e(!1);Xr(()=>{i(de)&&l()?(b(te,!0),l(!1)):!i(de)&&!l()&&i(te)&&(b(te,!1),l(!0))}),Xr(()=>{!r().modalIndCfg&&i(T)&&(b(T,!1),setTimeout(()=>{l(!0)},100))});let le=Lt(()=>{let ze=p;if(i(P)){const Ge=i(P).toLowerCase();ze=ze.filter(xt=>xt.name.toLowerCase().includes(Ge)||xt.title.toLowerCase().includes(Ge)).sort((xt,jt)=>xt.name.localeCompare(jt.name))}if(l()&&i(j).size>0){const Ge=ze.filter(jt=>i(j).has(jt.name)),xt=ze.filter(jt=>!i(j).has(jt.name));return[...Ge,...xt]}return ze});Xr(()=>{var ze,Ge;if(l()!==i(E)){if(l()){const xt=new Set;if((Ge=(ze=i(I)).forEach)==null||Ge.call(ze,jt=>xt.add(jt)),xt.size===0&&i(I)&&i(I).size>0)for(const jt of i(I).values())xt.add(jt);b(j,H(xt))}else b(j,H(new Set));b(E,H(l()))}});function pe(){var Ge;const ze=(Ge=a())==null?void 0:Ge.data;return ze?ze.isPremium===!0||ze.isTrial===!0:!1}async function re(ze,Ge,xt,jt=800){var ke;const ft=Date.now();for(;Date.now()-ft<jt;){try{const Se=((ke=ze.getIndicators)==null?void 0:ke.call(ze,{name:Ge,paneId:xt}))??[];if(Se.length>0&&Se.some(wt=>(wt==null?void 0:wt.result)&&Object.keys(wt.result).length>0))return}catch{}await new Promise(Se=>setTimeout(Se,16))}}async function xe(ze,Ge){var xt,jt,ft,ke,Se,Et,wt,Ls,tn,Gs,an,Es,Ns,Hs,ns,fs,Mn,po;if(Ge==="SMARTTREND"&&!pe()){console.log("🔒 Premium access required for Smart Trend indicator"),b(L,!0);return}if(Ge==="BBI")Me(Ge,[3,6,12,24],!0,{id:"pane_BBI"});else if(Ge==="EMA")Me(Ge,[20],!0,{id:"candle_pane"});else if(Ge==="MA"){const Tn="candle_pane",Cn=n();if(Cn){const go=Cn.createIndicator({name:"MA",calcParams:[20],styles:{lines:[{color:"#2563eb",size:1,style:mt.Solid}]},createTooltipDataSource:({indicator:no})=>{const Bo=[no.visible?1:0,2,3],Vo=Cn.getStyles().indicator.tooltip;return{icons:Bo.map(aa=>Vo.features[aa])}}},!0,{id:Tn});if(await re(Cn,"MA",Tn),go){const no={name:"MA",pane_id:Tn,params:[20],styles:[{color:"#2563eb",thickness:1,lineStyle:"solid"}]},Bo=`${Tn}_MA`;f.update(Vo=>(Vo.saveInds[Bo]=no,Vo))}}}else if(Ge==="SMARTTREND"){const Tn="candle_pane",Cn=n();if(Cn){const go=Cn.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:mt.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},createTooltipDataSource:({indicator:no})=>{const Bo=[no.visible?1:0,2,3],Vo=Cn.getStyles().indicator.tooltip;return{icons:Bo.map(aa=>Vo.features[aa])}}},!0,{id:Tn});if(await re(Cn,"SMARTTREND",Tn),go){const no={name:"SMARTTREND",pane_id:Tn,params:[10,3],superTrendGroups:[{id:"st_default",period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]},Bo=`${Tn}_SMARTTREND`;f.update(Vo=>(Vo.saveInds[Bo]=no,Vo))}}}else if(Ge==="SMA"){const Tn="candle_pane",Cn=n();if(Cn){const go=Cn.createIndicator({name:"SMA",calcParams:[20],styles:{lines:[{color:"#FF6C37",size:2,style:mt.Solid}]},createTooltipDataSource:({indicator:no})=>{const Bo=[no.visible?1:0,2,3],Vo=Cn.getStyles().indicator.tooltip;return{icons:Bo.map(aa=>Vo.features[aa])}}},!0,{id:Tn});if(await re(Cn,"SMA",Tn),go){const no={name:"SMA",pane_id:Tn,params:[20],styles:[{color:"#FF6C37",thickness:2,lineStyle:"solid"}]},Bo=`${Tn}_SMA`;f.update(Vo=>(Vo.saveInds[Bo]=no,Vo))}}}else if(Ge==="RSI"){const Tn=n();if(!Tn)return;let Cn=[];try{const zi=localStorage.getItem("rsiGroups");zi&&(Cn=JSON.parse(zi))}catch(zi){console.warn("Failed to load saved RSI groups:",zi)}Cn.length===0&&(Cn=[{id:"rsi_default",period:14,overbought:70,middle:50,oversold:30,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",middleLineColor:"#6B7280"}}]);const go=Cn[0],no=go.overboughtLevel??go.overbought??70,Bo=go.middleLevel??go.middle??50,Vo=go.oversoldLevel??go.oversold??30,Rl=x(Tn,"RSI"),aa=new Set(Rl);Object.values(o().saveInds).forEach(zi=>{(zi==null?void 0:zi.name)==="RSI"&&(zi!=null&&zi.pane_id)&&aa.add(zi.pane_id)});const tl=S("pane_RSI",aa),Zr=Tn.createIndicator({name:"RSI",calcParams:[go.period],styles:{lines:[{color:((jt=(xt=go.styles)==null?void 0:xt.rsi)==null?void 0:jt.color)||"#8B5CF6",size:((ke=(ft=go.styles)==null?void 0:ft.rsi)==null?void 0:ke.thickness)??2,style:((Et=(Se=go.styles)==null?void 0:Se.rsi)==null?void 0:Et.lineStyle)==="dashed"||((Ls=(wt=go.styles)==null?void 0:wt.rsi)==null?void 0:Ls.lineStyle)==="dotted"?mt.Dashed:mt.Solid}]}},!1,{id:tl,axis:{gap:{bottom:2}}});if(await re(Tn,"RSI",tl),Zr){const zi=C(Tn,"RSI",Rl,tl),Nl={id:go.id||`rsi_${Date.now()}`,period:go.period,overboughtLevel:no,middleLevel:Bo,oversoldLevel:Vo,paneId:zi,actualPaneId:zi,styles:{rsi:{color:((Gs=(tn=go.styles)==null?void 0:tn.rsi)==null?void 0:Gs.color)||"#8B5CF6",thickness:((Es=(an=go.styles)==null?void 0:an.rsi)==null?void 0:Es.thickness)??2,lineStyle:((Hs=(Ns=go.styles)==null?void 0:Ns.rsi)==null?void 0:Hs.lineStyle)||"solid"},overboughtColor:((ns=go.styles)==null?void 0:ns.overboughtColor)||"#EF4444",oversoldColor:((fs=go.styles)==null?void 0:fs.oversoldColor)||"#10B981",middleLineColor:((Mn=go.styles)==null?void 0:Mn.middleLineColor)||"#6B7280"}},mu={name:"RSI",pane_id:zi,params:[go.period],rsiGroups:[Nl]},Gc=`${zi}_RSI`;f.update(du=>(du.saveInds[Gc]=mu,du))}}else if(Ge==="STOCH"){const Tn="pane_STOCH";let Cn=[];try{const Bo=localStorage.getItem("stochasticGroups");Bo&&(Cn=JSON.parse(Bo))}catch(Bo){console.warn("Failed to load saved Stochastic groups:",Bo)}Cn.length===0&&(Cn=[{id:"stochastic_default",kPeriod:14,dPeriod:3,overbought:80,mid:50,oversold:20,styles:{k:{color:"#3B82F6",thickness:2,lineStyle:"solid"},d:{color:"#EF4444",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midColor:"#6B7280"}}]);const go=Cn[0],no=n();if(no&&no.createIndicator({name:"STOCH",calcParams:[go.kPeriod,go.dPeriod],styles:{lines:[{color:go.styles.k.color,size:go.styles.k.thickness,style:go.styles.k.lineStyle==="dashed"||go.styles.k.lineStyle==="dotted"?mt.Dashed:mt.Solid},{color:go.styles.d.color,size:go.styles.d.thickness,style:go.styles.d.lineStyle==="dashed"||go.styles.d.lineStyle==="dotted"?mt.Dashed:mt.Solid}]}},!0,{id:Tn})){const Vo={name:"STOCH",pane_id:Tn,params:[go.kPeriod,go.dPeriod]},Rl=`${Tn}_STOCH`;f.update(aa=>(aa.saveInds[Rl]=Vo,aa))}}else if(Ge==="NPO_MAE"){const Tn=n();if(!Tn)return;if(!(((po=Tn.getOverlays)==null?void 0:po.call(Tn))??[]).some(go=>(go==null?void 0:go.name)==="NearestPatternOutcomeMaeStop")){const go=CV(Tn);window.__npoMaeApi=go,f.update(no=>{const Bo="candle_pane_NPO_MAE";return no.saveInds[Bo]={name:"NPO_MAE",pane_id:"candle_pane"},no})}}else{const Tn=ze?"candle_pane":"pane_"+Ge;Me(Ge,void 0,!0,{id:Tn})}}function se(ze){var xt,jt;let Ge=Object.entries(o().saveInds).find(([ft,ke])=>ke.name===ze);if(!Ge&&n())try{const ke=(((jt=(xt=n()).getIndicators)==null?void 0:jt.call(xt))??[]).find(Se=>Se&&Se.name===ze);if(ke){Fc(c,Ro(r).editIndName=ze,Ro(r)),Fc(c,Ro(r).editPaneId=ke.paneId||r().editPaneId||"candle_pane",Ro(r)),Fc(c,Ro(r).modalIndCfg=!0,Ro(r)),b(T,!0),l(!1);return}}catch(ft){console.warn("⚠️ Failed to locate indicator on chart for edit:",ft)}if(Ge){const[,ft]=Ge;Fc(c,Ro(r).editIndName=ze,Ro(r)),Fc(c,Ro(r).editPaneId=ft.pane_id,Ro(r)),Fc(c,Ro(r).modalIndCfg=!0,Ro(r)),b(T,!0),l(!1)}}function Ne(ze){const Ge=new Set,xt=[];Object.entries(o().saveInds).forEach(([jt,ft])=>{(ft==null?void 0:ft.name)===ze&&(ft!=null&&ft.pane_id?Ge.add(ft.pane_id):xt.push(jt))}),x(n(),ze).forEach(jt=>{Ge.add(jt)}),Ge.forEach(jt=>{De(jt,ze)}),xt.length>0&&(f.update(jt=>(xt.forEach(ft=>{delete jt.saveInds[ft]}),jt)),Hm())}function Te(ze){var Ge,xt,jt;if(ze==="NPO_MAE"){const ft=n();if(ft)try{(((Ge=ft.getOverlays)==null?void 0:Ge.call(ft))??[]).forEach(Se=>{if((Se==null?void 0:Se.name)==="NearestPatternOutcomeMaeStop")try{ft.removeOverlay({id:Se.id})}catch{}})}catch{}try{(jt=(xt=window.__npoMaeApi)==null?void 0:xt.dispose)==null||jt.call(xt),window.__npoMaeApi=null}catch{}f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{var Et;((Et=ke.saveInds[Se])==null?void 0:Et.name)==="NPO_MAE"&&delete ke.saveInds[Se]}),ke));return}if(ze==="MACD")Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="MACD").forEach(([ke,Se])=>{De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="MACD"&&delete ke.saveInds[Se]}),ke));else if(ze==="RSI")Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="RSI").forEach(([ke,Se])=>{De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="RSI"&&delete ke.saveInds[Se]}),ke));else if(ze==="STOCH")Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="STOCH").forEach(([ke,Se])=>{De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="STOCH"&&delete ke.saveInds[Se]}),ke));else if(ze==="BBI")Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="BBI").forEach(([ke,Se])=>{De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="BBI"&&delete ke.saveInds[Se]}),ke));else if(ze==="AO"){if(console.log("🗑️ Starting bulk AO deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="AO");console.log("📊 Found AO indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing AO indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"AO"})}),console.log("✅ All AO indicators removed from chart")}catch(ke){console.error("❌ Error removing AO indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="AO");console.log("🗑️ Deleting AO saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="AO"&&(console.log("🗑️ Clearing AO saved data:",Se),delete ke.saveInds[Se])}),ke)),console.log("✅ Bulk AO deletion completed")}else if(ze==="DMI"){if(console.log("🗑️ Starting bulk DMI deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="DMI");console.log("📊 Found DMI indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing DMI indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"DMI"})}),console.log("✅ All DMI indicators removed from chart")}catch(ke){console.error("❌ Error removing DMI indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="DMI");console.log("🗑️ Deleting DMI saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="DMI"&&(console.log("🗑️ Clearing DMI saved data:",Se),delete ke.saveInds[Se])}),ke)),console.log("✅ Bulk DMI deletion completed")}else if(ze==="SAR"){if(console.log("🗑️ Starting bulk SAR deletion..."),n())try{const ke=n().getIndicators().filter(Se=>Se.name==="SAR");console.log("📊 Found SAR indicators on chart:",ke.length),ke.forEach(Se=>{console.log("🗑️ Removing SAR from pane:",Se.paneId),n().removeIndicator({paneId:Se.paneId,name:"SAR"})})}catch(ft){console.error("❌ Error removing SAR indicators from chart:",ft);try{n().removeIndicator({paneId:"candle_pane",name:"SAR"})}catch{}try{n().removeIndicator({paneId:r().editPaneId,name:"SAR"})}catch{}}f.update(ft=>(Object.keys(ft.saveInds).forEach(ke=>{ft.saveInds[ke].name==="SAR"&&delete ft.saveInds[ke]}),ft)),c.update(ft=>(ft.editIndName==="SAR"&&(ft.editIndName="",ft.editPaneId="",ft.modalIndCfg=!1),ft)),console.log("✅ Bulk SAR deletion completed")}else if(ze==="SMARTTREND"){if(console.log("🗑️ Starting bulk Smart Trend deletion..."),n())try{const ke=n().getIndicators().filter(Se=>Se.name==="SMARTTREND");console.log("📊 Found Smart Trend indicators on chart:",ke.length),ke.forEach(Se=>{console.log("🗑️ Removing Smart Trend from pane:",Se.paneId),n().removeIndicator({paneId:Se.paneId,name:"SMARTTREND"})})}catch(ft){console.error("❌ Error removing Smart Trend indicators from chart:",ft);try{n().removeIndicator({paneId:"candle_pane",name:"SMARTTREND"})}catch{}try{n().removeIndicator({paneId:r().editPaneId,name:"SMARTTREND"})}catch{}}f.update(ft=>(Object.keys(ft.saveInds).forEach(ke=>{ft.saveInds[ke].name==="SMARTTREND"&&delete ft.saveInds[ke]}),ft)),console.log("✅ Bulk Smart Trend deletion completed")}else if(ze==="CR"){if(console.log("🗑️ Starting bulk CR deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="CR");console.log("📊 Found CR indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing CR indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"CR"})}),console.log("✅ All CR indicators removed from chart")}catch(ke){console.error("❌ Error removing CR indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="CR");console.log("🗑️ Deleting CR saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="CR"&&(console.log("🗑️ Clearing CR saved data:",Se),delete ke.saveInds[Se])}),ke)),console.log("✅ Bulk CR deletion completed")}else if(ze==="WR"){if(console.log("🗑️ Starting bulk WR deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="WR");console.log("📊 Found WR indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing WR indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"WR"})}),console.log("✅ All WR indicators removed from chart")}catch(ke){console.error("❌ Error removing WR indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="WR");console.log("🗑️ Deleting WR saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="WR"&&(console.log("🗑️ Clearing WR saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearWrGroups+=1,ke)),console.log("✅ Bulk WR deletion completed")}else if(ze==="KDJ"){const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="KDJ");console.log("🗑️ Deleting KDJ entries:",ft),ft.forEach(([ke,Se])=>{console.log("🗑️ Deleting KDJ from pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="KDJ"&&(console.log("🗑️ Clearing KDJ saved data:",Se),delete ke.saveInds[Se])}),ke))}else if(ze==="OBV"){const ft=Object.entries(o().saveInds).filter(([Se,Et])=>Et.name==="OBV");console.log("🗑️ Deleting OBV entries from saveInds:",ft),ft.forEach(([Se,Et])=>{console.log("🗑️ Deleting OBV from pane (saveInds):",Et.pane_id),Et.pane_id&&De(Et.pane_id,ze)});const ke=[r().editPaneId,"pane_OBV_1","pane_OBV_2","pane_OBV_3","pane_OBV_4","pane_OBV_5","main","sub1","sub2","sub3","sub4"];console.log("🗑️ Attempting to remove OBV from common pane locations..."),ke.forEach(Se=>{var Et;if(Se)try{console.log("🗑️ Trying to remove OBV from pane:",Se),(Et=n())==null||Et.removeIndicator({paneId:Se,name:"OBV"})}catch{}}),f.update(Se=>(Object.keys(Se.saveInds).forEach(Et=>{Se.saveInds[Et].name==="OBV"&&(console.log("🗑️ Clearing OBV saved data:",Et),delete Se.saveInds[Et])}),Se)),c.update(Se=>(Se.clearObvGroups+=1,Se))}else if(ze==="CCI"){if(console.log("🗑️ Starting bulk CCI deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="CCI");console.log("📊 Found CCI indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing CCI indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"CCI"})}),console.log("✅ All CCI indicators removed from chart")}catch(ke){console.error("❌ Error removing CCI indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="CCI");console.log("🗑️ Deleting CCI saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="CCI"&&(console.log("🗑️ Clearing CCI saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearCciGroups+=1,ke)),console.log("✅ Bulk CCI deletion completed")}else if(ze==="EMV"){const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="EMV");console.log("🗑️ Deleting EMV entries:",ft),ft.forEach(([ke,Se])=>{console.log("🗑️ Deleting EMV from pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="EMV"&&(console.log("🗑️ Clearing EMV saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearEmvGroups+=1,ke))}else if(ze==="MTM"){const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="MTM");console.log("🗑️ Deleting MTM entries:",ft),ft.forEach(([ke,Se])=>{console.log("🗑️ Deleting MTM from pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="MTM"&&(console.log("🗑️ Clearing MTM saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearMtmGroups+=1,ke))}else if(ze==="PSY"){const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="PSY");console.log("🗑️ Deleting PSY entries:",ft),ft.forEach(([ke,Se])=>{console.log("🗑️ Deleting PSY from pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="PSY"&&(console.log("🗑️ Clearing PSY saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearPsyGroups+=1,ke))}else if(ze==="PVT"){if(console.log("🗑️ Starting bulk PVT deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="PVT");console.log("📊 Found PVT indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing PVT indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"PVT"})}),console.log("✅ All PVT indicators removed from chart")}catch(ke){console.error("❌ Error removing PVT indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="PVT");console.log("🗑️ Deleting PVT saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="PVT"&&(console.log("🗑️ Clearing PVT saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearPvtGroups+=1,ke)),console.log("✅ Bulk PVT deletion completed")}else if(ze==="ROC"){if(console.log("🗑️ Starting bulk ROC deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="ROC");console.log("📊 Found ROC indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing ROC indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"ROC"})}),console.log("✅ All ROC indicators removed from chart")}catch(ke){console.error("❌ Error removing ROC indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="ROC");console.log("🗑️ Deleting ROC saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="ROC"&&(console.log("🗑️ Clearing ROC saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearRocGroups+=1,ke)),console.log("✅ Bulk ROC deletion completed")}else if(ze==="VR"){if(console.log("🗑️ Starting bulk VR deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="VR");console.log("📊 Found VR indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing VR indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"VR"})}),console.log("✅ All VR indicators removed from chart")}catch(ke){console.error("❌ Error removing VR indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="VR");console.log("🗑️ Deleting VR saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="VR"&&(console.log("🗑️ Clearing VR saved data:",Se),delete ke.saveInds[Se])}),ke)),console.log("✅ Bulk VR deletion completed")}else if(ze==="VOL"){if(console.log("🗑️ Starting bulk VOL deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="VOL");console.log("📊 Found VOL indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing VOL indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"VOL"})}),console.log("✅ All VOL indicators removed from chart")}catch(ke){console.error("❌ Error removing VOL indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="VOL");console.log("🗑️ Deleting VOL saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="VOL"&&(console.log("🗑️ Clearing VOL saved data:",Se),delete ke.saveInds[Se])}),ke)),c.update(ke=>(ke.clearVolGroups+=1,ke)),console.log("✅ Bulk VOL deletion completed")}else if(ze==="BIAS"){if(console.log("🗑️ Starting bulk BIAS deletion..."),n())try{const Se=n().getIndicators().filter(Et=>Et.name==="BIAS");console.log("📊 Found BIAS indicators on chart:",Se.length),Se.forEach(Et=>{console.log("🗑️ Removing BIAS indicator from pane:",Et.paneId),n().removeIndicator({paneId:Et.paneId,name:"BIAS"})}),console.log("✅ All BIAS indicators removed from chart")}catch(ke){console.error("❌ Error removing BIAS indicators from chart:",ke)}const ft=Object.entries(o().saveInds).filter(([ke,Se])=>Se.name==="BIAS");console.log("🗑️ Deleting BIAS saved entries:",ft.length),ft.forEach(([ke,Se])=>{console.log("🗑️ Cleaning saved entry:",ke,"pane:",Se.pane_id),Se.pane_id&&De(Se.pane_id,ze)}),f.update(ke=>(Object.keys(ke.saveInds).forEach(Se=>{ke.saveInds[Se].name==="BIAS"&&(console.log("🗑️ Clearing BIAS saved data:",Se),delete ke.saveInds[Se])}),ke)),console.log("✅ Bulk BIAS deletion completed")}else Ne(ze)}async function Me(ze,Ge,xt,jt){const ft=n();if(!ft)return null;let ke=Ge,Se={};if(ze==="VOL"){if((!(jt!=null&&jt.id)||jt.id!=="candle_pane")&&(jt={axis:{gap:{bottom:2}},...jt}),!Ge||Ge.length===0){ke=[20];const an=(Es=>{switch(Es){case"dashed":return{style:mt.Dashed,dashedValue:[4,4]};case"dotted":return{style:mt.Dashed,dashedValue:[2,2]};default:return{style:mt.Solid,dashedValue:[2,2]}}})("dotted");Se={bars:[{upColor:"#26a69a",downColor:"#ef5350",noChangeColor:"#26a69a"}],lines:[{color:"#8B5CF6",size:1,style:an.style,dashedValue:an.dashedValue,smooth:!1}]}}}else ze==="EMV"&&((!(jt!=null&&jt.id)||jt.id!=="candle_pane")&&(jt={axis:{gap:{bottom:2}},...jt}),(!Ge||Ge.length===0)&&(ke=(cb[ze]||[]).filter(an=>an.type!=="color").map(an=>an.default)));if(!ke||ke.length===0){const Gs=cb[ze]||[];Gs.length>0&&ze!=="VOL"&&(ke=Gs.filter(Es=>Es.type!=="color").map(Es=>Es.default),Gs.filter(Es=>Es.styleKey&&Es.type==="color").forEach(Es=>{const Ns=Es.styleKey,Hs=Es.default,ns=Ns.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(ns){const[,fs,Mn,po]=ns;Se[fs]||(Se[fs]=[]),Se[fs][parseInt(Mn)]||(Se[fs][parseInt(Mn)]={}),Se[fs][parseInt(Mn)][po]=Hs}}))}const Et=(jt==null?void 0:jt.id)??"",wt=`${Et}_${ze}`,Ls=ft.createIndicator({name:ze,calcParams:ke,styles:Object.keys(Se).length>0?Se:void 0,createTooltipDataSource:({indicator:Gs})=>{const an=[Gs.visible?1:0,2,3],Es=ft.getStyles().indicator.tooltip;return{icons:an.map(Hs=>Es.features[Hs])}}},xt,jt);if(await re(ft,ze,jt==null?void 0:jt.id),!Ls)return null;const tn={name:ze,pane_id:Et,params:ke};return f.update(Gs=>(Gs.saveInds[wt]=tn,Gs)),Hm(),qp.recordAddIndicator(ze,Et,ke||[],wt),tn}async function De(ze,Ge){if(console.log("🗑️ delInd called:",{paneId:ze,name:Ge,chart:!!n()}),!n()){console.log("❌ No chart available");return}const xt=n(),jt=`${ze}_${Ge}`,ft=o().saveInds[jt];ft&&qp.recordRemoveIndicator(Ge,ze,ft.params||[],jt),console.log("🔥 Attempting to remove indicator with correct API: removeIndicator(paneId, name)");try{xt.removeIndicator({paneId:ze,name:Ge}),console.log("✅ removeIndicator successful")}catch(Se){console.log("❌ removeIndicator failed:",Se);try{console.log("🔄 Trying fallback: remove indicator by name directly"),console.log("Attempting to remove indicator:",Ge,"from pane:",ze),console.log("Direct removal attempt for:",Ge),[].forEach(wt=>{console.log("Removing indicator instance:",wt);try{xt.removeIndicator({paneId:ze,name:wt.name})}catch(Ls){console.log("Failed to remove indicator instance:",Ls)}}),console.log("✅ Fallback method successful")}catch(Et){console.log("❌ Fallback method also failed:",Et)}}console.log("🧹 Cleaning saved state for:",Ge);const ke=JSON.parse(localStorage.getItem("indicators")||"{}");console.log("🧹 Current localStorage indicators:",ke),ke[ze]&&(ke[ze]=ke[ze].filter(Se=>Se.name!==Ge),ke[ze].length===0&&delete ke[ze],localStorage.setItem("indicators",JSON.stringify(ke)),console.log("🧹 Updated localStorage indicators:",ke)),f.update(Se=>{if(console.log("🧹 Before cleanup saveInds keys:",Object.keys(Se.saveInds)),Ge==="ZIGZAG"){const Et=`${ze}_ZIGZAG`;Object.keys(Se.saveInds).forEach(wt=>{const Ls=Se.saveInds[wt];wt.startsWith(Et)&&(Ls==null?void 0:Ls.name)==="ZIGZAG"&&(console.log("🧹 Removing ZigZag save key:",wt),delete Se.saveInds[wt])})}else{const Et=`${ze}_${Ge}`;console.log("🧹 Cleaning saved state key:",Et,"existed:",!!Se.saveInds[Et]),delete Se.saveInds[Et]}return console.log("🧹 After cleanup saveInds keys:",Object.keys(Se.saveInds)),Se}),Hm(),d.removeIndicator({chart:xt,name:Ge,paneId:ze}).catch(Se=>{console.warn("Background color preservation failed:",Se)}),console.log("✅ delInd completed")}pp(c,ze=>ze.cloudIndLoaded).subscribe(ze=>{console.log("🔄 cloudIndLoaded triggered, saveInds:",Object.keys(o().saveInds)),console.log("🚫 Automatic indicator restoration disabled to prevent deleted indicators from reappearing")});function Ke(ze){const xt=ze.target.scrollTop;xt<i(X)||xt<=10?b(D,!0):xt>i(X)&&xt>50&&b(D,!1),b(X,H(xt))}const kt=pp(c,ze=>ze.initDone);let pt=!1;kt.subscribe(ze=>{if(console.log("initDone changed:",ze,"chart:",!!n(),"subscribed:",pt),ze>0&&!pt&&n()){console.log("Subscribing to OnTooltipIconClick with chart:",n()),console.log("Chart methods available:",Object.getOwnPropertyNames(n())),console.log("subscribeAction method:",typeof n().subscribeAction),pt=!0;try{n().subscribeAction(ig.OnCandleTooltipFeatureClick,Ge=>{var jt,ft;console.log("🔥 OnTooltipIconClick fired!",Ge);const xt=Ge;if(xt.indicatorName)switch(console.log("Processing icon click:",xt.iconId,"for indicator:",xt.indicatorName),xt.iconId){case"visible":{console.log("Making indicator visible"),(jt=n())==null||jt.overrideIndicator({name:xt.indicatorName,paneId:xt.paneId,visible:!0});break}case"invisible":{console.log("Making indicator invisible"),(ft=n())==null||ft.overrideIndicator({name:xt.indicatorName,paneId:xt.paneId,visible:!1});break}case"setting":{console.log("Opening settings"),Fc(c,Ro(r).editIndName=xt.indicatorName,Ro(r)),Fc(c,Ro(r).editPaneId=xt.paneId,Ro(r)),Fc(c,Ro(r).modalIndCfg=!0,Ro(r)),l()&&l(!1);break}case"close":console.log("Deleting indicator:",xt.indicatorName,"from pane:",xt.paneId),De(xt.paneId,xt.indicatorName)}}),console.log("✅ Successfully subscribed to OnTooltipIconClick")}catch(Ge){console.error("❌ Error subscribing to OnTooltipIconClick:",Ge)}}});const Rt=O0(),[Ht,Ft]=Rt;var zt=YV(),ut=_s(zt),nt=Lt(()=>$x());uv(ut,{get title(){return i(nt)},width:700,maxWidth:"95vw",maxHeight:"min(92svh, 90vh)",get show(){return l()},set show(ze){l(ze)},get theme(){return o().theme},buttons:[],class:"ind-modal",children:(ze,Ge)=>{var xt=RV(),jt=y(xt),ft=m(y(jt),2);Ts(ft),we(()=>Dt(ft,"placeholder",$5()));var ke=m(ft,2);Ve(ke,()=>i(P),tn=>{var Gs=MV();Gs.__click=[PV,P],Y(tn,Gs)}),_(jt);var Se=m(jt,2),Et=y(Se),wt=y(Et);qo(wt,17,()=>i(le),yi,(tn,Gs,an)=>{var Es=$V();const Ns=Lt(()=>i(I).has(i(Gs).name));Es.__click=[NV,Ns,xe,Gs];var Hs=y(Es),ns=m(Hs,2),fs=y(ns),Mn=y(fs,!0);_(fs),_(ns);var po=m(ns,2);Ve(po,()=>i(Gs).name==="NPO_MAE",Cn=>{var go=TV();go.__click=[AV,de],Y(Cn,go)});var Tn=m(po,2);Ve(Tn,()=>i(Ns),Cn=>{var go=EV(),no=y(go);no.__click=[FV,se,Gs];var Bo=m(no,2);Bo.__click=[LV,Te,Gs],_(go),Y(Cn,go)}),_(Es),we(()=>{$i(Es,`group indicator-row relative flex items-center min-h-[56px] px-5 py-3 cursor-pointer transition-all duration-500 ease-out
                   ${(an<i(le).length-1?"border-b":"")??""} 
                   ${(i(Ns)?"indicator-item-selected":"indicator-item-unselected")??""} svelte-e5btcs`),$i(Hs,`flex items-center justify-center w-2 h-2 rounded-full mr-4 transition-all duration-500
                        ${(i(Ns)?"indicator-dot-selected":"indicator-dot-unselected")??""} svelte-e5btcs`),$i(fs,`indicator-title text-[15px] font-medium tracking-wide leading-relaxed
                           ${(i(Ns)?"indicator-text-selected":"indicator-text-unselected")??""} svelte-e5btcs`),st(Mn,i(Gs).title)}),Y(tn,Es)});var Ls=m(wt,2);Ve(Ls,()=>i(le).length===0,tn=>{var Gs=DV();Y(tn,Gs)}),_(Et),hp(Et,tn=>ne=tn,()=>ne),_(Se),Oi(2),_(xt),we(()=>$i(jt,`relative group transition-all duration-300 ease-out ${(i(D)?"opacity-100 translate-y-0":"opacity-0 -translate-y-4 pointer-events-none")??""} svelte-e5btcs`)),Fn(ft,()=>i(P),tn=>b(P,tn)),pd("scroll",Et,Ke),Y(ze,xt)},$$slots:{default:!0}});var Je=m(ut,2);Ve(Je,()=>i(de),ze=>{var Ge=HV(),xt=y(Ge);xt.__click=[jV,de];var jt=m(xt,2),ft=y(jt),ke=y(ft),Se=y(ke),Et=m(y(Se),2),wt=y(Et),Ls=y(wt,!0);_(wt);var tn=m(wt,2),Gs=y(tn,!0);_(tn),_(Et),_(Se);var an=m(Se,2),Es=y(an);Es.__click=[BV,ie];var Ns=m(Es,2);Ns.__click=[OV,ie],_(an);var Hs=m(an,2);Hs.__click=[zV,de],_(ke);var ns=m(ke,2),fs=y(ns);Ve(fs,()=>i(ie)==="bn",Mn=>{var po=VV();Oi(22),Y(Mn,po)},Mn=>{var po=WV();Oi(22),Y(Mn,po)}),_(ns),_(ft),_(jt),_(Ge),we(()=>{st(Ls,i(ie)==="bn"?"নিকটতম‑প্যাটার্ন আউটকাম + এমএই‑স্টপ":"Nearest‑Pattern Outcome + MAE‑Stop"),st(Gs,i(ie)==="bn"?"কিভাবে কাজ করে এবং কিভাবে ব্যবহার করবেন":"How it works and how to use"),$i(Es,`btn btn-xs ${(i(ie)==="bn"?"btn-primary":"btn-outline")??""} svelte-e5btcs`),$i(Ns,`btn btn-xs ${(i(ie)==="en"?"btn-primary":"btn-outline")??""} svelte-e5btcs`)}),Y(ze,Ge)});var it=m(Je,2);return Ve(it,()=>i(L),ze=>{var Ge=GV(),xt=_s(Ge);xt.__click=[qV,L];var jt=m(xt,2),ft=m(y(jt),2),ke=y(ft);ke.__click=[UV,L];var Se=m(ke,10);we(()=>Dt(Se,"href",Ht("https://dutyai.app/settings/investor?device=1",void 0))),_(ft),_(jt),Sv(3,xt,()=>c_,()=>({duration:200})),Sv(3,jt,()=>$1,()=>({y:20,duration:300,easing:lx})),Y(ze,Ge)}),Y(s,zt),Kd({createIndicator:Me,delInd:De})}$p(["click"]);function Sc(s,e){Yd(e,!0);let t=bi(e,"show",15),n=bi(e,"selectedColor",7,"#000000");bi(e,"position",19,()=>({x:0,y:0}));let o=bi(e,"opacity",7,100);const r=fm();function a(d){const h=(d||"").trim();if(!h)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(h)){const v=h.startsWith("#")?h.slice(1):h;return{r:parseInt(v.slice(0,2),16),g:parseInt(v.slice(2,4),16),b:parseInt(v.slice(4,6),16)}}const p=h.match(/^rgba?\(([^)]+)\)$/i);if(p){const v=p[1].split(",").map(x=>parseFloat(x.trim()));if(v.length>=3&&v.every(x=>!isNaN(x)))return{r:Math.round(v[0]),g:Math.round(v[1]),b:Math.round(v[2])}}return null}function l(d,h){const p=a(d);if(!p)return null;const v=Math.max(0,Math.min(100,h))/100;return`rgba(${p.r}, ${p.g}, ${p.b}, ${v})`}function c(d){const h=d.detail;n(h);const p=l(h,o());r("colorChange",{color:h,opacity:o(),rgba:p})}function f(d){const h=d.detail;o(Number.isFinite(h)?h:o());const p=l(n(),o());r("opacityChange",{opacity:o(),rgba:p,color:n()}),r("colorChange",{color:n(),opacity:o(),rgba:p})}function u(){t(!1),r("close")}sv(s,{get show(){return t()},set show(d){t(d)},get selectedColor(){return n()},get opacity(){return o()},$$events:{colorChange:c,opacityChange:f,close:u}}),Kd()}const cm={LAYOUTS:"chart.saves.v1",ACTIVE_SAVE_ID:"chart.activeSaveId",LEGACY_LAYOUTS:"chart.saves.v0"};function Br(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function v2(s){return s.toUpperCase().trim()}function g2(s){return s&&typeof s.id=="string"&&typeof s.name=="string"&&typeof s.createdAt=="string"&&typeof s.updatedAt=="string"&&typeof s.timezone=="string"&&typeof s.interval=="string"&&typeof s.chartType=="string"&&typeof s.theme=="string"&&Array.isArray(s.panes)&&Array.isArray(s.indicators)&&typeof s.drawingsBySymbol=="object"}class d4{constructor(){Pe(this,"initialized",!1);this.initialize()}async initialize(){if(!(this.initialized||!i8))try{await this.migrate(),this.initialized=!0}catch(e){console.error("Failed to initialize storage provider:",e)}}async migrate(){try{const e=localStorage.getItem(cm.LEGACY_LAYOUTS);if(!e)return;console.log("🔄 Migrating chart saves from v0 to v1...");const t=JSON.parse(e);if(!Array.isArray(t))return;if(localStorage.getItem(cm.LAYOUTS)){localStorage.removeItem(cm.LEGACY_LAYOUTS);return}const o=t.map(r=>({id:r.id||Br(),name:r.name||"Migrated Layout",createdAt:r.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),timezone:r.timezone||"UTC",interval:r.interval||"1h",chartType:r.chartType||"candles",theme:r.theme||"dark",panes:r.panes||[],indicators:r.indicators||[],styles:r.styles||{},options:r.options||{},drawingsBySymbol:r.drawings?{[v2(r.symbol||"DEFAULT")]:r.drawings}:{}}));localStorage.setItem(cm.LAYOUTS,JSON.stringify(o)),localStorage.removeItem(cm.LEGACY_LAYOUTS),console.log(`✅ Migrated ${o.length} layouts to v1 format`)}catch(e){console.error("Migration failed:",e)}}async listSavedLayouts(){await this.initialize();try{const e=localStorage.getItem(cm.LAYOUTS);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(g2).map(n=>({id:n.id,name:n.name,createdAt:n.createdAt,updatedAt:n.updatedAt})).sort((n,o)=>new Date(o.updatedAt).getTime()-new Date(n.updatedAt).getTime()):[]}catch(e){return console.error("Failed to list saved layouts:",e),[]}}async getSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(cm.LAYOUTS);if(!t)return null;const n=JSON.parse(t);if(!Array.isArray(n))return null;const o=n.find(r=>r.id===e);return o&&g2(o)?o:null}catch(t){return console.error("Failed to get saved layout:",t),null}}async createSavedLayout(e){await this.initialize();try{const t=new Date().toISOString(),n={...e,id:Br(),createdAt:t,updatedAt:t,drawingsBySymbol:Object.fromEntries(Object.entries(e.drawingsBySymbol).map(([a,l])=>[v2(a),l]))},o=localStorage.getItem(cm.LAYOUTS),r=o?JSON.parse(o):[];return r.push(n),localStorage.setItem(cm.LAYOUTS,JSON.stringify(r)),n}catch(t){throw console.error("Failed to create saved layout:",t),new Error("Failed to save layout")}}async updateSavedLayout(e,t){await this.initialize();try{const n=localStorage.getItem(cm.LAYOUTS);if(!n)throw new Error("Layout not found");const o=JSON.parse(n),r=o.findIndex(l=>l.id===e);if(r===-1)throw new Error("Layout not found");const a={...o[r],...t,id:e,updatedAt:new Date().toISOString(),drawingsBySymbol:t.drawingsBySymbol?Object.fromEntries(Object.entries(t.drawingsBySymbol).map(([l,c])=>[v2(l),c])):o[r].drawingsBySymbol};return o[r]=a,localStorage.setItem(cm.LAYOUTS,JSON.stringify(o)),a}catch(n){throw console.error("Failed to update saved layout:",n),new Error("Failed to update layout")}}async deleteSavedLayout(e){await this.initialize();try{const t=localStorage.getItem(cm.LAYOUTS);if(!t)return;const o=JSON.parse(t).filter(a=>a.id!==e);localStorage.setItem(cm.LAYOUTS,JSON.stringify(o)),await this.getActiveSaveId()===e&&await this.setActiveSaveId(null)}catch(t){throw console.error("Failed to delete saved layout:",t),new Error("Failed to delete layout")}}async setActiveSaveId(e){try{e===null?localStorage.removeItem(cm.ACTIVE_SAVE_ID):localStorage.setItem(cm.ACTIVE_SAVE_ID,e)}catch(t){console.error("Failed to set active save ID:",t)}}async getActiveSaveId(){try{return localStorage.getItem(cm.ACTIVE_SAVE_ID)}catch(e){return console.error("Failed to get active save ID:",e),null}}async layoutNameExists(e,t){return(await this.listSavedLayouts()).some(o=>o.name===e&&o.id!==t)}async cleanup(){try{const e=localStorage.getItem(cm.LAYOUTS);if(!e)return;const t=JSON.parse(e),n=t.filter(g2);n.length!==t.length&&(localStorage.setItem(cm.LAYOUTS,JSON.stringify(n)),console.log(`🧹 Cleaned up ${t.length-n.length} invalid layouts`))}catch(e){console.error("Failed to cleanup storage:",e)}}}const XV=new d4;function bv(s,e,t,n,o,r,a){if(!i(e)||!t()||!o().editPaneId)return;const l=[a.zoneLookbackBars,a.minZoneBars,a.maxZoneBars,a.atrPeriod,a.volumeMAPeriod,a.minVolumeFactor,a.maxZoneWidthPct,a.priorTrendLookback,a.minOBVTrendStrength,a.minZoneScore,a.mergeNearbyZones?1:0,a.maxZonesDisplayed,a.showLabels?1:0];try{t().overrideIndicator({name:"SMART_MONEY",calcParams:l,paneId:o().editPaneId})}catch(c){console.error("SMART_MONEY realtime update failed:",c)}}function ZV(s,e,t){const n={id:Br(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}};b(e,H([...i(e),n])),t()}function qk(s,e,t,n){const o=e();o&&o.setStyles({median:{size:i(t),style:i(n)}})}function Uk(s,e,t,n){const o=e();o&&o.setStyles({slLong:{size:i(t),style:i(n)}})}function Gk(s,e,t,n){const o=e();o&&o.setStyles({slShort:{size:i(t),style:i(n)}})}function JV(s,e,t){const n=e();n&&n.setShowOutcomeBand(!!i(t))}function QV(s,e,t){const n=e();n&&n.setShowStopLines(!!i(t))}function eW(s,e,t){const n=e();n&&n.updateSettings({showTable:!!i(t)})}function tW(s,e,t){if(i(e))try{if(i(t).length>=10){console.warn("⚠️ Maximum number of EMV groups (10) reached");return}const o=i(t).length+1,r={id:Br(),name:`EMV #${o}`,period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"};i(t).push(r),console.log("✅ Added new EMV group:",r.name)}catch(n){console.error("❌ Error adding EMV group:",n)}}function sW(s,e,t,n){if(i(e))try{if(i(t).length>=10){console.warn("⚠️ Maximum number of MTM groups (10) reached");return}const r=i(t).length+1,a=["#2563eb","#8B5CF6","#F59E0B","#10B981","#EF4444","#EC4899","#06B6D4","#F97316"],l=i(t).length%a.length,c={id:Br(),name:`MTM #${r}`,period:14,color:a[l],thickness:2,lineStyle:"solid"};i(t).push(c),console.log("✅ Added new MTM group:",c.name),n()}catch(o){console.error("❌ Error adding MTM group:",o)}}function nW(s,e,t,n){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Br(),name:`BIAS${o}`,period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}),n()}function oW(s,e,t,n){if(!i(e))return;const o=i(t).length+1,r=o===1?"CCI":`CCI${o}`;i(t).push({id:Br(),name:r,period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}),console.log("➕ Added new CCI group:",r),n()}function iW(s,e,t,n){if(!i(e))return;const o=i(t)[i(t).length-1]||i(t)[0],r={id:Br(),start:(o==null?void 0:o.start)??.02,increment:(o==null?void 0:o.increment)??.02,maxValue:(o==null?void 0:o.maxValue)??.2,color:"#2563eb",dotSize:1};b(t,H([...i(t),r])),n()}function rW(s,e,t,n){if(!i(e))return;const o=["#00FF00","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],r=i(t).map(u=>u.styles.uptrend.color),a=o.filter(u=>!r.includes(u)),l=a.length>0?a[0]:o[i(t).length%o.length],c=i(t)[i(t).length-1]||i(t)[0],f={id:Br(),period:((c==null?void 0:c.period)||10)+2,multiplier:(c==null?void 0:c.multiplier)||3,showLabels:!0,styles:{uptrend:{color:l,thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}};b(t,H([...i(t),f])),console.log("✅ Added new Smart Trend group:",f),n()}function aW(s,e,t,n){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Br(),name:`DMI${o}`,diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new DMI group"),n()}function lW(s,e,t,n){if(!i(e))return;const o=i(t).length+1;i(t).push({id:Br(),name:`CR${o}`,crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}),console.log("➕ Added new CR group"),n()}function cW(s,e,t,n){if(!i(e))return;const o=["#26A69A","#EF5350","#8B5CF6","#F59E0B","#10B981","#F97316","#06B6D4","#84CC16"],r=i(t).length%o.length;i(t).push({id:Br(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:o[r]},decreasing:{color:o[(r+1)%o.length]},reverse:{color:"#c4c4c4"}}}),n()}function uW(s,e,t){b(e,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(t,!0)}function gy(s,e,t,n,o,r,a,l,c,f,u,d,h,p,v,x,S){if(i(e))return;if(i(t)){n();return}if(i(o)){r();return}if(i(a)){l();return}if(i(c)){f();return}if(u.length>=10)return;const C=u[u.length-1],I={...C,title:`${C.title.replace(/\d+$/,"")}${u.length+1}`};u.push(I),d.push(I.default||0),h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}),i(p)?v():i(x)&&S()}function dW(s,e,t,n,o,r,a,l,c,f,u,d,h,p,v){if(!i(e))return;const x=t().editPaneId||"candle_pane";i(o).push({id:Br(),paneId:x,period:i(r),stdDev:i(a),styles:{fillColor:i(l),fillOpacity:i(c),upperColor:i(f),middleColor:i(u),lowerColor:i(d),thickness:i(h),lineStyle:i(p)}}),v()}var fW=(s,e,t)=>e(i(t).id),pW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),hW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Fast</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Slow</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Signal</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">MACD Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Signal Line:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Positive Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Negative Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 sm:w-24 font-medium svelte-fy2ox8">Reverse Bar:</span> <button class="btn btn-xs btn-circle svelte-fy2ox8"></button></div></div></div>'),mW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MACD"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MACD</span></button></div></div>'),vW=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Zone Lookback Bars</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Prior Trend Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Bars</label> <input type="number" min="3" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Bars</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zone Width %</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.005" max="0.10" step="0.005" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Factor</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.5" max="2.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min OBV Trend</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="0.6" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Zone Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.3" max="0.9" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Merge Nearby Zones</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Overlap/adjacent similar zones merge</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Show Labels</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Type + score label</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Zones Displayed</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div>'),gW=(s,e,t)=>{e[9]=s.currentTarget.checked?1:0,t()},_W=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Resistance Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Support Lookback</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max Trap Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Spike (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="1.0" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Breakout Factor (%)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="number" step="0.0001" min="0.0000" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">e.g. 0.0005 = 0.05%</span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Wick Ratio</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Trap Score</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div></div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center justify-between bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="flex flex-col svelte-fy2ox8"><span class="text-xs font-medium svelte-fy2ox8">Stable Signal</span> <span class="text-[10px] text-base-content/60 svelte-fy2ox8">Show blue “Stable” dots</span></div> <input type="checkbox" class="toggle toggle-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normal Quiet Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm w-28 svelte-fy2ox8"></div></div></div>'),yW=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Compression Inputs</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Behavior</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),bW=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Detection Parameters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">BB StdDev</label> <input type="number" step="0.1" min="0.1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ATR Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Volume MA Period</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Normalize Lookback</label> <input type="number" min="10" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Pressure SMA</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 mb-2 svelte-fy2ox8">Alert & Breakout Filters</div> <div class="grid grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Pressure for Alert</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Confirmation Bars</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Volume Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Range Expansion (x)</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.8" max="3.0" step="0.05" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Body % of Range</label> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.0" max="1.0" step="0.01" class="range range-xs flex-1 svelte-fy2ox8"> <span class="text-xs w-10 text-right svelte-fy2ox8"> </span></div></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Breakout Lookback</label> <input type="number" min="5" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Min Bars Between Signals</label> <input type="number" min="1" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8"></div></div></div></div>'),xW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),wW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Middle</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">RSI Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change RSI Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Lines</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Middle Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Middle Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div> <div class="flex items-center justify-between mt-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Fill Opacity</span> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="range" min="0.05" max="0.5" step="0.05" class="range range-xs w-20 svelte-fy2ox8"> <span class="text-xs text-base-content/60 w-8 svelte-fy2ox8"> </span></div></div></div></div>'),kW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More RSI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add RSI</span></button></div></div>'),SW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),CW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%K Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">%D Period</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="1" max="50"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="50" max="100"></div> <div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="50"></div></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="space-y-1 svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Mid Level</label> <input type="number" class="input input-xs w-full bg-base-100 border-base-300 text-xs svelte-fy2ox8" min="0" max="100"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%K Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %K Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/70 svelte-fy2ox8">%D Line</span> <div class="flex items-center gap-2 svelte-fy2ox8"><button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change %D Line Color"></button> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-12 svelte-fy2ox8"><option class="svelte-fy2ox8">1</option><option class="svelte-fy2ox8">2</option><option class="svelte-fy2ox8">3</option><option class="svelte-fy2ox8">4</option><option class="svelte-fy2ox8">5</option></select> <select class="select select-xs bg-base-100 border-base-300 text-xs min-h-0 h-6 w-16 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 border-t border-base-200 pt-2 svelte-fy2ox8"><span class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Level Colors</span> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Overbought Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Oversold Color"></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Mid Line</span> <button class="w-6 h-6 rounded border border-base-300 flex-shrink-0 svelte-fy2ox8" title="Change Mid Line Color"></button></div></div></div>'),IW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 sm:gap-2 svelte-fy2ox8" title="Add More Stochastic"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Stochastic</span></button></div></div>'),PW=(s,e,t)=>e(i(t).id),MW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),NW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">DI Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">ADX Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI+:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">DI-:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">ADX:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),AW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More DMI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add DMI</span></button></div></div>'),TW=(s,e,t)=>e(i(t).id),FW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),LW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Overbought</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-50" max="0"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Middle Level</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-70" max="-30"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Oversold</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="-100" max="-50"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">WR Line:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 border-b border-base-200 pb-1 svelte-fy2ox8">Level Lines</div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Overbought:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Middle:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-20 font-medium svelte-fy2ox8">Oversold:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),EW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Williams %R"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Williams %R</span></button></div></div>'),$W=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),DW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 sm:col-span-1 col-span-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Main Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Short Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/70 svelte-fy2ox8">VR Long Line</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),RW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More VR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More VR</span></button></div></div>'),jW=(s,e,t)=>e(i(t).id),BW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),OW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 3</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 4</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),zW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BBI"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BBI</span></button></div></div>'),VW=(s,e,t)=>e(i(t).id),WW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),HW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 1</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period 2</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),qW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More EMV"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add EMV</span></button></div></div>'),UW=(s,e,t)=>e(i(t).id),GW=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),YW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-1 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),KW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More MTM"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add MTM</span></button></div></div>'),XW=(s,e,t)=>e(i(t).id),ZW=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove this AO"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Short Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Long Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">Histogram Colors</label> <div class="grid grid-cols-1 gap-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Increasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Decreasing Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Reverse Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div></div>'),JW=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More Awesome Oscillator"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add More AO</span></button></div></div>'),QW=(s,e,t)=>e(i(t).id),eH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),tH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">CR Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA1 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA2 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA3 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">MA4 Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">CR:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA1:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA2:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA3:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">MA4:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),sH=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-xs sm:btn-sm btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CR"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CR</span></button></div></div>'),nH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Deviation %</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50" step="0.1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Depth</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="50"></div></div> <div class="border-t border-base-300 pt-2 mt-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 mb-2 block svelte-fy2ox8">ZigZag Line Style</label> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Thickness</span> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Line Style</span> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),oH=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ZigZag"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ZigZag</button></div></div>'),iH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this PVT instance">✕</button>'),rH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),aH=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More PVT</button></div></div>'),lH=(s,e,t)=>e(i(t).id),cH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove SAR Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),uH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Start</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Increment</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.001" max="0.1" step="0.001"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Max value</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="1.0" step="0.01"></div></div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Dot size:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div></div></div>'),dH=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-primary svelte-fy2ox8">➕ Add More SAR</button></div></div>'),fH=(s,e,t)=>e(i(t).id),pH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Smart Trend Group"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),hH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="100" step="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Multiplier</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show Labels</label></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Uptrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="text-xs font-medium text-base-content/80 svelte-fy2ox8">Downtrend Line</div> <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-20 sm:w-24 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div></div>'),mH=be('<div class="space-y-2 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary svelte-fy2ox8" title="Add more Smart Trend"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add Smart Trend</button></div></div>'),vH=(s,e)=>e(),gH=be('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete EMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),_H=be('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),yH=(s,e)=>e(),bH=(s,e)=>e(),xH=be('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),wH=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),kH=be('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more EMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add EMA</button></div>'),SH=be('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),CH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Delete this SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),IH=be('<div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/70 font-medium svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-sm svelte-fy2ox8" min="1" max="500"></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Color</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Thickness</label> <select class="select select-bordered select-xs w-20 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Line Style</label> <select class="select select-bordered select-xs w-24 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),PH=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center mt-3 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div></div>'),MH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Volume"><span class="text-xs svelte-fy2ox8">×</span></button>'),NH=be('<div class="w-6 svelte-fy2ox8"></div>'),AH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs svelte-fy2ox8" min="1" max="200"></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Volume Histogram</h4> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Up Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Down Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div> <div class="space-y-2 svelte-fy2ox8"><h4 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">EMA Line</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-sm svelte-fy2ox8"> <label class="text-xs text-base-content/60 svelte-fy2ox8">Show EMA with Volume</label></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),TH=be('<div class="space-y-3 mt-3 svelte-fy2ox8"></div>'),FH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove TRIX"><span class="text-xs svelte-fy2ox8">×</span></button>'),LH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">TRIX:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Signal:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">TRIX Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-xs text-base-content/60 svelte-fy2ox8">Signal Line:</span> <div class="w-3 h-2 rounded svelte-fy2ox8"></div></div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <input type="color" class="w-8 h-6 rounded border border-base-300 cursor-pointer svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs w-12 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),EH=(s,e)=>e(),$H=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add More TRIX"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More TRIX</button></div></div>'),DH=(s,e,t)=>e(i(t).id),RH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove BIAS"><span class="text-xs svelte-fy2ox8">×</span></button>'),jH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),BH=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More BIAS"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add BIAS</span></button></div></div>'),OH=(s,e,t)=>e(i(t).id),zH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove CCI"><span class="text-xs svelte-fy2ox8">×</span></button>'),VH=be('<div class="bg-base-50 border border-base-200 rounded-md p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-xs sm:text-sm font-medium text-base-content/80 svelte-fy2ox8"></span> <!></div> <div class="flex items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="text-xs sm:text-sm text-base-content/60 w-12 sm:w-16 flex-shrink-0 svelte-fy2ox8">Period:</span> <input type="number" class="input input-bordered input-xs sm:input-sm flex-1 max-w-16 sm:max-w-20 text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs svelte-fy2ox8"><div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Color:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Width:</span> <select class="select select-bordered select-xs w-12 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option></select></div> <div class="flex items-center gap-1 svelte-fy2ox8"><span class="text-base-content/60 text-xs svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-14 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dash</option><option class="svelte-fy2ox8">Dot</option></select></div></div></div>'),WH=be('<div class="space-y-3 mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-2 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add More CCI"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add CCI</span></button></div></div>'),HH=be('<button class="btn btn-xs btn-circle btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),qH=be('<div class="grid grid-cols-1 sm:grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 items-center px-1 py-2 border-b border-base-200 last:border-b-0 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><div class="w-4 h-4 rounded-full border border-base-300 svelte-fy2ox8"></div> <span class="text-sm font-medium text-base-content svelte-fy2ox8"> </span></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-sm w-24 text-center svelte-fy2ox8" min="1" max="200"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Color</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-5 h-5 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Thickness</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><span class="text-xs text-base-content/60 sm:hidden svelte-fy2ox8">Style</span> <select class="select select-bordered select-xs flex-1 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),UH=be('<div class="space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><span class="text-sm sm:text-base font-medium text-base-content/80 svelte-fy2ox8"> </span> <!></div> <div class="hidden sm:grid grid-cols-[1.4fr_0.8fr_0.8fr_0.8fr_0.9fr] gap-3 text-xs text-base-content/60 px-1 svelte-fy2ox8"><div class="svelte-fy2ox8">Component</div> <div class="svelte-fy2ox8">Period</div> <div class="svelte-fy2ox8">Color</div> <div class="svelte-fy2ox8">Thickness</div> <div class="svelte-fy2ox8">Style</div></div> <!></div>'),GH=be('<div class="mt-3 sm:mt-5 svelte-fy2ox8"><div class="border border-base-300 rounded-lg p-4 bg-base-50/50 svelte-fy2ox8"><div class="flex items-center gap-3 mb-6 pb-4 border-b border-base-200 svelte-fy2ox8"><div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" class="svelte-fy2ox8"></path></svg></div> <div class="svelte-fy2ox8"><h3 class="text-lg font-semibold text-base-content svelte-fy2ox8">Ichimoku Kinko Hyo</h3> <p class="text-sm text-base-content/60 svelte-fy2ox8">Complete cloud indicator with all components</p></div></div> <div class="space-y-6 svelte-fy2ox8"></div> <div class="flex justify-center pt-4 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 svelte-fy2ox8" title="Add Ichimoku"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> <span class="text-xs sm:text-sm svelte-fy2ox8">Add Ichimoku</span></button></div> <div class="mt-6 pt-4 border-t border-base-200 svelte-fy2ox8"><div class="text-xs text-base-content/60 space-y-1 svelte-fy2ox8"><p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Components:</strong> Tenkan Sen (Conversion), Kijun Sen (Base), Senkou Span A & B (Cloud)</p> <p class="svelte-fy2ox8"><strong class="svelte-fy2ox8">Usage:</strong> Trend direction, support/resistance levels, and momentum analysis</p></div></div></div></div>'),YH=be('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete SMA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),KH=be('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),XH=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),ZH=be('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more SMA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add SMA</button></div>'),JH=be('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),QH=(s,e)=>e(),eq=be('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete MA parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),tq=be('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),sq=(s,e)=>e(),nq=(s,e)=>e(),oq=be('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div>'),iq=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-20 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <!></div>'),rq=be('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8" title="Add more MA"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> Add MA</button></div>'),aq=be('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),lq=(s,e,t)=>e(i(t).id),cq=be('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),uq=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),dq=be('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more ROC"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More ROC</button></div></div>'),fq=(s,e,t)=>e(i(t).id),pq=be('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),hq=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (PSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">PSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 2 (MAPSY Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAPSY Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex items-center gap-2 pt-2 svelte-fy2ox8"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm svelte-fy2ox8"> <label class="text-sm text-base-content/80 cursor-pointer svelte-fy2ox8">Show MAPSY</label></div></div></div>'),mq=be('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more PSY"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More PSY</button></div></div>'),vq=(s,e,t)=>e(i(t).id),gq=be('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),_q=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="flex flex-col gap-2 svelte-fy2ox8" style="display: none;"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">Param 1 (OBV Period)</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">OBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex flex-col gap-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Period</span> <input type="number" class="input input-bordered input-xs text-xs w-full max-w-24 svelte-fy2ox8"> <span class="text-xs text-base-content/50 svelte-fy2ox8">Moving average period for OBV smoothing</span></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">MAOBV Line Style</span> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-3 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-[45px] svelte-fy2ox8">Color:</label> <button class="btn btn-xs btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[60px] svelte-fy2ox8">Thickness:</span> <select class="select select-bordered select-xs w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-3 svelte-fy2ox8"><span class="text-base-content/60 text-xs min-w-[35px] svelte-fy2ox8">Style:</span> <select class="select select-bordered select-xs w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div></div>'),yq=be('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more OBV"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More OBV</button></div></div>'),bq=(s,e,t)=>e(i(t).id),xq=be('<button class="btn btn-xs btn-ghost text-error hover:bg-error/10 svelte-fy2ox8" title="Remove KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),wq=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8"></h4> <!></div> <div class="space-y-3 svelte-fy2ox8"><div class="grid grid-cols-2 gap-2 sm:gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">K Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">D Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1"></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">K Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">K:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">D Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">D:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div> <div class="space-y-2 svelte-fy2ox8"><span class="text-base-content/70 text-xs font-medium svelte-fy2ox8">J Line Style</span> <div class="flex items-center gap-2 text-xs text-base-content/70 svelte-fy2ox8"><span class="w-12 font-medium svelte-fy2ox8">J:</span> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button> <select class="select select-bordered select-xs w-14 sm:w-16 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select> <select class="select select-bordered select-xs w-16 sm:w-20 text-xs svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),kq=be('<div class="space-y-2 sm:space-y-3 mt-2 sm:mt-3 svelte-fy2ox8"><!> <div class="flex justify-center pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more KDJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More KDJ</button></div></div>'),Sq=(s,e)=>e("band"),Cq=(s,e)=>e("slLong"),Iq=(s,e)=>e("slShort"),Pq=(s,e)=>e("median"),Mq=be('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Outcome Band</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Band:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Fill Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Stop Lines</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Stops:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short SL Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Long Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Short Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Median Path</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option></select></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">EV Table</h4> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Show Table:</label> <input type="checkbox" class="toggle toggle-xs svelte-fy2ox8"></div></div></div>'),Nq=(s,e)=>e("fill",0),Aq=(s,e)=>e("upper",0),Tq=(s,e)=>e("middle",0),Fq=(s,e)=>e("lower",0),Lq=(s,e)=>e(0),Eq=be('<button class="btn btn-xs btn-outline btn-error gap-1 text-xs svelte-fy2ox8" title="Remove BOLL 1"><svg class="w-3 h-3 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg> Remove BOLL 1</button>'),$q=(s,e,t)=>e(i(t)),Dq=(s,e,t)=>e("fill",i(t)),Rq=(s,e,t)=>e("upper",i(t)),jq=(s,e,t)=>e("middle",i(t)),Bq=(s,e,t)=>e("lower",i(t)),Oq=be('<div class="bg-base-50 border border-primary/20 rounded-md p-3 space-y-3 mt-3 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><h4 class="text-sm font-semibold text-primary svelte-fy2ox8"> </h4> <button class="btn btn-xs btn-ghost text-error svelte-fy2ox8"><svg class="w-3.5 h-3.5 svelte-fy2ox8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Fill Area</h5> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Colors</h5> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h5 class="text-xs font-medium text-base-content/70 svelte-fy2ox8">Line Style</h5> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div></div>'),zq=be('<div class="space-y-4 mt-3 svelte-fy2ox8"><div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Parameters</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Period</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="1" max="200"></div> <div class="flex flex-col gap-1 svelte-fy2ox8"><label class="text-xs text-base-content/60 svelte-fy2ox8">Standard Deviation</label> <input type="number" class="input input-bordered input-xs sm:input-sm text-xs sm:text-sm svelte-fy2ox8" min="0.1" max="10" step="0.1"></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Fill Area Settings</h4> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Fill Color</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between svelte-fy2ox8"><label class="text-xs text-base-content/70 svelte-fy2ox8">Opacity</label> <span class="text-xs font-medium text-primary svelte-fy2ox8"> </span></div> <input type="range" class="range range-primary range-xs svelte-fy2ox8" min="0" max="100" step="1"> <div class="flex justify-between text-xs text-base-content/50 svelte-fy2ox8"><span class="svelte-fy2ox8">0%</span> <span class="svelte-fy2ox8">50%</span> <span class="svelte-fy2ox8">100%</span></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Colors</h4> <div class="space-y-2 svelte-fy2ox8"><div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Upper Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Middle Line (SMA)</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div> <div class="flex items-center justify-between gap-2 px-2 py-1.5 rounded bg-base-100 border border-base-200 svelte-fy2ox8"><span class="text-xs text-base-content/70 flex-1 svelte-fy2ox8">Lower Band</span> <div class="flex items-center gap-2 svelte-fy2ox8"><div class="w-6 h-6 rounded border-2 border-base-300 svelte-fy2ox8"></div> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div></div></div></div> <div class="bg-base-50 border border-base-200 rounded-md p-3 space-y-3 svelte-fy2ox8"><h4 class="text-sm font-medium text-base-content/80 svelte-fy2ox8">Line Style</h4> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div> <div class="flex justify-center gap-2 pt-1 svelte-fy2ox8"><button class="btn btn-xs btn-outline btn-primary gap-1 text-xs svelte-fy2ox8" title="Add more BOLL"><svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg> + Add More BOLL</button> <!></div> <!></div>'),Vq=be('<div class="flex justify-center items-center min-h-[120px] svelte-fy2ox8"><div class="text-base-content/70 svelte-fy2ox8"> </div></div>'),Wq=be('<button class="btn btn-sm btn-circle btn-ghost text-error hover:bg-error/10 flex-shrink-0 svelte-fy2ox8" title="Delete parameter"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M6 18L18 6M6 6l12 12" class="svelte-fy2ox8"></path></svg></button>'),Hq=be('<div class="w-8 flex-shrink-0 svelte-fy2ox8"></div>'),qq=be('<div class="border border-base-300 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 svelte-fy2ox8"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 svelte-fy2ox8"><span class="w-full sm:w-16 text-base-content/70 text-sm font-medium min-w-fit svelte-fy2ox8"> </span> <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0 svelte-fy2ox8"><input type="number" class="flex-1 input input-bordered input-sm min-w-0 svelte-fy2ox8"> <!></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 svelte-fy2ox8"><div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Color:</label> <button class="btn btn-sm btn-outline svelte-fy2ox8"><div class="w-4 h-4 rounded border border-base-300 svelte-fy2ox8"></div></button></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Thickness:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">1px</option><option class="svelte-fy2ox8">2px</option><option class="svelte-fy2ox8">3px</option><option class="svelte-fy2ox8">4px</option><option class="svelte-fy2ox8">5px</option></select></div> <div class="flex items-center gap-2 svelte-fy2ox8"><label class="text-xs text-base-content/60 min-w-fit svelte-fy2ox8">Style:</label> <select class="select select-bordered select-xs flex-1 min-w-0 svelte-fy2ox8"><option class="svelte-fy2ox8">Solid</option><option class="svelte-fy2ox8">Dashed</option><option class="svelte-fy2ox8">Dotted</option></select></div></div></div>'),Uq=be('<div class="flex justify-center mt-4 svelte-fy2ox8"><button class="btn btn-sm btn-outline btn-primary svelte-fy2ox8"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 svelte-fy2ox8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 4v16m8-8H4" class="svelte-fy2ox8"></path></svg></button></div>'),Gq=be('<div class="space-y-3 sm:space-y-4 mt-3 sm:mt-5 svelte-fy2ox8"><!> <!></div>'),Yq=be('<div class="ai-branding-container svelte-fy2ox8"><div class="ai-branding-badge svelte-fy2ox8"><svg class="ai-branding-icon svelte-fy2ox8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-fy2ox8"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-fy2ox8"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-fy2ox8"></line></svg> <div class="ai-branding-text svelte-fy2ox8"><div class="ai-branding-main svelte-fy2ox8">Duty AI Algorithm Included</div> <div class="ai-branding-sub svelte-fy2ox8">Powered by Duty AI</div></div> <div class="ai-branding-glow svelte-fy2ox8"></div></div></div>'),Kq=be('<div class="responsive-modal-content svelte-fy2ox8"><!> <!></div>'),Xq=be("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Zq(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(f,"$chart",t),o=()=>Ml(l,"$ctx",t),r=()=>Ml(c,"$save",t);let a=bi(e,"show",15);const l=hd("ctx"),c=hd("save"),f=hd("chart");let u=H([]),d=H([]),h=H([]);function p(k){const N=(k||"").trim();if(!N)return null;if(/^#?[0-9A-Fa-f]{6}$/.test(N)){const F=N.startsWith("#")?N.slice(1):N;return{r:parseInt(F.slice(0,2),16),g:parseInt(F.slice(2,4),16),b:parseInt(F.slice(4,6),16)}}const R=N.match(/^rgba?\(([^)]+)\)$/i);if(R){const F=R[1].split(",").map(z=>parseFloat(z.trim()));if(F.length>=3&&F.every(z=>!isNaN(z)))return{r:Math.round(F[0]),g:Math.round(F[1]),b:Math.round(F[2])}}return null}function v(k,N){const R=p(k);if(!R)return k;const F=Math.max(0,Math.min(100,N))/100;return`rgba(${R.r}, ${R.g}, ${R.b}, ${F})`}let x=_e("#2196F3"),S=_e(5),C=_e("#f23645"),I=_e("#2962ff"),A=_e("#089981"),P=_e(1),T=_e("solid"),j=_e(20),E=_e(2),L=_e(!1),D=_e(H({x:0,y:0})),X=_e(0),ne=_e("macdLine"),de=_e(!1),ie=_e(H({x:0,y:0})),te=_e(0),le=_e(!1),pe=_e(H({x:0,y:0})),re=_e(0),xe=_e("diPlus"),se=_e(!1),Ne=_e(H({x:0,y:0})),Te=_e(!1),Me=_e(H({x:0,y:0})),De=_e(!1),Oe=_e(H({x:0,y:0})),Ke=_e(0),kt=_e(!1),pt=_e(H({x:0,y:0})),Rt=_e(0),Ht=_e(!1),Ft=_e(H({x:0,y:0})),zt=_e(H([])),ut=_e(!1),nt=_e(H({x:0,y:0})),Je=_e(0),it=_e("histogram"),ze=_e(!1),Ge=_e(H({x:0,y:0})),xt=_e(!1),jt=_e(H({x:0,y:0})),ft=_e(!1),ke=_e(H({x:0,y:0})),Se=_e(!1),Et=_e(H({x:0,y:0})),wt=_e(0),Ls=_e(!1),tn=_e(H({x:0,y:0})),Gs=_e(0),an=_e("vr"),Es=_e(!1),Ns=_e(H({x:0,y:0})),Hs=_e(0),ns=_e(!1),fs=_e(H({x:0,y:0})),Mn=_e(0),po=_e(!1),Tn=_e(H({x:0,y:0})),Cn=_e(0),go=_e(!1),no=_e(H({x:0,y:0})),Bo=_e(!1),Vo=_e(H({x:0,y:0})),Rl=_e(0),aa=_e(!1),tl=_e(H({x:0,y:0})),Zr=_e(0),zi=_e(!1),Nl=H({x:0,y:0}),mu=_e(0),Gc=_e("uptrend"),du=_e(!1),Ju=_e(H({x:0,y:0})),rd=_e(0),Al=_e(!1),sa=_e(H({x:0,y:0})),Vc=_e(!1),vu=_e(H({x:0,y:0})),Qc=_e(!1),To=_e(H({x:0,y:0})),ec=_e(0),yl=_e(!1),Dc=_e(H({x:0,y:0})),jl=_e(0),qi=_e("cr"),la=_e(!1),El=_e(H({x:0,y:0})),qu=_e(!1),Td=_e(H({x:0,y:0})),ki=_e(!1),sl=_e(H({x:0,y:0})),br=_e(0),Wc=_e(!1),Xd=_e(H({x:0,y:0})),Uf=_e(!1),xf=_e(H({x:0,y:0})),Uu=_e(!1),tp=H({x:0,y:0}),wf=_e(!1),Vs=H({x:0,y:0}),kn=_e(!1),Kn=_e(H({x:0,y:0})),Bs=_e(!1),bo=_e(H({x:0,y:0})),lo=_e(!1),Qi=_e(H({x:0,y:0})),xr=_e(!1),Ai=_e(H({x:0,y:0})),ri=_e(!1),Ti=_e(H({x:0,y:0})),Eo=_e(!1),hr=_e(H({x:0,y:0})),ei=_e(!1),ai=_e(H({x:0,y:0})),vi=_e(!1),_a=_e(H({x:0,y:0})),dl=_e(!1),ar=_e(H({x:0,y:0})),Jr=_e(1),nl=_e("solid"),tc=_e(1),mc=_e("dashed"),gu=_e(1),Bl=_e("dashed"),Ui=_e(22),Ol=_e("#66c2a5"),fl=_e("#66c2a5"),bl=_e("#e67e22"),Ua=_e("#c0392b"),er=_e(!0),ba=_e(!0),ol=_e(!0),xd=_e(!1),_u=_e(H({x:0,y:0})),eu=_e(0),ca=_e(!1),vc=_e(H({x:0,y:0})),rc=_e(0),wd=_e(0),zl=_e(0),Fd=_e(!1),Tl=_e(H({x:0,y:0})),xa=_e(0),ku=_e(!1),Qu=_e(H({x:0,y:0})),ed=_e(0),td=_e(!1),sp=_e(H({x:0,y:0})),Gf=_e(0),kd=_e(!1),Zd=_e(!1),gc=_e(!1),jf=_e(!1),Nf=_e(!1),Jd=_e(H({x:0,y:0})),xl=_e(0);function Su(k,N){if(n()){try{n().removeIndicator({paneId:k,name:N})}catch(R){console.log("Error removing indicator:",R)}c.update(R=>{const F=`${k}_${N}`;return delete R.saveInds[F],R})}}const ad=Lt(()=>o().editIndName==="BOLL"),Af=Lt(()=>o().editIndName==="MACD"),fu=Lt(()=>o().editIndName==="BIAS"),$u=Lt(()=>o().editIndName==="AO"),yu=Lt(()=>o().editIndName==="WR"),Yf=Lt(()=>o().editIndName==="VR"),Ga=Lt(()=>o().editIndName==="BBI"),nf=Lt(()=>o().editIndName==="EMA"),Sd=Lt(()=>o().editIndName==="SMA"),wp=Lt(()=>o().editIndName==="MA"),ac=Lt(()=>o().editIndName==="ICHIMOKU"),Ld=Lt(()=>o().editIndName==="PVT"),Cu=Lt(()=>o().editIndName==="VOL"),Ie=Lt(()=>o().editIndName==="SAR"),ge=Lt(()=>o().editIndName==="DMI"),Re=Lt(()=>o().editIndName==="TRIX"),vt=Lt(()=>o().editIndName==="ROC"),Bt=Lt(()=>o().editIndName==="ZIGZAG"),Xt=Lt(()=>o().editIndName==="PSY"),W=Lt(()=>o().editIndName==="OBV"),Q=Lt(()=>o().editIndName==="CR"),O=Lt(()=>o().editIndName==="NPO_MAE"),U=Lt(()=>o().editIndName==="KDJ"),ce=Lt(()=>o().editIndName==="CCI"),G=Lt(()=>o().editIndName==="EMV"),ye=Lt(()=>o().editIndName==="MTM"),Qe=Lt(()=>o().editIndName==="RSI"),Ue=Lt(()=>o().editIndName==="STOCH"),dt=Lt(()=>o().editIndName==="SMARTTREND"),et=Lt(()=>o().editIndName==="SMART_MONEY"),B=Lt(()=>o().editIndName==="TRAP_HUNTER"),ve=Lt(()=>o().editIndName==="VOLCANIC"),Fe=Lt(()=>o().editIndName==="VOLCANIC_SIG"),ot=Lt(()=>i(et)||i(B)||i(ve)||i(Fe));function tt(){if(!(o().editIndName!=="TRAP_HUNTER"||!n()))try{const k=(u||[]).map(N=>Number(N));n().overrideIndicator({name:"TRAP_HUNTER",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating Trap Hunter:",k)}}function St(){if(!(o().editIndName!=="VOLCANIC"||!n()))try{const k=(u||[]).map(N=>Number(N));n().overrideIndicator({name:"VOLCANIC",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating VOLCANIC:",k)}}function Be(){if(!(o().editIndName!=="VOLCANIC_SIG"||!n()))try{const k=(u||[]).map(N=>Number(N));n().overrideIndicator({name:"VOLCANIC_SIG",calcParams:k,paneId:o().editPaneId})}catch(k){console.error("❌ Error updating VOLCANIC_SIG:",k)}}let je=_e("");Xr(()=>{if(!i(ve))return;const k=JSON.stringify(u??[]);k!==i(je)&&(b(je,H(k)),St())});let Mt=_e("");Xr(()=>{if(!i(Fe))return;const k=JSON.stringify(u??[]);k!==i(Mt)&&(b(Mt,H(k)),Be())});const Ze=Lt(()=>o().editIndName==="SMARTTREND"?"Smart Trend":o().editIndName);let rs=_e("#2962FF"),yn=_e(2),Qn=_e("solid"),wn=_e(26),xo=_e(10),hi=_e(20),Ln=_e(40),pl=_e(60),vn=H({zoneLookbackBars:40,minZoneBars:5,maxZoneBars:25,atrPeriod:14,volumeMAPeriod:20,minVolumeFactor:1.2,maxZoneWidthPct:.03,priorTrendLookback:20,minOBVTrendStrength:.2,minZoneScore:.6,mergeNearbyZones:!0,maxZonesDisplayed:20,showLabels:!0});function mo(){if(!i(et)||!Array.isArray(u))return;const k=u;vn.zoneLookbackBars=Number(k[0]??vn.zoneLookbackBars),vn.minZoneBars=Number(k[1]??vn.minZoneBars),vn.maxZoneBars=Number(k[2]??vn.maxZoneBars),vn.atrPeriod=Number(k[3]??vn.atrPeriod),vn.volumeMAPeriod=Number(k[4]??vn.volumeMAPeriod),vn.minVolumeFactor=Number(k[5]??vn.minVolumeFactor),vn.maxZoneWidthPct=Number(k[6]??vn.maxZoneWidthPct),vn.priorTrendLookback=Number(k[7]??vn.priorTrendLookback),vn.minOBVTrendStrength=Number(k[8]??vn.minOBVTrendStrength),vn.minZoneScore=Number(k[9]??vn.minZoneScore),vn.mergeNearbyZones=Number(k[10]??(vn.mergeNearbyZones?1:0))>0,vn.maxZonesDisplayed=Number(k[11]??vn.maxZonesDisplayed),vn.showLabels=Number(k[12]??(vn.showLabels?1:0))>0}Xr(()=>{i(et)&&mo()});function Gi(){var N;const k=[vn.zoneLookbackBars,vn.minZoneBars,vn.maxZoneBars,vn.atrPeriod,vn.volumeMAPeriod,vn.minVolumeFactor,vn.maxZoneWidthPct,vn.priorTrendLookback,vn.minOBVTrendStrength,vn.minZoneScore,vn.mergeNearbyZones?1:0,vn.maxZonesDisplayed,vn.showLabels?1:0];(N=n())==null||N.overrideIndicator({name:"SMART_MONEY",calcParams:k,paneId:o().editPaneId}),c.update(R=>(R.saveInds[`${o().editPaneId}_SMART_MONEY`]={name:"SMART_MONEY",params:k,pane_id:o().editPaneId},R))}let La=_e("#FF6B35"),lc=_e("#2196F3"),wl=_e("#4CAF50"),mf=_e("#FF9800"),mp=_e("#9C27B0"),_c=_e(2),Ea=_e(1),Tf=_e(1),Sr=_e(1),Oa=_e(1),lr=_e("solid"),mr=_e("solid"),Cr=_e("solid"),hl=_e("solid"),ls=_e("solid");Xr(()=>{i(vt)&&!i(wa)?(console.log("🎯 ROC modal opened, initializing..."),b(wa,!0),fr(),setTimeout(()=>{sh()},100)):!i(vt)&&i(wa)&&b(wa,!1)});let ws=_e(!1),Fs=_e(!1);Xr(()=>{i(Qe)&&!i(ws)?(console.log("🎯 RSI modal opened, initializing..."),b(ws,!0),ch()):!i(Qe)&&i(ws)&&b(ws,!1)}),Xr(()=>{i(Ue)&&!i(Fs)?(console.log("🎯 Stochastic modal opened, initializing..."),b(Fs,!0),Iv()):!i(Ue)&&i(Fs)&&b(Fs,!1)}),Xr(()=>{i(Re)&&!i(yc)?(console.log("🎯 TRIX modal opened, initializing..."),b(yc,!0),kl()):!i(Re)&&i(yc)&&b(yc,!1)});let to=_e(!1);Xr(()=>{i(Sd)&&!i(to)?(console.log("🎯 SMA modal opened, initializing..."),b(to,!0),nn()):!i(Sd)&&i(to)&&b(to,!1)});let cr=_e(!1);Xr(()=>{i(Yf)&&!i(cr)?(console.log("🎯 VR modal opened, initializing..."),b(cr,!0),vm()):!i(Yf)&&i(cr)&&b(cr,!1)});let io=_e(!1);Xr(()=>{i(Cu)&&!i(io)?(console.log("🎯 Volume modal opened, initializing..."),b(io,!0),pg()):!i(Cu)&&i(io)&&b(io,!1)});let Yl=_e(!1);Xr(()=>{i(Ga)&&!i(Yl)?(console.log("🎯 BBI modal opened, initializing..."),b(Yl,!0),Go()):!i(Ga)&&i(Yl)&&b(Yl,!1)}),Xr(()=>{i(Ga)&&i(Yl)&&n()&&i(Qd).forEach((k,N)=>{const{period1:R,period2:F,period3:z,period4:q,color:he,thickness:Ee,lineStyle:lt}=k;if(R&&F&&z&&q&&he&&Ee&&lt){const Qt=setTimeout(()=>{Gt(N)},100);return()=>clearTimeout(Qt)}})});let na=_e(!1);Xr(()=>{i(ad)&&!i(na)?(console.log("🎯 Bollinger Bands modal opened, initializing..."),b(na,!0),We()):!i(ad)&&i(na)&&b(na,!1)}),Xr(()=>{if(i(ad)&&i(na)&&n()){const k=i(j),N=i(E),R=i(x),F=i(S),z=i(C),q=i(I),he=i(A),Ee=i(P),lt=i(T);if(k&&N&&R&&z&&q&&he&&Ee&&lt){const Qt=setTimeout(()=>{i(Hl).length===0?b(Hl,H([{id:Br(),paneId:o().editPaneId||"candle_pane",period:k,stdDev:N,styles:{fillColor:R,fillOpacity:F,upperColor:z,middleColor:q,lowerColor:he,thickness:Ee,lineStyle:lt}}])):(i(Hl)[0].period=k,i(Hl)[0].stdDev=N,i(Hl)[0].styles.fillColor=R,i(Hl)[0].styles.fillOpacity=F,i(Hl)[0].styles.upperColor=z,i(Hl)[0].styles.middleColor=q,i(Hl)[0].styles.lowerColor=he,i(Hl)[0].styles.thickness=Ee,i(Hl)[0].styles.lineStyle=lt),Gn()},100);return()=>clearTimeout(Qt)}}});let Od=_e(!1);Xr(()=>{i(Ie)&&!i(Od)?(console.log("🎯 SAR modal opened, initializing..."),b(Od,!0),zd()):!i(Ie)&&i(Od)&&b(Od,!1)}),Xr(()=>{i(Ie)&&i(Od)&&n()&&i(cc).forEach((k,N)=>{const{start:R,increment:F,maxValue:z,color:q,dotSize:he}=k;if(R!==void 0&&F!==void 0&&z!==void 0&&q&&he){const Ee=setTimeout(()=>{ef(N)},100);return()=>clearTimeout(Ee)}})});let qr=_e(!1);Xr(()=>{i($u)&&!i(qr)?(console.log("🎯 AO modal opened, initializing..."),b(qr,!0),ae()):!i($u)&&i(qr)&&b(qr,!1)}),Xr(()=>{i($u)&&i(qr)&&n()&&i(Iu).forEach((k,N)=>{const{shortPeriod:R,longPeriod:F,styles:z}=k;if(R&&F&&z){const q=setTimeout(()=>{He()},100);return()=>clearTimeout(q)}})});let za=_e(!1);Xr(()=>{i(fu)&&!i(za)?(console.log("🎯 BIAS modal opened, initializing..."),b(za,!0),Ya()):!i(fu)&&i(za)&&b(za,!1)}),Xr(()=>{i(fu)&&i(za)&&n()&&i(oo).forEach((k,N)=>{const{period:R,color:F,thickness:z,lineStyle:q}=k;if(R&&F&&z&&q){const he=setTimeout(()=>{Kl()},100);return()=>clearTimeout(he)}})});let Yc=_e(!1);Xr(()=>{i(ye)&&!i(Yc)?(console.log("🎯 MTM modal opened, initializing..."),b(Yc,!0),zg()):!i(ye)&&i(Yc)&&b(Yc,!1)}),Xr(()=>{i(ye)&&i(Yc)&&n()&&i(Or).forEach((k,N)=>{const{period:R,color:F,thickness:z,lineStyle:q}=k;if(R&&F&&z&&q){const he=setTimeout(()=>{Hh()},100);return()=>clearTimeout(he)}})});let Na=_e(!1),Rc=_e(!1);Xr(()=>{i(W)&&!i(Na)?(console.log("🎯 OBV modal opened, initializing..."),b(Na,!0),Eh()):!i(W)&&i(Na)&&b(Na,!1)}),Xr(()=>{if(i(Rc)){console.log("⏸️ Skipping OBV effect - removal in progress");return}i(W)&&i(Na)&&n()&&i(fi).forEach((k,N)=>{const{obvPeriod:R,maobvPeriod:F,showMaobv:z,styles:q}=k;if(R&&F&&q){const he=setTimeout(()=>{nh()},100);return()=>clearTimeout(he)}})});let Ir=_e(!1);Xr(()=>{i(ce)&&!i(Ir)?(console.log("🎯 CCI modal opened, initializing..."),b(Ir,!0),vd()):!i(ce)&&i(Ir)&&b(Ir,!1)}),Xr(()=>{i(ce)&&i(Ir)&&n()&&i(uo).forEach((k,N)=>{const{period:R,color:F,thickness:z,lineStyle:q}=k;if(R&&F&&z&&q){const he=setTimeout(()=>{nc()},100);return()=>clearTimeout(he)}})});let tu=_e(!1);Xr(()=>{i(Q)&&!i(tu)?(console.log("🎯 CR modal opened, initializing..."),b(tu,!0),Vf()):!i(Q)&&i(tu)&&b(tu,!1)}),Xr(()=>{i(Q)&&i(tu)&&n()&&i($r).forEach((k,N)=>{const{crPeriod:R,crMa1Period:F,crMa2Period:z,crMa3Period:q,crMa4Period:he,styles:Ee}=k;if(R&&F&&z&&q&&he&&Ee){const lt=setTimeout(()=>{Dd()},100);return()=>clearTimeout(lt)}})});let jc=_e(!1);Xr(()=>{i(ge)&&!i(jc)?(console.log("🎯 DMI modal opened, initializing..."),b(jc,!0),Nc()):!i(ge)&&i(jc)&&b(jc,!1)}),Xr(()=>{i(ge)&&i(jc)&&n()&&i($l).forEach((k,N)=>{const{diPeriod:R,adxPeriod:F,styles:z}=k;if(R&&F&&z){const q=setTimeout(()=>{xu()},100);return()=>clearTimeout(q)}})}),Xr(()=>{i(Yf)&&i(cr)&&n()&&i(of).forEach((k,N)=>{const{period:R,shortPeriod:F,longPeriod:z,styles:q}=k;if(R&&F&&z&&q){const he=setTimeout(()=>{$e(N)},100);return()=>clearTimeout(he)}})}),Xr(()=>{i(Af)&&n()&&i(su).length>0&&i(su).forEach((k,N)=>{const{fastPeriod:R,slowPeriod:F,signalPeriod:z,styles:q}=k;if(R&&F&&z&&q){const he=setTimeout(()=>{Wh(N)},100);return()=>clearTimeout(he)}})});let su=_e(H([])),sd=_e(H([])),of=_e(H([])),Iu=_e(H([])),Qd=_e(H([])),Hl=_e(H([])),kp=_e(0),Ks=_e(H([])),Ct=_e(0);function xn(k){b(Ct,H(k)),b(no,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(go,!0)}function As(){if(!n())return;const k=o().editPaneId||"candle_pane";for(let N=0;N<6;(N+=1)-1)try{n().removeIndicator({paneId:k,name:"ZIGZAG"})}catch{}i(Ks).forEach((N,R)=>{const F=N.styles.lineStyle==="solid"?mt.Solid:mt.Dashed,z=N.styles.lineStyle==="dashed"?[4,4]:N.styles.lineStyle==="dotted"?[2,6]:[2,2],q={lines:[{color:N.styles.color,size:N.styles.thickness,style:F,dashedValue:z,smooth:!1}]};n().createIndicator({name:"ZIGZAG",calcParams:[N.deviation,N.depth],styles:q},!0,{id:k});const he=R===0?`${k}_ZIGZAG`:`${k}_ZIGZAG_${R+1}`;c.update(Ee=>(Ee.saveInds[he]={name:"ZIGZAG",pane_id:k,params:[N.deviation,N.depth],styles:q},Ee))}),c.update(N=>{const R=`${k}_ZIGZAG`;return Object.keys(N.saveInds).filter(z=>z.startsWith(R)).forEach(z=>{const q=z.match(/_ZIGZAG(?:_(\d+))?$/);(q&&q[1]?parseInt(q[1],10):1)>i(Ks).length&&delete N.saveInds[z]}),N})}function gn(k,N){b(kp,H(N));const R={x:window.innerWidth/2,y:window.innerHeight/2};k==="fill"&&(b(bo,H(R)),b(Bs,!0)),k==="upper"&&(b(Qi,H(R)),b(lo,!0)),k==="middle"&&(b(Ai,H(R)),b(xr,!0)),k==="lower"&&(b(Ti,H(R)),b(ri,!0))}function Sn(){return window.__npoMaeApi}function Yn(k){const N={x:window.innerWidth/2,y:window.innerHeight/2};k==="median"&&(b(hr,H(N)),b(Eo,!0)),k==="band"&&(b(ai,H(N)),b(ei,!0)),k==="slLong"&&(b(_a,H(N)),b(vi,!0)),k==="slShort"&&(b(ar,H(N)),b(dl,!0))}function _o(){const k=Sn();if(!k)return;k.updateSettings({bandAlpha:Math.max(0,Math.min(100,i(Ui)))/100});const N=v(i(Ol),i(Ui));k.setColors({band:N})}let si=_e(!1);Xr(()=>{var k,N;if(!(!i(O)||i(si)||!n()))try{const F=(((N=(k=n()).getOverlays)==null?void 0:N.call(k))??[]).find(Ee=>(Ee==null?void 0:Ee.name)==="NearestPatternOutcomeMaeStop"),z=(F==null?void 0:F.extendData)||{},q=z.colors||{};q.median&&b(fl,H(q.median)),q.band&&b(Ol,H(q.band)),q.slLong&&b(bl,H(q.slLong)),q.slShort&&b(Ua,H(q.slShort)),typeof z.showOutcomeBand=="boolean"&&b(er,H(z.showOutcomeBand)),typeof z.showStopLines=="boolean"&&b(ba,H(z.showStopLines)),typeof z.showTable=="boolean"&&b(ol,H(z.showTable));const he=z.styles||{};he.median&&(typeof he.median.size=="number"&&b(Jr,H(he.median.size)),typeof he.median.style=="string"&&b(nl,H(he.median.style))),he.slLong&&(typeof he.slLong.size=="number"&&b(tc,H(he.slLong.size)),typeof he.slLong.style=="string"&&b(mc,H(he.slLong.style))),he.slShort&&(typeof he.slShort.size=="number"&&b(gu,H(he.slShort.size)),typeof he.slShort.style=="string"&&b(Bl,H(he.slShort.style))),typeof z.bandAlpha=="number"&&b(Ui,H(Math.round((z.bandAlpha||0)*100))),b(si,!0)}catch{}});function Gn(){if(!n())return;const k=o().editPaneId||"candle_pane";for(let N=0;N<6;(N+=1)-1)try{n().removeIndicator({paneId:k,name:"BOLL"})}catch{}i(Hl).forEach((N,R)=>{const F=N.styles.lineStyle==="solid"?mt.Solid:mt.Dashed,z=N.styles.lineStyle==="dashed"?[4,4]:[0,0],q={lines:[{color:N.styles.upperColor,size:N.styles.thickness,style:F,dashedValue:z},{color:N.styles.middleColor,size:N.styles.thickness,style:F,dashedValue:z},{color:N.styles.lowerColor,size:N.styles.thickness,style:F,dashedValue:z}],fill:{color:N.styles.fillColor,opacity:(N.styles.fillOpacity||0)/100}};n().createIndicator({name:"BOLL",calcParams:[N.period,N.stdDev],styles:q},!0,{id:k});const he=R===0?`${k}_BOLL`:`${k}_BOLL_${R+1}`;c.update(Ee=>(Ee.saveInds[he]={name:"BOLL",pane_id:k,params:[N.period,N.stdDev],bollingerStyles:{fillColor:N.styles.fillColor,fillOpacity:N.styles.fillOpacity,upperColor:N.styles.upperColor,middleColor:N.styles.middleColor,lowerColor:N.styles.lowerColor,thickness:N.styles.thickness,lineStyle:N.styles.lineStyle}},Ee))}),c.update(N=>{const R=`${k}_BOLL`;return Object.keys(N.saveInds).filter(z=>z.startsWith(R)).forEach(z=>{const q=z.match(/_BOLL(?:_(\d+))?$/);(q&&q[1]?parseInt(q[1],10):1)>i(Hl).length&&delete N.saveInds[z]}),N})}function Uo(k){if(i(Hl).length<=1)return;b(Hl,H(i(Hl).filter((R,F)=>F!==k)));const N=i(Hl)[0];N&&(b(j,H(N.period)),b(E,H(N.stdDev)),b(x,H(N.styles.fillColor)),b(S,H(N.styles.fillOpacity)),b(C,H(N.styles.upperColor)),b(I,H(N.styles.middleColor)),b(A,H(N.styles.lowerColor)),b(P,H(N.styles.thickness)),b(T,H(N.styles.lineStyle))),Gn()}let oo=_e(H([])),Si=_e(H([])),cc=_e(H([])),bu=_e(H([])),$l=_e(H([])),nu=_e(H([])),$r=_e(H([])),$a=_e(H([])),wa=_e(!1),yc=_e(!1),ti=_e(H([])),fi=_e(H([])),hn=_e(H([])),uo=_e(H([]));function tr(){b(uo,H([])),console.log("✅ CCI groups cleared from modal state")}let Pr=_e(H([]));function Mr(){b(Pr,H([])),console.log("✅ EMV groups cleared from modal state")}let Or=_e(H([]));function ou(){b(Or,H([])),console.log("✅ MTM groups cleared from modal state")}function md(){b(fi,H([])),console.log("✅ OBV groups cleared from modal state")}function Kf(){b(ti,H([])),console.log("✅ PSY groups cleared from modal state")}let Pu=_e(H([]));function ld(){b(Pu,H([])),console.log("✅ PVT groups cleared from modal state")}function iu(){b(zt,H([])),console.log("✅ VOL groups cleared from modal state")}function Ed(){b(sd,H([])),console.log("✅ WR groups cleared from modal state")}function Du(){if(!i(Ld))return;const k=`${o().editPaneId}_PVT`,N=r().saveInds[k];N&&N.pvtGroups&&N.pvtGroups.length>0?b(Pu,H([...N.pvtGroups])):i(Pu).length===0&&b(Pu,H([{id:Br(),name:"PVT #1",color:"#2563eb",thickness:1,lineStyle:"solid"}]))}function kf(){var N;if(!i(Ld))return;const k={id:Br(),name:`PVT #${i(Pu).length+1}`,color:"#2563eb",thickness:1,lineStyle:"solid"};if(i(Pu).push(k),n()){let R=mt.Solid,F=[2,2];k.lineStyle==="dashed"?(R=mt.Dashed,F=[4,4]):k.lineStyle==="dotted"&&(R=mt.Dashed,F=[2,2]);const z={lines:[{color:k.color,size:k.thickness,style:R,dashedValue:F}]},q=(N=n())==null?void 0:N.createIndicator({name:"PVT",styles:z,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);console.log("✅ Created PVT indicator on pane:",q),q&&c.update(he=>{const Ee=`${q}_PVT`;return he.saveInds[Ee]||(he.saveInds[Ee]={name:"PVT",pane_id:q,pvtGroups:[]}),he.saveInds[Ee].pvtGroups||(he.saveInds[Ee].pvtGroups=[]),he.saveInds[Ee].pvtGroups.push({...k}),console.log("💾 Saved new PVT group to storage:",Ee,k),he})}console.log("➕ Added new PVT group:",k.name,"ID:",k.id)}function $d(k){var R,F;if(!i(Ld)||i(Pu).length<=1||k<0||k>=i(Pu).length)return;console.log("🗑️ Removing PVT group at index:",k);const N=i(Pu).length;if(i(Pu)[k],i(Pu).splice(k,1),console.log(`📝 Removed group: ${N} -> ${i(Pu).length}`),i(Pu).forEach((z,q)=>{z.name=`PVT #${q+1}`}),n())try{const q=((R=n())==null?void 0:R.getIndicators()).filter(he=>he.name==="PVT");console.log("📈 PVT indicators found:",q.length);for(const he of q)console.log("🗑️ Removing PVT from pane:",he.paneId),(F=n())==null||F.removeIndicator({paneId:he.paneId,name:"PVT"});i(Pu).forEach((he,Ee)=>{var xs;let lt=mt.Solid,Qt=[2,2];he.lineStyle==="dashed"?(lt=mt.Dashed,Qt=[4,4]):he.lineStyle==="dotted"&&(lt=mt.Dashed,Qt=[2,2]);const en={lines:[{color:he.color,size:he.thickness,style:lt,dashedValue:Qt}]};console.log("➕ Re-adding PVT group:",he.name,"at index:",Ee);const Zs=(xs=n())==null?void 0:xs.createIndicator({name:"PVT",styles:en,figures:[{key:"pvt",title:"PVT: ",type:"line"}]},!1);Zs&&c.update(Un=>{const jo=`${Zs}_PVT`;return Un.saveInds[jo]||(Un.saveInds[jo]={name:"PVT",pane_id:Zs,pvtGroups:[]}),Un.saveInds[jo].pvtGroups||(Un.saveInds[jo].pvtGroups=[]),Un.saveInds[jo].pvtGroups[Ee]={...he},Un})}),console.log("✅ Successfully updated PVT indicators on chart")}catch(z){console.error("❌ Error updating PVT indicators:",z)}console.log("✅ PVT group removed. Remaining groups:",i(Pu).length)}function Bf(){b($a,H([])),console.log("✅ ROC groups cleared from modal state")}let Di=_e(H([]));function bh(){b(Di,H([])),console.log("✅ RSI groups cleared from modal state")}function rf(){const k=new Set,N=n();if(!(N!=null&&N.getIndicators))return k;try{N.getIndicators().forEach(F=>{(F==null?void 0:F.name)==="RSI"&&(F!=null&&F.paneId)&&k.add(F.paneId)})}catch(R){console.warn("⚠️ Failed to read RSI pane IDs from chart:",R)}return k}function Xe(k,N){const R=rf();for(const F of R)if(!k.has(F))return F;return N}function Dp(k){const N="pane_RSI";if(!k.has(N))return N;let R=2;for(;k.has(`${N}_${R}`)&&R<1e3;)R+=1;if(!k.has(`${N}_${R}`))return`${N}_${R}`;let F=`${N}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;for(;k.has(F);)F=`${N}_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;return F}function nm(k,N={}){return{...k,...N,styles:{...k.styles,rsi:{...k.styles.rsi}}}}function Sp(k){var z,q,he;if(!k||k.name!=="RSI")return null;const N=Array.isArray(k.rsiGroups)&&k.rsiGroups.length>0?k.rsiGroups[0]:null;if(!N)return null;const R=N.actualPaneId||N.paneId||k.pane_id,F=N.styles||{};return{id:N.id||Br(),period:N.period??(Array.isArray(k.params)?k.params[0]:14),overboughtLevel:N.overboughtLevel??70,middleLevel:N.middleLevel??50,oversoldLevel:N.oversoldLevel??30,fillOpacity:N.fillOpacity??.15,paneId:R||k.pane_id,actualPaneId:R||k.pane_id,styles:{rsi:{color:((z=F.rsi)==null?void 0:z.color)??"#8B5CF6",thickness:((q=F.rsi)==null?void 0:q.thickness)??2,lineStyle:((he=F.rsi)==null?void 0:he.lineStyle)??"solid"},overboughtColor:F.overboughtColor??"#EF4444",overboughtThickness:F.overboughtThickness??1,overboughtLineStyle:F.overboughtLineStyle??"dashed",oversoldColor:F.oversoldColor??"#22C55E",oversoldThickness:F.oversoldThickness??1,oversoldLineStyle:F.oversoldLineStyle??"dashed",middleLineColor:F.middleLineColor??"#6B7280",middleLineThickness:F.middleLineThickness??1,middleLineStyle:F.middleLineStyle??"dashed"}}}function sc(){const k=new Map;Object.values(r().saveInds||{}).forEach(R=>{if(!R||R.name!=="RSI")return;const F=Sp(R);F!=null&&F.actualPaneId&&!k.has(F.actualPaneId)&&k.set(F.actualPaneId,F)});const N=Array.from(k.values());return o().editPaneId&&N.sort((R,F)=>R.actualPaneId===o().editPaneId?-1:F.actualPaneId===o().editPaneId?1:(R.actualPaneId||"").localeCompare(F.actualPaneId||"")),N}function Xf(){if(!i(Qe))return;const k=i(Di).map(N=>{const R=N.actualPaneId||N.paneId||o().editPaneId;return nm(N,{paneId:R,actualPaneId:R})});c.update(N=>(Object.keys(N.saveInds||{}).forEach(R=>{var F;((F=N.saveInds[R])==null?void 0:F.name)==="RSI"&&delete N.saveInds[R]}),k.forEach(R=>{const F=R.actualPaneId;if(!F)return;const z=`${F}_RSI`;N.saveInds[z]={name:"RSI",pane_id:F,params:[R.period],rsiGroups:[nm(R)]}}),N))}function ch(){if(!i(Qe))return;const k=sc(),N=rf();if(N.size>0&&k.length<N.size){const R=[];if(N.forEach(F=>{try{const z=Tg.getInstance(F)||Tg.getInstanceConfig(F);if(!z)return;const q={id:Br(),period:z.period??14,overboughtLevel:z.overboughtLevel??70,middleLevel:z.middleLevel??50,oversoldLevel:z.oversoldLevel??30,fillOpacity:z.fillOpacity??.15,paneId:F,actualPaneId:F,styles:{rsi:{color:z.lineColor??"#8B5CF6",thickness:z.lineThickness??2,lineStyle:z.lineStyle??"solid"},overboughtColor:z.overboughtColor??"#EF4444",overboughtThickness:z.overboughtThickness??1,overboughtLineStyle:z.overboughtLineStyle??"dashed",oversoldColor:z.oversoldColor??"#22C55E",oversoldThickness:z.oversoldThickness??1,oversoldLineStyle:z.oversoldLineStyle??"dashed",middleLineColor:z.middleLineColor??"#6B7280",middleLineThickness:z.middleLineThickness??1,middleLineStyle:z.middleLineStyle??"dashed"}};R.push(q)}catch(z){console.warn("⚠️ Failed to reconstruct RSI group from instance:",z)}}),R.length>0){b(Di,H(R)),Xf();return}}if(k.length>0){b(Di,H(k)),Xf();return}if(i(Di).length===0){const R={id:Br(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:o().editPaneId,actualPaneId:o().editPaneId,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};b(Di,H([R])),Tg.createInstance(R.actualPaneId,{period:R.period,lineColor:R.styles.rsi.color,lineThickness:R.styles.rsi.thickness,lineStyle:R.styles.rsi.lineStyle,overboughtLevel:R.overboughtLevel,oversoldLevel:R.oversoldLevel,middleLevel:R.middleLevel,overboughtColor:R.styles.overboughtColor,overboughtThickness:R.styles.overboughtThickness??1,overboughtLineStyle:R.styles.overboughtLineStyle||"dashed",oversoldColor:R.styles.oversoldColor,oversoldThickness:R.styles.oversoldThickness??1,oversoldLineStyle:R.styles.oversoldLineStyle||"dashed",overboughtFillColor:R.styles.overboughtColor,oversoldFillColor:R.styles.oversoldColor,middleLineColor:R.styles.middleLineColor,middleLineThickness:R.styles.middleLineThickness??1,middleLineStyle:R.styles.middleLineStyle||"dashed",fillOpacity:R.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:R.overboughtLevel,color:R.styles.overboughtColor,lineStyle:R.styles.overboughtLineStyle||"dashed",thickness:R.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:R.middleLevel,color:R.styles.middleLineColor,lineStyle:R.styles.middleLineStyle||"dashed",thickness:R.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:R.oversoldLevel,color:R.styles.oversoldColor,lineStyle:R.styles.oversoldLineStyle||"dashed",thickness:R.styles.oversoldThickness??1,label:"30",visible:!0}]}),Xf()}}function Vh(){if(!i(Qe))return;const k=rf(),N=new Set(k);i(Di).forEach(q=>{const he=q.actualPaneId||q.paneId;he&&N.add(he)});const R=Dp(N),F={id:Br(),period:14,overboughtLevel:70,middleLevel:50,oversoldLevel:30,fillOpacity:.15,paneId:R,actualPaneId:R,styles:{rsi:{color:"#8B5CF6",thickness:2,lineStyle:"solid"},overboughtColor:"#EF4444",overboughtThickness:1,overboughtLineStyle:"dashed",oversoldColor:"#22C55E",oversoldThickness:1,oversoldLineStyle:"dashed",middleLineColor:"#6B7280",middleLineThickness:1,middleLineStyle:"dashed"}};i(Di).push(F);let z=R;if(n()){const q=n(),he=new Set(k);let Ee=mt.Solid,lt=[2,2];F.styles.rsi.lineStyle==="dashed"?(Ee=mt.Dashed,lt=[6,4]):F.styles.rsi.lineStyle==="dotted"&&(Ee=mt.Dashed,lt=[2,2]);const Qt=q.createIndicator({name:"RSI",calcParams:[F.period],styles:{lines:[{color:F.styles.rsi.color,size:F.styles.rsi.thickness,style:Ee,dashedValue:lt}]}},!1,{id:R,axis:{gap:{bottom:2}}});if(z=Xe(he,R),F.paneId=z,F.actualPaneId=z,Tg.createInstance(z,{period:F.period,lineColor:F.styles.rsi.color,lineThickness:F.styles.rsi.thickness,lineStyle:F.styles.rsi.lineStyle,overboughtLevel:F.overboughtLevel,oversoldLevel:F.oversoldLevel,middleLevel:F.middleLevel,overboughtColor:F.styles.overboughtColor,overboughtThickness:F.styles.overboughtThickness??1,overboughtLineStyle:F.styles.overboughtLineStyle||"dashed",oversoldColor:F.styles.oversoldColor,oversoldThickness:F.styles.oversoldThickness??1,oversoldLineStyle:F.styles.oversoldLineStyle||"dashed",overboughtFillColor:F.styles.overboughtColor,oversoldFillColor:F.styles.oversoldColor,middleLineColor:F.styles.middleLineColor,middleLineThickness:F.styles.middleLineThickness??1,middleLineStyle:F.styles.middleLineStyle||"dashed",fillOpacity:F.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:F.overboughtLevel,color:F.styles.overboughtColor,lineStyle:F.styles.overboughtLineStyle||"dashed",thickness:F.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:F.middleLevel,color:F.styles.middleLineColor,lineStyle:F.styles.middleLineStyle||"dashed",thickness:F.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:F.oversoldLevel,color:F.styles.oversoldColor,lineStyle:F.styles.oversoldLineStyle||"dashed",thickness:F.styles.oversoldThickness??1,label:"30",visible:!0}]}),Qt){const en=`${z}_RSI`;c.update(Zs=>(Zs.saveInds[en]={name:"RSI",pane_id:z,params:[F.period],rsiGroups:[{id:F.id,period:F.period,overboughtLevel:F.overboughtLevel,middleLevel:F.middleLevel,oversoldLevel:F.oversoldLevel,paneId:z,actualPaneId:z,styles:F.styles}]},Zs))}}else Tg.createInstance(z,{period:F.period,lineColor:F.styles.rsi.color,lineThickness:F.styles.rsi.thickness,lineStyle:F.styles.rsi.lineStyle,overboughtLevel:F.overboughtLevel,oversoldLevel:F.oversoldLevel,middleLevel:F.middleLevel,overboughtColor:F.styles.overboughtColor,overboughtThickness:F.styles.overboughtThickness??1,overboughtLineStyle:F.styles.overboughtLineStyle||"dashed",oversoldColor:F.styles.oversoldColor,oversoldThickness:F.styles.oversoldThickness??1,oversoldLineStyle:F.styles.oversoldLineStyle||"dashed",overboughtFillColor:F.styles.overboughtColor,oversoldFillColor:F.styles.oversoldColor,middleLineColor:F.styles.middleLineColor,middleLineThickness:F.styles.middleLineThickness??1,middleLineStyle:F.styles.middleLineStyle||"dashed",fillOpacity:F.fillOpacity,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:F.overboughtLevel,color:F.styles.overboughtColor,lineStyle:F.styles.overboughtLineStyle||"dashed",thickness:F.styles.overboughtThickness??1,label:"70",visible:!0},{id:"middle",value:F.middleLevel,color:F.styles.middleLineColor,lineStyle:F.styles.middleLineStyle||"dashed",thickness:F.styles.middleLineThickness??1,label:"50",visible:!0},{id:"oversold",value:F.oversoldLevel,color:F.styles.oversoldColor,lineStyle:F.styles.oversoldLineStyle||"dashed",thickness:F.styles.oversoldThickness??1,label:"30",visible:!0}]});Xf()}function Lh(k){var z;if(!i(Qe)||i(Di).length<=1||k<0||k>=i(Di).length)return;console.log("🗑️ Removing RSI group at index:",k);const N=i(Di)[k];let R=N.actualPaneId||N.paneId||o().editPaneId;if(!R&&((z=n())!=null&&z.getIndicators))try{const q=new Set(i(Di).filter((lt,Qt)=>Qt!==k).map(lt=>lt.actualPaneId||lt.paneId).filter(lt=>!!lt)),Ee=n().getIndicators().find(lt=>(lt==null?void 0:lt.name)==="RSI"&&(lt==null?void 0:lt.paneId)&&!q.has(lt.paneId));Ee!=null&&Ee.paneId&&(R=Ee.paneId)}catch(q){console.warn("⚠️ Failed to resolve RSI pane ID for removal:",q)}const F=i(Di).length;if(i(Di).splice(k,1),console.log(`📝 Removed group: ${F} -> ${i(Di).length}`),n()&&R)try{console.log("🗑️ Removing RSI from pane:",R),Tg.deleteInstance(R),Su(R,"RSI")}catch(q){console.error("❌ Error removing RSI indicator:",q)}Xf(),console.log("✅ RSI group removed. Remaining groups:",i(Di).length)}function cp(k){if(!i(Qe)||!n()||k<0||k>=i(Di).length)return;const N=i(Di)[k],R=N.actualPaneId||N.paneId||o().editPaneId;if(!R){console.warn("⚠️ Unable to resolve pane ID for RSI update");return}try{Tg.updateInstance(R,{period:N.period,lineColor:N.styles.rsi.color,lineThickness:N.styles.rsi.thickness,lineStyle:N.styles.rsi.lineStyle,overboughtLevel:N.overboughtLevel,oversoldLevel:N.oversoldLevel,middleLevel:N.middleLevel,overboughtColor:N.styles.overboughtColor||"#EF4444",overboughtThickness:N.styles.overboughtThickness??1,overboughtLineStyle:N.styles.overboughtLineStyle||"dashed",oversoldColor:N.styles.oversoldColor||"#22C55E",oversoldThickness:N.styles.oversoldThickness??1,oversoldLineStyle:N.styles.oversoldLineStyle||"dashed",overboughtFillColor:N.styles.overboughtColor||"#EF4444",oversoldFillColor:N.styles.oversoldColor||"#22C55E",middleLineColor:N.styles.middleLineColor||"#6B7280",middleLineThickness:N.styles.middleLineThickness??1,middleLineStyle:N.styles.middleLineStyle||"dashed",fillOpacity:N.fillOpacity??.15,showLevels:!0,showFill:!0,levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overboughtColor||"#EF4444",lineStyle:N.styles.overboughtLineStyle||"dashed",thickness:N.styles.overboughtThickness??1,label:String(N.overboughtLevel),visible:!0},{id:"middle",value:N.middleLevel,color:N.styles.middleLineColor||"#6B7280",lineStyle:N.styles.middleLineStyle||"dashed",thickness:N.styles.middleLineThickness??1,label:String(N.middleLevel),visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversoldColor||"#22C55E",lineStyle:N.styles.oversoldLineStyle||"dashed",thickness:N.styles.oversoldThickness??1,label:String(N.oversoldLevel),visible:!0}]}),n().removeIndicator({paneId:R,name:"RSI"});let F=mt.Solid,z=[2,2];N.styles.rsi.lineStyle==="dashed"?(F=mt.Dashed,z=[6,4]):N.styles.rsi.lineStyle==="dotted"&&(F=mt.Dashed,z=[2,2]);const q=n().createIndicator({name:"RSI",calcParams:[N.period],styles:{lines:[{color:N.styles.rsi.color,size:N.styles.rsi.thickness,style:F,dashedValue:z}]}},!1,{id:R,axis:{gap:{bottom:2}}});try{typeof n().resize=="function"&&n().resize()}catch{}if(N.actualPaneId=R,N.paneId=R,q){const he=`${R}_RSI`;c.update(Ee=>{const lt=(i(Di)||[]).filter(Qt=>(Qt.actualPaneId||Qt.paneId)===R);return Ee.saveInds[he]={name:"RSI",pane_id:R,params:[N.period],rsiGroups:lt},Ee})}Xf()}catch(F){console.error("❌ Error updating RSI indicator:",F)}}let cd=_e(H([]));function u0(){b(cd,H([])),console.log("✅ Stochastic groups cleared from modal state")}function Iv(){if(!i(Ue))return;const k=`${o().editPaneId}_STOCH`,N=r().saveInds[k];if(N&&N.stochasticGroups&&N.stochasticGroups.length>0)b(cd,H([...N.stochasticGroups]));else if(i(cd).length===0){const R={id:Br(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:o().editPaneId,styles:{duty:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};b(cd,H([R])),sy.createInstance(o().editPaneId,{kPeriod:R.kPeriod,dPeriod:R.dPeriod,dutyColor:R.styles.duty.color,dutyThickness:R.styles.duty.thickness,dutyStyle:R.styles.duty.lineStyle,dLineColor:R.styles.dLine.color,dLineThickness:R.styles.dLine.thickness,dLineStyle:R.styles.dLine.lineStyle,levels:[{id:"overbought",value:R.overboughtLevel,color:R.styles.overboughtColor,lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:R.oversoldLevel,color:R.styles.oversoldColor,lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:R.midLevel,color:R.styles.midLineColor,lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]})}}function Dm(){var N;if(!i(Ue))return;const k={id:Br(),kPeriod:14,dPeriod:3,overboughtLevel:80,oversoldLevel:20,midLevel:50,paneId:void 0,styles:{duty:{color:"#1E90FF",thickness:2,lineStyle:"solid"},dLine:{color:"#FF1493",thickness:2,lineStyle:"dashed"},overboughtColor:"#EF4444",oversoldColor:"#10B981",midLineColor:"#6B7280"}};if(b(cd,H([...i(cd),k])),i(cd).length>1){const R=Object.values(r().saveInds).filter(Qt=>Qt.name==="STOCH"&&Qt.pane_id).map(Qt=>Qt.pane_id);let F=2;for(;R.includes(`pane_STOCH_${F}`);)F+=1;const z=i(cd).length-1,q=[k.kPeriod,k.dPeriod,1],he={lines:[{color:k.styles.duty.color,size:k.styles.duty.thickness,style:k.styles.duty.lineStyle==="dashed"||k.styles.duty.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:k.styles.duty.lineStyle==="dashed"?[4,4]:k.styles.duty.lineStyle==="dotted"?[2,2]:[2,2]},{color:k.styles.dLine.color,size:k.styles.dLine.thickness,style:k.styles.dLine.lineStyle==="dashed"||k.styles.dLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:k.styles.dLine.lineStyle==="dashed"?[4,4]:k.styles.dLine.lineStyle==="dotted"?[2,2]:[2,2]}]},Ee=`pane_STOCH_${F}`;console.log(`🆕 Immediately creating Stochastic ${F} with pane ID:`,Ee),((N=n())==null?void 0:N.createIndicator({name:"STOCH",calcParams:q,styles:he},!1,{id:Ee,axis:{gap:{bottom:2}}}))&&(console.log(`✅ Stochastic ${F} created with pane ID:`,Ee),k.paneId=Ee,sy.updateInstance(Ee,{kPeriod:k.kPeriod,dPeriod:k.dPeriod,levels:[{id:"overbought",value:k.overboughtLevel,color:k.styles.overboughtColor,lineStyle:"solid",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:k.oversoldLevel,color:k.styles.oversoldColor,lineStyle:"solid",thickness:1,label:"Oversold",visible:!0},{id:"midline",value:k.midLevel,color:k.styles.midLineColor,lineStyle:"solid",thickness:1,label:"Midline",visible:!0}],zones:[{id:"overbought_zone",type:"overbought",topLevel:100,bottomLevel:k.overboughtLevel,fillColor:k.styles.overboughtColor,fillOpacity:.1,visible:!0},{id:"oversold_zone",type:"oversold",topLevel:k.oversoldLevel,bottomLevel:0,fillColor:k.styles.oversoldColor,fillOpacity:.1,visible:!0}],dutyColor:k.styles.duty.color,dLineColor:k.styles.dLine.color,showLevels:!0,showZones:!0,overboughtLevel:k.overboughtLevel,oversoldLevel:k.oversoldLevel,midlineLevel:k.midLevel}),c.update(Qt=>{const en=`pane_STOCH_${F}_STOCH`;return Qt.saveInds[en]={name:"STOCH",stochasticGroup:k,pane_id:Ee,groupIndex:z,params:[k.kPeriod,k.dPeriod,1]},Qt}))}console.log("✅ New Stochastic group added:",k)}function xh(k){if(!i(Ue)||k<0||k>=i(cd).length)return;const R=i(cd)[k].paneId||o().editPaneId;try{sy.deleteInstance(R),n()&&n().removeIndicator({paneId:R,name:"STOCH"}),c.update(F=>(Object.keys(F.saveInds).filter(q=>F.saveInds[q].name==="STOCH"&&F.saveInds[q].pane_id===R).forEach(q=>{delete F.saveInds[q]}),F)),b(cd,H(i(cd).filter((F,z)=>z!==k))),console.log("✅ Stochastic group removed successfully")}catch(F){console.error("❌ Error removing Stochastic group:",F)}}function th(k){if(!i(Ue)||k<0||k>=i(cd).length)return;const N=i(cd)[k],R=N.paneId||o().editPaneId;try{sy.updateInstance(R,{kPeriod:N.kPeriod,dPeriod:N.dPeriod,dutyColor:N.styles.duty.color,dutyThickness:N.styles.duty.thickness,dutyStyle:N.styles.duty.lineStyle,dLineColor:N.styles.dLine.color,dLineThickness:N.styles.dLine.thickness,dLineStyle:N.styles.dLine.lineStyle,overboughtLevel:N.overboughtLevel,oversoldLevel:N.oversoldLevel,midlineLevel:N.midLevel,showZones:!0,zones:[{id:"overbought-zone",topLevel:100,bottomLevel:N.overboughtLevel,fillColor:N.styles.overboughtColor||"#EF4444",fillOpacity:.1,visible:!0,type:"overbought"},{id:"oversold-zone",topLevel:N.oversoldLevel,bottomLevel:0,fillColor:N.styles.oversoldColor||"#10B981",fillOpacity:.1,visible:!0,type:"oversold"}],levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overboughtColor||"#EF4444",lineStyle:"dashed",thickness:1,label:"Overbought",visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversoldColor||"#10B981",lineStyle:"dashed",thickness:1,label:"Oversold",visible:!0},{id:"mid",value:N.midLevel,color:N.styles.midLineColor||"#6B7280",lineStyle:"dashed",thickness:1,label:"Mid",visible:!0}]}),n()&&n().removeIndicator({paneId:R,name:"STOCH"});let F=mt.Solid,z=[2,2],q=mt.Solid,he=[2,2];if(N.styles.duty.lineStyle==="dashed"?(F=mt.Dashed,z=[4,4]):N.styles.duty.lineStyle==="dotted"&&(F=mt.Dashed,z=[2,2]),N.styles.dLine.lineStyle==="dashed"?(q=mt.Dashed,he=[4,4]):N.styles.dLine.lineStyle==="dotted"&&(q=mt.Dashed,he=[2,2]),n()?n().createIndicator({name:"STOCH",calcParams:[N.kPeriod,N.dPeriod],styles:{lines:[{color:N.styles.duty.color,size:N.styles.duty.thickness,style:F,dashedValue:z},{color:N.styles.dLine.color,size:N.styles.dLine.thickness,style:q,dashedValue:he}]}},R===o().editPaneId,{id:R}):null){const lt=`${R}_STOCH`;c.update(Qt=>(Qt.saveInds[lt]={name:"STOCH",pane_id:R,params:[N.kPeriod,N.dPeriod],stochasticGroups:i(cd)},Qt))}console.log("✅ Stochastic indicator and levels updated successfully")}catch(F){console.error("❌ Error updating Stochastic indicator:",F)}}function Um(){if(!i(Af))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="MACD").sort();console.log("🔍 Found existing MACD keys:",k),k.length>0?(b(su,H([])),k.forEach((N,R)=>{const F=r().saveInds[N];if(F){if(F.macdGroup){const z={...F.macdGroup};z.styles||(z.styles={}),z.styles.reverseHistogram||(z.styles.reverseHistogram={color:"#c4c4c4"}),R>0&&F.pane_id&&(z.actualPaneId=F.pane_id),i(su).push(z)}else if(F.params&&F.params.length>=3){const z={id:Br(),fastPeriod:F.params[0]||12,slowPeriod:F.params[1]||26,signalPeriod:F.params[2]||9,actualPaneId:void 0,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#22c55e"},negativeHistogram:{color:"#ef4444"},reverseHistogram:{color:"#c4c4c4"}}};R>0&&F.pane_id&&(z.actualPaneId=F.pane_id),i(su).push(z)}}}),console.log("✅ Loaded",i(su).length,"existing MACD groups")):i(su).length===0&&(b(su,H([{id:Br(),fastPeriod:12,slowPeriod:26,signalPeriod:9,styles:{macdLine:{color:"#2563eb",thickness:1,lineStyle:"solid"},signalLine:{color:"#dc2626",thickness:1,lineStyle:"solid"},positiveHistogram:{color:"#22c55e"},negativeHistogram:{color:"#ef4444"},reverseHistogram:{color:"#c4c4c4"}}}])),console.log("🆕 Created default MACD group"))}function dv(){var F;if(!i(Af))return;const k=[{macdLine:"#2563eb",signalLine:"#dc2626",positiveHistogram:"#22c55e",negativeHistogram:"#ef4444",reverseHistogram:"#c4c4c4"},{macdLine:"#9333ea",signalLine:"#ea580c",positiveHistogram:"#059669",negativeHistogram:"#dc2626",reverseHistogram:"#c4c4c4"},{macdLine:"#ec4899",signalLine:"#f59e0b",positiveHistogram:"#0891b2",negativeHistogram:"#f97316",reverseHistogram:"#c4c4c4"}],N=i(su).length%k.length,R={id:Br(),fastPeriod:12,slowPeriod:26,signalPeriod:9,actualPaneId:void 0,styles:{macdLine:{color:k[N].macdLine,thickness:1,lineStyle:"solid"},signalLine:{color:k[N].signalLine,thickness:1,lineStyle:"solid"},positiveHistogram:{color:k[N].positiveHistogram},negativeHistogram:{color:k[N].negativeHistogram},reverseHistogram:{color:k[N].reverseHistogram}}};if(i(su).push(R),i(su).length>1){const z=Object.values(r().saveInds).filter(Zs=>Zs.name==="MACD"&&Zs.pane_id).map(Zs=>Zs.pane_id);let q=2;for(;z.includes(`pane_MACD_${q}`);)q+=1;const he=i(su).length-1,Ee=[R.fastPeriod,R.slowPeriod,R.signalPeriod],lt={lines:[{color:R.styles.macdLine.color,size:R.styles.macdLine.thickness,style:R.styles.macdLine.lineStyle==="dashed"||R.styles.macdLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:R.styles.macdLine.lineStyle==="dashed"?[4,4]:R.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:R.styles.signalLine.color,size:R.styles.signalLine.thickness,style:R.styles.signalLine.lineStyle==="dashed"||R.styles.signalLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:R.styles.signalLine.lineStyle==="dashed"?[4,4]:R.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:R.styles.positiveHistogram.color,downColor:R.styles.negativeHistogram.color,noChangeColor:R.styles.positiveHistogram.color,reverseColor:R.styles.reverseHistogram.color,borderSize:0,borderColor:R.styles.positiveHistogram.color}]},Qt=`pane_MACD_${q}`;console.log(`🆕 Immediately creating MACD ${q} with pane ID:`,Qt),((F=n())==null?void 0:F.createIndicator({name:"MACD",calcParams:Ee,styles:lt},!1,{id:Qt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ MACD ${q} created with pane ID:`,Qt),R.actualPaneId=Qt,c.update(Zs=>{const xs=`pane_MACD_${q}_MACD`;return Zs.saveInds[xs]={name:"MACD",macdGroup:R,pane_id:Qt,groupIndex:he,params:[R.fastPeriod,R.slowPeriod,R.signalPeriod]},Zs}))}}function Bg(k){var R,F;if(!i(Af)||i(su).length<=1)return;const N=i(su).findIndex(z=>z.id===k);if(N!==-1){console.log("🗑️ Removing MACD group at index:",N,"ID:",k);try{if(N===0&&i(su).length>1){console.log("🔄 Special handling: First MACD removed, promoting second MACD to first position"),b(su,H(i(su).filter(q=>q.id!==k))),console.log("✅ MACD group removed from array. Remaining groups:",i(su).length);const z=i(su)[0];z.actualPaneId&&(console.log("🗑️ Removing old second MACD from sub-pane:",z.actualPaneId),(R=n())==null||R.removeIndicator({paneId:z.actualPaneId,name:"MACD"})),z.actualPaneId=void 0,console.log("📊 Updating MACD in edit pane with new first group settings"),Wh(0)}else{const z=i(su)[N];z.actualPaneId&&(console.log("🗑️ Removing MACD from actual pane:",z.actualPaneId),(F=n())==null||F.removeIndicator({paneId:z.actualPaneId,name:"MACD"}),console.log("✅ Successfully removed MACD from actual pane:",z.actualPaneId)),b(su,H(i(su).filter(q=>q.id!==k))),console.log("✅ MACD group removed from array. Remaining groups:",i(su).length)}c.update(z=>(Object.keys(z.saveInds).forEach(q=>{z.saveInds[q].name==="MACD"&&(console.log("🧹 Cleaning saved state for key:",q),delete z.saveInds[q])}),i(su).forEach((q,he)=>{const Ee=he===0?`${o().editPaneId}_MACD`:`pane_MACD_${he+1}_MACD`,lt=he===0?o().editPaneId:q.actualPaneId||`pane_MACD_${he+1}`;console.log(`💾 Re-saving MACD group ${he+1} with key:`,Ee,"pane ID:",lt),z.saveInds[Ee]={name:"MACD",macdGroup:q,pane_id:lt,groupIndex:he,macdGroups:he===0?[...i(su)]:void 0,params:[q.fastPeriod,q.slowPeriod,q.signalPeriod]}}),z)),console.log("🔄 MACD groups reindexed successfully")}catch(z){console.log("❌ Error removing MACD indicator:",z)}}}function Wh(k){var q;const N=i(su)[k];if(!N||!n())return;N.styles.reverseHistogram||(N.styles.reverseHistogram={color:"#c4c4c4"});const R=k===0?o().editPaneId:N.actualPaneId||`pane_MACD_${k+1}`,F={lines:[{color:N.styles.macdLine.color,size:N.styles.macdLine.thickness,style:N.styles.macdLine.lineStyle==="dashed"||N.styles.macdLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:N.styles.macdLine.lineStyle==="dashed"?[4,4]:N.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:N.styles.signalLine.color,size:N.styles.signalLine.thickness,style:N.styles.signalLine.lineStyle==="dashed"||N.styles.signalLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:N.styles.signalLine.lineStyle==="dashed"?[4,4]:N.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:N.styles.positiveHistogram.color,downColor:N.styles.negativeHistogram.color,noChangeColor:N.styles.positiveHistogram.color,reverseColor:N.styles.reverseHistogram.color,borderSize:0,borderColor:N.styles.positiveHistogram.color}]};(q=n())==null||q.overrideIndicator({name:"MACD",paneId:R,styles:F,calcParams:[N.fastPeriod,N.slowPeriod,N.signalPeriod]});const z=k===0?`${o().editPaneId}_MACD`:`pane_MACD_${k+1}_MACD`;c.update(he=>(he.saveInds[z]&&(he.saveInds[z].params=[N.fastPeriod,N.slowPeriod,N.signalPeriod],he.saveInds[z].macdGroup={...N},console.log("💾 Persisted MACD changes to save data:",z,N)),he)),console.log("🔄 Updated MACD indicator:",k,N)}function om(k,N){var q;const R=i(su)[k];if(!R||!n())return;R.styles.reverseHistogram||(R.styles.reverseHistogram={color:"#c4c4c4"});const F=k===0?o().editPaneId:R.actualPaneId||`pane_MACD_${k+1}`,z={lines:[{color:R.styles.macdLine.color,size:R.styles.macdLine.thickness,style:R.styles.macdLine.lineStyle==="dashed"||R.styles.macdLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:R.styles.macdLine.lineStyle==="dashed"?[4,4]:R.styles.macdLine.lineStyle==="dotted"?[2,2]:[2,2]},{color:R.styles.signalLine.color,size:R.styles.signalLine.thickness,style:R.styles.signalLine.lineStyle==="dashed"||R.styles.signalLine.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:R.styles.signalLine.lineStyle==="dashed"?[4,4]:R.styles.signalLine.lineStyle==="dotted"?[2,2]:[2,2]}],bars:[{upColor:R.styles.positiveHistogram.color,downColor:R.styles.negativeHistogram.color,noChangeColor:R.styles.positiveHistogram.color,reverseColor:R.styles.reverseHistogram.color,borderSize:0,borderColor:R.styles.positiveHistogram.color}]};(q=n())==null||q.overrideIndicator({name:"MACD",paneId:F,styles:z}),console.log("🎨 Updated MACD color:",N,R.styles[N].color)}function Og(){if(i(G))try{const k=`${o().editPaneId}_EMV`,N=r().saveInds[k];if(N&&N.emvGroups&&Array.isArray(N.emvGroups)&&N.emvGroups.length>0){const R=N.emvGroups.filter(F=>F&&typeof F.id=="string"&&typeof F.name=="string"&&typeof F.period=="number"&&F.period>0&&typeof F.period2=="number"&&F.period2>0&&typeof F.color=="string"&&typeof F.thickness=="number"&&F.thickness>0&&typeof F.lineStyle=="string");R.length>0?(b(Pr,H([...R])),console.log("✅ Loaded",R.length,"valid EMV groups")):(console.warn("⚠️ No valid EMV groups found in saved data, creating default"),hm())}else i(Pr).length===0&&hm()}catch(k){console.error("❌ Error initializing EMV groups:",k),hm()}}function hm(){b(Pr,H([{id:Br(),name:"EMV #1",period:14,period2:9,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default EMV group")}function mm(k){if(!i(G)||i(Pr).length<=1){console.warn("⚠️ Cannot remove EMV group: minimum one group required");return}try{if(!k||typeof k!="string"){console.error("❌ Invalid group ID provided for EMV group removal");return}const N=i(Pr).length;b(Pr,H(i(Pr).filter(R=>R.id!==k))),i(Pr).length<N?console.log("✅ Removed EMV group with ID:",k):console.warn("⚠️ EMV group not found for removal:",k)}catch(N){console.error("❌ Error removing EMV group:",N)}}function zg(){if(i(ye))try{const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N]&&r().saveInds[N].name==="MTM").sort((N,R)=>N===`${o().editPaneId}_MTM`?-1:R===`${o().editPaneId}_MTM`?1:N.localeCompare(R));k.length>0?(b(Or,H([])),k.forEach((N,R)=>{const F=r().saveInds[N];if(F){if(F.mtmGroup){const z={...F.mtmGroup};R>0&&F.pane_id&&(z.actualPaneId=F.pane_id),i(Or).push(z)}else if(F.mtmGroups&&Array.isArray(F.mtmGroups)&&R===0){const z=F.mtmGroups.filter(q=>q&&typeof q.id=="string"&&typeof q.name=="string"&&typeof q.period=="number"&&q.period>0&&typeof q.color=="string"&&typeof q.thickness=="number"&&q.thickness>0&&typeof q.lineStyle=="string");b(Or,H([...z]))}}}),i(Or).length>0?console.log("✅ Loaded",i(Or).length,"MTM groups from saved data"):(console.warn("⚠️ No valid MTM groups found, creating default"),Gm())):i(Or).length===0&&Gm()}catch(k){console.error("❌ Error initializing MTM groups:",k),Gm()}}function Gm(){b(Or,H([{id:Br(),name:"MTM #1",period:14,color:"#2563eb",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default MTM group")}function Rm(k){if(!i(ye)||i(Or).length<=1){console.warn("⚠️ Cannot remove MTM group: minimum one group required");return}try{if(!k||typeof k!="string"){console.error("❌ Invalid group ID provided for MTM group removal");return}const N=i(Or).length;b(Or,H(i(Or).filter(R=>R.id!==k))),i(Or).length<N?(console.log("✅ Removed MTM group with ID:",k),Hh()):console.warn("⚠️ MTM group not found for removal:",k)}catch(N){console.error("❌ Error removing MTM group:",N)}}function Hh(){var k;if(!(!i(ye)||!n()))try{console.log("🔄 Applying MTM changes to chart...");const N=Object.keys(r().saveInds).filter(F=>r().saveInds[F]&&r().saveInds[F].name==="MTM").sort((F,z)=>F===`${o().editPaneId}_MTM`?-1:z===`${o().editPaneId}_MTM`?1:F.localeCompare(z));console.log("🔧 Applying MTM changes. Existing keys:",N),console.log("🔧 Current MTM groups:",i(Or).length);const R=i(Or).length;if(N.length>R)for(let F=R;F<N.length;(F+=1)-1){const z=N[F],q=r().saveInds[z];if(q&&q.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",q.pane_id),(k=n())==null||k.removeIndicator({paneId:q.pane_id,name:"MTM"})}catch(he){console.log("❌ Error removing excess MTM indicator:",he)}}i(Or).forEach((F,z)=>{var Ee,lt,Qt;const q=[F.period],he={lines:[{color:F.color,size:F.thickness,style:F.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:F.lineStyle==="dashed"?[4,4]:F.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(z===0)console.log("🔄 Updating first MTM in pane:",o().editPaneId),(Ee=n())==null||Ee.overrideIndicator({name:"MTM",calcParams:q,styles:he,paneId:o().editPaneId});else{const en=`pane_MTM_${z+1}_MTM`,Zs=N.find(xs=>xs===en);if(Zs){const xs=r().saveInds[Zs];xs&&xs.pane_id&&(console.log("🔄 Updating existing MTM in pane:",xs.pane_id),(lt=n())==null||lt.overrideIndicator({name:"MTM",calcParams:q,styles:he,paneId:xs.pane_id}),F.actualPaneId=xs.pane_id)}else{const xs=`pane_MTM_${z+1}`;console.log("🆕 Creating new MTM in pane:",xs);const Un=(Qt=n())==null?void 0:Qt.createIndicator({name:"MTM",calcParams:q,styles:he},!0,{id:xs,axis:{gap:{bottom:2}}});Un&&(F.actualPaneId=xs,console.log("✅ Created new MTM indicator with ID:",Un,"in pane:",xs))}}}),c.update(F=>{try{Object.keys(F.saveInds).forEach(z=>{F.saveInds[z]&&F.saveInds[z].name==="MTM"&&delete F.saveInds[z]}),i(Or).forEach((z,q)=>{try{const he=q===0?`${o().editPaneId}_MTM`:`pane_MTM_${q+1}_MTM`,Ee=q===0?o().editPaneId:z.actualPaneId||`pane_MTM_${q+1}`;if(!he||!Ee){console.error(`❌ Invalid save key or pane ID for MTM group ${q}`);return}const lt={name:"MTM",mtmGroup:z,pane_id:Ee,groupIndex:q,mtmGroups:q===0?[...i(Or)]:void 0,params:[z.period]};F.saveInds[he]=lt,console.log("💾 Saved MTM group",q,"with key:",he,"and pane ID:",Ee)}catch(he){console.error(`❌ Error saving MTM group ${q}:`,he)}})}catch(z){console.error("❌ Error in MTM save operation:",z)}return F}),console.log("✅ MTM changes applied successfully")}catch(N){console.error("❌ Critical error in applyMtm:",N)}}function fg(){if(!i(yu))return;const k=`${o().editPaneId}_WR`,N=r().saveInds[k];if(N&&N.wrGroups&&N.wrGroups.length>0){b(sd,H([...N.wrGroups]));return}const R=[];Object.keys(r().saveInds).forEach(F=>{if((F.includes("_WR")||F.startsWith("WR_"))&&F!==k){const z=r().saveInds[F];z&&z.wrGroup&&R.push(z.wrGroup)}}),N&&N.wrGroup&&R.unshift(N.wrGroup),R.length>0?b(sd,H([...R])):i(sd).length===0&&b(sd,H([{id:Br(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:o().editPaneId,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}}]))}function qh(){if(!i(yu))return;const k=`pane_WR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={id:Br(),period:14,overboughtLevel:-20,middleLevel:-50,oversoldLevel:-80,paneId:k,styles:{wr:{color:"#2563eb",thickness:1,lineStyle:"solid"},overbought:{color:"#EF4444",thickness:1,lineStyle:"solid"},oversold:{color:"#10B981",thickness:1,lineStyle:"solid"},middleLine:{color:"#6B7280",thickness:1,lineStyle:"solid"}}};if(i(sd).push(N),Yb.createInstance(k,{period:N.period,lineColor:N.styles.wr.color,lineThickness:N.styles.wr.thickness,lineStyle:N.styles.wr.lineStyle,levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overbought.color,lineStyle:N.styles.overbought.lineStyle,thickness:N.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:N.middleLevel,color:N.styles.middleLine.color,lineStyle:N.styles.middleLine.lineStyle,thickness:N.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversold.color,lineStyle:N.styles.oversold.lineStyle,thickness:N.styles.oversold.thickness,label:"Oversold",visible:!0}]}),n()){let R=mt.Solid,F=[2,2];if(N.styles.wr.lineStyle==="dashed"?(R=mt.Dashed,F=[4,4]):N.styles.wr.lineStyle==="dotted"&&(R=mt.Dashed,F=[2,2]),n().createIndicator({name:"WR",calcParams:[N.period],styles:{lines:[{color:N.styles.wr.color,size:N.styles.wr.thickness,style:R,dashedValue:F}]}},!1,{id:k})){const q=`${k}_WR`;c.update(he=>(he.saveInds[q]={name:"WR",pane_id:k,params:[N.period]},he))}}console.log("➕ Added new WR group in new pane:",N.id,k)}function Uv(k){if(!i(yu)||i(sd).length<=1)return;const N=i(sd).find(F=>F.id===k);if(!N)return;i(sd).findIndex(F=>F.id===k);const R=N.paneId;b(sd,H(i(sd).filter(F=>F.id!==k))),R&&Yb.deleteInstance(R),R&&Su(R,"WR"),console.log("🗑️ Removed WR group from pane:",R)}function Zf(k){if(!i(yu)||!n()||k<0||k>=i(sd).length)return;const N=i(sd)[k],R=N.paneId||o().editPaneId;console.log("🔄 Updating WR indicator:",k,R);try{Yb.updateInstance(R,{period:N.period,lineColor:N.styles.wr.color,lineThickness:N.styles.wr.thickness,lineStyle:N.styles.wr.lineStyle,enableDynamicColoring:!0,overboughtColor:N.styles.overbought.color||"#EF4444",oversoldColor:N.styles.oversold.color||"#10B981",overboughtThreshold:N.overboughtLevel,oversoldThreshold:N.oversoldLevel,levels:[{id:"overbought",value:N.overboughtLevel,color:N.styles.overbought.color||"#EF4444",lineStyle:N.styles.overbought.lineStyle,thickness:N.styles.overbought.thickness,label:"Overbought",visible:!0},{id:"middle",value:N.middleLevel,color:N.styles.middleLine.color||"#6B7280",lineStyle:N.styles.middleLine.lineStyle,thickness:N.styles.middleLine.thickness,label:"Middle",visible:!0},{id:"oversold",value:N.oversoldLevel,color:N.styles.oversold.color||"#10B981",lineStyle:N.styles.oversold.lineStyle,thickness:N.styles.oversold.thickness,label:"Oversold",visible:!0}]}),n().removeIndicator({paneId:R,name:"WR"});let F=mt.Solid,z=[2,2];if(N.styles.wr.lineStyle==="dashed"?(F=mt.Dashed,z=[4,4]):N.styles.wr.lineStyle==="dotted"&&(F=mt.Dashed,z=[2,2]),n().createIndicator({name:"WR",calcParams:[N.period],styles:{lines:[{color:N.styles.wr.color,size:N.styles.wr.thickness,style:F,dashedValue:z}]}},R===o().editPaneId,{id:R})){const he=`${R}_WR`;c.update(Ee=>(Ee.saveInds[he]={name:"WR",pane_id:R,params:[N.period]},Ee))}console.log("✅ WR indicator and levels updated successfully")}catch(F){console.error("❌ Error updating WR indicator:",F)}}function vm(){if(!i(Yf))return;const k=Object.entries(r().saveInds).filter(([N,R])=>R.name==="VR");if(k.length>0)b(of,H(k.map(([N,R])=>{var F,z,q;return R.vrGroups&&R.vrGroups.length>0?R.vrGroups[0]:R.vrGroup?R.vrGroup:{id:Br(),paneId:R.pane_id,period:((F=R.params)==null?void 0:F[0])||26,shortPeriod:((z=R.params)==null?void 0:z[1])||6,longPeriod:((q=R.params)==null?void 0:q[2])||12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}}}))),console.log("✅ Loaded VR groups from save system:",i(of).length);else if(i(of).length===0){const N={id:Br(),paneId:o().editPaneId,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};b(of,H([N])),console.log("✅ Created default VR group with pane ID:",o().editPaneId)}}function pg(){if(!i(Cu))return;const k=Object.entries(r().saveInds).filter(([N,R])=>R.name==="VOL");if(k.length>0)b(zt,H(k.map(([N,R])=>{var F,z,q,he,Ee;if(R.volGroups&&R.volGroups.length>0){const lt=R.volGroups[0];return{...lt,paneId:"candle_pane",styles:{...lt.styles,ema:{visible:((z=(F=lt.styles)==null?void 0:F.ema)==null?void 0:z.visible)??!1,...lt.styles.ema}}}}else if(R.volGroup){const lt=R.volGroup;return{...lt,paneId:"candle_pane",styles:{...lt.styles,ema:{visible:((he=(q=lt.styles)==null?void 0:q.ema)==null?void 0:he.visible)??!1,...lt.styles.ema}}}}else return{id:Br(),paneId:"candle_pane",period:((Ee=R.params)==null?void 0:Ee[0])||20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}}}))),console.log("✅ Loaded Volume groups from save system:",i(zt).length);else if(i(zt).length===0){const N={id:Br(),paneId:"candle_pane",period:20,styles:{histogram:{upColor:"#26a69a",downColor:"#ef5350",thickness:1,lineStyle:"solid"},ema:{color:"#8B5CF6",thickness:1,lineStyle:"dotted",visible:!1}}};b(zt,H([N])),console.log("✅ Created default Volume group:",N)}}function d0(){if(!i(Yf))return;const k=`pane_VR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={id:Br(),paneId:k,period:26,shortPeriod:6,longPeriod:12,styles:{vr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},vrShort:{color:"#2196F3",thickness:1,lineStyle:"solid"},vrLong:{color:"#4CAF50",thickness:1,lineStyle:"solid"}}};if(i(of).push(N),n()){let R=mt.Solid,F=[2,2];if(N.styles.vr.lineStyle==="dashed"?(R=mt.Dashed,F=[4,4]):N.styles.vr.lineStyle==="dotted"&&(R=mt.Dashed,F=[2,2]),n().createIndicator({name:"VR",calcParams:[N.period,N.shortPeriod,N.longPeriod],styles:{lines:[{color:N.styles.vr.color,size:N.styles.vr.thickness,style:R,dashedValue:F}]}},!1,{id:k})){const q=`${k}_VR`;c.update(he=>(he.saveInds[q]={name:"VR",pane_id:k,params:[N.period,N.shortPeriod,N.longPeriod]},he))}}console.log("➕ Added new VR group in new pane:",N.id,k)}function ee(k){if(!i(Yf)||i(of).length<=1||k<0||k>=i(of).length)return;console.log("🗑️ Removing VR group at index:",k);const R=i(of)[k].paneId,F=i(of).length;if(i(of).splice(k,1),console.log(`📝 Removed group: ${F} -> ${i(of).length}`),n()&&R)try{console.log("🗑️ Removing VR from pane:",R),Su(R,"VR")}catch(z){console.error("❌ Error removing VR indicator:",z)}console.log("✅ VR group removed. Remaining groups:",i(of).length),console.log("🗑️ Removed VR group from list (will be applied on confirm)")}function oe(k){if(!i(Cu)||i(zt).length<=1||k<0||k>=i(zt).length)return;console.log("🗑️ Removing Volume group at index:",k),i(zt)[k];const N="candle_pane",R=i(zt).length;if(i(zt).splice(k,1),console.log(`📝 Removed group: ${R} -> ${i(zt).length}`),n()&&N)try{console.log("🗑️ Removing Volume from pane:",N),Su(N,"VOL")}catch(F){console.error("❌ Error removing Volume indicator:",F)}console.log("✅ Volume group removed. Remaining groups:",i(zt).length),console.log("🗑️ Removed Volume group from list (will be applied on confirm)")}function $e(k){if(o().editIndName!=="VR"||!n()||k<0||k>=i(of).length)return;const N=i(of)[k],R=N.paneId||o().editPaneId;console.log("🔄 Updating VR indicator:",k,R);try{n().removeIndicator({paneId:R,name:"VR"});const F=lt=>{switch(lt){case"dashed":return{style:mt.Dashed,dashedValue:[4,4]};case"dotted":return{style:mt.Dashed,dashedValue:[2,2]};default:return{style:mt.Solid,dashedValue:[2,2]}}},z=F(N.styles.vr.lineStyle),q=F(N.styles.vrShort.lineStyle),he=F(N.styles.vrLong.lineStyle);if(n().createIndicator({name:"VR",calcParams:[N.period,N.shortPeriod,N.longPeriod],styles:{lines:[{color:N.styles.vr.color,size:N.styles.vr.thickness,style:z.style,dashedValue:z.dashedValue},{color:N.styles.vrShort.color,size:N.styles.vrShort.thickness,style:q.style,dashedValue:q.dashedValue},{color:N.styles.vrLong.color,size:N.styles.vrLong.thickness,style:he.style,dashedValue:he.dashedValue}]}},R===o().editPaneId,{id:R})){const lt=`${R}_VR`;c.update(Qt=>(Qt.saveInds[lt]={name:"VR",pane_id:R,params:[N.period,N.shortPeriod,N.longPeriod]},Qt))}console.log("✅ VR indicator updated successfully")}catch(F){console.error("❌ Error updating VR indicator:",F)}}function at(k){if(o().editIndName!=="VOL"||!n()||k<0||k>=i(zt).length)return;const N=i(zt)[k],R="candle_pane";try{console.log("🔄 Updating Volume indicator for group:",k,"paneId:",R),n().removeIndicator({paneId:R,name:"VOL"});let F=mt.Solid,z=[2,2];if(N.styles.ema.lineStyle==="dashed"?(F=mt.Dashed,z=[4,4]):N.styles.ema.lineStyle==="dotted"&&(F=mt.Dashed,z=[2,2]),console.log("updateVolIndicator - Colors being applied:",{upColor:N.styles.histogram.upColor,downColor:N.styles.histogram.downColor,noChangeColor:N.styles.histogram.upColor,emaColor:N.styles.ema.color}),n().createIndicator({name:"VOL",calcParams:[N.period],styles:{bars:[{upColor:N.styles.histogram.upColor,downColor:N.styles.histogram.downColor,noChangeColor:N.styles.histogram.upColor}],lines:[{color:N.styles.ema.color,size:N.styles.ema.thickness,style:F,dashedValue:z}]}},!0,{id:R})){const he=`${R}_VOL`;c.update(Ee=>(Ee.saveInds[he]={name:"VOL",pane_id:R,params:[N.period],volGroup:N},Ee))}console.log("✅ Volume indicator updated successfully")}catch(F){console.error("❌ Error updating Volume indicator:",F)}}function Gt(k){if(o().editIndName!=="BBI"||!n()||k<0||k>=i(Qd).length)return;const N=i(Qd)[k],R=N.paneId||o().editPaneId;console.log("🔄 Updating BBI indicator:",k,R);try{n().removeIndicator({paneId:R,name:"BBI"});const z=(he=>{switch(he){case"dashed":return{style:mt.Dashed,dashedValue:[4,4]};case"dotted":return{style:mt.Dashed,dashedValue:[2,2]};default:return{style:mt.Solid,dashedValue:[2,2]}}})(N.lineStyle);if(n().createIndicator({name:"BBI",calcParams:[N.period1,N.period2,N.period3,N.period4],styles:{lines:[{color:N.color,size:N.thickness,style:z.style,dashedValue:z.dashedValue}]}},R===o().editPaneId,{id:R})){const he=`${R}_BBI`;c.update(Ee=>(Ee.saveInds[he]={name:"BBI",pane_id:R,params:[N.period1,N.period2,N.period3,N.period4],bbiGroup:N},Ee))}console.log("✅ BBI indicator updated successfully")}catch(F){console.error("❌ Error updating BBI indicator:",F)}}function Nt(){if(!(o().editIndName!=="EMA"||!n()))try{console.log("🔄 Updating EMA indicator"),n().removeIndicator({paneId:o().editPaneId,name:"EMA"});const k=n().createIndicator({name:"EMA",calcParams:u,styles:{lines:u.map((N,R)=>{const F=h[R];let z=mt.Solid,q=[2,2];return(F==null?void 0:F.lineStyle)==="dashed"?(z=mt.Dashed,q=[4,4]):(F==null?void 0:F.lineStyle)==="dotted"&&(z=mt.Dashed,q=[2,2]),{color:(F==null?void 0:F.color)||"#FF6B6B",size:(F==null?void 0:F.thickness)||1,style:z,dashedValue:q}})}},!0,{id:o().editPaneId});console.log("✅ EMA indicator updated successfully")}catch(k){console.error("❌ Error updating EMA indicator:",k)}}function Cs(){if(!(o().editIndName!=="MA"||!n()))try{console.log("🔄 Updating MA indicator"),n().removeIndicator({paneId:o().editPaneId,name:"MA"});const k=n().createIndicator({name:"MA",calcParams:u,styles:{lines:u.map((R,F)=>{const z=h[F];let q=mt.Solid,he=[2,2];return(z==null?void 0:z.lineStyle)==="dashed"?(q=mt.Dashed,he=[4,4]):(z==null?void 0:z.lineStyle)==="dotted"&&(q=mt.Dashed,he=[2,2]),{color:(z==null?void 0:z.color)||"#2563eb",size:(z==null?void 0:z.thickness)||1,style:q,dashedValue:he}})}},!0,{id:o().editPaneId}),N=`${o().editPaneId}_MA`;c.update(R=>(R.saveInds[N]&&(R.saveInds[N].params=[...u],R.saveInds[N].styles=h.map(F=>({...F}))),R)),console.log("✅ MA indicator updated successfully")}catch(k){console.error("❌ Error updating MA indicator:",k)}}function nn(){var R,F,z;if(!i(Sd))return;const k=`${o().editPaneId}_SMA`,N=r().saveInds[k];N&&N.smaGroups&&N.smaGroups.length>0?(b(Si,H([...N.smaGroups])),console.log("✅ Loaded",i(Si).length,"SMA groups from saved data")):N&&N.params&&N.params.length>0&&N.styles?(b(Si,H([{id:Br(),name:"SMA",period:N.params[0]||20,color:((R=N.styles[0])==null?void 0:R.color)||"#FF6C37",thickness:((F=N.styles[0])==null?void 0:F.thickness)||2,lineStyle:((z=N.styles[0])==null?void 0:z.lineStyle)||"solid"}])),console.log("✅ Loaded SMA from saved data (old format)")):i(Si).length===0&&(b(Si,H([{id:Br(),name:"SMA",period:20,color:"#FF6C37",thickness:2,lineStyle:"solid"}])),console.log("✅ Created default SMA group"))}function Xs(k){var N,R;if(!(o().editIndName!=="SMA"||!n()||i(Si).length===0||k>=i(Si).length))try{console.log("🔄 Updating SMA indicator at index:",k);const F=i(Si)[k],q=((N=n())==null?void 0:N.getIndicators()).filter(Ee=>Ee.name==="SMA");for(const Ee of q)(R=n())==null||R.removeIndicator({paneId:Ee.paneId,name:"SMA"});i(Si).forEach((Ee,lt)=>{var Zs;let Qt=mt.Solid,en=[2,2];Ee.lineStyle==="dashed"?(Qt=mt.Dashed,en=[8,4]):Ee.lineStyle==="dotted"&&(Qt=mt.Dashed,en=[2,2]),(Zs=n())==null||Zs.createIndicator({name:"SMA",calcParams:[Ee.period],styles:{lines:[{color:Ee.color,size:Ee.thickness,style:Qt,dashedValue:en}]}},!0,{id:o().editPaneId})});const he=`${o().editPaneId}_SMA`;c.update(Ee=>(Ee.saveInds[he]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Si).map(lt=>({...lt}))},Ee)),console.log("✅ SMA indicators updated successfully")}catch(F){console.error("❌ Error updating SMA indicator:",F)}}function Xn(){if(!i(Sd))return;const k=i(Si).length>0?i(Si)[i(Si).length-1].period+10:20,N=["#FF6C37","#2563eb","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],R=N[i(Si).length%N.length],F={id:Br(),name:"SMA",period:k,color:R,thickness:2,lineStyle:"solid"};if(i(Si).push(F),n()){n().createIndicator({name:"SMA",calcParams:[F.period],styles:{lines:[{color:F.color,size:F.thickness,style:mt.Solid,dashedValue:[2,2]}]}},!0,{id:o().editPaneId});const z=`${o().editPaneId}_SMA`;c.update(q=>(q.saveInds[z]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Si).map(he=>({...he}))},q))}console.log("➕ Added new SMA group:",F)}function ho(k){var N,R;if(!(!i(Sd)||i(Si).length<=1||k<0||k>=i(Si).length)&&(console.log("🗑️ Removing SMA group at index:",k),i(Si).splice(k,1),n()))try{const z=((N=n())==null?void 0:N.getIndicators()).filter(he=>he.name==="SMA");for(const he of z)(R=n())==null||R.removeIndicator({paneId:he.paneId,name:"SMA"});i(Si).forEach(he=>{var Qt;let Ee=mt.Solid,lt=[2,2];he.lineStyle==="dashed"?(Ee=mt.Dashed,lt=[8,4]):he.lineStyle==="dotted"&&(Ee=mt.Dashed,lt=[2,2]),(Qt=n())==null||Qt.createIndicator({name:"SMA",calcParams:[he.period],styles:{lines:[{color:he.color,size:he.thickness,style:Ee,dashedValue:lt}]}},!0,{id:o().editPaneId})});const q=`${o().editPaneId}_SMA`;c.update(he=>(i(Si).length>0?he.saveInds[q]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Si).map(Ee=>({...Ee}))}:delete he.saveInds[q],he)),console.log("✅ SMA group removed and chart updated")}catch(F){console.error("❌ Error removing SMA group:",F)}}function Zn(){var k,N;if(i(Sd)){console.log("🔧 SMA Confirm: Saving",i(Si).length,"SMA groups");try{const R=(k=n())==null?void 0:k.getIndicators(),F=(R==null?void 0:R.filter(q=>q.name==="SMA"))||[];for(const q of F)(N=n())==null||N.removeIndicator({paneId:q.paneId,name:"SMA"});i(Si).forEach(q=>{var lt;let he=mt.Solid,Ee=[2,2];q.lineStyle==="dashed"?(he=mt.Dashed,Ee=[8,4]):q.lineStyle==="dotted"&&(he=mt.Dashed,Ee=[2,2]),(lt=n())==null||lt.createIndicator({name:"SMA",calcParams:[q.period],styles:{lines:[{color:q.color,size:q.thickness,style:he,dashedValue:Ee}]}},!0,{id:o().editPaneId}),console.log("✅ Created SMA with period:",q.period)});const z=`${o().editPaneId}_SMA`;c.update(q=>(q.saveInds[z]={name:"SMA",pane_id:o().editPaneId,smaGroups:i(Si).map(he=>({...he}))},console.log("💾 Saved",i(Si).length,"SMA groups to:",z),q)),console.log("✅ SMA confirm completed successfully"),l.update(q=>(q.editIndName="",q.editPaneId="",q.modalIndCfg=!1,q))}catch(R){console.error("❌ Error in SMA confirm:",R)}}}function Go(){if(!i(Ga))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="BBI").sort((N,R)=>N===`${o().editPaneId}_BBI`?-1:R===`${o().editPaneId}_BBI`?1:N.localeCompare(R));console.log("🔍 Found existing BBI keys:",k),k.length>0?(b(Qd,H([])),k.forEach((N,R)=>{const F=r().saveInds[N];if(F){const z=F.pane_id||N.replace("_BBI","");if(F.bbiGroup){const q={...F.bbiGroup};q.paneId||(q.paneId=z),i(Qd).push(q)}else F.params&&F.params.length===4&&i(Qd).push({id:Br(),name:`BBI${R+1}`,paneId:z,period1:F.params[0]||3,period2:F.params[1]||6,period3:F.params[2]||12,period4:F.params[3]||24,color:"#8B5CF6",thickness:1,lineStyle:"solid"})}}),console.log("✅ Loaded",i(Qd).length,"existing BBI groups")):i(Qd).length===0&&(b(Qd,H([{id:Br(),name:"BBI",paneId:o().editPaneId,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BBI group"))}function mi(){if(!i(Ga))return;const k=`pane_BBI_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N=i(Qd).length+1,R={id:Br(),name:`BBI${N}`,paneId:k,period1:3,period2:6,period3:12,period4:24,color:"#8B5CF6",thickness:1,lineStyle:"solid"};if(i(Qd).push(R),n()){const z=(he=>{switch(he){case"dashed":return{style:mt.Dashed,dashedValue:[4,4]};case"dotted":return{style:mt.Dashed,dashedValue:[2,2]};default:return{style:mt.Solid,dashedValue:[2,2]}}})(R.lineStyle);if(n().createIndicator({name:"BBI",calcParams:[R.period1,R.period2,R.period3,R.period4],styles:{lines:[{color:R.color,size:R.thickness,style:z.style,dashedValue:z.dashedValue}]}},!1,{id:k})){const he=`${k}_BBI`;c.update(Ee=>(Ee.saveInds[he]={name:"BBI",pane_id:k,params:[R.period1,R.period2,R.period3,R.period4],bbiGroup:R},Ee))}}console.log("➕ Added new BBI group in new pane:",R.id,k)}function $o(k){var z;if(!i(Ga)||i(Qd).length<=1)return;const N=i(Qd).findIndex(q=>q.id===k);if(N===-1)return;const R=i(Qd)[N];console.log("🗑️ Removing BBI group at index:",N,"ID:",k,"paneId:",R.paneId);const F=R.paneId||(N===0?o().editPaneId:null);if(n()&&F){try{console.log("🗑️ Removing BBI from pane:",F),(z=n())==null||z.removeIndicator({paneId:F,name:"BBI"}),console.log("✅ Successfully removed BBI from pane:",F)}catch(q){console.log("❌ Error removing BBI indicator from pane:",F,q)}c.update(q=>{const he=`${F}_BBI`;return console.log("🧹 Cleaning saved state key:",he),delete q.saveInds[he],q})}else console.log("❌ Cannot remove BBI: no valid paneId found for group:",R);b(Qd,H(i(Qd).filter(q=>q.id!==k))),console.log("✅ BBI group removed from array. Remaining groups:",i(Qd).length)}function kl(){if(!i(Re))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="TRIX").sort((N,R)=>N===`${o().editPaneId}_TRIX`?-1:R===`${o().editPaneId}_TRIX`?1:N.localeCompare(R));console.log("🔍 Found existing TRIX keys:",k),k.length>0?(b(nu,H([])),k.forEach((N,R)=>{const F=r().saveInds[N];if(F)if(F.trixGroup){const z={...F.trixGroup};z.paneId||(z.paneId=F.pane_id||o().editPaneId),i(nu).push(z)}else F.params&&F.params.length>=2&&i(nu).push({id:Br(),name:`TRIX${R+1}`,trixPeriod:F.params[0]||15,signalPeriod:F.params[1]||9,paneId:F.pane_id||o().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",i(nu).length,"existing TRIX groups")):i(nu).length===0&&(b(nu,H([{id:Br(),name:"TRIX",trixPeriod:15,signalPeriod:9,paneId:o().editPaneId,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default TRIX group"))}function Fl(){if(!i(Re))return;const k=`pane_TRIX_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={id:Br(),name:`TRIX${i(nu).length+1}`,trixPeriod:15,signalPeriod:9,paneId:k,styles:{trix:{color:"#2563eb",thickness:2,lineStyle:"solid"},signal:{color:"#dc2626",thickness:1,lineStyle:"solid"}}};if(i(nu).push(N),n()){let R=mt.Solid,F=[2,2],z=mt.Solid,q=[2,2];if(N.styles.trix.lineStyle==="dashed"?(R=mt.Dashed,F=[4,4]):N.styles.trix.lineStyle==="dotted"&&(R=mt.Dashed,F=[2,2]),N.styles.signal.lineStyle==="dashed"?(z=mt.Dashed,q=[4,4]):N.styles.signal.lineStyle==="dotted"&&(z=mt.Dashed,q=[2,2]),n().createIndicator({name:"TRIX",calcParams:[N.trixPeriod,N.signalPeriod],styles:{lines:[{color:N.styles.trix.color,size:N.styles.trix.thickness,style:R,dashedValue:F},{color:N.styles.signal.color,size:N.styles.signal.thickness,style:z,dashedValue:q}]}},!1,{id:k})){const Ee=`${k}_TRIX`;c.update(lt=>(lt.saveInds[Ee]={name:"TRIX",pane_id:k,params:[N.trixPeriod,N.signalPeriod]},lt))}}console.log("➕ Added new TRIX group in new pane:",N.id,k)}function il(k){if(!i(Re)||i(nu).length<=1||k<0||k>=i(nu).length)return;console.log("🗑️ Removing TRIX group at index:",k);const R=i(nu)[k].paneId||o().editPaneId,F=i(nu).length;if(i(nu).splice(k,1),console.log(`📝 Removed group: ${F} -> ${i(nu).length}`),n()&&R)try{console.log("🗑️ Removing TRIX from pane:",R),Su(R,"TRIX")}catch(z){console.error("❌ Error removing TRIX indicator:",z)}console.log("✅ TRIX group removed. Remaining groups:",i(nu).length)}function Ya(){if(!i(fu))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="BIAS").sort((N,R)=>N===`${o().editPaneId}_BIAS`?-1:R===`${o().editPaneId}_BIAS`?1:N.localeCompare(R));console.log("🔍 Found existing BIAS keys:",k),k.length>0?(b(oo,H([])),k.forEach((N,R)=>{const F=r().saveInds[N];F&&(F.biasGroup?i(oo).push({...F.biasGroup}):F.params&&F.params.length>=1&&i(oo).push({id:Br(),name:`BIAS${R+1}`,period:F.params[0]||6,color:"#2196F3",thickness:1,lineStyle:"solid"}))}),console.log("✅ Loaded",i(oo).length,"existing BIAS groups")):i(oo).length===0&&(b(oo,H([{id:Br(),name:"BIAS",period:6,color:"#2196F3",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default BIAS group"))}function Kl(){var R;if(!i(fu)||!n())return;console.log("🔄 Applying BIAS changes in real-time, groups:",i(oo).length);const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="BIAS").sort((F,z)=>F===`${o().editPaneId}_BIAS`?-1:z===`${o().editPaneId}_BIAS`?1:F.localeCompare(z));console.log("🔍 Existing BIAS keys:",k);const N=i(oo).length;if(k.length>N){console.log(`🗑️ Removing ${k.length-N} excess BIAS indicators`);for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];if(q&&q.pane_id){console.log("🗑️ Removing BIAS indicator from pane:",q.pane_id);try{(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"BIAS"})}catch(he){console.log("Error removing excess BIAS indicator:",he)}}}}i(oo).forEach((F,z)=>{var Ee,lt,Qt;const q=[F.period],he={lines:[{color:F.color,size:F.thickness,style:F.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:F.lineStyle==="dashed"?[4,4]:F.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(z===0)console.log("🔄 Updating first BIAS indicator in pane:",o().editPaneId),(Ee=n())==null||Ee.overrideIndicator({name:"BIAS",calcParams:q,styles:he,paneId:o().editPaneId});else{const en=`pane_BIAS_${z+1}_BIAS`,Zs=k.find(xs=>xs===en);if(Zs){const xs=r().saveInds[Zs];xs&&xs.pane_id&&(console.log(`🔄 Updating existing BIAS ${z+1} in pane:`,xs.pane_id),(lt=n())==null||lt.overrideIndicator({name:"BIAS",calcParams:q,styles:he,paneId:xs.pane_id}))}else{const xs=`pane_BIAS_${z+1}`;console.log(`🆕 Creating new BIAS ${z+1} with pane ID:`,xs),(Qt=n())==null||Qt.createIndicator({name:"BIAS",calcParams:q,styles:he},!0,{id:xs})}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="BIAS"&&delete F.saveInds[z]}),i(oo).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_BIAS`:`pane_BIAS_${q+1}_BIAS`,Ee=q===0?o().editPaneId:`pane_BIAS_${q+1}`;console.log(`💾 Saving BIAS group ${q+1} with key:`,he),F.saveInds[he]={name:"BIAS",biasGroup:z,pane_id:Ee,groupIndex:q,biasGroups:q===0?[...i(oo)]:void 0,params:[z.period]}}),F))}function ru(k){if(!i(fu)||i(oo).length<=1)return;const N=i(oo).findIndex(R=>R.id===k);N!==-1&&(console.log("🗑️ Removing BIAS group at index:",N,"ID:",k),b(oo,H(i(oo).filter(R=>R.id!==k))),Kl(),console.log("✅ BIAS group removed. Remaining groups:",i(oo).length))}function vd(){if(!i(ce))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="CCI").sort((N,R)=>N===`${o().editPaneId}_CCI`?-1:R===`${o().editPaneId}_CCI`?1:N.localeCompare(R));if(console.log("🔍 Found existing CCI keys:",k),k.length>0){b(uo,H([]));let N=1;k.forEach((R,F)=>{const z=r().saveInds[R];if(z)if(z.cciGroup){const q={...z.cciGroup};q.name=N===1?"CCI":`CCI${N}`,i(uo).push(q),N+=1}else z.params&&z.params.length>=1&&(i(uo).push({id:Br(),name:N===1?"CCI":`CCI${N}`,period:z.params[0]||14,color:"#FF9800",thickness:1,lineStyle:"solid"}),N+=1)}),console.log("✅ Loaded",i(uo).length,"existing CCI groups with proper naming")}else i(uo).length===0&&(b(uo,H([{id:Br(),name:"CCI",period:14,color:"#FF9800",thickness:1,lineStyle:"solid"}])),console.log("🆕 Created default CCI group"))}function nc(){if(!i(ce)||!n())return;console.log("🔄 Applying CCI changes in real-time, groups:",i(uo).length);const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="CCI").sort((q,he)=>q===`${o().editPaneId}_CCI`?-1:he===`${o().editPaneId}_CCI`?1:q.localeCompare(he));console.log("🔍 Existing CCI keys:",k);const N=new Map,R=new Set;i(uo).forEach((q,he)=>{let Ee=null;for(const lt of k){if(R.has(lt))continue;const Qt=r().saveInds[lt];if(Qt&&Qt.cciGroup&&Qt.cciGroup.id===q.id){Ee=lt,R.add(lt);break}}if(!Ee){if(he===0&&!R.has(`${o().editPaneId}_CCI`))Ee=`${o().editPaneId}_CCI`;else{let lt=2;for(;R.has(`pane_CCI_${lt}_CCI`)||k.includes(`pane_CCI_${lt}_CCI`);)lt+=1;Ee=`pane_CCI_${lt}_CCI`}R.add(Ee)}N.set(q.id,Ee)});const F=Array.from(N.values()),z=k.filter(q=>!F.includes(q));z.forEach(q=>{var Ee;const he=r().saveInds[q];if(he&&he.pane_id){console.log("🗑️ Removing CCI indicator from pane:",he.pane_id,"key:",q);try{(Ee=n())==null||Ee.removeIndicator({paneId:he.pane_id,name:"CCI"})}catch(lt){console.log("Error removing excess CCI indicator:",lt)}}}),i(uo).forEach((q,he)=>{var Zs,xs;const Ee=[q.period],lt=N.get(q.id),Qt={lines:[{color:q.color,size:q.thickness,style:q.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.lineStyle==="dashed"?[4,4]:q.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},en=k.includes(lt)?r().saveInds[lt]:null;if(en&&en.pane_id)console.log("🔄 Updating existing CCI in pane:",en.pane_id),(Zs=n())==null||Zs.overrideIndicator({name:"CCI",calcParams:Ee,styles:Qt,paneId:en.pane_id});else{const Un=lt===`${o().editPaneId}_CCI`?o().editPaneId:lt.replace("_CCI","");console.log("🆕 Creating new CCI with pane ID:",Un,"key:",lt),(xs=n())==null||xs.createIndicator({name:"CCI",calcParams:Ee,styles:Qt},!0,{id:Un})}}),c.update(q=>(z.forEach(he=>{delete q.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i(uo).forEach((he,Ee)=>{const lt=N.get(he.id),Qt=lt===`${o().editPaneId}_CCI`?o().editPaneId:lt.replace("_CCI","");console.log(`💾 Saving CCI group ${Ee+1} with key:`,lt),q.saveInds[lt]={name:"CCI",cciGroup:he,pane_id:Qt,groupIndex:Ee,cciGroups:Ee===0?[...i(uo)]:void 0,params:[he.period]}}),q))}function af(k){if(!i(ce)||i(uo).length<=1)return;const N=i(uo).findIndex(R=>R.id===k);N!==-1&&(console.log("🗑️ Removing CCI group at index:",N,"ID:",k),b(uo,H(i(uo).filter(R=>R.id!==k))),nc(),console.log("✅ CCI group removed. Remaining groups:",i(uo).length))}function zd(){if(!i(Ie))return;const N=Object.values(r().saveInds||{}).filter(R=>(R==null?void 0:R.name)==="SAR").filter(R=>(R==null?void 0:R.pane_id)==="candle_pane");if(N.length>0){const R=N[0];R.sarGroups&&Array.isArray(R.sarGroups)&&R.sarGroups.length>0?b(cc,H([...R.sarGroups])):b(cc,H(N.map(F=>{const[z=.02,q=.02,he=.2]=F.params||[];return{id:Br(),start:z,increment:q,maxValue:he,color:"#2563eb",dotSize:1}})))}else b(cc,H([{id:Br(),start:.02,increment:.02,maxValue:.2,color:"#2563eb",dotSize:1}]));n()&&i(cc).length>0&&Hn()}function lf(k){!i(Ie)||i(cc).length<=1||(b(cc,H(i(cc).filter(N=>N.id!==k))),Hn())}function ef(k){!i(Ie)||!n()||k>=i(cc).length||Hn()}function Hn(){if(!n()||!i(Ie))return;const k="candle_pane";for(let N=0;N<6;(N+=1)-1)try{n().removeIndicator({paneId:k,name:"SAR"})}catch{}i(cc).forEach(N=>{var z;const R=[N.start,N.increment,N.maxValue],F={lines:[{color:N.color,size:N.dotSize,style:mt.Solid}]};(z=n())==null||z.createIndicator({name:"SAR",calcParams:R,styles:F},!0,{id:k})})}function Oo(){if(!i(dt))return;const k=`${o().editPaneId}_SMARTTREND`,N=r().saveInds[k];if(N&&N.superTrendGroups&&N.superTrendGroups.length>0)b(bu,H([...N.superTrendGroups]));else if(N&&Array.isArray(N.params)){const R=Number(N.params[0]??10),F=Number(N.params[1]??3);b(bu,H([{id:Br(),period:R,multiplier:F,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]))}else i(bu).length===0&&b(bu,H([{id:Br(),period:10,multiplier:3,showLabels:!0,styles:{uptrend:{color:"#00FF00",thickness:1,lineStyle:"dashed"},downtrend:{color:"#FF0000",thickness:1,lineStyle:"dashed"}}}]));Mc()}function pi(k){!i(dt)||i(bu).length<=1||(b(bu,H(i(bu).filter(N=>N.id!==k))),Mc())}function ur(k){!i(dt)||!n()||k>=i(bu).length||(i(bu)[k],Mc())}function Mc(){if(!n()||!i(dt))return;const k="candle_pane";for(let N=0;N<6;(N+=1)-1)try{n().removeIndicator({paneId:k,name:"SMARTTREND"})}catch{}i(bu).forEach((N,R)=>{var q;const F=[N.period,N.multiplier],z={lines:[{color:N.styles.uptrend.color,size:N.styles.uptrend.thickness,style:N.styles.uptrend.lineStyle==="dashed"?mt.Dashed:mt.Solid}]};(q=n())==null||q.createIndicator({name:"SMARTTREND",calcParams:F,styles:z,extendData:{showLabels:N.showLabels,uptrendColor:N.styles.uptrend.color,downtrendColor:N.styles.downtrend.color,uptrendThickness:N.styles.uptrend.thickness,downtrendThickness:N.styles.downtrend.thickness,uptrendLineStyle:N.styles.uptrend.lineStyle,downtrendLineStyle:N.styles.downtrend.lineStyle}},!0,{id:k})}),c.update(N=>(Object.keys(N.saveInds).forEach(R=>{N.saveInds[R].name==="SMARTTREND"&&delete N.saveInds[R]}),i(bu).forEach((R,F)=>{const z=F===0?`${k}_SMARTTREND`:`${k}_SMARTTREND_${F+1}`;N.saveInds[z]={name:"SMARTTREND",pane_id:k,params:[R.period,R.multiplier],superTrendGroup:R,groupIndex:F}}),N))}function Nc(){if(!i(ge))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="DMI").sort((N,R)=>N===`${o().editPaneId}_DMI`?-1:R===`${o().editPaneId}_DMI`?1:N.localeCompare(R));if(console.log("🔍 Found existing DMI keys:",k),k.length>0){b($l,H([]));let N=1;k.forEach((R,F)=>{const z=r().saveInds[R];if(z.dmiGroup){const q={...z.dmiGroup};q.name=N===1?"DMI":`DMI${N}`,i($l).push(q),N+=1}else z.params&&z.params.length>=2&&(i($l).push({id:Br(),name:N===1?"DMI":`DMI${N}`,diPeriod:z.params[0]||14,adxPeriod:z.params[1]||6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}),N+=1)}),console.log("✅ Loaded",i($l).length,"existing DMI groups with proper naming")}else i($l).length===0&&(b($l,H([{id:Br(),name:"DMI",diPeriod:14,adxPeriod:6,styles:{diPlus:{color:"#22c55e",thickness:1,lineStyle:"solid"},diMinus:{color:"#ef4444",thickness:1,lineStyle:"solid"},adx:{color:"#3b82f6",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default DMI group"))}function Vf(){if(!i(Q))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="CR").sort((N,R)=>N===`${o().editPaneId}_CR`?-1:R===`${o().editPaneId}_CR`?1:N.localeCompare(R));console.log("🔍 Found existing CR keys:",k),k.length>0?(b($r,H([])),k.forEach((N,R)=>{var z,q,he,Ee,lt;const F=r().saveInds[N];F.crGroup?i($r).push({...F.crGroup}):i($r).push({id:Br(),name:`CR${R+1}`,crPeriod:((z=F.params)==null?void 0:z[0])||26,crMa1Period:((q=F.params)==null?void 0:q[1])||10,crMa2Period:((he=F.params)==null?void 0:he[2])||20,crMa3Period:((Ee=F.params)==null?void 0:Ee[3])||40,crMa4Period:((lt=F.params)==null?void 0:lt[4])||60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}})}),console.log("✅ Loaded",i($r).length,"existing CR groups")):i($r).length===0&&(b($r,H([{id:Br(),name:"CR",crPeriod:26,crMa1Period:10,crMa2Period:20,crMa3Period:40,crMa4Period:60,styles:{cr:{color:"#FF6B35",thickness:2,lineStyle:"solid"},ma1:{color:"#2196F3",thickness:1,lineStyle:"solid"},ma2:{color:"#4CAF50",thickness:1,lineStyle:"solid"},ma3:{color:"#FF9800",thickness:1,lineStyle:"solid"},ma4:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default CR group"))}function xu(){if(!i(ge)||!n())return;console.log("🔄 Applying DMI changes in real-time, groups:",i($l).length);const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="DMI").sort((q,he)=>q===`${o().editPaneId}_DMI`?-1:he===`${o().editPaneId}_DMI`?1:q.localeCompare(he));console.log("🔍 Existing DMI keys:",k);const N=new Map,R=new Set;i($l).forEach((q,he)=>{for(const Ee of k){if(R.has(Ee))continue;const lt=r().saveInds[Ee];if(lt&&lt.dmiGroup&&lt.dmiGroup.id===q.id){N.set(q.id,Ee),R.add(Ee),console.log(`✅ Matched group ${he+1} (ID: ${q.id}) to existing key: ${Ee}`);break}}}),i($l).forEach((q,he)=>{if(N.has(q.id))return;let Ee=null;if(he===0&&!R.has(`${o().editPaneId}_DMI`)&&!k.includes(`${o().editPaneId}_DMI`))Ee=`${o().editPaneId}_DMI`;else{let lt=2;for(;R.has(`pane_DMI_${lt}_DMI`)||k.includes(`pane_DMI_${lt}_DMI`);)lt+=1;Ee=`pane_DMI_${lt}_DMI`}N.set(q.id,Ee),R.add(Ee),console.log(`🆕 Assigned new key for group ${he+1} (ID: ${q.id}): ${Ee}`)});const F=Array.from(N.values()),z=k.filter(q=>!F.includes(q));z.forEach(q=>{var Ee;const he=r().saveInds[q];if(he&&he.pane_id){console.log("🗑️ Removing DMI indicator from pane:",he.pane_id,"key:",q);try{(Ee=n())==null||Ee.removeIndicator({paneId:he.pane_id,name:"DMI"})}catch(lt){console.log("Error removing excess DMI indicator:",lt)}}}),i($l).forEach((q,he)=>{var Un,jo,Lc,Id;const Ee=[q.diPeriod,q.adxPeriod],lt=N.get(q.id),Qt=he===0?o().editPaneId:`pane_DMI_${he+1}`;console.log(`📍 Group ${he+1} (ID: ${q.id}) -> Target pane: ${Qt}, Save key: ${lt}`);const en={lines:[{color:q.styles.diPlus.color,size:q.styles.diPlus.thickness,style:q.styles.diPlus.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.diPlus.lineStyle==="dashed"?[4,4]:q.styles.diPlus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.diMinus.color,size:q.styles.diMinus.thickness,style:q.styles.diMinus.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.diMinus.lineStyle==="dashed"?[4,4]:q.styles.diMinus.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.adx.color,size:q.styles.adx.thickness,style:q.styles.adx.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.adx.lineStyle==="dashed"?[4,4]:q.styles.adx.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},Zs=k.includes(lt)?r().saveInds[lt]:null,xs=Zs==null?void 0:Zs.pane_id;if(xs&&xs!==Qt){console.log(`🔀 Moving DMI from pane ${xs} to ${Qt}`);try{(Un=n())==null||Un.removeIndicator({paneId:xs,name:"DMI"})}catch(sf){console.log("Note: Indicator may not exist in old pane:",sf)}(jo=n())==null||jo.createIndicator({name:"DMI",calcParams:Ee,styles:en},!0,{id:Qt})}else xs?(console.log(`🔄 Updating existing DMI in pane: ${Qt}`),(Lc=n())==null||Lc.overrideIndicator({name:"DMI",calcParams:Ee,styles:en,paneId:Qt})):(console.log(`🆕 Creating new DMI in pane: ${Qt}`),(Id=n())==null||Id.createIndicator({name:"DMI",calcParams:Ee,styles:en},!0,{id:Qt}))}),c.update(q=>(z.forEach(he=>{delete q.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i($l).forEach((he,Ee)=>{const lt=N.get(he.id),Qt=Ee===0?o().editPaneId:`pane_DMI_${Ee+1}`;console.log(`💾 Saving DMI group ${Ee+1} with key: ${lt}, pane: ${Qt}`),q.saveInds[lt]={name:"DMI",dmiGroup:he,pane_id:Qt,groupIndex:Ee,dmiGroups:Ee===0?[...i($l)]:void 0,params:[he.diPeriod,he.adxPeriod]}}),q))}function nd(k){if(!i(ge)||i($l).length<=1)return;const N=i($l).findIndex(R=>R.id===k);N!==-1&&(console.log("🗑️ Removing DMI group at index:",N,"ID:",k),b($l,H(i($l).filter(R=>R.id!==k))),xu(),console.log("✅ DMI group removed. Remaining groups:",i($l).length))}function Dd(){if(!i(Q)||!n())return;console.log("🔄 Applying CR changes in real-time, groups:",i($r).length);const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="CR").sort((q,he)=>q===`${o().editPaneId}_CR`?-1:he===`${o().editPaneId}_CR`?1:q.localeCompare(he));console.log("🔍 Existing CR keys:",k);const N=new Map,R=new Set;i($r).forEach((q,he)=>{let Ee=null;for(const lt of k){if(R.has(lt))continue;const Qt=r().saveInds[lt];if(Qt&&Qt.crGroup&&Qt.crGroup.id===q.id){Ee=lt,R.add(lt);break}}if(!Ee){if(he===0&&!R.has(`${o().editPaneId}_CR`))Ee=`${o().editPaneId}_CR`;else{let lt=2;for(;R.has(`pane_CR_${lt}_CR`)||k.includes(`pane_CR_${lt}_CR`);)lt+=1;Ee=`pane_CR_${lt}_CR`}R.add(Ee)}N.set(q.id,Ee)});const F=Array.from(N.values()),z=k.filter(q=>!F.includes(q));z.forEach(q=>{var Ee;const he=r().saveInds[q];if(he&&he.pane_id){console.log("🗑️ Removing CR indicator from pane:",he.pane_id,"key:",q);try{(Ee=n())==null||Ee.removeIndicator({paneId:he.pane_id,name:"CR"})}catch(lt){console.log("Error removing excess CR indicator:",lt)}}}),i($r).forEach((q,he)=>{var Zs,xs;const Ee=[q.crPeriod,q.crMa1Period,q.crMa2Period,q.crMa3Period,q.crMa4Period],lt=N.get(q.id),Qt={lines:[{color:q.styles.cr.color,size:q.styles.cr.thickness,style:q.styles.cr.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.cr.lineStyle==="dashed"?[4,4]:q.styles.cr.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma1.color,size:q.styles.ma1.thickness,style:q.styles.ma1.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.ma1.lineStyle==="dashed"?[4,4]:q.styles.ma1.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma2.color,size:q.styles.ma2.thickness,style:q.styles.ma2.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.ma2.lineStyle==="dashed"?[4,4]:q.styles.ma2.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma3.color,size:q.styles.ma3.thickness,style:q.styles.ma3.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.ma3.lineStyle==="dashed"?[4,4]:q.styles.ma3.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:q.styles.ma4.color,size:q.styles.ma4.thickness,style:q.styles.ma4.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.styles.ma4.lineStyle==="dashed"?[4,4]:q.styles.ma4.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},en=k.includes(lt)?r().saveInds[lt]:null;if(en&&en.pane_id)console.log("🔄 Updating existing CR in pane:",en.pane_id),(Zs=n())==null||Zs.overrideIndicator({name:"CR",calcParams:Ee,styles:Qt,paneId:en.pane_id});else{const Un=lt===`${o().editPaneId}_CR`?o().editPaneId:lt.replace("_CR","");console.log("🆕 Creating new CR with pane ID:",Un,"key:",lt),(xs=n())==null||xs.createIndicator({name:"CR",calcParams:Ee,styles:Qt},!0,{id:Un})}}),c.update(q=>(z.forEach(he=>{delete q.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i($r).forEach((he,Ee)=>{const lt=N.get(he.id),Qt=lt===`${o().editPaneId}_CR`?o().editPaneId:lt.replace("_CR","");console.log(`💾 Saving CR group ${Ee+1} with key:`,lt),q.saveInds[lt]={name:"CR",crGroup:he,pane_id:Qt,groupIndex:Ee,crGroups:Ee===0?[...i($r)]:void 0,params:[he.crPeriod,he.crMa1Period,he.crMa2Period,he.crMa3Period,he.crMa4Period]}}),q))}function Jf(k){if(!i(Q)||i($r).length<=1)return;const N=i($r).findIndex(R=>R.id===k);N!==-1&&(console.log("🗑️ Removing CR group at index:",N,"ID:",k),b($r,H(i($r).filter(R=>R.id!==k))),Dd(),console.log("✅ CR group removed. Remaining groups:",i($r).length))}function fr(){if(!i(vt))return;const k=`${o().editPaneId}_ROC`,N=r().saveInds[k];N&&N.rocGroups&&N.rocGroups.length>0?(b($a,H([...N.rocGroups])),i($a).forEach((R,F)=>{R.paneId||(R.paneId=F===0?o().editPaneId:void 0)})):N&&N.rocGroup?(b($a,H([N.rocGroup])),i($a)[0]&&!i($a)[0].paneId&&(i($a)[0].paneId=o().editPaneId)):i($a).length===0&&b($a,H([{id:Br(),period:14,period2:21,paneId:o().editPaneId,styles:{roc:{color:"#2563eb",thickness:1,lineStyle:"solid"},roc2:{color:"#dc2626",thickness:1,lineStyle:"solid",visible:!1}}}]))}function sh(){var k;if(!(!n()||!i(vt)))try{const R=((k=n())==null?void 0:k.getIndicators()).filter(F=>F.name==="ROC");console.log("🔍 Detecting paneIds for ROC indicators:",R.length),R.forEach((F,z)=>{z<i($a).length&&!i($a)[z].paneId&&(i($a)[z].paneId=F.paneId,console.log(`📍 Set paneId ${F.paneId} for ROC group ${z}`))})}catch(N){console.error("❌ Error detecting ROC paneIds:",N)}}function gm(){var Qt,en;if(!i(vt)||!n())return;const k=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],N=i($a).length%k.length,R={id:Br(),period:14,period2:21,paneId:void 0,styles:{roc:{color:k[N],thickness:1,lineStyle:"solid"},roc2:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid",visible:!1}}};i($a).push(R);const F=[R.period];let z=mt.Solid,q=[2,2];R.styles.roc.lineStyle==="dashed"?(z=mt.Dashed,q=[4,4]):R.styles.roc.lineStyle==="dotted"&&(z=mt.Dashed,q=[2,2]);const he={lines:[{color:R.styles.roc.color,size:R.styles.roc.thickness,style:z,dashedValue:q,smooth:!1}]},Ee={name:"ROC",calcParams:F,styles:he,figures:[{key:"roc",title:"ROC: ",type:"line"}]};let lt;i($a).length===1?((Qt=n())==null||Qt.overrideIndicator({...Ee,paneId:o().editPaneId}),lt=o().editPaneId):lt=(en=n())==null?void 0:en.createIndicator(Ee,!1,{axis:{gap:{bottom:2}}}),R.paneId=lt??void 0,c.update(Zs=>{const xs=`${o().editPaneId}_ROC`;return Zs.saveInds[xs]||(Zs.saveInds[xs]={name:"ROC",pane_id:o().editPaneId,params:[R.period],rocGroups:[]}),Zs.saveInds[xs].rocGroups||(Zs.saveInds[xs].rocGroups=[]),Zs.saveInds[xs].rocGroups=[...i($a)],Zs})}function _m(k){var F,z;if(!i(vt)||i($a).length<=1)return;const N=i($a).findIndex(q=>q.id===k);if(N===-1)return;console.log("🗑️ Removing ROC group at index:",N,"with ID:",k);const R=i($a).length;if(i($a).splice(N,1),console.log(`📝 Removed ROC group: ${R} -> ${i($a).length}`),i($a).forEach((q,he)=>{q.name=`ROC #${he+1}`}),n())try{const he=((F=n())==null?void 0:F.getIndicators()).filter(Ee=>Ee.name==="ROC");console.log("📈 ROC indicators found:",he.length);for(const Ee of he)console.log("🗑️ Removing ROC from pane:",Ee.paneId),(z=n())==null||z.removeIndicator({paneId:Ee.paneId,name:"ROC"});i($a).forEach((Ee,lt)=>{var Un;let Qt=mt.Solid,en=[2,2];Ee.styles.roc.lineStyle==="dashed"?(Qt=mt.Dashed,en=[4,4]):Ee.styles.roc.lineStyle==="dotted"&&(Qt=mt.Dashed,en=[2,2]);const Zs={lines:[{color:Ee.styles.roc.color,size:Ee.styles.roc.thickness,style:Qt,dashedValue:en}]};console.log("➕ Re-adding ROC group:",`ROC_${lt+1}`,"at index:",lt);const xs=(Un=n())==null?void 0:Un.createIndicator({name:"ROC",calcParams:[Ee.period],styles:Zs,figures:[{key:"roc",title:"ROC: ",type:"line"}]},!1);xs&&(Ee.paneId=xs,c.update(jo=>{const Lc=`${xs}_ROC`;return jo.saveInds[Lc]||(jo.saveInds[Lc]={name:"ROC",pane_id:xs,rocGroups:[]}),jo.saveInds[Lc].rocGroups||(jo.saveInds[Lc].rocGroups=[]),jo.saveInds[Lc].rocGroups[lt]={...Ee},jo}))}),console.log("✅ Successfully updated ROC indicators on chart")}catch(q){console.error("❌ Error updating ROC indicators:",q)}console.log("✅ ROC group removed. Remaining groups:",i($a).length)}function wh(k){var he,Ee;const N=i($a)[k];if(!N||!n()){console.warn("❌ updateRocIndicator: Missing group or chart",{group:N,chart:!!n()});return}console.log("🔄 updateRocIndicator called:",{groupIndex:k,group:N});let R=mt.Solid,F=[2,2];N.styles.roc.lineStyle==="dashed"?(R=mt.Dashed,F=[4,4]):N.styles.roc.lineStyle==="dotted"&&(R=mt.Dashed,F=[2,2]);const q=((he=n())==null?void 0:he.getIndicators()).filter(lt=>lt.name==="ROC");if(console.log("📊 Found ROC indicators on chart:",q.length),console.log("📊 Looking for group index:",k),q.length>k){const lt=q[k];console.log("✅ Found matching ROC indicator by index, updating styles...");const Qt=(Ee=n())==null?void 0:Ee.overrideIndicator({name:"ROC",paneId:lt.paneId,calcParams:[N.period],styles:{lines:[{color:N.styles.roc.color,size:N.styles.roc.thickness,style:R,dashedValue:F,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Qt),console.log("🎨 Applied styles:",{color:N.styles.roc.color,size:N.styles.roc.thickness,style:R,dashedValue:F});const en=`${lt.paneId}_ROC`;console.log("💾 Using save key:",en),c.update(Zs=>{Zs.saveInds[en]||(Zs.saveInds[en]={name:"ROC",pane_id:lt.paneId,params:[N.period],rocGroups:[]}),Zs.saveInds[en].rocGroups||(Zs.saveInds[en].rocGroups=[]);const xs=Zs.saveInds[en].rocGroups||[];for(;xs.length<=k;)xs.push({});return xs[k]={...N},Zs.saveInds[en].rocGroups=xs,Zs.saveInds[en].params=[N.period],console.log("💾 Persisted ROC changes to save data:",en,N),Zs}),console.log("✅ ROC indicator updated successfully:",k,N)}else console.error("❌ ROC indicator not found on chart for group index:",k),console.log("📊 Available ROC indicators:",q.length),console.log("📊 Requested group index:",k)}function Uh(){if(!i(Xt))return;b(ti,H([]));const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="PSY").sort((N,R)=>N===`${o().editPaneId}_PSY`?-1:R===`${o().editPaneId}_PSY`?1:N.localeCompare(R));k.length>0?b(ti,H(k.map((N,R)=>{const F=r().saveInds[N];if(F.psyGroup)return{...F.psyGroup,id:F.psyGroup.id||Br(),actualPaneId:F.pane_id};if(F.psyGroups){const z=F.psyGroups[R]||F.psyGroups[0];return{...z,id:z.id||Br(),actualPaneId:F.pane_id}}else{const[z=12,q=6]=F.params||[12,6],he=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"];return{id:Br(),psyPeriod:z,mapsyPeriod:q,showMapsy:!0,actualPaneId:F.pane_id,styles:{psy:{color:he[R%he.length],thickness:1,lineStyle:"solid"},mapsy:{color:he[(R+1)%he.length],thickness:1,lineStyle:"solid"}}}}}))):i(ti).push({id:Br(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,styles:{psy:{color:"#2563eb",thickness:1,lineStyle:"solid"},mapsy:{color:"#dc2626",thickness:1,lineStyle:"solid"}}}),b(ti,H(i(ti).map(N=>({...N,id:N.id||Br()}))))}function Nm(){var z;if(!i(Xt))return;const k=["#2563eb","#dc2626","#16a34a","#ca8a04","#9333ea","#c2410c"],N=i(ti).length%k.length,R={id:Br(),psyPeriod:12,mapsyPeriod:6,showMapsy:!0,actualPaneId:void 0,styles:{psy:{color:k[N],thickness:1,lineStyle:"solid"},mapsy:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid"}}};if(i(ti).push(R),i(ti).length>1){let q=2;for(;Object.keys(r().saveInds).some(jo=>jo===`psy_${String(q).padStart(3,"0")}_PSY`);)q+=1;const he=i(ti).length-1,Ee=[R.psyPeriod,R.mapsyPeriod],lt=[{key:"psy",title:"PSY: ",type:"line"}];R.showMapsy&&lt.push({key:"mapsy",title:"MAPSY: ",type:"line"});const Qt={lines:[]};let en=mt.Solid,Zs=[2,2];if(R.styles.psy.lineStyle==="dashed"?(en=mt.Dashed,Zs=[4,4]):R.styles.psy.lineStyle==="dotted"&&(en=mt.Dashed,Zs=[2,2]),Qt.lines.push({color:R.styles.psy.color,size:R.styles.psy.thickness,style:en,dashedValue:Zs,smooth:!1}),R.showMapsy){let jo=mt.Solid,Lc=[2,2];R.styles.mapsy.lineStyle==="dashed"?(jo=mt.Dashed,Lc=[4,4]):R.styles.mapsy.lineStyle==="dotted"&&(jo=mt.Dashed,Lc=[2,2]),Qt.lines.push({color:R.styles.mapsy.color,size:R.styles.mapsy.thickness,style:jo,dashedValue:Lc,smooth:!1})}const xs=`psy_${String(q).padStart(3,"0")}`;console.log(`🆕 Immediately creating PSY ${q} with pane ID:`,xs),((z=n())==null?void 0:z.createIndicator({name:"PSY",calcParams:Ee,styles:Qt,figures:lt},!1,{id:xs,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${q} created with pane ID:`,xs),R.actualPaneId=xs,c.update(jo=>{const Lc=`psy_${String(q).padStart(3,"0")}_PSY`;return jo.saveInds[Lc]={name:"PSY",psyGroup:R,pane_id:xs,groupIndex:he,params:[R.psyPeriod,R.mapsyPeriod]},jo}))}else console.log("📝 New PSY group will be added to edit pane on confirm")}function Ym(k){var R,F,z;if(!i(Xt)||i(ti).length<=1)return;const N=i(ti).findIndex(q=>q.id===k);if(N!==-1){console.log("🗑️ Removing PSY group at index:",N,"ID:",k);try{if(N===0&&i(ti).length>1){console.log("🔄 Special handling: First PSY removed, promoting second PSY to first position"),b(ti,H(i(ti).filter(he=>he.id!==k))),console.log("✅ PSY group removed from array. Remaining groups:",i(ti).length);const q=i(ti)[0];q.actualPaneId&&(console.log("🗑️ Removing old second PSY from sub-pane:",q.actualPaneId),(R=n())==null||R.removeIndicator({paneId:q.actualPaneId,name:"PSY"})),q.actualPaneId=void 0,console.log("📊 Updating PSY in edit pane with new first group settings"),Rp(0)}else{const q=`pane_PSY_${N+1}_PSY`;if(r().saveInds[q]){const he=r().saveInds[q];console.log("🗑️ Removing PSY from pane:",he.pane_id),(F=n())==null||F.removeIndicator({paneId:he.pane_id,name:"PSY"}),console.log("✅ Successfully removed PSY from pane:",he.pane_id)}else{const he=i(ti)[N];he.actualPaneId&&(console.log("🗑️ Removing PSY from actual pane:",he.actualPaneId),(z=n())==null||z.removeIndicator({paneId:he.actualPaneId,name:"PSY"}),console.log("✅ Successfully removed PSY from actual pane:",he.actualPaneId))}b(ti,H(i(ti).filter(he=>he.id!==k))),console.log("✅ PSY group removed from array. Remaining groups:",i(ti).length)}c.update(q=>(Object.keys(q.saveInds).forEach(he=>{q.saveInds[he].name==="PSY"&&(console.log("🧹 Cleaning saved state for key:",he),delete q.saveInds[he])}),i(ti).forEach((he,Ee)=>{const lt=Ee===0?`${o().editPaneId}_PSY`:`pane_PSY_${Ee+1}_PSY`,Qt=Ee===0?o().editPaneId:he.actualPaneId||`pane_PSY_${Ee+1}`;q.saveInds[lt]={name:"PSY",psyGroup:he,pane_id:Qt,groupIndex:Ee,psyGroups:Ee===0?[...i(ti)]:void 0,params:[he.psyPeriod,he.mapsyPeriod]},console.log("💾 Re-saved PSY group",Ee,"with key:",lt,"and pane ID:",Qt)}),q))}catch(q){console.error("❌ Error removing PSY group:",q)}}}function Rp(k){var lt;const N=i(ti)[k];if(!N||!n())return;const R=k===0?o().editPaneId:N.actualPaneId||`psy_${String(k+1).padStart(3,"0")}`,F=[{key:"psy",title:"PSY: ",type:"line"}];N.showMapsy&&F.push({key:"mapsy",title:"MAPSY: ",type:"line"});const z={lines:[]};let q=mt.Solid,he=[2,2];if(N.styles.psy.lineStyle==="dashed"?(q=mt.Dashed,he=[4,4]):N.styles.psy.lineStyle==="dotted"&&(q=mt.Dashed,he=[2,2]),z.lines.push({color:N.styles.psy.color,size:N.styles.psy.thickness,style:q,dashedValue:he,smooth:!1}),N.showMapsy){let Qt=mt.Solid,en=[2,2];N.styles.mapsy.lineStyle==="dashed"?(Qt=mt.Dashed,en=[4,4]):N.styles.mapsy.lineStyle==="dotted"&&(Qt=mt.Dashed,en=[2,2]),z.lines.push({color:N.styles.mapsy.color,size:N.styles.mapsy.thickness,style:Qt,dashedValue:en,smooth:!1})}(lt=n())==null||lt.overrideIndicator({name:"PSY",paneId:R,styles:z,calcParams:[N.psyPeriod,N.mapsyPeriod],figures:F});const Ee=k===0?`${o().editPaneId}_PSY`:`psy_${String(k+1).padStart(3,"0")}_PSY`;c.update(Qt=>(Qt.saveInds[Ee]&&(Qt.saveInds[Ee].params=[N.psyPeriod,N.mapsyPeriod],Qt.saveInds[Ee].psyGroup={...N},console.log("💾 Persisted PSY changes to save data:",Ee,N)),Qt)),console.log("🔄 Updated PSY indicator:",k,N)}function Eh(){if(!i(W))return;b(fi,H([]));const k=Object.entries(r().saveInds).filter(([N,R])=>R.name==="OBV");k.length>0?(k.sort(([N,R],[F,z])=>{const q=R.groupIndex||0,he=z.groupIndex||0;return q-he}),k.forEach(([N,R])=>{var z,q;const F=R;if(F.obvGroup){const he=F.obvGroup;F.pane_id&&(he.actualPaneId=F.pane_id),i(fi).push(he)}else if(F.obvGroups&&F.obvGroups.length>0)b(fi,H([...F.obvGroups])),i(fi).forEach((he,Ee)=>{he.actualPaneId||(Ee===0?he.actualPaneId=o().editPaneId:F.pane_id&&(he.actualPaneId=F.pane_id))});else{const he={id:Br(),obvPeriod:((z=F.params)==null?void 0:z[0])||30,maobvPeriod:((q=F.params)==null?void 0:q[1])||10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}};F.pane_id&&(he.actualPaneId=F.pane_id),i(fi).push(he)}})):i(fi).push({id:Br(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:o().editPaneId,styles:{obv:{color:"#FF6B35",thickness:2,lineStyle:"solid"},maobv:{color:"#2196F3",thickness:1,lineStyle:"solid"}}})}function Am(){if(!i(W))return;const k=["#FF6B35","#2196F3","#16a34a","#ca8a04","#9333ea","#c2410c"],N=i(fi).length%k.length,R={id:Br(),obvPeriod:30,maobvPeriod:10,showMaobv:!0,actualPaneId:void 0,styles:{obv:{color:k[N],thickness:2,lineStyle:"solid"},maobv:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid"}}},F=new Set;i(fi).forEach(he=>{he.actualPaneId&&F.add(he.actualPaneId)}),Object.keys(r().saveInds).forEach(he=>{r().saveInds[he]&&r().saveInds[he].name==="OBV"&&r().saveInds[he].pane_id&&F.add(r().saveInds[he].pane_id)}),console.log("🔍 Existing OBV pane IDs:",Array.from(F));let z=2;for(;F.has(`pane_OBV_${z}`);)z+=1;const q=`pane_OBV_${z}`;R.actualPaneId=q,console.log("✅ Adding new OBV group with pane ID:",q),i(fi).push(R),nh()}function im(k){var F;if(!i(W)||i(fi).length<=1)return;b(Rc,!0),console.log("🚫 Set obvRemovalInProgress = true");const N=i(fi).findIndex(z=>z.id===k);if(N===-1){b(Rc,!1);return}const R=i(fi)[N];console.log("🗑️ Removing OBV group at index:",N,"ID:",k),console.log("🗑️ Group to remove:",R);try{let z;z=R.actualPaneId,z||Object.keys(r().saveInds).forEach(q=>{const he=r().saveInds[q];he&&he.name==="OBV"&&he.groupIndex===N&&(z=he.pane_id)}),!z&&N===0&&(z=o().editPaneId),console.log("🗑️ Removing OBV at index",N,"from pane:",z),z&&(console.log("🗑️ Removing OBV indicator from pane:",z),(F=n())==null||F.removeIndicator({paneId:z,name:"OBV"}),console.log("✅ Successfully removed OBV from pane:",z)),b(fi,H(i(fi).filter(q=>q.id!==k))),console.log("✅ OBV group removed from array. Remaining groups:",i(fi).length),c.update(q=>{const he=[];return Object.keys(q.saveInds).forEach(Ee=>{q.saveInds[Ee]&&q.saveInds[Ee].name==="OBV"&&he.push(Ee)}),console.log("🧹 Clearing all OBV save data:",he),he.forEach(Ee=>delete q.saveInds[Ee]),i(fi).forEach((Ee,lt)=>{const Qt=Ee.actualPaneId||o().editPaneId;if(!Qt){console.error(`❌ No pane ID for OBV group ${lt} during removal cleanup`);return}const en=`${Qt}_OBV`;q.saveInds[en]={name:"OBV",obvGroup:Ee,pane_id:Qt,groupIndex:lt,obvGroups:lt===0?[...i(fi)]:void 0,params:[Ee.obvPeriod,Ee.maobvPeriod]},console.log("💾 Re-saved OBV group",lt,"with key:",en,"pane:",Qt)}),q}),console.log("✅ OBV removal and reindexing completed"),setTimeout(()=>{b(Rc,!1),console.log("✅ Reset obvRemovalInProgress = false")},200)}catch(z){console.error("❌ Error removing OBV group:",z)}}function nh(){if(!(!i(W)||!n()))try{console.log("🔄 Applying OBV changes to chart..."),console.log("🔧 Current OBV groups:",i(fi).length);const k=Object.keys(r().saveInds).filter(R=>r().saveInds[R]&&r().saveInds[R].name==="OBV");console.log("🔧 Existing OBV keys in save data:",k);const N=new Set;i(fi).forEach((R,F)=>{const z=R.actualPaneId||o().editPaneId;N.add(z)}),console.log("🔧 Pane IDs that should exist:",Array.from(N)),k.forEach(R=>{var z;const F=r().saveInds[R];if(F&&F.pane_id&&!N.has(F.pane_id))try{console.log("🗑️ Removing stale OBV indicator from pane:",F.pane_id),(z=n())==null||z.removeIndicator({paneId:F.pane_id,name:"OBV"})}catch(q){console.log("❌ Error removing stale OBV indicator:",q)}}),i(fi).forEach((R,F)=>{var he,Ee,lt;const z=[R.obvPeriod,R.maobvPeriod],q={lines:[{color:R.styles.obv.color,size:R.styles.obv.thickness,style:R.styles.obv.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:R.styles.obv.lineStyle==="dashed"?[4,4]:R.styles.obv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1},{color:R.styles.maobv.color,size:R.styles.maobv.thickness,style:R.styles.maobv.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:R.styles.maobv.lineStyle==="dashed"?[4,4]:R.styles.maobv.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(F===0){const Qt=R.actualPaneId||o().editPaneId;R.actualPaneId||(R.actualPaneId=o().editPaneId),console.log("🔄 Updating first OBV in pane:",Qt),(he=n())==null||he.overrideIndicator({name:"OBV",calcParams:z,styles:q,paneId:Qt})}else{const Qt=R.actualPaneId||`pane_OBV_${F+1}`;if(k.find(Zs=>{const xs=r().saveInds[Zs];return xs&&xs.pane_id===Qt}))console.log("🔄 Updating existing OBV in pane:",Qt),(Ee=n())==null||Ee.overrideIndicator({name:"OBV",calcParams:z,styles:q,paneId:Qt}),R.actualPaneId=Qt;else{const Zs=R.actualPaneId||`pane_OBV_${F+1}`;console.log("🆕 Creating new OBV in pane:",Zs);const xs=(lt=n())==null?void 0:lt.createIndicator({name:"OBV",calcParams:z,styles:q},!0,{id:Zs,axis:{gap:{bottom:2}}});xs&&(R.actualPaneId=Zs,console.log("✅ Created new OBV indicator with ID:",xs,"in pane:",Zs))}}}),c.update(R=>{try{Object.keys(R.saveInds).forEach(F=>{R.saveInds[F]&&R.saveInds[F].name==="OBV"&&delete R.saveInds[F]}),i(fi).forEach((F,z)=>{try{const q=F.actualPaneId||o().editPaneId;if(!q){console.error(`❌ No pane ID for OBV group ${z}`);return}const he=`${q}_OBV`,Ee={name:"OBV",obvGroup:F,pane_id:q,groupIndex:z,obvGroups:z===0?[...i(fi)]:void 0,params:[F.obvPeriod,F.maobvPeriod]};R.saveInds[he]=Ee,console.log("💾 Saved OBV group",z,"with key:",he,"and pane ID:",q)}catch(q){console.error(`❌ Error saving OBV group ${z}:`,q)}})}catch(F){console.error("❌ Error in OBV save operation:",F)}return R}),console.log("✅ OBV changes applied successfully")}catch(k){console.error("❌ Critical error in applyObv:",k)}}function fv(){if(!i(U))return;console.log("🔄 Initializing KDJ groups for edit pane:",o().editPaneId);const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="KDJ").sort((N,R)=>N===`${o().editPaneId}_KDJ`?-1:R===`${o().editPaneId}_KDJ`?1:N.localeCompare(R));console.log("🔍 Found KDJ keys:",k),k.length>0?(b(hn,H([])),k.forEach((N,R)=>{const F=r().saveInds[N];if(console.log(`🔄 Loading KDJ group ${R+1} from key:`,N,F),F){if(F.kdjGroup){const z={...F.kdjGroup};R>0&&F.pane_id&&(z.actualPaneId=F.pane_id),i(hn).push(z)}else if(F.params&&F.params.length>=2){const z={id:Br(),kPeriod:F.params[0]||9,dPeriod:F.params[1]||3,actualPaneId:void 0,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}};R>0&&F.pane_id&&(z.actualPaneId=F.pane_id),i(hn).push(z)}}}),console.log("✅ Loaded",i(hn).length,"existing KDJ groups")):i(hn).length===0&&(b(hn,H([{id:Br(),kPeriod:9,dPeriod:3,styles:{k:{color:"#FF6B35",thickness:1,lineStyle:"solid"},d:{color:"#2196F3",thickness:1,lineStyle:"solid"},j:{color:"#9C27B0",thickness:1,lineStyle:"solid"}}}])),console.log("🆕 Created default KDJ group"))}function Gh(){var F;if(!i(U))return;const k=["#FF6B35","#2196F3","#9C27B0","#16a34a","#ca8a04","#dc2626"],N=i(hn).length%k.length,R={id:Br(),kPeriod:9,dPeriod:3,actualPaneId:void 0,styles:{k:{color:k[N],thickness:1,lineStyle:"solid"},d:{color:k[(N+1)%k.length],thickness:1,lineStyle:"solid"},j:{color:k[(N+2)%k.length],thickness:1,lineStyle:"solid"}}};if(i(hn).push(R),i(hn).length>1){const z=Object.values(r().saveInds).filter(Zs=>Zs.name==="KDJ"&&Zs.pane_id).map(Zs=>Zs.pane_id);let q=2;for(;z.includes(`pane_KDJ_${q}`);)q+=1;const he=i(hn).length-1,Ee=[R.kPeriod,R.dPeriod,3],lt={lines:[{color:R.styles.k.color,size:R.styles.k.thickness,style:R.styles.k.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:R.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:R.styles.d.color,size:R.styles.d.thickness,style:R.styles.d.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:R.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:R.styles.j.color,size:R.styles.j.thickness,style:R.styles.j.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:R.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]},Qt=`pane_KDJ_${q}`;console.log(`🆕 Immediately creating KDJ ${q} with pane ID:`,Qt),((F=n())==null?void 0:F.createIndicator({name:"KDJ",calcParams:Ee,styles:lt},!1,{id:Qt,axis:{gap:{bottom:2}}}))&&(console.log(`✅ KDJ ${q} created with pane ID:`,Qt),R.actualPaneId=Qt,c.update(Zs=>{const xs=`pane_KDJ_${q}_KDJ`;return Zs.saveInds[xs]={name:"KDJ",kdjGroup:R,pane_id:Qt,groupIndex:he,params:[R.kPeriod,R.dPeriod,3]},Zs}))}}function Cp(k){var q;const N=i(hn)[k];if(!N||!n())return;const R=k===0?o().editPaneId:N.actualPaneId||`pane_KDJ_${k+1}`,F={lines:[{color:N.styles.k.color,size:N.styles.k.thickness,style:N.styles.k.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:N.styles.k.lineStyle==="dashed"?[4,4]:[2,2]},{color:N.styles.d.color,size:N.styles.d.thickness,style:N.styles.d.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:N.styles.d.lineStyle==="dashed"?[4,4]:[2,2]},{color:N.styles.j.color,size:N.styles.j.thickness,style:N.styles.j.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:N.styles.j.lineStyle==="dashed"?[4,4]:[2,2]}]};(q=n())==null||q.overrideIndicator({name:"KDJ",paneId:R,styles:F,calcParams:[N.kPeriod,N.dPeriod,3]});const z=k===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${k+1}_KDJ`;c.update(he=>(he.saveInds[z]&&(he.saveInds[z].params=[N.kPeriod,N.dPeriod,3],he.saveInds[z].kdjGroup={...N},console.log("💾 Persisted KDJ changes to save data:",z,N)),he)),console.log("🔄 Updated KDJ indicator:",k,N)}let vf=_e(H([]));function ym(){if(!i(ac)||i(vf).length>0)return;const k=`${o().editPaneId}_ICHIMOKU`,N=r().saveInds[k];if(N&&Array.isArray(N.ichimokuGroups)&&N.ichimokuGroups.length>0)b(vf,H(N.ichimokuGroups.map((R,F)=>{var z;return{id:R.id||Br(),name:R.name||`Ichimoku #${F+1}`,params:R.params||[9,26,52],styles:((z=R.styles)==null?void 0:z.map(q=>({color:q.color||"#2563eb",thickness:q.thickness??1,lineStyle:q.lineStyle||"solid"})))||[{color:"#ef4444",thickness:1,lineStyle:"solid"},{color:"#3b82f6",thickness:1,lineStyle:"solid"},{color:"#10b981",thickness:1,lineStyle:"solid"}]}})));else{const R=[u[0]||9,u[1]||26,u[2]||52],F=[0,1,2].map(z=>{var q,he,Ee;return{color:((q=h[z])==null?void 0:q.color)||["#ef4444","#3b82f6","#10b981"][z]||"#2563eb",thickness:((he=h[z])==null?void 0:he.thickness)??1,lineStyle:((Ee=h[z])==null?void 0:Ee.lineStyle)||"solid"}});b(vf,H([{id:Br(),name:"Ichimoku #1",params:R,styles:F}]))}}function Tm(){var z;if(!i(ac))return;const k=i(vf).length+1,N=[["#ef4444","#3b82f6","#10b981"],["#f59e0b","#8b5cf6","#06b6d4"],["#22c55e","#e11d48","#0ea5e9"]],R=N[(k-1)%N.length],F={id:Br(),name:`Ichimoku #${k}`,params:[9,26,52],styles:[{color:R[0],thickness:1,lineStyle:"solid"},{color:R[1],thickness:1,lineStyle:"solid"},{color:R[2],thickness:1,lineStyle:"solid"}]};b(vf,H([...i(vf),F]));try{const q={lines:F.styles.map(Ee=>({color:Ee.color,size:Ee.thickness,style:Ee.lineStyle==="dashed"||Ee.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:Ee.lineStyle==="dashed"?[4,4]:Ee.lineStyle==="dotted"?[2,2]:[2,2]}))};(z=n())==null||z.createIndicator({name:"ICHIMOKU",calcParams:F.params,styles:q},!0,{id:o().editPaneId});const he=`${o().editPaneId}_ICHIMOKU`;c.update(Ee=>{var lt;return Ee.saveInds[he]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((lt=i(vf)[0])==null?void 0:lt.params)||[9,26,52],ichimokuGroups:i(vf).map(Qt=>({...Qt}))},Ee})}catch(q){console.error("❌ Error adding Ichimoku group:",q)}}function M(k){var N,R,F;if(!(!i(ac)||!n()))try{const q=(((R=(N=n())==null?void 0:N.getIndicators)==null?void 0:R.call(N))||[]).filter(Ee=>Ee.name==="ICHIMOKU"&&Ee.paneId===o().editPaneId);for(const Ee of q)(F=n())==null||F.removeIndicator({paneId:Ee.paneId,name:"ICHIMOKU"});i(vf).forEach(Ee=>{var Qt;const lt={lines:Ee.styles.map(en=>({color:en.color,size:en.thickness,style:en.lineStyle==="dashed"||en.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:en.lineStyle==="dashed"?[4,4]:en.lineStyle==="dotted"?[2,2]:[2,2]}))};(Qt=n())==null||Qt.createIndicator({name:"ICHIMOKU",calcParams:Ee.params,styles:lt},!0,{id:o().editPaneId})});const he=`${o().editPaneId}_ICHIMOKU`;c.update(Ee=>{var lt;return Ee.saveInds[he]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((lt=i(vf)[0])==null?void 0:lt.params)||[9,26,52],ichimokuGroups:i(vf).map(Qt=>({...Qt}))},Ee}),console.log("🔄 Updated Ichimoku groups")}catch(z){console.error("❌ Error updating Ichimoku groups:",z)}}function V(k){if(i(ac)&&!(i(vf).length<=1)&&!(k<0||k>=i(vf).length))try{b(vf,H(i(vf).filter((N,R)=>R!==k))),M(0),console.log("🗑️ Removed Ichimoku group at index:",k)}catch(N){console.error("❌ Error removing Ichimoku group:",N)}}function fe(){var k,N,R;if(!(!i(ac)||!n()))try{const z=(((N=(k=n())==null?void 0:k.getIndicators)==null?void 0:N.call(k))||[]).filter(he=>he.name==="ICHIMOKU"&&he.paneId===o().editPaneId);for(const he of z)(R=n())==null||R.removeIndicator({paneId:he.paneId,name:"ICHIMOKU"});i(vf).forEach(he=>{var lt;const Ee={lines:he.styles.map(Qt=>({color:Qt.color,size:Qt.thickness,style:Qt.lineStyle==="dashed"||Qt.lineStyle==="dotted"?mt.Dashed:mt.Solid,dashedValue:Qt.lineStyle==="dashed"?[4,4]:Qt.lineStyle==="dotted"?[2,2]:[2,2]}))};(lt=n())==null||lt.createIndicator({name:"ICHIMOKU",calcParams:he.params,styles:Ee},!0,{id:o().editPaneId})});const q=`${o().editPaneId}_ICHIMOKU`;c.update(he=>{var Ee;return he.saveInds[q]={name:"ICHIMOKU",pane_id:o().editPaneId,params:((Ee=i(vf)[0])==null?void 0:Ee.params)||[9,26,52],ichimokuGroups:i(vf).map(lt=>({...lt}))},he}),l.update(he=>(he.editIndName="",he.editPaneId="",he.modalIndCfg=!1,he)),a(!1),console.log("✅ Ichimoku confirm applied")}catch(F){console.error("❌ Error confirming Ichimoku groups:",F)}}function me(k){var R,F;if(!i(U)||i(hn).length<=1)return;const N=i(hn).findIndex(z=>z.id===k);if(N!==-1){console.log("🗑️ Removing KDJ group at index:",N,"ID:",k);try{if(N===0&&i(hn).length>1){console.log("🔄 Special handling: First KDJ removed, promoting second KDJ to first position"),b(hn,H(i(hn).filter(q=>q.id!==k))),console.log("✅ KDJ group removed from array. Remaining groups:",i(hn).length);const z=i(hn)[0];z.actualPaneId&&(console.log("🗑️ Removing old second KDJ from sub-pane:",z.actualPaneId),(R=n())==null||R.removeIndicator({paneId:z.actualPaneId,name:"KDJ"})),z.actualPaneId=void 0,console.log("📊 Updating KDJ in edit pane with new first group settings"),Cp(0)}else{const z=i(hn)[N];z.actualPaneId&&(console.log("🗑️ Removing KDJ from actual pane:",z.actualPaneId),(F=n())==null||F.removeIndicator({paneId:z.actualPaneId,name:"KDJ"}),console.log("✅ Successfully removed KDJ from actual pane:",z.actualPaneId)),b(hn,H(i(hn).filter(q=>q.id!==k))),console.log("✅ KDJ group removed from array. Remaining groups:",i(hn).length)}c.update(z=>(Object.keys(z.saveInds).forEach(q=>{z.saveInds[q].name==="KDJ"&&(console.log("🧹 Cleaning saved state for key:",q),delete z.saveInds[q])}),i(hn).forEach((q,he)=>{const Ee=he===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${he+1}_KDJ`,lt=he===0?o().editPaneId:q.actualPaneId||`pane_KDJ_${he+1}`;console.log(`💾 Re-saving KDJ group ${he+1} with key:`,Ee,"pane ID:",lt),z.saveInds[Ee]={name:"KDJ",kdjGroup:q,pane_id:lt,groupIndex:he,kdjGroups:he===0?[...i(hn)]:void 0,params:[q.kPeriod,q.dPeriod,3]}}),z)),console.log("🔄 KDJ groups reindexed successfully")}catch(z){console.log("❌ Error removing KDJ indicator:",z)}}}function ae(){var N,R;if(!i($u))return;console.log("🔄 Initializing AO groups for edit pane:",o().editPaneId);const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="AO").sort((F,z)=>F===`${o().editPaneId}_AO`?-1:z===`${o().editPaneId}_AO`?1:F.localeCompare(z));if(console.log("🔍 Found AO keys:",k),k.length>0)b(Iu,H([])),k.forEach((F,z)=>{var he;const q=r().saveInds[F];if(console.log(`🔄 Loading AO group ${z+1} from key:`,F,q),q)if(q.aoGroup){const Ee={...q.aoGroup},lt=Ee.styles||{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"}};(he=lt.reverse)!=null&&he.color?Ee.styles=lt:Ee.styles={...lt,reverse:{color:"#c4c4c4"}},i(Iu).push(Ee)}else q.params&&q.params.length===2&&i(Iu).push({id:Br(),shortPeriod:q.params[0]||5,longPeriod:q.params[1]||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}})}),console.log("✅ Loaded AO groups:",i(Iu).length);else{const F=Object.entries(r().saveInds).find(([z,q])=>q.name==="AO"&&z.includes(o().editPaneId||""));if(F){const[,z]=F;console.log("🔄 Found existing AO indicator, creating group from it"),b(Iu,H([{id:Br(),shortPeriod:((N=z.params)==null?void 0:N[0])||5,longPeriod:((R=z.params)==null?void 0:R[1])||34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}}]))}else console.log("🔄 Creating default AO group"),b(Iu,H([{id:Br(),shortPeriod:5,longPeriod:34,styles:{increasing:{color:"#26A69A"},decreasing:{color:"#EF5350"},reverse:{color:"#c4c4c4"}}}]))}}function We(){if(!i(ad))return;const k=o().editPaneId||"candle_pane",N=Object.entries(r().saveInds).filter(([F,z])=>z&&z.name==="BOLL"&&z.pane_id===k);if(N.length>0){const F=N.sort(([z],[q])=>{var lt,Qt;const he=(lt=z.match(/_BOLL_(\d+)$/))!=null&&lt[1]?parseInt(z.match(/_BOLL_(\d+)$/)[1],10):1,Ee=(Qt=q.match(/_BOLL_(\d+)$/))!=null&&Qt[1]?parseInt(q.match(/_BOLL_(\d+)$/)[1],10):1;return he-Ee});b(Hl,H(F.map(([z,q])=>{var he,Ee,lt,Qt,en,Zs,xs;return{id:Br(),paneId:k,period:q.params&&q.params[0]||20,stdDev:q.params&&q.params[1]||2,styles:{fillColor:((he=q.bollingerStyles)==null?void 0:he.fillColor)||"#2196F3",fillOpacity:((Ee=q.bollingerStyles)==null?void 0:Ee.fillOpacity)??5,upperColor:((lt=q.bollingerStyles)==null?void 0:lt.upperColor)||"#f23645",middleColor:((Qt=q.bollingerStyles)==null?void 0:Qt.middleColor)||"#2962ff",lowerColor:((en=q.bollingerStyles)==null?void 0:en.lowerColor)||"#089981",thickness:((Zs=q.bollingerStyles)==null?void 0:Zs.thickness)||1,lineStyle:((xs=q.bollingerStyles)==null?void 0:xs.lineStyle)||"solid"}}})))}else b(Hl,H([{id:Br(),paneId:k,period:i(j)||20,stdDev:i(E)||2,styles:{fillColor:i(x)||"#2196F3",fillOpacity:i(S)??5,upperColor:i(C)||"#f23645",middleColor:i(I)||"#2962ff",lowerColor:i(A)||"#089981",thickness:i(P)||1,lineStyle:i(T)||"solid"}}]));const R=i(Hl)[0];R&&(b(j,H(R.period)),b(E,H(R.stdDev)),b(x,H(R.styles.fillColor)),b(S,H(R.styles.fillOpacity)),b(C,H(R.styles.upperColor)),b(I,H(R.styles.middleColor)),b(A,H(R.styles.lowerColor)),b(P,H(R.styles.thickness)),b(T,H(R.styles.lineStyle))),Gn()}function He(){var R;if(!i($u)||!n())return;console.log("🔄 Applying AO changes in real-time, groups:",i(Iu).length);const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="AO").sort((F,z)=>F===`${o().editPaneId}_AO`?-1:z===`${o().editPaneId}_AO`?1:F.localeCompare(z));console.log("🔍 Existing AO keys:",k);const N=i(Iu).length;if(k.length>N){console.log(`🗑️ Removing ${k.length-N} excess AO indicators`);for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];if(q&&q.pane_id){console.log("🗑️ Removing AO indicator from pane:",q.pane_id);try{(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"AO"})}catch(he){console.log("Error removing excess AO indicator:",he)}}}}i(Iu).forEach((F,z)=>{var Ee,lt,Qt,en,Zs;const q=[F.shortPeriod,F.longPeriod],he={bars:[{upColor:F.styles.increasing.color,downColor:F.styles.decreasing.color,noChangeColor:((Ee=F.styles.reverse)==null?void 0:Ee.color)||"#c4c4c4",reverseColor:((lt=F.styles.reverse)==null?void 0:lt.color)||"#c4c4c4"}]};if(z===0)console.log("🔄 Updating first AO indicator in pane:",o().editPaneId),(Qt=n())==null||Qt.overrideIndicator({name:"AO",calcParams:q,styles:he,paneId:o().editPaneId});else{const xs=`pane_AO_${z+1}_AO`,Un=k.find(jo=>jo===xs);if(Un){const jo=r().saveInds[Un];jo&&jo.pane_id&&(console.log(`🔄 Updating existing AO ${z+1} in pane:`,jo.pane_id),(en=n())==null||en.overrideIndicator({name:"AO",calcParams:q,styles:he,paneId:jo.pane_id}))}else{const jo=`pane_AO_${z+1}`;console.log(`🆕 Creating new AO ${z+1} with pane ID:`,jo),(Zs=n())==null||Zs.createIndicator({name:"AO",calcParams:q,styles:he},!0,{id:jo})}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="AO"&&delete F.saveInds[z]}),i(Iu).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_AO`:`pane_AO_${q+1}_AO`,Ee=q===0?o().editPaneId:`pane_AO_${q+1}`;console.log(`💾 Saving AO group ${q+1} with key:`,he),F.saveInds[he]={name:"AO",aoGroup:z,pane_id:Ee,groupIndex:q,aoGroups:q===0?[...i(Iu)]:void 0,params:[z.shortPeriod,z.longPeriod]}}),F))}function At(k){!i($u)||i(Iu).length<=1||!i(Iu).find(R=>R.id===k)||(i(Iu).findIndex(R=>R.id===k),b(Iu,H(i(Iu).filter(R=>R.id!==k))),He())}function Wt(){const k=`${o().editPaneId}_CR`,N=r().saveInds[k];N&&(b(wn,H(N.crPeriod||26)),b(xo,H(N.crMa1Period||10)),b(hi,H(N.crMa2Period||20)),b(Ln,H(N.crMa3Period||40)),b(pl,H(N.crMa4Period||60)),b(La,H(N.crColor||"#FF6B35")),b(lc,H(N.crMa1Color||"#2196F3")),b(wl,H(N.crMa2Color||"#4CAF50")),b(mf,H(N.crMa3Color||"#FF9800")),b(mp,H(N.crMa4Color||"#9C27B0")),b(_c,H(N.crThickness||2)),b(Ea,H(N.crMa1Thickness||1)),b(Tf,H(N.crMa2Thickness||1)),b(Sr,H(N.crMa3Thickness||1)),b(Oa,H(N.crMa4Thickness||1)),b(lr,H(N.crLineStyle||"solid")),b(mr,H(N.crMa1LineStyle||"solid")),b(Cr,H(N.crMa2LineStyle||"solid")),b(hl,H(N.crMa3LineStyle||"solid")),b(ls,H(N.crMa4LineStyle||"solid")))}function Jt(k,N){return R=>{b(X,H(k)),b(ne,H(N)),b(D,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(L,!0)}}function $s(k){return N=>{b(te,H(k)),b(ie,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(de,!0)}}function Kt(k,N){return R=>{b(re,H(k)),b(xe,H(N)),b(pe,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(le,!0)}}function Us(k){return N=>{b(Rt,H(k)),b(pt,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(kt,!0)}}function es(k,N){return R=>{b(jl,H(k)),b(qi,H(N)),b(Dc,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(yl,!0)}}function rn(k,N){return R=>{b(Ke,k*3+N),b(Oe,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(De,!0)}}function pn(k,N){return R=>{if(b(Je,H(k)),b(it,H(N)),b(nt,H({x:R.clientX,y:R.clientY})),b(ut,!0),i(zt).length>k&&(N==="histogram"||N==="histogram-down")){const F=i(zt)[k];N==="histogram"?F.styles.histogram.upColor=v(F.styles.histogram.upColor||"#26a69a",70):F.styles.histogram.downColor=v(F.styles.histogram.downColor||"#ef5350",70),at(k)}}}function Nn(k){return N=>{if(b(wt,H(k)),N.currentTarget&&N.currentTarget instanceof Element){const R=N.currentTarget.getBoundingClientRect();b(Ge,H({x:R.left+R.width/2,y:R.bottom+5}))}else b(Ge,H({x:window.innerWidth/2,y:window.innerHeight/2}));b(ze,!0)}}function js(k){return N=>{if(b(wt,H(k)),N.currentTarget&&N.currentTarget instanceof Element){const R=N.currentTarget.getBoundingClientRect();b(jt,H({x:R.left+R.width/2,y:R.bottom+5}))}else b(jt,H({x:window.innerWidth/2,y:window.innerHeight/2}));b(xt,!0)}}function qt(k){return N=>{if(b(wt,H(k)),N.currentTarget&&N.currentTarget instanceof Element){const R=N.currentTarget.getBoundingClientRect();b(ke,H({x:R.left+R.width/2,y:R.bottom+5}))}else b(ke,H({x:window.innerWidth/2,y:window.innerHeight/2}));b(ft,!0)}}function Os(k){return N=>{if(b(wt,H(k)),N.currentTarget&&N.currentTarget instanceof Element){const R=N.currentTarget.getBoundingClientRect();b(Et,H({x:R.left+R.width/2,y:R.bottom+5}))}else b(Et,H({x:window.innerWidth/2,y:window.innerHeight/2}));b(Se,!0)}}function zs(k,N){return R=>{b(Gs,H(k)),b(an,H(N)),b(tn,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(Ls,!0)}}function mn(k){return N=>{b(Hs,H(k)),b(Ns,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(Es,!0)}}function un(k){return N=>{b(Mn,H(k)),b(fs,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(ns,!0)}}function jn(k){return N=>{b(Cn,H(k)),b(Tn,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(po,!0)}}function ro(k){return N=>{b(Rl,H(k)),b(Vo,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(Bo,!0)}}function ys(k){return N=>{b(Zr,H(k)),b(tl,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(aa,!0)}}function qs(k){return N=>{b(ec,H(k)),b(To,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(Qc,!0)}}function Js(k){return N=>{b(rd,H(k)),b(Ju,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(du,!0)}}function is(k){return N=>{b(eu,H(k)),b(_u,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(xd,!0)}}function ts(k){return N=>{b(rc,H(k)),b(vc,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(ca,!0)}}function Ss(k,N=0){return R=>{b(zl,H(N)),b(wd,H(k)),b(sa,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(Al,!0)}}function ln(k){return N=>{b(xa,H(k)),b(Tl,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(Fd,!0)}}function on(k){return N=>{b(ed,H(k)),b(Qu,H({x:window.innerWidth/2,y:window.innerHeight/2})),b(ku,!0)}}pp(l,k=>k.modalIndCfg).subscribe(()=>{if(!o().editIndName)return;if(i(ac)){ym();const R=cb.ICHIMOKU||[];d.splice(0,d.length,...R);return}if(i(Bt)){const F=`${o().editPaneId||"candle_pane"}_ZIGZAG`,z=Object.keys(r().saveInds).filter(he=>{var Ee;return he.startsWith(F)&&((Ee=r().saveInds[he])==null?void 0:Ee.name)==="ZIGZAG"}).sort((he,Ee)=>{const lt=Qt=>{const en=Qt.match(/_ZIGZAG(?:_(\d+))?$/);return en&&en[1]?parseInt(en[1],10):1};return lt(he)-lt(Ee)});b(Ks,H([])),z.length>0?z.forEach(he=>{var Zs,xs,Un,jo;const Ee=r().saveInds[he],lt=((xs=(Zs=Ee==null?void 0:Ee.styles)==null?void 0:Zs.lines)==null?void 0:xs[0])||{},Qt=Array.isArray(lt.dashedValue)?lt.dashedValue.join(","):"",en=lt.style===mt.Solid?"solid":Qt==="2,6"?"dotted":"dashed";i(Ks).push({id:Br(),deviation:Number(((Un=Ee==null?void 0:Ee.params)==null?void 0:Un[0])??5),depth:Number(((jo=Ee==null?void 0:Ee.params)==null?void 0:jo[1])??5),styles:{color:lt.color??"#2962FF",thickness:Number(lt.size??2),lineStyle:en}})}):b(Ks,H([{id:Br(),deviation:5,depth:5,styles:{color:"#2962FF",thickness:2,lineStyle:"solid"}}]));const q=i(Ks)[0];u.splice(0,u.length,q.deviation,q.depth),b(rs,H(q.styles.color)),b(yn,H(q.styles.thickness)),b(Qn,H(q.styles.lineStyle));return}if(i(Af)){Um();return}if(i(Ld)){Du();return}if(i(G)){Og();return}if(i(ye)){zg();return}if(i(yu)){fg();return}if(i(Yf)){vm();return}if(i(Ga)){Go();return}if(i(Re)){kl();return}if(i(fu)){Ya();return}if(i(ce)){vd();return}if(i(Ie)){zd();return}if(i(dt)){Oo();return}if(i(ge)){Nc();return}if(i(Q)){Vf();return}if(i(vt)){fr();return}if(i(Xt)){Uh();return}if(i(W)){Eh();return}if(i(U)){fv();return}if(i($u)){ae();return}if(i(Q)){Wt();return}if(i(ad)){We();return}const k=`${o().editPaneId}_${o().editIndName}`,N=r().saveInds[k];if(N&&N.fields&&!i(ad))d.splice(0,d.length,...N.fields),u.splice(0,u.length,...N.params||[]),h.splice(0,h.length,...N.styles||[]);else{const R=cb[o().editIndName]||[];if(i(ad)){d.splice(0,d.length,...R);const F=R.map(z=>z.default);u.splice(0,u.length,...F),N&&N.params&&N.params.length>=2&&(u[0]=N.params[0],u[1]=N.params[1])}else if(d.splice(0,d.length,...R),N&&N.params)u.splice(0,u.length,...N.params),h.splice(0,h.length,...N.styles||[]),(i(wp)||i(nf))&&d.length>u.length&&d.splice(u.length,d.length-u.length);else{const F=R.filter(z=>z.type!=="color").map(z=>z.default);u.splice(0,u.length,...F)}}if(i(Re)){for(;h.length<2;)h.length===0?h.push({color:"#2563eb",thickness:1,lineStyle:"solid"}):h.push({color:"#dc2626",thickness:1,lineStyle:"solid"});for(;h.length>2;)h.pop()}else{for(;h.length<u.length;)h.push({color:"#2563eb",thickness:1,lineStyle:"solid"});for(;h.length>u.length;)h.pop()}}),pp(l,k=>k.clearCciGroups).subscribe(k=>{k>0&&tr()}),pp(l,k=>k.clearEmvGroups).subscribe(k=>{k>0&&Mr()}),pp(l,k=>k.clearMtmGroups).subscribe(k=>{k>0&&ou()}),pp(l,k=>k.clearObvGroups).subscribe(k=>{k>0&&md()}),pp(l,k=>k.clearPsyGroups).subscribe(k=>{k>0&&Kf()}),pp(l,k=>k.clearPvtGroups).subscribe(k=>{k>0&&ld()}),pp(l,k=>k.clearRocGroups).subscribe(k=>{k>0&&Bf()}),pp(l,k=>k.clearVolGroups).subscribe(k=>{k>0&&iu()}),pp(l,k=>k.clearWrGroups).subscribe(k=>{k>0&&Ed()});function Dr(k){i(ad)||u.length<=1||(u.splice(k,1),d.splice(k,1),h.splice(k,1),i(wp)?Cs():i(nf)&&Nt())}function ni(){const k=n();if(!k)return;const N=[6],R=k.createIndicator({name:"BIAS",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Ee=[he.visible?1:0,2,3],lt=k.getStyles().indicator.tooltip;return{icons:Ee.map(en=>lt.features[en])}}},!1,{axis:{gap:{bottom:2}}});if(!R)return;const F=R,z={name:"BIAS",pane_id:F,params:N},q=`${F}_BIAS`;c.update(he=>(he.saveInds[q]=z,he)),a(!1)}function Xo(){const k=n();if(!k)return;const N=[5,34],R=k.createIndicator({name:"AO",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Ee=[he.visible?1:0,2,3],lt=k.getStyles().indicator.tooltip;return{icons:Ee.map(en=>lt.features[en])}}},!1,{axis:{gap:{bottom:2}}});if(R){const he=k.getStyles();k.setStyles({...he,indicator:{...he.indicator,bars:[{upColor:"#8B5CF6",downColor:"#EF4444",noChangeColor:"#8B5CF6"}]}})}if(!R)return;const F=R,z={name:"AO",pane_id:F,params:N},q=`${F}_AO`;c.update(he=>(he.saveInds[q]=z,he)),a(!1)}function sr(){const k=n();if(!k)return;const N=[14],R=k.createIndicator({name:"WR",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Ee=[he.visible?1:0,2,3],lt=k.getStyles().indicator.tooltip;return{icons:Ee.map(en=>lt.features[en])}}},!1,{axis:{gap:{bottom:2}}});if(!R)return;const F=R,z={name:"WR",pane_id:F,params:N},q=`${F}_WR`;c.update(he=>(he.saveInds[q]=z,he)),a(!1)}function Sl(){const k=n();if(!k)return;const N=[15,9],R=k.createIndicator({name:"TRIX",calcParams:N,createTooltipDataSource:({indicator:he})=>{const Ee=[he.visible?1:0,2,3],lt=k.getStyles().indicator.tooltip;return{icons:Ee.map(en=>lt.features[en])}}},!1,{axis:{gap:{bottom:2}}});if(!R)return;const F=R,z={name:"TRIX",pane_id:F,params:N},q=`${F}_TRIX`;c.update(he=>(he.saveInds[q]=z,he)),a(!1)}function Ru(){var R;if(!i(Q))return;const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="CR").sort((F,z)=>F===`${o().editPaneId}_CR`?-1:z===`${o().editPaneId}_CR`?1:F.localeCompare(z));console.log("🔧 Applying CR changes. Existing keys:",k),console.log("🔧 Current CR groups:",i($r).length);const N=i($r).length;if(k.length>N)for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];try{console.log("🗑️ Removing excess CR indicator from pane:",q.pane_id),(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"CR"})}catch(he){console.log("❌ Error removing excess CR indicator:",he)}delete r().saveInds[z]}i($r).forEach((F,z)=>{var Ee,lt,Qt;const q=[F.crPeriod,F.crMa1Period,F.crMa2Period,F.crMa3Period,F.crMa4Period],he={lines:[{color:F.styles.cr.color,size:F.styles.cr.thickness,style:F.styles.cr.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.cr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:F.styles.ma1.color,size:F.styles.ma1.thickness,style:F.styles.ma1.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.ma1.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:F.styles.ma2.color,size:F.styles.ma2.thickness,style:F.styles.ma2.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.ma2.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:F.styles.ma3.color,size:F.styles.ma3.thickness,style:F.styles.ma3.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.ma3.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:F.styles.ma4.color,size:F.styles.ma4.thickness,style:F.styles.ma4.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.ma4.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if(z===0)console.log("🔄 Updating first CR in pane:",o().editPaneId),(Ee=n())==null||Ee.overrideIndicator({name:"CR",calcParams:q,styles:he,paneId:o().editPaneId});else{const en=`pane_CR_${z+1}_CR`,Zs=k.find(xs=>xs===en);if(Zs){const xs=r().saveInds[Zs];console.log("🔄 Updating existing CR in pane:",xs.pane_id),(lt=n())==null||lt.overrideIndicator({name:"CR",calcParams:q,styles:he,paneId:xs.pane_id})}else{const xs=`pane_CR_${z+1}`;console.log("🆕 Creating new CR in pane:",xs);const Un=(Qt=n())==null?void 0:Qt.createIndicator({name:"CR",calcParams:q,styles:he},!0,{id:xs});console.log("✅ Created new CR indicator with ID:",Un,"in pane:",xs)}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="CR"&&delete F.saveInds[z]}),i($r).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_CR`:`pane_CR_${q+1}_CR`,Ee=q===0?o().editPaneId:`pane_CR_${q+1}`,lt={name:"CR",crGroup:z,pane_id:Ee,groupIndex:q,crGroups:q===0?[...i($r)]:void 0,params:[z.crPeriod,z.crMa1Period,z.crMa2Period,z.crMa3Period,z.crMa4Period]};F.saveInds[he]=lt,console.log("💾 Saved CR group",q,"with key:",he,"and pane ID:",Ee)}),F)),l.update(F=>(F.editIndName="",F.editPaneId="",F.modalIndCfg=!1,F)),a(!1)}function rl(){i(su).forEach((k,N)=>{Wh(N)}),c.update(k=>(Object.keys(k.saveInds).forEach(N=>{k.saveInds[N].name==="MACD"&&delete k.saveInds[N]}),i(su).forEach((N,R)=>{const F=R===0?`${o().editPaneId}_MACD`:`pane_MACD_${R+1}_MACD`,z=R===0?o().editPaneId:N.actualPaneId||`pane_MACD_${R+1}`;k.saveInds[F]={name:"MACD",macdGroup:N,pane_id:z,groupIndex:R,params:[N.fastPeriod,N.slowPeriod,N.signalPeriod]}}),k)),console.log("🔄 Clearing edit state and closing popup..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),k)),a(!1)}function Vi(){if(i(yu)){i(sd).forEach((k,N)=>{k.paneId&&Zf(N)}),c.update(k=>{const N=`${o().editPaneId}_WR`,R={name:"WR",wrGroups:i(sd),pane_id:o().editPaneId};return k.saveInds[N]=R,i(sd).forEach((F,z)=>{const q=z===0?`${o().editPaneId}_WR_single`:`WR_${z+1}`,he={name:"WR",wrGroup:F,pane_id:z===0?o().editPaneId:`new_pane_${z}`,groupIndex:z};k.saveInds[q]=he}),k});try{console.log("🔄 Clearing edit state and closing popup..."),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,console.log("✅ Context updated - modalIndCfg set to false"),k)),a(!1),console.log("✅ Popup show flag set to false - handleKdjConfirm completed successfully")}catch(k){console.error("❌ Error in handleKdjConfirm:",k),console.log("🔄 Forcing popup close due to error..."),l.update(N=>(N.editIndName="",N.editPaneId="",N.modalIndCfg=!1,N)),a(!1),console.log("✅ Popup forcefully closed after error")}}}function Xl(){i(Yf)&&(i(of).forEach((k,N)=>{var z;const R=[k.period,k.shortPeriod,k.longPeriod],F={lines:[{color:k.styles.vr.color,size:k.styles.vr.thickness,style:k.styles.vr.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:k.styles.vr.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:k.styles.vrShort.color,size:k.styles.vrShort.thickness,style:k.styles.vrShort.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:k.styles.vrShort.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:k.styles.vrLong.color,size:k.styles.vrLong.thickness,style:k.styles.vrLong.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:k.styles.vrLong.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};k.paneId&&((z=n())==null||z.overrideIndicator({name:"VR",calcParams:R,styles:F,paneId:k.paneId}),console.log(`✅ Updated VR indicator in pane: ${k.paneId}`))}),c.update(k=>(i(of).forEach((N,R)=>{const F=`${N.paneId}_VR`,z={name:"VR",vrGroup:N,pane_id:N.paneId,params:[N.period,N.shortPeriod,N.longPeriod],groupIndex:R};k.saveInds[F]=z,console.log(`💾 Saved VR group to: ${F}`)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function Hc(){i(Cu)&&(i(zt).forEach((k,N)=>{var z;const R=[k.period],F={bars:[{upColor:k.styles.histogram.upColor,downColor:k.styles.histogram.downColor,noChangeColor:k.styles.histogram.upColor}],lines:[{color:k.styles.ema.color,size:k.styles.ema.thickness,style:k.styles.ema.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:k.styles.ema.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1,visible:k.styles.ema.visible===!0}]};k.paneId&&((z=n())==null||z.overrideIndicator({name:"VOL",calcParams:R,styles:F,paneId:k.paneId}),console.log(`✅ Updated Volume indicator in pane: ${k.paneId}`))}),c.update(k=>(i(zt).forEach((N,R)=>{const F=`${N.paneId}_VOL`,z={name:"VOL",volGroup:N,pane_id:N.paneId,params:[N.period],groupIndex:R};k.saveInds[F]=z,console.log(`💾 Saved Volume group to: ${F}`)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function Da(){i(Ga)&&(console.log("🔧 Applying BBI changes. Current BBI groups:",i(Qd).length),i(Qd).forEach((k,N)=>{var Ee;const R=[k.period1,k.period2,k.period3,k.period4],z=(lt=>{switch(lt){case"dashed":return{style:mt.Dashed,dashedValue:[4,4]};case"dotted":return{style:mt.Dashed,dashedValue:[2,2]};default:return{style:mt.Solid,dashedValue:[2,2]}}})(k.lineStyle),q={lines:[{color:k.color,size:k.thickness,style:z.style,dashedValue:z.dashedValue,smooth:!1}]},he=k.paneId||(N===0?o().editPaneId:`pane_BBI_${N+1}`);console.log("🔄 Updating BBI group",N,"in pane:",he),(Ee=n())==null||Ee.overrideIndicator({name:"BBI",calcParams:R,styles:q,paneId:he}),k.paneId||(k.paneId=he)}),c.update(k=>(Object.keys(k.saveInds).forEach(N=>{k.saveInds[N].name==="BBI"&&delete k.saveInds[N]}),i(Qd).forEach((N,R)=>{const F=`${N.paneId}_BBI`,z={name:"BBI",bbiGroup:N,pane_id:N.paneId,groupIndex:R,bbiGroups:R===0?[...i(Qd)]:void 0,params:[N.period1,N.period2,N.period3,N.period4]};k.saveInds[F]=z,console.log("💾 Saved BBI group",R,"with key:",F,"and pane ID:",N.paneId)}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function gf(){var k;if(!i(G)){console.warn("⚠️ handleEmvConfirm called but not in EMV mode");return}try{if(!i(Pr)||i(Pr).length===0){console.error("❌ No EMV groups to process");return}const N=i(Pr).filter(z=>!(!z||typeof z!="object"||typeof z.period!="number"||z.period<=0||typeof z.period2!="number"||z.period2<=0||typeof z.color!="string"||!z.color||typeof z.thickness!="number"||z.thickness<=0||typeof z.lineStyle!="string"||!z.lineStyle));if(N.length===0){console.error("❌ No valid EMV groups found");return}N.length!==i(Pr).length&&(console.warn(`⚠️ ${i(Pr).length-N.length} invalid EMV groups filtered out`),b(Pr,H(N)));const R=Object.keys(r().saveInds).filter(z=>r().saveInds[z]&&r().saveInds[z].name==="EMV").sort((z,q)=>z===`${o().editPaneId}_EMV`?-1:q===`${o().editPaneId}_EMV`?1:z.localeCompare(q));console.log("🔧 Applying EMV changes. Existing keys:",R),console.log("🔧 Current EMV groups:",i(Pr).length);const F=i(Pr).length;if(R.length>F)for(let z=F;z<R.length;(z+=1)-1){const q=R[z],he=r().saveInds[q];if(he&&he.pane_id)try{console.log("🗑️ Removing excess EMV indicator from pane:",he.pane_id),(k=n())==null||k.removeIndicator({paneId:he.pane_id,name:"EMV"})}catch(Ee){console.log("❌ Error removing excess EMV indicator:",Ee)}}i(Pr).forEach((z,q)=>{var lt,Qt,en;const he=[z.period,z.period2],Ee={lines:[{color:z.color,size:z.thickness,style:z.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:z.lineStyle==="dashed"?[4,4]:z.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(q===0)console.log("🔄 Updating first EMV in pane:",o().editPaneId),(lt=n())==null||lt.overrideIndicator({name:"EMV",calcParams:he,styles:Ee,paneId:o().editPaneId});else{const Zs=`pane_EMV_${q+1}_EMV`,xs=R.find(Un=>Un===Zs);if(xs){const Un=r().saveInds[xs];Un&&Un.pane_id&&(console.log("🔄 Updating existing EMV in pane:",Un.pane_id),(Qt=n())==null||Qt.overrideIndicator({name:"EMV",calcParams:he,styles:Ee,paneId:Un.pane_id}))}else{const Un=`pane_EMV_${q+1}`;console.log("🆕 Creating new EMV in pane:",Un);const jo=(en=n())==null?void 0:en.createIndicator({name:"EMV",calcParams:he,styles:Ee},!0,{id:Un});jo&&console.log("✅ Created new EMV indicator with ID:",jo,"in pane:",Un)}}}),c.update(z=>{try{Object.keys(z.saveInds).forEach(q=>{z.saveInds[q]&&z.saveInds[q].name==="EMV"&&delete z.saveInds[q]}),i(Pr).forEach((q,he)=>{try{const Ee=he===0?`${o().editPaneId}_EMV`:`pane_EMV_${he+1}_EMV`,lt=he===0?o().editPaneId:`pane_EMV_${he+1}`;if(!Ee||!lt){console.error(`❌ Invalid save key or pane ID for EMV group ${he}`);return}const Qt={name:"EMV",emvGroup:q,pane_id:lt,groupIndex:he,emvGroups:he===0?[...i(Pr)]:void 0,params:[q.period,q.period2]};z.saveInds[Ee]=Qt,console.log("💾 Saved EMV group",he,"with key:",Ee,"and pane ID:",lt)}catch(Ee){console.error(`❌ Error saving EMV group ${he}:`,Ee)}})}catch(q){console.error("❌ Error in EMV save operation:",q)}return z}),l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),a(!1),console.log("✅ EMV configuration completed successfully")}catch(N){console.error("❌ Critical error in handleEmvConfirm:",N)}}function ju(){var k;if(!i(ye)){console.warn("⚠️ handleMtmConfirm called but not in MTM mode");return}try{if(!i(Or)||i(Or).length===0){console.error("❌ No MTM groups to process");return}const N=i(Or).filter(z=>!(!z||typeof z!="object"||typeof z.period!="number"||z.period<=0||typeof z.color!="string"||!z.color||typeof z.thickness!="number"||z.thickness<=0||typeof z.lineStyle!="string"||!z.lineStyle));if(N.length===0){console.error("❌ No valid MTM groups found");return}N.length!==i(Or).length&&(console.warn(`⚠️ ${i(Or).length-N.length} invalid MTM groups filtered out`),b(Or,H(N)));const R=Object.keys(r().saveInds).filter(z=>r().saveInds[z]&&r().saveInds[z].name==="MTM").sort((z,q)=>z===`${o().editPaneId}_MTM`?-1:q===`${o().editPaneId}_MTM`?1:z.localeCompare(q));console.log("🔧 Applying MTM changes. Existing keys:",R),console.log("🔧 Current MTM groups:",i(Or).length);const F=i(Or).length;if(R.length>F)for(let z=F;z<R.length;(z+=1)-1){const q=R[z],he=r().saveInds[q];if(he&&he.pane_id)try{console.log("🗑️ Removing excess MTM indicator from pane:",he.pane_id),(k=n())==null||k.removeIndicator({paneId:he.pane_id,name:"MTM"})}catch(Ee){console.log("❌ Error removing excess MTM indicator:",Ee)}}i(Or).forEach((z,q)=>{var lt,Qt,en;const he=[z.period],Ee={lines:[{color:z.color,size:z.thickness,style:z.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:z.lineStyle==="dashed"?[4,4]:z.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(q===0)console.log("🔄 Updating first MTM in pane:",o().editPaneId),(lt=n())==null||lt.overrideIndicator({name:"MTM",calcParams:he,styles:Ee,paneId:o().editPaneId});else{const Zs=`pane_MTM_${q+1}_MTM`,xs=R.find(Un=>Un===Zs);if(xs){const Un=r().saveInds[xs];Un&&Un.pane_id&&(console.log("🔄 Updating existing MTM in pane:",Un.pane_id),(Qt=n())==null||Qt.overrideIndicator({name:"MTM",calcParams:he,styles:Ee,paneId:Un.pane_id}))}else{const Un=`pane_MTM_${q+1}`;console.log("🆕 Creating new MTM in pane:",Un);const jo=(en=n())==null?void 0:en.createIndicator({name:"MTM",calcParams:he,styles:Ee},!0,{id:Un});jo&&console.log("✅ Created new MTM indicator with ID:",jo,"in pane:",Un)}}}),c.update(z=>{try{Object.keys(z.saveInds).forEach(q=>{z.saveInds[q]&&z.saveInds[q].name==="MTM"&&delete z.saveInds[q]}),i(Or).forEach((q,he)=>{try{const Ee=he===0?`${o().editPaneId}_MTM`:`pane_MTM_${he+1}_MTM`,lt=he===0?o().editPaneId:`pane_MTM_${he+1}`;if(!Ee||!lt){console.error(`❌ Invalid save key or pane ID for MTM group ${he}`);return}const Qt={name:"MTM",mtmGroup:q,pane_id:lt,groupIndex:he,mtmGroups:he===0?[...i(Or)]:void 0,params:[q.period]};z.saveInds[Ee]=Qt,console.log("💾 Saved MTM group",he,"with key:",Ee,"and pane ID:",lt)}catch(Ee){console.error(`❌ Error saving MTM group ${he}:`,Ee)}})}catch(q){console.error("❌ Error in MTM save operation:",q)}return z}),l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),a(!1),console.log("✅ MTM configuration completed successfully")}catch(N){console.error("❌ Critical error in handleMtmConfirm:",N)}}function Ka(){var R;if(!i(fu))return;const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="BIAS").sort((F,z)=>F===`${o().editPaneId}_BIAS`?-1:z===`${o().editPaneId}_BIAS`?1:F.localeCompare(z));console.log("🔧 Applying BIAS changes. Existing keys:",k),console.log("🔧 Current BIAS groups:",i(oo).length);const N=i(oo).length;if(k.length>N)for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];if(q&&q.pane_id)try{console.log("🗑️ Removing excess BIAS indicator from pane:",q.pane_id),(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"BIAS"})}catch(he){console.log("❌ Error removing excess BIAS indicator:",he)}}i(oo).forEach((F,z)=>{var Ee,lt,Qt;const q=[F.period],he={lines:[{color:F.color,size:F.thickness,style:F.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:F.lineStyle==="dashed"?[4,4]:F.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]};if(z===0)console.log("🔄 Updating first BIAS in pane:",o().editPaneId),(Ee=n())==null||Ee.overrideIndicator({name:"BIAS",calcParams:q,styles:he,paneId:o().editPaneId});else{const en=`pane_BIAS_${z+1}_BIAS`,Zs=k.find(xs=>xs===en);if(Zs){const xs=r().saveInds[Zs];xs&&xs.pane_id&&(console.log("🔄 Updating existing BIAS in pane:",xs.pane_id),(lt=n())==null||lt.overrideIndicator({name:"BIAS",calcParams:q,styles:he,paneId:xs.pane_id}))}else{const xs=`pane_BIAS_${z+1}`;console.log("🆕 Creating new BIAS in pane:",xs);const Un=(Qt=n())==null?void 0:Qt.createIndicator({name:"BIAS",calcParams:q,styles:he},!0,{id:xs});Un&&console.log("✅ Created new BIAS indicator with ID:",Un,"in pane:",xs)}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="BIAS"&&delete F.saveInds[z]}),i(oo).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_BIAS`:`pane_BIAS_${q+1}_BIAS`,Ee=q===0?o().editPaneId:`pane_BIAS_${q+1}`,lt={name:"BIAS",biasGroup:z,pane_id:Ee,groupIndex:q,biasGroups:q===0?[...i(oo)]:void 0,params:[z.period]};F.saveInds[he]=lt,console.log("💾 Saved BIAS group",q,"with key:",he,"and pane ID:",Ee)}),F)),l.update(F=>(F.editIndName="",F.editPaneId="",F.modalIndCfg=!1,F)),a(!1),console.log("✅ BIAS configuration saved successfully")}function Gu(){if(!i(ce))return;const k=Object.keys(r().saveInds).filter(q=>r().saveInds[q].name==="CCI").sort((q,he)=>q===`${o().editPaneId}_CCI`?-1:he===`${o().editPaneId}_CCI`?1:q.localeCompare(he));console.log("🔧 Applying CCI changes. Existing keys:",k),console.log("🔧 Current CCI groups:",i(uo).length);const N=new Map,R=[],F=new Set;i(uo).forEach((q,he)=>{let Ee=null;for(const lt of k){if(F.has(lt))continue;const Qt=r().saveInds[lt];if(Qt&&Qt.cciGroup&&(Qt.cciGroup.id===q.id||Qt.cciGroup.period===q.period&&Qt.cciGroup.color===q.color&&Qt.cciGroup.thickness===q.thickness&&Qt.cciGroup.lineStyle===q.lineStyle)){Ee=lt,F.add(lt);break}}if(!Ee){let lt=he+1,Qt;do Qt=lt===1?`${o().editPaneId}_CCI`:`pane_CCI_${lt}_CCI`,lt+=1;while(F.has(Qt)||k.includes(Qt));Ee=Qt,F.add(Ee)}N.set(q.id,Ee),R.push(Ee)});const z=k.filter(q=>!R.includes(q));z.forEach(q=>{var Ee;const he=r().saveInds[q];if(he&&he.pane_id)try{console.log("🗑️ Removing CCI indicator from pane:",he.pane_id,"key:",q),(Ee=n())==null||Ee.removeIndicator({paneId:he.pane_id,name:"CCI"})}catch(lt){console.log("❌ Error removing CCI indicator:",lt)}}),i(uo).forEach((q,he)=>{var Zs,xs;const Ee=[q.period],lt={lines:[{color:q.color,size:q.thickness,style:q.lineStyle==="solid"?mt.Solid:mt.Dashed,dashedValue:q.lineStyle==="dashed"?[4,4]:q.lineStyle==="dotted"?[2,6]:[2,2],smooth:!1}]},Qt=N.get(q.id),en=r().saveInds[Qt];if(en&&en.pane_id)console.log("🔄 Updating existing CCI in pane:",en.pane_id,"with key:",Qt),(Zs=n())==null||Zs.overrideIndicator({name:"CCI",calcParams:Ee,styles:lt,paneId:en.pane_id});else{const Un=Qt===`${o().editPaneId}_CCI`?o().editPaneId:Qt.replace("_CCI","");console.log("🆕 Creating new CCI in pane:",Un,"with key:",Qt);const jo=(xs=n())==null?void 0:xs.createIndicator({name:"CCI",calcParams:Ee,styles:lt},!0,{id:Un});jo&&console.log("✅ Created new CCI indicator with ID:",jo,"in pane:",Un)}}),c.update(q=>(z.forEach(he=>{delete q.saveInds[he],console.log("🗑️ Deleted save data for key:",he)}),i(uo).forEach((he,Ee)=>{const lt=N.get(he.id),Qt=lt===`${o().editPaneId}_CCI`?o().editPaneId:lt.replace("_CCI",""),en={name:"CCI",cciGroup:he,pane_id:Qt,groupIndex:Ee,cciGroups:Ee===0?[...i(uo)]:void 0,params:[he.period]};q.saveInds[lt]=en,console.log("💾 Saved CCI group",Ee,"with key:",lt,"and pane ID:",Qt)}),q)),l.update(q=>(q.editIndName="",q.editPaneId="",q.modalIndCfg=!1,q)),a(!1),console.log("✅ CCI configuration saved successfully")}function tf(){i(Ie)&&(Hn(),c.update(k=>(Object.keys(k.saveInds).forEach(N=>{k.saveInds[N].name==="SAR"&&delete k.saveInds[N]}),i(cc).forEach((N,R)=>{const F=R===0?"candle_pane_SAR":`SAR_${R+1}`,z={name:"SAR",sarGroup:N,pane_id:"candle_pane",groupIndex:R,sarGroups:R===0?[...i(cc)]:void 0,params:[N.start,N.increment,N.maxValue]};k.saveInds[F]=z}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function kh(){i(dt)&&(Mc(),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function oh(){var R;if(!i(ge))return;const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="DMI").sort((F,z)=>F===`${o().editPaneId}_DMI`?-1:z===`${o().editPaneId}_DMI`?1:F.localeCompare(z));console.log("🔧 Applying DMI changes. Existing keys:",k),console.log("🔧 Current DMI groups:",i($l).length);const N=i($l).length;if(k.length>N)for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];try{console.log("🗑️ Removing excess DMI indicator from pane:",q.pane_id),(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"DMI"})}catch(he){console.log("❌ Error removing excess DMI indicator:",he)}delete r().saveInds[z]}i($l).forEach((F,z)=>{var Ee,lt,Qt;const q=[F.diPeriod,F.adxPeriod],he={lines:[{color:F.styles.diPlus.color,size:F.styles.diPlus.thickness,style:F.styles.diPlus.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.diPlus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:F.styles.diMinus.color,size:F.styles.diMinus.thickness,style:F.styles.diMinus.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.diMinus.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1},{color:F.styles.adx.color,size:F.styles.adx.thickness,style:F.styles.adx.lineStyle==="dashed"?mt.Dashed:mt.Solid,dashedValue:F.styles.adx.lineStyle==="dashed"?[4,4]:[2,2],smooth:!1}]};if(z===0)console.log("🔄 Updating first DMI in pane:",o().editPaneId),(Ee=n())==null||Ee.overrideIndicator({name:"DMI",calcParams:q,styles:he,paneId:o().editPaneId});else{const en=`pane_DMI_${z+1}_DMI`,Zs=k.find(xs=>xs===en);if(Zs){const xs=r().saveInds[Zs];console.log("🔄 Updating existing DMI in pane:",xs.pane_id),(lt=n())==null||lt.overrideIndicator({name:"DMI",calcParams:q,styles:he,paneId:xs.pane_id})}else{const xs=`pane_DMI_${z+1}`;console.log("🆕 Creating new DMI in pane:",xs);const Un=(Qt=n())==null?void 0:Qt.createIndicator({name:"DMI",calcParams:q,styles:he},!0,{id:xs});console.log("✅ Created new DMI indicator with ID:",Un,"in pane:",xs)}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="DMI"&&delete F.saveInds[z]}),i($l).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_DMI`:`pane_DMI_${q+1}_DMI`,Ee=q===0?o().editPaneId:`pane_DMI_${q+1}`,lt={name:"DMI",dmiGroup:z,pane_id:Ee,groupIndex:q,dmiGroups:q===0?[...i($l)]:void 0,params:[z.diPeriod,z.adxPeriod]};F.saveInds[he]=lt,console.log("💾 Saved DMI group",q,"with key:",he,"and pane ID:",Ee)}),F)),l.update(F=>(F.editIndName="",F.editPaneId="",F.modalIndCfg=!1,F)),a(!1)}function vp(k){var he,Ee;const N=i(Pu)[k];if(!N||!n()){console.warn("❌ updatePvtIndicator: Missing group or chart",{group:N,chart:!!n()});return}console.log("🔄 updatePvtIndicator called:",{groupIndex:k,group:N});let R=mt.Solid,F=[2,2];N.lineStyle==="dashed"?(R=mt.Dashed,F=[4,4]):N.lineStyle==="dotted"&&(R=mt.Dashed,F=[2,2]);const q=((he=n())==null?void 0:he.getIndicators()).filter(lt=>lt.name==="PVT");if(console.log("📊 Found PVT indicators on chart:",q.length),console.log("📊 Looking for group index:",k),q.length>k){const lt=q[k];console.log("✅ Found matching PVT indicator by index, updating styles...");const Qt=(Ee=n())==null?void 0:Ee.overrideIndicator({name:"PVT",paneId:lt.paneId,styles:{lines:[{color:N.color,size:N.thickness,style:R,dashedValue:F,smooth:!1}]},figures:[{key:"pvt",title:"PVT: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Qt),console.log("🎨 Applied styles:",{color:N.color,size:N.thickness,style:R,dashedValue:F});const en=`${lt.paneId}_PVT`;console.log("💾 Using save key:",en),c.update(Zs=>{Zs.saveInds[en]||(Zs.saveInds[en]={name:"PVT",pane_id:lt.paneId,pvtGroups:[]}),Zs.saveInds[en].pvtGroups||(Zs.saveInds[en].pvtGroups=[]);const xs=Zs.saveInds[en].pvtGroups||[];for(;xs.length<=k;)xs.push({});return xs[k]={...N},Zs.saveInds[en].pvtGroups=xs,console.log("💾 Persisted PVT changes to save data:",en,N),Zs}),console.log("✅ PVT indicator updated successfully:",k,N)}else console.error("❌ PVT indicator not found on chart for group index:",k),console.log("📊 Available PVT indicators:",q.length),console.log("📊 Requested group index:",k)}function Ff(k){if(!i(Re)||!n()||k<0||k>=i(nu).length)return;const N=i(nu)[k];console.log("🔄 Updating TRIX indicator:",k,N);try{let F=function(Ee){let lt=mt.Solid,Qt=[2,2];return Ee==="dashed"?(lt=mt.Dashed,Qt=[4,4]):Ee==="dotted"&&(lt=mt.Dashed,Qt=[2,2]),{lineStyle:lt,dashedValue:Qt}},R=N.paneId||o().editPaneId;console.log("🔍 Using pane ID for TRIX update:",R,"for group:",k),n().removeIndicator({paneId:R,name:"TRIX"});const z=F(N.styles.trix.lineStyle),q=F(N.styles.signal.lineStyle);if(n().createIndicator({name:"TRIX",calcParams:[N.trixPeriod,N.signalPeriod],styles:{lines:[{color:N.styles.trix.color,size:N.styles.trix.thickness,style:z.lineStyle,dashedValue:z.dashedValue},{color:N.styles.signal.color,size:N.styles.signal.thickness,style:q.lineStyle,dashedValue:q.dashedValue}]}},R===o().editPaneId,{id:R})){const Ee=`${R}_TRIX`;c.update(lt=>(lt.saveInds[Ee]?lt.saveInds[Ee].params=[N.trixPeriod,N.signalPeriod]:lt.saveInds[Ee]={name:"TRIX",pane_id:R,params:[N.trixPeriod,N.signalPeriod]},lt.saveInds[Ee].trixGroup={...N},lt))}console.log("✅ TRIX indicator updated successfully:",k)}catch(R){console.error("❌ Error updating TRIX indicator:",R)}}function ih(){var R;if(!i(vt)||!n())return;const N=((R=n())==null?void 0:R.getIndicators()).filter(F=>F.name==="ROC");console.log("📊 Found ROC indicators on chart:",N.length),console.log("📊 ROC groups to apply:",i($a).length),i($a).forEach((F,z)=>{var Qt,en;const q=[F.period];let he=mt.Solid,Ee=[2,2];F.styles.roc.lineStyle==="dashed"?(he=mt.Dashed,Ee=[4,4]):F.styles.roc.lineStyle==="dotted"&&(he=mt.Dashed,Ee=[2,2]);const lt=N[z];if(lt){console.log(`🎨 Updating existing ROC indicator ${z} in pane:`,lt.paneId);const Zs=(Qt=n())==null?void 0:Qt.overrideIndicator({name:"ROC",paneId:lt.paneId,calcParams:q,styles:{lines:[{color:F.styles.roc.color,size:F.styles.roc.thickness,style:he,dashedValue:Ee,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]});console.log("🎨 overrideIndicator result:",Zs);const xs=`${lt.paneId}_ROC`;c.update(Un=>{Un.saveInds[xs]||(Un.saveInds[xs]={name:"ROC",pane_id:lt.paneId,params:q,rocGroups:[]}),Un.saveInds[xs].rocGroups||(Un.saveInds[xs].rocGroups=[]);const jo=Un.saveInds[xs].rocGroups||[];for(;jo.length<=z;)jo.push({});return jo[z]={...F},Un.saveInds[xs].rocGroups=jo,Un.saveInds[xs].params=q,console.log("💾 Persisted ROC changes to save data:",xs,F),Un}),console.log("✅ ROC indicator updated successfully:",z,F)}else{console.log(`➕ Creating new ROC indicator for group ${z}`);const Zs={name:"ROC",calcParams:q,styles:{lines:[{color:F.styles.roc.color,size:F.styles.roc.thickness,style:he,dashedValue:Ee,smooth:!1}]},figures:[{key:"roc",title:"ROC: ",type:"line"}]};(en=n())==null||en.createIndicator(Zs,!1,{axis:{gap:{bottom:2}}})}}),l.update(F=>(F.editIndName="",F.editPaneId="",F.modalIndCfg=!1,F)),a(!1)}function bm(){var R;if(!i(Xt))return;const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="PSY").sort((F,z)=>F===`${o().editPaneId}_PSY`?-1:z===`${o().editPaneId}_PSY`?1:F.localeCompare(z)),N=i(ti).length;if(k.length>N)for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];if(q&&q.pane_id)try{(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"PSY"})}catch(he){console.log("Error removing excess PSY indicator:",he)}}i(ti).forEach((F,z)=>{var Zs,xs,Un;const q=[F.psyPeriod,F.mapsyPeriod],he=[{key:"psy",title:"PSY: ",type:"line"}];F.showMapsy&&he.push({key:"mapsy",title:"MAPSY: ",type:"line"});const Ee={lines:[]};let lt=mt.Solid,Qt=[2,2];if(F.styles.psy.lineStyle==="dashed"?(lt=mt.Dashed,Qt=[4,4]):F.styles.psy.lineStyle==="dotted"&&(lt=mt.Dashed,Qt=[2,2]),Ee.lines.push({color:F.styles.psy.color,size:F.styles.psy.thickness,style:lt,dashedValue:Qt,smooth:!1}),F.showMapsy){let jo=mt.Solid,Lc=[2,2];F.styles.mapsy.lineStyle==="dashed"?(jo=mt.Dashed,Lc=[4,4]):F.styles.mapsy.lineStyle==="dotted"&&(jo=mt.Dashed,Lc=[2,2]),Ee.lines.push({color:F.styles.mapsy.color,size:F.styles.mapsy.thickness,style:jo,dashedValue:Lc,smooth:!1})}const en={name:"PSY",calcParams:q,styles:Ee,figures:he};if(z===0)(Zs=n())==null||Zs.overrideIndicator({...en,paneId:o().editPaneId});else{const jo=`psy_${String(z+1).padStart(3,"0")}_PSY`,Lc=k.find(Id=>Id===jo);if(Lc){const Id=r().saveInds[Lc];Id&&Id.pane_id&&((xs=n())==null||xs.overrideIndicator({...en,paneId:Id.pane_id}))}else{const Id=`psy_${String(z+1).padStart(3,"0")}`;((Un=n())==null?void 0:Un.createIndicator(en,!1,{id:Id,axis:{gap:{bottom:2}}}))&&(console.log(`✅ PSY ${z+1} created with pane ID:`,Id),F.actualPaneId=Id)}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="PSY"&&delete F.saveInds[z]}),i(ti).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_PSY`:`psy_${String(q+1).padStart(3,"0")}_PSY`,Ee=q===0?o().editPaneId:z.actualPaneId||`psy_${String(q+1).padStart(3,"0")}`;F.saveInds[he]={name:"PSY",psyGroup:z,pane_id:Ee,groupIndex:q,params:[z.psyPeriod,z.mapsyPeriod]}}),F)),l.update(F=>(F.editIndName="",F.editPaneId="",F.modalIndCfg=!1,F)),a(!1)}function jp(){if(!i(W))return;const k=Object.keys(r().saveInds).filter(N=>r().saveInds[N].name==="OBV");i(fi).forEach((N,R)=>{var Qt,en,Zs;const F=[N.obvPeriod,N.maobvPeriod],z=[{key:"obv",title:"OBV: ",type:"line"}];N.showMaobv&&z.push({key:"maobv",title:"MAOBV: ",type:"line"});const q={lines:[]};let he=mt.Solid,Ee=[2,2];if(N.styles.obv.lineStyle==="dashed"?(he=mt.Dashed,Ee=[4,4]):N.styles.obv.lineStyle==="dotted"&&(he=mt.Dashed,Ee=[2,2]),q.lines.push({color:N.styles.obv.color,size:N.styles.obv.thickness,style:he,dashedValue:Ee,smooth:!1}),N.showMaobv){let xs=mt.Solid,Un=[2,2];N.styles.maobv.lineStyle==="dashed"?(xs=mt.Dashed,Un=[4,4]):N.styles.maobv.lineStyle==="dotted"&&(xs=mt.Dashed,Un=[2,2]),q.lines.push({color:N.styles.maobv.color,size:N.styles.maobv.thickness,style:xs,dashedValue:Un,smooth:!1})}const lt={name:"OBV",calcParams:F,styles:q,figures:z};if(R===0)(Qt=n())==null||Qt.overrideIndicator({...lt,paneId:o().editPaneId});else{const xs=`pane_OBV_${R+1}_OBV`,Un=k.find(jo=>jo===xs);if(Un){const jo=r().saveInds[Un];jo&&jo.pane_id&&((en=n())==null||en.overrideIndicator({...lt,paneId:jo.pane_id}))}else{const jo=`pane_OBV_${R+1}`;((Zs=n())==null?void 0:Zs.createIndicator(lt,!1,{id:jo,axis:{gap:{bottom:2}}}))&&(console.log(`✅ OBV ${R+1} created with pane ID:`,jo),N.actualPaneId=jo)}}}),c.update(N=>(Object.keys(N.saveInds).forEach(R=>{N.saveInds[R].name==="OBV"&&delete N.saveInds[R]}),i(fi).forEach((R,F)=>{const z=F===0?`${o().editPaneId}_OBV`:`pane_OBV_${F+1}_OBV`,q=F===0?o().editPaneId:R.actualPaneId||`pane_OBV_${F+1}`,he={name:"OBV",obvGroup:R,pane_id:q,groupIndex:F,obvGroups:F===0?[...i(fi)]:void 0,params:[R.obvPeriod,R.maobvPeriod]};N.saveInds[z]=he}),N)),l.update(N=>(N.editIndName="",N.editPaneId="",N.modalIndCfg=!1,N)),a(!1)}function Pv(){if(console.log("🚀 handleKdjConfirm started"),!i(U)){console.log("❌ Not KDJ indicator, returning early");return}try{console.log("🔄 Applying KDJ changes, groups:",i(hn).length),console.log("📊 Current KDJ groups data:",JSON.parse(JSON.stringify(i(hn)))),console.log("🔄 Preserving existing indicators and updating with current values"),i(hn).forEach((k,N)=>{console.log(`🔄 Applying KDJ group ${N+1} with current values`),Cp(N)}),c.update(k=>(i(hn).forEach((N,R)=>{const F=R===0?`${o().editPaneId}_KDJ`:`pane_KDJ_${R+1}_KDJ`,z=R===0?o().editPaneId:N.actualPaneId||`pane_KDJ_${R+1}`;console.log(`💾 Updating saved KDJ group ${R+1} with key:`,F,"pane ID:",z),k.saveInds[F]={name:"KDJ",kdjGroup:N,pane_id:z,groupIndex:R,kdjGroups:R===0?[...i(hn)]:void 0,params:[N.kPeriod,N.dPeriod,3]}}),k)),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1)}catch(k){console.error("❌ Error in handleKdjConfirm main logic:",k),console.log("🔄 Forcing popup close due to error in main logic..."),l.update(N=>(N.editIndName="",N.editPaneId="",N.modalIndCfg=!1,N)),a(!1),console.log("✅ Popup forcefully closed after error in main logic")}}function gp(){i(Bt)&&(As(),b(go,!1),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function uc(){var R;if(!i($u))return;console.log("🔄 Applying AO changes, groups:",i(Iu).length);const k=Object.keys(r().saveInds).filter(F=>r().saveInds[F].name==="AO").sort((F,z)=>F===`${o().editPaneId}_AO`?-1:z===`${o().editPaneId}_AO`?1:F.localeCompare(z));console.log("🔍 Existing AO keys:",k);const N=i(Iu).length;if(k.length>N){console.log(`🗑️ Removing ${k.length-N} excess AO indicators`);for(let F=N;F<k.length;(F+=1)-1){const z=k[F],q=r().saveInds[z];if(q&&q.pane_id){console.log("🗑️ Removing AO indicator from pane:",q.pane_id);try{(R=n())==null||R.removeIndicator({paneId:q.pane_id,name:"AO"})}catch(he){console.log("Error removing excess AO indicator:",he)}}}}i(Iu).forEach((F,z)=>{var Ee,lt,Qt,en,Zs;const q=[F.shortPeriod,F.longPeriod],he={bars:[{upColor:F.styles.increasing.color,downColor:F.styles.decreasing.color,noChangeColor:((Ee=F.styles.reverse)==null?void 0:Ee.color)||"#c4c4c4",reverseColor:((lt=F.styles.reverse)==null?void 0:lt.color)||"#c4c4c4"}]};if(z===0)console.log("🔄 Updating first AO indicator in pane:",o().editPaneId),(Qt=n())==null||Qt.overrideIndicator({name:"AO",calcParams:q,styles:he,paneId:o().editPaneId});else{const xs=`pane_AO_${z+1}_AO`,Un=k.find(jo=>jo===xs);if(Un){const jo=r().saveInds[Un];jo&&jo.pane_id&&(console.log(`🔄 Updating existing AO ${z+1} in pane:`,jo.pane_id),(en=n())==null||en.overrideIndicator({name:"AO",calcParams:q,styles:he,paneId:jo.pane_id}))}else{const jo=`pane_AO_${z+1}`;console.log(`🆕 Creating new AO ${z+1} with pane ID:`,jo),(Zs=n())==null||Zs.createIndicator({name:"AO",calcParams:q,styles:he},!0,{id:jo})}}}),c.update(F=>(Object.keys(F.saveInds).forEach(z=>{F.saveInds[z].name==="AO"&&delete F.saveInds[z]}),i(Iu).forEach((z,q)=>{const he=q===0?`${o().editPaneId}_AO`:`pane_AO_${q+1}_AO`,Ee=q===0?o().editPaneId:`pane_AO_${q+1}`;console.log(`💾 Saving AO group ${q+1} with key:`,he),F.saveInds[he]={name:"AO",aoGroup:z,pane_id:Ee,groupIndex:q,aoGroups:q===0?[...i(Iu)]:void 0,params:[z.shortPeriod,z.longPeriod]}}),F)),l.update(F=>(F.editIndName="",F.editPaneId="",F.modalIndCfg=!1,F)),a(!1)}function vr(){i(ad)&&(i(Hl).length===0?b(Hl,H([{id:Br(),paneId:o().editPaneId||"candle_pane",period:i(j),stdDev:i(E),styles:{fillColor:i(x),fillOpacity:i(S),upperColor:i(C),middleColor:i(I),lowerColor:i(A),thickness:i(P),lineStyle:i(T)}}])):(i(Hl)[0].period=i(j),i(Hl)[0].stdDev=i(E),i(Hl)[0].styles.fillColor=i(x),i(Hl)[0].styles.fillOpacity=i(S),i(Hl)[0].styles.upperColor=i(C),i(Hl)[0].styles.middleColor=i(I),i(Hl)[0].styles.lowerColor=i(A),i(Hl)[0].styles.thickness=i(P),i(Hl)[0].styles.lineStyle=i(T)),Gn(),l.update(k=>(k.editIndName="",k.editPaneId="",k.modalIndCfg=!1,k)),a(!1))}function Lf(k){var F;if(console.log("🔄 handleConfirm called with:",k),console.log("📊 Current context:",{editIndName:o().editIndName,editPaneId:o().editPaneId,isKdj:i(U),kdjGroups:i(hn)}),k==="close"||k==="cancel"){l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),b(go,!1),a(!1);return}if(k==="confirm"&&i(Af)&&o().editIndName&&o().editPaneId){rl();return}if(k==="confirm"&&i(et)&&o().editIndName&&o().editPaneId){Gi(),l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),a(!1);return}if(k==="confirm"&&i(Ld)&&o().editIndName&&o().editPaneId){console.log("🔄 PVT Confirm: Applying all changes to chart"),i(Pu).forEach((z,q)=>{console.log(`🔄 Applying PVT group ${q}:`,z),vp(q)}),c.update(z=>{const q=`${o().editPaneId}_PVT`;return z.saveInds[q]={...z.saveInds[q],pvtGroups:[...i(Pu)]},console.log("💾 Saved PVT groups to:",q),z}),l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),a(!1);return}if(k==="confirm"&&i(Q)&&o().editIndName&&o().editPaneId){Ru();return}if(k==="confirm"&&i(yu)&&o().editIndName&&o().editPaneId){Vi();return}if(k==="confirm"&&i(Yf)&&o().editIndName&&o().editPaneId){Xl();return}if(k==="confirm"&&i(Cu)&&o().editIndName&&o().editPaneId){Hc();return}if(k==="confirm"&&i(Ga)&&o().editIndName&&o().editPaneId){Da();return}if(k==="confirm"&&i(Qe)&&o().editIndName&&o().editPaneId){i(Di).forEach((z,q)=>{cp(q)}),Xf(),l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),a(!1);return}if(k==="confirm"&&i(G)&&o().editIndName&&o().editPaneId){gf();return}if(k==="confirm"&&i(ye)&&o().editIndName&&o().editPaneId){ju();return}if(k==="confirm"&&i(fu)&&o().editIndName&&o().editPaneId){Ka();return}if(k==="confirm"&&i(Sd)&&o().editIndName&&o().editPaneId){Zn();return}if(k==="confirm"&&i(ce)&&o().editIndName&&o().editPaneId){Gu();return}if(k==="confirm"&&i(Ie)&&o().editIndName&&o().editPaneId){tf();return}if(k==="confirm"&&i(dt)&&o().editIndName&&o().editPaneId){kh();return}if(k==="confirm"&&i(ge)&&o().editIndName&&o().editPaneId){oh();return}if(k==="confirm"&&i(vt)&&o().editIndName&&o().editPaneId){ih();return}if(k==="confirm"&&i(Xt)&&o().editIndName&&o().editPaneId){bm();return}if(k==="confirm"&&i(W)&&o().editIndName&&o().editPaneId){jp();return}if(k==="confirm"&&i(ac)&&o().editIndName&&o().editPaneId){fe();return}if(k==="confirm"&&i(U)&&o().editIndName&&o().editPaneId){console.log("✅ KDJ confirm condition met, calling handleKdjConfirm"),Pv();return}if(k==="confirm"&&i($u)&&o().editIndName&&o().editPaneId){uc();return}if(k==="confirm"&&i(ad)&&o().editIndName&&o().editPaneId){vr();return}if(k==="confirm"&&i(Bt)&&o().editIndName&&o().editPaneId){gp();return}if(k!=="confirm"||!o().editIndName||!o().editPaneId||d.length===0){a(!1);return}const N=[],R={lines:[],bars:[]};u.forEach((z,q)=>{const he=d[q];if(he&&he.type==="color"){const Ee=he.styleKey;if(Ee){const lt=Ee.match(/^(\w+)\[(\d+)\]\.(\w+)$/);if(lt){const[,Qt,en,Zs]=lt,xs=parseInt(en);R[Qt]||(R[Qt]=[]),R[Qt][xs]||(R[Qt][xs]={}),R[Qt][xs][Zs]=z||he.default}}}else(!iv.isValid(z)||z==="")&&he&&he.default&&(z=he.default),N.push(Number(z))}),h.forEach((z,q)=>{let he=mt.Solid,Ee=[2,2];z.lineStyle==="dashed"?(he=mt.Dashed,Ee=[4,4]):z.lineStyle==="dotted"&&(he=mt.Dashed,Ee=[2,6]),R.lines[q]={color:z.color,size:z.thickness,style:he,dashedValue:Ee}}),(F=n())==null||F.overrideIndicator({name:o().editIndName,calcParams:N,styles:R,paneId:o().editPaneId}),c.update(z=>{const q={name:o().editIndName,params:N,pane_id:o().editPaneId,styles:[...h]};return i(ad)||(q.fields=[...d]),z.saveInds[`${o().editPaneId}_${o().editIndName}`]=q,z}),l.update(z=>(z.editIndName="",z.editPaneId="",z.modalIndCfg=!1,z)),a(!1)}O0();var Mp=Xq(),Up=_s(Mp);uv(Up,{get title(){return i(Ze)},width:600,maxWidth:"min(600px, 95vw)",maxHeight:"90vh",get show(){return a()},set show(k){a(k)},get theme(){return r().theme},click:Lf,children:(k,N)=>{var R=Kq(),F=y(R);Ve(F,()=>i(Af),q=>{var he=mW(),Ee=y(he);qo(Ee,17,()=>i(su),yi,(en,Zs,xs)=>{var Un=hW(),jo=y(Un),Lc=y(jo);Lc.textContent=`MACD ${xs+1}`;var Id=m(Lc,2);Ve(Id,()=>i(su).length>1,Ii=>{var Zo=pW();Zo.__click=[fW,Bg,Zs],Y(Ii,Zo)}),_(jo);var sf=m(jo,2),au=y(sf),Wd=m(y(au),2);Ts(Wd),_(au);var ud=m(au,2),Hd=m(y(ud),2);Ts(Hd),_(ud);var dd=m(ud,2),Rd=m(y(dd),2);Ts(Rd),_(dd),_(sf);var Ou=m(sf,2),Pd=y(Ou),Rr=m(y(Pd),2),Ul=Lt(()=>Jt(xs,"macdLine"));Rr.__click=function(...Ii){var Zo;(Zo=i(Ul))==null||Zo.apply(this,Ii)};var Wa=m(Rr,2);Wa.__change=()=>Wh(xs);var Wo=y(Wa);Wo.value=(Wo.__value=1)==null?"":1;var ji=m(Wo);ji.value=(ji.__value=2)==null?"":2;var Jl=m(ji);Jl.value=(Jl.__value=3)==null?"":3;var zr=m(Jl);zr.value=(zr.__value=4)==null?"":4;var dc=m(zr);dc.value=(dc.__value=5)==null?"":5,_(Wa);var Jc=m(Wa,2);Jc.__change=()=>Wh(xs);var Vr=y(Jc);Vr.value=(Vr.__value="solid")==null?"":"solid";var ml=m(Vr);ml.value=(ml.__value="dashed")==null?"":"dashed";var Bc=m(ml);Bc.value=(Bc.__value="dotted")==null?"":"dotted",_(Jc),_(Pd);var Ja=m(Pd,2),xc=m(y(Ja),2),lu=Lt(()=>Jt(xs,"signalLine"));xc.__click=function(...Ii){var Zo;(Zo=i(lu))==null||Zo.apply(this,Ii)};var fa=m(xc,2);fa.__change=()=>Wh(xs);var fc=y(fa);fc.value=(fc.__value=1)==null?"":1;var cu=m(fc);cu.value=(cu.__value=2)==null?"":2;var Sa=m(cu);Sa.value=(Sa.__value=3)==null?"":3;var vl=m(Sa);vl.value=(vl.__value=4)==null?"":4;var pc=m(vl);pc.value=(pc.__value=5)==null?"":5,_(fa);var ya=m(fa,2);ya.__change=()=>Wh(xs);var Ur=y(ya);Ur.value=(Ur.__value="solid")==null?"":"solid";var Wl=m(Ur);Wl.value=(Wl.__value="dashed")==null?"":"dashed";var pa=m(Wl);pa.value=(pa.__value="dotted")==null?"":"dotted",_(ya),_(Ja);var Bi=m(Ja,2),wc=m(y(Bi),2),nr=Lt(()=>Jt(xs,"positiveHistogram"));wc.__click=function(...Ii){var Zo;(Zo=i(nr))==null||Zo.apply(this,Ii)},_(Bi);var Ca=m(Bi,2),Cl=m(y(Ca),2),Qa=Lt(()=>Jt(xs,"negativeHistogram"));Cl.__click=function(...Ii){var Zo;(Zo=i(Qa))==null||Zo.apply(this,Ii)},_(Ca);var el=m(Ca,2),Zi=m(y(el),2),Ki=Lt(()=>Jt(xs,"reverseHistogram"));Zi.__click=function(...Ii){var Zo;(Zo=i(Ki))==null||Zo.apply(this,Ii)},_(el),_(Ou),_(Un),we(()=>{Dt(Rr,"style",`background-color: ${i(Zs).styles.macdLine.color??""}; border: 1px solid #ddd;`),Dt(xc,"style",`background-color: ${i(Zs).styles.signalLine.color??""}; border: 1px solid #ddd;`),Dt(wc,"style",`background-color: ${i(Zs).styles.positiveHistogram.color??""}; border: 1px solid #ddd;`),Dt(Cl,"style",`background-color: ${i(Zs).styles.negativeHistogram.color??""}; border: 1px solid #ddd;`),Dt(Zi,"style",`background-color: ${i(Zs).styles.reverseHistogram.color??""}; border: 1px solid #ddd;`)}),Fn(Wd,()=>i(Zs).fastPeriod,Ii=>i(Zs).fastPeriod=Ii),Fn(Hd,()=>i(Zs).slowPeriod,Ii=>i(Zs).slowPeriod=Ii),Fn(Rd,()=>i(Zs).signalPeriod,Ii=>i(Zs).signalPeriod=Ii),co(Wa,()=>i(Zs).styles.macdLine.thickness,Ii=>i(Zs).styles.macdLine.thickness=Ii),co(Jc,()=>i(Zs).styles.macdLine.lineStyle,Ii=>i(Zs).styles.macdLine.lineStyle=Ii),co(fa,()=>i(Zs).styles.signalLine.thickness,Ii=>i(Zs).styles.signalLine.thickness=Ii),co(ya,()=>i(Zs).styles.signalLine.lineStyle,Ii=>i(Zs).styles.signalLine.lineStyle=Ii),Y(en,Un)});var lt=m(Ee,2),Qt=y(lt);Qt.__click=dv,_(lt),_(he),Y(q,he)},q=>{var he=Qs(),Ee=_s(he);Ve(Ee,()=>i(et),lt=>{var Qt=vW(),en=y(Qt),Zs=y(en),xs=m(y(Zs),2);Ts(xs),xs.__input=[bv,et,n,f,o,l,vn],_(Zs);var Un=m(Zs,2),jo=m(y(Un),2);Ts(jo),jo.__input=[bv,et,n,f,o,l,vn],_(Un);var Lc=m(Un,2),Id=m(y(Lc),2);Ts(Id),Id.__input=[bv,et,n,f,o,l,vn],_(Lc);var sf=m(Lc,2),au=m(y(sf),2);Ts(au),au.__input=[bv,et,n,f,o,l,vn],_(sf);var Wd=m(sf,2),ud=m(y(Wd),2);Ts(ud),ud.__input=[bv,et,n,f,o,l,vn],_(Wd);var Hd=m(Wd,2),dd=m(y(Hd),2);Ts(dd),dd.__input=[bv,et,n,f,o,l,vn],_(Hd),_(en);var Rd=m(en,2),Ou=y(Rd),Pd=m(y(Ou),2),Rr=y(Pd);Ts(Rr),Rr.__input=[bv,et,n,f,o,l,vn];var Ul=m(Rr,2),Wa=y(Ul);we(()=>st(Wa,`${(vn.maxZoneWidthPct*100).toFixed(1)??""}%`)),_(Ul),_(Pd),_(Ou);var Wo=m(Ou,2),ji=m(y(Wo),2),Jl=y(ji);Ts(Jl),Jl.__input=[bv,et,n,f,o,l,vn];var zr=m(Jl,2),dc=y(zr);we(()=>st(dc,`${vn.minVolumeFactor.toFixed(2)??""}x`)),_(zr),_(ji),_(Wo);var Jc=m(Wo,2),Vr=m(y(Jc),2),ml=y(Vr);Ts(ml),ml.__input=[bv,et,n,f,o,l,vn];var Bc=m(ml,2),Ja=y(Bc,!0);we(()=>st(Ja,vn.minOBVTrendStrength.toFixed(2))),_(Bc),_(Vr),_(Jc);var xc=m(Jc,2),lu=m(y(xc),2),fa=y(lu);Ts(fa),fa.__input=[bv,et,n,f,o,l,vn];var fc=m(fa,2),cu=y(fc,!0);we(()=>st(cu,vn.minZoneScore.toFixed(2))),_(fc),_(lu),_(xc),_(Rd);var Sa=m(Rd,2),vl=y(Sa),pc=m(y(vl),2);Ts(pc),pc.__change=[bv,et,n,f,o,l,vn],_(vl);var ya=m(vl,2),Ur=m(y(ya),2);Ts(Ur),Ur.__change=[bv,et,n,f,o,l,vn],_(ya),_(Sa);var Wl=m(Sa,2),pa=m(y(Wl),2);Ts(pa),pa.__input=[bv,et,n,f,o,l,vn],_(Wl),_(Qt),Fn(xs,()=>vn.zoneLookbackBars,Bi=>vn.zoneLookbackBars=Bi),Fn(jo,()=>vn.priorTrendLookback,Bi=>vn.priorTrendLookback=Bi),Fn(Id,()=>vn.minZoneBars,Bi=>vn.minZoneBars=Bi),Fn(au,()=>vn.maxZoneBars,Bi=>vn.maxZoneBars=Bi),Fn(ud,()=>vn.atrPeriod,Bi=>vn.atrPeriod=Bi),Fn(dd,()=>vn.volumeMAPeriod,Bi=>vn.volumeMAPeriod=Bi),Fn(Rr,()=>vn.maxZoneWidthPct,Bi=>vn.maxZoneWidthPct=Bi),Fn(Jl,()=>vn.minVolumeFactor,Bi=>vn.minVolumeFactor=Bi),Fn(ml,()=>vn.minOBVTrendStrength,Bi=>vn.minOBVTrendStrength=Bi),Fn(fa,()=>vn.minZoneScore,Bi=>vn.minZoneScore=Bi),Wv(pc,()=>vn.mergeNearbyZones,Bi=>vn.mergeNearbyZones=Bi),Wv(Ur,()=>vn.showLabels,Bi=>vn.showLabels=Bi),Fn(pa,()=>vn.maxZonesDisplayed,Bi=>vn.maxZonesDisplayed=Bi),Y(lt,Qt)},lt=>{var Qt=Qs(),en=_s(Qt);Ve(en,()=>i(B),Zs=>{var xs=_W(),Un=y(xs),jo=y(Un),Lc=m(y(jo),2);Ts(Lc),Lc.__input=tt,_(jo);var Id=m(jo,2),sf=m(y(Id),2);Ts(sf),sf.__input=tt,_(Id);var au=m(Id,2),Wd=m(y(au),2);Ts(Wd),Wd.__input=tt,_(au);var ud=m(au,2),Hd=m(y(ud),2);Ts(Hd),Hd.__input=tt,_(ud);var dd=m(ud,2),Rd=m(y(dd),2);Ts(Rd),Rd.__input=tt,_(dd);var Ou=m(dd,2),Pd=m(y(Ou),2),Rr=y(Pd);Ts(Rr),Rr.__input=tt;var Ul=m(Rr,2),Wa=y(Ul);we(()=>st(Wa,`${Number(u[5]??1.2).toFixed(2)??""}x`)),_(Ul),_(Pd),_(Ou),_(Un);var Wo=m(Un,2),ji=y(Wo),Jl=m(y(ji),2),zr=y(Jl);Ts(zr),zr.__input=tt,Oi(2),_(Jl),_(ji);var dc=m(ji,2),Jc=m(y(dc),2),Vr=y(Jc);Ts(Vr),Vr.__input=tt;var ml=m(Vr,2),Bc=y(ml,!0);we(()=>st(Bc,Number(u[7]??.35).toFixed(2))),_(ml),_(Jc),_(dc);var Ja=m(dc,2),xc=m(y(Ja),2),lu=y(xc);Ts(lu),lu.__input=tt;var fa=m(lu,2),fc=y(fa,!0);we(()=>st(fc,Number(u[8]??.5).toFixed(2))),_(fa),_(xc),_(Ja),_(Wo);var cu=m(Wo,2),Sa=y(cu),vl=m(y(Sa),2);Ts(vl),we(()=>qm(vl,Number(u[9]??1)>0)),vl.__change=[gW,u,tt],_(Sa);var pc=m(Sa,2),ya=m(y(pc),2);Ts(ya),ya.__input=tt,_(pc),_(cu),_(xs),Fn(Lc,()=>u[0],Ur=>u[0]=Ur),Fn(sf,()=>u[1],Ur=>u[1]=Ur),Fn(Wd,()=>u[2],Ur=>u[2]=Ur),Fn(Hd,()=>u[3],Ur=>u[3]=Ur),Fn(Rd,()=>u[4],Ur=>u[4]=Ur),Fn(Rr,()=>u[5],Ur=>u[5]=Ur),Fn(zr,()=>u[6],Ur=>u[6]=Ur),Fn(Vr,()=>u[7],Ur=>u[7]=Ur),Fn(lu,()=>u[8],Ur=>u[8]=Ur),Fn(ya,()=>u[10],Ur=>u[10]=Ur),Y(Zs,xs)},Zs=>{var xs=Qs(),Un=_s(xs);Ve(Un,()=>i(ve),jo=>{var Lc=yW(),Id=y(Lc),sf=m(y(Id),2),au=y(sf),Wd=m(y(au),2);Ts(Wd),Wd.__input=St,_(au);var ud=m(au,2),Hd=m(y(ud),2);Ts(Hd),Hd.__input=St,_(ud);var dd=m(ud,2),Rd=m(y(dd),2);Ts(Rd),Rd.__input=St,_(dd);var Ou=m(dd,2),Pd=m(y(Ou),2);Ts(Pd),Pd.__input=St,_(Ou);var Rr=m(Ou,2),Ul=m(y(Rr),2);Ts(Ul),Ul.__input=St,_(Rr);var Wa=m(Rr,2),Wo=m(y(Wa),2);Ts(Wo),Wo.__input=St,_(Wa),_(sf),_(Id);var ji=m(Id,2),Jl=m(y(ji),2),zr=y(Jl),dc=m(y(zr),2),Jc=y(dc);Ts(Jc),Jc.__input=St;var Vr=m(Jc,2),ml=y(Vr,!0);we(()=>st(ml,Number(u[6]??.7).toFixed(2))),_(Vr),_(dc),_(zr);var Bc=m(zr,2),Ja=m(y(Bc),2);Ts(Ja),Ja.__input=St,_(Bc);var xc=m(Bc,2),lu=m(y(xc),2),fa=y(lu);Ts(fa),fa.__input=St;var fc=m(fa,2),cu=y(fc);we(()=>st(cu,`${Number(u[8]??1.3).toFixed(2)??""}x`)),_(fc),_(lu),_(xc);var Sa=m(xc,2),vl=m(y(Sa),2),pc=y(vl);Ts(pc),pc.__input=St;var ya=m(pc,2),Ur=y(ya);we(()=>st(Ur,`${Number(u[9]??1.3).toFixed(2)??""}x`)),_(ya),_(vl),_(Sa);var Wl=m(Sa,2),pa=m(y(Wl),2),Bi=y(pa);Ts(Bi),Bi.__input=St;var wc=m(Bi,2),nr=y(wc,!0);we(()=>st(nr,Number(u[10]??.6).toFixed(2))),_(wc),_(pa),_(Wl);var Ca=m(Wl,2),Cl=m(y(Ca),2);Ts(Cl),Cl.__input=St,_(Ca);var Qa=m(Ca,2),el=m(y(Qa),2);Ts(el),el.__input=St,_(Qa),_(Jl),_(ji),_(Lc),Fn(Wd,()=>u[0],Zi=>u[0]=Zi),Fn(Hd,()=>u[1],Zi=>u[1]=Zi),Fn(Rd,()=>u[2],Zi=>u[2]=Zi),Fn(Pd,()=>u[3],Zi=>u[3]=Zi),Fn(Ul,()=>u[4],Zi=>u[4]=Zi),Fn(Wo,()=>u[5],Zi=>u[5]=Zi),Fn(Jc,()=>u[6],Zi=>u[6]=Zi),Fn(Ja,()=>u[7],Zi=>u[7]=Zi),Fn(fa,()=>u[8],Zi=>u[8]=Zi),Fn(pc,()=>u[9],Zi=>u[9]=Zi),Fn(Bi,()=>u[10],Zi=>u[10]=Zi),Fn(Cl,()=>u[11],Zi=>u[11]=Zi),Fn(el,()=>u[12],Zi=>u[12]=Zi),Y(jo,Lc)},jo=>{var Lc=Qs(),Id=_s(Lc);Ve(Id,()=>i(Fe),sf=>{var au=bW(),Wd=y(au),ud=m(y(Wd),2),Hd=y(ud),dd=m(y(Hd),2);Ts(dd),dd.__input=Be,_(Hd);var Rd=m(Hd,2),Ou=m(y(Rd),2);Ts(Ou),Ou.__input=Be,_(Rd);var Pd=m(Rd,2),Rr=m(y(Pd),2);Ts(Rr),Rr.__input=Be,_(Pd);var Ul=m(Pd,2),Wa=m(y(Ul),2);Ts(Wa),Wa.__input=Be,_(Ul);var Wo=m(Ul,2),ji=m(y(Wo),2);Ts(ji),ji.__input=Be,_(Wo);var Jl=m(Wo,2),zr=m(y(Jl),2);Ts(zr),zr.__input=Be,_(Jl),_(ud),_(Wd);var dc=m(Wd,2),Jc=m(y(dc),2),Vr=y(Jc),ml=m(y(Vr),2),Bc=y(ml);Ts(Bc),Bc.__input=Be;var Ja=m(Bc,2),xc=y(Ja,!0);we(()=>st(xc,Number(u[6]??.7).toFixed(2))),_(Ja),_(ml),_(Vr);var lu=m(Vr,2),fa=m(y(lu),2);Ts(fa),fa.__input=Be,_(lu);var fc=m(lu,2),cu=m(y(fc),2),Sa=y(cu);Ts(Sa),Sa.__input=Be;var vl=m(Sa,2),pc=y(vl);we(()=>st(pc,`${Number(u[8]??1.3).toFixed(2)??""}x`)),_(vl),_(cu),_(fc);var ya=m(fc,2),Ur=m(y(ya),2),Wl=y(Ur);Ts(Wl),Wl.__input=Be;var pa=m(Wl,2),Bi=y(pa);we(()=>st(Bi,`${Number(u[9]??1.3).toFixed(2)??""}x`)),_(pa),_(Ur),_(ya);var wc=m(ya,2),nr=m(y(wc),2),Ca=y(nr);Ts(Ca),Ca.__input=Be;var Cl=m(Ca,2),Qa=y(Cl,!0);we(()=>st(Qa,Number(u[10]??.6).toFixed(2))),_(Cl),_(nr),_(wc);var el=m(wc,2),Zi=m(y(el),2);Ts(Zi),Zi.__input=Be,_(el);var Ki=m(el,2),Ii=m(y(Ki),2);Ts(Ii),Ii.__input=Be,_(Ki),_(Jc),_(dc),_(au),Fn(dd,()=>u[0],Zo=>u[0]=Zo),Fn(Ou,()=>u[1],Zo=>u[1]=Zo),Fn(Rr,()=>u[2],Zo=>u[2]=Zo),Fn(Wa,()=>u[3],Zo=>u[3]=Zo),Fn(ji,()=>u[4],Zo=>u[4]=Zo),Fn(zr,()=>u[5],Zo=>u[5]=Zo),Fn(Bc,()=>u[6],Zo=>u[6]=Zo),Fn(fa,()=>u[7],Zo=>u[7]=Zo),Fn(Sa,()=>u[8],Zo=>u[8]=Zo),Fn(Wl,()=>u[9],Zo=>u[9]=Zo),Fn(Ca,()=>u[10],Zo=>u[10]=Zo),Fn(Zi,()=>u[11],Zo=>u[11]=Zo),Fn(Ii,()=>u[12],Zo=>u[12]=Zo),Y(sf,au)},sf=>{var au=Qs(),Wd=_s(au);Ve(Wd,()=>i(Qe),ud=>{var Hd=kW(),dd=y(Hd);qo(dd,17,()=>i(Di),yi,(Pd,Rr,Ul)=>{var Wa=wW(),Wo=y(Wa),ji=y(Wo);ji.textContent=`RSI ${Ul+1}`;var Jl=m(ji,2);Ve(Jl,()=>i(Di).length>1,K=>{var ht=xW();ht.__click=()=>Lh(Ul),Y(K,ht)}),_(Wo);var zr=m(Wo,2),dc=y(zr),Jc=m(y(dc),2);Ts(Jc),Jc.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)},_(dc);var Vr=m(dc,2),ml=m(y(Vr),2);Ts(ml),ml.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)},_(Vr);var Bc=m(Vr,2),Ja=m(y(Bc),2);Ts(Ja),Ja.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)},_(Bc);var xc=m(Bc,2),lu=m(y(xc),2);Ts(lu),lu.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)},_(xc),_(zr);var fa=m(zr,2),fc=y(fa),cu=m(y(fc),2),Sa=y(cu);Sa.__click=K=>{b(Gf,H(Ul));const ht=K.currentTarget.getBoundingClientRect();b(sp,H({x:ht.left+ht.width/2,y:ht.bottom+5})),b(td,!0)};var vl=m(Sa,2);vl.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var pc=y(vl);pc.value=(pc.__value=1)==null?"":1;var ya=m(pc);ya.value=(ya.__value=2)==null?"":2;var Ur=m(ya);Ur.value=(Ur.__value=3)==null?"":3;var Wl=m(Ur);Wl.value=(Wl.__value=4)==null?"":4;var pa=m(Wl);pa.value=(pa.__value=5)==null?"":5,_(vl);var Bi=m(vl,2);Bi.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var wc=y(Bi);wc.value=(wc.__value="solid")==null?"":"solid";var nr=m(wc);nr.value=(nr.__value="dashed")==null?"":"dashed";var Ca=m(nr);Ca.value=(Ca.__value="dotted")==null?"":"dotted",_(Bi),_(cu),_(fc),_(fa);var Cl=m(fa,2),Qa=m(y(Cl),2),el=m(y(Qa),2),Zi=y(el);Zi.__click=K=>{b(br,H(Ul));const ht=K.currentTarget.getBoundingClientRect();b(El,H({x:ht.left+ht.width/2,y:ht.bottom+5})),b(la,!0)};var Ki=m(Zi,2);Ki.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var Ii=y(Ki);Ii.value=(Ii.__value=1)==null?"":1;var Zo=m(Ii);Zo.value=(Zo.__value=2)==null?"":2;var ha=m(Zo);ha.value=(ha.__value=3)==null?"":3,_(Ki);var al=m(Ki,2);al.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var Pi=y(al);Pi.value=(Pi.__value="solid")==null?"":"solid";var Ar=m(Pi);Ar.value=(Ar.__value="dashed")==null?"":"dashed";var ia=m(Ar);ia.value=(ia.__value="dotted")==null?"":"dotted",_(al),_(el),_(Qa);var ma=m(Qa,2),jr=m(y(ma),2),Ha=y(jr);Ha.__click=K=>{b(br,H(Ul));const ht=K.currentTarget.getBoundingClientRect();b(Td,H({x:ht.left+ht.width/2,y:ht.bottom+5})),b(qu,!0)};var ll=m(Ha,2);ll.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var li=y(ll);li.value=(li.__value=1)==null?"":1;var wr=m(li);wr.value=(wr.__value=2)==null?"":2;var Qr=m(wr);Qr.value=(Qr.__value=3)==null?"":3,_(ll);var ea=m(ll,2);ea.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var ja=y(ea);ja.value=(ja.__value="solid")==null?"":"solid";var Ia=m(ja);Ia.value=(Ia.__value="dashed")==null?"":"dashed";var Li=m(Ia);Li.value=(Li.__value="dotted")==null?"":"dotted",_(ea),_(jr),_(ma);var Tr=m(ma,2),Il=m(y(Tr),2),va=y(Il);va.__click=K=>{b(br,H(Ul));const ht=K.currentTarget.getBoundingClientRect();b(sl,H({x:ht.left+ht.width/2,y:ht.bottom+5})),b(ki,!0)};var gr=m(va,2);gr.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var zo=y(gr);zo.value=(zo.__value=1)==null?"":1;var oi=m(zo);oi.value=(oi.__value=2)==null?"":2;var Lr=m(oi);Lr.value=(Lr.__value=3)==null?"":3,_(gr);var kr=m(gr,2);kr.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var or=y(kr);or.value=(or.__value="solid")==null?"":"solid";var Hi=m(or);Hi.value=(Hi.__value="dashed")==null?"":"dashed";var cl=m(Hi);cl.value=(cl.__value="dotted")==null?"":"dotted",_(kr),_(Il),_(Tr);var Ho=m(Tr,2),qa=m(y(Ho),2),Fr=y(qa);Ts(Fr),Fr.__change=()=>{b(Di,H([...i(Di)])),cp(Ul)};var Mi=m(Fr,2),Ll=y(Mi);we(()=>st(Ll,`${Math.round((i(Rr).fillOpacity??.15)*100)??""}%`)),_(Mi),_(qa),_(Ho),_(Cl),_(Wa),we(()=>{Dt(Sa,"style",`background-color: ${i(Rr).styles.rsi.color??""}`),Dt(Zi,"style",`background-color: ${(i(Rr).styles.overboughtColor||"#EF4444")??""}`),Dt(Ha,"style",`background-color: ${(i(Rr).styles.oversoldColor||"#22C55E")??""}`),Dt(va,"style",`background-color: ${(i(Rr).styles.middleLineColor||"#6B7280")??""}`)}),Fn(Jc,()=>i(Rr).period,K=>i(Rr).period=K),Fn(ml,()=>i(Rr).overboughtLevel,K=>i(Rr).overboughtLevel=K),Fn(Ja,()=>i(Rr).middleLevel,K=>i(Rr).middleLevel=K),Fn(lu,()=>i(Rr).oversoldLevel,K=>i(Rr).oversoldLevel=K),co(vl,()=>i(Rr).styles.rsi.thickness,K=>i(Rr).styles.rsi.thickness=K),co(Bi,()=>i(Rr).styles.rsi.lineStyle,K=>i(Rr).styles.rsi.lineStyle=K),co(Ki,()=>i(Rr).styles.overboughtThickness,K=>i(Rr).styles.overboughtThickness=K),co(al,()=>i(Rr).styles.overboughtLineStyle,K=>i(Rr).styles.overboughtLineStyle=K),co(ll,()=>i(Rr).styles.oversoldThickness,K=>i(Rr).styles.oversoldThickness=K),co(ea,()=>i(Rr).styles.oversoldLineStyle,K=>i(Rr).styles.oversoldLineStyle=K),co(gr,()=>i(Rr).styles.middleLineThickness,K=>i(Rr).styles.middleLineThickness=K),co(kr,()=>i(Rr).styles.middleLineStyle,K=>i(Rr).styles.middleLineStyle=K),Fn(Fr,()=>i(Rr).fillOpacity,K=>i(Rr).fillOpacity=K),Y(Pd,Wa)});var Rd=m(dd,2),Ou=y(Rd);Ou.__click=Vh,_(Rd),_(Hd),Y(ud,Hd)},ud=>{var Hd=Qs(),dd=_s(Hd);Ve(dd,()=>i(Ue),Rd=>{var Ou=IW(),Pd=y(Ou);qo(Pd,17,()=>i(cd),yi,(Wa,Wo,ji)=>{var Jl=CW(),zr=y(Jl),dc=y(zr);dc.textContent=`Stochastic ${ji+1}`;var Jc=m(dc,2);Ve(Jc,()=>i(cd).length>1,zo=>{var oi=SW();oi.__click=()=>xh(ji),Y(zo,oi)}),_(zr);var Vr=m(zr,2),ml=y(Vr),Bc=m(y(ml),2);Ts(Bc),Bc.__change=()=>th(ji),_(ml);var Ja=m(ml,2),xc=m(y(Ja),2);Ts(xc),xc.__change=()=>th(ji),_(Ja);var lu=m(Ja,2),fa=m(y(lu),2);Ts(fa),fa.__change=()=>th(ji),_(lu);var fc=m(lu,2),cu=m(y(fc),2);Ts(cu),cu.__change=()=>th(ji),_(fc),_(Vr);var Sa=m(Vr,2),vl=y(Sa),pc=m(y(vl),2);Ts(pc),pc.__change=()=>th(ji),_(vl),_(Sa);var ya=m(Sa,2),Ur=y(ya),Wl=m(y(Ur),2),pa=y(Wl);pa.__click=zo=>{const oi=zo.currentTarget.getBoundingClientRect();b(Jd,H({x:oi.left,y:oi.bottom+5})),b(xl,H(ji)),b(kd,!0)};var Bi=m(pa,2);Bi.__change=()=>th(ji);var wc=y(Bi);wc.value=(wc.__value=1)==null?"":1;var nr=m(wc);nr.value=(nr.__value=2)==null?"":2;var Ca=m(nr);Ca.value=(Ca.__value=3)==null?"":3;var Cl=m(Ca);Cl.value=(Cl.__value=4)==null?"":4;var Qa=m(Cl);Qa.value=(Qa.__value=5)==null?"":5,_(Bi);var el=m(Bi,2);el.__change=()=>th(ji);var Zi=y(el);Zi.value=(Zi.__value="solid")==null?"":"solid";var Ki=m(Zi);Ki.value=(Ki.__value="dashed")==null?"":"dashed";var Ii=m(Ki);Ii.value=(Ii.__value="dotted")==null?"":"dotted",_(el),_(Wl),_(Ur),_(ya);var Zo=m(ya,2),ha=y(Zo),al=m(y(ha),2),Pi=y(al);Pi.__click=zo=>{const oi=zo.currentTarget.getBoundingClientRect();b(Jd,H({x:oi.left,y:oi.bottom+5})),b(xl,H(ji)),b(Zd,!0)};var Ar=m(Pi,2);Ar.__change=()=>th(ji);var ia=y(Ar);ia.value=(ia.__value=1)==null?"":1;var ma=m(ia);ma.value=(ma.__value=2)==null?"":2;var jr=m(ma);jr.value=(jr.__value=3)==null?"":3;var Ha=m(jr);Ha.value=(Ha.__value=4)==null?"":4;var ll=m(Ha);ll.value=(ll.__value=5)==null?"":5,_(Ar);var li=m(Ar,2);li.__change=()=>th(ji);var wr=y(li);wr.value=(wr.__value="solid")==null?"":"solid";var Qr=m(wr);Qr.value=(Qr.__value="dashed")==null?"":"dashed";var ea=m(Qr);ea.value=(ea.__value="dotted")==null?"":"dotted",_(li),_(al),_(ha),_(Zo);var ja=m(Zo,2),Ia=m(y(ja),2),Li=m(y(Ia),2);Li.__click=zo=>{const oi=zo.currentTarget.getBoundingClientRect();b(Jd,H({x:oi.left,y:oi.bottom+5})),b(xl,H(ji)),b(gc,!0)},_(Ia);var Tr=m(Ia,2),Il=m(y(Tr),2);Il.__click=zo=>{const oi=zo.currentTarget.getBoundingClientRect();b(Jd,H({x:oi.left,y:oi.bottom+5})),b(xl,H(ji)),b(jf,!0)},_(Tr);var va=m(Tr,2),gr=m(y(va),2);gr.__click=zo=>{const oi=zo.currentTarget.getBoundingClientRect();b(Jd,H({x:oi.left,y:oi.bottom+5})),b(xl,H(ji)),b(Nf,!0)},_(va),_(ja),_(Jl),we(()=>{Dt(pa,"style",`background-color: ${i(Wo).styles.duty.color??""}`),Dt(Pi,"style",`background-color: ${i(Wo).styles.dLine.color??""}`),Dt(Li,"style",`background-color: ${(i(Wo).styles.overboughtColor||"#EF4444")??""}`),Dt(Il,"style",`background-color: ${(i(Wo).styles.oversoldColor||"#10B981")??""}`),Dt(gr,"style",`background-color: ${(i(Wo).styles.midLineColor||"#6B7280")??""}`)}),Fn(Bc,()=>i(Wo).kPeriod,zo=>i(Wo).kPeriod=zo),Fn(xc,()=>i(Wo).dPeriod,zo=>i(Wo).dPeriod=zo),Fn(fa,()=>i(Wo).overboughtLevel,zo=>i(Wo).overboughtLevel=zo),Fn(cu,()=>i(Wo).oversoldLevel,zo=>i(Wo).oversoldLevel=zo),Fn(pc,()=>i(Wo).midLevel,zo=>i(Wo).midLevel=zo),co(Bi,()=>i(Wo).styles.duty.thickness,zo=>i(Wo).styles.duty.thickness=zo),co(el,()=>i(Wo).styles.duty.lineStyle,zo=>i(Wo).styles.duty.lineStyle=zo),co(Ar,()=>i(Wo).styles.dLine.thickness,zo=>i(Wo).styles.dLine.thickness=zo),co(li,()=>i(Wo).styles.dLine.lineStyle,zo=>i(Wo).styles.dLine.lineStyle=zo),Y(Wa,Jl)});var Rr=m(Pd,2),Ul=y(Rr);Ul.__click=Dm,_(Rr),_(Ou),Y(Rd,Ou)},Rd=>{var Ou=Qs(),Pd=_s(Ou);Ve(Pd,()=>i(ge),Rr=>{var Ul=AW(),Wa=y(Ul);qo(Wa,17,()=>i($l),yi,(Jl,zr,dc)=>{var Jc=NW(),Vr=y(Jc),ml=y(Vr);ml.textContent=`DMI ${dc+1}`;var Bc=m(ml,2);Ve(Bc,()=>i($l).length>1,or=>{var Hi=MW();Hi.__click=[PW,nd,zr],Y(or,Hi)}),_(Vr);var Ja=m(Vr,2),xc=y(Ja),lu=m(y(xc),2);Ts(lu),lu.__input=xu,_(xc);var fa=m(xc,2),fc=m(y(fa),2);Ts(fc),fc.__input=xu,_(fa),_(Ja);var cu=m(Ja,2),Sa=y(cu),vl=m(y(Sa),2),pc=Lt(()=>Kt(dc,"diPlus"));vl.__click=function(...or){var Hi;(Hi=i(pc))==null||Hi.apply(this,or)};var ya=y(vl);_(vl);var Ur=m(vl,2);Ur.__change=xu;var Wl=y(Ur);Wl.value=(Wl.__value=1)==null?"":1;var pa=m(Wl);pa.value=(pa.__value=2)==null?"":2;var Bi=m(pa);Bi.value=(Bi.__value=3)==null?"":3;var wc=m(Bi);wc.value=(wc.__value=4)==null?"":4;var nr=m(wc);nr.value=(nr.__value=5)==null?"":5,_(Ur);var Ca=m(Ur,2);Ca.__change=xu;var Cl=y(Ca);Cl.value=(Cl.__value="solid")==null?"":"solid";var Qa=m(Cl);Qa.value=(Qa.__value="dashed")==null?"":"dashed";var el=m(Qa);el.value=(el.__value="dotted")==null?"":"dotted",_(Ca),_(Sa);var Zi=m(Sa,2),Ki=m(y(Zi),2),Ii=Lt(()=>Kt(dc,"diMinus"));Ki.__click=function(...or){var Hi;(Hi=i(Ii))==null||Hi.apply(this,or)};var Zo=y(Ki);_(Ki);var ha=m(Ki,2);ha.__change=xu;var al=y(ha);al.value=(al.__value=1)==null?"":1;var Pi=m(al);Pi.value=(Pi.__value=2)==null?"":2;var Ar=m(Pi);Ar.value=(Ar.__value=3)==null?"":3;var ia=m(Ar);ia.value=(ia.__value=4)==null?"":4;var ma=m(ia);ma.value=(ma.__value=5)==null?"":5,_(ha);var jr=m(ha,2);jr.__change=xu;var Ha=y(jr);Ha.value=(Ha.__value="solid")==null?"":"solid";var ll=m(Ha);ll.value=(ll.__value="dashed")==null?"":"dashed";var li=m(ll);li.value=(li.__value="dotted")==null?"":"dotted",_(jr),_(Zi);var wr=m(Zi,2),Qr=m(y(wr),2),ea=Lt(()=>Kt(dc,"adx"));Qr.__click=function(...or){var Hi;(Hi=i(ea))==null||Hi.apply(this,or)};var ja=y(Qr);_(Qr);var Ia=m(Qr,2);Ia.__change=xu;var Li=y(Ia);Li.value=(Li.__value=1)==null?"":1;var Tr=m(Li);Tr.value=(Tr.__value=2)==null?"":2;var Il=m(Tr);Il.value=(Il.__value=3)==null?"":3;var va=m(Il);va.value=(va.__value=4)==null?"":4;var gr=m(va);gr.value=(gr.__value=5)==null?"":5,_(Ia);var zo=m(Ia,2);zo.__change=xu;var oi=y(zo);oi.value=(oi.__value="solid")==null?"":"solid";var Lr=m(oi);Lr.value=(Lr.__value="dashed")==null?"":"dashed";var kr=m(Lr);kr.value=(kr.__value="dotted")==null?"":"dotted",_(zo),_(wr),_(cu),_(Jc),we(()=>{Dt(ya,"style",`background-color: ${i(zr).styles.diPlus.color??""}`),Dt(Zo,"style",`background-color: ${i(zr).styles.diMinus.color??""}`),Dt(ja,"style",`background-color: ${i(zr).styles.adx.color??""}`)}),Fn(lu,()=>i(zr).diPeriod,or=>i(zr).diPeriod=or),Fn(fc,()=>i(zr).adxPeriod,or=>i(zr).adxPeriod=or),co(Ur,()=>i(zr).styles.diPlus.thickness,or=>i(zr).styles.diPlus.thickness=or),co(Ca,()=>i(zr).styles.diPlus.lineStyle,or=>i(zr).styles.diPlus.lineStyle=or),co(ha,()=>i(zr).styles.diMinus.thickness,or=>i(zr).styles.diMinus.thickness=or),co(jr,()=>i(zr).styles.diMinus.lineStyle,or=>i(zr).styles.diMinus.lineStyle=or),co(Ia,()=>i(zr).styles.adx.thickness,or=>i(zr).styles.adx.thickness=or),co(zo,()=>i(zr).styles.adx.lineStyle,or=>i(zr).styles.adx.lineStyle=or),Y(Jl,Jc)});var Wo=m(Wa,2),ji=y(Wo);ji.__click=[aW,ge,$l,xu],_(Wo),_(Ul),Y(Rr,Ul)},Rr=>{var Ul=Qs(),Wa=_s(Ul);Ve(Wa,()=>i(yu),Wo=>{var ji=EW(),Jl=y(ji);qo(Jl,17,()=>i(sd),yi,(Jc,Vr,ml)=>{var Bc=LW(),Ja=y(Bc),xc=y(Ja);xc.textContent=`Williams %R ${ml+1}`;var lu=m(xc,2);Ve(lu,()=>i(sd).length>1,cs=>{var Ms=FW();Ms.__click=[TW,Uv,Vr],Y(cs,Ms)}),_(Ja);var fa=m(Ja,2),fc=y(fa),cu=m(y(fc),2);Ts(cu),cu.__change=()=>Zf(ml),_(fc);var Sa=m(fc,2),vl=m(y(Sa),2);Ts(vl),vl.__change=()=>Zf(ml),_(Sa);var pc=m(Sa,2),ya=m(y(pc),2);Ts(ya),ya.__change=()=>Zf(ml),_(pc);var Ur=m(pc,2),Wl=m(y(Ur),2);Ts(Wl),Wl.__change=()=>Zf(ml),_(Ur),_(fa);var pa=m(fa,2),Bi=y(pa),wc=m(y(Bi),2),nr=Lt(()=>Nn(ml));wc.__click=function(...cs){var Ms;(Ms=i(nr))==null||Ms.apply(this,cs)};var Ca=y(wc);_(wc);var Cl=m(wc,2);Cl.__change=()=>Zf(ml);var Qa=y(Cl);Qa.value=(Qa.__value=1)==null?"":1;var el=m(Qa);el.value=(el.__value=2)==null?"":2;var Zi=m(el);Zi.value=(Zi.__value=3)==null?"":3;var Ki=m(Zi);Ki.value=(Ki.__value=4)==null?"":4;var Ii=m(Ki);Ii.value=(Ii.__value=5)==null?"":5,_(Cl);var Zo=m(Cl,2);Zo.__change=()=>Zf(ml);var ha=y(Zo);ha.value=(ha.__value="solid")==null?"":"solid";var al=m(ha);al.value=(al.__value="dashed")==null?"":"dashed";var Pi=m(al);Pi.value=(Pi.__value="dotted")==null?"":"dotted",_(Zo),_(Bi),_(pa);var Ar=m(pa,2),ia=m(y(Ar),2),ma=m(y(ia),2),jr=Lt(()=>js(ml));ma.__click=function(...cs){var Ms;(Ms=i(jr))==null||Ms.apply(this,cs)};var Ha=y(ma);_(ma);var ll=m(ma,2);ll.__change=()=>Zf(ml);var li=y(ll);li.value=(li.__value=1)==null?"":1;var wr=m(li);wr.value=(wr.__value=2)==null?"":2;var Qr=m(wr);Qr.value=(Qr.__value=3)==null?"":3;var ea=m(Qr);ea.value=(ea.__value=4)==null?"":4;var ja=m(ea);ja.value=(ja.__value=5)==null?"":5,_(ll);var Ia=m(ll,2);Ia.__change=()=>Zf(ml);var Li=y(Ia);Li.value=(Li.__value="solid")==null?"":"solid";var Tr=m(Li);Tr.value=(Tr.__value="dashed")==null?"":"dashed";var Il=m(Tr);Il.value=(Il.__value="dotted")==null?"":"dotted",_(Ia),_(ia);var va=m(ia,2),gr=m(y(va),2),zo=Lt(()=>Os(ml));gr.__click=function(...cs){var Ms;(Ms=i(zo))==null||Ms.apply(this,cs)};var oi=y(gr);_(gr);var Lr=m(gr,2);Lr.__change=()=>Zf(ml);var kr=y(Lr);kr.value=(kr.__value=1)==null?"":1;var or=m(kr);or.value=(or.__value=2)==null?"":2;var Hi=m(or);Hi.value=(Hi.__value=3)==null?"":3;var cl=m(Hi);cl.value=(cl.__value=4)==null?"":4;var Ho=m(cl);Ho.value=(Ho.__value=5)==null?"":5,_(Lr);var qa=m(Lr,2);qa.__change=()=>Zf(ml);var Fr=y(qa);Fr.value=(Fr.__value="solid")==null?"":"solid";var Mi=m(Fr);Mi.value=(Mi.__value="dashed")==null?"":"dashed";var Ll=m(Mi);Ll.value=(Ll.__value="dotted")==null?"":"dotted",_(qa),_(va);var K=m(va,2),ht=m(y(K),2),qe=Lt(()=>qt(ml));ht.__click=function(...cs){var Ms;(Ms=i(qe))==null||Ms.apply(this,cs)};var Vt=y(ht);_(ht);var Ye=m(ht,2);Ye.__change=()=>Zf(ml);var Ps=y(Ye);Ps.value=(Ps.__value=1)==null?"":1;var vs=m(Ps);vs.value=(vs.__value=2)==null?"":2;var ps=m(vs);ps.value=(ps.__value=3)==null?"":3;var as=m(ps);as.value=(as.__value=4)==null?"":4;var Zt=m(as);Zt.value=(Zt.__value=5)==null?"":5,_(Ye);var ct=m(Ye,2);ct.__change=()=>Zf(ml);var Ut=y(ct);Ut.value=(Ut.__value="solid")==null?"":"solid";var hs=m(Ut);hs.value=(hs.__value="dashed")==null?"":"dashed";var Is=m(hs);Is.value=(Is.__value="dotted")==null?"":"dotted",_(ct),_(K),_(Ar),_(Bc),we(()=>{Dt(Ca,"style",`background-color: ${i(Vr).styles.wr.color??""}`),Dt(Ha,"style",`background-color: ${i(Vr).styles.overbought.color??""}`),Dt(oi,"style",`background-color: ${i(Vr).styles.middleLine.color??""}`),Dt(Vt,"style",`background-color: ${i(Vr).styles.oversold.color??""}`)}),Fn(cu,()=>i(Vr).period,cs=>i(Vr).period=cs),Fn(vl,()=>i(Vr).overboughtLevel,cs=>i(Vr).overboughtLevel=cs),Fn(ya,()=>i(Vr).middleLevel,cs=>i(Vr).middleLevel=cs),Fn(Wl,()=>i(Vr).oversoldLevel,cs=>i(Vr).oversoldLevel=cs),co(Cl,()=>i(Vr).styles.wr.thickness,cs=>i(Vr).styles.wr.thickness=cs),co(Zo,()=>i(Vr).styles.wr.lineStyle,cs=>i(Vr).styles.wr.lineStyle=cs),co(ll,()=>i(Vr).styles.overbought.thickness,cs=>i(Vr).styles.overbought.thickness=cs),co(Ia,()=>i(Vr).styles.overbought.lineStyle,cs=>i(Vr).styles.overbought.lineStyle=cs),co(Lr,()=>i(Vr).styles.middleLine.thickness,cs=>i(Vr).styles.middleLine.thickness=cs),co(qa,()=>i(Vr).styles.middleLine.lineStyle,cs=>i(Vr).styles.middleLine.lineStyle=cs),co(Ye,()=>i(Vr).styles.oversold.thickness,cs=>i(Vr).styles.oversold.thickness=cs),co(ct,()=>i(Vr).styles.oversold.lineStyle,cs=>i(Vr).styles.oversold.lineStyle=cs),Y(Jc,Bc)});var zr=m(Jl,2),dc=y(zr);dc.__click=qh,_(zr),_(ji),Y(Wo,ji)},Wo=>{var ji=Qs(),Jl=_s(ji);Ve(Jl,()=>i(Yf),zr=>{var dc=RW(),Jc=y(dc);qo(Jc,17,()=>i(of),yi,(Bc,Ja,xc)=>{var lu=DW(),fa=y(lu),fc=y(fa);fc.textContent=`VR ${xc+1}`;var cu=m(fc,2);Ve(cu,()=>i(of).length>1,Ut=>{var hs=$W();hs.__click=()=>ee(xc),Y(Ut,hs)}),_(fa);var Sa=m(fa,2),vl=y(Sa),pc=m(y(vl),2);Ts(pc),_(vl);var ya=m(vl,2),Ur=m(y(ya),2);Ts(Ur),_(ya);var Wl=m(ya,2),pa=m(y(Wl),2);Ts(pa),_(Wl),_(Sa);var Bi=m(Sa,2),wc=m(y(Bi),2),nr=y(wc),Ca=m(y(nr),2),Cl=Lt(()=>zs(xc,"vr"));Ca.__click=function(...Ut){var hs;(hs=i(Cl))==null||hs.apply(this,Ut)};var Qa=y(Ca);_(Ca),_(nr);var el=m(nr,2),Zi=m(y(el),2);Zi.__change=()=>$e(xc);var Ki=y(Zi);Ki.value=(Ki.__value=1)==null?"":1;var Ii=m(Ki);Ii.value=(Ii.__value=2)==null?"":2;var Zo=m(Ii);Zo.value=(Zo.__value=3)==null?"":3;var ha=m(Zo);ha.value=(ha.__value=4)==null?"":4;var al=m(ha);al.value=(al.__value=5)==null?"":5,_(Zi),_(el);var Pi=m(el,2),Ar=m(y(Pi),2);Ar.__change=()=>$e(xc);var ia=y(Ar);ia.value=(ia.__value="solid")==null?"":"solid";var ma=m(ia);ma.value=(ma.__value="dashed")==null?"":"dashed";var jr=m(ma);jr.value=(jr.__value="dotted")==null?"":"dotted",_(Ar),_(Pi),_(wc),_(Bi);var Ha=m(Bi,2),ll=m(y(Ha),2),li=y(ll),wr=m(y(li),2),Qr=Lt(()=>zs(xc,"vrShort"));wr.__click=function(...Ut){var hs;(hs=i(Qr))==null||hs.apply(this,Ut)};var ea=y(wr);_(wr),_(li);var ja=m(li,2),Ia=m(y(ja),2);Ia.__change=()=>$e(xc);var Li=y(Ia);Li.value=(Li.__value=1)==null?"":1;var Tr=m(Li);Tr.value=(Tr.__value=2)==null?"":2;var Il=m(Tr);Il.value=(Il.__value=3)==null?"":3;var va=m(Il);va.value=(va.__value=4)==null?"":4;var gr=m(va);gr.value=(gr.__value=5)==null?"":5,_(Ia),_(ja);var zo=m(ja,2),oi=m(y(zo),2);oi.__change=()=>$e(xc);var Lr=y(oi);Lr.value=(Lr.__value="solid")==null?"":"solid";var kr=m(Lr);kr.value=(kr.__value="dashed")==null?"":"dashed";var or=m(kr);or.value=(or.__value="dotted")==null?"":"dotted",_(oi),_(zo),_(ll),_(Ha);var Hi=m(Ha,2),cl=m(y(Hi),2),Ho=y(cl),qa=m(y(Ho),2),Fr=Lt(()=>zs(xc,"vrLong"));qa.__click=function(...Ut){var hs;(hs=i(Fr))==null||hs.apply(this,Ut)};var Mi=y(qa);_(qa),_(Ho);var Ll=m(Ho,2),K=m(y(Ll),2);K.__change=()=>$e(xc);var ht=y(K);ht.value=(ht.__value=1)==null?"":1;var qe=m(ht);qe.value=(qe.__value=2)==null?"":2;var Vt=m(qe);Vt.value=(Vt.__value=3)==null?"":3;var Ye=m(Vt);Ye.value=(Ye.__value=4)==null?"":4;var Ps=m(Ye);Ps.value=(Ps.__value=5)==null?"":5,_(K),_(Ll);var vs=m(Ll,2),ps=m(y(vs),2);ps.__change=()=>$e(xc);var as=y(ps);as.value=(as.__value="solid")==null?"":"solid";var Zt=m(as);Zt.value=(Zt.__value="dashed")==null?"":"dashed";var ct=m(Zt);ct.value=(ct.__value="dotted")==null?"":"dotted",_(ps),_(vs),_(cl),_(Hi),_(lu),we(()=>{Dt(Qa,"style",`background-color: ${i(Ja).styles.vr.color??""}`),Dt(ea,"style",`background-color: ${i(Ja).styles.vrShort.color??""}`),Dt(Mi,"style",`background-color: ${i(Ja).styles.vrLong.color??""}`)}),Fn(pc,()=>i(Ja).period,Ut=>i(Ja).period=Ut),Fn(Ur,()=>i(Ja).shortPeriod,Ut=>i(Ja).shortPeriod=Ut),Fn(pa,()=>i(Ja).longPeriod,Ut=>i(Ja).longPeriod=Ut),co(Zi,()=>i(Ja).styles.vr.thickness,Ut=>i(Ja).styles.vr.thickness=Ut),co(Ar,()=>i(Ja).styles.vr.lineStyle,Ut=>i(Ja).styles.vr.lineStyle=Ut),co(Ia,()=>i(Ja).styles.vrShort.thickness,Ut=>i(Ja).styles.vrShort.thickness=Ut),co(oi,()=>i(Ja).styles.vrShort.lineStyle,Ut=>i(Ja).styles.vrShort.lineStyle=Ut),co(K,()=>i(Ja).styles.vrLong.thickness,Ut=>i(Ja).styles.vrLong.thickness=Ut),co(ps,()=>i(Ja).styles.vrLong.lineStyle,Ut=>i(Ja).styles.vrLong.lineStyle=Ut),Y(Bc,lu)});var Vr=m(Jc,2),ml=y(Vr);ml.__click=d0,_(Vr),_(dc),Y(zr,dc)},zr=>{var dc=Qs(),Jc=_s(dc);Ve(Jc,()=>i(Ga),Vr=>{var ml=zW(),Bc=y(ml);qo(Bc,17,()=>i(Qd),yi,(lu,fa,fc)=>{var cu=OW(),Sa=y(cu),vl=y(Sa);vl.textContent=`BBI ${fc+1}`;var pc=m(vl,2);Ve(pc,()=>i(Qd).length>1,Qr=>{var ea=BW();ea.__click=[jW,$o,fa],Y(Qr,ea)}),_(Sa);var ya=m(Sa,2),Ur=y(ya),Wl=m(y(Ur),2);Ts(Wl),Wl.__change=()=>Gt(fc),_(Ur);var pa=m(Ur,2),Bi=m(y(pa),2);Ts(Bi),Bi.__change=()=>Gt(fc),_(pa);var wc=m(pa,2),nr=m(y(wc),2);Ts(nr),nr.__change=()=>Gt(fc),_(wc);var Ca=m(wc,2),Cl=m(y(Ca),2);Ts(Cl),Cl.__change=()=>Gt(fc),_(Ca),_(ya);var Qa=m(ya,2),el=y(Qa),Zi=m(y(el),2),Ki=Lt(()=>on(fc));Zi.__click=function(...Qr){var ea;(ea=i(Ki))==null||ea.apply(this,Qr)};var Ii=y(Zi);_(Zi),_(el);var Zo=m(el,2),ha=m(y(Zo),2);ha.__change=()=>Gt(fc);var al=y(ha);al.value=(al.__value=1)==null?"":1;var Pi=m(al);Pi.value=(Pi.__value=2)==null?"":2;var Ar=m(Pi);Ar.value=(Ar.__value=3)==null?"":3;var ia=m(Ar);ia.value=(ia.__value=4)==null?"":4;var ma=m(ia);ma.value=(ma.__value=5)==null?"":5,_(ha),_(Zo);var jr=m(Zo,2),Ha=m(y(jr),2);Ha.__change=()=>Gt(fc);var ll=y(Ha);ll.value=(ll.__value="solid")==null?"":"solid";var li=m(ll);li.value=(li.__value="dashed")==null?"":"dashed";var wr=m(li);wr.value=(wr.__value="dotted")==null?"":"dotted",_(Ha),_(jr),_(Qa),_(cu),we(()=>Dt(Ii,"style",`background-color: ${i(fa).color??""}`)),Fn(Wl,()=>i(fa).period1,Qr=>i(fa).period1=Qr),Fn(Bi,()=>i(fa).period2,Qr=>i(fa).period2=Qr),Fn(nr,()=>i(fa).period3,Qr=>i(fa).period3=Qr),Fn(Cl,()=>i(fa).period4,Qr=>i(fa).period4=Qr),co(ha,()=>i(fa).thickness,Qr=>i(fa).thickness=Qr),co(Ha,()=>i(fa).lineStyle,Qr=>i(fa).lineStyle=Qr),Y(lu,cu)});var Ja=m(Bc,2),xc=y(Ja);xc.__click=mi,_(Ja),_(ml),Y(Vr,ml)},Vr=>{var ml=Qs(),Bc=_s(ml);Ve(Bc,()=>i(G),Ja=>{var xc=qW(),lu=y(xc);qo(lu,17,()=>i(Pr),yi,(cu,Sa)=>{var vl=HW(),pc=y(vl),ya=y(pc),Ur=y(ya,!0);_(ya);var Wl=m(ya,2);Ve(Wl,()=>i(Pr).length>1,li=>{var wr=WW();wr.__click=[VW,mm,Sa],Y(li,wr)}),_(pc);var pa=m(pc,2),Bi=y(pa),wc=m(y(Bi),2);Ts(wc),_(Bi);var nr=m(Bi,2),Ca=m(y(nr),2);Ts(Ca),_(nr),_(pa);var Cl=m(pa,2),Qa=y(Cl),el=m(y(Qa),2);el.__click=[uW,Ne,se];var Zi=y(el);_(el),_(Qa);var Ki=m(Qa,2),Ii=m(y(Ki),2),Zo=y(Ii);Zo.value=(Zo.__value=1)==null?"":1;var ha=m(Zo);ha.value=(ha.__value=2)==null?"":2;var al=m(ha);al.value=(al.__value=3)==null?"":3;var Pi=m(al);Pi.value=(Pi.__value=4)==null?"":4;var Ar=m(Pi);Ar.value=(Ar.__value=5)==null?"":5,_(Ii),_(Ki);var ia=m(Ki,2),ma=m(y(ia),2),jr=y(ma);jr.value=(jr.__value="solid")==null?"":"solid";var Ha=m(jr);Ha.value=(Ha.__value="dashed")==null?"":"dashed";var ll=m(Ha);ll.value=(ll.__value="dotted")==null?"":"dotted",_(ma),_(ia),_(Cl),_(vl),we(()=>{st(Ur,i(Sa).name),Dt(Zi,"style",`background-color: ${i(Sa).color??""}`)}),Fn(wc,()=>i(Sa).period,li=>i(Sa).period=li),Fn(Ca,()=>i(Sa).period2,li=>i(Sa).period2=li),co(Ii,()=>i(Sa).thickness,li=>i(Sa).thickness=li),co(ma,()=>i(Sa).lineStyle,li=>i(Sa).lineStyle=li),Y(cu,vl)});var fa=m(lu,2),fc=y(fa);fc.__click=[tW,G,Pr],_(fa),_(xc),Y(Ja,xc)},Ja=>{var xc=Qs(),lu=_s(xc);Ve(lu,()=>i(ye),fa=>{var fc=KW(),cu=y(fc);qo(cu,17,()=>i(Or),yi,(pc,ya,Ur)=>{var Wl=YW(),pa=y(Wl),Bi=y(pa),wc=y(Bi,!0);_(Bi);var nr=m(Bi,2);Ve(nr,()=>i(Or).length>1,ea=>{var ja=GW();ja.__click=[UW,Rm,ya],Y(ea,ja)}),_(pa);var Ca=m(pa,2),Cl=y(Ca),Qa=m(y(Cl),2);Ts(Qa),Qa.__input=Hh,_(Cl),_(Ca);var el=m(Ca,2),Zi=y(el),Ki=m(y(Zi),2),Ii=Lt(()=>Us(Ur));Ki.__click=function(...ea){var ja;(ja=i(Ii))==null||ja.apply(this,ea)};var Zo=y(Ki);_(Ki),_(Zi);var ha=m(Zi,2),al=m(y(ha),2);al.__change=Hh;var Pi=y(al);Pi.value=(Pi.__value=1)==null?"":1;var Ar=m(Pi);Ar.value=(Ar.__value=2)==null?"":2;var ia=m(Ar);ia.value=(ia.__value=3)==null?"":3;var ma=m(ia);ma.value=(ma.__value=4)==null?"":4;var jr=m(ma);jr.value=(jr.__value=5)==null?"":5,_(al),_(ha);var Ha=m(ha,2),ll=m(y(Ha),2);ll.__change=Hh;var li=y(ll);li.value=(li.__value="solid")==null?"":"solid";var wr=m(li);wr.value=(wr.__value="dashed")==null?"":"dashed";var Qr=m(wr);Qr.value=(Qr.__value="dotted")==null?"":"dotted",_(ll),_(Ha),_(el),_(Wl),we(()=>{st(wc,i(ya).name),Dt(Zo,"style",`background-color: ${i(ya).color??""}`)}),Fn(Qa,()=>i(ya).period,ea=>i(ya).period=ea),co(al,()=>i(ya).thickness,ea=>i(ya).thickness=ea),co(ll,()=>i(ya).lineStyle,ea=>i(ya).lineStyle=ea),Y(pc,Wl)});var Sa=m(cu,2),vl=y(Sa);vl.__click=[sW,ye,Or,Hh],_(Sa),_(fc),Y(fa,fc)},fa=>{var fc=Qs(),cu=_s(fc);Ve(cu,()=>i($u),Sa=>{var vl=JW(),pc=y(vl);qo(pc,17,()=>i(Iu),yi,(Wl,pa,Bi)=>{var wc=ZW(),nr=y(wc),Ca=y(nr);Ca.textContent=Bi===0?"Awesome Oscillator":`AO ${Bi+1}`;var Cl=m(Ca,2);Cl.__click=[XW,At,pa],_(nr);var Qa=m(nr,2),el=y(Qa),Zi=m(y(el),2);Ts(Zi),Zi.__input=He,_(el);var Ki=m(el,2),Ii=m(y(Ki),2);Ts(Ii),Ii.__input=He,_(Ki),_(Qa);var Zo=m(Qa,2),ha=m(y(Zo),2),al=y(ha),Pi=m(y(al),2),Ar=y(Pi),ia=m(Ar,2),ma=Lt(()=>qs(Bi*3));ia.__click=function(...gr){var zo;(zo=i(ma))==null||zo.apply(this,gr)};var jr=y(ia);_(ia),_(Pi),_(al);var Ha=m(al,2),ll=m(y(Ha),2),li=y(ll),wr=m(li,2),Qr=Lt(()=>qs(Bi*3+1));wr.__click=function(...gr){var zo;(zo=i(Qr))==null||zo.apply(this,gr)};var ea=y(wr);_(wr),_(ll),_(Ha);var ja=m(Ha,2),Ia=m(y(ja),2),Li=y(Ia),Tr=m(Li,2),Il=Lt(()=>qs(Bi*3+2));Tr.__click=function(...gr){var zo;(zo=i(Il))==null||zo.apply(this,gr)};var va=y(Tr);_(Tr),_(Ia),_(ja),_(ha),_(Zo),_(wc),we(()=>{Dt(Ar,"style",`background-color: ${i(pa).styles.increasing.color??""}`),Dt(jr,"style",`background-color: ${i(pa).styles.increasing.color??""}`),Dt(li,"style",`background-color: ${i(pa).styles.decreasing.color??""}`),Dt(ea,"style",`background-color: ${i(pa).styles.decreasing.color??""}`),Dt(Li,"style",`background-color: ${i(pa).styles.reverse.color??""}`),Dt(va,"style",`background-color: ${i(pa).styles.reverse.color??""}`)}),Fn(Zi,()=>i(pa).shortPeriod,gr=>i(pa).shortPeriod=gr),Fn(Ii,()=>i(pa).longPeriod,gr=>i(pa).longPeriod=gr),Y(Wl,wc)});var ya=m(pc,2),Ur=y(ya);Ur.__click=[cW,$u,Iu,He],_(ya),_(vl),Y(Sa,vl)},Sa=>{var vl=Qs(),pc=_s(vl);Ve(pc,()=>i(Q),ya=>{var Ur=sH(),Wl=y(Ur);qo(Wl,17,()=>i($r),yi,(wc,nr,Ca)=>{var Cl=tH(),Qa=y(Cl),el=y(Qa);el.textContent=`CR ${Ca+1}`;var Zi=m(el,2);Ve(Zi,()=>i($r).length>1,Wr=>{var Au=eH();Au.__click=[QW,Jf,nr],Y(Wr,Au)}),_(Qa);var Ki=m(Qa,2),Ii=y(Ki),Zo=m(y(Ii),2);Ts(Zo),Zo.__input=Dd,_(Ii);var ha=m(Ii,2),al=m(y(ha),2);Ts(al),al.__input=Dd,_(ha);var Pi=m(ha,2),Ar=m(y(Pi),2);Ts(Ar),Ar.__input=Dd,_(Pi);var ia=m(Pi,2),ma=m(y(ia),2);Ts(ma),ma.__input=Dd,_(ia);var jr=m(ia,2),Ha=m(y(jr),2);Ts(Ha),Ha.__input=Dd,_(jr),_(Ki);var ll=m(Ki,2),li=y(ll),wr=m(y(li),2),Qr=Lt(()=>es(Ca,"cr"));wr.__click=function(...Wr){var Au;(Au=i(Qr))==null||Au.apply(this,Wr)};var ea=y(wr);_(wr);var ja=m(wr,2);ja.__change=Dd;var Ia=y(ja);Ia.value=(Ia.__value=1)==null?"":1;var Li=m(Ia);Li.value=(Li.__value=2)==null?"":2;var Tr=m(Li);Tr.value=(Tr.__value=3)==null?"":3;var Il=m(Tr);Il.value=(Il.__value=4)==null?"":4;var va=m(Il);va.value=(va.__value=5)==null?"":5,_(ja);var gr=m(ja,2);gr.__change=Dd;var zo=y(gr);zo.value=(zo.__value="solid")==null?"":"solid";var oi=m(zo);oi.value=(oi.__value="dashed")==null?"":"dashed";var Lr=m(oi);Lr.value=(Lr.__value="dotted")==null?"":"dotted",_(gr),_(li);var kr=m(li,2),or=m(y(kr),2),Hi=Lt(()=>es(Ca,"ma1"));or.__click=function(...Wr){var Au;(Au=i(Hi))==null||Au.apply(this,Wr)};var cl=y(or);_(or);var Ho=m(or,2);Ho.__change=Dd;var qa=y(Ho);qa.value=(qa.__value=1)==null?"":1;var Fr=m(qa);Fr.value=(Fr.__value=2)==null?"":2;var Mi=m(Fr);Mi.value=(Mi.__value=3)==null?"":3;var Ll=m(Mi);Ll.value=(Ll.__value=4)==null?"":4;var K=m(Ll);K.value=(K.__value=5)==null?"":5,_(Ho);var ht=m(Ho,2);ht.__change=Dd;var qe=y(ht);qe.value=(qe.__value="solid")==null?"":"solid";var Vt=m(qe);Vt.value=(Vt.__value="dashed")==null?"":"dashed";var Ye=m(Vt);Ye.value=(Ye.__value="dotted")==null?"":"dotted",_(ht),_(kr);var Ps=m(kr,2),vs=m(y(Ps),2),ps=Lt(()=>es(Ca,"ma2"));vs.__click=function(...Wr){var Au;(Au=i(ps))==null||Au.apply(this,Wr)};var as=y(vs);_(vs);var Zt=m(vs,2);Zt.__change=Dd;var ct=y(Zt);ct.value=(ct.__value=1)==null?"":1;var Ut=m(ct);Ut.value=(Ut.__value=2)==null?"":2;var hs=m(Ut);hs.value=(hs.__value=3)==null?"":3;var Is=m(hs);Is.value=(Is.__value=4)==null?"":4;var cs=m(Is);cs.value=(cs.__value=5)==null?"":5,_(Zt);var Ms=m(Zt,2);Ms.__change=Dd;var us=y(Ms);us.value=(us.__value="solid")==null?"":"solid";var ds=m(us);ds.value=(ds.__value="dashed")==null?"":"dashed";var os=m(ds);os.value=(os.__value="dotted")==null?"":"dotted",_(Ms),_(Ps);var In=m(Ps,2),Lo=m(y(In),2),_n=Lt(()=>es(Ca,"ma3"));Lo.__click=function(...Wr){var Au;(Au=i(_n))==null||Au.apply(this,Wr)};var sn=y(Lo);_(Lo);var Ao=m(Lo,2);Ao.__change=Dd;var Qo=y(Ao);Qo.value=(Qo.__value=1)==null?"":1;var wi=m(Qo);wi.value=(wi.__value=2)==null?"":2;var Do=m(wi);Do.value=(Do.__value=3)==null?"":3;var ir=m(Do);ir.value=(ir.__value=4)==null?"":4;var Io=m(ir);Io.value=(Io.__value=5)==null?"":5,_(Ao);var Bn=m(Ao,2);Bn.__change=Dd;var gi=y(Bn);gi.value=(gi.__value="solid")==null?"":"solid";var wo=m(gi);wo.value=(wo.__value="dashed")==null?"":"dashed";var Ei=m(wo);Ei.value=(Ei.__value="dotted")==null?"":"dotted",_(Bn),_(In);var Ba=m(In,2),Ta=m(y(Ba),2),Ji=Lt(()=>es(Ca,"ma4"));Ta.__click=function(...Wr){var Au;(Au=i(Ji))==null||Au.apply(this,Wr)};var Nu=y(Ta);_(Ta);var Pa=m(Ta,2);Pa.__change=Dd;var zu=y(Pa);zu.value=(zu.__value=1)==null?"":1;var Md=m(zu);Md.value=(Md.__value=2)==null?"":2;var ta=m(Md);ta.value=(ta.__value=3)==null?"":3;var uf=m(ta);uf.value=(uf.__value=4)==null?"":4;var Ku=m(uf);Ku.value=(Ku.__value=5)==null?"":5,_(Pa);var pu=m(Pa,2);pu.__change=Dd;var kc=y(pu);kc.value=(kc.__value="solid")==null?"":"solid";var Xu=m(kc);Xu.value=(Xu.__value="dashed")==null?"":"dashed";var Nd=m(Xu);Nd.value=(Nd.__value="dotted")==null?"":"dotted",_(pu),_(Ba),_(ll),_(Cl),we(()=>{Dt(ea,"style",`background-color: ${i(nr).styles.cr.color??""}`),Dt(cl,"style",`background-color: ${i(nr).styles.ma1.color??""}`),Dt(as,"style",`background-color: ${i(nr).styles.ma2.color??""}`),Dt(sn,"style",`background-color: ${i(nr).styles.ma3.color??""}`),Dt(Nu,"style",`background-color: ${i(nr).styles.ma4.color??""}`)}),Fn(Zo,()=>i(nr).crPeriod,Wr=>i(nr).crPeriod=Wr),Fn(al,()=>i(nr).crMa1Period,Wr=>i(nr).crMa1Period=Wr),Fn(Ar,()=>i(nr).crMa2Period,Wr=>i(nr).crMa2Period=Wr),Fn(ma,()=>i(nr).crMa3Period,Wr=>i(nr).crMa3Period=Wr),Fn(Ha,()=>i(nr).crMa4Period,Wr=>i(nr).crMa4Period=Wr),co(ja,()=>i(nr).styles.cr.thickness,Wr=>i(nr).styles.cr.thickness=Wr),co(gr,()=>i(nr).styles.cr.lineStyle,Wr=>i(nr).styles.cr.lineStyle=Wr),co(Ho,()=>i(nr).styles.ma1.thickness,Wr=>i(nr).styles.ma1.thickness=Wr),co(ht,()=>i(nr).styles.ma1.lineStyle,Wr=>i(nr).styles.ma1.lineStyle=Wr),co(Zt,()=>i(nr).styles.ma2.thickness,Wr=>i(nr).styles.ma2.thickness=Wr),co(Ms,()=>i(nr).styles.ma2.lineStyle,Wr=>i(nr).styles.ma2.lineStyle=Wr),co(Ao,()=>i(nr).styles.ma3.thickness,Wr=>i(nr).styles.ma3.thickness=Wr),co(Bn,()=>i(nr).styles.ma3.lineStyle,Wr=>i(nr).styles.ma3.lineStyle=Wr),co(Pa,()=>i(nr).styles.ma4.thickness,Wr=>i(nr).styles.ma4.thickness=Wr),co(pu,()=>i(nr).styles.ma4.lineStyle,Wr=>i(nr).styles.ma4.lineStyle=Wr),Y(wc,Cl)});var pa=m(Wl,2),Bi=y(pa);Bi.__click=[lW,Q,$r,Dd],_(pa),_(Ur),Y(ya,Ur)},ya=>{var Ur=Qs(),Wl=_s(Ur);Ve(Wl,()=>i(Bt),pa=>{var Bi=oH(),wc=y(Bi);qo(wc,17,()=>i(Ks),yi,(Cl,Qa,el)=>{var Zi=nH(),Ki=y(Zi),Ii=y(Ki);Ii.textContent=`ZigZag ${el+1}`,_(Ki);var Zo=m(Ki,2),ha=y(Zo),al=m(y(ha),2);Ts(al),al.__input=As,_(ha);var Pi=m(ha,2),Ar=m(y(Pi),2);Ts(Ar),Ar.__input=As,_(Pi),_(Zo);var ia=m(Zo,2),ma=m(y(ia),2),jr=y(ma),Ha=m(y(jr),2),ll=y(Ha),li=m(ll,2);li.__click=()=>xn(el);var wr=y(li);_(li),_(Ha),_(jr);var Qr=m(jr,2),ea=m(y(Qr),2);ea.__change=As;var ja=y(ea);ja.value=(ja.__value=1)==null?"":1;var Ia=m(ja);Ia.value=(Ia.__value=2)==null?"":2;var Li=m(Ia);Li.value=(Li.__value=3)==null?"":3;var Tr=m(Li);Tr.value=(Tr.__value=4)==null?"":4;var Il=m(Tr);Il.value=(Il.__value=5)==null?"":5,_(ea),_(Qr);var va=m(Qr,2),gr=m(y(va),2);gr.__change=As;var zo=y(gr);zo.value=(zo.__value="solid")==null?"":"solid";var oi=m(zo);oi.value=(oi.__value="dashed")==null?"":"dashed";var Lr=m(oi);Lr.value=(Lr.__value="dotted")==null?"":"dotted",_(gr),_(va),_(ma),_(ia),_(Zi),we(()=>{Dt(ll,"style",`background-color: ${i(Qa).styles.color??""}`),Dt(wr,"style",`background-color: ${i(Qa).styles.color??""}`)}),Fn(al,()=>i(Qa).deviation,kr=>i(Qa).deviation=kr),Fn(Ar,()=>i(Qa).depth,kr=>i(Qa).depth=kr),co(ea,()=>i(Qa).styles.thickness,kr=>i(Qa).styles.thickness=kr),co(gr,()=>i(Qa).styles.lineStyle,kr=>i(Qa).styles.lineStyle=kr),Y(Cl,Zi)});var nr=m(wc,2),Ca=y(nr);Ca.__click=[ZV,Ks,As],_(nr),_(Bi),Y(pa,Bi)},pa=>{var Bi=Qs(),wc=_s(Bi);Ve(wc,()=>i(Ld),nr=>{var Ca=aH(),Cl=y(Ca);qo(Cl,17,()=>i(Pu),yi,(Zi,Ki,Ii)=>{var Zo=rH(),ha=y(Zo),al=y(ha),Pi=y(al);we(()=>st(Pi,`${i(Ki).name??""} (ID: ${i(Ki).id.slice(0,8)??""})`)),_(al);var Ar=m(al,2);Ve(Ar,()=>i(Pu).length>1,oi=>{var Lr=iH();Lr.__click=()=>$d(Ii),Y(oi,Lr)}),_(ha);var ia=m(ha,2),ma=y(ia),jr=m(y(ma),2),Ha=Lt(()=>ro(Ii));jr.__click=function(...oi){var Lr;(Lr=i(Ha))==null||Lr.apply(this,oi)};var ll=y(jr);_(jr),_(ma);var li=m(ma,2),wr=m(y(li),2);wr.__change=oi=>{oi.target&&(i(Ki).thickness=parseInt(oi.target.value),vp(Ii))};var Qr=y(wr);Qr.value=(Qr.__value=1)==null?"":1;var ea=m(Qr);ea.value=(ea.__value=2)==null?"":2;var ja=m(ea);ja.value=(ja.__value=3)==null?"":3;var Ia=m(ja);Ia.value=(Ia.__value=4)==null?"":4;var Li=m(Ia);Li.value=(Li.__value=5)==null?"":5,_(wr),_(li);var Tr=m(li,2),Il=m(y(Tr),2);Il.__change=oi=>{oi.target&&(i(Ki).lineStyle=oi.target.value,vp(Ii))};var va=y(Il);va.value=(va.__value="solid")==null?"":"solid";var gr=m(va);gr.value=(gr.__value="dashed")==null?"":"dashed";var zo=m(gr);zo.value=(zo.__value="dotted")==null?"":"dotted",_(Il),_(Tr),_(ia),_(Zo),we(()=>Dt(ll,"style",`background-color: ${i(Ki).color??""}`)),co(wr,()=>i(Ki).thickness,oi=>i(Ki).thickness=oi),co(Il,()=>i(Ki).lineStyle,oi=>i(Ki).lineStyle=oi),Y(Zi,Zo)});var Qa=m(Cl,2),el=y(Qa);el.__click=kf,_(Qa),_(Ca),Y(nr,Ca)},nr=>{var Ca=Qs(),Cl=_s(Ca);Ve(Cl,()=>i(Ie),Qa=>{var el=dH(),Zi=y(el);qo(Zi,17,()=>i(cc),yi,(Zo,ha,al)=>{var Pi=uH(),Ar=y(Pi),ia=y(Ar);ia.textContent=`SAR ${al+1}`;var ma=m(ia,2);Ve(ma,()=>i(cc).length>1,Hi=>{var cl=cH();cl.__click=[lH,lf,ha],Y(Hi,cl)}),_(Ar);var jr=m(Ar,2),Ha=y(jr),ll=m(y(Ha),2);Ts(ll),_(Ha);var li=m(Ha,2),wr=m(y(li),2);Ts(wr),_(li);var Qr=m(li,2),ea=m(y(Qr),2);Ts(ea),_(Qr),_(jr);var ja=m(jr,2),Ia=y(ja),Li=m(y(Ia),2),Tr=Lt(()=>ys(al));Li.__click=function(...Hi){var cl;(cl=i(Tr))==null||cl.apply(this,Hi)};var Il=y(Li);_(Li),_(Ia);var va=m(Ia,2),gr=m(y(va),2),zo=y(gr);zo.value=(zo.__value=1)==null?"":1;var oi=m(zo);oi.value=(oi.__value=2)==null?"":2;var Lr=m(oi);Lr.value=(Lr.__value=3)==null?"":3;var kr=m(Lr);kr.value=(kr.__value=4)==null?"":4;var or=m(kr);or.value=(or.__value=5)==null?"":5,_(gr),_(va),_(ja),_(Pi),we(()=>Dt(Il,"style",`background-color: ${i(ha).color??""}`)),Fn(ll,()=>i(ha).start,Hi=>i(ha).start=Hi),Fn(wr,()=>i(ha).increment,Hi=>i(ha).increment=Hi),Fn(ea,()=>i(ha).maxValue,Hi=>i(ha).maxValue=Hi),co(gr,()=>i(ha).dotSize,Hi=>i(ha).dotSize=Hi),Y(Zo,Pi)});var Ki=m(Zi,2),Ii=y(Ki);Ii.__click=[iW,Ie,cc,Hn],_(Ki),_(el),Y(Qa,el)},Qa=>{var el=Qs(),Zi=_s(el);Ve(Zi,()=>i(dt),Ki=>{var Ii=mH(),Zo=y(Ii);qo(Zo,17,()=>i(bu),yi,(Pi,Ar,ia)=>{var ma=hH(),jr=y(ma),Ha=y(jr);Ha.textContent=`Smart Trend ${ia+1}`;var ll=m(Ha,2);Ve(ll,()=>i(bu).length>1,us=>{var ds=pH();ds.__click=[fH,pi,Ar],Y(us,ds)}),_(jr);var li=m(jr,2),wr=y(li),Qr=m(y(wr),2);Ts(Qr),Qr.__change=()=>ur(ia),_(wr);var ea=m(wr,2),ja=m(y(ea),2);Ts(ja),ja.__change=()=>ur(ia),_(ea),_(li);var Ia=m(li,2),Li=y(Ia);Ts(Li),Li.__change=()=>ur(ia),Oi(2),_(Ia);var Tr=m(Ia,2),Il=m(y(Tr),2),va=y(Il),gr=m(y(va),2);gr.__click=()=>{b(zi,!0),b(mu,H(ia)),b(Gc,"uptrend")};var zo=y(gr);_(gr),_(va);var oi=m(va,2),Lr=m(y(oi),2);Lr.__change=()=>ur(ia);var kr=y(Lr);kr.value=(kr.__value=1)==null?"":1;var or=m(kr);or.value=(or.__value=2)==null?"":2;var Hi=m(or);Hi.value=(Hi.__value=3)==null?"":3;var cl=m(Hi);cl.value=(cl.__value=4)==null?"":4;var Ho=m(cl);Ho.value=(Ho.__value=5)==null?"":5,_(Lr),_(oi);var qa=m(oi,2),Fr=m(y(qa),2);Fr.__change=()=>ur(ia);var Mi=y(Fr);Mi.value=(Mi.__value="solid")==null?"":"solid";var Ll=m(Mi);Ll.value=(Ll.__value="dashed")==null?"":"dashed",_(Fr),_(qa),_(Il),_(Tr);var K=m(Tr,2),ht=m(y(K),2),qe=y(ht),Vt=m(y(qe),2);Vt.__click=()=>{b(zi,!0),b(mu,H(ia)),b(Gc,"downtrend")};var Ye=y(Vt);_(Vt),_(qe);var Ps=m(qe,2),vs=m(y(Ps),2);vs.__change=()=>ur(ia);var ps=y(vs);ps.value=(ps.__value=1)==null?"":1;var as=m(ps);as.value=(as.__value=2)==null?"":2;var Zt=m(as);Zt.value=(Zt.__value=3)==null?"":3;var ct=m(Zt);ct.value=(ct.__value=4)==null?"":4;var Ut=m(ct);Ut.value=(Ut.__value=5)==null?"":5,_(vs),_(Ps);var hs=m(Ps,2),Is=m(y(hs),2);Is.__change=()=>ur(ia);var cs=y(Is);cs.value=(cs.__value="solid")==null?"":"solid";var Ms=m(cs);Ms.value=(Ms.__value="dashed")==null?"":"dashed",_(Is),_(hs),_(ht),_(K),_(ma),we(()=>{Dt(zo,"style",`background-color: ${i(Ar).styles.uptrend.color??""}`),Dt(Ye,"style",`background-color: ${i(Ar).styles.downtrend.color??""}`)}),Fn(Qr,()=>i(Ar).period,us=>i(Ar).period=us),Fn(ja,()=>i(Ar).multiplier,us=>i(Ar).multiplier=us),Wv(Li,()=>i(Ar).showLabels,us=>i(Ar).showLabels=us),co(Lr,()=>i(Ar).styles.uptrend.thickness,us=>i(Ar).styles.uptrend.thickness=us),co(Fr,()=>i(Ar).styles.uptrend.lineStyle,us=>i(Ar).styles.uptrend.lineStyle=us),co(vs,()=>i(Ar).styles.downtrend.thickness,us=>i(Ar).styles.downtrend.thickness=us),co(Is,()=>i(Ar).styles.downtrend.lineStyle,us=>i(Ar).styles.downtrend.lineStyle=us),Y(Pi,ma)});var ha=m(Zo,2),al=y(ha);al.__click=[rW,dt,bu,Mc],_(ha),_(Ii),Y(Ki,Ii)},Ki=>{var Ii=Qs(),Zo=_s(Ii);Ve(Zo,()=>i(nf),ha=>{var al=SH(),Pi=y(al);qo(Pi,17,()=>d,yi,(ia,ma,jr)=>{var Ha=wH(),ll=y(Ha),li=y(ll),wr=y(li,!0);_(li);var Qr=m(li,2),ea=y(Qr);Ts(ea),ea.__change=[vH,Nt];var ja=m(ea,2);Ve(ja,()=>u.length>1,Li=>{var Tr=gH();Tr.__click=()=>Dr(jr),Y(Li,Tr)},Li=>{var Tr=_H();Y(Li,Tr)}),_(Qr),_(ll);var Ia=m(ll,2);Ve(Ia,()=>h[jr],Li=>{var Tr=xH(),Il=y(Tr),va=m(y(Il),2),gr=Lt(()=>is(jr));va.__click=function(...ht){var qe;(qe=i(gr))==null||qe.apply(this,ht)};var zo=y(va);_(va),_(Il);var oi=m(Il,2),Lr=m(y(oi),2);Lr.__change=[yH,Nt];var kr=y(Lr);kr.value=(kr.__value=1)==null?"":1;var or=m(kr);or.value=(or.__value=2)==null?"":2;var Hi=m(or);Hi.value=(Hi.__value=3)==null?"":3;var cl=m(Hi);cl.value=(cl.__value=4)==null?"":4;var Ho=m(cl);Ho.value=(Ho.__value=5)==null?"":5,_(Lr),_(oi);var qa=m(oi,2),Fr=m(y(qa),2);Fr.__change=[bH,Nt];var Mi=y(Fr);Mi.value=(Mi.__value="solid")==null?"":"solid";var Ll=m(Mi);Ll.value=(Ll.__value="dashed")==null?"":"dashed";var K=m(Ll);K.value=(K.__value="dotted")==null?"":"dotted",_(Fr),_(qa),_(Tr),we(()=>Dt(zo,"style",`background-color: ${h[jr].color??""}`)),co(Lr,()=>h[jr].thickness,ht=>h[jr].thickness=ht),co(Fr,()=>h[jr].lineStyle,ht=>h[jr].lineStyle=ht),Y(Li,Tr)}),_(Ha),we(()=>st(wr,i(ma).title)),Fn(ea,()=>u[jr],Li=>u[jr]=Li),Y(ia,Ha)});var Ar=m(Pi,2);Ve(Ar,()=>d.length<10,ia=>{var ma=kH(),jr=y(ma);jr.__click=[gy,ad,fu,ni,$u,Xo,yu,sr,Re,Sl,d,u,h,wp,Cs,nf,Nt],_(ma),Y(ia,ma)}),_(al),Y(ha,al)},ha=>{var al=Qs(),Pi=_s(al);Ve(Pi,()=>i(Sd),Ar=>{var ia=PH(),ma=y(ia);qo(ma,17,()=>i(Si),yi,(ll,li,wr)=>{var Qr=IH(),ea=y(Qr),ja=y(ea),Ia=y(ja);_(ja);var Li=m(ja,2);Ve(Li,()=>i(Si).length>1,qe=>{var Vt=CH();Vt.__click=()=>ho(wr),Y(qe,Vt)}),_(ea);var Tr=m(ea,2),Il=m(y(Tr),2);Ts(Il),Il.__change=()=>Xs(wr),_(Tr);var va=m(Tr,2),gr=y(va),zo=m(y(gr),2);zo.__click=qe=>{b(rc,H(wr));const Vt=qe.currentTarget.getBoundingClientRect();b(vc,H({x:Vt.left+Vt.width/2,y:Vt.bottom+5})),b(ca,!0)};var oi=y(zo);_(zo),_(gr);var Lr=m(gr,2),kr=m(y(Lr),2);kr.__change=()=>Xs(wr);var or=y(kr);or.value=(or.__value=1)==null?"":1;var Hi=m(or);Hi.value=(Hi.__value=2)==null?"":2;var cl=m(Hi);cl.value=(cl.__value=3)==null?"":3;var Ho=m(cl);Ho.value=(Ho.__value=4)==null?"":4;var qa=m(Ho);qa.value=(qa.__value=5)==null?"":5,_(kr),_(Lr);var Fr=m(Lr,2),Mi=m(y(Fr),2);Mi.__change=()=>Xs(wr);var Ll=y(Mi);Ll.value=(Ll.__value="solid")==null?"":"solid";var K=m(Ll);K.value=(K.__value="dashed")==null?"":"dashed";var ht=m(K);ht.value=(ht.__value="dotted")==null?"":"dotted",_(Mi),_(Fr),_(va),_(Qr),we(()=>{st(Ia,`SMA (${i(li).period??""})`),Dt(oi,"style",`background-color: ${i(li).color??""}`)}),Fn(Il,()=>i(li).period,qe=>i(li).period=qe),co(kr,()=>i(li).thickness,qe=>i(li).thickness=qe),co(Mi,()=>i(li).lineStyle,qe=>i(li).lineStyle=qe),Y(ll,Qr)});var jr=m(ma,2),Ha=y(jr);Ha.__click=Xn,_(jr),_(ia),Y(Ar,ia)},Ar=>{var ia=Qs(),ma=_s(ia);Ve(ma,()=>i(Cu),jr=>{var Ha=TH();qo(Ha,21,()=>i(zt),yi,(ll,li,wr)=>{var Qr=AH(),ea=y(Qr),ja=y(ea);ja.textContent=`Volume ${wr+1}`;var Ia=m(ja,2);Ve(Ia,()=>i(zt).length>1,us=>{var ds=MH();ds.__click=()=>oe(wr),Y(us,ds)},us=>{var ds=NH();Y(us,ds)}),_(ea);var Li=m(ea,2),Tr=y(Li),Il=m(y(Tr),2);Ts(Il),Il.__change=()=>at(wr),_(Tr),_(Li);var va=m(Li,2),gr=m(y(va),2),zo=y(gr),oi=m(y(zo),2),Lr=Lt(()=>pn(wr,"histogram"));oi.__click=function(...us){var ds;(ds=i(Lr))==null||ds.apply(this,us)};var kr=y(oi);_(oi),_(zo);var or=m(zo,2),Hi=m(y(or),2),cl=Lt(()=>pn(wr,"histogram-down"));Hi.__click=function(...us){var ds;(ds=i(cl))==null||ds.apply(this,us)};var Ho=y(Hi);_(Hi),_(or),_(gr),_(va);var qa=m(va,2),Fr=m(y(qa),2),Mi=y(Fr);Ts(Mi),Mi.__change=()=>at(wr),Oi(2),_(Fr);var Ll=m(Fr,2),K=y(Ll),ht=m(y(K),2),qe=Lt(()=>pn(wr,"ema"));ht.__click=function(...us){var ds;(ds=i(qe))==null||ds.apply(this,us)};var Vt=y(ht);_(ht),_(K);var Ye=m(K,2),Ps=m(y(Ye),2);Ps.__change=()=>at(wr);var vs=y(Ps);vs.value=(vs.__value=1)==null?"":1;var ps=m(vs);ps.value=(ps.__value=2)==null?"":2;var as=m(ps);as.value=(as.__value=3)==null?"":3;var Zt=m(as);Zt.value=(Zt.__value=4)==null?"":4;var ct=m(Zt);ct.value=(ct.__value=5)==null?"":5,_(Ps),_(Ye);var Ut=m(Ye,2),hs=m(y(Ut),2);hs.__change=()=>at(wr);var Is=y(hs);Is.value=(Is.__value="solid")==null?"":"solid";var cs=m(Is);cs.value=(cs.__value="dashed")==null?"":"dashed";var Ms=m(cs);Ms.value=(Ms.__value="dotted")==null?"":"dotted",_(hs),_(Ut),_(Ll),_(qa),_(Qr),we(()=>{Dt(kr,"style",`background-color: ${i(li).styles.histogram.upColor??""}`),Dt(Ho,"style",`background-color: ${i(li).styles.histogram.downColor??""}`),Dt(Vt,"style",`background-color: ${i(li).styles.ema.color??""}`)}),Fn(Il,()=>i(li).period,us=>i(li).period=us),Wv(Mi,()=>i(li).styles.ema.visible,us=>i(li).styles.ema.visible=us),co(Ps,()=>i(li).styles.ema.thickness,us=>i(li).styles.ema.thickness=us),co(hs,()=>i(li).styles.ema.lineStyle,us=>i(li).styles.ema.lineStyle=us),Y(ll,Qr)}),_(Ha),Y(jr,Ha)},jr=>{var Ha=Qs(),ll=_s(Ha);Ve(ll,()=>i(Re),li=>{var wr=$H(),Qr=y(wr);qo(Qr,17,()=>i(nu),yi,(Ia,Li,Tr)=>{var Il=LH(),va=y(Il),gr=y(va),zo=y(gr,!0);_(gr);var oi=m(gr,2);Ve(oi,()=>i(nu).length>1,wo=>{var Ei=FH();Ei.__click=()=>il(Tr),Y(wo,Ei)}),_(va);var Lr=m(va,2),kr=y(Lr),or=m(y(kr),2);Ts(or),or.__input=()=>Ff(Tr),_(kr);var Hi=m(kr,2),cl=m(y(Hi),2);Ts(cl),cl.__input=()=>Ff(Tr),_(Hi),_(Lr);var Ho=m(Lr,2),qa=y(Ho),Fr=m(y(qa),2);_(qa);var Mi=m(qa,2),Ll=y(Mi),K=m(y(Ll),2);Ts(K),K.__input=()=>Ff(Tr),_(Ll);var ht=m(Ll,2),qe=m(y(ht),2);qe.__change=()=>Ff(Tr);var Vt=y(qe);Vt.value=(Vt.__value=1)==null?"":1;var Ye=m(Vt);Ye.value=(Ye.__value=2)==null?"":2;var Ps=m(Ye);Ps.value=(Ps.__value=3)==null?"":3;var vs=m(Ps);vs.value=(vs.__value=4)==null?"":4;var ps=m(vs);ps.value=(ps.__value=5)==null?"":5,_(qe),_(ht);var as=m(ht,2),Zt=m(y(as),2);Zt.__change=()=>Ff(Tr);var ct=y(Zt);ct.value=(ct.__value="solid")==null?"":"solid";var Ut=m(ct);Ut.value=(Ut.__value="dashed")==null?"":"dashed";var hs=m(Ut);hs.value=(hs.__value="dotted")==null?"":"dotted",_(Zt),_(as),_(Mi),_(Ho);var Is=m(Ho,2),cs=y(Is),Ms=m(y(cs),2);_(cs);var us=m(cs,2),ds=y(us),os=m(y(ds),2);Ts(os),os.__input=()=>Ff(Tr),_(ds);var In=m(ds,2),Lo=m(y(In),2);Lo.__change=()=>Ff(Tr);var _n=y(Lo);_n.value=(_n.__value=1)==null?"":1;var sn=m(_n);sn.value=(sn.__value=2)==null?"":2;var Ao=m(sn);Ao.value=(Ao.__value=3)==null?"":3;var Qo=m(Ao);Qo.value=(Qo.__value=4)==null?"":4;var wi=m(Qo);wi.value=(wi.__value=5)==null?"":5,_(Lo),_(In);var Do=m(In,2),ir=m(y(Do),2);ir.__change=()=>Ff(Tr);var Io=y(ir);Io.value=(Io.__value="solid")==null?"":"solid";var Bn=m(Io);Bn.value=(Bn.__value="dashed")==null?"":"dashed";var gi=m(Bn);gi.value=(gi.__value="dotted")==null?"":"dotted",_(ir),_(Do),_(us),_(Is),_(Il),we(()=>{st(zo,i(Li).name),Dt(Fr,"style",`background-color: ${i(Li).styles.trix.color??""}`),Dt(Ms,"style",`background-color: ${i(Li).styles.signal.color??""}`)}),Fn(or,()=>i(Li).trixPeriod,wo=>i(Li).trixPeriod=wo),Fn(cl,()=>i(Li).signalPeriod,wo=>i(Li).signalPeriod=wo),Fn(K,()=>i(Li).styles.trix.color,wo=>i(Li).styles.trix.color=wo),co(qe,()=>i(Li).styles.trix.thickness,wo=>i(Li).styles.trix.thickness=wo),co(Zt,()=>i(Li).styles.trix.lineStyle,wo=>i(Li).styles.trix.lineStyle=wo),Fn(os,()=>i(Li).styles.signal.color,wo=>i(Li).styles.signal.color=wo),co(Lo,()=>i(Li).styles.signal.thickness,wo=>i(Li).styles.signal.thickness=wo),co(ir,()=>i(Li).styles.signal.lineStyle,wo=>i(Li).styles.signal.lineStyle=wo),Y(Ia,Il)});var ea=m(Qr,2),ja=y(ea);ja.__click=[EH,Fl],_(ea),_(wr),Y(li,wr)},li=>{var wr=Qs(),Qr=_s(wr);Ve(Qr,()=>i(fu),ea=>{var ja=BH(),Ia=y(ja);qo(Ia,17,()=>i(oo),yi,(Il,va,gr)=>{var zo=jH(),oi=y(zo),Lr=y(oi);Lr.textContent=`BIAS ${gr+1}`;var kr=m(Lr,2);Ve(kr,()=>i(oo).length>1,ct=>{var Ut=RH();Ut.__click=[DH,ru,va],Y(ct,Ut)}),_(oi);var or=m(oi,2),Hi=m(y(or),2);Ts(Hi),Hi.__input=Kl,_(or);var cl=m(or,2),Ho=y(cl),qa=m(y(Ho),2),Fr=Lt(()=>Js(gr));qa.__click=function(...ct){var Ut;(Ut=i(Fr))==null||Ut.apply(this,ct)};var Mi=y(qa);_(qa),_(Ho);var Ll=m(Ho,2),K=m(y(Ll),2);K.__change=Kl;var ht=y(K);ht.value=(ht.__value=1)==null?"":1;var qe=m(ht);qe.value=(qe.__value=2)==null?"":2;var Vt=m(qe);Vt.value=(Vt.__value=3)==null?"":3;var Ye=m(Vt);Ye.value=(Ye.__value=4)==null?"":4,_(K),_(Ll);var Ps=m(Ll,2),vs=m(y(Ps),2);vs.__change=Kl;var ps=y(vs);ps.value=(ps.__value="solid")==null?"":"solid";var as=m(ps);as.value=(as.__value="dashed")==null?"":"dashed";var Zt=m(as);Zt.value=(Zt.__value="dotted")==null?"":"dotted",_(vs),_(Ps),_(cl),_(zo),we(()=>Dt(Mi,"style",`background-color: ${i(va).color??""}`)),Fn(Hi,()=>i(va).period,ct=>i(va).period=ct),co(K,()=>i(va).thickness,ct=>i(va).thickness=ct),co(vs,()=>i(va).lineStyle,ct=>i(va).lineStyle=ct),Y(Il,zo)});var Li=m(Ia,2),Tr=y(Li);Tr.__click=[nW,fu,oo,Kl],_(Li),_(ja),Y(ea,ja)},ea=>{var ja=Qs(),Ia=_s(ja);Ve(Ia,()=>i(ce),Li=>{var Tr=WH(),Il=y(Tr);qo(Il,17,()=>i(uo),yi,(zo,oi,Lr)=>{var kr=VH(),or=y(kr),Hi=y(or);Hi.textContent=`CCI ${Lr+1}`;var cl=m(Hi,2);Ve(cl,()=>i(uo).length>1,Is=>{var cs=zH();cs.__click=[OH,af,oi],Y(Is,cs)}),_(or);var Ho=m(or,2),qa=m(y(Ho),2);Ts(qa),qa.__input=nc,_(Ho);var Fr=m(Ho,2),Mi=y(Fr),Ll=m(y(Mi),2),K=Lt(()=>$s(Lr));Ll.__click=function(...Is){var cs;(cs=i(K))==null||cs.apply(this,Is)};var ht=y(Ll);_(Ll),_(Mi);var qe=m(Mi,2),Vt=m(y(qe),2);Vt.__change=nc;var Ye=y(Vt);Ye.value=(Ye.__value=1)==null?"":1;var Ps=m(Ye);Ps.value=(Ps.__value=2)==null?"":2;var vs=m(Ps);vs.value=(vs.__value=3)==null?"":3;var ps=m(vs);ps.value=(ps.__value=4)==null?"":4,_(Vt),_(qe);var as=m(qe,2),Zt=m(y(as),2);Zt.__change=nc;var ct=y(Zt);ct.value=(ct.__value="solid")==null?"":"solid";var Ut=m(ct);Ut.value=(Ut.__value="dashed")==null?"":"dashed";var hs=m(Ut);hs.value=(hs.__value="dotted")==null?"":"dotted",_(Zt),_(as),_(Fr),_(kr),we(()=>Dt(ht,"style",`background-color: ${i(oi).color??""}`)),Fn(qa,()=>i(oi).period,Is=>i(oi).period=Is),co(Vt,()=>i(oi).thickness,Is=>i(oi).thickness=Is),co(Zt,()=>i(oi).lineStyle,Is=>i(oi).lineStyle=Is),Y(zo,kr)});var va=m(Il,2),gr=y(va);gr.__click=[oW,ce,uo,nc],_(va),_(Tr),Y(Li,Tr)},Li=>{var Tr=Qs(),Il=_s(Tr);Ve(Il,()=>i(ac),va=>{var gr=GH(),zo=y(gr),oi=m(y(zo),2);qo(oi,21,()=>i(vf),yi,(or,Hi,cl)=>{var Ho=UH(),qa=y(Ho),Fr=y(qa),Mi=y(Fr,!0);_(Fr);var Ll=m(Fr,2);Ve(Ll,()=>i(vf).length>1,ht=>{var qe=HH();qe.__click=()=>V(cl),Y(ht,qe)}),_(qa);var K=m(qa,4);qo(K,17,()=>d,yi,(ht,qe,Vt)=>{var Ye=qH(),Ps=y(Ye),vs=y(Ps),ps=m(vs,2),as=y(ps,!0);_(ps),_(Ps);var Zt=m(Ps,2),ct=m(y(Zt),2);Ts(ct),ct.__change=()=>M(),_(Zt);var Ut=m(Zt,2),hs=m(y(Ut),2),Is=Lt(()=>Ss(Vt,cl));hs.__click=function(...ir){var Io;(Io=i(Is))==null||Io.apply(this,ir)};var cs=y(hs);_(hs),_(Ut);var Ms=m(Ut,2),us=m(y(Ms),2);us.__change=()=>M();var ds=y(us);ds.value=(ds.__value=1)==null?"":1;var os=m(ds);os.value=(os.__value=2)==null?"":2;var In=m(os);In.value=(In.__value=3)==null?"":3;var Lo=m(In);Lo.value=(Lo.__value=4)==null?"":4;var _n=m(Lo);_n.value=(_n.__value=5)==null?"":5,_(us),_(Ms);var sn=m(Ms,2),Ao=m(y(sn),2);Ao.__change=()=>M();var Qo=y(Ao);Qo.value=(Qo.__value="solid")==null?"":"solid";var wi=m(Qo);wi.value=(wi.__value="dashed")==null?"":"dashed";var Do=m(wi);Do.value=(Do.__value="dotted")==null?"":"dotted",_(Ao),_(sn),_(Ye),we(()=>{var ir,Io;Dt(vs,"style",`background-color: ${((ir=i(Hi).styles[Vt])==null?void 0:ir.color)??""}`),st(as,i(qe).title),Dt(cs,"style",`background-color: ${((Io=i(Hi).styles[Vt])==null?void 0:Io.color)??""}`)}),Fn(ct,()=>i(Hi).params[Vt],ir=>i(Hi).params[Vt]=ir),co(us,()=>i(Hi).styles[Vt].thickness,ir=>i(Hi).styles[Vt].thickness=ir),co(Ao,()=>i(Hi).styles[Vt].lineStyle,ir=>i(Hi).styles[Vt].lineStyle=ir),Y(ht,Ye)}),_(Ho),we(()=>st(Mi,i(Hi).name)),Y(or,Ho)}),_(oi);var Lr=m(oi,2),kr=y(Lr);kr.__click=Tm,_(Lr),Oi(2),_(zo),_(gr),Y(va,gr)},va=>{var gr=Qs(),zo=_s(gr);Ve(zo,()=>i(Sd),oi=>{var Lr=JH(),kr=y(Lr);qo(kr,17,()=>d,yi,(Hi,cl,Ho)=>{var qa=XH(),Fr=y(qa),Mi=y(Fr),Ll=y(Mi,!0);_(Mi);var K=m(Mi,2),ht=y(K);Ts(ht);var qe=m(ht,2);Ve(qe,()=>u.length>1,Lo=>{var _n=YH();_n.__click=()=>Dr(Ho),Y(Lo,_n)},Lo=>{var _n=KH();Y(Lo,_n)}),_(K),_(Fr);var Vt=m(Fr,2),Ye=y(Vt),Ps=m(y(Ye),2),vs=Lt(()=>ts(Ho));Ps.__click=function(...Lo){var _n;(_n=i(vs))==null||_n.apply(this,Lo)};var ps=y(Ps);_(Ps),_(Ye);var as=m(Ye,2),Zt=m(y(as),2),ct=y(Zt);ct.value=(ct.__value=1)==null?"":1;var Ut=m(ct);Ut.value=(Ut.__value=2)==null?"":2;var hs=m(Ut);hs.value=(hs.__value=3)==null?"":3;var Is=m(hs);Is.value=(Is.__value=4)==null?"":4;var cs=m(Is);cs.value=(cs.__value=5)==null?"":5,_(Zt),_(as);var Ms=m(as,2),us=m(y(Ms),2),ds=y(us);ds.value=(ds.__value="solid")==null?"":"solid";var os=m(ds);os.value=(os.__value="dashed")==null?"":"dashed";var In=m(os);In.value=(In.__value="dotted")==null?"":"dotted",_(us),_(Ms),_(Vt),_(qa),we(()=>{st(Ll,i(cl).title),Dt(ps,"style",`background-color: ${h[Ho].color??""}`)}),Fn(ht,()=>u[Ho],Lo=>u[Ho]=Lo),co(Zt,()=>h[Ho].thickness,Lo=>h[Ho].thickness=Lo),co(us,()=>h[Ho].lineStyle,Lo=>h[Ho].lineStyle=Lo),Y(Hi,qa)});var or=m(kr,2);Ve(or,()=>d.length<10,Hi=>{var cl=ZH(),Ho=y(cl);Ho.__click=[gy,ad,fu,ni,$u,Xo,yu,sr,Re,Sl,d,u,h,wp,Cs,nf,Nt],_(cl),Y(Hi,cl)}),_(Lr),Y(oi,Lr)},oi=>{var Lr=Qs(),kr=_s(Lr);Ve(kr,()=>i(wp),or=>{var Hi=aq(),cl=y(Hi);qo(cl,17,()=>d,yi,(qa,Fr,Mi)=>{var Ll=iq(),K=y(Ll),ht=y(K),qe=y(ht,!0);_(ht);var Vt=m(ht,2),Ye=y(Vt);Ts(Ye),Ye.__change=[QH,Cs];var Ps=m(Ye,2);Ve(Ps,()=>u.length>1,ps=>{var as=eq();as.__click=()=>Dr(Mi),Y(ps,as)},ps=>{var as=tq();Y(ps,as)}),_(Vt),_(K);var vs=m(K,2);Ve(vs,()=>h[Mi],ps=>{var as=oq(),Zt=y(as),ct=m(y(Zt),2),Ut=Lt(()=>ln(Mi));ct.__click=function(...wi){var Do;(Do=i(Ut))==null||Do.apply(this,wi)};var hs=y(ct);_(ct),_(Zt);var Is=m(Zt,2),cs=m(y(Is),2);cs.__change=[sq,Cs];var Ms=y(cs);Ms.value=(Ms.__value=1)==null?"":1;var us=m(Ms);us.value=(us.__value=2)==null?"":2;var ds=m(us);ds.value=(ds.__value=3)==null?"":3;var os=m(ds);os.value=(os.__value=4)==null?"":4;var In=m(os);In.value=(In.__value=5)==null?"":5,_(cs),_(Is);var Lo=m(Is,2),_n=m(y(Lo),2);_n.__change=[nq,Cs];var sn=y(_n);sn.value=(sn.__value="solid")==null?"":"solid";var Ao=m(sn);Ao.value=(Ao.__value="dashed")==null?"":"dashed";var Qo=m(Ao);Qo.value=(Qo.__value="dotted")==null?"":"dotted",_(_n),_(Lo),_(as),we(()=>Dt(hs,"style",`background-color: ${h[Mi].color??""}`)),co(cs,()=>h[Mi].thickness,wi=>h[Mi].thickness=wi),co(_n,()=>h[Mi].lineStyle,wi=>h[Mi].lineStyle=wi),Y(ps,as)}),_(Ll),we(()=>st(qe,i(Fr).title)),Fn(Ye,()=>u[Mi],ps=>u[Mi]=ps),Y(qa,Ll)});var Ho=m(cl,2);Ve(Ho,()=>d.length<10,qa=>{var Fr=rq(),Mi=y(Fr);Mi.__click=[gy,ad,fu,ni,$u,Xo,yu,sr,Re,Sl,d,u,h,wp,Cs,nf,Nt],_(Fr),Y(qa,Fr)}),_(Hi),Y(or,Hi)},or=>{var Hi=Qs(),cl=_s(Hi);Ve(cl,()=>i(vt),Ho=>{var qa=dq(),Fr=y(qa);qo(Fr,17,()=>i($a),yi,(K,ht,qe)=>{var Vt=uq(),Ye=y(Vt),Ps=y(Ye);Ps.textContent=`ROC ${qe+1}`;var vs=m(Ps,2);Ve(vs,()=>i($a).length>1,ir=>{var Io=cq();Io.__click=[lq,_m,ht],Y(ir,Io)}),_(Ye);var ps=m(Ye,2),as=y(ps),Zt=m(y(as),2);Ts(Zt),Zt.__change=()=>wh(qe),_(as);var ct=m(as,2),Ut=y(ct),hs=m(y(Ut),2),Is=Lt(()=>mn(qe));hs.__click=function(...ir){var Io;(Io=i(Is))==null||Io.apply(this,ir)};var cs=y(hs);_(hs),_(Ut);var Ms=m(Ut,2),us=m(y(Ms),2);us.__change=()=>wh(qe);var ds=y(us);ds.value=(ds.__value=1)==null?"":1;var os=m(ds);os.value=(os.__value=2)==null?"":2;var In=m(os);In.value=(In.__value=3)==null?"":3;var Lo=m(In);Lo.value=(Lo.__value=4)==null?"":4;var _n=m(Lo);_n.value=(_n.__value=5)==null?"":5,_(us),_(Ms);var sn=m(Ms,2),Ao=m(y(sn),2);Ao.__change=()=>wh(qe);var Qo=y(Ao);Qo.value=(Qo.__value="solid")==null?"":"solid";var wi=m(Qo);wi.value=(wi.__value="dashed")==null?"":"dashed";var Do=m(wi);Do.value=(Do.__value="dotted")==null?"":"dotted",_(Ao),_(sn),_(ct),_(ps),_(Vt),we(()=>Dt(cs,"style",`background-color: ${i(ht).styles.roc.color??""}`)),Fn(Zt,()=>i(ht).period,ir=>i(ht).period=ir),co(us,()=>i(ht).styles.roc.thickness,ir=>i(ht).styles.roc.thickness=ir),co(Ao,()=>i(ht).styles.roc.lineStyle,ir=>i(ht).styles.roc.lineStyle=ir),Y(K,Vt)});var Mi=m(Fr,2),Ll=y(Mi);Ll.__click=gm,_(Mi),_(qa),Y(Ho,qa)},Ho=>{var qa=Qs(),Fr=_s(qa);Ve(Fr,()=>i(Xt),Mi=>{var Ll=mq(),K=y(Ll);qo(K,17,()=>i(ti),yi,(Vt,Ye,Ps)=>{var vs=hq(),ps=y(vs),as=y(ps);as.textContent=`PSY ${Ps+1}`;var Zt=m(as,2);Ve(Zt,()=>i(ti).length>1,oc=>{var _f=pq();_f.__click=[fq,Ym,Ye],Y(oc,_f)}),_(ps);var ct=m(ps,2),Ut=y(ct),hs=m(y(Ut),2);Ts(hs),hs.__change=()=>Rp(Ps),_(Ut);var Is=m(Ut,2),cs=m(y(Is),2),Ms=y(cs),us=m(y(Ms),2),ds=Lt(()=>un(Ps*2));us.__click=function(...oc){var _f;(_f=i(ds))==null||_f.apply(this,oc)};var os=y(us);_(us),_(Ms);var In=m(Ms,2),Lo=m(y(In),2);Lo.__change=()=>Rp(Ps);var _n=y(Lo);_n.value=(_n.__value=1)==null?"":1;var sn=m(_n);sn.value=(sn.__value=2)==null?"":2;var Ao=m(sn);Ao.value=(Ao.__value=3)==null?"":3;var Qo=m(Ao);Qo.value=(Qo.__value=4)==null?"":4;var wi=m(Qo);wi.value=(wi.__value=5)==null?"":5,_(Lo),_(In);var Do=m(In,2),ir=m(y(Do),2);ir.__change=()=>Rp(Ps);var Io=y(ir);Io.value=(Io.__value="solid")==null?"":"solid";var Bn=m(Io);Bn.value=(Bn.__value="dashed")==null?"":"dashed";var gi=m(Bn);gi.value=(gi.__value="dotted")==null?"":"dotted",_(ir),_(Do),_(cs),_(Is);var wo=m(Is,2),Ei=m(y(wo),2);Ts(Ei),Ei.__change=()=>Rp(Ps),_(wo);var Ba=m(wo,2),Ta=m(y(Ba),2),Ji=y(Ta),Nu=m(y(Ji),2),Pa=Lt(()=>un(Ps*2+1));Nu.__click=function(...oc){var _f;(_f=i(Pa))==null||_f.apply(this,oc)};var zu=y(Nu);_(Nu),_(Ji);var Md=m(Ji,2),ta=m(y(Md),2);ta.__change=()=>Rp(Ps);var uf=y(ta);uf.value=(uf.__value=1)==null?"":1;var Ku=m(uf);Ku.value=(Ku.__value=2)==null?"":2;var pu=m(Ku);pu.value=(pu.__value=3)==null?"":3;var kc=m(pu);kc.value=(kc.__value=4)==null?"":4;var Xu=m(kc);Xu.value=(Xu.__value=5)==null?"":5,_(ta),_(Md);var Nd=m(Md,2),Wr=m(y(Nd),2);Wr.__change=()=>Rp(Ps);var Au=y(Wr);Au.value=(Au.__value="solid")==null?"":"solid";var Tp=m(Au);Tp.value=(Tp.__value="dashed")==null?"":"dashed";var yp=m(Tp);yp.value=(yp.__value="dotted")==null?"":"dotted",_(Wr),_(Nd),_(Ta),_(Ba);var Kp=m(Ba,2),bp=y(Kp);Ts(bp),bp.__change=()=>Rp(Ps);var fh=m(bp,2);_(Kp),_(ct),_(vs),we(()=>{Dt(os,"style",`background-color: ${i(Ye).styles.psy.color??""}`),Dt(zu,"style",`background-color: ${i(Ye).styles.mapsy.color??""}`),Dt(bp,"id",`showMapsy_${i(Ye).id??""}`),Dt(fh,"for",`showMapsy_${i(Ye).id??""}`)}),Fn(hs,()=>i(Ye).psyPeriod,oc=>i(Ye).psyPeriod=oc),co(Lo,()=>i(Ye).styles.psy.thickness,oc=>i(Ye).styles.psy.thickness=oc),co(ir,()=>i(Ye).styles.psy.lineStyle,oc=>i(Ye).styles.psy.lineStyle=oc),Fn(Ei,()=>i(Ye).mapsyPeriod,oc=>i(Ye).mapsyPeriod=oc),co(ta,()=>i(Ye).styles.mapsy.thickness,oc=>i(Ye).styles.mapsy.thickness=oc),co(Wr,()=>i(Ye).styles.mapsy.lineStyle,oc=>i(Ye).styles.mapsy.lineStyle=oc),Wv(bp,()=>i(Ye).showMapsy,oc=>i(Ye).showMapsy=oc),Y(Vt,vs)});var ht=m(K,2),qe=y(ht);qe.__click=Nm,_(ht),_(Ll),Y(Mi,Ll)},Mi=>{var Ll=Qs(),K=_s(Ll);Ve(K,()=>i(W),ht=>{var qe=yq(),Vt=y(qe);qo(Vt,17,()=>i(fi),yi,(vs,ps,as)=>{var Zt=_q(),ct=y(Zt),Ut=y(ct);Ut.textContent=`OBV ${as+1}`;var hs=m(Ut,2);Ve(hs,()=>i(fi).length>1,oc=>{var _f=gq();_f.__click=[vq,im,ps],Y(oc,_f)}),_(ct);var Is=m(ct,2),cs=y(Is),Ms=m(y(cs),2);Ts(Ms),Ms.__input=nh,_(cs);var us=m(cs,2),ds=m(y(us),2),os=y(ds),In=m(y(os),2),Lo=Lt(()=>jn(as*2));In.__click=function(...oc){var _f;(_f=i(Lo))==null||_f.apply(this,oc)};var _n=y(In);_(In),_(os);var sn=m(os,2),Ao=m(y(sn),2);Ao.__change=nh;var Qo=y(Ao);Qo.value=(Qo.__value=1)==null?"":1;var wi=m(Qo);wi.value=(wi.__value=2)==null?"":2;var Do=m(wi);Do.value=(Do.__value=3)==null?"":3;var ir=m(Do);ir.value=(ir.__value=4)==null?"":4;var Io=m(ir);Io.value=(Io.__value=5)==null?"":5,_(Ao),_(sn);var Bn=m(sn,2),gi=m(y(Bn),2);gi.__change=nh;var wo=y(gi);wo.value=(wo.__value="solid")==null?"":"solid";var Ei=m(wo);Ei.value=(Ei.__value="dashed")==null?"":"dashed";var Ba=m(Ei);Ba.value=(Ba.__value="dotted")==null?"":"dotted",_(gi),_(Bn),_(ds),_(us);var Ta=m(us,2),Ji=m(y(Ta),2);Ts(Ji),Ji.__input=nh,Oi(2),_(Ta);var Nu=m(Ta,2),Pa=m(y(Nu),2),zu=y(Pa),Md=m(y(zu),2),ta=Lt(()=>jn(as*2+1));Md.__click=function(...oc){var _f;(_f=i(ta))==null||_f.apply(this,oc)};var uf=y(Md);_(Md),_(zu);var Ku=m(zu,2),pu=m(y(Ku),2);pu.__change=nh;var kc=y(pu);kc.value=(kc.__value=1)==null?"":1;var Xu=m(kc);Xu.value=(Xu.__value=2)==null?"":2;var Nd=m(Xu);Nd.value=(Nd.__value=3)==null?"":3;var Wr=m(Nd);Wr.value=(Wr.__value=4)==null?"":4;var Au=m(Wr);Au.value=(Au.__value=5)==null?"":5,_(pu),_(Ku);var Tp=m(Ku,2),yp=m(y(Tp),2);yp.__change=nh;var Kp=y(yp);Kp.value=(Kp.__value="solid")==null?"":"solid";var bp=m(Kp);bp.value=(bp.__value="dashed")==null?"":"dashed";var fh=m(bp);fh.value=(fh.__value="dotted")==null?"":"dotted",_(yp),_(Tp),_(Pa),_(Nu),_(Is),_(Zt),we(()=>{Dt(_n,"style",`background-color: ${i(ps).styles.obv.color??""}`),Dt(uf,"style",`background-color: ${i(ps).styles.maobv.color??""}`)}),Fn(Ms,()=>i(ps).obvPeriod,oc=>i(ps).obvPeriod=oc),co(Ao,()=>i(ps).styles.obv.thickness,oc=>i(ps).styles.obv.thickness=oc),co(gi,()=>i(ps).styles.obv.lineStyle,oc=>i(ps).styles.obv.lineStyle=oc),Fn(Ji,()=>i(ps).maobvPeriod,oc=>i(ps).maobvPeriod=oc),co(pu,()=>i(ps).styles.maobv.thickness,oc=>i(ps).styles.maobv.thickness=oc),co(yp,()=>i(ps).styles.maobv.lineStyle,oc=>i(ps).styles.maobv.lineStyle=oc),Y(vs,Zt)});var Ye=m(Vt,2),Ps=y(Ye);Ps.__click=Am,_(Ye),_(qe),Y(ht,qe)},ht=>{var qe=Qs(),Vt=_s(qe);Ve(Vt,()=>i(U),Ye=>{var Ps=kq(),vs=y(Ps);qo(vs,17,()=>i(hn),yi,(Zt,ct,Ut)=>{var hs=wq(),Is=y(hs),cs=y(Is);cs.textContent=`KDJ ${Ut+1}`;var Ms=m(cs,2);Ve(Ms,()=>i(hn).length>1,Ud=>{var od=xq();od.__click=[bq,me,ct],Y(Ud,od)}),_(Is);var us=m(Is,2),ds=y(us),os=y(ds),In=m(y(os),2);Ts(In),In.__input=Ud=>{Ud.target&&(console.log("📊 K Period changed to:",Ud.target.value,"for group:",Ut),Cp(Ut))},_(os);var Lo=m(os,2),_n=m(y(Lo),2);Ts(_n),_n.__input=Ud=>{Ud.target&&(console.log("📊 D Period changed to:",Ud.target.value,"for group:",Ut),Cp(Ut))},_(Lo),_(ds);var sn=m(ds,2),Ao=m(y(sn),2),Qo=m(y(Ao),2),wi=Lt(()=>rn(Ut,0));Qo.__click=function(...Ud){var od;(od=i(wi))==null||od.apply(this,Ud)};var Do=y(Qo);_(Qo);var ir=m(Qo,2);ir.__change=()=>Cp(Ut);var Io=y(ir);Io.value=(Io.__value=1)==null?"":1;var Bn=m(Io);Bn.value=(Bn.__value=2)==null?"":2;var gi=m(Bn);gi.value=(gi.__value=3)==null?"":3;var wo=m(gi);wo.value=(wo.__value=4)==null?"":4;var Ei=m(wo);Ei.value=(Ei.__value=5)==null?"":5,_(ir);var Ba=m(ir,2);Ba.__change=()=>Cp(Ut);var Ta=y(Ba);Ta.value=(Ta.__value="solid")==null?"":"solid";var Ji=m(Ta);Ji.value=(Ji.__value="dashed")==null?"":"dashed";var Nu=m(Ji);Nu.value=(Nu.__value="dotted")==null?"":"dotted",_(Ba),_(Ao),_(sn);var Pa=m(sn,2),zu=m(y(Pa),2),Md=m(y(zu),2),ta=Lt(()=>rn(Ut,1));Md.__click=function(...Ud){var od;(od=i(ta))==null||od.apply(this,Ud)};var uf=y(Md);_(Md);var Ku=m(Md,2);Ku.__change=()=>Cp(Ut);var pu=y(Ku);pu.value=(pu.__value=1)==null?"":1;var kc=m(pu);kc.value=(kc.__value=2)==null?"":2;var Xu=m(kc);Xu.value=(Xu.__value=3)==null?"":3;var Nd=m(Xu);Nd.value=(Nd.__value=4)==null?"":4;var Wr=m(Nd);Wr.value=(Wr.__value=5)==null?"":5,_(Ku);var Au=m(Ku,2);Au.__change=()=>Cp(Ut);var Tp=y(Au);Tp.value=(Tp.__value="solid")==null?"":"solid";var yp=m(Tp);yp.value=(yp.__value="dashed")==null?"":"dashed";var Kp=m(yp);Kp.value=(Kp.__value="dotted")==null?"":"dotted",_(Au),_(zu),_(Pa);var bp=m(Pa,2),fh=m(y(bp),2),oc=m(y(fh),2),_f=Lt(()=>rn(Ut,2));oc.__click=function(...Ud){var od;(od=i(_f))==null||od.apply(this,Ud)};var Bm=y(oc);_(oc);var df=m(oc,2);df.__change=()=>Cp(Ut);var op=y(df);op.value=(op.__value=1)==null?"":1;var ph=m(op);ph.value=(ph.__value=2)==null?"":2;var Ih=m(ph);Ih.value=(Ih.__value=3)==null?"":3;var am=m(Ih);am.value=(am.__value=4)==null?"":4;var vv=m(am);vv.value=(vv.__value=5)==null?"":5,_(df);var Wf=m(df,2);Wf.__change=()=>Cp(Ut);var qd=y(Wf);qd.value=(qd.__value="solid")==null?"":"solid";var lm=m(qd);lm.value=(lm.__value="dashed")==null?"":"dashed";var Fv=m(lm);Fv.value=(Fv.__value="dotted")==null?"":"dotted",_(Wf),_(fh),_(bp),_(us),_(hs),we(()=>{Dt(Do,"style",`background-color: ${i(ct).styles.k.color??""}`),Dt(uf,"style",`background-color: ${i(ct).styles.d.color??""}`),Dt(Bm,"style",`background-color: ${i(ct).styles.j.color??""}`)}),Fn(In,()=>i(ct).kPeriod,Ud=>i(ct).kPeriod=Ud),Fn(_n,()=>i(ct).dPeriod,Ud=>i(ct).dPeriod=Ud),co(ir,()=>i(ct).styles.k.thickness,Ud=>i(ct).styles.k.thickness=Ud),co(Ba,()=>i(ct).styles.k.lineStyle,Ud=>i(ct).styles.k.lineStyle=Ud),co(Ku,()=>i(ct).styles.d.thickness,Ud=>i(ct).styles.d.thickness=Ud),co(Au,()=>i(ct).styles.d.lineStyle,Ud=>i(ct).styles.d.lineStyle=Ud),co(df,()=>i(ct).styles.j.thickness,Ud=>i(ct).styles.j.thickness=Ud),co(Wf,()=>i(ct).styles.j.lineStyle,Ud=>i(ct).styles.j.lineStyle=Ud),Y(Zt,hs)});var ps=m(vs,2),as=y(ps);as.__click=Gh,_(ps),_(Ps),Y(Ye,Ps)},Ye=>{var Ps=Qs(),vs=_s(Ps);Ve(vs,()=>i(O),ps=>{var as=Mq(),Zt=y(as),ct=m(y(Zt),2),Ut=y(ct),hs=m(y(Ut),2);Ts(hs),hs.__change=[JV,Sn,er],_(Ut);var Is=m(Ut,2),cs=m(y(Is),2);cs.__click=[Sq,Yn];var Ms=y(cs);const us=Lt(()=>`background-color: ${v(i(Ol),i(Ui))}`);_(cs),_(Is),_(ct);var ds=m(ct,2),os=y(ds),In=m(y(os),2),Lo=y(In);_(In),_(os);var _n=m(os,2);Ts(_n),_n.__change=_o,_(ds),_(Zt);var sn=m(Zt,2),Ao=m(y(sn),2),Qo=m(y(Ao),2);Ts(Qo),Qo.__change=[QV,Sn,ba],_(Ao);var wi=m(Ao,2),Do=y(wi),ir=m(y(Do),2);ir.__click=[Cq,Yn];var Io=y(ir);_(ir),_(Do);var Bn=m(Do,2),gi=m(y(Bn),2);gi.__click=[Iq,Yn];var wo=y(gi);_(gi),_(Bn),_(wi);var Ei=m(wi,2),Ba=y(Ei),Ta=m(y(Ba),2);Ta.__change=[Uk,Sn,tc,mc];var Ji=y(Ta);Ji.value=(Ji.__value=1)==null?"":1;var Nu=m(Ji);Nu.value=(Nu.__value=2)==null?"":2;var Pa=m(Nu);Pa.value=(Pa.__value=3)==null?"":3;var zu=m(Pa);zu.value=(zu.__value=4)==null?"":4;var Md=m(zu);Md.value=(Md.__value=5)==null?"":5,_(Ta),_(Ba);var ta=m(Ba,2),uf=m(y(ta),2);uf.__change=[Uk,Sn,tc,mc];var Ku=y(uf);Ku.value=(Ku.__value="solid")==null?"":"solid";var pu=m(Ku);pu.value=(pu.__value="dashed")==null?"":"dashed",_(uf),_(ta);var kc=m(ta,2),Xu=m(y(kc),2);Xu.__change=[Gk,Sn,gu,Bl];var Nd=y(Xu);Nd.value=(Nd.__value=1)==null?"":1;var Wr=m(Nd);Wr.value=(Wr.__value=2)==null?"":2;var Au=m(Wr);Au.value=(Au.__value=3)==null?"":3;var Tp=m(Au);Tp.value=(Tp.__value=4)==null?"":4;var yp=m(Tp);yp.value=(yp.__value=5)==null?"":5,_(Xu),_(kc);var Kp=m(kc,2),bp=m(y(Kp),2);bp.__change=[Gk,Sn,gu,Bl];var fh=y(bp);fh.value=(fh.__value="solid")==null?"":"solid";var oc=m(fh);oc.value=(oc.__value="dashed")==null?"":"dashed",_(bp),_(Kp),_(Ei),_(sn);var _f=m(sn,2),Bm=m(y(_f),2),df=y(Bm),op=m(y(df),2);op.__click=[Pq,Yn];var ph=y(op);_(op),_(df);var Ih=m(df,2),am=m(y(Ih),2);am.__change=[qk,Sn,Jr,nl];var vv=y(am);vv.value=(vv.__value=1)==null?"":1;var Wf=m(vv);Wf.value=(Wf.__value=2)==null?"":2;var qd=m(Wf);qd.value=(qd.__value=3)==null?"":3;var lm=m(qd);lm.value=(lm.__value=4)==null?"":4;var Fv=m(lm);Fv.value=(Fv.__value=5)==null?"":5,_(am),_(Ih);var Ud=m(Ih,2),od=m(y(Ud),2);od.__change=[qk,Sn,Jr,nl];var xg=y(od);xg.value=(xg.__value="solid")==null?"":"solid";var Jv=m(xg);Jv.value=(Jv.__value="dashed")==null?"":"dashed",_(od),_(Ud),_(Bm),_(_f);var Om=m(_f,2),Lv=m(y(Om),2),Ev=m(y(Lv),2);Ts(Ev),Ev.__change=[eW,Sn,ol],_(Lv),_(Om),_(as),we(()=>{Dt(Ms,"style",i(us)),st(Lo,`${i(Ui)??""}%`),Dt(Io,"style",`background-color: ${i(bl)}`),Dt(wo,"style",`background-color: ${i(Ua)}`),Dt(ph,"style",`background-color: ${i(fl)}`)}),Wv(hs,()=>i(er),Fp=>b(er,Fp)),Fn(_n,()=>i(Ui),Fp=>b(Ui,Fp)),Wv(Qo,()=>i(ba),Fp=>b(ba,Fp)),co(Ta,()=>i(tc),Fp=>b(tc,Fp)),co(uf,()=>i(mc),Fp=>b(mc,Fp)),co(Xu,()=>i(gu),Fp=>b(gu,Fp)),co(bp,()=>i(Bl),Fp=>b(Bl,Fp)),co(am,()=>i(Jr),Fp=>b(Jr,Fp)),co(od,()=>i(nl),Fp=>b(nl,Fp)),Wv(Ev,()=>i(ol),Fp=>b(ol,Fp)),Y(ps,as)},ps=>{var as=Qs(),Zt=_s(as);Ve(Zt,()=>i(ad),ct=>{var Ut=zq(),hs=y(Ut),Is=m(y(hs),2),cs=y(Is),Ms=m(y(cs),2);Ts(Ms),_(cs);var us=m(cs,2),ds=m(y(us),2);Ts(ds),_(us),_(Is),_(hs);var os=m(hs,2),In=m(y(os),2),Lo=m(y(In),2),_n=y(Lo),sn=m(_n,2);sn.__click=[Nq,gn];var Ao=y(sn);_(sn),_(Lo),_(In);var Qo=m(In,2),wi=y(Qo),Do=m(y(wi),2),ir=y(Do);_(Do),_(wi);var Io=m(wi,2);Ts(Io),Oi(2),_(Qo),_(os);var Bn=m(os,2),gi=m(y(Bn),2),wo=y(gi),Ei=m(y(wo),2),Ba=y(Ei),Ta=m(Ba,2);Ta.__click=[Aq,gn];var Ji=y(Ta);_(Ta),_(Ei),_(wo);var Nu=m(wo,2),Pa=m(y(Nu),2),zu=y(Pa),Md=m(zu,2);Md.__click=[Tq,gn];var ta=y(Md);_(Md),_(Pa),_(Nu);var uf=m(Nu,2),Ku=m(y(uf),2),pu=y(Ku),kc=m(pu,2);kc.__click=[Fq,gn];var Xu=y(kc);_(kc),_(Ku),_(uf),_(gi),_(Bn);var Nd=m(Bn,2),Wr=m(y(Nd),2),Au=y(Wr),Tp=m(y(Au),2),yp=y(Tp);yp.value=(yp.__value=1)==null?"":1;var Kp=m(yp);Kp.value=(Kp.__value=2)==null?"":2;var bp=m(Kp);bp.value=(bp.__value=3)==null?"":3;var fh=m(bp);fh.value=(fh.__value=4)==null?"":4;var oc=m(fh);oc.value=(oc.__value=5)==null?"":5,_(Tp),_(Au);var _f=m(Au,2),Bm=m(y(_f),2),df=y(Bm);df.value=(df.__value="solid")==null?"":"solid";var op=m(df);op.value=(op.__value="dashed")==null?"":"dashed";var ph=m(op);ph.value=(ph.__value="dotted")==null?"":"dotted",_(Bm),_(_f),_(Wr),_(Nd);var Ih=m(Nd,2),am=y(Ih);am.__click=[dW,ad,o,l,Hl,j,E,x,S,C,I,A,P,T,Gn];var vv=m(am,2);Ve(vv,()=>i(Hl).length>1,qd=>{var lm=Eq();lm.__click=[Lq,Uo],Y(qd,lm)}),_(Ih);var Wf=m(Ih,2);Ve(Wf,()=>i(Hl).length>1,qd=>{var lm=Qs(),Fv=_s(lm);qo(Fv,17,()=>i(Hl).slice(1),yi,(Ud,od,xg)=>{var Jv=Oq();const Om=Lt(()=>xg+1);var Lv=y(Jv),Ev=y(Lv),Fp=y(Ev);_(Ev);var z0=m(Ev,2);z0.__click=[$q,Uo,Om],_(Lv);var Gg=m(Lv,2),Yg=y(Gg),v0=m(y(Yg),2);Ts(v0),v0.__change=Gn,_(Yg);var Kg=m(Yg,2),g0=m(y(Kg),2);Ts(g0),g0.__change=Gn,_(Kg),_(Gg);var wg=m(Gg,2),gv=m(y(wg),2),V0=m(y(gv),2),W0=y(V0),_0=m(W0,2);_0.__click=[Dq,gn,Om];var v_=y(_0);_(_0),_(V0),_(gv);var H0=m(gv,2),Xg=y(H0),y0=m(y(Xg),2),g_=y(y0);_(y0),_(Xg);var b0=m(Xg,2);Ts(b0),b0.__change=Gn,_(H0),_(wg);var x0=m(wg,2),q0=m(y(x0),2),w0=y(q0),rt=m(y(w0),2),Ae=y(rt),_t=m(Ae,2);_t.__click=[Rq,gn,Om];var bt=y(_t);_(_t),_(rt),_(w0);var Tt=m(w0,2),It=m(y(Tt),2),Yt=y(It),fn=m(Yt,2);fn.__click=[jq,gn,Om];var Ds=y(fn);_(fn),_(It),_(Tt);var $n=m(Tt,2),Rs=m(y($n),2),cn=y(Rs),Vn=m(cn,2);Vn.__click=[Bq,gn,Om];var _i=y(Vn);_(Vn),_(Rs),_($n),_(q0),_(x0);var Gr=m(x0,2),An=m(y(Gr),2),ra=y(An),rr=m(y(ra),2);rr.__change=Gn;var Hr=y(rr);Hr.value=(Hr.__value=1)==null?"":1;var ci=m(Hr);ci.value=(ci.__value=2)==null?"":2;var On=m(ci);On.value=(On.__value=3)==null?"":3;var Po=m(On);Po.value=(Po.__value=4)==null?"":4;var Ma=m(Po);Ma.value=(Ma.__value=5)==null?"":5,_(rr),_(ra);var ic=m(ra,2),wu=m(y(ic),2);wu.__change=Gn;var Tu=y(wu);Tu.value=(Tu.__value="solid")==null?"":"solid";var Fu=m(Tu);Fu.value=(Fu.__value="dashed")==null?"":"dashed";var Gl=m(Fu);Gl.value=(Gl.__value="dotted")==null?"":"dotted",_(wu),_(ic),_(An),_(Gr),_(Jv),we(()=>{st(Fp,`BOLL ${i(Om)+1}`),Dt(z0,"title",`Remove BOLL ${i(Om)+1}`),Dt(W0,"style",`background-color: ${i(od).styles.fillColor}; opacity: ${(i(od).styles.fillOpacity||0)/100}`),Dt(v_,"style",`background-color: ${i(od).styles.fillColor}; opacity: ${(i(od).styles.fillOpacity||0)/100}`),st(g_,`${i(od).styles.fillOpacity??""}%`),Dt(Ae,"style",`background-color: ${i(od).styles.upperColor}`),Dt(bt,"style",`background-color: ${i(od).styles.upperColor}`),Dt(Yt,"style",`background-color: ${i(od).styles.middleColor}`),Dt(Ds,"style",`background-color: ${i(od).styles.middleColor}`),Dt(cn,"style",`background-color: ${i(od).styles.lowerColor}`),Dt(_i,"style",`background-color: ${i(od).styles.lowerColor}`)}),Fn(v0,()=>i(od).period,Lu=>i(od).period=Lu),Fn(g0,()=>i(od).stdDev,Lu=>i(od).stdDev=Lu),Fn(b0,()=>i(od).styles.fillOpacity,Lu=>i(od).styles.fillOpacity=Lu),co(rr,()=>i(od).styles.thickness,Lu=>i(od).styles.thickness=Lu),co(wu,()=>i(od).styles.lineStyle,Lu=>i(od).styles.lineStyle=Lu),Y(Ud,Jv)}),Y(qd,lm)}),_(Ut),we(()=>{Dt(_n,"style",`background-color: ${i(x)??""}; opacity: ${i(S)/100}`),Dt(Ao,"style",`background-color: ${i(x)??""}; opacity: ${i(S)/100}`),st(ir,`${i(S)??""}%`),Dt(Ba,"style",`background-color: ${i(C)??""}`),Dt(Ji,"style",`background-color: ${i(C)??""}`),Dt(zu,"style",`background-color: ${i(I)??""}`),Dt(ta,"style",`background-color: ${i(I)??""}`),Dt(pu,"style",`background-color: ${i(A)??""}`),Dt(Xu,"style",`background-color: ${i(A)??""}`)}),Fn(Ms,()=>i(j),qd=>b(j,qd)),Fn(ds,()=>i(E),qd=>b(E,qd)),Fn(Io,()=>i(S),qd=>b(S,qd)),co(Tp,()=>i(P),qd=>b(P,qd)),co(Bm,()=>i(T),qd=>b(T,qd)),Y(ct,Ut)},ct=>{var Ut=Qs(),hs=_s(Ut);Ve(hs,()=>!d.length,Is=>{var cs=Vq(),Ms=y(cs),us=y(Ms,!0);we(()=>st(us,E5())),_(Ms),_(cs),Y(Is,cs)},Is=>{var cs=Gq(),Ms=y(cs);qo(Ms,17,()=>d,yi,(ds,os,In)=>{var Lo=qq(),_n=y(Lo),sn=y(_n),Ao=y(sn,!0);_(sn);var Qo=m(sn,2),wi=y(Qo);Ts(wi);var Do=m(wi,2);Ve(Do,()=>u.length>1&&!i(ad),kc=>{var Xu=Wq();Xu.__click=()=>Dr(In),Y(kc,Xu)},kc=>{var Xu=Qs(),Nd=_s(Xu);Ve(Nd,()=>!i(ad),Wr=>{var Au=Hq();Y(Wr,Au)},null,!0),Y(kc,Xu)}),_(Qo),_(_n);var ir=m(_n,2),Io=y(ir),Bn=m(y(Io),2),gi=Lt(()=>$s(In));Bn.__click=function(...kc){var Xu;(Xu=i(gi))==null||Xu.apply(this,kc)};var wo=y(Bn);_(Bn),_(Io);var Ei=m(Io,2),Ba=m(y(Ei),2),Ta=y(Ba);Ta.value=(Ta.__value=1)==null?"":1;var Ji=m(Ta);Ji.value=(Ji.__value=2)==null?"":2;var Nu=m(Ji);Nu.value=(Nu.__value=3)==null?"":3;var Pa=m(Nu);Pa.value=(Pa.__value=4)==null?"":4;var zu=m(Pa);zu.value=(zu.__value=5)==null?"":5,_(Ba),_(Ei);var Md=m(Ei,2),ta=m(y(Md),2),uf=y(ta);uf.value=(uf.__value="solid")==null?"":"solid";var Ku=m(uf);Ku.value=(Ku.__value="dashed")==null?"":"dashed";var pu=m(Ku);pu.value=(pu.__value="dotted")==null?"":"dotted",_(ta),_(Md),_(ir),_(Lo),we(()=>{st(Ao,i(os).title),Dt(wo,"style",`background-color: ${h[In].color??""}`)}),Fn(wi,()=>u[In],kc=>u[In]=kc),co(Ba,()=>h[In].thickness,kc=>h[In].thickness=kc),co(ta,()=>h[In].lineStyle,kc=>h[In].lineStyle=kc),Y(ds,Lo)});var us=m(Ms,2);Ve(us,()=>d.length<10&&!i(ad)&&!i(Ld)&&!i(Bt),ds=>{var os=Uq(),In=y(os);In.__click=[gy,ad,fu,ni,$u,Xo,yu,sr,Re,Sl,d,u,h,wp,Cs,nf,Nt],_(os),we(()=>Dt(In,"title",i(fu)?"Add more BIAS indicator":i($u)?"Add more Awesome Oscillator":i(yu)?"Add more WR indicator":i(nf)?"Add more EMA":"Add parameter")),Y(ds,os)}),_(cs),Y(Is,cs)},!0),Y(ct,Ut)},!0),Y(ps,as)},!0),Y(Ye,Ps)},!0),Y(ht,qe)},!0),Y(Mi,Ll)},!0),Y(Ho,qa)},!0),Y(or,Hi)},!0),Y(oi,Lr)},!0),Y(va,gr)},!0),Y(Li,Tr)},!0),Y(ea,ja)},!0),Y(li,wr)},!0),Y(jr,Ha)},!0),Y(Ar,ia)},!0),Y(ha,al)},!0),Y(Ki,Ii)},!0),Y(Qa,el)},!0),Y(nr,Ca)},!0),Y(pa,Bi)},!0),Y(ya,Ur)},!0),Y(Sa,vl)},!0),Y(fa,fc)},!0),Y(Ja,xc)},!0),Y(Vr,ml)},!0),Y(zr,dc)},!0),Y(Wo,ji)},!0),Y(Rr,Ul)},!0),Y(Rd,Ou)},!0),Y(ud,Hd)},!0),Y(sf,au)},!0),Y(jo,Lc)},!0),Y(Zs,xs)},!0),Y(lt,Qt)},!0),Y(q,he)});var z=m(F,2);Ve(z,()=>i(ot),q=>{var he=Yq();Y(q,he)}),_(R),Y(k,R)},$$slots:{default:!0}});var Yh=m(Up,2),_p=Lt(()=>{var k,N;return((N=(k=i(Hl)[i(kp)])==null?void 0:k.styles)==null?void 0:N.upperColor)||"#f23645"});Sc(Yh,{get show(){return i(lo)},set show(k){b(lo,H(k))},get selectedColor(){return i(_p)},get position(){return i(Qi)},$$events:{colorChange:k=>{i(Hl)[i(kp)]?(i(Hl)[i(kp)].styles.upperColor=k.detail.rgba||k.detail.color,Gn()):b(C,H(k.detail.rgba||k.detail.color))}}});var xm=m(Yh,2),pv=Lt(()=>{var k,N;return((N=(k=i(Hl)[i(kp)])==null?void 0:k.styles)==null?void 0:N.middleColor)||"#2962ff"});Sc(xm,{get show(){return i(xr)},set show(k){b(xr,H(k))},get selectedColor(){return i(pv)},get position(){return i(Ai)},$$events:{colorChange:k=>{i(Hl)[i(kp)]?(i(Hl)[i(kp)].styles.middleColor=k.detail.rgba||k.detail.color,Gn()):b(I,H(k.detail.rgba||k.detail.color))}}});var Sh=m(xm,2),Mv=Lt(()=>{var k,N;return((N=(k=i(Hl)[i(kp)])==null?void 0:k.styles)==null?void 0:N.lowerColor)||"#089981"});Sc(Sh,{get show(){return i(ri)},set show(k){b(ri,H(k))},get selectedColor(){return i(Mv)},get position(){return i(Ti)},$$events:{colorChange:k=>{i(Hl)[i(kp)]?(i(Hl)[i(kp)].styles.lowerColor=k.detail.rgba||k.detail.color,Gn()):b(A,H(k.detail.rgba||k.detail.color))}}});var hv=m(Sh,2),rm=Lt(()=>{var k,N;return((N=(k=i(Hl)[i(kp)])==null?void 0:k.styles)==null?void 0:N.fillColor)||"#2196F3"});Sc(hv,{get show(){return i(Bs)},set show(k){b(Bs,H(k))},get selectedColor(){return i(rm)},get position(){return i(bo)},$$events:{colorChange:k=>{i(Hl)[i(kp)]?(i(Hl)[i(kp)].styles.fillColor=k.detail.rgba||k.detail.color,Gn()):b(x,H(k.detail.rgba||k.detail.color))}}});var Km=m(hv,2);Sc(Km,{get show(){return i(Eo)},set show(k){b(Eo,H(k))},get selectedColor(){return i(fl)},get position(){return i(hr)},$$events:{colorChange:k=>{var R;b(fl,H(k.detail.rgba||k.detail.color));const N=window.__npoMaeApi;(R=N==null?void 0:N.setColors)==null||R.call(N,{median:i(fl)})}}});var Gv=m(Km,2),Xm=Lt(()=>v(i(Ol),i(Ui)));Sc(Gv,{get show(){return i(ei)},set show(k){b(ei,H(k))},get selectedColor(){return i(Xm)},get position(){return i(ai)},$$events:{colorChange:k=>{b(Ol,H(k.detail.rgba||k.detail.color)),_o()}}});var up=m(Gv,2);Sc(up,{get show(){return i(vi)},set show(k){b(vi,H(k))},get selectedColor(){return i(bl)},get position(){return i(_a)},$$events:{colorChange:k=>{var R;b(bl,H(k.detail.rgba||k.detail.color));const N=window.__npoMaeApi;(R=N==null?void 0:N.setColors)==null||R.call(N,{slLong:i(bl)})}}});var Wi=m(up,2);Sc(Wi,{get show(){return i(dl)},set show(k){b(dl,H(k))},get selectedColor(){return i(Ua)},get position(){return i(ar)},$$events:{colorChange:k=>{var R;b(Ua,H(k.detail.rgba||k.detail.color));const N=window.__npoMaeApi;(R=N==null?void 0:N.setColors)==null||R.call(N,{slShort:i(Ua)})}}});var Nr=m(Wi,2),Kc=Lt(()=>{var k,N,R;return((R=(N=(k=i(su)[i(X)])==null?void 0:k.styles)==null?void 0:N[i(ne)])==null?void 0:R.color)||"#2563eb"});Sc(Nr,{get show(){return i(L)},set show(k){b(L,H(k))},get selectedColor(){return i(Kc)},get position(){return i(D)},$$events:{colorChange:k=>{i(su).length>i(X)&&(i(su)[i(X)].styles[i(ne)].color=k.detail.rgba||k.detail.color,om(i(X),i(ne)))}}});var Yu=m(Nr,2),Vd=Lt(()=>{var k,N,R;return((R=(N=(k=i(bu)[i(mu)])==null?void 0:k.styles)==null?void 0:N[i(Gc)])==null?void 0:R.color)||"#2563eb"});Sc(Yu,{get show(){return i(zi)},set show(k){b(zi,H(k))},get selectedColor(){return i(Vd)},get position(){return Nl},$$events:{colorChange:k=>{i(bu).length>i(mu)&&i(bu)[i(mu)].styles[i(Gc)]&&(i(bu)[i(mu)].styles[i(Gc)].color=k.detail.rgba||k.detail.color,Mc())}}});var Yi=m(Yu,2),$t=Lt(()=>{var k;return((k=i(uo)[i(te)])==null?void 0:k.color)||"#2563eb"});Sc(Yi,{get show(){return i(de)},set show(k){b(de,H(k))},get selectedColor(){return i($t)},get position(){return i(ie)},$$events:{colorChange:k=>{i(uo).length>i(te)&&(i(uo)[i(te)].color=k.detail.rgba||k.detail.color,nc())}}});var En=m(Yi,2),Mo=Lt(()=>{var k,N,R;return((R=(N=(k=i($l)[0])==null?void 0:k.styles)==null?void 0:N.diPlus)==null?void 0:R.color)||"#2563eb"});Sc(En,{get show(){return i(le)},set show(k){b(le,H(k))},get selectedColor(){return i(Mo)},get position(){return i(pe)},$$events:{colorChange:k=>{i($l).length>0&&(i($l)[0].styles.diPlus.color=k.detail.rgba||k.detail.color)}}});var No=m(En,2),ka=Lt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});Sc(No,{get show(){return i(se)},set show(k){b(se,H(k))},get selectedColor(){return i(ka)},get position(){return i(Ne)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Xc=m(No,2),eo=Lt(()=>{var k;return((k=i(Or)[i(Rt)])==null?void 0:k.color)||"#2563eb"});Sc(Xc,{get show(){return i(kt)},set show(k){b(kt,H(k))},get selectedColor(){return i(eo)},get position(){return i(pt)},$$events:{colorChange:k=>{i(Or)[i(Rt)]&&(i(Or)[i(Rt)].color=k.detail.rgba||k.detail.color,Hh())}}});var Ra=m(Xc,2),Xa=Lt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});Sc(Ra,{get show(){return i(Te)},set show(k){b(Te,H(k))},get selectedColor(){return i(Xa)},get position(){return i(Me)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Vl=m(Ra,2),Qf=Lt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});Sc(Vl,{get show(){return i(Ht)},set show(k){b(Ht,H(k))},get selectedColor(){return i(Qf)},get position(){return i(Ft)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Bp=m(Vl,2),Gp=Lt(()=>{var k,N,R,F,z,q,he,Ee,lt;return i(it)==="histogram"?((R=(N=(k=i(zt)[i(Je)])==null?void 0:k.styles)==null?void 0:N.histogram)==null?void 0:R.upColor)||"#26a69a":i(it)==="histogram-down"?((q=(z=(F=i(zt)[i(Je)])==null?void 0:F.styles)==null?void 0:z.histogram)==null?void 0:q.downColor)||"#ef5350":((lt=(Ee=(he=i(zt)[i(Je)])==null?void 0:he.styles)==null?void 0:Ee.ema)==null?void 0:lt.color)||"#2563eb"}),ao=Lt(()=>i(it)==="histogram"||i(it)==="histogram-down"?70:100);Sc(Bp,{get show(){return i(ut)},set show(k){b(ut,H(k))},get selectedColor(){return i(Gp)},get opacity(){return i(ao)},get position(){return i(nt)},$$events:{colorChange:k=>{i(zt).length>i(Je)&&(i(it)==="histogram"?i(zt)[i(Je)].styles.histogram.upColor=k.detail.rgba||k.detail.color:i(it)==="histogram-down"?i(zt)[i(Je)].styles.histogram.downColor=k.detail.rgba||k.detail.color:i(it)==="ema"&&(i(zt)[i(Je)].styles.ema.color=k.detail.rgba||k.detail.color),at(i(Je)))}}});var Ri=m(Bp,2),bc=Lt(()=>{var k,N,R;return((R=(N=(k=i(sd)[i(wt)])==null?void 0:k.styles)==null?void 0:N.wr)==null?void 0:R.color)||"#2563eb"});Sc(Ri,{get show(){return i(ze)},set show(k){b(ze,H(k))},get selectedColor(){return i(bc)},get position(){return i(Ge)},$$events:{colorChange:k=>{i(sd).length>i(wt)&&i(sd)[i(wt)].styles.wr&&(i(sd)[i(wt)].styles.wr.color=k.detail.rgba||k.detail.color,Zf(i(wt)))}}});var Mu=m(Ri,2),Sf=Lt(()=>{var k,N,R;return((R=(N=(k=i(sd)[i(wt)])==null?void 0:k.styles)==null?void 0:N.overbought)==null?void 0:R.color)||"#FF4444"});Sc(Mu,{get show(){return i(xt)},set show(k){b(xt,H(k))},get selectedColor(){return i(Sf)},get position(){return i(jt)},$$events:{colorChange:k=>{i(sd).length>i(wt)&&i(sd)[i(wt)].styles.overbought&&(i(sd)[i(wt)].styles.overbought.color=k.detail.rgba||k.detail.color,Zf(i(wt)))}}});var dp=m(Mu,2),Op=Lt(()=>{var k,N,R;return((R=(N=(k=i(sd)[i(wt)])==null?void 0:k.styles)==null?void 0:N.oversold)==null?void 0:R.color)||"#00C851"});Sc(dp,{get show(){return i(ft)},set show(k){b(ft,H(k))},get selectedColor(){return i(Op)},get position(){return i(ke)},$$events:{colorChange:k=>{i(sd).length>i(wt)&&i(sd)[i(wt)].styles.oversold&&(i(sd)[i(wt)].styles.oversold.color=k.detail.rgba||k.detail.color,Zf(i(wt)))}}});var gd=m(dp,2),Zc=Lt(()=>{var k,N,R;return((R=(N=(k=i(sd)[i(wt)])==null?void 0:k.styles)==null?void 0:N.middleLine)==null?void 0:R.color)||"#808080"});Sc(gd,{get show(){return i(Se)},set show(k){b(Se,H(k))},get selectedColor(){return i(Zc)},get position(){return i(Et)},$$events:{colorChange:k=>{i(sd).length>i(wt)&&i(sd)[i(wt)].styles.middleLine&&(i(sd)[i(wt)].styles.middleLine.color=k.detail.rgba||k.detail.color,Zf(i(wt)))}}});var Cf=m(gd,2),ep=Lt(()=>{var k,N,R;return((R=(N=(k=i(of)[i(Gs)])==null?void 0:k.styles)==null?void 0:N[i(an)])==null?void 0:R.color)||"#2563eb"});Sc(Cf,{get show(){return i(Ls)},set show(k){b(Ls,H(k))},get selectedColor(){return i(ep)},get position(){return i(tn)},$$events:{colorChange:k=>{i(of).length>i(Gs)&&i(of)[i(Gs)].styles[i(an)]&&(i(of)[i(Gs)].styles[i(an)].color=k.detail.rgba||k.detail.color,$e(i(Gs)))}}});var zp=m(Cf,2),Np=Lt(()=>{var k,N,R;return((R=(N=(k=i($a)[i(Hs)])==null?void 0:k.styles)==null?void 0:N.roc)==null?void 0:R.color)||"#2563eb"});Sc(zp,{get show(){return i(Es)},set show(k){b(Es,H(k))},get selectedColor(){return i(Np)},get position(){return i(Ns)},$$events:{colorChange:k=>{i($a).length>i(Hs)&&(i($a)[i(Hs)].styles.roc.color=k.detail.rgba||k.detail.color,wh(i(Hs)))}}});var np=m(zp,2),$h=Lt(()=>{var k,N,R,F,z,q;return i(Mn)%2===0?((R=(N=(k=i(ti)[Math.floor(i(Mn)/2)])==null?void 0:k.styles)==null?void 0:N.psy)==null?void 0:R.color)||"#2563eb":((q=(z=(F=i(ti)[Math.floor(i(Mn)/2)])==null?void 0:F.styles)==null?void 0:z.mapsy)==null?void 0:q.color)||"#dc2626"});Sc(np,{get show(){return i(ns)},set show(k){b(ns,H(k))},get selectedColor(){return i($h)},get position(){return i(fs)},$$events:{colorChange:k=>{const N=Math.floor(i(Mn)/2);i(ti).length>N&&(i(Mn)%2===0?(i(ti)[N].styles.psy.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated PSY color to:",k.detail.color)):(i(ti)[N].styles.mapsy.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated MAPSY color to:",k.detail.color)),Rp(N))}}});var Ef=m(np,2),Cd=Lt(()=>{var k,N,R,F,z,q;return i(Cn)%2===0?((R=(N=(k=i(fi)[Math.floor(i(Cn)/2)])==null?void 0:k.styles)==null?void 0:N.obv)==null?void 0:R.color)||"#FF6B35":((q=(z=(F=i(fi)[Math.floor(i(Cn)/2)])==null?void 0:F.styles)==null?void 0:z.maobv)==null?void 0:q.color)||"#2196F3"});Sc(Ef,{get show(){return i(po)},set show(k){b(po,H(k))},get selectedColor(){return i(Cd)},get position(){return i(Tn)},$$events:{colorChange:k=>{const N=Math.floor(i(Cn)/2);i(fi).length>N&&(i(Cn)%2===0?(i(fi)[N].styles.obv.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated OBV color to:",k.detail.color)):(i(fi)[N].styles.maobv.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated MAOBV color to:",k.detail.color)),nh())}}});var $f=m(Ef,2),uh=Lt(()=>{var k;return((k=i(Ks)[i(Ct)])==null?void 0:k.styles.color)||"#2962FF"});Sc($f,{get show(){return i(go)},set show(k){b(go,H(k))},get selectedColor(){return i(uh)},get position(){return i(no)},$$events:{colorChange:k=>{i(Ks).length>i(Ct)&&(i(Ks)[i(Ct)].styles.color=k.detail.rgba||k.detail.color,As())}}});var wm=m($f,2),Nv=Lt(()=>{var k;return((k=i(Pu)[i(Rl)])==null?void 0:k.color)||"#FF6B35"});Sc(wm,{get show(){return i(Bo)},set show(k){b(Bo,H(k))},get selectedColor(){return i(Nv)},get position(){return i(Vo)},$$events:{colorChange:k=>{i(Pu).length>i(Rl)&&(i(Pu)[i(Rl)].color=k.detail.rgba||k.detail.color,console.log("🎨 Updated PVT color to:",k.detail.color),vp(i(Rl)))}}});var Zm=m(wm,2),Av=Lt(()=>{var k;return((k=i(cc)[i(Zr)])==null?void 0:k.color)||"#2563eb"});Sc(Zm,{get show(){return i(aa)},set show(k){b(aa,H(k))},get selectedColor(){return i(Av)},get position(){return i(tl)},$$events:{colorChange:k=>{i(cc).length>i(Zr)&&(i(cc)[i(Zr)].color=k.detail.rgba||k.detail.color)}}});var hg=m(Zm,2),mg=Lt(()=>{var k;return((k=i(oo)[i(rd)])==null?void 0:k.color)||"#2563eb"});Sc(hg,{get show(){return i(du)},set show(k){b(du,H(k))},get selectedColor(){return i(mg)},get position(){return i(Ju)},$$events:{colorChange:k=>{i(oo).length>i(rd)&&(i(oo)[i(rd)].color=k.detail.rgba||k.detail.color,Kl())}}});var jm=m(hg,2),Yv=Lt(()=>{var k,N;return((N=(k=i(vf)[i(zl)])==null?void 0:k.styles[i(wd)])==null?void 0:N.color)||"#2563eb"});Sc(jm,{get show(){return i(Al)},set show(k){b(Al,H(k))},get selectedColor(){return i(Yv)},get position(){return i(sa)},$$events:{colorChange:k=>{const N=i(vf)[i(zl)];N&&N.styles&&N.styles.length>i(wd)&&(N.styles[i(wd)].color=k.detail.rgba||k.detail.color,M(i(zl)))}}});var Ch=m(jm,2),Jm=Lt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});Sc(Ch,{get show(){return i(Vc)},set show(k){b(Vc,H(k))},get selectedColor(){return i(Jm)},get position(){return i(vu)},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var Vg=m(Ch,2),Wg=Lt(()=>{var k,N,R,F,z,q,he,Ee,lt;return i(ec)%3===0?((R=(N=(k=i(Iu)[Math.floor(i(ec)/3)])==null?void 0:k.styles)==null?void 0:N.increasing)==null?void 0:R.color)||"#00C851":i(ec)%3===1?((q=(z=(F=i(Iu)[Math.floor(i(ec)/3)])==null?void 0:F.styles)==null?void 0:z.decreasing)==null?void 0:q.color)||"#FF4444":((lt=(Ee=(he=i(Iu)[Math.floor(i(ec)/3)])==null?void 0:he.styles)==null?void 0:Ee.reverse)==null?void 0:lt.color)||"#c4c4c4"});Sc(Vg,{get show(){return i(Qc)},set show(k){b(Qc,H(k))},get selectedColor(){return i(Wg)},get position(){return i(To)},$$events:{colorChange:k=>{const N=Math.floor(i(ec)/3);i(Iu)[N]&&(i(ec)%3===0?i(Iu)[N].styles.increasing.color=k.detail.rgba||k.detail.color:i(ec)%3===1?i(Iu)[N].styles.decreasing.color=k.detail.rgba||k.detail.color:i(Iu)[N].styles.reverse.color=k.detail.rgba||k.detail.color,He())}}});var vg=m(Vg,2),Tv=Lt(()=>{var k,N,R;return((R=(N=(k=i($l)[i(re)])==null?void 0:k.styles)==null?void 0:N[i(xe)])==null?void 0:R.color)||"#2563eb"});Sc(vg,{get show(){return i(le)},set show(k){b(le,H(k))},get selectedColor(){return i(Tv)},get position(){return i(pe)},$$events:{colorChange:k=>{i($l).length>i(re)&&i($l)[i(re)].styles[i(xe)]&&(i($l)[i(re)].styles[i(xe)].color=k.detail.rgba||k.detail.color,xu())}}});var f0=m(vg,2),Hg=Lt(()=>{var k,N,R;return((R=(N=(k=i(Iu)[0])==null?void 0:k.styles)==null?void 0:N.increasing)==null?void 0:R.color)||"#16a34a"});Sc(f0,{get show(){return i(Wc)},set show(k){b(Wc,H(k))},get selectedColor(){return i(Hg)},get position(){return i(Xd)},$$events:{colorChange:k=>{i(Iu).length>0&&(i(Iu)[0].styles.increasing.color=k.detail.rgba||k.detail.color)}}});var qg=m(f0,2),Ap=Lt(()=>{var k,N,R;return((R=(N=(k=i(Iu)[0])==null?void 0:k.styles)==null?void 0:N.decreasing)==null?void 0:R.color)||"#dc2626"});Sc(qg,{get show(){return i(Uf)},set show(k){b(Uf,H(k))},get selectedColor(){return i(Ap)},get position(){return i(xf)},$$events:{colorChange:k=>{i(Iu).length>0&&(i(Iu)[0].styles.decreasing.color=k.detail.rgba||k.detail.color)}}});var p0=m(qg,2),h0=Lt(()=>{var k;return((k=h[0])==null?void 0:k.color)||"#2563eb"});Sc(p0,{get show(){return i(Uu)},set show(k){b(Uu,H(k))},get selectedColor(){return i(h0)},get position(){return tp},$$events:{colorChange:k=>{h.length>0&&(h[0].color=k.detail.rgba||k.detail.color)}}});var m0=m(p0,2),Ug=Lt(()=>{var k;return((k=h[1])==null?void 0:k.color)||"#dc2626"});Sc(m0,{get show(){return i(wf)},set show(k){b(wf,H(k))},get selectedColor(){return i(Ug)},get position(){return Vs},$$events:{colorChange:k=>{h.length>1&&(h[1].color=k.detail.rgba||k.detail.color)}}});var Kv=m(m0,2),gg=Lt(()=>{var k;return((k=h[2])==null?void 0:k.color)||"#16a34a"});Sc(Kv,{get show(){return i(kn)},set show(k){b(kn,H(k))},get selectedColor(){return i(gg)},get position(){return i(Kn)},$$events:{colorChange:k=>{h.length>2&&(h[2].color=k.detail.rgba||k.detail.color)}}});var Xv=m(Kv,2);Sc(Xv,{get show(){return i(Bs)},set show(k){b(Bs,H(k))},get selectedColor(){return i(x)},get position(){return i(bo)},$$events:{colorChange:k=>{b(x,H(k.detail.rgba||k.detail.color))}}});var _g=m(Xv,2);Sc(_g,{get show(){return i(lo)},set show(k){b(lo,H(k))},get selectedColor(){return i(C)},get position(){return i(Qi)},$$events:{colorChange:k=>{b(C,H(k.detail.rgba||k.detail.color))}}});var Zv=m(_g,2);Sc(Zv,{get show(){return i(xr)},set show(k){b(xr,H(k))},get selectedColor(){return i(I)},get position(){return i(Ai)},$$events:{colorChange:k=>{b(I,H(k.detail.rgba||k.detail.color))}}});var yg=m(Zv,2);Sc(yg,{get show(){return i(ri)},set show(k){b(ri,H(k))},get selectedColor(){return i(A)},get position(){return i(Ti)},$$events:{colorChange:k=>{b(A,H(k.detail.rgba||k.detail.color))}}});var bg=m(yg,2),J=Lt(()=>{var k;return((k=h[i(eu)])==null?void 0:k.color)||"#2563eb"});Sc(bg,{get show(){return i(xd)},set show(k){b(xd,H(k))},get selectedColor(){return i(J)},get position(){return i(_u)},$$events:{colorChange:k=>{h.length>i(eu)&&(h[i(eu)].color=k.detail.rgba||k.detail.color,Nt())}}});var ms=m(bg,2),Ci=Lt(()=>{var k;return((k=i(Si)[i(rc)])==null?void 0:k.color)||"#FF6C37"});Sc(ms,{get show(){return i(ca)},set show(k){b(ca,H(k))},get selectedColor(){return i(Ci)},get position(){return i(vc)},$$events:{colorChange:k=>{i(Si).length>i(rc)&&(i(Si)[i(rc)].color=k.detail.rgba||k.detail.color,Xs(i(rc)))}}});var xi=m(ms,2),ko=Lt(()=>{var k;return((k=h[i(xa)])==null?void 0:k.color)||"#2563eb"});Sc(xi,{get show(){return i(Fd)},set show(k){b(Fd,H(k))},get selectedColor(){return i(ko)},get position(){return i(Tl)},$$events:{colorChange:k=>{h.length>i(xa)&&(h[i(xa)].color=k.detail.rgba||k.detail.color,Cs())}}});var cf=m(xi,2),Ac=Lt(()=>{var k;return((k=i(Qd)[i(ed)])==null?void 0:k.color)||"#2563eb"});Sc(cf,{get show(){return i(ku)},set show(k){b(ku,H(k))},get selectedColor(){return i(Ac)},get position(){return i(Qu)},$$events:{colorChange:k=>{i(Qd).length>i(ed)&&(i(Qd)[i(ed)].color=k.detail.rgba||k.detail.color,Gt(i(ed)))}}});var Bu=m(cf,2),dh=Lt(()=>(()=>{const k=Math.floor(i(Ke)/3),N=i(Ke)%3,R=i(hn)[k];if(!R)return"#2563eb";switch(N){case 0:return R.styles.k.color;case 1:return R.styles.d.color;case 2:return R.styles.j.color;default:return"#2563eb"}})());Sc(Bu,{get show(){return i(De)},set show(k){b(De,H(k))},get selectedColor(){return i(dh)},get position(){return i(Oe)},$$events:{colorChange:k=>{const N=Math.floor(i(Ke)/3),R=i(Ke)%3,F=i(hn)[N];if(console.log("🎨 KDJ Color change:",{groupIndex:N,lineIndex:R,newColor:k.detail.color,group:F}),F){switch(R){case 0:F.styles.k.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated K color to:",k.detail.color);break;case 1:F.styles.d.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated D color to:",k.detail.color);break;case 2:F.styles.j.color=k.detail.rgba||k.detail.color,console.log("🎨 Updated J color to:",k.detail.color);break}console.log("🎨 Updated KDJ group:",F),Cp(N)}}}});var Vp=m(Bu,2),mv=Lt(()=>(()=>{const k=i($r)[i(jl)];if(!k)return"#2563eb";switch(i(qi)){case"cr":return k.styles.cr.color;case"ma1":return k.styles.ma1.color;case"ma2":return k.styles.ma2.color;case"ma3":return k.styles.ma3.color;case"ma4":return k.styles.ma4.color;default:return"#2563eb"}})());Sc(Vp,{get show(){return i(yl)},set show(k){b(yl,H(k))},get selectedColor(){return i(mv)},get position(){return i(Dc)},$$events:{colorChange:k=>{const N=i($r)[i(jl)];if(N){switch(i(qi)){case"cr":N.styles.cr.color=k.detail.rgba||k.detail.color;break;case"ma1":N.styles.ma1.color=k.detail.rgba||k.detail.color;break;case"ma2":N.styles.ma2.color=k.detail.rgba||k.detail.color;break;case"ma3":N.styles.ma3.color=k.detail.rgba||k.detail.color;break;case"ma4":N.styles.ma4.color=k.detail.rgba||k.detail.color;break}Dd()}}}});var Qm=m(Vp,2),km=Lt(()=>{var k,N,R;return((R=(N=(k=i(Di)[i(Gf)])==null?void 0:k.styles)==null?void 0:N.rsi)==null?void 0:R.color)||"#8B5CF6"});Sc(Qm,{get show(){return i(td)},set show(k){b(td,H(k))},get selectedColor(){return i(km)},get position(){return i(sp)},$$events:{colorChange:k=>{i(Di).length>i(Gf)&&(i(Di)[i(Gf)].styles.rsi.color=k.detail.rgba||k.detail.color,cp(i(Gf)))}}});var Yp=m(Qm,2),rh=Lt(()=>{var k,N;return((N=(k=i(Di)[i(br)])==null?void 0:k.styles)==null?void 0:N.overboughtColor)||"#EF4444"});Sc(Yp,{get show(){return i(la)},set show(k){b(la,H(k))},get selectedColor(){return i(rh)},get position(){return i(El)},$$events:{colorChange:k=>{if(i(Di).length>i(br)){const N=k.detail.rgba||k.detail.color;i(Di)[i(br)].styles.overboughtColor=N,b(Di,H([...i(Di)])),cp(i(br))}}}});var ui=m(Yp,2),_d=Lt(()=>{var k,N;return((N=(k=i(Di)[i(br)])==null?void 0:k.styles)==null?void 0:N.oversoldColor)||"#22C55E"});Sc(ui,{get show(){return i(qu)},set show(k){b(qu,H(k))},get selectedColor(){return i(_d)},get position(){return i(Td)},$$events:{colorChange:k=>{if(i(Di).length>i(br)){const N=k.detail.rgba||k.detail.color;i(Di)[i(br)].styles.oversoldColor=N,b(Di,H([...i(Di)])),cp(i(br))}}}});var ql=m(ui,2),zn=Lt(()=>{var k,N;return((N=(k=i(Di)[i(br)])==null?void 0:k.styles)==null?void 0:N.middleLineColor)||"#6B7280"});Sc(ql,{get show(){return i(ki)},set show(k){b(ki,H(k))},get selectedColor(){return i(zn)},get position(){return i(sl)},$$events:{colorChange:k=>{if(i(Di).length>i(br)){const N=k.detail.rgba||k.detail.color;i(Di)[i(br)].styles.middleLineColor=N,b(Di,H([...i(Di)])),cp(i(br))}}}});var qn=m(ql,2),ua=Lt(()=>{var k,N,R;return((R=(N=(k=i(cd)[i(xl)])==null?void 0:k.styles)==null?void 0:N.duty)==null?void 0:R.color)||"#2962FF"});Sc(qn,{get show(){return i(kd)},set show(k){b(kd,H(k))},get selectedColor(){return i(ua)},get position(){return i(Jd)},$$events:{colorChange:k=>{i(cd).length>i(xl)&&(i(cd)[i(xl)].styles.duty.color=k.detail.rgba||k.detail.color,th(i(xl)))}}});var oa=m(qn,2),So=Lt(()=>{var k,N,R;return((R=(N=(k=i(cd)[i(xl)])==null?void 0:k.styles)==null?void 0:N.dLine)==null?void 0:R.color)||"#FF6D00"});Sc(oa,{get show(){return i(Zd)},set show(k){b(Zd,H(k))},get selectedColor(){return i(So)},get position(){return i(Jd)},$$events:{colorChange:k=>{i(cd).length>i(xl)&&(i(cd)[i(xl)].styles.dLine.color=k.detail.rgba||k.detail.color,th(i(xl)))}}});var dr=m(oa,2),Zl=Lt(()=>{var k,N;return((N=(k=i(cd)[i(xl)])==null?void 0:k.styles)==null?void 0:N.overboughtColor)||"#EF4444"});Sc(dr,{get show(){return i(gc)},set show(k){b(gc,H(k))},get selectedColor(){return i(Zl)},get position(){return i(Jd)},$$events:{colorChange:k=>{i(cd).length>i(xl)&&(i(cd)[i(xl)].styles.overboughtColor=k.detail.rgba||k.detail.color,th(i(xl)))}}});var Aa=m(dr,2),Za=Lt(()=>{var k,N;return((N=(k=i(cd)[i(xl)])==null?void 0:k.styles)==null?void 0:N.oversoldColor)||"#10B981"});Sc(Aa,{get show(){return i(jf)},set show(k){b(jf,H(k))},get selectedColor(){return i(Za)},get position(){return i(Jd)},$$events:{colorChange:k=>{i(cd).length>i(xl)&&(i(cd)[i(xl)].styles.oversoldColor=k.detail.rgba||k.detail.color,th(i(xl)))}}});var Va=m(Aa,2),da=Lt(()=>{var k,N;return((N=(k=i(cd)[i(xl)])==null?void 0:k.styles)==null?void 0:N.midLineColor)||"#6B7280"});return Sc(Va,{get show(){return i(Nf)},set show(k){b(Nf,H(k))},get selectedColor(){return i(da)},get position(){return i(Jd)},$$events:{colorChange:k=>{i(cd).length>i(xl)&&(i(cd)[i(xl)].styles.midLineColor=k.detail.rgba||k.detail.color,th(i(xl)))}}}),Y(s,Mp),Kd({clearCciGroups:tr,clearEmvGroups:Mr,clearMtmGroups:ou,clearObvGroups:md,clearPsyGroups:Kf,clearPvtGroups:ld,clearVolGroups:iu,clearWrGroups:Ed,clearRocGroups:Bf,clearRsiGroups:bh,clearStochasticGroups:u0})}$p(["click","change","input"]);function Jq(s,e,t){const n=s.target;b(e,parseInt(n.value)),t()}function Qq(s,e){s.target===s.currentTarget&&e(!1)}var eU=s=>s.stopPropagation(),tU=(s,e)=>e(!1),sU=(s,e)=>e("linear"),nU=(s,e)=>e("radial"),oU=(s,e,t)=>e(i(t).angle),iU=be('<button class="w-8 h-8 text-sm rounded border transition-colors flex items-center justify-center"> </button>'),rU=be('<div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Direction</label> <div class="grid grid-cols-4 gap-1 mb-3"></div> <div class="relative"><input type="range" min="0" max="360" class="w-full h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <div class="flex justify-between text-xs text-gray-500 mt-1"><span>0°</span> <span class="text-gray-300"> </span> <span>360°</span></div></div></div>'),aU=be('<button class="absolute -top-2 -right-1 w-3 h-3 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">×</button>'),lU=be('<div class="absolute top-0 w-4 h-6 border-2 rounded cursor-grab transform -translate-x-1/2"><!></div>'),cU=be('<button class="mt-2 w-full py-1 text-xs text-gray-400 border border-dashed border-gray-600 rounded hover:border-gray-400 hover:text-gray-300 transition-colors">+ Add Color Stop</button>'),uU=(s,e,t)=>e(i(t),parseInt(s.currentTarget.value)),dU=(s,e,t)=>e(s,i(t)),fU=(s,e,t)=>e(i(t),s.currentTarget.value),pU=(s,e,t)=>e(i(t),parseInt(s.currentTarget.value)),hU=be('<div class="mb-4 p-3 bg-[#1A1A1A] rounded border border-[#404040]"><h4 class="text-xs font-medium text-gray-300 mb-3"> </h4> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Position</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div> <div class="mb-3"><label class="block text-xs text-gray-400 mb-1">Color</label> <div class="flex items-center gap-2"><button class="w-8 h-8 rounded border-2 border-[#404040] cursor-pointer hover:border-gray-300 transition-colors"></button> <input type="text" class="flex-1 px-2 py-1 bg-[#404040] border border-[#555] rounded text-white text-xs focus:border-blue-500 focus:outline-none" placeholder="#000000"></div></div> <div><label class="block text-xs text-gray-400 mb-1">Opacity</label> <div class="flex items-center gap-2"><input type="range" min="0" max="100" class="flex-1 h-2 rounded appearance-none cursor-pointer bg-[#404040] svelte-e3zmk9"> <span class="text-xs text-gray-300 w-8"> </span></div></div></div>'),mU=be('<div class="fixed inset-0 z-[360000] flex items-center justify-center p-4"><div class="gradient-editor-container bg-[#2A2A2A] border border-[#404040] rounded-lg shadow-xl w-full max-w-sm max-h-[90vh] overflow-y-auto svelte-e3zmk9"><div class="p-4"><div class="mb-4"><div class="flex items-center justify-between mb-3"><h3 class="text-sm font-semibold text-white">Gradient Editor</h3> <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors">OK</button></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Gradient Type</label> <div class="flex gap-2"><button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Linear</button> <button class="flex-1 px-3 py-2 text-xs rounded transition-colors">Radial</button></div></div> <!> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Preview</label> <div class="w-full h-12 rounded border border-[#404040]"></div></div> <div class="mb-4"><label class="block text-xs text-gray-400 mb-2">Color Stops</label> <div class="relative"><div class="relative w-full h-6 rounded border border-[#404040] cursor-pointer"></div> <!></div></div> <!></div></div></div></div>'),vU=be("<!> <!>",1);function Yk(s,e){Yd(e,!1);const t=fm();let n=bi(e,"show",12,!1),o=bi(e,"initialGradient",24,()=>({type:"linear",direction:0,stops:[{position:0,color:"#ffffff",opacity:100},{position:100,color:"#000000",opacity:100}]})),r=bd(),a=bd(),l=!1,c=-1,f=bd(!1),u=bd(0),d=bd(o().type),h=bd(o().direction),p=bd([...o().stops]);const v=[{angle:0,label:"→",title:"Left to Right"},{angle:45,label:"↗",title:"Bottom-Left to Top-Right"},{angle:90,label:"↑",title:"Bottom to Top"},{angle:135,label:"↖",title:"Bottom-Right to Top-Left"},{angle:180,label:"←",title:"Right to Left"},{angle:225,label:"↙",title:"Top-Right to Bottom-Left"},{angle:270,label:"↓",title:"Top to Bottom"},{angle:315,label:"↘",title:"Top-Left to Bottom-Right"}];function x(){const se=[...i(p)].sort((Ne,Te)=>Ne.position-Te.position).map(Ne=>`${S(Ne.color,Ne.opacity/100)} ${Ne.position}%`);return i(d)==="linear"?`linear-gradient(${i(h)}deg, ${se.join(", ")})`:`radial-gradient(circle, ${se.join(", ")})`}function S(xe,se){const Ne=parseInt(xe.slice(1,3),16),Te=parseInt(xe.slice(3,5),16),Me=parseInt(xe.slice(5,7),16);return`rgba(${Ne}, ${Te}, ${Me}, ${se})`}function C(xe){b(d,xe),te()}function I(xe){b(h,xe),te()}function A(){if(i(p).length>=5)return;const xe=[...i(p)].sort((De,Oe)=>De.position-Oe.position);let se=50,Ne=0,Te=50;for(let De=0;De<xe.length-1;(De+=1)-1){const Oe=xe[De+1].position-xe[De].position;Oe>Ne&&(Ne=Oe,Te=xe[De].position+Oe/2)}Ne>10&&(se=Te);const Me={position:se,color:"#808080",opacity:100};b(p,[...i(p),Me]),b(u,i(p).length-1),te()}function P(xe){i(p).length<=2||(b(p,i(p).filter((se,Ne)=>Ne!==xe)),i(u)>=i(p).length&&b(u,i(p).length-1),te())}function T(xe,se){Ng(p,i(p)[xe].position=Math.max(0,Math.min(100,se))),te()}function j(xe,se){Ng(p,i(p)[xe].color=se),te()}function E(xe,se){Ng(p,i(p)[xe].opacity=Math.max(0,Math.min(100,se))),te()}function L(xe,se){const Ne=xe.target.getBoundingClientRect();Ne.right+10,Ne.top,b(u,se),b(f,!0)}function D(xe){i(u)>=0&&i(u)<i(p).length&&(Ng(p,i(p)[i(u)].color=xe.detail),te())}function X(xe){i(u)>=0&&i(u)<i(p).length&&(Ng(p,i(p)[i(u)].opacity=xe.detail),te())}function ne(xe){if(!i(a))return;const se=i(a).getBoundingClientRect(),Ne=xe.clientX-se.left,Te=Ne/se.width*100;let Me=-1;const De=8;if(i(p).forEach((Oe,Ke)=>{const kt=Oe.position/100*se.width;Math.abs(Ne-kt)<=De&&(Me=Ke)}),Me>=0)l=!0,c=Me,b(u,Me);else if(i(p).length<5){const Oe={position:Math.max(0,Math.min(100,Te)),color:"#808080",opacity:100};b(p,[...i(p),Oe]),b(u,i(p).length-1),te()}}function de(xe){if(!l||c<0||!i(a))return;const se=i(a).getBoundingClientRect(),Ne=xe.clientX-se.left,Te=Math.max(0,Math.min(100,Ne/se.width*100));Ng(p,i(p)[c].position=Te),te()}function ie(){l=!1,c=-1}function te(){const xe={type:i(d),direction:i(h),stops:[...i(p)],css:x()};t("gradientChange",xe)}Rg(()=>{typeof document<"u"&&(document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",ie))}),sm(()=>{te()}),_h(()=>jh(n()),()=>{n()&&typeof document<"u"&&setTimeout(()=>{document.addEventListener("mousemove",de),document.addEventListener("mouseup",ie)},0)}),_h(()=>jh(n()),()=>{!n()&&typeof document<"u"&&(document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",ie))}),c0(),$m();var le=vU(),pe=_s(le);Ve(pe,n,xe=>{var se=mU();se.__click=[Qq,n];var Ne=y(se);Ne.__click=[eU];var Te=y(Ne),Me=y(Te),De=y(Me),Oe=m(y(De),2);Oe.__click=[tU,n],_(De);var Ke=m(De,2),kt=m(y(Ke),2),pt=y(kt);pt.__click=[sU,C];var Rt=m(pt,2);Rt.__click=[nU,C],_(kt),_(Ke);var Ht=m(Ke,2);Ve(Ht,()=>i(d)==="linear",jt=>{var ft=rU(),ke=m(y(ft),2);qo(ke,5,()=>v,yi,(Gs,an)=>{var Es=iU();Es.__click=[oU,I,an];var Ns=y(Es,!0);_(Es),we(()=>{Dt(Es,"title",i(an).title),yr(Es,"border-blue-500",i(h)===i(an).angle),yr(Es,"bg-blue-600",i(h)===i(an).angle),yr(Es,"text-white",i(h)===i(an).angle),yr(Es,"border-[#404040]",i(h)!==i(an).angle),yr(Es,"text-gray-300",i(h)!==i(an).angle),st(Ns,i(an).label)}),Y(Gs,Es)}),_(ke);var Se=m(ke,2),Et=y(Se);Ts(Et),Et.__input=[Jq,h,te];var wt=m(Et,2),Ls=m(y(wt),2),tn=y(Ls);_(Ls),Oi(2),_(wt),_(Se),_(ft),we(()=>st(tn,`${i(h)??""}°`)),Fn(Et,()=>i(h),Gs=>b(h,Gs)),Y(jt,ft)});var Ft=m(Ht,2),zt=m(y(Ft),2);const ut=Mm(()=>`background: ${x()??""};`);_(Ft);var nt=m(Ft,2),Je=m(y(nt),2),it=y(Je);const ze=Mm(()=>`background: ${x()??""};`);it.__mousedown=ne,qo(it,5,()=>i(p),yi,(jt,ft,ke)=>{var Se=lU();Se.__click=wt=>{wt.stopPropagation(),b(u,ke)};var Et=y(Se);Ve(Et,()=>i(p).length>2,wt=>{var Ls=aU();Ls.__click=tn=>{tn.stopPropagation(),P(ke)},Y(wt,Ls)}),_(Se),we(()=>{Dt(Se,"style",`left: ${i(ft).position??""}%; background-color: ${i(ft).color??""};`),yr(Se,"border-white",ke===i(u)),yr(Se,"border-gray-500",ke!==i(u))}),Y(jt,Se)}),_(it),hp(it,jt=>b(a,jt),()=>i(a));var Ge=m(it,2);Ve(Ge,()=>i(p).length<5,jt=>{var ft=cU();ft.__click=A,Y(jt,ft)}),_(Je),_(nt);var xt=m(nt,2);Ve(xt,()=>i(u)>=0&&i(u)<i(p).length,jt=>{var ft=hU(),ke=y(ft),Se=y(ke);_(ke);var Et=m(ke,2),wt=m(y(Et),2),Ls=y(wt);Ts(Ls),Ls.__input=[uU,T,u];var tn=m(Ls,2),Gs=y(tn);_(tn),_(wt),_(Et);var an=m(Et,2),Es=m(y(an),2),Ns=y(Es);Ns.__click=[dU,L,u];var Hs=m(Ns,2);Ts(Hs),Hs.__input=[fU,j,u],_(Es),_(an);var ns=m(an,2),fs=m(y(ns),2),Mn=y(fs);Ts(Mn),Mn.__input=[pU,E,u];var po=m(Mn,2),Tn=y(po);_(po),_(fs),_(ns),_(ft),we(()=>{st(Se,`Stop ${i(u)+1} Configuration`),st(Gs,`${i(p)[i(u)].position??""}%`),Dt(Ns,"style",`background-color: ${i(p)[i(u)].color??""};`),st(Tn,`${i(p)[i(u)].opacity??""}%`)}),Fn(Ls,()=>i(p)[i(u)].position,Cn=>Ng(p,i(p)[i(u)].position=Cn)),Fn(Hs,()=>i(p)[i(u)].color,Cn=>Ng(p,i(p)[i(u)].color=Cn)),Fn(Mn,()=>i(p)[i(u)].opacity,Cn=>Ng(p,i(p)[i(u)].opacity=Cn)),Y(jt,ft)}),_(Me),_(Te),_(Ne),hp(Ne,jt=>b(r,jt),()=>i(r)),_(se),we(()=>{yr(pt,"bg-blue-600",i(d)==="linear"),yr(pt,"text-white",i(d)==="linear"),yr(pt,"bg-[#404040]",i(d)!=="linear"),yr(pt,"text-gray-300",i(d)!=="linear"),yr(Rt,"bg-blue-600",i(d)==="radial"),yr(Rt,"text-white",i(d)==="radial"),yr(Rt,"bg-[#404040]",i(d)!=="radial"),yr(Rt,"text-gray-300",i(d)!=="radial"),Dt(zt,"style",i(ut)),Dt(it,"style",i(ze))}),Y(xe,se)});var re=m(pe,2);Ve(re,()=>i(f),xe=>{var se=Mm(()=>{var Te;return((Te=i(p)[i(u)])==null?void 0:Te.color)||"#000000"}),Ne=Mm(()=>{var Te;return((Te=i(p)[i(u)])==null?void 0:Te.opacity)||100});sv(xe,{get show(){return i(f)},set show(Te){b(f,Te)},get selectedColor(){return i(se)},get opacity(){return i(Ne)},$$events:{colorChange:D,opacityChange:X},$$legacy:!0})}),Y(s,le),Kd()}$p(["click","input","mousedown"]);var Fg,Lg,n0,j_,By;const Qx=class Qx extends Map{constructor(t){super();G_(this,j_);G_(this,Fg,new Map);G_(this,Lg,__(0));G_(this,n0,__(0));if(t){for(var[n,o]of t)super.set(n,o);Ah(this,n0).v=super.size}}has(t){var n=Ah(this,Fg),o=n.get(t);if(o===void 0){var r=super.get(t);if(r!==void 0)o=__(0),n.set(t,o);else return i(Ah(this,Lg)),!1}return i(o),!0}forEach(t,n){q1(this,j_,By).call(this),super.forEach(t,n)}get(t){var n=Ah(this,Fg),o=n.get(t);if(o===void 0){var r=super.get(t);if(r!==void 0)o=__(0),n.set(t,o);else{i(Ah(this,Lg));return}}return i(o),super.get(t)}set(t,n){var d;var o=Ah(this,Fg),r=o.get(t),a=super.get(t),l=super.set(t,n),c=Ah(this,Lg);if(r===void 0)o.set(t,__(0)),b(Ah(this,n0),super.size),Y_(c);else if(a!==n){Y_(r);var f=c.reactions===null?null:new Set(c.reactions),u=f===null||!((d=r.reactions)!=null&&d.every(h=>f.has(h)));u&&Y_(c)}return l}delete(t){var n=Ah(this,Fg),o=n.get(t),r=super.delete(t);return o!==void 0&&(n.delete(t),b(Ah(this,n0),super.size),b(o,-1),Y_(Ah(this,Lg))),r}clear(){if(super.size!==0){super.clear();var t=Ah(this,Fg);b(Ah(this,n0),0);for(var n of t.values())b(n,-1);Y_(Ah(this,Lg)),t.clear()}}keys(){return i(Ah(this,Lg)),super.keys()}values(){return q1(this,j_,By).call(this),super.values()}entries(){return q1(this,j_,By).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return i(Ah(this,n0)),super.size}};Fg=new WeakMap,Lg=new WeakMap,n0=new WeakMap,j_=new WeakSet,By=function(){i(Ah(this,Lg));var t=Ah(this,Fg);if(Ah(this,n0).v!==t.size)for(var n of nw(Qx.prototype,this,"keys").call(this))t.has(n)||t.set(n,__(0));for(var[,o]of Ah(this,Fg))i(o)};let D1=Qx;function ux(s="dark"){return{version:2,canvas:{background:{mode:"solid",solid:{color:s==="dark"?"#070211":"#ffffff",alpha:1}},grid:{mode:"solid",solid:{color:s==="dark"?"#081115":"#F3F3F3",alpha:1}}}}}function _y(s){return JSON.parse(JSON.stringify(s))}function gU(s,e="dark"){const n={current:ux(e),pending:null,chartId:s};return Th(n)}function _U(s,e){if(typeof window>"u"||!window.localStorage)return;const t=`dutyai.chart.theme.${s}`;try{localStorage.setItem(t,JSON.stringify(e)),console.debug("THEME_PERSIST",{chartId:s,settings:e})}catch(n){console.error("Failed to persist theme settings:",n)}}function Kk(s,e="dark"){if(typeof window>"u"||!window.localStorage)return ux(e);const t=`dutyai.chart.theme.${s}`;try{const n=localStorage.getItem(t);if(n){const o=JSON.parse(n);if(o.version===2&&o.canvas)return console.debug("THEME_LOAD",{chartId:s,settings:o}),o}}catch(n){console.error("Failed to load persisted theme settings:",n)}return ux(e)}function yU(s){if(!s||!s.stops||s.stops.length===0)return"transparent";const e=s.stops.map(t=>{const n=t.alpha!==void 0?t.alpha:1,o=t.color;if(n!==1&&o.startsWith("#")){const r=parseInt(o.slice(1,3),16),a=parseInt(o.slice(3,5),16),l=parseInt(o.slice(5,7),16);return`rgba(${r}, ${a}, ${l}, ${n}) ${t.offset*100}%`}return`${o} ${t.offset*100}%`}).join(", ");if(s.type==="linear")return`linear-gradient(${s.angle||0}deg, ${e})`;if(s.type==="radial"){const t=s.cx||.5,n=s.cy||.5;return s.r,`radial-gradient(circle at ${t*100}% ${n*100}%, ${e})`}return"transparent"}function _2(s,e=1){if(!s.startsWith("#"))return s;const t=parseInt(s.slice(1,3),16),n=parseInt(s.slice(3,5),16),o=parseInt(s.slice(5,7),16);return`rgba(${t}, ${n}, ${o}, ${e})`}class Jx{constructor(e,t,n="dark"){Pe(this,"settingsStore");Pe(this,"chart");Pe(this,"chartId");Pe(this,"pendingThemeApplication",null);Pe(this,"chartUnsubscribe",null);Pe(this,"chartReadinessTimeout",null);Pe(this,"applyCanvasColorsFn",null);this.chartId=e,this.chart=t,this.settingsStore=gU(e,n),this.setupChartReadinessMonitoring(),this.loadPersistedSettings(n)}setApplyCanvasColorsFunction(e){this.applyCanvasColorsFn=e,console.log("🎨 Canvas colors function registered with theme manager")}applyCanvasColorsIfAvailable(){this.applyCanvasColorsFn&&(console.log("🎨 Applying canvas colors via theme manager"),this.applyCanvasColorsFn())}getStore(){return this.settingsStore}setupChartReadinessMonitoring(){this.chartUnsubscribe=this.chart.subscribe(e=>{e&&this.pendingThemeApplication&&(console.log("📊 Chart became available, applying pending theme"),this.applyTheme(this.pendingThemeApplication,{preview:!1}),this.pendingThemeApplication=null,this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null))})}setupChartReadinessTimeout(){this.chartReadinessTimeout&&clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=setTimeout(()=>{this.pendingThemeApplication&&(console.warn("📊 Chart readiness timeout - clearing pending theme application"),this.pendingThemeApplication=null),this.chartReadinessTimeout=null},1e4)}destroy(){this.chartUnsubscribe&&(this.chartUnsubscribe(),this.chartUnsubscribe=null),this.chartReadinessTimeout&&(clearTimeout(this.chartReadinessTimeout),this.chartReadinessTimeout=null)}loadPersistedSettings(e){let t=Kk(this.chartId,e);const n=this.loadFromLegacySystem();n&&(t=this.mergeThemeSettings(t,n)),this.settingsStore.update(r=>({...r,current:t})),vh(this.chart)?this.applyTheme(t,{preview:!1}):(console.log("📊 Chart not ready, deferring theme application"),this.pendingThemeApplication=t,this.setupChartReadinessTimeout())}loadFromLegacySystem(){var e,t,n,o,r,a;try{const l=localStorage.getItem("chart");if(!l)return null;const c=JSON.parse(l);if(!c.styles)return null;console.log("📦 Loading from localStorage - chart type:",(t=(e=c.styles)==null?void 0:e.candle)==null?void 0:t.type);const f={canvas:{background:{},grid:{}}},u=c.styles.backgroundType||"solid";u==="solid"&&c.styles.backgroundColor?f.canvas.background={mode:"solid",solid:{color:c.styles.backgroundColor,alpha:(c.styles.backgroundOpacity??100)/100}}:u==="gradient"&&c.styles.backgroundGradient&&(f.canvas.background={mode:"gradient",gradient:c.styles.backgroundGradient});const d=c.styles.gridType||"solid";if(d==="solid"){const h=((o=(n=c.styles.grid)==null?void 0:n.horizontal)==null?void 0:o.color)||((a=(r=c.styles.grid)==null?void 0:r.vertical)==null?void 0:a.color);if(h){const p=this.extractHexFromColor(h),v=c.styles.gridOpacity??100;f.canvas.grid={mode:"solid",solid:{color:p,alpha:v/100}}}}else d==="gradient"&&c.styles.gridGradient&&(f.canvas.grid={mode:"gradient",gradient:c.styles.gridGradient});return console.debug("LEGACY_LOAD",{loadedSettings:f}),f}catch(l){return console.error("Failed to load from legacy system:",l),null}}extractHexFromColor(e){if(e.startsWith("#"))return e;if(e.startsWith("rgba")||e.startsWith("rgb")){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){const n=parseInt(t[1]).toString(16).padStart(2,"0"),o=parseInt(t[2]).toString(16).padStart(2,"0"),r=parseInt(t[3]).toString(16).padStart(2,"0");return`#${n}${o}${r}`}}return e}mergeThemeSettings(e,t){var o,r;const n=_y(e);return(o=t.canvas)!=null&&o.background&&(n.canvas.background=t.canvas.background),(r=t.canvas)!=null&&r.grid&&(n.canvas.grid=t.canvas.grid),n}openModal(){this.settingsStore.update(e=>(e.pending===null&&(e.pending=_y(e.current),console.debug("THEME_MODAL_OPEN",{pending:e.pending})),e))}updatePending(e,t=!1){this.settingsStore.update(n=>(n.pending&&(e(n.pending),t&&this.applyTheme(n.pending,{preview:!0}),console.debug("THEME_PENDING_UPDATE",{pending:n.pending,applyPreview:t})),n))}confirm(){this.settingsStore.update(e=>(e.pending&&(e.current=_y(e.pending),_U(this.chartId,e.current),this.applyTheme(e.current,{preview:!1}),this.syncToLegacySystem(e.current),console.debug("THEME_COMMIT",{current:e.current}),e.pending=null),e))}syncToLegacySystem(e){var t,n;try{const o=localStorage.getItem("chart");if(o){const r=JSON.parse(o),a=(n=(t=r.styles)==null?void 0:t.candle)==null?void 0:n.type;if(console.log("🔒 Preserving chart type in syncToLegacySystem:",a),r.styles||(r.styles={}),e.canvas.background.mode==="solid"&&e.canvas.background.solid?(r.styles.backgroundColor=e.canvas.background.solid.color,r.styles.backgroundOpacity=(e.canvas.background.solid.alpha??1)*100,r.styles.backgroundType="solid",delete r.styles.backgroundGradient):e.canvas.background.mode==="gradient"&&e.canvas.background.gradient&&(r.styles.backgroundGradient=e.canvas.background.gradient,r.styles.backgroundType="gradient",delete r.styles.backgroundColor,delete r.styles.backgroundOpacity),e.canvas.grid.mode==="solid"&&e.canvas.grid.solid){r.styles.grid||(r.styles.grid={}),r.styles.grid.horizontal||(r.styles.grid.horizontal={}),r.styles.grid.vertical||(r.styles.grid.vertical={});const l=e.canvas.grid.solid.alpha!==void 0&&e.canvas.grid.solid.alpha!==1?_2(e.canvas.grid.solid.color,e.canvas.grid.solid.alpha):e.canvas.grid.solid.color;r.styles.grid.horizontal.color=l,r.styles.grid.vertical.color=l,r.styles.gridOpacity=(e.canvas.grid.solid.alpha??1)*100,r.styles.gridType="solid",delete r.styles.gridGradient}else e.canvas.grid.mode==="gradient"&&e.canvas.grid.gradient&&(r.styles.gridGradient=e.canvas.grid.gradient,r.styles.gridType="gradient");a&&(r.styles.candle||(r.styles.candle={}),r.styles.candle.type=a,console.log("✅ Restored chart type in syncToLegacySystem:",a)),localStorage.setItem("chart",JSON.stringify(r)),console.debug("LEGACY_SYNC",{syncedStyles:r.styles,preservedChartType:a})}}catch(o){console.error("Failed to sync to legacy system:",o)}}cancel(){this.settingsStore.update(e=>(e.pending&&(this.applyTheme(e.current,{preview:!1}),console.debug("THEME_CANCEL",{reverted_to:e.current}),e.pending=null),e))}reset(){this.settingsStore.update(e=>(e.pending&&(e.pending=_y(e.current),this.applyTheme(e.pending,{preview:!0}),console.debug("THEME_RESET",{pending:e.pending})),e))}applyTheme(e,t={}){const n=vh(this.chart);if(!n){console.log("📊 Chart not available for theme application, storing for later"),t.preview||(this.pendingThemeApplication=e,this.setupChartReadinessTimeout());return}if(!e||!e.canvas){console.warn("Invalid theme configuration, skipping application");return}const o=t.preview||!1;o?this.addPreviewWatermark():this.removePreviewWatermark();try{e.canvas.background&&this.applyBackground(e.canvas.background),o||(e.canvas.grid&&this.applyGrid(e.canvas.grid,n),setTimeout(()=>{this.applyCanvasColorsIfAvailable()},150)),console.debug("THEME_APPLIED",{theme:e.canvas,preview:o,chartId:this.chartId,appliedGrid:!o})}catch(r){console.error("Failed to apply theme:",r)}}applyBackground(e){const t=document.querySelector(".duty-main"),n=document.querySelector(".duty-widget");if(!t&&!n){console.warn("Chart containers not found for background application");return}if(!e){console.warn("Background configuration is null or undefined, skipping");return}let o;if(e.mode==="solid"&&e.solid&&e.solid.color){const r=e.solid.alpha!==void 0?e.solid.alpha:1;o=r!==1?_2(e.solid.color,r):e.solid.color}else e.mode==="gradient"&&e.gradient?o=yU(e.gradient):(console.warn("Invalid background configuration, using fallback"),o="#070211");console.log("🎨 Applying background:",o),[t,n].forEach(r=>{r&&(r.style.removeProperty("background"),r.style.removeProperty("background-color"),r.offsetHeight,r.style.background=o,r.style.backgroundColor=o,r.style.setProperty("--chart-background-color",o),r.offsetHeight)})}applyGrid(e,t){var a,l;const n=t.getStyles()??{},o=Ys.cloneDeep(n);try{const c=localStorage.getItem("chart");if(c){const f=JSON.parse(c);(l=(a=f.styles)==null?void 0:a.candle)!=null&&l.type&&(o.candle||(o.candle={}),o.candle.type=f.styles.candle.type,console.log("🔒 Preserved chart type in applyGrid:",f.styles.candle.type))}}catch(c){console.warn("Failed to preserve chart type:",c)}let r;if(e.mode==="solid"&&e.solid){const c=e.solid.alpha!==void 0?e.solid.alpha:1;r=c!==1?_2(e.solid.color,c):e.solid.color}else if(e.mode==="gradient"&&e.gradient){const c=e.gradient.stops;if(c.length===1)r=c[0].color;else if(c.length>=2)r=this.blendColors(c[0].color,c[c.length-1].color,.5);else{console.warn("Invalid grid gradient configuration");return}}else{console.warn("Invalid grid configuration");return}console.log("🎨 ThemeManager applying grid color:",r),Ys.set(o,"grid.horizontal.color",r),Ys.set(o,"grid.vertical.color",r),t.setStyles(o),console.log("✅ Applied grid styles directly:",{gridColor:r,gridConfig:o.grid})}blendColors(e,t,n){if(!e.startsWith("#")||!t.startsWith("#"))return e;const o=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),l=parseInt(t.slice(1,3),16),c=parseInt(t.slice(3,5),16),f=parseInt(t.slice(5,7),16),u=Math.round(o*(1-n)+l*n),d=Math.round(r*(1-n)+c*n),h=Math.round(a*(1-n)+f*n);return`#${u.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}`}addPreviewWatermark(){this.removePreviewWatermark();const e=document.querySelector(".duty-main");if(!e)return;const t=document.createElement("div");t.id="theme-preview-watermark",t.style.cssText=`
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
      pointer-events: none;
    `,t.textContent="PREVIEW",e.style.position="relative",e.appendChild(t)}removePreviewWatermark(){const e=document.getElementById("theme-preview-watermark");e&&e.remove()}getCurrentSettings(){return vh(this.settingsStore).current}getPendingSettings(){return vh(this.settingsStore).pending}isModalOpen(){return vh(this.settingsStore).pending!==null}resetToThemeDefaults(e){const t=Kk(this.chartId,e);this.settingsStore.update(n=>({...n,current:t,pending:null})),console.log("🔄 Reset TransactionalThemeManager to theme defaults:",e)}}function bU(s,e,t){const n=s.target.checked;b(e,H(n)),t({wick:n})}function xU(s,e,t){const n=s.target.value;b(e,H(n)),t({source:n})}function wU(s,e,t){const n="ATR";b(e,n),t({method:n})}function kU(s,e,t){const n=parseInt(s.target.value||"14",10),o=Math.max(1,isNaN(n)?14:n);b(e,H(o)),t({atrLength:o})}function SU(s,e,t){const n=s.target.value;b(e,H(n)),t({boxSizeMode:n})}function CU(s,e,t){const n=parseFloat(s.target.value||"1"),o=Math.max(1e-4,isNaN(n)?1:n);b(e,H(o)),t({boxSize:o})}function IU(s,e,t){const n=parseInt(s.target.value||"14",10),o=Math.max(1,isNaN(n)?14:n);b(e,H(o)),t({atrLength:o})}function PU(s,e,t){const n=parseInt(s.target.value||"3",10),o=Math.max(1,isNaN(n)?3:n);b(e,H(o)),t({reversalBoxes:o})}function MU(s,e,t){const n=s.target.value;b(e,H(n)),t({upColor:n})}function NU(s,e,t){const n=s.target.value;b(e,H(n)),t({downColor:n})}function AU(s,e,t,n,o,r,a,l){b(e,"ATR"),b(t,1),b(n,14),b(o,3),b(r,"#00E6D8"),b(a,"#FF4D4D"),l({boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"})}function TU(s,e,t,n,o,r,a,l,c,f){if(i(e)==="solid"){const u=s.target.getBoundingClientRect();b(t,H({x:u.right+10,y:u.top})),b(n,!0),b(o,!1),b(r,!1),b(a,!1),b(l,!1),b(c,!1),f()}else i(e)==="gradient"&&(b(r,!0),b(n,!1),b(o,!1),b(a,!1),b(l,!1),b(c,!1))}function FU(s,e,t,n,o,r,a,l,c){if(console.log("🔥 Grid picker clicked, type:",i(e)),i(e)==="solid"){const f=s.target.getBoundingClientRect();b(t,H({x:f.right+10,y:f.top})),console.log("🔥 Opening grid color picker at:",i(t)),b(n,!0),b(o,!1),b(r,!1),b(a,!1),b(l,!1),b(c,!1)}else i(e)==="gradient"&&(b(a,!0),b(n,!1),b(o,!1),b(r,!1),b(l,!1),b(c,!1))}function LU(s,e,t,n,o,r,a,l,c){const f=s.target.getBoundingClientRect();b(e,H({x:f.right+10,y:f.top})),b(t,!0),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c()}function EU(s,e,t,n,o,r,a,l,c){const f=s.target.getBoundingClientRect();b(e,H({x:f.right+10,y:f.top})),b(t,!0),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c()}function $U(s,e,t,n,o,r,a,l,c,f){const u=s.target.getBoundingClientRect();b(e,H({x:u.right+10,y:u.top})),b(t,!1),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c(),b(f,!0)}function DU(s,e,t,n,o,r,a,l,c,f){const u=s.target.getBoundingClientRect();b(e,H({x:u.right+10,y:u.top})),b(t,!1),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c(),b(f,!0)}function RU(s,e,t,n,o,r,a,l,c,f){const u=s.target.getBoundingClientRect();b(e,H({x:u.right+10,y:u.top})),b(t,!1),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c(),b(f,!0)}function jU(s,e,t,n,o,r,a,l,c,f){const u=s.target.getBoundingClientRect();b(e,H({x:u.right+10,y:u.top})),b(t,!1),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c(),b(f,!0)}function BU(s,e,t,n,o,r,a,l,c,f){const u=s.target.getBoundingClientRect();b(e,H({x:u.right+10,y:u.top})),b(t,!1),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c(),b(f,!0)}function OU(s,e,t,n,o,r,a,l,c,f){const u=s.target.getBoundingClientRect();b(e,H({x:u.right+10,y:u.top})),b(t,!1),b(n,!1),b(o,!1),b(r,!1),b(a,!1),b(l,!1),c(),b(f,!0)}function zU(s,e,t){b(e,!i(e)),t()}function VU(s,e,t){b(e,!i(e)),t()}function WU(s,e,t){b(e,!i(e)),t()}var HU=(s,e)=>b(e,"canvas"),qU=(s,e)=>b(e,"other"),UU=(s,e)=>b(e,"candle"),GU=(s,e)=>b(e,"renko"),YU=be('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Duty AI Renko</button>'),KU=(s,e)=>b(e,"pnf"),XU=be('<button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Point & Figure</button>'),ZU=be('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Canvas Settings</h4> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Background color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Grid color</label> <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3"><select class="select select-bordered select-sm w-full sm:w-32"><option>Solid</option><option>Gradient</option></select> <button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">X-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div> <div class="space-y-3"><label class="text-sm font-medium text-base-content/80">Y-Axis tick text color</label> <div class="flex items-center space-x-3"><button class="w-8 h-8 rounded border-2 border-base-300 cursor-pointer hover:border-primary transition-colors flex-shrink-0"></button></div></div></div>'),JU=(s,e,t)=>e(i(t).key,s.target.value),QU=be("<option> </option>"),eG=be('<select class="select select-bordered select-sm w-full sm:w-32 flex-shrink-0"></select>'),tG=(s,e,t)=>e(i(t).key,s.target.checked),sG=be('<input type="checkbox" class="toggle toggle-sm flex-shrink-0">'),nG=be('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 space-y-2 sm:space-y-0"><label class="text-sm font-medium text-base-content/80 flex-1"> </label> <!></div>'),oG=be('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Other Settings</h4> <div class="grid grid-cols-1 gap-4"></div></div>'),iG=be('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Candle Color Customization</h4> <div class="space-y-4"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Body</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-base-300"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Borders</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-3"><div class="flex items-center space-x-3 mb-3 sm:mb-0"><input type="checkbox" class="checkbox checkbox-sm"> <label class="text-sm font-medium text-base-content">Wick</label></div> <div class="flex space-x-3"><div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bull</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div> <div class="flex flex-col items-center space-y-1"><span class="text-xs text-base-content/60">Bear</span> <button class="w-8 h-8 rounded border-2 border-base-300 flex-shrink-0"></button></div></div></div></div></div>'),rG=be('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Duty AI Renko Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="flex items-center gap-3"><label class="flex items-center gap-2"><input type="checkbox" class="checkbox checkbox-sm"> <span>Wick</span></label></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Source</label> <select class="select select-bordered select-sm"><option>Close</option><option>Open</option><option>High</option><option>Low</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box size assignment method</label> <select class="select select-bordered select-sm" disabled><option>ATR</option></select></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR length</label> <input type="number" min="1" class="input input-bordered input-sm"></div></div></div></div>'),aG=be('<div class="flex flex-col gap-1"><label class="text-xs opacity-80">ATR Length</label> <input type="number" min="1" max="200" step="1" class="input input-bordered input-sm"></div>'),lG=be('<div class="flex flex-col gap-1"><label class="text-xs opacity-80"> </label> <input type="number" min="0.0001" step="0.1" class="input input-bordered input-sm"></div>'),cG=be('<div class="space-y-6 pb-6"><h4 class="text-lg font-semibold mb-4">Point & Figure Settings</h4> <div class="space-y-4 p-3 rounded-lg border border-base-300"><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div class="flex flex-col gap-1"><label class="text-xs opacity-80">Box Size Mode</label> <select class="select select-bordered select-sm"><option>ATR (Auto-fit)</option><option>Absolute (Price Units)</option><option>Percent (%)</option></select></div> <!></div> <div class="flex flex-col gap-1"><label class="text-xs opacity-80">Reversal Boxes (typical: 3)</label> <input type="number" min="1" max="10" step="1" class="input input-bordered input-sm w-32"></div> <div class="pt-2 border-t border-base-300"><h5 class="text-sm font-medium mb-3">Symbol Colors</h5> <div class="grid grid-cols-2 gap-4"><div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Up Column (X)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div> <div class="flex flex-col items-center gap-2"><label class="text-xs opacity-80">Down Column (O)</label> <div class="flex items-center gap-2"><input type="color" class="w-10 h-10 cursor-pointer rounded border border-base-300"> <span class="text-xs font-mono opacity-70"> </span></div></div></div></div> <div class="pt-4 border-t border-base-300"><button class="btn btn-sm btn-outline">Reset P&F to Defaults</button></div></div></div>'),uG=be('<div class="flex flex-col lg:flex-row min-h-[400px] max-h-[70vh] overflow-hidden"><div class="w-full lg:w-48 border-b lg:border-b-0 lg:border-r border-base-300 pb-4 lg:pb-0 lg:pr-4 mb-4 lg:mb-0"><div class="flex lg:flex-col space-x-2 lg:space-x-0 lg:space-y-2 overflow-x-auto lg:overflow-x-visible"><button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Canvas</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Other Settings</button> <button class="flex-shrink-0 lg:w-full text-left px-4 py-2 rounded-lg transition-colors duration-200">Candle</button> <!> <!></div></div> <div class="flex-1 lg:pl-6 overflow-y-auto"><!></div></div>'),dG=be("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function f4(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(c,"$save",t),o=()=>Ml(f,"$chart",t),r=()=>Ml(l,"$ctx",t);let a=bi(e,"show",15);const l=hd("ctx"),c=hd("save"),f=hd("chart"),u=new Jx("chart-settings",f,"dark");Rg(()=>{u.destroy()});let d=_e(!1),h=null;Xr(()=>{var Vs,kn,Kn,Bs,bo;if(a())console.log("🔧 Settings modal OPENED"),console.log("  - Current $save.styles.candle.type:",(kn=(Vs=n().styles)==null?void 0:Vs.candle)==null?void 0:kn.type),console.log("  - Current chart.getStyles().candle.type:",(bo=(Bs=(Kn=o())==null?void 0:Kn.getStyles())==null?void 0:Bs.candle)==null?void 0:bo.type),b(d,!1),u.openModal();else if(!i(d)){console.log("🚫 Settings modal CANCELLED"),h&&(clearTimeout(h),h=null);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}});let p=_e("canvas");const v=new D1;let x=_e(!1),S=_e(!1),C=_e(!1),I=_e(!1),A=_e(H({x:0,y:0})),P=_e(H({x:0,y:0})),T=_e(H({x:0,y:0})),j=_e(H({x:0,y:0})),E=_e(!1),L=_e(!1),D=_e(!1),X=_e(!1),ne=_e(!1),de=_e(!1),ie=_e(H({x:0,y:0})),te=_e(H({x:0,y:0})),le=_e(H({x:0,y:0})),pe=_e(H({x:0,y:0})),re=_e(H({x:0,y:0})),xe=_e(H({x:0,y:0})),se=_e(!1),Ne=_e(!1),Te=_e(!1),Me=_e(H(Ys.get(n().styles,"backgroundType")||"solid")),De=_e(H(Ys.get(n().styles,"gridType")||"solid")),Oe=_e(H(Ys.get(n().styles,"backgroundColor")||"#000000")),Ke=_e(H(Ys.get(n().styles,"grid.horizontal.color")||"#333333")),kt=_e(100),pt=_e(100),Rt=_e(100),Ht=_e(100);const Ft=[{key:"candle.priceMark.last.show",label:"Show Last Price",type:"switch",default:!0},{key:"candle.priceMark.high.show",label:"Show High Price",type:"switch",default:!0},{key:"candle.priceMark.low.show",label:"Show Low Price",type:"switch",default:!0},{key:"indicator.lastValueMark.show",label:"Show Indicator Last Value",type:"switch",default:!0},{key:"yAxis.reverse",label:"Reverse Coordinate",type:"switch",default:!1},{key:"grid.show",label:"Grid Show",type:"switch",default:!0}],zt=new D1;let ut=_e(!0),nt=_e(!0),Je=_e(!0),it=_e("#26a69a"),ze=_e("#ef5350"),Ge=_e("#26a69a"),xt=_e("#ef5350"),jt=_e("#26a69a"),ft=_e("#ef5350");const ke=Lt(()=>{var Vs,kn;return((kn=(Vs=n().styles)==null?void 0:Vs.candle)==null?void 0:kn.type)==="renko_atr"});let Se=_e(!1),Et=_e("close"),wt=_e("ATR"),Ls=_e(14);Xr(()=>{var kn,Kn;if(!a())return;const Vs=((Kn=(kn=n().styles)==null?void 0:kn.candle)==null?void 0:Kn.renko)||{};b(Se,!!Vs.wick),b(Et,H(Vs.source||"close")),b(wt,H(Vs.method||"ATR")),b(Ls,H(Math.max(1,(Vs.atrLength??14)|0)))}),Xr(()=>{a()&&(i(ke)?b(p,H(i(p)==="canvas"||i(p)==="other"?i(p):"renko")):i(p)==="renko"&&b(p,"candle"))});function tn(Vs){c.update(kn=>{kn.styles||(kn.styles={}),kn.styles.candle||(kn.styles.candle={});const Kn=kn.styles.candle;return Kn.renko||(Kn.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),Kn.renko={...Kn.renko,...Vs},kn})}const Gs=Lt(()=>{var Vs,kn;return((kn=(Vs=n().styles)==null?void 0:Vs.candle)==null?void 0:kn.type)==="point_and_figure"});let an=_e("ATR"),Es=_e(1),Ns=_e(14),Hs=_e(3),ns=_e("#00E6D8"),fs=_e("#FF4D4D");Xr(()=>{var kn,Kn;if(!a())return;const Vs=((Kn=(kn=n().styles)==null?void 0:kn.candle)==null?void 0:Kn.pnf)||{};b(an,H(Vs.boxSizeMode||"ATR")),b(Es,H(Math.max(1e-4,Vs.boxSize??1))),b(Ns,H(Math.max(1,Math.round(Vs.atrLength??14)))),b(Hs,H(Math.max(1,Math.round(Vs.reversalBoxes??3)))),b(ns,H(Vs.upColor||"#00E6D8")),b(fs,H(Vs.downColor||"#FF4D4D"))}),Xr(()=>{a()&&(i(Gs)?b(p,H(i(p)==="canvas"||i(p)==="other"?i(p):"pnf")):i(p)==="pnf"&&b(p,"candle"))});function Mn(Vs){c.update(kn=>{kn.styles||(kn.styles={}),kn.styles.candle||(kn.styles.candle={});const Kn=kn.styles.candle;return Kn.pnf||(Kn.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"}),Kn.pnf={...Kn.pnf,...Vs},kn})}let po=_e(H(Ys.get(n().styles,"backgroundGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]})),Tn=_e(H(Ys.get(n().styles,"gridGradient")||{type:"linear",direction:90,stops:[{position:0,color:"#2a2a2a",opacity:100},{position:100,color:"#3a3a3a",opacity:100}]}));function Cn(Vs){if(!Vs||!Vs.stops)return"";const Kn=[...Vs.stops].sort((Bs,bo)=>Bs.position-bo.position).map(Bs=>{const bo=parseInt(Bs.color.slice(1,3),16),lo=parseInt(Bs.color.slice(3,5),16),Qi=parseInt(Bs.color.slice(5,7),16),xr=Bs.opacity/100;return`rgba(${bo}, ${lo}, ${Qi}, ${xr}) ${Bs.position}%`});return Vs.type==="linear"?`linear-gradient(${Vs.direction}deg, ${Kn.join(", ")})`:`radial-gradient(circle, ${Kn.join(", ")})`}function go(Vs){if(typeof Vs=="string"&&Vs.startsWith("rgba(")){const kn=Vs.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(kn){const Kn=parseInt(kn[1]),Bs=parseInt(kn[2]),bo=parseInt(kn[3]);return`#${Kn.toString(16).padStart(2,"0")}${Bs.toString(16).padStart(2,"0")}${bo.toString(16).padStart(2,"0")}`}}return Vs}function no(){const Vs=n().theme;return{backgroundColor:Vs==="dark"?"#0A0F1A":"#ffffff",backgroundOpacity:100,gridColor:Vs==="dark"?"#111B2B":"#F3F3F3",gridOpacity:100,xAxisTickTextColor:Vs==="dark"?"#b3b3b3":"#000000",yAxisTickTextColor:Vs==="dark"?"#b3b3b3":"#000000"}}Xr(()=>{a()&&o()&&(console.log("📂 Modal opened - restoring saved values..."),b(Te,!0),v.clear(),Bo(),queueMicrotask(()=>{b(Te,!1),console.log("✅ Restoration complete - preview enabled")}))}),Xr(()=>{if(!o()||!a()||i(Te))return;const Vs=i(kt),kn=i(Oe),Kn=i(Me),Bs=i(po);Bs==null||Bs.stops,Bs==null||Bs.type,Bs==null||Bs.direction;const bo=document.querySelector(".duty-main"),lo=document.querySelector(".duty-widget");if(Kn==="solid"){const Qi=v.get("backgroundColor")||kn||no().backgroundColor,Ai=(v.get("backgroundOpacity")??Vs??100)/100,ri=sa(Qi,Ai);[bo,lo].forEach(Ti=>{if(Ti){const Eo=Ti;Eo.style.removeProperty("background"),Eo.style.removeProperty("background-color"),Eo.offsetHeight,Eo.style.setProperty("background",ri,"important"),Eo.style.setProperty("background-color",ri,"important"),Eo.style.setProperty("--chart-background-color",ri),Eo.offsetHeight}})}else if(Kn==="gradient"){const Qi=v.get("backgroundGradient")||Bs;let xr=Qi;(!Qi||!Qi.stops||Qi.stops.length===0)&&(xr={type:"linear",direction:90,stops:[{position:0,color:"#1a1a1a",opacity:100},{position:100,color:"#4a4a4a",opacity:100}]},v.set("backgroundGradient",xr));const Ai=xr.css||Cn(xr);[bo,lo].forEach(ri=>{if(ri){const Ti=ri;Ti.style.removeProperty("background"),Ti.style.removeProperty("background-color"),Ti.offsetHeight,Ti.style.setProperty("background",Ai,"important"),Ti.style.setProperty("background-color",Ai,"important"),Ti.style.setProperty("--chart-background-color",Ai),Ti.offsetHeight}})}}),Xr(()=>{var bo,lo,Qi,xr;if(!o()||!a()||i(Te))return;const Vs=i(pt),kn=i(Ke),Kn=i(De),Bs=i(Tn);if(Bs==null||Bs.stops,Bs==null||Bs.type,Bs==null||Bs.direction,console.log("🔄 Grid effect triggered:",{gridColorType:Kn,gridColor:kn,gridOpacity:Vs}),Kn==="solid"){const Ai=v.get("gridColor")||kn||no().gridColor,ri=v.get("gridOpacity")??Vs??100,Ti=sa(Ai,ri/100);console.log("🎨 Applying solid grid color via effect:",Ti);const Eo=o().getStyles()??{},hr=Ys.cloneDeep(Eo);(lo=(bo=n().styles)==null?void 0:bo.candle)!=null&&lo.type&&Ys.set(hr,"candle.type",n().styles.candle.type);const ei=Ys.get(Eo,"grid.show",!0);Ys.set(hr,"grid.show",ei),Ys.set(hr,"grid.horizontal.show",ei),Ys.set(hr,"grid.horizontal.color",Ti),Ys.set(hr,"grid.vertical.show",ei),Ys.set(hr,"grid.vertical.color",Ti),o().setStyles(hr)}else if(Kn==="gradient"){const Ai=v.get("gridGradient")||Bs;if(Ai&&Ai.stops&&Ai.stops.length>0){const ri=Ai.stops[0],Ti=Ai.stops[Ai.stops.length-1],Eo=Ju(ri.color,Ti.color,.5);console.log("🎨 Applying gradient grid color via effect:",Eo);const hr=o().getStyles()??{},ei=Ys.cloneDeep(hr);(xr=(Qi=n().styles)==null?void 0:Qi.candle)!=null&&xr.type&&Ys.set(ei,"candle.type",n().styles.candle.type);const ai=Ys.get(hr,"grid.show",!0);Ys.set(ei,"grid.show",ai),Ys.set(ei,"grid.horizontal.show",ai),Ys.set(ei,"grid.horizontal.color",Eo),Ys.set(ei,"grid.vertical.show",ai),Ys.set(ei,"grid.vertical.color",Eo),o().setStyles(ei)}}});function Bo(){const Vs=no();console.log("🔄 Restoring saved values...",{backgroundType:Ys.get(n().styles,"backgroundType"),gridType:Ys.get(n().styles,"gridType")});const kn=Ys.get(n().styles,"backgroundType")||"solid";if(b(Me,H(kn)),kn==="solid"){const vi=Ys.get(n().styles,"backgroundColor")||Vs.backgroundColor,_a=Ys.get(n().styles,"backgroundOpacity")||Vs.backgroundOpacity,dl=go(vi);b(Oe,H(dl)),b(kt,H(_a)),v.set("backgroundColor",dl),v.set("backgroundOpacity",_a),console.log("✅ Restored solid BG:",dl,"opacity:",_a)}else if(kn==="gradient"){const vi=Ys.get(n().styles,"backgroundGradient");vi&&(b(po,H({...vi})),v.set("backgroundGradient",vi),console.log("✅ Restored gradient BG:",vi))}const Kn=Ys.get(n().styles,"gridType")||"solid";if(b(De,H(Kn)),Kn==="solid"){const vi=Ys.get(n().styles,"grid.horizontal.color")||Ys.get(n().styles,"grid.vertical.color")||Vs.gridColor,_a=Ys.get(n().styles,"gridOpacity")||Vs.gridOpacity,dl=go(vi);b(Ke,H(dl)),b(pt,H(_a)),v.set("gridColor",dl),v.set("gridOpacity",_a),console.log("✅ Restored solid Grid:",dl,"opacity:",_a)}else if(Kn==="gradient"){const vi=Ys.get(n().styles,"gridGradient");vi&&(b(Tn,H({...vi})),v.set("gridGradient",vi),console.log("✅ Restored gradient Grid:",vi))}const Bs=Ys.get(n().styles,"xAxis.tickText.color")||Vs.xAxisTickTextColor,bo=Ys.get(n().styles,"xAxis.tickText.opacity")||100,lo=go(Bs);b(Rt,H(bo)),v.set("xAxisTickTextColor",lo),v.set("xAxisTickTextOpacity",bo);const Qi=Ys.get(n().styles,"yAxis.tickText.color")||Vs.yAxisTickTextColor,xr=Ys.get(n().styles,"yAxis.tickText.opacity")||100,Ai=go(Qi);b(Ht,H(xr)),v.set("yAxisTickTextColor",Ai),v.set("yAxisTickTextOpacity",xr);try{if(o()&&typeof o().getStyles=="function"){const vi=o().getStyles()??{},_a=Ys.get(vi,"xAxis.tickText.color"),dl=Ys.get(vi,"yAxis.tickText.color");if(_a){const ar=go(_a);v.set("xAxisTickTextColor",ar)}if(dl){const ar=go(dl);v.set("yAxisTickTextColor",ar)}}}catch(vi){console.warn("Failed to read live axis styles from chart:",vi)}const ri=Ys.get(n().styles,"candle.bar.upColor")||"#26a69a",Ti=Ys.get(n().styles,"candle.bar.downColor")||"#ef5350",Eo=Ys.get(n().styles,"candle.bar.upBorderColor")||"#26a69a",hr=Ys.get(n().styles,"candle.bar.downBorderColor")||"#ef5350",ei=Ys.get(n().styles,"candle.bar.upWickColor")||"#26a69a",ai=Ys.get(n().styles,"candle.bar.downWickColor")||"#ef5350";b(it,H(ri)),b(ze,H(Ti)),b(Ge,H(Eo)),b(xt,H(hr)),b(jt,H(ei)),b(ft,H(ai)),Ft.forEach(vi=>{const _a=Ys.get(n().styles,vi.key);_a!==void 0?zt.set(vi.key,_a):zt.set(vi.key,vi.default)})}function Vo(Vs){if(b(Oe,H(Vs.detail)),v.set("backgroundColor",Vs.detail),i(Me)==="solid"){const kn=i(kt)/100,Kn=sa(Vs.detail,kn),Bs=document.querySelector(".duty-main"),bo=document.querySelector(".duty-widget");[Bs,bo].forEach(lo=>{if(lo){const Qi=lo;Qi.style.removeProperty("background"),Qi.style.removeProperty("background-color"),Qi.style.removeProperty("background-image"),Qi.offsetHeight,Qi.style.setProperty("background",Kn,"important"),Qi.style.setProperty("background-color",Kn,"important"),Qi.style.setProperty("--chart-background-color",Kn),Qi.offsetHeight}})}}function Rl(Vs){if(b(kt,H(Vs.detail)),v.set("backgroundOpacity",Vs.detail),i(Me)==="solid"){const kn=v.get("backgroundColor")||i(Oe)||no().backgroundColor,Kn=Vs.detail/100,Bs=sa(kn,Kn),bo=document.querySelector(".duty-main"),lo=document.querySelector(".duty-widget");[bo,lo].forEach(Qi=>{if(Qi){const xr=Qi;xr.style.removeProperty("background"),xr.style.removeProperty("background-color"),xr.offsetHeight,xr.style.setProperty("background",Bs,"important"),xr.style.setProperty("background-color",Bs,"important"),xr.style.setProperty("--chart-background-color",Bs),xr.offsetHeight}})}}function aa(Vs){var lo,Qi;if(console.log("🎨 Grid color changed to:",Vs.detail),b(Ke,H(Vs.detail)),v.set("gridColor",Vs.detail),!o()){console.warn("⚠️ No chart available for grid color preview");return}const kn=sa(Vs.detail,i(pt)/100);console.log("🎨 Applying grid color:",kn);const Kn=o().getStyles()??{},Bs=Ys.cloneDeep(Kn);(Qi=(lo=n().styles)==null?void 0:lo.candle)!=null&&Qi.type&&Ys.set(Bs,"candle.type",n().styles.candle.type);const bo=Ys.get(Kn,"grid.show",!0);Ys.set(Bs,"grid.show",bo),Ys.set(Bs,"grid.horizontal.show",bo),Ys.set(Bs,"grid.horizontal.color",kn),Ys.set(Bs,"grid.vertical.show",bo),Ys.set(Bs,"grid.vertical.color",kn),console.log("🎨 New grid styles:",Bs.grid);try{o().setStyles(Bs),console.log("✅ Grid styles applied successfully")}catch(xr){console.error("❌ Failed to apply grid styles:",xr)}}function tl(Vs){var Qi,xr;if(console.log("🎨 Grid opacity changed to:",Vs.detail),b(pt,H(Vs.detail)),v.set("gridOpacity",Vs.detail),!o()){console.warn("⚠️ No chart available for grid opacity preview");return}const kn=v.get("gridColor")||i(Ke)||no().gridColor,Kn=sa(kn,Vs.detail/100);console.log("🎨 Applying grid opacity:",Kn);const Bs=o().getStyles()??{},bo=Ys.cloneDeep(Bs);(xr=(Qi=n().styles)==null?void 0:Qi.candle)!=null&&xr.type&&Ys.set(bo,"candle.type",n().styles.candle.type);const lo=Ys.get(Bs,"grid.show",!0);Ys.set(bo,"grid.show",lo),Ys.set(bo,"grid.horizontal.show",lo),Ys.set(bo,"grid.horizontal.color",Kn),Ys.set(bo,"grid.vertical.show",lo),Ys.set(bo,"grid.vertical.color",Kn),console.log("🎨 New grid styles:",bo.grid);try{o().setStyles(bo),console.log("✅ Grid opacity applied successfully")}catch(Ai){console.error("❌ Failed to apply grid opacity:",Ai)}}function Zr(Vs){if(v.set("xAxisTickTextColor",Vs.detail),o()){const kn=o().getStyles()??{},Kn=Ys.cloneDeep(kn);Ys.set(Kn,"xAxis.tickText.color",Vs.detail);const Bs=hf(Kn);o().setStyles(Bs)}}function zi(Vs){if(v.set("yAxisTickTextColor",Vs.detail),o()){const kn=o().getStyles()??{},Kn=Ys.cloneDeep(kn);Ys.set(Kn,"yAxis.tickText.color",Vs.detail);const Bs=hf(Kn);o().setStyles(Bs)}}function Nl(Vs){if(b(Rt,H(Vs.detail)),v.set("xAxisTickTextOpacity",Vs.detail),o()){const kn=o().getStyles()??{},Kn=Ys.cloneDeep(kn),Bs=v.get("xAxisTickTextColor")||no().xAxisTickTextColor,bo=Vs.detail/100,lo=sa(Bs,bo);Ys.set(Kn,"xAxis.tickText.color",lo);const Qi=hf(Kn);o().setStyles(Qi)}}function mu(Vs){if(b(Ht,H(Vs.detail)),v.set("yAxisTickTextOpacity",Vs.detail),o()){const kn=o().getStyles()??{},Kn=Ys.cloneDeep(kn),Bs=v.get("yAxisTickTextColor")||no().yAxisTickTextColor,bo=Vs.detail/100,lo=sa(Bs,bo);Ys.set(Kn,"yAxis.tickText.color",lo);const Qi=hf(Kn);o().setStyles(Qi)}}function Gc(Vs){if(b(po,H({...Vs.detail})),v.set("backgroundGradient",i(po)),i(Me)==="gradient"){const kn=document.querySelector(".duty-main"),Kn=document.querySelector(".duty-widget"),Bs=Cn(i(po));[kn,Kn].forEach(bo=>{if(bo){const lo=bo;lo.style.removeProperty("background"),lo.style.removeProperty("background-color"),lo.offsetHeight,lo.style.setProperty("background",Bs,"important"),lo.style.setProperty("background-color",Bs,"important"),lo.style.setProperty("--chart-background-color",Bs),lo.offsetHeight}})}}function du(Vs){var kn,Kn;if(b(Tn,H({...Vs.detail})),v.set("gridGradient",i(Tn)),o()&&i(De)==="gradient"){const Bs=Vs.detail.stops[0],bo=Vs.detail.stops[Vs.detail.stops.length-1],lo=Ju(Bs.color,bo.color,.5),Qi=o().getStyles()??{},xr=Ys.cloneDeep(Qi);(Kn=(kn=n().styles)==null?void 0:kn.candle)!=null&&Kn.type&&Ys.set(xr,"candle.type",n().styles.candle.type),Ys.set(xr,"grid.horizontal.color",lo),Ys.set(xr,"grid.vertical.color",lo);const Ai=hf(xr);o().setStyles(Ai)}}function Ju(Vs,kn,Kn){const Bs=Vs.replace("#",""),bo=kn.replace("#",""),lo=parseInt(Bs.substr(0,2),16),Qi=parseInt(Bs.substr(2,2),16),xr=parseInt(Bs.substr(4,2),16),Ai=parseInt(bo.substr(0,2),16),ri=parseInt(bo.substr(2,2),16),Ti=parseInt(bo.substr(4,2),16),Eo=Math.round(lo*(1-Kn)+Ai*Kn),hr=Math.round(Qi*(1-Kn)+ri*Kn),ei=Math.round(xr*(1-Kn)+Ti*Kn);return`#${Eo.toString(16).padStart(2,"0")}${hr.toString(16).padStart(2,"0")}${ei.toString(16).padStart(2,"0")}`}function rd(Vs,kn){var Qi,xr,Ai;const Kn=(Qi=o())==null?void 0:Qi.getStyles(),Bs=Ys.get(Kn,Vs);if(Vs==="yAxis.reverse")try{(xr=o())==null||xr.setPaneOptions({axis:{reverse:kn}}),c.update(ri=>(Ys.set(ri.styles,Vs,kn),ri)),zt.set(Vs,kn);return}catch(ri){console.warn("setPaneOptions not available, falling back to styles:",ri)}else if(Vs==="yAxis.type"){console.warn("yAxis.type is not supported in chart engine v10");return}if(Bs==kn)return;zt.set(Vs,kn),c.update(ri=>(Ys.set(ri.styles,Vs,kn),ri));const bo=lp(n().theme),lo=Ys.merge({},bo,n().styles);(Ai=o())==null||Ai.setStyles(hf(lo))}function Al(){let Vs=o();if(!Vs)return;const kn=Vs.getStyles()??{};Ft.forEach(Kn=>{const Bs=Ys.get(kn,Kn.key);Kn.key==="yAxis.reverse"?zt.set(Kn.key,Bs||!1):zt.set(Kn.key,Bs??Kn.default)})}function sa(Vs,kn){const Kn=Vs.replace("#",""),Bs=parseInt(Kn.substr(0,2),16),bo=parseInt(Kn.substr(2,2),16),lo=parseInt(Kn.substr(4,2),16);return`rgba(${Bs}, ${bo}, ${lo}, ${kn})`}function Vc(){b(E,!1),b(L,!1),b(D,!1),b(X,!1),b(ne,!1),b(de,!1)}function vu(Vs){b(it,H(Vs.detail)),jl()}function Qc(Vs){b(ze,H(Vs.detail)),jl()}function To(Vs){b(Ge,H(Vs.detail)),jl()}function ec(Vs){b(xt,H(Vs.detail)),jl()}function yl(Vs){b(jt,H(Vs.detail)),jl()}function Dc(Vs){b(ft,H(Vs.detail)),jl()}function jl(){h&&clearTimeout(h),h=setTimeout(()=>{var Bs,bo;if(!o())return;const Vs=o().getStyles()??{},kn=Ys.cloneDeep(Vs);(bo=(Bs=n().styles)==null?void 0:Bs.candle)!=null&&bo.type&&Ys.set(kn,"candle.type",n().styles.candle.type),i(ut)&&(Ys.set(kn,"candle.bar.upColor",i(it)),Ys.set(kn,"candle.bar.downColor",i(ze))),i(nt)&&(Ys.set(kn,"candle.bar.upBorderColor",i(Ge)),Ys.set(kn,"candle.bar.downBorderColor",i(xt))),i(Je)&&(Ys.set(kn,"candle.bar.upWickColor",i(jt)),Ys.set(kn,"candle.bar.downWickColor",i(ft)));const Kn=hf(kn);o().setStyles(Kn),h=null},16)}function qi(Vs){var kn,Kn;if(Vs==="confirm"){console.log("🔧 CONFIRM CLICKED - Using theme manager"),u.updatePending(Bs=>{if(i(Me)==="solid"){const bo=v.get("backgroundColor")||i(Oe),lo=v.get("backgroundOpacity")??i(kt);Bs.canvas.background.mode="solid",Bs.canvas.background.solid={color:bo,alpha:lo/100},delete Bs.canvas.background.gradient}else if(i(Me)==="gradient"){const bo=v.get("backgroundGradient")||i(po);Bs.canvas.background.mode="gradient",Bs.canvas.background.gradient=bo,delete Bs.canvas.background.solid}if(i(De)==="solid"){const bo=v.get("gridColor")||i(Ke),lo=v.get("gridOpacity")??i(pt);Bs.canvas.grid.mode="solid",Bs.canvas.grid.solid={color:bo,alpha:lo/100},delete Bs.canvas.grid.gradient}else if(i(De)==="gradient"){const bo=v.get("gridGradient")||i(Tn);Bs.canvas.grid.mode="gradient",Bs.canvas.grid.gradient=bo,delete Bs.canvas.grid.solid}}),c.update(Bs=>{var lo,Qi,xr,Ai,ri,Ti;Bs.styles||(Bs.styles={}),Bs.styles.candle||(Bs.styles.candle={}),Bs.styles.candle.bar||(Bs.styles.candle.bar={}),console.log("🎨 Saving settings - Background Type:",i(Me)),console.log("🎨 Saving settings - Grid Type:",i(De));const bo=(Qi=(lo=Bs.styles)==null?void 0:lo.candle)==null?void 0:Qi.type;if(bo&&console.log("🔒 Preserving chart type:",bo),i(Me)==="solid"){const Eo=v.get("backgroundColor")||i(Oe),hr=v.get("backgroundOpacity")??i(kt);console.log("🎨 Solid BG:",{bgColor:Eo,bgOpacity:hr}),Eo&&(Bs.styles.backgroundColor=Eo,Bs.styles.backgroundOpacity=hr,Bs.styles.backgroundType="solid",delete Bs.styles.backgroundGradient)}else if(i(Me)==="gradient"){const Eo=v.get("backgroundGradient")||i(po);console.log("🎨 Gradient BG:",Eo),Eo&&Eo.stops&&Eo.stops.length>0?(Bs.styles.backgroundGradient=Eo,Bs.styles.backgroundType="gradient",delete Bs.styles.backgroundColor,delete Bs.styles.backgroundOpacity,console.log("✅ Gradient background saved to $save.styles")):console.warn("⚠️ Invalid gradient data:",Eo)}if(i(De)==="solid"){const Eo=v.get("gridColor")||i(Ke),hr=v.get("gridOpacity")??100;console.log("🎨 Solid Grid:",{gridColor:Eo,gridOpacity:hr}),Eo&&(Bs.styles.grid||(Bs.styles.grid={}),Bs.styles.grid.horizontal||(Bs.styles.grid.horizontal={}),Bs.styles.grid.vertical||(Bs.styles.grid.vertical={}),Bs.styles.grid.horizontal.color=Eo,Bs.styles.grid.vertical.color=Eo,Bs.styles.gridOpacity=hr,Bs.styles.gridType="solid",delete Bs.styles.gridGradient)}else if(i(De)==="gradient"){const Eo=v.get("gridGradient")||i(Tn);console.log("🎨 Gradient Grid:",Eo),Eo&&Eo.stops&&Eo.stops.length>0?(Bs.styles.gridGradient=Eo,Bs.styles.gridType="gradient",(Ai=(xr=Bs.styles.grid)==null?void 0:xr.horizontal)==null||delete Ai.color,(Ti=(ri=Bs.styles.grid)==null?void 0:ri.vertical)==null||delete Ti.color,delete Bs.styles.gridOpacity,console.log("✅ Gradient grid saved to $save.styles")):console.warn("⚠️ Invalid grid gradient data:",Eo)}try{const Eo=v.get("xAxisTickTextColor")||no().xAxisTickTextColor,hr=v.get("xAxisTickTextOpacity")??100,ei=sa(Eo,hr/100);Ys.set(Bs.styles,"xAxis.tickText.color",ei),Ys.set(Bs.styles,"xAxis.tickText.opacity",hr);const ai=v.get("yAxisTickTextColor")||no().yAxisTickTextColor,vi=v.get("yAxisTickTextOpacity")??100,_a=sa(ai,vi/100);Ys.set(Bs.styles,"yAxis.tickText.color",_a),Ys.set(Bs.styles,"yAxis.tickText.opacity",vi)}catch(Eo){console.warn("Failed to persist axis tick text colors:",Eo)}try{const Eo=Bs.styles.candle.bar;i(ut)&&(Eo.upColor=i(it),Eo.downColor=i(ze)),i(nt)&&(Eo.upBorderColor=i(Ge),Eo.downBorderColor=i(xt)),i(Je)&&(Eo.upWickColor=i(jt),Eo.downWickColor=i(ft))}catch(Eo){console.warn("Failed to persist candle colors to $save.styles:",Eo)}return bo&&Bs.styles.candle&&(Bs.styles.candle.type=bo,console.log("✅ Restored chart type:",bo)),Bs}),u.confirm(),b(d,!0);try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors(),a(!1)}else if(Vs==="reset"){console.log("🔄 RESET CLICKED - Using theme manager"),u.reset();const Bs=no();b(Me,"solid"),b(kt,H(Bs.backgroundOpacity)),b(De,"solid"),b(pt,H(Bs.gridOpacity)),b(Rt,100),b(Ht,100),b(ut,!0),b(nt,!0),b(Je,!0),b(it,"#26a69a"),b(ze,"#ef5350"),b(Ge,"#26a69a"),b(xt,"#ef5350"),b(jt,"#26a69a"),b(ft,"#ef5350");try{const bo=no();if(c.update(lo=>{lo.styles||(lo.styles={}),lo.styles.backgroundType="solid",lo.styles.backgroundColor=bo.backgroundColor,lo.styles.backgroundOpacity=bo.backgroundOpacity,delete lo.styles.backgroundGradient,lo.styles.grid||(lo.styles.grid={}),lo.styles.grid.horizontal||(lo.styles.grid.horizontal={}),lo.styles.grid.vertical||(lo.styles.grid.vertical={}),lo.styles.gridType="solid",lo.styles.gridOpacity=bo.gridOpacity,lo.styles.grid.horizontal.color=bo.gridColor,lo.styles.grid.vertical.color=bo.gridColor,delete lo.styles.gridGradient;const Qi=bo.xAxisTickTextColor,xr=bo.yAxisTickTextColor,Ai=sa(Qi,1),ri=sa(xr,1);Ys.set(lo.styles,"xAxis.tickText.color",Ai),Ys.set(lo.styles,"xAxis.tickText.opacity",100),Ys.set(lo.styles,"yAxis.tickText.color",ri),Ys.set(lo.styles,"yAxis.tickText.opacity",100),lo.styles.candle||(lo.styles.candle={}),lo.styles.candle.bar||(lo.styles.candle.bar={});const Ti=lo.styles.candle.bar;return Ti.upColor=i(it),Ti.downColor=i(ze),Ti.upBorderColor=i(Ge),Ti.downBorderColor=i(xt),Ti.upWickColor=i(jt),Ti.downWickColor=i(ft),lo}),o()){const lo=lp(n().theme),Qi=Ys.merge({},lo,n().styles);(Kn=(kn=n().styles)==null?void 0:kn.candle)!=null&&Kn.type&&Ys.set(Qi,"candle.type",n().styles.candle.type);const xr=no().xAxisTickTextColor,Ai=no().yAxisTickTextColor,ri=sa(xr,1),Ti=sa(Ai,1);Ys.set(Qi,"xAxis.tickText.color",ri),Ys.set(Qi,"yAxis.tickText.color",Ti);const Eo=hf(Qi);o().setStyles(Eo);try{const hr=document.querySelector(".duty-main"),ei=document.querySelector(".duty-widget");[hr,ei].forEach(ai=>{if(ai){const vi=ai;vi.style.removeProperty("background"),vi.style.removeProperty("background-color"),vi.style.removeProperty("background-image"),vi.style.removeProperty("--chart-background-color")}})}catch{}try{window.__forceApplySavedCanvasColors=!0}catch{}r().applyCanvasColors&&r().applyCanvasColors()}}catch(bo){console.warn("Failed to apply default candle colors on reset:",bo)}Al(),v.clear(),v.set("backgroundColor",Bs.backgroundColor),v.set("backgroundOpacity",Bs.backgroundOpacity),v.set("gridColor",Bs.gridColor),v.set("gridOpacity",Bs.gridOpacity),v.set("xAxisTickTextColor",Bs.xAxisTickTextColor),v.set("xAxisTickTextOpacity",100),v.set("yAxisTickTextColor",Bs.yAxisTickTextColor),v.set("yAxisTickTextOpacity",100)}else console.log("🚫 CANCEL CLICKED - Using theme manager"),u.cancel(),a(!1);b(x,!1),b(S,!1),b(C,!1),b(I,!1),b(se,!1),b(Ne,!1),Vc()}var la=dG(),El=_s(la);uv(El,{title:"Chart Setting",width:"min(90vw, 700px)",get show(){return a()},set show(Vs){a(Vs)},get theme(){return n().theme},click:qi,buttons:["confirm","reset"],children:(Vs,kn)=>{var Kn=uG(),Bs=y(Kn),bo=y(Bs),lo=y(bo);lo.__click=[HU,p];var Qi=m(lo,2);Qi.__click=[qU,p];var xr=m(Qi,2);xr.__click=[UU,p];var Ai=m(xr,2);Ve(Ai,()=>i(ke),hr=>{var ei=YU();ei.__click=[GU,p],we(()=>{yr(ei,"bg-primary",i(p)==="renko"),yr(ei,"text-primary-content",i(p)==="renko"),yr(ei,"hover:bg-base-200",i(p)!=="renko")}),Y(hr,ei)});var ri=m(Ai,2);Ve(ri,()=>i(Gs),hr=>{var ei=XU();ei.__click=[KU,p],we(()=>{yr(ei,"bg-primary",i(p)==="pnf"),yr(ei,"text-primary-content",i(p)==="pnf"),yr(ei,"hover:bg-base-200",i(p)!=="pnf")}),Y(hr,ei)}),_(bo),_(Bs);var Ti=m(Bs,2),Eo=y(Ti);Ve(Eo,()=>i(p)==="canvas",hr=>{var ei=ZU(),ai=m(y(ei),2),vi=m(y(ai),2),_a=y(vi),dl=y(_a);dl.value=(dl.__value="solid")==null?"":"solid";var ar=m(dl);ar.value=(ar.__value="gradient")==null?"":"gradient",_(_a);var Jr=m(_a,2);const nl=Lt(()=>{var ca;return`background: ${(i(Me)==="gradient"?((ca=v.get("backgroundGradient"))==null?void 0:ca.css)||Cn(i(po))||"linear-gradient(0deg, #ffffff 0%, #000000 100%)":v.get("backgroundColor")||no().backgroundColor)??""}`});Jr.__click=[TU,Me,A,x,S,se,Ne,C,I,Vc],_(vi),_(ai);var tc=m(ai,2),mc=m(y(tc),2),gu=y(mc),Bl=y(gu);Bl.value=(Bl.__value="solid")==null?"":"solid";var Ui=m(Bl);Ui.value=(Ui.__value="gradient")==null?"":"gradient",_(gu);var Ol=m(gu,2);const fl=Lt(()=>{var ca;return`background: ${(i(De)==="gradient"?((ca=v.get("gridGradient"))==null?void 0:ca.css)||Cn(i(Tn))||"linear-gradient(0deg, #f3f3f3 0%, #1c1c1c 100%)":v.get("gridColor")||i(Ke)||no().gridColor)??""}`});Ol.__click=[FU,De,P,S,x,se,Ne,C,I],_(mc),_(tc);var bl=m(tc,2),Ua=m(y(bl),2),er=y(Ua);const ba=Lt(()=>`background: ${(v.get("xAxisTickTextColor")||no().xAxisTickTextColor)??""}`);er.__click=[LU,T,C,x,S,se,Ne,I,Vc],_(Ua),_(bl);var ol=m(bl,2),xd=m(y(ol),2),_u=y(xd);const eu=Lt(()=>`background: ${(v.get("yAxisTickTextColor")||no().yAxisTickTextColor)??""}`);_u.__click=[EU,j,I,x,S,se,Ne,C,Vc],_(xd),_(ol),_(ei),we(()=>{Dt(Jr,"style",i(nl)),Dt(Ol,"style",i(fl)),Dt(er,"style",i(ba)),Dt(_u,"style",i(eu))}),co(_a,()=>i(Me),ca=>b(Me,ca)),co(gu,()=>i(De),ca=>b(De,ca)),Y(hr,ei)},hr=>{var ei=Qs(),ai=_s(ei);Ve(ai,()=>i(p)==="other",vi=>{var _a=oG(),dl=m(y(_a),2);qo(dl,21,()=>Ft,yi,(ar,Jr)=>{var nl=nG(),tc=y(nl),mc=y(tc,!0);_(tc);var gu=m(tc,2);Ve(gu,()=>i(Jr).type==="select",Bl=>{var Ui=eG();L0(Ui,()=>zt.get(i(Jr).key)??i(Jr).default);var Ol;Ui.__change=[JU,rd,Jr],qo(Ui,21,()=>i(Jr).options||[],yi,(fl,bl)=>{var Ua=QU(),er={},ba=y(Ua,!0);_(Ua),we(()=>{er!==(er=i(bl).value)&&(Ua.value=(Ua.__value=i(bl).value)==null?"":i(bl).value),st(ba,i(bl).label)}),Y(fl,Ua)}),_(Ui),we(()=>{Ol!==(Ol=zt.get(i(Jr).key)??i(Jr).default)&&(Ui.value=(Ui.__value=zt.get(i(Jr).key)??i(Jr).default)==null?"":zt.get(i(Jr).key)??i(Jr).default,$g(Ui,zt.get(i(Jr).key)??i(Jr).default))}),Y(Bl,Ui)},Bl=>{var Ui=Qs(),Ol=_s(Ui);Ve(Ol,()=>i(Jr).type==="switch",fl=>{var bl=sG();Ts(bl),we(()=>qm(bl,zt.get(i(Jr).key)??i(Jr).default)),bl.__change=[tG,rd,Jr],Y(fl,bl)},null,!0),Y(Bl,Ui)}),_(nl),we(()=>st(mc,i(Jr).label)),Y(ar,nl)}),_(dl),_(_a),Y(vi,_a)},vi=>{var _a=Qs(),dl=_s(_a);Ve(dl,()=>i(p)==="candle",ar=>{var Jr=iG(),nl=m(y(Jr),2),tc=y(nl),mc=y(tc),gu=y(mc);Ts(gu),gu.__change=[zU,ut,jl],Oi(2),_(mc);var Bl=m(mc,2),Ui=y(Bl),Ol=m(y(Ui),2);Ol.__click=[$U,ie,x,S,C,I,se,Ne,Vc,E],_(Ui);var fl=m(Ui,2),bl=m(y(fl),2);bl.__click=[DU,te,x,S,C,I,se,Ne,Vc,L],_(fl),_(Bl),_(tc);var Ua=m(tc,2),er=y(Ua),ba=y(er);Ts(ba),ba.__change=[VU,nt,jl],Oi(2),_(er);var ol=m(er,2),xd=y(ol),_u=m(y(xd),2);_u.__click=[RU,le,x,S,C,I,se,Ne,Vc,D],_(xd);var eu=m(xd,2),ca=m(y(eu),2);ca.__click=[jU,pe,x,S,C,I,se,Ne,Vc,X],_(eu),_(ol),_(Ua);var vc=m(Ua,2),rc=y(vc),wd=y(rc);Ts(wd),wd.__change=[WU,Je,jl],Oi(2),_(rc);var zl=m(rc,2),Fd=y(zl),Tl=m(y(Fd),2);Tl.__click=[BU,re,x,S,C,I,se,Ne,Vc,ne],_(Fd);var xa=m(Fd,2),ku=m(y(xa),2);ku.__click=[OU,xe,x,S,C,I,se,Ne,Vc,de],_(xa),_(zl),_(vc),_(nl),_(Jr),we(()=>{Dt(Ol,"style",`background-color: ${i(it)??""}`),Ol.disabled=!i(ut),yr(Ol,"opacity-50",!i(ut)),Dt(bl,"style",`background-color: ${i(ze)??""}`),bl.disabled=!i(ut),yr(bl,"opacity-50",!i(ut)),Dt(_u,"style",`background-color: ${i(Ge)??""}`),_u.disabled=!i(nt),yr(_u,"opacity-50",!i(nt)),Dt(ca,"style",`background-color: ${i(xt)??""}`),ca.disabled=!i(nt),yr(ca,"opacity-50",!i(nt)),Dt(Tl,"style",`background-color: ${i(jt)??""}`),Tl.disabled=!i(Je),yr(Tl,"opacity-50",!i(Je)),Dt(ku,"style",`background-color: ${i(ft)??""}`),ku.disabled=!i(Je),yr(ku,"opacity-50",!i(Je))}),Wv(gu,()=>i(ut),Qu=>b(ut,Qu)),Wv(ba,()=>i(nt),Qu=>b(nt,Qu)),Wv(wd,()=>i(Je),Qu=>b(Je,Qu)),Y(ar,Jr)},ar=>{var Jr=Qs(),nl=_s(Jr);Ve(nl,()=>i(p)==="renko",tc=>{var mc=rG(),gu=m(y(mc),2),Bl=y(gu),Ui=y(Bl),Ol=y(Ui);Ts(Ol),Ol.__change=[bU,Se,tn],Oi(2),_(Ui),_(Bl);var fl=m(Bl,2),bl=y(fl),Ua=m(y(bl),2);Ua.__change=[xU,Et,tn];var er=y(Ua);er.value=(er.__value="close")==null?"":"close";var ba=m(er);ba.value=(ba.__value="open")==null?"":"open";var ol=m(ba);ol.value=(ol.__value="high")==null?"":"high";var xd=m(ol);xd.value=(xd.__value="low")==null?"":"low",_(Ua),_(bl);var _u=m(bl,2),eu=m(y(_u),2);eu.__change=[wU,wt,tn];var ca=y(eu);ca.value=(ca.__value="ATR")==null?"":"ATR",_(eu),_(_u);var vc=m(_u,2),rc=m(y(vc),2);Ts(rc),rc.__input=[kU,Ls,tn],_(vc),_(fl),_(gu),_(mc),we(()=>{qm(Ol,i(Se)),qf(rc,i(Ls))}),co(Ua,()=>i(Et),wd=>b(Et,wd)),co(eu,()=>i(wt),wd=>b(wt,wd)),Y(tc,mc)},tc=>{var mc=Qs(),gu=_s(mc);Ve(gu,()=>i(p)==="pnf",Bl=>{var Ui=cG(),Ol=m(y(Ui),2),fl=y(Ol),bl=y(fl),Ua=m(y(bl),2);Ua.__change=[SU,an,Mn];var er=y(Ua);er.value=(er.__value="ATR")==null?"":"ATR";var ba=m(er);ba.value=(ba.__value="absolute")==null?"":"absolute";var ol=m(ba);ol.value=(ol.__value="percent")==null?"":"percent",_(Ua),_(bl);var xd=m(bl,2);Ve(xd,()=>i(an)==="ATR",kd=>{var Zd=aG(),gc=m(y(Zd),2);Ts(gc),gc.__input=[IU,Ns,Mn],_(Zd),we(()=>qf(gc,i(Ns))),Y(kd,Zd)},kd=>{var Zd=lG(),gc=y(Zd),jf=y(gc);_(gc);var Nf=m(gc,2);Ts(Nf),Nf.__input=[CU,Es,Mn],_(Zd),we(()=>{st(jf,`Box Size ${(i(an)==="percent"?"(%)":"(Price)")??""}`),qf(Nf,i(Es))}),Y(kd,Zd)}),_(fl);var _u=m(fl,2),eu=m(y(_u),2);Ts(eu),eu.__input=[PU,Hs,Mn],_(_u);var ca=m(_u,2),vc=m(y(ca),2),rc=y(vc),wd=m(y(rc),2),zl=y(wd);Ts(zl),zl.__input=[MU,ns,Mn];var Fd=m(zl,2),Tl=y(Fd,!0);_(Fd),_(wd),_(rc);var xa=m(rc,2),ku=m(y(xa),2),Qu=y(ku);Ts(Qu),Qu.__input=[NU,fs,Mn];var ed=m(Qu,2),td=y(ed,!0);_(ed),_(ku),_(xa),_(vc),_(ca);var sp=m(ca,2),Gf=y(sp);Gf.__click=[AU,an,Es,Ns,Hs,ns,fs,Mn],_(sp),_(Ol),_(Ui),we(()=>{qf(eu,i(Hs)),st(Tl,i(ns)),st(td,i(fs))}),co(Ua,()=>i(an),kd=>b(an,kd)),Fn(zl,()=>i(ns),kd=>b(ns,kd)),Fn(Qu,()=>i(fs),kd=>b(fs,kd)),Y(Bl,Ui)},null,!0),Y(tc,mc)},!0),Y(ar,Jr)},!0),Y(vi,_a)},!0),Y(hr,ei)}),_(Ti),_(Kn),we(()=>{yr(lo,"bg-primary",i(p)==="canvas"),yr(lo,"text-primary-content",i(p)==="canvas"),yr(lo,"hover:bg-base-200",i(p)!=="canvas"),yr(Qi,"bg-primary",i(p)==="other"),yr(Qi,"text-primary-content",i(p)==="other"),yr(Qi,"hover:bg-base-200",i(p)!=="other"),yr(xr,"bg-primary",i(p)==="candle"),yr(xr,"text-primary-content",i(p)==="candle"),yr(xr,"hover:bg-base-200",i(p)!=="candle")}),Y(Vs,Kn)},$$slots:{default:!0}});var qu=m(El,2);Ve(qu,()=>i(x),Vs=>{var kn=Lt(()=>v.get("backgroundColor")||no().backgroundColor);sv(Vs,{get show(){return i(x)},set show(Kn){b(x,H(Kn))},get selectedColor(){return i(kn)},get opacity(){return i(kt)},$$events:{colorChange:Vo,opacityChange:Rl}})});var Td=m(qu,2);Ve(Td,()=>i(S),Vs=>{var kn=Lt(()=>v.get("gridColor")||i(Ke)||no().gridColor);sv(Vs,{get show(){return i(S)},set show(Kn){b(S,H(Kn))},get selectedColor(){return i(kn)},get opacity(){return i(pt)},$$events:{colorChange:aa,opacityChange:tl}})});var ki=m(Td,2);Ve(ki,()=>i(C),Vs=>{var kn=Lt(()=>v.get("xAxisTickTextColor")||no().xAxisTickTextColor);sv(Vs,{get show(){return i(C)},set show(Kn){b(C,H(Kn))},get selectedColor(){return i(kn)},get opacity(){return i(Rt)},$$events:{colorChange:Zr,opacityChange:Nl}})});var sl=m(ki,2);Ve(sl,()=>i(I),Vs=>{var kn=Lt(()=>v.get("yAxisTickTextColor")||no().yAxisTickTextColor);sv(Vs,{get show(){return i(I)},set show(Kn){b(I,H(Kn))},get selectedColor(){return i(kn)},get opacity(){return i(Ht)},$$events:{colorChange:zi,opacityChange:mu}})});var br=m(sl,2);Ve(br,()=>i(E),Vs=>{sv(Vs,{get show(){return i(E)},set show(kn){b(E,H(kn))},get selectedColor(){return i(it)},$$events:{colorChange:vu}})});var Wc=m(br,2);Ve(Wc,()=>i(L),Vs=>{sv(Vs,{get show(){return i(L)},set show(kn){b(L,H(kn))},get selectedColor(){return i(ze)},$$events:{colorChange:Qc}})});var Xd=m(Wc,2);Ve(Xd,()=>i(D),Vs=>{sv(Vs,{get show(){return i(D)},set show(kn){b(D,H(kn))},get selectedColor(){return i(Ge)},$$events:{colorChange:To}})});var Uf=m(Xd,2);Ve(Uf,()=>i(X),Vs=>{sv(Vs,{get show(){return i(X)},set show(kn){b(X,H(kn))},get selectedColor(){return i(xt)},$$events:{colorChange:ec}})});var xf=m(Uf,2);Ve(xf,()=>i(ne),Vs=>{sv(Vs,{get show(){return i(ne)},set show(kn){b(ne,H(kn))},get selectedColor(){return i(jt)},$$events:{colorChange:yl}})});var Uu=m(xf,2);Ve(Uu,()=>i(de),Vs=>{sv(Vs,{get show(){return i(de)},set show(kn){b(de,H(kn))},get selectedColor(){return i(ft)},$$events:{colorChange:Dc}})});var tp=m(Uu,2);Ve(tp,()=>i(se),Vs=>{Yk(Vs,{get show(){return i(se)},set show(kn){b(se,H(kn))},get initialGradient(){return i(po)},$$events:{gradientChange:Gc}})});var wf=m(tp,2);Ve(wf,()=>i(Ne),Vs=>{Yk(Vs,{get show(){return i(Ne)},set show(kn){b(Ne,H(kn))},get initialGradient(){return i(Tn)},$$events:{gradientChange:du}})}),Y(s,la),Kd()}$p(["click","change","input"]);var fG=(s,e,t)=>e(i(t).key,s.currentTarget.value),pG=be("<option> </option>"),hG=be('<select class="select select-bordered select-sm w-full"></select>'),mG=(s,e,t)=>e(i(t).key,s.currentTarget.checked),vG=be('<input type="checkbox" class="toggle toggle-sm">'),gG=be('<span class="text-base-content/70 text-right"> </span> <!>',1),_G=(s,e)=>b(e,!0),yG=be('<div class="grid grid-cols-[3fr_2fr_3fr_2fr] gap-5 mx-7 my-5 items-center"><!> <div class="col-span-4 mt-4 pt-4 border-t border-base-300"><button class="btn btn-outline btn-primary w-full">Chart Setting</button></div></div>'),bG=be("<!> <!>",1);function xG(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(f,"$chart",t),o=()=>Ml(c,"$save",t);let r=bi(e,"show",15);const a=new D1,l=hd("ctx"),c=hd("save"),f=hd("chart");let u=_e(!1);const d=[{key:"candle.priceMark.last.show",text:"last_price_show",component:"switch"},{key:"candle.priceMark.high.show",text:"high_price_show",component:"switch"},{key:"candle.priceMark.low.show",text:"low_price_show",component:"switch"},{key:"indicator.lastValueMark.show",text:"indicator_last_value_show",component:"switch"},{key:"yAxis.reverse",text:"reverse_coordinate",component:"switch"},{key:"grid.show",text:"grid_show",component:"switch"}];function h(P,T){var X,ne,de,ie,te,le,pe,re,xe,se,Ne,Te,Me,De,Oe,Ke,kt,pt,Rt,Ht,Ft,zt,ut,nt,Je,it,ze;const j=(X=n())==null?void 0:X.getStyles(),E=Ys.get(j,P);if(P==="yAxis.reverse")try{(ne=n())==null||ne.setPaneOptions({axis:{reverse:T}}),c.update(Ge=>(Ys.set(Ge.styles,P,T),Ge)),a.set(P,T);return}catch(Ge){console.warn("setPaneOptions not available, falling back to styles:",Ge)}if(E==T)return;a.set(P,T),c.update(Ge=>(Ys.set(Ge.styles,P,T),Ge));const L=lp(o().theme);console.log("🟡 Settings.update key:",P,"value:",T,"theme:",o().theme),console.log("🎨 theme axis colors:",(te=(ie=(de=L==null?void 0:L.xAxis)==null?void 0:de.tickText)==null?void 0:ie.style)==null?void 0:te.color,(re=(pe=(le=L==null?void 0:L.yAxis)==null?void 0:le.tickText)==null?void 0:pe.style)==null?void 0:re.color),console.log("💾 saved axis colors:",Ys.get(o().styles,"xAxis.tickText.style.color"),Ys.get(o().styles,"yAxis.tickText.style.color"));const D=Ys.merge({},L,o().styles);try{const Ge=(Ne=(se=(xe=L==null?void 0:L.xAxis)==null?void 0:xe.tickText)==null?void 0:se.style)==null?void 0:Ne.color,xt=(De=(Me=(Te=L==null?void 0:L.yAxis)==null?void 0:Te.tickText)==null?void 0:Me.style)==null?void 0:De.color;Ge&&((Ke=(Oe=D==null?void 0:D.xAxis)==null?void 0:Oe.tickText)!=null&&Ke.style)&&(D.xAxis.tickText.style.color=Ge,(kt=D==null?void 0:D.xAxis)!=null&&kt.tickText&&(delete D.xAxis.tickText.color,delete D.xAxis.tickText.opacity)),xt&&((Rt=(pt=D==null?void 0:D.yAxis)==null?void 0:pt.tickText)!=null&&Rt.style)&&(D.yAxis.tickText.style.color=xt,(Ht=D==null?void 0:D.yAxis)!=null&&Ht.tickText&&(delete D.yAxis.tickText.color,delete D.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors before apply:",(ut=(zt=(Ft=D==null?void 0:D.xAxis)==null?void 0:Ft.tickText)==null?void 0:zt.style)==null?void 0:ut.color,(it=(Je=(nt=D==null?void 0:D.yAxis)==null?void 0:nt.tickText)==null?void 0:Je.style)==null?void 0:it.color),(ze=n())==null||ze.setStyles(hf(D)),setTimeout(()=>{var ft,ke,Se,Et,wt,Ls,tn,Gs,an,Es,Ns;const Ge=((ft=n())==null?void 0:ft.getStyles())||{},xt=((Et=(Se=(ke=Ge==null?void 0:Ge.xAxis)==null?void 0:ke.tickText)==null?void 0:Se.style)==null?void 0:Et.color)??((Ls=(wt=Ge==null?void 0:Ge.xAxis)==null?void 0:wt.tickText)==null?void 0:Ls.color),jt=((an=(Gs=(tn=Ge==null?void 0:Ge.yAxis)==null?void 0:tn.tickText)==null?void 0:Gs.style)==null?void 0:an.color)??((Ns=(Es=Ge==null?void 0:Ge.yAxis)==null?void 0:Es.tickText)==null?void 0:Ns.color);console.log("✅ chart axis colors after apply:",xt,jt)},0)}function p(P){var T,j,E,L,D,X,ne,de,ie,te,le,pe,re,xe,se,Ne,Te,Me,De,Oe,Ke,kt,pt,Rt,Ht,Ft,zt;if(P==="reset"){const ut=(j=(T=o().styles)==null?void 0:T.candle)==null?void 0:j.type,nt=lp(o().theme),Je=o().styles;d.forEach(ze=>{Ys.unset(Je,ze.key)}),c.update(ze=>(ze.styles=Je,ut&&(ze.styles.candle||(ze.styles.candle={}),ze.styles.candle.type=ut),ze));const it=Ys.merge({},nt,o().styles);console.log("🟠 Settings.reset theme:",o().theme),console.log("🎨 default axis colors:",(D=(L=(E=nt==null?void 0:nt.xAxis)==null?void 0:E.tickText)==null?void 0:L.style)==null?void 0:D.color,(de=(ne=(X=nt==null?void 0:nt.yAxis)==null?void 0:X.tickText)==null?void 0:ne.style)==null?void 0:de.color);try{const ze=(le=(te=(ie=nt==null?void 0:nt.xAxis)==null?void 0:ie.tickText)==null?void 0:te.style)==null?void 0:le.color,Ge=(xe=(re=(pe=nt==null?void 0:nt.yAxis)==null?void 0:pe.tickText)==null?void 0:re.style)==null?void 0:xe.color;ze&&((Ne=(se=it==null?void 0:it.xAxis)==null?void 0:se.tickText)!=null&&Ne.style)&&(it.xAxis.tickText.style.color=ze,(Te=it==null?void 0:it.xAxis)!=null&&Te.tickText&&(delete it.xAxis.tickText.color,delete it.xAxis.tickText.opacity)),Ge&&((De=(Me=it==null?void 0:it.yAxis)==null?void 0:Me.tickText)!=null&&De.style)&&(it.yAxis.tickText.style.color=Ge,(Oe=it==null?void 0:it.yAxis)!=null&&Oe.tickText&&(delete it.yAxis.tickText.color,delete it.yAxis.tickText.opacity))}catch{}console.log("🔄 merged axis colors on reset:",(pt=(kt=(Ke=it==null?void 0:it.xAxis)==null?void 0:Ke.tickText)==null?void 0:kt.style)==null?void 0:pt.color,(Ft=(Ht=(Rt=it==null?void 0:it.yAxis)==null?void 0:Rt.tickText)==null?void 0:Ht.style)==null?void 0:Ft.color),(zt=n())==null||zt.setStyles(hf(it)),setTimeout(()=>{var jt,ft,ke,Se,Et,wt,Ls,tn,Gs,an,Es;const ze=((jt=n())==null?void 0:jt.getStyles())||{},Ge=((Se=(ke=(ft=ze==null?void 0:ze.xAxis)==null?void 0:ft.tickText)==null?void 0:ke.style)==null?void 0:Se.color)??((wt=(Et=ze==null?void 0:ze.xAxis)==null?void 0:Et.tickText)==null?void 0:wt.color),xt=((Gs=(tn=(Ls=ze==null?void 0:ze.yAxis)==null?void 0:Ls.tickText)==null?void 0:tn.style)==null?void 0:Gs.color)??((Es=(an=ze==null?void 0:ze.yAxis)==null?void 0:an.tickText)==null?void 0:Es.color);console.log("✅ chart axis colors after reset apply:",Ge,xt)},0),v()}else r(!1)}function v(){let P=n();if(!P)return;const T=P.getStyles()??{};d.forEach(j=>{const E=Ys.get(T,j.key);j.key==="yAxis.reverse"?a.set(j.key,E||!1):a.set(j.key,E)})}pp(l,P=>P.initDone).subscribe(v),Xr(()=>{r()&&n()&&v()});var S=bG(),C=_s(S),I=Lt(()=>D5());uv(C,{get title(){return i(I)},width:760,get show(){return r()},set show(P){r(P)},get theme(){return o().theme},click:p,buttons:["confirm","reset"],children:(P,T)=>{var j=yG(),E=y(j);qo(E,17,()=>d,yi,(X,ne)=>{var de=gG(),ie=_s(de),te=y(ie,!0);we(()=>{var pe;return st(te,(pe=Hv[i(ne).text])==null?void 0:pe.call(Hv))}),_(ie);var le=m(ie,2);Ve(le,()=>i(ne).component==="select",pe=>{var re=hG();L0(re,()=>a.get(i(ne).key));var xe;re.__change=[fG,h,ne],qo(re,21,()=>i(ne).dataSource||[],yi,(se,Ne)=>{var Te=pG(),Me={},De=y(Te,!0);we(()=>{var Oe;return st(De,((Oe=Hv[i(Ne).text])==null?void 0:Oe.call(Hv))||i(Ne).text)}),_(Te),we(()=>{Me!==(Me=i(Ne).key)&&(Te.value=(Te.__value=i(Ne).key)==null?"":i(Ne).key)}),Y(se,Te)}),_(re),we(()=>{xe!==(xe=a.get(i(ne).key))&&(re.value=(re.__value=a.get(i(ne).key))==null?"":a.get(i(ne).key),$g(re,a.get(i(ne).key)))}),Y(pe,re)},pe=>{var re=Qs(),xe=_s(re);Ve(xe,()=>i(ne).component==="switch",se=>{var Ne=vG();Ts(Ne),we(()=>qm(Ne,!!a.get(i(ne).key))),Ne.__change=[mG,h,ne],Y(se,Ne)},null,!0),Y(pe,re)}),Y(X,de)});var L=m(E,2),D=y(L);D.__click=[_G,u],_(L),_(j),Y(P,j)},$$slots:{default:!0}});var A=m(C,2);f4(A,{get show(){return i(u)},set show(P){b(u,H(P))}}),Y(s,S),Kd()}$p(["change","click"]);var wG=be('<img alt="screenshot" class="w-[500px] mt-5">');function kG(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(r,"$save",t);let o=bi(e,"show",15);const r=hd("save");function a(l){if(l==="confirm"){const c=document.createElement("a");c.download="screenshot",c.href=e.url,document.body.appendChild(c),c.click(),c.remove()}o(!1)}uv(s,{title:"Screenshot",width:540,get show(){return o()},set show(l){o(l)},get theme(){return n().theme},click:a,children:(l,c)=>{var f=wG();we(()=>Dt(f,"src",e.url)),Y(l,f)},$$slots:{default:!0}}),Kd()}function SG(s,e,t){const n=s.target;Fc(t,Ro(e).timezone=n.value,Ro(e))}var CG=be("<option> </option>"),IG=be('<div class="flex justify-center items-center min-h-[70px]"><select class="select select-bordered w-[70%]"></select></div>');function PG(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(r,"$save",t);let o=bi(e,"show",15);const r=hd("save"),a=LI();function l(f){o(!1)}var c=Lt(()=>F5());uv(s,{get title(){return i(c)},width:400,get show(){return o()},set show(f){o(f)},get theme(){return n().theme},click:l,children:(f,u)=>{var d=IG(),h=y(d);L0(h,()=>n().timezone);var p;h.__change=[SG,n,r],qo(h,21,()=>a,yi,(v,x)=>{var S=CG(),C={},I=y(S,!0);we(()=>st(I,Hv[i(x).text]())),_(S),we(()=>{C!==(C=i(x).key)&&(S.value=(S.__value=i(x).key)==null?"":i(x).key)}),Y(v,S)}),_(h),_(d),we(()=>{p!==(p=n().timezone)&&(h.value=(h.__value=n().timezone)==null?"":n().timezone,$g(h,n().timezone))}),Y(f,d)},$$slots:{default:!0}}),Kd()}$p(["change"]);var MG=be('<div class="warning-banner"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01M10.29 3.86l-7.6 13.17A1 1 0 003.53 19h16.94a1 1 0 00.84-1.5L13.71 3.86a1 1 0 00-1.73 0z"></path></svg> <span> </span></div>'),NG=(s,e,t)=>e(i(t),s),AG=be('<div class="selection-badge"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M13.3 4.3L6 11.6 2.7 8.3l1.1-1.1L6 9.4l6.2-6.2 1.1 1.1z" fill="currentColor" stroke="currentColor" stroke-width="0.5"></path></svg></div>'),TG=be('<button class="chart-card"><div class="card-bg"></div> <!> <div class="icon-container"><div class="icon-glow"></div> <!></div> <span class="chart-name"> </span> <div class="shine-effect"></div></button>'),FG=be(`<!> <div class="premium-grid"></div> <style>/* ===== PREMIUM GRID LAYOUT ===== */
    .premium-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      padding: 8px;
    }
    
    @media (max-width: 640px) {
      .premium-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding: 6px;
      }
    }
    
    @media (max-width: 480px) {
      .premium-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding: 8px;
      }
    }
    
    /* ===== PREMIUM CHART CARD ===== */
    .chart-card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px 12px 18px;
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      border: 1.5px solid rgba(255, 255, 255, 0.06);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    @media (max-width: 640px) {
      .chart-card {
        padding: 16px 10px 14px;
        gap: 8px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-card {
        padding: 22px 14px 20px;
        gap: 12px;
      }
    }
    
    /* Animated background */
    .card-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg,
        rgba(45, 55, 75, 0.3) 0%,
        rgba(30, 40, 60, 0.2) 50%,
        rgba(20, 30, 50, 0.3) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }
    
    /* Hover state */
    .chart-card:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.12);
      background: linear-gradient(145deg, 
        rgba(35, 45, 60, 0.7) 0%, 
        rgba(25, 35, 50, 0.5) 100%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        0 6px 20px rgba(20, 30, 50, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }
    
    .chart-card:hover .card-bg {
      opacity: 1;
    }
    
    /* Active state */
    .chart-card.active {
      background: linear-gradient(145deg, 
        rgba(30, 50, 80, 0.5) 0%,
        rgba(20, 40, 70, 0.4) 50%,
        rgba(25, 45, 75, 0.5) 100%);
      border-color: rgba(70, 120, 180, 0.4);
      box-shadow: 
        0 8px 32px rgba(30, 60, 100, 0.3),
        0 4px 16px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(60, 100, 150, 0.2);
      transform: translateY(-2px);
    }
    
    .chart-card.active .card-bg {
      background: linear-gradient(145deg,
        rgba(40, 65, 95, 0.4) 0%,
        rgba(30, 55, 85, 0.3) 50%,
        rgba(35, 60, 90, 0.4) 100%);
      opacity: 1;
    }
    
    .chart-card.active:hover {
      transform: translateY(-2px);
      border-color: rgba(80, 130, 190, 0.5);
    }
    
    /* ===== SELECTION BADGE ===== */
    .selection-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, 
        rgba(70, 120, 180, 0.9) 0%, 
        rgba(50, 100, 160, 0.85) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 
        0 3px 10px rgba(30, 60, 100, 0.4),
        0 1px 3px rgba(0, 0, 0, 0.3);
      animation: badgePulse 2.5s ease-in-out infinite;
    }
    
    @keyframes badgePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 
          0 3px 10px rgba(30, 60, 100, 0.4),
          0 1px 3px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 
          0 4px 14px rgba(40, 70, 110, 0.5),
          0 2px 5px rgba(0, 0, 0, 0.35);
      }
    }
    
    /* ===== ICON CONTAINER ===== */
    .icon-container {
      position: relative;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: linear-gradient(145deg, 
        rgba(40, 50, 65, 0.5) 0%, 
        rgba(25, 35, 50, 0.3) 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.06);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .icon-container {
        width: 42px;
        height: 42px;
        border-radius: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .icon-container {
        width: 50px;
        height: 50px;
        border-radius: 12px;
      }

    }
    
    .icon-glow {
      position: absolute;
      inset: -3px;
      background: linear-gradient(145deg, 
        rgba(50, 90, 140, 0.3) 0%, 
        rgba(35, 70, 120, 0.25) 100%);
      border-radius: inherit;
      opacity: 0;
      filter: blur(10px);
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .chart-card:hover .icon-container {
      transform: scale(1.06);
      background: linear-gradient(145deg, 
        rgba(50, 65, 85, 0.6) 0%, 
        rgba(35, 50, 70, 0.4) 100%);
      box-shadow: 
        0 5px 18px rgba(0, 0, 0, 0.25),
        0 2px 10px rgba(30, 50, 80, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .chart-card.active .icon-container {
      background: linear-gradient(145deg, 
        rgba(40, 70, 110, 0.5) 0%, 
        rgba(30, 60, 95, 0.4) 100%);
      border-color: rgba(70, 110, 160, 0.3);
      transform: scale(1.04);
      box-shadow: 
        0 6px 20px rgba(30, 60, 100, 0.3),
        0 3px 12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }
    
    .chart-card.active .icon-glow {
      opacity: 0.5;
    }
    
    /* ===== CHART ICON ===== */
    :global(.chart-icon) {
      color: rgba(200, 210, 230, 0.85);
      filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
    }
    
    .chart-card:hover :global(.chart-icon) {
      color: rgba(220, 230, 245, 0.95);
      filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.35));
      transform: scale(1.05);
    }
    
    .chart-card.active :global(.chart-icon) {
      color: rgba(160, 200, 240, 1);
      filter: drop-shadow(0 4px 12px rgba(40, 80, 130, 0.5));
      transform: scale(1.03);
    }
    
    /* ===== CHART NAME ===== */
    .chart-name {
      color: rgba(180, 190, 210, 0.85);
      font-size: 12px;
      font-weight: 500;
      text-align: center;
      line-height: 1.3;
      letter-spacing: 0.4px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }
    
    @media (max-width: 640px) {
      .chart-name {
        font-size: 11px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-name {
        font-size: 12.5px;
      }
    }
    
    .chart-card:hover .chart-name {
      color: rgba(210, 220, 235, 0.95);
      transform: translateY(-1px);
    }
    
    .chart-card.active .chart-name {
      color: rgba(180, 210, 240, 1);
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    /* ===== SHINE EFFECT ===== */
    .shine-effect {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        115deg,
        transparent 25%,
        rgba(255, 255, 255, 0.08) 45%,
        rgba(200, 220, 240, 0.12) 50%,
        rgba(255, 255, 255, 0.08) 55%,
        transparent 75%
      );
      transform: translateX(-100%) skewX(-15deg);
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chart-card:hover .shine-effect {
      transform: translateX(100%) skewX(-15deg);
    }
    
    /* ===== LIGHT THEME ===== */
    :global([data-theme="light"]) .chart-card {
      background: linear-gradient(145deg, #ffffff 0%, #f9fbff 100%);
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 2px 6px rgba(59, 130, 246, 0.08),
        0 1px 2px rgba(0, 0, 0, 0.04);
    }
    
    :global([data-theme="light"]) .card-bg {
      background: transparent;
      opacity: 0;
    }
    
    :global([data-theme="light"]) .chart-card:hover {
      background: #ffffff;
      border-color: rgba(59, 130, 246, 0.25);
      box-shadow: 
        0 6px 14px rgba(59, 130, 246, 0.10),
        0 3px 8px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active {
      background: linear-gradient(145deg, #e8f4ff 0%, #f0f8ff 100%);
      border-color: rgba(100, 150, 220, 0.4);
      box-shadow: 
        0 3px 10px rgba(100, 150, 220, 0.15),
        0 1px 4px rgba(0, 0, 0, 0.05);
    }
    
    :global([data-theme="light"]) .chart-card.active .card-bg {
      opacity: 0;
    }
    
    :global([data-theme="light"]) .icon-container {
      background: #f3f6fb;
      border-color: rgba(59, 130, 246, 0.15);
      box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.04),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card:hover .icon-container {
      background: #f0f2f5;
      box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.05),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .chart-card.active .icon-container {
      background: linear-gradient(145deg, #dceeff 0%, #e6f3ff 100%);
      border-color: rgba(100, 150, 220, 0.2);
      box-shadow: 
        0 2px 8px rgba(100, 150, 220, 0.12),
        inset 0 0.5px 0 rgba(255, 255, 255, 1);
    }
    
    :global([data-theme="light"]) .icon-glow {
      opacity: 0;
    }
    
    :global([data-theme="light"]) :global(.chart-icon) {
      color: #3b82f6;
      filter: drop-shadow(0 0.5px 1px rgba(59, 130, 246, 0.15));
    }
    
    :global([data-theme="light"]) .chart-card:hover :global(.chart-icon) {
      color: #2563eb;
      filter: drop-shadow(0 1px 2px rgba(37, 99, 235, 0.2));
    }
    
    :global([data-theme="light"]) .chart-card.active :global(.chart-icon) {
      color: #1d4ed8;
      filter: drop-shadow(0 1px 3px rgba(29, 78, 216, 0.3));
    }
    
    :global([data-theme="light"]) .chart-name {
      color: #334155;
    }
    
    :global([data-theme="light"]) .chart-card:hover .chart-name {
      color: #1f2937;
    }
    
    :global([data-theme="light"]) .chart-card.active .chart-name {
      color: #2563eb;
      font-weight: 600;
    }
    
    :global([data-theme="light"]) .selection-badge {
      background: linear-gradient(135deg, #5ba3f5 0%, #4a90e2 100%);
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 
        0 2px 8px rgba(74, 144, 226, 0.3),
        0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    /* ===== WARNING BANNER ===== */
    .warning-banner {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      margin-bottom: 16px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      color: rgba(251, 191, 36, 0.95);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
    }
    
    .warning-banner svg {
      flex-shrink: 0;
      color: rgba(251, 191, 36, 1);
      filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.3));
    }
    
    :global([data-theme="light"]) .warning-banner {
      background: linear-gradient(135deg, rgba(254, 243, 199, 0.9) 0%, rgba(254, 226, 226, 0.8) 100%);
      border-color: rgba(217, 119, 6, 0.3);
      color: rgba(146, 64, 14, 0.95);
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.15);
    }
    
    :global([data-theme="light"]) .warning-banner svg {
      color: rgba(217, 119, 6, 1);
      filter: drop-shadow(0 1px 2px rgba(217, 119, 6, 0.2));
    }
    
    /* ===== DISABLED STATE ===== */
    .chart-card.disabled {
      opacity: 0.35;
      cursor: not-allowed;
      pointer-events: auto;
    }
    
    .chart-card.disabled:hover {
      transform: none;
      opacity: 0.35;
      border-color: rgba(255, 255, 255, 0.06);
      background: linear-gradient(145deg, 
        rgba(30, 35, 48, 0.6) 0%, 
        rgba(20, 25, 35, 0.4) 100%);
      box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .chart-card.disabled .card-bg {
      opacity: 0;
    }
    
    .chart-card.disabled .icon-container {
      transform: none;
    }
    
    .chart-card.disabled .shine-effect {
      display: none;
    }
    
    :global([data-theme="light"]) .chart-card.disabled {
      opacity: 0.4;
    }
    
    :global([data-theme="light"]) .chart-card.disabled:hover {
      opacity: 0.4;
    }</style>`,1);function LG(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(a,"$save",t),o=()=>Ml(l,"$chart",t);let r=bi(e,"show",15);hd("ctx");const a=hd("save"),l=hd("chart"),c=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}],f=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"];function u(){return!n()||!n().saveInds?!1:Object.values(n().saveInds).some(x=>x&&f.includes(x.name))}let d=_e(!1),h=_e("");Xr(()=>{if(i(d)){const x=setTimeout(()=>{b(d,!1)},5e3);return()=>clearTimeout(x)}});function p(x,S){var P,T,j,E,L;const C=x;if(C.id==="renko_atr"&&u()){b(h,"You cannot use Duty AI Renko chart with AI Indicator"),b(d,!0),console.log("⚠️ Cannot add Renko chart: AI indicators present");return}if(C.id==="point_and_figure"&&u()){b(h,"You cannot use Point & Figure chart with AI Indicator"),b(d,!0),console.log("⚠️ Cannot add P&F chart: AI indicators present");return}if(console.log("📊 CHART TYPE CLICK:",C.id),S){const D=S.currentTarget;D.classList.add("selecting"),setTimeout(()=>{D.classList.remove("selecting")},800)}if(n().styles.candle||Fc(a,Ro(n).styles.candle={},Ro(n)),C.id==="line_chart"){console.log("🎯 Setting up LINE CHART (using area with transparent background)"),Fc(a,Ro(n).styles.candle.type="area",Ro(n));const D=((T=(P=n().styles.candle)==null?void 0:P.bar)==null?void 0:T.upColor)||"#2196F3";Fc(a,Ro(n).styles.candle.area={lineSize:2,lineColor:D,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:"rgba(0, 0, 0, 0)"},{offset:1,color:"rgba(0, 0, 0, 0)"}]},Ro(n)),Fc(a,Ro(n).styles.candle._isLineChart=!0,Ro(n)),console.log("✅ Line chart configured with area type and transparent background")}else if(C.id==="area"){console.log("🎯 Setting up AREA CHART with gradient fill"),Fc(a,Ro(n).styles.candle.type="area",Ro(n)),delete n().styles.candle._isLineChart;const D=((E=(j=n().styles.candle)==null?void 0:j.bar)==null?void 0:E.upColor)||"#2196F3";Fc(a,Ro(n).styles.candle.area={lineSize:2,lineColor:D,lineSmooth:!1,value:"close",backgroundColor:[{offset:0,color:D+"60"},{offset:1,color:D+"10"}]},Ro(n)),console.log("✅ Area chart configured with gradient background")}else C.id==="renko_atr"?(console.log("🎯 Setting up RENKO (ATR) chart"),Fc(a,Ro(n).styles.candle.type="renko_atr",Ro(n)),n().styles.candle.renko||Fc(a,Ro(n).styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1},Ro(n)),delete n().styles.candle._isLineChart,delete n().styles.candle.area):C.id==="point_and_figure"?(console.log("🎯 Setting up POINT & FIGURE chart"),Fc(a,Ro(n).styles.candle.type="point_and_figure",Ro(n)),n().styles.candle.pnf||Fc(a,Ro(n).styles.candle.pnf={boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"},Ro(n)),delete n().styles.candle._isLineChart,delete n().styles.candle.area):(Fc(a,Ro(n).styles.candle.type=C.id,Ro(n)),delete n().styles.candle._isLineChart,delete n().styles.candle.area);console.log("✅ Saved chart type to $save.styles:",{type:n().styles.candle.type,isLineChart:n().styles.candle._isLineChart,area:n().styles.candle.area});const I=lp(n().theme);Ys.merge(I,n().styles);const A=hf(I);(L=o())==null||L.setStyles(A),console.log("✅ Styles applied to chart with processing"),r(!1)}function v(){var S,C,I,A;return(C=(S=n().styles)==null?void 0:S.candle)!=null&&C._isLineChart?"line_chart":((A=(I=n().styles)==null?void 0:I.candle)==null?void 0:A.type)||"renko_atr"}uv(s,{get show(){return r()},set show(x){r(x)},title:"Chart Type",width:"550px",maxWidth:"95vw",maxHeight:"90vh",buttons:[],get theme(){return n().theme},class:"chart-type-modal-premium",children:(x,S)=>{var C=FG(),I=_s(C);Ve(I,()=>i(d),P=>{var T=MG(),j=m(y(T),2),E=y(j,!0);_(j),_(T),we(()=>st(E,i(h))),Sv(3,T,()=>$1,()=>({y:-20,duration:300})),Y(P,T)});var A=m(I,2);qo(A,21,()=>c,P=>P.id,(P,T)=>{var j=TG();const E=Lt(()=>(i(T).id==="renko_atr"||i(T).id==="point_and_figure")&&u());j.__click=[NG,p,T];const L=Lt(()=>v()===i(T).id);we(()=>yr(j,"active",i(L)));var D=m(y(j),2);Ve(D,()=>v()===i(T).id&&!i(E),te=>{var le=AG();Y(te,le)});var X=m(D,2),ne=m(y(X),2);nv(ne,{get name(){return i(T).icon},size:26,class:"chart-icon"}),_(X);var de=m(X,2),ie=y(de,!0);_(de),Oi(2),_(j),we(()=>{yr(j,"disabled",i(E)),st(ie,i(T).name)}),Y(P,j)}),_(A),Oi(2),Y(x,C)},$$slots:{default:!0}}),Kd()}$p(["click"]);function Xk(s,e){e(!1)}var EG=(s,e,t,n,o)=>!i(e)&&!i(t)&&n(i(o).is_main,i(o).name),$G=be('<div class="particle svelte-uswuii"></div>'),DG=be('<div class="stream-line svelte-uswuii"></div>'),RG=be('<div class="segment svelte-uswuii"></div>'),jG=be('<div class="ai-loading-overlay svelte-uswuii"><div class="particles-container svelte-uswuii"></div> <div class="data-stream svelte-uswuii"></div> <div class="loading-content svelte-uswuii"><div class="ai-loader-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg> <div class="ai-pulse-ring ring-1 svelte-uswuii"></div> <div class="ai-pulse-ring ring-2 svelte-uswuii"></div> <div class="ai-pulse-ring ring-3 svelte-uswuii"></div> <div class="ai-glow svelte-uswuii"></div></div> <div class="loading-text-container svelte-uswuii"><div class="loading-text-main svelte-uswuii"> </div> <div class="loading-text-sub svelte-uswuii"> </div></div> <div class="progress-container svelte-uswuii"><div class="progress-bar svelte-uswuii"><div class="progress-glow svelte-uswuii"></div></div> <div class="progress-segments svelte-uswuii"></div></div> <div class="progress-info svelte-uswuii"><div class="progress-percentage svelte-uswuii"> </div> <div class="progress-status svelte-uswuii"> </div></div></div></div>'),BG=(s,e,t,n)=>{s.stopPropagation(),e(i(t),i(n).name)},OG=(s,e,t,n)=>{s.stopPropagation(),e(i(t),i(n).name)},zG=be('<div class="indicator-actions svelte-uswuii"><button class="action-btn edit-btn svelte-uswuii" title="Edit Parameters"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" class="svelte-uswuii"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" class="svelte-uswuii"></path></svg></button> <button class="action-btn delete-btn svelte-uswuii" title="Remove Indicator"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="3 6 5 6 21 6" class="svelte-uswuii"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" class="svelte-uswuii"></path><line x1="10" y1="11" x2="10" y2="17" class="svelte-uswuii"></line><line x1="14" y1="11" x2="14" y2="17" class="svelte-uswuii"></line></svg></button></div>'),VG=be('<div class="add-indicator-hint svelte-uswuii"><span class="svelte-uswuii">Click to add</span></div>'),WG=be('<div class="indicator-icon svelte-uswuii"> </div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii"> </span></div> <!>',1),HG=be("<div><!></div>"),qG=s=>s.stopPropagation(),UG=be('<div class="ai-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="ai-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="ai-modal-title"><div class="ai-background svelte-uswuii"><div class="orb orb-1 svelte-uswuii"></div> <div class="orb orb-2 svelte-uswuii"></div> <div class="orb orb-3 svelte-uswuii"></div></div> <div class="ai-content svelte-uswuii"><div class="ai-header svelte-uswuii"><div class="ai-header-left svelte-uswuii"><div class="ai-icon-small svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="ai-header-text svelte-uswuii"><h2 id="ai-modal-title" class="ai-title svelte-uswuii">AI Indicators</h2> <p class="ai-subtitle svelte-uswuii">Duty AI Advanced Algorithm - Exclusive for Pro Traders</p></div></div> <button class="close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button></div> <div class="indicators-list svelte-uswuii"><!> <div class="indicator-row coming-soon-item disabled svelte-uswuii"><div class="coming-soon-glitter-bg svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-1 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-2 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-3 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-4 svelte-uswuii"></div> <div class="coming-soon-glitter-particle coming-soon-glitter-5 svelte-uswuii"></div> <div class="coming-soon-shine-sweep svelte-uswuii"></div> <div class="indicator-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-uswuii"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-uswuii"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-uswuii"></line></svg></div> <div class="indicator-info svelte-uswuii"><span class="indicator-name svelte-uswuii">AI Trade Entry Finder and more AI algorithms</span> <span class="coming-soon-badge svelte-uswuii">Coming Soon</span></div></div></div> <div class="ai-powered-footer svelte-uswuii"><span class="powered-by-text svelte-uswuii">Powered by Duty AI</span></div></div></div>',1),GG=(s,e)=>b(e,!1),YG=(s,e)=>b(e,!1),KG=be('<div class="premium-modal-backdrop svelte-uswuii" role="presentation"></div> <div class="premium-modal-container svelte-uswuii" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title"><div class="premium-background svelte-uswuii"><div class="premium-orb premium-orb-1 svelte-uswuii"></div> <div class="premium-orb premium-orb-2 svelte-uswuii"></div></div> <div class="premium-content svelte-uswuii"><button class="premium-close-btn svelte-uswuii" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="18" y1="6" x2="6" y2="18" class="svelte-uswuii"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-uswuii"></line></svg></button> <div class="premium-icon-wrapper svelte-uswuii"><div class="premium-icon svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-uswuii"></path><path d="M2 17l10 5 10-5" class="svelte-uswuii"></path><path d="M2 12l10 5 10-5" class="svelte-uswuii"></path></svg> <div class="premium-icon-glow svelte-uswuii"></div></div></div> <h2 id="premium-modal-title" class="premium-title svelte-uswuii">Premium Feature</h2> <p class="premium-message svelte-uswuii">AI Indicators are exclusive premium features. Upgrade to Premium to unlock all advanced AI algorithms and take your trading to the next level.</p> <div class="premium-features svelte-uswuii"><div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Smart Money Footprint</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Trap Hunter (Bull/Bear Traps)</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">Volcanic Move & Eruptions</span></div> <div class="premium-feature-item svelte-uswuii"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><polyline points="20 6 9 17 4 12" class="svelte-uswuii"></polyline></svg> <span class="svelte-uswuii">More AI algorithms coming soon</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-uswuii"><span class="svelte-uswuii">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uswuii"><line x1="5" y1="12" x2="19" y2="12" class="svelte-uswuii"></line><polyline points="12 5 19 12 12 19" class="svelte-uswuii"></polyline></svg></a></div></div>',1),XG=be("<!> <!>",1);function ZG(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(u,"$chart",t),o=()=>Ml(f,"$save",t),r=()=>Ml(c,"$ctx",t),a=()=>Ml(jg,"$userPreferences",t);let l=bi(e,"show",15);const c=hd("ctx"),f=hd("save"),u=hd("chart"),d=[{name:"SMART_MONEY",title:"Smart Money Footprint",is_main:!0,icon:"💰"},{name:"TRAP_HUNTER",title:"Trap Hunter (Bull/Bear Traps)",is_main:!0,icon:"🎯"},{name:"VOLCANIC",title:"Volcanic Move (Pressure) (Sub Pane)",is_main:!1,icon:"🌋"},{name:"VOLCANIC_SIG",title:"Volcanic Eruptions (Markers) (Main Pane)",is_main:!0,icon:"💥"}],h={SMART_MONEY:[{text:"💰 Tracking institutional money flow",duration:1200,subtext:"Analyzing whale movements..."},{text:"🏦 Detecting smart money footprints",duration:1400,subtext:"Scanning OBV patterns..."},{text:"📊 Mapping accumulation zones",duration:1300,subtext:"Identifying support levels..."},{text:"🎯 Calculating volume clusters",duration:1200,subtext:"Processing 50,000+ trades..."},{text:"✨ Activating smart money radar",duration:1100,subtext:"Deploying footprint tracker..."}],TRAP_HUNTER:[{text:"🎯 Scanning for bull/bear traps",duration:1200,subtext:"Analyzing false breakouts..."},{text:"🔍 Detecting fake-out patterns",duration:1400,subtext:"Identifying trap signatures..."},{text:"⚡ Processing trap probability",duration:1300,subtext:"Calculating 20+ parameters..."},{text:"🚨 Mapping high-risk zones",duration:1200,subtext:"Locating potential traps..."},{text:"✨ Deploying trap detection AI",duration:1100,subtext:"Activating alert system..."}],VOLCANIC:[{text:"🌋 Measuring market pressure",duration:1200,subtext:"Analyzing momentum buildup..."},{text:"📈 Detecting volcanic activity",duration:1400,subtext:"Scanning RSI extremes..."},{text:"🔥 Calculating eruption zones",duration:1300,subtext:"Processing pressure levels..."},{text:"⚡ Tracking explosive setups",duration:1200,subtext:"Identifying breakout points..."},{text:"✨ Activating volcanic pressure",duration:1100,subtext:"Deploying oscillator..."}],VOLCANIC_SIG:[{text:"💥 Detecting eruption signals",duration:1200,subtext:"Scanning breakout candles..."},{text:"🚀 Analyzing explosive moves",duration:1400,subtext:"Tracking volume spikes..."},{text:"🎯 Mapping eruption markers",duration:1300,subtext:"Calculating signal strength..."},{text:"⚡ Processing 15,000+ patterns",duration:1200,subtext:"Identifying eruption points..."},{text:"✨ Deploying eruption markers",duration:1100,subtext:"Activating signal alerts..."}]};let p=_e(H(new Set));Xr(()=>{var xe;if(!l()||!n())return;const pe=n();let re=new Set;try{const se=((xe=pe.getIndicators)==null?void 0:xe.call(pe))??[];re=new Set(se.map(Ne=>Ne.name)),console.log("🧠 AI Modal (open) - from chart.getIndicators:",se)}catch(se){console.warn("⚠️ AI Modal - getIndicators failed, falling back to saveInds",se);const Ne=new Set;o()&&o().saveInds&&Object.values(o().saveInds).forEach(Te=>{Te&&Te.name&&Ne.add(Te.name)}),re=Ne}console.log("🔄 AI Modal (open) - selectedIndicators updated:",Array.from(re)),console.log("🔍 AI Modal (open) - saveInds keys:",Object.keys(o().saveInds||{})),b(p,H(re))});let v=_e(!1),x=_e(null),S=_e(0),C=_e(0),I=_e(H([])),A=_e(!1);Xr(()=>{!r().modalIndCfg&&i(v)&&(b(v,!1),setTimeout(()=>{l(!0)},100))}),Xr(()=>{l()&&(console.log("🎯 AI Modal opened"),console.log("📊 Current saveInds:",o().saveInds),console.log("✅ AI indicators in chart:",Array.from(i(p))))});function P(){var re,xe,se;if(((xe=(re=o().styles)==null?void 0:re.candle)==null?void 0:xe.type)==="renko_atr"){console.log("🔄 Converting Renko chart to Candlestick for AI indicator compatibility"),Fc(f,Ro(o).styles.candle.type="candle_solid",Ro(o)),delete o().styles.candle.renko,delete o().styles.candle._isLineChart,delete o().styles.candle.area;const Ne=lp(o().theme);Ys.merge(Ne,o().styles);const Te=hf(Ne);return(se=n())==null||se.setStyles(Te),console.log("✅ Chart converted from Renko to Candlestick"),!0}return!1}async function T(pe){b(x,H(pe)),b(S,0),b(C,0),b(I,H(h[pe]||h.SMART_MONEY));for(let re=0;re<i(I).length;(re+=1)-1){b(S,H(re));const xe=i(I)[re],se=re/i(I).length*100,Ne=(re+1)/i(I).length*100,Te=20,Me=xe.duration/Te;for(let De=0;De<=Te;(De+=1)-1)b(C,se+(Ne-se)*(De/Te)),await new Promise(Oe=>setTimeout(Oe,Me))}b(x,null),b(S,0),b(C,0),b(I,H([]))}function j(){var re;const pe=(re=a())==null?void 0:re.data;return pe?pe.isPremium===!0||pe.isTrial===!0:!1}async function E(pe,re){if(!j()){console.log("🔒 Premium access required for AI indicators"),b(A,!0);return}await T(re),P();let xe=!1;if(re==="SMART_MONEY"){const se="candle_pane",Ne=n();if(Ne&&Ne.createIndicator({name:"SMART_MONEY",calcParams:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},!0,{id:se})){const Me={name:"SMART_MONEY",pane_id:se,params:[40,5,25,14,20,1.2,.03,20,.2,.6,1,20,1]},De=`${se}_SMART_MONEY`;f.update(Oe=>(Oe.saveInds[De]=Me,Oe)),Hm(),qp.recordAddIndicator(re,se,Me.params,De),xe=!0}}else if(re==="TRAP_HUNTER"){const se="candle_pane",Ne=n();if(Ne){const Te=[20,20,3,5,20,1.3,7e-4,.35,.5,1,5];if(Ne.createIndicator({name:"TRAP_HUNTER",calcParams:Te},!0,{id:se})){const De={name:"TRAP_HUNTER",pane_id:se,params:Te},Oe=`${se}_TRAP_HUNTER`;f.update(Ke=>(Ke.saveInds[Oe]=De,Ke)),Hm(),qp.recordAddIndicator(re,se,De.params,Oe),xe=!0}}}else if(re==="VOLCANIC"){const se="pane_VOLCANIC",Ne=n();if(Ne){const Te=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(Ne.createIndicator({name:"VOLCANIC",calcParams:Te},!1,{id:se})){const De={name:"VOLCANIC",pane_id:se,params:Te},Oe=`${se}_VOLCANIC`;f.update(Ke=>(Ke.saveInds[Oe]=De,Ke)),Hm(),qp.recordAddIndicator(re,se,De.params,Oe),xe=!0}}}else if(re==="VOLCANIC_SIG"){const se="candle_pane",Ne=n();if(Ne){const Te=[16,2,14,20,60,2,.5,1,.8,.8,.4,10,1,30,0,7e-4,0,1];if(Ne.createIndicator({name:"VOLCANIC_SIG",calcParams:Te},!0,{id:se})){const De={name:"VOLCANIC_SIG",pane_id:se,params:Te},Oe=`${se}_VOLCANIC_SIG`;f.update(Ke=>(Ke.saveInds[Oe]=De,Ke)),Hm(),qp.recordAddIndicator(re,se,De.params,Oe),xe=!0}}}xe&&console.log(`✅ ${re} added successfully from AI modal`)}function L(pe,re){b(v,!0),l(!1),c.update(xe=>(xe.editPaneId=pe,xe.editIndName=re,xe.modalIndCfg=!0,xe))}async function D(pe,re){if(console.log("🗑️ Deleting indicator:",{paneId:pe,name:re}),!n()){console.log("❌ No chart available");return}const xe=n(),se=`${pe}_${re}`,Ne=o().saveInds[se];Ne&&qp.recordRemoveIndicator(re,pe,Ne.params||[],se);try{xe.removeIndicator({paneId:pe,name:re}),console.log("✅ Indicator removed"),f.update(Te=>(delete Te.saveInds[se],Te)),Hm()}catch(Te){console.log("❌ Error removing indicator:",Te)}}const X=O0(),[ne,de]=X;var ie=XG(),te=_s(ie);Ve(te,l,pe=>{var re=UG(),xe=_s(re);xe.__click=[Xk,l];var se=m(xe,2),Ne=m(y(se),2),Te=y(Ne),Me=m(y(Te),2);Me.__click=[Xk,l],_(Te);var De=m(Te,2),Oe=y(De);qo(Oe,19,()=>d,kt=>kt.name,(kt,pt)=>{var Rt=HG();const Ht=Lt(()=>i(p).has(i(pt).name)),Ft=Lt(()=>i(x)===i(pt).name),zt=Lt(()=>i(pt).is_main?"candle_pane":`pane_${i(pt).name}`);Rt.__click=[EG,Ht,Ft,E,pt];var ut=y(Rt);Ve(ut,()=>i(Ft),nt=>{var Je=jG(),it=y(Je);qo(it,20,()=>Array(12),yi,(Mn,po,Tn)=>{var Cn=$G();Dt(Cn,"style",`--delay: ${Tn*.15}s; --x: ${Math.random()*100}%; --y: ${Math.random()*100}%`),Y(Mn,Cn)}),_(it);var Ge=m(it,2);qo(Ge,20,()=>Array(8),yi,(Mn,po,Tn)=>{var Cn=DG();Dt(Cn,"style",`--stream-delay: ${Tn*.2}s; left: ${10+Tn*12}%`),Y(Mn,Cn)}),_(Ge);var jt=m(Ge,2),ft=m(y(jt),2),ke=y(ft),Se=y(ke,!0);_(ke);var Et=m(ke,2),wt=y(Et,!0);_(Et),_(ft);var Ls=m(ft,2),tn=y(Ls),Gs=m(tn,2);qo(Gs,20,()=>Array(5),yi,(Mn,po,Tn)=>{var Cn=RG();we(()=>yr(Cn,"active",i(S)>=Tn)),Y(Mn,Cn)}),_(Gs),_(Ls);var Es=m(Ls,2),Ns=y(Es),Hs=y(Ns);we(()=>st(Hs,`${Math.round(i(C))??""}%`)),_(Ns);var ns=m(Ns,2),fs=y(ns);_(ns),_(Es),_(jt),_(Je),we(()=>{var Mn,po;st(Se,((Mn=i(I)[i(S)])==null?void 0:Mn.text)||""),st(wt,((po=i(I)[i(S)])==null?void 0:po.subtext)||""),Dt(tn,"style",`width: ${i(C)??""}%`),st(fs,`Phase ${i(S)+1}/5`)}),Y(nt,Je)},nt=>{var Je=WG(),it=_s(Je),ze=y(it,!0);_(it);var Ge=m(it,2),xt=y(Ge),jt=y(xt,!0);_(xt),_(Ge);var ft=m(Ge,2);Ve(ft,()=>i(Ht),ke=>{var Se=zG(),Et=y(Se);Et.__click=[BG,L,zt,pt];var wt=m(Et,2);wt.__click=[OG,D,zt,pt],_(Se),Y(ke,Se)},ke=>{var Se=VG();Y(ke,Se)}),we(()=>{st(ze,i(pt).icon),st(jt,i(pt).title)}),Y(nt,Je)}),_(Rt),we(()=>$i(Rt,`indicator-row ${(i(Ht)?"indicator-selected":"")??""} ${(i(Ft)?"indicator-loading":"")??""} svelte-uswuii`)),Y(kt,Rt)});var Ke=m(Oe,2);Ke.__click=[qG],_(De),Oi(2),_(Ne),_(se),Sv(3,xe,()=>c_,()=>({duration:200})),Sv(3,se,()=>$1,()=>({y:20,duration:300,easing:lx})),Y(pe,re)});var le=m(te,2);Ve(le,()=>i(A),pe=>{var re=KG(),xe=_s(re);xe.__click=[GG,A];var se=m(xe,2),Ne=m(y(se),2),Te=y(Ne);Te.__click=[YG,A];var Me=m(Te,10);we(()=>Dt(Me,"href",ne("https://dutyai.app/settings/investor?device=1",void 0))),_(Ne),_(se),Sv(3,xe,()=>c_,()=>({duration:200})),Sv(3,se,()=>$1,()=>({y:20,duration:300,easing:lx})),Y(pe,re)}),Y(s,ie),Kd()}$p(["click"]);var JG=be('<span class="loading loading-spinner loading-xs"></span>'),QG=be('<span class="text-xs">•</span>'),eY=be('<button class="btn btn-primary btn-sm min-w-[100px] transition-all duration-200 svelte-1ib83i5" title="Save Layout Options"><!> Save <!></button>');function tY(s,e){Yd(e,!1);const t=bd(),n=bd();let o=bi(e,"savedLayouts",24,()=>[]),r=bi(e,"activeSaveId",8,null),a=bi(e,"isLoading",8,!1),l=bi(e,"hasUnsavedChanges",8,!1);const c=fm();function f(){c("showPopup")}_h(()=>(jh(r()),jh(o())),()=>{b(t,r()?o().find(p=>p.id===r()):null)}),_h(()=>i(t),()=>{b(n,!!i(t))}),c0(),$m();var u=eY(),d=y(u);Ve(d,a,p=>{var v=JG();Y(p,v)},p=>{RB(p,{class:"h-4 w-4"})});var h=m(d,2);Ve(h,l,p=>{var v=QG();Y(p,v)}),_(u),we(()=>{u.disabled=a(),yr(u,"btn-warning",l())}),pd("click",u,f),Y(s,u),Kd()}function sY(s,e,t,n,o){s.key==="Enter"&&i(e).valid&&i(t).trim()?(s.preventDefault(),n()):s.key==="Escape"&&(s.preventDefault(),o())}var nY=be('<div class="flex items-center gap-2 text-sm text-error"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </div>'),oY=be('<div class="flex items-center gap-2 text-sm text-success"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Layout name is available</div>'),iY=be('<div class="flex items-center justify-between text-sm"><span class="text-base-content/80"> </span> <span class="text-xs text-base-content/50"> </span></div>'),rY=be('<div class="space-y-2"><h4 class="text-sm font-medium text-base-content/70"> </h4> <div class="max-h-32 overflow-y-auto space-y-1 p-3 bg-base-200/30 rounded-lg border border-base-300/50 svelte-bhlz05"></div></div>'),aY=be('<span class="loading loading-spinner loading-sm"></span> Saving...',1),lY=be('<div class="space-y-6"><div class="space-y-2"><label for="layout-name" class="block text-sm font-medium text-base-content">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter layout name..." class="w-full px-4 py-3 border border-base-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 bg-base-100 text-base-content placeholder-base-content/50"> <!></div> <!> <div class="flex gap-3 justify-end pt-4 border-t border-base-300/50"><button class="btn btn-ghost min-w-[100px] rounded-lg font-medium transition-all duration-200">Cancel</button> <button class="btn btn-primary min-w-[100px] rounded-lg font-medium transition-all duration-200 hover:scale-105"><!></button></div></div>');function cY(s,e){Yd(e,!1);const t=bd();let n=bi(e,"show",12,!1),o=bi(e,"savedLayouts",24,()=>[]),r=bi(e,"isLoading",8,!1),a=bi(e,"mode",8,"save"),l=bi(e,"showExisting",8,!1),c=bd(""),f=bd({valid:!0}),u=bd(!1);const d=fm();function h(x){if(b(u,!0),!x){b(f,{valid:!1,error:"Layout name is required"}),b(u,!1);return}if(x.length<2){b(f,{valid:!1,error:"Layout name must be at least 2 characters"}),b(u,!1);return}if(x.length>50){b(f,{valid:!1,error:"Layout name must be less than 50 characters"}),b(u,!1);return}if(/[<>:"/\\|?*]/.test(x)){b(f,{valid:!1,error:"Layout name contains invalid characters"}),b(u,!1);return}if(o().some(I=>I.name.toLowerCase()===x.toLowerCase())){b(f,{valid:!1,error:"A layout with this name already exists"}),b(u,!1);return}b(f,{valid:!0}),b(u,!1)}function p(){const x=i(c).trim();i(f).valid&&x&&d("save",{name:x})}function v(){n(!1),d("cancel")}_h(()=>jh(n()),()=>{n()&&(b(c,""),b(f,{valid:!0}),b(u,!1))}),_h(()=>i(c),()=>{i(c).trim()?h(i(c).trim()):b(f,{valid:!1,error:"Layout name is required"})}),_h(()=>jh(a()),()=>{b(t,a()==="save"?"Save Chart Layout":"Save Layout As")}),c0(),$m(),uv(s,{get show(){return n()},set show(x){n(x)},get title(){return i(t)},width:450,buttons:[],children:(x,S)=>{var C=lY(),I=y(C),A=m(y(I),2);Ts(A),A.__keydown=[sY,f,c,p,v],$6(A,!0);const P=Mm(()=>!i(f).valid&&i(c).trim()),T=Mm(()=>i(f).valid&&i(c).trim());var j=m(A,2);Ve(j,()=>i(c).trim()&&!i(f).valid,de=>{var ie=nY(),te=m(y(ie));_(ie),we(()=>st(te,` ${i(f).error??""}`)),Y(de,ie)},de=>{var ie=Qs(),te=_s(ie);Ve(te,()=>i(f).valid&&i(c).trim(),le=>{var pe=oY();Y(le,pe)},null,!0),Y(de,ie)}),_(I);var E=m(I,2);Ve(E,()=>l()&&o().length>0,de=>{var ie=rY(),te=y(ie),le=y(te);_(te);var pe=m(te,2);qo(pe,5,o,yi,(re,xe)=>{var se=iY(),Ne=y(se),Te=y(Ne,!0);_(Ne);var Me=m(Ne,2),De=y(Me,!0);we(()=>st(De,new Date(i(xe).updatedAt).toLocaleDateString())),_(Me),_(se),we(()=>st(Te,i(xe).name)),Y(re,se)}),_(pe),_(ie),we(()=>st(le,`Existing Layouts (${o().length??""})`)),Y(de,ie)});var L=m(E,2),D=y(L);D.__click=v;var X=m(D,2);X.__click=p,we(()=>X.disabled=!i(f).valid||!i(c).trim()||r()||i(u));var ne=y(X);Ve(ne,r,de=>{var ie=aY();Oi(),Y(de,ie)},de=>{var ie=I0("Save Layout");Y(de,ie)}),_(X),_(L),_(C),we(()=>{A.disabled=r(),yr(A,"border-error",i(P)),yr(A,"border-success",i(T)),D.disabled=r()}),Fn(A,()=>i(c),de=>b(c,de)),Y(x,C)},$$slots:{default:!0},$$legacy:!0}),Kd()}$p(["keydown","click"]);var uY=be('<span class="loading loading-spinner loading-xs"></span>'),dY=be('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path></svg>'),fY=be('<span class="text-xs text-warning">• Unsaved changes</span>'),pY=be('<div class="p-4 bg-primary/5 border-b border-base-300/50"><div class="flex items-center gap-2 text-sm"><div class="w-2 h-2 bg-primary rounded-full"></div> <span class="font-medium text-base-content"> </span> <!></div> <div class="text-xs text-base-content/60 mt-1"> </div></div>'),hY=be('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),mY=be('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),vY=be('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),gY=be('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),_Y=be('<div class="max-h-48 overflow-y-auto svelte-10s4pck"><!></div>'),yY=be('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Save Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-4 border-b border-base-300/50"><div class="space-y-2"><button class="w-full flex items-center gap-3 px-4 py-3 text-sm bg-primary text-primary-content hover:bg-primary/90 rounded-md transition-colors duration-150"><!> </button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> Save As...</button> <button class="w-full flex items-center gap-3 px-4 py-3 text-sm hover:bg-base-200 rounded-md transition-colors duration-150"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> New Layout</button></div></div> <!> <!></div>',1);function bY(s,e){Yd(e,!1);const t=bd(),n=bd();let o=bi(e,"show",12,!1),r=bi(e,"savedLayouts",24,()=>[]),a=bi(e,"activeSaveId",8,null),l=bi(e,"isLoading",8,!1),c=bi(e,"hasUnsavedChanges",8,!1),f=bi(e,"position",24,()=>({x:0,y:0})),u=bi(e,"showLayouts",8,!0),d=bd();const h=fm();function p(D){i(d)&&!i(d).contains(D.target)&&x()}function v(D){D.key==="Escape"&&x()}sm(()=>{console.log("🎯 ChartSavePopup mounted with props:",{show:o(),savedLayouts:r(),activeSaveId:a(),isLoading:l(),hasUnsavedChanges:c(),position:f()}),o()&&(document.addEventListener("click",p),document.addEventListener("keydown",v))}),Rg(()=>{document.removeEventListener("click",p),document.removeEventListener("keydown",v)});function x(){o(!1),h("close")}function S(){i(n)?h("quickSave"):(h("save"),x())}function C(){h("saveAs"),x()}function I(){h("newLayout"),x()}function A(D){h("load",{layoutId:D}),x()}function P(D,X){D.stopPropagation(),h("delete",{layoutId:X})}function T(D){return new Date(D).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function j(){const ne=document.querySelector(".chart-container")||document.querySelector(".duty-widget");if(!ne)return`left: ${f().x}px; top: ${f().y}px;`;const de=ne.getBoundingClientRect();let ie=de.left+de.width/2-320/2,te=de.top+de.height/2-400/2;return ie=Math.max(20,Math.min(ie,window.innerWidth-320-20)),te=Math.max(20,Math.min(te,window.innerHeight-400-20)),`left: ${ie}px; top: ${te}px;`}_h(()=>(jh(a()),jh(r())),()=>{b(t,a()?r().find(D=>D.id===a()):null)}),_h(()=>i(t),()=>{b(n,!!i(t))}),_h(()=>(jh(o()),jh(r()),jh(a()),i(t),i(n)),()=>{var D;o()&&console.log("🔄 ChartSavePopup reactive update (visible):",{show:o(),savedLayouts:((D=r())==null?void 0:D.length)||0,savedLayoutsData:r(),activeSaveId:a(),activeLayout:i(t),hasActiveSave:i(n)})}),_h(()=>jh(o()),()=>{o()?setTimeout(()=>{document.addEventListener("click",p),document.addEventListener("keydown",v)},0):(document.removeEventListener("click",p),document.removeEventListener("keydown",v))}),c0(),$m();var E=Qs(),L=_s(E);Ve(L,o,D=>{var X=yY(),ne=_s(X),de=m(ne,2);const ie=Mm(j);var te=y(de),le=m(y(te),2);_(te);var pe=m(te,2),re=y(pe),xe=y(re),se=y(xe);Ve(se,l,Ke=>{var kt=uY();Y(Ke,kt)},Ke=>{var kt=dY();Y(Ke,kt)});var Ne=m(se);_(xe);var Te=m(xe,2),Me=m(Te,2);_(re),_(pe);var De=m(pe,2);Ve(De,()=>i(t),Ke=>{var kt=pY(),pt=y(kt),Rt=m(y(pt),2),Ht=y(Rt);_(Rt);var Ft=m(Rt,2);Ve(Ft,c,nt=>{var Je=fY();Y(nt,Je)}),_(pt);var zt=m(pt,2),ut=y(zt);we(()=>st(ut,`Last saved: ${T(new Date(i(t).updatedAt).getTime())??""}`)),_(zt),_(kt),we(()=>st(Ht,`Active: ${i(t).name??""}`)),Y(Ke,kt)});var Oe=m(De,2);Ve(Oe,u,Ke=>{var kt=_Y(),pt=y(kt);Ve(pt,()=>r().length===0,Rt=>{var Ht=hY();Y(Rt,Ht)},Rt=>{var Ht=gY(),Ft=y(Ht),zt=y(Ft);_(Ft);var ut=m(Ft,2);qo(ut,5,r,yi,(nt,Je)=>{var it=vY(),ze=y(it),Ge=y(ze),xt=y(Ge),jt=y(xt,!0);_(xt);var ft=m(xt,2);Ve(ft,()=>i(Je).id===a(),wt=>{var Ls=mY();Y(wt,Ls)}),_(Ge);var ke=m(Ge,2),Se=y(ke,!0);we(()=>st(Se,T(new Date(i(Je).updatedAt).getTime()))),_(ke),_(ze);var Et=m(ze,2);_(it),we(()=>{$i(it,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(i(Je).id===a()?"bg-primary/10":"")??""}`),st(jt,i(Je).name)}),pd("click",Et,wt=>P(wt,i(Je).id)),pd("click",it,()=>A(i(Je).id)),Y(nt,it)}),_(ut),_(Ht),we(()=>st(zt,`Saved Layouts (${r().length??""})`)),Y(Rt,Ht)}),_(kt),Y(Ke,kt)}),_(de),hp(de,Ke=>b(d,Ke),()=>i(d)),we(()=>{Dt(de,"style",i(ie)),xe.disabled=l(),st(Ne,` ${(i(n)?"Save to Current Layout":"Save New Layout")??""}`)}),pd("click",ne,x),pd("click",le,x),pd("click",xe,S),pd("click",Te,C),pd("click",Me,I),Y(D,X)}),Y(s,E),Kd()}var xY=be('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),wY=be('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts yet</div>'),kY=be('<div class="w-1.5 h-1.5 bg-primary rounded-full"></div>'),SY=be('<div><div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-sm font-medium text-base-content truncate"> </span> <!></div> <div class="text-xs text-base-content/60"> </div></div> <button class="opacity-0 group-hover:opacity-100 p-1 hover:bg-error/20 rounded transition-all duration-150" title="Delete layout"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>'),CY=be('<div class="p-4"><div class="text-xs font-medium text-base-content/70 px-2 py-2"> </div> <div class="space-y-1"></div></div>'),IY=be('<div class="fixed inset-0 bg-transparent z-40"></div> <div class="fixed z-50 bg-base-100 border border-base-300 rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-200"><div class="flex items-center justify-between p-4 border-b border-base-300/50"><h3 class="text-lg font-semibold text-base-content">Load Chart Layout</h3> <button class="btn btn-ghost btn-sm btn-circle" title="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="max-h-80 overflow-y-auto svelte-ciowbr"><!></div></div>',1);function PY(s,e){Yd(e,!1);let t=bi(e,"show",12,!1),n=bi(e,"savedLayouts",24,()=>[]),o=bi(e,"activeSaveId",8,null),r=bi(e,"isLoading",8,!1),a=bi(e,"position",24,()=>({x:0,y:0})),l=bd();const c=fm();function f(A){i(l)&&!i(l).contains(A.target)&&d()}function u(A){A.key==="Escape"&&d()}sm(()=>{t()&&(document.addEventListener("click",f),document.addEventListener("keydown",u))}),Rg(()=>{document.removeEventListener("click",f),document.removeEventListener("keydown",u)});function d(){t(!1),c("close")}function h(A){c("load",{layoutId:A}),d()}function p(A){A!==o()&&h(A)}function v(A,P){A.stopPropagation(),c("delete",{layoutId:P})}function x(A){return new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function S(){const T=document.querySelector(".chart-container")||document.querySelector(".duty-widget");if(!T)return`left: ${a().x}px; top: ${a().y}px;`;const j=T.getBoundingClientRect();let E=j.left+j.width/2-320/2,L=j.top+j.height/2-400/2;return E=Math.max(20,Math.min(E,window.innerWidth-320-20)),L=Math.max(20,Math.min(L,window.innerHeight-400-20)),`left: ${E}px; top: ${L}px;`}_h(()=>jh(t()),()=>{t()?setTimeout(()=>{document.addEventListener("click",f),document.addEventListener("keydown",u)},0):(document.removeEventListener("click",f),document.removeEventListener("keydown",u))}),c0(),$m();var C=Qs(),I=_s(C);Ve(I,t,A=>{var P=IY(),T=_s(P),j=m(T,2);const E=Mm(S);var L=y(j),D=m(y(L),2);_(L);var X=m(L,2),ne=y(X);Ve(ne,r,de=>{var ie=xY();Y(de,ie)},de=>{var ie=Qs(),te=_s(ie);Ve(te,()=>n().length===0,le=>{var pe=wY();Y(le,pe)},le=>{var pe=CY(),re=y(pe),xe=y(re);_(re);var se=m(re,2);qo(se,5,n,yi,(Ne,Te)=>{var Me=SY(),De=y(Me),Oe=y(De),Ke=y(Oe),kt=y(Ke,!0);_(Ke);var pt=m(Ke,2);Ve(pt,()=>i(Te).id===o(),zt=>{var ut=kY();Y(zt,ut)}),_(Oe);var Rt=m(Oe,2),Ht=y(Rt,!0);we(()=>st(Ht,x(new Date(i(Te).updatedAt).getTime()))),_(Rt),_(De);var Ft=m(De,2);_(Me),we(()=>{$i(Me,`group flex items-center justify-between px-3 py-2 hover:bg-base-200 rounded-md transition-colors duration-150 cursor-pointer ${(i(Te).id===o()?"bg-primary/10":"")??""}`),st(kt,i(Te).name)}),pd("click",Ft,zt=>v(zt,i(Te).id)),pd("click",Me,()=>p(i(Te).id)),Y(Ne,Me)}),_(se),_(pe),we(()=>st(xe,`Saved Layouts (${n().length??""})`)),Y(le,pe)},!0),Y(de,ie)}),_(X),_(j),hp(j,de=>b(l,de),()=>i(l)),we(()=>Dt(j,"style",i(E))),pd("click",T,d),pd("click",D,d),Y(A,P)}),Y(s,C),Kd()}function MY(s,e,t){i(e)?(console.log("💾 SaveAsSelectModal dispatching saveTo event with layoutId:",i(e)),t("saveTo",{layoutId:i(e)})):console.log("❌ SaveAsSelectModal: No layout selected")}function NY(s,e){e("back")}function AY(s,e){e("cancel")}var TY=be('<div class="p-6 text-center text-base-content/60 text-sm"><span class="loading loading-spinner loading-xs"></span></div>'),FY=be('<div class="p-6 text-center text-base-content/60 text-sm">No saved layouts found.</div>'),LY=be('<label class="flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-base-200"><input type="radio" name="save-as-target" class="radio radio-primary"> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-base-content truncate"> </div> <div class="text-xs text-base-content/60"> </div></div></label>'),EY=be('<span class="loading loading-spinner loading-xs"></span> Saving...',1),$Y=be('<div class="space-y-4"><div class="flex items-center justify-between"><button class="btn btn-ghost btn-sm" title="Back">← Back</button> <div></div></div> <div class="text-sm text-base-content/70">Select a saved layout to overwrite with the current chart.</div> <div class="max-h-80 overflow-y-auto divide-y divide-base-300/50 rounded-lg border border-base-300/50 svelte-1a3gcnl"><!></div> <div class="flex justify-end gap-3 pt-2"><button class="btn btn-ghost">Cancel</button> <button class="btn btn-primary"><!></button></div></div>');function DY(s,e){Yd(e,!1);const t=[];let n=bi(e,"show",12,!1),o=bi(e,"savedLayouts",24,()=>[]),r=bi(e,"isLoading",8,!1),a=bd(null);const l=fm();_h(()=>jh(n()),()=>{n()&&b(a,null)}),c0(),$m(),uv(s,{get show(){return n()},set show(c){n(c)},title:"Save As: Choose Layout to Overwrite",width:520,buttons:[],children:(c,f)=>{var u=$Y(),d=y(u),h=y(d);h.__click=[NY,l],Oi(2),_(d);var p=m(d,4),v=y(p);Ve(v,r,A=>{var P=TY();Y(A,P)},A=>{var P=Qs(),T=_s(P);Ve(T,()=>o().length===0,j=>{var E=FY();Y(j,E)},j=>{var E=Qs(),L=_s(E);qo(L,1,o,yi,(D,X)=>{var ne=LY(),de=y(ne);Ts(de);var ie,te=m(de,2),le=y(te),pe=y(le,!0);_(le);var re=m(le,2),xe=y(re,!0);we(()=>st(xe,new Date(i(X).updatedAt).toLocaleString())),_(re),_(te),_(ne),we(()=>{ie!==(ie=i(X).id)&&(de.value=(de.__value=i(X).id)==null?"":i(X).id),st(pe,i(X).name)}),v8(t,[],de,()=>(i(X).id,i(a)),se=>b(a,se)),Y(D,ne)}),Y(j,E)},!0),Y(A,P)}),_(p);var x=m(p,2),S=y(x);S.__click=[AY,l];var C=m(S,2);C.__click=[MY,a,l];var I=y(C);Ve(I,r,A=>{var P=EY();Oi(),Y(A,P)},A=>{var P=I0("Save");Y(A,P)}),_(C),_(x),_(u),we(()=>{S.disabled=r(),C.disabled=!i(a)||r()}),Y(c,u)},$$slots:{default:!0},$$legacy:!0}),Kd()}$p(["click"]);function RY(s,e,t,n,o,r,a){if(!e()){b(t,!0);return}HS("normal"),B1(!0),BS(n().symbol),r(!1),a("close");try{window.predictNextCandle&&window.predictNextCandle()}catch{}}function jY(s,e,t,n,o,r){if(!e()){b(t,!0);return}BS(n().symbol),b(r,"deposit")}function BY(s,e,t,n,o,r){if(!e()){b(t,!0),b(n,"choose");return}OS(i(o)),zS(Math.max(0,Number(i(r))||0)),b(n,"leverage")}function Zk(s,e,t,n,o,r,a,l){if(!e()){b(t,!0),b(n,"choose");return}VS(i(o)?i(r)||100:null),WS(!0),HS("strategy"),a(!1),l("close");const c=window.sidebarHostRef;c&&c.openSidebar&&c.openSidebar()}var OY=be('<div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-stretch svelte-1w86s5a"><div class="card lux-card shadow overflow-hidden h-full svelte-1w86s5a"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-1w86s5a"><div class="flex items-center gap-2 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Normal Price Simulator</div></div> <div class="text-xs opacity-70 mt-1 svelte-1w86s5a">Auto-play historical candles to simulate price movement.</div> <div class="mt-auto pt-3 svelte-1w86s5a"><button class="btn btn-premium-primary w-full svelte-1w86s5a" type="button">Start Normal Mode</button></div></div></div> <div class="card lux-card shadow overflow-hidden h-full svelte-1w86s5a"><div class="card-body p-4 min-w-0 flex flex-col h-full svelte-1w86s5a"><div class="flex items-center gap-2 svelte-1w86s5a"><div class="p-2 rounded-full bg-base-300/60 svelte-1w86s5a"><!></div> <div class="text-sm font-semibold svelte-1w86s5a">Trade Strategy Test</div></div> <div class="text-xs opacity-70 mt-1 svelte-1w86s5a">Deposit, set leverage, buy/pending orders, and track portfolio & PnL.</div> <div class="mt-auto pt-3 svelte-1w86s5a"><button class="btn btn-premium-outline w-full svelte-1w86s5a" type="button">Start Strategy Mode</button></div></div></div></div>'),zY=(s,e)=>b(e,"choose"),VY=be('<option class="svelte-1w86s5a"> </option>'),WY=be('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Confirm Deposit</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-end svelte-1w86s5a"><div class="flex flex-col gap-1 svelte-1w86s5a"><div class="text-xs opacity-80 svelte-1w86s5a">Currency</div> <select class="select select-bordered select-sm svelte-1w86s5a"></select></div> <input class="input input-bordered input-sm svelte-1w86s5a" type="number" min="0" placeholder="Deposit"> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm Deposit</button></div></div></div>'),HY=(s,e)=>b(e,"deposit"),qY=(s,e)=>b(e,!0),UY=(s,e)=>b(e,!1),GY=be('<div class="mt-2 flex items-center gap-2 svelte-1w86s5a"><select class="select select-bordered select-sm svelte-1w86s5a"><option class="svelte-1w86s5a">1:50</option><option class="svelte-1w86s5a">1:100</option><option class="svelte-1w86s5a">1:200</option><option class="svelte-1w86s5a">1:400</option><option class="svelte-1w86s5a">1:500</option></select> <button class="btn btn-sm btn-premium-primary svelte-1w86s5a" type="button">Confirm</button></div>'),YY=be('<div class="mt-2 svelte-1w86s5a"><button class="btn btn-sm btn-premium-outline svelte-1w86s5a" type="button">Confirm</button></div>'),KY=be('<div class="card lux-card shadow overflow-hidden svelte-1w86s5a"><div class="card-body p-4 min-w-0 svelte-1w86s5a"><div class="text-sm font-semibold svelte-1w86s5a">Take leverage?</div> <div class="mt-2 flex items-center svelte-1w86s5a"><button class="btn btn-xs btn-premium-outline svelte-1w86s5a" type="button">Back</button></div> <div class="mt-2 flex items-center gap-2 svelte-1w86s5a"><label class="label cursor-pointer svelte-1w86s5a"><input type="radio" name="lev-modal" class="radio radio-sm svelte-1w86s5a"> <span class="label-text ml-2 svelte-1w86s5a">Yes</span></label> <label class="label cursor-pointer svelte-1w86s5a"><input type="radio" name="lev-modal" class="radio radio-sm svelte-1w86s5a"> <span class="label-text ml-2 svelte-1w86s5a">No</span></label></div> <!></div></div>'),XY=be('<div class="p-3 space-y-3 svelte-1w86s5a"><!></div>'),ZY=(s,e)=>b(e,!1),JY=(s,e)=>b(e,!1),QY=be('<div class="premium-modal-backdrop svelte-1w86s5a" role="presentation"></div> <div class="premium-modal-container svelte-1w86s5a" role="dialog" aria-modal="true" aria-labelledby="sim-premium-title"><div class="premium-background svelte-1w86s5a"><div class="premium-orb premium-orb-1 svelte-1w86s5a"></div> <div class="premium-orb premium-orb-2 svelte-1w86s5a"></div></div> <div class="premium-content svelte-1w86s5a"><button class="premium-close-btn svelte-1w86s5a" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><line x1="18" y1="6" x2="6" y2="18" class="svelte-1w86s5a"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-1w86s5a"></line></svg></button> <div class="premium-icon-wrapper svelte-1w86s5a"><div class="premium-icon svelte-1w86s5a"><!> <div class="premium-icon-glow svelte-1w86s5a"></div></div></div> <h2 id="sim-premium-title" class="premium-title svelte-1w86s5a">Premium Feature</h2> <p class="premium-message svelte-1w86s5a">Simulator Normal + Strategy modes are AI Pro exclusives. Unlock them to stress-test setups, fast-forward price action, and train with live-like executions.</p> <div class="premium-features svelte-1w86s5a"><div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Lightning-fast Normal Simulator</span></div> <div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Strategy Mode with deposits, leverage, and PnL</span></div> <div class="premium-feature-item svelte-1w86s5a"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><polyline points="20 6 9 17 4 12" class="svelte-1w86s5a"></polyline></svg> <span class="svelte-1w86s5a">Priority AI signals & future pro drops</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-1w86s5a"><span class="svelte-1w86s5a">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1w86s5a"><line x1="5" y1="12" x2="19" y2="12" class="svelte-1w86s5a"></line><polyline points="12 5 19 12 12 19" class="svelte-1w86s5a"></polyline></svg></a></div></div>',1),eK=be("<!> <!>",1);function tK(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(d,"$save",t),o=()=>Ml(jg,"$userPreferences",t);let r=bi(e,"show",15),a=_e("choose"),l=_e(1e5),c=_e(!1),f=_e(null),u=_e(!1);const d=hd("save");let h=_e(H(n().symbol.priceCurrency||"USD"));const p=fm();function v(j){j==="close"&&p("close")}function x(){var E;const j=(E=o())==null?void 0:E.data;return(j==null?void 0:j.isPremium)===!0||(j==null?void 0:j.isTrial)===!0}const S=O0(),[C,I]=S;var A=eK(),P=_s(A);uv(P,{get show(){return r()},set show(j){r(j)},title:"Choose Simulator Mode",buttons:[],click:v,get theme(){return n().theme},children:(j,E)=>{var L=XY(),D=y(L);Ve(D,()=>i(a)==="choose",X=>{var ne=OY(),de=y(ne),ie=y(de),te=m(y(ie),4),le=y(te);le.__click=[RY,x,u,n,d,r,p],_(te),_(ie),_(de);var pe=m(de,2),re=y(pe),xe=y(re),se=y(xe),Ne=y(se);NB(Ne,{size:18}),_(se),Oi(2),_(xe);var Te=m(xe,4),Me=y(Te);Me.__click=[jY,x,u,n,d,a],_(Te),_(re),_(pe),_(ne),Y(X,ne)},X=>{var ne=Qs(),de=_s(ne);Ve(de,()=>i(a)==="deposit",ie=>{var te=WY(),le=y(te),pe=m(y(le),2),re=y(pe);re.__click=[zY,a],_(pe);var xe=m(pe,2),se=y(xe),Ne=m(y(se),2);qo(Ne,21,()=>GS,yi,(De,Oe)=>{var Ke=VY(),kt={},pt=y(Ke,!0);_(Ke),we(()=>{kt!==(kt=i(Oe))&&(Ke.value=(Ke.__value=i(Oe))==null?"":i(Oe)),st(pt,i(Oe))}),Y(De,Ke)}),_(Ne),_(se);var Te=m(se,2);Ts(Te);var Me=m(Te,2);Me.__click=[BY,x,u,a,h,l],_(xe),_(le),_(te),co(Ne,()=>i(h),De=>b(h,De)),Fn(Te,()=>i(l),De=>b(l,De)),Y(ie,te)},ie=>{var te=KY(),le=y(te),pe=m(y(le),2),re=y(pe);re.__click=[HY,a],_(pe);var xe=m(pe,2),se=y(xe),Ne=y(se);Ts(Ne),Ne.__click=[qY,c],Oi(2),_(se);var Te=m(se,2),Me=y(Te);Ts(Me),Me.__click=[UY,c],Oi(2),_(Te),_(xe);var De=m(xe,2);Ve(De,()=>i(c),Oe=>{var Ke=GY(),kt=y(Ke),pt=y(kt);pt.value=(pt.__value=50)==null?"":50;var Rt=m(pt);Rt.value=(Rt.__value=100)==null?"":100;var Ht=m(Rt);Ht.value=(Ht.__value=200)==null?"":200;var Ft=m(Ht);Ft.value=(Ft.__value=400)==null?"":400;var zt=m(Ft);zt.value=(zt.__value=500)==null?"":500,_(kt);var ut=m(kt,2);ut.__click=[Zk,x,u,a,c,f,r,p],_(Ke),co(kt,()=>i(f),nt=>b(f,nt)),Y(Oe,Ke)},Oe=>{var Ke=YY(),kt=y(Ke);kt.__click=[Zk,x,u,a,c,f,r,p],_(Ke),Y(Oe,Ke)}),_(le),_(te),we(()=>{qm(Ne,i(c)),qm(Me,!i(c))}),Y(ie,te)},!0),Y(X,ne)}),_(L),Y(j,L)},$$slots:{default:!0}});var T=m(P,2);Ve(T,()=>i(u),j=>{var E=QY(),L=_s(E);L.__click=[ZY,u];var D=m(L,2),X=m(y(D),2),ne=y(X);ne.__click=[JY,u];var de=m(ne,2),ie=y(de),te=y(ie);kB(te,{size:34}),Oi(2),_(ie),_(de);var le=m(de,8);we(()=>Dt(le,"href",C("https://dutyai.app/settings/investor?device=1",void 0))),_(X),_(D),Sv(3,L,()=>c_,()=>({duration:200})),Sv(3,D,()=>$1,()=>({y:18,duration:260})),Y(j,E)}),Y(s,A),Kd()}$p(["click"]);var sK=be('<div class="toast svelte-66mo1o"><span class="toast-message svelte-66mo1o"> </span></div>');function p4(s,e){Yd(e,!1);let t=bi(e,"message",8,""),n=bi(e,"duration",8,3e3),o=bi(e,"visible",12,!1);const r=fm();let a=bd();sm(()=>{o()&&l()});function l(){o(!0),setTimeout(()=>{c()},n())}function c(){o(!1),r("hide")}$m();var f=Qs(),u=_s(f);return Ve(u,o,d=>{var h=sK(),p=y(h),v=y(p,!0);_(p),_(h),hp(h,x=>b(a,x),()=>i(a)),we(()=>{yr(h,"show",o()),st(v,t())}),Y(d,h)}),Y(s,f),pw(e,"showToast",l),pw(e,"hideToast",c),Kd({showToast:l,hideToast:c})}function nK(s,e,t,n,o,r,a){const l=e().theme==="dark"?"light":"dark";if(n()){b(o,H(l)),b(r,!0);return}a(l,!0)}function oK(s,e,t,n){i(e)&&(t(i(e),!0),b(n,!1),b(e,null))}function iK(s,e,t,n){i(e)&&(t(i(e),!1),b(n,!1),b(e,null))}function rK(s,e,t,n,o,r,a,l){const c=s.target;if(!c.files||!c.files.length)return;const f=c.files[0],u=f.name.split(".").shift()||"Unknown";Gz.parse(f,{skipEmptyLines:!0,complete:d=>{var p;const h=d.data.map(v=>({timestamp:parseInt(v[0]),open:parseFloat(v[1]),high:parseFloat(v[2]),low:parseFloat(v[3]),close:parseFloat(v[4]),volume:parseFloat(v[5])}));if(b(e,H(u)),h.length>1){const v=h.length-1,x=Math.min(h[1].timestamp-h[0].timestamp,h[v].timestamp-h[v-1].timestamp);Fc(n,Ro(t).period=wv(TI(x/1e3)),Ro(t))}h.length>0&&VR(Math.min(h[0].low,h[h.length-1].low))+3,(p=o())==null||p.applyNewData(h,!1),Fc(l,Ro(a).loadingDuty=!1,Ro(a)),Fc(l,Ro(a).dutyLoaded+=1,Ro(a))}})}function aK(s,e,t,n,o){const r=!i(e);b(e,r);try{sessionStorage.setItem("drawbarShown",String(r))}catch{}try{const a=t();a&&a.style.setProperty("--drawing-bar-width",r?"52px":"0px");const l=typeof document<"u"?document.querySelector(".duty-main"):null;l&&l.style.setProperty("--drawing-bar-width",r?"52px":"0px");const c=typeof document<"u"?document.querySelector(".drawbar-host"):null;c&&(c.style.width=r?"52px":"0px",c.style.overflow="hidden");const f=typeof document<"u"?document.querySelector(".drawbar-container"):null;f&&r&&(f.style.borderRightWidth="2px",f.style.borderRightStyle="solid",f.style.borderRightColor="var(--menu-border)");const u=typeof document<"u"?document.querySelector(".drawbar-wrapper"):null;u&&r&&(u.style.display="")}catch{}requestAnimationFrame(()=>{var a;(a=n())==null||a.resize()})}async function lK(s,e,t,n,o,r,a,l,c,f,u,d){if(!i(e)){b(e,!0);try{if(i(t))if(n())try{f();let h=!1;if(document.webkitExitFullscreen)try{document.webkitExitFullscreen(),h=!0}catch(p){console.log("webkitExitFullscreen failed:",p)}if(window.iosFullscreenCleanup)try{window.iosFullscreenCleanup(),delete window.iosFullscreenCleanup,h=!0}catch(p){console.log("iOS cleanup function failed:",p)}if(!h)try{document.body.classList.remove("ios-fullscreen");const p=document.getElementById("ios-fullscreen-style");p&&p.remove();const v=document.querySelector('meta[name="viewport"]');v&&v.setAttribute("content","width=device-width, initial-scale=1.0")}catch(p){console.log("Manual iOS cleanup failed:",p)}b(t,!1),b(u,!1),setTimeout(()=>{a()&&a().resize(),setTimeout(()=>{b(e,!1)},50)},150)}catch(h){console.log("iOS exit rotation failed:",h),b(t,!1),b(u,!1),b(e,!1)}else{try{"screen"in window&&"orientation"in window.screen&&"unlock"in window.screen.orientation&&window.screen.orientation.unlock()}catch(h){console.log("Screen orientation unlock failed:",h)}await d(),b(t,!1),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{b(e,!1)},50)},150):setTimeout(()=>{b(e,!1)},50)}else if(n())try{await o(),window.DeviceOrientationEvent&&r(),b(t,!0),setTimeout(()=>{window.scrollTo(0,1),setTimeout(()=>{window.scrollTo(0,0),a()&&a().resize(),setTimeout(()=>{b(e,!1)},50)},50)},100)}catch(h){console.log("iOS rotation setup failed:",h),b(t,!0),b(e,!1)}else await c(),setTimeout(async()=>{try{"screen"in window&&"orientation"in window.screen&&"lock"in window.screen.orientation?await window.screen.orientation.lock("landscape"):console.log("Screen Orientation API not supported. Please rotate your device manually.")}catch(h){console.log("Screen orientation lock failed:",h)}b(t,!0),a()?setTimeout(()=>{a().resize(),setTimeout(()=>{b(e,!1)},50)},100):setTimeout(()=>{b(e,!1)},50)},50)}catch(h){console.error("Rotation failed:",h),b(t,!1),b(e,!1)}}}function cK(s,e,t,n){if(e()){const o=e().querySelector(".chart-container");if(o){const r=o.getBoundingClientRect();b(t,H({x:r.left+r.width/2,y:r.top+r.height/2}))}else{const r=e().getBoundingClientRect();b(t,H({x:r.left+r.width/2,y:r.top+r.height/2}))}}b(n,!0)}var uK=be('<div class="save-overlay svelte-1jfzca0"><div class="save-success svelte-1jfzca0">Saved to current layout</div></div>'),dK=(s,e)=>{var t;return(t=i(e))==null?void 0:t.click()},fK=be('<div class="custom-load-section svelte-1jfzca0"><input type="file" class="hidden svelte-1jfzca0" accept="text/csv"> <button class="custom-load-btn svelte-1jfzca0"><span class="custom-load-text svelte-1jfzca0">打开</span> <div class="custom-load-glow svelte-1jfzca0"></div></button></div>'),pK=be('<div class="rotate-loading-overlay svelte-1jfzca0"><div class="rotate-loading-spinner svelte-1jfzca0"><div class="rotate-spinner-ring svelte-1jfzca0"></div> <div class="rotate-spinner-ring svelte-1jfzca0"></div> <div class="rotate-spinner-ring svelte-1jfzca0"></div></div> <div class="rotate-loading-text svelte-1jfzca0">Rotating...</div></div>'),hK=ga('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-1jfzca0"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-1jfzca0"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-1jfzca0"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-1jfzca0"></path>',1),mK=ga('<path d="M322.402 1.33524C319.002 2.83524 282.402 41.3352 279.802 46.2352C277.602 50.4352 277.602 56.6352 279.802 60.9352C282.102 65.5352 317.402 107.535 320.802 109.735C324.702 112.235 335.002 112.035 338.602 109.335C345.002 104.635 347.402 97.6352 345.002 90.4352C344.302 88.4352 340.902 83.3352 337.402 79.1352C333.902 74.9352 331.302 71.3352 331.502 71.1352C331.702 70.8352 334.802 71.2352 338.202 71.8352C379.802 79.7352 409.802 111.735 415.002 153.835C416.302 163.835 417.802 167.035 422.702 170.435C430.002 175.335 440.902 173.135 445.702 165.735C448.202 162.135 448.302 161.435 447.702 152.135C446.102 124.435 432.902 96.5352 411.102 74.9352C390.202 54.0352 367.102 42.7352 336.702 38.4352L331.902 37.8352L338.402 30.9352C345.302 23.5352 347.002 18.9352 345.502 12.0352C343.502 2.73524 331.702 -2.66476 322.402 1.33524Z" fill="currentColor" class="svelte-1jfzca0"></path><path d="M169.504 40.9358C163.204 42.2358 157.004 44.7358 152.004 47.9358C149.504 49.5358 125.204 73.2358 97.8044 100.636C44.9044 153.736 44.8044 153.936 41.4044 167.236C39.3044 175.336 40.0044 188.336 43.0044 196.136C44.1044 199.336 47.1044 204.436 49.4044 207.636C51.8044 210.836 95.8043 255.336 147.104 306.536C217.704 376.836 241.704 400.236 245.604 402.236C259.904 409.736 277.304 409.836 292.304 402.336C296.404 400.336 308.404 388.836 348.304 349.136C393.904 303.636 399.404 297.736 402.504 291.736C406.904 282.936 408.404 275.436 407.704 265.436C407.104 255.636 404.304 247.836 398.604 240.236C396.204 237.036 352.404 192.736 301.404 141.836C200.004 40.8358 204.204 44.5358 189.304 41.4358C181.904 39.8358 175.704 39.7358 169.504 40.9358ZM185.804 74.8358C187.904 75.9358 229.704 117.136 281.704 169.136C363.504 251.136 373.904 261.836 374.504 265.236C376.204 274.436 377.804 272.436 326.204 324.336C299.004 351.536 277.104 372.736 275.304 373.536C270.904 375.436 266.604 375.336 262.204 373.036C257.604 370.636 76.8043 189.636 74.6043 185.236C72.4043 180.936 72.6043 175.636 75.0043 170.936C78.3043 164.336 78.8044 164.436 94.8044 172.336C108.704 179.136 109.704 179.436 117.404 179.736C123.904 180.036 126.704 179.636 131.504 177.936C136.904 175.836 139.304 173.836 156.604 156.536C173.904 139.236 175.904 136.836 178.004 131.436C179.704 126.636 180.104 123.836 179.804 117.336C179.504 109.636 179.204 108.636 172.404 94.7358C164.504 78.8358 164.504 78.3358 170.804 74.9358C175.604 72.4358 181.104 72.4358 185.804 74.8358ZM133.404 133.036L119.404 147.036L112.204 143.736L105.004 140.436L122.804 122.636L140.504 104.936L144.004 111.936L147.504 118.936L133.404 133.036Z" fill="currentColor" class="svelte-1jfzca0"></path><path d="M310.402 275.936C308.602 276.336 305.902 277.536 304.402 278.736C299.102 282.436 278.102 304.436 277.102 307.336C275.502 311.236 275.802 318.536 277.502 321.836C280.902 328.436 288.102 331.836 295.802 330.436C298.802 329.836 302.002 327.236 313.902 315.636C321.802 307.836 328.902 300.036 329.602 298.236C334.902 285.836 323.602 272.736 310.402 275.936Z" fill="currentColor" class="svelte-1jfzca0"></path><path d="M7.40372 276.837C-0.296283 281.537 -1.79628 290.337 2.00372 309.037C12.9037 362.537 55.5037 401.637 111.304 409.437L116.104 410.037L109.604 416.937C102.704 424.337 101.004 428.937 102.504 435.837C104.504 445.137 116.004 450.537 125.304 446.537C128.904 445.037 165.304 407.037 168.304 401.637C170.504 397.537 170.504 391.337 168.204 386.937C165.904 382.337 130.604 340.337 127.204 338.137C123.304 335.637 113.004 335.837 109.404 338.537C103.004 343.237 100.604 350.237 103.004 357.437C103.704 359.437 107.104 364.537 110.604 368.737C114.104 372.937 116.704 376.537 116.504 376.737C116.304 377.037 113.204 376.637 109.804 376.037C79.4037 370.237 54.9037 351.637 41.9037 324.437C36.6037 313.337 34.4037 305.937 32.9037 293.737C31.7037 284.037 30.2037 280.837 25.3037 277.437C20.5037 274.237 12.1037 273.937 7.40372 276.837Z" fill="currentColor" class="svelte-1jfzca0"></path>',1),vK=(s,e)=>b(e,!0),gK=(s,e,t)=>e(i(t)),_K=be('<button><span class="timeframe-text svelte-1jfzca0"> </span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),yK=(s,e,t)=>e(t[0]),bK=be('<button><span class="timeframe-text svelte-1jfzca0">4h</span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),xK=(s,e,t)=>e(i(t)),wK=be('<button><span class="timeframe-text svelte-1jfzca0"> </span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),kK=be('<div class="timeframe-group desktop-only svelte-1jfzca0"><!> <!> <!></div>'),SK=(s,e,t)=>e(t.find(n=>n.timeframe==="1d")),CK=be('<button><span class="timeframe-text svelte-1jfzca0">1d</span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),IK=(s,e,t)=>e(t.find(n=>n.timeframe==="1w")),PK=be('<button><span class="timeframe-text svelte-1jfzca0">1w</span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),MK=(s,e)=>b(e,!i(e)),NK=(s,e,t)=>e(i(t)),AK=be('<button><span class="timeframe-text svelte-1jfzca0"> </span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),TK=(s,e,t)=>e(t[0]),FK=be('<button><span class="timeframe-text svelte-1jfzca0">4h</span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),LK=(s,e,t)=>e(t.find(n=>n.timeframe==="1M")),EK=be('<button><span class="timeframe-text svelte-1jfzca0">1M</span> <div class="timeframe-glow svelte-1jfzca0"></div></button>'),$K=be('<div class="timeframe-inline-expand svelte-1jfzca0"><!> <!> <!></div>'),DK=be('<div class="timeframe-group mobile-only svelte-1jfzca0"><!> <!> <button aria-label="More timeframes" title="More"><span class="timeframe-text svelte-1jfzca0">⋯</span> <div class="timeframe-glow svelte-1jfzca0"></div></button> <!></div>'),RK=(s,e)=>b(e,!0),jK=(s,e)=>b(e,!0),BK=(s,e)=>b(e,!0),OK=(s,e)=>b(e,!0),zK=be('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Play" type="button"><!></button>'),VK=be('<button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" disabled title="Simulator active" type="button"><!></button>'),WK=(s,e)=>b(e,!0),HK=(s,e)=>b(e,!0),qK=(s,e,t)=>{e("🖱️ Fullscreen button clicked!"),t()},UK=(s,e)=>e(s),GK=(s,e)=>e(s),YK=s=>{s.preventDefault(),s.stopPropagation()},KK=(s,e)=>e(s),XK=be('<button class="menu-scroll-arrow svelte-1jfzca0" title="Scroll to see more" aria-label="Scroll right" type="button"><span class="arrow-icon svelte-1jfzca0"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-1jfzca0"><polyline points="9 18 15 12 9 6" class="svelte-1jfzca0"></polyline></svg></span></button>'),ZK=be(`<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 svelte-1jfzca0" role="dialog" aria-modal="true"><div class="bg-base-100 rounded-lg shadow-xl p-6 w-full max-w-md svelte-1jfzca0"><div class="text-base-content text-lg font-semibold mb-2 svelte-1jfzca0">Switch chart template theme?</div> <div class="text-base-content/80 text-sm mb-5 svelte-1jfzca0"> <br class="svelte-1jfzca0"> Would you like to switch the chart template's theme too?</div> <div class="flex justify-end gap-2 svelte-1jfzca0"><button class="btn btn-sm svelte-1jfzca0" type="button">No</button> <button class="btn btn-sm btn-primary svelte-1jfzca0" type="button">Yes</button></div></div></div>`),JK=(s,e)=>b(e,!1),QK=(s,e)=>b(e,!1),eX=be('<div class="premium-modal-backdrop svelte-1jfzca0" role="presentation"></div> <div class="premium-modal-container svelte-1jfzca0" role="dialog" aria-modal="true" aria-labelledby="renko-premium-title"><div class="premium-background svelte-1jfzca0"><div class="premium-orb premium-orb-1 svelte-1jfzca0"></div> <div class="premium-orb premium-orb-2 svelte-1jfzca0"></div></div> <div class="premium-content svelte-1jfzca0"><button class="premium-close-btn svelte-1jfzca0" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1jfzca0"><line x1="18" y1="6" x2="6" y2="18" class="svelte-1jfzca0"></line><line x1="6" y1="6" x2="18" y2="18" class="svelte-1jfzca0"></line></svg></button> <div class="premium-icon-wrapper svelte-1jfzca0"><div class="premium-icon svelte-1jfzca0"><!> <div class="premium-icon-glow svelte-1jfzca0"></div></div></div> <h2 id="renko-premium-title" class="premium-title svelte-1jfzca0">Premium Feature</h2> <p class="premium-message svelte-1jfzca0">Renko and Point &amp; Figure intraday/daily views are AI Pro only. Weekly and Monthly stay free—upgrade to unlock every timeframe and keep your edge live.</p> <div class="premium-features svelte-1jfzca0"><div class="premium-feature-item svelte-1jfzca0"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1jfzca0"><polyline points="20 6 9 17 4 12" class="svelte-1jfzca0"></polyline></svg> <span class="svelte-1jfzca0">Full Renko &amp; Point &amp; Figure timeframes</span></div> <div class="premium-feature-item svelte-1jfzca0"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1jfzca0"><polyline points="20 6 9 17 4 12" class="svelte-1jfzca0"></polyline></svg> <span class="svelte-1jfzca0">Sharper entries with intraday brick precision</span></div> <div class="premium-feature-item svelte-1jfzca0"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1jfzca0"><polyline points="20 6 9 17 4 12" class="svelte-1jfzca0"></polyline></svg> <span class="svelte-1jfzca0">All future AI Pro chart perks, included</span></div></div> <a target="_blank" rel="noopener noreferrer" class="premium-payment-btn svelte-1jfzca0"><span class="svelte-1jfzca0">Upgrade to Premium</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1jfzca0"><line x1="5" y1="12" x2="19" y2="12" class="svelte-1jfzca0"></line><polyline points="12 5 19 12 12 19" class="svelte-1jfzca0"></polyline></svg></a></div></div>',1),tX=be('<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="menu-wrapper svelte-1jfzca0"><div class="menu-container svelte-1jfzca0"><div class="menu-left-section svelte-1jfzca0"><div class="menu-toggle-wrapper svelte-1jfzca0"><button class="menu-toggle-btn svelte-1jfzca0" title="Toggle Left Panel"><div class="menu-toggle-icon-wrapper svelte-1jfzca0"><svg viewBox="0 0 1024 1024"><path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" class="svelte-1jfzca0"></path></svg></div> <div class="menu-toggle-glow svelte-1jfzca0"></div></button></div> <!> <div class="rotate-button-wrapper-mobile svelte-1jfzca0"><button type="button"><!> <div class="menu-btn-content svelte-1jfzca0"><div class="menu-icon-wrapper svelte-1jfzca0"><svg width="20" height="20" viewBox="0 0 448 448" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1jfzca0"><!></svg></div></div> <div class="menu-btn-glow svelte-1jfzca0"></div></button></div> <div class="symbol-search-section svelte-1jfzca0"><div class="symbol-search-content svelte-1jfzca0"><div class="symbol-search-icon svelte-1jfzca0"><!></div> <span class="symbol-name svelte-1jfzca0"> </span></div></div> <div class="timeframe-section svelte-1jfzca0"><!> <!></div> <div class="ai-section svelte-1jfzca0"><button class="ai-btn group relative overflow-hidden svelte-1jfzca0" aria-label="AI Indicators" title="AI Powered Indicators" type="button"><div class="ai-glitter-bg svelte-1jfzca0"></div> <div class="ai-glitter-particle ai-glitter-1 svelte-1jfzca0"></div> <div class="ai-glitter-particle ai-glitter-2 svelte-1jfzca0"></div> <div class="ai-glitter-particle ai-glitter-3 svelte-1jfzca0"></div> <div class="ai-glitter-particle ai-glitter-4 svelte-1jfzca0"></div> <div class="ai-glitter-particle ai-glitter-5 svelte-1jfzca0"></div> <div class="ai-shine-sweep svelte-1jfzca0"></div> <div class="ai-btn-content svelte-1jfzca0"><div class="ai-icon-wrapper svelte-1jfzca0"><svg class="ai-icon svelte-1jfzca0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" class="svelte-1jfzca0"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" class="svelte-1jfzca0"></polyline><line x1="12" y1="22.08" x2="12" y2="12" class="svelte-1jfzca0"></line></svg></div> <span class="ai-text svelte-1jfzca0">AI</span> <div class="ai-badge-mini svelte-1jfzca0">New</div></div></button></div> <div class="chart-type-section svelte-1jfzca0"><button class="pro-menu-btn svelte-1jfzca0" title="Chart Type"><!> <span class="pro-menu-text svelte-1jfzca0"> </span></button></div> <div class="indicator-section svelte-1jfzca0"><button class="pro-menu-btn svelte-1jfzca0" title="Indicators"><!> <span class="pro-menu-text svelte-1jfzca0"> </span></button></div> <div class="undo-redo-section svelte-1jfzca0"><button title="Undo (Ctrl+Z)"><!></button> <button title="Redo (Ctrl+Y)"><!></button></div></div> <div class="menu-right-section svelte-1jfzca0"><!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Load Chart Layout" type="button"><!></button> <!> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Timezone" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Settings" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Script Studio" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Screenshot" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" type="button"><!></button> <button class="pro-menu-btn pro-menu-btn-icon-only svelte-1jfzca0" title="Toggle Theme" type="button"><!></button></div></div> <!></div> <!> <!> <!>',1);function sX(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(d,"$chart",t),o=()=>Ml(p,"$save",t),r=()=>Ml(h,"$ctx",t),a=()=>Ml(jg,"$userPreferences",t),l=()=>Ml(Tn,"$isRenkoActive",t),c=()=>Ml(pm,"$simulator",t);let f=bi(e,"customLoad",3,!1),u=bi(e,"mainContainer",15);const d=hd("chart"),h=hd("ctx"),p=hd("save");let v=_e(!0);sm(()=>{try{const ge=sessionStorage.getItem("drawbarShown");if(ge!=null){b(v,ge==="true");const Re=u(),vt=typeof document<"u"?document.querySelector(".duty-main"):null,Bt=typeof document<"u"?document.querySelector(".drawbar-host"):null,Xt=i(v)?"52px":"0px";Re&&Re.style.setProperty("--drawing-bar-width",Xt),vt&&vt.style.setProperty("--drawing-bar-width",Xt),Bt&&(Bt.style.width=Xt)}else{const Re=typeof document<"u"?document.querySelector(".drawbar-host"):null;if(Re){const vt=parseFloat(getComputedStyle(Re).width||"52");b(v,vt>0)}}}catch{}});const x="*";function S(){let ge=document;return(ge.fullscreenElement||ge.mozFullScreenElement||ge.webkitFullscreenElement||ge.msFullscreenElement)!=null}let C=_e(H(S())),I=_e(!1);{const ge=()=>{const vt=i(C);if(b(C,H(S())),vt&&!i(C)){if(n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Bt=lp(o().theme);Ys.merge(Bt,o().styles),n().setStyles(hf(Bt)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles before fullscreen exit")}u()&&(u(u().style.cssText="",!0),u().classList.remove("fullscreen")),setTimeout(()=>{var Bt;if(u()&&(u().offsetHeight,u().offsetWidth,window.getComputedStyle(u()).height),(Bt=n())==null||Bt.resize(),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Xt=lp(o().theme);Ys.merge(Xt,o().styles),n().setStyles(hf(Xt)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var Bt;if((Bt=n())==null||Bt.resize(),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Xt=lp(o().theme);Ys.merge(Xt,o().styles),n().setStyles(hf(Xt)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Bt;if((Bt=n())==null||Bt.resize(),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Xt=lp(o().theme);if(Ys.merge(Xt,o().styles),n().setStyles(hf(Xt)),r().applyCanvasColors){r().applyCanvasColors();const W=n().getVisibleRange();W&&n().scrollToDataIndex(W.to,0)}console.log("✅ Final chart colors applied after fullscreen exit")}},300),setTimeout(()=>{var Bt;(Bt=n())==null||Bt.resize()},600),setTimeout(()=>{var Bt;(Bt=n())==null||Bt.resize()},1200)}else setTimeout(()=>{var Bt;(Bt=n())==null||Bt.resize()},100)},Re=()=>{if(console.log("📱 handleIOSFullscreenChange triggered"),Nl()){const vt=window.innerHeight===screen.height,Bt=document.body.classList.contains("ios-fullscreen"),Xt=window.navigator.standalone;console.log("🔍 iOS fullscreen checks:",{heightMatch:vt,hasIOSClass:Bt,isStandalone:Xt,windowHeight:window.innerHeight,screenHeight:screen.height,currentFullScreen:i(C)});const W=vt||Bt||Xt,Q=i(C);if(i(C)!==W){if(console.log(`🔄 iOS fullscreen state changed: ${i(C)} → ${W}`),b(C,H(W)),Q&&!W&&n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const O=lp(o().theme);Ys.merge(O,o().styles),n().setStyles(hf(O)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied chart styles for iOS exit")}console.log("📏 Scheduling iOS chart resizes..."),setTimeout(()=>{var O;if((O=n())==null||O.resize(),Q&&!W&&n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const U=lp(o().theme);Ys.merge(U,o().styles),n().setStyles(hf(U)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var O;if((O=n())==null||O.resize(),Q&&!W&&n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const U=lp(o().theme);if(Ys.merge(U,o().styles),n().setStyles(hf(U)),r().applyCanvasColors){r().applyCanvasColors();const ce=n().getVisibleRange();ce&&n().scrollToDataIndex(ce.to,0)}console.log("✅ Final iOS chart colors applied")}},300)}else console.log("✅ No iOS fullscreen state change needed")}else console.log("❌ Not iOS Safari, skipping handler")};document.addEventListener("fullscreenchange",ge),document.addEventListener("webkitfullscreenchange",ge),document.addEventListener("mozfullscreenchange",ge),document.addEventListener("MSFullscreenChange",ge),Nl()&&(window.addEventListener("resize",Re),window.addEventListener("orientationchange",Re),document.addEventListener("webkitfullscreenchange",Re),"standalone"in window.navigator&&window.addEventListener("beforeunload",()=>{i(ze)&&i(ze)()}))}let A=_e(!1),P=_e(!1),T=_e(!1),j=_e(!1),E=_e(!1),L=_e(!1),D=_e(!1),X=_e(!1),ne=_e(""),de=_e(""),ie=_e(!1),te=_e(!1),le=_e(!1),pe=_e(!1),re=_e(!1),xe=_e(null),se=_e(!1),Ne=_e(!1),Te=_e(!1),Me=_e(H({x:0,y:0})),De=_e(!1),Oe=_e(H({x:0,y:0})),Ke=_e(H([])),kt=_e(null),pt=_e(!1),Rt=_e(!1),Ht=!1,Ft=_e(!1),zt=_e(""),ut=_e(!1),nt=_e(H({x:0,y:0})),Je=_e(!1);function it(){try{if(u()){const Re=(u().querySelector(".chart-container")||u()).getBoundingClientRect();b(nt,H({x:Re.left+Re.width/2,y:Re.top+Re.height/2}))}else{const ge=typeof window<"u"?window.innerWidth:0,Re=typeof window<"u"?window.innerHeight:0;b(nt,H({x:ge/2,y:Re/2}))}}catch{}}let ze=_e(null);function Ge(ge){console.log(ge)}let xt=_e(void 0);const jt=[{timeframe:"1m",multiplier:1,timespan:"minute",secs:60},{timeframe:"5m",multiplier:5,timespan:"minute",secs:300},{timeframe:"15m",multiplier:15,timespan:"minute",secs:900},{timeframe:"30m",multiplier:30,timespan:"minute",secs:1800},{timeframe:"1h",multiplier:1,timespan:"hour",secs:3600}],ft=[{timeframe:"1d",multiplier:1,timespan:"day",secs:86400},{timeframe:"1w",multiplier:1,timespan:"week",secs:604800},{timeframe:"1M",multiplier:1,timespan:"month",secs:2592e3}],ke=[{timeframe:"4h",multiplier:4,timespan:"hour",secs:14400}],Se=["1w","1M"],Et=[{id:"candle_solid",name:"Candlestick",icon:"candle_solid"},{id:"candle_stroke",name:"Hollow",icon:"candle_stroke"},{id:"candle_up_stroke",name:"Up Hollow",icon:"candle_up_stroke"},{id:"candle_down_stroke",name:"Down Hollow",icon:"candle_down_stroke"},{id:"heikin_ashi",name:"Heikin Ashi",icon:"candle_solid"},{id:"renko_atr",name:"Duty AI Renko",icon:"candle_solid"},{id:"point_and_figure",name:"Point & Figure",icon:"point_and_figure"},{id:"ohlc",name:"OHLC",icon:"ohlc"},{id:"area",name:"Area",icon:"area"},{id:"line_chart",name:"Line",icon:"line"}];let wt=_e(!1),Ls=_e(!1),tn=_e(!1),Gs=_e(!1),an=_e(void 0);Xr(()=>{let ge=null,Re=null;function vt(){return typeof window<"u"&&window.saveManager?(ge=window.saveManager.state.subscribe(Xt=>{console.log("📊 SaveManager state updated:",Xt),Xt.initialized?(console.log("🔗 SaveManager is initialized, updating UI state..."),b(Ke,H(Xt.savedLayouts)),b(kt,H(Xt.activeSaveId)),b(pt,H(Xt.isLoading)),Re&&(clearInterval(Re),Re=null)):console.log("⏳ SaveManager exists but not yet initialized...")}),!0):!1}return vt()||(console.log("⏳ Waiting for SaveManager to be available..."),Re=setInterval(()=>{vt()},100)),()=>{ge&&ge(),Re&&clearInterval(Re)}});function Es(){n()&&setTimeout(()=>{n().resize()},300)}sm(()=>{qp.init({chart:n(),saveStore:p,overlaysStore:null});const ge=()=>{b(Ls,H(qp.canUndo())),b(tn,H(qp.canRedo()))};ge();const Re=setInterval(ge,100);"screen"in window&&"orientation"in window.screen?window.screen.orientation.addEventListener("change",Es):window.addEventListener("orientationchange",Es),la();const vt=()=>{la()},Bt=()=>{la(),typeof window<"u"&&b(pe,window.innerWidth<=768)};return i(an)&&i(an).addEventListener("scroll",vt),window.addEventListener("resize",Bt),setTimeout(()=>{la(),typeof window<"u"&&b(pe,window.innerWidth<=768)},500),()=>{clearInterval(Re),"screen"in window&&"orientation"in window.screen?window.screen.orientation.removeEventListener("change",Es):window.removeEventListener("orientationchange",Es),i(an)&&i(an).removeEventListener("scroll",vt),window.removeEventListener("resize",Bt)}});function Ns(){i(Ls)&&qp.undo()}function Hs(){i(tn)&&qp.redo()}function ns(ge){var Re;if(Vo()&&!Bo()){const vt=ge==null?void 0:ge.timeframe;if(!Se.includes(vt)){b(Je,!0);return}}Fc(p,Ro(o).period=ge,Ro(o));try{const vt=(Re=o())!=null&&Re.key&&typeof o().key=="string"?o().key:"chart";typeof localStorage<"u"&&localStorage.setItem(`${vt}.lastTimeframe`,(ge==null?void 0:ge.timeframe)||"")}catch{}i(le)&&b(le,!1)}function fs(){var vt,Bt,Xt,W;if((Bt=(vt=o().styles)==null?void 0:vt.candle)!=null&&Bt._isLineChart)return Et.find(Q=>Q.id==="line_chart")||Et[0];const ge=((W=(Xt=o().styles)==null?void 0:Xt.candle)==null?void 0:W.type)||"renko_atr";return Et.find(Q=>Q.id===ge)||Et[0]}const Mn=pp(p,ge=>ge.symbol.ticker),po=pp(p,ge=>ge.symbol.shortName),Tn=pp(p,ge=>{var Re,vt;return((vt=(Re=ge.styles)==null?void 0:Re.candle)==null?void 0:vt.type)==="renko_atr"});pp(p,ge=>{var Re,vt;return((vt=(Re=ge.styles)==null?void 0:Re.candle)==null?void 0:vt.type)==="point_and_figure"}),Mn.subscribe(()=>{b(de,H(o().symbol.shortName||o().symbol.ticker))}),po.subscribe(()=>{b(de,H(o().symbol.shortName||o().symbol.ticker))});function Cn(){const ge=o().styles||{},Re=lp(o().theme);if(ge.backgroundColor||ge.backgroundGradient||ge.backgroundType||ge.backgroundOpacity!==void 0||ge.gridGradient||ge.gridType||ge.gridOpacity!==void 0)return!0;const vt=G=>{if(!G||typeof G!="string")return"";const ye=G.trim().toLowerCase();if(ye.startsWith("rgba(")){const Qe=ye.match(/rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(Qe){const Ue=Number(Qe[1]).toString(16).padStart(2,"0"),dt=Number(Qe[2]).toString(16).padStart(2,"0"),et=Number(Qe[3]).toString(16).padStart(2,"0");return`#${Ue}${dt}${et}`}}return ye},Bt=vt(Ys.get(ge,"pane.backgroundColor")),Xt=vt(Ys.get(ge,"candle.pane.backgroundColor")),W=vt(Ys.get(Re,"pane.backgroundColor"));if(Bt&&W&&Bt!==W||Xt&&W&&Xt!==W)return!0;const Q=vt(Ys.get(ge,"grid.horizontal.color")),O=vt(Ys.get(ge,"grid.vertical.color")),U=vt(Ys.get(Re,"grid.horizontal.color")),ce=vt(Ys.get(Re,"grid.vertical.color"));return!!(Q&&U&&Q!==U||O&&ce&&O!==ce)}function go(ge){try{if(window.self!==window.top){const Re={type:"theme-change",theme:ge};let vt=x;try{window.parent.location&&(vt=window.parent.location.origin)}catch{vt=x}window.parent.postMessage(Re,vt),console.log("📤 Sent theme-change message to parent:",Re,"origin:",vt)}}catch(Re){console.error("Failed to send theme-change message to parent:",Re)}}function no(ge,Re){var Xt,W,Q,O,U;const vt=document.querySelector(".duty-main");if(vt&&vt.setAttribute("data-theme",ge),Re){try{const ce=localStorage.getItem("chart");if(ce){const G=JSON.parse(ce);G.styles&&(delete G.styles.backgroundColor,delete G.styles.backgroundOpacity,delete G.styles.backgroundType,delete G.styles.backgroundGradient,G.styles.grid&&(delete G.styles.grid.horizontal,delete G.styles.grid.vertical),delete G.styles.gridColor,delete G.styles.gridOpacity,delete G.styles.gridType,delete G.styles.gridGradient,localStorage.setItem("chart",JSON.stringify(G)),console.log("🧹 Cleared custom background and grid colors from localStorage"))}}catch(ce){console.error("Failed to clear custom colors from localStorage:",ce)}if(n()){window.__forceApplyThemeDefaults=!0;const ce=lp(ge),G=JSON.parse(JSON.stringify(o().styles||{})),ye=ce,Qe={...G,pane:{...G.pane,backgroundColor:ye.pane.backgroundColor},candle:{...G.candle,pane:{...(Xt=G.candle)==null?void 0:Xt.pane,backgroundColor:ye.candle.pane.backgroundColor}},grid:{...G.grid,horizontal:{...(W=G.grid)==null?void 0:W.horizontal,color:ye.grid.horizontal.color},vertical:{...(Q=G.grid)==null?void 0:Q.vertical,color:ye.grid.vertical.color}}},Ue=(O=G==null?void 0:G.candle)==null?void 0:O.type,dt=Ys.merge({},ce,Qe);delete dt.backgroundColor,delete dt.backgroundOpacity,delete dt.backgroundType,delete dt.backgroundGradient,delete dt.gridColor,delete dt.gridOpacity,delete dt.gridType,delete dt.gridGradient,Ue&&dt.candle&&(dt.candle.type=Ue),n().setStyles(hf(dt)),Fc(p,Ro(o).styles=dt,Ro(o))}try{const ce=new Jx("chart-settings",d,ge);ce.resetToThemeDefaults(ge),ce.destroy(),console.log("🔄 Reset TransactionalThemeManager for theme toggle")}catch(ce){console.error("Failed to reset TransactionalThemeManager:",ce)}}Fc(p,Ro(o).theme=ge,Ro(o));const Bt=(U=a())==null?void 0:U.data;if(Bt!=null&&Bt.clerkId){const ce=ge==="dark"?"Dark":"Light";BR(Bt.clerkId,ce).catch(G=>{console.error("Failed to save theme to API:",G)})}go(ge)}function Bo(){var Re;const ge=(Re=a())==null?void 0:Re.data;return(ge==null?void 0:ge.isPremium)===!0||(ge==null?void 0:ge.isTrial)===!0}function Vo(){var Re,vt;const ge=(vt=(Re=o().styles)==null?void 0:Re.candle)==null?void 0:vt.type;return ge==="renko_atr"||ge==="point_and_figure"}function Rl(){var Re;if(Bo()||!Vo())return;const ge=(Re=o().period)==null?void 0:Re.timeframe;if(!Se.includes(ge)){const vt=ft.find(Bt=>Bt.timeframe==="1M")||ft.find(Bt=>Bt.timeframe==="1w");vt&&ns(vt)}}Xr(()=>{var ge,Re,vt;(Re=(ge=o().styles)==null?void 0:ge.candle)==null||Re.type,(vt=o().period)==null||vt.timeframe,Rl()});function aa(){const ge=Ys.get(o().styles,"backgroundType")==="gradient",Re=Ys.get(o().styles,"backgroundGradient"),vt=ge&&Re&&Array.isArray(Re.stops)&&Re.stops.length>0,Bt=(W,Q)=>{const O=(W||"#000000").replace("#",""),U=parseInt(O.substring(0,2),16)||0,ce=parseInt(O.substring(2,4),16)||0,G=parseInt(O.substring(4,6),16)||0,ye=Math.max(0,Math.min(1,Q??1));return`rgba(${U}, ${ce}, ${G}, ${ye})`};if(vt){requestAnimationFrame(()=>{var W,Q;try{const O=(W=n())==null?void 0:W.getConvertPictureUrl(!0,"png","rgba(0, 0, 0, 0)");if(!O)return;const U=new Image;U.onload=()=>{const ce=U.naturalWidth||U.width,G=U.naturalHeight||U.height,ye=document.createElement("canvas");ye.width=ce,ye.height=G;const Qe=ye.getContext("2d");if(!Qe)return;let Ue;if((Re.type==="radial"?"radial":"linear")==="radial")Ue=Qe.createRadialGradient(ce/2,G/2,0,ce/2,G/2,Math.max(ce,G)/2);else{const ve=((typeof Re.direction=="number"?Re.direction:90)-90)*Math.PI/180,Fe=Math.cos(ve),ot=Math.sin(ve),tt=ce/2-ce/2*Fe,St=G/2-G/2*ot,Be=ce/2+ce/2*Fe,je=G/2+G/2*ot;Ue=Qe.createLinearGradient(tt,St,Be,je)}[...Re.stops].sort((B,ve)=>(B.position??0)-(ve.position??0)).forEach(B=>{const ve=Math.max(0,Math.min(1,(B.position??0)/100)),Fe=Bt(B.color,(B.opacity??100)/100);Ue.addColorStop(ve,Fe)}),Qe.fillStyle=Ue,Qe.fillRect(0,0,ce,G),Qe.drawImage(U,0,0,ce,G),b(ne,H(ye.toDataURL("image/png"))),b(L,!0)},U.src=O}catch{let U=o().theme==="dark"?"#0A0F1A":"#ffffff";b(ne,H(((Q=n())==null?void 0:Q.getConvertPictureUrl(!0,"jpeg",U))??"")),b(L,!0)}});return}let Xt;try{const W=document.querySelector(".duty-widget"),Q=document.querySelector(".duty-main"),O=U=>{if(!U)return"";const ce=getComputedStyle(U).getPropertyValue("--chart-background-color").trim();return ce&&!ce.includes("gradient")?ce:""};if(Xt=O(W)||O(Q)||void 0,!Xt&&n()&&typeof n().getStyles=="function"){const U=n().getStyles()??{};Xt=Ys.get(U,"pane.backgroundColor")||Ys.get(U,"candle.pane.backgroundColor")||void 0}if(!Xt){const U=Ys.get(o().styles,"backgroundColor");Xt=U&&typeof U=="string"?U:void 0}}catch{}Xt||(Xt=o().theme==="dark"?"#0A0F1A":"#ffffff"),requestAnimationFrame(()=>{var W;b(ne,H(((W=n())==null?void 0:W.getConvertPictureUrl(!0,"jpeg",Xt))??"")),b(L,!0)})}function tl(){if(Nl()&&i(ze)){i(ze)();return}let ge=document;const Re=ge.exitFullscreen??ge.mozCancelFullScreen??ge.webkitExitFullscreen??ge.msExitFullscreen;Re?Re.call(ge):Nl()&&Gc()}function Zr(){Ge("🔄 toggleFullscreen called, current fullScreen: "+i(C)),Ge("🔍 iOS detection - isIOS(): "+zi()+", isIOSSafari(): "+Nl()),i(C)?(Ge("🚪 Exiting fullscreen..."),tl()):Nl()?(Ge("📱 Using iOS Safari fullscreen method"),mu()):(Ge("🖥️ Using standard fullscreen method"),du())}function zi(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function Nl(){const ge=navigator.userAgent,Re=/iPad|iPhone|iPod/.test(ge)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,vt=/Safari/.test(ge)&&!/Chrome|CriOS|FxiOS/.test(ge);return Re&&vt}function mu(){return Ge("📱 enterFullscreenIOS called"),new Promise(ge=>{var vt;const Re=u();if(Ge("🎯 mainContainer element: "+(Re?"Found":"Not found")),Re&&Re.webkitRequestFullscreen){Ge("🔧 Trying webkitRequestFullscreen...");try{Re.webkitRequestFullscreen(),setTimeout(()=>{Ge("✅ webkitRequestFullscreen success, setting fullScreen = true"),b(C,!0),ge(!0)},300);return}catch(Bt){Ge("❌ webkitRequestFullscreen failed: "+Bt)}}else Ge("❌ webkitRequestFullscreen not available");if(Re&&Re.webkitEnterFullscreen)try{Re.webkitEnterFullscreen(),setTimeout(()=>{b(C,!0),ge(!0)},300);return}catch(Bt){console.log("webkitEnterFullscreen failed:",Bt)}Ge("🔧 Trying viewport manipulation fallback...");try{const Bt=document.querySelector('meta[name="viewport"]'),Xt=(Bt==null?void 0:Bt.getAttribute("content"))||"";Ge("📋 Original viewport content: "+Xt);const W=Bt||document.createElement("meta");W.setAttribute("name","viewport"),W.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),Bt?console.log("🔄 Updated existing viewport meta tag"):(document.head.appendChild(W),console.log("➕ Added new viewport meta tag")),window.scrollTo(0,1),console.log("📜 Scrolled to hide Safari UI");const Q=document.createElement("style");Q.id="ios-fullscreen-style",Q.textContent=`
          body.ios-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100vh !important;
            overflow: hidden !important;
            -webkit-overflow-scrolling: touch !important;
          }
          
          .ios-fullscreen #main-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
          }
          
          /* Hide Safari bottom bar */
          @supports (padding: max(0px)) {
            .ios-fullscreen {
              padding-bottom: env(safe-area-inset-bottom) !important;
            }
          }
        `,document.head.appendChild(Q),console.log("🎨 Added iOS fullscreen CSS styles");const O=((vt=u())==null?void 0:vt.getAttribute("data-theme"))||o().theme;Ge("🎨 Preserving theme during iOS fullscreen: "+O),document.body.classList.add("ios-fullscreen"),console.log("✅ Applied ios-fullscreen class to body"),u()&&(u().setAttribute("data-theme",O),Ge("🔄 Restored theme attribute: "+O)),setTimeout(()=>{window.scrollTo(0,0),b(C,!0),Ge("🎯 iOS fullscreen activated successfully!"),b(ze,()=>{var G;Ge("🧹 Cleaning up iOS fullscreen...");const U=((G=u())==null?void 0:G.getAttribute("data-theme"))||o().theme;Ge("🎨 Preserving theme during cleanup: "+U),document.body.classList.remove("ios-fullscreen");const ce=document.getElementById("ios-fullscreen-style");ce&&ce.remove(),Bt&&Xt&&Bt.setAttribute("content",Xt),u()&&(u().setAttribute("data-theme",U),Ge("🔄 Restored theme attribute after cleanup: "+U)),b(C,!1),Ge("✅ iOS fullscreen cleanup completed")}),ge(!0)},100)}catch(Bt){console.log("iOS Safari viewport fallback failed:",Bt),ge(!1)}})}function Gc(){var ge;if(console.log("🚪 exitFullscreenIOS called"),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const Re=lp(o().theme);Ys.merge(Re,o().styles),n().setStyles(hf(Re)),r().applyCanvasColors&&r().applyCanvasColors(),console.log("🎨 Pre-applied styles before iOS exit")}try{document.webkitExitFullscreen?(console.log("🔧 Trying webkitExitFullscreen..."),document.webkitExitFullscreen()):console.log("❌ webkitExitFullscreen not available"),i(ze)?(console.log("🧹 Using stored cleanup function..."),i(ze)(),b(ze,null)):console.log("❌ No stored cleanup function available"),console.log("🔧 Performing manual cleanup...");const Re=((ge=u())==null?void 0:ge.getAttribute("data-theme"))||o().theme;console.log("🎨 Preserving theme during manual cleanup: "+Re),document.body.classList.remove("ios-fullscreen");const vt=document.getElementById("ios-fullscreen-style");vt&&(vt.remove(),console.log("🗑️ Removed iOS fullscreen styles"));const Bt=document.querySelector('meta[name="viewport"]');Bt&&(Bt.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),console.log("📱 Restored viewport meta tag")),u()&&(u().setAttribute("data-theme",Re),console.log("🔄 Restored theme attribute after manual cleanup: "+Re)),b(C,!1),console.log("✅ Set fullScreen = false"),setTimeout(()=>{var Xt;if(console.log("📏 First chart resize..."),(Xt=n())==null||Xt.resize(),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const W=lp(o().theme);Ys.merge(W,o().styles),n().setStyles(hf(W)),r().applyCanvasColors&&r().applyCanvasColors()}},10),setTimeout(()=>{var Xt;if((Xt=n())==null||Xt.resize(),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const W=lp(o().theme);Ys.merge(W,o().styles),n().setStyles(hf(W)),r().applyCanvasColors&&r().applyCanvasColors()}},100),setTimeout(()=>{var Xt;if((Xt=n())==null||Xt.resize(),n()&&o().styles){window.__forceApplySavedCanvasColors=!0;const W=lp(o().theme);if(Ys.merge(W,o().styles),n().setStyles(hf(W)),r().applyCanvasColors){r().applyCanvasColors();const Q=n().getVisibleRange();Q&&n().scrollToDataIndex(Q.to,0)}console.log("✅ Final iOS chart colors applied after exit")}},300)}catch(Re){console.log("❌ iOS exit fullscreen failed:",Re)}}function du(){return zi()?mu():new Promise(ge=>{let Re=u();Re&&Re.requestFullscreen?Re.requestFullscreen().then(()=>ge(!0)).catch(()=>ge(!1)):Re&&Re.mozRequestFullScreen?(Re.mozRequestFullScreen(),setTimeout(()=>ge(!0),100)):Re&&Re.webkitRequestFullscreen?(Re.webkitRequestFullscreen(),setTimeout(()=>ge(!0),100)):Re&&Re.msRequestFullscreen?(Re.msRequestFullscreen(),setTimeout(()=>ge(!0),100)):ge(!1)})}function Ju(){rd();const ge=document.createElement("div");ge.id="ios-rotation-hint",ge.innerHTML=`
      <div style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        z-index: 10000;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 280px;
        backdrop-filter: blur(10px);
      ">
        <div style="font-size: 24px; margin-bottom: 10px;">📱</div>
        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Rotate Your Device</div>
        <div style="font-size: 14px; opacity: 0.8;">Turn your device to landscape mode for the best experience</div>
        <div style="margin-top: 15px; font-size: 12px; opacity: 0.6;">Tap anywhere to dismiss</div>
      </div>
    `,ge.onclick=rd,document.body.appendChild(ge),setTimeout(rd,4e3)}function rd(){const ge=document.getElementById("ios-rotation-hint");ge&&ge.remove()}async function Al(){if(typeof window<"u"&&window.saveManager){const ge=window.saveManager,Re=ge.getState();if(b(ut,!1),Re.activeSaveId){const vt=await ge.quickSave();vt.success||console.error("Quick save failed:",vt.error),vt.success&&(b(Te,!1),b(zt,"Saved to current layout"),b(Ft,!0),setTimeout(()=>{b(Ft,!1)},2e3),b(ut,!0),it(),setTimeout(()=>{b(ut,!1)},1500))}else b(Te,!1),b(se,!0)}}function sa(){b(Te,!1),b(Ne,!0)}function Vc(){b(Te,!1),b(se,!0)}async function vu(ge){const{layoutId:Re}=ge.detail;if(typeof window<"u"&&window.saveManager){const vt=window.saveManager;b(Rt,!0);const Bt=await vt.load(Re);b(Rt,!1),Bt.success||console.error("Load failed:",Bt.error)}}async function Qc(ge){const{layoutId:Re}=ge.detail;if(typeof window<"u"&&window.saveManager){const Bt=await window.saveManager.delete(Re);if(!Bt.success){console.error("Delete failed:",Bt.error);return}b(Ke,H((i(Ke)||[]).filter(Xt=>Xt.id!==Re))),i(kt)===Re&&b(kt,null),b(pt,!1)}}async function To(ge){const{name:Re}=ge.detail;if(typeof window<"u"&&window.saveManager){const vt=window.saveManager;b(ut,!1);const Bt=await vt.save(Re);Bt.success?(b(se,!1),b(ut,!0),it(),setTimeout(()=>{b(ut,!1)},1500)):console.error("Save failed:",Bt.error)}}function ec(){b(se,!1)}async function yl(ge){const{layoutId:Re}=ge.detail;if(console.log("💾 SaveAsSelectSave triggered with layoutId:",Re),typeof window<"u"&&window.saveManager){const vt=window.saveManager;console.log("✅ SaveManager found, calling saveTo..."),b(ut,!1);const Bt=await vt.saveTo(Re);Bt.success?(console.log("✅ Save to existing successful"),b(Ne,!1),b(ut,!0),it(),setTimeout(()=>{b(ut,!1)},1500)):console.error("❌ Save to existing failed:",Bt.error)}else console.error("❌ SaveManager not available")}function Dc(){b(Ne,!1),qi()}function jl(){b(Ne,!1)}function qi(){console.log("🎯 Save button clicked, showing popup..."),console.log("📊 Current savedLayouts:",i(Ke)),console.log("🎯 Current activeSaveId:",i(kt)),console.log("💾 SaveManager available:",!!window.saveManager);try{if(typeof window<"u"&&window.saveManager){const Re=window.saveManager.getState();if(!Re||!Array.isArray(Re.savedLayouts)||Re.savedLayouts.length===0){b(Te,!1),b(se,!0);return}}else if(!i(Ke)||i(Ke).length===0){b(Te,!1),b(se,!0);return}}catch{b(Te,!1),b(se,!0);return}if(u()){const ge=u().querySelector(".chart-container");if(ge){const Re=ge.getBoundingClientRect();b(Me,H({x:Re.left+Re.width/2,y:Re.top+Re.height/2}))}else{const Re=u().getBoundingClientRect();b(Me,H({x:Re.left+Re.width/2,y:Re.top+Re.height/2}))}}b(Te,!0)}function la(){if(!i(an))return;const{scrollWidth:ge,clientWidth:Re,scrollLeft:vt}=i(an),Bt=ge>Re,Xt=vt+Re>=ge-5;b(Gs,H(Bt&&!Xt))}function El(ge){if(ge&&(ge.preventDefault(),ge.stopPropagation()),!i(an))return;const{scrollLeft:Re,clientWidth:vt,scrollWidth:Bt}=i(an),Xt=vt*.7,W=Math.min(Re+Xt,Bt-vt);try{i(an).scrollTo({left:W,behavior:"smooth"})}catch{i(an).scrollLeft=W}}function qu(ge){ge.preventDefault(),ge.stopPropagation(),El()}const Td=O0(),[ki,sl]=Td;var br=tX(),Wc=_s(br);lV(Wc,{get show(){return i(A)},set show(ge){b(A,H(ge))}});var Xd=m(Wc,2);fV(Xd,{get show(){return i(P)},set show(ge){b(P,H(ge))}});var Uf=m(Xd,2);KV(Uf,{get show(){return i(T)},set show(ge){b(T,H(ge))}});var xf=m(Uf,2);Zq(xf,{get show(){return r().modalIndCfg},set show(ge){Fc(h,Ro(r).modalIndCfg=ge,Ro(r))}});var Uu=m(xf,2);xG(Uu,{get show(){return i(j)},set show(ge){b(j,H(ge))}});var tp=m(Uu,2);f4(tp,{get show(){return i(E)},set show(ge){b(E,H(ge))}});var wf=m(tp,2);kG(wf,{get show(){return i(L)},set show(ge){b(L,H(ge))},get url(){return i(ne)},set url(ge){b(ne,H(ge))}});var Vs=m(wf,2);PG(Vs,{get show(){return i(D)},set show(ge){b(D,H(ge))}});var kn=m(Vs,2);LG(kn,{get show(){return i(wt)},set show(ge){b(wt,H(ge))}});var Kn=m(kn,2);ZG(Kn,{get show(){return i(X)},set show(ge){b(X,H(ge))}});var Bs=m(Kn,2);cY(Bs,{get show(){return i(se)},set show(ge){b(se,H(ge))},get savedLayouts(){return i(Ke)},get isLoading(){return i(pt)},mode:"save",showExisting:!1,$$events:{save:To,cancel:ec}});var bo=m(Bs,2);DY(bo,{get show(){return i(Ne)},set show(ge){b(Ne,H(ge))},get savedLayouts(){return i(Ke)},get isLoading(){return i(pt)},$$events:{saveTo:yl,back:Dc,cancel:jl}});var lo=m(bo,2);bY(lo,{get show(){return i(Te)},set show(ge){b(Te,H(ge))},get savedLayouts(){return i(Ke)},get activeSaveId(){return i(kt)},get isLoading(){return i(pt)},get hasUnsavedChanges(){return Ht},get position(){return i(Me)},showLayouts:!1,$$events:{save:Al,saveAs:sa,quickSave:Al,newLayout:Vc}});var Qi=m(lo,2);PY(Qi,{get show(){return i(De)},set show(ge){b(De,H(ge))},get savedLayouts(){return i(Ke)},get activeSaveId(){return i(kt)},get position(){return i(Oe)},get isLoading(){return i(pt)},$$events:{load:vu,delete:Qc}});var xr=m(Qi,2);p4(xr,{get visible(){return i(Ft)},set visible(ge){b(Ft,H(ge))},get message(){return i(zt)},duration:2e3});var Ai=m(xr,2);Ve(Ai,()=>i(ut),ge=>{var Re=uK();we(()=>Dt(Re,"style",`left: ${i(nt).x??""}px; top: ${i(nt).y??""}px;`)),Y(ge,Re)});var ri=m(Ai,2),Ti=y(ri),Eo=y(Ti),hr=y(Eo),ei=y(hr);ei.__click=[aK,v,u,n,d];var ai=y(ei),vi=y(ai);_(ai),Oi(2),_(ei),_(hr);var _a=m(hr,2);Ve(_a,f,ge=>{var Re=fK(),vt=y(Re);vt.__change=[rK,de,o,p,n,d,r,h],hp(vt,Xt=>b(xt,Xt),()=>i(xt));var Bt=m(vt,2);Bt.__click=[dK,xt],_(Re),Y(ge,Re)});var dl=m(_a,2),ar=y(dl);ar.__click=[lK,te,ie,zi,mu,Ju,n,d,du,rd,C,tl];var Jr=y(ar);Ve(Jr,()=>i(te),ge=>{var Re=pK();Y(ge,Re)});var nl=m(Jr,2),tc=y(nl),mc=y(tc),gu=y(mc);Ve(gu,()=>i(ie),ge=>{var Re=hK();Oi(3),Y(ge,Re)},ge=>{var Re=mK();Oi(3),Y(ge,Re)}),_(mc),_(tc),_(nl),Oi(2),_(ar),_(dl);var Bl=m(dl,2);Bl.__click=[vK,A];var Ui=y(Bl),Ol=y(Ui),fl=y(Ol);jB(fl,{class:"search-icon"}),_(Ol);var bl=m(Ol,2),Ua=y(bl,!0);_(bl),_(Ui),_(Bl);var er=m(Bl,2),ba=y(er);Ve(ba,()=>!i(pe),ge=>{var Re=kK(),vt=y(Re);qo(vt,17,()=>jt,yi,(W,Q)=>{var O=_K();O.__click=[gK,ns,Q];var U=y(O),ce=y(U,!0);_(U),Oi(2),_(O),we(()=>{var G;$i(O,`timeframe-btn ${(i(Q).timeframe===((G=o().period)==null?void 0:G.timeframe)?"timeframe-btn-active":"")??""} svelte-1jfzca0`),st(ce,i(Q).timeframe)}),Y(W,O)});var Bt=m(vt,2);Ve(Bt,()=>!l(),W=>{var Q=bK();Q.__click=[yK,ns,ke],we(()=>{var O;return $i(Q,`timeframe-btn ${(((O=o().period)==null?void 0:O.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-1jfzca0`)}),Y(W,Q)});var Xt=m(Bt,2);qo(Xt,17,()=>ft,yi,(W,Q)=>{var O=wK();O.__click=[xK,ns,Q];var U=y(O),ce=y(U,!0);_(U),Oi(2),_(O),we(()=>{var G;$i(O,`timeframe-btn ${(i(Q).timeframe===((G=o().period)==null?void 0:G.timeframe)?"timeframe-btn-active":"")??""} svelte-1jfzca0`),st(ce,i(Q).timeframe)}),Y(W,O)}),_(Re),Y(ge,Re)});var ol=m(ba,2);Ve(ol,()=>i(pe),ge=>{var Re=DK(),vt=y(Re);Ve(vt,()=>ft.find(Q=>Q.timeframe==="1d"),Q=>{var O=CK();O.__click=[SK,ns,ft],we(()=>{var U;return $i(O,`timeframe-btn ${(((U=o().period)==null?void 0:U.timeframe)==="1d"?"timeframe-btn-active":"")??""} svelte-1jfzca0`)}),Y(Q,O)});var Bt=m(vt,2);Ve(Bt,()=>ft.find(Q=>Q.timeframe==="1w"),Q=>{var O=PK();O.__click=[IK,ns,ft],we(()=>{var U;return $i(O,`timeframe-btn ${(((U=o().period)==null?void 0:U.timeframe)==="1w"?"timeframe-btn-active":"")??""} svelte-1jfzca0`)}),Y(Q,O)});var Xt=m(Bt,2);Xt.__click=[MK,le];var W=m(Xt,2);Ve(W,()=>i(le),Q=>{var O=$K(),U=y(O);qo(U,17,()=>jt,yi,(ye,Qe)=>{var Ue=AK();Ue.__click=[NK,ns,Qe];var dt=y(Ue),et=y(dt,!0);_(dt),Oi(2),_(Ue),we(()=>{var B;$i(Ue,`timeframe-btn ${(i(Qe).timeframe===((B=o().period)==null?void 0:B.timeframe)?"timeframe-btn-active":"")??""} svelte-1jfzca0`),st(et,i(Qe).timeframe)}),Y(ye,Ue)});var ce=m(U,2);Ve(ce,()=>!l(),ye=>{var Qe=FK();Qe.__click=[TK,ns,ke],we(()=>{var Ue;return $i(Qe,`timeframe-btn ${(((Ue=o().period)==null?void 0:Ue.timeframe)==="4h"?"timeframe-btn-active":"")??""} svelte-1jfzca0`)}),Y(ye,Qe)});var G=m(ce,2);Ve(G,()=>ft.find(ye=>ye.timeframe==="1M"),ye=>{var Qe=EK();Qe.__click=[LK,ns,ft],we(()=>{var Ue;return $i(Qe,`timeframe-btn ${(((Ue=o().period)==null?void 0:Ue.timeframe)==="1M"?"timeframe-btn-active":"")??""} svelte-1jfzca0`)}),Y(ye,Qe)}),_(O),Sv(1,O,()=>hV,()=>({duration:180})),Sv(2,O,()=>c_,()=>({duration:120})),Y(Q,O)}),_(Re),we(()=>{$i(Xt,`timeframe-btn timeframe-more-btn ${(i(le)?"timeframe-btn-active":"")??""} svelte-1jfzca0`),Dt(Xt,"aria-expanded",i(le))}),Y(ge,Re)}),_(er);var xd=m(er,2),_u=y(xd);_u.__click=[RK,X],_(xd);var eu=m(xd,2),ca=y(eu);ca.__click=[jK,wt];var vc=y(ca);nv(vc,{get name(){return fs().icon},size:16});var rc=m(vc,2),wd=y(rc,!0);we(()=>st(wd,fs().name)),_(rc),_(ca),_(eu);var zl=m(eu,2),Fd=y(zl);Fd.__click=[BK,T];var Tl=y(Fd);nv(Tl,{name:"indicator",size:16});var xa=m(Tl,2),ku=y(xa,!0);we(()=>st(ku,$x())),_(xa),_(Fd),_(zl);var Qu=m(zl,2),ed=y(Qu);ed.__click=function(...ge){var Re;(Re=i(Ls)?Ns:void 0)==null||Re.apply(this,ge)};var td=y(ed);nv(td,{class:"undo-redo-icon",name:"undo",size:16}),_(ed);var sp=m(ed,2);sp.__click=function(...ge){var Re;(Re=i(tn)?Hs:void 0)==null||Re.apply(this,ge)};var Gf=y(sp);nv(Gf,{class:"undo-redo-icon",name:"redo",size:16}),_(sp),_(Qu),_(Eo);var kd=m(Eo,2),Zd=y(kd),gc=Lt(()=>i(pt)&&!i(Rt));tY(Zd,{get savedLayouts(){return i(Ke)},get activeSaveId(){return i(kt)},get isLoading(){return i(gc)},get hasUnsavedChanges(){return Ht},$$events:{save:Al,saveAs:sa,quickSave:Al,load:vu,delete:Qc,newLayout:Vc,showPopup:qi}});var jf=m(Zd,2);jf.__click=[cK,u,Oe,De];var Nf=y(jf);MB(Nf,{size:18}),_(jf);var Jd=m(jf,2);Ve(Jd,()=>c().mode==="none",ge=>{var Re=zK();Re.__click=[OK,I];var vt=y(Re);nv(vt,{name:"play",size:18}),_(Re),Y(ge,Re)},ge=>{var Re=VK(),vt=y(Re);nv(vt,{name:"play",size:18}),_(Re),Y(ge,Re)});var xl=m(Jd,2);xl.__click=[WK,D];var Su=y(xl);IB(Su,{size:18}),_(xl);var ad=m(xl,2);ad.__click=[HK,E];var Af=y(ad);BB(Af,{size:18}),_(ad);var fu=m(ad,2);fu.__click=function(...ge){var Re;(Re=e.onToggleScriptStudio)==null||Re.apply(this,ge)};var $u=y(fu);PB($u,{size:18}),_(fu);var yu=m(fu,2);yu.__click=aa;var Yf=y(yu);CB(Yf,{size:18}),_(yu);var Ga=m(yu,2);Ga.__click=[qK,Ge,Zr];var nf=y(Ga);Ve(nf,()=>i(C),ge=>{LB(ge,{size:18})},ge=>{FB(ge,{size:18})}),_(Ga);var Sd=m(Ga,2);Sd.__click=[nK,o,p,Cn,xe,re,no];var wp=y(Sd);Ve(wp,()=>o().theme==="dark",ge=>{EB(ge,{size:20})},ge=>{OB(ge,{size:20})}),_(Sd),_(kd),_(Ti),hp(Ti,ge=>b(an,ge),()=>i(an));var ac=m(Ti,2);Ve(ac,()=>i(Gs),ge=>{var Re=XK();Re.__click=[UK,El],Re.__touchstart=[GK,qu],Re.__touchend=[YK],Re.__pointerdown=[KK,El],Y(ge,Re)}),_(ri);var Ld=m(ri,2);Ve(Ld,()=>i(re),ge=>{var Re=ZK(),vt=y(Re),Bt=m(y(vt),2),Xt=y(Bt);Oi(2),_(Bt);var W=m(Bt,2),Q=y(W);Q.__click=[iK,xe,no,re];var O=m(Q,2);O.__click=[oK,xe,no,re],_(W),_(vt),_(Re),we(()=>st(Xt,`${`You're changing the user interface to the ${i(xe)==="light"?"Light":"Dark"} theme.`??""} `)),Y(ge,Re)});var Cu=m(Ld,2);Ve(Cu,()=>i(Je),ge=>{var Re=eX(),vt=_s(Re);vt.__click=[JK,Je];var Bt=m(vt,2),Xt=m(y(Bt),2),W=y(Xt);W.__click=[QK,Je];var Q=m(W,2),O=y(Q),U=y(O);nv(U,{name:"candle_solid",size:36}),Oi(2),_(O),_(Q);var ce=m(Q,8);we(()=>Dt(ce,"href",ki("https://dutyai.app/settings/investor?device=1",void 0))),_(Xt),_(Bt),Sv(3,vt,()=>c_,()=>({duration:180})),Sv(3,Bt,()=>c_,()=>({duration:200})),Y(ge,Re)});var Ie=m(Cu,2);tK(Ie,{get show(){return i(I)},$$events:{close:()=>b(I,!1)}}),we(()=>{b1(vi,`menu-toggle-icon ${(i(v)?"":"rotate")??""} svelte-1jfzca0`),$i(ar,`menu-btn ${(i(ie)?"menu-btn-active":"")??""} ${(i(te)?"rotate-loading":"")??""} svelte-1jfzca0`),Dt(ar,"title",i(ie)?"Exit Fullscreen & Rotation":"Fullscreen & Rotate to Landscape"),ar.disabled=i(te),yr(nl,"rotate-content-hidden",i(te)),yr(mc,"rotate-icon-spinning",i(te)),st(Ua,i(de)),$i(ed,`undo-redo-btn ${(i(Ls)?"":"undo-redo-disabled")??""} svelte-1jfzca0`),$i(sp,`undo-redo-btn ${(i(tn)?"":"undo-redo-disabled")??""} svelte-1jfzca0`),Dt(Ga,"title",i(C)?"Exit Fullscreen":"Fullscreen")}),Y(s,br),Kd()}$p(["click","change","touchstart","touchend","pointerdown"]);var nX=be('<div class="modal-backdrop svelte-1oypfgf"><div class="modal-content svelte-1oypfgf"><div class="modal-actions svelte-1oypfgf"><button class="action-btn copy-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"></rect><path d="M5 15H4C2.9 15 2 14.1 2 13V4C2 2.9 2.9 2 4 2H13C14.1 2 15 2.9 15 4V5" stroke="currentColor" stroke-width="2"></path></svg> <span class="svelte-1oypfgf"> </span></button> <button class="action-btn reset-btn svelte-1oypfgf"><svg width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M3 12C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12C21 16.97 16.97 21 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M3 12L7 8M3 12L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg> <span class="svelte-1oypfgf">Reset View</span></button></div></div></div>');function oX(s,e){Yd(e,!1);let t=bi(e,"isOpen",12,!1),n=bi(e,"x",8,0),o=bi(e,"y",8,0),r=bi(e,"currentPrice",8,"");const a=fm();function l(){t(!1),a("close")}function c(){a("reset"),l()}function f(){a("copy",{price:r()}),l()}function u(v){v.target===v.currentTarget&&l()}function d(v){v.key==="Escape"&&l()}$m();var h=Qs();pd("keydown",s8,d);var p=_s(h);Ve(p,t,v=>{var x=nX(),S=y(x),C=y(S),I=y(C),A=m(y(I),2),P=y(A);_(A),_(I);var T=m(I,2);_(C),_(S),_(x),we(()=>{Dt(S,"style",`left: ${n()??""}px; top: ${o()??""}px;`),st(P,`Copy Price ${(r()?`(${r()})`:"")??""}`)}),pd("click",I,f),pd("click",T,c),pd("click",x,u),Y(v,x)}),Y(s,h),Kd()}class iX{constructor(e){Pe(this,"chart");Pe(this,"overlays",new Map);Pe(this,"projectionQueue",new Set);Pe(this,"isProjecting",!1);Pe(this,"eventListeners",new Map);Pe(this,"resizeObserver");Pe(this,"periodicProjectionId");Pe(this,"lastViewportState");Pe(this,"animationFrameId",null);this.chart=e,this.initializeEventListeners()}initializeEventListeners(){if(typeof ResizeObserver<"u"){const e=this.chart.getDom();if(e){const t=new ResizeObserver(()=>{this.scheduleProjection("resize")});t.observe(e),this.resizeObserver=t}}this.setupPeriodicProjection()}setupPeriodicProjection(){this.periodicProjectionId=window.setInterval(()=>{const e=this.getViewportState();e!==this.lastViewportState&&(this.lastViewportState=e,this.scheduleProjection("scroll"))},100)}getViewportState(){try{const e=this.chart.getVisibleRange(),t=this.chart.getSize();return JSON.stringify({visibleRange:e,chartSize:t})}catch{return""}}scheduleProjection(e){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>{this.projectAllOverlays(e),this.animationFrameId=null})}addOverlay(e){this.overlays.set(e.id,e),e.points.length>0&&Vk(e.points,this.chart),this.projectOverlay(e)}removeOverlay(e){this.overlays.delete(e);try{this.chart.removeOverlay({id:e})}catch(t){console.warn("Could not remove overlay from chart:",t)}}updateOverlay(e){this.overlays.has(e.id)&&(this.overlays.set(e.id,e),e.points.length>0&&Vk(e.points,this.chart),this.projectOverlay(e))}getOverlay(e){return this.overlays.get(e)}getAllOverlays(){return Array.from(this.overlays.values())}projectOverlay(e){const t={chart:this.chart,paneId:"candle_pane"},n=l4(e.points,t);return n.isValid&&e.visible!==!1&&this.updateChartOverlay(e,n.screenPoints),n}projectAllOverlays(e){if(!this.isProjecting){this.isProjecting=!0;try{const t={type:e,chart:this.chart,timestamp:Date.now()};this.emitEvent(e,t);for(const n of this.overlays.values())n.visible!==!1&&this.projectOverlay(n)}finally{this.isProjecting=!1}}}updateChartOverlay(e,t){try{const n=t.map(l=>({x:l.x,y:l.y})),o={id:e.id,name:e.type,points:n.map((l,c)=>{var f,u;return{...l,timestamp:(f=e.points[c])==null?void 0:f.t,value:(u=e.points[c])==null?void 0:u.p}}),styles:this.convertOverlayStyles(e.style),visible:e.visible,lock:e.lock},r=this.chart.getOverlays({id:e.id});(r.length>0?r[0]:null)?this.chart.overrideOverlay(o):this.chart.createOverlay(o)}catch(n){console.error("Error updating chart overlay:",n)}}convertOverlayStyles(e){const t={};return e.line&&(t.line={color:e.line.color,size:e.line.size,style:e.line.style==="dashed"?"dashed":"solid"},e.line.dashedValue&&(t.line.dashedValue=e.line.dashedValue)),e.text&&(t.text={color:e.text.color,backgroundColor:e.text.backgroundColor,borderColor:e.text.borderColor,fontSize:e.text.fontSize}),e.polygon&&(t.polygon={color:e.polygon.color,fillColor:e.polygon.fillColor}),t}onTimeframeChange(){this.scheduleProjection("timeframeChange")}onTimezoneChange(){this.scheduleProjection("timezoneChange")}onPriceScaleChange(){this.scheduleProjection("priceScaleChange")}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}removeEventListener(e,t){const n=this.eventListeners.get(e);n&&n.delete(t)}emitEvent(e,t){const n=this.eventListeners.get(e);n&&n.forEach(o=>{try{o(t)}catch(r){console.error("Error in overlay event listener:",r)}})}forceProjection(){this.projectAllOverlays("resize")}clearAllOverlays(){for(const e of this.overlays.keys())this.removeOverlay(e);this.overlays.clear()}dispose(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0),this.periodicProjectionId&&(clearInterval(this.periodicProjectionId),this.periodicProjectionId=void 0),this.clearAllOverlays(),this.eventListeners.clear()}}const rX={timeframeChange:{debounceMs:100,enabled:!0},zoom:{throttleMs:16,enabled:!0},scroll:{throttleMs:16,enabled:!0},resize:{debounceMs:250,enabled:!0},dataUpdate:{debounceMs:50,enabled:!0},priceScaleChange:{debounceMs:100,enabled:!0}};class aX{constructor(e,t={}){Pe(this,"chart");Pe(this,"projectionManager",null);Pe(this,"creationManager",null);Pe(this,"eventListeners",new Map);Pe(this,"resizeObserver",null);Pe(this,"config");Pe(this,"debounceTimers",new Map);Pe(this,"throttleTimers",new Map);this.chart=e,this.config={...rX,...t}}setProjectionManager(e){this.projectionManager=e}setCreationManager(e){this.creationManager=e}initialize(){this.setupChartEventListeners(),this.setupResizeObserver(),this.setupCustomEventListeners()}setupChartEventListeners(){this.setupViewportChangeDetection()}setupViewportChangeDetection(){let e=null;const n=setInterval(()=>{try{const o=this.chart.getVisibleRange();o&&this.hasRangeChanged(e,o)&&(e=o,this.handleEvent("scroll"))}catch(o){console.error("Error checking viewport changes:",o)}},16);this.eventListeners.set("viewportPolling",()=>clearInterval(n))}setupResizeObserver(){const e=this.chart.getDom();e&&(this.resizeObserver=new ResizeObserver(()=>{this.handleEvent("resize")}),this.resizeObserver.observe(e))}setupCustomEventListeners(){const e=this.chart.getDom();if(!e)return;const t=()=>this.handleEvent("timeframeChange"),n=()=>this.handleEvent("dataUpdate");e.addEventListener("timeframeChange",t),e.addEventListener("dataUpdate",n),this.eventListeners.set("timeframeChange",()=>{e.removeEventListener("timeframeChange",t)}),this.eventListeners.set("dataUpdate",()=>{e.removeEventListener("dataUpdate",n)})}handleEvent(e){const t=this.config[e];t.enabled&&(t.debounceMs?this.debounceEvent(e,t.debounceMs):t.throttleMs?this.throttleEvent(e,t.throttleMs):this.executeEvent(e))}debounceEvent(e,t){const n=this.debounceTimers.get(e);n&&clearTimeout(n);const o=setTimeout(()=>{this.executeEvent(e),this.debounceTimers.delete(e)},t);this.debounceTimers.set(e,o)}throttleEvent(e,t){const n=this.throttleTimers.get(e)||0,o=Date.now();o-n>=t&&(this.executeEvent(e),this.throttleTimers.set(e,o))}executeEvent(e){try{this.projectionManager&&this.projectionManager.forceProjection();const t=this.chart.getDom();t&&t.dispatchEvent(new CustomEvent("overlayEvent",{detail:{type:e,timestamp:Date.now()}}))}catch(t){console.error(`Error handling ${e} event:`,t)}}hasRangeChanged(e,t){return e?e.from!==t.from||e.to!==t.to:!0}hasPriceRangeChanged(e,t){return e?Math.abs(e.min-t.min)>1e-8||Math.abs(e.max-t.max)>1e-8:!0}triggerEvent(e){this.handleEvent(e)}updateConfig(e,t){this.config[e]={...this.config[e],...t}}setEventEnabled(e,t){this.config[e].enabled=t}destroy(){this.debounceTimers.forEach(e=>clearTimeout(e)),this.debounceTimers.clear(),this.throttleTimers.clear(),this.eventListeners.forEach(e=>e()),this.eventListeners.clear(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}}function Jk(s){return typeof s=="object"&&s!==null&&typeof s.x=="number"&&typeof s.y=="number"}function Qk(s){return typeof s=="object"&&s!==null&&typeof s.timestamp=="number"&&typeof s.value=="number"}function y2(s){return typeof s=="object"&&s!==null}class lX{constructor(e){Pe(this,"chart");Pe(this,"currentSymbolKey",null);this.chart=e}toDrawing(e,t){try{if(!this.currentSymbolKey)return null;const n=Array.isArray(t==null?void 0:t.points)?t.points.map(f=>{if(f&&typeof f=="object"){if(typeof f.timestamp=="number"&&typeof f.value=="number")return{time:f.timestamp,price:f.value};if(typeof f.t=="number"&&typeof f.p=="number")return{time:f.t,price:f.p}}return null}).filter(Boolean):[];if(n.length===0)return null;const o=(t==null?void 0:t.name)||(t==null?void 0:t.type)||"unknown",r=(t==null?void 0:t.styles)||(t==null?void 0:t.style)||{},a=!!(t!=null&&t.lock),l=(t==null?void 0:t.visible)!==!1;return{id:e,symbolKey:this.currentSymbolKey,type:o,points:n,styles:r,...t!=null&&t.extendData?{extendData:t.extendData}:{},locked:a,visible:l}}catch{return null}}setCurrentSymbolKey(e){this.currentSymbolKey=e,console.log("📍 OverlayCreationManager symbol set:",e)}getCurrentSymbolKey(){return this.currentSymbolKey}createPointFromMouse(e,t){try{const n={x:e,y:t},o={chart:this.chart},r=mV(n,o);return r?{timestamp:r.t,value:r.p}:null}catch(n){return console.error("Failed to create point from mouse coordinates:",n),null}}createDataSpaceOverlay(e){if(!y2(e)||!e.points||!Array.isArray(e.points))return e;const t=e.points.map(n=>{if(Jk(n)){const o=this.createPointFromMouse(n.x,n.y);return o?{timestamp:o.timestamp,value:o.value}:n}else if(Qk(n))return n;return n});return{...e,points:t,_isDataSpace:!0}}convertLegacyOverlay(e){if(!y2(e)||e._isDataSpace||!e.points)return e;const t=e.points.map(n=>{if(Jk(n)){const o=this.createPointFromMouse(n.x,n.y);return o?{timestamp:o.timestamp,value:o.value}:n}return n});return{...e,points:t,_isDataSpace:!0}}projectOverlayToScreen(e){if(!y2(e)||!e._isDataSpace||!e.points)return e;const t=e.points.map(n=>{if(Qk(n)){const o={id:n.id||"temp",t:n.timestamp,p:n.value},r={chart:this.chart},a=db(o,r);return a?{x:a.x,y:a.y}:n}return n});return{...e,points:t}}addOverlay(e){try{const t=this.createDataSpaceOverlay(e),n=this.projectOverlayToScreen(t),o=this.chart.createOverlay(n);if(o){const r=Array.isArray(o)?o[0]:o;if(typeof r=="string"){const a=ag();if(a){const l=this.toDrawing(r,t);if(l){a.addDrawing(l);try{Hm()}catch{}}}}return r}return null}catch(t){return console.error("Failed to add overlay:",t),null}}storeDataSpaceOverlay(e,t){}getStoredDataSpaceOverlay(e){try{const t=localStorage.getItem("dataSpaceOverlays");return t&&JSON.parse(t)[e]||null}catch(t){return console.error("Failed to retrieve data-space overlay:",t),null}}removeStoredDataSpaceOverlay(e){try{const t=ag();if(t){t.removeDrawing(e);try{Hm()}catch{}}}catch(t){console.error("Failed to remove overlay from DrawingManager:",t)}}}function cX(s){return s.createDataSpaceTemplate("enhancedRect",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:n})=>{var c,f,u,d,h,p;if(n.length<2)return[];const[o,r]=n,a=[],l=30;return a.push({type:"rect",attrs:{x:Math.min(o.x,r.x)-l,y:Math.min(o.y,r.y)-l,width:Math.abs(r.x-o.x)+l*2,height:Math.abs(r.y-o.y)+l*2},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),a.push({type:"rect",attrs:{x:Math.min(o.x,r.x),y:Math.min(o.y,r.y),width:Math.abs(r.x-o.x),height:Math.abs(r.y-o.y)},styles:{style:"stroke",color:((f=(c=e.style)==null?void 0:c.line)==null?void 0:f.color)||"#1677FF",borderSize:((d=(u=e.style)==null?void 0:u.line)==null?void 0:d.size)||1,borderStyle:((p=(h=e.style)==null?void 0:h.line)==null?void 0:p.style)||"solid"}}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function uX(s){return s.createDataSpaceTemplate("enhancedCircle",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:n})=>{var f,u,d,h,p,v;if(n.length<2)return[];const[o,r]=n,a=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),l=[];return l.push({type:"circle",attrs:{x:o.x,y:o.y,r:a+30},styles:{style:"fill",color:"transparent"},ignoreEvent:!1}),l.push({type:"circle",attrs:{x:o.x,y:o.y,r:a},styles:{style:"stroke",color:((u=(f=e.style)==null?void 0:f.line)==null?void 0:u.color)||"#1677FF",borderSize:((h=(d=e.style)==null?void 0:d.line)==null?void 0:h.size)||1,borderStyle:((v=(p=e.style)==null?void 0:p.line)==null?void 0:v.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function dX(s){return s.createDataSpaceTemplate("enhancedLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:n})=>{var r,a,l,c,f,u;if(n.length<2)return[];const o=[];for(let d=0;d<n.length-1;d++){const h=n[d],p=n[d+1];o.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:p.x,y:p.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),o.push({type:"line",attrs:{coordinates:[{x:h.x,y:h.y},{x:p.x,y:p.y}]},styles:{color:((a=(r=e.style)==null?void 0:r.line)==null?void 0:a.color)||"#1677FF",size:((c=(l=e.style)==null?void 0:l.line)==null?void 0:c.size)||.5,style:((u=(f=e.style)==null?void 0:f.line)==null?void 0:u.style)||"solid"}})}return o},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function fX(s){return s.createDataSpaceTemplate("enhancedTrendLine",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:n,chart:o})=>{var h,p,v,x,S,C;if(n.length<2)return[];const[r,a]=n,l=[];let c=r,f=a;const u=e.extendLeft,d=e.extendRight;if(u||d){const I=o.getSize();if(I){const A=(a.y-r.y)/(a.x-r.x);if(u&&(c={x:0,y:r.y+A*(0-r.x)}),d){const P=r.y+A*(I.width-r.x);f={x:I.width,y:P}}}}return l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:f.x,y:f.y}]},styles:{color:"transparent",size:40,style:"solid"},ignoreEvent:!1}),l.push({type:"line",attrs:{coordinates:[{x:c.x,y:c.y},{x:f.x,y:f.y}]},styles:{color:((p=(h=e.style)==null?void 0:h.line)==null?void 0:p.color)||"#1677FF",size:((x=(v=e.style)==null?void 0:v.line)==null?void 0:x.size)||.5,style:((C=(S=e.style)==null?void 0:S.line)==null?void 0:C.style)||"solid"}}),l},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function pX(s){return s.createDataSpaceTemplate("enhancedFibonacci",{totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createDataSpaceFigures:({overlay:e,projectionResult:t,screenCoordinates:n})=>{if(n.length<2)return[];const[o,r]=n,a=[],l=[0,.236,.382,.5,.618,.786,1,1.618,2.618],c=r.y-o.y;return l.forEach(f=>{var d,h,p,v,x,S,C,I;const u=o.y+c*f;a.push({type:"line",attrs:{coordinates:[{x:Math.min(o.x,r.x),y:u},{x:Math.max(o.x,r.x),y:u}]},styles:{color:"transparent",size:30,style:"solid"},ignoreEvent:!1}),a.push({type:"line",attrs:{coordinates:[{x:Math.min(o.x,r.x),y:u},{x:Math.max(o.x,r.x),y:u}]},styles:{color:((h=(d=e.style)==null?void 0:d.line)==null?void 0:h.color)||"#1677FF",style:"dashed",size:((v=(p=e.style)==null?void 0:p.line)==null?void 0:v.size)||2}}),a.push({type:"text",attrs:{x:Math.max(o.x,r.x)+5,y:u,text:`${(f*100).toFixed(1)}%`},styles:{color:((S=(x=e.style)==null?void 0:x.text)==null?void 0:S.color)||"#666666",size:((I=(C=e.style)==null?void 0:C.text)==null?void 0:I.fontSize)||12}})}),a},onDrawStart:()=>!0,onDrawing:()=>!0,onDrawEnd:()=>!0})}function hX(s){return{enhancedRect:cX(s),enhancedCircle:uX(s),enhancedLine:dX(s),enhancedTrendLine:fX(s),enhancedFibonacci:pX(s)}}const dx=["sma","smma","ema","wma","rsi","bbands","bollinger","bollinger_bands","atr","obv","cci","mfi","ao","trix","vwap","vwma","zscore","evwma","roc","macd","supertrend","kc","keltner","donchian","atr_bands","vwap_bands","linreg_channel","sar","stoch","ichimoku","pivot_high","pivot_low","auto_fib","autofib","last_value","prev_value","line_value","security","expr","formula"],fx=["line","histogram","area","cross","dots","stepped","step","bar","candles","ohlc","neon_line","bezier_line","glow_points","heatmap","distortion","cloud","aura","candleshadow","supertrend_cloud","fractal_boxes","liquidity_tiles"],px=["arrowUp","arrowDown","circle","square","cross","xcross","diamond","triangle_up_filled","triangle_down_filled","box","label","text","emoji","triangle_up_gradient","triangle_down_gradient","arrow_up_glow","arrow_down_glow","circle_pulse","pill","tag","flag","box_gradient","bubble","spark","star"];function Pc(s){return Array.isArray(s)?s:[]}function bf(s){return typeof s=="string"?s:void 0}function Qp(s){return typeof s=="number"&&Number.isFinite(s)?s:void 0}function b2(s){return String(s||"").replace(/\s+/g,"_").toLowerCase()}function mX(s,e,t,n){if(!s.length)return{series:[],stateSeries:[]};const o=[],r=[],a=new Set(e.map(f=>b2(String((f==null?void 0:f.name)||""))).filter(Boolean)),l=new Set(t.map(f=>b2(String((f==null?void 0:f.name)||""))).filter(Boolean)),c=f=>f==null?"":typeof f=="string"?f:typeof f=="number"&&Number.isFinite(f)?String(f):typeof f=="boolean"?f?"true":"false":"";return s.forEach((f,u)=>{if(!f||typeof f!="object")return;const d=bf(f.type),h=(d?d.toLowerCase():"")||(f.state?"state":(f.series,"series")),p=bf(f.name)||bf(f.series)||bf(f.state)||"";if(!p){n.push(`rules[${u}] missing name`);return}if(h!=="series"&&h!=="state"){n.push(`rules[${u}] invalid type "${String(f.type||"")}"`);return}const v=b2(p);if(a.has(v)||l.has(v)){n.push(`rules[${u}] name "${p}" conflicts with existing series/stateSeries`);return}const x=c(f.whenExpr??f.when),S=c(f.then??f.value??f.expr);if(!S){n.push(`rules[${u}] missing expression`);return}const C=c(f.else),I=x&&x.trim()?`iff(${x}, ${S}, ${C||(h==="state"?p:"na")})`:S;if(h==="state"){const A=c(f.init)||void 0,P=f.selfMode;r.push({name:p,initExpr:A,updateExpr:I,selfMode:P}),l.add(v)}else o.push({name:p,expr:I}),a.add(v)}),{series:o,stateSeries:r}}function T_(s){const e=[];if(!s||typeof s!="object")return e.push("Script must be an object"),{ok:!1,errors:e};const t=s,n=!!(t!=null&&t.strategy)||Pc(t==null?void 0:t.signals).length>0,o=Pc(t.calc),r=Pc(t.series),a=Pc(t.stateSeries),l=Pc(t.rules),c=mX(l,r,a,e);c.series.length&&r.push(...c.series),c.stateSeries.length&&a.push(...c.stateSeries);const f=[];if(Array.isArray(t.panes)&&t.panes.length)for(const d of t.panes){const h=d.pane==="sub"?"sub":"main";f.push({pane:h,plots:Pc(d.plots),levels:Pc(d.levels),labels:Pc(d.labels),lines:Pc(d.lines),runtimeDrawOps:Pc(d.runtimeDrawOps),runtimeLabels:Pc(d.runtimeLabels),runtimeLines:Pc(d.runtimeLines),runtimeBoxes:Pc(d.runtimeBoxes),runtimeTables:Pc(d.runtimeTables),runtimeHeatmaps:Pc(d.runtimeHeatmaps),overlays:Pc(d.overlays),min:Qp(d.min),max:Qp(d.max),shortName:bf(d.shortName),fills:Pc(d.fills),backgroundZones:Pc(d.backgroundZones),height:Qp(d.height)})}else if(t.main||t.sub)t.main&&f.push({pane:"main",plots:Pc(t.main.plots),levels:Pc(t.main.levels),labels:Pc(t.main.labels),lines:Pc(t.main.lines),runtimeDrawOps:Pc(t.main.runtimeDrawOps),runtimeLabels:Pc(t.main.runtimeLabels),runtimeLines:Pc(t.main.runtimeLines),runtimeBoxes:Pc(t.main.runtimeBoxes),runtimeTables:Pc(t.main.runtimeTables),runtimeHeatmaps:Pc(t.main.runtimeHeatmaps),overlays:Pc(t.main.overlays),min:Qp(t.main.min),max:Qp(t.main.max),shortName:bf(t.main.shortName||t.shortName),fills:Pc(t.main.fills),backgroundZones:Pc(t.main.backgroundZones),height:Qp(t.main.height)}),t.sub&&f.push({pane:"sub",plots:Pc(t.sub.plots),levels:Pc(t.sub.levels),labels:Pc(t.sub.labels),lines:Pc(t.sub.lines),runtimeDrawOps:Pc(t.sub.runtimeDrawOps),runtimeLabels:Pc(t.sub.runtimeLabels),runtimeLines:Pc(t.sub.runtimeLines),runtimeBoxes:Pc(t.sub.runtimeBoxes),runtimeTables:Pc(t.sub.runtimeTables),runtimeHeatmaps:Pc(t.sub.runtimeHeatmaps),overlays:Pc(t.sub.overlays),min:Qp(t.sub.min),max:Qp(t.sub.max),shortName:bf(t.sub.shortName||t.shortName),fills:Pc(t.sub.fills),backgroundZones:Pc(t.sub.backgroundZones),height:Qp(t.sub.height)});else if(t.pane||t.plots||t.labels||t.levels||t.lines){const d=t.pane==="sub"?"sub":"main";f.push({pane:d,plots:Pc(t.plots),levels:Pc(t.levels),labels:Pc(t.labels),lines:Pc(t.lines),runtimeDrawOps:Pc(t.runtimeDrawOps),runtimeLabels:Pc(t.runtimeLabels),runtimeLines:Pc(t.runtimeLines),runtimeBoxes:Pc(t.runtimeBoxes),runtimeTables:Pc(t.runtimeTables),runtimeHeatmaps:Pc(t.runtimeHeatmaps),overlays:Pc(t.overlays),min:Qp(t.min),max:Qp(t.max),shortName:bf(t.shortName),fills:[],backgroundZones:[],height:void 0})}f.length||(n?f.push({pane:"main",plots:[],levels:[],labels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],runtimeHeatmaps:[],overlays:[],min:Qp(t.min),max:Qp(t.max),shortName:bf(t.shortName),fills:[],backgroundZones:[],height:void 0}):e.push("No panes defined"));const u={calc:o.map((d,h)=>({name:bf(d.name)||bf(d.type)||`calc_${h}`,type:bf(d.type)||bf(d.name),source:bf(d.source),period:Qp(d.period),fast:Qp(d.fast),slow:Qp(d.slow),signal:Qp(d.signal),kPeriod:Qp(d.kPeriod),dPeriod:Qp(d.dPeriod),left:Qp(d.left),right:Qp(d.right),tenkan:Qp(d.tenkan),kijun:Qp(d.kijun),senkouB:Qp(d.senkouB),expr:bf(d.expr),timeframe:bf(d.timeframe),symbol:bf(d.symbol),country:bf(d.country),lookahead:bf(d.lookahead),gaps:bf(d.gaps),lower:d.lower===!0?!0:void 0,params:d.params,style:d.style})),series:r.map((d,h)=>({name:bf(d.name)||`series_${h}`,expr:bf(d.expr)||""})),stateSeries:a.map((d,h)=>({name:bf(d.name)||`state_${h}`,initExpr:bf(d.initExpr),updateExpr:bf(d.updateExpr)||"",selfMode:d.selfMode||void 0})),panes:f,loopPlans:Array.isArray(t.loopPlans)?t.loopPlans:void 0,userFunctions:Array.isArray(t.userFunctions)?t.userFunctions:void 0,signals:Pc(t.signals).map((d,h)=>{const p=d==null?void 0:d.order,v=bf(d==null?void 0:d.title),x=bf(d==null?void 0:d.message),S=bf(d==null?void 0:d.whenExpr),C=bf(d==null?void 0:d.scoreExpr),I=bf(d==null?void 0:d.cooldownExpr),A=bf(p==null?void 0:p.kind),P=A?A.trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"):void 0,T=bf((d==null?void 0:d.frequency)??(d==null?void 0:d.freq)),j=Ke=>{if(typeof Ke=="number"&&Number.isFinite(Ke)||typeof Ke=="string")return Ke},E=Ke=>{if(typeof Ke=="number"&&Number.isFinite(Ke)||typeof Ke=="string")return Ke},L=j(p==null?void 0:p.price),D=j((p==null?void 0:p.stopPrice)??(p==null?void 0:p.stop)??(p==null?void 0:p.trigger)),X=j((p==null?void 0:p.limitPrice)??(p==null?void 0:p.limit)??(p==null?void 0:p.lmt)),ne=E(p==null?void 0:p.qty),de=E(p==null?void 0:p.cash),ie=E((p==null?void 0:p.commissionPct)??(p==null?void 0:p.commission)),te=E((p==null?void 0:p.slippagePct)??(p==null?void 0:p.slippage)),le=typeof(p==null?void 0:p.qtyPct)=="number"&&Number.isFinite(p.qtyPct)?p.qtyPct:void 0,pe=typeof le=="number"?Math.max(0,Math.min(100,le)):void 0,re=bf(p==null?void 0:p.oco),xe=typeof(p==null?void 0:p.expiresBars)=="number"&&Number.isFinite(p.expiresBars)?p.expiresBars:void 0,se=typeof xe=="number"?Math.max(0,Math.floor(xe)):void 0,Ne=p==null?void 0:p.bracket,Te=(()=>{if(!Ne||typeof Ne!="object")return;const Ke=Ne,kt=typeof Ke.stopLossPct=="number"&&Number.isFinite(Ke.stopLossPct)?Math.max(0,Ke.stopLossPct):void 0,pt=typeof Ke.takeProfitPct=="number"&&Number.isFinite(Ke.takeProfitPct)?Math.max(0,Ke.takeProfitPct):void 0,Rt=typeof Ke.trailingStopPct=="number"&&Number.isFinite(Ke.trailingStopPct)?Math.max(0,Ke.trailingStopPct):void 0,Ht=[],Ft=Array.isArray(Ke.takeProfits)?Ke.takeProfits:[];for(const zt of Ft){if(!zt||typeof zt!="object")continue;const ut=typeof zt.takeProfitPct=="number"?zt.takeProfitPct:Number(zt.takeProfitPct),nt=typeof zt.qtyPct=="number"?zt.qtyPct:Number(zt.qtyPct);!Number.isFinite(ut)||ut<=0||!Number.isFinite(nt)||nt<=0||Ht.push({takeProfitPct:Math.max(0,ut),qtyPct:Math.max(0,Math.min(100,nt))})}if(Ht.sort((zt,ut)=>zt.takeProfitPct-ut.takeProfitPct),!(kt==null&&pt==null&&Rt==null&&Ht.length===0))return{stopLossPct:kt,takeProfitPct:pt,trailingStopPct:Rt,takeProfits:Ht.length?Ht:void 0}})(),Me=typeof(d==null?void 0:d.cooldownBars)=="number"&&Number.isFinite(d.cooldownBars)?d.cooldownBars:void 0,De=typeof Me=="number"?Math.max(0,Math.floor(Me)):void 0;let Oe=null;return C==null&&(d==null?void 0:d.score)!=null&&(typeof d.score!="number"||!Number.isFinite(d.score)?e.push(`signals[${h}].score must be an integer 0..10`):Number.isInteger(d.score)?d.score<0||d.score>10?e.push(`signals[${h}].score must be in range 0..10`):Oe=d.score:e.push(`signals[${h}].score must be an integer 0..10`)),{type:String((d==null?void 0:d.type)||""),when:String((d==null?void 0:d.when)||""),whenExpr:S,id:bf(d==null?void 0:d.id),orderId:bf(d==null?void 0:d.orderId),title:v,message:x,frequency:T,score:Oe,scoreExpr:C,order:P||L!=null||D!=null||X!=null||ne!=null||de!=null||pe!=null||re!=null||se!=null||ie!=null||te!=null||Te!=null?{kind:P,price:L,stopPrice:D,limitPrice:X,qty:ne,cash:de,qtyPct:pe,oco:re,expiresBars:se,commissionPct:ie,slippagePct:te,bracket:Te}:void 0,cooldownBars:De,cooldownExpr:I}}),shortName:bf(t.shortName),strategy:t.strategy,params:t.params,style:t.style};return u.series.forEach((d,h)=>{d.name||e.push(`series[${h}] missing name`)}),u.stateSeries.forEach((d,h)=>{d.name||e.push(`stateSeries[${h}] missing name`),d.updateExpr||e.push(`stateSeries[${h}] missing updateExpr`)}),u.panes.forEach((d,h)=>{var p,v,x,S;!n&&!((p=d.plots)!=null&&p.length)&&!((v=d.labels)!=null&&v.length)&&!((x=d.levels)!=null&&x.length)&&!((S=d.lines)!=null&&S.length)&&e.push(`pane[${h}] has no plots/labels/levels/lines`)}),{ok:e.length===0,spec:u,errors:e}}const vX=new Set(["line","histogram","area","cross","dots","stepped","step","bar","neon_line","bezier_line","glow_points","cloud","supertrend_cloud","aura","candleshadow"]),e6=s=>!s.interactionActive&&!s.overlayHover,gX=(s,e={})=>{const t=typeof e.pad=="number"?e.pad:6,n=typeof e.swatch=="number"?e.swatch:8,o=typeof e.gap=="number"?e.gap:6,r=typeof e.lineHeight=="number"?e.lineHeight:14;let a=0,l=0;for(const u of s){const d=Number.isFinite(u.width)?u.width:0,h=Number.isFinite(u.height)?u.height:r;a=Math.max(a,d),l+=Math.max(r,h)}const c=t*2+n+o+a,f=t*2+l;return{boxW:c,boxH:f,usedHeight:f+6,maxTextW:a,totalH:l}};function fb(s){return typeof s=="number"&&Number.isFinite(s)}function g1(s,e,t){const n=s[t];if(fb(n))return n;const o=e[t];return fb(o)?o:NaN}function _1(s,e,t){const n=s[t];if(fb(n))return n;const o=e[t];return fb(o)?o:NaN}function t6(s,e,t,n){let o=-1,r=-1/0;for(let a=t;a<=n;a++){const l=g1(s,e,a);Number.isFinite(l)&&l>r&&(r=l,o=a)}return o}function s6(s,e,t,n){let o=-1,r=1/0;for(let a=t;a<=n;a++){const l=_1(s,e,a);Number.isFinite(l)&&l<r&&(r=l,o=a)}return o}function h4(s,e,t,n,o){const r=Math.min(s.length,e.length,t.length);if(r<=1)return null;const a=Math.min(r-1,Math.max(0,Math.trunc(n))),l=Math.max(2,Math.trunc(o.lookback||200)),c=Math.max(0,a-l+1),f=o.direction==="down"?"down":"up";if((o.method==="pivots"?"pivots":"extremes")==="pivots"){const x=Math.max(1,Math.floor(Number(o.pivotLeft??3))),S=Math.max(1,Math.floor(Number(o.pivotRight??3))),C=a;if(C<S)return null;const I=[],A=[],P=X=>{const ne=g1(s,t,X);if(!Number.isFinite(ne))return null;const de=Math.max(0,X-x),ie=Math.min(C,X+S);if(ie<X+S)return null;for(let te=de;te<=ie;te++){if(te===X)continue;const le=g1(s,t,te);if(!Number.isFinite(le)||le>=ne)return null}return ne},T=X=>{const ne=_1(e,t,X);if(!Number.isFinite(ne))return null;const de=Math.max(0,X-x),ie=Math.min(C,X+S);if(ie<X+S)return null;for(let te=de;te<=ie;te++){if(te===X)continue;const le=_1(e,t,te);if(!Number.isFinite(le)||le<=ne)return null}return ne},j=Math.max(c,0),E=Math.min(a-S,a);for(let X=j;X<=E;X++){const ne=P(X);ne!=null&&I.push({index:X,value:ne});const de=T(X);de!=null&&A.push({index:X,value:de})}const L=I.length?I[I.length-1]:null,D=A.length?A[A.length-1]:null;if(!(!L||!D))if(f==="up"){let X=null;for(let ne=A.length-1;ne>=0;ne--)if(A[ne].index<L.index){X=A[ne];break}if(X)return{fromIndex:X.index,toIndex:L.index,fromValue:X.value,toValue:L.value}}else{let X=null;for(let ne=I.length-1;ne>=0;ne--)if(I[ne].index<D.index){X=I[ne];break}if(X)return{fromIndex:X.index,toIndex:D.index,fromValue:X.value,toValue:D.value}}}if(f==="up"){const x=t6(s,t,c,a);if(x<0)return null;const S=s6(e,t,c,x);if(S<0)return null;const C=_1(e,t,S),I=g1(s,t,x);return[C,I].every(Number.isFinite)?{fromIndex:S,toIndex:x,fromValue:C,toValue:I}:null}const d=s6(e,t,c,a);if(d<0)return null;const h=t6(s,t,c,d);if(h<0)return null;const p=_1(e,t,d),v=g1(s,t,h);return[p,v].every(Number.isFinite)?{fromIndex:h,toIndex:d,fromValue:v,toValue:p}:null}function _X(s,e,t,n){const o=Math.min(s.length,e.length,t.length),r=new Array(o),a=new Array(o),l=new Array(o),c=new Array(o),f=new Array(o),u=new Array(o),d=new Array(o);for(let h=0;h<o;h++){const p=h4(s,e,t,h,n);if(!p){r[h]=void 0,a[h]=void 0,l[h]=void 0,c[h]=void 0,f[h]=void 0,u[h]=void 0,d[h]=void 0;continue}r[h]=p.fromValue,a[h]=p.toValue,l[h]=p.fromIndex,c[h]=p.toIndex,f[h]=p.fromValue,d[h]=p.toValue,u[h]=p.fromValue+(p.toValue-p.fromValue)*.5}return{from:r,to:a,fromIndex:l,toIndex:c,lvl0:f,lvl50:u,lvl100:d}}function yX(s){const{seriesMap:e,calcDefs:t,len:n,params:o,lastPrevSource:r,resolveNum:a,onError:l}=s,c=o||{},f=(c==null?void 0:c.__pinev2)===1,u=d=>f?R_(d,{pineV2:!0}).expr:String(d??"");for(const d of t){const h=d.name||d.type;if(!h)continue;const p=String(h).replace(/\s+/g,"_").toLowerCase(),v=String(d.type||"").toLowerCase();if(v!=="security"){if(v==="sma"){const x=d.source||"close";e[p]=f_(e[x]||e.close,Math.max(1,a(d.period,`${p}_period`,14)))}else if(v==="smma"){const x=d.source||"close";e[p]=UL(e[x]||e.close,Math.max(1,a(d.period,`${p}_period`,13)))}else if(v==="ema"){const x=d.source||"close";e[p]=cg(e[x]||e.close,Math.max(1,a(d.period,`${p}_period`,14)))}else if(v==="wma"){const x=d.source||"close";e[p]=qL(e[x]||e.close,Math.max(1,a(d.period,`${p}_period`,14)))}else if(v==="rsi"){const x=d.source||"close";e[p]=GL(e[x]||e.close,Math.max(1,a(d.period,`${p}_period`,14)))}else if(v==="bbands"||v==="bollinger"||v==="bollinger_bands"){const x=d.source||"close",S=Math.max(1,a(d.period,`${p}_period`,20)),C=Math.max(.1,a(d.std,`${p}_std`,a(d.deviation,`${p}_deviation`,2))),{mid:I,upper:A,lower:P}=q2(e[x]||e.close,S,C);e[p+"_mid"]=I,e[p+"_upper"]=A,e[p+"_lower"]=P}else if(v==="atr"){const x=Math.max(1,a(d.period,`${p}_period`,14));e[p]=Xy(e.high,e.low,e.close,x)}else if(v==="obv")e[p]=F3(e.close,e.volume);else if(v==="cci"){const x=Math.max(1,a(d.period,`${p}_period`,20));e[p]=L3(e.high,e.low,e.close,x)}else if(v==="mfi"){const x=Math.max(1,a(d.period,`${p}_period`,14));e[p]=E3(e.high,e.low,e.close,e.volume,x)}else if(v==="ao")e[p]=YL(e.high,e.low);else if(v==="trix"){const x=Math.max(1,a(d.period,`${p}_period`,12));e[p]=KL(e.close,x)}else if(v==="vwap")e[p]=ok(e.close,e.volume);else if(v==="vwma"){const x=Math.max(1,a(d.period,`${p}_period`,20));e[p]=XL(e.close,e.volume,x)}else if(v==="macd"){const x=(d.source||"close").replace(/\s+/g,"_").toLowerCase(),S=Math.max(1,Number(d.fast)||12),C=Math.max(1,Number(d.slow)||26),I=Math.max(1,Number(d.signal)||9),A=e[x]||e.close,P=cg(A,S),T=cg(A,C),j=new Array(n);for(let X=0;X<n;X++)j[X]=P[X]===void 0||T[X]===void 0?void 0:P[X]-T[X];const E=cg(j,I),L=new Array(n),D=new Array(n);for(let X=0;X<n;X++){const ne=j[X],de=E[X];L[X]=typeof de=="number"&&Number.isFinite(de)?de:void 0,D[X]=ne!==void 0&&de!==void 0?ne-de:void 0}e.macd_line=j,e.macd_signal=L,e.macd_hist=D}else if(v==="supertrend"){const x=Math.max(1,Number(d.period)||10),S=Math.max(.1,Number(d.factor)||3);e[p]=ZL(e.high,e.low,e.close,x,S)}else if(v==="kc"||v==="keltner"){const x=Math.max(1,Number(d.period)||20),S=Math.max(.1,Number(d.mult)||2),C=JL(e.high,e.low,e.close,x,S);e[p+"_mid"]=C.mid,e[p+"_upper"]=C.upper,e[p+"_lower"]=C.lower}else if(v==="donchian"){const x=Math.max(1,Number(d.period)||20),S=QL(e.high,e.low,x);e[p+"_mid"]=S.mid,e[p+"_upper"]=S.upper,e[p+"_lower"]=S.lower}else if(v==="atr_bands"){const x=Math.max(1,Number(d.period)||14),S=Math.max(.1,Number(d.mult)||2),C=Xy(e.high,e.low,e.close,x),I=new Array(n),A=new Array(n);for(let P=0;P<n;P++){const T=C[P],j=e.close[P];I[P]=T!=null&&j!=null?j+S*T:void 0,A[P]=T!=null&&j!=null?j-S*T:void 0}e[p+"_upper"]=I,e[p+"_lower"]=A}else if(v==="zscore"){const x=Math.max(1,Number(d.period)||20),S=d.source||"close";e[p]=$3(e[S]||e.close,x)}else if(v==="volume_delta")e[p]=ik(e.close,e.volume);else if(v==="cum_delta"){const x=ik(e.close,e.volume);e[p]=eE(x)}else if(v==="vwap_bands"){const x=Math.max(1,Number(d.period)||20),S=ok(e.close,e.volume),{upper:C,lower:I}=q2(Array.from(S).map(A=>A),x,Math.max(.1,Number(d.std)||2));e[p+"_mid"]=Array.from(S),e[p+"_upper"]=C,e[p+"_lower"]=I}else if(v==="linreg_channel"){const x=Math.max(1,Number(d.period)||20),S=d.source||"close",C=tE(e[S]||e.close,x);e[p+"_mid"]=C.mid,e[p+"_upper"]=C.upper,e[p+"_lower"]=C.lower}else if(v==="evwma"){const x=Math.max(1,Number(d.period)||20);e[p]=D3(e.close,e.volume,x)}else if(v==="sar"){const x=Math.max(.001,Number(d.step)||.02),S=Math.max(x,Number(d.max)||.2),C=e.high,I=e.low,A=new Array(n);let P=x,T=C[0],j=I[0],E=!0;for(let L=1;L<n;L++){const D=C[L]??NaN,X=I[L]??NaN;if(!Number.isFinite(D)||!Number.isFinite(X)){A[L]=void 0;continue}let ne=j;E?(ne=j+P*(T-j),D>T&&(T=D,P=Math.min(S,P+x)),ne>X&&(E=!1,ne=T,T=X,P=x)):(ne=j-P*(j-T),X<T&&(T=X,P=Math.min(S,P+x)),ne<D&&(E=!0,ne=T,T=D,P=x)),A[L]=ne,j=ne}A[0]=j,e.sar=A}else if(v==="stoch"){const x=Number(d.kPeriod)||14,S=Number(d.dPeriod)||3,C=[],I=[];for(let P=0;P<n;P++){const T=Math.max(0,P-x+1);let j=-1/0,E=1/0;for(let ne=T;ne<=P;ne++){const de=e.high[ne]??e.close[ne]??NaN,ie=e.low[ne]??e.close[ne]??NaN;de>j&&(j=de),ie<E&&(E=ie)}const L=e.close[P]??NaN,D=j-E,X=D===0?void 0:100*((L-E)/D);C.push(X)}const A=f_(C.map(P=>P??NaN),S);for(let P=0;P<n;P++)I.push(isNaN(A[P])?void 0:A[P]);e[p+"_k"]=C,e[p+"_d"]=I}else if(v==="roc"){const x=d.source||"close",S=e[x]||e.close,C=Math.max(1,Number(d.period)||10),I=new Array(n);for(let A=0;A<n;A++){const P=S[A],T=S[A-C];P===void 0||T===void 0||T===0?I[A]=void 0:I[A]=(P/T-1)*100}e[p]=I}else if(v==="ichimoku"){const x=Math.max(1,Number(d.tenkan)||9),S=Math.max(1,Number(d.kijun)||26),C=Math.max(1,Number(d.senkouB)||52),I=S,A=new Array(n),P=new Array(n),T=new Array(n),j=new Array(n),E=new Array(n),L=new Array(n),D=new Array(n),X=e.high,ne=e.low,de=e.close,ie=(te,le)=>{let pe=-1/0,re=1/0;const xe=Math.max(0,te-le+1);for(let se=xe;se<=te;se++){const Ne=X[se]??de[se]??NaN,Te=ne[se]??de[se]??NaN;Ne>pe&&(pe=Ne),Te<re&&(re=Te)}return{hi:pe,lo:re}};for(let te=0;te<n;te++){if(te>=x-1){const{hi:le,lo:pe}=ie(te,x);A[te]=(le+pe)/2}if(te>=S-1){const{hi:le,lo:pe}=ie(te,S);P[te]=(le+pe)/2}if(A[te]!==void 0&&P[te]!==void 0&&(T[te]=(A[te]+P[te])/2),te>=C-1){const{hi:le,lo:pe}=ie(te,C);j[te]=(le+pe)/2}D[te]=te+I<n?de[te+I]:void 0}for(let te=0;te<n;te++)E[te]=te>=I?T[te-I]:void 0,L[te]=te>=I?j[te-I]:void 0;e.tenkan=A,e.kijun=P,e.spana=E,e.spanb=L,e.chikou=D}else if(v==="pivot_high"){const x=Math.max(0,Number(d.left)||3),S=Math.max(0,Number(d.right)||3),C=new Array(n);for(let I=0;I<n;I++){const A=e.high[I]??e.close[I]??NaN;if(!Number.isFinite(A)){C[I]=void 0;continue}let P=!0;const T=Math.max(0,I-x),j=Math.min(n-1,I+S);for(let E=T;E<=j;E++){if(E===I)continue;const L=e.high[E]??e.close[E]??NaN;if(!Number.isFinite(L)){P=!1;break}if(L>=A){P=!1;break}}C[I]=P?A:void 0}e[p]=C}else if(v==="pivot_low"){const x=Math.max(0,Number(d.left)||3),S=Math.max(0,Number(d.right)||3),C=new Array(n);for(let I=0;I<n;I++){const A=e.low[I]??e.close[I]??NaN;if(!Number.isFinite(A)){C[I]=void 0;continue}let P=!0;const T=Math.max(0,I-x),j=Math.min(n-1,I+S);for(let E=T;E<=j;E++){if(E===I)continue;const L=e.low[E]??e.close[E]??NaN;if(!Number.isFinite(L)){P=!1;break}if(L<=A){P=!1;break}}C[I]=P?A:void 0}e[p]=C}else if(v==="auto_fib"||v==="autofib"){const x=Math.max(2,Math.floor(a(d.lookback,`${p}_lookback`,200))),C=String(d.direction||"up").trim().toLowerCase()==="down"?"down":"up",I=String(d.method||d.mode||"extremes").trim().toLowerCase(),A=I==="pivots"||I==="pivot"||I==="swing"?"pivots":"extremes",P=Math.max(1,Math.floor(Number(d.pivotLeft??d.left??3))),T=Math.max(1,Math.floor(Number(d.pivotRight??d.right??3))),j=_X(e.high,e.low,e.close,{lookback:x,direction:C,method:A,pivotLeft:P,pivotRight:T});e[`${p}_from`]=j.from,e[`${p}_to`]=j.to,e[`${p}_from_idx`]=j.fromIndex,e[`${p}_to_idx`]=j.toIndex,e[`${p}_0`]=j.lvl0,e[`${p}_50`]=j.lvl50,e[`${p}_100`]=j.lvl100}else if(v==="last_value"){const x=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),S=e[x]||e.close,C=new Array(n);let I;for(let A=0;A<n;A++){const P=S[A];P!=null&&Number.isFinite(P)&&(I=P),C[A]=I}e[p]=C,r[p]=x}else if(v==="prev_value"){const x=String(d.source||"close").replace(/\s+/g,"_").toLowerCase(),S=e[x]||e.close,C=new Array(n);let I,A;for(let P=0;P<n;P++){const T=S[P];if(T!=null&&Number.isFinite(T)){const j=T;(I===void 0||j!==I)&&(A=I,I=j)}C[P]=A}e[p]=C,r[p]=x}else if(v==="line_value"){const x=String(d.startValue||"").replace(/\s+/g,"_").toLowerCase(),S=String(d.endValue||"").replace(/\s+/g,"_").toLowerCase();let I=r[x]||r[S]||"";I||(/pl|low/i.test(x)||/pl|low/i.test(S)?I="pl":(/ph|high/i.test(x)||/ph|high/i.test(S))&&(I="ph"));const A=e[I],P=new Array(n);if(A){const T=[];for(let j=n-1;j>=0&&T.length<2;j--){const E=A[j];E!=null&&Number.isFinite(E)&&T.push(j)}if(T.reverse(),T.length===2){const j=T[0],E=T[1],L=A[j],D=A[E];if(Number.isFinite(L)&&Number.isFinite(D)&&E!==j){const X=(D-L)/(E-j),ne=L-X*j,de=Math.max(1,Number(d.lookback)||n),ie=Math.max(0,E-de);for(let te=0;te<n;te++)P[te]=te>=ie?X*te+ne:void 0}}}e[p]=P}else if(v==="compare"){const x=String(d.left??"").trim(),S=String(d.right??"").trim(),C=String(d.op||">"),I=/^[-+]?\d+(?:\.\d+)?$/.test(x),A=/^[-+]?\d+(?:\.\d+)?$/.test(S),P=x.replace(/\s+/g,"_").toLowerCase(),T=S.replace(/\s+/g,"_").toLowerCase(),j=I?null:e[P]||e.close,E=A?null:e[T]||e.close,L=I?Number(x):NaN,D=A?Number(S):NaN,X=new Array(n);for(let ne=0;ne<n;ne++){const de=I?L:(j==null?void 0:j[ne])??NaN,ie=A?D:(E==null?void 0:E[ne])??NaN;if(!Number.isFinite(de)||!Number.isFinite(ie)){X[ne]=0;continue}let te=!1;switch(C){case">":te=de>ie;break;case"<":te=de<ie;break;case">=":te=de>=ie;break;case"<=":te=de<=ie;break;case"==":te=Math.abs(de-ie)<1e-9;break;default:te=de>ie;break}X[ne]=te?1:0}e[p]=X}else if(typeof d.expr=="string"&&String(d.expr).trim().length)try{const x={};Object.entries(e).forEach(([A,P])=>{const T=new Float32Array(n);for(let j=0;j<n;j++)T[j]=P[j]??NaN;x[A.replace(/\s+/g,"_").toLowerCase()]=T});const S=l_([{name:p,expr:u(String(d.expr).replace(/\$\{([^}]+)\}/g,(A,P)=>String(c[P]??A)))}],x,c),C=new Array(n),I=S[p];for(let A=0;A<n;A++){const P=I==null?void 0:I[A];C[A]=Number.isFinite(P)?P:void 0}e[p]=C}catch(x){if(l){const S=(x==null?void 0:x.message)!=null?String(x.message):String(x);l(`Expression error: ${S}`,x)}}}}}const m4=s=>/[A-Za-z_$]/.test(s),F_=s=>/[A-Za-z0-9_$]/.test(s),bX=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?/,xX=/[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,n6=(s,e)=>{let t=e;for(;t>=0&&/\s/.test(s[t]);)t-=1;return t},o6=(s,e)=>{let t=e;for(;t<s.length&&/\s/.test(s[t]);)t+=1;return t},wX=(s,e)=>{let t=1;for(let n=e-1;n>=0;n-=1){const o=s[n];if(o===")")t+=1;else if(o==="("&&(t-=1,t===0))return n}return-1},i6=(s,e)=>{let t=1;for(let n=e+1;n<s.length;n+=1){const o=s[n];if(o==="(")t+=1;else if(o===")"&&(t-=1,t===0))return n}return-1},kX=(s,e)=>{const t=n6(s,e-1);if(t<0)return null;const n=t+1,o=s[t];if(o===")"){const a=wX(s,t);if(a<0)return null;let l=a,c=n6(s,l-1);if(c>=0&&F_(s[c])){let f=c;for(;f>=0&&F_(s[f]);)f-=1;l=f+1}return{start:l,end:n}}if(F_(o)){let a=t;for(;a-1>=0&&F_(s[a-1]);)a-=1;return{start:a,end:n}}const r=xX.exec(s.slice(0,n));return r?{start:n-r[0].length,end:n}:null},SX=(s,e)=>{let t=o6(s,e);if(t>=s.length)return null;const n=s[t];if(n==="("){const r=i6(s,t);return r<0?null:{start:t,end:r+1}}if(m4(n)){let r=t+1;for(;r<s.length&&F_(s[r]);)r+=1;const a=o6(s,r);if(s[a]==="("){const l=i6(s,a);return l<0?null:{start:t,end:l+1}}return{start:t,end:r}}const o=bX.exec(s.slice(t));return o?{start:t,end:t+o[0].length}:null};function Oy(s){const e=String(s||""),t=e.length;if(!/crosses/i.test(e))return e;const n=[];let o=null,r=0;for(;r<t;){const c=e[r];if(o){c===o&&e[r-1]!=="\\"&&(o=null),r+=1;continue}if(c==="'"||c==='"'){o=c,r+=1;continue}if(m4(c)){let f=r+1;for(;f<t&&F_(e[f]);)f+=1;const d=e.slice(r,f).toLowerCase();if(d==="crossesabove"||d==="crossesbelow"){const h=kX(e,r),p=SX(e,f);if(h&&p){n.push({start:h.start,end:p.end,left:h,right:p,fn:d==="crossesabove"?"crossover":"crossunder"}),r=p.end;continue}}r=f;continue}r+=1}if(!n.length)return e;let a="",l=0;for(const c of n){a+=e.slice(l,c.start);const f=e.slice(c.left.start,c.left.end).trim(),u=e.slice(c.right.start,c.right.end).trim();a+=`${c.fn}(${f}, ${u})`,l=c.end}return a+=e.slice(l),a}function CX(s){console.error("[ScriptStudio]",s)}function hx(s,e){const t=o=>o.replace(/\$\{([^}]+)\}/g,(r,a)=>{const l=String(a),c=e[l];if(c==null)return r;if(typeof c=="number"&&Number.isFinite(c))return String(c);if(typeof c=="string")return c;try{return JSON.stringify(c)}catch{return String(c)}}),n=o=>{if(o==null)return o;if(typeof o=="string"){const r=o.match(/^\$\{([^}]+)\}$/);if(r){const a=String(r[1]),l=e[a];return l??o}return t(o)}if(Array.isArray(o))return o.map(n);if(typeof o=="object"){const r=Array.isArray(o)?[]:{};return Object.keys(o).forEach(a=>{const l=o[a];r[a]=n(l)}),r}return o};return n(s)}const r6=512;function IX(s,e){const t=s.match(/^\$\{([^}]+)\}$/);if(t){const n=String(t[1]||"");if(Object.prototype.hasOwnProperty.call(e,n))return e[n]}return s.replace(/\$\{([^}]+)\}/g,(n,o)=>{const r=String(o||"");if(!Object.prototype.hasOwnProperty.call(e,r))return n;const a=e[r];return typeof a=="string"?a:String(a)})}function mx(s,e){if(s==null)return s;if(typeof s=="string")return IX(s,e);if(Array.isArray(s))return s.map(t=>mx(t,e));if(typeof s=="object"){const t={};return Object.keys(s).forEach(n=>{t[n]=mx(s[n],e)}),t}return s}function vx(s){let e=0;const t=r=>{if(e+=r,e>r6)throw new Error(`Loop expansion exceeds ${r6} items`)},n=(r,a)=>{const l=r==null?void 0:r.repeat,c=r==null?void 0:r.forEach,f=r==null?void 0:r.template;if(!f||!l&&!c)return[];const u=[],d=p=>{const v=mx(f,p),x=o(v,p);Array.isArray(x)?u.push(...x):u.push(x)},h=(p,v,x)=>{p.forEach((S,C)=>{const I={...a,[v]:S};x&&(I[x]=C),t(1),d(I)})};if(c&&typeof c=="object"){if(!Array.isArray(c.items))throw new Error("forEach.items must be an array");const p=String(c.var||"item"),v=c.indexVar?String(c.indexVar):void 0;return h(c.items,p,v),u}if(l&&typeof l=="object"){const p=String(l.var||"i"),v=l.indexVar?String(l.indexVar):void 0;if(Array.isArray(l.items))return h(l.items,p,v),u;if(l.count!=null){const C=Number(l.count);if(!Number.isFinite(C))throw new Error("repeat.count must be a number");const I=Math.max(0,Math.floor(C)),A=new Array(I).fill(0).map((P,T)=>T);return h(A,p,v),u}const x=Number(l.from),S=Number(l.to);if(Number.isFinite(x)&&Number.isFinite(S)){const C=l.step!=null?Number(l.step):x<=S?1:-1;if(!Number.isFinite(C))throw new Error("repeat.step must be a number");const I=C===0?x<=S?1:-1:C,A=[];if(I>0)for(let P=x;P<=S;P+=I)A.push(P);else for(let P=x;P>=S;P+=I)A.push(P);return h(A,p,v),u}throw new Error("repeat requires count or from/to")}return u},o=(r,a)=>{if(r==null)return r;if(Array.isArray(r)){const l=[];return r.forEach(c=>{if(c&&typeof c=="object"&&!Array.isArray(c)&&(c.repeat||c.forEach)){if(!c.template)throw new Error("Loop directive requires template");l.push(...n(c,a))}else l.push(o(c,a))}),l}if(typeof r=="object"){const l={};return Object.keys(r).forEach(c=>{l[c]=o(r[c],a)}),l}return r};return o(s,{})}function Ib(s,e,t){if(s.save(),e&&(s.beginPath(),s.rect(e.left,e.top,e.width,e.height),s.clip()),t)try{t()}finally{s.restore()}}function a6(s,e,t,n,o,r){if(!e.length)return;const a=Math.max(1,n/2);Ib(s,o,()=>{if(s.save(),!!(r&&(r.from||r.to))){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(const C of e)!Number.isFinite(C.x)||!Number.isFinite(C.y)||(C.x<c&&(c=C.x),C.x>f&&(f=C.x),C.y<u&&(u=C.y),C.y>d&&(d=C.y));const h=Number.isFinite(c)?c:o?o.left:0,p=Number.isFinite(f)&&f!==c?f:h+1,v=Number.isFinite(u)?u:o?o.top:0,x=Number.isFinite(d)&&d!==u?d:v+1,S=Rh(s,{minX:h,maxX:p,minY:v,maxY:x},r,t);s.fillStyle=S??t}else s.fillStyle=t;for(let c=0;c<e.length;c++){const{x:f,y:u}=e[c];!Number.isFinite(f)||!Number.isFinite(u)||(s.beginPath(),s.arc(f,u,a,0,Math.PI*2),s.fill())}s.restore()})}function PX(s,e,t,n,o,r,a,l){e.length&&Ib(s,l,()=>{const c=Number.isFinite(t)?t:l?l.top+l.height:0,f=(h,p)=>{if(h<0||p<h)return;s.beginPath();let v=!1,x=null,S=null,C=0,I=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,P=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY;for(let E=h;E<=p;E++){const L=e[E];!Number.isFinite(L.x)||!Number.isFinite(L.y)||(v?s.lineTo(L.x,L.y):(s.moveTo(L.x,L.y),v=!0,x=L),S=L,C+=1,L.x<I&&(I=L.x),L.x>A&&(A=L.x),L.y<P&&(P=L.y),L.y>T&&(T=L.y))}if(!v||C<2||!x||!S)return;if(s.lineTo(S.x,c),s.lineTo(x.x,c),s.closePath(),s.save(),!!(o&&(o.from||o.to))){const E=Number.isFinite(I)?I:l?l.left:0,L=Number.isFinite(A)&&A!==I?A:E+1,D=Number.isFinite(P)?Math.min(P,c):c,X=Number.isFinite(T)?Math.max(T,c):c+1,ne=Rh(s,{minX:E,maxX:L,minY:Number.isFinite(D)?D:0,maxY:Number.isFinite(X)&&X!==D?X:Number.isFinite(D)?D+1:1},o,n);s.fillStyle=ne??n}else s.fillStyle=n;s.fill(),s.restore(),r&&a>0};let u=-1,d=-1;for(let h=0;h<e.length;h++){const p=e[h];Number.isFinite(p.x)&&Number.isFinite(p.y)?(u===-1&&(u=h),d=h):u!==-1&&(f(u,d),u=-1,d=-1)}u!==-1&&f(u,d)})}function MX(s,e,t,n,o,r){e.length&&Ib(s,o,()=>{if(s.beginPath(),!!(r&&(r.from||r.to))){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(const C of e)!Number.isFinite(C.x)||!Number.isFinite(C.y)||(C.x<c&&(c=C.x),C.x>f&&(f=C.x),C.y<u&&(u=C.y),C.y>d&&(d=C.y));const h=Number.isFinite(c)?c:o?o.left:0,p=Number.isFinite(f)&&f!==c?f:h+1,v=Number.isFinite(u)?u:o?o.top:0,x=Number.isFinite(d)&&d!==u?d:v+1,S=Rh(s,{minX:h,maxX:p,minY:v,maxY:x},r,t);s.strokeStyle=S??t}else s.strokeStyle=t;let l=!1;for(let c=0;c<e.length-1;c++){const f=e[c],u=e[c+1];!Number.isFinite(f.x)||!Number.isFinite(f.y)||!Number.isFinite(u.x)||!Number.isFinite(u.y)||(l||(s.moveTo(f.x,f.y),l=!0),s.lineTo(u.x,f.y),s.lineTo(u.x,u.y))}l&&(s.lineWidth=n,s.setLineDash([]),s.stroke())})}function x2(s,e,t,n,o){!e.length||!t.length||Ib(s,o,()=>{var a,l;s.beginPath();let r=0;for(;r<e.length&&!(Number.isFinite((a=e[r])==null?void 0:a.x)&&Number.isFinite((l=e[r])==null?void 0:l.y));)r++;if(!(r>=e.length)){for(s.moveTo(e[r].x,e[r].y);r<e.length;r++){const c=e[r];!Number.isFinite(c==null?void 0:c.x)||!Number.isFinite(c==null?void 0:c.y)||s.lineTo(c.x,c.y)}for(let c=t.length-1;c>=0;c--){const f=t[c];!Number.isFinite(f==null?void 0:f.x)||!Number.isFinite(f==null?void 0:f.y)||s.lineTo(f.x,f.y)}s.closePath(),s.save(),s.fillStyle=n,s.fill(),s.restore()}})}class v4{constructor(e){Pe(this,"storage");Pe(this,"runtime",null);Pe(this,"events",{});Pe(this,"state");Pe(this,"symbolChangeCallbacks",new Set);Pe(this,"currentSymbol",null);this.storage=e||XV,this.state=Th({activeSaveId:null,savedLayouts:[],isLoading:!1,lastError:null,initialized:!1}),this.initialize()}async initialize(){try{this.updateState({isLoading:!0});const[e,t]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);this.updateState({activeSaveId:e,savedLayouts:t,isLoading:!1,lastError:null})}catch(e){console.error("Failed to initialize SaveManager:",e),this.updateState({isLoading:!1,lastError:"Failed to initialize save system"})}}setRuntimeContracts(e){this.runtime=e,this.runtime.onSymbolChange(this.handleSymbolChange.bind(this)),this.currentSymbol=this.runtime.getCurrentSymbol(),this.updateState({initialized:!0}),console.log("✅ SaveManager fully initialized and ready")}setEventHandlers(e){this.events={...this.events,...e}}async handleSymbolChange(e){this.currentSymbol,this.currentSymbol=e;const t=this.getState();if(t.activeSaveId&&this.runtime)try{const n=await this.storage.getSavedLayout(t.activeSaveId);if(n){this.runtime.clearAllDrawings();const o=n.drawingsBySymbol[e]||[];this.runtime.renderDrawings(o)}}catch(n){console.error("Failed to reload drawings for symbol change:",n)}this.symbolChangeCallbacks.forEach(n=>{try{n(e)}catch(o){console.error("Symbol change callback error:",o)}})}onSymbolChange(e){this.symbolChangeCallbacks.add(e)}offSymbolChange(e){this.symbolChangeCallbacks.delete(e)}updateState(e){this.state.update(t=>({...t,...e}))}getState(){let e;return this.state.subscribe(t=>e=t)(),e}validateSaveName(e,t){return!e||e.trim().length===0?{valid:!1,error:"Name is required"}:e.length>100?{valid:!1,error:"Name must be 100 characters or less"}:this.getState().savedLayouts.some(r=>r.name===e&&r.id!==t)?{valid:!1,error:"Name already exists"}:{valid:!0}}async collectCurrentState(){if(!this.runtime)throw new Error("Runtime contracts not set");try{const e=this.runtime.getCurrentSymbol(),t=this.runtime.collectGlobalState(),n=this.runtime.collectDrawings(e);return{global:t,drawings:n,symbol:e}}catch(e){return console.error("Failed to collect chart state:",e),null}}async save(e){var t,n,o,r;try{this.updateState({isLoading:!0,lastError:null});const a=this.validateSaveName(e);if(!a.valid)return this.updateState({isLoading:!1,lastError:a.error}),{success:!1,error:a.error};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={name:e,timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{[l.symbol]:l.drawings}},f=await this.storage.createSavedLayout(c);await this.storage.setActiveSaveId(f.id);const u=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:f.id,savedLayouts:u,isLoading:!1}),(n=(t=this.events).onSaved)==null||n.call(t,f),{success:!0,layout:f}}catch(a){console.error("Save failed:",a);const l=a instanceof Error?a.message:"Save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}async quickSave(){var t,n,o,r;const e=this.getState();if(!e.activeSaveId)return this.updateState({isLoading:!1,lastError:"No active save to update"}),{success:!1,error:"No active save to update"};try{this.updateState({isLoading:!0,lastError:null});const a=await this.storage.getSavedLayout(e.activeSaveId);if(!a)return this.updateState({isLoading:!1,lastError:"Active save not found"}),{success:!1,error:"Active save not found"};const l=await this.collectCurrentState();if(!l)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const c={timezone:l.global.timezone,interval:l.global.interval,chartType:l.global.chartType,theme:l.global.theme,panes:l.global.panes,indicators:l.global.indicators,styles:l.global.styles,options:l.global.options,drawingsBySymbol:{...a.drawingsBySymbol,[l.symbol]:l.drawings}},f=await this.storage.updateSavedLayout(e.activeSaveId,c),u=await this.storage.listSavedLayouts();return this.updateState({savedLayouts:u,isLoading:!1}),(n=(t=this.events).onSaved)==null||n.call(t,f),{success:!0,layout:f}}catch(a){console.error("Quick save failed:",a);const l=a instanceof Error?a.message:"Quick save failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}async saveTo(e){var t,n,o,r,a,l;try{this.updateState({isLoading:!0,lastError:null});const c=await this.collectCurrentState();if(!c)return this.updateState({isLoading:!1,lastError:"Failed to collect chart state"}),{success:!1,error:"Failed to collect chart state"};const f=await this.storage.getSavedLayout(e),u={timezone:c.global.timezone,interval:c.global.interval,chartType:c.global.chartType,theme:c.global.theme,panes:c.global.panes,indicators:c.global.indicators,styles:c.global.styles,options:c.global.options,drawingsBySymbol:f?{...f.drawingsBySymbol,[c.symbol]:c.drawings}:{[c.symbol]:c.drawings}};if(!f){console.log("📝 Layout not found locally, creating new layout via API");const p={name:`Layout ${new Date().toLocaleString()}`,...u},v=await this.storage.createSavedLayout(p);await this.storage.setActiveSaveId(v.id);const x=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:v.id,savedLayouts:x,isLoading:!1}),(n=(t=this.events).onSaved)==null||n.call(t,v),{success:!0,layout:v}}const d=await this.storage.updateSavedLayout(e,u);await this.storage.setActiveSaveId(e);const h=await this.storage.listSavedLayouts();return this.updateState({activeSaveId:e,savedLayouts:h,isLoading:!1}),(r=(o=this.events).onSaved)==null||r.call(o,d),{success:!0,layout:d}}catch(c){console.error("Save to existing failed:",c);const f=c instanceof Error?c.message:"Save failed";return this.updateState({isLoading:!1,lastError:f}),(l=(a=this.events).onError)==null||l.call(a,f),{success:!1,error:f}}}async saveAs(e){return this.save(e)}async load(e){var t,n,o,r,a,l,c,f,u,d,h,p;try{this.updateState({isLoading:!0,lastError:null}),console.log("🔄 Loading layout:",e);const v=await this.storage.getSavedLayout(e);if(!v)try{await this.refresh();const C=await this.storage.getSavedLayout(e);if(!C){const T=await this.storage.listSavedLayouts();if(T&&T.length>0){const j=T[0].id,E=await this.storage.getSavedLayout(j);if(E){if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:E.timezone,interval:E.interval,chartType:E.chartType,theme:E.theme,panes:E.panes,indicators:E.indicators,styles:E.styles,options:E.options});const L=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const D=E.drawingsBySymbol[L]||[];return this.runtime.renderDrawings(D),await this.storage.setActiveSaveId(E.id),this.updateState({activeSaveId:E.id,isLoading:!1}),(n=(t=this.events).onLoaded)==null||n.call(t,E),{success:!0}}}return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}const I=C;if(!this.runtime)return this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};await this.runtime.applyGlobalState({timezone:I.timezone,interval:I.interval,chartType:I.chartType,theme:I.theme,panes:I.panes,indicators:I.indicators,styles:I.styles,options:I.options});const A=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const P=I.drawingsBySymbol[A]||[];return this.runtime.renderDrawings(P),await this.storage.setActiveSaveId(I.id),this.updateState({activeSaveId:I.id,isLoading:!1}),(r=(o=this.events).onLoaded)==null||r.call(o,I),{success:!0}}catch{return await this.storage.setActiveSaveId(null),this.updateState({isLoading:!1,lastError:"Layout not found"}),{success:!1,error:"Layout not found"}}if(console.log("📊 Layout data loaded:",{name:v.name,indicatorCount:((a=v.indicators)==null?void 0:a.length)||0,indicators:((l=v.indicators)==null?void 0:l.map(C=>C.type))||[]}),!this.runtime)return console.error("❌ Runtime contracts not set"),this.updateState({isLoading:!1,lastError:"Runtime contracts not set"}),{success:!1,error:"Runtime contracts not set"};console.log("🔧 Applying global state with indicators:",((c=v.indicators)==null?void 0:c.length)||0),await this.runtime.applyGlobalState({timezone:v.timezone,interval:v.interval,chartType:v.chartType,theme:v.theme,panes:v.panes,indicators:v.indicators,styles:v.styles,options:v.options});const x=this.runtime.getCurrentSymbol();this.runtime.clearAllDrawings();const S=v.drawingsBySymbol[x]||[];return this.runtime.renderDrawings(S),await this.storage.setActiveSaveId(v.id),this.updateState({activeSaveId:v.id,isLoading:!1}),(u=(f=this.events).onLoaded)==null||u.call(f,v),console.log("✅ Layout loaded successfully:",{layoutId:v.id,name:v.name,indicatorsRestored:((d=v.indicators)==null?void 0:d.length)||0}),{success:!0}}catch(v){console.error("Load failed:",v);const x=v instanceof Error?v.message:"Load failed";return this.updateState({isLoading:!1,lastError:x}),(p=(h=this.events).onError)==null||p.call(h,x),{success:!1,error:x}}}async delete(e){var t,n,o,r;try{this.updateState({isLoading:!0,lastError:null}),await this.storage.deleteSavedLayout(e);const[a,l]=await Promise.all([this.storage.getActiveSaveId(),this.storage.listSavedLayouts()]);return this.updateState({activeSaveId:a,savedLayouts:l,isLoading:!1}),(n=(t=this.events).onDeleted)==null||n.call(t,e),{success:!0}}catch(a){console.error("Delete failed:",a);const l=a instanceof Error?a.message:"Delete failed";return this.updateState({isLoading:!1,lastError:l}),(r=(o=this.events).onError)==null||r.call(o,l),{success:!1,error:l}}}hasActiveSave(){return this.getState().activeSaveId!==null}getActiveSaveId(){return this.getState().activeSaveId}async clearActiveSave(){await this.storage.setActiveSaveId(null),this.updateState({activeSaveId:null})}async refresh(){try{this.updateState({isLoading:!0});const e=await this.storage.listSavedLayouts();this.updateState({savedLayouts:e,isLoading:!1,lastError:null})}catch(e){console.error("Refresh failed:",e),this.updateState({isLoading:!1,lastError:"Failed to refresh layouts"})}}destroy(){this.runtime&&this.symbolChangeCallbacks.clear()}}new v4;const w2="https://noti.dutyai.app/auth/chart/settings";class NX{constructor(){Pe(this,"localStorageProvider");Pe(this,"initialized",!1);this.localStorageProvider=new d4}async initialize(){this.initialized||(await this.localStorageProvider.initialize(),this.initialized=!0)}hasUserId(){return typeof window<"u"&&!!localStorage.getItem("userId")}getUserId(){return typeof window<"u"?localStorage.getItem("userId"):null}async saveToApi(e){const t=this.getUserId();if(!t)throw new Error("User ID not found in localStorage");if(e._source==="api"&&!e._isModified)return console.log("🔄 Skipping API save for unmodified API-loaded data"),{...e,_source:"api"};try{console.log(e,"layoutData");const n=e.id||this.generateApiId(),o={clerkId:t,settings:e,id:n};console.log("🌐 Sending to API:",o);const r=await fetch(w2,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const l=await r.text();throw console.error("API error response:",l),new Error(`API request failed: ${r.status} ${r.statusText} - ${l}`)}const a=await r.json();return console.log("✅ API save successful:",a),{...e,id:a.id||n,createdAt:a.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(n){throw console.error("API save failed:",n),new Error("Failed to save to API")}}generateApiId(){return`api_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async loadFromApi(){var t;const e=this.getUserId();if(!e)throw new Error("User ID not found in localStorage");try{const n=`${w2}/${e}`;console.log("🌐 API Request:",n);const o=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Response Status:",o.status,o.statusText),!o.ok)throw new Error(`API request failed: ${o.status} ${o.statusText}`);const r=await o.json();return console.log("🌐 API Response Data:",r),Array.isArray(r)?r.map(a=>{var l;return{id:a.id,name:((l=a.settings)==null?void 0:l.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...a.settings,_source:"api"}}):[{id:r.id,name:((t=r.settings)==null?void 0:t.name)||"Untitled Layout",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...r.settings,_source:"api"}]}catch(n){throw console.error("API load failed:",n),new Error("Failed to load from API")}}async deleteFromApi(e){if(!this.getUserId())throw new Error("User ID not found in localStorage");try{const n=`${w2}/${e}`;console.log("🌐 API Delete Request:",n);const o=await fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("🌐 API Delete Response Status:",o.status,o.statusText),!o.ok)throw new Error(`API delete request failed: ${o.status} ${o.statusText}`);console.log("✅ Layout deleted successfully from API")}catch(n){throw console.error("API delete failed:",n),new Error("Failed to delete from API")}}async listSavedLayouts(){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Loading layouts from API (userId found)"),(await this.loadFromApi()).map(t=>({id:t.id,name:t.name||"Untitled Layout",createdAt:t.createdAt||new Date().toISOString(),updatedAt:t.updatedAt||new Date().toISOString()}))}catch(e){console.error("API load failed, falling back to localStorage:",e)}return console.log("💾 Loading layouts from localStorage (no userId or API failed)"),this.localStorageProvider.listSavedLayouts()}async getSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Loading specific layout from API");const n=(await this.loadFromApi()).find(o=>o.id===e);if(n)return n;console.log("📖 Layout not found in API response, falling back to localStorage")}catch(t){console.error("API load failed, falling back to localStorage:",t)}return this.localStorageProvider.getSavedLayout(e)}async createSavedLayout(e){if(await this.initialize(),this.hasUserId())try{return console.log("🌐 Saving to API (userId found)"),await this.saveToApi(e)}catch(t){console.error("API save failed, falling back to localStorage:",t)}return console.log("💾 Saving to localStorage (no userId or API failed)"),this.localStorageProvider.createSavedLayout(e)}async updateSavedLayout(e,t){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Updating via API (userId found)");try{const a=(await this.loadFromApi()).find(l=>l.id===e);if(a){console.log("📝 Layout found in API, updating via API");const l={...a,...t,_isModified:!0};return await this.saveToApi(l)}}catch(r){console.log("📖 Layout not found in API, checking localStorage:",r)}const n=await this.localStorageProvider.getSavedLayout(e);if(n){console.log("📝 Layout found in localStorage, updating via API");const r={...n,...t};return await this.saveToApi(r)}console.log("📝 Layout not found, creating new via API");const o={id:e,...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_isModified:!0};return await this.saveToApi(o)}catch(n){console.error("API update failed, falling back to localStorage:",n)}return console.log("💾 Updating in localStorage"),this.localStorageProvider.updateSavedLayout(e,t)}async deleteSavedLayout(e){if(await this.initialize(),this.hasUserId())try{console.log("🌐 Deleting layout from API"),await this.deleteFromApi(e),console.log("✅ Layout deleted from API successfully");return}catch(t){console.error("API delete failed, falling back to localStorage:",t)}return console.log("💾 Deleting from localStorage"),this.localStorageProvider.deleteSavedLayout(e)}async getActiveSaveId(){return await this.initialize(),this.localStorageProvider.getActiveSaveId()}async setActiveSaveId(e){return await this.initialize(),this.localStorageProvider.setActiveSaveId(e)}async cleanup(){return await this.initialize(),this.localStorageProvider.cleanup()}}function AX(s,e){Yd(e,!1);const t=lh(),n=()=>Ml(r,"$save",t),o=()=>Ml(a,"$chart",t),r=hd("save");hd("ctx");const a=hd("chart"),l=hd("drawingManager"),c=(()=>{try{return hd("saveRestoring")||null}catch{return null}})(),f=new NX,u=new v4(f);let d=null,h=null;function p(){try{console.log("🧹 Clearing persisted chart cache to prevent showing unsaved changes...");const S=n(),C=S!=null&&S.key&&typeof S.key=="string"?S.key:"chart";if(typeof localStorage<"u"){const I=localStorage.getItem(C);if(I)try{const T=JSON.parse(I),j={key:T.key||C,theme:T.theme||"dark",symbol:T.symbol||"BINANCE:BTCUSDT",period:T.period||{timeframe:"1d",timespan:"day"}};localStorage.setItem(C,JSON.stringify(j)),console.log("✅ Cleared unsaved chart changes, kept basic settings")}catch(T){console.warn("⚠️ Could not parse stored chart, clearing completely:",T),localStorage.removeItem(C)}const A=`${C}_drawings`,P=`${C}_overlays`;localStorage.removeItem(A),localStorage.removeItem(P),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Persisted chart cache cleared successfully")}try{r.update(I=>{var T,j,E,L;const A=((j=(T=I.styles)==null?void 0:T.candle)==null?void 0:j.type)||"renko_atr",P=((L=(E=I.styles)==null?void 0:E.candle)==null?void 0:L.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};return I.styles={candle:{type:A,renko:P}},I.options={},I.saveInds={},I})}catch(I){console.warn("⚠️ Failed to clear in‑memory save styles/options:",I)}}catch(S){console.error("❌ Error clearing persisted chart cache:",S)}}sm(async()=>{if(o())v(o());else{const S=a.subscribe(C=>{C&&(S(),v(C))})}});async function v(S){var C,I;try{let A=0;const P=20;for(;!l.get()&&A<P;)await new Promise(E=>setTimeout(E,100)),A+=1;const T=l.get();T?console.log("✅ DrawingManager is available for save system"):console.error("❌ DrawingManager not available after waiting");const j={getCurrentSymbol:()=>Rk(n()),collectGlobalState:()=>UR(n(),S),collectDrawings:E=>{if(!T)return console.warn("⚠️ DrawingManager not available, returning empty drawings"),[];const L=T.getDrawingsForSymbol(E);return console.log(`📥 Collected ${L.length} drawings for symbol:`,E),L},applyGlobalState:async E=>await GR(E,r,S),clearAllDrawings:()=>{var E,L;T?T.hideRenderedDrawings():console.warn("⚠️ DrawingManager not available, cannot clear drawings");try{const D=((E=S==null?void 0:S.getOverlays)==null?void 0:E.call(S,{groupId:"drawing_tools"}))||[];for(const X of D)try{(L=S==null?void 0:S.removeOverlay)==null||L.call(S,{id:X.id})}catch{}console.log("🗑️ Cleared chart overlays for drawing_tools group")}catch{}},renderDrawings:E=>{if(!T){console.warn("⚠️ DrawingManager not available, cannot render drawings");return}const L=Rk(n());console.log(`🎨 Rendering ${E.length} drawings for symbol:`,L),T.setCurrentSymbol(L),T.loadDrawingsForSymbol(L,E)},onSymbolChange:E=>{h=pp(r,D=>a0(D.symbol)).subscribe(D=>{d!==null&&d!==D&&(console.log("🔄 Save system detected symbol change:",d,"->",D),E(D)),d=D})},offSymbolChange:E=>{h&&(h(),h=null)}};u.setRuntimeContracts(j),u.setEventHandlers({onSaved:()=>{try{i2()}catch{}},onLoaded:()=>{try{i2()}catch{}}}),typeof window<"u"&&(window.saveManager=u,window.forceRefreshChart=async()=>{console.log("🔄 Force refresh triggered from WebView parent"),await x()},window.clearChartCache=()=>{var E;console.log("🗑️ Clearing chart cache");try{const L=(E=n())!=null&&E.key&&typeof n().key=="string"?n().key:"chart";localStorage.removeItem(L);const D=`${L}_drawings`;localStorage.removeItem(D);const X=`${L}_overlays`;localStorage.removeItem(X),localStorage.removeItem("dataSpaceOverlays"),console.log("✅ Chart cache cleared")}catch(L){console.error("❌ Error clearing cache:",L)}});try{u.getActiveSaveId()&&(c==null||c.set(!0))}catch{}p();try{const E=(C=n())!=null&&C.key&&typeof n().key=="string"?n().key:"chart";(typeof localStorage<"u"?localStorage.getItem(`${E}.lastTimeframe`):null)||typeof localStorage<"u"&&localStorage.setItem(`${E}.lastTimeframe`,"1d")}catch{}await x();try{const E=(I=n())!=null&&I.key&&typeof n().key=="string"?n().key:"chart",L=typeof localStorage<"u"?localStorage.getItem(`${E}.lastTimeframe`):null;if(L&&typeof L=="string"&&L.length>0){const D=L.slice(-1),X=parseInt(L.slice(0,-1))||1,ne=D==="M"?"month":D==="w"?"week":D==="d"?"day":D==="h"?"hour":D==="m"?"minute":D==="s"?"second":"day",de=fp(L);r.update(ie=>(ie.period={multiplier:X,timespan:ne,timeframe:L,secs:de},ie))}}catch{}try{i2()}catch{}try{c==null||c.set(!1)}catch{}console.log("✅ Save system initialized successfully")}catch(A){console.error("❌ Failed to initialize save system:",A)}}async function x(){try{console.log("🔍 Starting automatic restoration process (WebView-safe)...");let S=null;try{S=typeof window<"u"?localStorage.getItem("userId"):null}catch{}if(S){console.log("🌐 User logged in, refreshing saved layouts from server...");try{await u.refresh(),console.log("✅ Saved layouts refreshed from server")}catch(P){console.warn("⚠️ Could not refresh saved layouts from server:",P)}}const C=u.getActiveSaveId();if(console.log("🔍 Active save ID found:",C),C){console.log("🔄 Restoring active saved data:",C);const P=await u.load(C);if(P.success){console.log("✅ Active saved data restored successfully:",C);return}else{console.warn("⚠️ Failed to restore active saved data:",P.error);try{await u.clearActiveSave(),console.log("🧹 Cleared stale activeSaveId after failed restore")}catch(T){console.warn("⚠️ Could not clear activeSaveId:",T)}}}let I=[];const A=u.state.subscribe(P=>{I=(P==null?void 0:P.savedLayouts)||[]});if(A&&A(),I&&I.length>0){const P=I[0];if(console.log("🧭 Auto-selecting first saved layout:",P==null?void 0:P.id,P==null?void 0:P.name),P!=null&&P.id){const T=await u.load(P.id);if(T.success){console.log("✅ First saved layout auto-restored and set active:",P.id);return}else console.warn("⚠️ Failed to auto-load chosen layout:",T.error)}}console.log("ℹ️ No saved layouts found, using default chart configuration")}catch(S){console.error("❌ Error restoring active saved data:",S)}}Rg(()=>{h&&h(),u.destroy()}),$m(),Kd()}function TX(s,e){e("cancel")}function FX(s,e){e("confirm")}var LX=be('<div class="ucm-backdrop svelte-16egrl4"><div class="ucm-modal svelte-16egrl4" role="dialog" aria-modal="true" aria-labelledby="ucm-title"><div class="ucm-header svelte-16egrl4"><h2 id="ucm-title" class="svelte-16egrl4"> </h2></div> <div class="ucm-body svelte-16egrl4"><p> </p></div> <div class="ucm-actions svelte-16egrl4"><button class="btn btn-cancel svelte-16egrl4">Cancel</button> <button class="btn btn-confirm svelte-16egrl4">Confirm</button></div></div></div>');function EX(s,e){Yd(e,!1);let t=bi(e,"show",8,!1),n=bi(e,"title",8,"Unsaved changes"),o=bi(e,"message",8,"You have unsaved changes. If you refresh, your changes will be lost.");const r=fm();$m();var a=Qs(),l=_s(a);Ve(l,t,c=>{var f=LX(),u=y(f),d=y(u),h=y(d),p=y(h,!0);_(h),_(d);var v=m(d,2),x=y(v),S=y(x,!0);_(x),_(v);var C=m(v,2),I=y(C);I.__click=[TX,r];var A=m(I,2);A.__click=[FX,r],_(C),_(u),_(f),we(()=>{st(p,n()),st(S,o())}),Y(c,f)}),Y(s,a),Kd()}$p(["click"]);const $X={lookbackPeriod:50,trendWeight:.3,momentumWeight:.25,volatilityWeight:.2,supportResistanceWeight:.15,volumeWeight:.1};function av(s,e){return s.length<e?s[s.length-1]||0:s.slice(-e).reduce((n,o)=>n+o,0)/e}function k2(s,e){if(s.length===0)return 0;if(s.length<e)return av(s,s.length);const t=2/(e+1);let n=av(s.slice(0,e),e);for(let o=e;o<s.length;o++)n=(s[o]-n)*t+n;return n}function g4(s,e=14){if(s.length<e+1)return 50;const t=[];for(let c=1;c<s.length;c++)t.push(s[c]-s[c-1]);let n=0,o=0;for(let c=0;c<e;c++)t[c]>=0?n+=t[c]:o-=t[c];let r=n/e,a=o/e;for(let c=e;c<t.length;c++)t[c]>=0?(r=(r*(e-1)+t[c])/e,a=a*(e-1)/e):(r=r*(e-1)/e,a=(a*(e-1)-t[c])/e);return a===0?100:100-100/(1+r/a)}function DX(s,e=14){if(s.length<2)return 0;const t=[];for(let n=1;n<s.length;n++){const o=s[n].high,r=s[n].low,a=s[n-1].close,l=Math.max(o-r,Math.abs(o-a),Math.abs(r-a));t.push(l)}return av(t,Math.min(e,t.length))}function RX(s,e=3){if(s.length<10)return{support:[],resistance:[]};const t=s.map(a=>a.high),n=s.map(a=>a.low),o=[],r=[];for(let a=2;a<s.length-2;a++)t[a]>t[a-1]&&t[a]>t[a-2]&&t[a]>t[a+1]&&t[a]>t[a+2]&&o.push(t[a]),n[a]<n[a-1]&&n[a]<n[a-2]&&n[a]<n[a+1]&&n[a]<n[a+2]&&r.push(n[a]);return o.sort((a,l)=>l-a),r.sort((a,l)=>a-l),{resistance:o.slice(0,e),support:r.slice(0,e)}}function jX(s){if(s.length<3)return{pattern:"none",bullish:!0,confidence:.5};const e=s[s.length-1],t=s[s.length-2],n=s[s.length-3],o=Math.abs(e.close-e.open),r=e.high-e.low,a=e.close>e.open,l=Math.abs(t.close-t.open),c=t.close>t.open;if(o>l*1.5){if(a&&!c)return{pattern:"bullish_engulfing",bullish:!0,confidence:.75};if(!a&&c)return{pattern:"bearish_engulfing",bullish:!1,confidence:.75}}if(o<r*.1)return{pattern:"doji",bullish:c,confidence:.4};const f=a?e.open-e.low:e.close-e.low,u=a?e.high-e.close:e.high-e.open;return f>o*2&&u<o*.5?{pattern:"hammer",bullish:!0,confidence:.65}:u>o*2&&f<o*.5?{pattern:"shooting_star",bullish:!1,confidence:.65}:a&&c&&n.close>n.open?{pattern:"three_white_soldiers",bullish:!0,confidence:.7}:!a&&!c&&n.close<n.open?{pattern:"three_black_crows",bullish:!1,confidence:.7}:{pattern:"none",bullish:a,confidence:.5}}function BX(s){if(s.length<30)return{phase:"accumulation",confidence:.5};const e=s.slice(-30),t=e.map(u=>u.close),n=e.map(u=>u.volume||0),o=e.map(u=>u.high-u.low),r=(t[t.length-1]-t[0])/t.length,a=av(n,n.length),l=av(n.slice(-5),5),c=av(o,o.length),f=av(o.slice(-5),5);return Math.abs(r)<c*.1&&l<a*1.1&&f<c*1.1?{phase:"accumulation",confidence:.7}:r>c*.3&&l>a*1.2?{phase:"markup",confidence:.75}:Math.abs(r)<c*.15&&l>a*1.3&&(t[t.length-10]-t[0])/10>0?{phase:"distribution",confidence:.7}:r<-c*.3&&l>a*1.2?{phase:"markdown",confidence:.75}:{phase:"accumulation",confidence:.5}}function OX(s){if(s.length<20)return{direction:"sideways",strength:.5};const e=s.map(E=>E.close),t=s.map(E=>E.high),n=s.map(E=>E.low),o=k2(e,9),r=k2(e,21),a=k2(e,Math.min(50,e.length)),l=e[e.length-1];let c="sideways",f=0,u=0;o>r?f++:u++,r>a?f++:u++,l>o?f++:u++;const d=t.slice(-5),h=n.slice(-5),p=d[d.length-1]>d[0],v=h[h.length-1]>h[0],x=d[d.length-1]<d[0],S=h[h.length-1]<h[0];p&&v?f+=2:x&&S&&(u+=2);const C=e.slice(-10),I=(C[C.length-1]-C[0])/C.length,A=av(C,C.length),P=I/A*100;P>.15?f+=2:P<-.15&&(u+=2),f>u+1?c="up":u>f+1&&(c="down");const T=f+u,j=T>0?Math.abs(f-u)/T:.5;return{direction:c,strength:Math.min(j,1)}}function zX(s){if(s.length<20)return{value:0,strength:.5};const e=s.map(c=>c.close),t=g4(e,14),n=(t-50)/50,o=(e[e.length-1]-e[e.length-10])/e[e.length-10],r=n*.6+o*10*.4,a=Math.max(-1,Math.min(1,r)),l=Math.abs(t-50)/50;return{value:a,strength:Math.min(l,1)}}function VX(s){if(s.length<20)return{trend:"stable",relativeCurrent:1};const e=s.map(l=>l.volume||0),t=av(e,Math.min(20,e.length)),n=av(e.slice(-5),5),o=e[e.length-1],r=t>0?o/t:1;let a="stable";return n>t*1.2?a="increasing":n<t*.8&&(a="decreasing"),{trend:a,relativeCurrent:r}}function WX(s,e={}){const t={...$X,...e};if(s.length<10)return console.warn("Not enough historical data for prediction"),null;const n=s.slice(-t.lookbackPeriod),o=n[n.length-1];console.log("🔮 Predicting next candle from",n.length,"candles");const r=OX(n);console.log("📈 Trend:",r);const a=zX(n);console.log("⚡ Momentum:",a);const l=DX(n,14),c=av(n.map(Ft=>Ft.close),n.length),f=l/c*100;console.log("📊 Volatility (ATR%):",f.toFixed(2));const u=RX(n);console.log("🎯 Support/Resistance:",u);const d=VX(n);console.log("📦 Volume:",d);const h=jX(n);console.log("🎨 Pattern:",h);const p=BX(n);console.log("🔄 Market Cycle:",p);let v=0;const x=(Math.random()-.5)*.8;v+=x;const S=g4(n.map(Ft=>Ft.close),14),C=S>70,I=S<30,A=r.strength>.7;let P=.15;if(C&&r.direction==="up"&&(P+=.25),I&&r.direction==="down"&&(P+=.25),A&&(P+=.15),Math.random()<P){console.log("🔄 REVERSAL DETECTED - Creating counter-trend candle");const Ft=.5+Math.random()*1.5;r.direction==="up"?v-=Ft:r.direction==="down"?v+=Ft:v+=(Math.random()>.5?1:-1)*Ft}else r.direction==="up"?v+=r.strength*t.trendWeight*1.5:r.direction==="down"?v-=r.strength*t.trendWeight*1.5:v+=(Math.random()-.5)*.6,v+=a.value*a.strength*t.momentumWeight*1.8;if(h.pattern!=="none"){const Ft=h.confidence*1.2;h.bullish?v+=Ft:v-=Ft,console.log(`🎯 Pattern impact: ${h.bullish?"+":"-"}${Ft.toFixed(2)}%`)}p.phase==="markup"?v+=p.confidence*.5:p.phase==="markdown"?v-=p.confidence*.5:p.phase==="distribution"?v-=p.confidence*.2:p.phase==="accumulation"&&(v+=p.confidence*.2);const j=Math.min(f/2,2)*t.volatilityWeight;let E=0;const L=o.close;for(const Ft of u.resistance)L>=Ft*.98&&L<=Ft*1.02&&(E-=.5);for(const Ft of u.support)L>=Ft*.98&&L<=Ft*1.02&&(E+=.5);if(v+=E*t.supportResistanceWeight*1.5,d.trend==="increasing"){const Ft=t.volumeWeight*.8;(v>0||v<0)&&(v*=1+Ft)}else d.trend==="decreasing"&&(v*=.85);const D=(Math.random()-.5)*j*2.5;if(v+=D,Math.random()<.05){const Ft=(Math.random()-.5)*3;v+=Ft,console.log("📰 Surprise move:",Ft.toFixed(2)+"%")}v=Math.max(-6,Math.min(6,v)),console.log("💹 Predicted change:",v.toFixed(2)+"%");const X=L*(v/100),ne=v>0;let de,ie,te,le;const pe=f>2?.15:.05,xe=Math.random()<pe?(Math.random()*.5+.2)*(ne?1:-1):0,se=Math.abs(X),Ne=(Math.random()-.5)*.4,Te=se*(1+Ne);if(ne){de=L*(1+xe/100),le=de+Te;const Ft=Math.random();let zt,ut;Ft<.2?(zt=l*(.05+Math.random()*.15),ut=l*(.05+Math.random()*.15)):Ft<.4?(zt=l*(.4+Math.random()*.5),ut=l*(.1+Math.random()*.2)):Ft<.6?(zt=l*(.05+Math.random()*.15),ut=l*(.4+Math.random()*.6)):(zt=l*(.15+Math.random()*.35),ut=l*(.15+Math.random()*.35)),ie=le+zt,te=de-ut}else{de=L*(1+xe/100),le=de-Te;const Ft=Math.random();let zt,ut;Ft<.2?(zt=l*(.05+Math.random()*.15),ut=l*(.05+Math.random()*.15)):Ft<.4?(zt=l*(.4+Math.random()*.6),ut=l*(.05+Math.random()*.15)):Ft<.6?(zt=l*(.1+Math.random()*.2),ut=l*(.4+Math.random()*.5)):(zt=l*(.15+Math.random()*.35),ut=l*(.15+Math.random()*.35)),ie=de+zt,te=le-ut}const Me=r.direction==="sideways"?.15:.05;if(Math.random()<Me){le=de+(Math.random()-.5)*l*.1;const Ft=l*(.3+Math.random()*.4);ie=Math.max(de,le)+Ft,te=Math.min(de,le)-Ft,console.log("🎲 Created Doji candle (indecision)")}ie=Math.max(de,le,ie),te=Math.min(de,le,te);const De=av(n.map(Ft=>Ft.volume||0),20);av(n.slice(-5).map(Ft=>Ft.volume||0),5);let Oe=De;const Ke=Math.min(Math.abs(v)/2,1.5);Oe*=.8+Ke*.4,d.trend==="increasing"?Oe*=1.1+Math.random()*.3:d.trend==="decreasing"?Oe*=.7+Math.random()*.2:Oe*=.85+Math.random()*.3,h.pattern==="bullish_engulfing"||h.pattern==="bearish_engulfing"?Oe*=1.2+Math.random()*.3:h.pattern==="doji"&&(Oe*=.7+Math.random()*.2),(p.phase==="distribution"||p.phase==="markdown")&&(Oe*=1.1+Math.random()*.2),Oe=Math.max(De*.3,Math.min(Oe,De*3));const kt=n.slice(-5).map((Ft,zt,ut)=>zt>0?Ft.timestamp-ut[zt-1].timestamp:0).filter(Ft=>Ft>0),pt=kt.length>0?av(kt,kt.length):6e4,Ht={timestamp:o.timestamp+pt,open:Math.round(de*100)/100,high:Math.round(ie*100)/100,low:Math.round(te*100)/100,close:Math.round(le*100)/100,volume:Math.round(Oe)};return console.log("🎯 Predicted candle:",Ht),Ht}function HX(s,e){return Date.now()-s>e*2}function qX(){var s;try{(s=window.predictNextCandle)==null||s.call(window)}catch{}B1(!0)}function UX(s,e){(!(typeof window<"u")||window.confirm("Exit simulator?"))&&(e(),jS())}function GX(s){const e=parseFloat(s.target.value);Kx(e)}var YX=be('<button class="fc-btn svelte-u36ajg" type="button">Stop</button>'),KX=be('<button class="fc-btn svelte-u36ajg" type="button">Start</button>'),XX=be('<div class="floating-controls svelte-u36ajg"><div class="fc-content svelte-u36ajg"><div class="fc-header svelte-u36ajg"><div class="fc-title svelte-u36ajg">Simulator</div> <div class="fc-badge svelte-u36ajg"> </div></div> <div class="fc-row svelte-u36ajg"><input type="range" min="0.5" max="10" step="0.5" class="fc-range svelte-u36ajg"></div> <div class="fc-row svelte-u36ajg"><!> <button class="fc-btn fc-danger svelte-u36ajg" type="button">Exit</button></div></div></div>');function ZX(s,e){Yd(e,!0);const t=lh(),n=()=>Ml(pm,"$simulator",t);let o=_e(20),r=_e(80),a=_e(!1),l=0,c=0;function f(x){const S="touches"in x?x.touches[0]:x;l=S.clientX-i(o),c=S.clientY-i(r),b(a,!0),window.addEventListener("mousemove",u),window.addEventListener("mouseup",d),window.addEventListener("touchmove",u,{passive:!0}),window.addEventListener("touchend",d)}function u(x){if(!i(a))return;const S="touches"in x?x.touches[0]:x;b(o,S.clientX-l),b(r,S.clientY-c)}function d(){b(a,!1),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",d)}function h(){var x;try{(x=window.stopPrediction)==null||x.call(window)}catch{}B1(!1)}var p=Qs(),v=_s(p);Ve(v,()=>n().mode==="normal",x=>{var S=XX(),C=y(S),I=y(C);I.__mousedown=f,I.__touchstart=f;var A=m(y(I),2),P=y(A);_(A),_(I);var T=m(I,2),j=y(T);Ts(j),j.__input=[GX],_(T);var E=m(T,2),L=y(E);Ve(L,()=>n().playing,X=>{var ne=YX();ne.__click=h,Y(X,ne)},X=>{var ne=KX();ne.__click=[qX],Y(X,ne)});var D=m(L,2);D.__click=[UX,h],_(E),_(C),_(S),we(()=>{Dt(S,"style",`left:${i(o)}px;top:${i(r)}px;`),st(P,`${n().speed??""}x`),qf(j,n().speed)}),Y(x,S)}),Y(s,p),Kd()}$p(["mousedown","touchstart","input","click"]);const _4="scriptStudio.scripts";function V1(){try{const s=localStorage.getItem(_4);if(!s)return[];const e=JSON.parse(s);return Array.isArray(e)?e:[]}catch{return[]}}function W1(s){try{localStorage.setItem(_4,JSON.stringify(s))}catch{}}function zy(){return V1()}function yy(s){W1(Array.isArray(s)?s:[])}function l6(s){const e=V1(),t=e.findIndex(n=>n.id===s.id);return t>=0?e[t]={...s,updatedAt:Date.now()}:e.push(s),W1(e),s}function JX(s,e,t){const n=V1(),o=Date.now(),a={id:`${o}`,name:s,code:e,tags:t||[],createdAt:o,updatedAt:o};return n.push(a),W1(n),a}function QX(s,e){const t=V1(),n=t.findIndex(r=>r.id===s);if(n===-1)return null;const o={...t[n],...e,updatedAt:Date.now()};return t[n]=o,W1(t),o}function eZ(s){const e=V1(),t=e.filter(n=>n.id!==s);return W1(t),t.length!==e.length}function tZ(s){let e="",t=null;for(let n=0;n<s.length;n++){const o=s[n],r=s[n+1];if(t){e+=o,o===t&&s[n-1]!=="\\"&&(t=null);continue}if(o==="'"||o==='"'){t=o,e+=o;continue}if(o==="/"&&r==="/")break;e+=o}return e.replace(/\s+$/,"")}function Er(s){const e=s.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function Kr(s){const e=[];let t="",n=0,o=0,r=0,a=null;for(let l=0;l<s.length;l++){const c=s[l];if(a){t+=c,c===a&&s[l-1]!=="\\"&&(a=null);continue}if(c==="'"||c==='"'){a=c,t+=c;continue}if(c==="("){n+=1,t+=c;continue}if(c===")"){n=Math.max(0,n-1),t+=c;continue}if(c==="{"){o+=1,t+=c;continue}if(c==="}"){o=Math.max(0,o-1),t+=c;continue}if(c==="["){r+=1,t+=c;continue}if(c==="]"){r=Math.max(0,r-1),t+=c;continue}if(c===","&&n===0&&o===0&&r===0){e.push(t.trim()),t="";continue}t+=c}return t.trim()&&e.push(t.trim()),e}function qc(s){const e={};for(const t of s){const n=t.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/);n&&(e[n[1]]=n[2].trim())}return e}let y4=!1,b4=!1;function N1(s){let e=s.trim();return e=e.replace(/\bta\./g,""),e=e.replace(/\bmath\./g,""),y4&&(e=e.replace(/\bsession\./g,"")),e=e.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),e=e.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(t,n,o)=>`${String(n).toLowerCase()}_${o}`),e=(()=>{const t=e;let n="",o=null,r=0;const a=c=>/[A-Za-z_$]/.test(c),l=c=>/[A-Za-z0-9_$]/.test(c);for(;r<t.length;){const c=t[r];if(o){n+=c,c===o&&t[r-1]!=="\\"&&(o=null),r+=1;continue}if(c==="'"||c==='"'){o=c,n+=c,r+=1;continue}if(a(c)){let f=r+1;for(;f<t.length&&l(t[f]);)f+=1;const u=t.slice(r,f);let d=r-1;for(;d>=0&&/\s/.test(t[d]);)d-=1;const h=d>=0&&t[d]===".";let p=f;for(;p<t.length&&/\s/.test(t[p]);)p+=1;if(h){n+=u,r=f;continue}if(t[p]==="["&&b4&&!h){let v=0,x=p,S=null;for(;x<t.length;x++){const C=t[x];if(S){C===S&&t[x-1]!=="\\"&&(S=null);continue}if(C==="'"||C==='"'){S=C;continue}if(C==="[")v+=1;else if(C==="]"&&(v-=1,v===0))break}if(x<t.length&&v===0){const C=t.slice(p+1,x).trim();if(C){n+=`prev(${u}, __hist_index(${C}))`,r=x+1;continue}}}else if(t[p]==="["){let v=p+1;for(;v<t.length&&/\s/.test(t[v]);)v+=1;let x=1;t[v]==="-"&&(x=-1,v+=1);let S=v;for(;S<t.length&&/[0-9]/.test(t[S]);)S+=1;const C=t.slice(v,S);for(;S<t.length&&/\s/.test(t[S]);)S+=1;if(C&&t[S]==="]"){const I=x*Number(C);if(Number.isFinite(I)&&I>=1){n+=`prev(${u}, ${Math.floor(I)})`,r=S+1;continue}if(Number.isFinite(I)&&I===0){n+=u,r=S+1;continue}}}n+=u,r=f;continue}n+=c,r+=1}return n})(),e}function k_(s){let e=N1(s);return e=e.replace(/\bcrossover\s*\(/gi,"crossover("),e=e.replace(/\bcrossunder\s*\(/gi,"crossunder("),e}function Eu(s){const e=s.trim();if(!e.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=/))return!1;const n=e.indexOf("=");if(n<0)return!1;const o=e[n-1]??"",r=e[n+1]??"";return!(o==="="||o==="!"||o==="<"||o===">"||r==="=")}function og(s){const e=s.trim().toLowerCase();return e==="true"?!0:e==="false"?!1:null}function Dh(s){const e=s.trim();if(!/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(e))return null;const t=Number(e);return Number.isFinite(t)?t:null}function sZ(s){const e=Er(String(s||"").trim()).toLowerCase();return e?e==="background"||e==="bg"?"background":e==="main"||e==="base"?"main":e==="overlay"||e==="over"?"overlay":e==="ui"?"ui":null:null}function tg(s){if(s!=null)return sZ(s)??void 0}function sg(s){if(s==null)return;const e=Dh(Er(String(s)));return e??void 0}function ng(s){if(s==null)return;const e=Er(String(s)),t=og(e);if(t!=null)return t;const n=Dh(e);if(n!=null)return n!==0}function nZ(s){const e=String(s||"").trim().match(/^timestamp\s*\((.*)\)\s*$/i);if(!e)return null;const t=Kr(e[1]||"");if(!t.length)return null;const n=S=>{const C=Dh(Er(S));return C??null};let o=0,r=0;const a=Er(String(t[0]||"")).trim(),l=n(a);if(a&&l==null){const C=a.toUpperCase().match(/^(GMT|UTC)([+-]\d{1,2})?$/);if(C){const I=C[2]?Number(C[2]):0;Number.isFinite(I)&&(r=I*60),o=1}else{const I=Date.parse(a);return Number.isFinite(I)?I:null}}const c=n(t[o]||"");if(c==null)return null;const f=n(t[o+1]||"1")??1,u=n(t[o+2]||"1")??1,d=n(t[o+3]||"0")??0,h=n(t[o+4]||"0")??0,p=n(t[o+5]||"0")??0,v=n(t[o+6]||"0")??0,x=Date.UTC(c,Math.max(0,f-1),u,d,h,p,v);return Number.isFinite(x)?x-r*60*1e3:null}function c6(s){const e=Er(String(s||"").trim());if(!e)return;if(e.startsWith("#")||e.startsWith("rgb"))return e;const t=e.toLowerCase();if(t==="color.green"||t==="green")return"#16a34a";if(t==="color.red"||t==="red")return"#ef4444";if(t==="color.orange"||t==="orange")return"#f59e0b";if(t==="color.blue"||t==="blue")return"#3b82f6";if(t==="color.gray"||t==="gray"||t==="grey")return"#64748b";if(t==="color.white"||t==="white")return"#e2e8f0";if(t==="color.black"||t==="black")return"#0b1220"}function C0(s,e){if(!s||e==null||!Number.isFinite(e))return s;const t=Math.max(0,Math.min(100,e)),n=Math.max(0,Math.min(1,1-t/100)),o=s.trim();if(o.startsWith("#")){const a=o.slice(1),l=a.length===3?a.split("").map(c=>c+c).join(""):a.length===6?a:"";if(l){const c=parseInt(l.slice(0,2),16),f=parseInt(l.slice(2,4),16),u=parseInt(l.slice(4,6),16);if(Number.isFinite(c)&&Number.isFinite(f)&&Number.isFinite(u))return`rgba(${c},${f},${u},${n})`}}const r=o.match(/^rgba?\((.*)\)$/i);if(r){const a=r[1].split(",").map(l=>l.trim());if(a.length>=3){const l=Number(a[0]),c=Number(a[1]),f=Number(a[2]),u=a.length>=4?Number(a[3]):1;if([l,c,f,u].every(d=>Number.isFinite(d))){const d=Math.max(0,Math.min(1,u*n));return`rgba(${l},${c},${f},${d})`}}}return s}function oZ(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^shape\./,"").replace(/^label\./,"");if(t.includes("none"))return"none";if(t.includes("xcross"))return"xcross";if(t.includes("cross"))return"cross";if(t.includes("diamond"))return"diamond";if(t.includes("triangleup"))return"triangle_up_filled";if(t.includes("triangledown"))return"triangle_down_filled";if(t.includes("arrowup"))return"arrowUp";if(t.includes("arrowdown"))return"arrowDown";if(t.includes("circle"))return"circle";if(t.includes("square"))return"square";if(t.includes("flag"))return"flag";if(t.includes("tag"))return"tag";if(t.includes("pill"))return"pill";if(t.includes("label"))return"label"}function iZ(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^label\./,"").replace(/^style_/,"");return t.includes("none")?"text":t.includes("arrowup")?"arrowUp":t.includes("arrowdown")?"arrowDown":t.includes("triangleup")?"triangle_up_filled":t.includes("triangledown")?"triangle_down_filled":t.includes("circle")?"circle":t.includes("square")?"square":t.includes("xcross")?"xcross":t.includes("cross")?"cross":t.includes("diamond")?"diamond":t.includes("flag")?"flag":t.includes("tag")?"tag":t.includes("pill")?"pill":(t.includes("label"),"label")}function l1(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="auto")return 14;if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 18;if(t==="huge")return 22;const n=Dh(Er(e));if(n!=null)return Math.max(6,Math.min(64,n))}function u6(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^size\./,"");if(t==="tiny")return 10;if(t==="small")return 12;if(t==="normal")return 14;if(t==="large")return 16;if(t==="huge")return 18}function Pg(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^line\./,"").replace(/^style_/,"");if(t.includes("arrow")&&(t.includes("both")||t.includes("left_right")))return"arrow_both";if(t.includes("arrow")&&t.includes("left"))return"arrow_left";if(t.includes("arrow")&&t.includes("right"))return"arrow_right";if(t.includes("arrow")&&t.includes("none"))return"arrow_none";if(t.includes("dashed"))return"dashed";if(t.includes("dotted"))return"dotted";if(t.includes("solid"))return"solid"}function d6(s){const e=String(s||"").trim().toLowerCase();if(!e||e.startsWith("line."))return;const t=e.replace(/^plot\./,"").replace(/^style_/,"").replace(/^plot\.style_/,"");if(t.includes("histogram")||t.includes("columns"))return"histogram";if(t.includes("stepline")||t.includes("step"))return"stepped";if(t.includes("linebr"))return"line";if(t.includes("area"))return"area";if(t.includes("cross"))return"cross";if(t.includes("circles"))return"dots";if(t.includes("bar"))return"bar";if(t.includes("candles")||t.includes("candle"))return"candles";if(t.includes("ohlc"))return"ohlc";if(t.includes("line"))return"line"}function S2(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^extend\./,"");if(t.includes("right"))return"right";if(t.includes("left"))return"left";if(t.includes("both"))return"both";if(t.includes("none"))return"none"}function Mg(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^xloc\./,"");if(t.includes("bar_time")||t.includes("bartime")||t.includes("time"))return"time";if(t.includes("bar_index")||t.includes("barindex"))return"bar_index"}function t_(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^yloc\./,"");if(t.includes("above"))return"abovebar";if(t.includes("below"))return"belowbar";if(t.includes("price"))return"price"}function s_(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("left"))return"left";if(t.includes("right"))return"right";if(t.includes("center")||t.includes("middle"))return"center"}function c1(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^text\./,"").replace(/^align_/,"");if(t.includes("top"))return"top";if(t.includes("bottom"))return"bottom";if(t.includes("center")||t.includes("middle"))return"middle"}function f6(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^position\./,"");if(t.includes("top_left"))return"top_left";if(t.includes("top_right"))return"top_right";if(t.includes("top_center"))return"top_center";if(t.includes("bottom_left"))return"bottom_left";if(t.includes("bottom_right"))return"bottom_right";if(t.includes("bottom_center"))return"bottom_center";if(t.includes("middle_center")||t.includes("center"))return"middle_center"}function p6(s){const e=String(s||"").trim().toLowerCase();if(!e)return;const t=e.replace(/^location\./,"");if(t.includes("absolute"))return"absolute";if(t.includes("above")||t.includes("top")||t.includes("high"))return"above";if(t.includes("below")||t.includes("bottom")||t.includes("low"))return"below"}function h6(s){const e=String(s||"").trim().toLowerCase();if(e){if(e.includes("on"))return"on";if(e.includes("off"))return"off"}}function m6(s){const e=String(s||"").toLowerCase().replace(/\s+/g,"");if(e){if(e.includes("onceperbarclose")||e.includes("perbarclose")||e.includes("barclose"))return"once_per_bar_close";if(e.includes("onceperbar")||e.includes("perbar")||e.includes("all"))return"once_per_bar";if(e.includes("once"))return"once"}}function v6(s){const e=String(s||"").trim(),t=e.match(/^(?:request\.)?security(?:_lower_tf)?\s*\((.*)\)\s*$/i);if(!t)return null;const n=e.toLowerCase().startsWith("request.security_lower_tf")||e.toLowerCase().startsWith("security_lower_tf"),o=Kr(t[1]||"");if(o.length<2)return null;const r=qc(o),a=o.filter(S=>!Eu(S)),l=a[0]!=null?String(a[0]).trim():"",c=Er(l),f=c&&c.toLowerCase()==="syminfo.tickerid"?"syminfo.tickerid":!(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(c)&&!/^\d+$/.test(c)?`\${${c}}`:c,u=a[1]!=null?String(a[1]).trim():"",d=Er(u),h=d&&d.toLowerCase()==="timeframe.period"?"__CURRENT__":!(u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'"))&&/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(d)&&!/^\d+$/.test(d)?`\${${d}}`:d,p=a[2]!=null?N1(String(a[2])):"close",v=h6(String(r.lookahead??""))??(String(r.lookahead??"").toLowerCase().includes("lookahead_on")?"on":String(r.lookahead??"").toLowerCase().includes("lookahead_off")?"off":void 0),x=h6(String(r.gaps??""))??(String(r.gaps??"").toLowerCase().includes("gaps_on")?"on":String(r.gaps??"").toLowerCase().includes("gaps_off")?"off":void 0);return{symbol:f,country:r.country!=null?Er(String(r.country)):void 0,timeframe:h||"__CURRENT__",expr:p||"close",lookahead:v,gaps:x,lower:n}}function gx(s){var vt,Bt,Xt;const e=[],t=[],n=new Set,o=new Set,r=!0;y4=r,b4=r;const a="williamsr length must be integer >= 1",l="aroon length must be integer >= 1",c="dmi length must be integer >= 1",f="dmi smoothing must be integer >= 1",u="adx length must be integer >= 1",d="plus_di length must be integer >= 1",h="minus_di length must be integer >= 1",p="dx length must be integer >= 1",v="aroonosc length must be integer >= 1",x="highest length must be integer >= 1",S="lowest length must be integer >= 1",C="sum length must be integer >= 1",I="rising length must be integer >= 1",A="falling length must be integer >= 1",P="valuewhen occurrence must be integer >= 0",T=W=>{let Q=0;for(let O=0;O<W.length;O++){const U=W[O];if(U===" ")Q+=1;else if(U==="	")Q+=2;else break}return Q},j=W=>{let Q=0,O=null;for(let U=0;U<W.length;U++){const ce=W[U];if(O){ce===O&&W[U-1]!=="\\"&&(O=null);continue}if(ce==="'"||ce==='"'){O=ce;continue}ce==="("?Q+=1:ce===")"&&(Q-=1)}return Q},E=W=>{const Q=String(W||"").split(/\r?\n/),O=[];let U="",ce=1,G=0,ye=0;for(let Qe=0;Qe<Q.length;Qe++){const Ue=Qe+1,dt=tZ(Q[Qe]||""),et=dt.trim();et&&(U||(ce=Ue,ye=T(dt)),U=U?`${U} ${et}`:et,G+=j(et),G<=0&&(O.push({text:U.trim(),indent:ye,lineNo:ce,loopSeq:!1}),U="",G=0,ye=0))}return U.trim()&&O.push({text:U.trim(),indent:ye,lineNo:ce,loopSeq:!1}),O};let L=E(s);const D=W=>{const Q=Er(String(W||"").trim());if(!Q)return null;const O=Q.split("/").filter(Boolean);if(!O.length)return null;for(let U=O.length-1;U>=0;U--){const ce=O[U];if(!/^\d+$/.test(ce))return ce}return O[0]||null},X=W=>W.replace(/^\s*export\s+/i,""),ne=(W,Q)=>{const O=[];let U=0,ce=null;const G=Qe=>/[A-Za-z_$]/.test(Qe),ye=Qe=>/[A-Za-z0-9_$]/.test(Qe);for(;U<W.length;){const Qe=W[U];if(ce){O.push(Qe),Qe===ce&&W[U-1]!=="\\"&&(ce=null),U+=1;continue}if(Qe==="'"||Qe==='"'){ce=Qe,O.push(Qe),U+=1;continue}if(G(Qe)){let Ue=U+1;for(;Ue<W.length&&ye(W[Ue]);)Ue+=1;const dt=W.slice(U,Ue);O.push(Q[dt]||dt),U=Ue;continue}O.push(Qe),U+=1}return O.join("")},de=W=>{const Q=W.toLowerCase();return!!(/tradingview\/ta(\/|$)/.test(Q)||/tradingview\/math(\/|$)/.test(Q)||/tradingview\/str(\/|$)/.test(Q))},ie=W=>{const Q=Er(String(W||"").trim());if(!Q)return{error:"import path is empty"};if(typeof window>"u")return{error:`import "${Q}" is only supported in browser (local library cache)`};const O=zy(),U=Qe=>{if(typeof Qe=="string"){const Ue=Qe.trim();if(Ue.startsWith("{")&&Ue.includes('"script"')){try{const et=JSON.parse(Ue);if(et&&typeof et=="object"&&typeof et.script=="string")return et.script}catch{}const dt=Ue.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if(dt&&dt[1])try{return JSON.parse(`"${dt[1]}"`)}catch{}}return Qe}if(Qe&&typeof Qe=="object"){const Ue=Qe.script??Qe.code;if(typeof Ue=="string")return Ue}return String(Qe||"")},ce=D(Q)||Q,G=Qe=>O.filter(Ue=>Ue.name===Qe).sort((Ue,dt)=>(dt.updatedAt||0)-(Ue.updatedAt||0))[0],ye=G(Q)||G(ce);return ye?{code:U(ye.code),name:ye.name}:{error:`library "${Q}" not found in saved scripts`}},te=W=>{const Q=/^\s*export\s+/i.test(W),O=X(W).trim();if(!O||/^(import|library|indicator|study|strategy)\b/i.test(O))return null;const U=O.match(/^\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>/);if(U)return{name:U[1],exported:Q};const ce=O.match(/^(?:varip\s+|var\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)/i);return ce?{name:ce[1],exported:Q}:null},le=(W,Q,O,U,ce)=>{if(U>6)return e.push({message:`import "${Q}" exceeded max depth`,line:1}),{lines:[],exports:new Set};const G=E(W),ye=[],Qe=new Set,Ue=new Set;let dt=!1;for(const tt of G){const St=tt.text.trim(),Be=St.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(Be){const Mt=Be[1]||"",Ze=Be[2]||D(Mt)||"";Ze&&ye.push({path:Mt,alias:Ze,lineNo:tt.lineNo});continue}if(/^library\s*\(/i.test(St))continue;const je=te(St);je&&(Qe.add(je.name),je.exported&&(Ue.add(je.name),dt=!0))}const et=dt?Ue:new Set(Qe),B={},ve=[];for(const tt of ye){const St=tt.alias,Be=Er(tt.path);if(!St){e.push({message:`import "${Be}" needs an alias`,line:tt.lineNo});continue}if(de(Be)){B[St]="";continue}if(ce.includes(Be)){e.push({message:`cyclic import detected: ${ce.join(" -> ")} -> ${Be}`,line:tt.lineNo});continue}const je=ie(Be);if(je.error||!je.code){e.push({message:je.error||`library "${Be}" not found`,line:tt.lineNo});continue}const Mt=`${O}${St}__`;B[St]=Mt;const Ze=le(je.code,St,Mt,U+1,[...ce,Be]);ve.push(...Ze.lines)}const Fe={};Qe.forEach(tt=>{Fe[tt]=`${O}${tt}`});const ot=[];for(const tt of G){const St=tt.text.trim();if(!St||/^import\b/i.test(St)||/^library\s*\(/i.test(St))continue;let Be=X(tt.text);Object.entries(B).forEach(([je,Mt])=>{if(!je)return;const Ze=new RegExp(`\\b${je}\\.`,"gi");Be=Be.replace(Ze,Mt)}),Be=ne(Be,Fe),ot.push({...tt,text:Be})}return{lines:[...ve,...ot],exports:et}},pe={},re=[],xe=[];for(const W of L){const O=W.text.trim().match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i);if(O){const U=O[1]||"",ce=O[2]||D(U)||"",G=Er(U);if(!ce){e.push({message:`import "${G}" needs an alias`,line:W.lineNo});continue}if(pe[ce]){e.push({message:`import alias "${ce}" already used`,line:W.lineNo});continue}if(de(G)){pe[ce]={replacement:"",exports:new Set};continue}const ye=ie(G);if(ye.error||!ye.code){e.push({message:ye.error||`library "${G}" not found`,line:W.lineNo});continue}const Qe=`__lib_${ce}__`,Ue=le(ye.code,ce,Qe,1,[G]);re.push(...Ue.lines),pe[ce]={replacement:Qe,exports:Ue.exports};continue}xe.push(W)}L=[...re,...xe];let se="main";for(const W of L){const Q=W.text.trim().match(/^(indicator|study)\s*\((.*)\)\s*$/i);if(!Q)continue;const O=Kr(Q[2]||""),ce=qc(O).overlay;if(ce!=null){const G=og(Er(String(ce)));G==null?e.push({message:"indicator overlay must be true or false",line:W.lineNo}):se=G?"main":"sub"}else se="sub";break}const Ne=[{pane:"main",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]}],Te=[],Me=[],De={},Oe=[],Ke=[],kt={},pt=[],Rt={},Ht={};let Ft=null;const zt={},ut={},nt={},Je={},it={},ze={};let Ge=0;const xt=(W,Q)=>{const O=Q.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase(),U=O?`__sec_${O}`:"__sec";let ce=U,G=1;const ye=Qe=>Te.some(Ue=>String((Ue==null?void 0:Ue.name)||"").toLowerCase()===Qe.toLowerCase())||Oe.some(Ue=>String((Ue==null?void 0:Ue.name)||"").toLowerCase()===Qe.toLowerCase());for(;ye(ce);)G+=1,ce=`${U}_${G}`;return Oe.push({name:ce,type:"security",symbol:W.symbol,country:W.country,timeframe:W.timeframe,expr:W.expr,lookahead:W.lookahead,gaps:W.gaps,lower:W.lower}),ce},jt=(W,Q)=>{const O=String(W||"");let U="",ce=0,G=null;const ye=O.toLowerCase();for(;ce<O.length;){const Qe=O[ce];if(G){U+=Qe,Qe===G&&O[ce-1]!=="\\"&&(G=null),ce+=1;continue}if(Qe==="'"||Qe==='"'){G=Qe,U+=Qe,ce+=1;continue}const Ue=ye.slice(ce),dt=Ue.startsWith("request.security_lower_tf"),et=!dt&&Ue.startsWith("request.security"),B=!dt&&!et&&Ue.startsWith("security_lower_tf")&&(ce===0||!/[a-z0-9_$]/i.test(ye[ce-1]||"")),ve=!dt&&!et&&!B&&Ue.startsWith("security")&&(ce===0||!/[a-z0-9_$]/i.test(ye[ce-1]||""));if(dt||et||B||ve){let ot=ce+(dt?25:et?16:B?17:8);for(;ot<O.length&&/\s/.test(O[ot]);)ot+=1;if(O[ot]!=="("){U+=Qe,ce+=1;continue}let tt=0,St=ot,Be=null;for(;St<O.length;St++){const rs=O[St];if(Be){rs===Be&&O[St-1]!=="\\"&&(Be=null);continue}if(rs==="'"||rs==='"'){Be=rs;continue}if(rs==="(")tt+=1;else if(rs===")"&&(tt-=1,tt===0))break}if(St>=O.length){U+=O.slice(ce);break}const je=O.slice(ce,St+1),Mt=v6(je);if(!Mt){U+=je,ce=St+1;continue}Ge+=1;const Ze=xt(Mt,`${Q}_${Ge}`);U+=Ze,ce=St+1;continue}U+=Qe,ce+=1}return U};if(!/(^\s*\/\/@\s*pine)|(^\s*\/\/@\s*version)|\b(strategy|indicator|study)\s*\(/m.test(s))return{ok:!1,errors:[{message:"Not a Pine script",line:1}]};const ke=()=>{Ne.some(W=>W.pane==="sub")||Ne.push({pane:"sub",plots:[],labels:[],levels:[],lines:[],runtimeDrawOps:[],runtimeLabels:[],runtimeLines:[],runtimeBoxes:[],runtimeTables:[],overlays:[],fills:[],backgroundZones:[]})},Se=W=>(W==="sub"&&ke(),Ne.find(Q=>Q.pane===W)||Ne[0]),Et=W=>{const Q=String(W||"").trim();return!Q||/[+\-*/%]/.test(Q)?!1:!!(/\b(crossover|crossunder|between|above|below)\s*\(/i.test(Q)||/\bcrosses(Above|Below)\b/i.test(Q)||/[<>]=?|==|!=/.test(Q)||/\b(and|or|not)\b/i.test(Q)||/^\s*true\s*$|^\s*false\s*$/i.test(Q))},wt=W=>String(W||"").trim().replace(/\s+/g,"_").toLowerCase(),Ls=new Set,tn=(W,Q)=>{const O=`${Q??"?"}:${W}`;Ls.has(O)||(Ls.add(O),e.push({message:W,line:Q??1}))},Gs=W=>{var Mt;if(W.bodyPlan)return W.bodyPlan;const Q=/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i,O=(Ze,rs)=>To(String(Ze||"").trim(),rs),U=Ze=>{for(const rs of Ze){if(rs.kind==="return")return!0;if(rs.kind==="if"){for(const yn of rs.branches)if(U(yn.body))return!0}if((rs.kind==="for"||rs.kind==="while")&&U(rs.body))return!0}return!1},ce=(Ze,rs,yn)=>{let Qn=null;for(let wn=rs;wn<Ze.length;wn++){const xo=Ze[wn];if(xo.indent<=yn)break;const hi=String(xo.text||"").trim();!hi||hi.startsWith("//")||(Qn=xo.lineNo)}return Qn},G=(Ze,rs,yn,Qn,wn)=>{var pl,vn;const xo=[],hi=mo=>Qn.some(Gi=>wt(Gi)===wt(mo));let Ln=rs;for(;Ln<Ze.length;){const mo=Ze[Ln];if(mo.indent<=yn)break;const Gi=String(mo.text||"").trim();if(!Gi||Gi.startsWith("//")){Ln+=1;continue}Hs=mo.lineNo;const La=Gi.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(La){const Sr=La[3],Oa=Gi.includes(":=")?":=":"=",lr=String(La[4]??La[5]??"").trim(),mr=mo.indent,Cr=[];let hl=Ln+1;for(;hl<Ze.length&&Ze[hl].indent>mr;){const Fs=Ze[hl].text.trim(),to=Fs.indexOf("=>");if(to>=0){const cr=Fs.slice(0,to).trim(),io=Fs.slice(to+2).trim();Cr.push({cond:cr||void 0,expr:io||void 0,lineNo:Ze[hl].lineNo})}hl+=1}if(!Cr.length){tn("switch requires at least one case",mo.lineNo),Ln+=1;continue}const ls=lr?To(lr,`fn_switch_${Sr}`):"";let ws="na";for(let Fs=Cr.length-1;Fs>=0;Fs--){const to=Cr[Fs],cr=to.expr?To(to.expr,`fn_switch_${Sr}_case`):"na";if(!to.cond){ws=cr;continue}ws=`iff(${ls?`(${ls}) == (${To(to.cond,`fn_switch_${Sr}_cond`)})`:`(${To(to.cond,`fn_switch_${Sr}_cond`)})`}, ${cr}, ${ws})`}Ze.splice(Ln,hl-Ln,{text:`${Sr} ${Oa} ${ws}`,indent:mr,lineNo:mo.lineNo});continue}const lc=Gi.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(lc){const Sr=wn!=null&&mo.lineNo===wn,Oa=String(lc[1]??lc[2]??"").trim(),lr=mo.indent,mr=[];let Cr=Ln+1;for(;Cr<Ze.length&&Ze[Cr].indent>lr;){const ws=Ze[Cr].text.trim(),Fs=ws.indexOf("=>");if(Fs>=0){const to=ws.slice(0,Fs).trim(),cr=ws.slice(Fs+2).trim();mr.push({cond:to||void 0,expr:cr||void 0,lineNo:Ze[Cr].lineNo})}Cr+=1}if(!mr.length){tn("switch requires at least one case",mo.lineNo),Ln+=1;continue}const hl=Oa?To(Oa,"fn_switch_expr"):"";if(Sr){const ws=[];mr.forEach(Fs=>{if(!Fs.expr)return;const to=Fs.cond?hl?`(${hl}) == (${To(Fs.cond,"fn_switch_cond")})`:`(${To(Fs.cond,"fn_switch_cond")})`:void 0;ws.push({cond:to,body:[{kind:"return",expr:O(Fs.expr,`${W.name}_return`),lineNo:Fs.lineNo}],lineNo:Fs.lineNo})}),ws.some(Fs=>Fs.cond==null)||ws.push({cond:void 0,body:[{kind:"return",expr:"na",lineNo:mo.lineNo}],lineNo:mo.lineNo}),xo.push({kind:"if",lineNo:mo.lineNo,branches:ws}),Ln=Cr;continue}const ls=[];mr.forEach((ws,Fs)=>{if(ws.expr){if(!ws.cond)ls.push({text:"else",indent:lr,lineNo:ws.lineNo});else if(Fs===0){const to=hl?`(${hl}) == (${To(ws.cond,"fn_switch_cond")})`:`(${To(ws.cond,"fn_switch_cond")})`;ls.push({text:`if (${to})`,indent:lr,lineNo:ws.lineNo})}else{const to=hl?`(${hl}) == (${To(ws.cond,"fn_switch_cond")})`:`(${To(ws.cond,"fn_switch_cond")})`;ls.push({text:`else if (${to})`,indent:lr,lineNo:ws.lineNo})}ls.push({text:ws.expr,indent:lr+1,lineNo:ws.lineNo})}}),Ze.splice(Ln,Cr-Ln,...ls);continue}if(Gi==="break"){xo.push({kind:"break",lineNo:mo.lineNo}),Ln+=1;continue}if(Gi==="continue"){xo.push({kind:"continue",lineNo:mo.lineNo}),Ln+=1;continue}if(/^return\b/i.test(Gi)){const Sr=Gi.replace(/^return\b/i,"").trim();Sr?xo.push({kind:"return",expr:O(Sr,`${W.name}_return`),lineNo:mo.lineNo}):(tn(`Function "${W.name}" return requires an expression`,mo.lineNo),xo.push({kind:"return",expr:"na",lineNo:mo.lineNo})),Ln+=1;continue}const wl=Gi.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(wl){const Sr=wn!=null&&mo.lineNo===wn,Oa=mo.indent,lr=[],mr=String(wl[1]??wl[2]??"").trim();Hs=mo.lineNo;const Cr=mr?To(mr,`fn_if_${W.name}`):"",hl=Sr?ce(Ze,Ln+1,Oa):null,ls=G(Ze,Ln+1,Oa,Qn,hl);Sr&&!U(ls.ops)&&ls.ops.push({kind:"return",expr:"na",lineNo:mo.lineNo}),lr.push({cond:Cr||void 0,body:ls.ops,lineNo:mo.lineNo});let ws=ls.nextIdx;for(;ws<Ze.length&&Ze[ws].indent===Oa;){const Fs=String(Ze[ws].text||"").trim(),to=Fs.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(to){const cr=String(to[1]??to[2]??"").trim();Hs=Ze[ws].lineNo;const io=cr?To(cr,`fn_if_${W.name}`):"",Yl=Sr?ce(Ze,ws+1,Oa):null,na=G(Ze,ws+1,Oa,Qn,Yl);Sr&&!U(na.ops)&&na.ops.push({kind:"return",expr:"na",lineNo:Ze[ws].lineNo}),lr.push({cond:io||void 0,body:na.ops,lineNo:Ze[ws].lineNo}),ws=na.nextIdx;continue}if(/^else$/i.test(Fs)){const cr=Sr?ce(Ze,ws+1,Oa):null,io=G(Ze,ws+1,Oa,Qn,cr);Sr&&!U(io.ops)&&io.ops.push({kind:"return",expr:"na",lineNo:Ze[ws].lineNo}),lr.push({cond:void 0,body:io.ops,lineNo:Ze[ws].lineNo}),ws=io.nextIdx}break}xo.push({kind:"if",lineNo:mo.lineNo,branches:lr}),Ln=ws;continue}const mf=Gi.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(mf){const Sr=mf[1],Oa=String(mf[2]??"").trim(),lr=String(mf[3]??"").trim(),mr=String(mf[4]??"1").trim();Hs=mo.lineNo;const Cr=To(Oa,`fn_for_${Sr}`),hl=To(lr,`fn_for_${Sr}`),ls=To(mr,`fn_for_${Sr}`),ws=G(Ze,Ln+1,mo.indent,[...Qn,Sr],null);ws.nextIdx===Ln+1&&tn(`Function "${W.name}" for-loop requires an indented body`,mo.lineNo),xo.push({kind:"for",lineNo:mo.lineNo,varName:Sr,startExpr:Cr,endExpr:hl,stepExpr:ls,body:ws.ops}),Ln=ws.nextIdx;continue}const mp=Gi.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(mp){const Sr=String(mp[1]??mp[2]??"").trim();Hs=mo.lineNo;const Oa=To(Sr,`fn_while_${W.name}`),lr=G(Ze,Ln+1,mo.indent,Qn,null);lr.nextIdx===Ln+1&&tn(`Function "${W.name}" while-loop requires an indented body`,mo.lineNo),xo.push({kind:"while",lineNo:mo.lineNo,condExpr:Oa,body:lr.ops}),Ln=lr.nextIdx;continue}const _c=Gi.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(_c){const Sr=String(_c[1]||"").toLowerCase(),Oa=Kr(_c[2]||""),lr=String(Oa[0]||"").trim(),mr=wt(lr);if(!lr){tn(`array.${Sr} requires array name`,mo.lineNo),Ln+=1;continue}if(!!nt[mr]||((pl=Je[mr])==null?void 0:pl.kind)==="string"){tn(`array.${Sr} on string arrays is not supported inside functions`,mo.lineNo),Ln+=1;continue}if(!Je[mr]&&!ut[mr]){tn(`array.${Sr} unknown array "${lr}"`,mo.lineNo),Ln+=1;continue}if(!Je[mr]&&ut[mr]&&Vo(mr,ut[mr].length,ut[mr]),Sr==="push"||Sr==="unshift"||Sr==="insert"){const ws=Je[mr];if(ws){const Fs=Math.min(Tn,Math.max(ws.capacity,ws.size+po));aa(mr,Fs)}}if(Sr==="resize"){const ws=Je[mr];if(ws){const Fs=String(Oa[1]||"0"),to=fs(Fs);if(to!=null){const cr=Math.min(Tn,Math.max(ws.capacity,Math.floor(to)));aa(mr,cr)}}}Al(mr);const hl={};Sr==="push"||Sr==="unshift"?hl.value=Oa[1]:Sr==="insert"?(hl.index=Oa[1],hl.value=Oa[2]):Sr==="remove"?hl.index=Oa[1]:Sr==="resize"&&(hl.size=Oa[1]);const ls=sa(mr,Sr,hl,mo.lineNo);if(!ls){Ln+=1;continue}ls.forEach(ws=>{xo.push({kind:"assign",name:ws.name,op:ws.op,expr:ws.rhs,lineNo:ws.lineNo})}),Ln+=1;continue}const Ea=Gi.match(/^array\.set\s*\((.*)\)\s*$/i);if(Ea){const Sr=Kr(Ea[1]||""),Oa=String(Sr[0]||"").trim(),lr=String(Sr[1]||"").trim(),mr=String(Sr[2]||"").trim();if(!Oa||!lr||!mr){tn("array.set(name, index, value) requires 3 args",mo.lineNo),Ln+=1;continue}const Cr=wt(Oa);if(!Je[Cr]&&!ut[Cr]&&!nt[Cr]){tn(`array.set unknown array "${Oa}"`,mo.lineNo),Ln+=1;continue}if(nt[Cr]){tn("array.set on string arrays is not supported inside functions",mo.lineNo),Ln+=1;continue}!Je[Cr]&&ut[Cr]&&Vo(Cr,ut[Cr].length,ut[Cr]);const hl=To(lr,`${Cr}_idx`),ls=zi(hl),ws=To(mr,`${Cr}_set`),Fs=(vn=Je[Cr])==null?void 0:vn.sizeSeries,to=Fs!=null?`(${ls}) >= 0 and (${ls}) < ${Fs}`:void 0,cr=Gc(Cr,ls,ws,to);if(!cr){tn("array.set index must be within array size",mo.lineNo),Ln+=1;continue}cr.forEach((io,Yl)=>{xo.push({kind:"assign",name:Cn(Cr,Yl),op:":=",expr:io,lineNo:mo.lineNo})}),Ln+=1;continue}const Tf=Gi.match(Q);if(Tf){const Sr=Tf[3];if(hi(Sr)){tn(`Loop variable "${Sr}" is read-only`,mo.lineNo),Ln+=1;continue}const Oa=Tf[4],lr=String(Tf[5]||"").trim(),mr=String(Tf[1]||"").trim().toLowerCase(),Cr=mr==="var"||mr==="varip"?mr:void 0;Hs=mo.lineNo;const hl=To(lr,Sr);xo.push({kind:"assign",name:Sr,op:Oa,decl:Cr,expr:hl,lineNo:mo.lineNo}),Ln+=1;continue}if(wn!=null&&mo.lineNo===wn){xo.push({kind:"return",expr:O(Gi,`${W.name}_return`),lineNo:mo.lineNo}),Ln+=1;continue}tn(`Unsupported statement inside function "${W.name}": ${mo.text}`,mo.lineNo),Ln+=1}return{ops:xo,nextIdx:Ln}};if(!W.bodyLines||!W.bodyLines.length){const Ze=O(W.body,`${W.name}_return`);return W.bodyPlan={name:W.name,args:W.args,lineNo:W.lineNo,body:[{kind:"return",expr:Ze,lineNo:W.lineNo}]},W.bodyPlan}const ye=W.bodyLines.map(Ze=>({text:String(Ze.text||""),lineNo:Ze.lineNo,indent:Ze.indent})).filter(Ze=>String(Ze.text||"").trim()&&!String(Ze.text||"").trim().startsWith("//")),Qe=((Mt=ye[0])==null?void 0:Mt.indent)??0;let Ue=null;for(let Ze=ye.length-1;Ze>=0;Ze--){const rs=ye[Ze];if(rs.indent===Qe){Ue={text:String(rs.text||"").trim(),lineNo:rs.lineNo};break}}const dt=(Ue==null?void 0:Ue.text)??"",et=/^if\b/i.test(dt),B=/^switch\b/i.test(dt),ve=/^for\b/i.test(dt),Fe=/^while\b/i.test(dt),ot=et||B||ve||Fe,tt=/^return\b/i.test(dt),St=Ue&&!tt&&!Q.test(dt)&&(!ot||et||B)?Ue.lineNo:null,Be=G(ye,0,Qe-1,[],St),je=Ze=>{for(const rs of Ze){if(rs.kind==="return")return!0;if(rs.kind==="if"){for(const yn of rs.branches)if(je(yn.body))return!0}if((rs.kind==="for"||rs.kind==="while")&&je(rs.body))return!0}return!1};if(!je(Be.ops))if(Ue&&Q.test(dt)){const Ze=dt.match(Q),rs=(Ze==null?void 0:Ze[3])||"";rs&&Be.ops.push({kind:"return",expr:O(rs,`${W.name}_return`),lineNo:Ue.lineNo})}else(!Ue||ot)&&(tn(`Function "${W.name}" requires a return expression`,W.lineNo),Be.ops.push({kind:"return",expr:"na",lineNo:W.lineNo}));return W.bodyPlan={name:W.name,args:W.args,lineNo:W.lineNo,body:Be.ops},W.bodyPlan},an=(W,Q)=>W,Es=W=>String(W||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(Q,O)=>{const U=wt(String(O)),ce=Je[U];if(ce!=null&&ce.dynamic)return Q;const G=ut[U],ye=nt[U],Qe=(ce==null?void 0:ce.size)??(G==null?void 0:G.length)??(ye==null?void 0:ye.length);return Number.isFinite(Qe)?String(Qe):Q}),Ns=W=>{switch(W.kind){case"NumberLiteral":return W.value;case"Identifier":{const Q=wt(W.name);if(Q==="true")return 1;if(Q==="false")return 0;if(Q==="na"||Q==="nan")return NaN;const O=kt[Q]??kt[W.name],U=typeof O=="number"?O:Number(O);return Number.isFinite(U)?U:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(W.operator!=="not")return null;const Q=Ns(W.expr);return Q==null?null:Number.isFinite(Q)&&Q!==0?0:1}case"BinaryExpression":{const Q=Ns(W.left),O=Ns(W.right);if(Q==null||O==null)return null;switch(W.operator){case"+":return Q+O;case"-":return Q-O;case"*":return Q*O;case"/":return O===0?NaN:Q/O;case"%":return O===0?NaN:Q%O;case">":return Number.isFinite(Q)&&Number.isFinite(O)&&Q>O?1:0;case"<":return Number.isFinite(Q)&&Number.isFinite(O)&&Q<O?1:0;case">=":return Number.isFinite(Q)&&Number.isFinite(O)&&Q>=O?1:0;case"<=":return Number.isFinite(Q)&&Number.isFinite(O)&&Q<=O?1:0;case"==":return Number.isFinite(Q)&&Number.isFinite(O)&&Math.abs(Q-O)<1e-9?1:0;case"!=":return Number.isFinite(Q)&&Number.isFinite(O)&&Math.abs(Q-O)>=1e-9?1:0;case"and":return Number.isFinite(Q)&&Q!==0&&Number.isFinite(O)&&O!==0?1:0;case"or":return Number.isFinite(Q)&&Q!==0||Number.isFinite(O)&&O!==0?1:0;default:return null}}case"CallExpression":{const Q=W.callee.toLowerCase();if(Q==="iff"&&W.args.length===3){const G=Ns(W.args[0]);return G==null?null:Ns(G!==0?W.args[1]:W.args[2])}const O=W.args.map(G=>Ns(G));if(O.some(G=>G==null))return null;const U=O[0],ce=O[1];switch(Q){case"min":return Math.min(U,ce);case"max":return Math.max(U,ce);case"abs":return Math.abs(U);case"ceil":return Math.ceil(U);case"floor":return Math.floor(U);case"round":return Math.round(U);case"sqrt":return Math.sqrt(U);case"pow":return Math.pow(U,ce);default:return null}}default:return null}};let Hs=null;const ns=(W,Q)=>{if(Q==null)return;let O;try{O=Ep(W)}catch{return}const U=(ye,Qe)=>{ye!=null&&(!Number.isFinite(ye)||!Number.isInteger(ye)||ye<1)&&e.push({message:Qe,line:Q})},ce=(ye,Qe)=>{ye!=null&&(!Number.isFinite(ye)||!Number.isInteger(ye)||ye<0)&&e.push({message:Qe,line:Q})},G=ye=>{switch(ye.kind){case"MemberExpression":G(ye.object);return;case"IndexExpression":G(ye.object),G(ye.index);return;case"UnaryExpression":G(ye.expr);return;case"BinaryExpression":G(ye.left),G(ye.right);return;case"CallExpression":{const Qe=ye.callee.toLowerCase();if(Qe==="williamsr"&&ye.args.length>=1){const Ue=ye.args.length===1?ye.args[0]:ye.args[3];U(Ue?Ns(Ue):null,a)}Qe==="aroon"&&ye.args.length>=1&&U(Ns(ye.args[0]),l),Qe==="dmi"&&ye.args.length>=2&&(U(Ns(ye.args[0]),c),U(Ns(ye.args[1]),f)),Qe==="adx"&&ye.args.length>=1&&U(Ns(ye.args[0]),u),Qe==="plus_di"&&ye.args.length>=1&&U(Ns(ye.args[0]),d),Qe==="minus_di"&&ye.args.length>=1&&U(Ns(ye.args[0]),h),Qe==="dx"&&ye.args.length>=1&&U(Ns(ye.args[0]),p),Qe==="aroonosc"&&ye.args.length>=1&&U(Ns(ye.args[0]),v),Qe==="sum"&&ye.args.length>=2&&U(Ns(ye.args[1]),C),Qe==="highest"&&ye.args.length>=2&&U(Ns(ye.args[1]),x),Qe==="lowest"&&ye.args.length>=2&&U(Ns(ye.args[1]),S),Qe==="rising"&&ye.args.length>=2&&U(Ns(ye.args[1]),I),Qe==="falling"&&ye.args.length>=2&&U(Ns(ye.args[1]),A),Qe==="valuewhen"&&ye.args.length>=3&&ce(Ns(ye.args[2]),P),ye.args.forEach(Ue=>G(Ue));return}default:return}};G(O)},fs=W=>{const Q=Er(String(W||"").trim());if(!Q)return null;const O=Q.match(/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g)||[];for(const Ue of O){const dt=wt(Ue);if(Rt[dt])return null}const U=Dh(Q);if(U!=null)return U;const ce=wt(Q),G=kt[ce]??kt[Q],ye=typeof G=="number"?G:Number(G);if(Number.isFinite(ye))return ye;const Qe=Es(N1(Q));try{const Ue=Ep(Qe),dt=Ns(Ue);return Number.isFinite(dt)?dt:null}catch{return null}},Mn=W=>{const Q=Er(String(W||"").trim());if(!Q)return null;const O=Dh(Q);if(O!=null)return O;const U=wt(Q),ce=kt[U]??kt[Q],G=typeof ce=="number"?ce:Number(ce);if(Number.isFinite(G))return G;const ye=Es(N1(Q));try{const Qe=Ep(ye),Ue=Ns(Qe);return Number.isFinite(Ue)?Ue:null}catch{return null}},po=32,Tn=1024,Cn=(W,Q)=>`__arr_${W}_${Q}`,go=W=>`__arr_${W}__size`,no=W=>{const Q=wt(W),O=nt[Q];if(O)for(let U=0;U<O.length;U++)kt[Cn(Q,U)]=O[U]??""},Bo=(W,Q)=>{const O=go(W),U=De[O];if(typeof U=="number")return Me[U].initExpr||(Me[U].initExpr=String(Q)),O;const ce=Me.length;return De[O]=ce,Me.push({name:O,initExpr:String(Q),updateExpr:O,selfMode:"current"}),O},Vo=(W,Q,O,U)=>{const ce=wt(W),G=Math.max(0,Math.floor(Q)),ye=Je[ce],Qe=U??G,Ue=Math.min(Tn,Math.max((ye==null?void 0:ye.capacity)??0,Math.floor(Qe))),dt=Bo(ce,Math.max((ye==null?void 0:ye.size)??0,G)),et=ye?ye.elements.slice():[];for(let B=et.length;B<Ue;B++){const ve=Cn(ce,B);if(et.push(ve),ve in De){if(O&&O[B]!=null){const Fe=De[ve];Me[Fe].initExpr||(Me[Fe].initExpr=String(O[B]))}}else{const Fe=Me.length;De[ve]=Fe;const ot=O&&O[B]!=null?String(O[B]):void 0;Me.push({name:ve,initExpr:ot,updateExpr:ve,selfMode:"current"})}}return Je[ce]={size:Math.max((ye==null?void 0:ye.size)??0,G),capacity:Ue,elements:et,sizeSeries:dt,dynamic:(ye==null?void 0:ye.dynamic)??!1,kind:(ye==null?void 0:ye.kind)??"number"},{key:ce,elements:et}},Rl=(W,Q,O,U)=>{const ce=wt(W),G=Math.max(0,Math.floor(Q)),ye=Je[ce],Qe=U??Math.max(G,1),Ue=Math.min(Tn,Math.max((ye==null?void 0:ye.capacity)??0,Math.floor(Qe))),dt=Bo(ce,Math.max((ye==null?void 0:ye.size)??0,G)),et=ye?ye.elements.slice():[];for(let B=et.length;B<Ue;B++){const ve=Cn(ce,B);if(et.push(ve),ve in De){if(O&&O[B]!=null){const Fe=De[ve];Me[Fe].initExpr||(Me[Fe].initExpr=JSON.stringify(O[B]))}}else{const Fe=Me.length;De[ve]=Fe;const ot=O&&O[B]!=null?JSON.stringify(O[B]):void 0;Me.push({name:ve,initExpr:ot,updateExpr:ve,selfMode:"current"})}}return Je[ce]={size:Math.max((ye==null?void 0:ye.size)??0,G),capacity:Ue,elements:et,sizeSeries:dt,dynamic:(ye==null?void 0:ye.dynamic)??!1,kind:"string"},{key:ce,elements:et}},aa=(W,Q)=>{const O=wt(W),U=Je[O];U&&(U.capacity>=Q||Vo(O,U.size,void 0,Q))},tl=(W,Q)=>{const O=wt(W),U=Je[O];U&&(U.capacity>=Q||Rl(O,U.size,void 0,Q))},Zr=(W,Q)=>{var G,ye,Qe,Ue;const O=fs(Q);if(O==null)return null;const U=O;if(!Number.isFinite(U)||!Number.isInteger(U))return null;const ce=((G=Je[W])==null?void 0:G.capacity)??((ye=Je[W])==null?void 0:ye.size)??((Qe=ut[W])==null?void 0:Qe.length)??((Ue=nt[W])==null?void 0:Ue.length)??0;return U<0||ce<=0||U>=ce?null:U},zi=W=>{const Q=String(W||"").trim();return!Q||/^__arr_index\s*\(/i.test(Q)?W:`__arr_index(${W})`},Nl=W=>{const Q=String(W||"").trim();return!Q||/^__arr_index_str\s*\(/i.test(Q)?W:`__arr_index_str(${W})`},mu=(W,Q)=>{const O=ut[W],U=nt[W],ce=Je[W],G=(ce==null?void 0:ce.kind)==="string"||!!U&&!O,ye=(ce==null?void 0:ce.capacity)??(ce==null?void 0:ce.size)??(O==null?void 0:O.length)??(U==null?void 0:U.length)??0;if(!ye)return null;const Qe=G?Nl(Q):zi(Q);if(U&&!ce){const B=String(U.length);let ve="na";for(let Fe=ye-1;Fe>=0;Fe--){const ot=B?`(${B}) > ${Fe}`:"1",tt=JSON.stringify(U[Fe]??"");ve=`iff(((${Qe}) == ${Fe}) and (${ot}), ${tt}, ${ve})`}return ve}G?Rl(W,(ce==null?void 0:ce.size)??ye,U,ye):Vo(W,(ce==null?void 0:ce.size)??ye,O,ye);const Ue=Je[W],dt=Ue!=null&&Ue.dynamic?Ue.sizeSeries:String((Ue==null?void 0:Ue.size)??(O==null?void 0:O.length)??ye);let et="na";for(let B=ye-1;B>=0;B--){const ve=dt?`(${dt}) > ${B}`:"1";et=`iff(((${Qe}) == ${B}) and (${ve}), ${Cn(W,B)}, ${et})`}return et},Gc=(W,Q,O,U,ce)=>{const G=ut[W],ye=nt[W],Qe=Je[W],Ue=(Qe==null?void 0:Qe.kind)==="string"||!!ye&&!G,dt=(Qe==null?void 0:Qe.capacity)??(Qe==null?void 0:Qe.size)??(G==null?void 0:G.length)??(ye==null?void 0:ye.length)??0;if(!dt)return null;Ue?Rl(W,(Qe==null?void 0:Qe.size)??dt,ye,dt):Vo(W,(Qe==null?void 0:Qe.size)??dt,G,dt);const et=(ce==null?void 0:ce.normalizeIndex)===!1?Q:Ue?Nl(Q):zi(Q),B=[];for(let ve=0;ve<dt;ve++){const Fe=U?`(${U}) and `:"";B.push(`iff(${Fe}(${et}) == ${ve}, ${O}, ${Cn(W,ve)})`)}return B},du=W=>String(W||"").replace(/\barray\.size\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\)/gi,(Q,O)=>{const U=wt(String(O)),ce=Je[U];if(ce)return ce.sizeSeries;const G=ut[U];if(G)return String(G.length);const ye=nt[U];return ye?String(ye.length):Q}),Ju=(W,Q,O)=>{const U=Je[O],ce=ut[O],G=(U==null?void 0:U.capacity)??(U==null?void 0:U.size)??(ce==null?void 0:ce.length)??0;if(!G)return null;const ye=`array.size(${Q})`,Qe=(et,B)=>{const ve=`array.get(${Q}, ${et})`,Fe=B?`(${ve} * ${ve})`:ve;return`iff(${ye} > ${et}, ${Fe}, 0)`};if(W==="sum"||W==="avg"||W==="stdev"){let et=Qe(0,!1);for(let ot=1;ot<G;ot++)et=`(${et} + ${Qe(ot,!1)})`;if(W==="sum")return et;if(W==="avg")return`iff(${ye} > 0, (${et}) / ${ye}, na)`;let B=Qe(0,!0);for(let ot=1;ot<G;ot++)B=`(${B} + ${Qe(ot,!0)})`;const ve=`iff(${ye} > 0, (${et}) / ${ye}, na)`;return`sqrt(max(${`iff(${ye} > 0, (${B}) / ${ye} - (${ve} * ${ve}), na)`}, 0))`}const Ue=W==="min"?"1000000000000":"-1000000000000";let dt=`iff(${ye} > 0, array.get(${Q}, 0), ${Ue})`;for(let et=1;et<G;et++){const B=`iff(${ye} > ${et}, array.get(${Q}, ${et}), ${Ue})`;dt=`${W}(${dt}, ${B})`}return dt},rd=W=>{const Q=String(W||"");let O="",U=0,ce=null;const G=Q.toLowerCase(),ye=Qe=>/[a-z0-9_$]/i.test(Qe);for(;U<Q.length;){const Qe=Q[U];if(ce){O+=Qe,Qe===ce&&Q[U-1]!=="\\"&&(ce=null),U+=1;continue}if(Qe==="'"||Qe==='"'){ce=Qe,O+=Qe,U+=1;continue}const Ue=G.slice(U).match(/^array\.(sum|min|max|avg|stdev)\b/);if(!Ue||U>0&&ye(G[U-1]||"")){O+=Qe,U+=1;continue}const dt=String(Ue[1]||"").toLowerCase();let et=U+Ue[0].length;for(;et<Q.length&&/\s/.test(Q[et]);)et+=1;if(Q[et]!=="("){O+=Qe,U+=1;continue}let B=0,ve=et,Fe=null;for(;ve<Q.length;ve++){const Mt=Q[ve];if(Fe){Mt===Fe&&Q[ve-1]!=="\\"&&(Fe=null);continue}if(Mt==="'"||Mt==='"'){Fe=Mt;continue}if(Mt==="(")B+=1;else if(Mt===")"&&(B-=1,B===0))break}if(ve>=Q.length){O+=Q.slice(U);break}const ot=Q.slice(et+1,ve),tt=Kr(ot),St=String(tt[0]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(St)){O+=Q.slice(U,ve+1),U=ve+1;continue}const Be=wt(St),je=Ju(dt,St,Be);if(!je){O+=Q.slice(U,ve+1),U=ve+1;continue}O+=`(${je})`,U=ve+1}return O},Al=W=>{const Q=Je[W];Q&&(Q.dynamic=!0)},sa=(W,Q,O,U)=>{const ce=Je[W];if(!ce)return null;const G=ce.sizeSeries,ye=G,Qe=ce.capacity,Ue=[],dt=et=>{et.forEach((B,ve)=>{Ue.push({name:Cn(W,ve),hasVar:!1,declaredType:"",op:":=",rhs:B,lineNo:U})})};if(Q==="push"){const et=To(String(O.value||"na"),`${W}_push`),B=`(${ye}) < ${Qe}`,ve=Gc(W,ye,et,B);return ve&&dt(ve),Ue.push({name:G,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${B}, min(${G} + 1, ${Qe}), ${G})`,lineNo:U}),Ue}if(Q==="pop")return Ue.push({name:G,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${G} > 0, max(${G} - 1, 0), ${G})`,lineNo:U}),Ue;if(Q==="clear")return Ue.push({name:G,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:U}),Ue;if(Q==="resize"){const et=To(String(O.size||"0"),`${W}_resize`);return Ue.push({name:G,hasVar:!1,declaredType:"",op:":=",rhs:`min(max(0, ${et}), ${Qe})`,lineNo:U}),Ue}if(Q==="shift"||Q==="remove"){const et=Q==="shift"?"0":To(String(O.index||"0"),`${W}_remove`),B=zi(et),ve=`(${B}) >= 0 and (${B}) < ${ye}`,Fe=[];for(let ot=0;ot<Qe;ot++){const tt=ot<Qe-1?`(${ve}) and (${ot} >= (${B})) and (${ot} < (${ye} - 1))`:"0",St=ot<Qe-1?Cn(W,ot+1):Cn(W,ot);Fe.push(`iff(${tt}, ${St}, ${Cn(W,ot)})`)}return dt(Fe),Ue.push({name:G,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${ve}, max(${G} - 1, 0), ${G})`,lineNo:U}),Ue}if(Q==="unshift"||Q==="insert"){const et=Q==="unshift"?"0":To(String(O.index||"0"),`${W}_insert`),B=zi(et),ve=To(String(O.value||"na"),`${W}_insert_val`),Fe=`(${prevSize}) < ${Qe}`,ot=`(${B}) >= 0 and (${B}) <= ${ye}`,tt=[];for(let St=0;St<Qe;St++){const Be=`(${St} == (${B}))`,je=`(${St} > (${B})) and (${St} <= ${ye})`,Mt=St>0?Cn(W,St-1):Cn(W,St);tt.push(`iff(${Fe} and ${ot} and ${Be}, ${ve}, iff(${Fe} and ${ot} and ${je}, ${Mt}, ${Cn(W,St)}))`)}return dt(tt),Ue.push({name:G,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${Fe} and ${ot}, min(${G} + 1, ${Qe}), ${G})`,lineNo:U}),Ue}return null},Vc=(W,Q,O)=>{const U=Je[Q];if(!U)return null;Vo(W,U.size,void 0,U.capacity);const ce=Je[W];if(!ce)return null;const G=[];for(let ye=0;ye<ce.capacity;ye++)G.push({name:Cn(W,ye),hasVar:!1,declaredType:"",op:":=",rhs:Cn(Q,ye),lineNo:O});return G.push({name:ce.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:U.sizeSeries,lineNo:O}),G},vu=(W,Q,O,U)=>{const ce=Je[Q],G=Je[O];if(!ce||!G)return null;const ye=Math.min(Tn,ce.capacity+G.capacity);Vo(W,Math.min(ye,ce.size+G.size),void 0,ye);const Qe=Je[W];if(!Qe)return null;const Ue=[];for(let dt=0;dt<Qe.capacity;dt++){const et=`iff(${dt} < ${ce.sizeSeries}, array.get(${Q}, ${dt}), iff(${dt} < (${ce.sizeSeries} + ${G.sizeSeries}), array.get(${O}, ${dt} - ${ce.sizeSeries}), na))`;Ue.push({name:Cn(W,dt),hasVar:!1,declaredType:"",op:":=",rhs:To(et,`${W}_concat_${dt}`),lineNo:U})}return Ue.push({name:Qe.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:`min(${ce.sizeSeries} + ${G.sizeSeries}, ${ye})`,lineNo:U}),Al(W),Ue},Qc=W=>{const Q=String(W||"");let O="",U=0,ce=null;const G=Q.toLowerCase();for(;U<Q.length;){const ye=Q[U];if(ce){O+=ye,ye===ce&&Q[U-1]!=="\\"&&(ce=null),U+=1;continue}if(ye==="'"||ye==='"'){ce=ye,O+=ye,U+=1;continue}if(!(G.startsWith("array.get",U)&&(U===0||!/[a-z0-9_$]/i.test(G[U-1]||"")))){O+=ye,U+=1;continue}let Ue=U+9;for(;Ue<Q.length&&/\s/.test(Q[Ue]);)Ue+=1;if(Q[Ue]!=="("){O+=ye,U+=1;continue}let dt=0,et=Ue,B=null;for(;et<Q.length;et++){const wn=Q[et];if(B){wn===B&&Q[et-1]!=="\\"&&(B=null);continue}if(wn==="'"||wn==='"'){B=wn;continue}if(wn==="(")dt+=1;else if(wn===")"&&(dt-=1,dt===0))break}if(et>=Q.length){O+=Q.slice(U);break}const ve=Q.slice(Ue+1,et),Fe=Kr(ve),ot=String(Fe[0]||"").trim(),tt=String(Fe[1]||"").trim();if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(ot)||!tt){O+=Q.slice(U,et+1),U=et+1;continue}const St=wt(ot),Be=ut[St],je=nt[St],Mt=Je[St];if(!((Mt==null?void 0:Mt.capacity)??(Mt==null?void 0:Mt.size)??(Be==null?void 0:Be.length)??(je==null?void 0:je.length)??0)){O+=Q.slice(U,et+1),U=et+1;continue}const rs=Qc(tt),yn=Zr(St,rs);if(yn!=null){if(Je[St])O+=Cn(St,yn);else if(Be){const wn=Be[yn];O+=typeof wn=="number"&&Number.isFinite(wn)?String(wn):"na"}else je?O+=JSON.stringify(je[yn]??""):O+=Cn(St,yn);U=et+1;continue}const Qn=mu(St,rs);O+=Qn??Q.slice(U,et+1),U=et+1}return O},To=(W,Q)=>(()=>{let O=jt(W,Q);const U=Object.entries(pe);return U.length&&U.forEach(([ce,G])=>{O=O.replace(new RegExp(`\\b${ce}\\.`,"gi"),G.replacement)}),O=an(O),O=N1(O),O=O.replace(/\bta\./gi,""),O=O.replace(/\bmath\./gi,""),O=O.replace(/\bstr\./gi,""),O=O.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),O=O.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),O=O.replace(/\bstrategy_(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),O=rd(O),O=du(O),O=Qc(O),O=Jd(O,Hs),ns(O,Hs),O})(),ec=(W,Q)=>{if(W==null)return{};const O=String(W).trim();return O.startsWith('"')&&O.endsWith('"')||O.startsWith("'")&&O.endsWith("'")?{text:Er(O)}:O?{textExpr:To(O,Q)}:{}},yl=W=>W.when&&Qu(k_(To(String(W.when),"when")))||void 0,Dc=W=>Er(String(W.pane??se)).toLowerCase()==="sub"?"sub":"main",jl=(W,Q)=>{if(W.pane!=null)return Dc(W);const O=Q?wt(String(Q)):"";return O&&it[O]||se},qi=(W,Q,O)=>{if(!W)return e.push({message:`${Q} requires a value`,line:O}),null;const U=To(String(W),Q);return U||(e.push({message:`${Q} requires a value`,line:O}),null)},la=W=>{if(!W)return null;const Q=Er(String(W||"")).trim();return!Q||Q.toLowerCase()==="na"?null:wt(Q)},El=W=>{if(W==null)return;const Q=Er(String(W)).trim();return Q?Q.toLowerCase():void 0},qu=W=>{if(!W)return;if(Array.isArray(W)){const O=W.map(U=>String(U||"").trim().toLowerCase()).filter(Boolean);return O.length?O:void 0}const Q=String(W||"").split(",").map(O=>O.trim().toLowerCase()).filter(Boolean);return Q.length?Q:void 0},Td=(W,Q,O,U,ce,G)=>{const ye=[];for(let Qe=Q;Qe+1<W.length;Qe+=2){const Ue=qi(W[Qe],`${U} x`,O),dt=qi(W[Qe+1],`${U} y`,O);!Ue||!dt||ye.push({x:Ue,y:dt,xloc:ce,yloc:G})}return ye},ki=W=>{if(!W)return;const Q=String(W||"").trim(),O=Q.match(/^color\.new\s*\((.*)\)\s*$/i);if(O){const dt=Kr(O[1]||""),et=ki(dt[0]),B=dt[1]!=null?Er(String(dt[1])):"",ve=Dh(B);return C0(et,ve??void 0)}const U=Q.match(/^color\.from_hex\s*\((.*)\)\s*$/i);if(U){const dt=Kr(U[1]||""),et=String(dt[0]??"").trim(),B=et.startsWith('"')||et.startsWith("'"),ve=Er(et).trim();if(!B){Hs!=null&&!n.has(Hs)&&(t.push({message:"Color variables are limited. Use inline color.rgb/color.new/hex or input.color().",line:Hs}),n.add(Hs));return}if(!/^#[0-9a-fA-F]{6}$/.test(ve)){Hs!=null&&e.push({message:'color.from_hex expects "#RRGGBB"',line:Hs});return}return ve}const ce=Q.match(/^color\.rgb\s*\((.*)\)\s*$/i);if(ce){const dt=Kr(ce[1]||""),et=Dh(Er(String(dt[0]??""))),B=Dh(Er(String(dt[1]??""))),ve=Dh(Er(String(dt[2]??""))),Fe=Dh(Er(String(dt[3]??"")));if(typeof et=="number"&&typeof B=="number"&&typeof ve=="number"){const ot=Math.max(0,Math.min(255,Math.round(et))),tt=Math.max(0,Math.min(255,Math.round(B))),St=Math.max(0,Math.min(255,Math.round(ve)));if(typeof Fe=="number"&&Number.isFinite(Fe)){const Be=Math.max(0,Math.min(255,Math.round(Fe))),je=Math.max(0,Math.min(1,Be/255));return`rgba(${ot},${tt},${St},${je})`}return`rgb(${ot},${tt},${St})`}}const G=Q.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(G&&Rt[wt(G[0])]==="color")return`\${${G[0]}}`;const ye=c6(Q);if(ye)return ye;const Qe=Er(Q);if(Qe.startsWith("#")||Qe.startsWith("rgb"))return Qe;const Ue=Qe.toLowerCase();Ue&&Ue!=="na"&&Hs!=null&&!n.has(Hs)&&(t.push({message:"Color variables are limited. Use inline color.rgb/color.new/hex or input.color().",line:Hs}),n.add(Hs))},sl=(W,Q)=>{if(!W)return{};const O=To(String(W),Q);if(!O)return{};const U=fs(O);return U!=null?{value:U}:{expr:O}},br=(W,Q)=>{if(W==null)return{};const O=l1(String(W));return O!=null?{value:O}:sl(W,Q)},Wc=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=Pg(O);return U||e.push({message:`line style not supported: ${O}`,line:Q}),U},Xd=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=S2(O);return U||e.push({message:`line extend not supported: ${O}`,line:Q}),U},Uf=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=Mg(O);return U||e.push({message:`line xloc not supported: ${O}`,line:Q}),U},xf=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=Mg(O);return U||e.push({message:`label xloc not supported: ${O}`,line:Q}),U},Uu=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=Mg(O);return U||e.push({message:`box xloc not supported: ${O}`,line:Q}),U},tp=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=S2(O);return U||e.push({message:`box extend not supported: ${O}`,line:Q}),U},wf=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=Pg(O);if(U&&U.startsWith("arrow")){e.push({message:`box border_style not supported: ${O}`,line:Q});return}return U||e.push({message:`box border_style not supported: ${O}`,line:Q}),U},Vs=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=s_(O);return U||e.push({message:`box text_halign not supported: ${O}`,line:Q}),U},kn=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=c1(O);return U||e.push({message:`box text_valign not supported: ${O}`,line:Q}),U},Kn=(W,Q)=>{if(W==null)return{};const O=String(W??"").trim(),U=u6(O);if(U!=null)return{value:U};const ce=sl(W,"box.text_size");if(ce.value!=null){const G=ce.value;!Number.isFinite(G)||!Number.isInteger(G)?e.push({message:"box text_size must be an integer",line:Q}):ce.value=Math.max(8,Math.min(32,G))}return O&&U==null&&/^size\./i.test(O)&&e.push({message:`box text_size not supported: ${O}`,line:Q}),ce},Bs=(W,Q)=>{const O=sl(W,"box.border_width");if(W!=null&&String(W).trim()){const U=O.value;if(U!=null)(!Number.isFinite(U)||!Number.isInteger(U)||U<0||U>4)&&e.push({message:"box border_width must be an integer between 0 and 4",line:Q});else{const ce=To(String(W),"box.border_width"),G=String(ce??W).trim().toLowerCase();(G==="na"||G==="nan")&&e.push({message:"box border_width must be an integer between 0 and 4",line:Q})}}return O},bo=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=String(O).toLowerCase().replace(/^location\./,""),ce=U.includes("below")||U.includes("bottom")||U.includes("low"),G=U.includes("above")||U.includes("top")||U.includes("high"),ye=ce?"belowbar":G?"abovebar":void 0;return ye||e.push({message:`label location not supported: ${O}`,line:Q}),ye},lo=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=s_(O);return U||e.push({message:`label textalign not supported: ${O}`,line:Q}),U},Qi=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=iZ(O);return U||e.push({message:`label style not supported: ${O}`,line:Q}),U},xr=(W,Q)=>{if(W==null)return{};const O=String(W??"").trim(),U=u6(O);if(U!=null)return{value:U};const ce=sl(W,"label.size");if(ce.value!=null){const G=ce.value;!Number.isFinite(G)||!Number.isInteger(G)?e.push({message:"label size must be an integer",line:Q}):ce.value=Math.max(8,Math.min(32,G))}return O&&U==null&&/^size\./i.test(O)&&e.push({message:`label size not supported: ${O}`,line:Q}),ce},Ai=(W,Q)=>{const O=String(W??"").trim();if(!O)return;const U=t_(O);if(!U){e.push({message:`label yloc not supported: ${O}`,line:Q});return}return U||void 0},ri=(W,Q)=>{const O=sl(W,"line.width");if(W!=null&&String(W).trim()){const U=O.value;if(U!=null)(!Number.isFinite(U)||U<1||!Number.isInteger(U))&&e.push({message:"line width must be >= 1",line:Q});else{const ce=To(String(W),"line.width"),G=String(ce??W).trim().toLowerCase();(G==="na"||G==="nan")&&e.push({message:"line width must be >= 1",line:Q})}}return O},Ti=W=>{const Q=Er(String(W||"").trim()).toLowerCase();return Q?Q==="na"||Q==="nan"||Q==="inf"||Q==="+inf"||Q==="-inf"||Q==="infinity"||Q==="+infinity"||Q==="-infinity":!1},Eo=(W,Q,O)=>{if(W==null)return;const U=String(W||"").trim();if(!U)return;if(Q==="time"){Ti(U)&&e.push({message:"line x must be a number when xloc=time",line:O});return}const ce=fs(U);if(ce!=null){(!Number.isFinite(ce)||!Number.isInteger(ce))&&e.push({message:"line x must be an integer when xloc=bar_index",line:O});return}Ti(U)&&e.push({message:"line x must be an integer when xloc=bar_index",line:O})},hr=(W,Q,O)=>{if(W==null)return;const U=String(W||"").trim();if(!U)return;if(Q==="time"){Ti(U)&&e.push({message:"label x must be a number when xloc=time",line:O});return}const ce=fs(U);if(ce!=null){(!Number.isFinite(ce)||!Number.isInteger(ce))&&e.push({message:"label x must be an integer when xloc=bar_index",line:O});return}Ti(U)&&e.push({message:"label x must be an integer when xloc=bar_index",line:O})},ei=(W,Q,O)=>{if(W==null)return;const U=String(W||"").trim();if(!U)return;if(Q==="time"){Ti(U)&&e.push({message:"box x must be a number when xloc=time",line:O});return}const ce=fs(U);if(ce!=null){(!Number.isFinite(ce)||!Number.isInteger(ce))&&e.push({message:"box x must be an integer when xloc=bar_index",line:O});return}Ti(U)&&e.push({message:"box x must be an integer when xloc=bar_index",line:O})},ai=(W,Q)=>{const O=Se(W);Array.isArray(O.runtimeDrawOps)||(O.runtimeDrawOps=[]),O.runtimeDrawOps.push(Q)},vi=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(yn=>!Eu(yn)),Qe=qi(ye[0]??G.x1??G.x,"line.new x1",Q),Ue=qi(ye[1]??G.y1??G.y,"line.new y1",Q),dt=qi(ye[2]??G.x2,"line.new x2",Q),et=qi(ye[3]??G.y2,"line.new y2",Q);if(!Qe||!Ue||!dt||!et)return!0;const B=Dc(G),ve=yl(G),Fe=ri(G.width??G.linewidth,Q),ot=tg(G.layer??G.Layer),tt=sg(G.zindex??G.z_index??G.zIndex),St=ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),Be=El(G.group??G.group_id??G.groupId),je=qu(G.tags??G.tag),Mt=O?wt(O):void 0;Mt&&(it[Mt]=B);const Ze=Uf(G.xloc!=null?String(G.xloc):void 0,Q),rs=Ze||"bar_index";return Eo(Qe,rs,Q),Eo(dt,rs,Q),ai(B,{kind:"line_new",assign:Mt,once:U?!0:void 0,x1:Qe,y1:Ue,x2:dt,y2:et,when:ve,color:ki(String(G.color??""))||void 0,width:Fe.value,widthExpr:Fe.expr,style:Wc(G.style!=null?String(G.style):void 0,Q)||void 0,extend:Xd(G.extend!=null?String(G.extend):void 0,Q)||void 0,xloc:Ze,layer:ot,zIndex:tt,includeInAutoscale:St,groupId:Be,tags:je}),!0},_a=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(La=>!Eu(La)),Qe=qi(ye[0]??G.x,"label.new x",Q);let Ue=qi(ye[1]??G.y,"label.new y",Q);if(!Qe)return!0;const dt=ye[2]??G.text??G.title??"",et=ec(String(dt||""),"label_text"),B=ec(String(G.tooltip??""),"label_tooltip"),ve=Dc(G),Fe=yl(G),ot=Ai(String(G.yloc??""),Q)||bo(String(G.location??G.loc??""),Q)||void 0;if(ot&&(!Ue||String(Ue).trim().toLowerCase()==="na")&&(Ue=ot==="belowbar"?"low":ot==="abovebar"?"high":Ue),!Ue)return!0;const tt=xr(G.size,Q),St=tg(G.layer??G.Layer),Be=sg(G.zindex??G.z_index??G.zIndex),je=ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),Mt=El(G.group??G.group_id??G.groupId),Ze=qu(G.tags??G.tag),rs=G.wrap!=null?String(G.wrap).toLowerCase()==="true"||Number(G.wrap)===1:void 0,yn=sl(G.maxwidth??G.maxWidth,"label.max_width"),Qn=sl(G.bg_opacity??G.bgOpacity,"label.bg_opacity"),wn=sl(G.border_width??G.borderWidth,"label.border_width"),xo=sl(G.radius,"label.radius"),hi=sl(G.line_height??G.lineHeight,"label.line_height"),Ln=G.padding;let pl;if(Ln!=null){const La=Number(Ln);if(Number.isFinite(La))pl=La;else{const lc=String(Ln).trim();if(lc.startsWith("{"))try{pl=JSON.parse(lc.replace(/([A-Za-z0-9_]+)\s*:/g,'"$1":'))}catch{pl=void 0}}}const vn=O?wt(O):void 0;vn&&(it[vn]=ve);const mo=xf(String(G.xloc??""),Q)||void 0;return hr(Qe,mo||"bar_index",Q),ai(ve,{kind:"label_new",assign:vn,once:U?!0:void 0,x:Qe,y:Ue,when:Fe,yloc:ot,textAlign:lo(String(G.textalign??G.text_align??G.textAlign??""),Q),tooltip:B.text,tooltipExpr:B.textExpr,text:et.text,textExpr:et.textExpr,color:ki(String(G.color??""))||void 0,bgColor:ki(String(G.bgcolor??G.bgColor??G.background_color??G.backgroundColor??""))||void 0,borderColor:ki(String(G.bordercolor??G.border_color??G.borderColor??""))||void 0,textColor:ki(String(G.textcolor??G.textColor??""))||void 0,style:Qi(String(G.style??G.shape??""),Q)||void 0,size:tt.value??l1(String(G.size??"")),sizeExpr:tt.expr,xloc:mo,layer:St,zIndex:Be,includeInAutoscale:je,groupId:Mt,tags:Ze,wrap:rs,maxWidth:yn.value,bgOpacity:Qn.value,borderWidth:wn.value,radius:xo.value,padding:pl,align:lo(String(G.align??G.textalign??G.textAlign??""),Q)||void 0,valign:["top","middle","bottom"].includes(String(G.valign??"").toLowerCase())?String(G.valign).toLowerCase():void 0,lineHeight:hi.value,fontFamily:G.font_family??G.fontFamily,fontSize:sl(G.font_size??G.fontSize,"label.font_size").value,fontWeight:G.font_weight??G.fontWeight,monospace:G.monospace!=null?String(G.monospace).toLowerCase()==="true"||Number(G.monospace)===1:void 0}),!0},dl=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(mo=>!Eu(mo)),Qe=qi(ye[0]??G.left,"box.new left",Q),Ue=qi(ye[1]??G.top,"box.new top",Q),dt=qi(ye[2]??G.right,"box.new right",Q),et=qi(ye[3]??G.bottom,"box.new bottom",Q);if(!Qe||!Ue||!dt||!et)return!0;const B=Dc(G),ve=yl(G),Fe=Bs(G.border_width??G.borderWidth,Q),ot=G.text??"",tt=ec(String(ot||""),"box_text"),St=ec(String(G.tooltip??""),"box_tooltip"),Be=Kn(G.text_size??G.textSize,Q),je=Vs(String(G.text_halign??G.textHalign??""),Q)||void 0,Mt=kn(String(G.text_valign??G.textValign??""),Q)||void 0,Ze=G.text_wrap??G.textWrap,rs=Ze!=null?og(String(Ze))??void 0:void 0,yn=tg(G.layer??G.Layer),Qn=sg(G.zindex??G.z_index??G.zIndex),wn=ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),xo=El(G.group??G.group_id??G.groupId),hi=qu(G.tags??G.tag),Ln=O?wt(O):void 0;Ln&&(it[Ln]=B);const pl=Uu(String(G.xloc??""),Q)||void 0,vn=pl||"bar_index";return ei(Qe,vn,Q),ei(dt,vn,Q),ai(B,{kind:"box_new",assign:Ln,once:U?!0:void 0,left:Qe,top:Ue,right:dt,bottom:et,when:ve,borderColor:ki(String(G.border_color??G.borderColor??""))||void 0,width:Fe.value,widthExpr:Fe.expr,borderStyle:wf(String(G.border_style??G.borderStyle??""),Q)||void 0,bgColor:ki(String(G.bgcolor??G.bgColor??G.color??""))||void 0,text:tt.text,textExpr:tt.textExpr,tooltip:St.text,tooltipExpr:St.textExpr,textColor:ki(String(G.text_color??G.textColor??""))||void 0,textSize:Be.value,textSizeExpr:Be.expr,textHalign:je,textValign:Mt,textWrap:rs,extend:tp(String(G.extend??""),Q)||void 0,xloc:pl,layer:yn,zIndex:Qn,includeInAutoscale:wn,groupId:xo,tags:hi}),!0},ar=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(Qn=>!Eu(Qn)),Qe=ye[0]??G.position??G.pos??"top_right",Ue=ye[1]??G.columns??G.cols,dt=ye[2]??G.rows,et=Ue!=null?Number(Ue):NaN,B=dt!=null?Number(dt):NaN;if(!Number.isFinite(et)||!Number.isFinite(B))return e.push({message:"table.new(position, columns, rows) requires numeric columns/rows",line:Q}),!0;const ve=Dc(G),Fe=yl(G),ot=sl(G.border_width??G.borderWidth,"table.border_width"),tt=sl(G.frame_width??G.frameWidth,"table.frame_width"),St=br(G.text_size??G.textSize,"table.text_size"),Be=tg(G.layer??G.Layer),je=sg(G.zindex??G.z_index??G.zIndex),Mt=ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),Ze=El(G.group??G.group_id??G.groupId),rs=qu(G.tags??G.tag),yn=O?wt(O):void 0;return yn&&(it[yn]=ve),ai(ve,{kind:"table_new",assign:yn,once:U?!0:void 0,when:Fe,position:f6(String(Qe))||Er(String(Qe)),columns:Math.max(1,Math.floor(et)),rows:Math.max(1,Math.floor(B)),bgcolor:ki(String(G.bgcolor??G.bgColor??""))||void 0,borderColor:ki(String(G.border_color??G.borderColor??""))||void 0,borderWidth:ot.value,borderWidthExpr:ot.expr,textColor:ki(String(G.text_color??G.textColor??""))||void 0,textSize:St.value,textSizeExpr:St.expr,textHalign:s_(String(G.text_halign??G.textHalign??""))||void 0,textValign:c1(String(G.text_valign??G.textValign??""))||void 0,frameColor:ki(String(G.frame_color??G.frameColor??""))||void 0,frameWidth:tt.value,frameWidthExpr:tt.expr,layer:Be,zIndex:je,includeInAutoscale:Mt,groupId:Ze,tags:rs}),!0},Jr=(W,Q,O="table_cell")=>{const U=Kr(W||""),ce=qc(U),G=U.filter(Ze=>!Eu(Ze)),ye=G[0]??"",Qe=la(String(ye||""))||"",Ue=G[1]??ce.column??ce.col,dt=G[2]??ce.row,et=Ue!=null?Number(Ue):NaN,B=dt!=null?Number(dt):NaN;if(!Qe||!Number.isFinite(et)||!Number.isFinite(B))return t.push({message:"table.cell(table, column, row, text) requires a table id and numeric column/row",line:Q}),!0;const ve=G[3]??ce.text??ce.title??"",Fe=ec(String(ve||""),"table_cell_text"),ot=br(ce.text_size??ce.textSize,"table.cell_text_size"),tt=sl(ce.width,"table.cell_width"),St=sl(ce.height,"table.cell_height"),Be=jl(ce,Qe),je=ce.tooltip!=null?ec(String(ce.tooltip),"table_cell_tooltip"):{},Mt={kind:O,target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce),column:Math.floor(et),row:Math.floor(B),text:Fe.text,textExpr:Fe.textExpr,textColor:ki(String(ce.text_color??ce.textColor??""))||void 0,textSize:ot.value,textSizeExpr:ot.expr,textHalign:s_(String(ce.text_halign??ce.textHalign??""))||void 0,textValign:c1(String(ce.text_valign??ce.textValign??""))||void 0,bgcolor:ki(String(ce.bgcolor??ce.bgColor??""))||void 0,width:tt.value,widthExpr:tt.expr,height:St.value,heightExpr:St.expr,tooltip:je.text,tooltipExpr:je.textExpr};return ai(Be,Mt),!0},nl=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(B=>!Eu(B)),ye=G[0],Qe=la(ye);if(!Qe)return!0;const Ue=String(W||"").toLowerCase().replace(/_/g,""),dt=jl(ce,Qe),et={kind:"line_set",target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce)};if(Ue==="x1")et.x1=qi(G[1],"line.set_x1",O);else if(Ue==="y1")et.y1=qi(G[1],"line.set_y1",O);else if(Ue==="x2")et.x2=qi(G[1],"line.set_x2",O);else if(Ue==="y2")et.y2=qi(G[1],"line.set_y2",O);else if(Ue==="xy1")et.x1=qi(G[1],"line.set_xy1 x",O),et.y1=qi(G[2],"line.set_xy1 y",O);else if(Ue==="xy2")et.x2=qi(G[1],"line.set_xy2 x",O),et.y2=qi(G[2],"line.set_xy2 y",O);else if(Ue==="xy")et.x1=qi(G[1],"line.set_xy x1",O),et.y1=qi(G[2],"line.set_xy y1",O),et.x2=qi(G[3],"line.set_xy x2",O),et.y2=qi(G[4],"line.set_xy y2",O);else if(Ue==="color")et.color=ki(G[1]??ce.color);else if(Ue==="width"||Ue==="linewidth"){const B=ri(G[1]??ce.width,O);et.width=B.value,et.widthExpr=B.expr}else if(Ue==="style")et.style=Wc(G[1]??ce.style,O)||void 0;else if(Ue==="extend")et.extend=Xd(G[1]??ce.extend,O)||void 0;else if(Ue==="xloc")et.xloc=Uf(G[1]??ce.xloc,O)||void 0;else return t.push({message:`Unsupported line.set_${W}()`,line:O}),!0;return ai(dt,et),!0},tc=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"line_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},mc=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(Be=>!Eu(Be)),Qe=la(ye[0]??G.line1??G.line_1??G.l1),Ue=la(ye[1]??G.line2??G.line_2??G.l2);if(!Qe||!Ue)return t.push({message:"linefill.new(line1, line2) requires two line ids",line:Q}),!0;const dt=jl(G,Qe||Ue),et=yl(G),B=tg(G.layer??G.Layer),ve=sg(G.zindex??G.z_index??G.zIndex),Fe=ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),ot=El(G.group??G.group_id??G.groupId),tt=qu(G.tags??G.tag),St=O?wt(O):void 0;return St&&(it[St]=dt),ai(dt,{kind:"linefill_new",assign:St,once:U?!0:void 0,when:et,line1:Qe,line2:Ue,color:ki(ye[2]??G.color??G.fillcolor),layer:B,zIndex:ve,includeInAutoscale:Fe,groupId:ot,tags:tt}),!0},gu=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(B=>!Eu(B)),ye=G[0],Qe=la(ye);if(!Qe)return!0;const Ue=String(W||"").toLowerCase().replace(/_/g,""),dt=jl(ce,Qe),et={kind:"linefill_set",target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce)};if(Ue==="color")et.color=ki(G[1]??ce.color??ce.fillcolor);else if(Ue==="line1")et.line1=la(G[1]??ce.line1??ce.line_1??ce.l1)||void 0;else if(Ue==="line2")et.line2=la(G[1]??ce.line2??ce.line_2??ce.l2)||void 0;else return t.push({message:`Unsupported linefill.set_${W}()`,line:O}),!0;return ai(dt,et),!0},Bl=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"linefill_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},Ui=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(St=>!Eu(St)),Qe=yl(G),Ue=Mg(String(G.xloc??""))||void 0,dt=t_(String(G.yloc??""))||void 0,et=Td(ye,0,Q,"polyline.new",Ue,dt);if(et.length<2)return t.push({message:"polyline.new requires at least 2 points (x,y pairs)",line:Q}),!0;const B=Dc(G),ve=tg(G.layer??G.Layer),Fe=sg(G.zindex??G.z_index??G.zIndex),ot=ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),tt=O?wt(O):void 0;return tt&&(it[tt]=B),ai(B,{kind:"polyline_new",assign:tt,once:U?!0:void 0,when:Qe,points:et,color:ki(G.color),width:sl(G.width,"polyline.width").value,widthExpr:sl(G.width,"polyline.width").expr,style:Pg(String(G.style??""))||void 0,opacity:G.opacity!=null?Number(G.opacity):void 0,xloc:Ue,yloc:dt,layer:ve,zIndex:Fe,includeInAutoscale:ot,groupId:El(G.group??G.group_id??G.groupId),tags:qu(G.tags??G.tag)}),!0},Ol=(W,Q)=>{const O=Kr(W||""),U=qc(O),ce=O.filter(ve=>!Eu(ve)),G=ce[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye),Ue=Mg(String(U.xloc??""))||void 0,dt=t_(String(U.yloc??""))||void 0,et=Td(ce,1,Q,"polyline.set_points",Ue,dt),B=sl(U.width,"polyline.set_width");return ai(Qe,{kind:"polyline_set",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U),points:et.length?et:void 0,color:ki(U.color),width:B.value,widthExpr:B.expr,style:Pg(String(U.style??""))||void 0,opacity:U.opacity!=null?Number(U.opacity):void 0,xloc:Ue,yloc:dt,layer:tg(U.layer??U.Layer),zIndex:sg(U.zindex??U.z_index??U.zIndex),includeInAutoscale:ng(U.include_in_autoscale??U.includeInAutoscale??U.autoscale),groupId:El(U.group??U.group_id??U.groupId),tags:qu(U.tags??U.tag)}),!0},fl=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"polyline_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},bl=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(ot=>!Eu(ot)),Qe=yl(G),Ue=Mg(String(G.xloc??""))||void 0,dt=t_(String(G.yloc??""))||void 0,et=Td(ye,0,Q,"polygon.new",Ue,dt);if(et.length<3)return t.push({message:"polygon.new requires at least 3 points (x,y pairs)",line:Q}),!0;const B=Dc(G),ve=O?wt(O):void 0;ve&&(it[ve]=B);const Fe=sl(G.stroke_width??G.strokeWidth,"polygon.stroke_width");return ai(B,{kind:"polygon_new",assign:ve,once:U?!0:void 0,when:Qe,points:et,fillColor:ki(G.fill_color??G.fillcolor??G.color),strokeColor:ki(G.stroke_color??G.strokeColor??G.borderColor),strokeWidth:Fe.value,strokeWidthExpr:Fe.expr,strokeStyle:Pg(String(G.stroke_style??G.strokeStyle??""))||void 0,opacity:G.opacity!=null?Number(G.opacity):void 0,xloc:Ue,yloc:dt,layer:tg(G.layer??G.Layer),zIndex:sg(G.zindex??G.z_index??G.zIndex),includeInAutoscale:ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),groupId:El(G.group??G.group_id??G.groupId),tags:qu(G.tags??G.tag)}),!0},Ua=(W,Q)=>{const O=Kr(W||""),U=qc(O),ce=O.filter(ve=>!Eu(ve)),G=ce[0],ye=la(G);if(!ye)return!0;const Qe=Mg(String(U.xloc??""))||void 0,Ue=t_(String(U.yloc??""))||void 0,dt=Td(ce,1,Q,"polygon.set_points",Qe,Ue),et=jl(U,ye),B=sl(U.stroke_width??U.strokeWidth,"polygon.stroke_width");return ai(et,{kind:"polygon_set",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U),points:dt.length?dt:void 0,fillColor:ki(U.fill_color??U.fillcolor??U.color),strokeColor:ki(U.stroke_color??U.strokeColor??U.borderColor),strokeWidth:B.value,strokeWidthExpr:B.expr,strokeStyle:Pg(String(U.stroke_style??U.strokeStyle??""))||void 0,opacity:U.opacity!=null?Number(U.opacity):void 0,xloc:Qe,yloc:Ue,layer:tg(U.layer??U.Layer),zIndex:sg(U.zindex??U.z_index??U.zIndex),includeInAutoscale:ng(U.include_in_autoscale??U.includeInAutoscale??U.autoscale),groupId:El(U.group??U.group_id??U.groupId),tags:qu(U.tags??U.tag)}),!0},er=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"polygon_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},ba=(W,Q,O,U)=>{const ce=Kr(W||""),G=qc(ce),ye=ce.filter(tt=>!Eu(tt)),Qe=yl(G),Ue=Mg(String(G.xloc??""))||void 0,dt=t_(String(G.yloc??""))||void 0,et=Td(ye,0,Q,"path.new",Ue,dt);if(!et.length)return t.push({message:"path.new requires at least one (x,y) point",line:Q}),!0;const B=et.map((tt,St)=>({cmd:St===0?"M":"L",x:tt.x,y:tt.y,xloc:tt.xloc,yloc:tt.yloc})),ve=Dc(G),Fe=O?wt(O):void 0;Fe&&(it[Fe]=ve);const ot=sl(G.width,"path.width");return ai(ve,{kind:"path_new",assign:Fe,once:U?!0:void 0,when:Qe,commands:B,color:ki(G.color),width:ot.value,widthExpr:ot.expr,style:Pg(String(G.style??""))||void 0,opacity:G.opacity!=null?Number(G.opacity):void 0,layer:tg(G.layer??G.Layer),zIndex:sg(G.zindex??G.z_index??G.zIndex),includeInAutoscale:ng(G.include_in_autoscale??G.includeInAutoscale??G.autoscale),groupId:El(G.group??G.group_id??G.groupId),tags:qu(G.tags??G.tag)}),!0},ol=(W,Q)=>{const O=Kr(W||""),U=qc(O),ce=O.filter(Fe=>!Eu(Fe)),G=ce[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye),Ue=Mg(String(U.xloc??""))||void 0,dt=t_(String(U.yloc??""))||void 0,et=Td(ce,1,Q,"path.set_points",Ue,dt),B=et.length>0?et.map((Fe,ot)=>({cmd:ot===0?"M":"L",x:Fe.x,y:Fe.y,xloc:Fe.xloc,yloc:Fe.yloc})):void 0,ve=sl(U.width,"path.set_width");return ai(Qe,{kind:"path_set",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U),commands:B,color:ki(U.color),width:ve.value,widthExpr:ve.expr,style:Pg(String(U.style??""))||void 0,opacity:U.opacity!=null?Number(U.opacity):void 0,layer:tg(U.layer??U.Layer),zIndex:sg(U.zindex??U.z_index??U.zIndex),includeInAutoscale:ng(U.include_in_autoscale??U.includeInAutoscale??U.autoscale),groupId:El(U.group??U.group_id??U.groupId),tags:qu(U.tags??U.tag)}),!0},xd=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"path_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},_u=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(B=>!Eu(B)),ye=G[0],Qe=la(ye);if(!Qe)return!0;const Ue=String(W||"").toLowerCase().replace(/_/g,""),dt=jl(ce,Qe),et={kind:"label_set",target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce)};if(Ue==="x")et.x=qi(G[1],"label.set_x",O);else if(Ue==="y")et.y=qi(G[1],"label.set_y",O);else if(Ue==="xy")et.x=qi(G[1],"label.set_xy x",O),et.y=qi(G[2],"label.set_xy y",O);else if(Ue==="text"){const B=ec(String(G[1]??ce.text??""),"label_set_text");et.text=B.text,et.textExpr=B.textExpr}else if(Ue==="color")et.color=ki(G[1]??ce.color);else if(Ue==="textcolor")et.textColor=ki(G[1]??ce.textcolor??ce.textColor);else if(Ue==="style")et.style=Qi(String(G[1]??ce.style??""),O)||void 0;else if(Ue==="size"){const B=xr(G[1]??ce.size,O);et.size=B.value??l1(String(G[1]??ce.size??"")),et.sizeExpr=B.expr}else if(Ue==="yloc")et.yloc=Ai(String(G[1]??ce.yloc??""),O)||void 0;else if(Ue==="textalign")et.textAlign=lo(String(G[1]??ce.textalign??ce.textAlign??""),O)||void 0;else if(Ue==="tooltip"){const B=ec(String(G[1]??ce.tooltip??""),"label_set_tooltip");et.tooltip=B.text,et.tooltipExpr=B.textExpr}else if(Ue==="xloc")et.xloc=xf(String(G[1]??ce.xloc??""),O)||void 0;else return t.push({message:`Unsupported label.set_${W}()`,line:O}),!0;return ai(dt,et),!0},eu=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"label_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},ca=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(B=>!Eu(B)),ye=G[0],Qe=la(ye);if(!Qe)return!0;const Ue=String(W||"").toLowerCase().replace(/_/g,""),dt=jl(ce,Qe),et={kind:"box_set",target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce)};if(Ue==="left")et.left=qi(G[1],"box.set_left",O);else if(Ue==="right")et.right=qi(G[1],"box.set_right",O);else if(Ue==="top")et.top=qi(G[1],"box.set_top",O);else if(Ue==="bottom")et.bottom=qi(G[1],"box.set_bottom",O);else if(Ue==="lefttop")et.left=qi(G[1],"box.set_lefttop left",O),et.top=qi(G[2],"box.set_lefttop top",O);else if(Ue==="rightbottom")et.right=qi(G[1],"box.set_rightbottom right",O),et.bottom=qi(G[2],"box.set_rightbottom bottom",O);else if(Ue==="bgcolor")et.bgColor=ki(G[1]??ce.bgcolor??ce.bgColor);else if(Ue==="bordercolor")et.borderColor=ki(G[1]??ce.border_color??ce.borderColor);else if(Ue==="borderwidth"){const B=Bs(G[1]??ce.border_width??ce.borderWidth,O);et.width=B.value,et.widthExpr=B.expr}else if(Ue==="borderstyle")et.borderStyle=wf(String(G[1]??ce.border_style??ce.borderStyle??""),O)||void 0;else if(Ue==="text"){const B=ec(String(G[1]??ce.text??""),"box_set_text");et.text=B.text,et.textExpr=B.textExpr}else if(Ue==="textcolor")et.textColor=ki(G[1]??ce.text_color??ce.textColor);else if(Ue==="textsize"){const B=Kn(G[1]??ce.text_size??ce.textSize,O);et.textSize=B.value,et.textSizeExpr=B.expr}else if(Ue==="texthalign")et.textHalign=Vs(String(G[1]??ce.text_halign??ce.textHalign??""),O)||void 0;else if(Ue==="textvalign")et.textValign=kn(String(G[1]??ce.text_valign??ce.textValign??""),O)||void 0;else if(Ue==="textwrap"){const B=G[1]??ce.text_wrap??ce.textWrap;B!=null&&(et.textWrap=og(String(B))??void 0)}else if(Ue==="tooltip"){const B=ec(String(G[1]??ce.tooltip??""),"box_set_tooltip");et.tooltip=B.text,et.tooltipExpr=B.textExpr}else if(Ue==="extend")et.extend=tp(String(G[1]??ce.extend??""),O)||void 0;else if(Ue==="xloc")et.xloc=Uu(String(G[1]??ce.xloc??""),O)||void 0;else return t.push({message:`Unsupported box.set_${W}()`,line:O}),!0;return ai(dt,et),!0},vc=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"box_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},rc=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(B=>!Eu(B)),ye=G[0],Qe=la(ye);if(!Qe)return!0;const Ue=String(W||"").toLowerCase().replace(/_/g,""),dt=jl(ce,Qe),et={kind:"table_set",target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce)};if(Ue==="position")et.position=f6(String(G[1]??ce.position??""))||Er(String(G[1]??ce.position??""));else if(Ue==="bgcolor")et.bgcolor=ki(G[1]??ce.bgcolor??ce.bgColor);else if(Ue==="bordercolor")et.borderColor=ki(G[1]??ce.border_color??ce.borderColor);else if(Ue==="borderwidth"){const B=sl(G[1]??ce.border_width??ce.borderWidth,"table.set_border_width");et.borderWidth=B.value,et.borderWidthExpr=B.expr}else if(Ue==="textcolor")et.textColor=ki(G[1]??ce.text_color??ce.textColor);else if(Ue==="textsize"){const B=br(G[1]??ce.text_size??ce.textSize,"table.set_text_size");et.textSize=B.value,et.textSizeExpr=B.expr}else if(Ue==="texthalign")et.textHalign=s_(String(G[1]??ce.text_halign??ce.textHalign??""))||void 0;else if(Ue==="textvalign")et.textValign=c1(String(G[1]??ce.text_valign??ce.textValign??""))||void 0;else if(Ue==="framecolor")et.frameColor=ki(G[1]??ce.frame_color??ce.frameColor);else if(Ue==="framewidth"){const B=sl(G[1]??ce.frame_width??ce.frameWidth,"table.set_frame_width");et.frameWidth=B.value,et.frameWidthExpr=B.expr}else return t.push({message:`Unsupported table.set_${W}()`,line:O}),!0;return ai(dt,et),!0},wd=(W,Q)=>{const O=Kr(W||""),U=qc(O),G=O.filter(Ue=>!Eu(Ue))[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye);return ai(Qe,{kind:"table_delete",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)}),!0},zl=(W,Q)=>{const O=Kr(W||""),U=qc(O),ce=O.filter(et=>!Eu(et)),G=ce[0],ye=la(G);if(!ye)return!0;const Qe=jl(U,ye),Ue=(et,B)=>{if(!(et==null||String(et).trim()===""))return qi(String(et),B,Q)||void 0},dt={kind:"table_clear",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)};return dt.startColumn=Ue(ce[1]??U.start_column??U.start_col,"table.clear start_column"),dt.startRow=Ue(ce[2]??U.start_row,"table.clear start_row"),dt.endColumn=Ue(ce[3]??U.end_column??U.end_col,"table.clear end_column"),dt.endRow=Ue(ce[4]??U.end_row,"table.clear end_row"),ai(Qe,dt),!0},Fd=(W,Q)=>{const O=Kr(W||""),U=qc(O),ce=O.filter(Fe=>!Eu(Fe)),G=ce[0],ye=la(G);if(!ye)return!0;const Qe=ce[1]??U.left,Ue=ce[2]??U.top,dt=ce[3]??U.right,et=ce[4]??U.bottom;if(Qe==null||Ue==null||dt==null||et==null)return t.push({message:"table.merge(table, left, top, right, bottom) requires 4 numeric args",line:Q}),!0;const B=jl(U,ye),ve={kind:"table_merge",target:ye,targetExpr:G!=null?String(G):void 0,when:yl(U)};return ve.left=qi(String(Qe),"table.merge left",Q)||void 0,ve.top=qi(String(Ue),"table.merge top",Q)||void 0,ve.right=qi(String(dt),"table.merge right",Q)||void 0,ve.bottom=qi(String(et),"table.merge bottom",Q)||void 0,ai(B,ve),!0},Tl=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(tt=>!Eu(tt)),ye=G[0]??"",Qe=la(String(ye||""))||"",Ue=G[1]??ce.column??ce.col,dt=G[2]??ce.row,et=Ue!=null?Number(Ue):NaN,B=dt!=null?Number(dt):NaN;if(!Qe||!Number.isFinite(et)||!Number.isFinite(B))return t.push({message:"table.cell_set_* requires a table id and numeric column/row",line:O}),!0;const ve=String(W||"").toLowerCase().replace(/_/g,""),Fe=jl(ce,Qe),ot={kind:"table_cell_set",target:Qe,targetExpr:ye!=null?String(ye):void 0,when:yl(ce),column:Math.floor(et),row:Math.floor(B)};if(ve==="text"){const tt=ec(String(G[3]??ce.text??""),"table_cell_set_text");ot.text=tt.text,ot.textExpr=tt.textExpr}else if(ve==="textcolor")ot.textColor=ki(G[3]??ce.text_color??ce.textColor);else if(ve==="bgcolor")ot.bgcolor=ki(G[3]??ce.bgcolor??ce.bgColor);else if(ve==="textsize"){const tt=br(G[3]??ce.text_size??ce.textSize,"table.cell_set_text_size");ot.textSize=tt.value,ot.textSizeExpr=tt.expr}else if(ve==="texthalign")ot.textHalign=s_(String(G[3]??ce.text_halign??ce.textHalign??""))||void 0;else if(ve==="textvalign")ot.textValign=c1(String(G[3]??ce.text_valign??ce.textValign??""))||void 0;else if(ve==="width"){const tt=sl(G[3]??ce.width,"table.cell_set_width");ot.width=tt.value,ot.widthExpr=tt.expr}else if(ve==="height"){const tt=sl(G[3]??ce.height,"table.cell_set_height");ot.height=tt.value,ot.heightExpr=tt.expr}else if(ve==="tooltip"){const tt=ec(String(G[3]??ce.tooltip??""),"table_cell_set_tooltip");ot.tooltip=tt.text,ot.tooltipExpr=tt.textExpr}else return t.push({message:`Unsupported table.cell_set_${W}()`,line:O}),!0;return ai(Fe,ot),!0};for(let W=0;W<L.length;W++){const Q=W,O=L[W],U=O.text.match(/^\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*\((.*)\)\s*=>\s*(.*)$/);if(!U)continue;const ce=U[1],G=U[2]||"";let ye=String(U[3]||"").trim(),Qe;if(!ye){const et=O.indent,B=[];let ve=W+1;for(;ve<L.length&&L[ve].indent>et;)L[ve].text.startsWith("//@pine_fn")||B.push(L[ve]),ve+=1;const Fe=B.map(St=>String(St.text||"").trim()).filter(Boolean);if(!Fe.length){e.push({message:`Function "${ce}" requires a body expression`,line:O.lineNo});continue}Qe=B.map(St=>({text:String(St.text||""),lineNo:St.lineNo,indent:St.indent}));const ot=Fe[Fe.length-1];ye=ot.replace(/^return\s+/i,"").trim()||ot;for(let St=W+1;St<ve;St++)L[St]={...L[St],text:"//@pine_fn"};W=ve-1}const Ue=Kr(G).map(et=>String(et||"").trim()).filter(Boolean).map(et=>{const B=et.match(/^(?:(?:varip|var)\s+)?(?:float|int|bool|string)\s+([A-Za-z_$][A-Za-z0-9_$]*)$/i);return(B?B[1]:et).trim()}),dt=wt(ce);zt[dt]&&t.push({message:`Duplicate function definition "${ce}" (later definition overrides).`,line:O.lineNo}),zt[dt]={name:ce,args:Ue,body:ye,lineNo:O.lineNo,bodyLines:Qe},L[Q]={...O,text:"//@pine_fn"}}const xa=W=>{const Q=String(W||"").trim(),O=wt(Q),U=Ht[O];return U||Q},ku=W=>{const Q=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,O=new Map,U=new Set,ce=ye=>{const Qe=wt(ye);if(O.has(Qe))return O.get(Qe);const Ue=Ht[Qe];if(!Ue)return ye;if(U.has(Qe))return Ue;U.add(Qe);const dt=String(Ue).replace(Q,et=>{const B=wt(et);return Ht[B]?`(${ce(B)})`:et});return U.delete(Qe),O.set(Qe,dt),dt},G=xa(W);return String(G).replace(Q,ye=>{const Qe=wt(ye);return Ht[Qe]?`(${ce(Qe)})`:ye})},Qu=W=>{const Q=/\b[A-Za-z_$][A-Za-z0-9_$]*\b/g,O=new Map,U=new Set,ce=B=>{const ve=wt(B);if(O.has(ve))return O.get(ve);const Fe=Ht[ve];if(!Fe)return B;if(U.has(ve))return Fe;U.add(ve);const ot=String(Fe).replace(Q,tt=>{const St=wt(tt);return Ht[St]?`(${ce(St)})`:tt});return U.delete(ve),O.set(ve,ot),ot},G=xa(W),ye=String(G).replace(Q,B=>{const ve=wt(B);return Ht[ve]?`(${ce(ve)})`:B}),Qe=new Set(Te.map(B=>wt(String((B==null?void 0:B.name)||""))).filter(Boolean)),Ue=new Set(Object.keys(kt||{}).map(B=>wt(B)).filter(Boolean)),dt=new Set(["open","high","low","close","volume","time","and","or","not","true","false","crossesabove","crossesbelow"]);return ye.replace(Q,(B,ve)=>{const Fe=wt(B);if(!Fe||dt.has(Fe))return B;const ot=ye.slice(ve+B.length);return/^\s*\(/.test(ot)||!Ue.has(Fe)||Qe.has(Fe)?B:`\${${B}}`})},ed=W=>W===">"||W==="<"||W===">="||W==="<="||W==="=="||W==="!=",td=W=>{if(!W||typeof W!="object")return!1;if(W.kind==="BinaryExpression"){const Q=W.left,O=W.right;return ed(W.operator)&&(Q.kind==="BinaryExpression"&&ed(Q.operator)||O.kind==="BinaryExpression"&&ed(O.operator))?!0:td(Q)||td(O)}return W.kind==="UnaryExpression"?td(W.expr):W.kind==="MemberExpression"?td(W.object):W.kind==="IndexExpression"?td(W.object)||td(W.index):W.kind==="CallExpression"?W.args.some(Q=>td(Q)):!1},sp="Chained comparisons are only supported in simple form. Rewrite as (a < b) and (b < c).",Gf=W=>{W!=null&&(o.has(W)||(e.push({message:sp,line:W}),o.add(W)))},kd=W=>!!W&&/[A-Za-z0-9_$]/.test(W),Zd=(W,Q,O)=>{if(W.slice(Q,Q+O.length).toLowerCase()!==O)return!1;const U=W[Q-1],ce=W[Q+O.length];return!(kd(U)||kd(ce))},gc=W=>{let Q=W.trim(),O=0;for(;Q.startsWith("(")&&Q.endsWith(")");){let U=0,ce=null,G=!0;for(let ye=0;ye<Q.length;ye++){const Qe=Q[ye];if(ce){Qe===ce&&Q[ye-1]!=="\\"&&(ce=null);continue}if(Qe==="'"||Qe==='"'){ce=Qe;continue}if(Qe==="(")U+=1;else if(Qe===")"&&(U-=1,U===0&&ye<Q.length-1)){G=!1;break}}if(!G||U!==0||ce)break;Q=Q.slice(1,-1).trim(),O+=1}return{inner:Q,wraps:O}},jf=W=>{const Q=[],O=[];let U=0,ce=0,G=0,ye=0,Qe=null,Ue=!1,dt=0;for(;dt<W.length;){const et=W[dt];if(Qe){et===Qe&&W[dt-1]!=="\\"&&(Qe=null),dt+=1;continue}if(et==="'"||et==='"'){Qe=et,dt+=1;continue}if(et==="("){ce+=1,dt+=1;continue}if(et===")"){ce=Math.max(0,ce-1),dt+=1;continue}if(et==="{"){G+=1,dt+=1;continue}if(et==="}"){G=Math.max(0,G-1),dt+=1;continue}if(et==="["){ye+=1,dt+=1;continue}if(et==="]"){ye=Math.max(0,ye-1),dt+=1;continue}if(ce||G||ye){dt+=1;continue}const B=W.slice(dt,dt+2);if(B==="<="||B===">="||B==="=="||B==="!="){Q.push(W.slice(U,dt).trim()),O.push(B),dt+=2,U=dt;continue}if(et==="<"||et===">"){Q.push(W.slice(U,dt).trim()),O.push(et),dt+=1,U=dt;continue}if(Zd(W,dt,"and")){Ue=!0,dt+=3;continue}if(Zd(W,dt,"or")){Ue=!0,dt+=2;continue}if(Zd(W,dt,"not")){Ue=!0,dt+=3;continue}if(et==="?"){Ue=!0,dt+=1;continue}if(et===":"){W[dt+1]==="="&&(dt+=1),Ue=!0,dt+=1;continue}if(et===","){Ue=!0,dt+=1;continue}if(et==="="){Ue=!0,dt+=1;continue}dt+=1}return O.length&&Q.push(W.slice(U).trim()),{terms:Q,ops:O,hasChain:O.length>1,complex:Ue}},Nf=W=>{const Q=W.trim();if(!Q)return!1;let O=0,U=null,ce=0;for(;ce<Q.length;){const G=Q[ce];if(U){G===U&&Q[ce-1]!=="\\"&&(U=null),ce+=1;continue}if(G==="'"||G==='"'){U=G,ce+=1;continue}if(G==="("){O+=1,ce+=1;continue}if(G===")"){O=Math.max(0,O-1),ce+=1;continue}if(G==="{"){ce+=1;continue}if(G==="}"){ce+=1;continue}if(G==="["){ce+=1;continue}if(G==="]"){ce+=1;continue}if(Zd(Q,ce,"and")||Zd(Q,ce,"or")||Zd(Q,ce,"not"))return!1;const ye=Q.slice(ce,ce+2);if(ye==="<="||ye===">="||ye==="=="||ye==="!="||G==="<"||G===">"||G==="?"||G===":"||G==="="||G===","&&(O<=0||O>1))return!1;ce+=1}return!0},Jd=(W,Q)=>{if(!/[<>!=]=?|==/.test(W))return W;const{inner:O,wraps:U}=gc(W),ce=jf(O);if(ce.hasChain&&!ce.complex){const G=ce.ops.some(dt=>dt==="=="||dt==="!="),ye=ce.terms.length===ce.ops.length+1&&ce.terms.every(dt=>Nf(dt));if(G||!ye)return Gf(Q),W;const Qe=[];for(let dt=0;dt<ce.ops.length;dt++)Qe.push(`(${ce.terms[dt]}) ${ce.ops[dt]} (${ce.terms[dt+1]})`);let Ue=Qe.join(" and ");for(let dt=0;dt<U;dt++)Ue=`(${Ue})`;return Ue}try{const G=W.replace(/\$\{[^}]+\}/g,"1"),ye=Ep(G);td(ye)&&Gf(Q)}catch{}return W},xl=(W,Q)=>{if(W==null)return{};const O=Qu(k_(To(String(W),"when")));if(!O)return{};try{const U=O.replace(/\$\{[^}]+\}/g,"1");Ep(U)}catch(U){const ce=(U==null?void 0:U.message)||String(U);e.push({message:`Pine condition parse failed: ${ce}`,line:Q})}return{whenExpr:O}},Su=(W,Q)=>{const O=String(W||"").trim(),U=To(O,Q),ce=U.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(ce)return ce[0];const G=Dh(U);if(G!=null){const dt=`__const_${String(G).replace(/[^\d]/g,"_")}`;return Te.some(et=>et.name.toLowerCase()===dt.toLowerCase())||Te.push({name:dt,expr:String(G)}),dt}const ye=Q.replace(/[^A-Za-z0-9_]+/g,"_").toLowerCase();let Qe=`__${ye||"expr"}`,Ue=1;for(;Te.some(dt=>dt.name.toLowerCase()===Qe.toLowerCase());)Ue+=1,Qe=`__${ye||"expr"}_${Ue}`;return Te.push({name:Qe,expr:U}),Qe},ad=(W,Q)=>{const O=Er(String(W||"").trim()),U=wt(O);return ze[U]?ze[U]:Su(O,Q).replace(/\s+/g,"_").toLowerCase()},Af=(W,Q,O)=>{const U=Kr(W||"");if(!U.length){e.push({message:"plot() requires at least 1 argument",line:Q});return}const ce=U[0],G=U[1]&&!U[1].includes("=")?U[1]:null,ye=qc(U),Qe=Dc(ye),Ue=Se(Qe),dt=Su(ce,Er(String(ye.title??ye.name??G??ce??"plot"))),et=sl(ye.offset,"plot_offset"),B=sl(ye.show_last,"plot_show_last"),ve=sl(ye.precision,"plot_precision"),Fe=et.value!=null?et.value:et.expr,ot=B.value!=null?B.value:B.expr,tt=ve.value!=null?ve.value:ve.expr,St=ye.display!=null?String(ye.display):void 0,Be=ye.trackprice!=null?og(String(ye.trackprice)):void 0,je=ye.transp??ye.transparency,Mt=je!=null?Number(je):void 0,Ze=ki(String(ye.color??"")),rs=C0(Ze,Mt),yn=d6(ye.type),Qn=d6(ye.style),wn=yn??Qn??Er(String(ye.type??"line"))??"line",xo=ye.linestyle??ye.line_style??ye.lineStyle??(Qn?void 0:ye.style),hi=xo?Pg(String(xo)):void 0,Ln=dt.replace(/\s+/g,"_").toLowerCase();Ue.plots.push({name:Er(String(ye.title??ye.name??G??dt)),source:Ln,type:wn,color:rs,width:ye.width!=null?Number(ye.width):ye.linewidth!=null?Number(ye.linewidth):void 0,style:hi??void 0,offset:Fe,showLast:ot,precision:tt,display:St,trackPrice:Be}),O&&(ze[wt(O)]=Ln)},fu=(W,Q,O)=>{const U=Kr(Q||""),ce=qc(U),G=U.filter(Gi=>!Eu(Gi));if(G.length<4){e.push({message:`${W} plot requires open/high/low/close`,line:O});return}const ye=Dc(ce),Qe=Se(ye),Ue=Su(G[0],`${W}_open`).replace(/\s+/g,"_").toLowerCase(),dt=Su(G[1],`${W}_high`).replace(/\s+/g,"_").toLowerCase(),et=Su(G[2],`${W}_low`).replace(/\s+/g,"_").toLowerCase(),B=Su(G[3],`${W}_close`).replace(/\s+/g,"_").toLowerCase(),ve=Er(String(ce.title??ce.name??G[4]??W)),Fe=ce.color??G[5]??"",ot=ce.colordown??ce.color_down??ce.colordn??"",tt=ce.wickcolor??G[6]??"",St=ce.bordercolor??G[7]??"",Be=ce.transp??ce.transparency,je=Be!=null?Number(Be):void 0,Mt=C0(ki(String(Fe)),je),Ze=C0(ki(String(ot))||Mt,je),rs=C0(ki(String(tt)),je),yn=C0(ki(String(St)),je),Qn=sl(ce.offset,`${W}_offset`),wn=sl(ce.show_last,`${W}_show_last`),xo=sl(ce.precision,`${W}_precision`),hi=Qn.value!=null?Qn.value:Qn.expr,Ln=wn.value!=null?wn.value:wn.expr,pl=xo.value!=null?xo.value:xo.expr,vn=ce.display!=null?String(ce.display):void 0,mo=ce.trackprice!=null?og(String(ce.trackprice)):void 0;Qe.plots.push({name:ve||W,type:W,open:Ue,high:dt,low:et,close:B,color:Mt||(W==="candles"?"#22c55e":"#64748b"),downColor:Ze||"#ef4444",wickColor:rs||void 0,borderColor:yn||void 0,offset:hi,showLast:Ln,precision:pl,display:vn,trackPrice:mo})},$u=(W,Q,O)=>{const U=Q.match(/^input\.(int|float|bool|string|time|session|source|symbol|color)\s*\((.*)\)\s*$/i);if(!U)return!1;const ce=U[1].toLowerCase(),G=Kr(U[2]||""),ye=qc(G),Qe=G.filter(Be=>!Eu(Be)),Ue=ye.defval??Qe[0]??"",dt=ye.title??Qe[1]??"",et=dt?Er(String(dt)):void 0,B=Be=>{e.push({message:Be,line:O})},ve=Be=>{const je=typeof Be=="number"?Be:Number(Be);return Number.isFinite(je)?je:void 0},Fe=ve(ye.minval),ot=ve(ye.maxval),tt=ve(ye.step);let St=null;if(ce==="bool"){const Be=og(String(Ue));if(Be==null)return B(`input.bool() requires defval true/false for "${W}"`),!0;St=Be}else if(ce==="string"||ce==="session"||ce==="symbol")St=Er(String(Ue||""));else if(ce==="color"){const Be=c6(String(Ue))||Er(String(Ue||""));if(!Be)return B(`input.color() requires a valid color for "${W}"`),!0;St=Be}else if(ce==="time"){const Be=ve(String(Ue));if(Be!=null)St=Be;else{const je=nZ(String(Ue))??(()=>{const Mt=Er(String(Ue||"")),Ze=Date.parse(Mt);return Number.isFinite(Ze)?Ze:null})();if(je==null)return B(`input.time() requires a numeric or timestamp defval for "${W}"`),!0;St=je}}else if(ce==="source"){const Be=To(String(Ue||"close"),`input_source_${W}`),je=Be.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);St=je?je[0]:Su(Be,`input_source_${W}`)}else{const Be=ve(Ue);if(Be==null)return B(`input.${ce}() requires numeric defval for "${W}"`),!0;St=ce==="int"?Math.floor(Be):Be}return kt[W]=St,Rt[wt(W)]=ce,pt.push({name:W,type:ce,title:et,defval:St,minval:Fe,maxval:ot,step:tt}),!0},yu=[];let Yf=0;const Ga=(W,Q,O,U)=>{var Qe,Ue;const ce=[],G=dt=>U.some(et=>wt(et)===wt(dt));let ye=Q;for(;ye<W.length;){const dt=W[ye];if(dt.indent<=O)break;const et=String(dt.text||"").trim();if(!et||et.startsWith("//")){ye+=1;continue}if(et==="break"){ce.push({kind:"break",lineNo:dt.lineNo}),ye+=1;continue}if(et==="continue"){ce.push({kind:"continue",lineNo:dt.lineNo}),ye+=1;continue}const B=et.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(B){const Be=dt.indent,je=[],Mt=String(B[1]??B[2]??"").trim();Hs=dt.lineNo;const Ze=Mt?To(Mt,"loop_if"):"",rs=Ga(W,ye+1,Be,U);je.push({cond:Ze||void 0,body:rs.ops,lineNo:dt.lineNo});let yn=rs.nextIdx;for(;yn<W.length&&W[yn].indent===Be;){const Qn=String(W[yn].text||"").trim(),wn=Qn.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(wn){const xo=String(wn[1]??wn[2]??"").trim();Hs=W[yn].lineNo;const hi=xo?To(xo,"loop_if"):"",Ln=Ga(W,yn+1,Be,U);je.push({cond:hi||void 0,body:Ln.ops,lineNo:W[yn].lineNo}),yn=Ln.nextIdx;continue}if(/^else$/i.test(Qn)){const xo=Ga(W,yn+1,Be,U);je.push({cond:void 0,body:xo.ops,lineNo:W[yn].lineNo}),yn=xo.nextIdx}break}ce.push({kind:"if",lineNo:dt.lineNo,branches:je}),ye=yn;continue}const ve=et.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(ve){const Be=ve[1],je=String(ve[2]??"").trim(),Mt=String(ve[3]??"").trim(),Ze=String(ve[4]??"1").trim();Hs=dt.lineNo;const rs=To(je,`for_start_${Be}`),yn=To(Mt,`for_end_${Be}`),Qn=To(Ze,`for_step_${Be}`),wn=Ga(W,ye+1,dt.indent,[...U,Be]);wn.nextIdx===ye+1&&e.push({message:"for-loop requires an indented body",line:dt.lineNo}),ce.push({kind:"for",lineNo:dt.lineNo,varName:Be,startExpr:rs,endExpr:yn,stepExpr:Qn,body:wn.ops}),ye=wn.nextIdx;continue}const Fe=et.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(Fe){const Be=String(Fe[1]??Fe[2]??"").trim();Hs=dt.lineNo;const je=To(Be,"while_cond"),Mt=Ga(W,ye+1,dt.indent,U);Mt.nextIdx===ye+1&&e.push({message:"while-loop requires an indented body",line:dt.lineNo}),ce.push({kind:"while",lineNo:dt.lineNo,condExpr:je,body:Mt.ops}),ye=Mt.nextIdx;continue}const ot=et.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(ot){const Be=String(ot[1]||"").toLowerCase(),je=Kr(ot[2]||""),Mt=String(je[0]||"").trim(),Ze=wt(Mt);if(!Mt){e.push({message:`array.${Be} requires array name`,line:dt.lineNo}),ye+=1;continue}if(!!nt[Ze]||((Qe=Je[Ze])==null?void 0:Qe.kind)==="string"){e.push({message:`array.${Be} on string arrays is not supported inside loops`,line:dt.lineNo}),ye+=1;continue}if(!Je[Ze]&&!ut[Ze]){e.push({message:`array.${Be} unknown array "${Mt}"`,line:dt.lineNo}),ye+=1;continue}if(!Je[Ze]&&ut[Ze]&&Vo(Ze,ut[Ze].length,ut[Ze]),Be==="push"||Be==="unshift"||Be==="insert"){const wn=Je[Ze];if(wn){const xo=Math.min(Tn,Math.max(wn.capacity,wn.size+po));aa(Ze,xo)}}if(Be==="resize"){const wn=Je[Ze];if(wn){const xo=String(je[1]||"0"),hi=fs(xo);if(hi!=null){const Ln=Math.min(Tn,Math.max(wn.capacity,Math.floor(hi)));aa(Ze,Ln)}}}Al(Ze);const yn={};Be==="push"||Be==="unshift"?yn.value=je[1]:Be==="insert"?(yn.index=je[1],yn.value=je[2]):Be==="remove"?yn.index=je[1]:Be==="resize"&&(yn.size=je[1]);const Qn=sa(Ze,Be,yn,dt.lineNo);if(!Qn){ye+=1;continue}Qn.forEach(wn=>{ce.push({kind:"assign",name:wn.name,op:wn.op,expr:wn.rhs,lineNo:wn.lineNo})}),ye+=1;continue}const tt=et.match(/^array\.set\s*\((.*)\)\s*$/i);if(tt){const Be=Kr(tt[1]||""),je=String(Be[0]||"").trim(),Mt=String(Be[1]||"").trim(),Ze=String(Be[2]||"").trim();if(!je||!Mt||!Ze){e.push({message:"array.set(name, index, value) requires 3 args",line:dt.lineNo}),ye+=1;continue}const rs=wt(je);if(!Je[rs]&&!ut[rs]&&!nt[rs]){e.push({message:`array.set unknown array "${je}"`,line:dt.lineNo}),ye+=1;continue}if(nt[rs]){e.push({message:"array.set on string arrays is not supported inside loops",line:dt.lineNo}),ye+=1;continue}!Je[rs]&&ut[rs]&&Vo(rs,ut[rs].length,ut[rs]);const yn=To(Mt,`${rs}_idx`),Qn=zi(yn),wn=To(Ze,`${rs}_set`),xo=(Ue=Je[rs])==null?void 0:Ue.sizeSeries,hi=xo!=null?`(${Qn}) >= 0 and (${Qn}) < ${xo}`:void 0,Ln=Gc(rs,Qn,wn,hi);if(!Ln){e.push({message:"array.set index must be within array size",line:dt.lineNo}),ye+=1;continue}Ln.forEach((pl,vn)=>{ce.push({kind:"assign",name:Cn(rs,vn),op:":=",expr:pl,lineNo:dt.lineNo})}),ye+=1;continue}const St=et.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(St){const Be=St[3];if(G(Be)){e.push({message:`Loop variable "${Be}" is read-only`,line:dt.lineNo}),ye+=1;continue}const je=St[4],Mt=String(St[5]||"").trim();Hs=dt.lineNo;const Ze=To(Mt,Be);ce.push({kind:"assign",name:Be,op:je,expr:Ze,lineNo:dt.lineNo}),ye+=1;continue}e.push({message:`Unsupported statement inside loop: ${dt.text}`,line:dt.lineNo}),ye+=1}return{ops:ce,nextIdx:ye}},nf=(W,Q)=>{for(const O of W){if(O.kind==="assign"){Q.add(O.name);continue}if(O.kind==="if"){O.branches.forEach(U=>nf(U.body,Q));continue}(O.kind==="for"||O.kind==="while")&&nf(O.body,Q)}},Sd=W=>{const Q=W.qty_percent??W.qtyPct??W.qtyPctVal??W.qtyPercent,O=Q!=null?Number(Q):void 0,U=W.qty??W.quantity,ce=W.cash??W.cashQty??W.cash_qty,G=W.oco??W.oca_name??W.ocaName??W.oca,ye=G?Er(String(G)):void 0,Qe=W.expiresBars!=null?Number(W.expiresBars):void 0,Ue=W.commission??W.commissionPct??W.commission_pct,dt=W.slippage??W.slippagePct??W.slippage_pct,et=W.stop??W.stopPrice,B=W.limit??W.limitPrice,ve=W.price,Fe=(yn,Qn)=>{if(yn==null)return null;const wn=To(String(yn),Qn);if(!wn)return null;const xo=wn.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(xo)return xo[0];const hi=Dh(Er(wn));return hi!=null?String(hi):Su(wn,Qn)},ot=Fe(et,"order_stop"),tt=Fe(B,"order_limit"),St=Fe(ve,"order_price"),Be=Fe(U,"order_qty"),je=Fe(ce,"order_cash"),Mt=Ue!=null?Dh(Er(String(Ue))):null,Ze=dt!=null?Dh(Er(String(dt))):null,rs={};return typeof O=="number"&&Number.isFinite(O)&&(rs.qtyPct=O),Be&&(rs.qty=Be),je&&(rs.cash=je),ye&&(rs.oco=ye),typeof Qe=="number"&&Number.isFinite(Qe)&&(rs.expiresBars=Qe),Mt!=null&&Number.isFinite(Mt)&&(rs.commissionPct=Mt),Ze!=null&&Number.isFinite(Ze)&&(rs.slippagePct=Ze),ot&&tt?(rs.kind="stop_limit",rs.stopPrice=ot,rs.limitPrice=tt,rs):tt?(rs.kind="limit",rs.price=tt,rs):ot?(rs.kind="stop",rs.price=ot,rs):St?(rs.kind="market",rs):Object.keys(rs).length?{kind:"market",...rs}:null},wp=W=>{const Q=G=>{let ye=null,Qe=0;const Ue=ot=>/[A-Za-z0-9_$]/.test(ot),dt=G.toLowerCase(),et=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let B=null;for(let ot=0;ot<G.length;ot++){const tt=G[ot];if(ye){tt===ye&&G[ot-1]!=="\\"&&(ye=null);continue}if(tt==="'"||tt==='"'){ye=tt;continue}if(tt==="("){Qe+=1;continue}if(tt===")"){Qe=Math.max(0,Qe-1);continue}if(!(Qe>0)&&!(ot>0&&Ue(G[ot-1])))for(const St of et){if(!dt.startsWith(St.token,ot))continue;const Be=ot+St.token.length;if(Be<G.length&&Ue(G[Be]))continue;let je=Be;for(;je<G.length&&/\s/.test(G[je]);)je+=1;const Mt=G[je];if(!(Mt!=="="&&Mt!==":")){B={key:St.key,start:ot,valueStart:je+1};break}}}if(!B)return null;const ve=G.slice(0,B.start).replace(/[,;]+\s*$/,"").trim(),Fe=G.slice(B.valueStart).trim();return{key:B.key,when:ve,value:Fe}};let O=W.trim(),U,ce;for(let G=0;G<4;G++){const ye=Q(O);if(!ye)break;O=ye.when,ye.key==="score"&&U==null&&(U=ye.value),ye.key==="cooldown"&&ce==null&&(ce=ye.value)}return{when:O.trim(),scoreRaw:U,cooldownRaw:ce}},ac=(W,Q,O)=>{if(W==null)return;const U=To(String(W),O),ce=Mn(U);if(ce==null||!Number.isFinite(ce)){e.push({message:"score must be an integer between 0 and 10",line:Q});return}if(!Number.isInteger(ce)){e.push({message:"score must be an integer between 0 and 10",line:Q});return}if(ce<0||ce>10){e.push({message:"score must be in range 0..10",line:Q});return}return ce},Ld=(W,Q,O)=>{if(W==null)return;const U=To(String(W),O),ce=Mn(U);if(ce==null||!Number.isFinite(ce)){e.push({message:"cooldown must be a non-negative integer",line:Q});return}if(!Number.isInteger(ce)){e.push({message:"cooldown must be a non-negative integer",line:Q});return}if(ce<0){e.push({message:"cooldown must be a non-negative integer",line:Q});return}return ce},Cu=(W,Q,O)=>{const U=W.cooldown??W.cooldownBars??W.cooldown_bars??W.cooldownbars;return U==null?{value:void 0,hadRaw:!1}:{value:Ld(String(U),Q,O),hadRaw:!0}};for(let W=0;W<L.length;W++){const Q=L[W],O=Q.lineNo;Hs=O;let U=Q.text.trim();if(!U||U.startsWith("//@pine_fn")||U.startsWith("//@pine_loop")||(/^\s*export\s+/i.test(U)&&(U=X(U),L[W]={...Q,text:U}),U.match(/^import\s+(.+?)(?:\s+as\s+([A-Za-z_$][A-Za-z0-9_$]*))?\s*$/i))||U.match(/^library\s*\((.*)\)\s*$/i))continue;const ye=U.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*switch\s*(?:\((.*)\)|(.*))$/i);if(ye){const Ks=ye[3],Ct=U.includes(":=")?":=":"=",xn=String(ye[4]??ye[5]??"").trim(),As=Q.indent,gn=[];let Sn=W+1;for(;Sn<L.length&&L[Sn].indent>As;){const si=L[Sn].text.trim(),Gn=si.indexOf("=>");if(Gn>=0){const Uo=si.slice(0,Gn).trim(),oo=si.slice(Gn+2).trim();gn.push({cond:Uo||void 0,expr:oo||void 0,lineNo:L[Sn].lineNo})}Sn+=1}if(!gn.length){e.push({message:"switch requires at least one case",line:O});continue}const Yn=xn?To(xn,`switch_${Ks}`):"";let _o="na";for(let si=gn.length-1;si>=0;si--){const Gn=gn[si],Uo=Gn.expr?To(Gn.expr,`switch_${Ks}_case`):"na";if(!Gn.cond){_o=Uo;continue}_o=`iff(${Yn?`(${Yn}) == (${To(Gn.cond,`switch_${Ks}_cond`)})`:`(${To(Gn.cond,`switch_${Ks}_cond`)})`}, ${Uo}, ${_o})`}L.splice(W,Sn-W,{text:`${Ks} ${Ct} ${_o}`,indent:As,lineNo:O}),W-=1;continue}const Qe=U.match(/^switch\s*(?:\((.*)\)|(.*))$/i);if(Qe){const Ks=String(Qe[1]??Qe[2]??"").trim(),Ct=Q.indent,xn=[];let As=W+1;for(;As<L.length&&L[As].indent>Ct;){const Yn=L[As].text.trim(),_o=Yn.indexOf("=>");if(_o>=0){const si=Yn.slice(0,_o).trim(),Gn=Yn.slice(_o+2).trim();xn.push({cond:si||void 0,expr:Gn||void 0,lineNo:L[As].lineNo})}As+=1}if(!xn.length){e.push({message:"switch requires at least one case",line:O});continue}const gn=Ks?To(Ks,"switch_expr"):"",Sn=[];xn.forEach((Yn,_o)=>{if(Yn.expr){if(!Yn.cond)Sn.push({text:"else",indent:Ct,lineNo:Yn.lineNo});else if(_o===0){const si=gn?`(${gn}) == (${To(Yn.cond,"switch_cond")})`:`(${To(Yn.cond,"switch_cond")})`;Sn.push({text:`if (${si})`,indent:Ct,lineNo:Yn.lineNo})}else{const si=gn?`(${gn}) == (${To(Yn.cond,"switch_cond")})`:`(${To(Yn.cond,"switch_cond")})`;Sn.push({text:`else if (${si})`,indent:Ct,lineNo:Yn.lineNo})}Sn.push({text:Yn.expr,indent:Ct+1,lineNo:Yn.lineNo})}}),L.splice(W,As-W,...Sn),W-=1;continue}const Ue=U.match(/^for\s+([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+?)\s+to\s+(.+?)(?:\s+by\s+(.+))?$/i);if(Ue){const Ks=Ue[1],Ct=String(Ue[2]??"").trim(),xn=String(Ue[3]??"").trim(),As=String(Ue[4]??"1").trim(),gn=Q.indent,Sn=Ga(L,W+1,gn,[Ks]);if(Sn.nextIdx===W+1){e.push({message:"for-loop requires an indented body",line:O});continue}const Yn=`__loop_${++Yf}`;Hs=O;const _o={id:Yn,kind:"for",lineNo:O,varName:Ks,startExpr:To(Ct,`for_start_${Ks}`),endExpr:To(xn,`for_end_${Ks}`),stepExpr:To(As,`for_step_${Ks}`),body:Sn.ops};yu.push(_o);const si=new Set;nf(_o.body,si);const Gn=Array.from(si).filter(Uo=>!wt(Uo).startsWith("__arr_"));Gn.forEach(Uo=>{Me.push({name:Uo,updateExpr:`__loop_exec("${Yn}", "${Uo}")`})}),Gn.length||Me.push({name:`__loop_exec_${Yn}`,updateExpr:`__loop_exec("${Yn}")`});for(let Uo=W;Uo<Sn.nextIdx;Uo++)L[Uo]={...L[Uo],text:"//@pine_loop"};W=Sn.nextIdx-1;continue}const dt=U.match(/^while\s*(?:\((.*)\)|(.*))$/i);if(dt){const Ks=String(dt[1]??dt[2]??"").trim();if(!Ks){e.push({message:"while statement missing condition",line:O});continue}const Ct=Q.indent,xn=Ga(L,W+1,Ct,[]);if(xn.nextIdx===W+1){e.push({message:"while-loop requires an indented body",line:O});continue}const As=`__loop_${++Yf}`;Hs=O;const gn={id:As,kind:"while",lineNo:O,condExpr:To(Ks,"while_cond"),body:xn.ops};yu.push(gn);const Sn=new Set;nf(gn.body,Sn);const Yn=Array.from(Sn).filter(_o=>!wt(_o).startsWith("__arr_"));Yn.forEach(_o=>{Me.push({name:_o,updateExpr:`__loop_exec("${As}", "${_o}")`})}),Yn.length||Me.push({name:`__loop_exec_${As}`,updateExpr:`__loop_exec("${As}")`});for(let _o=W;_o<xn.nextIdx;_o++)L[_o]={...L[_o],text:"//@pine_loop"};W=xn.nextIdx-1;continue}const et=U.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(et){const Ks=String(et[1]??et[2]??"").trim();if(!Ks){e.push({message:"if statement missing condition",line:O});continue}const Ct=Q.indent,xn=hn=>{const uo=[];let tr=hn;for(;tr<L.length&&L[tr].indent>Ct;)L[tr].text.startsWith("//@pine_fn")||uo.push(L[tr]),tr+=1;return{body:uo,nextIdx:tr}},As=[],gn=xn(W+1);if(!gn.body.length){e.push({message:"if statement requires an indented body",line:O});continue}As.push({condRaw:Ks,body:gn.body,lineNo:O});let Sn=gn.nextIdx;for(;Sn<L.length&&L[Sn].indent===Ct;){const hn=L[Sn].text.trim(),uo=hn.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(uo){const Pr=String(uo[1]??uo[2]??"").trim();if(!Pr){e.push({message:"else if missing condition",line:L[Sn].lineNo});break}const Mr=xn(Sn+1);if(!Mr.body.length){e.push({message:"else if requires an indented body",line:L[Sn].lineNo});break}As.push({condRaw:Pr,body:Mr.body,lineNo:L[Sn].lineNo}),Sn=Mr.nextIdx;continue}if(hn.match(/^else$/i)){const Pr=xn(Sn+1);if(!Pr.body.length){e.push({message:"else requires an indented body",line:L[Sn].lineNo});break}As.push({condRaw:void 0,body:Pr.body,lineNo:L[Sn].lineNo}),Sn=Pr.nextIdx;break}break}const Yn=[],_o=[];As.forEach((hn,uo)=>{if(!hn.condRaw){Yn.push(null),_o.push(null);return}const tr=To(hn.condRaw,`if_${uo+1}`);Yn.push(ku(tr)),_o.push(Qu(k_(tr)))});const si=(hn,uo)=>{const tr=hn.slice(0,uo).filter(Boolean);return tr.length?tr.map(Pr=>`(${Pr})`).join(" or "):""},Gn=hn=>{const uo=Yn[hn],tr=si(Yn,hn);return uo?tr?`((${uo}) and not (${tr}))`:`(${uo})`:tr?`not (${tr})`:"1"},Uo=hn=>{const uo=_o[hn],tr=si(_o,hn);return uo?tr?`((${uo}) and not (${tr}))`:`(${uo})`:tr?`not (${tr})`:"1"},oo=(hn,uo)=>{var Kf,Pu;const tr=hn.match(/^array\.set\s*\((.*)\)\s*$/i);if(tr){const ld=Kr(tr[1]||""),iu=String(ld[0]||"").trim(),Ed=String(ld[1]||"").trim(),Du=String(ld[2]||"").trim();if(!iu||!Ed||!Du)return e.push({message:"array.set(name, index, value) requires 3 args",line:uo}),null;const kf=wt(iu),$d=ut[kf],Bf=Je[kf];if(!$d&&!Bf)return e.push({message:`array.set unknown array "${iu}"`,line:uo}),null;const Di=Zr(kf,Ed);if(Di!=null){const sc=(Bf==null?void 0:Bf.size)??($d==null?void 0:$d.length)??Di+1;Vo(kf,sc,$d);const Xf=To(Du,`${kf}_${Di}`),ch=fs(Xf);return $d&&ch!=null&&($d[Di]=ch),[{name:Cn(kf,Di),hasVar:!1,declaredType:"",op:":=",rhs:Xf,lineNo:uo}]}const bh=To(Ed,`${kf}_idx`),rf=zi(bh),Xe=To(Du,`${kf}_set`),Dp=(Kf=Je[kf])==null?void 0:Kf.sizeSeries,nm=Dp!=null?`(${rf}) >= 0 and (${rf}) < ${Dp}`:void 0,Sp=Gc(kf,rf,Xe,nm);return Sp?Sp.map((sc,Xf)=>({name:Cn(kf,Xf),hasVar:!1,declaredType:"",op:":=",rhs:sc,lineNo:uo})):(e.push({message:"array.set index must be within array size",line:uo}),null)}const Pr=hn.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Pr){const ld=String(Pr[1]||"").toLowerCase(),iu=Kr(Pr[2]||""),Ed=String(iu[0]||"").trim(),Du=wt(Ed);if(!Ed)return e.push({message:`array.${ld} requires array name`,line:uo}),null;if(!Je[Du]&&!ut[Du])return e.push({message:`array.${ld} unknown array "${Ed}"`,line:uo}),null;!Je[Du]&&ut[Du]&&Vo(Du,ut[Du].length,ut[Du]);const kf=Je[Du];if(!kf)return null;if(ld==="push"||ld==="unshift"||ld==="insert"){const Di=Math.min(Tn,Math.max(kf.capacity,kf.size+po));aa(Du,Di)}if(ld==="resize"){const Di=String(iu[1]||"0"),bh=fs(Di);if(bh!=null){const rf=Math.min(Tn,Math.max(kf.capacity,Math.floor(bh)));aa(Du,rf)}}Al(Du);const $d={};ld==="push"||ld==="unshift"?$d.value=iu[1]:ld==="insert"?($d.index=iu[1],$d.value=iu[2]):ld==="remove"?$d.index=iu[1]:ld==="resize"&&($d.size=iu[1]);const Bf=sa(Du,ld,$d,uo);return Bf||null}const Mr=hn.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(!Mr)return null;const Or=String(Mr[5]||"").trim();if(/^(line|label|box|table|linefill)\.new\s*\(/i.test(Or)||/^table\.cell\s*\(/i.test(Or))return null;const ou=Or.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(ou){const ld=String(ou[1]||"").toLowerCase(),iu=Kr(ou[2]||""),Ed=String(iu[0]||"").trim(),Du=wt(Ed);if(!Ed)return e.push({message:`array.${ld} requires array name`,line:uo}),null;if(!Je[Du]&&!ut[Du])return e.push({message:`array.${ld} unknown array "${Ed}"`,line:uo}),null;if(!Je[Du]&&ut[Du]&&Vo(Du,ut[Du].length,ut[Du]),!Je[Du])return null;Al(Du);const $d=ld==="pop"?`array.size(${Ed}) - 1`:ld==="shift"?"0":String(iu[1]||"0"),Bf=To(`array.get(${Ed}, ${$d})`,Mr[3]||"array_pop"),Di=sa(Du,ld==="pop"?"pop":ld==="shift"?"shift":"remove",{index:iu[1]},uo);return Di?[{name:Mr[3],hasVar:!!Mr[1],declaredType:Mr[2]?String(Mr[2]).toLowerCase():"",op:Mr[4],rhs:Bf,lineNo:uo},...Di]:null}const md=Or.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(md){const ld=String(md[1]||"").toLowerCase(),iu=Kr(md[2]||""),Ed=wt(Mr[3]);if(ld==="copy"){const bh=String(iu[0]||"").trim(),rf=wt(bh);if(!bh)return e.push({message:"array.copy requires source array name",line:uo}),null;if(nt[rf])return nt[Ed]=[...nt[rf]],no(Ed),[];if(!Je[rf]&&!ut[rf])return e.push({message:`array.copy unknown array "${bh}"`,line:uo}),null;!Je[rf]&&ut[rf]&&Vo(rf,ut[rf].length,ut[rf]);const Xe=Vc(Ed,rf,uo);return Xe?((Pu=Je[rf])!=null&&Pu.dynamic&&Je[Ed]&&(Je[Ed].dynamic=!0),Xe):null}const Du=String(iu[0]||"").trim(),kf=String(iu[1]||"").trim(),$d=wt(Du),Bf=wt(kf);if(!Du||!kf)return e.push({message:"array.concat requires two arrays",line:uo}),null;if(nt[$d]||nt[Bf])return!nt[$d]||!nt[Bf]?(e.push({message:"array.concat string arrays must be same type",line:uo}),null):(nt[Ed]=[...nt[$d],...nt[Bf]],no(Ed),[]);if(!Je[$d]&&!ut[$d])return e.push({message:`array.concat unknown array "${Du}"`,line:uo}),null;if(!Je[Bf]&&!ut[Bf])return e.push({message:`array.concat unknown array "${kf}"`,line:uo}),null;!Je[$d]&&ut[$d]&&Vo($d,ut[$d].length,ut[$d]),!Je[Bf]&&ut[Bf]&&Vo(Bf,ut[Bf].length,ut[Bf]);const Di=vu(Ed,$d,Bf,uo);return Di||null}return[{name:Mr[3],hasVar:!!Mr[1],declaredType:Mr[2]?String(Mr[2]).toLowerCase():"",op:Mr[4],rhs:To(Or,Mr[3]),lineNo:uo}]},Si={},cc=[],bu=(hn,uo)=>{for(const tr of hn){const Pr=oo(tr.text,tr.lineNo);if(Pr){for(const Mr of Pr){const Or=wt(Mr.name),ou=Si[Or]||(Si[Or]={base:void 0,branches:new Array(As.length).fill(null)});ou.base||(ou.base=Mr),ou.branches[uo]=Mr}continue}cc.push({text:tr.text,lineNo:tr.lineNo,branchIndex:uo,indent:tr.indent})}};As.forEach((hn,uo)=>bu(hn.body,uo));const $l=(hn,uo)=>{let tr=!1;const Pr=hn.map(Mr=>tr||Eu(Mr)?Mr:(tr=!0,uo));return tr||Pr.unshift(uo),Pr},nu=(hn,uo,tr)=>{const Pr=uo.match(new RegExp(`^${hn}\\s*\\((.*)\\)\\s*$`,"i"));if(!Pr)return null;const Mr=Kr(Pr[1]||""),Or=Gn(tr),ou=Uo(tr);if(hn==="plot"){const Pu=Mr.find(iu=>!Eu(iu))||"",ld=`iff(${Or}, ${Pu||"na"}, na)`;return`${hn}(${$l(Mr,ld).join(", ")})`}const md=Mr.find(Pu=>!Eu(Pu))||"",Kf=md?`${ou} and (${md})`:ou;return`${hn}(${$l(Mr,Kf).join(", ")})`},$r=(hn,uo)=>{const tr=hn.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)$/i);if(!tr)return null;const Pr=tr[1],Mr=String(tr[2]||"").trim(),Or=Uo(uo),ou=Mr?`${Or} and (${Mr})`:Or;return`signal ${Pr} when ${ou}`},$a=(hn,uo)=>{const tr=hn.match(/^(strategy\.(entry|exit|close|close_all|order|cancel|cancel_all))\s*\((.*)\)\s*$/i);if(!tr)return null;const Pr=tr[1],Mr=Kr(tr[3]||""),Or=Uo(uo);let ou=!1;const md=Mr.map(Kf=>/^\s*when\s*=/.test(Kf)?(ou=!0,`when=${Or} and (${Kf.replace(/^\s*when\s*=\s*/i,"")})`):Kf);return ou||md.push(`when=${Or}`),`${Pr}(${md.join(", ")})`},wa=(hn,uo,tr)=>{const Pr=uo.match(new RegExp(`^(?:varip\\s+|var\\s+)?(?:(?:float|int|bool|string|line|label|box|table|linefill)\\s+)?[A-Za-z_$][A-Za-z0-9_$]*\\s*(?::=|=)\\s*${hn}\\s*\\((.*)\\)\\s*$`,"i")),Mr=uo.match(new RegExp(`^${hn}\\s*\\((.*)\\)\\s*$`,"i"));if(!Pr&&!Mr)return null;const Or=Kr(((Pr==null?void 0:Pr[1])||(Mr==null?void 0:Mr[1]))??""),ou=Uo(tr);let md=!1;const Kf=Or.map(Pu=>/^\s*when\s*=/.test(Pu)?(md=!0,`when=${ou} and (${Pu.replace(/^\s*when\s*=\s*/i,"")})`):Pu);return md||Kf.push(`when=${ou}`),`${hn}(${Kf.join(", ")})`},yc=(hn,uo)=>{const tr=hn.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(!tr)return null;const Pr=`${String(tr[1]).toLowerCase()}.${String(tr[2]).toLowerCase()}`,Mr=Kr(tr[3]||""),Or=Uo(uo);let ou=!1;const md=Mr.map(Kf=>/^\s*when\s*=/.test(Kf)?(ou=!0,`when=${Or} and (${Kf.replace(/^\s*when\s*=\s*/i,"")})`):Kf);return ou||md.push(`when=${Or}`),`${Pr}(${md.join(", ")})`},ti=[],fi=(hn,uo,tr)=>ti.push({text:hn,indent:tr??Ct,lineNo:uo,loopSeq:!!Q.loopSeq});Object.values(Si).forEach(hn=>{var Pu,ld;const uo=hn.base;if(!uo)return;const tr=!!hn.branches.some(iu=>iu==null?void 0:iu.hasVar),Pr=((Pu=hn.branches.find(iu=>iu==null?void 0:iu.declaredType))==null?void 0:Pu.declaredType)||"",Mr=((ld=hn.branches.find(iu=>iu==null?void 0:iu.op))==null?void 0:ld.op)||"=",Or=Mr===":="?uo.name:"na",ou=iu=>{for(let Ed=iu;Ed<As.length;Ed++){const Du=hn.branches[Ed];if(!Du)continue;const kf=Yn[Ed],$d=ou(Ed+1);return kf?`iff(${kf}, ${Du.rhs}, ${$d})`:Du.rhs}return Or},md=ou(0),Kf=`${tr?"var ":""}${Pr?`${Pr} `:""}`;fi(`${Kf}${uo.name} ${Mr} ${md}`,uo.lineNo)});for(const hn of cc){const uo=hn.text.trim(),tr=Gn(hn.branchIndex);Uo(hn.branchIndex);const Pr=uo.match(/^if\s*(?:\((.*)\)|(.*))$/i);if(Pr){const ou=String(Pr[1]??Pr[2]??"").trim(),md=tr&&tr!=="1"?`(${tr}) and (${ou})`:ou;fi(`if (${md})`,hn.lineNo,hn.indent);continue}const Mr=uo.match(/^else\s+if\s*(?:\((.*)\)|(.*))$/i);if(Mr){const ou=String(Mr[1]??Mr[2]??"").trim(),md=tr&&tr!=="1"?`(${tr}) and (${ou})`:ou;fi(`else if (${md})`,hn.lineNo,hn.indent);continue}if(/^else$/i.test(uo)){fi(tr&&tr!=="1"?`else if (${tr})`:"else",hn.lineNo,hn.indent);continue}const Or=nu("plot",hn.text,hn.branchIndex)||nu("plotshape",hn.text,hn.branchIndex)||nu("plotchar",hn.text,hn.branchIndex)||wa("line.new",hn.text,hn.branchIndex)||wa("linefill.new",hn.text,hn.branchIndex)||wa("label.new",hn.text,hn.branchIndex)||wa("box.new",hn.text,hn.branchIndex)||wa("polyline.new",hn.text,hn.branchIndex)||wa("polygon.new",hn.text,hn.branchIndex)||wa("path.new",hn.text,hn.branchIndex)||wa("table.cell",hn.text,hn.branchIndex)||yc(hn.text,hn.branchIndex)||$r(hn.text,hn.branchIndex)||$a(hn.text,hn.branchIndex);if(Or){fi(Or,hn.lineNo,hn.indent);continue}e.push({message:`Unsupported statement inside if: ${hn.text}`,line:hn.lineNo})}ti.length||t.push({message:"if statement produced no output",line:O}),L.splice(W,Sn-W,...ti),W-=1;continue}const B=U.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\((.*)\)\s*$/i);if(B){const Ks=wt(B[1]),Ct=Kr(B[2]||""),xn=[],As=[];let gn=!1,Sn=!1,Yn=!0;for(const _o of Ct){const si=String(_o||"").trim();if(si.startsWith('"')&&si.endsWith('"')||si.startsWith("'")&&si.endsWith("'")){As.push(Er(si)),gn=!0;continue}const Uo=To(si,`array_from_${Ks}`),oo=fs(Uo);if(oo==null){Yn=!1;break}xn.push(oo),Sn=!0}if(!Yn||!xn.length&&!As.length||gn&&Sn){e.push({message:"array.from(...) supports only all-numeric or all-string literals (compile-time)",line:O});continue}gn?(nt[Ks]=As,no(Ks),Rl(Ks,As.length,As)):(Vo(Ks,xn.length,xn),ut[Ks]=xn);continue}const ve=U.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(float|int|bool|string)\s*\((.*)\)\s*$/i);if(ve){const Ks=wt(ve[1]),Ct=String(ve[2]||"").toLowerCase(),xn=Kr(ve[3]||""),As=xn[0]??"0",gn=xn[1]??"0",Sn=fs(As);if(Sn==null||Sn<0){e.push({message:"array.new_* size must be a numeric constant or param",line:O});continue}if(Ct==="string"){let si="";const Gn=String(gn??"").trim();(Gn.startsWith('"')&&Gn.endsWith('"')||Gn.startsWith("'")&&Gn.endsWith("'"))&&(si=Er(Gn));const oo=new Array(Math.floor(Sn));for(let Si=0;Si<oo.length;Si++)oo[Si]=si;nt[Ks]=oo,no(Ks),Rl(Ks,oo.length,oo);continue}let Yn=fs(gn);if(Yn==null){const si=og(String(gn));si!=null&&(Yn=si?1:0)}Yn==null&&(Yn=0);const _o=new Array(Math.floor(Sn));for(let si=0;si<_o.length;si++)_o[si]=Yn;Vo(Ks,_o.length,_o);continue}const Fe=U.match(/^array\.(push|pop|shift|unshift|insert|remove|clear|resize)\s*\((.*)\)\s*$/i);if(Fe){const Ks=String(Fe[1]||"").toLowerCase(),Ct=Kr(Fe[2]||""),xn=String(Ct[0]||"").trim(),As=wt(xn);if(!xn){e.push({message:`array.${Ks} requires array name`,line:O});continue}if(!!nt[As]||((vt=Je[As])==null?void 0:vt.kind)==="string"){if(Ks!=="push"&&Ks!=="clear"){t.push({message:`array.${Ks} on string arrays is not supported yet (ignored)`,line:O});continue}if(!Je[As]){const Si=nt[As];Rl(As,(Si==null?void 0:Si.length)??0,Si)}let Gn=Je[As];if(!Gn)continue;if(Ks==="push"){const Si=Math.min(Tn,Math.max(Gn.capacity,Gn.size+po));if(tl(As,Si),Gn=Je[As],!Gn)continue}Al(As);const Uo=[];if(Ks==="push"){const Si=To(String(Ct[1]??"na"),`${As}_push`),cc=`__str_num(${Si})`,bu=Gn.sizeSeries,$l=`(${bu}) < ${Gn.capacity}`,nu=`__arr_str_valid(${Si})`,$r=`(${$l}) and (${nu})`,$a=Gc(As,bu,cc,$r);$a&&$a.forEach((wa,yc)=>{Uo.push({name:Cn(As,yc),hasVar:!1,declaredType:"",op:":=",rhs:wa,lineNo:O})}),Uo.push({name:bu,hasVar:!1,declaredType:"",op:":=",rhs:`iff(${$r}, min(${bu} + 1, ${Gn.capacity}), ${bu})`,lineNo:O})}else Ks==="clear"&&Uo.push({name:Gn.sizeSeries,hasVar:!1,declaredType:"",op:":=",rhs:"0",lineNo:O});const oo=Uo.map(Si=>({text:`${Si.name} ${Si.op} ${Si.rhs}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}));oo.length&&(L.splice(W,1,...oo),W-=1);continue}if(!Je[As]&&!ut[As]){e.push({message:`array.${Ks} unknown array "${xn}"`,line:O});continue}!Je[As]&&ut[As]&&Vo(As,ut[As].length,ut[As]);const Sn=Je[As];if(!Sn)continue;if(Ks==="push"||Ks==="unshift"||Ks==="insert"){const Gn=Math.min(Tn,Math.max(Sn.capacity,Sn.size+po));aa(As,Gn)}if(Ks==="resize"){const Gn=String(Ct[1]||"0"),Uo=fs(Gn);if(Uo!=null){const oo=Math.min(Tn,Math.max(Sn.capacity,Math.floor(Uo)));aa(As,oo)}}Al(As);const Yn={};Ks==="push"||Ks==="unshift"?Yn.value=Ct[1]:Ks==="insert"?(Yn.index=Ct[1],Yn.value=Ct[2]):Ks==="remove"?Yn.index=Ct[1]:Ks==="resize"&&(Yn.size=Ct[1]);const _o=sa(As,Ks,Yn,O);if(!_o)continue;const si=_o.map(Gn=>({text:`${Gn.name} ${Gn.op} ${Gn.rhs}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}));L.splice(W,1,...si),W-=1;continue}const ot=U.match(/^array\.set\s*\((.*)\)\s*$/i);if(ot){const Ks=Kr(ot[1]||""),Ct=String(Ks[0]||"").trim(),xn=String(Ks[1]||"").trim(),As=String(Ks[2]||"").trim();if(!Ct||!xn||!As){e.push({message:"array.set(name, index, value) requires 3 args",line:O});continue}const gn=wt(Ct),Sn=ut[gn],Yn=nt[gn],_o=Je[gn],si=!!Yn||(_o==null?void 0:_o.kind)==="string";if(!Sn&&!_o&&!Yn){e.push({message:`array.set unknown array "${Ct}"`,line:O});continue}if(si){Je[gn]||Rl(gn,(Yn==null?void 0:Yn.length)??0,Yn);const Uo=Je[gn];if(!Uo)continue;const oo=To(xn,`${gn}_idx`),cc=`__str_num(${To(As,`${gn}_set`)})`,bu=Uo.sizeSeries,$l=bu?`__arr_set_guard(${oo}, ${bu})`:void 0,nu=Gc(gn,oo,cc,$l,{normalizeIndex:!1});if(!nu){e.push({message:"array.set index must be within array size",line:O});continue}const $r=nu.map(($a,wa)=>({text:`${Cn(gn,wa)} := ${$a}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}));Al(gn),L.splice(W,1,...$r),W-=1;continue}const Gn=Zr(gn,xn);if(Gn!=null){const Uo=(_o==null?void 0:_o.size)??(Sn==null?void 0:Sn.length)??Gn+1;Vo(gn,Uo,Sn);const oo=To(As,`${gn}_${Gn}`),Si=fs(oo);Sn&&Si!=null&&(Sn[Gn]=Si),U=`${Cn(gn,Gn)} := ${oo}`}else{const Uo=To(xn,`${gn}_idx`),oo=zi(Uo),Si=To(As,`${gn}_set`),cc=(Bt=Je[gn])==null?void 0:Bt.sizeSeries,bu=cc!=null?`(${oo}) >= 0 and (${oo}) < ${cc}`:void 0,$l=Gc(gn,oo,Si,bu);if(!$l){e.push({message:"array.set index must be within array size",line:O});continue}const nu=$l.map(($r,$a)=>({text:`${Cn(gn,$a)} := ${$r}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}));L.splice(W,1,...nu),W-=1;continue}}{const Ks=U.match(/^\s*\[([^\]]+)\]\s*(:=|=)\s*(.+)$/);if(Ks){const Ct=Ks[1]||"",xn=Ks[2]||"=",gn=String(Ks[3]||"").trim().match(/^(?:ta\.)?(bbands|bollinger|macd|stoch|aroon|dmi|supertrend|keltner|kc|donchian|kdj|kst|vortex)\s*\((.*)\)\s*$/i);if(gn){const Sn=String(gn[1]||"").toLowerCase(),Yn=String(gn[2]||""),_o=Kr(Ct).map(oo=>oo.trim()).filter(Boolean),si=Sn==="stoch"||Sn==="aroon"||Sn==="supertrend"||Sn==="kst"||Sn==="vortex"?2:3;if(_o.length!==si){e.push({message:`${gn[1]}() assignment requires ${si} target${si===1?"":"s"}`,line:O});continue}const Gn=_o.find(oo=>oo!=="_"&&!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(oo));if(Gn){e.push({message:`Invalid assignment target "${Gn}"`,line:O});continue}const Uo=[];for(let oo=0;oo<_o.length;oo++){const Si=_o[oo];if(Si==="_")continue;const cc=Yn.trim()?`${Yn}, ${oo}`:String(oo);Uo.push({text:`${Si} ${xn} ${Sn}(${cc})`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq})}if(Uo.length){L.splice(W,1,...Uo),W-=1;continue}}}}const tt=U.match(/^(varip\s+|var\s+)?(?:(float|int|bool|string|line|label|box|table|linefill|polyline|polygon|path)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(:=|=)\s*(.+)$/i);if(tt){const Ks=!!tt[1],Ct=tt[2]?String(tt[2]).toLowerCase():"",xn=tt[3],As=tt[4],gn=String(tt[5]||"").trim(),Sn=gn.match(/^(line|label|box|table|linefill|polyline|polygon|path)\.new\s*\((.*)\)\s*$/i);if(Sn){const $r=String(Sn[1]||"").toLowerCase();if($r==="line"){vi(Sn[2]||"",O,xn,Ks);continue}if($r==="linefill"){mc(Sn[2]||"",O,xn,Ks);continue}if($r==="label"){_a(Sn[2]||"",O,xn,Ks);continue}if($r==="box"){dl(Sn[2]||"",O,xn,Ks);continue}if($r==="table"){ar(Sn[2]||"",O,xn,Ks);continue}if($r==="polyline"){Ui(Sn[2]||"",O,xn,Ks);continue}if($r==="polygon"){bl(Sn[2]||"",O,xn,Ks);continue}if($r==="path"){ba(Sn[2]||"",O,xn,Ks);continue}}const Yn=gn.match(/^table\.cell\s*\((.*)\)\s*$/i);if(Yn){Jr(Yn[1]||"",O);continue}const _o=gn.match(/^plot\s*\((.*)\)\s*$/i);if(_o){Af(_o[1]||"",O,xn);continue}const si=gn.match(/^array\.(pop|shift|remove)\s*\((.*)\)\s*$/i);if(si){const $r=String(si[1]||"").toLowerCase(),$a=Kr(si[2]||""),wa=String($a[0]||"").trim(),yc=wt(wa);if(!wa){e.push({message:`array.${$r} requires array name`,line:O});continue}if(!Je[yc]&&!ut[yc]){e.push({message:`array.${$r} unknown array "${wa}"`,line:O});continue}if(!Je[yc]&&ut[yc]&&Vo(yc,ut[yc].length,ut[yc]),!Je[yc])continue;Al(yc);const fi=$r==="pop"?`array.size(${wa}) - 1`:$r==="shift"?"0":String($a[1]||"0"),hn=To(`array.get(${wa}, ${fi})`,xn),uo=sa(yc,$r==="pop"?"pop":$r==="shift"?"shift":"remove",{index:$a[1]},O);if(!uo)continue;const Pr=[{text:`${`${Ks?"var ":""}${Ct?`${Ct} `:""}`}${xn} ${As} ${hn}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq},...uo.map(Mr=>({text:`${Mr.name} ${Mr.op} ${Mr.rhs}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}))];L.splice(W,1,...Pr),W-=1;continue}const Gn=gn.match(/^array\.(copy|concat)\s*\((.*)\)\s*$/i);if(Gn){const $r=String(Gn[1]||"").toLowerCase(),$a=Kr(Gn[2]||""),wa=wt(xn);if($r==="copy"){const Pr=String($a[0]||"").trim(),Mr=wt(Pr);if(!Pr){e.push({message:"array.copy requires source array name",line:O});continue}if(nt[Mr]){nt[wa]=[...nt[Mr]],no(wa),L.splice(W,1),W-=1;continue}if(!Je[Mr]&&!ut[Mr]){e.push({message:`array.copy unknown array "${Pr}"`,line:O});continue}!Je[Mr]&&ut[Mr]&&Vo(Mr,ut[Mr].length,ut[Mr]);const Or=Vc(wa,Mr,O);if(!Or)continue;(Xt=Je[Mr])!=null&&Xt.dynamic&&Je[wa]&&(Je[wa].dynamic=!0);const ou=Or.map(md=>({text:`${md.name} ${md.op} ${md.rhs}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}));L.splice(W,1,...ou),W-=1;continue}const yc=String($a[0]||"").trim(),ti=String($a[1]||"").trim(),fi=wt(yc),hn=wt(ti);if(!yc||!ti){e.push({message:"array.concat requires two arrays",line:O});continue}if(nt[fi]||nt[hn]){if(!nt[fi]||!nt[hn]){e.push({message:"array.concat string arrays must be same type",line:O});continue}nt[wa]=[...nt[fi],...nt[hn]],no(wa),L.splice(W,1),W-=1;continue}if(!Je[fi]&&!ut[fi]){e.push({message:`array.concat unknown array "${yc}"`,line:O});continue}if(!Je[hn]&&!ut[hn]){e.push({message:`array.concat unknown array "${ti}"`,line:O});continue}!Je[fi]&&ut[fi]&&Vo(fi,ut[fi].length,ut[fi]),!Je[hn]&&ut[hn]&&Vo(hn,ut[hn].length,ut[hn]);const uo=vu(wa,fi,hn,O);if(!uo)continue;const tr=uo.map(Pr=>({text:`${Pr.name} ${Pr.op} ${Pr.rhs}`,indent:Q.indent,lineNo:O,loopSeq:Q.loopSeq}));L.splice(W,1,...tr),W-=1;continue}if(As===":="){const $r=wt(xn);$r in kt||xn in kt||!!Ht[$r]||Te.some(wa=>wt(String((wa==null?void 0:wa.name)||""))===$r)||Me.some(wa=>wt(String((wa==null?void 0:wa.name)||""))===$r)||Oe.some(wa=>wt(String((wa==null?void 0:wa.name)||""))===$r)||t.push({message:`":=" used before "${xn}" is defined (use "=" for first assignment)`,line:O})}const Uo=v6(gn);if(Uo){Oe.push({name:xn,type:"security",symbol:Uo.symbol,country:Uo.country,timeframe:Uo.timeframe,expr:Uo.expr,lookahead:Uo.lookahead,gaps:Uo.gaps,lower:Uo.lower});continue}const oo=To(gn,xn);if(!xn.startsWith("__arr_")&&$u(xn,oo,O))continue;if(Et(oo)&&(Ht[xn.replace(/\s+/g,"_").toLowerCase()]=k_(oo)),(Ks||As===":=")&&Ct!=="bool"&&Ct!=="string"){const $r=wt(xn),$a=$r.startsWith("__arr_"),yc=(()=>{const fi=De[$r];if(typeof fi=="number")return fi;const hn=Me.length;return De[$r]=hn,Me.push({name:xn,initExpr:void 0,updateExpr:xn,selfMode:$a?"current":void 0}),hn})();if(As===":="){const fi=wt(xn),hn=Object.prototype.hasOwnProperty.call(kt,xn)?xn:Object.prototype.hasOwnProperty.call(kt,fi)?fi:null;if(hn&&Me[yc]&&!Me[yc].initExpr){const uo=kt[hn];if(typeof uo=="number"&&Number.isFinite(uo))Me[yc].initExpr=String(uo),delete kt[hn];else if(typeof uo=="string"){const tr=Number(uo);Number.isFinite(tr)&&(Me[yc].initExpr=String(tr),delete kt[hn])}}}if(($a||!!Q.loopSeq)&&As===":="&&typeof De[$r]=="number"){Me.push({name:xn,initExpr:void 0,updateExpr:oo,selfMode:"current"});continue}if(Ks&&As==="="){Me[yc].initExpr=oo;continue}if(Ks&&As===":="){Me[yc].initExpr=oo,Me[yc].updateExpr=oo;continue}Me[yc].updateExpr=oo;continue}const $l=Dh(oo);if($l!=null){kt[xn]=$l;continue}const nu=og(oo);if(nu!=null){kt[xn]=nu;continue}if(oo.startsWith('"')&&oo.endsWith('"')||oo.startsWith("'")&&oo.endsWith("'")){kt[xn]=Er(oo);continue}Te.push({name:xn,expr:oo});continue}const St=U.match(/^strategy\s*\((.*)\)\s*$/i);if(St){const Ks=Kr(St[1]||""),Ct=qc(Ks),xn=Ft&&typeof Ft=="object"?{...Ft}:null,As=(...Gn)=>{for(const Uo of Gn){if(Ct[Uo]==null)continue;const oo=Er(String(Ct[Uo])),Si=Dh(oo);if(Si!=null)return Si}},gn=(...Gn)=>{for(const Uo of Gn){if(Ct[Uo]==null)continue;const oo=Er(String(Ct[Uo])),Si=Dh(oo);return Si??oo}},Sn=(...Gn)=>{for(const Uo of Gn)if(Ct[Uo]!=null)return Er(String(Ct[Uo]))},Yn=Er(String(Ct.default_qty_type??Ct.default_qty_type??"")).toLowerCase(),_o=Number(Ct.default_qty_value??Ct.default_qty_value??NaN),si=Yn==="cash"?{type:"cash",value:Number.isFinite(_o)?_o:1e4}:Yn==="qty"?{type:"qty",value:Number.isFinite(_o)?_o:1}:{type:"percent_of_equity",value:Number.isFinite(_o)?_o:100};if(Ft={initialCapital:As("initial_capital","initialCapital")??1e4,from:gn("from","start","startDate","dateFrom","rangeStart"),to:gn("to","end","endDate","dateTo","rangeEnd"),session:Sn("session","tradingSession","sessionTime"),orderSize:si,commissionPct:As("commissionPct","commission")??0,slippagePct:As("slippagePct","slippage")??0,spreadPct:As("spreadPct","spread_pct","spread")??(As("spreadBps","spread_bps")!=null?As("spreadBps","spread_bps")/100:void 0),leverage:As("leverage","lev","marginLeverage","margin_leverage")??void 0,maintenanceMarginPct:As("maintenanceMarginPct","maintenance_margin_pct","maintMarginPct")??void 0,liquidationFeePct:As("liquidationFeePct","liquidation_fee_pct","liqFeePct")??void 0,borrowPctPerYear:As("borrowPctPerYear","borrow_pct_per_year","shortBorrowPctPerYear")??void 0,fundingPctPerDay:As("fundingPctPerDay","funding_pct_per_day","funding")??void 0,positionMode:(()=>{const Gn=Er(String(Ct.positionMode??Ct.position_mode??"")).toLowerCase();if(Gn)return Gn.includes("hedge")?"hedging":"netting"})()??void 0,closeMethod:(()=>{const Gn=Er(String(Ct.closeMethod??Ct.close_method??Ct.costBasis??Ct.cost_basis??"")).toLowerCase();if(Gn)return Gn.includes("lifo")?"lifo":Gn.includes("avg")||Gn.includes("average")?"avg":"fifo"})()??void 0,priceTick:As("priceTick","price_tick","tickSize","tick_size","tick","minTick","min_tick")??void 0,qtyStep:As("qtyStep","qty_step","quantityStep","quantity_step","lotStep","lot_step")??void 0,minQty:As("minQty","min_qty","minimumQty","minimum_qty")??void 0,pyramiding:As("pyramiding")??1,execution:Er(String(Ct.execution??"intrabar_ohlc")),intrabarTieBreak:Er(String(Ct.intrabarTieBreak??"worst_case")),ohlcPath:Er(String(Ct.ohlcPath??"open_high_low_close")),allowShort:og(String(Ct.allowShort??""))??void 0,allowLong:og(String(Ct.allowLong??""))??void 0},xn){const Gn=["maxDrawdownPct","maxDrawdownCash","maxPositionPct","maxPositionCash","maxPositionQty","maxIntradayFilledOrders","maxIntradayLossPct","maxIntradayLossCash"];for(const Uo of Gn)xn[Uo]!=null&&(Ft[Uo]=xn[Uo])}continue}const Be=U.match(/^strategy\.risk\.([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Be){const Ks=String(Be[1]||"").trim().toLowerCase(),Ct=Kr(Be[2]||""),xn=qc(Ct),As=Ct.filter(Si=>!Eu(Si)),gn=xn.value??xn.max??xn.size??As[0],Sn=xn.type??xn.qty_type??xn.qtyType??xn.position_type??As[1],Yn=gn!=null?Dh(Er(String(gn))):null;if(Yn==null||!Number.isFinite(Yn)){e.push({message:`strategy.risk.${Ks}(...) requires numeric value`,line:O});continue}const _o=Sn!=null?Er(String(Sn)).toLowerCase():"",si=_o.includes("percent")||_o.includes("equity"),Gn=_o.includes("cash")||_o.includes("currency")||_o.includes("fixed"),Uo=_o.includes("qty")||_o.includes("contract"),oo=si?"percent":Gn?"cash":Uo?"qty":"percent";if((!Ft||typeof Ft!="object")&&(Ft={enabled:!0}),Ks==="max_drawdown"||Ks==="max_drawdown_percent"){oo==="cash"?Ft.maxDrawdownCash=Yn:Ft.maxDrawdownPct=Yn;continue}if(Ks==="max_position_size"||Ks==="max_position"||Ks==="max_position_size_contracts"){oo==="cash"?Ft.maxPositionCash=Yn:oo==="qty"?Ft.maxPositionQty=Yn:Ft.maxPositionPct=Yn;continue}if(Ks==="max_intraday_filled_orders"||Ks==="max_intraday_orders"){Ft.maxIntradayFilledOrders=Math.max(0,Math.floor(Yn));continue}if(Ks==="max_intraday_loss"||Ks==="max_daily_loss"){oo==="cash"?Ft.maxIntradayLossCash=Yn:Ft.maxIntradayLossPct=Yn;continue}t.push({message:`Ignored strategy.risk method: ${Ks}`,line:O});continue}if(U.match(/^(indicator|study)\s*\((.*)\)\s*$/i))continue;const Mt=U.match(/^line\.new\s*\((.*)\)\s*$/i);if(Mt){vi(Mt[1]||"",O);continue}const Ze=U.match(/^linefill\.new\s*\((.*)\)\s*$/i);if(Ze){mc(Ze[1]||"",O);continue}const rs=U.match(/^label\.new\s*\((.*)\)\s*$/i);if(rs){_a(rs[1]||"",O);continue}const yn=U.match(/^box\.new\s*\((.*)\)\s*$/i);if(yn){dl(yn[1]||"",O);continue}const Qn=U.match(/^polyline\.new\s*\((.*)\)\s*$/i);if(Qn){Ui(Qn[1]||"",O);continue}const wn=U.match(/^polygon\.new\s*\((.*)\)\s*$/i);if(wn){bl(wn[1]||"",O);continue}const xo=U.match(/^path\.new\s*\((.*)\)\s*$/i);if(xo){ba(xo[1]||"",O);continue}const hi=U.match(/^table\.new\s*\((.*)\)\s*$/i);if(hi){ar(hi[1]||"",O);continue}const Ln=U.match(/^table\.clear\s*\((.*)\)\s*$/i);if(Ln){zl(Ln[1]||"",O);continue}const pl=U.match(/^table\.merge(?:_cells)?\s*\((.*)\)\s*$/i);if(pl){Fd(pl[1]||"",O);continue}const vn=U.match(/^table\.cell\s*\((.*)\)\s*$/i);if(vn){Jr(vn[1]||"",O);continue}const mo=U.match(/^line\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(mo){nl(mo[1]||"",mo[2]||"",O);continue}const Gi=U.match(/^line\.delete\s*\((.*)\)\s*$/i);if(Gi){tc(Gi[1]||"");continue}const La=U.match(/^polyline\.set\s*\((.*)\)\s*$/i);if(La){Ol(La[1]||"",O);continue}const lc=U.match(/^polyline\.delete\s*\((.*)\)\s*$/i);if(lc){fl(lc[1]||"");continue}const wl=U.match(/^polygon\.set\s*\((.*)\)\s*$/i);if(wl){Ua(wl[1]||"",O);continue}const mf=U.match(/^polygon\.delete\s*\((.*)\)\s*$/i);if(mf){er(mf[1]||"");continue}const mp=U.match(/^path\.set\s*\((.*)\)\s*$/i);if(mp){ol(mp[1]||"",O);continue}const _c=U.match(/^path\.delete\s*\((.*)\)\s*$/i);if(_c){xd(_c[1]||"");continue}const Ea=U.match(/^linefill\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Ea){gu(Ea[1]||"",Ea[2]||"",O);continue}const Tf=U.match(/^linefill\.delete\s*\((.*)\)\s*$/i);if(Tf){Bl(Tf[1]||"");continue}const Sr=U.match(/^label\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Sr){_u(Sr[1]||"",Sr[2]||"",O);continue}const Oa=U.match(/^label\.delete\s*\((.*)\)\s*$/i);if(Oa){eu(Oa[1]||"");continue}const lr=U.match(/^box\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(lr){ca(lr[1]||"",lr[2]||"",O);continue}const mr=U.match(/^box\.delete\s*\((.*)\)\s*$/i);if(mr){vc(mr[1]||"");continue}const Cr=U.match(/^table\.set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(Cr){rc(Cr[1]||"",Cr[2]||"",O);continue}const hl=U.match(/^table\.delete\s*\((.*)\)\s*$/i);if(hl){wd(hl[1]||"");continue}const ls=U.match(/^table\.cell_set_([A-Za-z0-9_]+)\s*\((.*)\)\s*$/i);if(ls){Tl(ls[1]||"",ls[2]||"",O);continue}const ws=U.match(/^plotcandle\s*\((.*)\)\s*$/i);if(ws){fu("candles",ws[1]||"",O);continue}const Fs=U.match(/^plotbar\s*\((.*)\)\s*$/i);if(Fs){fu("ohlc",Fs[1]||"",O);continue}const to=U.match(/^plotohlc\s*\((.*)\)\s*$/i);if(to){fu("ohlc",to[1]||"",O);continue}const cr=U.match(/^plotfill\s*\((.*)\)\s*$/i);if(cr){const Ks=Kr(cr[1]||""),Ct=qc(Ks),xn=Ks.filter(_o=>!Eu(_o));if(xn.length<2){e.push({message:"plotfill() requires 2 plot series",line:O});continue}const As=Dc(Ct),gn=Se(As),Sn=ad(xn[0],"plotfill_a"),Yn=ad(xn[1],"plotfill_b");gn.fills=Array.isArray(gn.fills)?gn.fills:[],gn.fills.push({between:[Sn,Yn],color:ki(String(Ct.color??""))||Er(String(Ct.color??""))||"rgba(34,197,94,0.10)"});continue}const io=U.match(/^(?:(?:varip|var)\s+)?(?:(?:float|int|bool|string)\s+)?([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*plot\s*\((.*)\)\s*$/i);if(io){Af(io[2]||"",O,io[1]);continue}const Yl=U.match(/^plot\s*\((.*)\)\s*$/i);if(Yl){Af(Yl[1]||"",O);continue}const na=U.match(/^plotarrow\s*\((.*)\)\s*$/i);if(na){const Ks=Kr(na[1]||""),Ct=qc(Ks),xn=Ks.filter(Uo=>!Eu(Uo));if(!xn.length){e.push({message:"plotarrow() requires a series",line:O});continue}const As=Dc(Ct),gn=Se(As),Sn=Su(xn[0],"plotarrow").replace(/\s+/g,"_").toLowerCase(),Yn=k_(To(`${Sn} > 0`,"plotarrow_up")),_o=k_(To(`${Sn} < 0`,"plotarrow_down")),si=ki(String(Ct.colorup??Ct.color_up??""))||"#22c55e",Gn=ki(String(Ct.colordown??Ct.color_down??""))||"#ef4444";gn.labels.push({when:Yn,text:"▲",color:si,position:"below",source:"low",shape:"arrowUp"}),gn.labels.push({when:_o,text:"▼",color:Gn,position:"above",source:"high",shape:"arrowDown"});continue}const Od=U.match(/^plotshape\s*\((.*)\)\s*$/i);if(Od){const Ks=Kr(Od[1]||"");if(!Ks.length){e.push({message:"plotshape() requires at least 1 argument",line:O});continue}const Ct=qc(Ks),xn=Ks.filter(fi=>!Eu(fi)),As=xn[0]?xl(xn[0],O):{};if(!(As.when??As.whenExpr)){e.push({message:"plotshape() missing condition",line:O});continue}const Sn=Dc(Ct),Yn=Se(Sn),_o=p6(String(Ct.location??"")),si=_o==="below",Gn=si?"below":"above",Uo=Ct.price??Ct.y??Ct.source??Ct.series,oo=Uo!=null?Su(String(Uo),"shape_price").replace(/\s+/g,"_").toLowerCase():_o==="absolute"?"close":si?"low":"high",cc=oZ(String(Ct.style??Ct.shape??""))||(si?"triangle_up_filled":"triangle_down_filled");if(cc==="none")continue;const bu=Er(String(Ct.text??Ct.title??""))||(si?"BUY":"SELL"),$l=Ct.transp??Ct.transparency,nu=$l!=null?Number($l):void 0,$r=C0(ki(String(Ct.color??""))||(si?"#16a34a":"#ef4444"),nu),$a=ki(String(Ct.textcolor??Ct.textColor??""))||void 0,wa=l1(String(Ct.size??""))||void 0,yc=sl(Ct.offset,"plotshape_offset");let ti=yc.value;yc.value!=null&&Number.isFinite(ti)?ti=Math.trunc(ti):yc.expr&&r&&t.push({message:"plotshape offset must be a constant integer",line:O}),Yn.labels.push({when:As.when,whenExpr:As.whenExpr,text:bu,color:$r,textColor:$a,position:Gn,source:oo,shape:cc,size:wa,offset:ti});continue}const qr=U.match(/^plotchar\s*\((.*)\)\s*$/i);if(qr){const Ks=Kr(qr[1]||"");if(!Ks.length){e.push({message:"plotchar() requires at least 1 argument",line:O});continue}const Ct=qc(Ks),xn=Ks.filter(yc=>!Eu(yc)),As=xn[0]?xl(xn[0],O):{};if(!(As.when??As.whenExpr)){e.push({message:"plotchar() missing condition",line:O});continue}const Sn=Dc(Ct),Yn=Se(Sn),_o=p6(String(Ct.location??"")),si=_o==="below",Gn=si?"below":"above",Uo=Ct.price??Ct.y??Ct.source??Ct.series,oo=Uo!=null?Su(String(Uo),"char_price").replace(/\s+/g,"_").toLowerCase():_o==="absolute"?"close":si?"low":"high",Si=Er(String(Ct.char??""))||Er(String(Ct.text??""))||"•",cc=Ct.transp??Ct.transparency,bu=cc!=null?Number(cc):void 0,$l=C0(ki(String(Ct.color??""))||(si?"#16a34a":"#ef4444"),bu),nu=ki(String(Ct.textcolor??Ct.textColor??""))||void 0,$r=l1(String(Ct.size??""))||14,$a=sl(Ct.offset,"plotchar_offset");let wa=$a.value;$a.value!=null&&Number.isFinite(wa)?wa=Math.trunc(wa):$a.expr&&r&&t.push({message:"plotchar offset must be a constant integer",line:O}),Yn.labels.push({when:As.when,whenExpr:As.whenExpr,text:Si,color:$l,textColor:nu,position:Gn,source:oo,shape:"text",size:$r,offset:wa});continue}const za=U.match(/^alert\s*\((.*)\)\s*$/i);if(za){const Ks=Kr(za[1]||"");if(!Ks.length){e.push({message:"alert() requires a message",line:O});continue}const Ct=qc(Ks),xn=Ks.filter(oo=>!Eu(oo)),As=xn[0]??Ct.message??Ct.msg??"",gn=xn[1]??Ct.freq??Ct.frequency??Ct.alert_freq??"",Sn=Ct.when??null,Yn=xl(Sn??"close >= close",O),_o=Yn.when??Yn.whenExpr??"close >= close",si=Er(String(Ct.title??"")),Gn=Er(String(As??"")),Uo=m6(String(gn??""));Ke.push({id:si?`${si}`:`alert_${O}`,type:"alert",when:_o,whenExpr:Yn.whenExpr,title:si||void 0,message:Gn||void 0,frequency:Uo});continue}const Yc=U.match(/^alertcondition\s*\((.*)\)\s*$/i);if(Yc){const Ks=Kr(Yc[1]||"");if(!Ks.length){e.push({message:"alertcondition() requires a condition",line:O});continue}const Ct=qc(Ks),xn=Ks.filter(Uo=>!Eu(Uo)),As=xn[0]!=null?String(xn[0]):"",gn=As?xl(As,O):{},Sn=gn.when??gn.whenExpr??null;if(!Sn){e.push({message:"alertcondition() missing condition",line:O});continue}const Yn=Er(String(Ct.title??"")),_o=Er(String(Ct.message??"")),si=Ct.freq??Ct.frequency??Ct.alert_freq??"",Gn=m6(String(si??""));Ke.push({id:Yn?`${Yn}`:`alert_${O}`,type:"alert",when:Sn,whenExpr:gn.whenExpr,title:Yn||void 0,message:_o||void 0,frequency:Gn});continue}const Na=U.match(/^hline\s*\((.*)\)\s*$/i);if(Na){const Ks=Kr(Na[1]||"");if(!Ks.length){e.push({message:"hline() requires value",line:O});continue}const Ct=qc(Ks),xn=Ks.filter(Yn=>!Eu(Yn)),As=Dh(Er(xn[0]??""));if(As==null){e.push({message:"hline() value must be a number",line:O});continue}const gn=Dc(Ct);Se(gn).levels.push({name:Er(String(Ct.title??Ct.name??String(As))),value:As,color:ki(String(Ct.color??""))||void 0,style:Er(String(Ct.linestyle??Ct.style??"dashed")),width:Ct.width!=null?Number(Ct.width):void 0});continue}const Rc=U.match(/^fill\s*\((.*)\)\s*$/i);if(Rc){const Ks=Kr(Rc[1]||""),Ct=qc(Ks),xn=Ks.filter(_o=>!Eu(_o));if(xn.length<2){e.push({message:"fill() requires 2 plot series",line:O});continue}const As=Dc(Ct),gn=Se(As),Sn=Su(xn[0],"fill_a"),Yn=Su(xn[1],"fill_b");gn.fills=Array.isArray(gn.fills)?gn.fills:[],gn.fills.push({between:[Sn,Yn],color:ki(String(Ct.color??""))||Er(String(Ct.color??""))||"rgba(34,197,94,0.10)"});continue}const Ir=U.match(/^signal\s+(entry_long|exit_long|entry_short|exit_short|buy|sell|exit)\s+when\s+(.+)$/i);if(Ir){const Ks=wp(Ir[2]||"");if(!Ks.when){e.push({message:"signal ... when requires a condition",line:O});continue}const Ct=xl(Ks.when,O),xn=Ct.when??Ct.whenExpr,As=ac(Ks.scoreRaw,O,"signal_score");if(Ks.scoreRaw!=null&&As==null)continue;const gn=Ld(Ks.cooldownRaw,O,"signal_cooldown");if(Ks.cooldownRaw!=null&&gn==null)continue;const Sn=Ir[1].toLowerCase(),Yn=Sn==="buy"?"entry_long":Sn==="sell"||Sn==="exit"?"exit_long":Sn;Ke.push({type:Yn,when:xn,whenExpr:Ct.whenExpr,score:As??null,cooldownBars:gn});continue}const tu=U.match(/^strategy\.entry\s*\((.*)\)\s*$/i);if(tu){const Ks=Kr(tu[1]||""),Ct=qc(Ks),As=Ks.filter(oo=>!Eu(oo))[0]||"",gn=Ks.find(oo=>/strategy\.(long|short)/i.test(oo))||"",Sn=/short/i.test(gn)?"short":"long",Yn=Ct.when?xl(Ct.when,O):{},_o=Yn.when??Yn.whenExpr??null;if(!_o){e.push({message:"strategy.entry(...) requires when=...",line:O});continue}const si=Sd(Ct),Gn=ac(Ct.score??Ct.signal_score,O,"entry_score");if((Ct.score??Ct.signal_score)!=null&&Gn==null)continue;const Uo=Cu(Ct,O,"entry_cooldown");if(Uo.hadRaw&&Uo.value==null)continue;Ke.push({id:As?Er(String(As)):void 0,type:Sn==="long"?"entry_long":"entry_short",when:_o,whenExpr:Yn.whenExpr,order:si||void 0,score:Gn??null,cooldownBars:Uo.value});continue}const jc=U.match(/^strategy\.order\s*\((.*)\)\s*$/i);if(jc){const Ks=Kr(jc[1]||""),Ct=qc(Ks),xn=Ks.filter(Si=>!Eu(Si)),As=xn[0]||"",gn=As?Er(String(As)):"";if(!gn){e.push({message:"strategy.order(...) requires id",line:O});continue}const Sn=Ks.find(Si=>/strategy\.(long|short)/i.test(Si))||xn[1]||"",Yn=/short/i.test(Sn)?"short":/long/i.test(Sn)?"long":"";if(!Yn){e.push({message:"strategy.order(...) requires strategy.long/strategy.short",line:O});continue}Ct.qty==null&&xn[2]!=null&&(Ct.qty=String(xn[2]));const _o=Ct.when?xl(Ct.when,O):{},si=_o.when??_o.whenExpr??null;if(!si){e.push({message:"strategy.order(...) requires when=...",line:O});continue}const Gn=Sd(Ct),Uo=ac(Ct.score??Ct.signal_score,O,"order_score");if((Ct.score??Ct.signal_score)!=null&&Uo==null)continue;const oo=Cu(Ct,O,"order_cooldown");if(oo.hadRaw&&oo.value==null)continue;Ke.push({id:gn,orderId:gn,type:Yn==="long"?"entry_long":"entry_short",when:si,whenExpr:_o.whenExpr,order:Gn||void 0,score:Uo??null,cooldownBars:oo.value});continue}const su=U.match(/^strategy\.(close|exit)\s*\((.*)\)\s*$/i);if(su){const Ks=Kr(su[2]||""),Ct=qc(Ks),As=Ks.filter($a=>!Eu($a))[0]||"",gn=Ct.when?xl(Ct.when,O):{},Sn=gn.when??gn.whenExpr??null,Yn=Ct.side&&/short/i.test(String(Ct.side))?"short":"long",_o=Sd(Ct),si=ac(Ct.score??Ct.signal_score,O,"exit_score");if((Ct.score??Ct.signal_score)!=null&&si==null)continue;const Gn=Cu(Ct,O,"exit_cooldown");if(Gn.hadRaw&&Gn.value==null)continue;const Uo=Ct.stop??Ct.stopPrice,oo=Ct.limit??Ct.limitPrice,Si=Ct.qty_percent??Ct.qtyPct??Ct.qtyPctVal??Ct.qtyPercent,cc=Si!=null?Number(Si):void 0,bu=Uo!=null?Su(String(Uo),"exit_stop"):null,$l=oo!=null?Su(String(oo),"exit_limit"):null,nu=As?`${Er(String(As))}__bracket`:`exit__bracket_${O}`;let $r=!1;if(Uo!=null&&(Ke.push({id:`${As?Er(String(As)):O}_STOP`,type:Yn==="long"?"exit_long":"exit_short",when:`between(${bu||"close"}, low, high)`,order:{kind:"stop",price:(bu||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof cc=="number"&&Number.isFinite(cc)?cc:void 0,oco:nu},score:si??null,cooldownBars:Gn.value}),$r=!0),oo!=null&&(Ke.push({id:`${As?Er(String(As)):O}_LIMIT`,type:Yn==="long"?"exit_long":"exit_short",when:`between(${$l||"close"}, low, high)`,order:{kind:"limit",price:($l||"close").replace(/\s+/g,"_").toLowerCase(),qtyPct:typeof cc=="number"&&Number.isFinite(cc)?cc:void 0,oco:nu},score:si??null,cooldownBars:Gn.value}),$r=!0),Sn&&(Ke.push({id:As?Er(String(As)):void 0,type:Yn==="long"?"exit_long":"exit_short",when:Sn,whenExpr:gn.whenExpr,order:Uo!=null||oo!=null?typeof cc=="number"&&Number.isFinite(cc)?{kind:"market",qtyPct:cc}:void 0:_o||(typeof cc=="number"&&Number.isFinite(cc)?{kind:"market",qtyPct:cc}:void 0),score:si??null,cooldownBars:Gn.value}),$r=!0),!$r){e.push({message:"strategy.exit/close(...) needs when=... or stop=/limit=...",line:O});continue}continue}const sd=U.match(/^strategy\.cancel\s*\((.*)\)\s*$/i);if(sd){const Ks=Kr(sd[1]||""),Ct=qc(Ks),As=Ks.filter(_o=>!Eu(_o))[0]||"",gn=As?Er(String(As)):"";if(!gn){e.push({message:"strategy.cancel(...) requires id",line:O});continue}const Sn=xl(Ct.when??"close >= close",O),Yn=Sn.when??Sn.whenExpr??"close >= close";Ke.push({id:`cancel_${gn}_${O}`,type:"cancel",when:Yn,whenExpr:Sn.whenExpr,orderId:gn});continue}const of=U.match(/^strategy\.cancel_all\s*\((.*)\)\s*$/i);if(of){const Ks=Kr(of[1]||""),Ct=qc(Ks),xn=xl(Ct.when??"close >= close",O),As=xn.when??xn.whenExpr??"close >= close";Ke.push({id:`cancel_all_${O}`,type:"cancel_all",when:As,whenExpr:xn.whenExpr});continue}const Iu=U.match(/^strategy\.close_all\s*\((.*)\)\s*$/i);if(Iu){const Ks=Kr(Iu[1]||""),Ct=qc(Ks),xn=Ct.when?xl(Ct.when,O):{},As=xn.when??xn.whenExpr??null;if(!As){e.push({message:"strategy.close_all(...) requires when=...",line:O});continue}const gn=ac(Ct.score??Ct.signal_score,O,"close_all_score");if((Ct.score??Ct.signal_score)!=null&&gn==null)continue;const Sn=Cu(Ct,O,"close_all_cooldown");if(Sn.hadRaw&&Sn.value==null)continue;Ke.push({type:"exit_long",when:As,whenExpr:xn.whenExpr,id:`close_all_long_${O}`,order:{kind:"market",qtyPct:100},score:gn??null,cooldownBars:Sn.value}),Ke.push({type:"exit_short",when:As,whenExpr:xn.whenExpr,id:`close_all_short_${O}`,order:{kind:"market",qtyPct:100},score:gn??null,cooldownBars:Sn.value});continue}const Qd=U.match(/^draw\.clear\s*\((.*)\)\s*$/i);if(Qd){const Ks=Kr(Qd[1]||""),Ct=qc(Ks),xn=Dc(Ct),As=String(Ct.kind??Ct.type??"").toLowerCase(),gn=["line","label","box","linefill","table","polyline","polygon","path"].includes(As)?As:void 0,Sn=El(Ct.group??Ct.group_id??Ct.groupId),Yn=El(Ct.tag??Ct.tags);ai(xn,{kind:"draw_clear",when:yl(Ct),filterKind:gn,groupId:Sn,tag:Yn});continue}const Hl=U.match(/^draw\.for_each\s*\((.*)\)\s*$/i);if(Hl){const Ks=Kr(Hl[1]||""),Ct=qc(Ks),xn=Dc(Ct),As=String(Ct.kind??Ct.type??"").toLowerCase(),gn=["line","label","box","linefill","table","polyline","polygon","path"].includes(As)?As:void 0,Sn=El(Ct.group??Ct.group_id??Ct.groupId),Yn=El(Ct.tag??Ct.tags),_o=sl(Ct.width,"draw.for_each_width"),si=br(Ct.text_size??Ct.textSize,"draw.for_each_text_size"),Gn=Ct.text!=null?ec(String(Ct.text),"draw.for_each_text"):{text:void 0,textExpr:void 0},Uo={color:ki(Ct.color),fillColor:ki(Ct.fill_color??Ct.fillcolor??Ct.bgcolor??Ct.bgColor),width:_o.value,widthExpr:_o.expr,style:Pg(String(Ct.style??""))||void 0,extend:S2(String(Ct.extend??""))||void 0,xloc:Mg(String(Ct.xloc??""))||void 0,bgColor:ki(Ct.bgcolor??Ct.bgColor),bgOpacity:Ct.bg_opacity!=null?Number(Ct.bg_opacity):Ct.bgOpacity!=null?Number(Ct.bgOpacity):void 0,borderColor:ki(Ct.border_color??Ct.borderColor),borderWidth:Ct.border_width!=null?Number(Ct.border_width):Ct.borderWidth!=null?Number(Ct.borderWidth):void 0,textColor:ki(Ct.text_color??Ct.textColor),text:Gn.text,textExpr:Gn.textExpr,textSize:si.value,textSizeExpr:si.expr,opacity:Ct.opacity!=null?Number(Ct.opacity):void 0,wrap:Ct.wrap!=null?String(Ct.wrap).toLowerCase()==="true"||Number(Ct.wrap)===1:void 0,maxWidth:Ct.maxwidth!=null?Number(Ct.maxwidth):Ct.maxWidth!=null?Number(Ct.maxWidth):void 0,padding:Ct.padding,radius:Ct.radius!=null?Number(Ct.radius):void 0,align:s_(String(Ct.align??Ct.textalign??Ct.textAlign??""))||void 0,valign:["top","middle","bottom"].includes(String(Ct.valign??"").toLowerCase())?String(Ct.valign).toLowerCase():void 0,lineHeight:Ct.line_height!=null?Number(Ct.line_height):Ct.lineHeight!=null?Number(Ct.lineHeight):void 0,fontFamily:Ct.font_family??Ct.fontFamily,fontSize:Ct.font_size!=null?Number(Ct.font_size):Ct.fontSize!=null?Number(Ct.fontSize):void 0,fontWeight:Ct.font_weight??Ct.fontWeight,monospace:Ct.monospace!=null?String(Ct.monospace).toLowerCase()==="true"||Number(Ct.monospace)===1:void 0};ai(xn,{kind:"draw_for_each",when:yl(Ct),filterKind:gn,groupId:Sn,tag:Yn,updates:Uo});continue}const kp=U.match(/^draw\.fib\.auto\s*\((.*)\)\s*$/i);if(kp){const Ks=Kr(kp[1]||""),Ct=qc(Ks),xn=Er(String(Ct.name??"fibo"));Oe.push({name:xn,type:"auto_fib",method:Er(String(Ct.method??"pivots")),pivotLeft:Number(Ct.left??Ct.pivotLeft??3),pivotRight:Number(Ct.right??Ct.pivotRight??3),lookback:Number(Ct.lookback??400),direction:Er(String(Ct.direction??"up")),draw:!0});continue}U.startsWith("//@")||t.push({message:`Ignored Pine statement: ${U}`,line:O})}if(!Ne.some(W=>Array.isArray(W.plots)&&W.plots.length||Array.isArray(W.labels)&&W.labels.length||Array.isArray(W.levels)&&W.levels.length||Array.isArray(W.lines)&&W.lines.length||Array.isArray(W.runtimeDrawOps)&&W.runtimeDrawOps.length||Array.isArray(W.runtimeLabels)&&W.runtimeLabels.length||Array.isArray(W.runtimeLines)&&W.runtimeLines.length||Array.isArray(W.runtimeBoxes)&&W.runtimeBoxes.length||Array.isArray(W.runtimeTables)&&W.runtimeTables.length)){const W=Te.length?Te[Te.length-1].name:Me.length?Me[Me.length-1].name:null,Q=W||"close";Se(se).plots.push({name:W?Er(String(W)):"Close",source:Q.replace(/\s+/g,"_").toLowerCase(),type:"line",color:"#60a5fa",width:2}),t.push({message:W?`No plot() found; auto-plotted "${W}". Add plot(...) to control output.`:'No plot() found; auto-plotted "close". Add plot(...) to control output.',line:1})}for(const W of Ne)if((Array.isArray(W.runtimeDrawOps)&&W.runtimeDrawOps.length||Array.isArray(W.runtimeLabels)&&W.runtimeLabels.length||Array.isArray(W.runtimeLines)&&W.runtimeLines.length||Array.isArray(W.runtimeBoxes)&&W.runtimeBoxes.length||Array.isArray(W.runtimeTables)&&W.runtimeTables.length||Array.isArray(W.runtimePolylines)&&W.runtimePolylines.length||Array.isArray(W.runtimePolygons)&&W.runtimePolygons.length?!0:Array.isArray(W.runtimePaths)&&W.runtimePaths.length)&&(!Array.isArray(W.plots)||W.plots.length===0)){const O=Te.length?Te[Te.length-1].name:"close";Array.isArray(W.plots)||(W.plots=[]),W.plots.push({name:"__runtime_stub__",source:String(O||"close").replace(/\s+/g,"_").toLowerCase(),type:"line",color:"rgba(0,0,0,0)",width:0})}if(!(!!Ft||Ke.length>0)){const Q=Ne.findIndex(O=>O.pane==="main");if(Q>=0){const O=Ne[Q];Array.isArray(O.plots)&&O.plots.length||Array.isArray(O.labels)&&O.labels.length||Array.isArray(O.levels)&&O.levels.length||Array.isArray(O.lines)&&O.lines.length||Ne.some((G,ye)=>ye===Q?!1:Array.isArray(G.plots)&&G.plots.length||Array.isArray(G.labels)&&G.labels.length||Array.isArray(G.levels)&&G.levels.length||Array.isArray(G.lines)&&G.lines.length)&&Ne.splice(Q,1)}}if(e.length)return{ok:!1,errors:e,warnings:t.length?t:void 0};try{const W=Ne.find(Q=>Q.pane==="sub");if(W&&typeof W.min!="number"&&typeof W.max!="number"){const O=(Array.isArray(W.levels)?W.levels:[]).map(U=>Number(U==null?void 0:U.value)).filter(U=>Number.isFinite(U));if(O.length){const U=Math.min(...O),ce=Math.max(...O),G=O.some(Qe=>Qe<=30),ye=O.some(Qe=>Qe>=70);O.length>=2&&U>=0&&ce<=100&&G&&ye&&(W.min=0,W.max=100)}}}catch{}const ge=Object.values(zt).map(W=>{const Q=Gs(W);return{name:Q.name,args:Q.args,lineNo:Q.lineNo,body:Q.body}});return{ok:!0,spec:{panes:Ne,calc:Oe,series:Te,stateSeries:Me,signals:Ke,strategy:Ft,params:kt,loopPlans:yu,userFunctions:ge.length?ge:void 0},inputDefs:pt,warnings:t.length?t:void 0}}function rZ(s){return new Worker(""+new URL("../workers/editor.worker-oRlJJsnX.js",import.meta.url).href,{name:s==null?void 0:s.name})}function aZ(s){return new Worker(""+new URL("../workers/json.worker-CPn_BmvY.js",import.meta.url).href,{name:s==null?void 0:s.name})}function lZ(s){return new Worker(""+new URL("../workers/css.worker-DGFkc2qH.js",import.meta.url).href,{name:s==null?void 0:s.name})}function cZ(s){return new Worker(""+new URL("../workers/html.worker-CltiozTZ.js",import.meta.url).href,{name:s==null?void 0:s.name})}function uZ(s){return new Worker(""+new URL("../workers/ts.worker-CGiXAPLT.js",import.meta.url).href,{name:s==null?void 0:s.name})}const dZ=()=>{var e;if(typeof window>"u")return;const s=window;(e=s.MonacoEnvironment)!=null&&e.getWorker||(s.MonacoEnvironment={getWorker(t,n){return n==="json"?new aZ:n==="css"||n==="scss"||n==="less"?new lZ:n==="html"||n==="handlebars"||n==="razor"?new cZ:n==="typescript"||n==="javascript"?new uZ:new rZ}})};function fZ(s,e){e("reset")}function pZ(s,e){e()}function hZ(s,e,t){i(e)&&(b(e,!1),t("fullpage",{enabled:!1})),t("close")}function mZ(s,e){e("guide")}function vZ(){L1.set(!0)}async function gZ(s,e,t){b(e,!0),await t(!1)}function g6(s,e){b(e,!1)}async function _Z(s,e){await e(!0)}function _6(s,e){b(e,!1)}function yZ(s,e,t){b(e,!i(e)),t("labels",{enabled:i(e)})}function y6(s,e){b(e,!1)}function bZ(s,e,t,n,o){if(!i(e))return;const r=i(t).trim()||`Run ${i(n).length+1}`,a=`cmp_${Date.now()}_${i(n).length}`,l=i(o)&&typeof i(o)=="object"?{...i(o)}:null;b(n,H([...i(n),{id:a,label:r,summary:i(e),params:l,ts:Date.now()}])),b(t,"")}function xZ(s,e,t,n){b(e,H([])),b(t,null),b(n,H({}))}function wZ(s,e,t,n){b(e,""),b(t,""),b(n,"")}function kZ(s,e,t,n,o,r,a,l,c,f,u,d,h,p,v,x,S,C,I,A,P,T,j){var ne;if(!i(e).length)return;if(b(t,""),!i(n)){b(t,"Select Param A");return}if(i(o)&&i(o)===i(n)){b(t,"Param B must differ from Param A");return}const E=r(i(n),i(a),i(l),i(c));if(!E.length){b(t,"Invalid range for Param A");return}const L=i(o)?r(i(o),i(f),i(u),i(d)):[null],D=E.length*(L.length||1);if(D>200){b(t,`Too many combos (${D}). Reduce ranges or steps.`);return}const X=[];for(const de of E)for(const ie of L){const te={...i(h)};te[i(n)]=de,i(o)&&ie!=null&&(te[i(o)]=ie),X.push({params:te})}b(p,H(X)),b(v,H([])),b(x,0),b(S,!0),b(C,!1),b(I,"train"),b(A,null),b(P,H(Number(((ne=T())==null?void 0:ne._updatedAt)??0))),j(0)}function SZ(s,e,t,n,o){b(e,!1),b(t,!1),b(n,H([])),b(o,0)}function CZ(s,e,t,n,o,r,a,l,c){b(e,H([])),b(t,null),b(n,""),b(o,0),b(r,H([])),b(a,!1),b(l,!1),b(c,0)}function IZ(s,e,t){b(e,!i(e)),t("fullpage",{enabled:i(e)})}function b6(s,e,t,n,o,r,a,l,c,f){const u=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const d of i(t))u.push(e([n(d.side),d.entryIndex,d.entryTimeLabel,o(d.entryPrice),d.exitIndex,d.exitTimeLabel,o(d.exitPrice),r(d.qty),a(d.barsHeld,0),l(d.netPnl),c(d.pnlPct),l(d.fees),l(d.pnl),d.maePct==null?"-":c(d.maePct),d.mfePct==null?"-":c(d.mfePct),d.entrySignalId,d.exitSignalId,d.exitReason,l(d.cumNet)]));f("backtest_trades.csv",u.join(`
`),"text/csv;charset=utf-8")}function x6(s,e,t,n,o,r,a,l){const c=[e(["id","status","action","side","kind","createdIndex","createdTime","activeFromIndex","expiresAtIndex","qtyPct","qty","cash","tif","price","stopPrice","limitPrice","targetQty","remainingQty","trailPct","trailOffset","trailPrice","filledIndex","filledTime","fillQty","fillPrice","fees","signalId","ocoGroup","note"])];for(const f of i(t))c.push(e([f.id,f.statusLabel,f.actionLabel,f.sideLabel,f.kindLabel,f.createdIndex,f.createdTimeLabel,f.activeFromIndex,f.expiresAtIndex,`${n(f.qtyPct,2)}%`,f.qty==null?"-":o(f.qty),f.cash==null?"-":r(f.cash),f.tif||"-",f.price==null?"-":a(f.price),f.stopPrice==null?"-":a(f.stopPrice),f.limitPrice==null?"-":a(f.limitPrice),f.targetQty==null?"-":o(f.targetQty),f.remainingQty==null?"-":o(f.remainingQty),f.trailPct==null?"-":`${n(f.trailPct,2)}%`,f.trailOffset==null?"-":a(f.trailOffset),f.trailPrice==null?"-":a(f.trailPrice),f.filledIndex,f.filledTimeLabel,f.fillQty==null?"-":o(f.fillQty),f.fillPrice==null?"-":a(f.fillPrice),f.fees==null?"-":r(f.fees),f.signalId,f.ocoGroup,f.note]));l("backtest_orders.csv",c.join(`
`),"text/csv;charset=utf-8")}function PZ(s,e,t,n,o,r,a,l,c,f,u){const d=[e(["side","entryIndex","entryTime","entryPrice","exitIndex","exitTime","exitPrice","qty","barsHeld","netPnl","pnlPct","fees","grossPnl","maePct","mfePct","entrySignalId","exitSignalId","exitReason","cumNetPnl"])];for(const p of i(t))d.push(e([n(p.side),p.entryIndex,p.entryTimeLabel,o(p.entryPrice),p.exitIndex,p.exitTimeLabel,o(p.exitPrice),r(p.qty),a(p.barsHeld,0),l(p.netPnl),c(p.pnlPct),l(p.fees),l(p.pnl),p.maePct==null?"-":c(p.maePct),p.mfePct==null?"-":c(p.mfePct),p.entrySignalId,p.exitSignalId,p.exitReason,l(p.cumNet)]));const h=i(f).type==="all"?"all":`${i(f).type}_${String(i(f).key).replace(/[^a-zA-Z0-9_-]+/g,"_")}`;u(`backtest_trades_${h}.csv`,d.join(`
`),"text/csv;charset=utf-8")}function MZ(s,e,t,n){const o=[e(["index","timestamp","equity"])];for(const r of i(t))o.push(e([r.index,r.timestamp,r.equity]));n("backtest_equity.csv",o.join(`
`),"text/csv;charset=utf-8")}var NZ=s=>s.stopPropagation(),AZ=(s,e)=>{s.stopPropagation(),b(e,"editor")},TZ=(s,e)=>{s.stopPropagation(),b(e,"errors")},FZ=be("<span> </span>"),LZ=(s,e)=>{s.stopPropagation(),b(e,"results")},EZ=s=>s.stopPropagation(),$Z=(s,e)=>e("main"),DZ=(s,e)=>e("sub"),RZ=be('<div class="pane-toggle svelte-1ehcy4i" aria-label="Target pane"><button type="button" class="svelte-1ehcy4i">Main</button> <button type="button" class="svelte-1ehcy4i">Sub pane</button></div>'),jZ=be('<button class="icon svelte-1ehcy4i" type="button" aria-label="Full page view" title="Full page view"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),BZ=be('<button class="icon svelte-1ehcy4i" type="button" aria-label="Exit full page view" title="Exit full page view (Esc)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 4H4v5M15 4h5v5M9 20H4v-5M15 20h5v-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>'),OZ=be('<div class="monaco-loading svelte-1ehcy4i">Loading editor…</div>'),zZ=be('<div class="monaco-shell svelte-1ehcy4i"><!></div>'),VZ=be('<div class="gutter-line svelte-1ehcy4i"></div>'),WZ=be('<div class="editor-gutter svelte-1ehcy4i"></div> <div class="code-shell svelte-1ehcy4i"><pre class="code-overlay svelte-1ehcy4i" aria-hidden="true"><code class="svelte-1ehcy4i"><!></code><mark class="err svelte-1ehcy4i" style="display:none" aria-hidden="true"></mark><mark class="err-warning svelte-1ehcy4i" style="display:none" aria-hidden="true"></mark></pre> <textarea class="code-input svelte-1ehcy4i" spellcheck="false" placeholder="Write or paste your script here, then press Run to see it on the chart"></textarea></div>',1),HZ=be('<div class="pine-warn-row svelte-1ehcy4i"> </div>'),qZ=be('<div class="pine-warn svelte-1ehcy4i"></div>'),UZ=(s,e,t)=>e(i(t).name,s.currentTarget.checked),GZ=be('<label class="toggle svelte-1ehcy4i"><input type="checkbox" class="svelte-1ehcy4i"> <span class="toggle-track svelte-1ehcy4i"></span></label>'),YZ=(s,e,t)=>e(i(t).name,s.currentTarget.value),KZ=be('<input class="input svelte-1ehcy4i" type="text">'),XZ=(s,e,t,n)=>{const o=s.currentTarget.value,r=e(o);r!=null&&t(i(n).name,r)},ZZ=be('<input class="input svelte-1ehcy4i" type="datetime-local">'),JZ=(s,e,t)=>e(i(t).name,s.currentTarget.value),QZ=be("<option></option>"),eJ=be('<div class="input-source svelte-1ehcy4i"><input class="input svelte-1ehcy4i"> <datalist></datalist></div>'),tJ=(s,e,t)=>e(i(t).name,s.currentTarget.value),sJ=be('<input class="input input-color svelte-1ehcy4i" type="color">'),nJ=(s,e,t)=>{const n=s.currentTarget.value,o=Number(n);Number.isFinite(o)&&e(i(t).name,i(t).type==="int"?Math.floor(o):o)},oJ=be('<input class="input svelte-1ehcy4i" type="number">'),iJ=be('<div class="input-row svelte-1ehcy4i"><div class="input-label svelte-1ehcy4i"><div class="input-name svelte-1ehcy4i"> </div> <div class="input-key mono svelte-1ehcy4i"> </div></div> <div class="input-control svelte-1ehcy4i"><!></div></div>'),rJ=be('<div class="editor-side svelte-1ehcy4i"><div class="side-card svelte-1ehcy4i"><div class="side-title svelte-1ehcy4i">Inputs</div> <div class="side-sub svelte-1ehcy4i">Script inputs — update values, then press Run.</div> <!> <div class="inputs-list svelte-1ehcy4i"></div> <div class="side-hint svelte-1ehcy4i">Change inputs → press <b>Run</b> to re‑calculate.</div></div></div>'),aJ=be('<div class="no-errors svelte-1ehcy4i">No errors • All good</div>'),lJ=be('<span class="diag-loc svelte-1ehcy4i"> <!> —</span>'),cJ=be('<span class="diag-hint svelte-1ehcy4i"> </span>'),uJ=be('<div><span class="diag-dot svelte-1ehcy4i"></span> <span class="diag-msg svelte-1ehcy4i"><!> </span> <!></div>'),dJ=be('<div class="errors-header svelte-1ehcy4i"><div class="errors-title svelte-1ehcy4i"> </div> <div class="errors-sub svelte-1ehcy4i">Newest errors appear here as you type.</div></div> <div class="errors-list svelte-1ehcy4i" aria-live="polite"></div>',1),fJ=be('<div class="errors-area svelte-1ehcy4i"><!></div>'),pJ=s=>{var e;try{(e=s==null?void 0:s.stopPropagation)==null||e.call(s)}catch{}},hJ=(s,e)=>b(e,"trades"),mJ=(s,e)=>b(e,"orders"),vJ=(s,e)=>b(e,H(s.currentTarget.value)),gJ=(s,e)=>b(e,H(i(e)==="compact"?"full":"compact")),_J=(s,e)=>e({type:"all"}),yJ=be('<button class="btn btn-xs btn-outline" type="button">Clear filter</button>'),bJ=(s,e)=>e("side"),xJ=(s,e)=>e("entryIndex"),wJ=(s,e)=>e("exitIndex"),kJ=(s,e)=>e("qty"),SJ=(s,e)=>e("barsHeld"),CJ=(s,e)=>e("netPnl"),IJ=(s,e)=>e("pnlPct"),PJ=(s,e)=>e("fees"),MJ=(s,e)=>e("pnl"),NJ=(s,e)=>e("maePct"),AJ=(s,e)=>e("mfePct"),TJ=(s,e)=>e("cumNet"),FJ=be('<th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th> <th class="svelte-1ehcy4i">Signals</th> <th class="svelte-1ehcy4i">Reason</th> <th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th>',1),LJ=(s,e,t)=>e(i(t)),EJ=(s,e,t)=>{s.key==="Enter"&&e(i(t))},$J=(s,e,t)=>{var n;try{(n=s==null?void 0:s.stopPropagation)==null||n.call(s)}catch{}e(i(t))},DJ=be('<td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td> <td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Entry</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Exit</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="mono svelte-1ehcy4i"> </td> <td class="right mono svelte-1ehcy4i"> </td>',1),RJ=be('<tr tabindex="0" class="svelte-1ehcy4i"><td class="svelte-1ehcy4i"><button class="btn btn-xs btn-ghost svelte-1ehcy4i" type="button" title="Focus this trade on chart">View</button></td><td class="svelte-1ehcy4i"><span class="tt-pill tt-pill-side svelte-1ehcy4i"> </span></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><td class="right mono svelte-1ehcy4i"> </td><!></tr>'),jJ=be('<div class="tt-scroll svelte-1ehcy4i"><table><thead class="svelte-1ehcy4i"><tr><th class="svelte-1ehcy4i">View</th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="svelte-1ehcy4i"><button class="th-btn svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><th class="right svelte-1ehcy4i"><button class="th-btn right svelte-1ehcy4i" type="button"> </button></th><!></tr></thead><tbody class="svelte-1ehcy4i"></tbody></table></div>'),BJ=be('<div class="no-errors svelte-1ehcy4i">No trades to show.</div>'),OJ=be(`<div class="tt-toolbar svelte-1ehcy4i"><div class="tt-toolbar-left svelte-1ehcy4i"><div class="tt-title svelte-1ehcy4i">Trades Table <span class="tt-sub mono svelte-1ehcy4i"> </span></div> <div class="tt-note-inline svelte-1ehcy4i">Entry/Exit show index, time, price. Bars = holding
                      duration.</div></div> <div class="tt-toolbar-right"><input class="input input-sm svelte-1ehcy4i" type="text" placeholder="Search trades..."> <button class="btn btn-xs btn-outline" type="button"> </button> <!> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),zJ=(s,e)=>b(e,H(i(e)==="compact"?"full":"compact")),VJ=be('<th class="svelte-1ehcy4i">Active / Expire</th> <th class="svelte-1ehcy4i">Signal / OCO</th> <th class="svelte-1ehcy4i">Note</th>',1),WJ=(s,e,t)=>{var n;try{(n=s==null?void 0:s.stopPropagation)==null||n.call(s)}catch{}e(i(t))},HJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty</span><span class="mono svelte-1ehcy4i"> </span></div>'),qJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Cash</span><span class="mono svelte-1ehcy4i"> </span></div>'),UJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div>'),GJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Stop</span><span class="mono svelte-1ehcy4i"> </span></div>'),YJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Limit</span><span class="mono svelte-1ehcy4i"> </span></div>'),KJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">TIF</span><span class="mono svelte-1ehcy4i"> </span></div>'),XJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Trail%</span><span class="mono svelte-1ehcy4i"> </span></div>'),ZJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Trail</span><span class="mono svelte-1ehcy4i"> </span></div>'),JJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">TrailPx</span><span class="mono svelte-1ehcy4i"> </span></div>'),QJ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Remaining</span><span class="mono svelte-1ehcy4i"> </span></div>'),eQ=be('<div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Target</span><span class="mono svelte-1ehcy4i"> </span></div>'),tQ=be('<td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Active</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Expire</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Signal</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">OCO</span><span class="mono svelte-1ehcy4i"> </span></div></div></td> <td class="mono svelte-1ehcy4i"> </td>',1),sQ=be('<tr class="svelte-1ehcy4i"><td class="svelte-1ehcy4i"><button class="btn btn-xs btn-ghost svelte-1ehcy4i" type="button" title="View this order on chart">View</button></td><td class="mono svelte-1ehcy4i"> </td><td class="svelte-1ehcy4i"><span> </span></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Action</span> <span class="tt-pill tt-pill-action svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Side</span> <span class="tt-pill tt-pill-side svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Kind</span> <span class="tt-pill tt-pill-kind svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty%</span><span class="mono svelte-1ehcy4i"> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></div></td><td class="svelte-1ehcy4i"><div class="tt-cell-stack svelte-1ehcy4i"><div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Idx</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Time</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Qty</span><span class="mono svelte-1ehcy4i"> </span></div> <!> <!> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Price</span><span class="mono svelte-1ehcy4i"> </span></div> <div class="svelte-1ehcy4i"><span class="tt-label svelte-1ehcy4i">Fees</span><span class="mono svelte-1ehcy4i"> </span></div></div></td><!></tr>'),nQ=be('<div class="tt-scroll svelte-1ehcy4i"><table><thead class="svelte-1ehcy4i"><tr><th class="svelte-1ehcy4i">View</th><th class="svelte-1ehcy4i">ID</th><th class="svelte-1ehcy4i">Status</th><th class="svelte-1ehcy4i">Type</th><th class="svelte-1ehcy4i">Created</th><th class="svelte-1ehcy4i">Request</th><th class="svelte-1ehcy4i">Fill</th><!></tr></thead><tbody class="svelte-1ehcy4i"></tbody></table></div>'),oQ=be('<div class="no-errors svelte-1ehcy4i">No orders to show.</div>'),iQ=be(`<div class="tt-title-row svelte-1ehcy4i"><div class="tt-title-group svelte-1ehcy4i"><div class="tt-title svelte-1ehcy4i">Orders</div> <div class="tt-sub mono svelte-1ehcy4i"> <!></div> <div class="tt-note-inline svelte-1ehcy4i">Request shows desired qty/price; Fill shows executed
                      values.</div></div> <div class="tt-title-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Download CSV</button></div></div> <!>`,1),rQ=be('<div class="tables-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="tables-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Trades and Orders"><div class="tables-modal-head svelte-1ehcy4i"><div class="tables-modal-title svelte-1ehcy4i">Trades & Orders</div> <div class="tables-modal-actions svelte-1ehcy4i"><div class="tables-modal-tabs svelte-1ehcy4i" role="tablist" aria-label="Tables"><button type="button" role="tab" class="svelte-1ehcy4i">Trades</button> <button type="button" role="tab" class="svelte-1ehcy4i">Orders</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="tables-modal-body svelte-1ehcy4i"><!></div></div></div>'),aQ=be("Backtest requires <code>strategy(...)</code> — add it, then press <b>Run</b>.",1),lQ=be('Backtest requires <code>"strategy"</code> — add it, then press <b>Run</b>.',1),cQ=be('<div class="no-errors svelte-1ehcy4i"><!></div>'),uQ=be("No backtest results yet — add <code>strategy.entry/strategy.exit</code>, then press <b>Run</b>.",1),dQ=be('No backtest results yet — add <code>"signals"</code>, then press <b>Run</b>.',1),fQ=be('<div class="no-errors svelte-1ehcy4i"><!></div>'),pQ=be("Ready — press <b>Run</b> to calculate results.",1),hQ=be('<div class="mono svelte-1ehcy4i" style="margin-top:6px; opacity:0.8"> </div>'),mQ=be('<div class="no-errors svelte-1ehcy4i"><!> <!></div>'),vQ=be('<div class="meta-chip svelte-1ehcy4i">Last signal <span class="mono svelte-1ehcy4i"> </span></div>'),gQ=be('<div class="meta-chip svelte-1ehcy4i">Filter <span class="mono svelte-1ehcy4i"> </span></div>'),_Q=(s,e)=>e("setup"),yQ=(s,e)=>b(e,H(s.currentTarget.value)),bQ=(s,e)=>b(e,H(s.currentTarget.value)),xQ=(s,e)=>b(e,H(s.currentTarget.value)),wQ=be('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),kQ=be('<div class="bt-active mono svelte-1ehcy4i"> </div>'),SQ=(s,e)=>b(e,H(s.currentTarget.value)),CQ=be('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),IQ=(s,e,t)=>e(i(t).id),PQ=(s,e,t)=>e(i(t).id),MQ=be('<div class="compare-metric svelte-1ehcy4i"><span class="cd-key svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div>'),NQ=be('<div class="compare-metric svelte-1ehcy4i"><span class="cd-key svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div>'),AQ=be('<div class="compare-params svelte-1ehcy4i"></div>'),TQ=be('<div class="cd-empty svelte-1ehcy4i">No params</div>'),FQ=(s,e,t)=>e(i(t).id),LQ=be('<pre class="compare-raw mono svelte-1ehcy4i"> </pre>'),EQ=be('<div class="compare-details svelte-1ehcy4i"><div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Summary</div> <div class="compare-metrics svelte-1ehcy4i"></div></div> <div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Params</div> <!></div> <div class="compare-detail svelte-1ehcy4i"><div class="cd-title svelte-1ehcy4i">Raw (optional)</div> <button class="btn btn-xs btn-outline" type="button"> </button> <!></div></div>'),$Q=be('<div class="compare-row svelte-1ehcy4i"><div class="mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="mono svelte-1ehcy4i"> </div> <div class="compare-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button"> </button> <button class="btn btn-xs btn-outline" type="button">Remove</button></div></div> <!>',1),DQ=be('<div class="compare-table svelte-1ehcy4i"><div class="compare-head svelte-1ehcy4i"><div>Run</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">Ret%</div> <div class="right svelte-1ehcy4i">DD%</div> <div class="right svelte-1ehcy4i">Sharpe</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Trades</div> <div>Params</div> <div>Actions</div></div> <!></div>'),RQ=be('<div class="bt-empty svelte-1ehcy4i">Pin runs to compare net PnL, drawdown, Sharpe, and params.</div>'),jQ=(s,e)=>e("performance"),BQ=be(`No signals matched. Check <code>when</code> conditions and series
                    names; try a simpler condition first.`,1),OQ=be(`Signals matched but no orders filled. Common causes:
                    limit/stop price never touches • stop‑limit expires • try <code>"order": &#123; "kind": "market" &#125;</code> first, then add limit/stop.`,1),zQ=be('<div class="bt-hint svelte-1ehcy4i"><div class="bt-hint-title svelte-1ehcy4i">No trades yet</div> <div class="bt-hint-body svelte-1ehcy4i"><!></div></div>'),VQ=(s,e)=>e("behavior"),WQ=be('<div class="sig-row svelte-1ehcy4i"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),HQ=be('<div class="signal-table svelte-1ehcy4i"><div class="sig-head svelte-1ehcy4i"><div>Signal</div> <div class="right svelte-1ehcy4i">Trades</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">PF</div></div> <!></div>'),qQ=be('<div class="no-errors svelte-1ehcy4i">No signal stats yet.</div>'),UQ=(s,e)=>e("optimization"),GQ=(s,e)=>e(s.currentTarget.value),YQ=be("<option> </option>"),KQ=(s,e)=>b(e,H(Number(s.currentTarget.value))),XQ=(s,e)=>b(e,H(Number(s.currentTarget.value))),ZQ=(s,e)=>b(e,H(Number(s.currentTarget.value))),JQ=(s,e)=>e(s.currentTarget.value),QQ=be("<option> </option>"),eee=(s,e)=>b(e,H(Number(s.currentTarget.value))),tee=(s,e)=>b(e,H(Number(s.currentTarget.value))),see=(s,e)=>b(e,H(Number(s.currentTarget.value))),nee=be('<div class="opt-range-grid svelte-1ehcy4i"><label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Step</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label></div>'),oee=(s,e)=>b(e,H(s.currentTarget.value)),iee=(s,e)=>b(e,H(s.currentTarget.checked)),ree=(s,e)=>b(e,H(Math.max(10,Math.min(90,Number(s.currentTarget.value)||70)))),aee=be('<div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Train %</div> <div class="opt-control svelte-1ehcy4i"><input class="input input-sm svelte-1ehcy4i" type="number" min="10" max="90"></div></div>'),lee=be('<button class="btn btn-xs btn-outline" type="button">Stop</button>'),cee=be('<button class="btn btn-xs btn-outline" type="button">Clear</button>'),uee=be('<div class="opt-warning svelte-1ehcy4i"> </div>'),dee=be('<div class="opt-progress svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div>'),fee=be('<div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Param A</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"></select></div></div> <div class="opt-range-grid svelte-1ehcy4i"><label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label> <label class="opt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Step</span> <input class="input input-sm svelte-1ehcy4i" type="number"></label></div> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Param B</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"><option>None</option><!></select></div></div> <!> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Metric</div> <div class="opt-control svelte-1ehcy4i"><select class="input input-sm svelte-1ehcy4i"><option>Net PnL</option><option>Profit Factor</option><option>Sharpe</option><option>Win Rate</option><option>Max Drawdown (lower better)</option></select></div></div> <div class="opt-row svelte-1ehcy4i"><div class="opt-label svelte-1ehcy4i">Walk-forward</div> <div class="opt-control opt-toggle svelte-1ehcy4i"><label class="toggle svelte-1ehcy4i"><input type="checkbox" class="svelte-1ehcy4i"> <span class="toggle-track svelte-1ehcy4i"></span></label></div></div> <!> <div class="opt-actions svelte-1ehcy4i"><button class="btn btn-xs btn-primary" type="button">Run grid</button> <!> <span class="opt-note svelte-1ehcy4i">Up to 200 combos per run.</span></div> <!> <!>',1),pee=be('<div class="bt-empty svelte-1ehcy4i">No numeric inputs found. Add <code>input.int</code> or <code>input.float</code> to optimize.</div>'),hee=be('<div><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),mee=be('<div class="opt-test svelte-1ehcy4i"> </div>'),vee=be('<div class="opt-results-meta svelte-1ehcy4i"> </div> <div class="opt-results svelte-1ehcy4i"><div class="opt-results-head svelte-1ehcy4i"><div>Params</div> <div class="right svelte-1ehcy4i">Metric</div> <div class="right svelte-1ehcy4i">Net</div> <div class="right svelte-1ehcy4i">Ret%</div> <div class="right svelte-1ehcy4i">DD%</div> <div class="right svelte-1ehcy4i">Win%</div> <div class="right svelte-1ehcy4i">Trades</div></div> <!></div> <!>',1),gee=be('<div class="bt-empty svelte-1ehcy4i">Run a grid search to see ranked results.</div>'),_ee=(s,e)=>e("charts"),yee=(s,e)=>{b(e,"1w")},bee=(s,e)=>{b(e,"1m")},xee=(s,e)=>{b(e,"3m")},wee=(s,e)=>{b(e,"6m")},kee=(s,e)=>{b(e,"1y")},See=(s,e)=>{b(e,"5y")},Cee=(s,e)=>{b(e,"all")},Iee=be('<div class="report-metrics svelte-1ehcy4i"><div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Start</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">End</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Net</span> <span> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Return</span> <span> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Range</span> <span class="mono svelte-1ehcy4i"> </span></div></div>'),Pee=ga('<path fill="none" stroke="var(--report-benchmark-stroke)" stroke-width="1.25" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path>'),Mee=ga('<circle class="report-dot equity svelte-1ehcy4i" r="1.8"></circle>'),Nee=be('<svg class="report-svg svelte-1ehcy4i" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Equity curve"><path fill="var(--report-equity-fill)"></path><path fill="none" stroke="var(--report-equity-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><!><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-1ehcy4i"> </div> <div class="chart-axis bottom mono svelte-1ehcy4i"> </div>',1),Aee=be('<div class="report-empty svelte-1ehcy4i">No data</div>'),Tee=be('<div class="crosshair v svelte-1ehcy4i"></div> <div class="crosshair h svelte-1ehcy4i"></div> <div class="chart-tooltip svelte-1ehcy4i"><div class="tt-title mono svelte-1ehcy4i"> </div> <div class="tt-val svelte-1ehcy4i">Equity: <span class="mono svelte-1ehcy4i"> </span></div> <div class="tt-sub svelte-1ehcy4i">Net: <span class="mono svelte-1ehcy4i"> </span></div> <div class="tt-sub svelte-1ehcy4i">Return: <span class="mono svelte-1ehcy4i"> </span></div></div>',1),Fee=be('<div class="report-legend svelte-1ehcy4i"><div class="legend-item svelte-1ehcy4i"><span class="legend-dot equity svelte-1ehcy4i"></span>Equity</div> <div class="legend-item svelte-1ehcy4i"><span class="legend-dot bench svelte-1ehcy4i"></span>Buy &amp; Hold</div></div>'),Lee=be('<div class="report-metrics svelte-1ehcy4i"><div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Worst DD</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Avg DD</span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="metric svelte-1ehcy4i"><span class="metric-label svelte-1ehcy4i">Last DD</span> <span class="mono svelte-1ehcy4i"> </span></div></div>'),Eee=ga('<circle class="report-dot dd svelte-1ehcy4i" r="1.8"></circle>'),$ee=be('<svg class="report-svg svelte-1ehcy4i" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Drawdown"><path fill="var(--report-dd-fill)"></path><path fill="none" stroke="var(--report-dd-stroke)" stroke-width="1.5" vector-effect="non-scaling-stroke" stroke-linejoin="round" stroke-linecap="round"></path><line x1="0" y1="25" x2="100" y2="25" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="50" x2="100" y2="50" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><line x1="0" y1="75" x2="100" y2="75" stroke="var(--report-grid)" stroke-width="1" vector-effect="non-scaling-stroke"></line><!></svg> <div class="chart-axis top mono svelte-1ehcy4i"> </div> <div class="chart-axis bottom mono svelte-1ehcy4i"> </div>',1),Dee=be('<div class="report-empty svelte-1ehcy4i">No data</div>'),Ree=be('<div class="tt-sub svelte-1ehcy4i">Equity: <span class="mono svelte-1ehcy4i"> </span></div>'),jee=be('<div class="crosshair v svelte-1ehcy4i"></div> <div class="crosshair h svelte-1ehcy4i"></div> <div class="chart-tooltip svelte-1ehcy4i"><div class="tt-title mono svelte-1ehcy4i"> </div> <div class="tt-val svelte-1ehcy4i">DD: <span class="mono svelte-1ehcy4i"> </span></div> <!></div>',1),Bee=(s,e)=>e("returns"),Oee=(s,e,t,n,o)=>{e({type:"month",key:i(t).key}),n("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades")},zee=(s,e,t,n,o)=>{s.key==="Enter"&&(e({type:"month",key:i(t).key}),n("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades"))},Vee=be('<div role="button" tabindex="0"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Wee=be('<div class="returns-table svelte-1ehcy4i"><div class="rt-head svelte-1ehcy4i"><div>Month</div> <div class="right svelte-1ehcy4i">Return</div></div> <!></div>'),Hee=be('<div class="no-errors svelte-1ehcy4i">No monthly returns yet.</div>'),qee=(s,e,t,n,o)=>{e({type:"week",key:i(t).key}),n("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades")},Uee=(s,e,t,n,o)=>{s.key==="Enter"&&(e({type:"week",key:i(t).key}),n("focusIndex",{index:i(t).toIndex,timestamp:i(t).toTs}),o("trades"))},Gee=be('<div role="button" tabindex="0"><div class="mono svelte-1ehcy4i"> </div> <div class="right mono svelte-1ehcy4i"> </div></div>'),Yee=be('<div class="returns-table svelte-1ehcy4i"><div class="rt-head svelte-1ehcy4i"><div>Week</div> <div class="right svelte-1ehcy4i">Return</div></div> <!></div>'),Kee=be('<div class="no-errors svelte-1ehcy4i">No weekly returns yet.</div>'),Xee=(s,e)=>e("distributions"),Zee=be('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),Jee=be('<div class="hist svelte-1ehcy4i"></div>'),Qee=be('<div class="no-errors svelte-1ehcy4i">No trades yet.</div>'),ete=be('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),tte=be('<div class="hist svelte-1ehcy4i"></div>'),ste=be('<div class="no-errors svelte-1ehcy4i">No MAE data.</div>'),nte=be('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),ote=be('<div class="hist svelte-1ehcy4i"></div>'),ite=be('<div class="no-errors svelte-1ehcy4i">No MFE data.</div>'),rte=be('<div class="hist-row svelte-1ehcy4i"><div class="hist-label mono svelte-1ehcy4i"> </div> <div class="hist-bar svelte-1ehcy4i"><span class="svelte-1ehcy4i"></span></div> <div class="hist-count mono svelte-1ehcy4i"> </div></div>'),ate=be('<div class="hist svelte-1ehcy4i"></div>'),lte=be('<div class="no-errors svelte-1ehcy4i">No duration data.</div>'),cte=(s,e)=>e("exports"),ute=(s,e)=>e("trades"),dte=(s,e)=>e("orders"),fte=be('<button class="btn btn-sm btn-outline" type="button">Download Filtered Trades CSV</button>'),pte=be('<div class="results-shell svelte-1ehcy4i"><div class="results-hero svelte-1ehcy4i"><div class="results-title-group svelte-1ehcy4i"><div class="results-title svelte-1ehcy4i">Strategy Results</div> <div class="results-sub svelte-1ehcy4i">Latest run summary. Update inputs or filters, then press Run.</div></div> <div class="results-kpis svelte-1ehcy4i"><div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Final equity</div> <div class="kpi-value mono svelte-1ehcy4i"> </div></div> <div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Net PnL</div> <div> </div></div> <div class="kpi svelte-1ehcy4i"><div class="kpi-label svelte-1ehcy4i">Max drawdown</div> <div class="kpi-value mono svelte-1ehcy4i"> </div></div></div></div> <div class="results-meta svelte-1ehcy4i"><div class="meta-chip svelte-1ehcy4i">Signals <span class="mono svelte-1ehcy4i"> </span> <span class="meta-sub mono svelte-1ehcy4i"> </span></div> <!> <!></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Setup</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Setup info">i</button></div> <div class="section-sub svelte-1ehcy4i">Limit the backtest window or pin runs for comparison.</div></div></div> <div class="bt-tools svelte-1ehcy4i"><div class="bt-tool-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Backtest Filters</div> <div class="bt-field-grid svelte-1ehcy4i"><label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">From</span> <input class="input input-sm svelte-1ehcy4i" type="date"></label> <label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">To</span> <input class="input input-sm svelte-1ehcy4i" type="date"></label> <label class="bt-field svelte-1ehcy4i"><span class="bt-label svelte-1ehcy4i">Session</span> <input class="input input-sm svelte-1ehcy4i" type="text" placeholder="0930-1600"></label></div> <div class="bt-actions svelte-1ehcy4i"><button class="btn btn-xs btn-primary" type="button">Re-run</button> <!> <!> <div class="bt-note svelte-1ehcy4i">Dates use UTC • Session HHMM‑HHMM</div></div></div> <div class="bt-tool-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Compare Runs</div> <div class="bt-compare-toolbar svelte-1ehcy4i"><input class="input input-sm svelte-1ehcy4i" type="text" placeholder="Label (optional)"> <button class="btn btn-xs btn-primary" type="button">Pin current</button> <!></div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Performance Snapshot</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Performance snapshot info">i</button></div> <div class="section-sub svelte-1ehcy4i">Core stats for this run at a glance.</div></div></div> <div class="results-grid svelte-1ehcy4i"><div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Trades</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> <!></div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Win rate</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Net PnL</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Expectancy</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Risk</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div> <div class="result-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Exposure</div> <div class="rc-value svelte-1ehcy4i"> </div> <div class="rc-sub svelte-1ehcy4i"> </div></div></div> <!></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Trade Behavior</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Trade behavior info">i</button></div> <div class="section-sub svelte-1ehcy4i">Breakdowns by side and signal.</div></div></div> <div class="breakdown-grid svelte-1ehcy4i"><div class="breakdown-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Long vs Short</div> <div class="breakdown-row svelte-1ehcy4i"><span class="mono svelte-1ehcy4i">Long</span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div> <div class="breakdown-row svelte-1ehcy4i"><span class="mono svelte-1ehcy4i">Short</span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span> <span class="mono svelte-1ehcy4i"> </span></div></div> <div class="breakdown-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Per‑Signal Stats</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Optimization</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Optimization info">i</button></div> <div class="section-sub svelte-1ehcy4i">Search numeric inputs and rank by the chosen metric.</div></div> <div class="section-meta mono svelte-1ehcy4i"> <!></div></div> <div class="opt-grid svelte-1ehcy4i"><div class="opt-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Params</div> <!></div> <div class="opt-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Results</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Charts</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Charts info">i</button></div> <div class="section-sub svelte-1ehcy4i">Equity and drawdown for the selected range.</div></div> <div class="section-meta svelte-1ehcy4i"><div class="range-toggle svelte-1ehcy4i" role="group" aria-label="Report range"><button type="button" class="svelte-1ehcy4i">1W</button> <button type="button" class="svelte-1ehcy4i">1M</button> <button type="button" class="svelte-1ehcy4i">3M</button> <button type="button" class="svelte-1ehcy4i">6M</button> <button type="button" class="svelte-1ehcy4i">1Y</button> <button type="button" class="svelte-1ehcy4i">5Y</button> <button type="button" class="svelte-1ehcy4i">All</button></div></div></div> <div class="reports-grid svelte-1ehcy4i"><div class="report-card svelte-1ehcy4i"><div class="report-head svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Equity Curve</div> <div class="report-sub mono svelte-1ehcy4i"><!></div></div> <!> <div class="report-canvas svelte-1ehcy4i"><!> <!></div> <!></div> <div class="report-card svelte-1ehcy4i"><div class="report-head svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Drawdown (%)</div> <div class="report-sub mono svelte-1ehcy4i"> </div></div> <!> <div class="report-canvas svelte-1ehcy4i"><!> <!></div></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Returns</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Returns info">i</button></div> <div class="section-sub svelte-1ehcy4i">Monthly and weekly performance snapshots.</div></div></div> <div class="returns-grid svelte-1ehcy4i"><div class="return-card svelte-1ehcy4i"><div class="rc-title-row svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Monthly Returns</div></div> <div class="rc-subhint svelte-1ehcy4i">Click a row to filter trades by that period.</div> <!></div> <div class="return-card svelte-1ehcy4i"><div class="rc-title-row svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Weekly Returns</div></div> <div class="rc-subhint svelte-1ehcy4i">Click a row to filter trades by that period.</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Distributions</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Distributions info">i</button></div> <div class="section-sub svelte-1ehcy4i">See how trades are distributed across outcomes.</div></div></div> <div class="dist-grid svelte-1ehcy4i"><div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">PnL% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">MAE% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">MFE% Distribution</div> <!></div> <div class="dist-card svelte-1ehcy4i"><div class="rc-title svelte-1ehcy4i">Trade Duration (bars)</div> <!></div></div></div> <div class="results-section svelte-1ehcy4i"><div class="section-head svelte-1ehcy4i"><div><div class="section-title-row svelte-1ehcy4i"><div class="section-title svelte-1ehcy4i">Exports & Totals</div> <button class="info-btn svelte-1ehcy4i" type="button" aria-label="Exports info">i</button></div> <div class="section-sub svelte-1ehcy4i">Download data or review totals for this run.</div></div></div> <div class="export-row svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Open Trades Table</button> <button class="btn btn-sm btn-primary" type="button">Open Orders Table</button> <button class="btn btn-sm btn-outline" type="button">Download Trades CSV</button> <!> <button class="btn btn-sm btn-outline" type="button">Download Orders CSV</button> <button class="btn btn-sm btn-outline" type="button">Download Equity CSV</button></div> <div class="pnl-strip svelte-1ehcy4i"><div class="pnl-item pos svelte-1ehcy4i"> </div> <div class="pnl-item neg svelte-1ehcy4i"> </div> <div> </div></div> <div class="pnl-strip pnl-strip-2 svelte-1ehcy4i"><div class="pnl-item svelte-1ehcy4i"> </div> <div class="pnl-item svelte-1ehcy4i"> </div> <div class="pnl-item svelte-1ehcy4i"> </div></div></div></div>'),hte=be('<div class="errors-area svelte-1ehcy4i"><!> <!></div>'),mte=s=>{var e;try{(e=s==null?void 0:s.stopPropagation)==null||e.call(s)}catch{}},vte=(s,e)=>b(e,"en"),gte=(s,e)=>b(e,"bn"),_te=be("<li> </li>"),yte=be("<li> </li>"),bte=be('<ul class="info-list svelte-1ehcy4i"></ul> <div class="info-example svelte-1ehcy4i"><div class="info-example-title svelte-1ehcy4i">Example</div> <ul class="svelte-1ehcy4i"></ul></div>',1),xte=be('<div class="info-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="info-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Section info"><div class="info-modal-head svelte-1ehcy4i"><div class="info-modal-title svelte-1ehcy4i"> </div> <div class="info-modal-actions svelte-1ehcy4i"><div class="info-lang-toggle svelte-1ehcy4i" role="group" aria-label="Info language"><button type="button" class="svelte-1ehcy4i">EN</button> <button type="button" class="svelte-1ehcy4i">BN</button></div> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="info-modal-body svelte-1ehcy4i"><!></div></div></div>'),wte=s=>{var e;try{(e=s==null?void 0:s.stopPropagation)==null||e.call(s)}catch{}},kte=(s,e)=>{s.key==="Enter"&&e()},Ste=be('<div class="library-loading svelte-1ehcy4i">Loading saved scripts…</div>'),Cte=be('<div class="library-empty svelte-1ehcy4i">No saved scripts yet.</div>'),Ite=(s,e,t)=>b(e,H(i(t).id)),Pte=be('<button type="button"><div class="save-row-name svelte-1ehcy4i"> </div> <div class="save-row-meta svelte-1ehcy4i"> </div></button>'),Mte=(s,e,t)=>i(e)&&t(i(e)),Nte=be('<div class="library-error svelte-1ehcy4i"> </div>'),Ate=be('<div class="library-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="library-modal save-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="Save script"><div class="library-head svelte-1ehcy4i"><div class="library-title svelte-1ehcy4i">Save Script</div> <div class="library-head-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-body save-grid svelte-1ehcy4i"><div class="save-panel svelte-1ehcy4i"><div class="save-card svelte-1ehcy4i"><label class="input-label svelte-1ehcy4i" for="save-script-name">Script name</label> <input id="save-script-name" class="input svelte-1ehcy4i" placeholder="Enter a unique name"> <div class="save-actions svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Save as new</button> <span class="save-hint svelte-1ehcy4i">Names must be unique</span></div></div></div> <div class="save-panel svelte-1ehcy4i"><div class="save-card svelte-1ehcy4i"><div class="save-divider svelte-1ehcy4i">Overwrite existing</div> <div class="save-list svelte-1ehcy4i"><!></div> <div class="save-actions overwrite-actions svelte-1ehcy4i"><button class="btn btn-sm btn-primary" type="button">Overwrite selected</button> <span class="save-hint svelte-1ehcy4i">Replaces the selected script with current code</span></div></div></div> <!></div></div></div>'),Tte=s=>{var e;try{(e=s==null?void 0:s.stopPropagation)==null||e.call(s)}catch{}},Fte=be('<div class="library-error svelte-1ehcy4i"> </div>'),Lte=be('<div class="library-loading svelte-1ehcy4i">Loading scripts…</div>'),Ete=be('<div class="library-empty svelte-1ehcy4i">No scripts found.</div>'),$te=(s,e,t)=>e(i(t)),Dte=(s,e,t)=>e(i(t)),Rte=(s,e,t)=>e(i(t)),jte=(s,e,t)=>e(i(t)),Bte=(s,e,t)=>e(i(t).id),Ote=be('<div class="library-row svelte-1ehcy4i"><div><div class="library-name svelte-1ehcy4i"> </div> <div class="library-meta svelte-1ehcy4i"> </div></div> <div class="library-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Edit</button> <button class="btn btn-xs btn-outline" type="button">Insert</button> <button class="btn btn-xs btn-outline" type="button">Run</button> <button class="btn btn-xs btn-outline" type="button">Copy</button> <button class="btn btn-xs btn-danger svelte-1ehcy4i" type="button">Delete</button></div></div>'),zte=be('<div class="library-list svelte-1ehcy4i"></div>'),Vte=be('<div class="library-modal-backdrop svelte-1ehcy4i" role="presentation"><div class="library-modal svelte-1ehcy4i" role="dialog" aria-modal="true" aria-label="My script library"><div class="library-head svelte-1ehcy4i"><div class="library-title svelte-1ehcy4i">My Script Library</div> <div class="library-head-actions svelte-1ehcy4i"><button class="btn btn-xs btn-outline" type="button">Refresh</button> <button class="btn btn-xs btn-outline" type="button">Close</button></div></div> <div class="library-toolbar svelte-1ehcy4i"><input class="input library-search svelte-1ehcy4i" type="search" placeholder="Search scripts"> <div class="library-count svelte-1ehcy4i"> </div></div> <!> <div class="library-body svelte-1ehcy4i"><!></div></div></div>'),Wte=be('<span class="footer-alert-line svelte-1ehcy4i"> </span>'),Hte=be('<span tabindex="0"><span class="footer-alert-icon svelte-1ehcy4i">!</span> <span class="footer-alert-label svelte-1ehcy4i"> </span> <span class="footer-alert-tip svelte-1ehcy4i" role="tooltip"><span class="footer-alert-title svelte-1ehcy4i"> </span> <!></span></span>'),qte=be('<div class="script-studio svelte-1ehcy4i"><div class="studio-header svelte-1ehcy4i"><div class="studio-title svelte-1ehcy4i"><div class="title-dot svelte-1ehcy4i"></div> <div class="title-text-group svelte-1ehcy4i"><div class="title-text svelte-1ehcy4i">Script Studio</div> <div class="title-sub svelte-1ehcy4i">Inline editor · draft → chart</div></div></div> <div class="studio-meta svelte-1ehcy4i"><div class="view-toggle svelte-1ehcy4i"><button type="button" class="svelte-1ehcy4i">Editor</button> <button type="button" class="svelte-1ehcy4i"><span> </span> <!></button> <button type="button" class="svelte-1ehcy4i">Results</button></div> <div class="lang-toggle svelte-1ehcy4i" aria-label="Script mode"><span class="lang-label svelte-1ehcy4i">Mode</span> <select class="lang-select svelte-1ehcy4i"><option>Auto</option><option>JSON</option><option>Pine</option><option>DSL</option><option>JS</option></select></div></div> <div class="studio-actions svelte-1ehcy4i"><!> <button class="ghost svelte-1ehcy4i" type="button" title="Toggle chart labels"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M2 3.5h8M2 6h8M2 8.5h5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span> </span></button> <button class="ghost ghost-secondary svelte-1ehcy4i" type="button"><span>Documentation</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span>Alerts</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span>My Library</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M3 2.5h6v7H3z" stroke="currentColor" stroke-width="1.2"></path><path d="M4 1h4v2H4z" fill="currentColor"></path><path d="M5 7h2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Save</span></button> <button class="ghost svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true"><path d="M6 2a4 4 0 1 1-3.5 2.06" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path><path d="M2.5 2.5v3h3" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path></svg></span> <span>Reset</span></button> <button class="primary svelte-1ehcy4i" type="button"><span class="btn-icon svelte-1ehcy4i"><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true"><path d="M4 3.2v5.6L9 6 4 3.2Z"></path></svg></span> <span> </span></button> <!> <button class="icon svelte-1ehcy4i" type="button" aria-label="Collapse script dock">&times;</button></div></div> <div class="editor-area svelte-1ehcy4i"><div class="editor-shell svelte-1ehcy4i"><div class="editor-main svelte-1ehcy4i"><div class="editor-toolbar svelte-1ehcy4i"><div class="editor-file svelte-1ehcy4i"><span class="file-dot svelte-1ehcy4i"></span> <span class="file-name svelte-1ehcy4i"> </span> <span class="file-meta svelte-1ehcy4i"> </span></div> <div class="editor-hints svelte-1ehcy4i"><span class="hint svelte-1ehcy4i">1. Write or paste script</span> <span class="hint svelte-1ehcy4i">2. Press Run ▶</span></div></div> <div class="editor-scroll svelte-1ehcy4i"><!></div></div> <!></div></div> <!> <!> <!> <!> <div class="studio-footer svelte-1ehcy4i"><div class="footer-left svelte-1ehcy4i"><span></span> <span class="footer-text svelte-1ehcy4i"> </span> <!></div> <div class="footer-right svelte-1ehcy4i"><span class="footer-hint svelte-1ehcy4i">Ctrl/Cmd + S to save</span> <span class="footer-divider svelte-1ehcy4i">•</span> <span class="footer-hint svelte-1ehcy4i">Ctrl/Cmd + Enter to run</span></div></div></div>');function Ute(s,e){Yd(e,!0);let t=bi(e,"code",15,""),n=bi(e,"codeVersion",3,0),o=bi(e,"status",3,null),r=bi(e,"error",3,null),a=bi(e,"runtimeDiagnostics",19,()=>[]),l=bi(e,"backtest",3,null),c=bi(e,"signalEvents",19,()=>[]),f=bi(e,"isRunning",3,!1),u=bi(e,"isOpen",3,!0),d=bi(e,"paneTarget",7,"main"),h=bi(e,"labelsEnabled",3,!0);const p=fm();function v(){const ee=P(t());(typeof t()!="string"||ee!==t())&&(t(ee),i(Si)&&gn&&(_o=!0,gn.setValue(ee),_o=!1)),p("run",{code:ee,params:i(fl),lang:i(Et),backtest:i(Vo)})}const x="https://noti.dutyai.app/auth/chart/scripts",S=ee=>String(ee||"").trim().toLowerCase(),C=ee=>{const oe=String(ee||""),$e=oe.match(/^\s*library\s*\(\s*["']([^"']+)["']/im);if($e)return $e[1];const at=oe.match(/^\s*(indicator|study|strategy)\s*\(\s*["']([^"']+)["']/im);return at?at[2]:null},I=()=>typeof window<"u"?localStorage.getItem("userId"):null,A=ee=>{if(typeof ee=="string")return ee;if(ee==null)return"";try{return JSON.stringify(ee,null,2)}catch{return String(ee)}},P=ee=>{if(typeof ee=="string"){const oe=ee.trim();if(oe.startsWith("{")&&oe.includes('"script"')){try{const $e=JSON.parse(oe);if($e&&typeof $e=="object"&&typeof $e.script=="string"&&($e.userPreferenceId||$e.createdAt||$e.updatedAt))return $e.script}catch{}if(oe.includes('"userPreferenceId"')||oe.includes('"createdAt"')){const $e=oe.match(/"script"\s*:\s*"([\s\S]*?)"\s*,\s*"(?:name|userPreferenceId|createdAt)"/);if($e&&$e[1])try{return JSON.parse(`"${$e[1]}"`)}catch{}}}return ee}if(ee&&typeof ee=="object"){const oe=ee.script??ee.code;if(typeof oe=="string")return oe}return A(ee)};let T=_e(!1),j=_e(!1),E=_e(!1),L=_e(null),D=_e(""),X=_e(H([])),ne=_e(!1),de=_e(""),ie=_e(null),te=_e(!1),le=_e(null);function pe(ee){p("saveStatus",{status:ee})}const re=ee=>{if(typeof ee=="number"&&Number.isFinite(ee))return ee;if(typeof ee=="string"&&ee.trim()){const oe=Date.parse(ee);if(Number.isFinite(oe))return oe}return Date.now()},xe=ee=>{if(!ee)return null;const oe=String(ee.id||ee._id||ee.scriptId||ee.name||"").trim()||`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,$e=String(ee.name||ee.title||"Untitled Script").trim(),at=ee.script??ee.code??ee.source??"",Gt=A(at).trim(),Nt=re(ee.createdAt||ee.created_at),Cs=re(ee.updatedAt||ee.updated_at||Nt);return{id:oe,name:$e,code:Gt,createdAt:Nt,updatedAt:Cs}},se=ee=>[...ee].sort((oe,$e)=>($e.updatedAt||0)-(oe.updatedAt||0));async function Ne(ee=!1){if(i(E)&&!ee)return;b(j,!0),b(L,null);const oe=I();if(!oe){const $e=se(zy());b(X,H($e)),b(E,!0),b(j,!1);return}try{const $e=await fetch(`${x}/${oe}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!$e.ok){const nn=await $e.text();throw new Error(nn||`${$e.status} ${$e.statusText}`)}const at=await $e.json(),Nt=(Array.isArray(at)?at:Array.isArray(at==null?void 0:at.data)?at.data:Array.isArray(at==null?void 0:at.scripts)?at.scripts:[]).map(xe).filter(Boolean),Cs=se(Nt);b(X,H(Cs)),yy(Cs),b(E,!0)}catch{const at=se(zy());b(X,H(at)),b(E,!0),b(L,"Could not reach server. Showing local copies.")}finally{b(j,!1)}}function Te(){b(ne,!0),b(ie,null),b(le,null);const ee=C(P(t()));b(de,H(ee||"")),Ne(!1)}const Me=(ee,oe)=>{const $e=S(ee);return $e?(i(X).length?i(X):zy()).some(Gt=>S(Gt.name)===$e&&Gt.id!==oe):!1};async function De(){if(i(te))return;const ee=String(i(de)||"").trim();if(!ee){b(ie,"Enter a script name to save.");return}if(Me(ee)){b(ie,"That name already exists. Choose a different name.");return}b(te,!0),b(ie,null);const oe=I();try{let $e=null;const at=P(t());if(oe){const Gt=await fetch(`${x}/${oe}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ee,script:at})});if(!Gt.ok){const nn=await Gt.text();throw new Error(nn||`${Gt.status} ${Gt.statusText}`)}const Nt=await Gt.json(),Cs=xe({id:(Nt==null?void 0:Nt.id)||(Nt==null?void 0:Nt.scriptId)||(Nt==null?void 0:Nt._id),name:ee,script:(Nt==null?void 0:Nt.script)||(Nt==null?void 0:Nt.code)||at,createdAt:Nt==null?void 0:Nt.createdAt,updatedAt:Nt==null?void 0:Nt.updatedAt});Cs&&($e=Cs,l6($e))}else $e=JX(ee,at);$e&&(b(X,H(se([$e,...i(X).filter(Gt=>Gt.id!==$e.id)]))),yy(i(X)),pe(`Saved • ${$e.name}`)),b(ne,!1)}catch{b(ie,"Save failed. Please try again.")}finally{b(te,!1)}}async function Oe(ee){if(i(te))return;const oe=i(X).find(Gt=>Gt.id===ee);if(!oe)return;const $e=String(oe.name||"").trim();if(!$e)return;if(Me($e,ee)){b(ie,"Another script already uses this name.");return}b(te,!0),b(ie,null);const at=I();try{let Gt=null;const Nt=P(t());if(at){const Cs=await fetch(`${x}/${ee}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:$e,script:Nt})});if(!Cs.ok){const Xn=await Cs.text();throw new Error(Xn||`${Cs.status} ${Cs.statusText}`)}const nn=await Cs.json(),Xs=xe({id:ee,name:$e,script:(nn==null?void 0:nn.script)||(nn==null?void 0:nn.code)||Nt,createdAt:oe.createdAt,updatedAt:(nn==null?void 0:nn.updatedAt)||Date.now()});Xs&&(Gt=Xs,l6(Gt))}else Gt=QX(ee,{code:Nt,name:$e});Gt&&(b(X,H(se([Gt,...i(X).filter(Cs=>Cs.id!==Gt.id)]))),yy(i(X)),pe(`Saved • ${Gt.name}`)),b(ne,!1)}catch{b(ie,"Update failed. Please try again.")}finally{b(te,!1)}}async function Ke(ee){const oe=i(X).find(Gt=>Gt.id===ee);if(!oe||!(typeof window>"u"?!0:window.confirm(`Delete "${oe.name}"? This cannot be undone.`)))return;const at=I();try{if(at){const Nt=await fetch(`${x}/${ee}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!Nt.ok){const Cs=await Nt.text();throw new Error(Cs||`${Nt.status} ${Nt.statusText}`)}}else eZ(ee);const Gt=i(X).filter(Nt=>Nt.id!==ee);b(X,H(se(Gt))),yy(i(X)),pe(`Deleted • ${oe.name}`)}catch{b(L,"Delete failed. Please try again.")}}async function kt(ee){try{await navigator.clipboard.writeText(String(ee.code||"")),pe(`Copied • ${ee.name}`)}catch{pe("Copy failed")}}async function pt(ee,oe){const $e=P(t()),at=P(ee),Gt=oe!=null&&oe.append&&$e?`${$e}

${at}`.trim():at;t(Gt),i(Si)&&gn&&(_o=!0,gn.setValue(Gt),_o=!1),b(Se,"editor"),await qy(),requestAnimationFrame(()=>As==null?void 0:As.layout()),oe!=null&&oe.run&&v()}function Rt(ee){pt(ee)}async function Ht(ee){await pt(ee.code||""),b(T,!1),pe(`Loaded • ${ee.name}`)}async function Ft(ee){await pt(ee.code||"",{append:!0}),b(T,!1),pe(`Inserted • ${ee.name}`)}async function zt(ee){await pt(ee.code||"",{run:!0}),b(T,!1)}const ut=()=>{const ee=String(i(D)||"").trim().toLowerCase();return ee?i(X).filter(oe=>String(oe.name||"").toLowerCase().includes(ee)):i(X)},nt=ee=>{if(!Number.isFinite(ee))return"";try{return new Date(ee).toLocaleString()}catch{return""}};Xr(()=>{const ee=P(t());ee!==t()&&(t(ee),i(Si)&&gn&&(_o=!0,gn.setValue(ee),_o=!1))});function Je(ee){d()!==ee&&(d(ee),p("pane",{target:ee}))}const it=ee=>{let oe=String(ee||"").trim();return oe=qx(oe).replace(/#.*$/,""),oe=oe.split(";")[0],oe=oe.replace(/,\s*$/,""),oe=oe.replace(/\b(and|or)\b\s*$/i,""),oe=oe.replace(/\$\{[^}]+\}/g,"1"),oe=oe.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),oe=oe.replace(/\bstr\./gi,""),oe=oe.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),oe=oe.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,($e,at,Gt)=>`${String(at).toLowerCase()}_${Gt}`),oe=oe.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),oe=oe.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),oe=R_(oe,{pineV2:!0}).expr,oe=Oy(oe),oe.trim()},ze=new Set(["na","nan","pi","e","true","false"]),Ge=ee=>{const oe=[],$e=at=>{if(!(!at||typeof at!="object"))switch(at.kind){case"Identifier":{const Gt=String(at.name||"").toLowerCase();ze.has(Gt)||oe.push(at.name);return}case"UnaryExpression":$e(at.expr);return;case"BinaryExpression":$e(at.left),$e(at.right);return;case"CallExpression":at.args.forEach(Gt=>$e(Gt));return;default:return}};return $e(ee),oe},xt=["close","open","high","low","hl2","hlc3","ohlc4","volume"],jt=ee=>{const oe=typeof ee=="number"?ee:Number(ee);if(!Number.isFinite(oe)||oe<=0)return"";try{return new Date(oe).toISOString().slice(0,16)}catch{return""}},ft=ee=>{if(!ee)return null;const oe=Date.parse(ee);if(Number.isFinite(oe))return oe;const $e=Number(ee);return Number.isFinite($e)?$e:null},ke=ee=>{const oe=String(ee||"").trim();if(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(oe))return oe.length===4?`#${oe[1]}${oe[1]}${oe[2]}${oe[2]}${oe[3]}${oe[3]}`:oe;const $e=oe.match(/^rgba?\(([^)]+)\)$/i);if($e){const at=$e[1].split(",").map(Gt=>Gt.trim());if(at.length>=3){const Gt=Number(at[0]),Nt=Number(at[1]),Cs=Number(at[2]);if([Gt,Nt,Cs].every(nn=>Number.isFinite(nn))){const nn=Xs=>Math.max(0,Math.min(255,Math.round(Xs))).toString(16).padStart(2,"0");return`#${nn(Gt)}${nn(Nt)}${nn(Cs)}`}}}return"#22c55e"};let Se=_e("editor"),Et=_e("auto"),wt=_e(H(!!h())),Ls=_e(!1),tn=_e("trades"),Gs=_e("compact"),an=_e("compact"),Es=_e(!1);const Ns={setup:{en:{title:"Setup",desc:["Backtest Filters define the time window for the run (date range + session).","Filters do not change results until you press Run again.","Session uses HHMM-HHMM (leave blank for full day).","Compare Runs saves a snapshot (results + inputs) when you press Pin current.","Use Compare to see how parameter changes affect results side-by-side."],examples:["From 2025-01-01 to 2025-03-31 + Session 0930-1600 -> Run shows only those hours.","Pin Run A -> change fast=10 -> Run -> Pin Run B to compare."]},bn:{title:"সেটআপ",desc:["Backtest Filters মানে কোন সময়ের ডেটা নিয়ে টেস্ট করবেন (তারিখ + সেশন)।","ফিল্টার বদলালেই ফল বদলায় না—আবার Run দিলেই নতুন ফল আসবে।","Session ফরম্যাট HHMM-HHMM; ফাঁকা রাখলে পুরো দিন ধরা হয়।","Pin current দিলে ওই মুহূর্তের ফল + ইনপুট সেভ হয়।","Compare দিয়ে ছোট পরিবর্তনের ফল পাশাপাশিই দেখা যায়।"],examples:["From 2025-01-01, To 2025-03-31 + Session 0930-1600 দিলে শুধু ওই সময়ের ফল।","Run A Pin -> fast=10 দিন -> Run -> Pin -> দুইটা রানের ফল তুলনা।"]}},performance:{en:{title:"Performance Snapshot",desc:["Trades means a complete position: entry -> exit. For long it is buy->sell; for short it is sell->buy.","Net PnL is your real profit after fees; Return (%) compares that to your starting capital.","Max Drawdown is the biggest fall from a previous peak; smaller is safer.","Profit Factor > 1 means total wins are larger than total losses; Expectancy is avg profit per trade.","Sharpe/Sortino show risk-adjusted return; Exposure shows how long you were in the market."],examples:["A 60% win rate with negative Net PnL means losses are larger than wins.","A smooth, slowly rising equity curve usually means lower risk."]},bn:{title:"পারফরম্যান্স স্ন্যাপশট",desc:["Trades মানে সম্পূর্ণ একটি পজিশন: entry থেকে exit। Long হলে buy->sell, short হলে sell->buy।","Net PnL হলো আসল লাভ/ক্ষতি: মোট লাভ থেকে ফি/চার্জ বাদ।","Return (%) দেখায় শুরু করা টাকার তুলনায় কত শতাংশ লাভ/ক্ষতি হলো।","Max Drawdown মানে আগের সর্বোচ্চ লেভেল থেকে সবচেয়ে বড় পতন—এটা যত কম, তত নিরাপদ।","Profit Factor > 1 হলে লাভ ক্ষতির চেয়ে বেশি; Expectancy হলো প্রতি ট্রেডে গড় লাভ/ক্ষতি।","Sharpe/Sortino বলে একই লাভ করতে কত ঝুঁকি নিয়েছেন; Exposure দেখায় কত সময় ট্রেডে ছিলেন।"],examples:["Win rate বেশি হলেও Net negative হলে loss-গুলো বড় হয়েছে।","কম Drawdown + ধীরে ওপরে ওঠা curve মানে স্টেবল ট্রেডিং।"]}},behavior:{en:{title:"Trade Behavior",desc:["Long vs Short splits performance by direction.","Per-Signal Stats groups trades by signal ID so you can see what works.","Signals with low Net/PF are usually the ones to fix or remove.","Use this section to debug entries/exits, not just profitability."],examples:["Short trades = 0 means a long-only strategy.","If EXIT_FULL is net negative, your exit logic may be hurting results."]},bn:{title:"ট্রেড বিহেভিয়ার",desc:["Long বনাম Short আলাদা করে দেখায় কোন দিক বেশি কাজ করেছে।","Per-Signal Stats দেখায় কোন signal ID লাভ/ক্ষতি দিচ্ছে।","যে signal বারবার ক্ষতি করে, সেটি পরিবর্তন বা বন্ধ করতে পারবেন।","Trades/Net/PF দেখে বোঝা যায় কোনটা শক্তিশালী।"],examples:["Short ট্রেড 0 হলে long-only।","EXIT_FULL যদি net negative হয়, exit logic ঠিক করুন।"]}},optimization:{en:{title:"Optimization",desc:["Optimization only works if your script defines input.int or input.float.","Param A/B choose which inputs to sweep.","From/To/Step sets the grid values for each parameter.","Total runs = count(A) x count(B); too many combos triggers a warning.","Metric controls ranking (Max DD: lower is better).","Walk-forward splits Train/Test so results are more realistic."],examples:["Fast 5->20 step 5 gives 4 values; Slow 20->60 step 10 gives 5 values -> 20 runs.","Top row is best by the chosen metric."]},bn:{title:"অপ্টিমাইজেশন",desc:["Optimization কাজ করবে শুধু input.int বা input.float থাকলে।","Param A/B মানে কোন ইনপুটের মান ঘুরিয়ে দেখা হবে।","From/To/Step দিয়ে রেঞ্জ সেট হয়।","মোট রান = A-র মান x B-র মান (খুব বেশি হলে warning আসবে)।","Metric অনুযায়ী র‍্যাংক হয় (Max DD হলে কম মান ভালো)।","Walk-forward দিলে Train/Test আলাদা হয়ে বাস্তবসম্মত ফল পাওয়া যায়।"],examples:["Fast 5->20 step 5 = 4 মান; Slow 20->60 step 10 = 5 মান -> মোট 20 রান।","Top row মানে সেরা ফল।"]}},charts:{en:{title:"Charts",desc:["Equity curve (area + line) shows how your balance moved over time.","Buy & Hold line is the benchmark: what if you just held.","Drawdown chart shows the depth of pullbacks from peaks.","Range buttons only change the chart window, not the backtest itself."],examples:["Equity above Buy & Hold means the strategy outperformed holding.","Hover to see the exact date and equity value."]},bn:{title:"চার্টস",desc:["Equity curve (area + line) দেখায় আপনার ব্যালেন্স সময়ের সাথে কেমন বদলেছে।","Buy & Hold line হলো তুলনা—শুধু ধরে রাখলে কী হতো।","Drawdown chart দেখায় সবচেয়ে বড় পতন কত % ছিল।","1M/3M/6M/All শুধু চার্ট রেঞ্জ বদলায়, ট্রেড রেজাল্ট নয়।"],examples:["Equity line যদি Buy & Hold-এর উপরে থাকে, স্ট্র্যাটেজি ভালো।","Hover করলে নির্দিষ্ট দিনের equity দেখা যায়।"]}},returns:{en:{title:"Returns",desc:["Monthly/Weekly returns show which periods were good or bad.","Click a row to filter trades for that period.","Great for spotting seasonality or outlier months.","Empty means there were no trades in that period."],examples:["2025-02 +3.2% means that month was profitable.","Click a week row, then open Trades table to see those trades."]},bn:{title:"রিটার্নস",desc:["Monthly/Weekly রিটার্নস দেখায় কোন সময় ভালো বা খারাপ গেছে।","Row ক্লিক করলে ওই সময়ের ট্রেড ফিল্টার হয়।","Seasonality ধরতে কাজে লাগে।","ডেটা না থাকলে ওই সময় ট্রেড হয়নি।"],examples:["2025-02 মাসে +3.2% মানে লাভ।","Week row ক্লিক করলে Trades টেবিলে ফিল্টার হয়।"]}},distributions:{en:{title:"Distributions",desc:["PnL% histogram shows how trade outcomes are spread.","MAE% = worst adverse move; MFE% = best favorable move.","Duration shows how long trades usually last (in bars).","Use these to tune stops, targets, and holding time."],examples:["If most PnL% bins are small, results are consistent but modest.","High MAE suggests trades go deep negative before exit."]},bn:{title:"ডিস্ট্রিবিউশন",desc:["PnL% histogram দেখায় ফলাফল কোন রেঞ্জে বেশি হচ্ছে।","MAE% = সবচেয়ে খারাপ adverse move; MFE% = সবচেয়ে ভালো move।","Duration দিয়ে ট্রেড কত বার ধরে থাকে বোঝা যায়।","এগুলো দেখে stop-loss/TP টিউন করা যায়।"],examples:["PnL% ছোট রেঞ্জে বেশি মানে consistent ছোট লাভ।","MAE বেশি হলে ট্রেড আগে অনেক নিচে যায়।"]}},exports:{en:{title:"Exports & Totals",desc:["Open Trades/Orders tables to inspect each trade and order.","CSV exports are for Excel/Sheets or external analysis.","Totals summarize gross profit, gross loss, net, initial/final equity.","Filtered trades CSV respects the current month/week filter."],examples:["Use Trades CSV to build custom reports.","Total = Gross Profit - Gross Loss (fees shown separately)."]},bn:{title:"এক্সপোর্টস ও টোটালস",desc:["Trades/Orders টেবিলে প্রতিটি ট্রেডের Net PnL/fees/price দেখা যায়।","CSV ডাউনলোড করে Excel/Sheets-এ বিশ্লেষণ করা যায়।","Totals-এ gross profit, gross loss, net, initial/final equity দেখা যায়।","Filtered trades CSV বর্তমান ফিল্টার মেনে চলে।"],examples:["Trades CSV দিয়ে custom রিপোর্ট বানান।","Total = Gross Profit - Gross Loss (fees আলাদা)।"]}}};let Hs=_e(!1),ns=_e("setup"),fs=_e("bn");function Mn(ee){b(ns,H(ee)),b(Hs,!0)}let po=_e(H([])),Tn=_e("");function Cn(ee){b(po,H(i(po).filter(at=>at.id!==ee))),i(br)===ee&&b(br,null);const{[ee]:oe,...$e}=i(Wc);b(Wc,H($e))}let go=_e(""),no=_e(""),Bo=_e("");const Vo=Lt(()=>{const ee={},oe=i(go).trim(),$e=i(no).trim(),at=i(Bo).trim();return oe&&(ee.from=oe),$e&&(ee.to=$e),at&&(ee.session=at),Object.keys(ee).length?ee:null}),Rl=Lt(()=>!!i(Vo)),aa=Lt(()=>{const ee=[];return(i(go)||i(no))&&ee.push(`${i(go)||"…"} → ${i(no)||"…"}`),i(Bo)&&ee.push(`Session ${i(Bo)}`),ee.join(" • ")}),tl=Lt(()=>i(Ol).filter(ee=>ee.type==="int"||ee.type==="float"));let Zr=_e(!1),zi=_e(""),Nl=_e(""),mu=_e(0),Gc=_e(0),du=_e(1),Ju=_e(0),rd=_e(0),Al=_e(1),sa=_e("netPnl"),Vc=_e(!1),vu=_e(H([])),Qc=_e(0),To=_e(!1),ec=_e(H([])),yl=_e(""),Dc=_e(!1),jl=_e(70),qi=_e("train"),la=_e(null),El=_e(0);const qu=Lt(()=>i(vu).length),Td=Lt(()=>i(qu)>0?Math.min(100,Math.round(i(Qc)/i(qu)*100)):0),ki=Lt(()=>[...i(ec)].sort((ee,oe)=>bo(oe.summary)-bo(ee.summary))),sl=Lt(()=>i(sa)==="profitFactor"?"Profit Factor":i(sa)==="sharpe"?"Sharpe":i(sa)==="winRate"?"Win Rate":i(sa)==="maxDrawdownPct"?"Max DD (lower is better)":"Net PnL");let br=_e(null),Wc=_e(H({}));function Xd(ee){b(br,H(i(br)===ee?null:ee))}function Uf(ee){b(Wc,H({...i(Wc),[ee]:!i(Wc)[ee]}))}function xf(ee,oe=40){if(ee==null)return"—";let $e="";if(typeof ee=="number"||typeof ee=="boolean")$e=String(ee);else if(typeof ee=="string")$e=ee;else try{$e=JSON.stringify(ee)}catch{$e=String(ee)}return oe>0&&$e.length>oe?`${$e.slice(0,oe-1)}…`:$e}function Uu(ee){return ee?Object.entries(ee).slice(0,6).map(([oe,$e])=>`${oe}=${xf($e,18)}`).join(", "):"-"}const tp=ee=>[{label:"Final",value:io(ee.finalEquity,2)},{label:"Net",value:`${ee.netPnl>=0?"+":""}${io(ee.netPnl,2)} (${tu(ee.netPnlPct??0)})`},{label:"DD",value:tu(ee.maxDrawdownPct??0)},{label:"PF",value:jc(ee.profitFactor??0)},{label:"Win",value:tu(ee.winRate??0)},{label:"Trades",value:String(ee.trades??0)},{label:"Sharpe",value:jc(ee.sharpe??0)},{label:"Sortino",value:jc(ee.sortino??0)},{label:"Exposure",value:tu(ee.exposurePct??0)},{label:"Bars/Trade",value:io(ee.avgBarsInTrade??0,1)}];function wf(ee){try{return JSON.stringify({label:ee.label,ts:ee.ts,params:ee.params,summary:ee.summary},null,2)}catch{return String(ee.summary)}}function Vs(ee){const oe=i(tl).find(Cs=>Cs.name===ee),$e=typeof(oe==null?void 0:oe.defval)=="number"?oe.defval:0,at=typeof(oe==null?void 0:oe.minval)=="number"?oe.minval:$e,Gt=typeof(oe==null?void 0:oe.maxval)=="number"?oe.maxval:$e,Nt=typeof(oe==null?void 0:oe.step)=="number"?oe.step:(oe==null?void 0:oe.type)==="int"?1:.1;return{from:at,to:Gt,step:Nt}}function kn(ee){b(zi,H(ee));const oe=Vs(ee);b(mu,H(oe.from)),b(Gc,H(oe.to)),b(du,H(oe.step))}function Kn(ee){if(b(Nl,H(ee)),!ee)return;const oe=Vs(ee);b(Ju,H(oe.from)),b(rd,H(oe.to)),b(Al,H(oe.step))}Xr(()=>{i(Zr)||i(tl).length&&(kn(i(tl)[0].name),i(tl).length>1&&Kn(i(tl)[1].name),b(Zr,!0))});function Bs(ee,oe,$e,at){const Gt=i(tl).find(Zn=>Zn.name===ee),Nt=(Gt==null?void 0:Gt.type)==="int",Cs=Math.abs(at||1);if(!Number.isFinite(oe)||!Number.isFinite($e)||!Number.isFinite(Cs)||Cs<=0)return[];const nn=[],Xs=oe<=$e?1:-1;let Xn=oe,ho=0;for(;Xs>0&&Xn<=$e+1e-9||Xs<0&&Xn>=$e-1e-9;){const Zn=Nt?Math.round(Xn):Number(Xn.toFixed(6));if(nn.push(Zn),Xn+=Cs*Xs,ho+=1,ho>2e3)break}return Array.from(new Set(nn))}function bo(ee){return ee?i(sa)==="profitFactor"?ee.profitFactor??0:i(sa)==="sharpe"?ee.sharpe??0:i(sa)==="winRate"?ee.winRate??0:i(sa)==="maxDrawdownPct"?-(ee.maxDrawdownPct??0):ee.netPnl??0:-1/0}function lo(ee){return ee?i(sa)==="profitFactor"?ee.profitFactor??0:i(sa)==="sharpe"?ee.sharpe??0:i(sa)==="winRate"?ee.winRate??0:i(sa)==="maxDrawdownPct"?ee.maxDrawdownPct??0:ee.netPnl??0:0}function Qi(ee){const oe=lo(ee);return i(sa)==="winRate"||i(sa)==="maxDrawdownPct"?tu(oe):io(oe,2)}function xr(ee){const oe=i(Vo)&&typeof i(Vo)=="object"?{...i(Vo)}:null;return!oe&&!ee?null:{...oe||{},...ee||{}}}function Ai(ee){if(!i(vu).length)return;const oe=i(vu)[ee];if(!oe)return;const $e=i(Dc)?ri(i(qi)):null,at=xr($e);b(To,!0),p("run",{code:t(),params:oe.params,lang:i(Et),backtest:at})}function ri(ee){var Nt,Cs;if(!i(yu).length)return null;const oe=Number((Nt=i(yu)[0])==null?void 0:Nt.timestamp),$e=Number((Cs=i(yu)[i(yu).length-1])==null?void 0:Cs.timestamp);if(!Number.isFinite(oe)||!Number.isFinite($e)||$e<=oe)return null;const at=Math.max(10,Math.min(90,Number(i(jl))||70))/100,Gt=Math.round(oe+($e-oe)*at);return ee==="train"?{from:oe,to:Gt}:{from:Gt,to:$e}}Xr(()=>{var Nt;if(!i(Vc)||!i(To)||f())return;const ee=Ag(l()),oe=Number((ee==null?void 0:ee._updatedAt)??0),$e=Number(Ag(i(El)));if(!ee||!oe||oe===$e)return;b(El,H(oe)),b(To,!1);const at=((Nt=i(vu)[i(Qc)])==null?void 0:Nt.params)||{},Gt=ee.summary;if(Gt&&(b(ec,H([...i(ec),{params:at,summary:Gt}])),i(Dc)&&i(qi)==="test"&&b(la,H({params:at,summary:Gt}))),b(Qc,i(Qc)+1),i(Qc)<i(vu).length)Ai(i(Qc));else if(i(Dc)&&i(qi)==="train"){const Cs=[...i(ec)].sort((nn,Xs)=>bo(Xs.summary)-bo(nn.summary))[0];Cs?(b(vu,H([{params:Cs.params}])),b(Qc,0),b(qi,"test"),Ai(0)):b(Vc,!1)}else b(Vc,!1)});const Ti=Lt(()=>i(Et)==="auto"?"auto":i(Et)),Eo=ee=>{const oe=String(ee||"").trim();return oe.startsWith("{")||oe.startsWith("[")},hr=ee=>{const oe=String(ee||"");return/^\s*\/\/@\s*(?:pine|version)\b/m.test(oe)||/\b(strategy|indicator|library|plot)\s*\(/m.test(oe)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(oe)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(oe)},ei=ee=>{const oe=String(ee||"").split(/\r?\n/),$e=Math.min(8,oe.length);for(let at=0;at<$e;(at+=1)-1){const Nt=(oe[at]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!Nt)continue;const Cs=String(Nt[1]||"").toLowerCase();if(Cs==="auto"||Cs==="json"||Cs==="pine"||Cs==="dsl"||Cs==="js")return Cs}return null},ai=Lt(()=>{if(i(Et)!=="auto")return i(Et);const ee=ei(t());return ee||(Eo(t())?"json":"auto")});Xr(()=>{b(wt,H(!!h()))});const vi=Lt(()=>i(Se)==="results");function _a(){b(Es,!1),p("fullpage",{enabled:!1})}sm(()=>{const ee=oe=>{i(Es)&&oe.key==="Escape"&&(oe.preventDefault(),_a())};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)}),sm(async()=>{if(!(typeof window>"u")&&i(Ct)==="idle"){b(Ct,"loading");try{dZ();const ee=await Vv(()=>import("../chunks/editor.api.BiPlqzrK.js").then(at=>at.m),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url);if(await Promise.all([Vv(()=>import("../chunks/monaco.contribution.hU7iWkca.js"),__vite__mapDeps([15,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Vv(()=>import("../chunks/monaco.contribution.CPuGIZ1w.js"),__vite__mapDeps([16,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Vv(()=>import("../chunks/monaco.contribution.C7yQ60ma.js"),__vite__mapDeps([17,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Vv(()=>import("../chunks/monaco.contribution.aFG-n5X_.js"),__vite__mapDeps([18,7,8,0,1,2,3,4,5,6,9,10,11,12,13,14]),import.meta.url),Vv(()=>import("../chunks/suggestController.TAqXY2ko.js"),__vite__mapDeps([19,1,2,3,4,5,6,12,20,21,22]),import.meta.url),Vv(()=>import("../chunks/parameterHints.StIp-S_A.js"),__vite__mapDeps([23,2,1,3,24]),import.meta.url),Vv(()=>import("../chunks/hoverContribution.CisGEAg6.js"),__vite__mapDeps([25,2,1,3,11,4,5,6,20,21,9,10,26]),import.meta.url),Vv(()=>import("../chunks/formatActions.BuL_rer4.js"),__vite__mapDeps([27,2,4,13,11]),import.meta.url)]),xn=ee,nu(ee),$r(ee),$a(ee),await qy(),!i(Ks)){b(Ct,"failed");return}const oe=wa(String(t()||""));b(oo,H(oe)),gn=ee.editor.createModel(String(t()||""),oe),As=ee.editor.create(i(Ks),{model:gn,automaticLayout:!0,minimap:{enabled:!1},fontSize:13,fontFamily:'JetBrains Mono, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace',lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:oe==="pine"?"off":"on",theme:yc(),quickSuggestions:{other:!0,comments:!1,strings:!0},suggestOnTriggerCharacters:!0,parameterHints:{enabled:!0},inlineSuggest:{enabled:!0},tabCompletion:"on",snippetSuggestions:"inline",wordBasedSuggestions:!1,quickSuggestionsDelay:40}),As.addAction({id:"scriptstudio.format",label:"Format Document",keybindings:[ee.KeyMod.CtrlCmd|ee.KeyMod.Shift|ee.KeyCode.KeyF],run:()=>As==null?void 0:As.getAction("editor.action.formatDocument").run()}),Sn.push(As.onDidType(at=>{if(As&&(at==="."||at==="("))try{const Gt=As.getAction("editor.action.triggerSuggest");Gt?Gt.run():As.trigger("keyboard","editor.action.triggerSuggest",{})}catch{}})),Sn.push(As.onDidChangeModelContent(at=>{if(!gn||_o)return;Uo+=1;const Gt=Uo;si&&clearTimeout(si);const Nt=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Nt&&Gn!=null&&Nt(Gn),Gn=null;const nn=(Array.isArray(at==null?void 0:at.changes)?at.changes.reduce((Xs,Xn)=>Xs+String((Xn==null?void 0:Xn.text)||"").length,0):0)>800?180:60;si=setTimeout(()=>{const Xs=()=>{if(!gn||_o||Gt!==Uo)return;const ho=gn.getValue();Yn=!0,ho!==t()&&t(ho),Yn=!1},Xn=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Xn&&nn>60?Gn=Xn(Xs,{timeout:250}):Xs()},nn)}));const $e=new MutationObserver(()=>{xn&&xn.editor.setTheme(yc())});if($e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),$e.observe(document.body,{attributes:!0,attributeFilter:["data-theme"]}),Sn.push({dispose:()=>$e.disconnect()}),Sn.push({dispose:()=>{si&&clearTimeout(si),si=null;const at=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;at&&Gn!=null&&at(Gn),Gn=null}}),typeof ResizeObserver<"u"){const at=new ResizeObserver(()=>{As==null||As.layout()});i(Ks)&&at.observe(i(Ks)),Sn.push({dispose:()=>at.disconnect()})}b(Ct,"ready"),ti()}catch(ee){console.warn("[ScriptStudio] Monaco init failed:",ee),b(Ct,"failed")}}}),Rg(()=>{try{i(Es)&&p("fullpage",{enabled:!1})}catch{}Sn.forEach(ee=>ee.dispose()),Sn=[],As==null||As.dispose(),gn==null||gn.dispose(),As=null,gn=null});const dl=Lt(()=>{try{if(!Eo(String(t()||"")))return!1;const ee=JSON.parse(String(t()||"").trim());return!!(ee!=null&&ee.strategy)}catch{return!1}}),ar=Lt(()=>{try{if(!Eo(String(t()||"")))return!1;const ee=JSON.parse(String(t()||"").trim());return Array.isArray(ee==null?void 0:ee.signals)&&ee.signals.length>0}catch{return!1}});let Jr=_e(""),nl=_e(null);Xr(()=>{const ee=String(t()||""),oe=i(ai);if(!(oe==="pine"||oe==="auto"&&hr(ee))){b(Jr,""),b(nl,null);return}let at=!1,Gt=null;const Nt=ee,Cs=()=>{if(!at&&Nt===String(t()||""))try{const Xs=gx(Nt);if(at||Nt!==String(t()||""))return;b(Jr,H(Nt)),b(nl,H(Xs))}catch{if(at||Nt!==String(t()||""))return;b(Jr,H(Nt)),b(nl,null)}},nn=setTimeout(()=>{const Xs=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Xs?Gt=Xs(Cs,{timeout:250}):Cs()},160);return()=>{at=!0,clearTimeout(nn);const Xs=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Xs&&Gt!=null&&Xs(Gt)}});const tc=Lt(()=>{const ee=i(nl);return!!(ee&&ee.ok&&ee.spec&&ee.spec.strategy)}),mc=Lt(()=>{const ee=i(nl),oe=ee&&ee.ok&&ee.spec?ee.spec.signals:null;return Array.isArray(oe)&&oe.length>0}),gu=Lt(()=>!!(i(dl)||i(tc))),Bl=Lt(()=>!!(i(ar)||i(mc))),Ui=Lt(()=>{const ee=i(nl);return!ee||!ee.ok?[]:Array.isArray(ee.warnings)?ee.warnings:[]}),Ol=Lt(()=>{const ee=i(nl);return!ee||!ee.ok?[]:Array.isArray(ee.inputDefs)?ee.inputDefs:[]});let fl=_e(null);Xr(()=>{if(!i(Ol).length){b(fl,null);return}i(fl)==null&&b(fl,H({}))});const bl=Lt(()=>{const ee={};for(const oe of i(Ol))ee[oe.name]=i(fl)&&oe.name in i(fl)?i(fl)[oe.name]:oe.defval;return ee}),Ua=(ee,oe)=>{b(fl,H({...i(fl)||{},[ee]:oe}))},er=Lt(()=>{var ee;return((ee=l())==null?void 0:ee.summary)||null}),ba=Lt(()=>{if(!i(vi))return{total:0,entryLong:0,exitLong:0,entryShort:0,exitShort:0,lastTs:null};const ee=Array.isArray(c())?c():[],oe={total:ee.length,entryLong:0,exitLong:0,entryShort:0,exitShort:0};let $e=null;for(const at of ee){if(!at)continue;at.type==="entry_long"?oe.entryLong+=1:at.type==="exit_long"?oe.exitLong+=1:at.type==="entry_short"?oe.entryShort+=1:at.type==="exit_short"&&(oe.exitShort+=1);const Gt=Number(at.timestamp);Number.isFinite(Gt)&&($e=$e==null?Gt:Math.max($e,Gt))}return{...oe,lastTs:$e}}),ol=Lt(()=>{var ee;return i(vi)&&Array.isArray((ee=l())==null?void 0:ee.trades)?l().trades:[]}),xd=Lt(()=>{var ee;return i(vi)&&Array.isArray((ee=l())==null?void 0:ee.orders)?l().orders:[]}),_u=ee=>{const oe=typeof ee=="number"?ee:Number(ee);return!Number.isFinite(oe)||oe<=0?null:oe<1e12?oe*1e3:oe},eu=ee=>{const oe=_u(ee);if(oe==null)return"-";try{const at=new Date(oe).toISOString();return`${at.slice(0,10)} ${at.slice(11,16)}`}catch{return"-"}},ca=ee=>{const oe=typeof ee=="number"?ee:Number(ee);return Number.isFinite(oe)?oe:null},vc=Lt(()=>{var Gt;const ee=i(vi)&&Array.isArray((Gt=l())==null?void 0:Gt.roundTrips)?l().roundTrips:[],oe=i(ol).length===0&&ee.length>0,$e=(oe?ee:i(ol)).filter(Nt=>Nt&&Number.isFinite(Number(Nt.entryIndex))&&Number.isFinite(Number(Nt.exitIndex))).slice().sort((Nt,Cs)=>Number(Nt.exitIndex)-Number(Cs.exitIndex)||Number(Nt.entryIndex)-Number(Cs.entryIndex));let at=0;return $e.map((Nt,Cs)=>{const nn=ca(Nt.pnl??Nt.grossPnl??Nt.profit),Xs=ca(Nt.fees??Nt.fee??Nt.commission),Xn=oe&&Number.isFinite(Number(Nt.netPnl))?Number(Nt.netPnl):(nn??0)-(Xs??0);at+=Xn;const ho=_u(Nt.entryTimestamp),Zn=_u(Nt.exitTimestamp),Go=eu(ho),mi=eu(Zn),$o=[Nt.side||"",Nt.entryIndex,Nt.exitIndex,ho??0,Zn??0,Nt.entryOrderId??"",Nt.exitOrderId??"",Cs].join(":"),kl=ca(oe?Nt.avgEntryPrice??Nt.entryPrice??Nt.entry:Nt.entryPrice??Nt.entry_price??Nt.entry),Fl=ca(oe?Nt.avgExitPrice??Nt.exitPrice??Nt.exit:Nt.exitPrice??Nt.exit_price??Nt.exit);return{id:$o,side:String(Nt.side||""),qty:ca(Nt.qty??Nt.size??Nt.qtyEntered)??0,entryIndex:Number(Nt.entryIndex)||0,exitIndex:Number(Nt.exitIndex)||0,entryTimestamp:ho,exitTimestamp:Zn,entryTimeLabel:Go,exitTimeLabel:mi,entryPrice:kl??0,exitPrice:Fl??0,entrySignalId:Nt.entrySignalId!=null?String(Nt.entrySignalId):"",exitSignalId:Nt.exitSignalId!=null?String(Nt.exitSignalId):"",pnl:nn??0,pnlPct:ca(Nt.pnlPct??Nt.pnl_pct??Nt.returnPct)??0,fees:Xs??0,netPnl:Xn,cumNet:at,exitReason:String(Nt.exitReason||""),maePct:Number.isFinite(Number(Nt.maePct))?Number(Nt.maePct):null,mfePct:Number.isFinite(Number(Nt.mfePct))?Number(Nt.mfePct):null,barsHeld:Math.max(0,(Number(Nt.exitIndex)||0)-(Number(Nt.entryIndex)||0)+1)}})}),rc=Lt(()=>i(xd).filter(oe=>oe&&Number.isFinite(Number(oe.createdIndex))).slice().sort((oe,$e)=>Number(oe.createdIndex)-Number($e.createdIndex)||String(oe.id||"").localeCompare(String($e.id||""))).map((oe,$e)=>{const at=_u(oe.createdTimestamp),Gt=_u(oe.filledTimestamp),Nt=String(oe.kind||"").toLowerCase(),Cs=String(oe.action||""),nn=String(oe.side||""),Xs=String(oe.status||""),Xn=ca(oe.qty??oe.quantity),ho=ca(oe.cash),Zn=ca(oe.price),Go=ca(oe.stopPrice),mi=ca(oe.limitPrice),$o=oe.tif!=null?String(oe.tif).toUpperCase():"",kl=ca(oe.remainingQty),Fl=ca(oe.targetQty),il=ca(oe.trailPct),Ya=ca(oe.trailOffset),Kl=ca(oe.trailPrice),ru=String(Xs||"").toLowerCase().replace(/[^a-z0-9]+/g,"-");return{id:String(oe.id||$e),action:Cs,actionLabel:su(Cs),side:nn,sideLabel:su(nn),kind:String(oe.kind||""),kindLabel:sd(oe.kind),originalKind:String(oe.originalKind||""),status:Xs,statusLabel:su(Xs),statusKey:ru,signalId:oe.signalId!=null?String(oe.signalId):"",ocoGroup:oe.ocoGroup!=null?String(oe.ocoGroup):"",createdIndex:Number(oe.createdIndex)||0,createdTimestamp:at,createdTimeLabel:eu(at),activeFromIndex:Number(oe.activeFromIndex)||0,expiresAtIndex:Number.isFinite(Number(oe.expiresAtIndex))?Number(oe.expiresAtIndex):null,qtyPct:Number(oe.qtyPct)||0,qty:Xn,cash:ho,tif:$o,remainingQty:kl,targetQty:Fl,trailPct:il,trailOffset:Ya,trailPrice:Kl,price:Zn,stopPrice:Go??(Nt==="stop"?Zn:null),limitPrice:mi??(Nt==="limit"?Zn:null),filledIndex:Number.isFinite(Number(oe.filledIndex))?Number(oe.filledIndex):null,filledTimestamp:Gt,filledTimeLabel:eu(Gt),fillPrice:ca(oe.fillPrice),fillQty:ca(oe.fillQty),fees:ca(oe.fees),note:oe.note!=null?String(oe.note):""}})),wd=Lt(()=>i(rc).length>500?i(rc).slice(i(rc).length-500):i(rc));let zl=_e(H({type:"all"})),Fd=_e(""),Tl=_e(H({key:"exitIndex",dir:"desc"}));function xa(ee){i(Tl).key===ee?b(Tl,H({key:ee,dir:i(Tl).dir==="asc"?"desc":"asc"})):b(Tl,H({key:ee,dir:"desc"}))}function ku(ee){return i(Tl).key!==ee?"":i(Tl).dir==="asc"?"↑":"↓"}const Qu=Lt(()=>{const ee=i(vc),oe=nn=>{const Xs=Number(nn==null?void 0:nn.exitTimestamp);return!Number.isFinite(Xs)||Xs<=0?!1:i(zl).type==="month"?ce(Xs)===i(zl).key:i(zl).type==="week"?G(Xs)===i(zl).key:!0},$e=i(Fd).trim().toLowerCase(),at=i(zl).type==="all"?ee:ee.filter(oe),Gt=$e?at.filter(nn=>[nn.side,nn.exitReason,nn.entrySignalId,nn.exitSignalId,String(nn.entryIndex),String(nn.exitIndex)].filter(Boolean).map(Xn=>String(Xn).toLowerCase()).some(Xn=>Xn.includes($e))):at,Nt=i(Tl).dir==="asc"?1:-1,Cs=i(Tl).key;return Gt.slice().sort((nn,Xs)=>{const Xn=nn==null?void 0:nn[Cs],ho=Xs==null?void 0:Xs[Cs];if(Cs==="side")return String(Xn).localeCompare(String(ho))*Nt;const Zn=typeof Xn=="number"?Xn:Number(Xn),Go=typeof ho=="number"?ho:Number(ho);return!Number.isFinite(Zn)&&!Number.isFinite(Go)?0:Number.isFinite(Zn)?Number.isFinite(Go)?(Zn-Go)*Nt:-1:1})}),ed=ee=>{const oe=ee.length;let $e=0,at=0,Gt=0,Nt=0,Cs=0,nn=0,Xs=0,Xn=0,ho=0;for(const Fl of ee){const il=Number(Fl==null?void 0:Fl.netPnl)||0,Ya=Number(Fl==null?void 0:Fl.fees)||0,Kl=Number(Fl==null?void 0:Fl.pnl)||0;Gt+=il,Nt+=Ya,Cs+=Kl,Kl>0?nn+=Kl:Kl<0&&(Xs+=Math.abs(Kl)),il>0?($e+=1,Xn+=il):il<0&&(at+=1,ho+=il)}const Zn=oe?$e/oe*100:0,Go=$e?Xn/$e:0,mi=at?ho/at:0,$o=Xs>0?nn/Xs:nn>0?1/0:0,kl=oe?$e/oe*Go+at/oe*mi:0;return{trades:oe,wins:$e,losses:at,winRate:Zn,net:Gt,fees:Nt,gross:Cs,grossProfit:nn,grossLoss:Xs,profitFactor:$o,avgWin:Go,avgLoss:mi,expectancy:kl}},td=Lt(()=>{const ee=i(vc).filter($e=>String($e.side)==="long"),oe=i(vc).filter($e=>String($e.side)==="short");return{long:ed(ee),short:ed(oe)}}),sp=Lt(()=>{const ee=i(vc),oe=new Map;for(const at of ee){const Gt=String(at.entrySignalId||at.exitSignalId||"unknown"),Nt=oe.get(Gt)||[];Nt.push(at),oe.set(Gt,Nt)}const $e=Array.from(oe.entries()).map(([at,Gt])=>({id:at,...ed(Gt)}));return $e.sort((at,Gt)=>(Gt.net||0)-(at.net||0)),$e}),Gf=Lt(()=>{const ee=i(vc).map(oe=>Number(oe==null?void 0:oe.pnlPct)).filter(oe=>Number.isFinite(oe));return Xt(ee,12)}),kd=Lt(()=>{const ee=i(vc).map(oe=>Number(oe==null?void 0:oe.maePct)).filter(oe=>Number.isFinite(oe));return Xt(ee,10)}),Zd=Lt(()=>{const ee=i(vc).map(oe=>Number(oe==null?void 0:oe.mfePct)).filter(oe=>Number.isFinite(oe));return Xt(ee,10)}),gc=Lt(()=>{const ee=i(vc).map(oe=>Number(oe==null?void 0:oe.barsHeld)).filter(oe=>Number.isFinite(oe));return Xt(ee,10)}),jf=Lt(()=>i(Qu).length>500?i(Qu).slice(i(Qu).length-500):i(Qu)),Nf=Lt(()=>i(vc).reduce((ee,oe)=>ee+(Number(oe.netPnl)||0),0));let Jd=_e(null);function xl(ee){b(Jd,H((ee==null?void 0:ee.id)||null)),p("selectTrade",{trade:ee||null})}function Su(ee){ee&&(xl(ee),$u())}function ad(ee){ee&&(p("focusOrder",{order:ee}),$u())}function Af(ee){b(zl,H(ee)),i(Jd)&&(i(Qu).some($e=>$e.id===i(Jd))||b(Jd,null))}function fu(ee){b(tn,H(ee)),b(Ls,!0)}function $u(){b(Ls,!1)}const yu=Lt(()=>{var ee;return i(vi)&&Array.isArray((ee=l())==null?void 0:ee.equity)?l().equity:[]}),Yf=Lt(()=>{var ee;return i(vi)&&Array.isArray((ee=l())==null?void 0:ee.benchmark)?l().benchmark:[]});let Ga=_e("6m");function nf(ee,oe){var Nt;if(!Array.isArray(ee)||ee.length===0)return[];if(oe==="all")return ee;const $e=Number((Nt=ee[ee.length-1])==null?void 0:Nt.timestamp);if(!Number.isFinite($e)||$e<=0)return ee;const at=oe==="1w"?7:oe==="1m"?30:oe==="3m"?90:oe==="6m"?180:oe==="1y"?365:365*5,Gt=$e-at*864e5;return ee.filter(Cs=>Number(Cs==null?void 0:Cs.timestamp)>=Gt)}const Sd=Lt(()=>nf(i(yu),i(Ga))),wp=Lt(()=>nf(i(Yf),i(Ga))),ac=Lt(()=>i(Sd).map(ee=>({index:Number(ee.index),ts:Number(ee.timestamp),equity:Number(ee.equity)})).filter(ee=>Number.isFinite(ee.index)&&Number.isFinite(ee.ts)&&Number.isFinite(ee.equity))),Ld=Lt(()=>i(wp).map(ee=>({index:Number(ee.index),ts:Number(ee.timestamp),equity:Number(ee.equity)})).filter(ee=>Number.isFinite(ee.index)&&Number.isFinite(ee.ts)&&Number.isFinite(ee.equity))),Cu=Lt(()=>{if(!i(ac).length)return[];let ee=-1/0;return i(ac).map(oe=>{ee=Math.max(ee,oe.equity);const $e=ee>0?(oe.equity-ee)/ee*100:0;return{index:oe.index,ts:oe.ts,ddPct:$e}})}),Ie=Lt(()=>{if(!i(ac).length)return null;const ee=i(ac)[0].equity,oe=i(ac)[i(ac).length-1].equity;let $e=1/0,at=-1/0;for(const Cs of i(ac))Cs.equity<$e&&($e=Cs.equity),Cs.equity>at&&(at=Cs.equity);const Gt=oe-ee,Nt=ee!==0?Gt/ee*100:0;return{first:ee,last:oe,net:Gt,retPct:Nt,min:$e,max:at}}),ge=Lt(()=>{if(!i(Cu).length)return null;let ee=0,oe=0;for(const Gt of i(Cu)){const Nt=Number(Gt.ddPct)||0;Nt<ee&&(ee=Nt),oe+=Nt}const $e=oe/i(Cu).length,at=i(Cu)[i(Cu).length-1].ddPct??0;return{worstAbs:Math.abs(ee),avgAbs:Math.abs($e),lastAbs:Math.abs(at)}}),Re=Lt(()=>{if(!i(Q)||!i(ac).length)return null;const ee=i(ac)[i(ac).length-1],oe=i(Q).maxY-i(Q).minY;return!Number.isFinite(oe)||oe===0?null:{x:100,y:(1-(ee.equity-i(Q).minY)/oe)*100,value:ee.equity}}),vt=Lt(()=>{if(!i(U)||!i(Cu).length)return null;const ee=i(Cu)[i(Cu).length-1],oe=i(U).maxY-i(U).minY;return!Number.isFinite(oe)||oe===0?null:{x:100,y:(1-(ee.ddPct-i(U).minY)/oe)*100,value:ee.ddPct}});function Bt(ee,oe){const $e=ee.filter(mi=>Number.isFinite(mi));if(!$e.length)return null;const at=typeof oe=="number"&&Number.isFinite(oe)?oe:Math.min(...$e);let Gt=Math.min(...$e,at),Nt=Math.max(...$e,at);if(!Number.isFinite(Gt)||!Number.isFinite(Nt))return null;Gt===Nt&&(Gt-=1,Nt+=1);const Cs=$e.length,nn=mi=>Cs<=1?0:mi/(Cs-1)*100,Xs=mi=>(1-(mi-Gt)/(Nt-Gt))*100,Xn=Xs(at),ho=$e.map((mi,$o)=>({x:nn($o),y:Xs(mi)})),Zn=ho.map((mi,$o)=>`${$o===0?"M":"L"} ${mi.x.toFixed(3)} ${mi.y.toFixed(3)}`).join(" "),Go=[`M ${ho[0].x.toFixed(3)} ${Xn.toFixed(3)}`,...ho.map(mi=>`L ${mi.x.toFixed(3)} ${mi.y.toFixed(3)}`),`L ${ho[ho.length-1].x.toFixed(3)} ${Xn.toFixed(3)}`,"Z"].join(" ");return{line:Zn,area:Go,minY:Gt,maxY:Nt,baselineY:Xn}}function Xt(ee,oe){const $e=ee.filter(nn=>Number.isFinite(nn));if(!$e.length||oe<=0)return[];let at=Math.min(...$e),Gt=Math.max(...$e);if(at===Gt)return[{label:`${io(at,2)}`,count:$e.length,min:at,max:Gt}];const Nt=(Gt-at)/oe,Cs=[];for(let nn=0;nn<oe;(nn+=1)-1){const Xs=at+Nt*nn,Xn=nn===oe-1?Gt:at+Nt*(nn+1);Cs.push({label:`${io(Xs,2)}–${io(Xn,2)}`,count:0,min:Xs,max:Xn})}for(const nn of $e){const Xs=Math.min(Cs.length-1,Math.floor((nn-at)/Nt));Cs[Xs].count+=1}return Cs}function W(ee){let oe=0;for(const $e of ee)$e.count>oe&&(oe=$e.count);return oe||1}const Q=Lt(()=>Bt(i(ac).map(ee=>ee.equity))),O=Lt(()=>Bt(i(Ld).map(ee=>ee.equity))),U=Lt(()=>Bt(i(Cu).map(ee=>ee.ddPct),0));function ce(ee){const oe=new Date(ee),$e=oe.getUTCFullYear(),at=String(oe.getUTCMonth()+1).padStart(2,"0");return`${$e}-${at}`}function G(ee){const oe=new Date(ee),$e=new Date(Date.UTC(oe.getUTCFullYear(),oe.getUTCMonth(),oe.getUTCDate())),at=$e.getUTCDay()||7;$e.setUTCDate($e.getUTCDate()+4-at);const Gt=new Date(Date.UTC($e.getUTCFullYear(),0,1)),Nt=Math.ceil((($e-Gt)/864e5+1)/7);return`${$e.getUTCFullYear()}-W${String(Nt).padStart(2,"0")}`}function ye(ee,oe){if(!(ee!=null&&ee.length))return[];const $e=oe==="month"?ce:G,at=new Map;for(const nn of ee){const Xs=Number(nn==null?void 0:nn.timestamp),Xn=Number(nn==null?void 0:nn.equity),ho=Number(nn==null?void 0:nn.index);if(!Number.isFinite(Xs)||!Number.isFinite(Xn)||!Number.isFinite(ho))continue;const Zn=$e(Xs),Go=at.get(Zn);Go?Go.last={ts:Xs,eq:Xn,idx:ho}:at.set(Zn,{first:{ts:Xs,eq:Xn,idx:ho},last:{ts:Xs,eq:Xn,idx:ho}})}const Gt=Array.from(at.keys()).sort(),Nt=[];let Cs=null;for(const nn of Gt){const Xs=at.get(nn),Xn=Number(Xs.last.eq);if(!Number.isFinite(Xn))continue;if(Cs==null){Cs=Xn;continue}const ho=Cs!==0?(Xn-Cs)/Cs*100:0;Nt.push({key:nn,retPct:ho,from:Cs,to:Xn,toIndex:Number(Xs.last.idx),toTs:Number(Xs.last.ts)}),Cs=Xn}return Nt}const Qe=Lt(()=>ye(i(yu),"month")),Ue=Lt(()=>ye(i(yu),"week")),dt=Lt(()=>{const ee=new Map;for(const oe of i(vc)){const $e=Number(oe==null?void 0:oe.exitTimestamp);if(!Number.isFinite($e)||$e<=0)continue;const at=ce($e),Gt=ee.get(at)||{trades:0,wins:0,losses:0,net:0,fees:0},Nt=Number(oe==null?void 0:oe.netPnl)||0;Gt.trades+=1,Gt.net+=Nt,Gt.fees+=Number(oe==null?void 0:oe.fees)||0,Nt>0?Gt.wins+=1:Nt<0&&(Gt.losses+=1),ee.set(at,Gt)}return ee}),et=Lt(()=>{const ee=new Map;for(const oe of i(vc)){const $e=Number(oe==null?void 0:oe.exitTimestamp);if(!Number.isFinite($e)||$e<=0)continue;const at=G($e),Gt=ee.get(at)||{trades:0,wins:0,losses:0,net:0,fees:0},Nt=Number(oe==null?void 0:oe.netPnl)||0;Gt.trades+=1,Gt.net+=Nt,Gt.fees+=Number(oe==null?void 0:oe.fees)||0,Nt>0?Gt.wins+=1:Nt<0&&(Gt.losses+=1),ee.set(at,Gt)}return ee});function B(ee){const oe=$e=>{const at=$e==null?"":String($e);return/[",\n]/.test(at)?`"${at.replace(/"/g,'""')}"`:at};return ee.map(oe).join(",")}function ve(ee,oe,$e){try{const at=new Blob([oe],{type:$e}),Gt=URL.createObjectURL(at),Nt=document.createElement("a");Nt.href=Gt,Nt.download=ee,document.body.appendChild(Nt),Nt.click(),Nt.remove(),setTimeout(()=>URL.revokeObjectURL(Gt),2500)}catch{}}const Fe=190,ot=86,tt=10;let St=_e(null),Be=_e(null);const je=Lt(()=>{try{const ee=JSON.parse(String(t()||"").trim());return!!(ee!=null&&ee.pane||ee!=null&&ee.panes||ee!=null&&ee.main||ee!=null&&ee.sub)}catch{return!1}});Xr(()=>{i(ac),i(Cu),i(Se),i(Se)});function Mt(ee){var $o;if(!i(ac).length)return;const $e=ee.currentTarget.getBoundingClientRect(),at=Math.max(0,Math.min(Fe,$e.width-tt*2)),Gt=Math.max(0,Math.min(ot,$e.height-tt*2)),Nt=Math.max(0,Math.min($e.width,ee.clientX-$e.left)),Cs=Math.max(0,Math.min($e.height,ee.clientY-$e.top)),nn=Math.round(Nt/Math.max(1,$e.width)*(i(ac).length-1)),Xs=i(ac)[nn];if(!Xs)return;const Xn=(($o=i(ac)[0])==null?void 0:$o.equity)??Xs.equity,ho=Xs.equity-Xn,Zn=Xn!==0?ho/Xn*100:0;let Go=Nt+12;Go+at+tt>$e.width&&(Go=Nt-12-at),Go=Math.max(tt,Math.min(Go,$e.width-at-tt));let mi=Cs-12-Gt;mi<tt&&(mi=Cs+12),mi=Math.max(tt,Math.min(mi,$e.height-Gt-tt)),b(St,H({x:Nt,y:Cs,left:Go,top:mi,ts:Xs.ts,equity:Xs.equity,net:ho,retPct:Zn}))}function Ze(ee){var Go;if(!i(Cu).length)return;const $e=ee.currentTarget.getBoundingClientRect(),at=Math.max(0,Math.min(Fe,$e.width-tt*2)),Gt=Math.max(0,Math.min(ot,$e.height-tt*2)),Nt=Math.max(0,Math.min($e.width,ee.clientX-$e.left)),Cs=Math.max(0,Math.min($e.height,ee.clientY-$e.top)),nn=Math.round(Nt/Math.max(1,$e.width)*(i(Cu).length-1)),Xs=i(Cu)[nn];if(!Xs)return;const Xn=(Go=i(ac)[nn])==null?void 0:Go.equity;let ho=Nt+12;ho+at+tt>$e.width&&(ho=Nt-12-at),ho=Math.max(tt,Math.min(ho,$e.width-at-tt));let Zn=Cs-12-Gt;Zn<tt&&(Zn=Cs+12),Zn=Math.max(tt,Math.min(Zn,$e.height-Gt-tt)),b(Be,H({x:Nt,y:Cs,left:ho,top:Zn,ts:Xs.ts,ddPct:Xs.ddPct,equity:Number.isFinite(Xn)?Xn:null}))}const rs=Lt(()=>{const ee=String(t()||"");if(!ee)return 1;let oe=1;for(let $e=0;$e<ee.length;($e+=1)-1)ee.charCodeAt($e)===10&&(oe+=1);return oe}),yn=Lt(()=>i(Ct)==="failed"?String(t()||"").split(`
`):[]);function Qn(ee,oe){let $e=1,at=1;for(let Gt=0;Gt<oe&&Gt<ee.length;Gt+=1)ee[Gt]===`
`?($e+=1,at=1):at+=1;return{line:$e,col:at}}const wn=ee=>{const oe=String(ee||""),$e=[[/JS guardrail: loop iteration limit exceeded/i,"Reduce loop size or add a break/guard condition."],[/JS guardrail: time budget exceeded/i,"Reduce per-bar work or heavy calculations; optimize loops."],[/JS guardrail: call depth exceeded/i,"Avoid deep recursion or excessive nested calls."],[/ctx\.hist offset must be a non-negative integer/i,"Use integer offsets only: ctx.hist(series, 0/1/2/...)."],[/strategy\.[^\s]+ is not available in JS/i,"Use documented strategy accessors (snake_case or camelCase)."],[/JS guardrail: max series points exceeded/i,"Reduce loaded bars or increase the guardrail limit."],[/JS guardrail: draw op limit exceeded/i,"Reduce draw calls or gate them with conditions."],[/JS guardrail: total runtime exceeded/i,"Reduce the number of bars or simplify per-bar work."],[/JS engine: no bars available/i,"Load chart data or switch to a symbol/timeframe with candles."]];for(const[at,Gt]of $e)if(at.test(oe))return Gt};function xo(ee){try{return{ok:!0,value:JSON.parse(ee)}}catch(oe){const $e=String((oe==null?void 0:oe.message)||"Invalid JSON"),at=$e.match(/position\s+(\d+)/i),Gt=at?Number(at[1]):null,Nt=typeof Gt=="number"&&Number.isFinite(Gt)?Qn(ee,Gt):void 0;return{ok:!1,error:{level:"error",message:$e,hint:"Fix JSON syntax (quotes/commas/braces).",line:Nt==null?void 0:Nt.line,col:Nt==null?void 0:Nt.col}}}}const hi=ee=>{let oe="",$e=null;for(let at=0;at<ee.length;(at+=1)-1){const Gt=ee[at],Nt=ee[at+1];if($e){oe+=Gt,Gt===$e&&ee[at-1]!=="\\"&&($e=null);continue}if(Gt==="'"||Gt==='"'){$e=Gt,oe+=Gt;continue}if(Gt==="/"&&Nt==="/")break;oe+=Gt}return oe},Ln=ee=>{let oe="",$e=null;for(let at=0;at<ee.length;(at+=1)-1){const Gt=ee[at];if($e){oe+=" ",Gt===$e&&ee[at-1]!=="\\"&&($e=null);continue}if(Gt==="'"||Gt==='"'){$e=Gt,oe+=" ";continue}oe+=Gt}return oe},pl=ee=>{const oe=String(ee||"").split(/\r?\n/),$e=/[A-Za-z_$][A-Za-z0-9_$]*\s*\[\s*-\s*\d+\s*\]/;for(let at=0;at<oe.length;(at+=1)-1){const Gt=hi(oe[at]||""),Nt=Ln(Gt),Cs=$e.exec(Nt);if(Cs)return{line:at+1,col:Cs.index+1,snippet:Cs[0].trim()}}return null},vn=ee=>{const oe=String(ee||""),$e=[];let at="",Gt=0,Nt=null,Cs=!1;for(let nn=0;nn<oe.length;(nn+=1)-1){const Xs=oe[nn];if(Nt){if(at+=Xs,Cs){Cs=!1;continue}if(Xs==="\\"){Cs=!0;continue}Xs===Nt&&(Nt=null);continue}if(Xs==="'"||Xs==='"'){Nt=Xs,at+=Xs;continue}if(Xs==="("){Gt+=1,at+=Xs;continue}if(Xs===")"&&Gt>0){Gt-=1,at+=Xs;continue}if(Xs===","&&Gt===0){at.trim()&&$e.push(at.trim()),at="";continue}at+=Xs}return at.trim()&&$e.push(at.trim()),$e},mo=ee=>{const oe=String(ee||"").split(/\r?\n/),$e={},at=Nt=>Nt.trim().toLowerCase(),Gt=Nt=>{const Cs=String(Nt||"").trim();if(!/^[-+]?\d+(?:\.\d+)?$/.test(Cs))return null;const nn=Number(Cs);return Number.isFinite(nn)?Math.max(0,Math.floor(nn)):null};for(let Nt=0;Nt<oe.length;(Nt+=1)-1){const Cs=hi(oe[Nt]||""),nn=Cs.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(?:float|int|bool|string)\s*\(([^)]*)\)/i);if(nn){const Xn=vn(nn[2]||""),ho=Gt(Xn[0]||"");ho!=null&&($e[at(nn[1]||"")]=ho);continue}const Xs=Cs.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\(([^)]*)\)/i);if(Xs){const Xn=vn(Xs[2]||"");Xn.length&&($e[at(Xs[1]||"")]=Xn.length)}}for(let Nt=0;Nt<oe.length;(Nt+=1)-1){const Cs=hi(oe[Nt]||""),nn=Ln(Cs),Xs=nn.match(/\barray\.set\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+(?:\.\d+)?)\b/i);if(Xs){const ho=at(Xs[1]||""),Zn=Number(Xs[2]),Go=$e[ho],mi=nn.indexOf(Xs[0]||"")+1;if(Number.isFinite(Zn)&&!Number.isInteger(Zn))return{line:Nt+1,col:mi>0?mi:1,message:"array index must be an integer"};if(Number.isFinite(Zn)&&Zn<0)return{line:Nt+1,col:mi>0?mi:1,message:"Negative array index not allowed"};if(Number.isFinite(Zn)&&Go!=null&&Zn>=Go)return{line:Nt+1,col:mi>0?mi:1,message:"array.set index must be within array size"}}const Xn=nn.match(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+(?:\.\d+)?)\b/i);if(Xn){const ho=Number(Xn[2]),Zn=nn.indexOf(Xn[0]||"")+1;if(Number.isFinite(ho)&&!Number.isInteger(ho))return{line:Nt+1,col:Zn>0?Zn:1,message:"array index must be an integer"};if(Number.isFinite(ho)&&ho<0)return{line:Nt+1,col:Zn>0?Zn:1,message:"Negative array index not allowed"}}}return null},Gi=ee=>{const oe=String(ee||"").trim();if(!oe)return"";const $e=oe[0];return($e==='"'||$e==="'")&&oe.endsWith($e)?oe.slice(1,-1):oe},La=ee=>{const oe=Gi(ee).trim().toLowerCase();if(!oe)return null;const $e=oe.replace(/^shape\./,"").replace(/^label\./,"");return $e.includes("none")?"none":$e.includes("xcross")?"xcross":$e.includes("cross")?"cross":$e.includes("diamond")?"diamond":$e.includes("triangleup")?"triangle_up_filled":$e.includes("triangledown")?"triangle_down_filled":$e.includes("arrowup")?"arrowUp":$e.includes("arrowdown")?"arrowDown":$e.includes("circle")?"circle":$e.includes("square")?"square":$e.includes("flag")?"flag":$e.includes("tag")?"tag":$e.includes("pill")?"pill":$e.includes("label")?"label":null},lc=ee=>{const oe=Gi(ee).trim().toLowerCase();if(!oe)return null;const $e=oe.replace(/^size\./,"");if($e==="auto")return 14;if($e==="tiny")return 10;if($e==="small")return 12;if($e==="normal")return 14;if($e==="large")return 18;if($e==="huge")return 22;const at=Number($e);return Number.isFinite(at)?at:null},wl=ee=>{const oe=String(ee||"").trim().toLowerCase();return oe?oe.startsWith('"')||oe.startsWith("'")||oe.startsWith("shape.")||oe.startsWith("label.")?!0:["triangleup","triangledown","arrowup","arrowdown","circle","square","label","cross","xcross","diamond","flag","tag","pill","none"].includes(oe):!1},mf=ee=>{const oe=String(ee||"").trim().toLowerCase();return oe?oe.startsWith('"')||oe.startsWith("'")?!0:oe.startsWith("location."):!1},mp=ee=>{const oe=Gi(ee).trim().toLowerCase();if(!oe)return null;const $e=oe.replace(/^location\./,"");return $e.includes("absolute")?"absolute":/(above|top|high)/.test($e)?"above":/(below|bottom|low)/.test($e)?"below":null},_c=ee=>{const oe=String(ee||"").trim().toLowerCase();return oe?oe.startsWith('"')||oe.startsWith("'")||oe.startsWith("size.")?!0:/^[-+]?\d+(?:\.\d+)?$/.test(oe):!1},Ea=ee=>{const oe={};return ee.forEach($e=>{const at=$e.indexOf("=");if(at<=0)return;const Gt=$e.slice(0,at).trim().toLowerCase(),Nt=$e.slice(at+1).trim();Gt&&(oe[Gt]=Nt)}),oe},Tf=ee=>{const oe=String(ee||"").split(/\r?\n/);for(let $e=0;$e<oe.length;($e+=1)-1){const at=hi(oe[$e]||""),Gt=at.match(/^\s*(plotshape|plotchar)\s*\((.*)\)\s*$/i);if(!Gt)continue;const Nt=String(Gt[1]||"").toLowerCase(),Cs=vn(Gt[2]||""),nn=Ea(Cs),Xs=nn.style??nn.shape;if(Nt==="plotshape"&&Xs&&wl(Xs)&&!La(Xs)){const Go=Math.max(1,at.indexOf(Xs)+1);return{line:$e+1,col:Go,message:`plotshape style not supported: ${Xs}`}}const Xn=nn.location;if(Xn&&mf(Xn)&&!mp(Xn)){const Go=Math.max(1,at.indexOf(Xn)+1);return{line:$e+1,col:Go,message:`${Nt} location not supported: ${Xn}`}}const ho=nn.size;if(ho&&_c(ho)&&lc(ho)==null){const Go=Math.max(1,at.indexOf(ho)+1);return{line:$e+1,col:Go,message:`${Nt} size not supported: ${ho}`}}}return null},Sr=ee=>{const oe=String(ee||"").trim();if(!oe)return!1;const $e=oe[0];if($e!=='"'&&$e!=="'")return!1;let at=1,Gt=!1;for(;at<oe.length;(at+=1)-1){const Nt=oe[at];if(Gt){Gt=!1;continue}if(Nt==="\\"){Gt=!0;continue}if(Nt===$e){at+=1;break}}return at<=1?!1:oe.slice(at).trim().length===0},Oa=ee=>{const oe=String(ee||"").split(/\r?\n/);for(let $e=0;$e<oe.length;($e+=1)-1){const at=oe[$e]||"";let Gt=null,Nt=0,Cs=-1,nn=-1;for(let Xs=0;Xs<at.length;(Xs+=1)-1){const Xn=at[Xs],ho=at[Xs+1];if(Gt){Xn===Gt&&at[Xs-1]!=="\\"&&(Gt=null);continue}if(Xn==="'"||Xn==='"'){Gt=Xn;continue}if(Xn==="/"&&ho==="/")break;if(Xn==="?"){Nt===0&&(Cs=Xs),Nt+=1;continue}if(Xn===":"&&Nt>0&&(Nt-=1,Nt===0)){nn=Xs;break}}if(Cs>=0&&nn>Cs){const Xs=at.slice(Cs+1,nn),Xn=at.slice(nn+1),ho=Sr(Xs),Zn=Sr(Xn);if(ho!==Zn)return{line:$e+1,col:Cs+1,snippet:at.slice(Cs).trim()}}}return null};function lr(){var nn,Xs,Xn,ho;const ee=[],oe=String(t()||""),$e=oe.trim();if(!$e)return ee;const at=Zn=>{const Go=new Set;Zn.forEach($o=>{const kl=`${$o.level}:${String($o.message||"").trim()}`;kl.trim()!==`${$o.level}:`&&Go.add(kl)});const mi=String(r()||"").trim();if(mi){const $o=`error:${mi}`;Go.has($o)||(Zn.unshift({level:"error",message:mi,hint:(i(ai)==="js"?wn(mi):void 0)||"See the console for details if needed."}),Go.add($o))}return Array.isArray(a())&&a().forEach($o=>{if($o&&typeof $o=="object"){const il=$o.level==="error"||$o.level==="warning"?$o.level:"warning",Ya=String($o.message||"").trim();if(!Ya)return;const Kl=`${il}:${Ya}`;if(Go.has(Kl))return;Go.add(Kl),Zn.push({level:il,message:Ya,hint:$o.hint?String($o.hint):void 0,line:typeof $o.line=="number"?$o.line:void 0,col:typeof $o.col=="number"?$o.col:void 0});return}const kl=String($o||"").trim();if(!kl)return;const Fl=`warning:${kl}`;Go.has(Fl)||(Go.add(Fl),Zn.push({level:"warning",message:kl}))}),Zn},Gt=i(ai);if(Gt==="pine"||Gt==="auto"&&hr(oe)){try{const Zn=i(Jr)===oe?i(nl):null;if(Zn&&Zn.ok===!1&&Array.isArray(Zn.errors)&&Zn.errors.length)return Zn.errors.slice(0,12).forEach(Go=>{ee.push({level:"error",message:String((Go==null?void 0:Go.message)||"Pine error"),hint:"Fix the Pine line or use the Guide examples.",line:typeof(Go==null?void 0:Go.line)=="number"?Go.line:void 0,col:1})}),at(ee);if(Zn&&Zn.ok){const Go=pl($e);if(Go)return ee.push({level:"error",message:`Negative history index not allowed: ${Go.snippet}`,hint:"Use x[0], x[1], x[2] (negative indices are invalid).",line:Go.line,col:Go.col}),at(ee);const mi=(Zn.warnings||[]).find(Ya=>String((Ya==null?void 0:Ya.message)||"").includes('":=" used before'));if(mi)return ee.push({level:"error",message:String(mi.message||'":=" used before declaration'),hint:"Declare with var or use '=' for first assignment.",line:typeof mi.line=="number"?mi.line:void 0,col:1}),at(ee);const $o=Oa($e);if($o)return ee.push({level:"error",message:"Ternary branches must both be numeric or both non-numeric",hint:"Use numeric values on both branches or non-numeric values on both branches.",line:$o.line,col:$o.col}),at(ee);const kl=mo($e);if(kl)return ee.push({level:"error",message:kl.message,hint:"Use a valid non-negative index within the array size.",line:kl.line,col:kl.col}),at(ee);const Fl=Tf($e);if(Fl)return ee.push({level:"error",message:Fl.message,hint:"Use a supported plotshape/plotchar option value.",line:Fl.line,col:Fl.col}),at(ee);const il=T_(Zn.spec);il.ok||(il.errors||[]).forEach(Ya=>ee.push({level:"error",message:Ya,hint:hn(Ya)}))}}catch{}return at(ee)}if(Gt==="js"||Gt==="dsl"||Gt==="auto"&&!Eo($e))return at(ee);const Cs=xo($e);if(!Cs.ok)return ee.push(Cs.error),at(ee);try{const Zn=Cs.value;if(Zn&&(Zn.plots||Zn.calc||Zn.panes||Zn.main||Zn.sub)){const Go=Zn&&typeof Zn=="object"?Zn.params||{}:{},mi=hx(Zn,Go);let $o=mi;try{$o=vx(mi)}catch(Hn){return ee.push({level:"error",message:`Template expansion error: ${String((Hn==null?void 0:Hn.message)||Hn)}`,hint:"Check repeat/forEach blocks and loop sizes."}),at(ee)}const kl=T_($o);kl.ok||(kl.errors||[]).forEach(Hn=>ee.push({level:"error",message:Hn,hint:hn(Hn)}));const Fl=$o.pane||$o.plots||$o.labels||$o.levels||$o.lines?{pane:$o.pane||"main",plots:$o.plots||[],labels:$o.labels||[],levels:$o.levels||[],lines:$o.lines||[],min:$o.min,max:$o.max}:null,il=[].concat(Fl?[Fl]:[]).concat($o.panes||[]).concat($o.main?[$o.main]:[]).concat($o.sub?[$o.sub]:[]),Ya=Array.isArray($o.calc)?$o.calc:[],Kl=Array.isArray($o.series)?$o.series:[],ru=Array.isArray((nn=kl.spec)==null?void 0:nn.series)?(Xs=kl.spec)==null?void 0:Xs.series:[],vd=Array.isArray((Xn=kl.spec)==null?void 0:Xn.stateSeries)?(ho=kl.spec)==null?void 0:ho.stateSeries:[],nc=new Set(["open","high","low","close","volume","time","bar_index"]);Kl.forEach(Hn=>{const Oo=String((Hn==null?void 0:Hn.name)||"").replace(/\s+/g,"_").toLowerCase();Oo&&nc.add(Oo)}),ru.forEach(Hn=>{const Oo=String((Hn==null?void 0:Hn.name)||"").replace(/\s+/g,"_").toLowerCase();Oo&&nc.add(Oo)}),vd.forEach(Hn=>{const Oo=String((Hn==null?void 0:Hn.name)||"").replace(/\s+/g,"_").toLowerCase();Oo&&nc.add(Oo)}),Ya.forEach(Hn=>{const Oo=String((Hn==null?void 0:Hn.type)||(Hn==null?void 0:Hn.name)||"").toLowerCase(),pi=String((Hn==null?void 0:Hn.name)||(Hn==null?void 0:Hn.type)||"").replace(/\s+/g,"_").toLowerCase();if(dx.includes(Oo)||Oo&&ee.push({level:"error",message:`Unsupported calc type "${Hn==null?void 0:Hn.type}"`,hint:`Use one of: ${Array.from(dx).join(", ")}`}),Oo==="ema"){const ur=Hn==null?void 0:Hn.period;(typeof ur!="number"||!(ur>0))&&ee.push({level:"error",message:"EMA requires numeric period > 0",hint:'Add "period": e.g., 20'})}if(Oo==="macd"){const ur=Mc=>typeof Mc=="number"&&Mc>0;(!ur(Hn==null?void 0:Hn.fast)||!ur(Hn==null?void 0:Hn.slow)||!ur(Hn==null?void 0:Hn.signal))&&ee.push({level:"error",message:"MACD requires numeric fast/slow/signal",hint:'Add "fast":12, "slow":26, "signal":9'})}if(Oo==="stoch"){const ur=Mc=>typeof Mc=="number"&&Mc>0;(!ur(Hn==null?void 0:Hn.kPeriod)||!ur(Hn==null?void 0:Hn.dPeriod))&&ee.push({level:"error",message:"Stochastic requires kPeriod and dPeriod",hint:'Add "kPeriod":14, "dPeriod":3'})}pi&&(Oo==="bbands"||Oo==="bollinger"||Oo==="bollinger_bands"||Oo==="kc"||Oo==="keltner"||Oo==="donchian"||Oo==="linreg_channel"?(nc.add(`${pi}_mid`),nc.add(`${pi}_upper`),nc.add(`${pi}_lower`)):Oo==="atr_bands"?(nc.add(`${pi}_upper`),nc.add(`${pi}_lower`)):Oo==="macd"?(nc.add("macd_line"),nc.add("macd_signal"),nc.add("macd_hist")):Oo==="stoch"?(nc.add(`${pi}_k`),nc.add(`${pi}_d`)):Oo==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"].forEach(ur=>nc.add(ur)):nc.add(pi))}),il.forEach((Hn,Oo)=>{(Hn.plots||[]).forEach((pi,ur)=>{const Mc=String((pi==null?void 0:pi.type)||"line").toLowerCase();fx.includes(Mc)||ee.push({level:"warning",message:`Pane[${Oo}] plot[${ur}] unsupported type "${pi==null?void 0:pi.type}"`,hint:`Supported: ${Array.from(fx).join(", ")}`});const Nc=String((pi==null?void 0:pi.source)||"").replace(/\s+/g,"_").toLowerCase();Nc&&!nc.has(Nc)&&ee.push({level:"error",message:`Pane[${Oo}] plot[${ur}] source "${pi==null?void 0:pi.source}" not defined`,hint:"Define it in calc/series or use a valid alias."})}),(Hn.labels||[]).forEach((pi,ur)=>{const Mc=String((pi==null?void 0:pi.shape)||"label");Mc&&!px.includes(Mc)&&ee.push({level:"warning",message:`Pane[${Oo}] label[${ur}] unsupported shape "${Mc}"`,hint:`Supported: ${Array.from(px).join(", ")}`}),pi!=null&&pi.shape||ee.push({level:"warning",message:`Pane[${Oo}] label[${ur}] no shape set (default: label)`,hint:'Set "shape": triangle_up_filled, triangle_down_filled, label, pill, tag, flag'});const Nc=String((pi==null?void 0:pi.source)||"").replace(/\s+/g,"_").toLowerCase();Nc&&!["open","high","low","close","volume"].includes(Nc)&&!nc.has(Nc)&&ee.push({level:"error",message:`Pane[${Oo}] label[${ur}] source "${pi==null?void 0:pi.source}" not defined`,hint:"Use high/low/open/close or a defined series"}),String((Hn==null?void 0:Hn.pane)||"main").toLowerCase()==="sub"&&(Nc==="high"||Nc==="low")&&ee.push({level:"warning",message:`Pane[${Oo}] label[${ur}] anchors to price in sub pane`,hint:"Move label to main pane for price anchors"});const Vf=String((pi==null?void 0:pi.whenExpr)||""),xu=String((pi==null?void 0:pi.when)||"");if(Vf.trim())try{const nd=Ep(it(Vf));Ge(nd).forEach(Jf=>{const fr=Jf.replace(/\s+/g,"_").toLowerCase();!nc.has(fr)&&!["open","high","low","close","volume"].includes(fr)&&ee.push({level:"warning",message:`Label[${Oo}:${ur}] references unknown series "${Jf}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(nd){const Dd=(nd==null?void 0:nd.position)!=null?` at ${nd.position}`:"",Jf=nd instanceof rv?nd.message:String(nd),fr=typeof(nd==null?void 0:nd.position)=="number"?Qn($e,nd.position):void 0;ee.push({level:"error",message:`Label[${Oo}:${ur}] Pine expression parse failed${Dd}: ${Jf}`,hint:"Use parentheses to disambiguate comparisons; split chained comparisons with and/or.",line:fr==null?void 0:fr.line,col:fr==null?void 0:fr.col})}else if(xu.trim())try{const nd=Ep(it(xu));Ge(nd).forEach(Jf=>{const fr=Jf.replace(/\s+/g,"_").toLowerCase();!nc.has(fr)&&!["open","high","low","close","volume"].includes(fr)&&ee.push({level:"warning",message:`Label[${Oo}:${ur}] references unknown series "${Jf}"`,hint:"Define via calc/series or use a base series (open/high/low/close/volume)."})})}catch(nd){const Dd=(nd==null?void 0:nd.position)!=null?` at ${nd.position}`:"",Jf=nd instanceof rv?nd.message:String(nd),fr=typeof(nd==null?void 0:nd.position)=="number"?Qn($e,nd.position):void 0;ee.push({level:"error",message:`Label[${Oo}:${ur}] condition parse failed${Dd}: ${Jf}`,hint:"Use parentheses to disambiguate comparisons; split chained comparisons with and/or.",line:fr==null?void 0:fr.line,col:fr==null?void 0:fr.col})}})});const af=new Set;il.forEach(Hn=>{(Hn.plots||[]).forEach(Oo=>{const pi=String((Oo==null?void 0:Oo.source)||"").replace(/\s+/g,"_").toLowerCase();pi&&af.add(pi)}),(Hn.labels||[]).forEach(Oo=>{const pi=String((Oo==null?void 0:Oo.source)||"").replace(/\s+/g,"_").toLowerCase();pi&&af.add(pi);const ur=String((Oo==null?void 0:Oo.whenExpr)||""),Mc=String((Oo==null?void 0:Oo.when)||"");try{if(ur.trim()){const Nc=Ep(it(ur));Ge(Nc).forEach(xu=>af.add(xu.replace(/\s+/g,"_").toLowerCase()))}else if(Mc.trim()){const Nc=Ep(it(Mc));Ge(Nc).forEach(xu=>af.add(xu.replace(/\s+/g,"_").toLowerCase()))}}catch{}}),(Hn.lines||[]).forEach(Oo=>{const pi=String((Oo==null?void 0:Oo.segmentsFrom)||"").replace(/\s+/g,"_").toLowerCase();pi&&af.add(pi);const ur=String((Oo==null?void 0:Oo.start)||"").replace(/\s+/g,"_").toLowerCase();ur&&af.add(ur);const Mc=String((Oo==null?void 0:Oo.end)||"").replace(/\s+/g,"_").toLowerCase();Mc&&af.add(Mc)})}),(Array.isArray(Zn.signals)?Zn.signals:[]).forEach(Hn=>{const Oo=String((Hn==null?void 0:Hn.whenExpr)||""),pi=String((Hn==null?void 0:Hn.when)||"");try{if(Oo.trim()){const ur=Ep(it(Oo));Ge(ur).forEach(Nc=>af.add(Nc.replace(/\s+/g,"_").toLowerCase()))}else if(pi.trim()){const ur=Ep(it(pi));Ge(ur).forEach(Nc=>af.add(Nc.replace(/\s+/g,"_").toLowerCase()))}}catch{}});const lf=Kl.map(Hn=>String((Hn==null?void 0:Hn.expr)||"")).join(" ").replace(/\s+/g," ").toLowerCase(),ef=(Hn,Oo)=>{const pi=Hn.toLowerCase(),ur=Oo;return pi==="bbands"||pi==="bollinger"||pi==="bollinger_bands"||pi==="kc"||pi==="keltner"||pi==="donchian"||pi==="linreg_channel"?[`${ur}_mid`,`${ur}_upper`,`${ur}_lower`]:pi==="atr_bands"?[`${ur}_upper`,`${ur}_lower`]:pi==="stoch"?[`${ur}_k`,`${ur}_d`]:pi==="macd"?["macd_line","macd_signal","macd_hist"]:pi==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[ur]};return Ya.forEach(Hn=>{const Oo=String((Hn==null?void 0:Hn.name)||(Hn==null?void 0:Hn.type)||"").replace(/\s+/g,"_").toLowerCase();if(Oo&&!af.has(Oo)){const pi=String((Hn==null?void 0:Hn.type)||""),ur=ef(pi,Oo);if(!ur.some(Nc=>af.has(Nc))){const Nc=lf&&new RegExp(`\\b${Oo.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test(lf),Vf=lf&&ur.some(xu=>new RegExp(`\\b${xu.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")}\\b`,"i").test(lf));if(Nc||Vf)return;ee.push({level:"warning",message:`Calc "${pi}" (${Oo}) is defined but not used`,hint:"Reference it in plots or label conditions"})}}}),at(ee)}}catch{ee.push({level:"warning",message:"Non‑JSON script detected",hint:"Use JSON spec or the DSL examples from Guide. If JSON, ensure valid commas/quotes/braces.",line:1,col:1})}return at(ee)}let mr=_e(H([]));Xr(()=>{const ee=String(t()||"");r(),a(),i(ai),i(Jr),i(nl);let oe=!1,$e=null;const at=()=>{oe||ee===String(t()||"")&&b(mr,H(lr()))},Gt=setTimeout(()=>{const Nt=typeof window<"u"?window==null?void 0:window.requestIdleCallback:void 0;Nt?$e=Nt(at,{timeout:250}):at()},140);return()=>{oe=!0,clearTimeout(Gt);const Nt=typeof window<"u"?window==null?void 0:window.cancelIdleCallback:void 0;Nt&&$e!=null&&Nt($e)}});const Cr=Lt(()=>i(mr).filter(ee=>ee.level==="error").length),hl=Lt(()=>i(mr).filter(ee=>ee.level==="warning").length),ls=Lt(()=>i(mr).length),ws=Lt(()=>i(Cr)>0?"Errors":i(hl)>0?"Warnings":"Issues"),Fs=Lt(()=>r()?`Error: ${r()}`:f()?"Running…":o()?o():"Ready"),to=Lt(()=>{const ee=String(t()||"");if(!/security_lower_tf/i.test(ee))return null;const oe=String(r()||""),$e=String(o()||"");return oe&&/(lower_tf|lower timeframe)/i.test(oe)?{kind:"error",label:"Lower TF",title:"Lower TF not available",lines:["Lower TF must be smaller than the chart timeframe.","Switch chart timeframe higher or lower the requested TF.","Lower TF needs server data; wait if loading."]}:oe&&/request\.security/i.test(oe)?{kind:"warning",label:"Lower TF",title:"Lower TF data not ready",lines:["Lower TF data may be missing for this range.","Zoom to recent data or wait for fetch to finish."]}:/loading request\.security/i.test($e)?{kind:"info",label:"Lower TF",title:"Lower TF data loading",lines:["Lower TF candles are loading from the server.","The chart will refresh when data arrives."]}:null}),cr=Lt(()=>{const ee=typeof i(to)=="function"?i(to)():i(to);if(!ee)return"";const oe=ee.title||"Lower TF",$e=Array.isArray(ee.lines)?ee.lines:[];return[oe,...$e].join(`
`)}),io=(ee,oe=2)=>Number.isFinite(ee)?ee.toFixed(oe):"—",Yl=(ee,oe=2,$e=8)=>{if(!Number.isFinite(ee))return"—";const at=Math.abs(ee);if(at===0||at>=1)return ee.toFixed(oe);const Gt=Math.ceil(-Math.log10(at)),Nt=Math.max(oe,Math.min($e,oe+Gt));return ee.toFixed(Nt)},na=ee=>Yl(ee,2,6),Od=ee=>Yl(ee,2,10),qr=ee=>Yl(ee,6,10),za=(ee,oe=2)=>{const $e=typeof ee=="number"?ee:Number(ee);return Number.isFinite($e)?io($e,oe):"—"},Yc=ee=>{const oe=typeof ee=="number"?ee:Number(ee);return Number.isFinite(oe)?na(oe):"—"},Na=ee=>{const oe=typeof ee=="number"?ee:Number(ee);return Number.isFinite(oe)?Od(oe):"—"},Rc=ee=>{const oe=typeof ee=="number"?ee:Number(ee);return Number.isFinite(oe)?qr(oe):"—"},Ir=ee=>{const oe=typeof ee=="number"?ee:Number(ee);return Number.isFinite(oe)?tu(oe):"—"},tu=ee=>`${io(ee,2)}%`,jc=ee=>ee===1/0?"∞":io(ee,2),su=ee=>{const oe=String(ee||"").replace(/_/g," ").trim();return oe?oe.charAt(0).toUpperCase()+oe.slice(1):"—"},sd=ee=>{const oe=String(ee||"").toLowerCase();return oe?oe==="stop_limit"?"Stop-limit":oe==="trailing_stop"?"Trailing stop":oe==="mit"?"MIT":oe==="lit"?"LIT":oe==="market"?"Market":oe==="limit"?"Limit":oe==="stop"?"Stop":su(oe):"—"},of=Lt(()=>i(mr).filter(ee=>typeof ee.line=="number").map(ee=>({line:ee.line,col:ee.col,level:ee.level}))),Iu=Lt(()=>{if(i(Ct)!=="failed")return"";const ee=String(t()||"").split(`
`),oe=new Map;i(of).forEach(at=>{oe.has(at.line)||oe.set(at.line,[]),oe.get(at.line).push({col:at.col,level:at.level})});const $e=at=>at.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return ee.map((at,Gt)=>{const Nt=Gt+1,Cs=oe.get(Nt)||[],nn=Cs.some(Go=>!Go.col),Xs=$e(at||" ");if(nn)return`<div class="code-line"><mark class="err err-${Cs[0].level}">${Xs}</mark></div>`;if(!Cs.length)return`<div class="code-line"><span>${Xs}</span></div>`;const Xn=Cs.filter(Go=>typeof Go.col=="number"&&Go.col>0).sort((Go,mi)=>Go.col-mi.col);let ho="",Zn=0;return Xn.forEach((Go,mi)=>{const $o=Math.max(0,Go.col-1);$o>Zn&&(ho+=$e(at.slice(Zn,$o))),ho+=`<mark class="err err-${Go.level}">${$e(at.slice($o))||"&nbsp;"}</mark>`,Zn=at.length}),Zn<at.length&&(ho+=$e(at.slice(Zn))),`<div class="code-line"><span>${ho||"&nbsp;"}</span></div>`}).join("")});let Qd=_e(void 0),Hl=_e(void 0),kp=_e(void 0),Ks=_e(void 0),Ct=_e("idle"),xn=null,As=null,gn=null,Sn=[],Yn=!1,_o=!1,si=null,Gn=null,Uo=0,oo=_e("plaintext");const Si=Lt(()=>i(Ct)==="ready"),cc={indicator:"Creates an indicator script.",strategy:"Creates a strategy script with backtest settings.",library:"Marks this script as a reusable library.",import:"Import a local library by name.",plot:"Plot a series on chart.",plotcandle:"Plot custom candles from OHLC series.",plotbar:"Plot OHLC bars from series.",plotohlc:"Plot OHLC bars from series.",plotarrow:"Plot up/down arrows from a series.",plotfill:"Fill between two plots.",fill:"Fill between two series.",plotshape:"Plot a shape on chart.",plotchar:"Plot a character on chart.",hline:"Draw a horizontal line.",input:"Create a user input.","input.int":"Integer input.","input.float":"Float input.","input.bool":"Boolean input.","input.string":"String input.","request.security":"Fetch HTF/MTF series.","request.security_lower_tf":"Fetch lower timeframe series.","strategy.entry":"Place an entry order.","strategy.exit":"Place an exit order.","strategy.order":"Place a generic order.",alertcondition:"Emit an alert when condition is true.",barstate:"Bar state flags (islast, isnewbar, isrealtime).",timeframe:"Chart timeframe helpers.",syminfo:"Symbol metadata (ticker, type, etc.)."},bu={uri:"scriptstudio://schema/script.json",fileMatch:["*"],schema:{type:"object",description:"Script Studio JSON spec",properties:{pane:{type:"string",description:'Default pane ("main" or "sub")'},min:{type:"number"},max:{type:"number"},params:{type:"object",description:"Named params (input values)"},strategy:{type:"object",properties:{initialCapital:{type:"number"},orderSize:{type:"object"},commissionPct:{type:"number"},slippagePct:{type:"number"},execution:{type:"string"},allowShort:{type:"boolean"},pyramiding:{type:"number"}}},calc:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"},source:{type:"string"},period:{type:"number"},fast:{type:"number"},slow:{type:"number"},signal:{type:"number"},expr:{type:"string"},timeframe:{type:"string"},symbol:{type:"string"},country:{type:"string"},lookahead:{type:"string"},gaps:{type:"string"}}}},series:{type:"array",items:{type:"object",properties:{name:{type:"string"},expr:{type:"string"}}}},rules:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["series","state"]},name:{type:"string"},series:{type:"string"},state:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},then:{type:"string"},value:{type:"string"},expr:{type:"string"},else:{type:"string"},init:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},stateSeries:{type:"array",items:{type:"object",properties:{name:{type:"string"},initExpr:{type:"string"},updateExpr:{type:"string"},selfMode:{type:"string",enum:["prev","current"]}}}},plots:{type:"array",items:{type:"object",properties:{name:{type:"string"},source:{type:"string"},type:{type:"string"},color:{type:"string"},width:{type:"number"},style:{type:"string"},offset:{type:["number","string"]},showLast:{type:["number","string"]},open:{type:"string"},high:{type:"string"},low:{type:"string"},close:{type:"string"},downColor:{type:"string"},wickColor:{type:"string"},borderColor:{type:"string"}}}},labels:{type:"array",items:{type:"object",properties:{when:{type:"string"},whenExpr:{type:"string"},text:{type:"string"},textExpr:{type:"string"},shape:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},position:{type:"string"},source:{type:"string"},bgColor:{type:"string"},bgColorExpr:{type:"string"},borderColor:{type:"string"},borderColorExpr:{type:"string"},textColor:{type:"string"},textColorExpr:{type:"string"},size:{type:"number"},sizeExpr:{type:"string"},offsetY:{type:"number"},offsetYExpr:{type:"string"}}}},lines:{type:"array",items:{type:"object",properties:{name:{type:"string"},start:{type:"string"},end:{type:"string"},color:{type:"string"},colorExpr:{type:"string"},width:{type:"number"},widthExpr:{type:"string"},sizeExpr:{type:"string"},style:{type:"string"},extend:{type:"string"},segmentsFrom:{type:"string"},maxSegments:{type:"number"}}}},signals:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},when:{type:"string"},whenExpr:{type:"string"},score:{type:"number",minimum:0,maximum:10,multipleOf:1},scoreExpr:{type:"string"},cooldownBars:{type:"number"},cooldownExpr:{type:"string"},order:{type:"object"}}}},panes:{type:"array",items:{type:"object",properties:{pane:{type:"string"},plots:{$ref:"#/properties/plots"},labels:{$ref:"#/properties/labels"},levels:{type:"array"},lines:{$ref:"#/properties/lines"},min:{type:"number"},max:{type:"number"}}}},main:{$ref:"#/properties/panes/items"},sub:{$ref:"#/properties/panes/items"}}}},$l=ee=>{const oe=(Gt,Nt,Cs)=>({label:Gt,kind:ee.languages.CompletionItemKind.Function,insertText:Gt,insertTextRules:void 0,detail:Nt}),$e=Gt=>({label:Gt,kind:ee.languages.CompletionItemKind.Keyword,insertText:Gt,detail:"keyword"}),at=(Gt,Nt,Cs)=>({label:Gt,kind:ee.languages.CompletionItemKind.Snippet,insertText:Nt,insertTextRules:ee.languages.CompletionItemInsertTextRule.InsertAsSnippet,detail:Cs});return[$e("if"),$e("else"),$e("for"),$e("while"),$e("switch"),$e("break"),$e("continue"),$e("return"),$e("var"),$e("varip"),$e("export"),$e("import"),$e("library"),at("indicator",'indicator("${1:Title}", overlay=${2:true})',"indicator(...)"),at("strategy",'strategy(initial_capital=${1:10000}, execution="bar_close", allowShort=${2:false})',"strategy(...)"),at("input.int",'input.int(${1:14}, title="${2:Length}")',"input.int(...)"),at("input.float",'input.float(${1:14.0}, title="${2:Length}")',"input.float(...)"),at("input.bool",'input.bool(${1:true}, title="${2:Enabled}")',"input.bool(...)"),at("input.string",'input.string("${1:Value}", title="${2:Title}")',"input.string(...)"),oe("plot","plot(series)"),oe("plotcandle","plotcandle(open, high, low, close)"),oe("plotbar","plotbar(open, high, low, close)"),oe("plotohlc","plotohlc(open, high, low, close)"),oe("plotarrow","plotarrow(series)"),oe("plotfill","plotfill(plotA, plotB, color)"),oe("fill","fill(seriesA, seriesB, color)"),oe("plotshape","plotshape(condition)"),oe("plotchar","plotchar(condition)"),oe("hline","hline(price)"),oe("line.new","line.new(x1, y1, x2, y2)"),oe("label.new","label.new(x, y, text)"),oe("box.new","box.new(left, top, right, bottom)"),oe("table.new","table.new(position, columns, rows)"),oe("table.cell","table.cell(table_id, column, row, text)"),oe("table.clear","table.clear(table_id)"),oe("request.security","request.security(symbol, timeframe, expr)"),oe("request.security_lower_tf","request.security_lower_tf(symbol, timeframe, expr)"),oe("strategy.entry","strategy.entry(id, side)"),oe("strategy.exit","strategy.exit(id, side)"),oe("strategy.order","strategy.order(id, side)"),oe("strategy.cancel","strategy.cancel(id)"),oe("strategy.close","strategy.close(id)"),oe("alertcondition","alertcondition(condition, title, message)"),oe("ema","ema(source, length)"),oe("sma","sma(source, length)"),oe("rsi","rsi(source, length)"),oe("macd","macd(source, fast, slow, signal)"),oe("highest","highest(source, length)"),oe("lowest","lowest(source, length)"),oe("atr","atr(high, low, close, length)"),oe("stoch","stoch(high, low, close, kPeriod, dPeriod)"),oe("array.new_float","array.new_float(size, initial)"),oe("array.new_string","array.new_string(size, initial)"),oe("array.from","array.from(val1, val2, val3)"),oe("array.get","array.get(arr, index)"),oe("array.set","array.set(arr, index, value)"),oe("array.push","array.push(arr, value)"),oe("array.pop","array.pop(arr)"),oe("array.size","array.size(arr)")]},nu=ee=>{ee.languages.getLanguages().some(oe=>oe.id==="pine")||(ee.languages.register({id:"pine"}),ee.languages.setLanguageConfiguration("pine",{comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}],surroundingPairs:[{open:'"',close:'"'},{open:"'",close:"'"},{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"}]}),ee.languages.setMonarchTokensProvider("pine",{keywords:["if","else","for","while","switch","break","continue","return","var","varip","export","import","library","strategy","indicator","study"],types:["int","float","bool","string","line","label","box","table","linefill","color"],tokenizer:{root:[[/\/\/.*$/,"comment"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/\b(true|false|na)\b/,"constant"],[/\b\d+(\.\d+)?\b/,"number"],[/[{}()[\]]/,"@brackets"],[/[=><!~?:&|+\-*\/%^]/,"operator"],[/[A-Za-z_][A-Za-z0-9_]*/,{cases:{"@keywords":"keyword","@types":"type","@default":"identifier"}}]],string_double:[[/[^\\"]+/,"string"],[/\\./,"string.escape"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/\\./,"string.escape"],[/'/,"string","@pop"]]}}),ee.languages.registerCompletionItemProvider("pine",{triggerCharacters:[".","("],provideCompletionItems:(oe,$e)=>{const at=oe.getWordUntilPosition($e),Gt=new ee.Range($e.lineNumber,at.startColumn,$e.lineNumber,at.endColumn);return{suggestions:$l(ee).map(Cs=>({...Cs,range:Gt}))}}}),ee.languages.registerHoverProvider("pine",{provideHover(oe,$e){const at=oe.getWordAtPosition($e);if(!at)return null;const Gt=at.word,Nt=cc[Gt]||cc[Gt.toLowerCase()];return Nt?{range:new ee.Range($e.lineNumber,at.startColumn,$e.lineNumber,at.endColumn),contents:[{value:`**${Gt}**`},{value:Nt}]}:null}}))},$r=ee=>{var oe,$e;($e=(oe=ee.languages)==null?void 0:oe.json)!=null&&$e.jsonDefaults&&ee.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[bu]})},$a=ee=>{ee.editor.getTheme&&ee.editor._scriptStudioThemes||(ee.editor.defineTheme("scriptstudio-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#0b0a1a","editor.foreground":"#e2e8f0","editorLineNumber.foreground":"#475569","editorLineNumber.activeForeground":"#94a3b8","editor.selectionBackground":"#1f2a44","editor.inactiveSelectionBackground":"#1b2338","editorCursor.foreground":"#94a3b8"}}),ee.editor.defineTheme("scriptstudio-light",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#f8fafc","editor.foreground":"#0f172a","editorLineNumber.foreground":"#94a3b8","editorLineNumber.activeForeground":"#334155","editor.selectionBackground":"#dbeafe","editor.inactiveSelectionBackground":"#e2e8f0","editorCursor.foreground":"#1e293b"}}),ee.editor._scriptStudioThemes=!0)},wa=ee=>i(ai)==="json"?"json":i(ai)==="dsl"?"plaintext":i(ai)==="pine"?"pine":i(ai)==="js"?"javascript":/^\s*\/\/@\s*(?:pine|version)\b/m.test(ee)||/\b(strategy|indicator|library|plot)\s*\(/m.test(ee)||/\b(plotshape|plotchar|hline|table|line|label|box|alertcondition)\b/i.test(ee)||/\b(request\.security(?:_lower_tf)?|input\.)\b/i.test(ee)?"pine":Eo(ee)?"json":"plaintext",yc=()=>(document.documentElement.getAttribute("data-theme")||document.body.getAttribute("data-theme"))==="light"?"scriptstudio-light":"scriptstudio-dark",ti=()=>{if(!xn||!gn)return;const ee=[],oe=($e,at,Gt,Nt,Cs)=>{const nn=Math.max(1,Math.min(gn.getLineCount(),Gt||1)),Xs=Math.max(1,Nt||1),Xn=gn.getLineContent(nn)||"",ho=Math.max(Xs+1,Xn.length+1);ee.push({startLineNumber:nn,startColumn:Xs,endLineNumber:nn,endColumn:ho,message:Cs?`${at} • ${Cs}`:at,severity:$e==="error"?xn.MarkerSeverity.Error:xn.MarkerSeverity.Warning})};i(mr).forEach($e=>oe($e.level,$e.message,$e.line,$e.col,$e.hint)),i(Ui).forEach($e=>oe("warning",$e.message,$e.line,1)),xn.editor.setModelMarkers(gn,"scriptstudio",ee)};function fi(){var $e,at;const ee=(($e=i(Qd))==null?void 0:$e.scrollTop)??0,oe=((at=i(Qd))==null?void 0:at.scrollLeft)??0;i(Hl)&&(i(Hl).scrollTop=ee,i(Hl).scrollLeft=oe),i(kp)&&(i(kp).scrollTop=ee)}function hn(ee){const oe=ee.toLowerCase();return oe.includes("no panes defined")?'Add pane:"main" or {main:{...}} with plots/labels.':oe.includes("has no plots/labels/levels/lines")?"Add at least one plot or label in the pane.":oe.includes("series")?"Check series names and expressions; use normalized aliases like macd_line.":"Review field names/types; see Guide examples."}Xr(()=>{if(!xn||!gn||!i(Si)||Yn)return;n();const ee=String(t()||"");gn.getValue()!==ee&&(_o=!0,gn.setValue(ee),_o=!1)}),Xr(()=>{if(!xn||!As||!i(Si)||n()<=0)return;const ee=String(t()||""),oe=wa(ee),$e=As.getModel();if($e){gn=$e,$e.setValue(ee),i(oo)!==oe&&(b(oo,H(oe)),xn.editor.setModelLanguage($e,oe));try{As.updateOptions({wordWrap:oe==="pine"?"off":"on"})}catch{}ti(),requestAnimationFrame(()=>As==null?void 0:As.layout())}}),Xr(()=>{if(!xn||!gn||!i(Si))return;const ee=wa(String(t()||""));if(ee!==i(oo)){b(oo,H(ee)),xn.editor.setModelLanguage(gn,ee);try{As==null||As.updateOptions({wordWrap:ee==="pine"?"off":"on"})}catch{}}}),Xr(()=>{!xn||!gn||!i(Si)||ti()}),Xr(()=>{!As||!i(Si)||i(Se)==="editor"&&requestAnimationFrame(()=>As==null?void 0:As.layout())}),Xr(()=>{!As||!i(Si)||(i(Ol).length,requestAnimationFrame(()=>As==null?void 0:As.layout()))}),O0();var uo=qte(),tr=y(uo);tr.__pointerdown=[NZ];var Pr=m(y(tr),2),Mr=y(Pr),Or=y(Mr);Or.__click=[AZ,Se];var ou=m(Or,2);ou.__click=[TZ,Se];var md=y(ou),Kf=y(md,!0);_(md);var Pu=m(md,2);Ve(Pu,()=>i(ls),ee=>{var oe=FZ(),$e=y(oe,!0);_(oe),we(()=>{$i(oe,`err-badge ${(i(Cr)===0&&i(hl)>0?"warn":"")??""} svelte-1ehcy4i`),st($e,i(ls))}),Y(ee,oe)}),_(ou);var ld=m(ou,2);ld.__click=[LZ,Se],_(Mr);var iu=m(Mr,2),Ed=m(y(iu),2);Ed.__click=[EZ];var Du=y(Ed);Du.value=(Du.__value="auto")==null?"":"auto";var kf=m(Du);kf.value=(kf.__value="json")==null?"":"json";var $d=m(kf);$d.value=($d.__value="pine")==null?"":"pine";var Bf=m($d);Bf.value=(Bf.__value="dsl")==null?"":"dsl";var Di=m(Bf);Di.value=(Di.__value="js")==null?"":"js",_(Ed),_(iu),_(Pr);var bh=m(Pr,2),rf=y(bh);Ve(rf,()=>!i(je),ee=>{var oe=RZ(),$e=y(oe);$e.__click=[$Z,Je];var at=m($e,2);at.__click=[DZ,Je],_(oe),we(()=>{yr($e,"active",d()==="main"),yr(at,"active",d()==="sub")}),Y(ee,oe)});var Xe=m(rf,2);Xe.__click=[yZ,wt,p];var Dp=m(y(Xe),2),nm=y(Dp);_(Dp),_(Xe);var Sp=m(Xe,2);Sp.__click=[mZ,p];var sc=m(Sp,2);sc.__click=[vZ];var Xf=m(sc,2);Xf.__click=[gZ,T,Ne];var ch=m(Xf,2);ch.__click=[pZ,Te];var Vh=m(ch,2);Vh.__click=[fZ,p];var Lh=m(Vh,2);Lh.__click=v;var cp=m(y(Lh),2),cd=y(cp,!0);_(cp),_(Lh);var u0=m(Lh,2);Ve(u0,()=>!i(Es),ee=>{var oe=jZ();oe.__click=[IZ,Es,p],Y(ee,oe)},ee=>{var oe=BZ();oe.__click=_a,Y(ee,oe)});var Iv=m(u0,2);Iv.__click=[hZ,Es,p],_(bh),_(tr);var Dm=m(tr,2),xh=y(Dm),th=y(xh),Um=y(th),dv=y(Um),Bg=m(y(dv),2),Wh=y(Bg);_(Bg);var om=m(Bg,2),Og=y(om);_(om),_(dv),Oi(2),_(Um);var hm=m(Um,2),mm=y(hm);Ve(mm,()=>i(Ct)!=="failed",ee=>{var oe=zZ(),$e=y(oe);Ve($e,()=>i(Ct)!=="ready",at=>{var Gt=OZ();Y(at,Gt)}),_(oe),hp(oe,at=>b(Ks,at),()=>i(Ks)),Y(ee,oe)},ee=>{var oe=WZ(),$e=_s(oe);qo($e,21,()=>i(yn),yi,(Xs,Xn,ho)=>{var Zn=VZ();Zn.textContent=ho+1,Y(Xs,Zn)}),_($e),hp($e,Xs=>b(kp,Xs),()=>i(kp));var at=m($e,2),Gt=y(at),Nt=y(Gt),Cs=y(Nt);u8(Cs,()=>i(Iu)),_(Nt),Oi(2),_(Gt),hp(Gt,Xs=>b(Hl,Xs),()=>i(Hl));var nn=m(Gt,2);R4(nn),nn.__input=fi,hp(nn,Xs=>b(Qd,Xs),()=>i(Qd)),_(at),pd("scroll",nn,fi),Fn(nn,t),Y(ee,oe)}),_(hm),_(th);var zg=m(th,2);Ve(zg,()=>i(Ol).length,ee=>{var oe=rJ(),$e=y(oe),at=m(y($e),4);Ve(at,()=>i(Ui).length,Nt=>{var Cs=qZ();qo(Cs,21,()=>i(Ui).slice(0,3),nn=>nn.message,(nn,Xs)=>{var Xn=HZ(),ho=y(Xn);_(Xn),we(()=>st(ho,`Line ${i(Xs).line??""}: ${i(Xs).message??""}`)),Y(nn,Xn)}),_(Cs),Y(Nt,Cs)});var Gt=m(at,2);qo(Gt,21,()=>i(Ol),Nt=>Nt.name,(Nt,Cs)=>{var nn=iJ(),Xs=y(nn),Xn=y(Xs),ho=y(Xn,!0);_(Xn);var Zn=m(Xn,2),Go=y(Zn,!0);_(Zn),_(Xs);var mi=m(Xs,2),$o=y(mi);Ve($o,()=>i(Cs).type==="bool",kl=>{var Fl=GZ(),il=y(Fl);Ts(il),we(()=>qm(il,!!i(bl)[i(Cs).name])),il.__change=[UZ,Ua,Cs],Oi(2),_(Fl),Y(kl,Fl)},kl=>{var Fl=Qs(),il=_s(Fl);Ve(il,()=>i(Cs).type==="string"||i(Cs).type==="session"||i(Cs).type==="symbol",Ya=>{var Kl=KZ();Ts(Kl),we(()=>qf(Kl,String(i(bl)[i(Cs).name]??""))),Kl.__input=[YZ,Ua,Cs],Y(Ya,Kl)},Ya=>{var Kl=Qs(),ru=_s(Kl);Ve(ru,()=>i(Cs).type==="time",vd=>{var nc=ZZ();Ts(nc),we(()=>qf(nc,jt(i(bl)[i(Cs).name]??i(Cs).defval))),nc.__input=[XZ,ft,Ua,Cs],Y(vd,nc)},vd=>{var nc=Qs(),af=_s(nc);Ve(af,()=>i(Cs).type==="source",zd=>{var lf=eJ(),ef=y(lf);Ts(ef),we(()=>qf(ef,String(i(bl)[i(Cs).name]??i(Cs).defval??"close"))),ef.__input=[JZ,Ua,Cs];var Hn=m(ef,2);qo(Hn,21,()=>xt,yi,(Oo,pi)=>{var ur=QZ(),Mc={};we(()=>{Mc!==(Mc=i(pi))&&(ur.value=(ur.__value=i(pi))==null?"":i(pi))}),Y(Oo,ur)}),_(Hn),_(lf),we(()=>{Dt(ef,"list",`source-options-${i(Cs).name}`),Dt(Hn,"id",`source-options-${i(Cs).name}`)}),Y(zd,lf)},zd=>{var lf=Qs(),ef=_s(lf);Ve(ef,()=>i(Cs).type==="color",Hn=>{var Oo=sJ();Ts(Oo),we(()=>qf(Oo,ke(i(bl)[i(Cs).name]??i(Cs).defval))),Oo.__input=[tJ,Ua,Cs],Y(Hn,Oo)},Hn=>{var Oo=oJ();Ts(Oo),we(()=>qf(Oo,Number(i(bl)[i(Cs).name]??i(Cs).defval))),Oo.__input=[nJ,Ua,Cs],we(()=>{Dt(Oo,"step",i(Cs).step??(i(Cs).type==="int"?1:.01)),Dt(Oo,"min",i(Cs).minval),Dt(Oo,"max",i(Cs).maxval)}),Y(Hn,Oo)},!0),Y(zd,lf)},!0),Y(vd,nc)},!0),Y(Ya,Kl)},!0),Y(kl,Fl)}),_(mi),_(nn),we(()=>{st(ho,i(Cs).title||i(Cs).name),st(Go,i(Cs).name)}),Y(Nt,nn)}),_(Gt),Oi(2),_($e),_(oe),Y(ee,oe)}),_(xh),_(Dm);var Gm=m(Dm,2);Ve(Gm,()=>i(Se)==="errors",ee=>{var oe=fJ(),$e=y(oe);Ve($e,()=>i(mr).length===0,at=>{var Gt=aJ();Y(at,Gt)},at=>{var Gt=dJ(),Nt=_s(Gt),Cs=y(Nt),nn=y(Cs);_(Cs),Oi(2),_(Nt);var Xs=m(Nt,2);qo(Xs,21,()=>i(mr),yi,(Xn,ho)=>{var Zn=uJ(),Go=m(y(Zn),2),mi=y(Go);Ve(mi,()=>i(ho).line,Fl=>{var il=lJ(),Ya=y(il),Kl=m(Ya);Ve(Kl,()=>i(ho).col,ru=>{var vd=I0();we(()=>st(vd,`· Col ${i(ho).col??""}`)),Y(ru,vd)}),Oi(),_(il),we(()=>st(Ya,`Line ${i(ho).line??""}`)),Y(Fl,il)});var $o=m(mi);_(Go);var kl=m(Go,2);Ve(kl,()=>i(ho).hint,Fl=>{var il=cJ(),Ya=y(il);_(il),we(()=>st(Ya,`— ${i(ho).hint??""}`)),Y(Fl,il)}),_(Zn),we(()=>{$i(Zn,`${`diag-item ${i(ho).level}`??""} svelte-1ehcy4i`),st($o,` ${i(ho).message??""}`)}),Y(Xn,Zn)}),_(Xs),we(()=>st(nn,`Errors (${(i(Cr)||0)??""})`)),Y(at,Gt)}),_(oe),Y(ee,oe)},ee=>{var oe=Qs(),$e=_s(oe);Ve($e,()=>i(Se)==="results",at=>{var Gt=hte(),Nt=y(Gt);Ve(Nt,()=>i(Ls),nn=>{var Xs=rQ();Xs.__click=$u;var Xn=y(Xs);Xn.__click=[pJ];var ho=y(Xn),Zn=m(y(ho),2),Go=y(Zn),mi=y(Go);mi.__click=[hJ,tn];var $o=m(mi,2);$o.__click=[mJ,tn],_(Go);var kl=m(Go,2);kl.__click=$u,_(Zn),_(ho);var Fl=m(ho,2),il=y(Fl);Ve(il,()=>i(tn)==="trades",Ya=>{var Kl=OJ(),ru=_s(Kl),vd=y(ru),nc=y(vd),af=m(y(nc)),zd=y(af);_(af),_(nc),Oi(2),_(vd);var lf=m(vd,2),ef=y(lf);Ts(ef),ef.__input=[vJ,Fd];var Hn=m(ef,2);Hn.__click=[gJ,Gs];var Oo=y(Hn,!0);_(Hn);var pi=m(Hn,2);Ve(pi,()=>i(zl).type!=="all",Nc=>{var Vf=yJ();Vf.__click=[_J,Af],Y(Nc,Vf)});var ur=m(pi,2);ur.__click=[b6,B,vc,su,Na,Rc,za,Yc,Ir,ve],_(lf),_(ru);var Mc=m(ru,2);Ve(Mc,()=>i(jf).length,Nc=>{var Vf=jJ(),xu=y(Vf),nd=y(xu),Dd=y(nd),Jf=m(y(Dd)),fr=y(Jf);fr.__click=[bJ,xa];var sh=y(fr);we(()=>st(sh,`Side ${ku("side")??""}`)),_(fr),_(Jf);var gm=m(Jf),_m=y(gm);_m.__click=[xJ,xa];var wh=y(_m);we(()=>st(wh,`Entry ${ku("entryIndex")??""}`)),_(_m),_(gm);var Uh=m(gm),Nm=y(Uh);Nm.__click=[wJ,xa];var Ym=y(Nm);we(()=>st(Ym,`Exit ${ku("exitIndex")??""}`)),_(Nm),_(Uh);var Rp=m(Uh),Eh=y(Rp);Eh.__click=[kJ,xa];var Am=y(Eh);we(()=>st(Am,`Qty ${ku("qty")??""}`)),_(Eh),_(Rp);var im=m(Rp),nh=y(im);nh.__click=[SJ,xa];var fv=y(nh);we(()=>st(fv,`Bars ${ku("barsHeld")??""}`)),_(nh),_(im);var Gh=m(im),Cp=y(Gh);Cp.__click=[CJ,xa];var vf=y(Cp);we(()=>st(vf,`Net PnL ${ku("netPnl")??""}`)),_(Cp),_(Gh);var ym=m(Gh),Tm=y(ym);Tm.__click=[IJ,xa];var M=y(Tm);we(()=>st(M,`PnL% ${ku("pnlPct")??""}`)),_(Tm),_(ym);var V=m(ym);Ve(V,()=>i(Gs)==="full",me=>{var ae=FJ(),We=_s(ae),He=y(We);He.__click=[PJ,xa];var At=y(He);we(()=>st(At,`Fees ${ku("fees")??""}`)),_(He),_(We);var Wt=m(We,2),Jt=y(Wt);Jt.__click=[MJ,xa];var $s=y(Jt);we(()=>st($s,`Gross ${ku("pnl")??""}`)),_(Jt),_(Wt);var Kt=m(Wt,2),Us=y(Kt);Us.__click=[NJ,xa];var es=y(Us);we(()=>st(es,`MAE% ${ku("maePct")??""}`)),_(Us),_(Kt);var rn=m(Kt,2),pn=y(rn);pn.__click=[AJ,xa];var Nn=y(pn);we(()=>st(Nn,`MFE% ${ku("mfePct")??""}`)),_(pn),_(rn);var js=m(rn,6),qt=y(js);qt.__click=[TJ,xa];var Os=y(qt);we(()=>st(Os,`Cum Net ${ku("cumNet")??""}`)),_(qt),_(js),Y(me,ae)}),_(Dd),_(nd);var fe=m(nd);qo(fe,21,()=>i(jf),me=>me.id,(me,ae)=>{var We=RJ();We.__click=[LJ,xl,ae],We.__keydown=[EJ,xl,ae];var He=y(We),At=y(He);At.__click=[$J,Su,ae],_(He);var Wt=m(He),Jt=y(Wt),$s=y(Jt,!0);we(()=>st($s,su(i(ae).side))),_(Jt),_(Wt);var Kt=m(Wt),Us=y(Kt),es=y(Us),rn=m(y(es)),pn=y(rn);_(rn),_(es);var Nn=m(es,2),js=m(y(Nn)),qt=y(js,!0);_(js),_(Nn);var Os=m(Nn,2),zs=m(y(Os)),mn=y(zs,!0);we(()=>st(mn,Na(i(ae).entryPrice))),_(zs),_(Os),_(Us),_(Kt);var un=m(Kt),jn=y(un),ro=y(jn),ys=m(y(ro)),qs=y(ys);_(ys),_(ro);var Js=m(ro,2),is=m(y(Js)),ts=y(is,!0);_(is),_(Js);var Ss=m(Js,2),ln=m(y(Ss)),on=y(ln,!0);we(()=>st(on,Na(i(ae).exitPrice))),_(ln),_(Ss),_(jn),_(un);var yo=m(un),pr=y(yo,!0);we(()=>st(pr,Rc(i(ae).qty))),_(yo);var dn=m(yo),Fo=y(dn,!0);we(()=>st(Fo,za(i(ae).barsHeld,0))),_(dn);var Dn=m(dn);const Yo=Lt(()=>(Number(i(ae).netPnl)>=0?"+":"")??""),Fi=Lt(()=>Yc(i(ae).netPnl)??"");var fo=y(Dn);we(()=>st(fo,`${i(Yo)}${i(Fi)}`)),_(Dn);var Pn=m(Dn),ii=y(Pn,!0);we(()=>st(ii,Ir(i(ae).pnlPct))),_(Pn);var Dr=m(Pn);Ve(Dr,()=>i(Gs)==="full",ni=>{var Xo=DJ(),sr=_s(Xo),Sl=y(sr,!0);we(()=>st(Sl,Yc(i(ae).fees))),_(sr);var Ru=m(sr,2);const rl=Lt(()=>(Number(i(ae).pnl)>=0?"+":"")??""),Vi=Lt(()=>Yc(i(ae).pnl)??"");var Xl=y(Ru);we(()=>st(Xl,`${i(rl)}${i(Vi)}`)),_(Ru);var Hc=m(Ru,2),Da=y(Hc,!0);we(()=>st(Da,i(ae).maePct==null?"-":Ir(i(ae).maePct))),_(Hc);var gf=m(Hc,2),ju=y(gf,!0);we(()=>st(ju,i(ae).mfePct==null?"-":Ir(i(ae).mfePct))),_(gf);var Ka=m(gf,2),Gu=y(Ka),tf=y(Gu),kh=m(y(tf)),oh=y(kh,!0);_(kh),_(tf);var vp=m(tf,2),Ff=m(y(vp)),ih=y(Ff,!0);_(Ff),_(vp),_(Gu),_(Ka);var bm=m(Ka,2),jp=y(bm,!0);_(bm);var Pv=m(bm,2);const gp=Lt(()=>(Number(i(ae).cumNet)>=0?"+":"")??""),uc=Lt(()=>Yc(i(ae).cumNet)??"");var vr=y(Pv);we(()=>st(vr,`${i(gp)}${i(uc)}`)),_(Pv),we(()=>{st(oh,i(ae).entrySignalId||"-"),st(ih,i(ae).exitSignalId||"-"),st(jp,i(ae).exitReason||"-")}),Y(ni,Xo)}),_(We),we(()=>{yr(We,"selected",i(Jd)===i(ae).id),yr(We,"pos",i(ae).netPnl>=0),yr(We,"neg",i(ae).netPnl<0),st(pn,`#${i(ae).entryIndex??""}`),st(qt,i(ae).entryTimeLabel),st(qs,`#${i(ae).exitIndex??""}`),st(ts,i(ae).exitTimeLabel)}),Y(me,We)}),_(fe),_(xu),_(Vf),we(()=>$i(xu,`${`tt-table tt-table-trades ${i(Gs)}`??""} svelte-1ehcy4i`)),Y(Nc,Vf)},Nc=>{var Vf=BJ();Y(Nc,Vf)}),we(()=>{st(zd,`(${i(Qu).length??""}/${i(vc).length??""})`),qf(ef,i(Fd)),st(Oo,i(Gs)==="compact"?"Show details":"Compact view")}),Y(Ya,Kl)},Ya=>{var Kl=iQ(),ru=_s(Kl),vd=y(ru),nc=m(y(vd),2),af=y(nc),zd=m(af);Ve(zd,()=>i(rc).length>500,ur=>{var Mc=I0("• Showing last 500");Y(ur,Mc)}),_(nc),Oi(2),_(vd);var lf=m(vd,2),ef=y(lf);ef.__click=[zJ,an];var Hn=y(ef,!0);_(ef);var Oo=m(ef,2);Oo.__click=[x6,B,rc,za,Rc,Yc,Na,ve],_(lf),_(ru);var pi=m(ru,2);Ve(pi,()=>i(rc).length,ur=>{var Mc=nQ(),Nc=y(Mc),Vf=y(Nc),xu=y(Vf),nd=m(y(xu),7);Ve(nd,()=>i(an)==="full",Jf=>{var fr=VJ();Oi(4),Y(Jf,fr)}),_(xu),_(Vf);var Dd=m(Vf);qo(Dd,21,()=>i(wd),Jf=>Jf.id,(Jf,fr)=>{var sh=sQ(),gm=y(sh),_m=y(gm);_m.__click=[WJ,ad,fr],_(gm);var wh=m(gm),Uh=y(wh,!0);_(wh);var Nm=m(wh),Ym=y(Nm),Rp=y(Ym,!0);_(Ym),_(Nm);var Eh=m(Nm),Am=y(Eh),im=y(Am),nh=m(y(im),2),fv=y(nh,!0);_(nh),_(im);var Gh=m(im,2),Cp=m(y(Gh),2),vf=y(Cp,!0);_(Cp),_(Gh);var ym=m(Gh,2),Tm=m(y(ym),2),M=y(Tm,!0);_(Tm),_(ym),_(Am),_(Eh);var V=m(Eh),fe=y(V),me=y(fe),ae=m(y(me)),We=y(ae);_(ae),_(me);var He=m(me,2),At=m(y(He)),Wt=y(At,!0);_(At),_(He),_(fe),_(V);var Jt=m(V),$s=y(Jt),Kt=y($s),Us=m(y(Kt)),es=y(Us);we(()=>st(es,`${za(i(fr).qtyPct,2)??""}%`)),_(Us),_(Kt);var rn=m(Kt,2);Ve(rn,()=>i(fr).qty!=null,Dr=>{var ni=HJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Rc(i(fr).qty))),_(Xo),_(ni),Y(Dr,ni)});var pn=m(rn,2);Ve(pn,()=>i(fr).cash!=null,Dr=>{var ni=qJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Yc(i(fr).cash))),_(Xo),_(ni),Y(Dr,ni)});var Nn=m(pn,2);Ve(Nn,()=>i(fr).price!=null,Dr=>{var ni=UJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Na(i(fr).price))),_(Xo),_(ni),Y(Dr,ni)});var js=m(Nn,2);Ve(js,()=>i(fr).stopPrice!=null,Dr=>{var ni=GJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Na(i(fr).stopPrice))),_(Xo),_(ni),Y(Dr,ni)});var qt=m(js,2);Ve(qt,()=>i(fr).limitPrice!=null,Dr=>{var ni=YJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Na(i(fr).limitPrice))),_(Xo),_(ni),Y(Dr,ni)});var Os=m(qt,2);Ve(Os,()=>i(fr).tif,Dr=>{var ni=KJ(),Xo=m(y(ni)),sr=y(Xo,!0);_(Xo),_(ni),we(()=>st(sr,i(fr).tif)),Y(Dr,ni)});var zs=m(Os,2);Ve(zs,()=>i(fr).trailPct!=null,Dr=>{var ni=XJ(),Xo=m(y(ni)),sr=y(Xo);we(()=>st(sr,`${za(i(fr).trailPct,2)??""}%`)),_(Xo),_(ni),Y(Dr,ni)});var mn=m(zs,2);Ve(mn,()=>i(fr).trailOffset!=null,Dr=>{var ni=ZJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Na(i(fr).trailOffset))),_(Xo),_(ni),Y(Dr,ni)});var un=m(mn,2);Ve(un,()=>i(fr).trailPrice!=null,Dr=>{var ni=JJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Na(i(fr).trailPrice))),_(Xo),_(ni),Y(Dr,ni)}),_($s),_(Jt);var jn=m(Jt),ro=y(jn),ys=y(ro),qs=m(y(ys)),Js=y(qs,!0);_(qs),_(ys);var is=m(ys,2),ts=m(y(is)),Ss=y(ts,!0);_(ts),_(is);var ln=m(is,2),on=m(y(ln)),yo=y(on,!0);we(()=>st(yo,i(fr).fillQty==null?"-":Rc(i(fr).fillQty))),_(on),_(ln);var pr=m(ln,2);Ve(pr,()=>i(fr).remainingQty!=null,Dr=>{var ni=QJ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Rc(i(fr).remainingQty))),_(Xo),_(ni),Y(Dr,ni)});var dn=m(pr,2);Ve(dn,()=>i(fr).targetQty!=null,Dr=>{var ni=eQ(),Xo=m(y(ni)),sr=y(Xo,!0);we(()=>st(sr,Rc(i(fr).targetQty))),_(Xo),_(ni),Y(Dr,ni)});var Fo=m(dn,2),Dn=m(y(Fo)),Yo=y(Dn,!0);we(()=>st(Yo,i(fr).fillPrice==null?"-":Na(i(fr).fillPrice))),_(Dn),_(Fo);var Fi=m(Fo,2),fo=m(y(Fi)),Pn=y(fo,!0);we(()=>st(Pn,i(fr).fees==null?"-":Yc(i(fr).fees))),_(fo),_(Fi),_(ro),_(jn);var ii=m(jn);Ve(ii,()=>i(an)==="full",Dr=>{var ni=tQ(),Xo=_s(ni),sr=y(Xo),Sl=y(sr),Ru=m(y(Sl)),rl=y(Ru);_(Ru),_(Sl);var Vi=m(Sl,2),Xl=m(y(Vi)),Hc=y(Xl,!0);_(Xl),_(Vi),_(sr),_(Xo);var Da=m(Xo,2),gf=y(Da),ju=y(gf),Ka=m(y(ju)),Gu=y(Ka,!0);_(Ka),_(ju);var tf=m(ju,2),kh=m(y(tf)),oh=y(kh,!0);_(kh),_(tf),_(gf),_(Da);var vp=m(Da,2),Ff=y(vp,!0);_(vp),we(()=>{st(rl,`#${i(fr).activeFromIndex??""}`),st(Hc,i(fr).expiresAtIndex==null?"-":`#${i(fr).expiresAtIndex}`),st(Gu,i(fr).signalId||"-"),st(oh,i(fr).ocoGroup||"-"),st(Ff,i(fr).note||"-")}),Y(Dr,ni)}),_(sh),we(()=>{st(Uh,i(fr).id),$i(Ym,`${`tt-pill status status-${i(fr).statusKey}`??""} svelte-1ehcy4i`),st(Rp,i(fr).statusLabel),st(fv,i(fr).actionLabel),st(vf,i(fr).sideLabel),st(M,i(fr).kindLabel),st(We,`#${i(fr).createdIndex??""}`),st(Wt,i(fr).createdTimeLabel),st(Js,i(fr).filledIndex==null?"-":`#${i(fr).filledIndex}`),st(Ss,i(fr).filledIndex==null?"-":i(fr).filledTimeLabel)}),Y(Jf,sh)}),_(Dd),_(Nc),_(Mc),we(()=>$i(Nc,`${`tt-table tt-table-orders ${i(an)}`??""} svelte-1ehcy4i`)),Y(ur,Mc)},ur=>{var Mc=oQ();Y(ur,Mc)}),we(()=>{st(af,`Rows ${i(rc).length??""}`),st(Hn,i(an)==="compact"?"Show details":"Compact view")}),Y(Ya,Kl)}),_(Fl),_(Xn),_(Xs),we(()=>{yr(mi,"active",i(tn)==="trades"),yr($o,"active",i(tn)==="orders")}),Y(nn,Xs)});var Cs=m(Nt,2);Ve(Cs,()=>!i(er),nn=>{var Xs=Qs(),Xn=_s(Xs);Ve(Xn,()=>!i(gu),ho=>{var Zn=cQ(),Go=y(Zn);Ve(Go,()=>i(tc)||i(mc),mi=>{var $o=aQ();Oi(4),Y(mi,$o)},mi=>{var $o=lQ();Oi(4),Y(mi,$o)}),_(Zn),Y(ho,Zn)},ho=>{var Zn=Qs(),Go=_s(Zn);Ve(Go,()=>!i(Bl),mi=>{var $o=fQ(),kl=y($o);Ve(kl,()=>i(tc)||i(mc),Fl=>{var il=uQ();Oi(4),Y(Fl,il)},Fl=>{var il=dQ();Oi(4),Y(Fl,il)}),_($o),Y(mi,$o)},mi=>{var $o=mQ(),kl=y($o);Ve(kl,f,il=>{var Ya=I0("Running… please wait.");Y(il,Ya)},il=>{var Ya=pQ();Oi(2),Y(il,Ya)});var Fl=m(kl,2);Ve(Fl,()=>i(tc)||i(mc),il=>{var Ya=hQ(),Kl=y(Ya);_(Ya),we(()=>st(Kl,`Pine parsed: strategy ${(i(tc)?"yes":"no")??""} • signals
                ${(i(mc)?"yes":"no")??""}`)),Y(il,Ya)}),_($o),Y(mi,$o)},!0),Y(ho,Zn)}),Y(nn,Xs)},nn=>{var Xs=pte(),Xn=y(Xs),ho=m(y(Xn),2),Zn=y(ho),Go=m(y(Zn),2),mi=y(Go,!0);we(()=>st(mi,io(i(er).finalEquity,2))),_(Go),_(Zn);var $o=m(Zn,2),kl=m(y($o),2),Fl=y(kl);we(()=>st(Fl,`${(i(er).netPnl>=0?"+":"")??""}${io(i(er).netPnl,2)??""}`)),_(kl),_($o);var il=m($o,2),Ya=m(y(il),2),Kl=y(Ya,!0);we(()=>st(Kl,tu(i(er).maxDrawdownPct))),_(Ya),_(il),_(ho),_(Xn);var ru=m(Xn,2),vd=y(ru),nc=m(y(vd)),af=y(nc,!0);_(nc);var zd=m(nc,2),lf=y(zd);_(zd),_(vd);var ef=m(vd,2);Ve(ef,()=>i(ba).lastTs,zn=>{var qn=vQ(),ua=m(y(qn)),oa=y(ua,!0);we(()=>st(oa,new Date(i(ba).lastTs).toISOString().slice(0,10))),_(ua),_(qn),Y(zn,qn)});var Hn=m(ef,2);Ve(Hn,()=>i(aa),zn=>{var qn=gQ(),ua=m(y(qn)),oa=y(ua,!0);_(ua),_(qn),we(()=>st(oa,i(aa))),Y(zn,qn)}),_(ru);var Oo=m(ru,2),pi=y(Oo),ur=y(pi),Mc=y(ur),Nc=m(y(Mc),2);Nc.__click=[_Q,Mn],_(Mc),Oi(2),_(ur),_(pi);var Vf=m(pi,2),xu=y(Vf),nd=m(y(xu),2),Dd=y(nd),Jf=m(y(Dd),2);Ts(Jf),Jf.__input=[yQ,go],_(Dd);var fr=m(Dd,2),sh=m(y(fr),2);Ts(sh),sh.__input=[bQ,no],_(fr);var gm=m(fr,2),_m=m(y(gm),2);Ts(_m),_m.__input=[xQ,Bo],_(gm),_(nd);var wh=m(nd,2),Uh=y(wh);Uh.__click=v;var Nm=m(Uh,2);Ve(Nm,()=>i(Rl),zn=>{var qn=wQ();qn.__click=[wZ,go,no,Bo],Y(zn,qn)});var Ym=m(Nm,2);Ve(Ym,()=>i(aa),zn=>{var qn=kQ(),ua=y(qn,!0);_(qn),we(()=>st(ua,i(aa))),Y(zn,qn)}),Oi(2),_(wh),_(xu);var Rp=m(xu,2),Eh=m(y(Rp),2),Am=y(Eh);Ts(Am),Am.__input=[SQ,Tn];var im=m(Am,2);im.__click=[bZ,er,Tn,po,fl];var nh=m(im,2);Ve(nh,()=>i(po).length,zn=>{var qn=CQ();qn.__click=[xZ,po,br,Wc],Y(zn,qn)}),_(Eh);var fv=m(Eh,2);Ve(fv,()=>i(po).length,zn=>{var qn=DQ(),ua=m(y(qn),2);qo(ua,17,()=>i(po),oa=>oa.id,(oa,So)=>{var dr=$Q(),Zl=_s(dr),Aa=y(Zl),Za=y(Aa,!0);_(Aa);var Va=m(Aa,2),da=y(Va);we(()=>st(da,`${(i(So).summary.netPnl>=0?"+":"")??""}${io(i(So).summary.netPnl,2)??""}`)),_(Va);var k=m(Va,2),N=y(k,!0);we(()=>st(N,tu(i(So).summary.netPnlPct??0))),_(k);var R=m(k,2),F=y(R,!0);we(()=>st(F,tu(i(So).summary.maxDrawdownPct??0))),_(R);var z=m(R,2),q=y(z,!0);we(()=>st(q,jc(i(So).summary.sharpe??0))),_(z);var he=m(z,2),Ee=y(he,!0);we(()=>st(Ee,tu(i(So).summary.winRate??0))),_(he);var lt=m(he,2),Qt=y(lt,!0);_(lt);var en=m(lt,2),Zs=y(en,!0);we(()=>st(Zs,Uu(i(So).params))),_(en);var xs=m(en,2),Un=y(xs);Un.__click=[IQ,Xd,So];var jo=y(Un,!0);_(Un);var Lc=m(Un,2);Lc.__click=[PQ,Cn,So],_(xs),_(Zl);var Id=m(Zl,2);Ve(Id,()=>i(br)===i(So).id,sf=>{var au=EQ(),Wd=y(au),ud=m(y(Wd),2);qo(ud,21,()=>tp(i(So).summary),yi,(Ul,Wa)=>{var Wo=MQ(),ji=y(Wo),Jl=y(ji,!0);_(ji);var zr=m(ji,2),dc=y(zr,!0);_(zr),_(Wo),we(()=>{st(Jl,i(Wa).label),st(dc,i(Wa).value)}),Y(Ul,Wo)}),_(ud),_(Wd);var Hd=m(Wd,2),dd=m(y(Hd),2);Ve(dd,()=>i(So).params&&Object.keys(i(So).params).length,Ul=>{var Wa=AQ();qo(Wa,21,()=>Object.entries(i(So).params),yi,(Wo,ji)=>{let Jl=()=>i(ji)[0],zr=()=>i(ji)[1];var dc=NQ(),Jc=y(dc),Vr=y(Jc,!0);_(Jc);var ml=m(Jc,2),Bc=y(ml,!0);we(()=>st(Bc,xf(zr(),0))),_(ml),_(dc),we(()=>st(Vr,Jl())),Y(Wo,dc)}),_(Wa),Y(Ul,Wa)},Ul=>{var Wa=TQ();Y(Ul,Wa)}),_(Hd);var Rd=m(Hd,2),Ou=m(y(Rd),2);Ou.__click=[FQ,Uf,So];var Pd=y(Ou,!0);_(Ou);var Rr=m(Ou,2);Ve(Rr,()=>i(Wc)[i(So).id],Ul=>{var Wa=LQ(),Wo=y(Wa,!0);we(()=>st(Wo,wf(i(So)))),_(Wa),Y(Ul,Wa)}),_(Rd),_(au),we(()=>st(Pd,i(Wc)[i(So).id]?"Hide raw":"Show raw")),Y(sf,au)}),we(()=>{st(Za,i(So).label),$i(Va,`${`right mono ${i(So).summary.netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),st(Qt,i(So).summary.trades??0),Dt(Un,"aria-expanded",i(br)===i(So).id),st(jo,i(br)===i(So).id?"Hide":"Details")}),Y(oa,dr)}),_(qn),Y(zn,qn)},zn=>{var qn=RQ();Y(zn,qn)}),_(Rp),_(Vf),_(Oo);var Gh=m(Oo,2),Cp=y(Gh),vf=y(Cp),ym=y(vf),Tm=m(y(ym),2);Tm.__click=[jQ,Mn],_(ym),Oi(2),_(vf),_(Cp);var M=m(Cp,2),V=y(M),fe=m(y(V),2),me=y(fe,!0);_(fe);var ae=m(fe,2),We=y(ae),He=m(We);Ve(He,()=>i(er).roundTrips!=null,zn=>{var qn=I0();we(()=>st(qn,`• Positions ${i(er).roundTrips??""}`)),Y(zn,qn)}),_(ae),_(V);var At=m(V,2),Wt=m(y(At),2),Jt=y(Wt,!0);we(()=>st(Jt,tu(i(er).winRate))),_(Wt);var $s=m(Wt,2);const Kt=Lt(()=>tu(i(er).maxDrawdownPct)??""),Us=Lt(()=>io(i(er).maxDrawdownValue??0,2)??"");var es=y($s);we(()=>st(es,`Max DD ${i(Kt)} / ${i(Us)}`)),_($s),_(At);var rn=m(At,2),pn=m(y(rn),2),Nn=y(pn);we(()=>st(Nn,`${(i(er).netPnl>=0?"+":"")??""}${io(i(er).netPnl,2)??""}`)),_(pn);var js=m(pn,2);const qt=Lt(()=>tu(i(er).netPnlPct)??""),Os=Lt(()=>io(i(er).feesPaid,2)??""),zs=Lt(()=>jc(i(er).profitFactor)??"");var mn=y(js);we(()=>st(mn,`${i(qt)} • Fees ${i(Os)} • PF ${i(zs)}`)),_(js),_(rn);var un=m(rn,2),jn=m(y(un),2),ro=y(jn);we(()=>st(ro,`${(i(er).expectancy>=0?"+":"")??""}${io(i(er).expectancy??0,2)??""}`)),_(jn);var ys=m(jn,2);const qs=Lt(()=>io(i(er).avgTrade??0,2)??""),Js=Lt(()=>jc(i(er).payoffRatio??0)??""),is=Lt(()=>i(er).maxConsecWins??0??""),ts=Lt(()=>i(er).maxConsecLosses??0??"");var Ss=y(ys);we(()=>st(Ss,`Avg ${i(qs)} • Payoff
                  ${i(Js)} • Streak
                  W ${i(is)}/L ${i(ts)}`)),_(ys),_(un);var ln=m(un,2),on=m(y(ln),2),yo=y(on);we(()=>st(yo,`Sharpe ${jc(i(er).sharpe??0)??""}`)),_(on);var pr=m(on,2);const dn=Lt(()=>jc(i(er).sortino??0)??""),Fo=Lt(()=>tu(i(er).volatilityPct??0)??"");var Dn=y(pr);we(()=>st(Dn,`Sortino ${i(dn)} • Vol
                  ${i(Fo)}`)),_(pr),_(ln);var Yo=m(ln,2),Fi=m(y(Yo),2),fo=y(Fi,!0);we(()=>st(fo,tu(i(er).exposurePct??0))),_(Fi);var Pn=m(Fi,2);const ii=Lt(()=>tu(i(er).maxRunupPct??0)??""),Dr=Lt(()=>io(i(er).maxRunupValue??0,2)??""),ni=Lt(()=>io(i(er).avgBarsInTrade??0,1)??""),Xo=Lt(()=>jc(i(er).calmar??0)??"");var sr=y(Pn);we(()=>st(sr,`Run-up ${i(ii)} / ${i(Dr)} • Bars/trade
                  ${i(ni)} • Calmar
                  ${i(Xo)}`)),_(Pn),_(Yo),_(M);var Sl=m(M,2);Ve(Sl,()=>i(er).trades===0,zn=>{var qn=zQ(),ua=m(y(qn),2),oa=y(ua);Ve(oa,()=>i(ba).total===0,So=>{var dr=BQ();Oi(2),Y(So,dr)},So=>{var dr=OQ();Oi(2),Y(So,dr)}),_(ua),_(qn),Y(zn,qn)}),_(Gh);var Ru=m(Gh,2),rl=y(Ru),Vi=y(rl),Xl=y(Vi),Hc=m(y(Xl),2);Hc.__click=[VQ,Mn],_(Xl),Oi(2),_(Vi),_(rl);var Da=m(rl,2),gf=y(Da),ju=m(y(gf),2),Ka=m(y(ju),2),Gu=y(Ka);_(Ka);var tf=m(Ka,2),kh=y(tf);we(()=>st(kh,`Win ${tu(i(td).long.winRate)??""}`)),_(tf);var oh=m(tf,2),vp=y(oh);we(()=>st(vp,`Net ${(i(td).long.net>=0?"+":"")??""}${io(i(td).long.net,2)??""}`)),_(oh);var Ff=m(oh,2),ih=y(Ff);we(()=>st(ih,`PF ${jc(i(td).long.profitFactor)??""}`)),_(Ff),_(ju);var bm=m(ju,2),jp=m(y(bm),2),Pv=y(jp);_(jp);var gp=m(jp,2),uc=y(gp);we(()=>st(uc,`Win ${tu(i(td).short.winRate)??""}`)),_(gp);var vr=m(gp,2),Lf=y(vr);we(()=>st(Lf,`Net ${(i(td).short.net>=0?"+":"")??""}${io(i(td).short.net,2)??""}`)),_(vr);var Mp=m(vr,2),Up=y(Mp);we(()=>st(Up,`PF ${jc(i(td).short.profitFactor)??""}`)),_(Mp),_(bm),_(gf);var Yh=m(gf,2),_p=m(y(Yh),2);Ve(_p,()=>i(sp).length,zn=>{var qn=HQ(),ua=m(y(qn),2);qo(ua,17,()=>i(sp).slice(0,12),yi,(oa,So)=>{var dr=WQ(),Zl=y(dr),Aa=y(Zl,!0);_(Zl);var Za=m(Zl,2),Va=y(Za,!0);_(Za);var da=m(Za,2),k=y(da,!0);we(()=>st(k,tu(i(So).winRate))),_(da);var N=m(da,2),R=y(N);we(()=>st(R,`${(i(So).net>=0?"+":"")??""}${io(i(So).net,2)??""}`)),_(N);var F=m(N,2),z=y(F,!0);we(()=>st(z,jc(i(So).profitFactor))),_(F),_(dr),we(()=>{st(Aa,i(So).id),st(Va,i(So).trades),$i(N,`${`right mono ${i(So).net>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),Y(oa,dr)}),_(qn),Y(zn,qn)},zn=>{var qn=qQ();Y(zn,qn)}),_(Yh),_(Da),_(Ru);var xm=m(Ru,2),pv=y(xm),Sh=y(pv),Mv=y(Sh),hv=m(y(Mv),2);hv.__click=[UQ,Mn],_(Mv),Oi(2),_(Sh);var rm=m(Sh,2),Km=y(rm,!0),Gv=m(Km);Ve(Gv,()=>i(Vc),zn=>{var qn=I0();we(()=>st(qn,`• Running ${i(Qc)??""}/${i(qu)??""} (${i(Td)??""}%) • ${i(qi)??""}`)),Y(zn,qn)}),_(rm),_(pv);var Xm=m(pv,2),up=y(Xm),Wi=m(y(up),2);Ve(Wi,()=>i(tl).length,zn=>{var qn=fee(),ua=_s(qn),oa=m(y(ua),2),So=y(oa);L0(So,()=>i(zi));var dr;So.__change=[GQ,kn],qo(So,21,()=>i(tl),Wa=>Wa.name,(Wa,Wo)=>{var ji=YQ(),Jl={},zr=y(ji,!0);_(ji),we(()=>{Jl!==(Jl=i(Wo).name)&&(ji.value=(ji.__value=i(Wo).name)==null?"":i(Wo).name),st(zr,i(Wo).title||i(Wo).name)}),Y(Wa,ji)}),_(So),_(oa),_(ua);var Zl=m(ua,2),Aa=y(Zl),Za=m(y(Aa),2);Ts(Za),Za.__input=[KQ,mu],_(Aa);var Va=m(Aa,2),da=m(y(Va),2);Ts(da),da.__input=[XQ,Gc],_(Va);var k=m(Va,2),N=m(y(k),2);Ts(N),N.__input=[ZQ,du],_(k),_(Zl);var R=m(Zl,2),F=m(y(R),2),z=y(F);L0(z,()=>i(Nl));var q;z.__change=[JQ,Kn];var he=y(z);he.value=((he.__value="")==null,"");var Ee=m(he);qo(Ee,17,()=>i(tl),Wa=>Wa.name,(Wa,Wo)=>{var ji=QQ(),Jl={},zr=y(ji,!0);_(ji),we(()=>{Jl!==(Jl=i(Wo).name)&&(ji.value=(ji.__value=i(Wo).name)==null?"":i(Wo).name),st(zr,i(Wo).title||i(Wo).name)}),Y(Wa,ji)}),_(z),_(F),_(R);var lt=m(R,2);Ve(lt,()=>i(Nl),Wa=>{var Wo=nee(),ji=y(Wo),Jl=m(y(ji),2);Ts(Jl),Jl.__input=[eee,Ju],_(ji);var zr=m(ji,2),dc=m(y(zr),2);Ts(dc),dc.__input=[tee,rd],_(zr);var Jc=m(zr,2),Vr=m(y(Jc),2);Ts(Vr),Vr.__input=[see,Al],_(Jc),_(Wo),we(()=>{qf(Jl,i(Ju)),qf(dc,i(rd)),qf(Vr,i(Al))}),Y(Wa,Wo)});var Qt=m(lt,2),en=m(y(Qt),2),Zs=y(en);L0(Zs,()=>i(sa));var xs;Zs.__change=[oee,sa];var Un=y(Zs);Un.value=(Un.__value="netPnl")==null?"":"netPnl";var jo=m(Un);jo.value=(jo.__value="profitFactor")==null?"":"profitFactor";var Lc=m(jo);Lc.value=(Lc.__value="sharpe")==null?"":"sharpe";var Id=m(Lc);Id.value=(Id.__value="winRate")==null?"":"winRate";var sf=m(Id);sf.value=(sf.__value="maxDrawdownPct")==null?"":"maxDrawdownPct",_(Zs),_(en),_(Qt);var au=m(Qt,2),Wd=m(y(au),2),ud=y(Wd),Hd=y(ud);Ts(Hd),Hd.__change=[iee,Dc],Oi(2),_(ud),_(Wd),_(au);var dd=m(au,2);Ve(dd,()=>i(Dc),Wa=>{var Wo=aee(),ji=m(y(Wo),2),Jl=y(ji);Ts(Jl),Jl.__input=[ree,jl],_(ji),_(Wo),we(()=>qf(Jl,i(jl))),Y(Wa,Wo)});var Rd=m(dd,2),Ou=y(Rd);Ou.__click=[kZ,tl,yl,zi,Nl,Bs,mu,Gc,du,Ju,rd,Al,bl,vu,ec,Qc,Vc,To,qi,la,El,l,Ai];var Pd=m(Ou,2);Ve(Pd,()=>i(Vc),Wa=>{var Wo=lee();Wo.__click=[SZ,Vc,To,vu,El],Y(Wa,Wo)},Wa=>{var Wo=Qs(),ji=_s(Wo);Ve(ji,()=>i(ec).length,Jl=>{var zr=cee();zr.__click=[CZ,ec,la,yl,Qc,vu,Vc,To,El],Y(Jl,zr)},null,!0),Y(Wa,Wo)}),Oi(2),_(Rd);var Rr=m(Rd,2);Ve(Rr,()=>i(yl),Wa=>{var Wo=uee(),ji=y(Wo,!0);_(Wo),we(()=>st(ji,i(yl))),Y(Wa,Wo)});var Ul=m(Rr,2);Ve(Ul,()=>i(Vc),Wa=>{var Wo=dee(),ji=y(Wo);_(Wo),we(()=>Dt(ji,"style",`width:${i(Td)}%`)),Y(Wa,Wo)}),we(()=>{dr!==(dr=i(zi))&&(So.value=(So.__value=i(zi))==null?"":i(zi),$g(So,i(zi))),qf(Za,i(mu)),qf(da,i(Gc)),qf(N,i(du)),q!==(q=i(Nl))&&(z.value=(z.__value=i(Nl))==null?"":i(Nl),$g(z,i(Nl))),xs!==(xs=i(sa))&&(Zs.value=(Zs.__value=i(sa))==null?"":i(sa),$g(Zs,i(sa))),qm(Hd,i(Dc)),Ou.disabled=i(Vc)}),Y(zn,qn)},zn=>{var qn=pee();Y(zn,qn)}),_(up);var Nr=m(up,2),Kc=m(y(Nr),2);Ve(Kc,()=>i(ki).length,zn=>{var qn=vee(),ua=_s(qn),oa=y(ua);_(ua);var So=m(ua,2),dr=m(y(So),2);qo(dr,19,()=>i(ki),(Aa,Za)=>Uu(Aa.params)+Za,(Aa,Za,Va)=>{var da=hee(),k=y(da),N=y(k,!0);we(()=>st(N,Uu(i(Za).params))),_(k);var R=m(k,2),F=y(R,!0);we(()=>st(F,Qi(i(Za).summary))),_(R);var z=m(R,2),q=y(z);we(()=>st(q,`${(i(Za).summary.netPnl>=0?"+":"")??""}${io(i(Za).summary.netPnl,2)??""}`)),_(z);var he=m(z,2),Ee=y(he,!0);we(()=>st(Ee,tu(i(Za).summary.netPnlPct??0))),_(he);var lt=m(he,2),Qt=y(lt,!0);we(()=>st(Qt,tu(i(Za).summary.maxDrawdownPct??0))),_(lt);var en=m(lt,2),Zs=y(en,!0);we(()=>st(Zs,tu(i(Za).summary.winRate??0))),_(en);var xs=m(en,2),Un=y(xs,!0);_(xs),_(da),we(()=>{$i(da,`${`opt-results-row ${i(Va)===0?"best":""}`??""} svelte-1ehcy4i`),$i(z,`${`right mono ${i(Za).summary.netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),st(Un,i(Za).summary.trades??0)}),Y(Aa,da)}),_(So);var Zl=m(So,2);Ve(Zl,()=>i(Dc)&&i(la),Aa=>{var Za=mee();const Va=Lt(()=>Uu(i(la).params)??""),da=Lt(()=>(i(la).summary.netPnl>=0?"+":"")??""),k=Lt(()=>io(i(la).summary.netPnl,2)??""),N=Lt(()=>tu(i(la).summary.maxDrawdownPct??0)??""),R=Lt(()=>tu(i(la).summary.winRate??0)??"");var F=y(Za);we(()=>st(F,`Test run: ${i(Va)} • Net ${i(da)}${i(k)} • DD ${i(N)} • Win ${i(R)}`)),_(Za),Y(Aa,Za)}),we(()=>st(oa,`Showing ${i(ki).length??""} runs`)),Y(zn,qn)},zn=>{var qn=gee();Y(zn,qn)}),_(Nr),_(Xm),_(xm);var Yu=m(xm,2),Vd=y(Yu),Yi=y(Vd),$t=y(Yi),En=m(y($t),2);En.__click=[_ee,Mn],_($t),Oi(2),_(Yi);var Mo=m(Yi,2),No=y(Mo),ka=y(No);ka.__click=[yee,Ga];var Xc=m(ka,2);Xc.__click=[bee,Ga];var eo=m(Xc,2);eo.__click=[xee,Ga];var Ra=m(eo,2);Ra.__click=[wee,Ga];var Xa=m(Ra,2);Xa.__click=[kee,Ga];var Vl=m(Xa,2);Vl.__click=[See,Ga];var Qf=m(Vl,2);Qf.__click=[Cee,Ga],_(No),_(Mo),_(Vd);var Bp=m(Vd,2),Gp=y(Bp),ao=y(Gp),Ri=m(y(ao),2),bc=y(Ri);Ve(bc,()=>i(ac).length,zn=>{var qn=I0();const ua=Lt(()=>io(i(ac)[0].equity,2)??""),oa=Lt(()=>io(i(ac)[i(ac).length-1].equity,2)??"");we(()=>st(qn,`${i(ua)} → ${i(oa)}`)),Y(zn,qn)}),_(Ri),_(ao);var Mu=m(ao,2);Ve(Mu,()=>i(Ie),zn=>{var qn=Iee(),ua=y(qn),oa=m(y(ua),2),So=y(oa,!0);we(()=>st(So,io(i(Ie).first,2))),_(oa),_(ua);var dr=m(ua,2),Zl=m(y(dr),2),Aa=y(Zl,!0);we(()=>st(Aa,io(i(Ie).last,2))),_(Zl),_(dr);var Za=m(dr,2),Va=m(y(Za),2),da=y(Va);we(()=>st(da,`${(i(Ie).net>=0?"+":"")??""}${io(i(Ie).net,2)??""}`)),_(Va),_(Za);var k=m(Za,2),N=m(y(k),2),R=y(N);we(()=>st(R,`${(i(Ie).retPct>=0?"+":"")??""}${tu(i(Ie).retPct)??""}`)),_(N),_(k);var F=m(k,2),z=m(y(F),2);const q=Lt(()=>io(i(Ie).min,2)??""),he=Lt(()=>io(i(Ie).max,2)??"");var Ee=y(z);we(()=>st(Ee,`${i(q)}–${i(he)}`)),_(z),_(F),_(qn),we(()=>{$i(Va,`${`mono ${i(Ie).net>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),$i(N,`${`mono ${i(Ie).retPct>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),Y(zn,qn)});var Sf=m(Mu,2);Sf.__pointermove=Mt;var dp=y(Sf);Ve(dp,()=>i(Q),zn=>{var qn=Nee(),ua=_s(qn),oa=y(ua),So=m(oa),dr=m(So);Ve(dr,()=>i(O),k=>{var N=Pee();we(()=>Dt(N,"d",i(O).line)),Y(k,N)});var Zl=m(dr,4);Ve(Zl,()=>i(Re),k=>{var N=Mee();we(()=>{Dt(N,"cx",i(Re).x),Dt(N,"cy",i(Re).y)}),Y(k,N)}),_(ua);var Aa=m(ua,2),Za=y(Aa,!0);we(()=>st(Za,io(i(Q).maxY,2))),_(Aa);var Va=m(Aa,2),da=y(Va,!0);we(()=>st(da,io(i(Q).minY,2))),_(Va),we(()=>{Dt(oa,"d",i(Q).area),Dt(So,"d",i(Q).line)}),Y(zn,qn)},zn=>{var qn=Aee();Y(zn,qn)});var Op=m(dp,2);Ve(Op,()=>i(St),zn=>{var qn=Tee(),ua=_s(qn),oa=m(ua,2),So=m(oa,2),dr=y(So),Zl=y(dr,!0);we(()=>st(Zl,new Date(i(St).ts).toISOString().slice(0,10))),_(dr);var Aa=m(dr,2),Za=m(y(Aa)),Va=y(Za,!0);we(()=>st(Va,io(i(St).equity,2))),_(Za),_(Aa);var da=m(Aa,2),k=m(y(da)),N=y(k);we(()=>st(N,`${(i(St).net>=0?"+":"")??""}${Yc(i(St).net)??""}`)),_(k),_(da);var R=m(da,2),F=m(y(R)),z=y(F);we(()=>st(z,`${(i(St).retPct>=0?"+":"")??""}${Ir(i(St).retPct)??""}`)),_(F),_(R),_(So),we(()=>{Dt(ua,"style",`left:${i(St).x}px;`),Dt(oa,"style",`top:${i(St).y}px;`),Dt(So,"style",`left:${i(St).left}px; top:${i(St).top}px;`)}),Y(zn,qn)}),_(Sf);var gd=m(Sf,2);Ve(gd,()=>i(O),zn=>{var qn=Fee();Y(zn,qn)}),_(Gp);var Zc=m(Gp,2),Cf=y(Zc),ep=m(y(Cf),2),zp=y(ep);we(()=>st(zp,`Max ${tu(i(er).maxDrawdownPct)??""}`)),_(ep),_(Cf);var Np=m(Cf,2);Ve(Np,()=>i(ge),zn=>{var qn=Lee(),ua=y(qn),oa=m(y(ua),2),So=y(oa,!0);we(()=>st(So,tu(i(ge).worstAbs))),_(oa),_(ua);var dr=m(ua,2),Zl=m(y(dr),2),Aa=y(Zl,!0);we(()=>st(Aa,tu(i(ge).avgAbs))),_(Zl),_(dr);var Za=m(dr,2),Va=m(y(Za),2),da=y(Va,!0);we(()=>st(da,tu(i(ge).lastAbs))),_(Va),_(Za),_(qn),Y(zn,qn)});var np=m(Np,2);np.__pointermove=Ze;var $h=y(np);Ve($h,()=>i(U),zn=>{var qn=$ee(),ua=_s(qn),oa=y(ua),So=m(oa),dr=m(So,4);Ve(dr,()=>i(vt),da=>{var k=Eee();we(()=>{Dt(k,"cx",i(vt).x),Dt(k,"cy",i(vt).y)}),Y(da,k)}),_(ua);var Zl=m(ua,2),Aa=y(Zl);we(()=>st(Aa,`${io(i(U).maxY,2)??""}%`)),_(Zl);var Za=m(Zl,2),Va=y(Za);we(()=>st(Va,`${io(i(U).minY,2)??""}%`)),_(Za),we(()=>{Dt(oa,"d",i(U).area),Dt(So,"d",i(U).line)}),Y(zn,qn)},zn=>{var qn=Dee();Y(zn,qn)});var Ef=m($h,2);Ve(Ef,()=>i(Be),zn=>{var qn=jee(),ua=_s(qn),oa=m(ua,2),So=m(oa,2),dr=y(So),Zl=y(dr,!0);we(()=>st(Zl,new Date(i(Be).ts).toISOString().slice(0,10))),_(dr);var Aa=m(dr,2),Za=m(y(Aa)),Va=y(Za,!0);we(()=>st(Va,tu(Math.abs(i(Be).ddPct)))),_(Za),_(Aa);var da=m(Aa,2);Ve(da,()=>i(Be).equity!=null,k=>{var N=Ree(),R=m(y(N)),F=y(R,!0);we(()=>st(F,io(i(Be).equity,2))),_(R),_(N),Y(k,N)}),_(So),we(()=>{Dt(ua,"style",`left:${i(Be).x}px;`),Dt(oa,"style",`top:${i(Be).y}px;`),Dt(So,"style",`left:${i(Be).left}px; top:${i(Be).top}px;`)}),Y(zn,qn)}),_(np),_(Zc),_(Bp),_(Yu);var Cd=m(Yu,2),$f=y(Cd),uh=y($f),wm=y(uh),Nv=m(y(wm),2);Nv.__click=[Bee,Mn],_(wm),Oi(2),_(uh),_($f);var Zm=m($f,2),Av=y(Zm),hg=m(y(Av),4);Ve(hg,()=>i(Qe).length,zn=>{var qn=Wee(),ua=m(y(qn),2);qo(ua,17,()=>i(Qe),yi,(oa,So)=>{var dr=Vee();we(()=>Dt(dr,"title",(()=>{const da=i(dt).get(i(So).key)||null;if(!da)return"Click to filter trades by this month";const k=da.trades?da.wins/da.trades*100:0,N=da.net>=0?`+${io(da.net,2)}`:`${io(da.net,2)}`;return`Trades ${da.trades} • Win ${tu(k)} • Net ${N} • Fees ${io(da.fees,2)} • Click to filter`})())),dr.__click=[Oee,Af,So,p,fu],dr.__keydown=[zee,Af,So,p,fu];var Zl=y(dr),Aa=y(Zl,!0);_(Zl);var Za=m(Zl,2),Va=y(Za);we(()=>st(Va,`${(i(So).retPct>=0?"+":"")??""}${tu(i(So).retPct)??""}`)),_(Za),_(dr),we(()=>{$i(dr,`${`rt-row ${i(So).retPct>=0?"pos":"neg"} ${i(zl).type==="month"&&i(zl).key===i(So).key?"active":""}`??""} svelte-1ehcy4i`),st(Aa,i(So).key)}),Y(oa,dr)}),_(qn),Y(zn,qn)},zn=>{var qn=Hee();Y(zn,qn)}),_(Av);var mg=m(Av,2),jm=m(y(mg),4);Ve(jm,()=>i(Ue).length,zn=>{var qn=Yee(),ua=m(y(qn),2);qo(ua,17,()=>i(Ue),yi,(oa,So)=>{var dr=Gee();we(()=>Dt(dr,"title",(()=>{const da=i(et).get(i(So).key)||null;if(!da)return"Click to filter trades by this week";const k=da.trades?da.wins/da.trades*100:0,N=da.net>=0?`+${io(da.net,2)}`:`${io(da.net,2)}`;return`Trades ${da.trades} • Win ${tu(k)} • Net ${N} • Fees ${io(da.fees,2)} • Click to filter`})())),dr.__click=[qee,Af,So,p,fu],dr.__keydown=[Uee,Af,So,p,fu];var Zl=y(dr),Aa=y(Zl,!0);_(Zl);var Za=m(Zl,2),Va=y(Za);we(()=>st(Va,`${(i(So).retPct>=0?"+":"")??""}${tu(i(So).retPct)??""}`)),_(Za),_(dr),we(()=>{$i(dr,`${`rt-row ${i(So).retPct>=0?"pos":"neg"} ${i(zl).type==="week"&&i(zl).key===i(So).key?"active":""}`??""} svelte-1ehcy4i`),st(Aa,i(So).key)}),Y(oa,dr)}),_(qn),Y(zn,qn)},zn=>{var qn=Kee();Y(zn,qn)}),_(mg),_(Zm),_(Cd);var Yv=m(Cd,2),Ch=y(Yv),Jm=y(Ch),Vg=y(Jm),Wg=m(y(Vg),2);Wg.__click=[Xee,Mn],_(Vg),Oi(2),_(Jm),_(Ch);var vg=m(Ch,2),Tv=y(vg),f0=m(y(Tv),2);Ve(f0,()=>i(Gf).length,zn=>{var qn=Jee();qo(qn,21,()=>i(Gf),yi,(ua,oa)=>{var So=Zee(),dr=y(So),Zl=y(dr,!0);_(dr);var Aa=m(dr,2),Za=y(Aa);const Va=Lt(()=>`width:${i(oa).count/W(i(Gf))*100}%`);_(Aa);var da=m(Aa,2),k=y(da,!0);_(da),_(So),we(()=>{st(Zl,i(oa).label),Dt(Za,"style",i(Va)),st(k,i(oa).count)}),Y(ua,So)}),_(qn),Y(zn,qn)},zn=>{var qn=Qee();Y(zn,qn)}),_(Tv);var Hg=m(Tv,2),qg=m(y(Hg),2);Ve(qg,()=>i(kd).length,zn=>{var qn=tte();qo(qn,21,()=>i(kd),yi,(ua,oa)=>{var So=ete(),dr=y(So),Zl=y(dr,!0);_(dr);var Aa=m(dr,2),Za=y(Aa);const Va=Lt(()=>`width:${i(oa).count/W(i(kd))*100}%`);_(Aa);var da=m(Aa,2),k=y(da,!0);_(da),_(So),we(()=>{st(Zl,i(oa).label),Dt(Za,"style",i(Va)),st(k,i(oa).count)}),Y(ua,So)}),_(qn),Y(zn,qn)},zn=>{var qn=ste();Y(zn,qn)}),_(Hg);var Ap=m(Hg,2),p0=m(y(Ap),2);Ve(p0,()=>i(Zd).length,zn=>{var qn=ote();qo(qn,21,()=>i(Zd),yi,(ua,oa)=>{var So=nte(),dr=y(So),Zl=y(dr,!0);_(dr);var Aa=m(dr,2),Za=y(Aa);const Va=Lt(()=>`width:${i(oa).count/W(i(Zd))*100}%`);_(Aa);var da=m(Aa,2),k=y(da,!0);_(da),_(So),we(()=>{st(Zl,i(oa).label),Dt(Za,"style",i(Va)),st(k,i(oa).count)}),Y(ua,So)}),_(qn),Y(zn,qn)},zn=>{var qn=ite();Y(zn,qn)}),_(Ap);var h0=m(Ap,2),m0=m(y(h0),2);Ve(m0,()=>i(gc).length,zn=>{var qn=ate();qo(qn,21,()=>i(gc),yi,(ua,oa)=>{var So=rte(),dr=y(So),Zl=y(dr,!0);_(dr);var Aa=m(dr,2),Za=y(Aa);const Va=Lt(()=>`width:${i(oa).count/W(i(gc))*100}%`);_(Aa);var da=m(Aa,2),k=y(da,!0);_(da),_(So),we(()=>{st(Zl,i(oa).label),Dt(Za,"style",i(Va)),st(k,i(oa).count)}),Y(ua,So)}),_(qn),Y(zn,qn)},zn=>{var qn=lte();Y(zn,qn)}),_(h0),_(vg),_(Yv);var Ug=m(Yv,2),Kv=y(Ug),gg=y(Kv),Xv=y(gg),_g=m(y(Xv),2);_g.__click=[cte,Mn],_(Xv),Oi(2),_(gg),_(Kv);var Zv=m(Kv,2),yg=y(Zv);yg.__click=[ute,fu];var bg=m(yg,2);bg.__click=[dte,fu];var J=m(bg,2);J.__click=[b6,B,vc,su,Na,Rc,za,Yc,Ir,ve];var ms=m(J,2);Ve(ms,()=>i(zl).type!=="all",zn=>{var qn=fte();qn.__click=[PZ,B,Qu,su,Na,Rc,za,Yc,Ir,zl,ve],Y(zn,qn)});var Ci=m(ms,2);Ci.__click=[x6,B,rc,za,Rc,Yc,Na,ve];var xi=m(Ci,2);xi.__click=[MZ,B,yu,ve],_(Zv);var ko=m(Zv,2),cf=y(ko),Ac=y(cf);we(()=>st(Ac,`Gross Profit: +${io(i(er).grossProfit,2)??""}`)),_(cf);var Bu=m(cf,2),dh=y(Bu);we(()=>st(dh,`Gross Loss: -${io(i(er).grossLoss,2)??""}`)),_(Bu);var Vp=m(Bu,2),mv=y(Vp);we(()=>st(mv,`Total: ${(i(er).netPnl>=0?"+":"")??""}${io(i(er).netPnl,2)??""}`)),_(Vp),_(ko);var Qm=m(ko,2),km=y(Qm),Yp=y(km);we(()=>st(Yp,`Net (from trades): ${(i(Nf)>=0?"+":"")??""}${na(i(Nf))??""}`)),_(km);var rh=m(km,2),ui=y(rh);we(()=>st(ui,`Initial: ${io(i(er).initialCapital,2)??""}`)),_(rh);var _d=m(rh,2),ql=y(_d);we(()=>st(ql,`Final: ${io(i(er).finalEquity,2)??""}`)),_(_d),_(Qm),_(Ug),_(Xs),we(()=>{$i(kl,`${`kpi-value mono ${i(er).netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`),st(af,i(ba).total),st(lf,`L ${i(ba).entryLong??""}/${i(ba).exitLong??""} • S ${i(ba).entryShort??""}/${i(ba).exitShort??""}`),qf(Jf,i(go)),qf(sh,i(no)),qf(_m,i(Bo)),Uh.disabled=f(),qf(Am,i(Tn)),im.disabled=!i(er),st(me,i(er).trades),st(We,`Wins ${i(er).wins??""} • Loss ${i(er).losses??""} `),st(Gu,`Trades ${i(td).long.trades??""}`),st(Pv,`Trades ${i(td).short.trades??""}`),st(Km,i(sl)),yr(ka,"active",i(Ga)==="1w"),yr(Xc,"active",i(Ga)==="1m"),yr(eo,"active",i(Ga)==="3m"),yr(Ra,"active",i(Ga)==="6m"),yr(Xa,"active",i(Ga)==="1y"),yr(Vl,"active",i(Ga)==="5y"),yr(Qf,"active",i(Ga)==="all"),$i(Vp,`${`pnl-item ${i(er).netPnl>=0?"pos":"neg"}`??""} svelte-1ehcy4i`)}),pd("pointerleave",Sf,()=>{b(St,null)}),pd("pointerleave",np,()=>{b(Be,null)}),Y(nn,Xs)}),_(Gt),Y(at,Gt)},null,!0),Y(ee,oe)});var Rm=m(Gm,2);Ve(Rm,()=>i(Hs),ee=>{var oe=xte();oe.__click=[y6,Hs];var $e=y(oe);$e.__click=[mte];var at=y($e),Gt=y(at),Nt=y(Gt,!0);_(Gt);var Cs=m(Gt,2),nn=y(Cs),Xs=y(nn);Xs.__click=[vte,fs];var Xn=m(Xs,2);Xn.__click=[gte,fs],_(nn);var ho=m(nn,2);ho.__click=[y6,Hs],_(Cs),_(at);var Zn=m(at,2),Go=y(Zn);Ve(Go,()=>Ns[i(ns)],mi=>{var $o=bte(),kl=_s($o);qo(kl,21,()=>Ns[i(ns)][i(fs)].desc,yi,(Ya,Kl)=>{var ru=_te(),vd=y(ru,!0);_(ru),we(()=>st(vd,i(Kl))),Y(Ya,ru)}),_(kl);var Fl=m(kl,2),il=m(y(Fl),2);qo(il,21,()=>Ns[i(ns)][i(fs)].examples,yi,(Ya,Kl)=>{var ru=yte(),vd=y(ru,!0);_(ru),we(()=>st(vd,i(Kl))),Y(Ya,ru)}),_(il),_(Fl),Y(mi,$o)}),_(Zn),_($e),_(oe),we(()=>{var mi,$o;st(Nt,($o=(mi=Ns[i(ns)])==null?void 0:mi[i(fs)])==null?void 0:$o.title),yr(Xs,"active",i(fs)==="en"),yr(Xn,"active",i(fs)==="bn")}),Y(ee,oe)});var Hh=m(Rm,2);Ve(Hh,()=>i(ne),ee=>{var oe=Ate();oe.__click=[_6,ne];var $e=y(oe);$e.__click=[wte];var at=y($e),Gt=m(y(at),2),Nt=y(Gt);Nt.__click=[_6,ne],_(Gt),_(at);var Cs=m(at,2),nn=y(Cs),Xs=y(nn),Xn=m(y(Xs),2);Ts(Xn),Xn.__keydown=[kte,De];var ho=m(Xn,2),Zn=y(ho);Zn.__click=De,Oi(2),_(ho),_(Xs),_(nn);var Go=m(nn,2),mi=y(Go),$o=m(y(mi),2),kl=y($o);Ve(kl,()=>i(j),Kl=>{var ru=Ste();Y(Kl,ru)},Kl=>{var ru=Qs(),vd=_s(ru);Ve(vd,()=>i(X).length===0,nc=>{var af=Cte();Y(nc,af)},nc=>{var af=Qs(),zd=_s(af);qo(zd,17,()=>i(X),yi,(lf,ef)=>{var Hn=Pte();Hn.__click=[Ite,le,ef];var Oo=y(Hn),pi=y(Oo,!0);_(Oo);var ur=m(Oo,2),Mc=y(ur,!0);we(()=>st(Mc,nt(i(ef).updatedAt))),_(ur),_(Hn),we(()=>{$i(Hn,`save-row ${(i(le)===i(ef).id?"selected":"")??""} svelte-1ehcy4i`),st(pi,i(ef).name)}),Y(lf,Hn)}),Y(nc,af)},!0),Y(Kl,ru)}),_($o);var Fl=m($o,2),il=y(Fl);il.__click=[Mte,le,Oe],Oi(2),_(Fl),_(mi),_(Go);var Ya=m(Go,2);Ve(Ya,()=>i(ie),Kl=>{var ru=Nte(),vd=y(ru,!0);_(ru),we(()=>st(vd,i(ie))),Y(Kl,ru)}),_(Cs),_($e),_(oe),we(()=>{Zn.disabled=i(te),il.disabled=!i(le)||i(te)}),Fn(Xn,()=>i(de),Kl=>b(de,Kl)),Y(ee,oe)});var fg=m(Hh,2);Ve(fg,()=>i(T),ee=>{var oe=Vte();oe.__click=[g6,T];var $e=y(oe);$e.__click=[Tte];var at=y($e),Gt=m(y(at),2),Nt=y(Gt);Nt.__click=[_Z,Ne];var Cs=m(Nt,2);Cs.__click=[g6,T],_(Gt),_(at);var nn=m(at,2),Xs=y(nn);Ts(Xs);var Xn=m(Xs,2),ho=y(Xn);we(()=>st(ho,`${ut().length??""} scripts`)),_(Xn),_(nn);var Zn=m(nn,2);Ve(Zn,()=>i(L),$o=>{var kl=Fte(),Fl=y(kl,!0);_(kl),we(()=>st(Fl,i(L))),Y($o,kl)});var Go=m(Zn,2),mi=y(Go);Ve(mi,()=>i(j),$o=>{var kl=Lte();Y($o,kl)},$o=>{var kl=Qs(),Fl=_s(kl);Ve(Fl,()=>ut().length===0,il=>{var Ya=Ete();Y(il,Ya)},il=>{var Ya=zte();qo(Ya,21,ut,yi,(Kl,ru)=>{var vd=Ote(),nc=y(vd),af=y(nc),zd=y(af,!0);_(af);var lf=m(af,2),ef=y(lf);we(()=>st(ef,`Updated ${nt(i(ru).updatedAt)??""}`)),_(lf),_(nc);var Hn=m(nc,2),Oo=y(Hn);Oo.__click=[$te,Ht,ru];var pi=m(Oo,2);pi.__click=[Dte,Ft,ru];var ur=m(pi,2);ur.__click=[Rte,zt,ru];var Mc=m(ur,2);Mc.__click=[jte,kt,ru];var Nc=m(Mc,2);Nc.__click=[Bte,Ke,ru],_(Hn),_(vd),we(()=>st(zd,i(ru).name)),Y(Kl,vd)}),_(Ya),Y(il,Ya)},!0),Y($o,kl)}),_(Go),_($e),_(oe),we(()=>Nt.disabled=i(j)),Fn(Xs,()=>i(D),$o=>b(D,$o)),Y(ee,oe)});var qh=m(fg,2),Uv=y(qh),Zf=y(Uv),vm=m(Zf,2),pg=y(vm,!0);_(vm);var d0=m(vm,2);return Ve(d0,()=>typeof i(to)=="function"?i(to)():i(to),ee=>{var oe=Hte();const $e=Lt(()=>typeof i(to)=="function"?i(to)():i(to));we(()=>Dt(oe,"title",typeof i(cr)=="function"?i(cr)():i(cr)));var at=m(y(oe),2),Gt=y(at,!0);_(at);var Nt=m(at,2),Cs=y(Nt),nn=y(Cs,!0);_(Cs);var Xs=m(Cs,2);qo(Xs,17,()=>i($e).lines,yi,(Xn,ho)=>{var Zn=Wte(),Go=y(Zn,!0);_(Zn),we(()=>st(Go,i(ho))),Y(Xn,Zn)}),_(Nt),_(oe),we(()=>{$i(oe,`${`footer-alert ${i($e).kind}`??""} svelte-1ehcy4i`),st(Gt,i($e).label),st(nn,i($e).title)}),Y(ee,oe)}),_(Uv),Oi(2),_(qh),_(uo),we(()=>{Dt(uo,"aria-hidden",!u()),yr(uo,"fullpage",i(Es)),yr(Or,"selected",i(Se)==="editor"),yr(ou,"selected",i(Se)==="errors"),yr(ou,"has-errors",i(Cr)>0),yr(ou,"has-warnings",i(Cr)===0&&i(hl)>0),st(Kf,i(ws)),yr(ld,"selected",i(Se)==="results"),Dt(Xe,"aria-pressed",i(wt)),st(nm,`Labels ${(i(wt)?"On":"Off")??""}`),Lh.disabled=f(),st(cd,f()?"Running...":"Run"),yr(Dm,"hidden",i(Se)!=="editor"),st(Wh,`inline-script.${i(Ti)??""}`),st(Og,`Lines: ${i(rs)??""}`),yr(hm,"monaco-mode",i(Ct)!=="failed"),$i(Zf,`footer-dot ${(r()?"error":f()?"running":"ok")??""} svelte-1ehcy4i`),st(pg,i(Fs))}),co(Ed,()=>i(Et),ee=>b(Et,ee)),Y(s,uo),Kd({setEditorCode:Rt})}$p(["pointerdown","click","input","change","keydown","pointermove"]);const Gte=[{id:"js-basic-plot",title:"JS basic plot",format:"js",description:"Plot close as a line (JS mode).",code:`// @lang js
export function onBar(ctx) {
  plot(ctx.close, { color: "#22c55e", title: "Close" });
}`},{id:"js-draw-demo",title:"JS draw tools demo",format:"js",description:"Labels, lines, boxes, and a table updated each bar (draw ops are capped).",code:`// @lang js
let statsTable;

export function onInit(ctx) {
  statsTable = table.new("top_right", 2, 2, {
    bgcolor: "rgba(15, 23, 42, 0.85)",
    text_color: "#e2e8f0",
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  plot(ctx.close, { color: "#38bdf8", title: "Close", pane: "main" });

  const every = i % 20 === 0;
  plotshape(every, { style: "cross", location: "abovebar", color: "#f97316" });

  if (every) {
    label.new(ctx.bar_index, ctx.high, "Pulse", {
      style: "label",
      color: "#0f172a",
      textcolor: "#f8fafc",
      avoidOverlap: true,
    });
    line.new(i - 1, ctx.low, i + 1, ctx.high, {
      color: "#22c55e",
      width: 1,
    });
    box.new(i - 2, ctx.high, i + 2, ctx.low, {
      border_color: "#f59e0b",
      bgcolor: "rgba(245, 158, 11, 0.15)",
    });
  }

  if (statsTable) {
    table.cell(statsTable, 0, 0, "Bar");
    table.cell(statsTable, 1, 0, String(i));
  }
}`},{id:"js-heatmap-raster",title:"JS heatmap raster",format:"js",description:"WebGL heatmap raster with bar_index + price anchors.",code:`// @lang js
let hm;

export function onInit(ctx) {
  hm = heatmap.new({
    id: "vol_heat",
    pane: "sub",
    xloc: "bar_index",
    opacity: 0.85,
    xBinPx: 6,
    yBinPx: 6,
    agg: "avg",
    blend: "screen",
    colormap: [
      { stop: 0, color: "#0f172a" },
      { stop: 0.4, color: "#1d4ed8" },
      { stop: 0.7, color: "#22c55e" },
      { stop: 1, color: "#f59e0b" },
    ],
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  if (i % 3 === 0) {
    const range = Number(ctx.high) - Number(ctx.low);
    heatmap.push(hm, i, Number(ctx.close), range);
  }
  plot(ta.ema(ctx.close, 20), { color: "#38bdf8", title: "EMA 20" });
}`},{id:"js-gradient-demo",title:"JS gradient demo",format:"js",description:"Area + callout + candle gradients in one script.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.ema(ctx.close, 20), {
    type: "area",
    gradient: { from: "rgba(96,165,250,0.35)", to: "rgba(34,197,94,0.12)", mode: "vertical" },
  });

  plotshape(Number(ctx.bar_index) % 25 === 5, {
    style: "callout",
    text: "BUY",
    location: "belowbar",
    bgGradient: { from: "#16a34a", to: "#22c55e", mode: "horizontal" },
  });

  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, {
    gradient: { from: "rgba(34,197,94,0.45)", to: "rgba(34,197,94,0.1)" },
    downGradient: { from: "rgba(239,68,68,0.45)", to: "rgba(239,68,68,0.1)" },
  });
}`},{id:"js-str-color-demo",title:"JS strings + color utils",format:"js",description:"str.format + str.upper + color.from_gradient + hsl.",code:`// @lang js
let badge;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;

  const price = str.tostring(ctx.close, "0.00");
  const tag = str.format("sig {0}", str.pad_left(ctx.bar_index, 4, "0"));
  const text = str.upper(str.format("{0} @ {1}", tag, price));

  const mix = color.from_gradient("#22c55e", "#ef4444", 0.25);
  const bg = color.set_alpha(mix, 0.18);
  const fg = color.hsl(210, 80, 60);

  badge = label.new(ctx.bar_index, ctx.high, text, {
    style: "label",
    color: bg,
    textcolor: fg,
    size: "small",
  });
}`},{id:"js-polygon-demo",title:"JS polygon overlay",format:"js",description:"Polygon overlay (GPU accelerated when WebGL is enabled).",code:`// @lang js
let poly;

export function onBar(ctx) {
  const x0 = ctx.bar_index - 2;
  const x1 = ctx.bar_index - 1;
  const x2 = ctx.bar_index;
  const y0 = ctx.low;
  const y1 = ctx.high;
  const y2 = ctx.low;

  if (!poly) {
    poly = polygon.new(
      x0, y0,
      x1, y1,
      x2, y2,
      {
        fillColor: "rgba(56, 189, 248, 0.25)",
        strokeColor: "#38bdf8",
        strokeWidth: 2,
        strokeStyle: "dashed",
        includeInAutoscale: false,
      }
    );
  }

  polygon.set_points(poly, x0, y0, x1, y1, x2, y2);
}`},{id:"js-overlay-basic",title:"JS overlay templates",format:"js",description:"Template-based overlay (rect) created via overlay.new.",code:`// @lang js
let rect;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  const i = Number(ctx.bar_index);
  if (i !== last) return;
  const low = Number(ctx.low);
  const high = Number(ctx.high);
  if (!Number.isFinite(low) || !Number.isFinite(high)) return;

  rect = overlay.new(
    "rect",
    [
      { index: last - 20, value: low },
      { index: last, value: high },
    ],
    { styles: { polygon: { color: "rgba(14, 165, 233, 0.18)" } } }
  );
}`},{id:"js-overlay-fib-labels",title:"JS overlay fib labels (left)",format:"js",description:"Fibonacci overlay with labels placed on the left side of the levels.",code:`// @lang js
let fib;

export function onBar(ctx) {
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;

  fib = overlay.new(
    "fibonacciSegment",
    [
      { extreme: "low", lookback: 300 },
      { extreme: "high", lookback: 300 },
    ],
    {
      extendData: {
        labelSide: "left",
        labelOffset: 16,
        labelAlign: "right",
        fibonacciLevels: [
          { value: 0, color: "#64748b", label: "0", visible: true },
          { value: 0.382, color: "#60a5fa", label: "0.382", visible: true },
          { value: 0.5, color: "#22c55e", label: "0.5", visible: true },
          { value: 0.618, color: "#f59e0b", label: "0.618", visible: true },
          { value: 1, color: "#64748b", label: "1", visible: true },
        ],
      },
    }
  );
}`},{id:"js-primitives-advanced",title:"JS primitives (glow + gradient)",format:"js",description:"Polyline glow + polygon gradient fill (WebGL or Canvas fallback).",code:`// @lang js
let poly;
let pl;

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  const lowRaw = Number(ctx.low);
  const highRaw = Number(ctx.high);
  const low = Number.isFinite(lowRaw) ? lowRaw : Number(ctx.hist(ctx.low, 1));
  const high = Number.isFinite(highRaw) ? highRaw : Number(ctx.hist(ctx.high, 1));
  const mid = (low + high) / 2;

  if (!poly) {
    poly = polygon.new(
      i - 6, low,
      i - 3, high,
      i, low,
      {
        fillGradient: { from: "rgba(59, 130, 246, 0.35)", to: "rgba(34, 197, 94, 0.12)", mode: "vertical" },
        strokeColor: "#38bdf8",
        strokeWidth: 2,
        glow: 6,
        glowColor: "rgba(56, 189, 248, 0.7)",
        glowOpacity: 0.35,
        includeInAutoscale: false,
      }
    );
  }

  if (!pl) {
    pl = polyline.new(
      i - 4, mid,
      i - 2, high,
      i, mid,
      {
        color: "#f59e0b",
        width: 2,
        glow: 5,
        glowColor: "rgba(245, 158, 11, 0.75)",
        glowOpacity: 0.35,
        includeInAutoscale: false,
      }
    );
  }

  polygon.set_points(poly, i - 6, low, i - 3, high, i, low);
  polyline.set_points(pl, i - 4, mid, i - 2, high, i, mid);

  plot(ta.ema(ctx.close, 20), { color: "#22c55e", title: "EMA 20" });
}`},{id:"js-ema-color-segments",title:"JS EMA color segments",format:"js",description:"Color-switching EMA using fixed polyline segments.",code:`// @lang js
const WINDOW = 140;
let emaHist = [];
let closeHist = [];
let handles = [];

function initHandles() {
  if (handles.length) return;
  for (let i = 0; i < WINDOW; i++) {
    handles.push(
      polyline.new(0, 0, 0, 0, {
        color: "#3b82f6",
        width: 2,
        when: 0,
        includeInAutoscale: false,
      })
    );
  }
}

export function onBar(ctx) {
  const ema = Number(ta.ema(ctx.close, 20));
  const close = Number(ctx.close);
  if (!Number.isFinite(ema) || !Number.isFinite(close)) return;

  emaHist.push(ema);
  closeHist.push(close);
  if (emaHist.length > WINDOW + 1) {
    emaHist.shift();
    closeHist.shift();
  }

  initHandles();
  const lastX = Number(ctx.bar_index);
  const len = emaHist.length;

  for (let s = 0; s < WINDOW; s++) {
    const i1 = len - WINDOW + s;
    const i0 = i1 - 1;
    const h = handles[s];
    if (i0 < 0 || i1 <= 0 || i1 >= len) {
      polyline.set_points(h, 0, 0, 0, 0, { when: 0 });
      continue;
    }

    const x0 = lastX - (len - 1 - i0);
    const x1 = lastX - (len - 1 - i1);
    const y0 = emaHist[i0];
    const y1 = emaHist[i1];
    const color = closeHist[i1] >= emaHist[i1] ? "#3b82f6" : "#ef4444";

    polyline.set_points(h, x0, y0, x1, y1, { color, width: 2, when: 1 });
  }
}
`},{id:"js-interaction-runtime",title:"JS interaction (drag shapes)",format:"js",description:"Drag the last-bar line/polyline/polygon to test snapping + hit-testing.",code:`// @lang js
export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  const lastIdx = ctx.bar_index.data.length - 1;
  const lowRaw = Number(ctx.low);
  const highRaw = Number(ctx.high);
  const low = Number.isFinite(lowRaw) ? lowRaw : Number(ctx.hist(ctx.low, 1));
  const high = Number.isFinite(highRaw) ? highRaw : Number(ctx.hist(ctx.high, 1));
  if (!Number.isFinite(low) || !Number.isFinite(high)) return;
  const mid = (low + high) / 2;
  const when = i === lastIdx;

  polyline.new(
    i - 6, mid,
    i - 3, high,
    i, mid,
    { color: "#22c55e", width: 2, includeInAutoscale: false, when }
  );

  polygon.new(
    i - 9, low,
    i - 4, high,
    i + 1, low,
    {
      fillColor: "rgba(56, 189, 248, 0.2)",
      strokeColor: "#38bdf8",
      strokeWidth: 2,
      when,
      includeInAutoscale: false,
    }
  );

  line.new(i - 12, low, i, high, {
    color: "#f59e0b",
    width: 1,
    when,
    includeInAutoscale: false,
  });
}`},{id:"js-loop-average",title:"JS loop average",format:"js",description:"Simple looped average using ctx.hist (offsets must be integer >= 0).",code:`// @lang js
export function onBar(ctx) {
  let sum = 0;
  for (let i = 0; i < 5; i++) {
    sum += ctx.hist(ctx.close, i);
  }
  const avg = sum / 5;
  plot(avg, { color: "#e879f9", title: "Avg(5)", pane: "sub" });
}`},{id:"js-ta-macd",title:"JS ta.macd",format:"js",description:"MACD with SMA/EMA overlays using ta.*.",code:`// @lang js
export function onBar(ctx) {
  const smaFast = ta.sma(ctx.close, 10);
  const emaSlow = ta.ema(ctx.close, 30);
  plot(smaFast, { color: "#60a5fa", title: "SMA 10" });
  plot(emaSlow, { color: "#f59e0b", title: "EMA 30" });

  const [macdLine, signalLine, hist] = ta.macd(ctx.close, 12, 26, 9);
  plot(macdLine, { color: "#22c55e", title: "MACD", pane: "sub" });
  plot(signalLine, { color: "#ef4444", title: "Signal", pane: "sub" });
  plot(hist, { color: "#94a3b8", title: "Hist", pane: "sub", type: "histogram" });
}`},{id:"js-ta-extended-mas",title:"JS ta extended MAs",format:"js",description:"DEMA/TEMA/HMA/KAMA/ALMA/T3/TRIMA/SWMA/EVWMA family.",code:`// @lang js
export function onBar(ctx) {
  const src = ctx.close;
  plot(ta.dema(src, 20), { title: "DEMA", color: "#ef4444", pane: "sub" });
  plot(ta.tema(src, 20), { title: "TEMA", color: "#f97316", pane: "sub" });
  plot(ta.hma(src, 20), { title: "HMA", color: "#eab308", pane: "sub" });
  plot(ta.kama(src, 10, 2, 30), { title: "KAMA", color: "#22c55e", pane: "sub" });
  plot(ta.alma(src, 20, 0.85, 6), { title: "ALMA", color: "#14b8a6", pane: "sub" });
  plot(ta.t3(src, 10, 0.7), { title: "T3", color: "#3b82f6", pane: "sub" });
  plot(ta.trima(src, 20), { title: "TRIMA", color: "#8b5cf6", pane: "sub" });
  plot(ta.swma(src, 20), { title: "SWMA", color: "#ec4899", pane: "sub" });
  plot(ta.evwma(src, ctx.volume, 20), { title: "EVWMA", color: "#0ea5e9", pane: "sub" });
}`},{id:"js-ta-extended-osc",title:"JS ta extended oscillators",format:"js",description:"CMO/TSI/StochRSI/PPO/TRIX/AO/ZScore/ATRP/NATR set.",code:`// @lang js
export function onBar(ctx) {
  const src = ctx.close;
  plot(ta.cmo(src, 14), { title: "CMO", color: "#ef4444", pane: "sub" });
  plot(ta.tsi(src, 25, 13), { title: "TSI", color: "#f97316", pane: "sub" });
  plot(ta.stochrsi(src, 14, 3, 3), { title: "StochRSI", color: "#eab308", pane: "sub" });
  plot(ta.ppo(src, 12, 26), { title: "PPO", color: "#22c55e", pane: "sub" });
  plot(ta.trix(src, 9), { title: "TRIX", color: "#0ea5e9", pane: "sub" });
  plot(ta.ao(), { title: "AO", color: "#8b5cf6", pane: "sub" });
  plot(ta.zscore(src, 20), { title: "ZScore", color: "#14b8a6", pane: "sub" });
  plot(ta.atrp(14), { title: "ATRP", color: "#94a3b8", pane: "sub" });
  plot(ta.natr(14), { title: "NATR", color: "#64748b", pane: "sub" });
}`},{id:"js-ta-extended-volume",title:"JS ta extended volume",format:"js",description:"AD + CMF volume indicators.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.ad(), { title: "AD", color: "#8b5cf6", pane: "sub" });
  plot(ta.cmf(20), { title: "CMF", color: "#22c55e", pane: "sub" });
}`},{id:"js-ta-uo-cog-bbw",title:"JS ta UO/COG/BBW",format:"js",description:"Ultimate oscillator, center of gravity, and band width.",code:`// @lang js
export function onBar(ctx) {
  plot(ta.uo(7, 14, 28), { title: "UO", color: "#22c55e", pane: "sub" });
  plot(ta.cog(ctx.close, 10), { title: "COG", color: "#3b82f6", pane: "sub" });
  plot(ta.bbw(ctx.close, 20, 2), { title: "BBW", color: "#ef4444", pane: "sub" });
}`},{id:"js-ta-pivot-tr",title:"JS ta pivots + TR",format:"js",description:"Pivot highs/lows, pivot points, and true range.",code:`// @lang js
export function onBar(ctx) {
  const left = 3;
  const right = 3;
  const ph = ta.pivothigh(ctx.high, left, right);
  const pl = ta.pivotlow(ctx.low, left, right);

  plot(ph, { title: "Pivot High", color: "#f97316", offset: -right });
  plot(pl, { title: "Pivot Low", color: "#22c55e", offset: -right });

  const piv = ta.pivot_points(20, "classic");
  plot(piv.pp, { title: "PP", color: "#38bdf8" });
  plot(piv.r1, { title: "R1", color: "#ef4444" });
  plot(piv.s1, { title: "S1", color: "#22c55e" });

  plot(ta.tr(), { title: "TR", color: "#94a3b8", pane: "sub" });
}`},{id:"js-mtf-htf-ema",title:"JS MTF (HTF EMA)",format:"js",description:"Higher-timeframe close + EMA using request.security.",code:`// @lang js
const htfCloseExpr = (s) => s.close;
const htfEmaExpr = (s, env) => env.ta.ema(s.close, 20);

export function onBar(ctx) {
  const htfClose = request.security("240", htfCloseExpr);
  const htfEma = request.security("240", htfEmaExpr);
  plot(htfClose, { color: "#38bdf8", title: "HTF Close" });
  plot(htfEma, { color: "#f59e0b", title: "HTF EMA 20" });
}`},{id:"js-mtf-lower-tf",title:"JS MTF (LTF Close)",format:"js",description:"Lower-timeframe close using request.security_lower_tf.",code:`// @lang js
const ltfCloseExpr = (s) => s.close;

export function onBar(ctx) {
  const ltfClose = request.security_lower_tf("5", ltfCloseExpr);
  plot(ltfClose, { color: "#22c55e", title: "LTF Close (5m)" });
}`},{id:"js-mtf-multi-symbol",title:"JS MTF (multi-symbol)",format:"js",description:"Multi-symbol HTF series via request.security(symbol, tf, expr). Set symbols if available.",code:`// @lang js
const closeExpr = (s) => s.close;

export function onBar(ctx) {
  const symB = ctx.input("Symbol B (optional)", "");
  const symC = ctx.input("Symbol C (optional)", "");
  const bbb = symB
    ? request.security(symB, "240", closeExpr)
    : request.security("240", closeExpr);
  const ccc = symC
    ? request.security(symC, "60", closeExpr)
    : request.security("60", closeExpr);
  plot(bbb, { color: "#22c55e", title: "BBB 240" });
  plot(ccc, { color: "#f97316", title: "CCC 60" });
}`},{id:"js-math-color",title:"JS math + color",format:"js",description:"math.mod and color.new usage on plots.",code:`// @lang js
export function onBar(ctx) {
  const spread = math.max(ctx.high, ctx.low) - math.min(ctx.high, ctx.low);
  plot(spread, { color: color.new(color.teal, 20), title: "Spread", pane: "sub" });

  const tick = math.mod(ctx.bar_index, 10);
  plot(tick, { color: color.rgb(239, 68, 68), title: "Mod(10)", pane: "sub" });
}`},{id:"js-plot-fill-advanced",title:"JS plot + fill (advanced)",format:"js",description:"Advanced plot types with fill and hline.",code:`// @lang js
export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastPlot = plot(fast, { color: "#38bdf8", type: "neon_line", width: 2 });
  const slowPlot = plot(slow, { color: "#f59e0b", type: "bezier_line", width: 2 });
  fill(fastPlot, slowPlot, { color: "rgba(59, 130, 246, 0.12)" });
  hline(0, { color: "#64748b", style: "dashed", pane: "sub" });
  plot(Number(fast) - Number(slow), { color: "#f472b6", title: "Diff", pane: "sub", type: "area" });
}`},{id:"js-plot-advanced",title:"JS plot advanced (histogram)",format:"js",description:"Histogram + hline in sub pane with cross-only plotshape/plotchar.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);

  plot(fast, { color: "#38bdf8", type: "neon_line", width: 2 });
  plot(slow, { color: "#f59e0b", type: "bezier_line", width: 2 });

  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const diff = fastNow - slowNow;
  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  plot(diff, { type: "histogram", color: "#94a3b8", pane: "sub" });
  hline(0, { color: "#64748b", style: "dashed", pane: "sub" });

  plotshape(crossUp, {
    style: "triangle_up",
    location: "abovebar",
    color: "#22c55e",
    text: "UP",
  });
  plotchar(crossDown, {
    char: "x",
    location: "belowbar",
    color: "#ef4444",
  });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-draw-options-parity",title:"JS draw options parity",format:"js",description:"Labels/lines/boxes/tables with advanced styling + layer/zIndex.",code:`// @lang js
let stats;

export function onInit() {
  stats = table.new("top_right", 2, 2, {
    bgcolor: "rgba(15, 23, 42, 0.85)",
    frameColor: "#334155",
    frameWidth: 1,
    text_color: "#e2e8f0",
    text_halign: "center",
    text_valign: "middle",
  });
}

export function onBar(ctx) {
  const i = Number(ctx.bar_index);
  plot(ctx.close, { color: "#38bdf8", title: "Close" });

  if (i % 25 === 0) {
    label.new(ctx.bar_index, ctx.high, "Pulse", {
      style: "flag",
      color: "#0f172a",
      textcolor: "#f8fafc",
      bgcolor: "rgba(59, 130, 246, 0.2)",
      borderColor: "#60a5fa",
      borderWidth: 1,
      align: "center",
      valign: "middle",
      padding: { left: 6, right: 6, top: 3, bottom: 3 },
      tooltip: "Label tooltip",
      layer: "overlay",
      zIndex: 5,
      includeInAutoscale: false,
    });

    line.new(i - 2, ctx.low, i + 2, ctx.high, {
      color: "#22c55e",
      width: 2,
      style: "dashed",
      extend: "right",
      layer: "overlay",
      zIndex: 2,
      includeInAutoscale: false,
    });

    box.new(i - 3, ctx.high, i + 3, ctx.low, {
      border_color: "#f59e0b",
      border_width: 1,
      bgcolor: "rgba(245, 158, 11, 0.12)",
      text: "Zone",
      text_halign: "center",
      text_valign: "middle",
      text_wrap: true,
      tooltip: "Box tooltip",
      layer: "background",
      zIndex: 1,
      includeInAutoscale: false,
    });
  }

  if (stats) {
    table.cell(stats, 0, 0, "Bar", { text_color: "#e2e8f0" });
    table.cell(stats, 1, 0, String(i), { text_color: "#38bdf8" });
    table.cell(stats, 0, 1, "Close", { text_color: "#e2e8f0" });
    table.cell(stats, 1, 1, String(ctx.close), {
      text_color: "#22c55e",
      bgcolor: "rgba(15, 23, 42, 0.5)",
    });
  }
}`},{id:"js-plotcandle-ohlc",title:"JS plotcandle + plotohlc",format:"js",description:"Custom candles/ohlc with colors.",code:`// @lang js
export function onBar(ctx) {
  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, {
    color: "rgba(34,197,94,0.35)",
    downColor: "rgba(239,68,68,0.35)",
    wickColor: "#94a3b8",
    borderColor: "#334155",
  });
  plotohlc(ctx.open, ctx.high, ctx.low, ctx.close, {
    color: "#0ea5e9",
    downColor: "#f97316",
  });
}`},{id:"js-alert-basic",title:"JS alert basic",format:"js",description:"Alert rules via alertcondition/alert (Alerts Center).",code:`// @lang js
export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) > Number(slow);

  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", {
    id: "ema_cross_up",
    frequency: "once_per_bar",
  });

  alert("Pulse", {
    when: Number(ctx.bar_index) % 50 === 0,
    id: "pulse",
  });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f59e0b", title: "EMA 21" });
}`},{id:"js-strategy-basic",title:"JS strategy basic",format:"js",description:"Entry/exit signals with backtest config.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.05 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastNow = Number(fast);
  const slowNow = Number(slow);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.close("L", { when: crossDown });

  plot(fast, { color: "#22c55e", title: "EMA 10" });
  plot(slow, { color: "#ef4444", title: "EMA 30" });
  plot(strategy.position_size, { color: "#94a3b8", title: "Pos Size", pane: "sub" });
  plot(strategy.equity, { color: "#38bdf8", title: "Equity", pane: "sub" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-bracket",title:"JS strategy bracket",format:"js",description:"Entry with stop/limit exits and bracket sizing.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.04, slippagePct: 0.02 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const atr = ta.atr(14);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  const stopPx = Number(ctx.close) - Number(atr) * 1.5;
  const limitPx = Number(ctx.close) + Number(atr) * 2.0;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.exit("L", { when: crossDown, stop: stopPx, limit: limitPx, qtyPct: 50 });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f97316", title: "EMA 21" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-advanced",title:"JS strategy advanced",format:"js",description:"Order types + bracket/trailing options with strategy.config.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({
    initialCapital: 10000,
    commissionType: "percent",
    commissionPct: 0.03,
    slippageType: "ticks",
    slippageTicks: 2,
    pyramiding: 2,
    orderSize: { type: "percent_of_equity", value: 50 },
    allowShort: true,
    execution: "intrabar_ohlc",
    fillMode: "volume",
    volumeFillPct: 50,
    timeInForce: "gtc",
  });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const fastNow = Number(fast);
  const slowNow = Number(slow);
  const atr = ta.atr(14);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, {
    when: crossUp,
    bracket: { stopLossPct: 1.5, takeProfitPct: 3, trailingStopPct: 1 },
    kind: "mit",
    price: Number(ctx.close) + Number(atr) * 0.5,
    tif: "ioc",
  });

  const stopEntry = Number(ctx.close) + Number(atr) * 0.8;
  const limitEntry = stopEntry + Number(atr) * 0.2;
  strategy.order("S", strategy.short, {
    when: crossDown,
    kind: "lit",
    price: stopEntry,
    limit: limitEntry,
    qty: 1,
    tif: "fok",
    slippageType: "abs",
    slippageAbs: Number(atr) * 0.1,
  });

  strategy.exit("L", {
    kind: "trailing_stop",
    trailPct: 1.2,
    trailPrice: ctx.close,
    qtyPct: 50,
    commissionType: "cash",
    commissionCash: 1.5,
  });

  plot(fast, { color: "#22c55e", title: "EMA 8" });
  plot(slow, { color: "#f97316", title: "EMA 21" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-accessors",title:"JS strategy accessors",format:"js",description:"Plot-only accessors for closed/open trade stats.",code:`// @lang js
let prevFast = NaN;
let prevSlow = NaN;

export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.02, pyramiding: 1 });
}

export function onBar(ctx) {
  const fast = ta.ema(ctx.close, 10);
  const slow = ta.ema(ctx.close, 30);
  const fastNow = Number(fast);
  const slowNow = Number(slow);

  const crossUp =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast <= prevSlow &&
    fastNow > slowNow;
  const crossDown =
    Number.isFinite(prevFast) &&
    Number.isFinite(prevSlow) &&
    prevFast >= prevSlow &&
    fastNow < slowNow;

  strategy.entry("L", strategy.long, { when: crossUp, qty: 1 });
  strategy.close("L", { when: crossDown });

  plot(strategy.closedtrades.profit(0), { color: "#38bdf8", title: "Closed PnL", pane: "sub" });
  plot(strategy.closedtrades.net_profit(0), { color: "#22c55e", title: "Closed Net", pane: "sub" });
  plot(strategy.opentrades.profit(0), { color: "#f59e0b", title: "Open PnL", pane: "sub" });
  plot(strategy.closedtrades.fees(0), { color: "#94a3b8", title: "Closed Fees", pane: "sub" });

  plot(fast, { color: "#22c55e", title: "EMA 10" });
  plot(slow, { color: "#ef4444", title: "EMA 30" });

  prevFast = fastNow;
  prevSlow = slowNow;
}`},{id:"js-strategy-rsi-mean",title:"JS strategy RSI mean reversion",format:"js",description:"RSI oversold/overbought entries with limit orders.",code:`// @lang js
export function onInit() {
  strategy.config({ initialCapital: 10000, commissionPct: 0.02, pyramiding: 2 });
}

export function onBar(ctx) {
  const rsi = ta.rsi(ctx.close, 14);
  const rsiNow = Number(rsi);

  const longCond = Number.isFinite(rsiNow) && rsiNow < 30;
  const shortCond = Number.isFinite(rsiNow) && rsiNow > 70;

  const limitLong = Number(ctx.close) * 0.995;
  const limitShort = Number(ctx.close) * 1.005;

  strategy.order("RL", strategy.long, { when: longCond, limit: limitLong, qty: 1 });
  strategy.order("RS", strategy.short, { when: shortCond, limit: limitShort, qty: 1 });

  strategy.close("RL", { when: rsiNow > 55 });
  strategy.close("RS", { when: rsiNow < 45 });

  plot(rsi, { color: "#60a5fa", title: "RSI 14", pane: "sub" });
  plot(70, { color: "#94a3b8", title: "OB", pane: "sub" });
  plot(30, { color: "#94a3b8", title: "OS", pane: "sub" });
}`}];var Yte=be('<span class="svelte-15ifth6"> </span>'),Kte=be('<span class="svelte-15ifth6"> </span>'),Xte=be('<span class="svelte-15ifth6"> </span>'),Zte=be('<span class="svelte-15ifth6"> </span>'),Jte=be(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="json-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Define indicators with calc + plots + labels + lines.</li> <li>Compose series with expression math and condition language.</li> <li>Add trading signals and optional backtest settings.</li> <li>Build multi-pane visuals with main/sub panes.</li></ul> <h3 id="json-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to JSON.</li> <li>Start from a minimal spec with one plot.</li> <li>Add calc or series definitions you want to draw.</li> <li>Click Run to render the chart overlays.</li></ol> <h3 id="json-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">calc</div> <p>Structured indicators (ema, rsi, macd, bbands, etc.).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">series</div> <p>Expression-based series (lag, add, mul, custom math).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">when vs whenExpr</div> <p>Use when for condition language, whenExpr for expressions.</p></div></div> <h3 id="json-supported" class="svelte-15ifth6">Supported features</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Calc types</div> <div class="ss-tag-list svelte-15ifth6"></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Plot types</div> <div class="ss-tag-list svelte-15ifth6"></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Label shapes</div> <div class="ss-tag-list svelte-15ifth6"></div></div></div> <h3 id="json-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>Every pane must include at least one plot/label/level/line.</li> <li>Template loops (repeat/forEach) expand at load time.</li> <li>Signals score must be integers between 0 and 10.</li></ul> <h3 id="json-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>Schema validation failed: check field names and types.</li> <li>pane has no plots/labels/levels/lines: add at least one.</li> <li>Missing series: define calc/series names used in plots.</li> <li>Condition parse failed: validate when syntax.</li> <li>Expressions: dotted calls (<code>ta.sma</code>/<code>math.max</code>/<code>session.isin</code>), dotted fields (<code>syminfo.*</code>/<code>barstate.*</code>/<code>strategy.*</code>/<code>timeframe.*</code>), and inline <code>//</code> comments are supported; if pasted code fails, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="json-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">Runnable JSON examples live in the Examples tab → JSON Examples. Suggested
              starting points: EMA baseline, Labels and shapes, Polyline + path, Layer
              ordering, Autoscale exclusion, Draw clear + loop.</p> <details class="ss-dev-notes svelte-15ifth6"><summary>For developers</summary> <div class="ss-dev-body svelte-15ifth6"><p>Feature flags (dev only):</p> <div class="ss-tag-list svelte-15ifth6"></div> <p>Guardrails:</p> <ul class="ss-list svelte-15ifth6"><li>VERIFY mode compares snapshots without updating.</li> <li>UPDATE_SNAPSHOTS=1 regenerates fixtures when intentional.</li></ul></div></details></section>`),Qte=be(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="dsl-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Create quick signals and labels with a short syntax.</li> <li>Define simple series expressions (ema, highest, lowest).</li> <li>Attach scores and cooldowns to signals.</li></ul> <h3 id="dsl-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to DSL.</li> <li>Define series with <code>name = expr</code>.</li> <li>Add <code>signal ... when ...</code> and <code>label at ...</code>.</li> <li>Click Run to see labels and signal results.</li></ol> <h3 id="dsl-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Assignments</div> <p>Numbers become params; expressions become series.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Signals</div> <p>Use signal aliases like buy/sell/top/bot with when.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p>label at top/bot with text, color, and shape.</p></div></div> <h3 id="dsl-supported" class="svelte-15ifth6">Supported features</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Series</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">ema</span> <span class="svelte-15ifth6">sma</span> <span class="svelte-15ifth6">highest</span> <span class="svelte-15ifth6">lowest</span> <span class="svelte-15ifth6">lag</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Signals</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">signal buy/sell/top/bot</span> <span class="svelte-15ifth6">score</span> <span class="svelte-15ifth6">cooldown</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Labels</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">label at top/bot</span> <span class="svelte-15ifth6">text/color/shape</span></div></div></div> <h3 id="dsl-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>DSL is partial: no plots, no strategy blocks, no tables.</li> <li>Each line must follow a DSL command or assignment.</li></ul> <h3 id="dsl-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>signal ... when requires a condition: add a valid when.</li> <li>Unknown series: define the series before using it.</li> <li>Invalid score/cooldown: use numeric values only.</li> <li>Expressions: dotted calls (<code>ta.sma</code>/<code>math.max</code>/<code>session.isin</code>), dotted fields (<code>syminfo.*</code>/<code>barstate.*</code>/<code>strategy.*</code>/<code>timeframe.*</code>), and inline <code>//</code> comments are supported; if pasted code fails, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="dsl-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">DSL examples live in the Examples tab → DSL Examples. DSL is partial, so
              the list may be small compared to JSON/Pine.</p></section>`),ese=be(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">What you can do</a> <a class="svelte-15ifth6">Quick start</a> <a class="svelte-15ifth6">Core concepts</a> <a class="svelte-15ifth6">Supported features</a> <a class="svelte-15ifth6">Changelog</a> <a class="svelte-15ifth6">How-to</a> <a class="svelte-15ifth6">Sessions</a> <a class="svelte-15ifth6">request.security</a> <a class="svelte-15ifth6">Not supported yet</a> <a class="svelte-15ifth6">Limits & safety</a> <a class="svelte-15ifth6">Common mistakes</a> <a class="svelte-15ifth6">Examples</a></div> <h3 id="pine-what" class="svelte-15ifth6">What you can do</h3> <ul class="ss-list svelte-15ifth6"><li>Build overlay or oscillator indicators with Pine syntax.</li> <li>Use plots (plotcandle/plotbar/plotohlc/plotfill/plotarrow/hline), shapes, labels, lines, boxes, and draw.clear/for_each.</li> <li>Access history (x[n]), nz/na, and var state across bars.</li> <li>Use member fields like <code>syminfo.*</code>, <code>barstate.*</code>, <code>timeframe.*</code>, and <code>strategy.*</code>.</li> <li>Use arrays, time/date fields, and session filters.</li> <li>Use expanded ta.* (MA family + oscillators + channels + volume), including bbands/macd/stoch/cci/mfi/obv and kama/hma/tsi/supertrend/kdj/kst/uo/bbw.</li></ul> <h3 id="pine-quick" class="svelte-15ifth6">Quick start</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch editor mode to Pine.</li> <li>Add <code>//@pine</code> and <code>//@version=5</code>.</li> <li>Define <code>indicator("Name", overlay=true/false)</code>.</li> <li>Create a series and call <code>plot()</code> or <code>plotshape()</code>.</li> <li>Click Run to render the overlays.</li></ol> <p class="ss-note svelte-15ifth6">Pine is strict and deterministic, with extra builtins and runtime validation.</p> <h3 id="pine-core" class="svelte-15ifth6">Core concepts</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Execution model</div> <p>Runs once per bar; each series is an array of values (no lookahead).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">History + na</div> <p>x[0] is current bar, x[1] previous; out-of-range =&gt; na.</p> <p>Negative index raises a diagnostic.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">State</div> <p><code>var</code> initializes once, <code>:=</code> updates the series.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Conditionals</div> <p>if/else and ternary return per-bar series values.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Line rendering</div> <p>Dash styles are deterministic and use pixel units (no zoom scaling).</p> <p>extend is viewport-clipped and recomputed on pan/zoom.</p> <p>xloc=time uses floor + clamp; bar_index requires integers.</p> <p>Line handles use stable ids; line.set after line.delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p>xloc bar_index/time is strict; bar_index requires integers.</p> <p>xloc=time floors to the previous bar and clamps before-first.</p> <p>textalign left/center/right, tooltip, size, color/textcolor.</p> <p>bgcolor/bordercolor/border_width supported; text/tooltip truncate (24/80).</p> <p>yloc supports price/abovebar/belowbar with fixed padding; location=location.* maps to yloc.</p> <p>label.set after delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Boxes</div> <p>xloc/extend/border_style/text_size/text_halign/text_valign are strict.</p> <p>xloc=time floors to previous bar and clamps before-first; bar_index requires integers.</p> <p>extend expands to viewport edges (left/right/both) using resolved indices.</p> <p>border_width must be 0..4; numeric text_size clamps 8..32.</p> <p>Dash arrays match line policy; text is single-line with fixed padding and truncation.</p> <p>Box cap: max 200 active boxes per script run; extra creates are skipped with a single diagnostic; delete/clear frees capacity.</p> <p>Box handles use stable ids; box.set after delete reports an error.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Arrays</div> <p>Numeric arrays: array.new_float/int + push/get/set/size/clear + pop/shift/unshift/insert/remove/resize.</p> <p>array.from(...) builds compile-time arrays (literals only, all numeric or all string, no mixed types).</p> <p>String arrays: array.new_string + push/get/set/size/clear.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Builtins</div> <p>math.mod/math.fmod, expanded ta.* (MA/oscillator/channel/volume families incl. kama/hma/tsi/stochrsi/supertrend/keltner/donchian/ad/cmf + kdj/kst/uo/bbw/pvi/nvi/vortex/cog), time/date functions (year(time)/hour(time)/timestamp()/timenow()/time_close()), and session.isin(time, "HHMM-HHMM") in UTC.</p></div></div> <h3 id="pine-supported" class="svelte-15ifth6">Supported features</h3> <p class="ss-note svelte-15ifth6">Verified by guardrails. Pine adds stricter validation and extra builtins.</p> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Core syntax (verified)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">if/else</span> <span class="svelte-15ifth6">ternary</span> <span class="svelte-15ifth6">var / :=</span> <span class="svelte-15ifth6">history x[n]</span> <span class="svelte-15ifth6">nz / na</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Plots + primitives</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plot</span> <span class="svelte-15ifth6">plotshape</span> <span class="svelte-15ifth6">plotchar</span> <span class="svelte-15ifth6">plotcandle</span> <span class="svelte-15ifth6">plotbar/plotohlc</span> <span class="svelte-15ifth6">plotfill/fill</span> <span class="svelte-15ifth6">plotarrow</span> <span class="svelte-15ifth6">hline</span> <span class="svelte-15ifth6">label.new</span> <span class="svelte-15ifth6">line.new</span> <span class="svelte-15ifth6">box.new</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Tables + paths (limited)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">table.new/table.cell</span> <span class="svelte-15ifth6">linefill.new</span> <span class="svelte-15ifth6">polyline.new</span> <span class="svelte-15ifth6">polygon.new</span> <span class="svelte-15ifth6">path.new</span></div> <p>linefill.set_* supports color/line1/line2; table.set_*/table.cell_set_* support a subset (unsupported methods warn).</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Line options (validation)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">style: solid/dashed/dotted</span> <span class="svelte-15ifth6">extend: none/left/right/both</span> <span class="svelte-15ifth6">xloc: bar_index/time</span> <span class="svelte-15ifth6">width: integer &gt;= 1</span></div> <p>Dash arrays: solid [], dashed [6,4] (width &gt;= 3 → [8,5]), dotted [2,4] (width &gt;= 3 → [3,5]).</p> <p>lineDashOffset is fixed to 0 for deterministic renders.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Line lifecycle</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">stable ids</span> <span class="svelte-15ifth6">in-place updates</span> <span class="svelte-15ifth6">delete diagnostics</span></div> <p>line.new ids are deterministic per script run; line.set_* updates in place.</p> <p>line.set_* after line.delete reports <code>line is deleted</code>.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Label options (validation)</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">xloc: bar_index/time</span> <span class="svelte-15ifth6">textalign: left/center/right</span> <span class="svelte-15ifth6">size: tiny/small/normal/large/huge</span> <span class="svelte-15ifth6">style: up/down/circle/square/none</span> <span class="svelte-15ifth6">tooltip</span> <span class="svelte-15ifth6">yloc: price/abovebar/belowbar</span> <span class="svelte-15ifth6">location: abovebar/belowbar</span> <span class="svelte-15ifth6">bgcolor/bordercolor/border_width</span></div> <p>label.new ids are deterministic per script run; label.set_* updates in place.</p> <p>label.set_* after label.delete reports <code>label is deleted</code>.</p> <p>above/below defaults includeInAutoscale=false unless set explicitly.</p> <p>Size map: tiny=10, small=12, normal=14, large=16, huge=18; numeric sizes clamp 8..32.</p> <p>Text truncates at 24 chars; tooltip truncates at 80.</p> <p>Label cap: max 500 active labels per script run; extra creates are skipped with a single diagnostic; deleting labels frees capacity.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">plotshape/plotchar options</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">location.abovebar/belowbar</span> <span class="svelte-15ifth6">location.absolute</span> <span class="svelte-15ifth6">shape.triangleup/triangledown</span> <span class="svelte-15ifth6">shape.circle</span> <span class="svelte-15ifth6">shape.cross/xcross/diamond/flag</span> <span class="svelte-15ifth6">text/textcolor</span> <span class="svelte-15ifth6">size.tiny/small/large</span> <span class="svelte-15ifth6">offset</span> <span class="svelte-15ifth6">color</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Runtime draw</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">draw.clear</span> <span class="svelte-15ifth6">draw.for_each</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Arrays</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">array.new_float/int</span> <span class="svelte-15ifth6">array.push/get/set/size/clear</span> <span class="svelte-15ifth6">array.pop/shift/unshift/insert/remove/resize</span> <span class="svelte-15ifth6">array.from (const)</span> <span class="svelte-15ifth6">array.new_string (runtime)</span></div> <p>array.from is compile-time only and requires literal values (all numeric or all string).</p> <p>String arrays: runtime push/get/set/size/clear supported; pop/shift/unshift/insert/remove/resize are not supported yet.</p></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">ta.* subset</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">ta.sma/ta.ema/ta.wma/ta.rma</span> <span class="svelte-15ifth6">ta.dema/ta.tema/ta.hma</span> <span class="svelte-15ifth6">ta.kama/ta.alma/ta.t3</span> <span class="svelte-15ifth6">ta.trima/ta.swma/ta.evwma</span> <span class="svelte-15ifth6">ta.atr/ta.atrp/ta.natr</span> <span class="svelte-15ifth6">ta.bbands</span> <span class="svelte-15ifth6">ta.keltner/ta.donchian</span> <span class="svelte-15ifth6">ta.supertrend</span> <span class="svelte-15ifth6">ta.sar</span> <span class="svelte-15ifth6">ta.macd</span> <span class="svelte-15ifth6">ta.stoch/ta.stochrsi</span> <span class="svelte-15ifth6">ta.cci</span> <span class="svelte-15ifth6">ta.mfi</span> <span class="svelte-15ifth6">ta.obv</span> <span class="svelte-15ifth6">ta.cmo/ta.tsi</span> <span class="svelte-15ifth6">ta.ppo/ta.trix/ta.ao</span> <span class="svelte-15ifth6">ta.zscore</span> <span class="svelte-15ifth6">ta.cog</span> <span class="svelte-15ifth6">ta.highest/ta.lowest</span> <span class="svelte-15ifth6">ta.williamsr</span> <span class="svelte-15ifth6">ta.aroon/ta.aroonosc</span> <span class="svelte-15ifth6">ta.dmi/ta.adx/ta.plus_di/ta.minus_di/ta.dx</span> <span class="svelte-15ifth6">ta.sum</span> <span class="svelte-15ifth6">ta.rising/ta.falling</span> <span class="svelte-15ifth6">ta.valuewhen</span> <span class="svelte-15ifth6">ta.pivothigh/low</span> <span class="svelte-15ifth6">ta.ad/ta.cmf</span> <span class="svelte-15ifth6">ta.kdj/ta.kst</span> <span class="svelte-15ifth6">ta.uo</span> <span class="svelte-15ifth6">ta.bbw</span> <span class="svelte-15ifth6">ta.pvi/ta.nvi</span> <span class="svelte-15ifth6">ta.vortex</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Time + session</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">year(time)/month(time)/dayofweek(time)</span> <span class="svelte-15ifth6">hour(time)/minute(time)/second(time)</span> <span class="svelte-15ifth6">timestamp(...)</span> <span class="svelte-15ifth6">timenow()</span> <span class="svelte-15ifth6">time_close()</span> <span class="svelte-15ifth6">session.isin(time, "HHMM-HHMM")</span></div></div></div> <h3 id="pine-changelog" class="svelte-15ifth6">Changelog</h3> <ul class="ss-list svelte-15ifth6"><li>Function bodies now support control flow (<code>if/for/while/switch</code>), <code>var/varip</code>, and <code>:=</code>.</li> <li>Loops run at runtime with <code>break</code>/<code>continue</code> and a configurable max-iteration cap.</li> <li>Added member access for <code>syminfo.*</code>/<code>barstate.*</code>/<code>timeframe.*</code>/<code>strategy.*</code> and parsing for indexed expressions.</li> <li>Comparisons propagate na (operators &lt;=, &gt;=, !=).</li> <li>Safe math: invalid domains return na; division by 0 returns na; diagnostics are one-time.</li> <li>Added math.mod/math.fmod and ta.williamsr/ta.aroon/ta.dmi/ta.adx (ta.sum alias).</li> <li>Added ta.plus_di/ta.minus_di/ta.dx/ta.aroonosc.</li> <li>Added ta.rising/ta.falling and strict ta.sum length validation.</li> <li>Added ta.highest/ta.lowest with strict length validation and na-aware windows.</li> <li>Expanded ta.* with MA/oscillator/channel/volume families (kama/hma/tsi/stochrsi/supertrend/keltner/donchian/ad/cmf + kdj/kst/uo/bbw/pvi/nvi/vortex/cog).</li> <li>Added plot.style_* mapping (stepline/histogram/area/cross/circles) and plotshape/plotchar offset + extra shapes.</li> <li>Area plots no longer fill across na gaps (prevents triangle artifacts).</li> <li>Script Studio issue panel now recognizes plotshape cross/xcross/diamond/flag/tag/pill/none and location.absolute/size.auto.</li> <li>Added line.style_arrow_* support for runtime line objects.</li> <li>Added string array runtime ops (array.new_string + push/get/set/size/clear).</li> <li>Ternary numeric branches now unify int/float results.</li> <li>Strict integer rules for history/array indices and bar_index xloc values.</li> <li>A4: unified truthiness + tri-value logical ops + short-circuit; when uses expression semantics.</li></ul> <h3 id="pine-howto" class="svelte-15ifth6">How-to</h3> <ul class="ss-list svelte-15ifth6"><li>Operators &lt;=, &gt;=, != are supported.</li> <li>Comparisons return numeric 1/0 and yield na if any input is na.</li> <li>Use parentheses to make complex arithmetic + comparisons explicit.</li> <li>Chained comparisons are supported in simple form (1 &lt; x &lt; 3, a &lt;= b &lt;= c).</li> <li>For complex chains, rewrite explicitly: (a &lt; b) and (b &lt; c).</li> <li>Unsupported in chains: == / !=, or chains mixed with and/or/not or ternary at the same level.</li></ul> <h3 id="pine-known-limitations" class="svelte-15ifth6">Known Limitations (Important)</h3> <p class="ss-note svelte-15ifth6">These are current engine limits. Watch diagnostics for warnings.</p> <p class="ss-note svelte-15ifth6"><strong>1) Color expressions/variables</strong></p> <ul class="ss-list svelte-15ifth6"><li>Supported color forms: "#RRGGBB", color.rgb(r,g,b), color.new(color, transp), input.color(...).</li> <li>Not reliably supported: computed/local color variables in plot/plotshape (e.g., myColor = color.rgb(...); plot(..., color=myColor)).</li> <li>Workaround: inline the color expression in the call or use input.color.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported
plot(close, color="#22c55e")
c = input.color("#22c55e", "C")
plot(close, color=c)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Warning
myColor = color.rgb(34, 197, 94)
plot(close, color=myColor)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Workaround
plot(close, color=color.rgb(34, 197, 94))
</code></pre> <p class="ss-note svelte-15ifth6"><strong>2) Function bodies</strong></p> <ul class="ss-list svelte-15ifth6"><li>Multi-line functions support <code>if/for/while/switch</code>, <code>var/varip</code>, and <code>:=</code> assignments.</li> <li>Implicit return uses the final expression or a final <code>if</code>/<code>switch</code> block; use <code>return</code> for early exits.</li> <li>Loop iteration caps apply inside functions too (see loop semantics below).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported
f(x) =>
  var acc = 0.0
  if x > 0
    acc := acc + x
  acc
plot(f(close))
</code></pre> <p class="ss-note svelte-15ifth6"><strong>3) Loop semantics</strong></p> <ul class="ss-list svelte-15ifth6"><li>for/while execute at runtime with <code>break</code>/<code>continue</code> support.</li> <li>for-loops run to completion when bounds are finite (no default cap).</li> <li>while-loops use a safety cap (default 1000) to prevent infinite loops; a warning is emitted if exceeded.</li> <li>Set <code>__loop_max_iters</code> via input to override the cap for all loops; set it to 0 for unlimited (use with care). Values above 1,000,000 are clamped.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Supported (small loop)
sum = 0.0
for i = 0 to 5
  sum := sum + i
plot(sum)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Warning
for i = 0 to bar_index
  sum := sum + i
plot(sum)
</code></pre> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Workaround
plot(ta.sum(close, 5))
</code></pre> <h3 id="pine-boolean-policy" class="svelte-15ifth6">Boolean + na policy</h3> <ul class="ss-list svelte-15ifth6"><li>Conditions treat na as false; non-zero numbers are true.</li> <li>Conditions must be bool or number; string conditions are treated as false with a runtime warning.</li> <li>Tri-value logic: not(na) =&gt; na; na and false =&gt; false; na or true =&gt; true; other na cases propagate.</li> <li>and/or are short-circuit (skipped branches are not evaluated).</li> <li>Runtime warnings appear once per run per call-site.</li></ul> <h3 id="pine-ta-rules" class="svelte-15ifth6">ta.* rules</h3> <ul class="ss-list svelte-15ifth6"><li>ATR signatures: <code>ta.atr(length)</code>, <code>atr(length)</code>, and <code>atr(high, low, close, length)</code>.</li> <li>ATR uses true range + RMA (smma) smoothing; the seed is SMA of the first length values, so early bars are na.</li> <li>Lengths for ta.highest/ta.lowest/ta.sum/ta.rising/ta.falling must be integers &gt;= 1; invalid returns na with a runtime diagnostic.</li> <li>valuewhen occurrence must be integer &gt;= 0; invalid returns na with a runtime diagnostic.</li> <li>valuewhen conditions use A4 truthiness; na is treated as false (diagnostic once per call-site).</li> <li>highest/lowest ignore na inside the window; if all values are na, the result is na.</li> <li>Early bars use the available window up to the current bar (no warmup requirement).</li></ul> <h3 id="pine-stdlib" class="svelte-15ifth6">Standard Library Support</h3> <ul class="ss-list svelte-15ifth6"><li>math: <code>math.mod(a, b)</code> (modulus; sign follows divisor), <code>math.fmod(a, b)</code> (remainder; sign follows dividend). Divisor 0 returns na with a runtime diagnostic.</li> <li>str: <code>str.tostring</code>, <code>str.length</code>, <code>str.contains</code>, <code>str.replace</code>, <code>str.lower</code>, <code>str.upper</code>, <code>str.startswith</code>, <code>str.endswith</code>.</li> <li>color: <code>color.rgb</code>, <code>color.new</code>, <code>color.from_hex("#RRGGBB")</code>.</li> <li>ta: <code>ta.rma(src, len)</code> (Wilder's smoothing), <code>ta.tr()</code>/<code>ta.tr(high, low, close)</code>, <code>ta.vwap()</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// math + str
modv = math.mod(-5, 4)
ok = str.contains("alpha", "ph")
plot(modv)
plot(ok)

// color + ta
plot(close, color=color.from_hex("#ffcc00"))
plot(ta.vwap())
</code></pre> <p class="ss-note svelte-15ifth6"><strong>Known differences vs TradingView</strong></p> <ul class="ss-list svelte-15ifth6"><li>vwap() resets on UTC day boundaries using HLC3 * volume / volume (basic daily VWAP, not full session rules).</li> <li>math.mod uses mathematical modulus; math.fmod uses remainder (JS-style %).</li></ul> <h3 id="pine-session" class="svelte-15ifth6">Session filters</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>session.isin(time, "HHMM-HHMM")</code> to filter bars.</li> <li>Session strings must be string literals with an ASCII hyphen (no variables; e.g., "0930-1600").</li> <li>UTC time-of-day only (no exchange timezone yet).</li> <li>Wrap-around supported: <code>"2200-0200"</code> crosses midnight.</li> <li>Returns 1/0 (numeric) for plots or plotshape conditions.</li> <li>Invalid format errors with <code>session.isin session must be in HHMM-HHMM</code>.</li></ul> <h3 id="pine-request-security" class="svelte-15ifth6">request.security</h3> <p class="ss-note svelte-15ifth6">Pulls a series from another symbol/timeframe into the current chart.
              Uses server-backed candles when available, otherwise resamples chart candles.</p> <ul class="ss-list svelte-15ifth6"><li>Supported: HTF/MTF series, multi-symbol, lookahead/gaps flags.</li> <li>Pine accepts <code>ta.*</code> prefixes (e.g., <code>ta.ema</code>); the prefix is optional.</li> <li>Defaults: <code>lookahead=barmerge.lookahead_off</code>, <code>gaps=barmerge.gaps_off</code>.</li> <li>Lower TF: use <code>request.security_lower_tf</code> and the TF must be lower than the chart.</li> <li>Lower TF error: <code>request.security_lower_tf: "&lt;tf&gt;" must be lower than chart timeframe "&lt;chartTf&gt;"</code>.</li> <li>No silent fallback: lower TF without lower-TF candles is a hard error.</li> <li>Lower TF data error: <code>request.security error: request.security: lower timeframe "&lt;tf&gt;" is not available from current chart data (base ~&lt;N&gt;m). Switch chart timeframe lower or provide lower-TF datafeed.</code>.</li> <li>Invalid timeframe error: <code>request.security error: request.security: invalid timeframe "&lt;tf&gt;"</code>.</li> <li>Missing data errors: <code>request.security: no data for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>No overlap errors: <code>request.security: no overlap for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>Loading status: <code>Loading request.security: &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)... loaded &lt;oldest&gt;-&gt;&lt;newest&gt;</code>.</li> <li>Loading status (partial): <code>Loading request.security (partial): &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)... loaded &lt;oldest&gt;-&gt;&lt;newest&gt;</code>.</li></ul> <p class="ss-note svelte-15ifth6">Alignment: each base bar maps to the HTF bucket that contains its end time
              (next base open - 1ms). <code>lookahead_off</code> uses the previous confirmed
              HTF bar until the current HTF bar closes; <code>lookahead_on</code> uses the
              current HTF bar across the bucket. The last bar never confirms an HTF close.</p> <p class="ss-note svelte-15ifth6">Timezone: bucket boundaries use the symbol timezone when available, otherwise
              the chart timezone (UTC if none). Per-call timezone overrides are not supported.</p> <p class="ss-note svelte-15ifth6"><strong>Lookahead & gaps matrix</strong></p> <ul class="ss-list svelte-15ifth6"><li><code>lookahead_off + gaps_off</code>: updates on HTF close, carries forward across gaps (default).</li> <li><code>lookahead_off + gaps_on</code>: updates on HTF close, returns na inside gaps.</li> <li><code>lookahead_on + gaps_off</code>: updates within HTF bucket, carries forward across gaps.</li> <li><code>lookahead_on + gaps_on</code>: updates within HTF bucket, returns na inside gaps.</li></ul> <p class="ss-note svelte-15ifth6">Gap = missing HTF bucket or bucket mismatch. Use off/off for stable signals,
              on/on for live intrabucket updates with explicit gaps.</p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Default: stable signals
close_htf = request.security(syminfo.tickerid, "240", close,
  lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)

// Live within-bucket updates + explicit gaps
close_live = request.security(syminfo.tickerid, "240", close,
  lookahead=barmerge.lookahead_on, gaps=barmerge.gaps_on)
</code></pre> <p class="ss-note svelte-15ifth6">Not supported: nested <code>request.security</code> inside the expression,
              seconds-based timeframes, or synthetic lower-TF bars. Nested calls error: <code>request.security error: request.security: nested request.security inside security expression is not supported</code>.</p> <p class="ss-note svelte-15ifth6"><strong>Common errors</strong></p> <ul class="ss-list svelte-15ifth6"><li>No data: <code>request.security: no data for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>No overlap: <code>request.security: no overlap for &lt;symbol&gt;[@&lt;country&gt;] (&lt;tf&gt;)</code>.</li> <li>Invalid timeframe: <code>request.security error: request.security: invalid timeframe "&lt;tf&gt;"</code>.</li> <li>Nested security: <code>request.security error: request.security: nested request.security inside security expression is not supported</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Multi-symbol compare
close_bbb = request.security("BBB", "240", close)
close_ccc = request.security("CCC", "240", close)
spread = close_bbb - close_ccc
plot(spread, title="BBB-CCC Spread")
</code></pre> <p class="ss-note svelte-15ifth6"><strong>request.security_lower_tf</strong></p> <p class="ss-note svelte-15ifth6">Use this to fetch a lower timeframe series than the chart. The requested
              timeframe must be strictly lower, and lower-TF candles must be available
              (no synthetic downsampling).</p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Lower-TF close from 5m on a 15m chart
close_ltf = request.security_lower_tf(syminfo.tickerid, "5", close)
plot(close_ltf, title="LTF Close")
</code></pre> <p class="ss-note svelte-15ifth6"><strong>Limits &amp; performance</strong></p> <ul class="ss-list svelte-15ifth6"><li>Limits (enforced): 16 calls, 8 symbols, 8 timeframes, 5000 bars per series.</li> <li>Limit errors: <code>request.security error: request.security: limit exceeded: &lt;reason&gt;</code>.</li> <li>Performance: internal caching avoids recompute; outputs are unchanged.</li></ul> <p class="ss-note svelte-15ifth6">If you hit limits, reduce calls/symbols/timeframes or use a higher timeframe.</p> <p class="ss-note svelte-15ifth6"><strong>Minimal examples</strong></p> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// HTF EMA filter
ema_htf = request.security(syminfo.tickerid, "240", ta.ema(close, 20))
filter = close > ema_htf
plot(ema_htf, title="HTF EMA 20")
plot(filter ? 1 : 0, title="EMA Filter", style="histogram")

// Multi-symbol spread
close_bbb = request.security("BBB", "240", close)
close_ccc = request.security("CCC", "240", close)
spread = close_bbb - close_ccc
plot(spread, title="BBB-CCC Spread")
</code></pre> <h3 id="pine-not-supported" class="svelte-15ifth6">Limited / experimental (use with care)</h3> <ul class="ss-list svelte-15ifth6"><li>request.security / request.security_lower_tf (experimental; see request.security section for limits/errors).</li> <li>table.* drawing APIs (supported but limited; unsupported set methods warn and are ignored).</li> <li>strategy.* order functions (supported as signals/backtest; not full TradingView strategy parity).</li></ul> <h3 id="pine-strategy-accessors" class="svelte-15ifth6">Strategy accessors</h3> <ul class="ss-list svelte-15ifth6"><li>Supported: <code>strategy.position_size</code>, <code>strategy.position_avg_price</code>, <code>strategy.equity</code>.</li> <li>position_size is net qty (long &gt; 0, short &lt; 0, flat = 0).</li> <li>position_avg_price is the average entry price for the open position; na when flat.</li> <li>equity updates on bar close and includes unrealized P&amp;L using close (no intrabar fills yet).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Minimal usage
pos = strategy.position_size
avg = strategy.position_avg_price
eq = strategy.equity
plot(pos)
plot(avg)
plot(eq)
</code></pre> <h3 id="pine-limits" class="svelte-15ifth6">Limits & safety</h3> <ul class="ss-list svelte-15ifth6"><li>Caps: labels 500, lines 500, boxes 200, runtime draws 1000.</li> <li>When a cap is exceeded, extra objects are skipped with diagnostics.</li> <li>Label cap frees capacity on delete/clear and emits a single runtime diagnostic.</li> <li>Box cap frees capacity on delete/clear and emits a single runtime diagnostic.</li> <li>Lifecycle is consistent: new() creates, set_* updates in place, delete/clear marks handles deleted and set_* after delete emits &quot;&lt;type&gt; is deleted&quot;.</li> <li>Box options are strict (xloc/extend/border_style/border_width/text_size/text_halign/text_valign).</li> <li>Box xloc is strict (time floors+clamps; bar_index requires integers).</li> <li>Box extend expands to the visible viewport edges.</li> <li>Scripts are bar-based (no tick-level execution).</li> <li>Strict validation for safer, deterministic runs.</li> <li>Line xloc rules are strict (bar_index integer, time uses floor + clamp).</li> <li>Line extend is viewport-clipped and recomputed on pan/zoom.</li></ul> <h3 id="pine-mistakes" class="svelte-15ifth6">Common mistakes & fixes</h3> <ul class="ss-list svelte-15ifth6"><li>Missing //@pine header: add it at the top.</li> <li>plotshape requires a condition and valid style/location options.</li> <li>Negative history index: use x[1] or greater.</li> <li>array.set index must be within array size.</li> <li>valuewhen occurrence must be integer &gt;= 0; pivot left/right must be integer &gt;= 1.</li> <li>ta.highest/ta.lowest/ta.sum/ta.rising/ta.falling length must be integer &gt;= 1.</li> <li>Time fields are functions: use <code>hour(time)</code>, not <code>hour</code>.</li> <li>line style/extend/xloc not supported: use valid literals.</li> <li>line width must be &gt;= 1 (integer).</li> <li>line x must be integer when xloc=bar_index, number when xloc=time.</li> <li>line.set after line.delete triggers: "line is deleted".</li> <li>box.set after box.delete triggers: "box is deleted".</li> <li>label x must be integer when xloc=bar_index, number when xloc=time.</li> <li>label.set after label.delete triggers: "label is deleted".</li> <li>label yloc must be price/abovebar/belowbar.</li> <li>Label text/tooltip may truncate (24/80 chars); shorten if needed.</li> <li>Expect extend to clip to the visible viewport (not full history).</li> <li>Top-level loops inside top-level if blocks are not supported yet; use draw when-conditions to gate last-bar actions.</li> <li>Function bodies now allow <code>if/for/while/switch</code> + <code>var/varip</code> + <code>:=</code>; loop caps still apply.</li> <li>session.isin session must be in HHMM-HHMM (literal string, ASCII '-', example: "0930-1600").</li> <li>Dotted calls and member fields are supported (examples: <code>ta.sma</code>, <code>math.max</code>, <code>session.isin</code>, <code>syminfo.tickerid</code>, <code>barstate.islast</code>, <code>strategy.position_size</code>, <code>timeframe.period</code>).</li> <li>Inline comments using <code>//</code> are supported; block comments (<code>/* ... */</code>) are not supported.</li> <li>If pasted code fails unexpectedly, replace NBSP/odd whitespace with normal spaces.</li></ul> <h3 id="pine-mini" class="svelte-15ifth6">Examples</h3> <p class="ss-note svelte-15ifth6">All runnable Pine examples live in the Examples tab → Pine Examples.</p> <ul class="ss-list svelte-15ifth6"><li>EMA baseline, History + nz, var state, if/ternary basics.</li> <li>Array push/get/size, draw.clear + draw.for_each.</li> <li>Line update + delete, line style + extend, xloc mapping demo.</li> <li>Line extend (viewport clipped), dash styles, width 3 dash parity.</li> <li>Label yloc price/abovebar/belowbar + location alias.</li> <li>Label size mapping + bg/border + text/tooltip truncation.</li> <li>Label cap examples: delete frees capacity + single diagnostic.</li> <li>draw.clear by group/tags for line/label/box.</li> <li>Box lifecycle + delete diagnostics.</li> <li>Box extend examples (viewport-clipped).</li> <li>Box style examples (bg/border/dash/text).</li> <li>ta.highest/ta.lowest, ta.sum, ta.rising/ta.falling, ta.valuewhen, ta.pivothigh/low, ta.bbands/macd/stoch/cci/mfi/obv.</li> <li>Time fields, time_close, session.isin.</li></ul></section>`),tse=be(`<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-toc svelte-15ifth6"><a class="svelte-15ifth6">Start Here</a> <a class="svelte-15ifth6">Quick Index</a> <a class="svelte-15ifth6">Common Recipes</a> <a class="svelte-15ifth6">Implementation Playbook</a> <a class="svelte-15ifth6">Supported vs Not Supported</a> <a class="svelte-15ifth6">Script Structure</a> <a class="svelte-15ifth6">Data Model</a> <a class="svelte-15ifth6">History + NaN</a> <a class="svelte-15ifth6">Plots</a> <a class="svelte-15ifth6">Gradients</a> <a class="svelte-15ifth6">Pane Scaling</a> <a class="svelte-15ifth6">Autoscale Defaults</a> <a class="svelte-15ifth6">Draw Tools</a> <a class="svelte-15ifth6">Polyline/Polygon</a> <a class="svelte-15ifth6">Overlay Templates</a> <a class="svelte-15ifth6">Interaction</a> <a class="svelte-15ifth6">Heatmap</a> <a class="svelte-15ifth6">WebGL Runtime</a> <a class="svelte-15ifth6">Strategy & Backtest</a> <a class="svelte-15ifth6">Alerts</a> <a class="svelte-15ifth6">Multi-Timeframe</a> <a class="svelte-15ifth6">Datafeed Parity</a> <a class="svelte-15ifth6">Stdlib</a> <a class="svelte-15ifth6">JS API Index</a> <a class="svelte-15ifth6">Performance</a> <a class="svelte-15ifth6">Limits & Safety</a> <a class="svelte-15ifth6">Guardrails</a> <a class="svelte-15ifth6">JS Rules (Exact)</a> <a class="svelte-15ifth6">Troubleshooting</a> <a class="svelte-15ifth6">Examples</a> <a class="svelte-15ifth6">Status</a></div> <h3 id="js-start" class="svelte-15ifth6">Start Here (5 steps)</h3> <ol class="ss-steps svelte-15ifth6"><li>Switch Script Studio mode to JS and keep <code>// @lang js</code> on line 1.</li> <li>Choose your goal: indicator, strategy, overlay, or heatmap.</li> <li>Open the Examples tab and pick the closest example.</li> <li>Edit only one thing at a time (inputs → logic → visuals).</li> <li>Run and check the Issues panel if something is not visible.</li></ol> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Indicator</div> <p>Compute a series from <code>ctx.*</code> and plot it.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy</div> <p>Use <code>strategy.entry/exit/close</code> and plot equity in a sub pane.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay</div> <p>Use <code>overlay.new</code> or draw primitives (line/box/polygon).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap</div> <p>Create once in <code>onInit</code>, then push points in <code>onBar</code>.</p></div></div> <h3 id="js-index" class="svelte-15ifth6">Quick Index (find by task)</h3> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">I want to…</th><th class="svelte-15ifth6">Go to section</th><th class="svelte-15ifth6">Example to run</th></tr></thead><tbody><tr><td class="svelte-15ifth6">Plot a line indicator</td><td class="svelte-15ifth6">Plots</td><td class="svelte-15ifth6">JS basic plot</td></tr><tr><td class="svelte-15ifth6">Place buy/sell markers</td><td class="svelte-15ifth6">Plots (plotshape)</td><td class="svelte-15ifth6">JS plot advanced</td></tr><tr><td class="svelte-15ifth6">Draw boxes/labels/lines</td><td class="svelte-15ifth6">Draw Tools</td><td class="svelte-15ifth6">JS draw tools demo</td></tr><tr><td class="svelte-15ifth6">Draw polylines / polygons</td><td class="svelte-15ifth6"><a>Polyline/Polygon</a></td><td class="svelte-15ifth6">JS polygon overlay</td></tr><tr><td class="svelte-15ifth6">Create Fibonacci overlays</td><td class="svelte-15ifth6">Overlay Templates</td><td class="svelte-15ifth6">JS overlay fib labels</td></tr><tr><td class="svelte-15ifth6">Build a heatmap</td><td class="svelte-15ifth6">Heatmap</td><td class="svelte-15ifth6">JS heatmap raster</td></tr><tr><td class="svelte-15ifth6">Run a strategy backtest</td><td class="svelte-15ifth6">Strategy & Backtest</td><td class="svelte-15ifth6">JS strategy basic</td></tr><tr><td class="svelte-15ifth6">Create alert rules</td><td class="svelte-15ifth6">Alerts (JS)</td><td class="svelte-15ifth6">JS alert basic</td></tr><tr><td class="svelte-15ifth6">Use higher timeframe data</td><td class="svelte-15ifth6">Multi-Timeframe</td><td class="svelte-15ifth6">JS MTF basic</td></tr></tbody></table></div> <h3 id="js-recipes" class="svelte-15ifth6">Common Recipes (copy + edit)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">1) Indicator (single line)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const value = ta.ema(ctx.close, 20);
  if (!Number.isFinite(value)) return;
  plot(value, &#123; color: "#22c55e", title: "EMA 20" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">2) Indicator + signals</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  plot(fast, &#123; color: "#22c55e", title: "EMA 8" &#125;);
  plot(slow, &#123; color: "#f59e0b", title: "EMA 21" &#125;);
  plotshape(crossUp, &#123; style: "triangle_up", location: "belowbar", color: "#22c55e" &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">3) Strategy (entry + exit)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  const crossDown = fast &lt; slow;
  strategy.entry("L", strategy.long, &#123; when: crossUp &#125;);
  strategy.close("L", &#123; when: crossDown &#125;);
  plot(fast, &#123; color: "#22c55e", title: "EMA 8" &#125;);
  plot(slow, &#123; color: "#f59e0b", title: "EMA 21" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">4) Alerts (rules)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) &gt; Number(slow);
  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", &#123;
    id: "ema_cross_up",
    frequency: "once_per_bar",
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">5) Overlay template</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let rect;
export function onBar(ctx) &#123;
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;
  rect = overlay.new(
    "rect",
    [&#123; index: last - 20, value: ctx.low &#125;, &#123; index: last, value: ctx.high &#125;],
    &#123; styles: &#123; polygon: &#123; color: "rgba(14, 165, 233, 0.18)" &#125; &#125; &#125;
  );
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">6) Heatmap (sub pane)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let hm;
export function onInit() &#123;
  hm = heatmap.new(&#123; id: "vol", pane: "sub", xBinPx: 6, yBinPx: 6, agg: "avg" &#125;);
&#125;
export function onBar(ctx) &#123;
  if (Number(ctx.bar_index) % 3 === 0) &#123;
    heatmap.push(hm, Number(ctx.bar_index), Number(ctx.close), Number(ctx.volume));
  &#125;
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">7) Color-switching EMA (segments)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const WINDOW = 80;
let emaHist = [];
let closeHist = [];
let handles = [];

function initHandles() &#123;
  if (handles.length) return;
  for (let i = 0; i &lt; WINDOW; i++) &#123;
    handles.push(polyline.new(0, 0, 0, 0, &#123; color: "#3b82f6", width: 2, when: 0 &#125;));
  &#125;
&#125;

export function onBar(ctx) &#123;
  const ema = Number(ta.ema(ctx.close, 20));
  const close = Number(ctx.close);
  if (!Number.isFinite(ema) || !Number.isFinite(close)) return;
  emaHist.push(ema);
  closeHist.push(close);
  if (emaHist.length &gt; WINDOW + 1) &#123;
    emaHist.shift();
    closeHist.shift();
  &#125;
  initHandles();
  const lastX = Number(ctx.bar_index);
  const len = emaHist.length;
  for (let s = 0; s &lt; WINDOW; s++) &#123;
    const i1 = len - WINDOW + s;
    const i0 = i1 - 1;
    const h = handles[s];
    if (i0 &lt; 0 || i1 &lt;= 0 || i1 &gt;= len) &#123;
      polyline.set_points(h, 0, 0, 0, 0, &#123; when: 0 &#125;);
      continue;
    &#125;
    const x0 = lastX - (len - 1 - i0);
    const x1 = lastX - (len - 1 - i1);
    const y0 = emaHist[i0];
    const y1 = emaHist[i1];
    const color = closeHist[i1] &gt;= emaHist[i1] ? "#3b82f6" : "#ef4444";
    polyline.set_points(h, x0, y0, x1, y1, &#123; color, width: 2, when: 1 &#125;);
  &#125;
&#125;</code></pre></div></div> <h3 id="js-playbook" class="svelte-15ifth6">Implementation Playbook (step-by-step)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">A) Script structure</div> <ul class="ss-list svelte-15ifth6"><li>Declare handles in module scope.</li> <li>Use <code>onInit</code> for one-time setup.</li> <li>Use <code>onBar</code> for all logic and visuals.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">B) Indicator build</div> <ul class="ss-list svelte-15ifth6"><li>Pick input: <code>ctx.close</code> / <code>ctx.high</code>.</li> <li>Compute: <code>ta.ema</code> / custom math.</li> <li>Guard NaN, then <code>plot</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">C) Strategy build</div> <ul class="ss-list svelte-15ifth6"><li>Define signals.</li> <li>Use <code>strategy.entry/exit/close</code>.</li> <li>Plot equity in a sub pane.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">D) Overlay build</div> <ul class="ss-list svelte-15ifth6"><li>Create once with <code>overlay.new</code>.</li> <li>Update points with <code>overlay.set_points</code>.</li> <li>Keep handles stable.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">E) Heatmap build</div> <ul class="ss-list svelte-15ifth6"><li>Create in <code>onInit</code>.</li> <li>Push points each bar.</li> <li>Tune bins with <code>set_grid</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">F) Interaction</div> <ul class="ss-list svelte-15ifth6"><li>Interaction is enabled by default.</li> <li>Draw on last bar for visibility.</li> <li>Keep draw order stable.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">G) Performance</div> <ul class="ss-list svelte-15ifth6"><li>Keep loops small.</li> <li>Reuse handles.</li> <li>Prefer heatmap for dense visuals.</li></ul></div></div> <h3 id="js-support" class="svelte-15ifth6">Supported vs Not Supported</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Supported</div> <ul class="ss-list svelte-15ifth6"><li><strong>Execution:</strong> <code>onInit</code> once, <code>onBar</code> per bar, globals persist across bars.</li> <li><strong>Data:</strong> <code>ctx.open/high/low/close</code>, <code>ctx.volume/time</code>, <code>ctx.bar_index</code>.</li> <li><strong>History:</strong> <code>ctx.hist(series, n)</code> (integer <code>n &gt;= 0</code>).</li> <li><strong>Indicators:</strong> <code>ta.*</code> MA family, oscillators, volatility, volume, pivots.</li> <li><strong>Math, color, strings:</strong> <code>math.*</code>, <code>color.*</code>, <code>str.*</code> helpers.</li> <li><strong>Plots:</strong> <code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>plotcandle</code>, <code>plotohlc</code>, <code>plotbar</code>, <code>hline</code>, <code>fill</code>.</li> <li><strong>Plot types:</strong> line/area/histogram/bar + neon/glow/bezier/cloud.</li> <li><strong>Draw tools:</strong> <code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polyline.new</code>, <code>polygon.new</code>, <code>table.new</code>.</li> <li><strong>Styling:</strong> layer/zIndex, glow, gradients, tooltips, avoidOverlap.</li> <li><strong>Overlays:</strong> <code>overlay.new</code> templates (fib, ruler, shapes).</li> <li><strong>Heatmap:</strong> raster heatmap with LOD + tiling, colormap, bin sizes.</li> <li><strong>Strategy:</strong> <code>strategy.entry/exit/close/cancel</code>, config, brackets.</li> <li><strong>Alerts:</strong> <code>alertcondition</code> / <code>alert</code> rules in Alerts Center.</li> <li><strong>Backtest accessors:</strong> <code>strategy.equity</code>, <code>position_size</code>, trade metrics (plot-only).</li> <li><strong>MTF:</strong> <code>request.security</code> / <code>request.security_lower_tf</code> with multi-symbol + lookahead/gaps/timezone/session.</li> <li><strong>Diagnostics:</strong> warnings vs errors in Issues panel.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Not Supported (yet / by design)</div> <ul class="ss-list svelte-15ifth6"><li><strong>Pine syntax:</strong> JS mode does not parse Pine.</li> <li><strong>Async/IO:</strong> no DOM, network, timers, or async APIs.</li> <li><strong>Non-determinism:</strong> <code>Date</code>, <code>Math.random</code>, <code>performance.now</code> blocked.</li> <li><strong>Dynamic code:</strong> no <code>eval</code>, <code>Function</code>, or dynamic <code>import</code>.</li> <li><strong>External libs:</strong> third-party packages not available.</li></ul></div></div> <h3 id="js-structure" class="svelte-15ifth6">Script Structure (skeleton)</h3> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
let handle;

export function onInit(ctx) &#123;
  // one-time setup: tables, heatmaps, config
&#125;

export function onBar(ctx) &#123;
  // per-bar logic
  const i = Number(ctx.bar_index);
  if (!Number.isFinite(i)) return;

  // draw or plot
  plot(ctx.close, &#123; color: "#22c55e", title: "Close" &#125;);
&#125;</code></pre> <ul class="ss-list svelte-15ifth6"><li>Global variables persist across bars: use them for handles.</li> <li><code>onInit</code> runs once, <code>onBar</code> runs on every bar.</li> <li>All visuals should happen inside <code>onBar</code>.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Handle reuse (important)</div> <p>Create once, then update with <code>set_points</code> or <code>set</code> to avoid leaks.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Last-bar pattern</div> <p>Draw only on the last bar to keep visuals stable and visible.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Warmup guard</div> <p>Skip bars where indicators return NaN to avoid noise.</p></div></div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Last-bar only
const last = ctx.bar_index.data.length - 1;
if (Number(ctx.bar_index) !== last) return;</code></pre> <h3 id="js-data" class="svelte-15ifth6">Data Model (ctx)</h3> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">What</th><th class="svelte-15ifth6">How to use</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6">Price series</td><td class="svelte-15ifth6"><code>ctx.open/high/low/close</code></td><td class="svelte-15ifth6"><code>ta.ema(ctx.close, 20)</code></td></tr><tr><td class="svelte-15ifth6">Volume series</td><td class="svelte-15ifth6"><code>ctx.volume</code></td><td class="svelte-15ifth6"><code>ta.obv()</code></td></tr><tr><td class="svelte-15ifth6">Time & index</td><td class="svelte-15ifth6"><code>ctx.time</code>, <code>ctx.bar_index</code></td><td class="svelte-15ifth6"><code>Number(ctx.bar_index)</code></td></tr><tr><td class="svelte-15ifth6">Inputs</td><td class="svelte-15ifth6"><code>ctx.input(name, default)</code></td><td class="svelte-15ifth6"><code>const len = ctx.input("Len", 20)</code></td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Series arrays are available as <code>ctx.bar_index.data</code> (useful for last-bar checks).</li> <li>Convert to numbers when needed: <code>Number(ctx.close)</code>.</li></ul> <h3 id="js-history" class="svelte-15ifth6">History + NaN Rules</h3> <ul class="ss-list svelte-15ifth6"><li><code>ctx.hist(series, n)</code> only accepts integer <code>n &gt;= 0</code>.</li> <li>Out of range returns <code>NaN</code>.</li> <li>Use <code>Number.isFinite(x)</code> before plotting or using in conditions.</li> <li>Conditions accept number/boolean/string only; objects/arrays are errors.</li> <li><code>NaN</code> is treated as false inside conditions.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// Guard warmup bars
const value = ta.ema(ctx.close, 20);
if (!Number.isFinite(value)) return;
plot(value, &#123; title: "EMA 20" &#125;);</code></pre> <h3 id="js-plots" class="svelte-15ifth6">Plots (line / area / histogram)</h3> <div class="ss-feature-grid svelte-15ifth6"><div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Core plots</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plot</span> <span class="svelte-15ifth6">plotshape</span> <span class="svelte-15ifth6">plotchar</span> <span class="svelte-15ifth6">hline</span> <span class="svelte-15ifth6">fill</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Candle plots</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">plotcandle</span> <span class="svelte-15ifth6">plotohlc</span> <span class="svelte-15ifth6">plotbar</span></div></div> <div class="ss-feature-card svelte-15ifth6"><div class="ss-feature-title svelte-15ifth6">Advanced types</div> <div class="ss-tag-list svelte-15ifth6"><span class="svelte-15ifth6">neon_line</span> <span class="svelte-15ifth6">glow_points</span> <span class="svelte-15ifth6">bezier_line</span> <span class="svelte-15ifth6">cloud</span></div></div></div> <p class="ss-note svelte-15ifth6">Legends auto-stack. Hide a legend with <code>legend: false</code>, or move it using <code>legendPosition</code>/<code>legendOffsetX</code>/<code>legendOffsetY</code>.</p> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Plot option</th><th class="svelte-15ifth6">Meaning</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>type</code></td><td class="svelte-15ifth6">Line/area/histogram/bar/candles/ohlc + advanced types.</td><td class="svelte-15ifth6"><code>&#123; type: "histogram" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>color</code> / <code>width</code></td><td class="svelte-15ifth6">Stroke color and width.</td><td class="svelte-15ifth6"><code>&#123; color: "#22c55e", width: 2 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Two-stop fill/stroke gradient for plots.</td><td class="svelte-15ifth6"><code>&#123; gradient: &#123; from: "rgba(56,189,248,.4)", to: "rgba(34,197,94,.2)", mode: "vertical" &#125; &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>offset</code></td><td class="svelte-15ifth6">Shift plot forward/backward by bars.</td><td class="svelte-15ifth6"><code>&#123; offset: -1 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>showLast</code></td><td class="svelte-15ifth6">Only show last N bars.</td><td class="svelte-15ifth6"><code>&#123; showLast: 100 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>trackPrice</code></td><td class="svelte-15ifth6">Show last value label at right axis.</td><td class="svelte-15ifth6"><code>&#123; trackPrice: true &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>pane</code></td><td class="svelte-15ifth6">Target pane (<code>"main"</code> or <code>"sub"</code>).</td><td class="svelte-15ifth6"><code>&#123; pane: "sub" &#125;</code></td></tr></tbody></table></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">plotshape styles</div> <p>cross, xcross, triangle_up, triangle_down, circle, square, diamond, star, arrow_up, arrow_down, flag, tag, pill, bubble, spark, box, box_gradient, label, text, circle_pulse, arrow_up_glow, arrow_down_glow, triangle_up_gradient, triangle_down_gradient.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">plotshape options</div> <p><code>size</code>, <code>location</code> (abovebar/belowbar/price), <code>offset</code>, <code>text</code>, <code>textcolor</code>, <code>bgGradient</code>, <code>tooltip</code>.</p></div></div> <h3 id="js-gradient" class="svelte-15ifth6">Gradients (plots + labels + boxes)</h3> <p class="ss-note svelte-15ifth6">Use a two-stop gradient object: <code>&#123; from, to, mode &#125;</code>. Supported modes: <code>"vertical"</code> (default), <code>"horizontal"</code>, <code>"radial"</code>.</p> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">How to use (step-by-step)</div> <ul class="ss-list svelte-15ifth6"><li>Pick the target API: <code>plot</code>, <code>plotcandle</code>, <code>plotshape</code>, <code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polygon.new</code>, <code>fill</code>.</li> <li>Build the gradient object: <code>&#123; from: "#...", to: "#...", mode: "vertical|horizontal|radial" &#125;</code>.</li> <li>Attach it to the right key (see table below).</li> <li>Keep gradients simple: two stops only for best performance.</li> <li>If a gradient looks flat, check pane scaling or set <code>includeInAutoscale: true</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Which key to use</div> <table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">API</th><th class="svelte-15ifth6">Gradient key</th><th class="svelte-15ifth6">Affects</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>plot</code></td><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Line/area/hist/dots/stepped/neon/bezier/cloud</td></tr><tr><td class="svelte-15ifth6"><code>plotcandle</code></td><td class="svelte-15ifth6"><code>gradient</code>, <code>downGradient</code></td><td class="svelte-15ifth6">Up/down candle bodies</td></tr><tr><td class="svelte-15ifth6"><code>plotshape</code> / <code>label.new</code></td><td class="svelte-15ifth6"><code>bgGradient</code></td><td class="svelte-15ifth6">Label background</td></tr><tr><td class="svelte-15ifth6"><code>line.new</code> / <code>polyline.new</code></td><td class="svelte-15ifth6"><code>gradient</code></td><td class="svelte-15ifth6">Stroke color</td></tr><tr><td class="svelte-15ifth6"><code>box.new</code></td><td class="svelte-15ifth6"><code>bgGradient</code></td><td class="svelte-15ifth6">Box fill</td></tr><tr><td class="svelte-15ifth6"><code>polygon.new</code></td><td class="svelte-15ifth6"><code>fillGradient</code></td><td class="svelte-15ifth6">Polygon fill</td></tr><tr><td class="svelte-15ifth6"><code>fill</code></td><td class="svelte-15ifth6"><code>fillGradient</code></td><td class="svelte-15ifth6">Band fill between two series</td></tr></tbody></table></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plot gradient (line/area/hist)</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const v = ta.ema(ctx.close, 20);
  plot(v, &#123;
    type: "area",
    color: "#60a5fa",
    gradient: &#123; from: "rgba(96,165,250,0.35)", to: "rgba(34,197,94,0.12)", mode: "vertical" &#125;
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Label / plotshape gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const isBuy = Number(ctx.bar_index) % 25 === 5;
  plotshape(isBuy, &#123;
    style: "callout",
    text: "BUY",
    location: "belowbar",
    bgGradient: &#123; from: "#16a34a", to: "#22c55e", mode: "horizontal" &#125;
  &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Candle gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  plotcandle(ctx.open, ctx.high, ctx.low, ctx.close, &#123;
    color: "#22c55e",
    downColor: "#ef4444",
    gradient: &#123; from: "rgba(34,197,94,0.45)", to: "rgba(34,197,94,0.1)", mode: "vertical" &#125;,
    downGradient: &#123; from: "rgba(239,68,68,0.45)", to: "rgba(239,68,68,0.1)", mode: "vertical" &#125;
  &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Box gradient</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  box.new(ctx.bar_index - 10, ctx.high, ctx.bar_index, ctx.low, &#123;
    bgGradient: &#123; from: "rgba(56,189,248,0.25)", to: "rgba(14,116,144,0.12)", mode: "vertical" &#125;,
    borderColor: "#38bdf8"
  &#125;);
&#125;</code></pre></div></div> <h3 id="js-pane-scaling" class="svelte-15ifth6">Pane Scaling (important)</h3> <ul class="ss-list svelte-15ifth6"><li>Each pane has a single y-scale. If you plot very different magnitudes together, small series look flat.</li> <li>Example: <code>strategy.equity</code> (~10,000) vs <code>strategy.position_size</code> (~1).</li> <li>Solution: use <code>pane: "sub"</code> or normalize one series.</li></ul> <h3 id="js-autoscale" class="svelte-15ifth6">Autoscale Defaults</h3> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code> to avoid chart compression.</li> <li>Heatmaps in sub panes default to autoscale on.</li> <li>If a plot is off-screen, set <code>includeInAutoscale: true</code> or adjust pane.</li></ul> <h3 id="js-draw" class="svelte-15ifth6">Draw Tools (labels / lines / boxes)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Labels</div> <p><code>label.new</code> supports padding, wrap, tooltip, font, avoidOverlap.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Lines</div> <p><code>line.new</code> supports dashed/dotted, gradient, extend, glow.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Boxes</div> <p><code>box.new</code> supports borders, text, and background fill/gradient.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polylines / Polygons</div> <p><code>polyline.new</code> / <code>polygon.new</code> support glow + gradients.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Tables</div> <p><code>table.new</code> / <code>table.cell</code> for small dashboards.</p></div></div> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code>.</li> <li>Use <code>layer</code> + <code>zIndex</code> for draw order.</li> <li>Use <code>timestamp + value</code> for overlays to avoid index misalignment.</li> <li>Lock tool locks existing drawings; starting a new draw auto-unlocks for editing.</li> <li>Floating lock toggles only the selected drawing and stays locked until unlocked there.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Label options (common)</div> <p>bgcolor, bgGradient, borderColor, borderWidth, padding, wrap, maxWidth, align, valign, textAlign, fontFamily, fontSize, fontWeight, lineHeight, radius, tooltip, layer, zIndex, includeInAutoscale, xloc, yloc, avoidOverlap, collision.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Line options (common)</div> <p>color, gradient, width, style (solid/dashed/dotted), glow, glowColor, glowOpacity, extend, xloc, layer, zIndex, includeInAutoscale.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polygon options (common)</div> <p>fillColor, fillGradient (vertical/horizontal/radial), strokeColor, strokeWidth, strokeStyle, opacity, glow, glowColor, glowOpacity, layer, zIndex, includeInAutoscale.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Box + table options</div> <p>box: border_color, border_width, border_style, bgcolor, bgGradient, text, text_halign, text_valign, text_wrap, extend, xloc. table: bgcolor, frameColor, frameWidth, borderColor, borderWidth, text_color, text_halign, text_valign, text_size.</p></div></div> <h4 id="js-polyline-polygon">Polylines / Polygons (step-by-step)</h4> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polyline step-by-step</div> <ul class="ss-list svelte-15ifth6"><li>Choose points in bar_index + price (or time + price).</li> <li>Call <code>polyline.new</code> with points and options.</li> <li>Use <code>polyline.set_points</code> if you want to update it.</li> <li>Per-bar color changes require segments (one handle per segment).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const i = Number(ctx.bar_index);
  polyline.new(
    &#123; x: i - 3, y: Number(ctx.low) &#125;,
    &#123; x: i, y: Number(ctx.high) &#125;,
    &#123; x: i + 3, y: Number(ctx.low) &#125;,
    &#123; color: "#22c55e", width: 2, includeInAutoscale: false &#125;
  );
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Polygon step-by-step</div> <ul class="ss-list svelte-15ifth6"><li>Use at least 3 points (closed shape).</li> <li>Call <code>polygon.new</code> with points and fill/stroke options.</li> <li>Curves: use fractional x values (ex: <code>i + 0.25</code>) or keep shapes wide enough (8-12 bars).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const i = Number(ctx.bar_index);
  polygon.new(
    &#123; x: i - 3, y: Number(ctx.low) &#125;,
    &#123; x: i, y: Number(ctx.high) &#125;,
    &#123; x: i + 3, y: Number(ctx.low) &#125;,
    &#123;
      fillColor: "rgba(56,189,248,0.25)",
      strokeColor: "#38bdf8",
      strokeWidth: 2,
      includeInAutoscale: false
    &#125;
  );
&#125;</code></pre></div></div> <h3 id="js-overlays" class="svelte-15ifth6">Overlay Templates</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay rules</div> <ul class="ss-list svelte-15ifth6"><li>Prefer <code>&#123;timestamp, value&#125;</code> points for stable alignment.</li> <li>Draw overlays on the last bar so they update cleanly.</li> <li>Use <code>extendData</code> for template-specific settings.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Fibonacci example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const last = ctx.bar_index.data.length - 1;
  if (Number(ctx.bar_index) !== last) return;
  overlay.new("fibonacciSegment", [
    &#123; timestamp: Number(ctx.hist(ctx.time, 1)), value: Number(ctx.hist(ctx.low, 1)) &#125;,
    &#123; timestamp: Number(ctx.hist(ctx.time, 0)), value: Number(ctx.hist(ctx.high, 0)) &#125;,
  ], &#123;
    extendData: &#123;
      labelSide: "left",
      labelOffset: 16,
      labelAlign: "right",
      fibonacciLevels: [
        &#123; value: 0, color: "#64748b", label: "0", visible: true &#125;,
        &#123; value: 0.382, color: "#60a5fa", label: "0.382", visible: true &#125;,
        &#123; value: 0.5, color: "#22c55e", label: "0.5", visible: true &#125;,
        &#123; value: 0.618, color: "#f59e0b", label: "0.618", visible: true &#125;,
        &#123; value: 1, color: "#64748b", label: "1", visible: true &#125;,
      ],
    &#125;
  &#125;);
&#125;</code></pre></div></div> <ul class="ss-list svelte-15ifth6"><li>Create with <code>overlay.new(name, points, opts)</code>.</li> <li>Update with <code>overlay.set_points(handle, points)</code>.</li> <li>Points can be pairs (<code>[index, value]</code>) or objects (<code>&#123; index, value &#125;</code>).</li> <li>Common templates: <code>rect</code>, <code>circle</code>, <code>triangle</code>, <code>parallelogram</code>, <code>arrow</code>, <code>text</code>, <code>emoji</code>.</li> <li>Fibonacci: <code>fibonacciSegment</code>, <code>fibonacciExtension</code>, <code>fibonacciCircle</code>, <code>fibonacciSpiral</code>, <code>fibonacciSpeedResistanceFan</code>.</li> <li>Other: <code>horizontalStraightLine</code>, <code>horizontalRayLine</code>, <code>ruler</code>, <code>trade</code>, <code>note</code>, <code>barSignal</code>, <code>gannBox</code>, <code>pointAndFigure</code>.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Point fields</div> <p>index, timestamp, value, source, pivot, extreme, lookback, left, right, which.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Fibonacci labels</div> <p><code>extendData.labelSide</code>, <code>labelOffset</code>, <code>labelAlign</code>, <code>fibonacciLevels</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Guardrails</div> <p>Max overlays and total overlay points are capped to protect performance.</p></div></div> <h3 id="js-interaction" class="svelte-15ifth6">Interaction</h3> <ul class="ss-list svelte-15ifth6"><li>Drag: line, polyline, polygon, path, box, label.</li> <li>Resize: box (edge/corner handles).</li> <li>Draw objects + plots render behind by default; hover lifts them to the foreground.</li> <li>Hover priority: draw/overlay hits take precedence over series hover.</li> <li>Click a candle or plot line/bar to place selection markers every 6 bars (auto‑throttled), with a brighter dot on the selected bar. Click empty space to clear.</li> <li>Snap: hold Alt to disable; hold Shift to lock axis; arrows to nudge.</li> <li>Edits are session-scoped (no script callbacks yet).</li></ul> <h3 id="js-heatmap" class="svelte-15ifth6">Heatmap</h3> <ul class="ss-list svelte-15ifth6"><li>Create once in <code>onInit</code> using <code>heatmap.new</code>.</li> <li>Push points every bar with <code>heatmap.push</code>.</li> <li>Use <code>heatmap.set_grid</code> to adjust bin sizes.</li></ul> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Option</th><th class="svelte-15ifth6">Meaning</th><th class="svelte-15ifth6">Example</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>pane</code></td><td class="svelte-15ifth6">Target pane (<code>"sub"</code> recommended for heatmaps).</td><td class="svelte-15ifth6"><code>&#123; pane: "sub" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>xloc</code> / <code>yloc</code></td><td class="svelte-15ifth6">Coordinate system: <code>bar_index</code> or <code>time</code>; <code>price</code> for y.</td><td class="svelte-15ifth6"><code>&#123; xloc: "bar_index" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>xBinPx</code> / <code>yBinPx</code></td><td class="svelte-15ifth6">Bin size in pixels (LOD scales up when zoomed out).</td><td class="svelte-15ifth6"><code>&#123; xBinPx: 6, yBinPx: 6 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>agg</code></td><td class="svelte-15ifth6">Aggregation: sum/avg/max/min.</td><td class="svelte-15ifth6"><code>&#123; agg: "avg" &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>blend</code> / <code>opacity</code></td><td class="svelte-15ifth6">Blend mode and opacity for visuals.</td><td class="svelte-15ifth6"><code>&#123; blend: "screen", opacity: 0.85 &#125;</code></td></tr><tr><td class="svelte-15ifth6"><code>colormap</code></td><td class="svelte-15ifth6">Color ramp with stops.</td><td class="svelte-15ifth6"><code>&#123; colormap: [&#123; stop: 0, color: "#0f172a" &#125;] &#125;</code></td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Use <code>heatmap.setGrid</code> (alias) to update bins after creation.</li> <li>Heatmap points are capped; exceeding the cap emits a warning.</li> <li>Heatmaps redraw on zoom/scroll and stay aligned to candles.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>let hm;
export function onInit() &#123;
  hm = heatmap.new(&#123; id: "hm", pane: "sub", xBinPx: 6, yBinPx: 6, agg: "avg" &#125;);
&#125;
export function onBar(ctx) &#123;
  heatmap.push(hm, Number(ctx.bar_index), Number(ctx.close), Number(ctx.volume));
&#125;</code></pre> <h3 id="js-webgl" class="svelte-15ifth6">WebGL Runtime</h3> <ul class="ss-list svelte-15ifth6"><li>Heatmaps use WebGL by default for performance (Canvas fallback if needed).</li> <li>WebGL accelerates polylines/polygons when available.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap raster (WebGL)</div> <p>Bins are rasterized in GPU tiles; zooming out increases bin size for speed.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Primitives (WebGL)</div> <p>Lines/polylines/polygons render in GPU for smooth zoom/scroll.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Glow</div> <p>Glow may render via Canvas for stability; outline stays crisp.</p></div></div> <h3 id="js-strategy" class="svelte-15ifth6">Strategy & Backtest</h3> <ul class="ss-list svelte-15ifth6"><li>Signals evaluate on bar close; market fills next bar open.</li> <li>Enable intrabar fills with <code>execution: "intrabar_ohlc"</code>.</li> <li>Order kinds include <code>market/limit/stop/stop_limit/mit/lit/trailing_stop</code> (use <code>kind</code>).</li> <li>Use <code>tif: "gtc" | "ioc" | "fok"</code> to control time-in-force.</li> <li><code>fillMode: "volume"</code> enables partial fills (use <code>volumeFillPct</code>).</li> <li>Use <code>strategy.entry/exit/close</code> and plot equity in a sub pane.</li> <li>Accessors like <code>strategy.equity</code> are for plots (not entry logic).</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = fast &gt; slow;
  const crossDown = fast &lt; slow;
  strategy.entry("L", strategy.long, &#123; when: crossUp, qty: 1 &#125;);
  strategy.exit("L", &#123; stop: Number(ctx.close) * 0.98, limit: Number(ctx.close) * 1.03 &#125;);
  strategy.close("L", &#123; when: crossDown &#125;);
&#125;</code></pre> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Order types</div> <p>market/limit/stop/stop_limit + MIT/LIT + trailing_stop. Use <code>kind</code> to override.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Sizing</div> <p><code>strategy.config(&#123; orderSize: &#123; type, value &#125; &#125;)</code> for default sizing.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Partial fills</div> <p>Enable <code>fillMode: "volume"</code> and set <code>volumeFillPct</code> (ex: 50).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Risk caps</div> <p><code>max_drawdown</code>, <code>max_position_size</code>, <code>max_intraday_loss</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Costs</div> <p><code>commissionType</code> + <code>commissionPct/commissionCash/commissionPerUnit</code>, <code>slippageType</code> + <code>slippagePct/slippageAbs/slippageTicks</code>.</p></div></div> <div class="ss-table-wrap svelte-15ifth6"><table class="ss-table svelte-15ifth6"><thead><tr><th class="svelte-15ifth6">Accessor (plot only)</th><th class="svelte-15ifth6">Meaning</th></tr></thead><tbody><tr><td class="svelte-15ifth6"><code>strategy.position_size</code></td><td class="svelte-15ifth6">Current position size.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.position_avg_price</code></td><td class="svelte-15ifth6">Average entry price.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.equity</code></td><td class="svelte-15ifth6">Equity curve.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.net_profit</code></td><td class="svelte-15ifth6">Total net profit.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.trades</code></td><td class="svelte-15ifth6">Number of completed trades.</td></tr><tr><td class="svelte-15ifth6"><code>strategy.win_rate</code></td><td class="svelte-15ifth6">Win percentage.</td></tr></tbody></table></div> <ul class="ss-list svelte-15ifth6"><li>Trade arrays: <code>strategy.closedtrades.&lt;field&gt;(offset)</code> and <code>strategy.opentrades.&lt;field&gt;(offset)</code>.</li> <li>Fields include <code>profit/net_profit/fees</code>, <code>entry_fee</code>, and <code>exit_fee</code> (closed only).</li> <li>Accessors are computed after backtest; do not use for signals.</li></ul> <h3 id="js-alerts" class="svelte-15ifth6">Alerts (JS)</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>alertcondition</code> to register alert rules.</li> <li>Use <code>alert</code> for quick, message-based alerts.</li> <li>Provide a stable <code>id</code> or <code>title</code> so the rule persists.</li> <li>Frequency: <code>once</code>, <code>once_per_bar</code>, <code>once_per_bar_close</code>.</li></ul> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
export function onBar(ctx) &#123;
  const fast = ta.ema(ctx.close, 8);
  const slow = ta.ema(ctx.close, 21);
  const crossUp = Number(fast) &gt; Number(slow);

  alertcondition(crossUp, "EMA Cross Up", "Fast EMA crossed above slow", &#123;
    id: "ema_cross_up",
    frequency: "once_per_bar",
  &#125;);

  alert("Momentum check", &#123;
    when: Number(ctx.bar_index) % 50 === 0,
    id: "pulse",
  &#125;);
&#125;</code></pre> <h3 id="js-mtf" class="svelte-15ifth6">Multi-Timeframe</h3> <ul class="ss-list svelte-15ifth6"><li>Use <code>request.security(tf, expr, opts)</code> and <code>request.security_lower_tf</code> for HTF/LTF series (multi-symbol supported).</li> <li>Define <code>expr</code> outside <code>onBar</code> to avoid call limits.</li> <li>Nested calls are allowed with a depth guardrail (default 6); lower TF requires datafeed coverage.</li> <li>Alignment defaults to previous bar; use <code>lookahead</code> for same-bar values.</li> <li><code>gaps: true</code> leaves gaps when HTF bars do not align.</li> <li>Invalid timeframe strings throw a deterministic error.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Options</div> <p><code>lookahead</code>, <code>gaps</code>, <code>timezone</code>, <code>session</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Timeframes</div> <p>Supports seconds (ex: <code>30s</code>) and higher TF strings like <code>240</code>, <code>1D</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Limits</div> <p>Call limit per script run is enforced (default 20).</p></div></div> <h4 class="ss-subtitle">MTF step-by-step</h4> <ol class="ss-list svelte-15ifth6"><li><strong>Pick your TFs:</strong> Chart TF is the base. Use HTF with <code>request.security</code> and LTF with <code>request.security_lower_tf</code>.</li> <li><strong>Define expressions once:</strong> Put <code>expr</code> outside <code>onBar</code> to avoid reallocation and call limits.</li> <li><strong>Call from onBar:</strong> Use the same <code>expr</code> function every bar for stable caching.</li> <li><strong>Wait for coverage:</strong> If the status says "Loading request.security...", wait for data to finish loading.</li> <li><strong>Handle errors:</strong> "No data" means the symbol/timeframe is not available. "Lower TF must be lower" means your request TF is not smaller than the chart TF.</li> <li><strong>Multi-symbol:</strong> Use real tickers available in your datafeed. Missing symbols will error deterministically.</li> <li><strong>Nesting:</strong> Nested calls are allowed but capped at depth 6; keep nesting shallow for performance.</li></ol> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">HTF example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const htfCloseExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const htf = request.security("240", htfCloseExpr);
  plot(htf, &#123; title: "HTF Close" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">LTF example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const ltfCloseExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const ltf = request.security_lower_tf("5", ltfCloseExpr);
  plot(ltf, &#123; title: "LTF Close" &#125;);
&#125;</code></pre></div></div> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Multi-symbol example</div> <pre class="ss-code ss-code-small svelte-15ifth6"><code>// @lang js
const closeExpr = (s) =&gt; s.close;
export function onBar(ctx) &#123;
  const sym = ctx.input("Symbol", "");
  const src = sym ? request.security(sym, "240", closeExpr)
                  : request.security("240", closeExpr);
  plot(src, &#123; title: "Symbol HTF" &#125;);
&#125;</code></pre></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Common errors</div> <ul class="ss-list svelte-15ifth6"><li><code>no data</code>: symbol/timeframe not available in datafeed.</li> <li><code>must be lower</code>: LTF request is not smaller than chart TF.</li> <li><code>call limit</code>: too many <code>request.security</code> calls.</li></ul></div></div> <h3 id="js-datafeed" class="svelte-15ifth6">Datafeed Parity (Session/Timezone/Adjust)</h3> <ul class="ss-list svelte-15ifth6"><li>Symbol metadata is sourced from the datafeed when available: <code>timezone</code>, <code>session</code>, <code>sessionExtended</code>, <code>tickSize</code>, <code>lotSize</code>, <code>contractSize</code>.</li> <li>Session mode (chart-level): <code>regular</code> (default), <code>extended</code>, or <code>all</code> (24x7).</li> <li>Corporate actions: <code>adjustMode</code> can be <code>none</code>, <code>split</code>, <code>dividend</code>, or <code>all</code> (applies before scripts run).</li> <li>Advanced: chart config can set <code>options.datafeed.sessionMode</code> / <code>options.datafeed.adjustMode</code>.</li> <li>Timezone resolution: symbol timezone → session timezone → chart timezone → UTC.</li> <li>Per-call overrides: <code>request.security(..., &#123; session, timezone &#125;)</code> for alignment control.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Why it matters</div> <p>Session windows control gaps/alignments, timezone affects bucket boundaries, and adjustments keep history consistent across splits/dividends.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Defaults</div> <p><code>sessionMode: "regular"</code>, <code>adjustMode: "none"</code>. Datafeed metadata overrides apply automatically when present.</p></div></div> <h3 id="js-stdlib" class="svelte-15ifth6">Stdlib</h3> <ul class="ss-list svelte-15ifth6"><li><code>ta.*</code>: moving averages, oscillators, volatility, volume, pivots, trend tools.</li> <li><code>math.*</code>: trig/log/pow, clamp, mod/fmod, sum/avg, isfinite/isnan.</li> <li><code>color.*</code>: rgb/rgba/hsl/hsv, gradients, blend/mix, alpha + channel helpers.</li> <li><code>str.*</code>: format, replace, trim, split/join, substring, casing.</li></ul> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MA family</div> <p>sma, ema, wma, rma, vwma, dema, tema, hma, kama, alma, t3, trima, swma, evwma.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Oscillators</div> <p>rsi, stoch, stochrsi, cmo, roc, mom, tsi, ppo, trix, ao, zscore.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Volatility & ranges</div> <p>tr, atr, atrp, natr, bbands, bbw, donchian, keltner.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Trend tools</div> <p>dmi, adx, aroon, aroonosc, vortex, supertrend, sar, linreg, linreg_slope, linreg_intercept, linreg_angle.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Volume</div> <p>obv, ad, cmf, pvi, nvi.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Helpers</div> <p>sum, highest, lowest, pivot/pivot_points, pivothigh, pivotlow, rising, falling, cross, crossover, crossunder, valuewhen.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strings</div> <p>length, upper/lower, trim, contains, starts/ends, replace, split/join, substring, format.</p></div></div> <h3 id="js-api" class="svelte-15ifth6">JS API Index</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Core</div> <p><code>onInit</code>, <code>onBar</code>, <code>ctx.input</code>, <code>ctx.hist</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plots</div> <p><code>plot</code>, <code>plotshape</code>, <code>plotchar</code>, <code>plotcandle</code>, <code>plotbar</code>, <code>plotohlc</code>, <code>hline</code>, <code>fill</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw</div> <p><code>label.new</code>, <code>line.new</code>, <code>box.new</code>, <code>polyline.new</code>, <code>polygon.new</code>, <code>table.new</code>, <code>table.cell</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay</div> <p><code>overlay.new</code>, <code>overlay.set</code>, <code>overlay.set_points</code>, <code>overlay.delete</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap</div> <p><code>heatmap.new</code>, <code>heatmap.push</code>, <code>heatmap.clear</code>, <code>heatmap.set_grid</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy</div> <p><code>strategy.config</code>, <code>strategy.entry</code>, <code>strategy.exit</code>, <code>strategy.close</code>, <code>strategy.cancel</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Alerts</div> <p><code>alertcondition</code>, <code>alert</code> (rules feed the Alerts Center).</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MTF</div> <p><code>request.security</code> / <code>request.security_lower_tf</code>.</p></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Builtins</div> <p><code>ta.*</code>, <code>math.*</code>, <code>color.*</code>, <code>str.*</code>.</p></div></div> <h3 id="js-performance" class="svelte-15ifth6">Performance</h3> <ul class="ss-list svelte-15ifth6"><li>Keep loops small; avoid heavy allocations per bar.</li> <li>Reuse handles instead of recreating shapes every bar.</li> <li>Prefer heatmap for dense visuals.</li> <li>Define MTF expressions once to reduce call overhead.</li> <li>Use sub panes for large-magnitude series (equity vs size).</li> <li>WebGL is used automatically for heatmaps and can accelerate primitives.</li> <li>Rendering is coalesced per frame; redundant redraws are merged.</li> <li>For large data, limit custom loops to the visible window when possible.</li></ul> <h3 id="js-safety" class="svelte-15ifth6">Limits & Safety</h3> <ul class="ss-list svelte-15ifth6"><li>Loop iterations and per-bar runtime are capped.</li> <li>Draw ops per bar are capped (extra calls are skipped with a warning).</li> <li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> are blocked.</li> <li>Network/timers/DOM APIs are blocked.</li> <li>Diagnostics include warning vs error severity in the Issues panel.</li> <li>Plots that are all NaN/undefined emit a warning.</li> <li>Conditions accept number/boolean/string only.</li> <li>JS mode does not implement Pine syntax or semantics.</li></ul> <h3 id="js-guardrails" class="svelte-15ifth6">Guardrails (always on)</h3> <ul class="ss-list svelte-15ifth6"><li>Loop iteration caps prevent infinite loops.</li> <li>Per-bar time budget prevents UI freezes.</li> <li>Total runtime cap prevents long scripts from blocking the UI.</li> <li>Output caps limit plots and draw ops.</li> <li>Draw ops are capped per bar; extra draw calls are skipped with a warning.</li> <li>Diagnostics include warning vs error severity (non-fatal errors may still render).</li> <li>Plots that are all NaN/undefined emit a warning.</li> <li>AST-based loop guards are injected into <code>for/while/do</code> blocks.</li> <li><code>eval</code>, <code>Function</code>, <code>import</code> are blocked.</li> <li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> are blocked.</li> <li>Environment globals blocked: <code>window</code>, <code>document</code>, <code>globalThis</code>, <code>self</code>, <code>navigator</code>, <code>location</code>, <code>crypto</code>.</li> <li>Network/timer APIs blocked: <code>fetch</code>, <code>WebSocket</code>, <code>setTimeout</code>, <code>setInterval</code>.</li></ul> <h3 id="js-rules" class="svelte-15ifth6">JS Rules (Exact Behavior)</h3> <div class="ss-grid svelte-15ifth6"><div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Execution model</div> <ul class="ss-list svelte-15ifth6"><li><code>onInit</code> runs once before the first bar.</li> <li><code>onBar</code> runs oldest → newest.</li> <li>Global variables persist across bars.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Series + history</div> <ul class="ss-list svelte-15ifth6"><li>Use <code>ctx.open/high/low/close/volume/time/bar_index</code>.</li> <li><code>ctx.hist(series, n)</code> requires integer <code>n &gt;= 0</code>.</li> <li>Out-of-range returns <code>NaN</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">NaN + conditions</div> <ul class="ss-list svelte-15ifth6"><li><code>NaN</code> propagates through math.</li> <li><code>NaN</code> is false in conditions.</li> <li>Only number/boolean/string conditions allowed.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Plot + fill semantics</div> <ul class="ss-list svelte-15ifth6"><li><code>plot()</code> returns a series handle.</li> <li><code>fill(a, b)</code> accepts handles or constants.</li> <li>Calling <code>fill()</code> every bar stacks opacity; guard it when possible.</li> <li>Series used by <code>fill()</code> should be plotted every bar to avoid wedge shapes.</li> <li><code>fill()</code> supports <code>fillGradient</code> using <code>&#123; from, to, mode &#125;</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Layering</div> <ul class="ss-list svelte-15ifth6"><li>Layers: background → main → overlay → ui.</li> <li>Higher <code>zIndex</code> draws on top.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">MTF rules</div> <ul class="ss-list svelte-15ifth6"><li><code>request.security</code> / <code>request.security_lower_tf</code> (multi-symbol).</li> <li>Nested calls allowed with a depth guardrail (default 6).</li> <li>Lower TF requires datafeed coverage.</li> <li>Call limit enforced per run.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Strategy fills</div> <ul class="ss-list svelte-15ifth6"><li>Signals on bar close; fills next bar open.</li> <li>Brackets attach to entries.</li> <li>Accessors are plot-only after backtest.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw autoscale</div> <ul class="ss-list svelte-15ifth6"><li>Draw objects default to <code>includeInAutoscale: false</code>.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Draw styling</div> <ul class="ss-list svelte-15ifth6"><li>Glow supported on line/polyline/polygon.</li> <li>Polygon gradients: vertical/horizontal/radial.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Overlay templates</div> <ul class="ss-list svelte-15ifth6"><li>Points accept index/time/value fields.</li> <li>Overlay count/points are capped.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Heatmap rules</div> <ul class="ss-list svelte-15ifth6"><li>Bins in pixels; LOD scales when zoomed out.</li> <li>Points are capped; warnings on overflow.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Diagnostics</div> <ul class="ss-list svelte-15ifth6"><li>Warnings vs errors in Issues panel.</li> <li>All-NaN plots emit a warning.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Determinism + sandbox</div> <ul class="ss-list svelte-15ifth6"><li><code>Date</code>, <code>Math.random</code>, <code>performance.now</code> blocked.</li> <li>No DOM/network/timers/async APIs.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Stdlib scope</div> <ul class="ss-list svelte-15ifth6"><li>Only <code>ta.*</code>, <code>math.*</code>, <code>color.*</code> exposed.</li> <li>Strings/arrays use native JS methods.</li></ul></div> <div class="ss-card svelte-15ifth6"><div class="ss-card-title svelte-15ifth6">Compatibility</div> <ul class="ss-list svelte-15ifth6"><li>JS mode is not Pine; features not listed are undefined.</li></ul></div></div> <h3 id="js-troubleshoot" class="svelte-15ifth6">Troubleshooting</h3> <ul class="ss-list svelte-15ifth6"><li>JSON syntax error: switch editor mode to JS.</li> <li>Nothing renders: confirm <code>plot()</code> or draw APIs are called.</li> <li>Overlay invisible: use <code>&#123; index, value &#125;</code> points.</li> <li>Chart compresses: set <code>includeInAutoscale: false</code>.</li> <li>MTF errors: check timeframe string and call limits.</li> <li>Heatmap blank: ensure <code>heatmap.push</code> is called each bar.</li> <li>All NaN: add warmup guard with <code>Number.isFinite</code>.</li> <li>Plot overlap: use <code>pane: "sub"</code> for mixed magnitudes.</li> <li><code>__js_draw_stub__</code> label: draw-only scripts auto-add an invisible plot to keep the pane alive. Hide it by adding <code>plot(ctx.close, &#123; color: "rgba(0,0,0,0)", width: 0, legend: false, title: "" &#125;)</code>. Note: keep the stub if your script has only draw calls; hide it if you already plot a series or want a clean legend.</li></ul> <h3 id="js-examples" class="svelte-15ifth6">Examples to run</h3> <p class="ss-note svelte-15ifth6">Examples tab → JS Examples</p> <ul class="ss-list svelte-15ifth6"><li><strong>JS basic plot:</strong> minimal indicator baseline.</li> <li><strong>JS draw tools demo:</strong> label/line/box/table usage.</li> <li><strong>JS heatmap raster:</strong> sub-pane heatmap + EMA.</li> <li><strong>JS overlay templates:</strong> rect/fib overlays.</li> <li><strong>JS primitives (glow + gradient):</strong> WebGL primitives showcase.</li> <li><strong>JS strings + color utils:</strong> str.format + color blend/hsl helpers.</li> <li><strong>JS strategy basic/advanced/accessors:</strong> entries, exits, equity plotting.</li> <li><strong>JS MTF (HTF/LTF/multi-symbol):</strong> request.security examples.</li> <li><strong>JS plot advanced:</strong> plot types + fill + hline.</li> <li><strong>JS draw options parity:</strong> style-rich draw options.</li></ul> <h3 id="js-status" class="svelte-15ifth6">Status</h3> <p class="ss-note svelte-15ifth6">JS mode is stable for indicators, visuals, strategies, and MTF (HTF/LTF + multi-symbol).
              Ensure the datafeed covers requested symbols/timeframes and watch the Issues panel for guardrail warnings.</p></section>`),sse=be('<div class="ss-loading svelte-15ifth6">Loading examples...</div>'),nse=be('<article class="ss-example-card svelte-15ifth6"><div class="ss-example-card-head svelte-15ifth6"><div><h4 class="svelte-15ifth6"> </h4> <p class="svelte-15ifth6"> </p></div></div> <pre class="ss-code ss-code-small svelte-15ifth6"><code> </code></pre> <div class="ss-example-actions svelte-15ifth6"><button class="ss-btn svelte-15ifth6" type="button">Copy</button> <button class="ss-btn primary svelte-15ifth6" type="button">Use in Editor</button></div></article>'),ose=be('<div class="ss-empty svelte-15ifth6">No examples match your search.</div>'),ise=be('<section class="ss-section svelte-15ifth6" role="tabpanel"><div class="ss-examples-toolbar svelte-15ifth6"><div class="ss-tabs svelte-15ifth6" role="tablist" aria-label="Example formats"><button role="tab" type="button" data-examples-tab="json">JSON Examples</button> <button role="tab" type="button" data-examples-tab="dsl">DSL Examples</button> <button role="tab" type="button" data-examples-tab="pine">Pine Examples</button> <button role="tab" type="button" data-examples-tab="js">JS Examples</button></div> <input class="ss-search svelte-15ifth6" type="search" placeholder="Search examples"></div> <!> <div class="ss-examples-grid svelte-15ifth6"></div> <!></section>'),rse=be('<div class="ss-toast svelte-15ifth6" role="status"> </div>'),ase=be('<div class="ss-guide-backdrop svelte-15ifth6" role="dialog" aria-modal="true" aria-labelledby="ss-guide-title"><div class="ss-guide-modal svelte-15ifth6"><div class="ss-guide-header svelte-15ifth6"><div><h2 id="ss-guide-title" class="svelte-15ifth6">Script Studio Documentation</h2> <p class="ss-guide-subhead svelte-15ifth6">Write indicators and drawings with JSON, DSL, Pine, or JS scripts.</p></div> <button class="ss-guide-close svelte-15ifth6" type="button" aria-label="Close guide">&times;</button></div> <div class="ss-tabs svelte-15ifth6" role="tablist" aria-label="Documentation tabs"><button role="tab" type="button" data-tab="json">JSON</button> <button role="tab" type="button" data-tab="dsl">DSL</button> <button role="tab" type="button" data-tab="pine">Pine</button> <button role="tab" type="button" data-tab="js">JS</button> <button role="tab" type="button" data-tab="examples">Examples</button></div> <div class="ss-guide-body svelte-15ifth6"><!></div> <!></div></div>');function lse(s,e){Yd(e,!1);const t=bd();let n=bi(e,"show",8,!1);const o=fm();let r=bd("json"),a=bd(null),l=bd("json"),c=bd(""),f=bd(""),u=bd(!1);const d=[...dx].sort(),h=[...fx].sort(),p=[...px].sort(),v=[{id:"dsl-signal-label",title:"DSL signal + label",format:"dsl",description:"Simple series, a signal, and two labels for top/bot conditions.",code:`fast = ema(close, 10)
slow = ema(close, 20)

signal buy when (fast crossesAbove slow) score:8 cooldown:5
signal sell when (fast crossesBelow slow) score:6

label at top when (fast crossesAbove slow) text:"BUY" color:#16a34a
label at bot when (fast crossesBelow slow) text:"SELL" color:#ef4444`},{id:"dsl-fractal",title:"DSL fractal tops/bots",format:"dsl",description:"Highest/lowest window with labels at turning points.",code:`win = 5
hi = highest(close, win)
lo = lowest(close, win)

signal top when (close == hi)
signal bot when (close == lo)

label at top when (close == hi) text:"TOP" color:#f59e0b
label at bot when (close == lo) text:"BOT" color:#3b82f6`}];let x=bd({json:[],pine:[],dsl:v,js:Gte}),S=!1,C=!1,I=bd({json:!1,pine:!1,dsl:!1,js:!1}),A={json:!1,pine:!1,dsl:!0,js:!0};function P(){o("close")}function T(){i(a)&&Ng(a,i(a).scrollTop=0)}function j(Te){i(r)!==Te&&(b(r,Te),T(),Te==="examples"&&te(i(l)))}function E(Te){var Oe,Ke,kt;const Me=(Ke=(Oe=Te.target)==null?void 0:Oe.closest)==null?void 0:Ke.call(Oe,"[data-tab]"),De=(kt=Me==null?void 0:Me.dataset)==null?void 0:kt.tab;De&&j(De)}function L(Te){i(l)!==Te&&(b(l,Te),T(),te(Te))}function D(Te){var Oe,Ke,kt;const Me=(Ke=(Oe=Te.target)==null?void 0:Oe.closest)==null?void 0:Ke.call(Oe,"[data-examples-tab]"),De=(kt=Me==null?void 0:Me.dataset)==null?void 0:kt.examplesTab;De&&L(De)}function X(Te){return String(Te||"").replace(/\\r\\n/g,`
`).replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"')}async function ne(Te){const Me=X(Te);try{await navigator.clipboard.writeText(Me),de("Copied to clipboard");return}catch{}try{const De=document.createElement("textarea");De.value=Me,De.setAttribute("readonly","true"),De.style.position="absolute",De.style.left="-9999px",document.body.appendChild(De),De.select(),document.execCommand("copy"),document.body.removeChild(De),de("Copied to clipboard")}catch{de("Copy failed")}}function de(Te){b(f,Te),b(u,!0),window.clearTimeout(de._t),de._t=window.setTimeout(()=>{b(u,!1)},2e3)}async function ie(){if(S||C)return;C=!0;const Te=await Vv(()=>import("../chunks/registry.BdqBMTdh.js"),[],import.meta.url);b(x,{...i(x),json:Te.jsonExamples||[],pine:Te.pineExamples||[]}),S=!0,C=!1}async function te(Te){A[Te]||i(I)[Te]||(b(I,{...i(I),[Te]:!0}),Te!=="dsl"&&Te!=="js"&&await ie(),A={...A,[Te]:!0},b(I,{...i(I),[Te]:!1}))}function le(Te){o("insert",{code:Te.code,mode:Te.format})}const pe=O0(),[re,xe]=pe;_h(()=>(i(r),i(l)),()=>{i(r)==="examples"&&te(i(l))}),_h(()=>(i(r),i(l),i(x)),()=>{i(r)==="examples"&&i(l)==="dsl"&&b(x,{...i(x),dsl:v})}),_h(()=>(i(x),i(l),i(c)),()=>{b(t,(()=>{const Te=i(x)[i(l)]||[],Me=i(c).trim().toLowerCase();return Me?Te.filter(De=>`${De.title} ${De.description}`.toLowerCase().includes(Me)):Te})())}),c0(),$m();var se=Qs(),Ne=_s(se);Ve(Ne,n,Te=>{var Me=ase(),De=y(Me),Oe=y(De),Ke=m(y(Oe),2);_(Oe);var kt=m(Oe,2),pt=y(kt),Rt=m(pt,2),Ht=m(Rt,2),Ft=m(Ht,2),zt=m(Ft,2);_(kt);var ut=m(kt,2),nt=y(ut);Ve(nt,()=>i(r)==="json",it=>{var ze=Jte(),Ge=y(ze),xt=y(Ge);we(()=>Dt(xt,"href",re("#json-what",void 0)));var jt=m(xt,2);we(()=>Dt(jt,"href",re("#json-quick",void 0)));var ft=m(jt,2);we(()=>Dt(ft,"href",re("#json-core",void 0)));var ke=m(ft,2);we(()=>Dt(ke,"href",re("#json-supported",void 0)));var Se=m(ke,2);we(()=>Dt(Se,"href",re("#json-limits",void 0)));var Et=m(Se,2);we(()=>Dt(Et,"href",re("#json-mistakes",void 0)));var wt=m(Et,2);we(()=>Dt(wt,"href",re("#json-mini",void 0))),_(Ge);var Ls=m(Ge,16),tn=y(Ls),Gs=m(y(tn),2);qo(Gs,5,()=>d,yi,(po,Tn)=>{var Cn=Yte(),go=y(Cn,!0);_(Cn),we(()=>st(go,i(Tn))),Y(po,Cn)}),_(Gs),_(tn);var an=m(tn,2),Es=m(y(an),2);qo(Es,5,()=>h,yi,(po,Tn)=>{var Cn=Kte(),go=y(Cn,!0);_(Cn),we(()=>st(go,i(Tn))),Y(po,Cn)}),_(Es),_(an);var Ns=m(an,2),Hs=m(y(Ns),2);qo(Hs,5,()=>p,yi,(po,Tn)=>{var Cn=Xte(),go=y(Cn,!0);_(Cn),we(()=>st(go,i(Tn))),Y(po,Cn)}),_(Hs),_(Ns),_(Ls);var ns=m(Ls,14),fs=m(y(ns),2),Mn=m(y(fs),2);qo(Mn,5,()=>Object.keys(FS),yi,(po,Tn)=>{var Cn=Zte(),go=y(Cn,!0);_(Cn),we(()=>st(go,i(Tn))),Y(po,Cn)}),_(Mn),Oi(4),_(fs),_(ns),_(ze),Y(it,ze)},it=>{var ze=Qs(),Ge=_s(ze);Ve(Ge,()=>i(r)==="dsl",xt=>{var jt=Qte(),ft=y(jt),ke=y(ft);we(()=>Dt(ke,"href",re("#dsl-what",void 0)));var Se=m(ke,2);we(()=>Dt(Se,"href",re("#dsl-quick",void 0)));var Et=m(Se,2);we(()=>Dt(Et,"href",re("#dsl-core",void 0)));var wt=m(Et,2);we(()=>Dt(wt,"href",re("#dsl-supported",void 0)));var Ls=m(wt,2);we(()=>Dt(Ls,"href",re("#dsl-limits",void 0)));var tn=m(Ls,2);we(()=>Dt(tn,"href",re("#dsl-mistakes",void 0)));var Gs=m(tn,2);we(()=>Dt(Gs,"href",re("#dsl-mini",void 0))),_(ft),Oi(28),_(jt),Y(xt,jt)},xt=>{var jt=Qs(),ft=_s(jt);Ve(ft,()=>i(r)==="pine",ke=>{var Se=ese(),Et=y(Se),wt=y(Et);we(()=>Dt(wt,"href",re("#pine-what",void 0)));var Ls=m(wt,2);we(()=>Dt(Ls,"href",re("#pine-quick",void 0)));var tn=m(Ls,2);we(()=>Dt(tn,"href",re("#pine-core",void 0)));var Gs=m(tn,2);we(()=>Dt(Gs,"href",re("#pine-supported",void 0)));var an=m(Gs,2);we(()=>Dt(an,"href",re("#pine-changelog",void 0)));var Es=m(an,2);we(()=>Dt(Es,"href",re("#pine-howto",void 0)));var Ns=m(Es,2);we(()=>Dt(Ns,"href",re("#pine-session",void 0)));var Hs=m(Ns,2);we(()=>Dt(Hs,"href",re("#pine-request-security",void 0)));var ns=m(Hs,2);we(()=>Dt(ns,"href",re("#pine-not-supported",void 0)));var fs=m(ns,2);we(()=>Dt(fs,"href",re("#pine-limits",void 0)));var Mn=m(fs,2);we(()=>Dt(Mn,"href",re("#pine-mistakes",void 0)));var po=m(Mn,2);we(()=>Dt(po,"href",re("#pine-mini",void 0))),_(Et),Oi(146),_(Se),Y(ke,Se)},ke=>{var Se=Qs(),Et=_s(Se);Ve(Et,()=>i(r)==="js",wt=>{var Ls=tse(),tn=y(Ls),Gs=y(tn);we(()=>Dt(Gs,"href",re("#js-start",void 0)));var an=m(Gs,2);we(()=>Dt(an,"href",re("#js-index",void 0)));var Es=m(an,2);we(()=>Dt(Es,"href",re("#js-recipes",void 0)));var Ns=m(Es,2);we(()=>Dt(Ns,"href",re("#js-playbook",void 0)));var Hs=m(Ns,2);we(()=>Dt(Hs,"href",re("#js-support",void 0)));var ns=m(Hs,2);we(()=>Dt(ns,"href",re("#js-structure",void 0)));var fs=m(ns,2);we(()=>Dt(fs,"href",re("#js-data",void 0)));var Mn=m(fs,2);we(()=>Dt(Mn,"href",re("#js-history",void 0)));var po=m(Mn,2);we(()=>Dt(po,"href",re("#js-plots",void 0)));var Tn=m(po,2);we(()=>Dt(Tn,"href",re("#js-gradient",void 0)));var Cn=m(Tn,2);we(()=>Dt(Cn,"href",re("#js-pane-scaling",void 0)));var go=m(Cn,2);we(()=>Dt(go,"href",re("#js-autoscale",void 0)));var no=m(go,2);we(()=>Dt(no,"href",re("#js-draw",void 0)));var Bo=m(no,2);we(()=>Dt(Bo,"href",re("#js-polyline-polygon",void 0)));var Vo=m(Bo,2);we(()=>Dt(Vo,"href",re("#js-overlays",void 0)));var Rl=m(Vo,2);we(()=>Dt(Rl,"href",re("#js-interaction",void 0)));var aa=m(Rl,2);we(()=>Dt(aa,"href",re("#js-heatmap",void 0)));var tl=m(aa,2);we(()=>Dt(tl,"href",re("#js-webgl",void 0)));var Zr=m(tl,2);we(()=>Dt(Zr,"href",re("#js-strategy",void 0)));var zi=m(Zr,2);we(()=>Dt(zi,"href",re("#js-alerts",void 0)));var Nl=m(zi,2);we(()=>Dt(Nl,"href",re("#js-mtf",void 0)));var mu=m(Nl,2);we(()=>Dt(mu,"href",re("#js-datafeed",void 0)));var Gc=m(mu,2);we(()=>Dt(Gc,"href",re("#js-stdlib",void 0)));var du=m(Gc,2);we(()=>Dt(du,"href",re("#js-api",void 0)));var Ju=m(du,2);we(()=>Dt(Ju,"href",re("#js-performance",void 0)));var rd=m(Ju,2);we(()=>Dt(rd,"href",re("#js-safety",void 0)));var Al=m(rd,2);we(()=>Dt(Al,"href",re("#js-guardrails",void 0)));var sa=m(Al,2);we(()=>Dt(sa,"href",re("#js-rules",void 0)));var Vc=m(sa,2);we(()=>Dt(Vc,"href",re("#js-troubleshoot",void 0)));var vu=m(Vc,2);we(()=>Dt(vu,"href",re("#js-examples",void 0)));var Qc=m(vu,2);we(()=>Dt(Qc,"href",re("#js-status",void 0))),_(tn);var To=m(tn,10),ec=y(To),yl=m(y(ec)),Dc=m(y(yl),3),jl=m(y(Dc)),qi=y(jl);we(()=>Dt(qi,"href",re("#js-polyline-polygon",void 0))),_(jl),Oi(),_(Dc),Oi(5),_(yl),_(ec),_(To),Oi(186),_(Ls),Y(wt,Ls)},wt=>{var Ls=Qs(),tn=_s(Ls);Ve(tn,()=>i(r)==="examples",Gs=>{var an=ise(),Es=y(an),Ns=y(Es),Hs=y(Ns),ns=m(Hs,2),fs=m(ns,2),Mn=m(fs,2);_(Ns);var po=m(Ns,2);Ts(po),_(Es);var Tn=m(Es,2);Ve(Tn,()=>i(I)[i(l)]&&!i(x)[i(l)].length,no=>{var Bo=sse();Y(no,Bo)});var Cn=m(Tn,2);qo(Cn,5,()=>i(t),yi,(no,Bo)=>{var Vo=nse(),Rl=y(Vo),aa=y(Rl),tl=y(aa),Zr=y(tl,!0);_(tl);var zi=m(tl,2),Nl=y(zi,!0);_(zi),_(aa),_(Rl);var mu=m(Rl,2),Gc=y(mu),du=y(Gc,!0);_(Gc),_(mu);var Ju=m(mu,2),rd=y(Ju),Al=m(rd,2);_(Ju),_(Vo),we(()=>{st(Zr,i(Bo).title),st(Nl,i(Bo).description),st(du,i(Bo).code)}),pd("click",rd,()=>ne(i(Bo).code)),pd("click",Al,()=>le(i(Bo))),Y(no,Vo)}),_(Cn);var go=m(Cn,2);Ve(go,()=>!i(t).length&&!i(I)[i(l)],no=>{var Bo=ose();Y(no,Bo)}),_(an),we(()=>{$i(Hs,`ss-tab ${(i(l)==="json"?"active":"")??""} svelte-15ifth6`),Dt(Hs,"aria-selected",i(l)==="json"),$i(ns,`ss-tab ${(i(l)==="dsl"?"active":"")??""} svelte-15ifth6`),Dt(ns,"aria-selected",i(l)==="dsl"),$i(fs,`ss-tab ${(i(l)==="pine"?"active":"")??""} svelte-15ifth6`),Dt(fs,"aria-selected",i(l)==="pine"),$i(Mn,`ss-tab ${(i(l)==="js"?"active":"")??""} svelte-15ifth6`),Dt(Mn,"aria-selected",i(l)==="js")}),pd("click",Ns,D),Fn(po,()=>i(c),no=>b(c,no)),Y(Gs,an)},null,!0),Y(wt,Ls)},!0),Y(ke,Se)},!0),Y(xt,jt)},!0),Y(it,ze)}),_(ut),hp(ut,it=>b(a,it),()=>i(a));var Je=m(ut,2);Ve(Je,()=>i(u),it=>{var ze=rse(),Ge=y(ze,!0);_(ze),we(()=>st(Ge,i(f))),Y(it,ze)}),_(De),_(Me),we(()=>{$i(pt,`ss-tab ${(i(r)==="json"?"active":"")??""} svelte-15ifth6`),Dt(pt,"aria-selected",i(r)==="json"),$i(Rt,`ss-tab ${(i(r)==="dsl"?"active":"")??""} svelte-15ifth6`),Dt(Rt,"aria-selected",i(r)==="dsl"),$i(Ht,`ss-tab ${(i(r)==="pine"?"active":"")??""} svelte-15ifth6`),Dt(Ht,"aria-selected",i(r)==="pine"),$i(Ft,`ss-tab ${(i(r)==="js"?"active":"")??""} svelte-15ifth6`),Dt(Ft,"aria-selected",i(r)==="js"),$i(zt,`ss-tab ${(i(r)==="examples"?"active":"")??""} svelte-15ifth6`),Dt(zt,"aria-selected",i(r)==="examples")}),pd("click",Ke,P),pd("click",kt,E),pd("click",Me,it=>{it.target===it.currentTarget&&P()}),Y(Te,Me)}),Y(s,se),Kd()}const cse={signals:new Set,label:new Set};function w6(s,e){cse[s].forEach(t=>{try{t(e)}catch{}})}const H1=Th({});function use(s,e){H1.update(t=>({...t,[s]:e}))}function dse(s){return vh(H1)[s]||[]}const fse=H1;function pse(s){H1.update(e=>{const{[s]:t,...n}=e;return n})}function hse(){H1.set({})}class mse{constructor(e,t,n,o){Pe(this,"gl");Pe(this,"width");Pe(this,"height");Pe(this,"padding");Pe(this,"texture");Pe(this,"cursorX",0);Pe(this,"cursorY",0);Pe(this,"rowHeight",0);this.gl=e,this.width=Math.max(1,Math.floor(t)),this.height=Math.max(1,Math.floor(n)),this.padding=Math.max(0,Math.floor((o==null?void 0:o.padding)??1));const r=e.createTexture();if(!r)throw new Error("Failed to create WebGL texture.");this.texture=r,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=(o==null?void 0:o.filter)??e.LINEAR;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null)}bind(e=0){const t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}allocate(e,t){const n=Math.max(1,Math.floor(e)),o=Math.max(1,Math.floor(t)),r=n+this.padding*2,a=o+this.padding*2;if(r>this.width||a>this.height||(this.cursorX+r>this.width&&(this.cursorX=0,this.cursorY+=this.rowHeight,this.rowHeight=0),this.cursorY+a>this.height))return null;const l=this.cursorX+this.padding,c=this.cursorY+this.padding;this.cursorX+=r,this.rowHeight=Math.max(this.rowHeight,a);const f=l/this.width,u=c/this.height,d=(l+n)/this.width,h=(c+o)/this.height;return{x:l,y:c,width:n,height:o,u0:f,v0:u,u1:d,v1:h}}update(e,t){const n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texSubImage2D(n.TEXTURE_2D,0,e.x,e.y,n.RGBA,n.UNSIGNED_BYTE,t)}destroy(){this.gl.deleteTexture(this.texture)}}const vse={alpha:!0,antialias:!0,depth:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!0,powerPreference:"high-performance"},k6=(s,e,t)=>{const n=s.createShader(e);if(!n)return null;if(s.shaderSource(n,t),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){const o=s.getShaderInfoLog(n);return s.deleteShader(n),console.warn("[WebGL] Shader compile failed:",o),null}return n},gse=(s,e)=>{const t=k6(s,s.VERTEX_SHADER,e.vertex),n=k6(s,s.FRAGMENT_SHADER,e.fragment);if(!t||!n)return null;const o=s.createProgram();if(!o)return null;if(s.attachShader(o,t),s.attachShader(o,n),s.linkProgram(o),s.deleteShader(t),s.deleteShader(n),!s.getProgramParameter(o,s.LINK_STATUS)){const r=s.getProgramInfoLog(o);return s.deleteProgram(o),console.warn("[WebGL] Program link failed:",r),null}return o},_se=(s,e)=>{const t={...vse},n=s.getContext("webgl2",t),o=!n&&s.getContext("webgl",t),r=n||o,a=n?"webgl2":o?"webgl1":"canvas",l=r?null:s.getContext("2d"),c=new Map,f=new Map,u=new Map;return{mode:a,canvas:s,gl:r??void 0,ctx2d:l,isWebgl:!!r,isWebgl2:!!n,resize:(h,p,v)=>{const x=Math.max(1,Math.floor(h*v)),S=Math.max(1,Math.floor(p*v));s.width=x,s.height=S,s.style.width=`${h}px`,s.style.height=`${p}px`,r?r.viewport(0,0,x,S):l&&l.setTransform(v,0,0,v,0,0)},getProgram:(h,p)=>{if(!r)return null;const v=p.version?`@${p.version}`:"",x=`${h}${v}`,S=c.get(x);if(S)return S;const C=gse(r,p);if(!C)return null;const I=new Map,A=new Map;Array.isArray(p.attributes)&&p.attributes.forEach(T=>{I.set(T,r.getAttribLocation(C,T))}),Array.isArray(p.uniforms)&&p.uniforms.forEach(T=>{A.set(T,r.getUniformLocation(C,T))});const P={key:x,program:C,attributes:I,uniforms:A};return c.set(x,P),P},getBuffer:(h,p)=>{if(!r)return null;const v=`${h}:${p??r.ARRAY_BUFFER}`,x=f.get(v);if(x)return x;const S=r.createBuffer();if(!S)return null;const C={key:v,buffer:S,target:p??r.ARRAY_BUFFER};return f.set(v,C),C},createTextureAtlas:(h,p,v)=>{if(!r)return null;const x=u.get(h);if(x)return x;const S=new mse(r,p,v);return u.set(h,S),S},destroy:()=>{if(r){for(const h of c.values())r.deleteProgram(h.program);for(const h of f.values())r.deleteBuffer(h.buffer);for(const h of u.values())h.destroy()}c.clear(),f.clear(),u.clear()}}},S6=[{stop:0,color:"#0b1020"},{stop:.25,color:"#1e4fd8"},{stop:.5,color:"#22c55e"},{stop:.75,color:"#f59e0b"},{stop:1,color:"#ef4444"}],C6=25e4,x4=1e6,C2=256,I6=256,P6=512,M6=32,N6=512,w4=s=>Math.max(0,Math.min(1,s)),yse=s=>{const e=s.replace("#","").trim();if(e.length===3){const t=parseInt(e[0]+e[0],16),n=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16);return[t,n,o,255]}if(e.length===6||e.length===8){const t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),r=e.length===8?parseInt(e.slice(6,8),16):255;return[t,n,o,r]}return null},bse=s=>{const e=s.trim().match(/rgba?\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*(?:,\s*([0-9.]+)\s*)?\)/i);if(!e)return null;const t=Number(e[1]),n=Number(e[2]),o=Number(e[3]),r=e[4],a=r==null?1:Number(r);return[t,n,o,a].every(l=>Number.isFinite(l))?[Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,n)),Math.max(0,Math.min(255,o)),Math.max(0,Math.min(255,Math.round(a*255)))]:null},xse=s=>{if(!s)return[255,255,255,255];const e=String(s).trim();if(!e)return[255,255,255,255];if(e.startsWith("#")){const t=yse(e);if(t)return t}if(e.startsWith("rgb")){const t=bse(e);if(t)return t}return[255,255,255,255]},A6=s=>{const e=new Uint8Array(1024),t=s.map(o=>({stop:w4(Number(o.stop)),color:xse(o.color)})).sort((o,r)=>o.stop-r.stop),n=o=>{if(!t.length)return[255,255,255,255];if(o<=t[0].stop)return t[0].color;if(o>=t[t.length-1].stop)return t[t.length-1].color;for(let r=0;r+1<t.length;r++){const a=t[r],l=t[r+1];if(o>=a.stop&&o<=l.stop){const c=l.stop-a.stop||1,f=(o-a.stop)/c,u=Math.round(a.color[0]+(l.color[0]-a.color[0])*f),d=Math.round(a.color[1]+(l.color[1]-a.color[1])*f),h=Math.round(a.color[2]+(l.color[2]-a.color[2])*f),p=Math.round(a.color[3]+(l.color[3]-a.color[3])*f);return[u,d,h,p]}}return t[t.length-1].color};for(let o=0;o<256;o++){const r=o/255,[a,l,c,f]=n(r),u=o*4;e[u]=a,e[u+1]=l,e[u+2]=c,e[u+3]=f}return e},k4=(s,e,t,n)=>{let o=Math.max(1,e),r=Math.max(1,t),a=Math.max(1,Math.floor(s.width/o)),l=Math.max(1,Math.floor(s.height/r)),c=a*l;if(c>n){const f=Math.sqrt(c/n);o=Math.max(1,Math.floor(o*f)),r=Math.max(1,Math.floor(r*f)),a=Math.max(1,Math.floor(s.width/o)),l=Math.max(1,Math.floor(s.height/r)),c=a*l}return{xBins:a,yBins:l,binX:o,binY:r}},wse=(s,e,t)=>{const n=Math.max(1,e),o=Math.max(1,t),r=Math.max(1,Math.floor(s.width/n)),a=Math.max(1,Math.floor(s.height/o)),l=r*a;let c=1;if(l>C6){const d=Math.sqrt(l/C6),h=Math.pow(2,Math.floor(Math.log2(d)));c=Math.max(1,h)}const f=Math.max(1,Math.floor(n*c)),u=Math.max(1,Math.floor(o*c));return k4(s,f,u,x4)},kse=s=>{let e=C2,t=Math.ceil(s.width/e),n=Math.ceil(s.height/e),o=t*n;if(o>I6){const r=Math.ceil(Math.sqrt(o/I6));e=Math.max(C2,C2*r),t=Math.ceil(s.width/e),n=Math.ceil(s.height/e),o=t*n}return{tileSize:e,cols:t,rows:n}},Sse=(s,e,t,n,o)=>{const{xBins:r,yBins:a,binX:l,binY:c}=k4(e,t,n,x4),f=r*a,u=new Float32Array(f),d=new Uint32Array(f);if(o==="max")for(let x=0;x<f;x++)u[x]=-1/0;else if(o==="min")for(let x=0;x<f;x++)u[x]=1/0;for(const x of s){const S=x.x-e.left,C=x.y-e.top;if(S<0||C<0||S>=e.width||C>=e.height)continue;const I=Math.floor(S/l),A=Math.floor(C/c);if(I<0||A<0||I>=r||A>=a)continue;const P=A*r+I,T=x.value;Number.isFinite(T)&&(o==="max"?u[P]=Math.max(u[P],T):o==="min"?u[P]=Math.min(u[P],T):u[P]+=T,d[P]+=1)}if(o==="avg")for(let x=0;x<f;x++){const S=d[x];u[x]=S>0?u[x]/S:0}let h=1/0,p=-1/0;for(let x=0;x<f;x++){if(!d[x])continue;const S=u[x];Number.isFinite(S)&&(h=Math.min(h,S),p=Math.max(p,S))}const v=new Uint8Array(f);for(let x=0;x<f;x++)d[x]&&(v[x]=1);return{width:r,height:a,accum:u,mask:v,min:h,max:p}},Cse=(s,e,t,n)=>{const o=s.width*s.height*4,r=n&&n.length===o?n:new Uint8Array(o),a=Number.isFinite(e)?e:0;let l=Number.isFinite(t)?t:a+1;a===l&&(l=a+1);const c=l-a||1;for(let f=0;f<s.accum.length;f++){const u=s.accum[f],d=s.mask[f]===1,h=Number.isFinite(u)?w4((u-a)/c):0,p=Math.round(h*255),v=f*4;r[v]=p,r[v+1]=0,r[v+2]=0,r[v+3]=d?255:0}return r};class Ise{constructor(e){Pe(this,"runtime");Pe(this,"program",null);Pe(this,"quadBuffer",null);Pe(this,"dataTextures",new Map);Pe(this,"colormapCache",new Map);Pe(this,"tileCache",new Map);Pe(this,"cacheTick",0);Pe(this,"canvasFallback",null);this.runtime=e}ensureProgram(e){if(this.program)return;const t=`
      attribute vec2 a_pos;
      void main() {
        gl_Position = vec4(a_pos, 0.0, 1.0);
      }
    `,n=`
      precision mediump float;
      uniform sampler2D u_data;
      uniform sampler2D u_colormap;
      uniform vec4 u_bounds;
      uniform vec2 u_canvas;
      uniform float u_opacity;
      void main() {
        vec2 frag = vec2(gl_FragCoord.x, u_canvas.y - gl_FragCoord.y);
        vec2 pos = frag - u_bounds.xy;
        if (pos.x < 0.0 || pos.y < 0.0 || pos.x > u_bounds.z || pos.y > u_bounds.w) {
          discard;
        }
        vec2 uv = vec2(pos.x / u_bounds.z, pos.y / u_bounds.w);
        vec4 data = texture2D(u_data, uv);
        float v = data.r;
        float m = data.a;
        vec4 c = texture2D(u_colormap, vec2(v, 0.5));
        gl_FragColor = vec4(c.rgb, c.a * u_opacity * m);
      }
    `,o=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);if(!o||!r||(e.shaderSource(o,t),e.shaderSource(r,n),e.compileShader(o),e.compileShader(r),!e.getShaderParameter(o,e.COMPILE_STATUS))||!e.getShaderParameter(r,e.COMPILE_STATUS))return;const a=e.createProgram();a&&(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.deleteShader(o),e.deleteShader(r),e.getProgramParameter(a,e.LINK_STATUS)&&(this.program=a))}ensureQuadBuffer(e){if(this.quadBuffer)return;const t=e.createBuffer();if(!t)return;e.bindBuffer(e.ARRAY_BUFFER,t);const n=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),this.quadBuffer=t}getColormapTexture(e,t){const n=JSON.stringify(t),o=this.colormapCache.get(n);if(o)return o;const r=e.createTexture();if(!r)return null;e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const a=A6(t);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,256,1,0,e.RGBA,e.UNSIGNED_BYTE,a),this.colormapCache.set(n,r),r}getDataTexture(e,t,n,o,r,a){const l=this.dataTextures.get(t);if(l&&l.width===n&&l.height===o&&l.version===r)return l.lastUsed=a,l.texture;const c=(l==null?void 0:l.texture)??e.createTexture();return c?(e.bindTexture(e.TEXTURE_2D,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),this.dataTextures.set(t,{texture:c,width:n,height:o,version:r,lastUsed:a}),c):null}getSpecCache(e,t){let n=this.tileCache.get(e);return n||(n={tiles:new Map,lastUsed:t},this.tileCache.set(e,n)),n.lastUsed=t,n}pruneCaches(){if(this.tileCache.size>M6){const t=Array.from(this.tileCache.entries()).sort((o,r)=>o[1].lastUsed-r[1].lastUsed),n=this.tileCache.size-M6;for(let o=0;o<n;o++)this.tileCache.delete(t[o][0])}let e=0;if(this.tileCache.forEach(t=>{e+=t.tiles.size}),e>P6){const t=[];this.tileCache.forEach((o,r)=>{o.tiles.forEach((a,l)=>{t.push([r,l,a])})}),t.sort((o,r)=>o[2].lastUsed-r[2].lastUsed);const n=e-P6;for(let o=0;o<n;o++){const[r,a]=t[o],l=this.tileCache.get(r);l==null||l.tiles.delete(a)}}if(this.dataTextures.size>N6){const t=Array.from(this.dataTextures.entries()).sort((o,r)=>o[1].lastUsed-r[1].lastUsed),n=this.dataTextures.size-N6;for(let o=0;o<n;o++){const r=t[o];if(!r)continue;const a=r[1].texture;this.runtime.gl&&this.runtime.gl.deleteTexture(a),this.dataTextures.delete(r[0])}}}buildTiles(e,t){const n=e.bounds,o=e.xBinPx??3,r=e.yBinPx??3,a=e.agg??"sum",l=wse(n,o,r),{tileSize:c,cols:f,rows:u}=kse(n),d=new Array(f*u);for(const I of e.points){const A=I.x-n.left,P=I.y-n.top;if(A<0||P<0||A>=n.width||P>=n.height)continue;const T=Math.floor(A/c),j=Math.floor(P/c);if(T<0||j<0||T>=f||j>=u)continue;const E=j*f+T;d[E]||(d[E]=[]),d[E].push(I)}const h=e.viewKey??"",p=`${e.id}:${e.version??0}:${h}:${l.binX}:${l.binY}:${a}`,v=this.getSpecCache(p,t),x=[];for(let I=0;I<u;I++)for(let A=0;A<f;A++){const P=I*f+A,T=d[P];if(!T||!T.length)continue;const j=n.left+A*c,E=n.top+I*c,L=Math.min(c,n.width-A*c),D=Math.min(c,n.height-I*c),X={left:j,top:E,width:L,height:D},ne=`${A}:${I}:${L}:${D}`;let de=v.tiles.get(ne);if(de)de.lastUsed=t;else{const ie=Sse(T,X,l.binX,l.binY,a);de={grid:ie,encoded:new Uint8Array(ie.width*ie.height*4),min:NaN,max:NaN,lastUsed:t},v.tiles.set(ne,de)}x.push({key:ne,bounds:X,grid:de.grid,encoded:de.encoded,min:de.min,max:de.max})}let S=Number.isFinite(e.minValue)?e.minValue:1/0,C=Number.isFinite(e.maxValue)?e.maxValue:-1/0;if(!Number.isFinite(e.minValue)||!Number.isFinite(e.maxValue))for(const I of x)Number.isFinite(e.minValue)||(S=Math.min(S,I.grid.min)),Number.isFinite(e.maxValue)||(C=Math.max(C,I.grid.max));Number.isFinite(S)||(S=0),Number.isFinite(C)||(C=S+1),S===C&&(C=S+1);for(const I of x)if(I.min!==S||I.max!==C){I.encoded=Cse(I.grid,S,C,I.encoded),I.min=S,I.max=C;const A=v.tiles.get(I.key);A&&(A.encoded=I.encoded,A.min=S,A.max=C)}return x.map(I=>({key:I.key,bounds:I.bounds,encoded:I.encoded,width:I.grid.width,height:I.grid.height}))}clear(){const e=this.runtime.gl;if(!e){const t=this.runtime.ctx2d;t&&t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);return}e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}render(e,t){this.cacheTick+=1;const n=this.cacheTick;if(!e.length){(t==null?void 0:t.clear)!==!1&&this.clear(),this.pruneCaches();return}const o=this.runtime,r=o.gl;if(!r){this.renderCanvas(e),this.pruneCaches();return}const a=o.canvas.clientWidth||o.canvas.width||1,l=o.canvas.clientHeight||o.canvas.height||1,c=o.canvas.width/a,f=o.canvas.height/l;if((t==null?void 0:t.clear)!==!1&&(r.disable(r.SCISSOR_TEST),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)),this.ensureProgram(r),this.ensureQuadBuffer(r),!this.program||!this.quadBuffer)return;r.useProgram(this.program),r.bindBuffer(r.ARRAY_BUFFER,this.quadBuffer);const u=r.getAttribLocation(this.program,"a_pos");r.enableVertexAttribArray(u),r.vertexAttribPointer(u,2,r.FLOAT,!1,0,0);const d=r.getUniformLocation(this.program,"u_data"),h=r.getUniformLocation(this.program,"u_colormap"),p=r.getUniformLocation(this.program,"u_bounds"),v=r.getUniformLocation(this.program,"u_canvas"),x=r.getUniformLocation(this.program,"u_opacity");r.uniform2f(v,o.canvas.width,o.canvas.height),r.enable(r.BLEND),r.disable(r.DEPTH_TEST),r.enable(r.SCISSOR_TEST);for(const S of e)for(const C of S.heatmaps){const I=this.buildTiles(C,n);if(!I.length)continue;const A=C.colormap&&C.colormap.length?C.colormap:S6,P=this.getColormapTexture(r,A);if(!P)continue;const T=Number.isFinite(C.opacity)?Math.max(0,Math.min(1,C.opacity)):1;r.uniform1f(x,T),C.blend==="add"?r.blendFunc(r.SRC_ALPHA,r.ONE):C.blend==="screen"?r.blendFunc(r.ONE,r.ONE_MINUS_SRC_COLOR):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(const j of I){const E=`${C.id}:${j.key}`,L=this.getDataTexture(r,E,j.width,j.height,C.version??0,n);if(!L)continue;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,L),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,j.width,j.height,0,r.RGBA,r.UNSIGNED_BYTE,j.encoded),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,P),r.uniform1i(d,0),r.uniform1i(h,1);const D=j.bounds.left*c,X=j.bounds.top*f,ne=j.bounds.width*c,de=j.bounds.height*f;r.uniform4f(p,D,X,ne,de);const ie=Math.round(D),te=Math.round(o.canvas.height-(X+de)),le=Math.round(ne),pe=Math.round(de);r.scissor(ie,te,le,pe),r.drawArrays(r.TRIANGLES,0,6)}}r.disable(r.SCISSOR_TEST),this.pruneCaches()}renderCanvas(e){const t=this.runtime.ctx2d;if(t){t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);for(const n of e)for(const o of n.heatmaps){const r=o.colormap&&o.colormap.length?o.colormap:S6,a=A6(r),l=this.buildTiles(o,this.cacheTick);if(l.length)for(const c of l){const f=t.createImageData(c.width,c.height);for(let p=0;p<c.width*c.height;p++){const v=p*4,S=c.encoded[v]*4;f.data[v]=a[S],f.data[v+1]=a[S+1],f.data[v+2]=a[S+2];const C=c.encoded[v+3]/255;f.data[v+3]=Math.round(a[S+3]*C)}this.canvasFallback||(this.canvasFallback=document.createElement("canvas"));const u=this.canvasFallback;u.width=c.width,u.height=c.height;const d=u.getContext("2d");if(!d)continue;d.putImageData(f,0,0);const h=Number.isFinite(o.opacity)?Math.max(0,Math.min(1,o.opacity)):1;t.save(),t.globalAlpha=h,t.drawImage(u,c.bounds.left,c.bounds.top,c.bounds.width,c.bounds.height),t.restore()}}this.pruneCaches()}}destroy(){const e=this.runtime.gl;e&&this.program&&e.deleteProgram(this.program),e&&this.quadBuffer&&e.deleteBuffer(this.quadBuffer);for(const t of this.dataTextures.values())e&&e.deleteTexture(t.texture);for(const t of this.colormapCache.values())e&&e.deleteTexture(t);this.dataTextures.clear(),this.colormapCache.clear(),this.tileCache.clear(),this.program=null,this.quadBuffer=null,this.canvasFallback=null}}const Vy=s=>Math.max(0,Math.min(1,s)),by=(s,e,t)=>s+(e-s)*t,Pse=(s,e,t)=>[by(s[0],e[0],t),by(s[1],e[1],t),by(s[2],e[2],t),by(s[3],e[3],t)],Mse=s=>{const e=s.replace("#","").trim();if(e.length===3){const t=parseInt(e[0]+e[0],16),n=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16);return[t,n,o,255]}if(e.length===6||e.length===8){const t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),r=e.length===8?parseInt(e.slice(6,8),16):255;return[t,n,o,r]}return null},Nse=s=>{const e=s.trim().match(/rgba?\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*(?:,\s*([0-9.]+)\s*)?\)/i);if(!e)return null;const t=Number(e[1]),n=Number(e[2]),o=Number(e[3]),r=e[4],a=r==null?1:Number(r);return[t,n,o,a].every(l=>Number.isFinite(l))?[Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,n)),Math.max(0,Math.min(255,o)),Math.max(0,Math.min(255,Math.round(a*255)))]:null},r_=s=>{if(!s)return[1,1,1,1];const e=String(s).trim();if(!e)return[1,1,1,1];if(e.startsWith("#")){const t=Mse(e);if(t)return[t[0]/255,t[1]/255,t[2]/255,t[3]/255]}if(e.startsWith("rgb")){const t=Nse(e);if(t)return[t[0]/255,t[1]/255,t[2]/255,t[3]/255]}return[1,1,1,1]},S4=s=>{const e=s.length;if(e<3)return[];const t=Array.from({length:e},(f,u)=>u),n=[],r=(()=>{let f=0;for(let u=0;u<e;u++){const d=s[u],h=s[(u+1)%e];f+=(h.x-d.x)*(h.y+d.y)}return f})()>0?1:-1,a=(f,u,d)=>{const h=s[f],p=s[u],v=s[d],x=(p.x-h.x)*(v.y-h.y)-(p.y-h.y)*(v.x-h.x);return r*x<0},l=(f,u,d,h)=>{const p=h.x-u.x,v=h.y-u.y,x=d.x-u.x,S=d.y-u.y,C=f.x-u.x,I=f.y-u.y,A=p*p+v*v,P=p*x+v*S,T=p*C+v*I,j=x*x+S*S,E=x*C+S*I,L=1/(A*j-P*P||1),D=(j*T-P*E)*L,X=(A*E-P*T)*L;return D>=0&&X>=0&&D+X<=1};let c=0;for(;t.length>3&&c<1e4;){c+=1;let f=!1;for(let u=0;u<t.length;u++){const d=t[(u-1+t.length)%t.length],h=t[u],p=t[(u+1)%t.length];if(!a(d,h,p))continue;const v=s[d],x=s[h],S=s[p];let C=!1;for(let I=0;I<t.length;I++){const A=t[I];if(!(A===d||A===h||A===p)&&l(s[A],v,x,S)){C=!0;break}}if(!C){n.push(d,h,p),t.splice(u,1),f=!0;break}}if(!f)break}if(t.length===3&&n.push(t[0],t[1],t[2]),!n.length)for(let f=1;f+1<e;f++)n.push(0,f,f+1);return n},S_=(s,e)=>{const t=[];if(s.length<2)return t;const n=e.toLowerCase(),o=n==="dashed"?[6,4]:n==="dotted"?[2,2]:null;if(!o){for(let l=0;l+1<s.length;l++)t.push({a:s[l],b:s[l+1]});return t}let r=0,a=0;for(let l=0;l+1<s.length;l++){const c=s[l],f=s[l+1],u=f.x-c.x,d=f.y-c.y,h=Math.hypot(u,d);if(!Number.isFinite(h)||h<=0)continue;const p=u/h,v=d/h;let x=0;for(;x<h;){const S=o[r%o.length],C=S-a,I=Math.min(C,h-x);if(r%2===0&&I>0){const P=c.x+p*x,T=c.y+v*x,j=c.x+p*(x+I),E=c.y+v*(x+I);t.push({a:{x:P,y:T},b:{x:j,y:E}})}x+=I,a+=I,a>=S-1e-6&&(r+=1,a=0)}}return t},u1=(s,e,t)=>{if(!s.length)return new Float32Array(0);const n=[],o=Math.max(.5,e/2);for(const r of s){const a=r.b.x-r.a.x,l=r.b.y-r.a.y,c=Math.hypot(a,l);if(!Number.isFinite(c)||c<=0)continue;const f=-l/c,u=a/c,d=r.a.x+f*o,h=r.a.y+u*o,p=r.a.x-f*o,v=r.a.y-u*o,x=r.b.x+f*o,S=r.b.y+u*o,C=r.b.x-f*o,I=r.b.y-u*o;n.push(d,h,t[0],t[1],t[2],t[3],p,v,t[0],t[1],t[2],t[3],x,S,t[0],t[1],t[2],t[3],x,S,t[0],t[1],t[2],t[3],p,v,t[0],t[1],t[2],t[3],C,I,t[0],t[1],t[2],t[3])}return new Float32Array(n)},Ase=(s,e)=>{if(s.length<3)return new Float32Array(0);const t=S4(s);if(!t.length)return new Float32Array(0);const n=[];for(let o=0;o<t.length;o+=3){const r=s[t[o]],a=s[t[o+1]],l=s[t[o+2]];n.push(r.x,r.y,e[0],e[1],e[2],e[3],a.x,a.y,e[0],e[1],e[2],e[3],l.x,l.y,e[0],e[1],e[2],e[3])}return new Float32Array(n)},Tse=(s,e)=>{if(s.length<3||e.length!==s.length)return new Float32Array(0);const t=S4(s);if(!t.length)return new Float32Array(0);const n=[];for(let o=0;o<t.length;o+=3){const r=t[o],a=t[o+1],l=t[o+2],c=s[r],f=s[a],u=s[l],d=e[r],h=e[a],p=e[l];n.push(c.x,c.y,d[0],d[1],d[2],d[3],f.x,f.y,h[0],h[1],h[2],h[3],u.x,u.y,p[0],p[1],p[2],p[3])}return new Float32Array(n)},Fse=(s,e,t,n=1)=>{if(!e||!e.from&&!e.to)return null;const o=r_(e.from||t||"#38bdf8"),r=r_(e.to||t||e.from||"#38bdf8"),a=Math.min(...s.map(C=>C.x)),l=Math.max(...s.map(C=>C.x)),c=Math.min(...s.map(C=>C.y)),f=Math.max(...s.map(C=>C.y)),u=l-a||1,d=f-c||1,h=String(e.mode||"vertical").toLowerCase();let p=0,v=0,x=1;if(h==="radial"){p=(a+l)/2,v=(c+f)/2,x=0;for(const C of s){const I=Math.hypot(C.x-p,C.y-v);I>x&&(x=I)}(!Number.isFinite(x)||x<=0)&&(x=1)}const S=[];for(const C of s){let I=0;h==="horizontal"?I=(C.x-a)/u:h==="radial"?I=Math.hypot(C.x-p,C.y-v)/x:I=(C.y-c)/d;const A=Pse(o,r,Vy(I));A[3]=A[3]*n,S.push(A)}return S};class Lse{constructor(e){Pe(this,"runtime");Pe(this,"program",null);Pe(this,"buffer",null);this.runtime=e}ensureProgram(e){if(this.program)return;const t=`
      attribute vec2 a_pos;
      attribute vec4 a_color;
      varying vec4 v_color;
      uniform vec2 u_canvas;
      void main() {
        vec2 clip = (a_pos / u_canvas) * 2.0 - 1.0;
        gl_Position = vec4(clip.x, -clip.y, 0.0, 1.0);
        v_color = a_color;
      }
    `,n=`
      precision mediump float;
      varying vec4 v_color;
      void main() {
        gl_FragColor = v_color;
      }
    `,o=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);if(!o||!r||(e.shaderSource(o,t),e.shaderSource(r,n),e.compileShader(o),e.compileShader(r),!e.getShaderParameter(o,e.COMPILE_STATUS))||!e.getShaderParameter(r,e.COMPILE_STATUS))return;const a=e.createProgram();a&&(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.deleteShader(o),e.deleteShader(r),e.getProgramParameter(a,e.LINK_STATUS)&&(this.program=a))}ensureBuffer(e){this.buffer||(this.buffer=e.createBuffer())}clear(){const e=this.runtime.gl;if(!e){const t=this.runtime.ctx2d;t&&t.clearRect(0,0,this.runtime.canvas.width,this.runtime.canvas.height);return}e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}render(e,t){const n=this.runtime,o=n.gl;if(!o){this.clear();return}const r=n.canvas.clientWidth||n.canvas.width||1,a=n.canvas.clientHeight||n.canvas.height||1,l=n.canvas.width/r,c=n.canvas.height/a,f=Number.isFinite(l)&&Number.isFinite(c)?(l+c)/2:1;if((t==null?void 0:t.clear)!==!1&&(o.disable(o.SCISSOR_TEST),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),!e.length||(this.ensureProgram(o),this.ensureBuffer(o),!this.program||!this.buffer))return;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.buffer);const u=o.getAttribLocation(this.program,"a_pos"),d=o.getAttribLocation(this.program,"a_color"),h=o.getUniformLocation(this.program,"u_canvas");o.enableVertexAttribArray(u),o.enableVertexAttribArray(d),o.vertexAttribPointer(u,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(d,4,o.FLOAT,!1,24,8),o.uniform2f(h,n.canvas.width,n.canvas.height),o.enable(o.BLEND),o.disable(o.DEPTH_TEST),o.enable(o.SCISSOR_TEST);const p=(v,x)=>x?v.map(S=>({x:Math.round(S.x)+.5,y:Math.round(S.y)+.5})):v;for(const v of e){const x=v.bounds,S=Math.round(x.left*l),C=Math.round(n.canvas.height-(x.top+x.height)*c),I=Math.round(x.width*l),A=Math.round(x.height*c);o.scissor(S,C,I,A);for(const P of v.shapes){const T=Number.isFinite(P.opacity)?Vy(P.opacity):1,j=P.blend||"normal";if(j==="add"?o.blendFunc(o.SRC_ALPHA,o.ONE):j==="screen"?o.blendFunc(o.ONE,o.ONE_MINUS_SRC_COLOR):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),P.kind==="polygon"){const pe=P.points.map(Oe=>({x:Oe.x*l,y:Oe.y*c})),re=P.fillColor,xe=P.fillGradient,se=xe?Fse(pe,xe,re,T):null;if(se&&se.length===pe.length){const Oe=Tse(pe,se);Oe.length&&(o.bufferData(o.ARRAY_BUFFER,Oe,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Oe.length/6))}else if(re){const Oe=r_(re),Ke=[Oe[0],Oe[1],Oe[2],Oe[3]*T],kt=Ase(pe,Ke);kt.length&&(o.bufferData(o.ARRAY_BUFFER,kt,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,kt.length/6))}const Ne=P.strokeColor,Te=(P.strokeWidth??1)*f,Me=Number.isFinite(P.glow)?P.glow:0,De=Number.isFinite(P.glowOpacity)?Vy(P.glowOpacity):.35;if(Me>0&&(Ne||re)){const Oe=r_(P.glowColor||Ne||re||"#e2e8f0"),Ke=[Oe[0],Oe[1],Oe[2],Oe[3]*T*De],kt=Math.max(1,Te+Me*f),pt=p(pe.length?[...pe,pe[0]]:[],!0),Rt=S_(pt,"solid"),Ht=u1(Rt,kt,Ke);Ht.length&&(o.bufferData(o.ARRAY_BUFFER,Ht,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Ht.length/6))}if(Ne&&Te>0){const Oe=r_(Ne),Ke=[Oe[0],Oe[1],Oe[2],Oe[3]*T],kt=P.strokeStyle||"solid",pt=kt==="dashed"||kt==="dotted"||Te<=1,Rt=p(pe.length?[...pe,pe[0]]:[],pt),Ht=S_(Rt,kt),Ft=u1(Ht,Te,Ke);Ft.length&&(o.bufferData(o.ARRAY_BUFFER,Ft,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Ft.length/6))}continue}const E=P.style||"solid",L=Math.max(1,(P.width??1)*f),D=P.color||"#e2e8f0",X=r_(D),ne=[X[0],X[1],X[2],X[3]*T],de=Number.isFinite(P.glow)?P.glow:0,ie=Number.isFinite(P.glowOpacity)?Vy(P.glowOpacity):.35,te=pe=>{if(!pe.length||de<=0)return;const re=r_(P.glowColor||D||"#e2e8f0"),xe=[re[0],re[1],re[2],re[3]*T*ie],se=Math.max(1,L+de*f),Ne=u1(pe,se,xe);Ne.length&&(o.bufferData(o.ARRAY_BUFFER,Ne,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Ne.length/6))};let le=[];if(P.kind==="path"&&P.commands){let pe=[];const re=()=>{if(pe.length>=2){const xe=S_(pe,E),se=p(pe,!0);te(S_(se,"solid"));const Ne=u1(xe,L,ne);Ne.length&&(o.bufferData(o.ARRAY_BUFFER,Ne,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,Ne.length/6))}pe=[]};for(const xe of P.commands)xe.cmd==="M"?(re(),pe.push({x:xe.x*l,y:xe.y*c})):xe.cmd==="L"&&pe.push({x:xe.x*l,y:xe.y*c});re();continue}if(P.points&&(le=P.points.map(pe=>({x:pe.x*l,y:pe.y*c}))),le.length>=2){const pe=S_(le,E),re=p(le,!0);te(S_(re,"solid"));const xe=u1(pe,L,ne);xe.length&&(o.bufferData(o.ARRAY_BUFFER,xe,o.STREAM_DRAW),o.drawArrays(o.TRIANGLES,0,xe.length/6))}}}o.disable(o.SCISSOR_TEST)}destroy(){const e=this.runtime.gl;e&&this.program&&e.deleteProgram(this.program),e&&this.buffer&&e.deleteBuffer(this.buffer),this.program=null,this.buffer=null}}const Pb=Th({}),Ese=Pb;function $se(s,e){const t={...e,_updatedAt:Date.now()};Pb.update(n=>({...n,[s]:t}))}function T6(s){Pb.update(e=>{const{[s]:t,...n}=e;return n})}function Dse(){Pb.set({})}function Pp(s,e){const t=typeof s=="number"?s:Number(s);return Number.isFinite(t)?t:e}function F6(s,e="start"){if(s==null)return null;if(typeof s=="number"&&Number.isFinite(s))return s>1e12?Math.floor(s):Math.floor(s*1e3);const t=String(s).trim();if(!t)return null;if(/^\d+$/.test(t)){const r=Number(t);if(Number.isFinite(r))return r>1e12?Math.floor(r):Math.floor(r*1e3)}const n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n){const r=Number(n[1]),a=Number(n[2])-1,l=Number(n[3]);if([r,a,l].every(c=>Number.isFinite(c))){const c=Date.UTC(r,a,l);return Number.isFinite(c)?e==="end"?c+86399999:c:null}}const o=Date.parse(t);return Number.isFinite(o)?o:null}function Rse(s){if(!s)return null;const e=String(s).trim();if(!e)return null;const t=e.match(/^(\d{2})(?::?(\d{2}))?\s*-\s*(\d{2})(?::?(\d{2}))?$/);if(!t)return null;const n=Number(t[1]),o=Number(t[2]||"0"),r=Number(t[3]),a=Number(t[4]||"0");return![n,o,r,a].every(l=>Number.isFinite(l))||n<0||n>23||r<0||r>23||o<0||o>59||a<0||a>59?null:{startMin:n*60+o,endMin:r*60+a}}function jse(s){if(s===!0)return{enabled:!0,execution:"intrabar_ohlc",intrabarTieBreak:"worst_case",ohlcPath:"open_high_low_close",intrabarTicks:6,initialCapital:1e4,fromTs:null,toTs:null,session:null,orderSize:{type:"percent_of_equity",value:100},commissionPct:0,commissionCash:null,commissionPerUnit:null,commissionType:"percent",slippagePct:0,slippageAbs:null,slippageTicks:null,slippageType:"percent",priceTick:null,qtyStep:null,minQty:null,spreadPct:null,leverage:1,maintenanceMarginPct:null,liquidationFeePct:null,borrowPctPerYear:null,fundingPctPerDay:null,positionMode:"netting",closeMethod:"fifo",pyramiding:1,timeInForce:"gtc",fillMode:"full",volumeFillPct:100,stopLossPct:null,takeProfitPct:null,takeProfits:[],trailingStopPct:null,maxDrawdownPct:null,maxDrawdownCash:null,maxPositionPct:null,maxPositionCash:null,maxPositionQty:null,maxIntradayFilledOrders:null,maxIntradayLossPct:null,maxIntradayLossCash:null,allowLong:!0,allowShort:!0,closeOnEnd:!0};if(!s||typeof s!="object")return null;const e=s;if(e.enabled===!1)return null;const t=String(e.execution||e.exec||e.mode||"").trim().toLowerCase()||"intrabar_ohlc",n=t==="bar_close"||t==="barclose"||t==="close"?"bar_close":t==="intrabar_ticks"||t==="intrabarticks"||t==="ticks"?"intrabar_ticks":"intrabar_ohlc",o=String(e.intrabarTieBreak||e.tieBreak||"").trim().toLowerCase(),r=o==="best_case"||o==="best"||o==="tp"?"best_case":o==="ohlc"||o==="path"?"ohlc":"worst_case",a=String(e.ohlcPath||e.path||"").trim().toLowerCase(),l=a==="open_low_high_close"||a==="olhc"?"open_low_high_close":"open_high_low_close",c=e.intrabarTicks??e.ticks??e.tickCount??e.intrabarTickCount??null,f=Math.max(2,Math.min(100,Math.floor(Pp(c,6)))),u=Math.max(0,Pp(e.initialCapital,1e4)),d=Math.max(0,Pp(e.commissionPct,0)),h=e.commissionCash??e.commission_cash??e.commissionFixed??e.commission_fixed??null,p=e.commissionPerUnit??e.commission_per_unit??e.commissionPerShare??e.commission_per_share??null,v=h==null?null:Math.max(0,Pp(h,0)),x=p==null?null:Math.max(0,Pp(p,0)),S=String(e.commissionType??e.commission_mode??e.commissionMode??"").trim().toLowerCase(),C=x!=null||S==="per_unit"?"per_unit":v!=null||S==="cash"?"cash":"percent",I=Math.max(0,Pp(e.slippagePct??e.slippage??e.slippage_percent,0)),A=e.slippageAbs??e.slippage_abs??null,P=e.slippageTicks??e.slippage_ticks??e.slippageTick??null,T=A==null?null:Math.max(0,Pp(A,0)),j=P==null?null:Math.max(0,Pp(P,0)),E=String(e.slippageType??e.slippage_mode??e.slippageMode??"").trim().toLowerCase(),L=j!=null||E==="ticks"?"ticks":T!=null||E==="abs"?"abs":"percent",D=e.priceTick??e.price_tick??e.tickSize??e.tick_size??e.tick??e.minTick??e.min_tick??null,X=e.qtyStep??e.qty_step??e.quantityStep??e.quantity_step??e.lotStep??e.lot_step??null,ne=e.minQty??e.min_qty??e.minimumQty??e.minimum_qty??null,de=D==null?null:Math.max(0,Pp(D,0)),ie=X==null?null:Math.max(0,Pp(X,0)),te=ne==null?null:Math.max(0,Pp(ne,0)),le=e.spreadPct??e.spread_pct??e.spread??e.spreadBps??e.spread_bps??null,pe=(()=>{if(le==null)return null;const Zr=Pp(le,0);return!Number.isFinite(Zr)||Zr<=0?null:"spreadBps"in e||"spread_bps"in e?Zr/100:Zr})(),re=e.leverage??e.lev??e.marginLeverage??e.margin_leverage??1,xe=Math.max(1,Pp(re,1)),se=e.maintenanceMarginPct??e.maintenance_margin_pct??e.maintMarginPct??null,Ne=e.liquidationFeePct??e.liquidation_fee_pct??e.liqFeePct??null,Te=e.borrowPctPerYear??e.borrow_pct_per_year??e.shortBorrowPctPerYear??null,Me=e.fundingPctPerDay??e.funding_pct_per_day??e.funding??null,De=se==null?null:Math.max(0,Pp(se,0)),Oe=Ne==null?null:Math.max(0,Pp(Ne,0)),Ke=Te==null?null:Math.max(0,Pp(Te,0)),kt=Me==null?null:Math.max(0,Pp(Me,0)),pt=String(e.positionMode??e.position_mode??"").trim().toLowerCase(),Rt=pt==="hedge"||pt==="hedging"?"hedging":"netting",Ht=String(e.closeMethod??e.close_method??e.costBasis??e.cost_basis??"").trim().toLowerCase(),Ft=Ht==="lifo"?"lifo":Ht==="avg"||Ht==="average"?"avg":"fifo",zt=Math.max(1,Math.min(50,Math.floor(Pp(e.pyramiding??e.maxEntries??e.max_positions??e.maxPositions??1,1)))),ut=String(e.timeInForce??e.tif??e.orderTif??e.order_tif??"").trim().toLowerCase(),nt=ut==="ioc"||ut==="immediate_or_cancel"?"ioc":ut==="fok"||ut==="fill_or_kill"?"fok":"gtc",Je=String(e.fillMode??e.fill_mode??"").trim().toLowerCase(),it=Je==="volume"||Je==="partial"||e.partialFills?"volume":"full",ze=Math.max(0,Math.min(100,Pp(e.volumeFillPct??e.volume_fill_pct??e.fillPct??100,100))),Ge=e.stopLossPct??e.slPct??e.sl??e.stopLoss??e.stop_loss??null,xt=e.takeProfitPct??e.tpPct??e.tp??e.takeProfit??e.take_profit??null,jt=e.trailingStopPct??e.trailPct??e.trailing??e.trailingStop??null,ft=Ge==null?null:Math.max(0,Pp(Ge,0)),ke=xt==null?null:Math.max(0,Pp(xt,0)),Se=jt==null?null:Math.max(0,Pp(jt,0)),Et=typeof e.allowLong=="boolean"?e.allowLong:e.allowLong!==!1,wt=typeof e.allowShort=="boolean"?e.allowShort:e.allowShort!==!1,Ls=typeof e.closeOnEnd=="boolean"?e.closeOnEnd:e.closeOnEnd!==!1,tn=F6(e.from??e.start??e.startDate??e.dateFrom??e.fromDate??e.rangeStart,"start")??null,Gs=F6(e.to??e.end??e.endDate??e.dateTo??e.toDate??e.rangeEnd,"end")??null,an=Rse(e.session??e.tradingSession??e.sessionTime),Es=e.takeProfits??e.tpLevels??e.takeProfitLevels??[],Ns=[];if(Array.isArray(Es))for(const Zr of Es){if(!Zr||typeof Zr!="object")continue;const zi=Pp(Zr.takeProfitPct??Zr.tpPct??Zr.pct,NaN),Nl=Pp(Zr.qtyPct??Zr.qty??Zr.percent,NaN);!Number.isFinite(zi)||zi<=0||!Number.isFinite(Nl)||Nl<=0||Ns.push({takeProfitPct:zi,qtyPct:Math.max(0,Math.min(100,Nl))})}Ns.sort((Zr,zi)=>Zr.takeProfitPct-zi.takeProfitPct);const Hs=e.risk&&typeof e.risk=="object"?e.risk:{},ns=Zr=>{if(Zr==null)return null;const zi=Pp(Zr,NaN);return Number.isFinite(zi)?zi:null},fs=ns(e.maxDrawdownPct??e.max_drawdown_pct??Hs.maxDrawdownPct??Hs.max_drawdown_pct??Hs.max_drawdown)??null,Mn=ns(e.maxDrawdownCash??e.max_drawdown_cash??Hs.maxDrawdownCash??Hs.max_drawdown_cash)??null,po=ns(e.maxPositionPct??e.max_position_pct??Hs.maxPositionPct??Hs.max_position_pct??Hs.max_position_size)??null,Tn=ns(e.maxPositionCash??e.max_position_cash??Hs.maxPositionCash??Hs.max_position_cash)??null,Cn=ns(e.maxPositionQty??e.max_position_qty??Hs.maxPositionQty??Hs.max_position_qty??Hs.max_contracts)??null,go=ns(e.maxIntradayFilledOrders??e.max_intraday_filled_orders??Hs.maxIntradayFilledOrders??Hs.max_intraday_filled_orders)??null,no=ns(e.maxIntradayLossPct??e.max_intraday_loss_pct??Hs.maxIntradayLossPct??Hs.max_intraday_loss_pct??Hs.max_intraday_loss)??null,Bo=ns(e.maxIntradayLossCash??e.max_intraday_loss_cash??Hs.maxIntradayLossCash??Hs.max_intraday_loss_cash)??null;let Vo=0;const Rl=[];for(const Zr of Ns){if(Vo>=100)break;const zi=100-Vo,Nl=Math.min(zi,Zr.qtyPct);Nl<=0||(Rl.push({takeProfitPct:Zr.takeProfitPct,qtyPct:Nl}),Vo+=Nl)}const aa=e.orderSize??e.positionSize??e.order??null;let tl={type:"percent_of_equity",value:100};if(aa&&typeof aa=="object"){const Zr=String(aa.type||"").trim().toLowerCase(),zi=Pp(aa.value,100);Zr==="cash"?tl={type:"cash",value:Math.max(0,zi)}:Zr==="qty"?tl={type:"qty",value:Math.max(0,zi)}:Zr?tl={type:"percent_of_equity",value:Math.max(0,Math.min(100,zi))}:tl={type:"percent_of_equity",value:Math.max(0,Math.min(100,zi))}}else if(aa!=null){const Zr=Pp(aa,100);tl={type:"percent_of_equity",value:Math.max(0,Math.min(100,Zr))}}return{enabled:!0,execution:n,intrabarTieBreak:r,ohlcPath:l,intrabarTicks:f,initialCapital:u,fromTs:tn,toTs:Gs,session:an,orderSize:tl,commissionPct:d,commissionCash:v,commissionPerUnit:x,commissionType:C,slippagePct:I,slippageAbs:T,slippageTicks:j,slippageType:L,priceTick:de&&de>0?de:null,qtyStep:ie&&ie>0?ie:null,minQty:te&&te>0?te:null,spreadPct:pe&&pe>0?pe:null,leverage:xe,maintenanceMarginPct:De&&De>0?De:null,liquidationFeePct:Oe&&Oe>0?Oe:null,borrowPctPerYear:Ke&&Ke>0?Ke:null,fundingPctPerDay:kt&&kt>0?kt:null,positionMode:Rt,closeMethod:Ft,pyramiding:zt,timeInForce:nt,fillMode:it,volumeFillPct:ze,stopLossPct:ft!=null&&ft>0?ft:null,takeProfitPct:ke!=null&&ke>0?ke:null,takeProfits:Rl,trailingStopPct:Se!=null&&Se>0?Se:null,maxDrawdownPct:fs!=null&&fs>0?fs:null,maxDrawdownCash:Mn!=null&&Mn>0?Mn:null,maxPositionPct:po!=null&&po>0?po:null,maxPositionCash:Tn!=null&&Tn>0?Tn:null,maxPositionQty:Cn!=null&&Cn>0?Cn:null,maxIntradayFilledOrders:go!=null&&go>0?Math.floor(go):null,maxIntradayLossPct:no!=null&&no>0?no:null,maxIntradayLossCash:Bo!=null&&Bo>0?Bo:null,allowLong:Et,allowShort:wt,closeOnEnd:Ls}}function L6(s){return s==="cancel"||s==="cancel_all"?0:s==="exit_long"?1:s==="exit_short"?2:s==="entry_long"?3:s==="entry_short"?4:9}function Wy(s){const e=s==null?void 0:s.close;return typeof e=="number"&&Number.isFinite(e)?e:null}function I2(s){return typeof s=="number"&&Number.isFinite(s)?s:null}function Bse(s){const e=Wy(s);if(e==null)return null;const t=I2(s==null?void 0:s.open)??e,n=I2(s==null?void 0:s.high)??Math.max(t,e),o=I2(s==null?void 0:s.low)??Math.min(t,e);return{o:t,h:n,l:o,c:e}}function Ose(s,e,t){var ye,Qe,Ue,dt,et;const n=t.initialCapital,o=t.commissionPct/100,r=t.commissionCash,a=t.commissionPerUnit,l=t.commissionType,c=t.slippagePct/100,f=t.slippageAbs,u=t.slippageTicks,d=t.slippageType,h=t.priceTick&&t.priceTick>0?t.priceTick:null,p=t.qtyStep&&t.qtyStep>0?t.qtyStep:null,v=t.minQty&&t.minQty>0?t.minQty:null,x=t.spreadPct&&t.spreadPct>0?t.spreadPct/100:0,S=x>0?x/2:0,C=Math.max(1,Number(t.leverage)||1),I=t.maintenanceMarginPct&&t.maintenanceMarginPct>0?t.maintenanceMarginPct/100:null,A=t.liquidationFeePct&&t.liquidationFeePct>0?t.liquidationFeePct/100:null,P=t.borrowPctPerYear&&t.borrowPctPerYear>0?t.borrowPctPerYear/100:null,T=t.fundingPctPerDay&&t.fundingPctPerDay>0?t.fundingPctPerDay/100:null,j=t.maxDrawdownPct&&t.maxDrawdownPct>0?t.maxDrawdownPct/100:null,E=t.maxDrawdownCash&&t.maxDrawdownCash>0?t.maxDrawdownCash:null,L=t.maxPositionPct&&t.maxPositionPct>0?t.maxPositionPct/100:null,D=t.maxPositionCash&&t.maxPositionCash>0?t.maxPositionCash:null,X=t.maxPositionQty&&t.maxPositionQty>0?t.maxPositionQty:null,ne=t.maxIntradayFilledOrders&&t.maxIntradayFilledOrders>0?Math.floor(t.maxIntradayFilledOrders):null,de=t.maxIntradayLossPct&&t.maxIntradayLossPct>0?t.maxIntradayLossPct/100:null,ie=t.maxIntradayLossCash&&t.maxIntradayLossCash>0?t.maxIntradayLossCash:null,te=(B,ve,Fe)=>{const ot=(Fe==null?void 0:Fe.commissionMode)??l,tt=(Fe==null?void 0:Fe.commissionValue)??(ot==="per_unit"?a:ot==="cash"?r:o);return Number.isFinite(tt)?ot==="cash"?Math.max(0,tt):ot==="per_unit"?Math.max(0,tt*Math.max(0,B)):Math.max(0,ve*Math.max(0,tt)):0},le=(B,ve)=>{const Fe=(ve==null?void 0:ve.slippageMode)??d,ot=(ve==null?void 0:ve.slippageValue)??(Fe==="ticks"?u:Fe==="abs"?f:c);return Number.isFinite(ot)?Fe==="ticks"?h?Math.max(0,ot*h):0:Fe==="abs"?Math.max(0,ot):Math.max(0,B*Math.max(0,ot)):0},pe=B=>{if(!Number.isFinite(B)||B<=0)return 0;const ve=String(B),Fe=ve.match(/e-(\d+)$/i);if(Fe)return Math.max(0,Math.min(12,Number(Fe[1])||0));const ot=ve.indexOf(".");return ot>=0?Math.max(0,Math.min(12,ve.length-ot-1)):0},re=(B,ve,Fe)=>{if(!Number.isFinite(B))return NaN;if(!Number.isFinite(ve)||ve<=0)return B;const ot=pe(ve),tt=Math.pow(10,ot),St=Math.round(ve*tt);if(!Number.isFinite(St)||St<=0)return B;const Be=B*tt;return(Fe==="ceil"?Math.ceil(Be/St-1e-12):Fe==="round"?Math.round(Be/St):Math.floor(Be/St+1e-12))*St/tt},xe=(B,ve)=>p?re(B,p,ve):B,se=(B,ve)=>B==="entry"?ve==="long":ve==="short",Ne=(B,ve)=>S?se(B,ve)?1+S:1-S:1,Te=(B,ve,Fe)=>{const ot=Ne(ve,Fe);return ot===1?B:{o:B.o*ot,h:B.h*ot,l:B.l*ot,c:B.c*ot}},Me=(B,ve,Fe,ot)=>{if(!h)return ot;const tt=se(B,ve);return re(ot,h,Fe==="limit"?tt?"floor":"ceil":tt?"ceil":"floor")},De=(B,ve,Fe)=>{if(!h)return Fe;const tt=se(B,ve)?"ceil":"floor";return re(Fe,h,tt)};let Oe=0,Ke=0;const kt={long:[],short:[]},pt=B=>kt[B],Rt=B=>pt(B).some(ve=>ve.qty>1e-12),Ht=()=>Rt("long")||Rt("short"),Ft=B=>pt(B).filter(ve=>ve.qty>1e-12).length,zt=B=>B==="long"?"short":"long",ut=[],nt=[],Je=[],it=new Map;let ze=1;const Ge=[],xt=()=>`o${ze++}`,jt=B=>{var Fe;const ve=Number((Fe=s[B])==null?void 0:Fe.timestamp);return Number.isFinite(ve)&&ve>0?ve:Date.now()},ft=B=>{const ve=xt(),Fe={id:ve,...B};return Je.push(Fe),it.set(ve,Fe),Fe},ke=(B,ve)=>{if(!B)return;const Fe=it.get(B);Fe&&Object.assign(Fe,ve)},Se=B=>{const ve=B.id?it.get(B.id):null;if(!ve)return;const Fe=Number.isFinite(ve.fillQty)?ve.fillQty:0,ot=Number.isFinite(ve.fillPrice)?ve.fillPrice:0,tt=Number.isFinite(B.qty)?B.qty:0,St=Fe+tt,Be=St>0?(ot*Fe+B.price*tt)/St:B.price,je=(Number.isFinite(ve.fees)?ve.fees:0)+(Number.isFinite(B.fees)?B.fees:0);ve.fillQty=St,ve.fillPrice=Be,ve.fees=je,ve.filledIndex=B.index,ve.filledTimestamp=B.timestamp,B.targetQty!=null&&(ve.targetQty=B.targetQty),B.remainingQty!=null&&(ve.remainingQty=B.remainingQty),B.status&&(ve.status=B.status),B.note&&(ve.note=B.note)},Et=s.length,wt={initialCapital:n,finalEquity:n,netPnl:0,netPnlPct:0,grossProfit:0,grossLoss:0,profitFactor:0,trades:0,roundTrips:0,wins:0,losses:0,winRate:0,maxDrawdownPct:0,maxDrawdownValue:0,feesPaid:0,avgTrade:0,avgWin:0,avgLoss:0,payoffRatio:0,expectancy:0,maxConsecWins:0,maxConsecLosses:0,exposurePct:0,maxRunupPct:0,maxRunupValue:0,avgBarsInTrade:0,volatilityPct:0,sharpe:0,sortino:0,calmar:0};if(!Et)return{summary:wt,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]};const Ls=new Array(Et).fill(0),tn=new Array(Et).fill(0),Gs=new Array(Et).fill(0),an=new Array(Et).fill(0),Es=new Array(Et).fill(0),Ns=new Array(Et).fill(0),Hs=new Array(Et).fill(0),ns=new Array(Et).fill(0),fs=new Array(Et).fill(0),Mn=new Array(Et).fill(0),po=new Array(Et).fill(0),Tn=new Array(Et).fill(0),Cn=new Array(Et).fill(0),go=new Array(Et).fill(0),no=new Array(Et).fill(0),Bo=new Array(Et).fill(0),Vo=new Array(Et).fill(0),Rl=new Array(Et).fill(0),aa=new Array(Et).fill(0),tl=new Array(Et).fill(n),Zr=new Array(Et).fill(0),zi=Array.from({length:Et},()=>[]);let Nl=0,mu=0,Gc=0,du=0,Ju=0,rd=0,Al=0,sa="",Vc=n,vu=!1;const Qc=t.fromTs!=null&&Number.isFinite(t.fromTs)?t.fromTs:null,To=t.toTs!=null&&Number.isFinite(t.toTs)?t.toTs:null;let ec=0,yl=Et-1;if(Qc!=null){const B=s.findIndex(ve=>Number(ve==null?void 0:ve.timestamp)>=Qc);if(B>=0)ec=B;else return{summary:wt,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}if(To!=null){for(let B=Et-1;B>=0;B--){const ve=Number((ye=s[B])==null?void 0:ye.timestamp);if(Number.isFinite(ve)&&ve<=To){yl=B;break}}if(yl<ec)return{summary:wt,trades:[],roundTrips:[],orders:[],equity:[],benchmark:[]}}const Dc=t.session,jl=B=>{var Be;if(!Dc)return!0;const ve=Number((Be=s[B])==null?void 0:Be.timestamp);if(!Number.isFinite(ve)||ve<=0)return!0;const Fe=new Date(ve),ot=Fe.getUTCHours()*60+Fe.getUTCMinutes(),{startMin:tt,endMin:St}=Dc;return tt<=St?ot>=tt&&ot<=St:ot>=tt||ot<=St},qi=(Array.isArray(e)?e:[]).filter(B=>typeof(B==null?void 0:B.index)=="number"&&B.index>=0).filter(B=>B.index>=ec&&B.index<=yl).filter(B=>jl(B.index)).slice().sort((B,ve)=>B.index-ve.index||L6(B.type)-L6(ve.type));let la=0,El=n,qu=0,Td=0,ki=n,sl=0,br=0,Wc=1;const Xd={long:null,short:null},Uf=(B,ve)=>{const Fe=Xd[B];if(Fe)return Fe;const ot={id:`t${Wc++}`,side:B,entryIndex:ve,entryTimestamp:jt(ve),exitIndex:ve,exitTimestamp:jt(ve),qtyEntered:0,entryNotional:0,qtyExited:0,exitNotional:0,grossPnl:0,fees:0,entries:0,exits:0};return Xd[B]=ot,ot},xf=(B,ve)=>{if(Rt(B))return;const Fe=Xd[B];if(!Fe)return;const ot=Fe.qtyEntered,tt=ot>0?Fe.entryNotional/ot:0,St=Fe.qtyExited>0?Fe.exitNotional/Fe.qtyExited:0,Be=Fe.entryNotional>0?Fe.grossPnl/Fe.entryNotional*100:0;nt.push({id:Fe.id,side:Fe.side,entryIndex:Fe.entryIndex,entryTimestamp:Fe.entryTimestamp,exitIndex:Fe.exitIndex,exitTimestamp:Fe.exitTimestamp,qty:ot,avgEntryPrice:tt,avgExitPrice:St,grossPnl:Fe.grossPnl,fees:Fe.fees,netPnl:Fe.grossPnl-Fe.fees,pnlPct:Be,entries:Fe.entries,exits:Fe.exits,maePct:typeof Fe.maeMin=="number"&&Number.isFinite(Fe.maeMin)?Fe.maeMin:void 0,mfePct:typeof Fe.mfeMax=="number"&&Number.isFinite(Fe.mfeMax)?Fe.mfeMax:void 0}),Xd[B]=null},Uu=(B,ve)=>{let Fe=0;for(const ot of pt("long"))ot.qty<=0||(Fe+=(ve-ot.entryPrice)*ot.qty);for(const ot of pt("short"))ot.qty<=0||(Fe+=(ot.entryPrice-ve)*ot.qty);return n+Oe+Fe-Ke},tp=B=>{let ve=0;for(const Fe of pt("long"))Fe.qty<=0||(ve+=(B-Fe.entryPrice)*Fe.qty);for(const Fe of pt("short"))Fe.qty<=0||(ve+=(Fe.entryPrice-B)*Fe.qty);return Number.isFinite(ve)?ve:0},wf=()=>{let B=0,ve=0,Fe=0,ot=0;for(const St of pt("long"))St.qty<=0||(B+=St.qty,ve+=St.entryPrice*St.qty);for(const St of pt("short"))St.qty<=0||(Fe+=St.qty,ot+=St.entryPrice*St.qty);const tt=B-Fe;return tt>0&&B>0?ve/B:tt<0&&Fe>0?ot/Fe:NaN},Vs=(B,ve)=>{if(t.orderSize.type==="cash")return Math.max(0,t.orderSize.value)*C;if(t.orderSize.type==="qty")return Math.max(0,t.orderSize.value*ve);const Fe=Math.max(0,Math.min(100,t.orderSize.value));return B*Fe/100*C},kn=()=>{let B=0;for(const ve of pt("long"))B+=ve.qty>0?ve.entryNotional:0;for(const ve of pt("short"))B+=ve.qty>0?ve.entryNotional:0;return B},Kn=()=>C>0?kn()/C:0,Bs=B=>{const ve=Number(B);if(!Number.isFinite(ve)||ve<=0)return{long:0,short:0,total:0};let Fe=0,ot=0;for(const tt of pt("long"))Fe+=tt.qty>0?tt.qty*ve:0;for(const tt of pt("short"))ot+=tt.qty>0?tt.qty*ve:0;return{long:Fe,short:ot,total:Fe+ot}},bo=(B,ve,Fe)=>{var Qn,wn;if(!Ht()||!P&&!T||B<=Fe)return;const ot=Number((Qn=s[B-1])==null?void 0:Qn.timestamp),tt=Number((wn=s[B])==null?void 0:wn.timestamp);if(!Number.isFinite(ot)||!Number.isFinite(tt)||tt<=ot)return;const St=tt-ot,Be=St/864e5,je=St/(365*864e5);if(!Number.isFinite(Be)||Be<=0)return;const Mt=Bs(ve);let Ze=0,rs=0;T&&(Ze=Math.max(0,Mt.total*T*Be)),P&&(rs=Math.max(0,Mt.short*P*je));const yn=Ze+rs;if(!(!Number.isFinite(yn)||yn<=0)){if(Ke+=yn,Ze>0&&Mt.total>0){const xo=Ze*Mt.long/Mt.total,hi=Ze-xo;Xd.long&&(Xd.long.fees+=xo),Xd.short&&(Xd.short.fees+=hi)}rs>0&&Xd.short&&(Xd.short.fees+=rs)}},lo=(B,ve,Fe)=>{if(!Ht())return!1;const ot=jt(B);let tt=!1;for(const St of["long","short"]){if(!Rt(St))continue;const Be=ft({action:"exit",side:St,kind:"market",originalKind:"market",status:"pending",createdIndex:B,createdTimestamp:ot,activeFromIndex:B,qtyPct:100,price:ve,note:Fe}),je=vi(St,B,ve,"liquidation","market",{orderId:Be.id},A??void 0);je?(ke(Be.id,{status:"filled",filledIndex:B,filledTimestamp:ot,fillPrice:je.execPrice,fillQty:je.qtyClosed,fees:je.exitFees}),tt=!0):ke(Be.id,{status:"rejected",note:`${Fe} (no fill)`})}if(tt&&ar.length){for(const St of ar)ke(St.orderId,{status:"canceled",note:"Canceled on liquidation"});ar.length=0}return tt},Qi=(B,ve)=>{if(!I||!Ht())return!1;const Fe=Mt=>{const Ze=Uu(B,Mt),yn=Bs(Mt).total*I;return{px:Mt,equityNow:Ze,req:yn,gap:Ze-yn}},ot=Fe(ve.l),tt=Fe(ve.h),St=Number.isFinite(ot.gap)&&ot.gap<=1e-9,Be=Number.isFinite(tt.gap)&&tt.gap<=1e-9;if(!St&&!Be)return!1;const je=St&&Be?ot.gap<=tt.gap?ot:tt:St?ot:tt;return lo(B,je.px,"AUTO liquidation")},xr=(B,ve,Fe,ot)=>{const tt=le(Fe,ot);return!Number.isFinite(tt)||tt<=0?Fe:se(B,ve)?Fe+tt:Fe-tt},Ai=(B,ve,Fe,ot)=>{if(Fe==="limit")return De("entry",B,ve);const tt=ve*Ne("entry",B),St=xr("entry",B,tt,ot);return De("entry",B,St)},ri=(B,ve,Fe,ot)=>{if(Fe==="limit")return De("exit",B,ve);const tt=ve*Ne("exit",B),St=xr("exit",B,tt,ot);return De("exit",B,St)},Ti=B=>{if(!B||typeof B!="object")return;const ve=Ze=>{const rs=typeof Ze=="number"?Ze:Number(Ze);return Number.isFinite(rs)?rs:void 0},Fe=ve(B.stopLossPct),ot=ve(B.takeProfitPct),tt=ve(B.trailingStopPct),St=B.takeProfits,Be=[];if(Array.isArray(St))for(const Ze of St){if(!Ze||typeof Ze!="object")continue;const rs=ve(Ze.takeProfitPct),yn=ve(Ze.qtyPct);rs==null||rs<=0||yn==null||yn<=0||Be.push({takeProfitPct:Math.max(0,rs),qtyPct:Math.max(0,Math.min(100,yn))})}Be.sort((Ze,rs)=>Ze.takeProfitPct-rs.takeProfitPct);let je=0;const Mt=[];for(const Ze of Be){if(je>=100)break;const rs=100-je,yn=Math.min(rs,Ze.qtyPct);yn<=0||(Mt.push({takeProfitPct:Ze.takeProfitPct,qtyPct:yn}),je+=yn)}if(!(Fe==null&&ot==null&&tt==null&&Mt.length===0))return{stopLossPct:Fe,takeProfitPct:ot,trailingStopPct:tt,takeProfits:Mt.length?Mt:void 0}},Eo=(B,ve,Fe,ot,tt)=>{if(!Number.isFinite(Fe)||Fe<=0)return{ok:!1,reject:"Invalid fill price"};const St=Uu(ve,Fe),Be=tt&&typeof tt.qty=="number"&&Number.isFinite(tt.qty)?Math.abs(tt.qty):null,je=tt&&typeof tt.cash=="number"&&Number.isFinite(tt.cash)?Math.abs(tt.cash):null;let Mt=0;if(Be!=null)Mt=Be;else if(je!=null)Mt=je*C/Fe;else{const wn=Number.isFinite(ot)?Math.max(0,Math.min(100,ot)):100;if(wn<=0)return{ok:!1,reject:"qtyPct <= 0"};const xo=Vs(St,Fe)*wn/100;if(!Number.isFinite(xo)||xo<=0)return{ok:!1,reject:"Notional <= 0"};Mt=xo/Fe}if(!Number.isFinite(Mt)||Mt<=0)return{ok:!1,reject:"Qty <= 0"};const Ze=xe(Mt,"floor");if(!Number.isFinite(Ze)||Ze<=0)return p?{ok:!1,reject:`Qty rounded to 0 (qtyStep=${p})`}:{ok:!1,reject:"Qty <= 0"};if(v!=null&&Ze<v)return{ok:!1,reject:`Qty ${Ze} < minQty ${v}`};if(X!=null&&_a(B)+Ze>X)return{ok:!1,reject:"Max position qty exceeded"};if(D!=null&&Bs(Fe)[B]+Ze*Fe>D)return{ok:!1,reject:"Max position cash exceeded"};if(L!=null&&L>0){const xo=Bs(Fe)[B]+Ze*Fe,hi=St*L;if(hi>0&&xo>hi)return{ok:!1,reject:"Max position percent exceeded"}}const rs=Fe*Ze,yn=C>0?rs/C:rs,Qn=Kn();return yn>0&&Qn+yn>St+1e-9?{ok:!1,reject:"Insufficient margin"}:{ok:!0,qty:Ze,equityNow:St}},hr=(B,ve,Fe,ot=100,tt="market",St,Be,je)=>{var mf,mp,_c;if(t.positionMode==="netting"&&Rt(zt(B)))return{ok:!1,reject:"Netting mode: opposite position open"};if(vu)return{ok:!1,reject:"Risk limit reached"};if(ne!=null&&Al>=ne)return{ok:!1,reject:"Max intraday filled orders reached"};if(Ft(B)>=t.pyramiding)return{ok:!1,reject:`Pyramiding limit reached (${t.pyramiding})`};const Mt=Ai(B,Fe,tt,je),Ze=Eo(B,ve,Mt,ot,je);if(!Ze.ok)return{ok:!1,reject:Ze.reject};const rs=Ze.qty,yn=Mt*rs,Qn=te(rs,yn,je);Ke+=Qn;{const Ea=Uf(B,ve);Ea.qtyEntered+=rs,Ea.entryNotional+=yn,Ea.fees+=Qn,Ea.entries+=1}const wn=t.closeMethod==="avg"?void 0:Ti(St),xo=(wn==null?void 0:wn.stopLossPct)!=null?wn.stopLossPct:t.stopLossPct,hi=(wn==null?void 0:wn.takeProfitPct)!=null?wn.takeProfitPct:t.takeProfitPct,Ln=(wn==null?void 0:wn.trailingStopPct)!=null?wn.trailingStopPct:t.trailingStopPct,pl=xo&&xo>0?B==="long"?Mt*(1-xo/100):Mt*(1+xo/100):null,vn=hi&&hi>0?B==="long"?Mt*(1+hi/100):Mt*(1-hi/100):null,mo=pl!=null&&Number.isFinite(pl)?Me("exit",B,"stop",pl):null,Gi=vn!=null&&Number.isFinite(vn)?Me("exit",B,"limit",vn):null,La={side:B,qty:rs,entryIndex:ve,entryTimestamp:((mf=s[ve])==null?void 0:mf.timestamp)??Date.now(),entryPrice:Mt,entrySignalId:Be==null?void 0:Be.signalId,entryOrderId:Be==null?void 0:Be.orderId,entrySignalScore:(Be==null?void 0:Be.score)??null,entryNotional:yn,entryFee:Qn,entryFeeRemaining:Qn,stopPrice:mo&&Number.isFinite(mo)?mo:null,takePrice:Gi&&Number.isFinite(Gi)?Gi:null,trailingPct:Ln,trailingStop:Ln&&Ln>0?B==="long"?Me("exit",B,"stop",Mt*(1-Ln/100)):Me("exit",B,"stop",Mt*(1+Ln/100)):null,takeProfitOrders:[],maxFav:Mt,maxAdv:Mt},lc=(mp=wn==null?void 0:wn.takeProfits)!=null&&mp.length?wn.takeProfits:t.takeProfits;if(lc!=null&&lc.length){const Ea=[];let Tf=0;for(const Sr of lc){if(Tf>=rs)break;const Oa=Math.max(0,Math.min(rs-Tf,rs*Sr.qtyPct/100)),lr=xe(Oa,"floor");if(!Number.isFinite(lr)||lr<=0||v!=null&&lr<v&&lr<rs-Tf-1e-12)continue;const mr=B==="long"?Mt*(1+Sr.takeProfitPct/100):Mt*(1-Sr.takeProfitPct/100),Cr=Me("exit",B,"limit",mr);!Number.isFinite(Cr)||Cr<=0||(Ea.push({price:Cr,qty:lr,pct:Sr.takeProfitPct}),Tf+=lr)}La.takeProfitOrders=Ea.sort((Sr,Oa)=>B==="long"?Sr.price-Oa.price:Oa.price-Sr.price)}Al+=1;const wl=pt(B);if(t.closeMethod==="avg"&&wl.length){const Ea=wl[0],Tf=Ea.qty+La.qty,Sr=Ea.entryNotional+La.entryNotional,Oa=Tf>0?Sr/Tf:Ea.entryPrice;Ea.qty=Tf,Ea.entryNotional=Sr,Ea.entryPrice=Oa,Ea.entryFee+=La.entryFee,Ea.entryFeeRemaining+=La.entryFeeRemaining;const lr=t.stopLossPct,mr=t.takeProfitPct,Cr=t.trailingStopPct,hl=lr&&lr>0?B==="long"?Oa*(1-lr/100):Oa*(1+lr/100):null,ls=mr&&mr>0?B==="long"?Oa*(1+mr/100):Oa*(1-mr/100):null;if(Ea.stopPrice=hl!=null&&Number.isFinite(hl)?Me("exit",B,"stop",hl):null,Ea.takePrice=ls!=null&&Number.isFinite(ls)?Me("exit",B,"limit",ls):null,Ea.trailingPct=Cr,Ea.trailingStop=Cr&&Cr>0?B==="long"?Me("exit",B,"stop",Oa*(1-Cr/100)):Me("exit",B,"stop",Oa*(1+Cr/100)):null,Ea.takeProfitOrders=[],(_c=t.takeProfits)!=null&&_c.length){const ws=[];let Fs=0;for(const to of t.takeProfits){if(Fs>=Ea.qty)break;const cr=Math.max(0,Math.min(Ea.qty-Fs,Ea.qty*to.qtyPct/100)),io=xe(cr,"floor");if(!Number.isFinite(io)||io<=0)continue;const Yl=B==="long"?Oa*(1+to.takeProfitPct/100):Oa*(1-to.takeProfitPct/100),na=Me("exit",B,"limit",Yl);!Number.isFinite(na)||na<=0||(ws.push({price:na,qty:io,pct:to.takeProfitPct}),Fs+=io)}Ea.takeProfitOrders=ws.sort((to,cr)=>B==="long"?to.price-cr.price:cr.price-to.price)}return Ea.maxFav=Ea.maxFav==null?Oa:Ea.maxFav,Ea.maxAdv=Ea.maxAdv==null?Oa:Ea.maxAdv,{ok:!0,lot:Ea}}return wl.push(La),{ok:!0,lot:La}},ei=(B,ve,Fe,ot,tt)=>{const St=_a(B);if(!Number.isFinite(St)||St<=0)return 0;if(ot!=null&&Number.isFinite(ot)){const je=Math.abs(ot);return je>0?Math.min(St,je):0}if(tt!=null&&Number.isFinite(tt)){const je=Math.abs(tt);if(je<=0||!Number.isFinite(ve)||ve<=0)return 0;const Ze=(C>0?je*C:je)/ve;return Number.isFinite(Ze)&&Ze>0?Math.min(St,Ze):0}const Be=Number.isFinite(Fe)?Math.max(0,Math.min(100,Fe)):100;return Be<=0?0:St*Be/100},ai=(B,ve,Fe,ot="signal",tt,St="market",Be,je,Mt)=>{var lc;const Ze=B.side;p&&(B.qty=xe(B.qty,"round"));const rs=ri(Ze,Fe,St,Mt);if(!Number.isFinite(rs)||rs<=0)return null;const yn=B.qty,Qn=tt==null?yn:Math.max(0,Math.min(yn,tt)),wn=tt==null?p?xe(Qn,"round"):Qn:p?xe(Qn,"floor"):Qn;if(!Number.isFinite(wn)||wn<=0||v!=null&&tt!=null&&wn<v&&wn<yn-1e-12)return null;const xo=yn>0&&Number.isFinite(B.entryFeeRemaining)?B.entryFeeRemaining*wn/yn:0,hi=rs*wn,Ln=te(wn,hi,Mt),pl=je&&je>0?hi*je:0;Ke+=Ln,Ke+=pl;const vn=Ze==="long"?(rs-B.entryPrice)*wn:(B.entryPrice-rs)*wn;Oe+=vn;{const wl=Uf(Ze,B.entryIndex);wl.qtyExited+=wn,wl.exitNotional+=hi,wl.grossPnl+=vn,wl.fees+=xo+Ln+pl,wl.exits+=1,wl.exitIndex=ve,wl.exitTimestamp=jt(ve)}const mo=Number.isFinite(B.entryPrice)&&B.entryPrice>0?B.entryPrice*wn:NaN,Gi=(()=>{if(!(B.entryPrice<=0)&&!(B.maxAdv==null||!Number.isFinite(B.maxAdv)))return B.side==="long"?(B.maxAdv-B.entryPrice)/B.entryPrice*100:(B.entryPrice-B.maxAdv)/B.entryPrice*100})(),La=(()=>{if(!(B.entryPrice<=0)&&!(B.maxFav==null||!Number.isFinite(B.maxFav)))return B.side==="long"?(B.maxFav-B.entryPrice)/B.entryPrice*100:(B.entryPrice-B.maxFav)/B.entryPrice*100})();ut.push({side:Ze,qty:wn,entryIndex:B.entryIndex,entryTimestamp:B.entryTimestamp,entryPrice:B.entryPrice,entrySignalId:B.entrySignalId,entryOrderId:B.entryOrderId,entrySignalScore:B.entrySignalScore??null,exitIndex:ve,exitTimestamp:((lc=s[ve])==null?void 0:lc.timestamp)??Date.now(),exitPrice:rs,exitSignalId:Be==null?void 0:Be.signalId,exitOrderId:Be==null?void 0:Be.orderId,exitSignalScore:(Be==null?void 0:Be.score)??null,exitReason:ot,pnl:vn,pnlPct:Number.isFinite(mo)&&mo>0?vn/mo*100:0,fees:xo+Ln+pl,entryFee:xo,exitFee:Ln+pl,netPnl:vn-(xo+Ln+pl),maePct:typeof Gi=="number"&&Number.isFinite(Gi)?Gi:void 0,mfePct:typeof La=="number"&&Number.isFinite(La)?La:void 0}),rd+=Math.max(0,ve-B.entryIndex+1),Nl+=xo+Ln+pl,vn>0?(mu+=vn,du+=1):vn<0&&(Gc+=Math.abs(vn),Ju+=1);try{const wl=Xd[Ze];typeof Gi=="number"&&Number.isFinite(Gi)&&wl&&(wl.maeMin=wl.maeMin==null?Gi:Math.min(wl.maeMin,Gi)),typeof La=="number"&&Number.isFinite(La)&&wl&&(wl.mfeMax=wl.mfeMax==null?La:Math.max(wl.mfeMax,La))}catch{}return B.qty-=wn,p&&(B.qty=xe(B.qty,"round")),B.entryFeeRemaining=Math.max(0,B.entryFeeRemaining-xo),B.qty<=1e-12&&(B.entryFeeRemaining=0),{qtyClosed:wn,fees:xo+Ln+pl,exitFee:Ln+pl,execPrice:rs}},vi=(B,ve,Fe,ot="signal",tt="market",St,Be,je)=>{const Mt=pt(B);if(!Mt.length)return null;const Ze=Mt.slice();let rs=0,yn=0,Qn=0,wn=0;for(const xo of Ze)if(xo.qty>0){const hi=ai(xo,ve,Fe,ot,xo.qty,tt,St,Be,je);hi&&(rs+=hi.qtyClosed,yn+=hi.fees,Qn+=hi.exitFee,wn+=hi.execPrice*hi.qtyClosed)}return kt[B]=pt(B).filter(xo=>xo.qty>1e-12),xf(B),rs<=0?null:{qtyClosed:rs,fees:yn,exitFees:Qn,execPrice:wn/rs}},_a=B=>{const ve=pt(B);return ve.length?ve.reduce((Fe,ot)=>Fe+(ot.qty>0?ot.qty:0),0):0},dl=(B,ve,Fe,ot,tt="signal",St="market",Be,je,Mt)=>{const Ze=pt(B);if(!Ze.length)return null;let rs=Math.max(0,ot),yn=0,Qn=0,wn=0,xo=0;const hi=t.closeMethod==="lifo"?Ze.slice().reverse():Ze;for(const Ln of hi){if(rs<=0)break;if(Ln.qty<=0)continue;const pl=Math.min(Ln.qty,rs),vn=ai(Ln,ve,Fe,tt,pl,St,Be,je,Mt);vn&&(yn+=vn.qtyClosed,Qn+=vn.fees,wn+=vn.exitFee,xo+=vn.execPrice*vn.qtyClosed),rs-=pl}return kt[B]=pt(B).filter(Ln=>Ln.qty>1e-12),xf(B),yn<=0?null:{qtyClosed:yn,fees:Qn,exitFees:wn,execPrice:xo/yn}},ar=[],Jr=(B,ve)=>{for(let Fe=ar.length-1;Fe>=0;Fe--){const ot=ar[Fe];B(ot)&&(ke(ot.orderId,{status:"canceled",note:ve}),ar.splice(Fe,1))}},nl=(B,ve)=>{if(!B)return;const Fe=String(B).trim();Fe&&Jr(ot=>String(ot.signalId||"")===Fe||String(ot.orderId||"")===Fe,ve)},tc=B=>{Jr(()=>!0,B)},mc=B=>(B==null?void 0:B.order)||{},gu=B=>{const ve=typeof B=="number"?B:Number(B);return!Number.isFinite(ve)||ve<=0?100:Math.max(0,Math.min(100,ve))},Bl=B=>{const ve=typeof B=="number"?B:Number(B);return Number.isFinite(ve)?Math.max(0,ve):null},Ui=B=>{const ve=typeof B=="number"?B:Number(B);return Number.isFinite(ve)?ve:null},Ol=B=>{if(!B||typeof B!="object")return null;const ve=String(B.commissionType??B.commission_mode??B.commissionMode??"").trim().toLowerCase(),Fe=B.commissionCash??B.commission_cash??B.commissionFixed??B.commission_fixed??null,ot=B.commissionPerUnit??B.commission_per_unit??B.commissionPerShare??B.commission_per_share??null,tt=B.commissionValue??B.commission_value??null,St=B.commissionPct??B.commission??null;let Be=null,je=null;return ve==="cash"?(Be="cash",je=Ui(tt??Fe)):ve==="per_unit"||ve==="perunit"?(Be="per_unit",je=Ui(tt??ot)):ve==="percent"||ve==="pct"?(Be="percent",je=Bl(St),je!=null&&(je/=100)):ot!=null?(Be="per_unit",je=Ui(ot)):Fe!=null?(Be="cash",je=Ui(Fe)):tt!=null?(Be="percent",je=Bl(tt),je!=null&&(je/=100)):St!=null&&(Be="percent",je=Bl(St),je!=null&&(je/=100)),!Be||je==null||!Number.isFinite(je)?null:{commissionMode:Be,commissionValue:Math.max(0,je)}},fl=B=>{if(!B||typeof B!="object")return null;const ve=String(B.slippageType??B.slippage_mode??B.slippageMode??"").trim().toLowerCase(),Fe=B.slippageAbs??B.slippage_abs??null,ot=B.slippageTicks??B.slippage_ticks??null,tt=B.slippageValue??B.slippage_value??null,St=B.slippagePct??B.slippage??null;let Be=null,je=null;return ve==="abs"?(Be="abs",je=Ui(tt??Fe)):ve==="ticks"?(Be="ticks",je=Ui(tt??ot)):ve==="percent"||ve==="pct"?(Be="percent",je=Bl(St),je!=null&&(je/=100)):Fe!=null?(Be="abs",je=Ui(Fe)):ot!=null?(Be="ticks",je=Ui(ot)):tt!=null?(Be="percent",je=Bl(tt),je!=null&&(je/=100)):St!=null&&(Be="percent",je=Bl(St),je!=null&&(je/=100)),!Be||je==null||!Number.isFinite(je)?null:{slippageMode:Be,slippageValue:Math.max(0,je)}},bl=B=>{const ve=String(B||"market").trim().toLowerCase();return ve==="limit"||ve==="lit"?"limit":ve==="stop"||ve==="trailing_stop"?"stop":"market"},Ua=(B,ve,Fe,ot,tt)=>Number.isFinite(tt)?B==="entry"?ve==="long"?Fe==="limit"?ot.l<=tt:ot.h>=tt:Fe==="limit"?ot.h>=tt:ot.l<=tt:ve==="long"?Fe==="limit"?ot.h>=tt:ot.l<=tt:Fe==="limit"?ot.l<=tt:ot.h>=tt:!1,er=(B,ve,Fe)=>{for(const ot of Fe)B.side==="long"?ot==="high"?B.maxFav=B.maxFav==null?ve.h:Math.max(B.maxFav,ve.h):B.maxAdv=B.maxAdv==null?ve.l:Math.min(B.maxAdv,ve.l):ot==="low"?B.maxFav=B.maxFav==null?ve.l:Math.min(B.maxFav,ve.l):B.maxAdv=B.maxAdv==null?ve.h:Math.max(B.maxAdv,ve.h)},ba=B=>t.intrabarTieBreak==="ohlc"?t.ohlcPath==="open_high_low_close"?["high","low"]:["low","high"]:t.intrabarTieBreak==="best_case"?B==="long"?["high","low"]:["low","high"]:B==="long"?["low","high"]:["high","low"],ol=B=>{const{lot:ve,i:Fe,triggerPx:ot,reason:tt,qty:St,fillKind:Be,note:je}=B;if(!Number.isFinite(ot)||ot<=0||!Number.isFinite(St)||St<=0)return!1;const Mt=Be==="limit"?"limit":"stop",Ze=jt(Fe),rs=ft({action:"exit",side:ve.side,kind:Mt,originalKind:Mt,status:"pending",createdIndex:Fe,createdTimestamp:Ze,activeFromIndex:Fe,qtyPct:100,price:ot,note:je}),yn=ai(ve,Fe,ot,tt,St,Be,{orderId:rs.id});return yn?(ke(rs.id,{status:"filled",filledIndex:Fe,filledTimestamp:Ze,fillPrice:yn.execPrice,fillQty:yn.qtyClosed,fees:yn.exitFee,note:je}),!0):(ke(rs.id,{status:"rejected",note:`${je} (no fill)`}),!1)},xd=B=>{var ot;if(t.fillMode!=="volume")return Number.POSITIVE_INFINITY;const ve=Number((ot=s[B])==null?void 0:ot.volume);if(!Number.isFinite(ve)||ve<=0)return Number.POSITIVE_INFINITY;const Fe=ve*t.volumeFillPct/100;return Number.isFinite(Fe)&&Fe>0?Fe:Number.POSITIVE_INFINITY},_u=(B,ve,Fe)=>{if(B.targetQty!=null&&B.remainingQty!=null)return{ok:!0,target:B.targetQty,remaining:B.remainingQty};if(B.action==="entry"){const Be=Eo(B.side,ve,Fe,B.qtyPct,{qty:B.qty,cash:B.cash});return Be.ok?(B.targetQty=Be.qty,B.remainingQty=Be.qty,{ok:!0,target:Be.qty,remaining:Be.qty}):{ok:!1,reject:Be.reject}}const ot=ei(B.side,Fe,B.qtyPct,B.qty,B.cash),tt=xe(ot,"floor");if(!Number.isFinite(tt)||tt<=0)return{ok:!1,reject:"Qty <= 0"};const St=_a(B.side);return v!=null&&tt>0&&tt<v&&tt<St-1e-12?{ok:!1,reject:`Qty ${tt} < minQty ${v}`}:(B.targetQty=tt,B.remainingQty=tt,{ok:!0,target:tt,remaining:tt})},eu=B=>B.tif??t.timeInForce,ca=(B,ve,Fe,ot,tt,St)=>{const Be=_u(B,ve,Fe);if(!Be.ok)return ke(B.orderId,{status:"rejected",note:Be.reject}),{remove:!0,filled:!1};const je=eu(B),Mt=Be.remaining,Ze=xd(ve),rs=Math.min(Mt,Ze);if(je==="fok"&&rs+1e-12<Mt)return ke(B.orderId,{status:"rejected",note:"FOK not fully filled"}),{remove:!0,filled:!1};if(je==="ioc"&&rs<=0)return ke(B.orderId,{status:"canceled",note:"IOC not filled"}),{remove:!0,filled:!1};if(rs<=0)return{remove:!1,filled:!1};const yn=B.slippageMode!=null||B.slippageValue!=null||B.commissionMode!=null||B.commissionValue!=null?{slippageMode:B.slippageMode,slippageValue:B.slippageValue,commissionMode:B.commissionMode,commissionValue:B.commissionValue}:void 0,Qn=jt(ve);let wn=0,xo=Fe,hi=0,Ln=!1;if(B.action==="entry"){if(t.positionMode==="netting"){const Gi=zt(B.side);if(Rt(Gi)){const La=ft({action:"exit",side:Gi,kind:ot==="limit"?"limit":"market",originalKind:"market",status:"pending",createdIndex:ve,createdTimestamp:Qn,activeFromIndex:ve,qtyPct:100,price:Fe,note:"AUTO netting close (reverse)"}),lc=vi(Gi,ve,Fe,"signal",ot,{orderId:La.id,signalId:B.signalId,score:B.score??null});ke(La.id,{status:lc?"filled":"rejected",filledIndex:lc?ve:void 0,filledTimestamp:lc?Qn:void 0,fillPrice:lc==null?void 0:lc.execPrice,fillQty:(lc==null?void 0:lc.qtyClosed)??0,fees:(lc==null?void 0:lc.exitFees)??0,note:lc?"AUTO netting close (reverse)":"AUTO netting close failed"})}}const mo=hr(B.side,ve,Fe,B.qtyPct,ot,B.bracket,{orderId:B.orderId,signalId:B.signalId,score:B.score??null},{qty:rs,...yn});if(mo.ok){const Gi=mo.lot;if(wn=Gi.qty,xo=Gi.entryPrice,hi=Gi.entryFee,Ln=!0,t.execution!=="bar_close"){const La=ba(B.side),lc=La.indexOf(tt),wl=lc>=0?La.slice(lc+1):La;er(Gi,St,wl),vc(B.side,ve,St,wl)}}}else{const mo=rs>=_a(B.side)-1e-12?vi(B.side,ve,Fe,"signal",ot,{orderId:B.orderId,signalId:B.signalId,score:B.score??null},void 0,yn):dl(B.side,ve,Fe,rs,"signal",ot,{orderId:B.orderId,signalId:B.signalId,score:B.score??null},void 0,yn);mo&&(wn=mo.qtyClosed,xo=mo.execPrice,hi=mo.exitFees,Ln=!0)}if(!Ln||wn<=0)return ke(B.orderId,{status:"rejected",note:"Order not filled"}),{remove:!0,filled:!1};const pl=Math.max(0,Mt-wn),vn=pl<=1e-12?"filled":"partial";return Se({id:B.orderId,index:ve,timestamp:Qn,qty:wn,price:xo,fees:hi,targetQty:Be.target,remainingQty:pl,status:vn,note:vn==="partial"?"Partial fill":void 0}),B.remainingQty=pl,B.targetQty=Be.target,je==="ioc"?(pl>1e-12&&ke(B.orderId,{status:"canceled",note:"IOC remainder canceled"}),{remove:!0,filled:!0}):{remove:pl<=1e-12,filled:!0}},vc=(B,ve,Fe,ot)=>{if(!Rt(B)||t.execution==="bar_close")return!1;let tt=!1;const St=Be=>{var je,Mt;for(const Ze of pt(B)){if(Ze.qty<=0)continue;const rs=Te(Fe,"exit",Ze.side);if(Ze.trailingPct&&Ze.trailingPct>0){const yn=Ze.trailingPct/100;if(Ze.side==="long"&&Be==="high"){const Qn=Fe.h*(1-yn);Ze.trailingStop=Ze.trailingStop==null?Qn:Math.max(Ze.trailingStop,Qn)}if(Ze.side==="short"&&Be==="low"){const Qn=Fe.l*(1+yn);Ze.trailingStop=Ze.trailingStop==null?Qn:Math.min(Ze.trailingStop,Qn)}}if(Ze.side==="long"&&Be==="high"){if((je=Ze.takeProfitOrders)!=null&&je.length){const yn=[];for(const Qn of Ze.takeProfitOrders){if(Ze.qty<=0)break;rs.h>=Qn.price?tt=ol({lot:Ze,i:ve,triggerPx:Qn.price,reason:"take_profit",qty:Qn.qty,fillKind:"limit",note:`AUTO take_profit (${Qn.pct}%)`})||tt:yn.push(Qn)}Ze.takeProfitOrders=yn}Ze.takePrice!=null&&rs.h>=Ze.takePrice&&Ze.qty>0&&(tt=ol({lot:Ze,i:ve,triggerPx:Ze.takePrice,reason:"take_profit",qty:Ze.qty,fillKind:"limit",note:"AUTO take_profit"})||tt)}if(Ze.side==="short"&&Be==="low"){if((Mt=Ze.takeProfitOrders)!=null&&Mt.length){const yn=[];for(const Qn of Ze.takeProfitOrders){if(Ze.qty<=0)break;rs.l<=Qn.price?tt=ol({lot:Ze,i:ve,triggerPx:Qn.price,reason:"take_profit",qty:Qn.qty,fillKind:"limit",note:`AUTO take_profit (${Qn.pct}%)`})||tt:yn.push(Qn)}Ze.takeProfitOrders=yn}Ze.takePrice!=null&&rs.l<=Ze.takePrice&&Ze.qty>0&&(tt=ol({lot:Ze,i:ve,triggerPx:Ze.takePrice,reason:"take_profit",qty:Ze.qty,fillKind:"limit",note:"AUTO take_profit"})||tt)}if(Ze.side==="long"&&Be==="low"){if(Ze.stopPrice!=null&&rs.l<=Ze.stopPrice){tt=ol({lot:Ze,i:ve,triggerPx:Ze.stopPrice,reason:"stop_loss",qty:Ze.qty,fillKind:"stop",note:"AUTO stop_loss"})||tt;continue}Ze.trailingStop!=null&&rs.l<=Ze.trailingStop&&(tt=ol({lot:Ze,i:ve,triggerPx:Ze.trailingStop,reason:"trailing_stop",qty:Ze.qty,fillKind:"stop",note:"AUTO trailing_stop"})||tt)}if(Ze.side==="short"&&Be==="high"){if(Ze.stopPrice!=null&&rs.h>=Ze.stopPrice){tt=ol({lot:Ze,i:ve,triggerPx:Ze.stopPrice,reason:"stop_loss",qty:Ze.qty,fillKind:"stop",note:"AUTO stop_loss"})||tt;continue}Ze.trailingStop!=null&&rs.h>=Ze.trailingStop&&(tt=ol({lot:Ze,i:ve,triggerPx:Ze.trailingStop,reason:"trailing_stop",qty:Ze.qty,fillKind:"stop",note:"AUTO trailing_stop"})||tt)}}kt[B]=pt(B).filter(Ze=>Ze.qty>1e-12),xf(B)};for(const Be of ot){if(!Rt(B))break;St(Be)}return tt},rc=(B,ve)=>{if(B)for(let Fe=ar.length-1;Fe>=0;Fe--){const ot=ar[Fe];(ot==null?void 0:ot.ocoGroup)===B&&(ve&&ot.orderId===ve||(ke(ot.orderId,{status:"canceled",note:"OCO canceled"}),ar.splice(Fe,1)))}},wd=(B,ve,Fe)=>B==="entry"?ve==="long"?Fe==="limit"?"low":"high":Fe==="limit"?"high":"low":ve==="long"?Fe==="limit"?"high":"low":Fe==="limit"?"low":"high",zl=(B,ve,Fe,ot,tt)=>{const St=tt.o;if(!Number.isFinite(St)||!Number.isFinite(ot))return{px:ot,fillsAtOpen:!1};const Be=St*Ne(B,ve);return Fe==="limit"?B==="entry"&&ve==="long"&&St<=ot||B==="entry"&&ve==="short"&&St>=ot||B==="exit"&&ve==="long"&&St>=ot||B==="exit"&&ve==="short"&&St<=ot?{px:Be,fillsAtOpen:!0}:{px:ot,fillsAtOpen:!1}:B==="entry"&&ve==="long"&&St>=ot||B==="entry"&&ve==="short"&&St<=ot||B==="exit"&&ve==="long"&&St<=ot||B==="exit"&&ve==="short"&&St>=ot?{px:St,fillsAtOpen:!0}:{px:ot,fillsAtOpen:!1}},Fd=(B,ve,Fe)=>{var Be,je;if(!Rt(B)||t.execution==="bar_close")return!1;const ot=Fe.o;if(!Number.isFinite(ot)||ot<=0)return!1;const tt=ot*Ne("exit",B);let St=!1;for(const Mt of pt(B).slice())if(!(Mt.qty<=0))if(Mt.side==="long"){if(Mt.stopPrice!=null&&tt<=Mt.stopPrice){St=ol({lot:Mt,i:ve,triggerPx:ot,reason:"stop_loss",qty:Mt.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||St;continue}if(Mt.trailingStop!=null&&tt<=Mt.trailingStop){St=ol({lot:Mt,i:ve,triggerPx:ot,reason:"trailing_stop",qty:Mt.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||St;continue}if((Be=Mt.takeProfitOrders)!=null&&Be.length){const Ze=[];for(const rs of Mt.takeProfitOrders){if(Mt.qty<=0)break;tt>=rs.price?St=ol({lot:Mt,i:ve,triggerPx:tt,reason:"take_profit",qty:rs.qty,fillKind:"limit",note:`AUTO take_profit (${rs.pct}%) (gap)`})||St:Ze.push(rs)}Mt.takeProfitOrders=Ze}Mt.takePrice!=null&&tt>=Mt.takePrice&&Mt.qty>0&&(St=ol({lot:Mt,i:ve,triggerPx:tt,reason:"take_profit",qty:Mt.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||St)}else{if(Mt.stopPrice!=null&&tt>=Mt.stopPrice){St=ol({lot:Mt,i:ve,triggerPx:ot,reason:"stop_loss",qty:Mt.qty,fillKind:"stop",note:"AUTO stop_loss (gap)"})||St;continue}if(Mt.trailingStop!=null&&tt>=Mt.trailingStop){St=ol({lot:Mt,i:ve,triggerPx:ot,reason:"trailing_stop",qty:Mt.qty,fillKind:"stop",note:"AUTO trailing_stop (gap)"})||St;continue}if((je=Mt.takeProfitOrders)!=null&&je.length){const Ze=[];for(const rs of Mt.takeProfitOrders){if(Mt.qty<=0)break;tt<=rs.price?St=ol({lot:Mt,i:ve,triggerPx:tt,reason:"take_profit",qty:rs.qty,fillKind:"limit",note:`AUTO take_profit (${rs.pct}%) (gap)`})||St:Ze.push(rs)}Mt.takeProfitOrders=Ze}Mt.takePrice!=null&&tt<=Mt.takePrice&&Mt.qty>0&&(St=ol({lot:Mt,i:ve,triggerPx:tt,reason:"take_profit",qty:Mt.qty,fillKind:"limit",note:"AUTO take_profit (gap)"})||St)}return kt[B]=pt(B).filter(Mt=>Mt.qty>1e-12),xf(B),St},Tl=(B,ve)=>{if(!ar.length)return;if(vu){tc("Canceled by risk limit");return}ne!=null&&Al>=ne&&Jr(je=>je.action==="entry","Max intraday filled orders reached");for(let je=ar.length-1;je>=0;je--){const Mt=ar[je];if(!(B<Mt.activeFromIndex)){if(Mt.expiresAtIndex!=null&&B>Mt.expiresAtIndex){ke(Mt.orderId,{status:"expired",note:"Expired"}),ar.splice(je,1);continue}if(Mt.action==="exit"&&!Rt(Mt.side)){ke(Mt.orderId,{status:"canceled",note:"No position"}),ar.splice(je,1);continue}}}for(const je of ar){if(je.kind!=="trailing_stop"||B<je.activeFromIndex||je.action!=="exit"||!Rt(je.side))continue;const Mt=typeof je.trailPct=="number"&&Number.isFinite(je.trailPct)?je.trailPct:null,Ze=typeof je.trailOffset=="number"&&Number.isFinite(je.trailOffset)?je.trailOffset:null,rs=typeof je.trailPrice=="number"&&Number.isFinite(je.trailPrice)?je.trailPrice:je.side==="long"?ve.h:ve.l,yn=Ze??(Mt!=null&&Mt>0?rs*Mt/100:null);if(!(!yn||!Number.isFinite(yn)||yn<=0))if(je.side==="long"){const Qn=rs-yn;je.price=je.price==null?Qn:Math.max(je.price,Qn)}else{const Qn=rs+yn;je.price=je.price==null?Qn:Math.min(je.price,Qn)}}const Fe=[];for(let je=0;je<ar.length;je++){const Mt=ar[je];if(B<Mt.activeFromIndex||Mt.expiresAtIndex!=null&&B>Mt.expiresAtIndex)continue;const Ze=Te(ve,Mt.action,Mt.side);if(Mt.action==="exit"){if(!Rt(Mt.side))continue}else if(Ft(Mt.side)>=t.pyramiding)continue;const rs=Mt.ocoGroup||`__solo__${Mt.orderId||je}`,yn=Mt.action==="exit"?0:1,Qn=ba(Mt.side);if(Mt.kind==="stop_limit"){const La=Mt.stopPrice??Mt.price,lc=Mt.limitPrice??Mt.price;if(!Number.isFinite(La)||!Number.isFinite(lc)||!Ua(Mt.action,Mt.side,"stop",Ze,La))continue;const mf=wd(Mt.action,Mt.side,"stop"),mp=Qn.indexOf(mf),_c=zl(Mt.action,Mt.side,"stop",La,ve),Ea=_c.fillsAtOpen?0:mp>=0?mp+1:99,Tf=mf==="high"?La:-La;Fe.push({groupKey:rs,orderId:Mt.orderId,pi:je,action:Mt.action,side:Mt.side,kind:"stop_limit",triggerExt:mf,phase:Ea,actionRank:yn,priceRank:Tf,sp:La,lp:lc,stopAtOpen:_c.fillsAtOpen,limitAtOpen:zl(Mt.action,Mt.side,"limit",lc,ve).fillsAtOpen});continue}const wn=Mt.price;if(wn==null||!Number.isFinite(wn))continue;const xo=Mt.kind==="stop"||Mt.kind==="trailing_stop"?"stop":"limit";if(!Ua(Mt.action,Mt.side,xo,Ze,wn))continue;const Ln=wd(Mt.action,Mt.side,xo),pl=Qn.indexOf(Ln),mo=zl(Mt.action,Mt.side,xo,wn,ve).fillsAtOpen?0:pl>=0?pl+1:99,Gi=Ln==="high"?wn:-wn;Fe.push({groupKey:rs,orderId:Mt.orderId,pi:je,action:Mt.action,side:Mt.side,kind:Mt.kind,triggerKind:xo,triggerExt:Ln,phase:mo,actionRank:yn,priceRank:Gi,px:wn})}if(!Fe.length)return;const ot=new Map,tt=(je,Mt)=>je.phase!==Mt.phase?je.phase<Mt.phase?je:Mt:je.actionRank!==Mt.actionRank?je.actionRank<Mt.actionRank?je:Mt:je.priceRank!==Mt.priceRank?je.priceRank<Mt.priceRank?je:Mt:je.pi<Mt.pi?je:Mt;for(const je of Fe){const Mt=ot.get(je.groupKey);ot.set(je.groupKey,Mt?tt(Mt,je):je)}const St=Array.from(ot.values()).sort((je,Mt)=>je.phase!==Mt.phase?je.phase-Mt.phase:je.actionRank!==Mt.actionRank?je.actionRank-Mt.actionRank:je.priceRank!==Mt.priceRank?je.priceRank-Mt.priceRank:je.pi-Mt.pi),Be=(je,Mt)=>{if(je){const Ze=ar.findIndex(rs=>rs.orderId===je);if(Ze>=0)return Ze}return typeof Mt=="number"?Mt:-1};for(const je of St){const Mt=Be(je.orderId,je.pi);if(Mt<0||Mt>=ar.length)continue;const Ze=ar[Mt];if(B<Ze.activeFromIndex||Ze.expiresAtIndex!=null&&B>Ze.expiresAtIndex)continue;const rs=Te(ve,Ze.action,Ze.side);if(Ze.action==="exit"){if(!Rt(Ze.side)){ke(Ze.orderId,{status:"canceled",note:"No position"}),ar.splice(Mt,1);continue}}else if(Ft(Ze.side)>=t.pyramiding)continue;if(Ze.kind==="stop_limit"){const vn=Ze.stopPrice??Ze.price,mo=Ze.limitPrice??Ze.price;if(!Number.isFinite(vn)||!Number.isFinite(mo)||!Ua(Ze.action,Ze.side,"stop",rs,vn))continue;const La=Ua(Ze.action,Ze.side,"limit",rs,mo),lc=wd(Ze.action,Ze.side,"stop"),wl=wd(Ze.action,Ze.side,"limit"),mf=ba(Ze.side),mp=mf.indexOf(lc),_c=mf.indexOf(wl);if(La&&mp>=0&&_c>=0&&mp<_c){const Sr=zl(Ze.action,Ze.side,"limit",mo,ve).px,Oa=ca(Ze,B,Sr,"limit",lc,ve);Oa.filled&&rc(Ze.ocoGroup,Ze.orderId),Oa.remove?ar.splice(Mt,1):Ze.remainingQty!=null&&Ze.remainingQty>1e-12&&(Ze.kind="limit",Ze.price=mo,Ze.activeFromIndex=B+1);continue}ke(Ze.orderId,{kind:"limit",note:"Stop triggered → limit active next bar"}),Ze.kind="limit",Ze.price=mo,Ze.activeFromIndex=B+1;continue}const yn=Ze.price;if(yn==null||!Number.isFinite(yn))continue;const Qn=Ze.kind==="stop"||Ze.kind==="trailing_stop"?"stop":"limit";if(!Ua(Ze.action,Ze.side,Qn,rs,yn))continue;let xo=bl(Ze.kind),hi=zl(Ze.action,Ze.side,Qn,yn,ve).px;const Ln=wd(Ze.action,Ze.side,Qn);if(Ze.kind==="lit"){const vn=typeof Ze.limitPrice=="number"&&Number.isFinite(Ze.limitPrice)?Ze.limitPrice:yn;if(!Ua(Ze.action,Ze.side,"limit",rs,vn)){ke(Ze.orderId,{kind:"limit",note:"LIT triggered → limit active next bar"}),Ze.kind="limit",Ze.price=vn,Ze.activeFromIndex=B+1;continue}hi=zl(Ze.action,Ze.side,"limit",vn,ve).px,xo="limit"}const pl=ca(Ze,B,hi,xo,Ln,ve);pl.filled&&rc(Ze.ocoGroup,Ze.orderId),pl.remove&&ar.splice(Mt,1)}},xa=(B,ve)=>{if(!Ht()||t.execution==="bar_close")return!1;const Fe=Fd("long",B,ve),ot=Fd("short",B,ve),tt=vc("long",B,ve,ba("long")),St=vc("short",B,ve,ba("short"));return Fe||ot||tt||St};let ku=0,Qu=0;for(let B=ec;B<=yl;B++){const ve=Bse(s[B]);if(!ve)continue;const Fe=ve.c;bo(B,Fe,ec);const ot=Number((Qe=s[B])==null?void 0:Qe.timestamp);if(Number.isFinite(ot)&&ot>0){const Be=new Date(ot).toISOString().slice(0,10);Be&&Be!==sa&&(sa=Be,Vc=Uu(B,Fe),Al=0)}for(const Be of pt("long"))Be.qty<=0||(Be.maxFav=Be.maxFav==null?ve.h:Math.max(Be.maxFav,ve.h),Be.maxAdv=Be.maxAdv==null?ve.l:Math.min(Be.maxAdv,ve.l));for(const Be of pt("short"))Be.qty<=0||(Be.maxFav=Be.maxFav==null?ve.l:Math.min(Be.maxFav,ve.l),Be.maxAdv=Be.maxAdv==null?ve.h:Math.max(Be.maxAdv,ve.h));for(Ht()&&xa(B,ve),Tl(B,ve),Qi(B,ve);la<qi.length&&qi[la].index===B;){const Be=qi[la];if(Be.type==="cancel"){nl(Be.orderId??Be.signalId,"Canceled by strategy.cancel"),la+=1;continue}if(Be.type==="cancel_all"){tc("Canceled by strategy.cancel_all"),la+=1;continue}const je=mc(Be),Ze=String((je==null?void 0:je.kind)||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit").replace(/market[_\s-]*if[_\s-]*touched|mit/g,"mit").replace(/limit[_\s-]*if[_\s-]*touched|lit/g,"lit").replace(/trailing[_\s-]*stop/g,"trailing_stop"),rs=gu(je==null?void 0:je.qtyPct),yn=je==null?void 0:je.qty,Qn=je==null?void 0:je.cash,wn=typeof yn=="number"&&Number.isFinite(yn)?yn:Number(yn),xo=typeof Qn=="number"&&Number.isFinite(Qn)?Qn:Number(Qn),hi=Number.isFinite(wn)?wn:void 0,Ln=Number.isFinite(xo)?xo:void 0,pl=Ol(je),vn=fl(je),mo=pl||vn?{...pl,...vn}:void 0,Gi=typeof(je==null?void 0:je.oco)=="string"&&String(je.oco).trim()?String(je.oco).trim():void 0,La=String((je==null?void 0:je.tif)??(je==null?void 0:je.timeInForce)??"").trim().toLowerCase(),wl=La?La==="ioc"||La==="immediate_or_cancel"?"ioc":La==="fok"||La==="fill_or_kill"?"fok":"gtc":t.timeInForce,mf=je==null?void 0:je.expiresBars,mp=typeof mf=="number"&&Number.isFinite(mf)&&mf>0?Math.floor(mf):La==="day"?1:null,_c=mp?B+mp:void 0,Ea=Ti(je==null?void 0:je.bracket),Tf=(je==null?void 0:je.trailPct)??(je==null?void 0:je.trail_percent)??(je==null?void 0:je.trailPercent)??(je==null?void 0:je.trailingStopPct)??(je==null?void 0:je.trailing_stop_pct)??null,Sr=(je==null?void 0:je.trailOffset)??(je==null?void 0:je.trailPoints)??(je==null?void 0:je.trail_points)??(je==null?void 0:je.trail_offset)??null,Oa=(je==null?void 0:je.trailPrice)??(je==null?void 0:je.trail_price)??null,lr=Bl(Tf),mr=Ui(Sr),Cr=Ui(Oa),hl=vu?"Risk limit reached":ne!=null&&Al>=ne?"Max intraday filled orders reached":null,ls={commissionMode:mo==null?void 0:mo.commissionMode,commissionValue:mo==null?void 0:mo.commissionValue,slippageMode:mo==null?void 0:mo.slippageMode,slippageValue:mo==null?void 0:mo.slippageValue},ws={qtyPct:rs,qty:hi,cash:Ln,tif:wl,trailPct:lr??void 0,trailOffset:mr??void 0,trailPrice:Cr??void 0,...ls},Fs=(Ze==="limit"||Ze==="stop"||Ze==="mit"||Ze==="lit")&&typeof(je==null?void 0:je.price)=="number"?je.price:Fe,to=typeof(je==null?void 0:je.stopPrice)=="number"?je.stopPrice:typeof(je==null?void 0:je.price)=="number"?je.price:Fe,cr=typeof(je==null?void 0:je.limitPrice)=="number"?je.limitPrice:typeof(je==null?void 0:je.price)=="number"?je.price:Fe,io=Ze==="limit"||Ze==="stop"||Ze==="mit"||Ze==="lit"?Me(Be.type.startsWith("entry")?"entry":"exit",Be.type.endsWith("long")?"long":"short",Ze==="stop"?"stop":"limit",Fs):Fs,Yl=Ze==="stop_limit"?Me(Be.type.startsWith("entry")?"entry":"exit",Be.type.endsWith("long")?"long":"short","stop",to):to,na=Ze==="stop_limit"||Ze==="lit"?Me(Be.type.startsWith("entry")?"entry":"exit",Be.type.endsWith("long")?"long":"short","limit",cr):cr,Od=jt(B),qr=Ze==="limit"||Ze==="stop"||Ze==="stop_limit"||Ze==="mit"||Ze==="lit"||Ze==="trailing_stop"?Ze:"market";if(Be.type==="exit_long"&&Rt("long"))if(qr==="stop_limit"){if(Number.isFinite(Yl)&&Yl>0&&Number.isFinite(na)&&na>0){const za=ft({action:"exit",side:"long",kind:"stop_limit",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,stopPrice:Yl,limitPrice:na});ar.push({action:"exit",side:"long",kind:"stop_limit",signalId:Be.signalId,score:Be.score??null,stopPrice:Yl,limitPrice:na,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,...ws,orderId:za.id})}}else if(qr==="limit"||qr==="stop"||qr==="mit"||qr==="lit"||qr==="trailing_stop"){if(Number.isFinite(io)&&io>0){const za=typeof Cr=="number"&&Number.isFinite(Cr)?Cr:Fe,Yc=mr!=null&&Number.isFinite(mr)?mr:lr!=null&&Number.isFinite(lr)?za*lr/100:null,Na=qr==="trailing_stop"&&Yc!=null?Me("exit","long","stop",za-Yc):io,Rc=ft({action:"exit",side:"long",kind:qr,originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,trailPct:lr??void 0,trailOffset:mr??void 0,trailPrice:Cr??void 0,price:Na,limitPrice:qr==="lit"?na:void 0});ar.push({action:"exit",side:"long",kind:qr,signalId:Be.signalId,score:Be.score??null,price:Na,limitPrice:qr==="lit"?na:void 0,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,...ws,orderId:Rc.id})}}else{const za=_a("long"),Yc=ei("long",Fe,rs,hi,Ln),Na=xe(Yc,"floor"),Rc=ft({action:"exit",side:"long",kind:"market",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl});if(v!=null&&Na>0&&Na<v&&Na<za-1e-12)ke(Rc.id,{status:"rejected",note:`Qty ${Na} < minQty ${v}`});else{const Ir=Na>=za-1e-12?vi("long",B,Fe,"signal","market",{signalId:Be.signalId,orderId:Rc.id,score:Be.score??null},void 0,mo):dl("long",B,Fe,Na,"signal","market",{signalId:Be.signalId,orderId:Rc.id,score:Be.score??null},void 0,mo);ke(Rc.id,{status:Ir?"filled":"rejected",filledIndex:Ir?B:void 0,filledTimestamp:Ir?Od:void 0,fillPrice:(Ir==null?void 0:Ir.execPrice)??ri("long",Fe,"market"),fillQty:(Ir==null?void 0:Ir.qtyClosed)??0,fees:(Ir==null?void 0:Ir.exitFees)??0,note:Ir?void 0:"Exit not filled"})}}else if(Be.type==="exit_short"&&Rt("short"))if(qr==="stop_limit"){if(Number.isFinite(Yl)&&Yl>0&&Number.isFinite(na)&&na>0){const za=ft({action:"exit",side:"short",kind:"stop_limit",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,stopPrice:Yl,limitPrice:na});ar.push({action:"exit",side:"short",kind:"stop_limit",signalId:Be.signalId,score:Be.score??null,stopPrice:Yl,limitPrice:na,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,...ws,orderId:za.id})}}else if(qr==="limit"||qr==="stop"||qr==="mit"||qr==="lit"||qr==="trailing_stop"){if(Number.isFinite(io)&&io>0){const za=typeof Cr=="number"&&Number.isFinite(Cr)?Cr:Fe,Yc=mr!=null&&Number.isFinite(mr)?mr:lr!=null&&Number.isFinite(lr)?za*lr/100:null,Na=qr==="trailing_stop"&&Yc!=null?Me("exit","short","stop",za+Yc):io,Rc=ft({action:"exit",side:"short",kind:qr,originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,trailPct:lr??void 0,trailOffset:mr??void 0,trailPrice:Cr??void 0,price:Na,limitPrice:qr==="lit"?na:void 0});ar.push({action:"exit",side:"short",kind:qr,signalId:Be.signalId,score:Be.score??null,price:Na,limitPrice:qr==="lit"?na:void 0,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,...ws,orderId:Rc.id})}}else{const za=_a("short"),Yc=ei("short",Fe,rs,hi,Ln),Na=xe(Yc,"floor"),Rc=ft({action:"exit",side:"short",kind:"market",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl});if(v!=null&&Na>0&&Na<v&&Na<za-1e-12)ke(Rc.id,{status:"rejected",note:`Qty ${Na} < minQty ${v}`});else{const Ir=Na>=za-1e-12?vi("short",B,Fe,"signal","market",{signalId:Be.signalId,orderId:Rc.id,score:Be.score??null},void 0,mo):dl("short",B,Fe,Na,"signal","market",{signalId:Be.signalId,orderId:Rc.id,score:Be.score??null},void 0,mo);ke(Rc.id,{status:Ir?"filled":"rejected",filledIndex:Ir?B:void 0,filledTimestamp:Ir?Od:void 0,fillPrice:(Ir==null?void 0:Ir.execPrice)??ri("short",Fe,"market"),fillQty:(Ir==null?void 0:Ir.qtyClosed)??0,fees:(Ir==null?void 0:Ir.exitFees)??0,note:Ir?void 0:"Exit not filled"})}}else if(Be.type==="entry_long"&&t.allowLong)if(qr==="stop_limit"){if(Number.isFinite(Yl)&&Yl>0&&Number.isFinite(na)&&na>0){const za=ft({action:"entry",side:"long",kind:"stop_limit",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,stopPrice:Yl,limitPrice:na});hl?ke(za.id,{status:"rejected",note:hl}):ar.push({action:"entry",side:"long",kind:"stop_limit",signalId:Be.signalId,score:Be.score??null,stopPrice:Yl,limitPrice:na,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,bracket:Ea,...ws,orderId:za.id})}}else if(qr==="limit"||qr==="stop"||qr==="mit"||qr==="lit"||qr==="trailing_stop"){if(Number.isFinite(io)&&io>0){const za=typeof Cr=="number"&&Number.isFinite(Cr)?Cr:Fe,Yc=mr!=null&&Number.isFinite(mr)?mr:lr!=null&&Number.isFinite(lr)?za*lr/100:null,Na=qr==="trailing_stop"&&Yc!=null?Me("entry","long","stop",za+Yc):io,Rc=ft({action:"entry",side:"long",kind:qr,originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,trailPct:lr??void 0,trailOffset:mr??void 0,trailPrice:Cr??void 0,price:Na,limitPrice:qr==="lit"?na:void 0});hl?ke(Rc.id,{status:"rejected",note:hl}):ar.push({action:"entry",side:"long",kind:qr,signalId:Be.signalId,score:Be.score??null,price:Na,limitPrice:qr==="lit"?na:void 0,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,bracket:Ea,...ws,orderId:Rc.id})}}else{const za=ft({action:"entry",side:"long",kind:"market",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl});if(hl){ke(za.id,{status:"rejected",note:hl}),la+=1;continue}if(t.positionMode==="netting"){const Na="short";if(Rt(Na)){const Rc=ft({action:"exit",side:Na,kind:"market",originalKind:"market",status:"pending",createdIndex:B,createdTimestamp:Od,activeFromIndex:B,qtyPct:100,price:Fe,note:"AUTO netting close (reverse)"}),Ir=vi(Na,B,Fe,"signal","market",{signalId:Be.signalId,orderId:Rc.id,score:Be.score??null});ke(Rc.id,{status:Ir?"filled":"rejected",filledIndex:Ir?B:void 0,filledTimestamp:Ir?Od:void 0,fillPrice:(Ir==null?void 0:Ir.execPrice)??ri(Na,Fe,"market"),fillQty:(Ir==null?void 0:Ir.qtyClosed)??0,fees:(Ir==null?void 0:Ir.exitFees)??0})}}const Yc=hr("long",B,Fe,rs,"market",Ea,{signalId:Be.signalId,orderId:za.id,score:Be.score??null},{qty:hi,cash:Ln,...mo});if(Yc.ok){const Na=Yc.lot;ke(za.id,{status:"filled",filledIndex:B,filledTimestamp:Od,fillPrice:Na.entryPrice,fillQty:Na.qty,fees:Na.entryFee})}else ke(za.id,{status:"rejected",note:Yc.reject||"Entry blocked"})}else if(Be.type==="entry_short"&&t.allowShort)if(qr==="stop_limit"){if(Number.isFinite(Yl)&&Yl>0&&Number.isFinite(na)&&na>0){const za=ft({action:"entry",side:"short",kind:"stop_limit",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,stopPrice:Yl,limitPrice:na});hl?ke(za.id,{status:"rejected",note:hl}):ar.push({action:"entry",side:"short",kind:"stop_limit",signalId:Be.signalId,score:Be.score??null,stopPrice:Yl,limitPrice:na,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,bracket:Ea,...ws,orderId:za.id})}}else if(qr==="limit"||qr==="stop"||qr==="mit"||qr==="lit"||qr==="trailing_stop"){if(Number.isFinite(io)&&io>0){const za=typeof Cr=="number"&&Number.isFinite(Cr)?Cr:Fe,Yc=mr!=null&&Number.isFinite(mr)?mr:lr!=null&&Number.isFinite(lr)?za*lr/100:null,Na=qr==="trailing_stop"&&Yc!=null?Me("entry","short","stop",za-Yc):io,Rc=ft({action:"entry",side:"short",kind:qr,originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B+1,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl,trailPct:lr??void 0,trailOffset:mr??void 0,trailPrice:Cr??void 0,price:Na,limitPrice:qr==="lit"?na:void 0});hl?ke(Rc.id,{status:"rejected",note:hl}):ar.push({action:"entry",side:"short",kind:qr,signalId:Be.signalId,score:Be.score??null,price:Na,limitPrice:qr==="lit"?na:void 0,activeFromIndex:B+1,expiresAtIndex:_c,ocoGroup:Gi,bracket:Ea,...ws,orderId:Rc.id})}}else{const za=ft({action:"entry",side:"short",kind:"market",originalKind:qr,status:"pending",signalId:Be.signalId,ocoGroup:Gi,createdIndex:B,createdTimestamp:Od,activeFromIndex:B,expiresAtIndex:_c,qtyPct:rs,qty:hi,cash:Ln,tif:wl});if(hl){ke(za.id,{status:"rejected",note:hl}),la+=1;continue}if(t.positionMode==="netting"){const Na="long";if(Rt(Na)){const Rc=ft({action:"exit",side:Na,kind:"market",originalKind:"market",status:"pending",createdIndex:B,createdTimestamp:Od,activeFromIndex:B,qtyPct:100,price:Fe,note:"AUTO netting close (reverse)"}),Ir=vi(Na,B,Fe,"signal","market",{signalId:Be.signalId,orderId:Rc.id,score:Be.score??null});ke(Rc.id,{status:Ir?"filled":"rejected",filledIndex:Ir?B:void 0,filledTimestamp:Ir?Od:void 0,fillPrice:(Ir==null?void 0:Ir.execPrice)??ri(Na,Fe,"market"),fillQty:(Ir==null?void 0:Ir.qtyClosed)??0,fees:(Ir==null?void 0:Ir.exitFees)??0})}}const Yc=hr("short",B,Fe,rs,"market",Ea,{signalId:Be.signalId,orderId:za.id,score:Be.score??null},{qty:hi,cash:Ln,...mo});if(Yc.ok){const Na=Yc.lot;ke(za.id,{status:"filled",filledIndex:B,filledTimestamp:Od,fillPrice:Na.entryPrice,fillQty:Na.qty,fees:Na.entryFee})}else ke(za.id,{status:"rejected",note:Yc.reject||"Entry blocked"})}la+=1}let tt=Uu(B,Fe);if(!vu){const Be=Vc-tt,je=ie??(de!=null?Vc*de:null),Mt=El>0?(El-tt)/El:0,Ze=El-tt,rs=j!=null&&Mt>=j||E!=null&&Ze>=E,yn=je!=null&&Number.isFinite(Be)&&Be>=je;(rs||yn)&&(vu=!0,tc("Canceled by risk limit"),Rt("long")&&vi("long",B,Fe,"signal","market"),Rt("short")&&vi("short",B,Fe,"signal","market"),tt=Uu(B,Fe))}{const Be=(Ue=s==null?void 0:s[B])==null?void 0:Ue.timestamp,je=Number(Be);Ge.push({index:B,timestamp:Number.isFinite(je)&&je>0?je:Date.now(),equity:tt})}if(tt>El&&(El=tt),El>0){const Be=(El-tt)/El;Be>qu&&(qu=Be);const je=El-tt;je>Td&&(Td=je)}if(Number.isFinite(tt)){if(!Number.isFinite(ki)||tt<ki)ki=tt;else if(ki>0){const Be=tt-ki;Be>br&&(br=Be);const je=Be/ki;je>sl&&(sl=je)}}ku+=1,Ht()&&(Qu+=1);const St=_a("long")-_a("short");Ls[B]=St,tn[B]=wf(),Gs[B]=Ft("long")+Ft("short"),an[B]=ut.length,Es[B]=tp(Fe),Ns[B]=Oe-Nl,Hs[B]=mu,ns[B]=Gc,fs[B]=du,Mn[B]=Ju,po[B]=ut.length>0?du/ut.length*100:0,Tn[B]=qu*100,Cn[B]=Td,go[B]=sl*100,no[B]=br,tl[B]=tt,Zr[B]=tt-n,Bo[B]=ut.length>0?(Oe-Nl)/ut.length:0,Vo[B]=du>0?mu/du:0,Rl[B]=Ju>0?-(Gc/Ju):0,aa[B]=ut.length>0?rd/ut.length:0;{const Be=[];for(const je of pt("long"))je.qty<=1e-12||Be.push({side:"long",qty:je.qty,entryIndex:je.entryIndex,entryTimestamp:je.entryTimestamp,entryPrice:je.entryPrice,entryFee:je.entryFee,entrySignalId:je.entrySignalId,entryOrderId:je.entryOrderId,entrySignalScore:je.entrySignalScore??null,maxFav:je.maxFav,maxAdv:je.maxAdv});for(const je of pt("short"))je.qty<=1e-12||Be.push({side:"short",qty:je.qty,entryIndex:je.entryIndex,entryTimestamp:je.entryTimestamp,entryPrice:je.entryPrice,entryFee:je.entryFee,entrySignalId:je.entrySignalId,entryOrderId:je.entryOrderId,entrySignalScore:je.entrySignalScore??null,maxFav:je.maxFav,maxAdv:je.maxAdv});Be.sort((je,Mt)=>Mt.entryIndex-je.entryIndex),zi[B]=Be}}if(t.closeOnEnd&&Ht()&&s.length){const B=yl,ve=Wy(s[B]);if(ve!=null){Rt("long")&&vi("long",B,ve,"end","market"),Rt("short")&&vi("short",B,ve,"end","market");const Fe=Uu(B,ve);{const tt=(dt=s==null?void 0:s[B])==null?void 0:dt.timestamp,St=Number(tt);Ge.push({index:B,timestamp:Number.isFinite(St)&&St>0?St:Date.now(),equity:Fe})}if(Fe>El&&(El=Fe),El>0){const tt=(El-Fe)/El;tt>qu&&(qu=tt);const St=El-Fe;St>Td&&(Td=St)}if(Number.isFinite(Fe)){if(!Number.isFinite(ki)||Fe<ki)ki=Fe;else if(ki>0){const tt=Fe-ki;tt>br&&(br=tt);const St=tt/ki;St>sl&&(sl=St)}}const ot=_a("long")-_a("short");Ls[B]=ot,tn[B]=wf(),Gs[B]=Ft("long")+Ft("short"),an[B]=ut.length,Es[B]=tp(ve),Ns[B]=Oe-Nl,Hs[B]=mu,ns[B]=Gc,fs[B]=du,Mn[B]=Ju,po[B]=ut.length>0?du/ut.length*100:0,Tn[B]=qu*100,Cn[B]=Td,go[B]=sl*100,no[B]=br,tl[B]=Fe,Zr[B]=Fe-n,Bo[B]=ut.length>0?(Oe-Nl)/ut.length:0,Vo[B]=du>0?mu/du:0,Rl[B]=Ju>0?-(Gc/Ju):0,aa[B]=ut.length>0?rd/ut.length:0,zi[B]=[]}if(ar.length){for(const Fe of ar)ke(Fe.orderId,{status:"canceled",note:"Canceled on end"});ar.length=0}}const ed=Ge.length?Ge[Ge.length-1].equity:n,td=ed-n,sp=ut.reduce((B,ve)=>B+(ve.pnl>0?ve.pnl:0),0),Gf=ut.reduce((B,ve)=>B+(ve.pnl<0?Math.abs(ve.pnl):0),0),kd=ut.filter(B=>B.pnl>0).length,Zd=ut.filter(B=>B.pnl<0).length,gc=ut.length,jf=gc?kd/gc*100:0,Nf=gc?td/gc:0,Jd=kd?sp/kd:0,xl=Zd?-(Gf/Zd):0,Su=xl!==0?Math.abs(Jd/xl):Jd>0?1/0:0,ad=gc>0?ut.reduce((B,ve)=>B+Math.max(0,ve.exitIndex-ve.entryIndex+1),0)/gc:0,Af=ku>0?Qu/ku*100:0,fu=[];{let B="",ve=NaN,Fe=0;for(const ot of Ge){const tt=Number(ot.timestamp);if(!Number.isFinite(tt)||tt<=0)continue;const St=new Date(tt).toISOString().slice(0,10);B&&St!==B&&Number.isFinite(ve)&&fu.push({ts:Fe,eq:ve}),B=St,ve=ot.equity,Fe=tt}B&&Number.isFinite(ve)&&fu.push({ts:Fe,eq:ve})}const $u=[];for(let B=1;B<fu.length;B++){const ve=fu[B-1].eq,Fe=fu[B].eq;Number.isFinite(ve)&&ve!==0&&Number.isFinite(Fe)&&$u.push((Fe-ve)/ve)}const yu=$u.length?$u.reduce((B,ve)=>B+ve,0)/$u.length:0,Yf=$u.length>1?$u.reduce((B,ve)=>B+(ve-yu)**2,0)/($u.length-1):0,Ga=Yf>0?Math.sqrt(Yf):0,nf=$u.filter(B=>B<0),Sd=nf.length?nf.reduce((B,ve)=>B+ve,0)/nf.length:0,wp=nf.length>1?nf.reduce((B,ve)=>B+(ve-Sd)**2,0)/(nf.length-1):0,ac=wp>0?Math.sqrt(wp):0,Ld=Ga>0?yu/Ga*Math.sqrt(252):0,Cu=ac>0?yu/ac*Math.sqrt(252):0,Ie=Ga>0?Ga*Math.sqrt(252)*100:0,ge=Ge.length?Ge[0].equity:n,Re=Ge.length?Number(Ge[0].timestamp):NaN,vt=Ge.length?Number(Ge[Ge.length-1].timestamp):NaN,Bt=Number.isFinite(Re)&&Number.isFinite(vt)&&vt>Re?(vt-Re)/(365*864e5):0,Xt=ge>0?ed/ge:1,W=Bt>0?Math.pow(Xt,1/Bt)-1:Xt-1,Q=qu>0?W/qu:W>0?1/0:0,O=[];if(Ge.length){const B=Ge[0].index,ve=Wy(s[B])??NaN;if(Number.isFinite(ve)&&ve>0){const Fe=n/ve;for(let ot=ec;ot<=yl;ot++){const tt=Wy(s[ot]);if(tt==null||!Number.isFinite(tt))continue;const St=(et=s==null?void 0:s[ot])==null?void 0:et.timestamp,Be=Number(St);O.push({index:ot,timestamp:Number.isFinite(Be)&&Be>0?Be:Date.now(),equity:Fe*tt})}}}const U=gc?kd/gc*Jd+Zd/gc*xl:0;let ce=0,G=0;{let B=0,ve=0;for(const Fe of ut)Fe.pnl>0?(B+=1,ve=0,B>ce&&(ce=B)):Fe.pnl<0&&(ve+=1,B=0,ve>G&&(G=ve))}return{summary:{initialCapital:n,finalEquity:ed,netPnl:td,netPnlPct:n>0?td/n*100:0,grossProfit:sp,grossLoss:Gf,profitFactor:Gf>0?sp/Gf:sp>0?1/0:0,trades:gc,roundTrips:nt.length,wins:kd,losses:Zd,winRate:jf,maxDrawdownPct:qu*100,maxDrawdownValue:Td,feesPaid:Ke,avgTrade:Nf,avgWin:Jd,avgLoss:xl,payoffRatio:Su,expectancy:U,maxConsecWins:ce,maxConsecLosses:G,exposurePct:Af,maxRunupPct:sl*100,maxRunupValue:br,avgBarsInTrade:ad,volatilityPct:Ie,sharpe:Ld,sortino:Cu,calmar:Q},trades:ut,roundTrips:nt,orders:Je,equity:Ge,benchmark:O,series:{positionSize:Ls,positionAvgPrice:tn,openTrades:Gs,closedTrades:an,openProfit:Es,closedProfit:Ns,grossProfit:Hs,grossLoss:ns,winTrades:fs,lossTrades:Mn,winRate:po,maxDrawdownPct:Tn,maxDrawdownValue:Cn,maxRunupPct:go,maxRunupValue:no,avgTrade:Bo,avgWin:Vo,avgLoss:Rl,avgBarsInTrade:aa,equity:tl,netProfit:Zr},accessors:{openTradesByBar:zi,closedTrades:ut}}}function xy(s){return s.replace(/^"|"$/g,"").replace(/^'|'$/g,"")}function zse(s){const e={},t=/([A-Za-z_$][A-Za-z0-9_$]*)\s*:\s*("([^"\\]|\\.)*"|'([^'\\]|\\.)*'|[^\s]+)/g;let n;for(;n=t.exec(s);){const o=String(n[1]||"").toLowerCase(),r=String(n[2]||"");e[o]=r}return e}function Vse(s){const e=r=>{let a=null,l=0;const c=v=>/[A-Za-z0-9_$]/.test(v),f=r.toLowerCase(),u=[{token:"cooldown_bars",key:"cooldown"},{token:"cooldownbars",key:"cooldown"},{token:"cooldown",key:"cooldown"},{token:"score",key:"score"}];let d=null;for(let v=0;v<r.length;v++){const x=r[v];if(a){x===a&&r[v-1]!=="\\"&&(a=null);continue}if(x==="'"||x==='"'){a=x;continue}if(x==="("){l+=1;continue}if(x===")"){l=Math.max(0,l-1);continue}if(!(l>0)&&!(v>0&&c(r[v-1])))for(const S of u){if(!f.startsWith(S.token,v))continue;const C=v+S.token.length;if(C<r.length&&c(r[C]))continue;let I=C;for(;I<r.length&&/\s/.test(r[I]);)I+=1;const A=r[I];if(!(A!=="="&&A!==":")){d={key:S.key,start:v,valueStart:I+1};break}}}if(!d)return null;const h=r.slice(0,d.start).replace(/[,;]+\s*$/,"").trim(),p=r.slice(d.valueStart).trim();return{key:d.key,when:h,value:p}};let t=s.trim(),n,o;for(let r=0;r<4;r++){const a=e(t);if(!a)break;t=a.when,a.key==="score"&&n==null&&(n=a.value),a.key==="cooldown"&&o==null&&(o=a.value)}return{when:t.trim(),scoreRaw:n,cooldownRaw:o}}function Wse(s,e,t){const n=s.trim();if(!n)throw new Error(`Line ${t}: score requires a numeric value`);const o=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[n],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&o.test(r)?Number(r):null,l=a??(o.test(n)?Number(n):null),c=u=>{switch(u.kind){case"NumberLiteral":return u.value;case"Identifier":{const d=e[u.name],h=typeof d=="number"?d:Number(d);return Number.isFinite(h)?h:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(u.operator!=="not")return null;const d=c(u.expr);return d==null?null:Number.isFinite(d)&&d!==0?0:1}case"BinaryExpression":{const d=c(u.left),h=c(u.right);if(d==null||h==null)return null;switch(u.operator){case"+":return d+h;case"-":return d-h;case"*":return d*h;case"/":return h===0?NaN:d/h;case"%":return h===0?NaN:d%h;case">":return Number.isFinite(d)&&Number.isFinite(h)&&d>h?1:0;case"<":return Number.isFinite(d)&&Number.isFinite(h)&&d<h?1:0;case">=":return Number.isFinite(d)&&Number.isFinite(h)&&d>=h?1:0;case"<=":return Number.isFinite(d)&&Number.isFinite(h)&&d<=h?1:0;case"==":return Number.isFinite(d)&&Number.isFinite(h)&&Math.abs(d-h)<1e-9?1:0;case"!=":return Number.isFinite(d)&&Number.isFinite(h)&&Math.abs(d-h)>=1e-9?1:0;case"and":return Number.isFinite(d)&&d!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(d)&&d!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const d=u.callee.toLowerCase();if(d==="iff"&&u.args.length===3){const x=c(u.args[0]);return x==null?null:c(x!==0?u.args[1]:u.args[2])}const h=u.args.map(x=>c(x));if(h.some(x=>x==null))return null;const p=h[0],v=h[1];switch(d){case"min":return Math.min(p,v);case"max":return Math.max(p,v);case"abs":return Math.abs(p);case"ceil":return Math.ceil(p);case"floor":return Math.floor(p);case"round":return Math.round(p);case"sqrt":return Math.sqrt(p);case"pow":return Math.pow(p,v);default:return null}}default:return null}};let f=l;if(f==null)try{const u=Ep(n);f=c(u)}catch{f=null}if(f==null||!Number.isFinite(f))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(!Number.isInteger(f))throw new Error(`Line ${t}: score must be an integer between 0 and 10`);if(f<0||f>10)throw new Error(`Line ${t}: score must be in range 0..10`);return f}function Hse(s,e,t){const n=s.trim();if(!n)throw new Error(`Line ${t}: cooldown requires a numeric value`);const o=/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/,r=e[n],a=typeof r=="number"&&Number.isFinite(r)?r:typeof r=="string"&&o.test(r)?Number(r):null,l=a??(o.test(n)?Number(n):null),c=u=>{switch(u.kind){case"NumberLiteral":return u.value;case"Identifier":{const d=e[u.name],h=typeof d=="number"?d:Number(d);return Number.isFinite(h)?h:null}case"MemberExpression":case"IndexExpression":return null;case"UnaryExpression":{if(u.operator!=="not")return null;const d=c(u.expr);return d==null?null:Number.isFinite(d)&&d!==0?0:1}case"BinaryExpression":{const d=c(u.left),h=c(u.right);if(d==null||h==null)return null;switch(u.operator){case"+":return d+h;case"-":return d-h;case"*":return d*h;case"/":return h===0?NaN:d/h;case"%":return h===0?NaN:d%h;case">":return Number.isFinite(d)&&Number.isFinite(h)&&d>h?1:0;case"<":return Number.isFinite(d)&&Number.isFinite(h)&&d<h?1:0;case">=":return Number.isFinite(d)&&Number.isFinite(h)&&d>=h?1:0;case"<=":return Number.isFinite(d)&&Number.isFinite(h)&&d<=h?1:0;case"==":return Number.isFinite(d)&&Number.isFinite(h)&&d===h?1:0;case"!=":return Number.isFinite(d)&&Number.isFinite(h)&&d!==h?1:0;case"and":return Number.isFinite(d)&&d!==0&&Number.isFinite(h)&&h!==0?1:0;case"or":return Number.isFinite(d)&&d!==0||Number.isFinite(h)&&h!==0?1:0;default:return null}}case"CallExpression":{const d=u.callee.toLowerCase();if(d==="iff"&&u.args.length===3){const x=c(u.args[0]);return x==null?null:c(x!==0?u.args[1]:u.args[2])}const h=u.args.map(x=>c(x));if(h.some(x=>x==null))return null;const p=h[0],v=h[1];switch(d){case"min":return Math.min(p,v);case"max":return Math.max(p,v);case"abs":return Math.abs(p);case"ceil":return Math.ceil(p);case"floor":return Math.floor(p);case"round":return Math.round(p);case"sqrt":return Math.sqrt(p);case"pow":return Math.pow(p,v);default:return null}}default:return null}};let f=l;if(f==null)try{const u=Ep(n);f=c(u)}catch{f=null}if(f==null||!Number.isFinite(f))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(!Number.isInteger(f))throw new Error(`Line ${t}: cooldown must be a non-negative integer`);if(f<0)throw new Error(`Line ${t}: cooldown must be a non-negative integer`);return f}function E6(s){const e=String(s||"").split(/\n+/),t={},n=[],o=[],r=[],a=[],l={};for(let f=0;f<e.length;f++){const u=e[f],d=f+1,h=u.replace(/#.*$/,"").replace(/\/\/.*$/,"").trim();if(!h)continue;let p;if(p=h.match(/^([A-Za-z_$][A-Za-z0-9_$]*)\s*=\s*(.+)$/),p){const v=p[1],x=p[2].trim(),S=Number(x);Number.isFinite(S)&&/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][-+]?\d+)?$/.test(x)?t[v]=S:x.startsWith('"')&&x.endsWith('"')||x.startsWith("'")&&x.endsWith("'")?t[v]=xy(x):n.push({name:v,expr:x});continue}if(p=h.match(/^signal\s+([A-Za-z_$][A-Za-z0-9_$]*)\s+when\s+(.+)\s*$/i),p){const v=p[1],x=Vse(p[2]||"");if(!x.when)throw new Error(`Line ${d}: signal ... when requires a condition`);const S=x.when.trim();l[v.toLowerCase()]=S;const C=v.toLowerCase(),I=C==="top"?"entry_long":C==="bot"?"entry_short":C==="buy"?"entry_long":C==="sell"||C==="exit"?"exit_long":C,A=x.scoreRaw!=null?Wse(x.scoreRaw,t,d):null,P=x.cooldownRaw!=null?Hse(x.cooldownRaw,t,d):void 0;o.push({type:I,when:S,score:A,cooldownBars:P});continue}if(p=h.match(/^label\s+at\s+(top|bot)(?:\s+when\s*\((.+?)\))?\s+(.+)$/i),p){const v=p[1].toLowerCase(),x=(p[2]||"").trim(),S=p[3]||"",C=zse(S),I=C.text?xy(C.text):v==="top"?"▲":"▼",A=C.color||(v==="top"?"#f97316":"#3b82f6"),P=v==="top"?"above":"below",T=C.source?xy(C.source):v==="top"?"high":"low",j=C.shape?xy(C.shape):void 0,E=de=>n.some(ie=>ie.name.replace(/\s+/g,"_").toLowerCase()===de.replace(/\s+/g,"_").toLowerCase()),L=typeof t.WIN=="number"||typeof t.WIN=="string"&&Number.isFinite(Number(t.WIN)),D=v==="top"?E("hiwin")?"close == HIWIN":L?"close == highest(close, WIN)":"close < -1e20":E("lowin")?"close == LOWIN":L?"close == lowest(close, WIN)":"close < -1e20",ne={when:x||l[v]||D,text:I,color:A,position:P,source:T,shape:j};T==="high"||T==="low"?r.push(ne):a.push(ne);continue}}const c=[];return(r.length||o.length)&&c.push({pane:"main",plots:[],labels:r,levels:[],lines:[]}),a.length&&c.push({pane:"sub",plots:[],labels:a,levels:[],lines:[],min:0,max:100}),{params:t,series:n,signals:o,panes:c}}function qse(s,e,t,n){if(!Cm("interactionV2"))return;const{endedId:o}=rx();o&&(b(e,""),b(t,"")),o&&n()}function Use(s,e,t,n,o){i(e)&&t(),i(n)&&o()}var Gse=(s,e,t)=>Fc(t(),Ro(e).clickChart+=1,Ro(e)),Yse=be('<div class="duty-loading-overlay svelte-1hw3i2b"><div class="loader-content svelte-1hw3i2b"><div class="ai-minimal svelte-1hw3i2b"><div class="brand-text svelte-1hw3i2b">Duty AI</div> <span class="brand-shine svelte-1hw3i2b"></span> <div class="orbit svelte-1hw3i2b"><span class="o-dot o1 svelte-1hw3i2b"></span><span class="o-dot o2 svelte-1hw3i2b"></span></div> <div class="progress-line svelte-1hw3i2b"><span class="dot svelte-1hw3i2b"></span></div> <div class="tagline svelte-1hw3i2b">Preparing data</div></div></div></div>'),Kse=s=>s.stopPropagation(),Xse=be('<div class="historical-loading-indicator svelte-1hw3i2b"><div class="loading-spinner svelte-1hw3i2b"></div> <span class="svelte-1hw3i2b">Loading historical data...</span></div>'),Zse=be('<div class="reset-menu svelte-1hw3i2b"><button class="action-btn copy-btn svelte-1hw3i2b"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" class="svelte-1hw3i2b"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2" class="svelte-1hw3i2b"></rect><path d="M5 15H4C2.9 15 2 14.1 2 13V4C2 2.9 2.9 2 4 2H13C14.1 2 15 2.9 15 4V5" stroke="currentColor" stroke-width="2" class="svelte-1hw3i2b"></path></svg> <span class="svelte-1hw3i2b"> </span></button> <button class="action-btn reset-btn svelte-1hw3i2b"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" class="svelte-1hw3i2b"><path d="M3 12C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12C21 16.97 16.97 21 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="svelte-1hw3i2b"></path><path d="M3 12L7 8M3 12L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="svelte-1hw3i2b"></path></svg> <span class="svelte-1hw3i2b">Reset View</span></button></div>'),Jse=be('<div class="duty-main svelte-1hw3i2b"><div class="alerts-container svelte-1hw3i2b"></div> <!> <div class="chart-container svelte-1hw3i2b"><div class="chart-shell svelte-1hw3i2b"><div class="duty-content svelte-1hw3i2b"><div class="drawbar-host svelte-1hw3i2b" style="width: var(--drawing-bar-width); overflow: hidden;"><!></div> <!> <div class="duty-widget svelte-1hw3i2b" role="application" tabindex="0"><canvas class="script-webgl-layer svelte-1hw3i2b"></canvas> <canvas class="script-overlay svelte-1hw3i2b"></canvas> <canvas class="tool-overlay svelte-1hw3i2b"></canvas></div> <!></div> <div><div class="dock-resize-handle svelte-1hw3i2b" aria-label="Resize script dock"><div class="handle-bar svelte-1hw3i2b"></div></div> <div class="dock-body svelte-1hw3i2b"><!></div></div></div> <!></div> <!> <!> <!> <!> <!> <!> <!> <!></div>');function Qse(s,e){var Cp,vf,ym,Tm;Yd(e,!0);const t=lh(),n=()=>Ml(T(),"$save",t),o=()=>Ml(Ge,"$chart",t),r=()=>Ml(pm,"$simulator",t),a=()=>Ml(P(),"$ctx",t),l=()=>Ml(R6,"$page",t),c=()=>Ml(jg,"$userPreferences",t),f=()=>Ml(jt,"$alerts",t),u=()=>Ml(bl,"$saveRestoring",t),d=()=>Ml(Ese,"$scriptBacktests",t),h=()=>Ml(fse,"$scriptSignals",t),p=(...M)=>{},v=-10,x=(M,V,fe,me,ae,We)=>{const He=Math.max(0,Math.min(We,Math.min(me,ae)/2));M.beginPath(),M.moveTo(V+He,fe),M.lineTo(V+me-He,fe),M.quadraticCurveTo(V+me,fe,V+me,fe+He),M.lineTo(V+me,fe+ae-He),M.quadraticCurveTo(V+me,fe+ae,V+me-He,fe+ae),M.lineTo(V+He,fe+ae),M.quadraticCurveTo(V,fe+ae,V,fe+ae-He),M.lineTo(V,fe+He),M.quadraticCurveTo(V,fe,V+He,fe),M.closePath()};Ow("UTC");function S(M){const fe=`${M??""}`.replace(/0[\{\(](\d+)[\}\)]/g,(ae,We)=>{const He=Number(We);return!Number.isFinite(He)||He<=0?"0":"0".repeat(Math.min(50,Math.trunc(He)))}),me=(ae,We)=>{if(!Number.isFinite(ae)||ae===0)return`${ae}`;const He=ae<0?"-":"",At=Math.abs(ae),Wt=Math.floor(Math.log10(At))+1;let Jt=At/Math.pow(10,Wt),$s=Wt;const Kt=Number(Jt.toFixed(We));return Kt>=1?(Jt=Kt/10,$s=Wt+1):Jt=Kt,`${He}${Jt.toFixed(We)}e${$s}`};try{const ae=/^(-?)([\d,]+)(?:\.(\d+))?$/.exec(fe.trim());if(ae){const We=ae[1]||"",He=ae[2]||"0",At=ae[3]||"";if(He.replace(/,/g,"").length>=5&&At.length>2)return`${We}${He}.${At.slice(0,2).padEnd(2,"0")}`}}catch{}try{const ae=vy(n().symbol);if(ae==="stock"||ae==="crypto"){const We=Number(fe.replace(/,/g,"").trim());if(Number.isFinite(We)){const He=Math.abs(We);if(He>0&&He<1e-4)return me(We,5)}}}catch{}return fe}const C=new P$;let I={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},A=null;MF.forEach(M=>o5(M)),$F.forEach(M=>h9(M)),LL.forEach(M=>{M.extendData=="datafeed"&&(M.extendData=C),Rb(M)});let P=bi(e,"ctx",23,()=>Th(new G5)),T=bi(e,"save",19,()=>Fx("chart",new Py)),j=bi(e,"customLoad",3,!1);const E=5e3,L=`{
  "pane": "sub",
  "min": -2,
  "max": 2,
  "shortName": "Debug Area",
  "plots": [
    {
      "name": "AreaTest",
      "source": "close",
      "type": "area",
      "color": "rgba(129,140,248,0.4)",
      "width": 1
    }
  ]
}`;try{const M=sessionStorage.getItem("chart.tabId");M?Fc(T(),Ro(n).key=`chart:${M}`,Ro(n)):n().key||Fc(T(),Ro(n).key="chart",Ro(n))}catch{n().key||Fc(T(),Ro(n).key="chart",Ro(n))}try{const M=n()&&n().symbol&&typeof n().symbol=="object",V=n()&&n().period&&typeof n().period=="object";(!M||!V)&&T().set(new Py)}catch{T().set(new Py)}T().update(M=>{if(!(M.allExgs instanceof Set)){const V=Array.isArray(M.allExgs)?M.allExgs:[];M.allExgs=new Set(V)}return M});let D,X,ne,de,ie=null,te=null,le=null,pe=null,re=!1,xe=null,se=[],Ne=null,Te=[];const Me=new Set;let De=null,Oe=[],Ke=[],kt=!1,pt=!1,Rt=!1,Ht=_e(!1),Ft=_e(!1),zt=_e(null),ut=_e(!1),nt=_e(void 0),Je=_e(void 0),it=_e(void 0),ze=_e(void 0);const Ge=Th(null),xt=500,jt=l8();let ft=_e(!1),ke=_e(!1),Se=_e(!1),Et=_e(.35);const wt=.2,Ls=.6;let tn=_e(!1),Gs=0,an=0,Es=_e(L),Ns=_e(0),Hs=_e(void 0),ns=_e("Ready"),fs=_e(null),Mn=_e(H([])),po=_e(!1),Tn=0,Cn=new Set,go="",no=null,Bo=_e(!0),Vo=!1;const Rl="SCRIPT_STUDIO";let aa=[],tl=[],Zr=_e(null),zi=_e("main"),Nl=new Set;const mu="script-trade-focus",Gc="script-order-focus",du=()=>{var V;const M=((V=n().options)==null?void 0:V.datafeed)||{};return{sessionMode:String(M.sessionMode||"regular"),adjustMode:String(M.adjustMode||"none"),timezone:String(n().timezone||"UTC")}};let Ju=[],rd=[];const Al=(M,V)=>{const fe=typeof M=="number"?M:Number(M);if(!Number.isFinite(fe))return"-";try{return S(fe.toFixed(Math.max(0,Math.min(10,V))))}catch{return`${fe}`}},sa=M=>{const V=typeof M=="number"?M:Number(M);return!Number.isFinite(V)||V<=0?null:V<1e12?V*1e3:V};function Vc(){const M=o();if(M){try{for(const V of Ju)M.removeOverlay({id:V});Ju=[]}catch{}try{M.removeOverlay({groupId:mu})}catch{}}}function vu(){const M=o();if(M){try{for(const V of rd)M.removeOverlay({id:V});rd=[]}catch{}try{M.removeOverlay({groupId:Gc})}catch{}}}function Qc(M){if(M==null)return;const V=String(M);V&&Ju.push(V)}function To(M){if(M==null)return;const V=String(M);V&&rd.push(V)}function ec(M){var fe;const V=o();if(!(!V||!M))try{const me=((fe=V.getDataList)==null?void 0:fe.call(V))||[],ae=Math.max(0,Math.floor(Number(M.entryIndex)||0)),We=Math.max(0,Math.floor(Number(M.exitIndex)||0)),He=me[ae]||null,At=me[We]||null,Wt=sa(M.entryTimestamp)??sa((He==null?void 0:He.timestamp)??(He==null?void 0:He.time))??null,Jt=sa(M.exitTimestamp)??sa((At==null?void 0:At.timestamp)??(At==null?void 0:At.time))??null,$s=Number(M.entryPrice),Kt=Number(M.exitPrice);if(!Number.isFinite($s)||!Number.isFinite(Kt)||Wt==null||Jt==null)return;Vc(),vu();const Us=Number(M.netPnl)>=0,es=Us?"#22c55e":"#ef4444",rn=Us?"#16a34a":"#ef4444",pn=Us?"#16a34a":"#f59e0b",Nn=Number(M.netPnl)||0,js=Number(M.fees)||0,qt=String(M.exitReason||"").replace(/_/g," "),Os=V.createOverlay({name:"trade",paneId:"candle_pane",groupId:mu,lock:!1,visible:!0,points:[{timestamp:Wt,value:$s},{timestamp:Jt,value:Kt},{timestamp:Jt,value:Kt}],extendData:{line_color:es,in_color:rn,out_color:pn,in_text:`ENTRY ${String(M.side||"").toUpperCase()} @ ${Al($s,6)}`,out_text:`EXIT @ ${Al(Kt,6)} • ${qt||"signal"} • Net ${Nn>=0?"+":""}${Al(Nn,2)} • Fees ${Al(js,2)}`,selected:!1,active:!1,distance:18}});Qc(Os);try{const zs=V.createOverlay({name:"note",paneId:"candle_pane",groupId:mu,lock:!1,visible:!0,points:[{timestamp:Wt,value:$s},{timestamp:Wt,value:$s}],extendData:{line_color:"transparent",in_color:rn,in_text:`ENTRY ${String(M.side||"").toUpperCase()} @ ${Al($s,6)}`,out_color:rn,out_text:"",distance:24,offsetX:-70,align:"right"}});Qc(zs);const mn=V.createOverlay({name:"note",paneId:"candle_pane",groupId:mu,lock:!1,visible:!0,points:[{timestamp:Jt,value:Kt},{timestamp:Jt,value:Kt}],extendData:{line_color:"transparent",in_color:pn,in_text:`EXIT @ ${Al(Kt,6)} • ${qt||"signal"} • Net ${Nn>=0?"+":""}${Al(Nn,2)} • Fees ${Al(js,2)}`,out_color:pn,out_text:"",distance:24,offsetX:70,align:"left"}});Qc(mn)}catch{}try{V.scrollToDataIndex(We,0)}catch{try{V.scrollToTimestamp(Jt,0)}catch{}}}catch(me){console.error("[ScriptStudio] focus trade failed",me)}}function yl(M){var fe;const V=o();if(!(!V||!M))try{const me=((fe=V.getDataList)==null?void 0:fe.call(V))||[],ae=Number(M.filledIndex),We=Number(M.createdIndex),He=Number.isFinite(ae)?Math.max(0,Math.floor(ae)):Number.isFinite(We)?Math.max(0,Math.floor(We)):null,At=He!=null?me[He]:null,Wt=sa(M.filledTimestamp)??sa(M.createdTimestamp)??sa((At==null?void 0:At.timestamp)??(At==null?void 0:At.time))??null,Jt=Number.isFinite(Number(M.fillPrice))?Number(M.fillPrice):Number.isFinite(Number(M.stopPrice))?Number(M.stopPrice):Number.isFinite(Number(M.limitPrice))?Number(M.limitPrice):Number.isFinite(Number(M.price))?Number(M.price):NaN;if(!Number.isFinite(Jt)||Wt==null)return;vu(),Vc();const $s=String(M.action||"").toLowerCase(),Kt=String(M.side||"").toLowerCase(),rn=$s==="entry"?Kt==="short"?"#ef4444":"#16a34a":$s==="exit"?"#f59e0b":"#64748b",pn=String(M.kindLabel||M.kind||"").toUpperCase(),Nn=String(M.statusLabel||M.status||"").replace(/_/g," ").trim(),js=`ORDER ${pn}${Kt?` ${Kt.toUpperCase()}`:""}${Nn?` • ${Nn}`:""}`,qt=V.createOverlay({name:"horizontalStraightLine",paneId:"candle_pane",groupId:Gc,lock:!1,visible:!0,points:[{timestamp:Wt,value:Jt},{timestamp:Wt,value:Jt}],extendData:{showDot:!0,interactive:!1},styles:{line:{color:rn,size:1,style:"dashed"}}});To(qt);const Os=V.createOverlay({name:"note",paneId:"candle_pane",groupId:Gc,lock:!1,visible:!0,points:[{timestamp:Wt,value:Jt},{timestamp:Wt,value:Jt}],extendData:{line_color:rn,in_color:rn,in_text:js,distance:24,offsetX:-70,align:"right"}});To(Os),He!=null?V.scrollToDataIndex(He,0):V.scrollToTimestamp(Wt,0)}catch(me){console.error("[ScriptStudio] focus order failed",me)}}function Dc(M){const V=o();if(!V)return!1;const fe=Math.max(0,Math.floor(Number(M)||0));try{return V.scrollToDataIndex(fe,0),!0}catch(me){return console.error("[ScriptStudio] focus index failed",me),!1}}function jl(M){const V=o();if(!V)return!1;const fe=Math.floor(Number(M)||0);if(!Number.isFinite(fe)||fe<=0)return!1;try{return V.scrollToTimestamp(fe,0),!0}catch(me){return console.error("[ScriptStudio] focus timestamp failed",me),!1}}let qi=new Map;const la=new Set;let El=null,qu=null;const Td={solid:mt.Solid,dashed:mt.Dashed,dotted:mt.Dashed,arrow_left:mt.Solid,arrow_right:mt.Solid,arrow_both:mt.Solid,arrow_none:mt.Solid};let ki={};const sl=new Map,br=new Map,Wc=M=>{if(!M)return 0;let V=2166136261;for(let me=0;me<M.length;(me+=1)-1)V^=M.charCodeAt(me),V=Math.imul(V,16777619);const fe=V>>>0;return fe===0?1:fe},Xd=M=>{const V=String(M||"");let fe="",me=0;for(;me<V.length;){const ae=V[me];if(ae==='"'||ae==="'"){const We=ae;me+=1;let He="",At=!1;for(;me<V.length;){const Wt=V[me];if(At){He+=Wt,At=!1,me+=1;continue}if(Wt==="\\"){At=!0,me+=1;continue}if(Wt===We){me+=1;break}He+=Wt,me+=1}fe+=String(Wc(He));continue}fe+=ae,me+=1}return fe};function Uf(M){let V=String(M||"").trim();return V=V.replace(/\$\{([^}]+)\}/g,(fe,me)=>{const ae=ki[String(me)];if(ae==null)return fe;if(typeof ae=="number"&&Number.isFinite(ae)||typeof ae=="string")return String(ae);try{return JSON.stringify(ae)}catch{return String(ae)}}),V=qx(V).replace(/#.*$/,""),V=V.split(";")[0],V=V.replace(/,\s*$/,""),V=V.replace(/\b(and|or)\b\s*$/i,""),V=V.replace(/\b(line|label|box|table)\.get_/gi,"$1_get_"),V=V.replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2"),V=V.replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(fe,me,ae)=>`${String(me).toLowerCase()}_${ae}`),V=V.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),V=V.replace(/\bcrosses\s+below\b/gi,"crossesBelow"),Vo?(V=V.replace(/\bstr\./gi,""),V=R_(V,{pineV2:!0}).expr,V=Oy(V),V.trim()):(V=V.replace(/\bta\./gi,""),V=V.replace(/\bmath\./gi,""),V=V.replace(/\bstr\./gi,""),V=Xd(V),V=Oy(V),V.trim())}function xf(M){const V=String(M||"");let fe="",me=null,ae=0;const We=At=>/[A-Za-z_$]/.test(At),He=At=>/[A-Za-z0-9_$]/.test(At);for(;ae<V.length;){const At=V[ae];if(me){fe+=At,At===me&&V[ae-1]!=="\\"&&(me=null),ae+=1;continue}if(At==="'"||At==='"'){me=At,fe+=At,ae+=1;continue}if(We(At)){let Wt=ae+1;for(;Wt<V.length&&He(V[Wt]);)Wt+=1;const Jt=V.slice(ae,Wt);let $s=Wt;for(;$s<V.length&&/\s/.test(V[$s]);)$s+=1;if(V[$s]==="["){let Kt=$s+1;for(;Kt<V.length&&/\s/.test(V[Kt]);)Kt+=1;let Us=1;V[Kt]==="-"&&(Us=-1,Kt+=1);let es=Kt;for(;es<V.length&&/[0-9]/.test(V[es]);)es+=1;const rn=V.slice(Kt,es);for(;es<V.length&&/\s/.test(V[es]);)es+=1;if(rn&&V[es]==="]"){const pn=Us*Number(rn);if(Number.isFinite(pn)&&pn>=1){fe+=`prev(${Jt}, ${Math.floor(pn)})`,ae=es+1;continue}if(Number.isFinite(pn)&&pn===0){fe+=Jt,ae=es+1;continue}}}fe+=Jt,ae=Wt;continue}fe+=At,ae+=1}return fe}function Uu(M){let V=String(M||"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_");return Vo?(V=V.replace(/\bstr\./g,""),R_(V,{pineV2:!0}).expr):(V=V.replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(fe,me,ae)=>`${String(me).toLowerCase()}_${ae}`),V=Xd(V),xf(V))}function tp(M){let V=String(M||"").replace(/\bta\./g,"").replace(/\bmath\./g,"").replace(/\bstr\./g,"").replace(/\b(line|label|box|table)\.get_/gi,"$1_get_").replace(/\bstrategy\.(closedtrades|opentrades)\.([A-Za-z0-9_]+)/gi,"strategy_$1_$2").replace(/\b(barstate|timeframe|syminfo|strategy)\.([A-Za-z0-9_]+)/gi,(fe,me,ae)=>`${String(me).toLowerCase()}_${ae}`);return xf(V)}let wf=!1,Vs=_e(!1),kn=_e(null),Kn=!0,Bs=null,bo=!1,lo=0,Qi=null,xr=_e(!1),Ai=null,ri=0;function Ti(){return ri+=1,ri}let Eo=null,hr=null,ei=null,ai=null,vi=null,_a=null,dl=null,ar=null,Jr=!1,nl=null;const tc=()=>{o()&&(Eo&&(clearTimeout(Eo),Eo=null),hr&&(cancelAnimationFrame(hr),hr=null),hr=requestAnimationFrame(()=>{hr=null,Ui.requestKey("window-resize:stage1",()=>{if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const M=lp(n().theme);Ys.merge(M,Ag(n().styles)),o().setStyles(hf(M)),lr(),ba(),ed()})}),Eo=setTimeout(()=>{Eo=null,Ui.requestKey("window-resize:stage2",()=>{var fe,me,ae,We,He,At,Wt,Jt,$s;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const M=lp(n().theme);if(Ys.merge(M,Ag(n().styles)),o().setStyles(hf(M)),lr(),ba(),ed(),kl()){const Kt=o(),Us=((me=(fe=Kt.getSize)==null?void 0:fe.call(Kt))==null?void 0:me.height)??(D==null?void 0:D.clientHeight)??((ae=D==null?void 0:D.getBoundingClientRect)==null?void 0:ae.call(D).height)??0,es=((He=(We=Kt.getSize)==null?void 0:We.call(Kt))==null?void 0:He.width)??(D==null?void 0:D.clientWidth)??((At=D==null?void 0:D.getBoundingClientRect)==null?void 0:At.call(D).width)??0,rn=es>0&&Us>0&&es>Us;if(ei===null||ei!==rn){ei=rn;try{const pn=(Wt=Kt.getPaneOptions)==null?void 0:Wt.call(Kt);if(Array.isArray(pn)&&Us>0){const js=Math.round(Us*(rn?.3:.25));pn.forEach(qt=>{var zs;const Os=qt==null?void 0:qt.id;Os&&(Os==="candle_pane"||Os==="x_axis_pane"||qt!=null&&qt.state&&qt.state!=="normal"||(zs=Kt.setPaneOptions)==null||zs.call(Kt,{id:Os,height:js}))})}}catch{}}}const V=($s=(Jt=o()).getVisibleRange)==null?void 0:$s.call(Jt);V&&typeof V.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(V.to,0)},30)})},160))};function mc(M){const V=(M==null?void 0:M.ticker)||(M==null?void 0:M.symbol);if(V)return`https://s3-api.bayah.app/cdn/symbol/logo/${V}.svg`}function gu(M){if(!M)return M;const V=mc(M);return M.logo&&M.logo2?M:{...M,logo:M.logo||M.logo2||V,logo2:M.logo2}}const Bl=Zx(),Ui=Cb(),Ol=new Jx("global-chart",Ge,n().theme||"dark");let fl=null;const bl=Th(!1);Qg("ctx",P()),Qg("save",T()),Qg("chart",Ge),Qg("alerts",jt),Qg("datafeed",C),Qg("renderIntegration",Bl),Qg("globalThemeManager",Ol),Qg("drawingManager",{get:()=>fl}),Qg("saveRestoring",bl);function Ua(M){const V=M.match(/WIN\s*=\s*(\d+)/i),fe=Math.max(2,Math.min(500,V&&parseInt(V[1],10)||5)),me=M.match(/label\s+at\s+top\s+text:\s*\"?([^\"\n]+)\"?/i),ae=M.match(/label\s+at\s+bot\s+text:\s*\"?([^\"\n]+)\"?/i),We=M.match(/label\s+at\s+top.*color:\s*([#a-zA-Z0-9]+)/i),He=M.match(/label\s+at\s+bot.*color:\s*([#a-zA-Z0-9]+)/i),At=((me==null?void 0:me[1])||"▲").trim(),Wt=((ae==null?void 0:ae[1])||"▼").trim(),Jt=((We==null?void 0:We[1])||"#f97316").trim(),$s=((He==null?void 0:He[1])||"#3b82f6").trim();if(!At||!Wt)throw new Error("Script is missing label text for top/bot.");return{window:fe,topText:At,botText:Wt,topColor:Jt,botColor:$s}}function er(M,V){return{name:V,shortName:"Script",precision:4,zLevel:10,calcParams:[M.window],figures:[{key:"hi",title:`HI(${M.window})`,type:"line"},{key:"lo",title:`LO(${M.window})`,type:"line"}],styles:{lines:[{color:"rgba(0,0,0,0)",size:1e-4,style:mt.Solid},{color:"rgba(0,0,0,0)",size:1e-4,style:mt.Solid}]},shouldOhlc:!0,calc:(fe,me)=>{var At;const ae=Math.max(2,Math.min(500,((At=me.calcParams)==null?void 0:At[0])||M.window||5)),We=Math.max(2,Math.floor(ae/2)),He=[];for(let Wt=0;Wt<fe.length;(Wt+=1)-1){const Jt=fe[Wt].high??fe[Wt].close,$s=fe[Wt].low??fe[Wt].close;let Kt,Us,es=!1,rn=!1;if(Wt>=We&&Wt<=fe.length-We-1){const pn=Wt-We,Nn=Wt+We;let js=-1/0,qt=1/0;for(let un=pn;un<=Nn;(un+=1)-1){const jn=fe[un].high??fe[un].close,ro=fe[un].low??fe[un].close;jn>js&&(js=jn),ro<qt&&(qt=ro)}Kt=js,Us=qt;const Os=Math.max(1e-8,Math.abs(Jt||$s||1)*1e-4);let zs=-1,mn=-1;for(let un=pn;un<=Nn;(un+=1)-1){const jn=fe[un].high??fe[un].close,ro=fe[un].low??fe[un].close;if(zs===-1&&Math.abs(jn-js)<=Os&&(zs=un),mn===-1&&Math.abs(ro-qt)<=Os&&(mn=un),zs!==-1&&mn!==-1)break}es=Math.abs(Jt-js)<=Os&&Wt===zs,rn=Math.abs($s-qt)<=Os&&Wt===mn}He.push({hi:Kt,lo:Us,high:Jt,low:$s,topSignal:es,botSignal:rn})}return He},draw:({ctx:fe,indicator:me,xAxis:ae,yAxis:We,bounding:He})=>{if(!fe||!ae||!We)return!1;const At=(me==null?void 0:me.result)||[];fe.save(),He&&(fe.beginPath(),fe.rect(0,0,He.width,He.height),fe.clip()),fe.textAlign="center",fe.textBaseline="middle",fe.font='12px "Inter", "SF Pro", system-ui, -apple-system, sans-serif';for(let Wt=0;Wt<At.length;(Wt+=1)-1){const Jt=At[Wt];if(!Jt)continue;const $s=ae.convertToPixel(Wt);if(Jt.topSignal&&Jt.hi!==void 0){const Kt=We.convertToPixel(Jt.hi);if(Number.isFinite(Kt)){const Us=Kt-8;fe.fillStyle=M.topColor,fe.strokeStyle="rgba(0,0,0,0.35)",fe.lineWidth=1,fe.textBaseline="middle",fe.fillText(M.topText,$s,Us),fe.strokeText(M.topText,$s,Us),fe.beginPath(),fe.arc($s,Us-8,3.5,0,Math.PI*2),fe.fill(),fe.stroke()}}if(Jt.botSignal&&Jt.lo!==void 0){const Kt=We.convertToPixel(Jt.lo);if(Number.isFinite(Kt)){const Us=Kt+8;fe.fillStyle=M.botColor,fe.strokeStyle="rgba(0,0,0,0.35)",fe.lineWidth=1,fe.textBaseline="middle",fe.fillText(M.botText,$s,Us),fe.strokeText(M.botText,$s,Us),fe.beginPath(),fe.arc($s,Us+8,3.5,0,Math.PI*2),fe.fill(),fe.stroke()}}}return fe.restore(),!0}}}function ba(){if(!D)return;const M=D.getBoundingClientRect(),V=typeof window<"u"?Math.max(1,window.devicePixelRatio||1):1,fe=We=>{if(!We)return;We.style.width=`${M.width}px`,We.style.height=`${M.height}px`,We.width=Math.floor(M.width*V),We.height=Math.floor(M.height*V);const He=We.getContext("2d");He&&He.setTransform(V,0,0,V,0,0)},me=We=>{We&&(We.style.width=`${M.width}px`,We.style.height=`${M.height}px`,We.width=Math.floor(M.width*V),We.height=Math.floor(M.height*V))};fe(X),fe(de),me(ne),ie=X==null?void 0:X.getContext("2d"),xe=de==null?void 0:de.getContext("2d"),(Cm("webglRuntimeDrawV1")||re)&&ne?(te||(te=_se(ne)),!le&&te&&(le=new Ise(te)),!pe&&te&&(pe=new Lse(te)),te==null||te.resize(M.width,M.height,V)):te&&(te.destroy(),te=null,le&&(le.destroy(),le=null),pe&&(pe.destroy(),pe=null))}const ol=()=>{if(pt||Rt){Oe=[],Ke=[];return}kt||(kt=!0,Ui.request(()=>{if(kt=!1,!te){Oe=[],Ke=[];return}const M=Oe,V=Ke;Oe=[],Ke=[];const fe=M.length>0,me=V.length>0;if(!fe&&!me){le==null||le.clear(),pe==null||pe.clear();return}if(le&&fe?le.render(M,{clear:!0}):le&&le.clear(),pe&&me){const ae=!fe;pe.render(V,{clear:ae})}}))},xd=()=>{te&&(le==null||le.clear(),pe==null||pe.clear())},_u=M=>{const{runtimeHeatmaps:V,bounds:fe,xAxis:me,yAxis:ae,offsetX:We,offsetY:He,drawConfigMeta:At,len:Wt,tsIndex:Jt,timeSeriesMs:$s,avgIntervalMs:Kt}=M;if(!V.length)return[];const Us=(js,qt,Os)=>{var zs,mn,un;return bk({xVal:js,xloc:qt,len:Wt,timeSeriesMs:$s,tsIndex:Jt,config:{mode:((zs=At==null?void 0:At.time)==null?void 0:zs.mode)||"nearest",toleranceBars:Number.isFinite((mn=At==null?void 0:At.time)==null?void 0:mn.toleranceBars)?Math.max(0,Math.floor(At.time.toleranceBars)):0,toleranceMs:Number.isFinite((un=At==null?void 0:At.time)==null?void 0:un.toleranceMs)?Math.max(0,Math.floor(At.time.toleranceMs)):0,futureBars:Number.isFinite(At==null?void 0:At.futureBars)?Math.max(0,Math.floor(At.futureBars)):0,avgIntervalMs:Kt,strictXloc:!1},meta:Os})},es={background:0,main:1,overlay:2,ui:3},rn=(()=>{const js=ro=>{var qs;const ys=(qs=me==null?void 0:me.convertToPixel)==null?void 0:qs.call(me,ro);return Number.isFinite(ys)?Math.round(ys):0},qt=ro=>{var qs;const ys=(qs=ae==null?void 0:ae.convertToPixel)==null?void 0:qs.call(ae,ro);return Number.isFinite(ys)?Math.round(ys):0},Os=js(0),zs=js(Math.max(0,Wt-1)),mn=Wt>1?js(1)-js(0):0,un=qt(0),jn=qt(1);return`${Os}:${zs}:${mn}:${un}:${jn}:${Math.round(fe.width)}:${Math.round(fe.height)}`})(),pn=V.map((js,qt)=>{const Os=String((js==null?void 0:js.layer)||"main").toLowerCase(),zs=es[Os]??es.main,mn=js==null?void 0:js.zIndex,un=Number.isFinite(Number(mn))?Number(mn):0;return{hm:js,idx:qt,layer:zs,zIndex:un}}).sort((js,qt)=>js.layer-qt.layer||js.zIndex-qt.zIndex||js.idx-qt.idx),Nn=[];for(const js of pn){const qt=js.hm;if(!qt)continue;const Os=Array.isArray(qt.points)?qt.points:[];if(!Os.length)continue;const zs=qt.xloc??"bar_index";if((qt.yloc??"price")!=="price")continue;const un=[];for(const ro of Os){const ys=Number(ro==null?void 0:ro.x),qs=Number(ro==null?void 0:ro.y),Js=Number(ro==null?void 0:ro.value);if(!Number.isFinite(ys)||!Number.isFinite(qs)||!Number.isFinite(Js))continue;const is=Us(ys,zs,{kind:"heatmap",id:qt.id??"heatmap"});if(is==null)continue;const ts=me.convertToPixel(is),Ss=ae.convertToPixel(qs);!Number.isFinite(ts)||!Number.isFinite(Ss)||un.push({x:ts+We,y:Ss+He,value:Js})}if(!un.length)continue;const jn=qt.id??`heatmap_${js.idx+1}`;Nn.push({id:jn,bounds:fe,points:un,opacity:qt.opacity,colormap:qt.colormap,blend:qt.blend,xBinPx:qt.xBinPx,yBinPx:qt.yBinPx,minValue:qt.minValue,maxValue:qt.maxValue,agg:qt.agg,version:qt.version,viewKey:rn})}return Nn},eu=M=>{const{runtimeLineDefs:V,runtimeLineFills:fe,runtimePolylineDefs:me,runtimePolygonDefs:ae,runtimePathDefs:We,xAxis:He,yAxis:At,offsetX:Wt,offsetY:Jt,fromIndex:$s,toIndex:Kt,len:Us}=M,es=[],rn=(qt,Os)=>{const zs=He.convertToPixel(qt),mn=At.convertToPixel(Os);return!Number.isFinite(zs)||!Number.isFinite(mn)?null:{x:zs+Wt,y:mn+Jt}},pn=qt=>{let Os=NaN,zs=NaN,mn=NaN,un=NaN;if(qt.strictExtend){const jn=typeof At.getRange=="function"?At.getRange():null,ro=cy({startIndex:qt.startIndex,endIndex:qt.endIndex,startValue:qt.startValue,endValue:qt.endValue,slope:qt.slope,intercept:qt.intercept,extend:qt.extend,fromIndex:$s,toIndex:Kt,yRange:jn,toX:ys=>He.convertToPixel(ys),toY:ys=>At.convertToPixel(ys)});if(!ro)return null;Os=ro.extended.x1,zs=ro.extended.y1,mn=ro.extended.x2,un=ro.extended.y2}else{let jn=qt.startIndex,ro=qt.endIndex;qt.extend==="both"?(jn=0,ro=Math.max(0,Us-1)):qt.extend==="left"?jn=0:qt.extend==="right"&&(ro=Math.max(0,Us-1));const ys=Number.isFinite(qt.slope)&&Number.isFinite(qt.intercept)?qt.slope*jn+qt.intercept:qt.startValue,qs=Number.isFinite(qt.slope)&&Number.isFinite(qt.intercept)?qt.slope*ro+qt.intercept:qt.endValue;Os=He.convertToPixel(jn),zs=At.convertToPixel(ys),mn=He.convertToPixel(ro),un=At.convertToPixel(qs)}return!Number.isFinite(Os)||!Number.isFinite(zs)||!Number.isFinite(mn)||!Number.isFinite(un)?null:{a:{x:Os+Wt,y:zs+Jt},b:{x:mn+Wt,y:un+Jt}}};for(const qt of V){if(!qt)continue;const Os=String(qt.style||"solid").toLowerCase();if(Os.includes("arrow"))continue;const zs=pn(qt);zs&&es.push({kind:"line",points:[zs.a,zs.b],color:qt.color,width:qt.width,style:Os,opacity:qt.opacity})}for(const qt of me){if(!(qt!=null&&qt.points)||qt.points.length<2)continue;const Os=Math.min(...qt.points.map(un=>un.index));if(Math.max(...qt.points.map(un=>un.index))<$s-2||Os>Kt+2)continue;const mn=[];for(const un of qt.points){const jn=rn(un.index,un.value);jn&&mn.push(jn)}mn.length<2||es.push({kind:"polyline",points:mn,color:qt.color,width:qt.width,style:qt.style,opacity:qt.opacity})}for(const qt of ae){if(!(qt!=null&&qt.points)||qt.points.length<3)continue;const Os=Math.min(...qt.points.map(un=>un.index));if(Math.max(...qt.points.map(un=>un.index))<$s-2||Os>Kt+2)continue;const mn=[];for(const un of qt.points){const jn=rn(un.index,un.value);jn&&mn.push(jn)}mn.length<3||es.push({kind:"polygon",points:mn,fillColor:qt.fillColor,strokeColor:qt.strokeColor,strokeWidth:qt.strokeWidth,strokeStyle:qt.strokeStyle,opacity:qt.opacity})}for(const qt of We){if(!(qt!=null&&qt.commands)||!qt.commands.length)continue;const Os=[];for(const zs of qt.commands){const mn=rn(zs.index,zs.value);mn&&(zs.cmd==="M"||zs.cmd==="L")&&Os.push({cmd:zs.cmd,x:mn.x,y:mn.y})}Os.length&&es.push({kind:"path",commands:Os,color:qt.color,width:qt.width,style:qt.style,opacity:qt.opacity})}const Nn=qt=>{let Os=Number(qt==null?void 0:qt.startIndex),zs=Number(qt==null?void 0:qt.endIndex);if(!Number.isFinite(Os)||!Number.isFinite(zs))return null;if(Os>zs){const un=Os;Os=zs,zs=un}const mn=String((qt==null?void 0:qt.extend)||"").toLowerCase();return mn==="both"?(Os=0,zs=Math.max(0,Us-1)):mn==="left"?Os=0:mn==="right"&&(zs=Math.max(0,Us-1)),{a:Os,b:zs}},js=(qt,Os)=>Number.isFinite(qt==null?void 0:qt.slope)&&Number.isFinite(qt==null?void 0:qt.intercept)?qt.slope*Os+qt.intercept:Number.isFinite(qt==null?void 0:qt.startValue)?qt.startValue:Number.NaN;for(const qt of fe){const Os=qt==null?void 0:qt.line1,zs=qt==null?void 0:qt.line2;if(!Os||!zs)continue;const mn=Nn(Os),un=Nn(zs);if(!mn||!un)continue;const jn=Math.max($s,mn.a,un.a),ro=Math.min(Kt,mn.b,un.b);if(jn>ro)continue;const ys=[],qs=[];for(let Js=jn;Js<=ro;(Js+=1)-1){const is=js(Os,Js),ts=js(zs,Js);if(!Number.isFinite(is)||!Number.isFinite(ts))continue;const Ss=rn(Js,is),ln=rn(Js,ts);!Ss||!ln||(ys.push(Ss),qs.push(ln))}if(ys.length>1&&qs.length>1){const Js=ys.concat(qs.reverse());es.push({kind:"polygon",points:Js,fillColor:qt.color||"rgba(59,130,246,0.15)",opacity:qt.opacity})}}return es},ca=()=>{te&&Te.length&&(pt||(pt=!0,requestAnimationFrame(()=>{var M,V,fe,me;pt=!1,Rt=!0;try{const ae=o();if(!ae)return;const We=(fe=(M=ae.getXAxisPane)==null?void 0:(V=M.call(ae)).getAxisComponent)==null?void 0:fe.call(V);if(!We)return;const He=vc(),At=[],Wt=[],Jt=!!(te!=null&&te.isWebgl&&pe);for(const $s of Te){const Kt=(me=$s.def)==null?void 0:me.__lastResult;if(!Kt)continue;const Us=Array.isArray(Kt)?Kt:Array.isArray(Kt==null?void 0:Kt.__rows)?Kt.__rows:[],es=Number.isFinite(Kt==null?void 0:Kt.__len)?Number(Kt.__len):Us.length,rn=Array.isArray(Kt==null?void 0:Kt.__runtimeHeatmaps)?Kt.__runtimeHeatmaps:[],pn=Array.isArray(Kt==null?void 0:Kt.__runtimeLineDefs)?Kt.__runtimeLineDefs:[],Nn=Array.isArray(Kt==null?void 0:Kt.__runtimeLineFills)?Kt.__runtimeLineFills:[],js=Array.isArray(Kt==null?void 0:Kt.__runtimePolylineDefs)?Kt.__runtimePolylineDefs:[],qt=Array.isArray(Kt==null?void 0:Kt.__runtimePolygonDefs)?Kt.__runtimePolygonDefs:[],Os=Array.isArray(Kt==null?void 0:Kt.__runtimePathDefs)?Kt.__runtimePathDefs:[],zs=rn.length>0,mn=Jt&&(pn.length||Nn.length||js.length||qt.length||Os.length);if(!zs&&!mn)continue;const un=(Kt==null?void 0:Kt.__tsIndex)||{},jn=Array.isArray(Kt==null?void 0:Kt.__timeSeriesMs)?Kt.__timeSeriesMs:[];let ro=0;if(jn.length>=2){let Fo=0;for(let Dn=1;Dn<jn.length;(Dn+=1)-1)Fo+=Math.abs(jn[Dn]-jn[Dn-1]);ro=Fo/(jn.length-1)}const ys=(Kt==null?void 0:Kt.__drawConfig)||{},qs=$s.paneId??"candle_pane",Js=He[qs]||He.candle_pane;if(!Js)continue;const is=rc(qs),ts=is==null?void 0:is.axis;if(!ts)continue;const Ss={left:Js.left,top:Js.top,width:Js.width,height:Js.height},ln=typeof We.getRange=="function"?We.getRange():{from:0,to:es?es-1:0},on=es?es-1:-1,yo=typeof(Kt==null?void 0:Kt.__virtualMaxIndex)=="number"?Math.max(on,Number(Kt.__virtualMaxIndex)):on,pr=yo>=0?Math.max(0,Math.floor(((ln==null?void 0:ln.from)??0)-2)):0,dn=yo>=0?Math.min(yo,Math.ceil(((ln==null?void 0:ln.to)??yo)+2)):-1;if(zs){const Fo=_u({runtimeHeatmaps:rn,bounds:Ss,xAxis:We,yAxis:ts,offsetX:Ss.left,offsetY:Ss.top,drawConfigMeta:ys,len:es,tsIndex:un,timeSeriesMs:jn,avgIntervalMs:ro});Fo.length&&At.push({bounds:Ss,heatmaps:Fo})}if(mn){const Fo=eu({runtimeLineDefs:pn,runtimeLineFills:Nn,runtimePolylineDefs:js,runtimePolygonDefs:qt,runtimePathDefs:Os,bounds:Ss,xAxis:We,yAxis:ts,offsetX:Ss.left,offsetY:Ss.top,fromIndex:pr,toIndex:dn,len:es});Fo.length&&Wt.push({bounds:Ss,shapes:Fo})}}if(le&&At.length?le.render(At,{clear:!0}):le&&le.clear(),pe&&Wt.length){const $s=At.length===0;pe.render(Wt,{clear:$s})}}finally{Rt=!1}})))};function vc(){const M={},V=D==null?void 0:D.getBoundingClientRect(),fe=(V==null?void 0:V.width)??((X==null?void 0:X.width)||0),me=(V==null?void 0:V.height)??((X==null?void 0:X.height)||0),ae=new DOMRect(0,0,fe,me);return((D==null?void 0:D.querySelectorAll('[class*="dutycharts-pane"]'))||[]).forEach((He,At)=>{var Kt;if((Kt=He.classList)!=null&&Kt.contains("dutycharts-pane-separator"))return;const Jt=He.getAttribute("data-pane-id")||He.getAttribute("data-id")||""||(At===0?"candle_pane":`pane_index_${At}`);if(!Jt)return;const $s=He.getBoundingClientRect();if(V){const Us=$s.left-V.left,es=$s.top-V.top;M[Jt]=new DOMRect(Us,es,$s.width,$s.height)}else M[Jt]=ae}),M.candle_pane||(M.candle_pane=ae),M}function rc(M){var We,He,At,Wt,Jt,$s;if(!o())return null;const V=o(),fe=((We=V.getDrawPaneById)==null?void 0:We.call(V,M))??((He=V._drawPanes)==null?void 0:He.find(Kt=>{var Us;return((Us=Kt==null?void 0:Kt.getId)==null?void 0:Us.call(Kt))===M}));if(!(fe!=null&&fe.getAxisComponent))return null;const me=fe.getAxisComponent(),ae=((Jt=(Wt=(At=fe.getMainWidget)==null?void 0:At.call(fe))==null?void 0:Wt.getBounding)==null?void 0:Jt.call(Wt))??(($s=fe.getBounding)==null?void 0:$s.call(fe));return me?{axis:me,bounding:ae}:null}function wd(M){var Wt,Jt;const V=qi.get(M);if(!V)return;const fe=rc(M);if(!fe)return;const{axis:me}=fe,ae=Math.min(V.min,V.max),We=Math.max(V.min,V.max),He=Math.max(1e-9,We-ae),At={from:ae,to:We,range:He,realFrom:ae,realTo:We,realRange:He,displayFrom:ae,displayTo:We,displayRange:He};(Wt=me.setRange)==null||Wt.call(me,At),(Jt=me.buildTicks)==null||Jt.call(me,!0)}function zl(M){qi.has(M)&&(la.has(M)||(la.add(M),Ui.request(()=>{la.delete(M),wd(M)})))}const Fd=(M,V)=>{for(let fe=M.length-1;fe>=0;(fe-=1)+1){const ae=(M[fe]||{})[V];if(Number.isFinite(ae))return ae}return null},Tl=(M,V,fe,me,ae)=>{if(!fe||fe.legend===!1)return;const We=fe.plots||[],He=fe.plotKeys||[];if(!We.length)return;const At=[],Wt='12px "Inter", system-ui, -apple-system, sans-serif',Jt=14;for(let ts=0;ts<We.length;(ts+=1)-1){const Ss=We[ts]||{},ln=String((Ss==null?void 0:Ss.display)||"").toLowerCase();if(ln.includes("none")||ln==="display.none"||String(Ss.name||"").toLowerCase()==="__zero__"||Ss.legend===!1)continue;const on=He[ts];if(!on)continue;const yo=Fd(me,on),pr=typeof Ss.precision=="number"&&Number.isFinite(Ss.precision)?Math.max(0,Math.min(10,Math.trunc(Ss.precision))):4,dn=yo==null?"-":Al(yo,pr),Dn=`${String(Ss.name||on)} ${dn}`,Yo=Ss.color||"#94a3b8",Fi=dy(Dn,{font:Wt,color:"#e2e8f0",lineHeight:Jt,align:"left"});At.push({text:Dn,color:Yo,atlas:Fi})}if(!At.length)return;const $s=6,Kt=8,Us=6,es=gX(At.map(ts=>({width:ts.atlas?ts.atlas.width:0,height:ts.atlas?ts.atlas.height:Jt})),{pad:$s,swatch:Kt,gap:Us,lineHeight:Jt}),{boxW:rn,boxH:pn}=es,Nn=String((fe==null?void 0:fe.legendPosition)||"top_left").toLowerCase().replace(/\s+/g,"_"),js=Number((fe==null?void 0:fe.legendOffsetX)??0),qt=Number((fe==null?void 0:fe.legendOffsetY)??0),Os=Number.isFinite(js)?js:0,zs=Number.isFinite(qt)?qt:0,mn=8,un=Nn.includes("right"),jn=Nn.includes("bottom"),ro=V.top<12?24:8,ys=un?V.left+V.width-mn-rn+Os:V.left+mn+Os,qs=jn?V.top+V.height-mn-pn-zs:V.top+ro+zs,Js=jn?qs-ae:qs+ae;M.save(),M.beginPath(),M.rect(V.left,V.top,V.width,V.height),M.clip(),M.fillStyle="rgba(15,23,42,0.78)",M.strokeStyle="rgba(148,163,184,0.35)",M.lineWidth=1,M.beginPath(),Zd(M,ys,Js,rn,pn,6),M.fill(),M.stroke();let is=Js+$s;for(const ts of At){const Ss=ts.atlas,ln=Ss?Ss.height:Jt,on=Math.max(Jt,ln),yo=is+on/2-2;M.fillStyle=ts.color,M.fillRect(ys+$s,yo,Kt,4),Ss?M.drawImage(Ss.canvas,Math.round(ys+$s+Kt+Us),Math.round(is),Ss.width,Ss.height):(M.font=Wt,M.fillStyle="#e2e8f0",M.textBaseline="top",M.textAlign="left",M.fillText(ts.text,ys+$s+Kt+Us,is)),is+=on}return M.restore(),pn+6},xa=M=>{const V=fi((M==null?void 0:M.open)??(M==null?void 0:M.o)??(M==null?void 0:M.price)??(M==null?void 0:M.value)),fe=fi((M==null?void 0:M.close)??(M==null?void 0:M.c)??(M==null?void 0:M.price)??(M==null?void 0:M.value));return!ti(V)||!ti(fe)?null:(V+fe)/2},ku=(M,V,fe)=>{var Jt;const me=typeof(M==null?void 0:M.getRange)=="function"?M.getRange():null,ae=(Jt=fe==null?void 0:fe.getVisibleRange)==null?void 0:Jt.call(fe),We=Number.isFinite(me==null?void 0:me.from)?me.from:Number.isFinite(ae==null?void 0:ae.from)?ae.from:0,He=Number.isFinite(me==null?void 0:me.to)?me.to:Number.isFinite(ae==null?void 0:ae.to)?ae.to:Math.max(0,V-1),At=Math.max(0,Math.floor(We)),Wt=Math.min(Math.max(0,V-1),Math.ceil(He));return{from:At,to:Wt}},Qu=(M,V,fe,me)=>{const ae=typeof(me==null?void 0:me.size)=="number"&&me.size>0?me.size:5,We=typeof(me==null?void 0:me.alpha)=="number"&&Number.isFinite(me.alpha)?Math.max(0,Math.min(1,me.alpha)):1,He=typeof(me==null?void 0:me.glow)=="number"&&me.glow>=0?me.glow:10;M.save(),M.globalAlpha=We,M.shadowColor="rgba(56,189,248,0.55)",M.shadowBlur=He,M.fillStyle="rgba(15,23,42,0.9)",M.strokeStyle="#38bdf8",M.lineWidth=2,M.beginPath(),M.arc(V,fe,ae,0,Math.PI*2),M.fill(),M.stroke(),M.shadowBlur=0,M.fillStyle="#e2e8f0",M.beginPath(),M.arc(V,fe,Math.max(1.4,ae*.32),0,Math.PI*2),M.fill(),M.restore()};function ed(){var Jt,$s,Kt,Us,es,rn,pn;if(!ie||!o())return;const M=ie;M.clearRect(0,0,X.width,X.height),M.save(),M.font='12px "Inter", system-ui, -apple-system, sans-serif',M.textAlign="center",M.textBaseline="middle";const V=o(),fe=vc(),me=((Jt=V.getDataList)==null?void 0:Jt.call(V))||[],ae=(Us=(Kt=($s=V.getXAxisPane)==null?void 0:$s.call(V))==null?void 0:Kt.getAxisComponent)==null?void 0:Us.call(Kt),We=new Set,He=[],At={},Wt={};for(const Nn of Te){const{def:js,paneId:qt}=Nn,Os=js==null?void 0:js.__lastResult,zs=Array.isArray(Os)?Os:Array.isArray(Os==null?void 0:Os.__rows)?Os.__rows:[];if(!Array.isArray(zs)||zs.length===0||!Os)continue;const mn=fe[qt]||fe.candle_pane,un={left:mn.left,top:mn.top,width:mn.width,height:mn.height},jn=Os.__labelItems;if(Array.isArray(jn)){const Js=Os.__tsIndex||{},is={},ts={};for(const Ss of jn){const ln=Ss==null?void 0:Ss.meta;if(!ln)continue;const on=ln==null?void 0:ln.value;if(typeof on!="number"||!Number.isFinite(on))continue;const yo=Ss==null?void 0:Ss.ts,pr=Ss==null?void 0:Ss.tsMs,dn=(()=>{if(typeof(Ss==null?void 0:Ss.index)=="number")return Ss.index;if(typeof yo=="number"&&Number.isFinite(yo)){const ii=Js[String(yo)];if(typeof ii=="number")return ii}if(typeof pr=="number"&&Number.isFinite(pr)){const ii=Js[`${Math.floor(pr)}_ms`]??Js[`${Math.floor(pr/1e3)}_s`];if(typeof ii=="number")return ii}})();if(typeof dn!="number"||!Number.isFinite(dn))continue;const Fo=(ln.position||"above")==="above",Dn=typeof ln.size=="number"&&ln.size>0?ln.size:12,Yo=typeof ln.offsetY=="number"?ln.offsetY:10,Fi=Fo?is[dn]||0:ts[dn]||0,fo=Yo+Fi*Math.max(6,Dn/3);Fo?is[dn]=Fi+1:ts[dn]=Fi+1;const Pn=(ln==null?void 0:ln.tooltip)!=null?String(ln.tooltip):"";Pn&&He.push({kind:"label",paneId:qt,ts:typeof yo=="number"?yo:void 0,index:dn,value:on,tooltip:Pn,size:Dn,isAbove:Fo,offsetPx:fo})}}const ro=Os.__runtimeTables;if(Array.isArray(ro))for(const Js of ro)(Array.isArray(Js==null?void 0:Js.cells)?Js.cells:[]).some(Ss=>Ss==null?void 0:Ss.tooltip)&&He.push({kind:"table",paneId:qt,table:Js});const ys=dse(js.name);if(Array.isArray(ys)&&ys.length)for(const Js of ys){const is=Js.index,ts=me[is],Ss=(ts==null?void 0:ts.timestamp)??(ts==null?void 0:ts.time);if(!Number.isFinite(Ss))continue;let ln,on="",yo=!0,pr="";Js.type==="entry_long"?(ln=(ts==null?void 0:ts.low)??(ts==null?void 0:ts.close),on="#16a34a",yo=!0,pr="BUY"):Js.type==="exit_long"?(ln=(ts==null?void 0:ts.high)??(ts==null?void 0:ts.close),on="#f59e0b",yo=!1,pr="EXIT"):Js.type==="entry_short"?(ln=(ts==null?void 0:ts.high)??(ts==null?void 0:ts.close),on="#ef4444",yo=!1,pr="SELL"):Js.type==="exit_short"&&(ln=(ts==null?void 0:ts.low)??(ts==null?void 0:ts.close),on="#f59e0b",yo=!0,pr="EXIT");const dn=Array.isArray(js==null?void 0:js.figures)&&((es=js.figures[0])!=null&&es.key)?String(js.figures[0].key):"",Fo=qt!=="candle_pane";let Dn=ln;if(Fo&&dn){const Gu=(zs[is]||{})[dn];Gu!=null&&Number.isFinite(Gu)&&(Dn=Gu)}if(!Number.isFinite(Dn))continue;const Yo=db({id:is,t:Ss,p:Dn},{chart:o(),paneId:qt});if(!Yo)continue;const Fi=12;M.font=`600 ${Fi}px "Inter", system-ui, -apple-system, sans-serif`;const fo=Math.max(12,M.measureText(pr).width+18),Pn=Math.max(16,Fi+8),ii=6,Dr=6,ni=un.top+6,Xo=un.top+un.height-6,sr=ni+ii+Pn,Sl=Xo-ii-Pn,Ru=Yo.y;let rl=yo?Ru-Dr:Ru+Dr;rl=Math.max(sr,Math.min(Sl,rl));const Vi=Yo.x-Math.floor(fo/2),Xl=yo?rl-ii-Pn:rl+ii,Hc=Math.max(3,Math.floor(Pn/3)),Da=on||"#16a34a",gf="rgba(0,0,0,0.35)",ju="#f8fafc";M.save(),M.lineWidth=1,M.fillStyle=Da,M.strokeStyle=gf,M.shadowColor="rgba(0,0,0,0.25)",M.shadowBlur=6,x(M,Vi,Xl,fo,Pn,Hc),M.fill(),M.stroke(),M.shadowBlur=0,M.beginPath(),yo?(M.moveTo(Yo.x-ii,Xl+Pn),M.lineTo(Yo.x+ii,Xl+Pn),M.lineTo(Yo.x,rl)):(M.moveTo(Yo.x-ii,Xl),M.lineTo(Yo.x+ii,Xl),M.lineTo(Yo.x,rl)),M.closePath(),M.fill(),M.stroke(),pr&&(M.fillStyle=ju,M.textAlign="center",M.textBaseline="middle",M.fillText(pr,Yo.x,Xl+Pn/2)),M.restore()}const qs=js==null?void 0:js.__plotMeta;if(qs&&mn){const Js=qt||"candle_pane",ts=String((qs==null?void 0:qs.legendPosition)||"top_left").toLowerCase().replace(/\s+/g,"_").includes("bottom");Js in Wt||(Wt[Js]=gc(o(),Js));const Ss=At[Js]||0,ln=ts?0:Wt[Js]||0,on=Ss+ln,yo=Tl(M,mn,qs,zs,on);typeof yo=="number"&&Number.isFinite(yo)&&(At[Js]=(At[Js]||0)+yo)}}if(i(wa)&&ae){const Nn=i(wa).paneId,js=fe[Nn]||fe.candle_pane;if(js&&!We.has(Nn)){const qt=rc(Nn),Os=qt==null?void 0:qt.axis,zs=ku(ae,me.length,V),mn=Math.max(0,zs.to-zs.from+1);let un=Math.max(1,Math.floor(Si));mn/un>cc&&(un=Math.max(1,Math.ceil(mn/cc)));let jn=null;if(i(wa).kind==="indicator"){const is=((rn=V.getIndicators)==null?void 0:rn.call(V,{paneId:Nn}))||((pn=V.getIndicators)==null?void 0:pn.call(V))||[];jn=is.find(ts=>(ts==null?void 0:ts.id)===i(wa).indicatorId)||is.find(ts=>(ts==null?void 0:ts.name)===i(wa).indicatorName)||null}let ro=[];const ys=jn&&Or(jn),qs=js?ou(js):null,Js=ys&&jn?md(jn,me,zs.from,zs.to):0;if(jn&&Mr(jn)&&(ro=ld(Array.isArray(jn==null?void 0:jn.result)?jn.result:[],zs.from,zs.to)),Os&&mn>0){M.save(),M.beginPath(),M.rect(js.left,js.top,js.width,js.height),M.clip();for(let is=zs.from;is<=zs.to;is+=un){let ts=null;if(i(wa).kind==="candle")Nn==="candle_pane"&&(ts=xa(me[is]));else if(i(wa).kind==="indicator"&&i(wa).plotKey&&jn){const yo=Pr(jn,is,me);yo&&(ts=fi(yo[i(wa).plotKey])),!ti(ts)&&i(wa).plotKey==="zigzag"&&ro.length&&(ts=iu(ro,is))}if(!ti(ts))continue;const Ss=ae.convertToPixel(is);let ln=Os.convertToPixel(ts)+js.top;if(ys&&qs&&Js>0&&i(wa).plotKey==="volume"){const yo=Math.min(1,ts/Js),pr=Math.max(1,Math.floor(yo*qs.effectiveBandHeight));ln=js.top+qs.bandBottom-pr}if(!ti(Ss)||!ti(ln))continue;const on=is===i(wa).barIndex;Qu(M,Ss,ln,{size:on?5:3,alpha:on?1:.75,glow:on?10:6})}M.restore(),We.add(Nn)}}}se=He,sp(),ie==null||ie.restore()}function td(){!xe||!de||xe.clearRect(0,0,de.width,de.height)}function sp(){Ne!=null&&cancelAnimationFrame(Ne),Ne=requestAnimationFrame(()=>{Ne=null,Nf()})}const Gf=(M,V)=>!(M.x+M.width<V.x||V.x+V.width<M.x||M.y+M.height<V.y||V.y+V.height<M.y),kd=M=>{if((M==null?void 0:M.avoidOverlap)===!0||(M==null?void 0:M.avoid_overlap)===!0)return!0;const V=String((M==null?void 0:M.collision)||"").toLowerCase();return V==="avoid"||V==="hide"},Zd=(M,V,fe,me,ae,We)=>{const He=Math.max(0,Math.min(We,Math.min(me,ae)/2));M.beginPath(),M.moveTo(V+He,fe),M.lineTo(V+me-He,fe),M.quadraticCurveTo(V+me,fe,V+me,fe+He),M.lineTo(V+me,fe+ae-He),M.quadraticCurveTo(V+me,fe+ae,V+me-He,fe+ae),M.lineTo(V+He,fe+ae),M.quadraticCurveTo(V,fe+ae,V,fe+ae-He),M.lineTo(V,fe+He),M.quadraticCurveTo(V,fe,V+He,fe),M.closePath()},gc=(M,V)=>{var ys,qs,Js,is,ts;if(!M)return 0;const fe=(ys=M.getChartStore)==null?void 0:ys.call(M),me=((qs=fe==null?void 0:fe.getStyles)==null?void 0:qs.call(fe))||{},ae=((Js=me==null?void 0:me.candle)==null?void 0:Js.tooltip)||{},We=((is=me==null?void 0:me.indicator)==null?void 0:is.tooltip)||{},He=(Ss,ln)=>{const on=Number.isFinite(Ss==null?void 0:Ss.size)?Number(Ss.size):ln,yo=Number.isFinite(Ss==null?void 0:Ss.marginTop)?Number(Ss.marginTop):0,pr=Number.isFinite(Ss==null?void 0:Ss.marginBottom)?Number(Ss.marginBottom):0;return on+yo+pr},At=(Ss,ln)=>{if((Ss==null?void 0:Ss.show)===!1)return 0;const on=Number.isFinite(Ss==null?void 0:Ss.size)?Number(Ss.size):ln,yo=Number.isFinite(Ss==null?void 0:Ss.marginTop)?Number(Ss.marginTop):0,pr=Number.isFinite(Ss==null?void 0:Ss.marginBottom)?Number(Ss.marginBottom):0;return on+yo+pr},Wt=(ae==null?void 0:ae.legend)||{},Jt=He(Wt,12),$s=At(ae==null?void 0:ae.title,14);let Kt=0;const Us=Wt==null?void 0:Wt.template;Array.isArray(Us)?Kt=Us.length:Array.isArray(Wt==null?void 0:Wt.labels)?Kt=Wt.labels.length:Kt=5;let es=$s+Jt*Math.max(0,Kt);const rn=(We==null?void 0:We.legend)||{},pn=He(rn,12),Nn=At(We==null?void 0:We.title,12),js=Array.isArray((ts=M.getIndicators)==null?void 0:ts.call(M,{paneId:V}))?M.getIndicators({paneId:V}):[];let qt=0;for(const Ss of js){if((Ss==null?void 0:Ss.visible)===!1)continue;const ln=Array.isArray(Ss==null?void 0:Ss.figures)?Ss.figures.length:1,on=Math.max(1,ln);qt+=on,es+=Nn}es+=pn*qt;const Os=(ae==null?void 0:ae.rect)||{},zs=Number.isFinite(Os==null?void 0:Os.paddingTop)?Number(Os.paddingTop):4,mn=Number.isFinite(Os==null?void 0:Os.paddingBottom)?Number(Os.paddingBottom):4,un=Number.isFinite(Os==null?void 0:Os.offsetTop)?Number(Os.offsetTop):4,jn=Number.isFinite(Os==null?void 0:Os.offsetBottom)?Number(Os.offsetBottom):4,ro=Number.isFinite(Os==null?void 0:Os.borderSize)?Number(Os.borderSize):1;return es+=zs+mn+un+jn+ro*2,Math.max(0,Math.ceil(es+6))};function jf(M,V,fe,me,ae,We){if(!V)return;const He=260,At=10,Wt=8,Jt=16;M.save(),M.font='12px "Inter", system-ui, -apple-system, sans-serif';const $s=dy(V,{font:M.font,color:"#e2e8f0",maxWidth:He-At*2,wrap:!0,lineHeight:Jt,align:"left"}),Kt=$s?$s.width:M.measureText(V).width,Us=$s?$s.height:Jt,es=Math.min(He,Math.max(60,Kt+At*2)),rn=Math.max(Jt+Wt*2,Us+Wt*2),pn=8,Nn=12,js=[{x:fe+Nn,y:me+Nn},{x:fe-es-Nn,y:me+Nn},{x:fe+Nn,y:me-rn-Nn},{x:fe-es-Nn,y:me-rn-Nn}];let qt=js[0],Os=Number.POSITIVE_INFINITY;for(const ys of js){const qs=Math.max(0,pn-ys.x),Js=Math.max(0,ys.x+es-(ae-pn)),is=Math.max(0,pn-ys.y),ts=Math.max(0,ys.y+rn-(We-pn)),Ss=qs+Js+is+ts;Ss<Os&&(Os=Ss,qt=ys)}let zs=qt.x,mn=qt.y;zs=Math.max(pn,Math.min(ae-es-pn,zs)),mn=Math.max(pn,Math.min(We-rn-pn,mn));const un=8;M.fillStyle="rgba(15,23,42,0.92)",M.strokeStyle="rgba(148,163,184,0.35)",M.lineWidth=1,M.beginPath(),M.moveTo(zs+un,mn),M.lineTo(zs+es-un,mn),M.quadraticCurveTo(zs+es,mn,zs+es,mn+un),M.lineTo(zs+es,mn+rn-un),M.quadraticCurveTo(zs+es,mn+rn,zs+es-un,mn+rn),M.lineTo(zs+un,mn+rn),M.quadraticCurveTo(zs,mn+rn,zs,mn+rn-un),M.lineTo(zs,mn+un),M.quadraticCurveTo(zs,mn,zs+un,mn),M.closePath(),M.fill(),M.stroke(),M.fillStyle="#e2e8f0",M.textAlign="left",M.textBaseline="top";const jn=zs+At,ro=mn+Wt;$s?M.drawImage($s.canvas,Math.round(jn),Math.round(ro),$s.width,$s.height):M.fillText(V,jn,ro),M.restore()}function Nf(){var Jt,$s,Kt,Us;if(!xe||!de||!D)return;if(xe.clearRect(0,0,de.width,de.height),!se.length){try{ed()}catch{}if(!se.length)return}const M=o();if(!M)return;const V=D.getBoundingClientRect(),fe=vc();let me=i(Xe),ae=i(Dp);const We=(Kt=(Jt=M.getChartStore)==null?void 0:($s=Jt.call(M)).getCrosshair)==null?void 0:Kt.call($s);if(We&&(Number.isFinite(We.realX)||Number.isFinite(We.x))){const es=We.paneId||"candle_pane",rn=fe[es]||fe.candle_pane,pn=typeof We.realX=="number"?We.realX:We.x;if(typeof pn=="number"&&Number.isFinite(pn)&&(me=pn),typeof We.y=="number"&&Number.isFinite(We.y)){const Nn=(rn==null?void 0:rn.top)??0;ae=We.y+Nn}}if(me==null||ae==null||me<0||ae<0||me>V.width||ae>V.height)return;const He=((Us=M.getDataList)==null?void 0:Us.call(M))||[];let At=null;for(const es of se){if(es.kind!=="table")continue;const rn=fe[es.paneId]||fe.candle_pane;if(!rn)continue;const pn=me-rn.left,Nn=ae-rn.top,js=es.table;if(!js||pn<0||Nn<0)continue;const qt=Math.max(1,Math.floor(Number(js.columns??1))),Os=Math.max(1,Math.floor(Number(js.rows??1))),zs=typeof js.textSize=="number"&&js.textSize>0?js.textSize:12,mn=8,un=new Array(qt).fill(0),jn=new Array(Os).fill(Math.max(20,zs+8)),ro=Array.isArray(js.cells)?js.cells:[],ys=new Map;for(const Dn of ro){const Yo=Math.max(0,Math.min(qt-1,Dn.column)),Fi=Math.max(0,Math.min(Os-1,Dn.row));ys.set(`${Yo}:${Fi}`,Dn)}const qs=Array.isArray(js.merges)?js.merges:[],Js=new Map,is=new Map;for(const Dn of qs){if(!Dn)continue;let Yo=Math.max(0,Math.min(qt-1,Math.floor(Number(Dn.left)))),Fi=Math.max(0,Math.min(qt-1,Math.floor(Number(Dn.right)))),fo=Math.max(0,Math.min(Os-1,Math.floor(Number(Dn.top)))),Pn=Math.max(0,Math.min(Os-1,Math.floor(Number(Dn.bottom))));if(!Number.isFinite(Yo)||!Number.isFinite(Fi)||!Number.isFinite(fo)||!Number.isFinite(Pn))continue;Yo>Fi&&([Yo,Fi]=[Fi,Yo]),fo>Pn&&([fo,Pn]=[Pn,fo]);const ii=`${Yo}:${fo}:${Fi}:${Pn}`;is.has(ii)||is.set(ii,{left:Yo,top:fo,right:Fi,bottom:Pn,minW:0,minH:0});for(let Dr=Yo;Dr<=Fi;(Dr+=1)-1)for(let ni=fo;ni<=Pn;(ni+=1)-1)Js.set(`${Dr}:${ni}`,{left:Yo,top:fo,right:Fi,bottom:Pn})}for(const Dn of ro){const Yo=Math.max(0,Math.min(qt-1,Dn.column)),Fi=Math.max(0,Math.min(Os-1,Dn.row)),fo=Js.get(`${Yo}:${Fi}`);if(fo&&(fo.left!==Yo||fo.top!==Fi))continue;const Pn=Dn.text||"",ii=typeof Dn.textSize=="number"&&Dn.textSize>0?Dn.textSize:zs;xe.font=`${ii}px "Inter", system-ui, -apple-system, sans-serif`;const Dr=xe.measureText(Pn).width+mn*2,ni=typeof Dn.width=="number"&&Dn.width>0?Dn.width:0,Xo=typeof Dn.height=="number"&&Dn.height>0?Dn.height:Math.max(20,ii+8);if(fo){const sr=`${fo.left}:${fo.top}:${fo.right}:${fo.bottom}`,Sl=is.get(sr);Sl&&(Sl.minW=Math.max(Sl.minW,Dr,ni),Sl.minH=Math.max(Sl.minH,Xo))}else un[Yo]=Math.max(un[Yo],Dr,ni),jn[Fi]=Math.max(jn[Fi],Xo)}for(let Dn=0;Dn<qt;(Dn+=1)-1)un[Dn]<60&&(un[Dn]=60);for(const Dn of is.values()){let Yo=0;for(let fo=Dn.left;fo<=Dn.right;(fo+=1)-1)Yo+=un[fo]||0;Yo<Dn.minW&&(un[Dn.right]=(un[Dn.right]||0)+(Dn.minW-Yo));let Fi=0;for(let fo=Dn.top;fo<=Dn.bottom;(fo+=1)-1)Fi+=jn[fo]||0;Fi<Dn.minH&&(jn[Dn.bottom]=(jn[Dn.bottom]||0)+(Dn.minH-Fi))}const ts=un.reduce((Dn,Yo)=>Dn+Yo,0),Ss=jn.reduce((Dn,Yo)=>Dn+Yo,0),ln=String(js.position||"top_right").toLowerCase();let on=mn,yo=mn;const pr=rn.width,dn=rn.height;if(ln.includes("top_right")?(on=pr-ts-mn,yo=mn):ln.includes("bottom_left")?(on=mn,yo=dn-Ss-mn):ln.includes("bottom_right")?(on=pr-ts-mn,yo=dn-Ss-mn):ln.includes("top_center")?(on=(pr-ts)/2,yo=mn):ln.includes("bottom_center")?(on=(pr-ts)/2,yo=dn-Ss-mn):(ln.includes("middle_center")||ln.includes("center"))&&(on=(pr-ts)/2,yo=(dn-Ss)/2),pn<on||Nn<yo||pn>on+ts||Nn>yo+Ss)continue;let Fo=on;for(let Dn=0;Dn<qt;(Dn+=1)-1){let Yo=yo;for(let Fi=0;Fi<Os;(Fi+=1)-1){const fo=un[Dn],Pn=jn[Fi],ii=Js.get(`${Dn}:${Fi}`);if(ii&&(ii.left!==Dn||ii.top!==Fi)){Yo+=Pn;continue}const Dr=ii?(()=>{let sr=0;for(let Sl=ii.left;Sl<=ii.right;(Sl+=1)-1)sr+=un[Sl]||0;return sr})():fo,ni=ii?(()=>{let sr=0;for(let Sl=ii.top;Sl<=ii.bottom;(Sl+=1)-1)sr+=jn[Sl]||0;return sr})():Pn,Xo=ys.get(`${Dn}:${Fi}`);if(Xo!=null&&Xo.tooltip&&pn>=Fo&&pn<=Fo+Dr&&Nn>=Yo&&Nn<=Yo+ni){At={text:String(Xo.tooltip),x:rn.left+Fo+Dr/2,y:rn.top+Yo+ni/2};break}Yo+=Pn}if(At)break;Fo+=un[Dn]}if(At)break}if(At){jf(xe,At.text,At.x,At.y,V.width,V.height);return}let Wt=null;for(const es of se){if(es.kind!=="label")continue;const rn=typeof es.ts=="number"?es.ts:typeof es.index=="number"?(()=>{const qs=He[es.index];return(qs==null?void 0:qs.timestamp)??(qs==null?void 0:qs.time)??(qs==null?void 0:qs.t)})():void 0;if(typeof rn!="number"||!Number.isFinite(rn))continue;const pn=rn<1e12?rn*1e3:rn,Nn=db({t:pn,p:es.value},{chart:M,paneId:es.paneId});if(!Nn)continue;let js=Nn.y;const qt=typeof es.offsetPx=="number"?es.offsetPx:10;es.isAbove!==!1?js-=qt:js+=qt;const zs=fe[es.paneId]||fe.candle_pane,mn=typeof es.size=="number"&&es.size>0?es.size/2:6;if(zs){const qs=zs.top+mn+2,Js=zs.top+zs.height-mn-2;js=Math.max(qs,Math.min(Js,js))}const un=me-Nn.x,jn=ae-js,ro=Math.hypot(un,jn),ys=Math.max(14,mn+10);ro<=ys&&(!Wt||ro<Wt.dist)&&(Wt={text:es.tooltip,x:Nn.x,y:js,dist:ro})}Wt&&jf(xe,Wt.text,Wt.x,Wt.y,V.width,V.height)}function Jd(M){if(!M)return{r:0,g:0,b:0};const V=M.trim();if(V.startsWith("#")&&(V.length===7||V.length===4)){const me=V.length===4?`#${V[1]}${V[1]}${V[2]}${V[2]}${V[3]}${V[3]}`:V,ae=parseInt(me.slice(1,3),16),We=parseInt(me.slice(3,5),16),He=parseInt(me.slice(5,7),16);return{r:ae,g:We,b:He}}const fe=M.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);return fe?{r:+fe[1],g:+fe[2],b:+fe[3]}:{r:0,g:0,b:0}}const xl=48,Su=80,ad=6,Af=4,fu=(M,V)=>{const fe=String(M??"").replace(/\s*\n\s*/g," ");return fe.length<=V?fe:V<=1?"…":`${fe.slice(0,Math.max(0,V-1))}…`},$u=M=>{if(!Number.isFinite(M))return;const V=Math.round(Number(M));return Math.max(8,Math.min(32,V))},yu=M=>{if(!Number.isFinite(M))return;const V=Math.round(Number(M));return Math.max(0,Math.min(4,V))},Yf=M=>{var Jt;if(!M)return M;const V=String(M).trim(),fe=V.match(/^rgba?\(([^)]+)\)$/i);if(!fe)return V;const me=((Jt=fe[1])==null?void 0:Jt.split(",").map($s=>$s.trim()))??[];if(me.length<3)return V;const ae=Number(me[0]),We=Number(me[1]),He=Number(me[2]);if(!Number.isFinite(ae)||!Number.isFinite(We)||!Number.isFinite(He))return V;if(me.length<4)return`rgb(${Math.round(ae)}, ${Math.round(We)}, ${Math.round(He)})`;const At=Number(me[3]),Wt=Number.isFinite(At)?Math.max(0,Math.min(1,At)):1;return`rgba(${Math.round(ae)}, ${Math.round(We)}, ${Math.round(He)}, ${Wt})`},Ga=M=>{var We;const fe=String(M||"").trim().match(/^rgba\(([^)]+)\)$/i);if(!fe)return null;const me=((We=fe[1])==null?void 0:We.split(",").map(He=>He.trim()))??[];if(me.length<4)return null;const ae=Number(me[3]);return Number.isFinite(ae)?Math.max(0,Math.min(1,ae)):null},nf=M=>{const V=Jd(M),fe=Ga(M)??1,me=We=>Math.max(0,Math.min(255,Math.round(We*.75))),ae=Math.max(0,Math.min(1,fe+.15));return`rgba(${me(V.r)}, ${me(V.g)}, ${me(V.b)}, ${ae})`},Sd=M=>{const V=M.bgColor?Yf(String(M.bgColor)):void 0,fe=M.borderColor?Yf(String(M.borderColor)):void 0;let me=yu(typeof M.borderWidth=="number"?M.borderWidth:void 0);me==null&&(me=fe?1:0);let ae=fe;!ae&&me>0&&V&&(ae=nf(V)),!ae&&!fe&&(me=0);const We=String(M.borderStyle||"solid").toLowerCase(),He=me>0?wk(We,me):[],At=0,Wt=fu(M.text??"",xl),Jt=fu(M.tooltip??"",Su),$s=M.textColor?Yf(String(M.textColor)):void 0,Kt=$u(M.textSize)??12,Us=M.textHalign==="left"||M.textHalign==="right"?M.textHalign:"center",es=M.textValign==="top"||M.textValign==="bottom"?M.textValign:"middle";return{bgColor:V,borderColor:ae,borderWidth:me,borderStyle:We,dash:He,dashOffset:At,textFinal:Wt,tooltipFinal:Jt,textColor:$s,fontPx:Kt,textHalign:Us,textValign:es,padX:ad,padY:Af}};function wp(M,V){let fe=M.replace(/\s+/g,"_").toLowerCase().replace(/[^a-z0-9_]+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||"plot",me=1;for(;V.has(fe);)fe=`${fe}_${me}`,me+=1;return V.add(fe),fe}function ac(M){if(M){try{tl.forEach(V=>{pse(V),T6(V)})}catch{}aa.forEach(V=>{try{M.removeIndicator({id:V})}catch{}}),aa=[],tl.forEach(V=>{try{M.removeIndicator({paneId:"candle_pane",name:V})}catch{}try{M.removeIndicator({paneId:"pane_script",name:V})}catch{}try{M.removeIndicator({paneId:"script_pane",name:V})}catch{}}),tl=[],Te=[];try{xd()}catch{}qi.forEach((V,fe)=>{var ae,We,He;const me=rc(fe);(ae=me==null?void 0:me.axis)!=null&&ae.setAutoCalcTickFlag&&(me.axis.setAutoCalcTickFlag(!0),(He=(We=me.axis).buildTicks)==null||He.call(We,!0))}),qi.clear(),la.clear(),b(Zr,null)}}const Ld={limits:{line:240,linefill:120,label:300,box:180,table:20,polyline:180,polygon:160,path:160},pruningPolicy:"fifo",futureBars:200,time:{mode:"nearest",toleranceBars:2,toleranceMs:6e4},decimationPx:2},Cu=500,Ie=200,ge={labels:Cu,lines:500,boxes:Ie,runtimeDraws:1e3},Re={maxPx:0,offsetPx:0,lastAppliedTs:0},vt=new Map,Bt=new Map;function Xt(M){if(!Array.isArray(M)||M.length===0)return null;let V=0,fe=0;M.forEach(ae=>{if(typeof ae=="string"){fe+=1;return}String((ae==null?void 0:ae.level)||"").toLowerCase()==="error"?V+=1:fe+=1});const me=V+fe;return me?V&&fe?`issues: ${me} (${V} error${V===1?"":"s"})`:V?`errors: ${V}`:`warnings: ${fe}`:null}function W(M,V){const fe=[],me=new Set,ae=We=>{if(!We)return;const He=String((We==null?void 0:We.level)||"warning").toLowerCase(),At=String((We==null?void 0:We.message)||We||"").trim();if(!At)return;const Wt=`${He}:${At}`;me.has(Wt)||(me.add(Wt),typeof We=="string"?fe.push({level:"warning",message:At}):fe.push(We))};return(M||[]).forEach(ae),(V||[]).forEach(ae),fe}function Q(M){if(M==null)return!1;const V=String(M).trim().toLowerCase();if(!V)return!1;if(V==="transparent"||V==="none")return!0;const fe=V.match(/rgba?\(([^)]+)\)/);if(fe){const ae=fe[1].split(",").map(We=>We.trim());if(ae.length>=4){const We=Number(ae[3]);return Number.isFinite(We)&&We<=0}return!1}const me=V.match(/hsla?\(([^)]+)\)/);if(me){const ae=me[1].split(",").map(We=>We.trim());if(ae.length>=4){const We=Number(ae[3]);return Number.isFinite(We)&&We<=0}return!1}if(V.startsWith("#")){const ae=V.slice(1);if(ae.length===4)return ae[3]==="0";if(ae.length===8)return ae.slice(6)==="00"}return!1}function O(M){if(!M||typeof M!="object")return!1;const V=M.gradient||M.upGradient||M.downGradient;if(V){const ae=V==null?void 0:V.from,We=V==null?void 0:V.to;return ae!=null||We!=null?!Q(ae)||!Q(We):!0}const fe=[M.color,M.downColor,M.wickColor,M.borderColor];return fe.some(ae=>ae!=null)?fe.some(ae=>ae!=null&&!Q(ae)):!0}async function U(M,V="auto"){var Lf,Mp,Up,Yh,_p,xm,pv,Sh,Mv,hv,rm,Km,Gv,Xm,up,Wi,Nr,Kc,Yu,Vd,Yi;const fe=o();if(!fe)throw new Error("Chart not ready yet. Please try again in a moment.");Cn=new Set,V!=="js"&&b(Mn,H([]));const me=String(V||"script").trim().toLowerCase(),ae=V==="pine",We=new Map,He=ae?{emitOnce:($t,En)=>{const Mo=String($t||En||"").trim(),No=String(En||$t||"").trim();!Mo||!No||We.has(Mo)||We.set(Mo,No)}}:void 0,At=($t,En)=>{if(!ae)return;const Mo=`Limit exceeded: ${$t} (max ${En})`;Cn.add(Mo)};ae&&((!M.params||typeof M.params!="object")&&(M.params={}),M.params.__pinev2=1),Vo=((Lf=M.params)==null?void 0:Lf.__pinev2)===1;const Wt=V==="json",Jt=Array.isArray(M.calc)?M.calc:[],$s=Array.isArray(M.series)?M.series:[],Kt=Array.isArray(M.stateSeries)?M.stateSeries:[],Us=$t=>String($t||"").replace(/\s+/g,"_").toLowerCase(),es=($t,En)=>{const Mo=new Set,No=Xd($t),ka=/[A-Za-z_$][A-Za-z0-9_$]*/g;let Xc;for(;Xc=ka.exec(No);){const eo=Us(Xc[0]||"");En.has(eo)&&Mo.add(eo)}return Mo},rn=$t=>{const En=[],Mo=[],No=[],ka=new Map;$t.forEach((Xa,Vl)=>{const Qf=Us(String((Xa==null?void 0:Xa.name)||`series_${Vl}`));No[Vl]=Qf,ka.set(Qf,String((Xa==null?void 0:Xa.expr)??""))});const Xc=new Set(ka.keys()),eo=new Set;ka.forEach((Xa,Vl)=>{/\b__arr_/i.test(Xa)&&eo.add(Vl)});let Ra=!0;for(;Ra;)Ra=!1,ka.forEach((Xa,Vl)=>{if(eo.has(Vl))return;const Qf=es(Xa,Xc);for(const Bp of Qf)if(eo.has(Bp)){eo.add(Vl),Ra=!0;break}});return $t.forEach((Xa,Vl)=>{const Qf=No[Vl]||"";eo.has(Qf)?Mo.push(Xa):En.push(Xa)}),{primary:En,arrayDependent:Mo}},{primary:pn,arrayDependent:Nn}=rn($s),js=[],qt=Array.isArray(M.signals)?M.signals:[];if(Array.isArray(M.panes))for(const $t of M.panes){const En=$t.pane==="sub"?"sub":"main";js.push({pane:En,plots:Array.isArray($t.plots)?$t.plots:[],levels:Array.isArray($t.levels)?$t.levels:[],labels:Array.isArray($t.labels)?$t.labels:[],lines:Array.isArray($t.lines)?$t.lines:[],runtimeDrawOps:Array.isArray($t.runtimeDrawOps)?$t.runtimeDrawOps:[],runtimeLabels:Array.isArray($t.runtimeLabels)?$t.runtimeLabels:[],runtimeLines:Array.isArray($t.runtimeLines)?$t.runtimeLines:[],runtimeBoxes:Array.isArray($t.runtimeBoxes)?$t.runtimeBoxes:[],runtimeTables:Array.isArray($t.runtimeTables)?$t.runtimeTables:[],runtimeHeatmaps:Array.isArray($t.runtimeHeatmaps)?$t.runtimeHeatmaps:[],overlays:Array.isArray($t.overlays)?$t.overlays:[],fills:Array.isArray($t.fills)?$t.fills:[],backgroundZones:Array.isArray($t.backgroundZones)?$t.backgroundZones:[],min:$t.min,max:$t.max,shortName:$t.shortName||M.shortName,height:$t.height})}else if(M.main||M.sub)M.main&&js.push({pane:"main",plots:Array.isArray(M.main.plots)?M.main.plots:[],levels:Array.isArray(M.main.levels)?M.main.levels:[],labels:Array.isArray(M.main.labels)?M.main.labels:[],lines:Array.isArray(M.main.lines)?M.main.lines:[],runtimeDrawOps:Array.isArray(M.main.runtimeDrawOps)?M.main.runtimeDrawOps:[],runtimeLabels:Array.isArray(M.main.runtimeLabels)?M.main.runtimeLabels:[],runtimeLines:Array.isArray(M.main.runtimeLines)?M.main.runtimeLines:[],runtimeBoxes:Array.isArray(M.main.runtimeBoxes)?M.main.runtimeBoxes:[],runtimeTables:Array.isArray(M.main.runtimeTables)?M.main.runtimeTables:[],runtimeHeatmaps:Array.isArray(M.main.runtimeHeatmaps)?M.main.runtimeHeatmaps:[],overlays:Array.isArray(M.main.overlays)?M.main.overlays:Array.isArray(M.overlays)?M.overlays:[],fills:Array.isArray(M.main.fills)?M.main.fills:[],backgroundZones:Array.isArray(M.main.backgroundZones)?M.main.backgroundZones:[],min:M.main.min,max:M.main.max,shortName:M.main.shortName||M.shortName,height:M.main.height}),M.sub&&js.push({pane:"sub",plots:Array.isArray(M.sub.plots)?M.sub.plots:[],levels:Array.isArray(M.sub.levels)?M.sub.levels:[],labels:Array.isArray(M.sub.labels)?M.sub.labels:[],lines:Array.isArray(M.sub.lines)?M.sub.lines:[],runtimeDrawOps:Array.isArray(M.sub.runtimeDrawOps)?M.sub.runtimeDrawOps:[],runtimeLabels:Array.isArray(M.sub.runtimeLabels)?M.sub.runtimeLabels:[],runtimeLines:Array.isArray(M.sub.runtimeLines)?M.sub.runtimeLines:[],runtimeBoxes:Array.isArray(M.sub.runtimeBoxes)?M.sub.runtimeBoxes:[],runtimeTables:Array.isArray(M.sub.runtimeTables)?M.sub.runtimeTables:[],runtimeHeatmaps:Array.isArray(M.sub.runtimeHeatmaps)?M.sub.runtimeHeatmaps:[],overlays:Array.isArray(M.sub.overlays)?M.sub.overlays:[],fills:Array.isArray(M.sub.fills)?M.sub.fills:[],backgroundZones:Array.isArray(M.sub.backgroundZones)?M.sub.backgroundZones:[],min:M.sub.min,max:M.sub.max,shortName:M.sub.shortName||M.shortName,height:M.sub.height});else{const En=M.pane==="sub"?"sub":M.pane==="main"?"main":i(zi);js.push({pane:En,plots:Array.isArray(M.plots)?M.plots:[],levels:Array.isArray(M.levels)?M.levels:[],labels:Array.isArray(M.labels)?M.labels:[],lines:Array.isArray(M.lines)?M.lines:[],runtimeDrawOps:Array.isArray(M.runtimeDrawOps)?M.runtimeDrawOps:[],runtimeLabels:Array.isArray(M.runtimeLabels)?M.runtimeLabels:[],runtimeLines:Array.isArray(M.runtimeLines)?M.runtimeLines:[],runtimeBoxes:Array.isArray(M.runtimeBoxes)?M.runtimeBoxes:[],runtimeTables:Array.isArray(M.runtimeTables)?M.runtimeTables:[],runtimeHeatmaps:Array.isArray(M.runtimeHeatmaps)?M.runtimeHeatmaps:[],overlays:Array.isArray(M.overlays)?M.overlays:[],fills:Array.isArray(M.fills)?M.fills:[],backgroundZones:Array.isArray(M.backgroundZones)?M.backgroundZones:[],min:M.min,max:M.max,shortName:M.shortName,height:M.height}),b(zi,H(En))}if(js.some($t=>Array.isArray($t.runtimeHeatmaps)&&$t.runtimeHeatmaps.length)){re=!0;try{ba()}catch{}}if(!js.length)throw new Error("No panes defined in script.");const zs=(()=>{const $t=js.findIndex(En=>En.pane==="main");return $t>=0?$t:0})(),mn=js.some($t=>$t.plots&&$t.plots.length||$t.overlays&&$t.overlays.length||$t.labels&&$t.labels.length||$t.levels&&$t.levels.length||$t.lines&&$t.lines.length||$t.runtimeDrawOps&&$t.runtimeDrawOps.length||$t.runtimeLabels&&$t.runtimeLabels.length||$t.runtimeLines&&$t.runtimeLines.length||$t.runtimeBoxes&&$t.runtimeBoxes.length||$t.runtimeTables&&$t.runtimeTables.length||$t.runtimeHeatmaps&&$t.runtimeHeatmaps.length),un=!!(M!=null&&M.strategy)||qt.length>0;if(!mn&&!un)throw new Error("No plots or labels defined in script.");!mn&&un&&(js[0]||js.push({pane:"main",plots:[],levels:[],labels:[],lines:[],overlays:[]}),js[0].plots=Array.isArray(js[0].plots)?js[0].plots:[],js[0].plots.push({name:"__hidden__",source:"close",type:"line",color:"rgba(0,0,0,0)",width:1e-4,style:"solid",layer:"background"})),ac(fe);try{fe.removeOverlay({groupId:"runtime"})}catch{}const jn=`${Rl}_${Date.now()}`;let ro=0,ys=!1;const qs={maxCalls:16,maxSymbols:8,maxTimeframes:8,maxBars:5e3},Js=new Map,is=new Map,ts=$t=>{const En=String($t||"").trim(),Mo=En.lastIndexOf("@");if(Mo>0&&Mo<En.length-1){const No=En.slice(0,Mo).trim(),ka=En.slice(Mo+1).trim();if(No&&ka)return{ticker:No,country:ka}}return{ticker:En}},Ss=$t=>String($t||"").trim().toLowerCase().replace(/\s+/g,""),ln=Array.isArray((Mp=n())==null?void 0:Mp.allSymbols)?n().allSymbols:[],on=new Map,yo=new Map,pr=new Map;for(const $t of ln){const En=Ss(String(($t==null?void 0:$t.ticker)||""));En&&on.set(En,$t);const Mo=Ss(String(($t==null?void 0:$t.shortName)||""));Mo&&!yo.has(Mo)&&yo.set(Mo,$t);const No=Ss(String(($t==null?void 0:$t.name)||""));No&&!pr.has(No)&&pr.set(No,$t)}const dn=($t,En)=>{let Mo=String($t??"").trim();if(!Mo)return"__CURRENT__";try{Mo=Mo.replace(/\$\{([^}]+)\}/g,(eo,Ra)=>{var Vl;const Xa=(En==null?void 0:En[Ra])??(En==null?void 0:En[(Vl=Ra==null?void 0:Ra.toLowerCase)==null?void 0:Vl.call(Ra)]);return Xa==null?eo:String(Xa)})}catch{}const No=Mo.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(No)){const eo=(En==null?void 0:En[No])??(En==null?void 0:En[No.toLowerCase()]);typeof eo=="string"&&eo.trim()&&(Mo=eo.trim())}const ka=String(Mo).trim(),Xc=ka.toLowerCase();return Xc==="syminfo.tickerid"||Xc==="syminfo.ticker"||Xc==="syminfo.root"||Xc==="__current__"||Xc==="__current_symbol__"?"__CURRENT__":ka},Fo=du(),Dn=$t=>({...$t,sessionMode:Fo.sessionMode,adjustMode:Fo.adjustMode}),Yo=$t=>{const En=String(Fo.sessionMode||"regular").toLowerCase(),Mo=String(($t==null?void 0:$t.session)||""),No=String(($t==null?void 0:$t.sessionExtended)||"");return En==="all"?"24x7":En==="extended"&&No||Mo},Fi=($t,En,Mo)=>{const No=dn($t,Mo);if(No==="__CURRENT__")return Dn(Pn);const ka=ts(No),Xc=String(ka.ticker||"").trim(),eo=Ss(Xc),Ra=eo&&on.get(eo)||eo&&yo.get(eo)||eo&&pr.get(eo)||null,Xa=String(En||ka.country||(Ra==null?void 0:Ra.country)||Pn.country||"BD").trim()||"BD";return Ra&&String(Ra.ticker||"").trim()?Dn({...Ra,country:Xa}):Dn({...Pn,ticker:Xc,country:Xa})},fo=M!=null&&M.params&&typeof M.params=="object"?M.params:{},Pn=((Up=n())==null?void 0:Up.symbol)||{ticker:"UNKNOWN"},ii=((Yh=fe.getDataList)==null?void 0:Yh.call(fe))||[],Dr=typeof((_p=ii==null?void 0:ii[0])==null?void 0:_p.timestamp)=="number"?ii[0].timestamp:typeof((xm=ii==null?void 0:ii[0])==null?void 0:xm.time)=="number"?ii[0].time:0,ni=typeof((pv=ii==null?void 0:ii[ii.length-1])==null?void 0:pv.timestamp)=="number"?ii[ii.length-1].timestamp:typeof((Sh=ii==null?void 0:ii[ii.length-1])==null?void 0:Sh.time)=="number"?ii[ii.length-1].time:0,Xo=$t=>{const En=typeof $t=="number"?$t:Number($t);return!Number.isFinite(En)||En<=0?0:En<1e12?En*1e3:En},sr=Xo(Dr),Sl=Xo(ni),Ru=$t=>{const En=String($t??"").trim();if(!En)return"__CURRENT__";const Mo=En.toUpperCase();if(Mo==="CURRENT"||Mo==="__CURRENT__"||Mo==="TIMEFRAME.PERIOD")return"__CURRENT__";if(Mo==="D"||Mo==="1D")return"1d";if(Mo==="W"||Mo==="1W")return"1w";if(Mo==="M"||Mo==="1M")return"1M";if(/^\d+$/.test(En))return`${En}m`;const No=Mo.match(/^(\d+)\s*H$/);return No?`${No[1]}h`:En},rl=$t=>{const En=String($t||"").trim();if(!En)return 0;if(/^\d+$/.test(En))return fp(`${En}m`);if(En==="M"||En==="1M")return fp("1M");const Mo=En.toUpperCase();if(Mo==="D"||Mo==="1D")return fp("1d");if(Mo==="W"||Mo==="1W")return fp("1w");const No=En.match(/^(\d+)\s*([A-Za-z]+)$/);if(No){const ka=No[1]||"1",Xc=No[2]||"";if(Xc==="M")return fp(`${ka}M`);const eo=Xc.toLowerCase();return eo.startsWith("min")?fp(`${ka}m`):eo==="h"||eo.startsWith("hr")||eo.startsWith("hour")?fp(`${ka}h`):eo==="d"||eo.startsWith("day")?fp(`${ka}d`):eo==="w"||eo.startsWith("wk")||eo.startsWith("week")?fp(`${ka}w`):fp(`${ka}${eo}`)}try{return fp(En)}catch{return 0}},Vi=rl(((hv=(Mv=n())==null?void 0:Mv.period)==null?void 0:hv.timeframe)||""),Xl=Vi>0?Vi*1e3:0,Hc=Sl>0&&Xl>0?Sl+Xl-1:Sl;if(ae){(!M.params||typeof M.params!="object")&&(M.params={});const $t=ii.length>=1?ii[ii.length-1]:null,En=ii.length>=2?ii[ii.length-2]:null,Mo=Xo(($t==null?void 0:$t.timestamp)??($t==null?void 0:$t.time)),No=Xo((En==null?void 0:En.timestamp)??(En==null?void 0:En.time)),Xc=(Number.isFinite(Mo)&&Number.isFinite(No)&&Mo>No?Mo-No:0)||Xl||0,eo=Number.isFinite(Mo)&&Mo>0&&Xc>0?Mo+Xc:Date.now();M.params.__barDurationMs=Xc,M.params.__nowMs=eo}const Da=$t=>{const En=String($t||"").trim();if(!En)return"__CURRENT__";const Mo=En.toLowerCase();if(Mo.endsWith("m")){const No=Number(Mo.slice(0,-1));if(Number.isFinite(No)&&No>0)return String(Math.floor(No))}if(Mo.endsWith("h")){const No=Number(Mo.slice(0,-1));if(Number.isFinite(No)&&No>0)return String(Math.floor(No*60))}return Mo.endsWith("d")?"D":Mo.endsWith("w")?"W":En==="1M"||En==="M"?"M":(/^\d+$/.test(En),En)},gf=$t=>{let En=String($t??"__CURRENT__");try{En=En.replace(/\$\{([^}]+)\}/g,(No,ka)=>{var eo;const Xc=(fo==null?void 0:fo[ka])??(fo==null?void 0:fo[(eo=ka==null?void 0:ka.toLowerCase)==null?void 0:eo.call(ka)]);return Xc==null?No:String(Xc)});const Mo=En.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Mo)){const No=(fo==null?void 0:fo[Mo])??(fo==null?void 0:fo[Mo.toLowerCase()]);No!=null&&(En=String(No))}}catch{}return En},ju=new Map;let Ka=[];try{const $t=(Jt||[]).filter(En=>String((En==null?void 0:En.type)||"").toLowerCase()==="security");if($t.length&&(Pn!=null&&Pn.ticker)){if(Nl.size)for(const No of Nl){const[ka]=String(No).split("@");if(ka&&ka!==Pn.ticker)try{C.stopSymbolPipelines(ka)}catch{}}const En=new Set,Mo=new Map;for(const No of $t){const ka=String((No==null?void 0:No.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!ka)continue;const Xc=!!(No!=null&&No.lower),eo=Fi(No==null?void 0:No.symbol,No==null?void 0:No.country,fo),Ra=String((eo==null?void 0:eo.ticker)||"").trim(),Xa=String((eo==null?void 0:eo.country)||"BD");if(!Ra)continue;En.add(`${Ra}@${Xa}`);const Vl=gf((No==null?void 0:No.timeframe)||(No==null?void 0:No.tf)||"__CURRENT__"),Qf=Vl==="__CURRENT__"?((Km=(rm=n())==null?void 0:rm.period)==null?void 0:Km.timeframe)||"1m":Ru(Vl),Bp=Vl==="__CURRENT__"?Da(((Xm=(Gv=n())==null?void 0:Gv.period)==null?void 0:Xm.timeframe)||"1m"):String(Vl||"__CURRENT__");ju.set(ka,{ticker:Ra,country:Xa,pipelineTf:Qf,computeTf:Bp,lower:Xc});const Gp=`${Ra}@${Xa}|${Qf}`;Qf&&Qf!=="__CURRENT__"&&Mo.set(Gp,{sym:eo,tf:Qf})}if(Ka=Array.from(Mo.values()),Nl=En,Mo.size&&sr>0&&Hc>0)await Promise.all(Array.from(Mo.values()).map(({sym:No,tf:ka})=>C.ensureHistoryCovers(No,ka,sr,Hc,3e3).catch(()=>null)));else if(Mo.size)for(const{sym:No,tf:ka}of Mo.values())try{C.startBackgroundPrefetch(No,{timeframe:ka})}catch{}}}catch($t){console.warn("[ScriptStudio] request.security prefetch skipped",$t)}try{De&&(clearInterval(De),De=null)}catch{}if(Ka.length){const $t=Date.now(),En=25e3;De=setInterval(()=>{var ka;const Mo=o();if(!Mo)return;if(Date.now()-$t>En){try{clearInterval(De)}catch{}De=null;return}let No=0;for(const{sym:Xc,tf:eo}of Ka){const Ra=C.getHistorySnapshot(Xc,eo);if(Ra!=null&&Ra.error)continue;const Xa=(((ka=Ra==null?void 0:Ra.candles)==null?void 0:ka.length)||0)>=2,Vl=sr>0&&Hc>0&&((Ra==null?void 0:Ra.oldestTimestampLoaded)??1/0)<=sr&&((Ra==null?void 0:Ra.newestTimestampLoaded)??0)>=Hc;!(Ra!=null&&Ra.isComplete)&&(!Xa||!Vl)&&(No+=1)}if(No<=0){try{clearInterval(De)}catch{}De=null;return}Ui.requestKey("security:refresh",()=>{try{Mo.resize()}catch{}try{ed()}catch{}})},350)}const Gu=($t,En)=>{var Ug,Kv,gg,Xv,_g,Zv,yg,bg;const Mo=new Set,No=[],ka={min:"__rt_autoscale_min",max:"__rt_autoscale_max"},Xc=$t.plots||[],eo=M!=null&&M.params&&typeof M.params=="object"?M.params:{},Ra=J=>{if(J!=null){if(typeof J!="string")return String(J);try{const ms=J.replace(/\$\{([^}]+)\}/g,(xi,ko)=>{var Ac;const cf=(eo==null?void 0:eo[ko])??(eo==null?void 0:eo[(Ac=ko==null?void 0:ko.toLowerCase)==null?void 0:Ac.call(ko)]);return cf==null?xi:String(cf)});if(ms!==J)return ms;const Ci=J.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Ci)){const xi=(eo==null?void 0:eo[Ci])??(eo==null?void 0:eo[Ci.toLowerCase()]);if(xi!=null)return String(xi)}return ms}catch{return J}}},Xa=J=>{if(J==null)return;if(typeof J=="number"&&Number.isFinite(J))return J;const ms=Ra(J);if(!ms)return;const Ci=Number(ms);return Number.isFinite(Ci)?Ci:void 0},Vl=Xc.filter(J=>{const ms=String((J==null?void 0:J.display)||"").toLowerCase();return ms?!ms.includes("none")&&ms!=="display.none":!0}).map(J=>{const ms=Ra(J==null?void 0:J.color),Ci=Xa(J==null?void 0:J.offset),xi=Xa((J==null?void 0:J.showLast)??(J==null?void 0:J.show_last)),ko=Xa(J==null?void 0:J.precision);return{...J,color:ms??(J==null?void 0:J.color),offset:Ci,showLast:xi,precision:ko}}),Qf=$t.runtimeDrawOps||[],Bp=$t.runtimeLabels||[],Gp=$t.runtimeLines||[],ao=$t.runtimeBoxes||[],Ri=$t.runtimeTables||[],bc=$t.runtimeHeatmaps||[],Mu=J=>{const ms=(Ci,xi)=>{Ci.length=0,Array.isArray(xi)&&Ci.push(...xi)};ms(Qf,J==null?void 0:J.runtimeDrawOps),ms(Bp,J==null?void 0:J.runtimeLabels),ms(Gp,J==null?void 0:J.runtimeLines),ms(ao,J==null?void 0:J.runtimeBoxes),ms(Ri,J==null?void 0:J.runtimeTables),ms(bc,J==null?void 0:J.runtimeHeatmaps)},Sf=Vl.some(J=>String((J==null?void 0:J.type)||"").toLowerCase()==="histogram"),dp=Sf,Op=typeof $t.min=="number"||typeof $t.max=="number",gd=$t.pane==="sub"&&!dp&&!Op;$t.pane==="sub"&&Sf&&Vl.push({name:"__zero__",source:"__zero__",type:"line",color:"rgba(0,0,0,0)",width:0});const Zc=[...$t.levels||[],...$t._trackLevels||[]],Cf=$t.labels||[],ep=$t.lines||[],zp={},Np=Vl.map(J=>{const ms=wp(J.name||J.source||"plot",Mo);No.push(ms);const Ci=(J.source||J.name||"").replace(/\s+/g,"_").toLowerCase();Ci&&(zp[Ci]=ms);const xi=(J.type||J.style||"").toLowerCase();return xi==="histogram"?{key:ms,title:J.name||ms,type:"bar",baseValue:0}:xi==="bar"?{key:ms,title:J.name||ms,type:"bar",baseValue:0}:{key:ms,title:J.name||ms,type:"line"}});Np.push({key:ka.min,type:"line"},{key:ka.max,type:"line"});const np=Vl.map((J,ms)=>{var ko;const Ci=String((J==null?void 0:J.type)||"").toLowerCase();return Ci!=="candles"&&Ci!=="ohlc"?null:{key:No[ms]||((ko=Np[ms])==null?void 0:ko.key)||`plot_${ms}`,openKey:String((J==null?void 0:J.open)||"open").replace(/\s+/g,"_").toLowerCase(),highKey:String((J==null?void 0:J.high)||"high").replace(/\s+/g,"_").toLowerCase(),lowKey:String((J==null?void 0:J.low)||"low").replace(/\s+/g,"_").toLowerCase(),closeKey:String((J==null?void 0:J.close)||"close").replace(/\s+/g,"_").toLowerCase(),offset:Number.isFinite(J==null?void 0:J.offset)?Math.trunc(J.offset):0,showLast:Number.isFinite(J==null?void 0:J.showLast)?Math.max(0,Math.floor(J.showLast)):0}}).filter(Boolean),$h=`${jn}_${$t.pane}_${En}`,Ef=`${jn}__strategy`,Cd=(M==null?void 0:M.drawConfig)||{},$f={limits:{...Ld.limits,...Cd.limits||{}},pruningPolicy:Cd.pruningPolicy==="lru"||Cd.pruningPolicy==="byGroup"?Cd.pruningPolicy:Ld.pruningPolicy,futureBars:Number.isFinite(Cd.futureBars)?Math.max(0,Math.floor(Cd.futureBars)):Ld.futureBars,time:{mode:((Ug=Cd==null?void 0:Cd.time)==null?void 0:Ug.mode)==="prev"||((Kv=Cd==null?void 0:Cd.time)==null?void 0:Kv.mode)==="next"?Cd.time.mode:Ld.time.mode,toleranceBars:Number.isFinite((gg=Cd==null?void 0:Cd.time)==null?void 0:gg.toleranceBars)?Math.max(0,Math.floor(Cd.time.toleranceBars)):Ld.time.toleranceBars,toleranceMs:Number.isFinite((Xv=Cd==null?void 0:Cd.time)==null?void 0:Xv.toleranceMs)?Math.max(0,Math.floor(Cd.time.toleranceMs)):Ld.time.toleranceMs},decimationPx:Number.isFinite(Cd.decimationPx)?Math.max(1,Math.floor(Cd.decimationPx)):Ld.decimationPx},uh={};let wm="",Nv=!1,Zm=-1;const Av=En===zs;let hg=!1,mg="",jm=null,Yv="",Ch=null;const Jm=2e4,Vg=J=>new Promise((ms,Ci)=>{const xi=new Worker(new URL(""+new URL("../workers/runtime.worker-B3x7EOJS.js",import.meta.url).href,import.meta.url),{type:"module"}),ko=setTimeout(()=>{try{xi.terminate()}catch{}Ci(new Error("Runtime worker timed out"))},Jm);xi.onerror=()=>{try{clearTimeout(ko)}catch{}try{xi.terminate()}catch{}Ci(new Error("Runtime worker error"))},xi.onmessage=cf=>{const Ac=cf.data;if(!(!Ac||Ac.id!==J.id)){try{clearTimeout(ko)}catch{}try{xi.terminate()}catch{}if(Ac.error){Ci(new Error(String(Ac.error)));return}ms({seriesMap:Ac.seriesMap||{},lastPrevSource:Ac.lastPrevSource||void 0,diagnostics:Array.isArray(Ac.diagnostics)?Ac.diagnostics:void 0})}},xi.postMessage(J)}),Wg=Vl.map((J,ms)=>{var cf;const Ci=(J.source||J.name||"").replace(/\s+/g,"_").toLowerCase();let xi="#22d3ee";/ema\d+/i.test(Ci)?xi=(cf=/ema(\d+)/i.exec(Ci))!=null&&cf[1]&&Number(RegExp.$1)<=20?"#22c55e":"#ef4444":/signal|sig/i.test(Ci)?xi="#f59e0b":/hist|bar/i.test(J.type||J.style||"")&&(xi="#64748b");const ko=(J.type||J.style||"").toLowerCase();return ko==="histogram"?{color:"rgba(0,0,0,0)",size:1e-4,style:mt.Solid}:ko==="dots"||ko==="cross"?{color:"rgba(0,0,0,0)",size:1e-4,style:mt.Solid}:ko==="candles"||ko==="ohlc"?{color:"rgba(0,0,0,0)",size:1e-4,style:mt.Solid}:{color:J.color||xi,size:J.width??2,gradient:J==null?void 0:J.gradient,style:Td[(J.style||"solid").toLowerCase()]??mt.Solid}});Wg.push({color:"rgba(0,0,0,0)",size:0,style:mt.Solid},{color:"rgba(0,0,0,0)",size:0,style:mt.Solid});const vg=Vl.filter(J=>{const ms=(J.type||J.style||"").toLowerCase();return ms==="histogram"||ms==="bar"}).map(J=>{const ms=J.color||"#64748b",Ci=J.downColor||ms;return{style:"fill",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],upColor:ms,downColor:Ci,noChangeColor:ms,gradient:J==null?void 0:J.gradient}}),Tv={name:$h,shortName:$t.shortName||"Script",precision:4,calcParams:[],figures:Np,shouldOhlc:!1,zLevel:$l,minValue:(()=>{const J=$t.pane==="sub",ms=Vl.some(Ci=>String((Ci==null?void 0:Ci.type)||"").toLowerCase()==="histogram");if(typeof $t.min=="number")return $t.min;if(J&&ms)return-5})(),maxValue:(()=>{const J=$t.pane==="sub",ms=Vl.some(Ci=>String((Ci==null?void 0:Ci.type)||"").toLowerCase()==="histogram");if(typeof $t.max=="number")return $t.max;if(J&&ms)return 5})(),styles:{lines:Wg,...vg.length?{bars:vg}:{}},calc:async J=>{var uf,Ku,pu,kc,Xu,Nd,Wr,Au,Tp,yp,Kp,bp,fh,oc,_f,Bm,df,op,ph,Ih,am,vv,Wf,qd,lm,Fv,Ud,od,xg,Jv,Om,Lv,Ev,Fp,z0,Gg,Yg,v0,Kg,g0,wg,gv,V0,W0,_0,v_,H0,Xg,y0,g_,b0,x0,q0,w0;const ms=J.length,Ci=ms?J[ms-1]:null,xi=(Ci==null?void 0:Ci.timestamp)??(Ci==null?void 0:Ci.time)??(Ci==null?void 0:Ci.t)??0,ko=typeof xi=="number"?xi:Number(xi),cf=ms?J[0]:null,Ac=(cf==null?void 0:cf.timestamp)??(cf==null?void 0:cf.time)??(cf==null?void 0:cf.t)??0,Bu=typeof Ac=="number"?Ac:Number(Ac);let dh=0,Vp=0,mv=0,Qm=0;if(Ka.length)for(const{sym:rt,tf:Ae}of Ka){const _t=C.getHistorySnapshot(rt,Ae),bt=Number((_t==null?void 0:_t.lastUpdatedAt)??0);Number.isFinite(bt)&&(dh=Math.max(dh,bt));const Tt=((uf=_t==null?void 0:_t.candles)==null?void 0:uf.length)??0;Vp+=Number.isFinite(Tt)?Tt:0,_t!=null&&_t.error&&(mv+=1),!(_t!=null&&_t.error)&&!(_t!=null&&_t.isComplete)&&(((Ku=_t==null?void 0:_t.candles)==null?void 0:Ku.length)??0)<2&&(Qm+=1)}const km=`${ms}:${Number.isFinite(Bu)?Bu:0}:${Number.isFinite(ko)?ko:0}:${i(Bo)?1:0}:${dh}:${Vp}:${mv}:${Qm}:${Tn}:${go}:${ro}`;if(km===mg&&jm)return jm;const Yp={},rh={},ui={};let _d=!1;const ql=(M==null?void 0:M.params)||{};ki=ql;const zn=(rt,Ae,_t)=>{if(typeof rt=="number"&&Number.isFinite(rt))return rt;if(typeof rt=="string"){const bt=Number(rt);if(Number.isFinite(bt))return bt;const Tt=rt.match(/^\$\{([^}]+)\}$/),It=Tt?Tt[1]:rt,Yt=ql[It],fn=typeof Yt=="number"?Yt:Number(Yt);if(Number.isFinite(fn))return fn}if(Ae&&ql[Ae]!=null){const bt=ql[Ae],Tt=typeof bt=="number"?bt:Number(bt);if(Number.isFinite(Tt))return Tt}return _t??0},qn=rt=>{if(typeof rt=="number")return Number.isFinite(rt)?rt:void 0;if(typeof rt=="string"){const _t=rt.replace(/[^0-9eE+\\-\\.]/g,"");if(!_t||_t==="+"||_t==="-"||_t===".")return;const bt=Number(_t);return Number.isFinite(bt)?bt:void 0}const Ae=Number(rt);return Number.isFinite(Ae)?Ae:void 0},ua=new Array(ms),oa=new Array(ms),So=new Array(ms),dr=new Array(ms),Zl=new Array(ms),Aa=new Array(ms),Za=new Array(ms);for(let rt=0;rt<ms;(rt+=1)-1){const Ae=J[rt],_t=qn((Ae==null?void 0:Ae.close)??(Ae==null?void 0:Ae.c)??(Ae==null?void 0:Ae.price)??(Ae==null?void 0:Ae.value)),bt=qn((Ae==null?void 0:Ae.open)??(Ae==null?void 0:Ae.o))??_t,Tt=qn((Ae==null?void 0:Ae.high)??(Ae==null?void 0:Ae.h))??_t??bt,It=qn((Ae==null?void 0:Ae.low)??(Ae==null?void 0:Ae.l))??_t??bt,Yt=qn((Ae==null?void 0:Ae.volume)??(Ae==null?void 0:Ae.vol))??0,fn=qn((Ae==null?void 0:Ae.timestamp)??(Ae==null?void 0:Ae.time)??(Ae==null?void 0:Ae.t))??0;dr[rt]=_t,ua[rt]=bt,oa[rt]=Tt,So[rt]=It,Zl[rt]=Yt,Aa[rt]=fn,Za[rt]=rt}ui.open=ua,ui.close=dr,ui.high=oa,ui.low=So,ui.volume=Zl,ui.time=Aa,ui.bar_index=Za;let Va=null;const da=M==null?void 0:M.__jsSeriesMap,k=da?Object.values(da):[],N=k.length>0&&k.every(rt=>Array.isArray(rt)&&rt.length===ms);da&&N&&(Va=da);const R=M==null?void 0:M.__jsCode;if(!Va&&R){const rt=`${ms}:${Number.isFinite(Bu)?Bu:0}:${Number.isFinite(ko)?ko:0}:${Tn}`;if(rt===Yv&&Ch)Va=Ch;else try{const Ae=await hi({id:`${$h}_js_${ms}_${Number.isFinite(ko)?ko:0}`,code:R,base:{open:ua,high:oa,low:So,close:dr,volume:Zl,time:Aa},params:ql});if(Ae!=null&&Ae.error)b(fs,H(String(Ae.error||"JS engine failed"))),b(ns,"Validation failed");else if((pu=Ae==null?void 0:Ae.output)!=null&&pu.seriesMap){Va=Ae.output.seriesMap,Ch=Va,Yv=rt,M.__jsSeriesMap=Va;const _t=Array.isArray((kc=Ae==null?void 0:Ae.output)==null?void 0:kc.panes)?Ae.output.panes:[];if(_t.length){const bt=($t==null?void 0:$t.pane)||"main",Tt=_t.find(It=>((It==null?void 0:It.pane)??"main")===bt)||(_t.length===1?_t[0]:null);Tt&&Mu(Tt)}}}catch(Ae){const _t=Ae instanceof Error?Ae.message:"JS engine failed";b(fs,H(_t)),b(ns,"Validation failed")}}if(Va){const rt={};Object.entries(Va).forEach(([Ae,_t])=>{const bt=String(Ae||"").replace(/\s+/g,"_").toLowerCase();!bt||!Array.isArray(_t)||_t.length!==ms||(rt[bt]=_t)}),Va=Object.keys(rt).length?rt:null}const F=rt=>{const Ae=new Array(ms);for(let _t=0;_t<ms;(_t+=1)-1)Ae[_t]=rt;return Ae},z={},q=sl.get(Ef),he=rt=>Array.isArray(rt)&&rt.length===ms?rt:null;z.strategy_position_size=he(q==null?void 0:q.positionSize)??F(0),z.strategy_position_avg_price=he(q==null?void 0:q.positionAvgPrice)??F(NaN),z.strategy_opentrades=he(q==null?void 0:q.openTrades)??F(0),z.strategy_closedtrades=he(q==null?void 0:q.closedTrades)??F(0),z.strategy_openprofit=he(q==null?void 0:q.openProfit)??F(0),z.strategy_closedprofit=he(q==null?void 0:q.closedProfit)??F(0),z.strategy_grossprofit=he(q==null?void 0:q.grossProfit)??F(0),z.strategy_grossloss=he(q==null?void 0:q.grossLoss)??F(0),z.strategy_wintrades=he(q==null?void 0:q.winTrades)??F(0),z.strategy_losstrades=he(q==null?void 0:q.lossTrades)??F(0),z.strategy_winrate=he(q==null?void 0:q.winRate)??F(0),z.strategy_max_drawdown=he(q==null?void 0:q.maxDrawdownPct)??F(0),z.strategy_max_drawdown_value=he(q==null?void 0:q.maxDrawdownValue)??F(0),z.strategy_max_runup=he(q==null?void 0:q.maxRunupPct)??F(0),z.strategy_max_runup_value=he(q==null?void 0:q.maxRunupValue)??F(0),z.strategy_avg_trade=he(q==null?void 0:q.avgTrade)??F(0),z.strategy_avg_win=he(q==null?void 0:q.avgWin)??F(0),z.strategy_avg_loss=he(q==null?void 0:q.avgLoss)??F(0),z.strategy_avg_bars_in_trade=he(q==null?void 0:q.avgBarsInTrade)??F(0),z.strategy_equity=he(q==null?void 0:q.equity)??F(0),z.strategy_netprofit=he(q==null?void 0:q.netProfit)??F(0);const Ee=q==null?void 0:q.initialCapital;z.strategy_initial_capital=F(typeof Ee=="number"&&Number.isFinite(Ee)?Ee:0);const lt=String(((Nd=(Xu=n())==null?void 0:Xu.period)==null?void 0:Nd.timeframe)||"1m").trim(),Qt=lt.match(/^(\d+)\s*([a-zA-Z])$/);let en=0,Zs="";Qt?(en=Number(Qt[1]),Zs=Qt[2]||""):/^\d+$/.test(lt)&&(en=Number(lt),Zs="m");const xs=Zs==="M"?"M":Zs.toLowerCase();let Un=0;if(en>0&&xs)try{Un=fp(`${en}${xs}`)}catch{}const jo=xs==="s",Lc=xs==="m",Id=xs==="h",sf=xs==="d",au=xs==="w",Wd=xs==="M",ud=xs==="y",Hd=jo||Lc||Id;let dd="";en>0&&xs&&(xs==="m"?dd=String(en):xs==="h"?dd=String(en*60):xs==="s"?dd=`${en}S`:xs==="d"?dd=en===1?"D":`${en}D`:xs==="w"?dd=en===1?"W":`${en}W`:xs==="M"?dd=en===1?"M":`${en}M`:xs==="y"&&(dd=en===1?"Y":`${en}Y`)),z.timeframe_multiplier=F(en||0),z.timeframe_seconds=F(Un||0),z.timeframe_isseconds=F(jo?1:0),z.timeframe_isminutes=F(Lc?1:0),z.timeframe_ishours=F(Id?1:0),z.timeframe_isdaily=F(sf?1:0),z.timeframe_isweekly=F(au?1:0),z.timeframe_ismonthly=F(Wd?1:0),z.timeframe_isyearly=F(ud?1:0),z.timeframe_isintraday=F(Hd?1:0),z.timeframe_period=F(Wc(dd));const Rd=Pn==null?void 0:Pn.pricePrecision,Ou=typeof Rd=="number"?Rd:Number(Rd),Pd=Number.isFinite(Ou)?Math.max(0,Math.floor(Ou)):2,Rr=(Pn==null?void 0:Pn.tickSize)??(Pn==null?void 0:Pn.minTick)??(Pn==null?void 0:Pn.priceStep),Ul=typeof Rr=="number"?Rr:Number(Rr),Wa=Number.isFinite(Ul)&&Ul>0?Ul:1/Math.pow(10,Pd);z.syminfo_mintick=F(Wa),z.syminfo_tick_size=F(Wa);const Wo=Pn==null?void 0:Pn.lotSize,ji=typeof Wo=="number"?Wo:Number(Wo);z.syminfo_lot_size=F(Number.isFinite(ji)?ji:1);const Jl=Pn==null?void 0:Pn.contractSize,zr=typeof Jl=="number"?Jl:Number(Jl);z.syminfo_pointvalue=F(Number.isFinite(zr)?zr:1);const dc=String((Pn==null?void 0:Pn.ticker)||""),Jc=String((Pn==null?void 0:Pn.country)||""),Vr=Jc?`${dc}@${Jc}`:dc,ml=dc.split(/[:.]/).pop()||dc,Bc=String((Pn==null?void 0:Pn.exchange)||(Pn==null?void 0:Pn.market)||""),Ja=String((Pn==null?void 0:Pn.name)||(Pn==null?void 0:Pn.shortName)||""),xc=String((Pn==null?void 0:Pn.type)||""),lu=String((Pn==null?void 0:Pn.priceCurrency)||""),fa=String((Pn==null?void 0:Pn.timezone)||(Pn==null?void 0:Pn.sessionTimezone)||((Wr=n())==null?void 0:Wr.timezone)||"UTC"),fc=String((Fo==null?void 0:Fo.sessionMode)||"regular").toLowerCase(),cu=String((Pn==null?void 0:Pn.session)||""),Sa=String((Pn==null?void 0:Pn.sessionExtended)||""),vl=fc==="all"?"24x7":fc==="extended"&&Sa||cu;z.syminfo_tickerid=F(Wc(Vr)),z.syminfo_ticker=F(Wc(dc)),z.syminfo_root=F(Wc(ml)),z.syminfo_prefix=F(Wc(Bc)),z.syminfo_exchange=F(Wc(Bc)),z.syminfo_description=F(Wc(Ja)),z.syminfo_type=F(Wc(xc)),z.syminfo_currency=F(Wc(lu)),z.syminfo_timezone=F(Wc(fa)),z.syminfo_session=F(Wc(vl)),z.syminfo_session_extended=F(Wc(Sa)),z.syminfo_isdelayed=F(0);const pc=F(0),ya=F(0),Ur=F(0),Wl=F(ms>0?1:0),pa=F(0),Bi=F(ms>0?1:0),wc=F(ms>0?1:0);if(ms>0){pc[0]=1,ya[ms-1]=1;const rt=Ds=>{const $n=typeof Ds=="number"?Ds:Number(Ds);return!Number.isFinite($n)||$n<=0?0:$n<1e12?$n*1e3:$n},Ae=Date.now(),_t=rt(Aa[ms-1]??0),bt=Un>0?Un*1e3:0,Tt=((Au=n().options)==null?void 0:Au.enableRealtime)===!0||r().playing===!0,It=Math.max(6e4,bt>0?bt*2:6e4),Yt=Tt&&I.active&&I.lastUpdateAt>0&&Ae-I.lastUpdateAt<=It,fn=bt>0&&_t>0?Ae<_t+bt:Yt;if(Yt){fn&&(pa[ms-1]=1,Bi[ms-1]=0),Wl[ms-1]=fn?0:1,wc.fill(0);const Ds=I.lastNewBarIndex>=0?I.lastNewBarIndex:ms-1;Ds>=0&&Ds<ms&&(wc[Ds]=1);const $n=fn?ms-2:ms-1;$n>=0&&(Ur[$n]=1)}else Ur[ms-1]=1}z.barstate_isfirst=pc,z.barstate_islast=ya,z.barstate_islastconfirmedhistory=Ur,z.barstate_isconfirmed=Wl,z.barstate_isrealtime=pa,z.barstate_ishistory=Bi,z.barstate_isnew=wc,Object.entries(z).forEach(([rt,Ae])=>{ui[rt]=Ae});const nr=Vl.some(rt=>String((rt==null?void 0:rt.source)||"").toLowerCase()==="__zero__");let Ca=null;if(nr){Ca=new Array(ms);for(let rt=0;rt<ms;(rt+=1)-1)Ca[rt]=0}const Cl=[];try{const rt=(Jt||[]).filter(Ae=>String((Ae==null?void 0:Ae.type)||"").toLowerCase()==="security");if(rt.length&&ms>0){const Ae=Tt=>{let It=String(Tt??"__CURRENT__");try{It=It.replace(/\$\{([^}]+)\}/g,(fn,Ds)=>{var Rs;const $n=(ql==null?void 0:ql[Ds])??(ql==null?void 0:ql[(Rs=Ds==null?void 0:Ds.toLowerCase)==null?void 0:Rs.call(Ds)]);return $n==null?fn:String($n)});const Yt=It.trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Yt)){const fn=(ql==null?void 0:ql[Yt])??(ql==null?void 0:ql[Yt.toLowerCase()]);fn!=null&&(It=String(fn))}}catch{}return It};if(rt.length>qs.maxCalls)throw new Error("request.security: limit exceeded: too many calls");const _t=new Set,bt=new Set;for(const Tt of rt){const It=Fi(Tt==null?void 0:Tt.symbol,Tt==null?void 0:Tt.country,ql),Yt=String((It==null?void 0:It.ticker)||"").trim(),fn=String((It==null?void 0:It.country)||"").trim(),Ds=fn?`${Yt}@${fn}`:Yt;_t.add(Ds||"__UNKNOWN__");const $n=String(Ae((Tt==null?void 0:Tt.timeframe)||(Tt==null?void 0:Tt.tf)||"__CURRENT__")||"__CURRENT__"),Rs=$n==="__CURRENT__"?Da(((yp=(Tp=n())==null?void 0:Tp.period)==null?void 0:yp.timeframe)||"1m"):$n;bt.add(String(Rs||"__CURRENT__"))}if(_t.size>qs.maxSymbols)throw new Error("request.security: limit exceeded: too many symbols");if(bt.size>qs.maxTimeframes)throw new Error("request.security: limit exceeded: too many timeframes");if(ms>qs.maxBars)throw new Error("request.security: limit exceeded: too many bars");for(const Tt of rt){const It=String((Tt==null?void 0:Tt.name)||"security").replace(/\s+/g,"_").toLowerCase();if(!It)continue;const Yt=Fi(Tt==null?void 0:Tt.symbol,Tt==null?void 0:Tt.country,ql),fn=String(Ae((Tt==null?void 0:Tt.timeframe)||(Tt==null?void 0:Tt.tf)||"__CURRENT__")||"__CURRENT__"),Ds=fn==="__CURRENT__"?((bp=(Kp=n())==null?void 0:Kp.period)==null?void 0:bp.timeframe)||"1m":Ru(fn),$n=ju.get(It),Rs=($n==null?void 0:$n.pipelineTf)||Ds,cn=($n==null?void 0:$n.computeTf)||(fn==="__CURRENT__"?Da(((oc=(fh=n())==null?void 0:fh.period)==null?void 0:oc.timeframe)||"1m"):fn),Vn=!!($n!=null&&$n.lower||Tt!=null&&Tt.lower),_i=String((Yt==null?void 0:Yt.ticker)||"").trim(),Gr=String((Yt==null?void 0:Yt.country)||"").trim(),An=rl(cn);if(Vn&&Vi>0&&An>0&&An>=Vi){if(!i(fs)){const _l=String(((Bm=(_f=n())==null?void 0:_f.period)==null?void 0:Bm.timeframe)||"");b(fs,`request.security_lower_tf: "${cn}" must be lower than chart timeframe "${_l}"`)}ui[It]=new Array(ms),Cl.push(It);continue}const ra=Rs&&Rs!=="__CURRENT__"?`${_i}${Gr?`@${Gr}`:""}|${Rs}`:"",rr=Rs&&Rs!=="__CURRENT__"?is.has(ra)?is.get(ra):(()=>{const _l=C.getHistorySnapshot(Yt,Rs);return is.set(ra,_l),_l})():null,Hr=rr?rr.candles:null,ci=Number(Aa[0]??0),On=Number(Aa[ms-1]??0);if(Rs&&Rs!=="__CURRENT__"){const _l=Xp=>{const Hf=typeof Xp=="number"?Xp:Number(Xp);return!Number.isFinite(Hf)||Hf<=0?0:Hf<1e12?Hf*1e3:Hf},Oc=_l(ci),Df=_l(On),ah=Hr&&Hr.length>=2,hh=Hr&&Hr.length?Number(((df=Hr[0])==null?void 0:df.timestamp)??((op=Hr[0])==null?void 0:op.time)??((ph=Hr[0])==null?void 0:ph.t)??0):0,kg=Hr&&Hr.length?Number(((Ih=Hr[Hr.length-1])==null?void 0:Ih.timestamp)??((am=Hr[Hr.length-1])==null?void 0:am.time)??((vv=Hr[Hr.length-1])==null?void 0:vv.t)??0):0,_v=_l((rr==null?void 0:rr.oldestTimestampLoaded)??hh),Ph=_l((rr==null?void 0:rr.newestTimestampLoaded)??kg),zm=ah&&Oc>0&&Df>0&&_v>0&&Ph>0&&_v<=Df&&Ph>=Oc,Wp=zm&&_v<=Oc&&Ph>=Df;if(!ah||!zm){const Xp=String((Yt==null?void 0:Yt.ticker)||""),Hf=String((Yt==null?void 0:Yt.country)||"");if(rr!=null&&rr.error)i(fs)||b(fs,`request.security: ${Xp}${Hf?`@${Hf}`:""} (${Rs}) error: ${rr.error}`);else if(rr!=null&&rr.isComplete){if(!i(fs)){const Hp=!ah||!(Hr&&Hr.length);if(Vn&&Hp){const Zp=Vi>0?Math.round(Vi/60):0;b(fs,`request.security error: request.security: lower timeframe "${cn}" is not available from current chart data${Zp?` (base ~${Zp}m)`:""}. Switch chart timeframe lower or provide lower-TF datafeed.`)}else b(fs,H(Hp?`request.security: no data for ${Xp}${Hf?`@${Hf}`:""} (${Rs})`:`request.security: no overlap for ${Xp}${Hf?`@${Hf}`:""} (${Rs})`))}}else if(i(ns)==="Running..."||i(ns)==="Plotted from Pine"||i(ns)==="Plotted from DSL"){const Hp=rr!=null&&rr.oldestTimestampLoaded?new Date(rr.oldestTimestampLoaded).toISOString().slice(0,10):"?",Zp=rr!=null&&rr.newestTimestampLoaded?new Date(rr.newestTimestampLoaded).toISOString().slice(0,10):"?";b(ns,`Loading request.security: ${Xp}${Hf?`@${Hf}`:""} (${Rs})… loaded ${Hp}→${Zp}`)}ui[It]=new Array(ms),Cl.push(It);continue}if(!Wp&&!(rr!=null&&rr.error)&&!(rr!=null&&rr.isComplete)&&(i(ns)==="Running..."||i(ns)==="Plotted from Pine"||i(ns)==="Plotted from DSL")){const Xp=String((Yt==null?void 0:Yt.ticker)||""),Hf=String((Yt==null?void 0:Yt.country)||""),Hp=rr!=null&&rr.oldestTimestampLoaded?new Date(rr.oldestTimestampLoaded).toISOString().slice(0,10):"?",Zp=rr!=null&&rr.newestTimestampLoaded?new Date(rr.newestTimestampLoaded).toISOString().slice(0,10):"?";b(ns,`Loading request.security (partial): ${Xp}${Hf?`@${Hf}`:""} (${Rs})… loaded ${Hp}→${Zp}`)}}const Po=String((Tt==null?void 0:Tt.expr)||"close"),Ma=Vo?R_(Po,{pineV2:!0}).expr:String(Po??"").trim(),ic=String((Tt==null?void 0:Tt.lookahead)||"off").toLowerCase(),wu=ic==="on"||ic.includes("on")&&!ic.includes("off")?"on":"off",Tu=String((Tt==null?void 0:Tt.gaps)||"off").toLowerCase(),Fu=Tu==="on"||Tu.includes("on")&&!Tu.includes("off")?"on":"off",Gl=`${ua[ms-1]??""}|${oa[ms-1]??""}|${So[ms-1]??""}|${dr[ms-1]??""}|${Zl[ms-1]??""}`,Lu=Hr&&Hr.length?Number(((Wf=Hr[0])==null?void 0:Wf.timestamp)??((qd=Hr[0])==null?void 0:qd.time)??0):0,Xi=Hr&&Hr.length?Number(((lm=Hr[Hr.length-1])==null?void 0:lm.timestamp)??((Fv=Hr[Hr.length-1])==null?void 0:Fv.time)??0):0,Ql=String((Yt==null?void 0:Yt.timezone)||(Yt==null?void 0:Yt.sessionTimezone)||((Ud=n())==null?void 0:Ud.timezone)||"UTC"),If=Yo(Yt)||Yo(Pn)||"",hu=`sym=${_i}${Gr?`@${Gr}`:""}|tf=${cn}|srcTf=${Rs}|srcLen=${Hr?Hr.length:0}|src0=${Lu}|srcN=${Xi}|la=${wu}|gaps=${Fu}|lower=${Vn?1:0}|expr=${Ma}|len=${ms}|t0=${ci}|tN=${On}|tail=${Gl}|tz=${Ql}|session=${If}`,gl=Js.get(hu),ff=gl&&gl.len===ms&&gl.firstTime===ci&&gl.lastTime===On&&gl.tailSig===Gl?gl.out:(()=>{const _l=C$({timestamps:Aa,open:ua,high:oa,low:So,close:dr,volume:Zl,sourceCandles:Hr||void 0,timeframe:cn,expr:Po,lookahead:wu,gaps:Fu,scalars:ql,userFunctions:M==null?void 0:M.userFunctions,timezone:Ql,session:If,allowLowerTfFallback:!Vn});return Js.set(hu,{out:_l,len:ms,firstTime:ci,lastTime:On,tailSig:Gl}),_l})();try{let _l=!1;const Oc=Math.max(0,ms-250);for(let Df=ms-1;Df>=Oc;(Df-=1)+1){const ah=ff[Df];if(ah!=null&&Number.isFinite(ah)){_l=!0;break}}if(!_l&&!i(fs)){const Df=String((Yt==null?void 0:Yt.ticker)||""),ah=String((Yt==null?void 0:Yt.country)||"");b(ns,`request.security: no overlap for ${Df}${ah?`@${ah}`:""} (${Rs}) — try a more recent chart range or switch chart timeframe`)}}catch{}ui[It]=ff,Cl.push(It)}}}catch(rt){const Ae=(rt==null?void 0:rt.message)!=null?String(rt.message):String(rt);console.error("[ScriptStudio] request.security error",rt),i(fs)||b(fs,`request.security error: ${Ae}`)}const Qa=()=>{if(pn.length&&ms>0)try{const rt={open:new Float32Array(ms),high:new Float32Array(ms),low:new Float32Array(ms),close:new Float32Array(ms),volume:new Float32Array(ms),time:new Float32Array(ms),bar_index:new Float32Array(ms)};for(let bt=0;bt<ms;(bt+=1)-1)rt.open[bt]=ua[bt]??NaN,rt.high[bt]=oa[bt]??NaN,rt.low[bt]=So[bt]??NaN,rt.close[bt]=dr[bt]??NaN,rt.volume[bt]=Zl[bt]??0,rt.time[bt]=Aa[bt]??0,rt.bar_index[bt]=Za[bt]??bt;const Ae=bt=>{if(!rt[bt]){if(bt==="hl2"){const Tt=new Float32Array(ms);for(let It=0;It<ms;(It+=1)-1){const Yt=oa[It],fn=So[It];Tt[It]=Yt==null||fn==null?NaN:(Yt+fn)/2}rt[bt]=Tt}else if(bt==="hlc3"){const Tt=new Float32Array(ms);for(let It=0;It<ms;(It+=1)-1){const Yt=oa[It],fn=So[It],Ds=dr[It];Tt[It]=Yt==null||fn==null||Ds==null?NaN:(Yt+fn+Ds)/3}rt[bt]=Tt}else if(bt==="ohlc4"){const Tt=new Float32Array(ms);for(let It=0;It<ms;(It+=1)-1){const Yt=ua[It],fn=oa[It],Ds=So[It],$n=dr[It];Tt[It]=Yt==null||fn==null||Ds==null||$n==null?NaN:(Yt+fn+Ds+$n)/4}rt[bt]=Tt}}};ql&&typeof ql=="object"&&Object.entries(ql).forEach(([bt,Tt])=>{if(typeof Tt!="string")return;const It=String(bt).replace(/\s+/g,"_").toLowerCase(),Yt=String(Tt).replace(/\s+/g,"_").toLowerCase();Ae(Yt);const fn=rt[Yt];if(fn){rt[It]=fn;const Ds=new Array(ms);for(let $n=0;$n<ms;($n+=1)-1){const Rs=fn[$n];Ds[$n]=Number.isFinite(Rs)?Rs:void 0}ui[It]=Ds}});for(const bt of Cl){const Tt=ui[bt];if(!Tt)continue;const It=new Float32Array(ms);for(let Yt=0;Yt<ms;(Yt+=1)-1)It[Yt]=Tt[Yt]??NaN;rt[bt]=It}Object.entries(z).forEach(([bt,Tt])=>{if(!Tt)return;const It=new Float32Array(ms);for(let Yt=0;Yt<ms;(Yt+=1)-1)It[Yt]=Tt[Yt]??NaN;rt[bt]=It});const _t=l_(pn.map((bt,Tt)=>({name:String(bt.name||`series_${Tt}`),expr:Uu(String(bt.expr||"").replace(/\$\{([^}]+)\}/g,(It,Yt)=>String(ql[Yt]??It)))})),rt,ql,br.get(Ef),He,{loopPlans:M==null?void 0:M.loopPlans,userFunctions:M==null?void 0:M.userFunctions});Object.entries(_t).forEach(([bt,Tt])=>{const It=bt.replace(/\s+/g,"_").toLowerCase(),Yt=new Array(ms);for(let fn=0;fn<ms;(fn+=1)-1)Yt[fn]=Tt[fn];ui[It]=Yt})}catch(rt){const Ae=(rt==null?void 0:rt.message)!=null?String(rt.message):String(rt);console.error("[ScriptStudio] expression engine error",rt),i(fs)||b(fs,`Expression error: ${Ae}`),i(ns)||b(ns,"Expression error")}yX({seriesMap:ui,calcDefs:Jt,len:ms,params:ql,lastPrevSource:uh,resolveNum:zn,onError:(rt,Ae)=>{Ae&&console.error("[ScriptStudio] expr eval error",Ae),i(fs)||b(fs,H(rt)),i(ns)||b(ns,"Expression error")}})};if(ms>0&&($s.length||Jt.length||Kt.length)){const rt={...z};if(Cl.length&&Cl.forEach(_t=>{const bt=ui[_t];bt&&(rt[_t]=bt)}),Ca&&(rt.__zero__=Ca),Va&&Object.entries(Va).forEach(([_t,bt])=>{!Array.isArray(bt)||bt.length!==ms||(rt[_t]=bt)}),(()=>{const _t=/\bstrategy[._](closedtrades|opentrades)[._]/i,bt=Tt=>_t.test(String(Tt??""));return!!($s.some(Tt=>bt(Tt==null?void 0:Tt.expr))||Kt.some(Tt=>bt(Tt==null?void 0:Tt.initExpr)||bt(Tt==null?void 0:Tt.updateExpr)||bt(Tt==null?void 0:Tt.expr))||Jt.some(Tt=>bt(Tt==null?void 0:Tt.expr)||bt(Tt==null?void 0:Tt.when)))})())Qa();else try{const _t=`${$h}_rt_${ms}_${Number.isFinite(ko)?ko:0}`,bt=gd?"calc_only":"full",Tt=await Vg({id:_t,base:{open:ua,high:oa,low:So,close:dr,volume:Zl,time:Aa},calc:Jt,series:$s,stateSeries:Kt,params:ql,extraSeries:rt,stage:bt,autoSortStateSeries:Wt,loopPlans:M==null?void 0:M.loopPlans,userFunctions:M==null?void 0:M.userFunctions});Tt.diagnostics&&We.size>=0&&Tt.diagnostics.forEach(Yt=>{const fn=String(Yt||"").trim();fn&&(We.has(fn)||We.set(fn,Yt))});const It=Tt.seriesMap||{};Object.keys(ui).forEach(Yt=>delete ui[Yt]),Object.entries(It).forEach(([Yt,fn])=>{ui[Yt]=fn}),Tt.lastPrevSource&&Object.assign(uh,Tt.lastPrevSource),_d=bt==="full"}catch(_t){console.warn("[ScriptStudio] runtime worker fallback",_t),Qa()}}else Qa();if(nr){if(!Ca){Ca=new Array(ms);for(let rt=0;rt<ms;(rt+=1)-1)Ca[rt]=0}ui.__zero__=Ca}if($t.pane==="sub"){const rt=new Set,Ae=new Set;Vl.forEach(bt=>{const Tt=(bt.source||bt.name||"").replace(/\s+/g,"_").toLowerCase();Tt&&rt.add(Tt),String(bt.type||"").toLowerCase()==="histogram"&&Tt&&Ae.add(Tt)}),($t.labels||[]).forEach(bt=>{const Tt=((bt==null?void 0:bt.source)||(bt==null?void 0:bt.name)||"").replace(/\s+/g,"_").toLowerCase();Tt&&rt.add(Tt)}),(od=$t.fills)==null||od.forEach(bt=>{(Array.isArray(bt==null?void 0:bt.between)?bt.between:[]).forEach(It=>{const Yt=String(It||"").replace(/\s+/g,"_").toLowerCase();Yt&&rt.add(Yt)})});const _t=(bt,Tt)=>{let It=1/0,Yt=-1/0;for(let Rs=0;Rs<bt.length;(Rs+=1)-1){const cn=bt[Rs];cn==null||Number.isNaN(cn)||(cn<It&&(It=cn),cn>Yt&&(Yt=cn))}const fn=Yt-It;if(!(Yt>200||It<-50||fn>200))return bt;const $n=new Array(bt.length);if(fn>1e-8){for(let Rs=0;Rs<bt.length;(Rs+=1)-1){const cn=bt[Rs];$n[Rs]=cn==null?void 0:(cn-It)/fn*100}return $n}if(Tt){for(let Rs=0;Rs<bt.length;(Rs+=1)-1){const cn=bt[Rs],Vn=Tt[Rs];$n[Rs]=cn==null||Vn===void 0||Vn===null||Vn===0?void 0:cn/Vn*50+50}return $n}return bt};!dp&&!Op&&rt.forEach(bt=>{ui[bt]&&!Ae.has(bt)&&!/hist|macd|signal/i.test(bt)&&(ui[bt]=_t(ui[bt],ui.close))})}if(!_d&&pn.length&&ms>0)try{const rt=new Set(pn.map((bt,Tt)=>String((bt==null?void 0:bt.name)||`series_${Tt}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Ae={};Object.entries(ui).forEach(([bt,Tt])=>{const It=String(bt||"").replace(/\s+/g,"_").toLowerCase();if(rt.has(It))return;const Yt=new Float32Array(ms);for(let fn=0;fn<ms;(fn+=1)-1)Yt[fn]=Tt[fn]??NaN;Ae[It]=Yt});const _t=l_(pn.map((bt,Tt)=>({name:String(bt.name||`series_${Tt}`),expr:Uu(String(bt.expr||"").replace(/\$\{([^}]+)\}/g,(It,Yt)=>String(ql[Yt]??It)))})),Ae,ql,br.get(Ef),He,{loopPlans:M==null?void 0:M.loopPlans,userFunctions:M==null?void 0:M.userFunctions});Object.entries(_t).forEach(([bt,Tt])=>{const It=bt.replace(/\s+/g,"_").toLowerCase(),Yt=new Array(ms);for(let fn=0;fn<ms;(fn+=1)-1)Yt[fn]=Tt[fn];ui[It]=Yt})}catch(rt){const Ae=(rt==null?void 0:rt.message)!=null?String(rt.message):String(rt);console.error("[ScriptStudio] expression engine error (2nd pass)",rt),i(fs)||b(fs,`Expression error: ${Ae}`),i(ns)||b(ns,"Expression error")}const el=Kt.filter(rt=>/^__arr_/i.test(String((rt==null?void 0:rt.name)||""))),Zi=Kt.filter(rt=>!/^__arr_/i.test(String((rt==null?void 0:rt.name)||"")));if(!_d&&el.length&&ms>0)try{const rt={};Object.entries(ui).forEach(([_t,bt])=>{const Tt=String(_t||"").replace(/\s+/g,"_").toLowerCase(),It=new Float32Array(ms);for(let Yt=0;Yt<ms;(Yt+=1)-1)It[Yt]=bt[Yt]??NaN;rt[Tt]=It});const Ae=fk(el.map((_t,bt)=>({name:String((_t==null?void 0:_t.name)||`state_${bt}`),initExpr:(_t==null?void 0:_t.initExpr)!=null?Uu(String(_t.initExpr).replace(/\$\{([^}]+)\}/g,(Tt,It)=>String(ql[It]??Tt))):void 0,updateExpr:Uu(String((_t==null?void 0:_t.updateExpr)??(_t==null?void 0:_t.expr)??"").replace(/\$\{([^}]+)\}/g,(Tt,It)=>String(ql[It]??Tt))),selfMode:_t==null?void 0:_t.selfMode})),rt,ql,br.get(Ef),{autoSort:Wt,diagnostics:He,loopPlans:M==null?void 0:M.loopPlans,userFunctions:M==null?void 0:M.userFunctions});Object.entries(Ae).forEach(([_t,bt])=>{const Tt=_t.replace(/\s+/g,"_").toLowerCase(),It=new Array(ms);for(let Yt=0;Yt<ms;(Yt+=1)-1)It[Yt]=bt[Yt];ui[Tt]=It})}catch(rt){const Ae=(rt==null?void 0:rt.message)!=null?String(rt.message):String(rt);console.error("[ScriptStudio] state series error",rt),i(fs)||b(fs,`Expression error: ${Ae}`),i(ns)||b(ns,"Expression error")}if(!_d&&Nn.length&&ms>0)try{const rt=new Set(Nn.map((bt,Tt)=>String((bt==null?void 0:bt.name)||`series_${Tt}`).replace(/\s+/g,"_").toLowerCase()).filter(Boolean)),Ae={};Object.entries(ui).forEach(([bt,Tt])=>{const It=String(bt||"").replace(/\s+/g,"_").toLowerCase();if(rt.has(It))return;const Yt=new Float32Array(ms);for(let fn=0;fn<ms;(fn+=1)-1)Yt[fn]=Tt[fn]??NaN;Ae[It]=Yt});const _t=l_(Nn.map((bt,Tt)=>({name:String(bt.name||`series_${Tt}`),expr:Uu(String(bt.expr||"").replace(/\$\{([^}]+)\}/g,(It,Yt)=>String(ql[Yt]??It)))})),Ae,ql,br.get(Ef),He,{loopPlans:M==null?void 0:M.loopPlans,userFunctions:M==null?void 0:M.userFunctions});Object.entries(_t).forEach(([bt,Tt])=>{const It=bt.replace(/\s+/g,"_").toLowerCase(),Yt=new Array(ms);for(let fn=0;fn<ms;(fn+=1)-1)Yt[fn]=Tt[fn];ui[It]=Yt})}catch(rt){const Ae=(rt==null?void 0:rt.message)!=null?String(rt.message):String(rt);console.error("[ScriptStudio] expression engine error (array pass)",rt),i(fs)||b(fs,`Expression error: ${Ae}`),i(ns)||b(ns,"Expression error")}if(!_d&&Zi.length&&ms>0)try{const rt={};Object.entries(ui).forEach(([_t,bt])=>{const Tt=String(_t||"").replace(/\s+/g,"_").toLowerCase(),It=new Float32Array(ms);for(let Yt=0;Yt<ms;(Yt+=1)-1)It[Yt]=bt[Yt]??NaN;rt[Tt]=It});const Ae=fk(Zi.map((_t,bt)=>({name:String((_t==null?void 0:_t.name)||`state_${bt}`),initExpr:(_t==null?void 0:_t.initExpr)!=null?Uu(String(_t.initExpr).replace(/\$\{([^}]+)\}/g,(Tt,It)=>String(ql[It]??Tt))):void 0,updateExpr:Uu(String((_t==null?void 0:_t.updateExpr)??(_t==null?void 0:_t.expr)??"").replace(/\$\{([^}]+)\}/g,(Tt,It)=>String(ql[It]??Tt))),selfMode:_t==null?void 0:_t.selfMode})),rt,ql,br.get(Ef),{autoSort:Wt,diagnostics:He,loopPlans:M==null?void 0:M.loopPlans,userFunctions:M==null?void 0:M.userFunctions});Object.entries(Ae).forEach(([_t,bt])=>{const Tt=_t.replace(/\s+/g,"_").toLowerCase(),It=new Array(ms);for(let Yt=0;Yt<ms;(Yt+=1)-1)It[Yt]=bt[Yt];ui[Tt]=It})}catch(rt){const Ae=(rt==null?void 0:rt.message)!=null?String(rt.message):String(rt);console.error("[ScriptStudio] state series error",rt),i(fs)||b(fs,`Expression error: ${Ae}`),i(ns)||b(ns,"Expression error")}Va&&Object.entries(Va).forEach(([rt,Ae])=>{const _t=String(rt||"").replace(/\s+/g,"_").toLowerCase();!Array.isArray(Ae)||Ae.length!==ms||(ui[_t]=Ae)});const Ki={};Np.forEach(rt=>{Ki[rt.key]=new Array(ms)});const Ii=new Array(ms),Zo=[];for(let rt=0;rt<ms;(rt+=1)-1){const Ae={};Vl.forEach((bt,Tt)=>{const It=No[Tt]||Np[Tt].key,Yt=(bt.source||bt.name||"").replace(/\s+/g,"_").toLowerCase(),fn=ui[Yt]||ui[It]||ui.close,Ds=zn(bt==null?void 0:bt.offset,void 0,0),$n=Number.isFinite(Ds)?Math.trunc(Ds):0,Rs=rt-$n,cn=zn((bt==null?void 0:bt.showLast)??(bt==null?void 0:bt.show_last),void 0,NaN),Vn=Number.isFinite(cn)?Math.max(0,Math.floor(cn)):0,Gr=(!Vn||rt>=ms-Vn)&&Rs>=0&&Rs<fn.length?fn[Rs]:void 0;Ae[It]=Gr,Ki[It][rt]=Gr}),Ae.__open=ui.open[rt],Ae.__close=ui.close[rt],Ae.__high=ui.high[rt],Ae.__low=ui.low[rt],np.length&&np.forEach(bt=>{const Tt=ui[bt.openKey]||ui.open,It=ui[bt.highKey]||ui.high,Yt=ui[bt.lowKey]||ui.low,fn=ui[bt.closeKey]||ui.close;if(!Tt||!It||!Yt||!fn)return;const Ds=Number.isFinite(bt.offset)?bt.offset:0,$n=rt-Ds,Rs=Number.isFinite(bt.showLast)?bt.showLast:0,cn=!Rs||rt>=ms-Rs,Vn=_i=>cn&&$n>=0&&$n<_i.length?_i[$n]:void 0;Ae[`${bt.key}__open`]=Vn(Tt),Ae[`${bt.key}__high`]=Vn(It),Ae[`${bt.key}__low`]=Vn(Yt),Ae[`${bt.key}__close`]=Vn(fn)}),Ii[rt]=Ae;const _t=((xg=J[rt])==null?void 0:xg.timestamp)??((Jv=J[rt])==null?void 0:Jv.time)??((Om=J[rt])==null?void 0:Om.t);if(typeof _t=="number"){const bt=String(_t);Yp[bt]=Ae,rh[bt]=rt;const Tt=_t<1e12?Math.floor(_t*1e3):Math.floor(_t);Zo.push(Tt),rh[`${Tt}_ms`]=rt,rh[`${Math.floor(Tt/1e3)}_s`]=rt}}let ha=0;if(Zo.length>=2){let rt=0;for(let Ae=1;Ae<Zo.length;(Ae+=1)-1)rt+=Math.abs(Zo[Ae]-Zo[Ae-1]);ha=rt/(Zo.length-1)}const al=[];Vl.forEach((rt,Ae)=>{if(!(rt!=null&&rt.trackPrice))return;const _t=No[Ae]||Np[Ae].key,bt=Ki[_t];if(!bt||!bt.length)return;let Tt=NaN;for(let It=bt.length-1;It>=0;(It-=1)+1){const Yt=bt[It];if(Yt!=null&&Number.isFinite(Yt)){Tt=Yt;break}}Number.isFinite(Tt)&&al.push({value:Tt,color:rt.color||"#94a3b8",width:1,style:"dashed"})}),$t._trackLevels=al;const Pi={},Ar=rt=>{const Ae=new Float32Array(ms);for(let _t=0;_t<ms;(_t+=1)-1){const bt=rt[_t];Ae[_t]=bt??NaN}return Ae};Object.entries(ui).forEach(([rt,Ae])=>{Pi[rt.replace(/\s+/g,"_").toLowerCase()]=Ar(Ae)}),Object.entries(Ki).forEach(([rt,Ae])=>{Pi[rt]=Ar(Ae)}),Va&&Object.entries(Va).forEach(([rt,Ae])=>{Array.isArray(Ae)&&(Pi[rt]||(Pi[rt]=Ar(Ae)))});try{Object.entries(zp).forEach(([rt,Ae])=>{const _t=String(rt||"").replace(/\s+/g,"_").toLowerCase(),bt=String(Ae||"");!_t||!bt||Pi[_t]||Pi[bt]&&(Pi[_t]=Pi[bt])})}catch{}{const rt=Object.keys(Pi);for(const Ae of rt){if(!Ae.includes("_"))continue;const _t=Ae.replace(/_/g,"");!_t||_t===Ae||Pi[_t]||(Pi[_t]=Pi[Ae])}}const ia=new Map,ma=new Map,jr=new Map,Ha=new Map,ll="condition must be bool or number",li=rt=>{let Ae=String(rt||"").replace(/\$\{([^}]+)\}/g,(bt,Tt)=>String(ql[Tt]??bt));Ae=Ae.replace(/\/\/.*$/,"").replace(/#.*$/,""),Ae=Ae.split(";")[0],Ae=Ae.replace(/[,;]+\s*$/,""),Ae=Ae.replace(/\b(and|or)\b\s*$/i,""),Ae=Ae.replace(/\bcrosses\s+above\b/gi,"crossesAbove"),Ae=Ae.replace(/\bcrosses\s+below\b/gi,"crossesBelow");const _t=Uu(Ae);return Oy(_t)},wr=rt=>{const Ae=li(rt);if(!Ae)return null;const _t=jr.get(Ae);if(_t)return _t;try{const bt=Ep(Ae);return jr.set(Ae,bt),bt}catch{return null}},Qr=rt=>{const Ae=li(rt);if(!Ae)return!1;const _t=Ha.get(Ae);if(_t!=null)return _t;const bt=wr(rt),Tt=bt?dg(bt):!1;return Ha.set(Ae,Tt),Tt},ea=rt=>{const Ae=li(rt);if(!Ae)return null;const _t=ia.get(Ae);if(_t)return _t;try{const bt=ay(Ae,Pi,ql,br.get(Ef),He);return ia.set(Ae,bt),bt}catch(bt){const Tt=(bt==null?void 0:bt.message)!=null?String(bt.message):String(bt);return i(fs)||b(fs,`Expression error: ${Tt}`),i(ns)||b(ns,"Expression error"),null}},ja=rt=>{const Ae=li(rt);if(!Ae)return null;const _t=ma.get(Ae);if(_t)return _t;if(ae&&Qr(rt)){He==null||He.emitOnce(`cond_type:${Ae}`,ll);const Yt=new Uint8Array(ms);return ma.set(Ae,Yt),Yt}const bt=ea(rt);if(!bt)return null;const Tt=new Uint8Array(ms),It=ae?`cond_na:${Ae}`:"";for(let Yt=0;Yt<ms;(Yt+=1)-1){const fn=bt[Yt];Tt[Yt]=ae?Dg(fn,He,It)?1:0:Number.isFinite(fn)&&fn!==0?1:0}return ma.set(Ae,Tt),Tt},Ia=(rt,Ae)=>{const _t=String(rt||"").trim(),bt=String(Ae||"").trim(),Tt=_t||bt;return Tt?ja(Tt):null};if(Av&&!hg&&$s.length){try{const Ae=$s.map(_t=>String((_t==null?void 0:_t.name)||"")).map(_t=>_t.replace(/\s+/g,"_").toLowerCase()).filter(Boolean).filter(_t=>!(_t in ui));if(Ae.length){const _t=`Missing series: ${Ae.slice(0,6).join(", ")}${Ae.length>6?", ...":""}`;b(fs,H(i(fs)?`${i(fs)} • ${_t}`:_t))}}catch{}hg=!0}const Li=[],Tr=new Map,Il=new Map,va=rt=>Uu(String(rt||"").replace(/\$\{([^}]+)\}/g,(Ae,_t)=>String(ql[_t]??Ae))),gr=rt=>tp(String(rt||"").replace(/\$\{([^}]+)\}/g,(Ae,_t)=>String(ql[_t]??Ae))),zo=rt=>{const Ae=gr(rt);if(!Ae)return null;const _t=Tr.get(Ae);if(_t)return _t;try{const bt=hk(Ae,Pi,ql,br.get(Ef),He);return Tr.set(Ae,bt),bt}catch(bt){const Tt=(bt==null?void 0:bt.message)!=null?String(bt.message):String(bt);return i(fs)||b(fs,`Expression error: ${Tt}`),i(ns)||b(ns,"Expression error"),null}},oi=rt=>{const Ae=va(rt);if(!Ae)return null;const _t=Il.get(Ae);if(_t)return _t;try{const bt=ay(Ae,Pi,ql,br.get(Ef),He);return Il.set(Ae,bt),bt}catch(bt){const Tt=(bt==null?void 0:bt.message)!=null?String(bt.message):String(bt);return i(fs)||b(fs,`Expression error: ${Tt}`),i(ns)||b(ns,"Expression error"),null}},Lr=(rt,Ae,_t)=>{if(!rt)return _t;const bt=rt[Ae];if(bt==null)return _t;const Tt=String(bt);return Tt||_t},kr=(rt,Ae,_t)=>{if(!rt)return _t;const bt=rt[Ae];return Number.isFinite(bt)?bt:_t};if(i(Bo)&&Array.isArray(Cf)&&Cf.length){const rt=ae?ge.labels:((Lv=M==null?void 0:M.style)==null?void 0:Lv.labelLimit)??((Ev=$t==null?void 0:$t.style)==null?void 0:Ev.labelLimit)??($t==null?void 0:$t.labelLimit),Ae=(()=>{const It=typeof rt=="number"?rt:Number(rt);return Number.isFinite(It)?Math.max(0,Math.floor(It)):600})();let _t=0,bt=!1,Tt=!1;for(const It of Cf){if(bt)break;if(!It)continue;const Yt=String(It.whenExpr||"").trim(),fn=String(It.when||"").trim();if(!Yt&&!fn)continue;const Ds=!ae&&String(It.shape||"").toLowerCase()==="text"&&String(It.text||"").trim().length<=1;let $n;const Rs=Ia(Yt,fn);if(!Rs)continue;$n=Rs;const cn=(It.source||It.name||"").replace(/\s+/g,"_").toLowerCase(),Vn=cn==="open"||cn==="high"||cn==="low"||cn==="close"||cn==="volume"||cn==="time",_i=zp[cn],Gr=_i||((Fp=Np[0])==null?void 0:Fp.key);if(!Ds&&(Ae===0||_t>=Ae)){ae&&!Tt&&(At("labels",Ae),Tt=!0),bt=!0;break}const An=[];for(let hu=0;hu<ms;(hu+=1)-1)$n[hu]&&An.push(hu);if(!An.length)continue;const ra=Ds?An.length:Math.max(0,Ae-_t);if(ra<=0){ae&&!Tt&&(At("labels",Ae),Tt=!0),Ds||(bt=!0);break}!Ds&&An.length>ra&&ae&&!Tt&&(At("labels",Ae),Tt=!0);const rr=An.length<=ra?An:(()=>{const hu=Math.max(1,Math.ceil(An.length/ra)),gl=[];for(let ff=An.length-1;ff>=0&&gl.length<ra;ff-=hu)gl.push(An[ff]);return gl.sort((ff,_l)=>ff-_l),gl})(),Hr=String(It.textExpr||"").trim(),ci=Hr?zo(Hr):null,On=String(It.colorExpr||"").trim(),Po=On?zo(On):null,Ma=String(It.bgColorExpr||"").trim(),ic=Ma?zo(Ma):null,wu=String(It.borderColorExpr||"").trim(),Tu=wu?zo(wu):null,Fu=String(It.textColorExpr||"").trim(),Gl=Fu?zo(Fu):null,Lu=String(It.sizeExpr||"").trim(),Xi=Lu?oi(Lu):null,Ql=String(It.offsetYExpr||"").trim(),If=Ql?oi(Ql):null;for(const hu of rr){if(!Ds&&_t>=Ae){bt=!0;break}const gl=Ii[hu]||(Ii[hu]={});let ff=(cn&&ui[cn]?ui[cn][hu]:void 0)??(_i?gl[_i]:void 0)??(Gr?gl[Gr]:void 0);if($t.pane==="sub"&&Vn&&Gr&&gl[Gr]!==void 0&&gl[Gr]!==null&&Number.isFinite(gl[Gr])&&(ff=gl[Gr]),$t.pane==="sub"&&typeof $t.min=="number"&&typeof $t.max=="number"&&Vn&&typeof ff=="number"&&Number.isFinite(ff)&&(ff<$t.min-5||ff>$t.max+5)&&(ff=Gr?gl[Gr]:ff),ff==null||Number.isNaN(ff)){const Hf=zp.__zero__||"__zero__",Hp=gl[Hf];ff=Hp??0}const _l=Vn&&cn||Gr,Oc=`__label_${_l}_${It.position||"above"}`,Df=It.text!=null?String(It.text):ci?String(ci[hu]??""):"",ah=Lr(Po,hu,It.color||"#f97316"),hh=Lr(ic,hu,It.bgColor),kg=Lr(Tu,hu,It.borderColor),_v=Lr(Gl,hu,It.textColor),Ph=kr(Xi,hu,It.size),zm=kr(If,hu,It.offsetY);gl[Oc]={text:Df,color:ah,yKey:_l,position:It.position||"above",offset:It.offset,value:ff,shape:It.shape,callout:It.callout,bgColor:hh,bgGradient:It.bgGradient??It.gradient,borderColor:kg,textColor:_v,size:Ph,offsetY:zm,wrap:It.wrap,maxWidth:It.maxWidth,padding:It.padding,bgOpacity:It.bgOpacity,borderWidth:It.borderWidth,radius:It.radius,align:It.align,valign:It.valign,lineHeight:It.lineHeight,fontFamily:It.fontFamily,fontSize:It.fontSize,fontWeight:It.fontWeight,monospace:It.monospace};const Wp=((z0=J[hu])==null?void 0:z0.timestamp)??((Gg=J[hu])==null?void 0:Gg.time)??((Yg=J[hu])==null?void 0:Yg.t),Xp=typeof Wp=="number"&&Number.isFinite(Wp)?Wp<1e12?Math.floor(Wp*1e3):Math.floor(Wp):void 0;Li.push({index:hu,ts:Wp,tsMs:Xp,meta:gl[Oc]}),Ds||(_t+=1);try{w6("label",{pane:$t.pane,index:hu,meta:gl[Oc]})}catch{}}}}const or=new Map,Hi=new Map,cl=new Map,Ho=new Map,qa=/\b(?:line|label|box|table)_get_[a-z0-9_]+\s*\(/i;let Fr=null;const Mi=rt=>Uu(String(rt||"").replace(/\$\{([^}]+)\}/g,(Ae,_t)=>String(ql[_t]??Ae))),Ll=rt=>tp(String(rt||"").replace(/\$\{([^}]+)\}/g,(Ae,_t)=>String(ql[_t]??Ae))),K=(rt,Ae)=>{const _t=Mi(rt);if(!_t)return null;const bt=or.get(_t);if(bt)return bt;const Tt=_t.match(/^[A-Za-z_$][A-Za-z0-9_$]*$/);if(Tt){const It=Tt[0].replace(/\s+/g,"_").toLowerCase(),Yt=Pi==null?void 0:Pi[It];if(Yt)return or.set(_t,Yt),Yt;const fn=(ui==null?void 0:ui[It])??(Va?Va[It]:void 0);if(Array.isArray(fn)){const Ds=Ar(fn);return Pi[It]=Ds,or.set(_t,Ds),Ds}}try{const It=ay(_t,Pi,ql,br.get(Ef),He);return or.set(_t,It),It}catch(It){const Yt=(It==null?void 0:It.message)!=null?String(It.message):String(It);return i(fs)||b(fs,`Expression error: ${Yt}`),i(ns)||b(ns,"Expression error"),null}},ht=(rt,Ae)=>{const _t=Ll(rt);if(!_t)return null;const bt=Hi.get(_t);if(bt)return bt;try{const Tt=hk(_t,Pi,ql,br.get(Ef),He);return Hi.set(_t,Tt),Tt}catch(Tt){const It=(Tt==null?void 0:Tt.message)!=null?String(Tt.message):String(Tt);return i(fs)||b(fs,`Expression error: ${It}`),i(ns)||b(ns,"Expression error"),null}},qe=rt=>{const Ae=Mi(rt);if(!Ae)return null;let _t=cl.get(Ae);if(_t)return _t;try{return _t=Ep(Ae),cl.set(Ae,_t),_t}catch(bt){const Tt=(bt==null?void 0:bt.message)!=null?String(bt.message):String(bt);return i(fs)||b(fs,`Expression error: ${Tt}`),i(ns)||b(ns,"Expression error"),null}},Vt=(rt,Ae,_t)=>{if(!Fr)return null;const bt=qe(rt);if(!bt)return null;try{return a$(bt,Pi,ql,_t,Fr,br.get(Ef),He)}catch(Tt){const It=(Tt==null?void 0:Tt.message)!=null?String(Tt.message):String(Tt);return i(fs)||b(fs,`Expression error: ${It}`),i(ns)||b(ns,"Expression error"),null}},Ye=(rt,Ae,_t)=>{const bt=Vt(rt,Ae,_t);return bt!=null&&Number.isFinite(bt)?bt:void 0},Ps=(rt,Ae,_t)=>{const bt=Ll(rt);if(!bt||!Fr)return"";let Tt=Ho.get(bt);if(!Tt)try{Tt=Ep(bt),Ho.set(bt,Tt)}catch(It){const Yt=(It==null?void 0:It.message)!=null?String(It.message):String(It);return i(fs)||b(fs,`Expression error: ${Yt}`),i(ns)||b(ns,"Expression error"),""}try{return l$(Tt,Pi,ql,_t,Fr,br.get(Ef))}catch(It){const Yt=(It==null?void 0:It.message)!=null?String(It.message):String(It);return i(fs)||b(fs,`Expression error: ${Yt}`),i(ns)||b(ns,"Expression error"),""}},vs=new Set,ps=rt=>{const Ae=rt;vs.has(Ae)||(vs.add(Ae),console.warn(rt))},as=new Set,Zt=rt=>{as.has(rt)||(as.add(rt),ae&&(He==null||He.emitOnce(rt,rt)),b(fs,H(i(fs)?`${i(fs)} • ${rt}`:rt)),i(ns)||b(ns,"Expression error"))},ct=(rt,Ae,_t)=>{const bt=(_t==null?void 0:_t.kind)==="label"?"label":(_t==null?void 0:_t.kind)==="box"?"box":"line",Tt=ae&&((_t==null?void 0:_t.kind)==="line"||(_t==null?void 0:_t.kind)==="label"||(_t==null?void 0:_t.kind)==="box"),It=(_t==null?void 0:_t.kind)==="polyline"||(_t==null?void 0:_t.kind)==="polygon"||(_t==null?void 0:_t.kind)==="path",Yt=Ae??"bar_index";if(Tt){if(Yt==="time"){if(!Number.isFinite(rt))return Zt(`${bt} x must be a number when xloc=time`),null}else if(!Number.isInteger(rt))return Zt(`${bt} x must be an integer when xloc=bar_index`),null}return bk({xVal:rt,xloc:Yt,len:ms,timeSeriesMs:Zo,tsIndex:rh,config:{mode:$f.time.mode,toleranceBars:$f.time.toleranceBars,toleranceMs:$f.time.toleranceMs,futureBars:$f.futureBars,avgIntervalMs:ha,strictXloc:Tt,allowFloatIndex:It},warn:ps,meta:_t})},Ut=(rt,Ae)=>{const _t=[];if(rt)for(let It=0;It<ms;(It+=1)-1)rt[It]&&_t.push(It);else for(let It=0;It<ms;(It+=1)-1)_t.push(It);if(_t.length<=Ae)return _t;const bt=Math.max(1,Math.ceil(_t.length/Ae)),Tt=[];for(let It=_t.length-1;It>=0&&Tt.length<Ae;It-=bt)Tt.push(_t[It]);return Tt.sort((It,Yt)=>It-Yt),Tt},hs=rt=>{if(typeof rt!="string")return;const Ae=rt.trim().toLowerCase();if(Ae==="background"||Ae==="bg")return"background";if(Ae==="main"||Ae==="base")return"main";if(Ae==="overlay"||Ae==="over")return"overlay";if(Ae==="ui")return"ui"},Is=rt=>{if(typeof rt=="number"&&Number.isFinite(rt))return rt;if(typeof rt=="string"){const Ae=Number(rt);return Number.isFinite(Ae)?Ae:void 0}},cs=rt=>{if(typeof rt=="boolean")return rt;if(typeof rt=="number")return Number.isFinite(rt)?rt!==0:void 0;if(typeof rt=="string"){const Ae=rt.trim().toLowerCase();if(Ae==="true")return!0;if(Ae==="false")return!1;const _t=Number(Ae);if(Number.isFinite(_t))return _t!==0}},Ms=[],us=[],ds=[],os=[],In=Math.max(ms-1+$f.futureBars,ms-1),Lo=[],_n=[],sn=[],Ao=rt=>{if(Number.isFinite(rt)&&!(rt<=0))return Math.min(64,rt)},Qo=rt=>{if(Number.isFinite(rt))return Math.max(0,Math.min(1,rt))};let wi=null,Do=null;if(Qf.length){const rt=new Map,Ae=Ot=>{const gs=String(Ot||"").trim();return gs?gs.replace(/\s+/g,"_").toLowerCase():null},_t=ae?Ae(String(((v0=M==null?void 0:M.params)==null?void 0:v0.__scriptId)??(M==null?void 0:M.id)??(M==null?void 0:M.name)??(M==null?void 0:M.title)??""))||"script":"";wi=`${Ae(String((M==null?void 0:M.id)??(M==null?void 0:M.name)??$h))}_${$t.pane}_${En}`||$h;const bt=vt.get(wi)??new Map;vt.set(wi,bt),Do=Bt.get(wi)??{created:{},updated:{},pruned:{}};const Tt=(Ot,gs)=>{const Z=Do[gs][Ot]??0;Do[gs][Ot]=Z+1},It=(Ot,gs)=>`${Ot}:${gs}`,Yt=new Map,fn=new Map,Ds=(Ot,gs)=>{const Z=Ae(Ot);return Z?gs.get(Z)||Z:null},$n=(Ot,gs)=>{if(!gs)return null;const Z=It(Ot,gs),Jn=Yt.get(Z);if(Jn)return Jn;const Ce={__handle:!0,kind:Ot,id:gs,key:Z};return Yt.set(Z,Ce),Ce},Rs=(Ot,gs)=>{const Z=Ae(Ot);Z&&gs&&fn.set(Z,gs)},cn=(Ot,gs)=>{const Z=Ae(Ot);if(!Z)return null;const Jn=fn.get(Z);return!Jn||gs&&Jn.kind!==gs?null:Jn},Vn=(Ot,gs,Z,Jn)=>{const Ce=cn(Z,Ot);if(Ce)return Ce;const yt=cn(gs,Ot);if(yt)return yt;const bn=Ds(gs,Jn);if(!bn)return null;const bs=$n(Ot,bn);return bs&&Rs(gs,bs),bs},_i=(Ot,gs,Z,Jn)=>{var Ce;return((Ce=Vn(Ot,gs,Z,Jn))==null?void 0:Ce.id)??null},Gr=(Ot,gs,Z)=>{const Jn=String(Ot||"").trim(),Ce=String(gs||"").trim(),yt=Jn||Ce;if(!yt)return!0;const bn=Mi(yt);if(bn&&qa.test(bn)){if(ae){const Pl=qe(bn);if(Pl&&dg(Pl))return He==null||He.emitOnce(`cond_type:${bn}`,ll),!1;const Ec=Vt(bn,"when",Z);return Ec==null?!1:Dg(Ec,He,`cond_na:${bn}`)}const Ni=Ye(bn,"when",Z);return Number.isFinite(Ni)&&Ni!==0}let bs=rt.get(yt);return bs||(bs=Ia(Jn,Ce),rt.set(yt,bs)),bs?!!bs[Z]:!1},An=(Ot,gs,Z)=>{if(!Ot)return;const Jn=String(Ot||"").trim();if(/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(Jn)){const bs=Us(Jn),Ni=ui[bs]??(Va?Va[bs]:void 0);if(Ni){const Pl=Ni[Z];return Number.isFinite(Pl)?Pl:void 0}}const Ce=Mi(String(Ot));if(Ce&&qa.test(Ce))return Ye(Ce,gs,Z);const yt=K(String(Ot));if(!yt)return;const bn=yt[Z];return Number.isFinite(bn)?bn:void 0},ra=(Ot,gs,Z,Jn)=>{if(Ot!=null)return String(Ot);if(!gs)return"";const Ce=Ll(String(gs));if(Ce&&qa.test(Ce))return Ps(Ce,Z,Jn);const yt=ht(gs);return yt?String(yt[Jn]??""):""},rr=24,Hr=80,ci=(Ot,gs)=>{const Z=String(Ot??"");return!ae||Z.length<=gs?Z:gs<=1?"…":`${Z.slice(0,Math.max(0,gs-1))}…`},On=Ot=>{if(!ae)return Ot;if(Number.isFinite(Ot)){if(!Number.isInteger(Ot)||Ot<1){He==null||He.emitOnce("line_width_int","line width must be an integer >= 1");return}return Ot}},Po=Ot=>{if(!ae)return Ot;if(Number.isFinite(Ot)){if(!Number.isInteger(Ot)){He==null||He.emitOnce("label_size_int","label size must be an integer");return}return Math.max(8,Math.min(32,Ot))}},Ma=Ot=>{if(!ae)return Ot;if(!Number.isFinite(Ot))return;const gs=Math.round(Number(Ot));return Math.max(0,Math.min(4,gs))},ic=Ot=>{if(!ae)return Ot;if(Number.isFinite(Ot)){if(!Number.isInteger(Ot)){He==null||He.emitOnce("box_text_size_int","box text_size must be an integer");return}return Math.max(8,Math.min(32,Ot))}},wu=Ot=>{if(!ae)return Ot;if(Number.isFinite(Ot)){if(!Number.isInteger(Ot)){He==null||He.emitOnce("box_border_width_int","box border_width must be an integer between 0 and 4");return}return Math.max(0,Math.min(4,Ot))}},Tu=Ot=>ae?Ot||"rgba(0,0,0,0)":Ot,Fu=Ot=>ae?Ot||"rgba(0,0,0,0)":Ot,Gl=Ot=>{if(Array.isArray(Ot)){const gs=Ot.map(Z=>String(Z||"").trim().toLowerCase()).filter(Boolean);return gs.length?gs:void 0}if(typeof Ot=="string"){const gs=Ot.split(",").map(Z=>Z.trim().toLowerCase()).filter(Boolean);return gs.length?gs:void 0}},Lu=(Ot,gs,Z)=>{if(!Ot)return;gs&&(Ot.groupId=gs);const Jn=Gl(Z);Jn&&(Ot.tags=Jn)},Xi={line:new Set,label:new Set,box:new Set},Ql=(Ot,gs,Z)=>{if(!ae)return;const Jn=`${gs}:${Z}`,Ce=Xi[Ot];if(Ce.has(Jn))return;Ce.add(Jn);const yt=`${Ot} is deleted`;b(fs,H(i(fs)?`${i(fs)} • ${yt}`:yt)),i(ns)||b(ns,"Expression error")},If=(Ot,gs)=>{ae&&(Ot==="line"&&U0.add(gs),Ot==="label"&&G0.add(gs),Ot==="box"&&Sg.add(gs))},hu=(Ot,gs)=>ae?Ot==="line"?U0.has(gs):Ot==="label"?G0.has(gs):Ot==="box"?Sg.has(gs):!1:!1,gl=Ot=>{if(!ae||Dl)return;Dl=!0;const gs=`line limit reached: ${Ot} (skipping new lines)`;b(fs,H(i(fs)?`${i(fs)} • ${gs}`:gs)),i(ns)||b(ns,"Expression error")},ff=Ot=>{if(!ae||Co)return;Co=!0;const gs=`label limit reached: ${Ot} (skipping new labels)`;b(fs,H(i(fs)?`${i(fs)} • ${gs}`:gs)),i(ns)||b(ns,"Expression error")},_l=Ot=>{if(!ae||Yr)return;Yr=!0;const gs=`box limit reached: ${Ot} (skipping new boxes)`;b(fs,H(i(fs)?`${i(fs)} • ${gs}`:gs)),i(ns)||b(ns,"Expression error")},Oc=Ot=>String(Ot??"").trim().toLowerCase(),Df=(Ot,gs)=>gs?Yt.get(It(Ot,gs)):null,ah=(Ot,gs,Z,Jn,Ce,yt)=>{if(!gs||Jn&&Jn!==Ot)return!1;const bn=Df(Ot,gs),bs=Oc(Ce);if(bs&&Oc((Z==null?void 0:Z.groupId)??(bn==null?void 0:bn.groupId))!==bs)return!1;const Ni=Oc(yt);if(Ni){const Pl=Gl((Z==null?void 0:Z.tags)??(bn==null?void 0:bn.tags))??(bn!=null&&bn.tags?Gl(bn.tags):void 0);if(!Pl||!Pl.includes(Ni))return!1}return!0},hh=(Ot,gs)=>{var Ce;if(!gs)return;const Z=It(Ot,gs);if(Yt.get(Z)){Yt.delete(Z);const yt=w==null?void 0:w[Ot];(Ce=yt==null?void 0:yt.delete)==null||Ce.call(yt,gs);for(const[bs,Ni]of fn.entries())(Ni==null?void 0:Ni.key)===Z&&fn.delete(bs);for(const[bs,Ni]of bt.entries())(Ni==null?void 0:Ni.key)===Z&&bt.delete(bs);const bn=bs=>{for(const[Ni,Pl]of bs.entries())Pl===gs&&bs.delete(Ni)};Ot==="line"&&bn(Wp),Ot==="linefill"&&bn(Xp),Ot==="label"&&bn(Hf),Ot==="box"&&bn(Hp),Ot==="table"&&bn(Zp),Ot==="polyline"&&bn(Qv),Ot==="polygon"&&bn($v),Ot==="path"&&bn(Dv)}},kg=(Ot,gs,Z)=>{gs<=0||console.warn(`[ScriptStudio] ${Ot} limit ${Z} reached; pruned ${gs} via ${$f.pruningPolicy} policy`)},_v=(Ot,gs,Z)=>{if($f.pruningPolicy==="lru"){const Jn=w[Z];return Ot.slice().sort((Ce,yt)=>(Jn.get(Ce)??Number.MIN_SAFE_INTEGER)-(Jn.get(yt)??Number.MIN_SAFE_INTEGER))}if($f.pruningPolicy==="byGroup"){const Jn=new Map;return Ot.forEach((Ce,yt)=>{var bs;const bn=((bs=gs.get(Ce))==null?void 0:bs.groupId)||"";Jn.has(bn)||Jn.set(bn,yt)}),Ot.slice().sort((Ce,yt)=>{var Ec,Fa;const bn=((Ec=gs.get(Ce))==null?void 0:Ec.groupId)||"",bs=((Fa=gs.get(yt))==null?void 0:Fa.groupId)||"",Ni=Jn.get(bn)??0,Pl=Jn.get(bs)??0;return Ni!==Pl?Ni-Pl:Ot.indexOf(Ce)-Ot.indexOf(yt)})}return Ot.slice()},Ph=(Ot,gs,Z,Jn)=>{const Ce=[];if(Ot.length<=Z)return;const yt=_v(Ot,gs,Jn);for(;Ot.length>Z&&yt.length;){const bn=yt.shift();if(!bn)continue;gs.delete(bn);const bs=Ot.indexOf(bn);bs>=0&&Ot.splice(bs,1),$[Jn].push(bn),hh(Jn,bn),Ce.push(bn),Tt(Jn,"pruned")}Ce.length&&kg(Jn,Ce.length,Z)},zm=(Ot,gs,Z,Jn,Ce)=>{const yt=[];if(!Ot||!Ot.length)return yt;for(const bn of Ot){if(!bn)continue;const bs=An(bn.x,`${Jn}.x`,Ce),Ni=An(bn.y,`${Jn}.y`,Ce);bs==null||Ni==null||yt.push({x:bs,y:Ni,xloc:bn.xloc||gs,yloc:bn.yloc||Z})}return yt},Wp=new Map,Xp=new Map,Hf=new Map,Hp=new Map,Zp=new Map,Qv=new Map,$v=new Map,Dv=new Map,Kh=new Map,Zu=new Map,Vu=new Map,Tc=new Map,Of=new Map,Pf=new Map,mh=new Map,Jp=new Map,U0=new Set,G0=new Set,Sg=new Set,Y0=[],K0=[],X0=[],Z0=[],Zg=[],J0=[],Q0=[],g=[],w={line:new Map,linefill:new Map,label:new Map,box:new Map,table:new Map,polyline:new Map,polygon:new Map,path:new Map},$={line:[],linefill:[],label:[],box:[],table:[],polyline:[],polygon:[],path:[]},ue=()=>Kh.size+Zu.size+Vu.size+Tc.size+Of.size+Pf.size+mh.size+Jp.size,Le=(Ot,gs,Z,Jn)=>!ae||!Jn?!1:jv!=null&&ue()>=jv?(At("runtime draws",jv),!0):gs!=null&&gs>0&&Z>=gs?(At(Ot,gs),!0):!1;let gt=0,ss=0,ks=0,Ws=0,vo=0,Co=!1,Jo=0,Yr=!1,Dl=!1,Cc=0,Wu=0,Ic=0,fd=0,Ad=0,Xh=0,Mh=0,Zh=0;bt.forEach((Ot,gs)=>{if(!Ot||!Ot.key)return;Yt.set(Ot.key,Ot),fn.set(gs,Ot);const Z=Ot.id;if(Z){if(Ot.kind==="line"){Wp.set(gs,Z);const Jn=Z.match(/line_(\d+)/);Jn&&(Cc=Math.max(Cc,Number(Jn[1])))}else if(Ot.kind==="linefill"){Xp.set(gs,Z);const Jn=Z.match(/linefill_(\d+)/);Jn&&(Wu=Math.max(Wu,Number(Jn[1])))}else if(Ot.kind==="label"){Hf.set(gs,Z);const Jn=Z.match(/label_(\d+)/);Jn&&(Ic=Math.max(Ic,Number(Jn[1])))}else if(Ot.kind==="box"){Hp.set(gs,Z);const Jn=Z.match(/box_(\d+)/);Jn&&(fd=Math.max(fd,Number(Jn[1])))}else if(Ot.kind==="table"){Zp.set(gs,Z);const Jn=Z.match(/table_(\d+)/);Jn&&(Ad=Math.max(Ad,Number(Jn[1])))}else if(Ot.kind==="polyline"){Qv.set(gs,Z);const Jn=Z.match(/polyline_(\d+)/);Jn&&(Xh=Math.max(Xh,Number(Jn[1])))}else if(Ot.kind==="polygon"){$v.set(gs,Z);const Jn=Z.match(/polygon_(\d+)/);Jn&&(Mh=Math.max(Mh,Number(Jn[1])))}else if(Ot.kind==="path"){Dv.set(gs,Z);const Jn=Z.match(/path_(\d+)/);Jn&&(Zh=Math.max(Zh,Number(Jn[1])))}}});const Ip=ae?ge.lines:$f.limits.line||240,Fm=ae?ge.labels:$f.limits.label||300,Rv=ae?ge.boxes:$f.limits.box||180,q_=$f.limits.table||20,C4=$f.limits.linefill||120,I4=$f.limits.polyline||180,P4=$f.limits.polygon||160,M4=$f.limits.path||160,jv=ae?ge.runtimeDraws:null;Fr={get:(Ot,gs,Z,Jn)=>{const Ce=String(gs||"").toLowerCase().replace(/[^a-z0-9]/g,""),yt=Ae(String(Z||""));if(yt){if(Ot==="line"){const bn=_i("line",yt,yt,Wp),bs=Kh.get(bn);return bs?Ce==="x1"?Number.isFinite(bs.x1)?bs.x1:NaN:Ce==="y1"?Number.isFinite(bs.y1)?bs.y1:NaN:Ce==="x2"?Number.isFinite(bs.x2)?bs.x2:NaN:Ce==="y2"?Number.isFinite(bs.y2)?bs.y2:NaN:Ce==="width"||Ce==="linewidth"?Number.isFinite(bs.width)?bs.width:NaN:Ce==="color"?bs.color??"":Ce==="style"?bs.style??"":Ce==="extend"?bs.extend??"":Ce==="xloc"?bs.xloc??"":void 0:void 0}if(Ot==="label"){const bn=_i("label",yt,yt,Hf),bs=Vu.get(bn);return bs?Ce==="x"?Number.isFinite(bs.x)?bs.x:NaN:Ce==="y"?Number.isFinite(bs.y)?bs.y:NaN:Ce==="size"?Number.isFinite(bs.size)?bs.size:NaN:Ce==="text"?bs.text??"":Ce==="color"?bs.color??"":Ce==="textcolor"?bs.textColor??"":Ce==="style"?bs.shape??"":Ce==="yloc"?bs.yloc??"":Ce==="xloc"?bs.xloc??"":Ce==="textalign"?bs.textAlign??"":Ce==="tooltip"?bs.tooltip??"":void 0:void 0}if(Ot==="box"){const bn=_i("box",yt,yt,Hp),bs=Tc.get(bn);return bs?Ce==="left"?Number.isFinite(bs.left)?bs.left:NaN:Ce==="right"?Number.isFinite(bs.right)?bs.right:NaN:Ce==="top"?Number.isFinite(bs.top)?bs.top:NaN:Ce==="bottom"?Number.isFinite(bs.bottom)?bs.bottom:NaN:Ce==="borderwidth"?Number.isFinite(bs.borderWidth)?bs.borderWidth:NaN:Ce==="textsize"?Number.isFinite(bs.textSize)?bs.textSize:NaN:Ce==="textwrap"?bs.textWrap?1:0:Ce==="bgcolor"?bs.bgColor??"":Ce==="bordercolor"?bs.borderColor??"":Ce==="borderstyle"?bs.borderStyle??"":Ce==="text"?bs.text??"":Ce==="textcolor"?bs.textColor??"":Ce==="texthalign"?bs.textHalign??"":Ce==="textvalign"?bs.textValign??"":Ce==="extend"?bs.extend??"":Ce==="xloc"?bs.xloc??"":void 0:void 0}if(Ot==="table"){const bn=_i("table",yt,yt,Zp),bs=Of.get(bn);return bs?Ce==="position"?bs.position??"":Ce==="columns"?Number.isFinite(bs.columns)?bs.columns:NaN:Ce==="rows"?Number.isFinite(bs.rows)?bs.rows:NaN:Ce==="borderwidth"?Number.isFinite(bs.borderWidth)?bs.borderWidth:NaN:Ce==="framewidth"?Number.isFinite(bs.frameWidth)?bs.frameWidth:NaN:Ce==="textsize"?Number.isFinite(bs.textSize)?bs.textSize:NaN:Ce==="bgcolor"?bs.bgcolor??"":Ce==="bordercolor"?bs.borderColor??"":Ce==="textcolor"?bs.textColor??"":Ce==="texthalign"?bs.textHalign??"":Ce==="textvalign"?bs.textValign??"":Ce==="framecolor"?bs.frameColor??"":void 0:void 0}}}};let Nh=0;for(let Ot=0;Ot<ms;(Ot+=1)-1)for(let gs=0;gs<Qf.length;(gs+=1)-1){const Z=Qf[gs];if(Nh+=1,!Z||!Gr(Z.whenExpr,Z.when,Ot))continue;const Jn=`${Z.kind}:${gs}`;if(Z.kind==="line_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Wp.get(Ce):null,bs=bn?Kh.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=ae?!0:!bs;if(ae&&Ni){if(jv!=null&&ue()>=jv){At("runtime draws",jv);continue}if(Ws>=Ip){At("lines",Ip),gl(Ip);continue}}else if(Le("lines",Ip,Kh.size,Ni))continue;const Pl=An(Z.x1,"line.x1",Ot),Ec=An(Z.y1,"line.y1",Ot),Fa=An(Z.x2,"line.x2",Ot),uu=An(Z.y2,"line.y2",Ot);if(Pl==null||Ec==null||Fa==null||uu==null)continue;const pf=$.line.shift(),$c=ae?`pline:${_t}:${(gt+=1)-1}`:null,yf=$c||(yt==null?void 0:yt.id)||bn||pf||`line_${Cc+=1}`;if(!$c){const yv=yf.match(/line_(\d+)/);yv&&(Cc=Math.max(Cc,Number(yv[1])))}const Rf=Z.width??An(Z.widthExpr,"line.width",Ot)??void 0,Ko=On(Rf),hc=Ao(Z.glow),Jh=Qo(Z.glowOpacity),Bv=Z.glowColor,Jg=hs(Z.layer),U_=Is(Z.zIndex),ev=cs(Z.includeInAutoscale),Vm=yt&&yt.id===yf?yt:$n("line",yf);Lu(Vm,Z.groupId,Gl(Z.tags)),Kh.set(yf,{x1:Pl,y1:Ec,x2:Fa,y2:uu,color:Z.color,gradient:Z.gradient,width:Ko,glow:hc,glowColor:Bv,glowOpacity:Jh,style:Z.style,extend:Z.extend,xloc:Z.xloc,layer:Jg,zIndex:U_,includeInAutoscale:ev,groupId:Z.groupId??(Vm==null?void 0:Vm.groupId),tags:Gl(Z.tags)??(Vm==null?void 0:Vm.tags)}),w.line.set(yf,Nh),Tt("line",Ni?"created":"updated"),Y0.push(yf),Ph(Y0,Kh,Ip,"line"),ae&&(Ws=Kh.size),Ce&&Vm&&(Wp.set(Ce,yf),Rs(Ce,Vm),bt.set(Ce,Vm));continue}if(Z.kind==="line_set"){const Ce=_i("line",Z.target,Z.targetExpr,Wp);if(!Ce)continue;if(ae&&hu("line",Ce)){Ql("line",Ce,Jn);continue}const yt=Kh.get(Ce);if(!yt)continue;const bn=An(Z.x1,"line.set_x1",Ot),bs=An(Z.y1,"line.set_y1",Ot),Ni=An(Z.x2,"line.set_x2",Ot),Pl=An(Z.y2,"line.set_y2",Ot);if(bn!=null&&(yt.x1=bn),bs!=null&&(yt.y1=bs),Ni!=null&&(yt.x2=Ni),Pl!=null&&(yt.y2=Pl),Z.color&&(yt.color=Z.color),Z.gradient&&(yt.gradient=Z.gradient),Z.width!=null||Z.widthExpr){const Ec=Z.width??An(Z.widthExpr,"line.set_width",Ot),Fa=On(Ec);Fa!=null&&(yt.width=Fa)}if(Z.glow!=null){const Ec=Ao(Z.glow);Ec!=null&&(yt.glow=Ec)}if(Z.glowOpacity!=null){const Ec=Qo(Z.glowOpacity);Ec!=null&&(yt.glowOpacity=Ec)}Z.glowColor&&(yt.glowColor=Z.glowColor),Z.style&&(yt.style=Z.style),Z.extend&&(yt.extend=Z.extend),Z.xloc&&(yt.xloc=Z.xloc),w.line.set(Ce,Nh),Tt("line","updated");continue}if(Z.kind==="line_delete"){const Ce=_i("line",Z.target,Z.targetExpr,Wp);if(!Ce)continue;Kh.delete(Ce);const yt=Y0.indexOf(Ce);yt>=0&&Y0.splice(yt,1),ae?(If("line",Ce),Ws=Kh.size):hh("line",Ce);continue}if(Z.kind==="linefill_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Xp.get(Ce):null,bs=bn?Zu.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=!bs;if(Le("runtime draws",null,Zu.size,Ni))continue;const Pl=_i("line",Z.line1,Z.line1,Wp),Ec=_i("line",Z.line2,Z.line2,Wp);if(!Pl||!Ec)continue;const Fa=$.linefill.shift(),uu=(yt==null?void 0:yt.id)||bn||Fa||`linefill_${Wu+=1}`,pf=uu.match(/linefill_(\d+)/);pf&&(Wu=Math.max(Wu,Number(pf[1])));const $c=hs(Z.layer),yf=Is(Z.zIndex),Rf=cs(Z.includeInAutoscale),Ko=yt??$n("linefill",uu);Lu(Ko,Z.groupId,Gl(Z.tags)),Zu.set(uu,{line1:Pl,line2:Ec,color:Z.color,layer:$c,zIndex:yf,includeInAutoscale:Rf,groupId:Z.groupId??(Ko==null?void 0:Ko.groupId),tags:Gl(Z.tags)??(Ko==null?void 0:Ko.tags)}),w.linefill.set(uu,Nh),Tt("linefill",bs?"updated":"created"),K0.push(uu),Ph(K0,Zu,C4,"linefill"),Ce&&Ko&&(Xp.set(Ce,uu),Rs(Ce,Ko),bt.set(Ce,Ko));continue}if(Z.kind==="linefill_set"){const Ce=_i("linefill",Z.target,Z.targetExpr,Xp);if(!Ce)continue;const yt=Zu.get(Ce);if(!yt)continue;if(Z.color&&(yt.color=Z.color),Z.line1){const bn=_i("line",Z.line1,Z.line1,Wp);bn&&(yt.line1=bn)}if(Z.line2){const bn=_i("line",Z.line2,Z.line2,Wp);bn&&(yt.line2=bn)}w.linefill.set(Ce,Nh),Tt("linefill","updated");continue}if(Z.kind==="linefill_delete"){const Ce=_i("linefill",Z.target,Z.targetExpr,Xp);if(!Ce)continue;Zu.delete(Ce);const yt=K0.indexOf(Ce);yt>=0&&K0.splice(yt,1),hh("linefill",Ce);continue}if(Z.kind==="label_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Hf.get(Ce):null,bs=bn?Vu.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=ae?!0:!bs;if(ae&&Ni){if(jv!=null&&ue()>=jv){At("runtime draws",jv);continue}if(vo>=Cu){At("labels",Cu),ff(Cu);continue}}else if(Le("labels",Fm,Vu.size,Ni))continue;const Pl=An(Z.x,"label.x",Ot),Ec=An(Z.y,"label.y",Ot);if(Pl==null||Ec==null)continue;const Fa=$.label.shift(),uu=ae?`plabel:${_t}:${(ss+=1)-1}`:null,pf=uu||(yt==null?void 0:yt.id)||bn||Fa||`label_${Ic+=1}`;if(!uu){const ew=pf.match(/label_(\d+)/);ew&&(Ic=Math.max(Ic,Number(ew[1])))}const $c=Z.size??An(Z.sizeExpr,"label.size",Ot)??void 0,yf=Po($c),Rf=Z.padding,Ko=Z.radius??An(Z.radiusExpr,"label.radius",Ot),hc=Z.maxWidth??An(Z.maxWidthExpr,"label.max_width",Ot),Jh=Z.borderWidth??An(Z.borderWidthExpr,"label.border_width",Ot),Bv=ae?Ma(Jh)??0:Jh,Jg=Z.lineHeight??An(Z.lineHeightExpr,"label.line_height",Ot),U_=hs(Z.layer),ev=Is(Z.zIndex),Vm=cs(Z.includeInAutoscale),yv=yt&&yt.id===pf?yt:$n("label",pf);Lu(yv,Z.groupId,Gl(Z.tags));const N4=ra(Z.text,Z.textExpr,"label.text",Ot),A4=ra(Z.tooltip,Z.tooltipExpr,"label.tooltip",Ot);Vu.set(pf,{x:Pl,y:Ec,text:ci(N4,rr),color:Z.color,textColor:Z.textColor,shape:Z.style,size:yf,xloc:Z.xloc,yloc:Z.yloc,textAlign:Z.textAlign,tooltip:ci(A4,Hr),wrap:ae?!1:Z.wrap,maxWidth:ae?void 0:hc,padding:Rf,bgColor:Tu(Z.bgColor),bgGradient:Z.bgGradient??Z.gradient,bgOpacity:Z.bgOpacity,borderColor:Fu(Z.borderColor),borderWidth:Bv,radius:Ko,align:Z.align,valign:Z.valign,lineHeight:Jg,fontFamily:Z.fontFamily,fontSize:Z.fontSize,fontWeight:Z.fontWeight,monospace:Z.monospace,pineV2:ae||void 0,layer:U_,zIndex:ev,includeInAutoscale:Vm,groupId:Z.groupId??(yv==null?void 0:yv.groupId),tags:Gl(Z.tags)??(yv==null?void 0:yv.tags)}),w.label.set(pf,Nh),Tt("label",Ni?"created":"updated"),X0.push(pf),Ph(X0,Vu,Fm,"label"),ae&&(vo=Vu.size),Ce&&yv&&(Hf.set(Ce,pf),Rs(Ce,yv),bt.set(Ce,yv));continue}if(Z.kind==="label_set"){const Ce=_i("label",Z.target,Z.targetExpr,Hf);if(!Ce)continue;if(ae&&hu("label",Ce)){Ql("label",Ce,Jn);continue}const yt=Vu.get(Ce);if(!yt)continue;const bn=An(Z.x,"label.set_x",Ot),bs=An(Z.y,"label.set_y",Ot);if(bn!=null&&(yt.x=bn),bs!=null&&(yt.y=bs),Z.text!=null||Z.textExpr){const Ni=ra(Z.text,Z.textExpr,"label.set_text",Ot);yt.text=ci(Ni,rr)}if(Z.color&&(yt.color=Z.color),Z.textColor&&(yt.textColor=Z.textColor),Z.style&&(yt.shape=Z.style),Z.size!=null||Z.sizeExpr){const Ni=Z.size??An(Z.sizeExpr,"label.set_size",Ot);Ni!=null&&(yt.size=Po(Ni))}if(Z.yloc&&(yt.yloc=Z.yloc),Z.textAlign&&(yt.textAlign=Z.textAlign),Z.tooltip!=null||Z.tooltipExpr){const Ni=ra(Z.tooltip,Z.tooltipExpr,"label.set_tooltip",Ot);yt.tooltip=ci(Ni,Hr)}Z.xloc&&(yt.xloc=Z.xloc),!ae&&Z.wrap!=null&&(yt.wrap=Z.wrap),!ae&&Z.maxWidth!=null&&(yt.maxWidth=Z.maxWidth),Z.padding!=null&&(yt.padding=Z.padding),Z.bgColor&&(yt.bgColor=Tu(Z.bgColor)),Z.bgGradient?yt.bgGradient=Z.bgGradient:Z.gradient&&(yt.bgGradient=Z.gradient),Z.bgOpacity!=null&&(yt.bgOpacity=Z.bgOpacity),Z.borderColor&&(yt.borderColor=Fu(Z.borderColor)),Z.borderWidth!=null&&(yt.borderWidth=Ma(Z.borderWidth)),Z.radius!=null&&(yt.radius=Z.radius),Z.align&&(yt.align=Z.align),Z.valign&&(yt.valign=Z.valign),Z.lineHeight!=null&&(yt.lineHeight=Z.lineHeight),Z.fontFamily&&(yt.fontFamily=Z.fontFamily),Z.fontSize!=null&&(yt.fontSize=Z.fontSize),Z.fontWeight&&(yt.fontWeight=Z.fontWeight),Z.monospace!=null&&(yt.monospace=Z.monospace),w.label.set(Ce,Nh),Tt("label","updated");continue}if(Z.kind==="label_delete"){const Ce=_i("label",Z.target,Z.targetExpr,Hf);if(!Ce)continue;Vu.delete(Ce);const yt=X0.indexOf(Ce);yt>=0&&X0.splice(yt,1),ae?(vo=Vu.size,If("label",Ce)):hh("label",Ce);continue}if(Z.kind==="box_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Hp.get(Ce):null,bs=bn?Tc.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=ae?!0:!bs;if(ae&&Ni){if(jv!=null&&ue()>=jv){At("runtime draws",jv);continue}if(Jo>=Ie){At("boxes",Ie),_l(Ie);continue}}else if(Le("boxes",Rv,Tc.size,Ni))continue;const Pl=An(Z.left,"box.left",Ot),Ec=An(Z.right,"box.right",Ot),Fa=An(Z.top,"box.top",Ot),uu=An(Z.bottom,"box.bottom",Ot);if(Pl==null||Ec==null||Fa==null||uu==null)continue;const pf=$.box.shift(),$c=ae?`pbox:${_t}:${(ks+=1)-1}`:null,yf=$c||(yt==null?void 0:yt.id)||bn||pf||`box_${fd+=1}`;if(!$c){const Vm=yf.match(/box_(\d+)/);Vm&&(fd=Math.max(fd,Number(Vm[1])))}const Rf=Z.width??An(Z.widthExpr,"box.border_width",Ot)??void 0,Ko=ae?wu(Rf):Rf,hc=Z.textSize??An(Z.textSizeExpr,"box.text_size",Ot)??void 0,Jh=ae?ic(hc):hc,Bv=hs(Z.layer),Jg=Is(Z.zIndex),U_=cs(Z.includeInAutoscale),ev=yt??$n("box",yf);Lu(ev,Z.groupId,Gl(Z.tags)),Tc.set(yf,{left:Pl,right:Ec,top:Fa,bottom:uu,borderColor:Z.borderColor,bgColor:Z.bgColor,bgGradient:Z.bgGradient??Z.gradient,borderWidth:Ko,borderStyle:Z.borderStyle,text:ra(Z.text,Z.textExpr,"box.text",Ot),tooltip:ra(Z.tooltip,Z.tooltipExpr,"box.tooltip",Ot),textColor:Z.textColor,textSize:Jh,textHalign:Z.textHalign,textValign:Z.textValign,textWrap:Z.textWrap,extend:Z.extend,xloc:Z.xloc,layer:Bv,zIndex:Jg,includeInAutoscale:U_,groupId:Z.groupId??(ev==null?void 0:ev.groupId),tags:Gl(Z.tags)??(ev==null?void 0:ev.tags)}),w.box.set(yf,Nh),Tt("box",Ni?"created":"updated"),Z0.push(yf),Ph(Z0,Tc,Rv,"box"),ae&&(Jo=Tc.size),Ce&&ev&&(Hp.set(Ce,yf),Rs(Ce,ev),bt.set(Ce,ev));continue}if(Z.kind==="box_set"){const Ce=_i("box",Z.target,Z.targetExpr,Hp);if(!Ce)continue;if(ae&&hu("box",Ce)){Ql("box",Ce,Jn);continue}const yt=Tc.get(Ce);if(!yt)continue;const bn=An(Z.left,"box.set_left",Ot),bs=An(Z.right,"box.set_right",Ot),Ni=An(Z.top,"box.set_top",Ot),Pl=An(Z.bottom,"box.set_bottom",Ot);if(bn!=null&&(yt.left=bn),bs!=null&&(yt.right=bs),Ni!=null&&(yt.top=Ni),Pl!=null&&(yt.bottom=Pl),Z.borderColor&&(yt.borderColor=Z.borderColor),Z.bgColor&&(yt.bgColor=Z.bgColor),Z.bgGradient?yt.bgGradient=Z.bgGradient:Z.gradient&&(yt.bgGradient=Z.gradient),Z.width!=null||Z.widthExpr){const Ec=Z.width??An(Z.widthExpr,"box.set_border_width",Ot),Fa=ae?wu(Ec):Ec;Fa!=null&&(yt.borderWidth=Fa)}if(Z.borderStyle&&(yt.borderStyle=Z.borderStyle),(Z.text!=null||Z.textExpr)&&(yt.text=ra(Z.text,Z.textExpr,"box.set_text",Ot)),Z.textColor&&(yt.textColor=Z.textColor),Z.textSize!=null||Z.textSizeExpr){const Ec=Z.textSize??An(Z.textSizeExpr,"box.set_text_size",Ot),Fa=ae?ic(Ec):Ec;Fa!=null&&(yt.textSize=Fa)}(Z.tooltip!=null||Z.tooltipExpr)&&(yt.tooltip=ra(Z.tooltip,Z.tooltipExpr,"box.set_tooltip",Ot)),Z.textHalign&&(yt.textHalign=Z.textHalign),Z.textValign&&(yt.textValign=Z.textValign),typeof Z.textWrap=="boolean"&&(yt.textWrap=Z.textWrap),Z.extend&&(yt.extend=Z.extend),Z.xloc&&(yt.xloc=Z.xloc),w.box.set(Ce,Nh),Tt("box","updated");continue}if(Z.kind==="box_delete"){const Ce=_i("box",Z.target,Z.targetExpr,Hp);if(!Ce)continue;Tc.delete(Ce);const yt=Z0.indexOf(Ce);yt>=0&&Z0.splice(yt,1),ae?(Jo=Tc.size,If("box",Ce)):hh("box",Ce);continue}if(Z.kind==="polyline_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Qv.get(Ce):null,bs=bn?Pf.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=!bs;if(Le("runtime draws",null,Pf.size,Ni))continue;const Pl=zm(Z.points,Z.xloc,Z.yloc,"polyline.points",Ot);if(!Pl.length)continue;const Ec=$.polyline.shift(),Fa=(yt==null?void 0:yt.id)||bn||Ec||`polyline_${Xh+=1}`,uu=Fa.match(/polyline_(\d+)/);uu&&(Xh=Math.max(Xh,Number(uu[1])));const pf=Z.width??An(Z.widthExpr,"polyline.width",Ot)??void 0,$c=yt??$n("polyline",Fa);Lu($c,Z.groupId,Gl(Z.tags)),Pf.set(Fa,{id:Fa,points:Pl,color:Z.color,gradient:Z.gradient,width:pf,style:Z.style,opacity:Z.opacity,glow:Ao(Z.glow),glowColor:Z.glowColor,glowOpacity:Qo(Z.glowOpacity),layer:hs(Z.layer),zIndex:Is(Z.zIndex),includeInAutoscale:cs(Z.includeInAutoscale),groupId:Z.groupId??($c==null?void 0:$c.groupId),tags:Gl(Z.tags)??($c==null?void 0:$c.tags)}),w.polyline.set(Fa,Nh),Tt("polyline",bs?"updated":"created"),J0.push(Fa),Ph(J0,Pf,I4,"polyline"),Ce&&$c&&(Qv.set(Ce,Fa),Rs(Ce,$c),bt.set(Ce,$c));continue}if(Z.kind==="polyline_set"){const Ce=_i("polyline",Z.target,Z.targetExpr,Qv);if(!Ce)continue;const yt=Pf.get(Ce);if(!yt)continue;if(Z.points&&Z.points.length){const bs=zm(Z.points,Z.xloc,Z.yloc,"polyline.set_points",Ot);bs.length&&(yt.points=bs)}if(Z.color&&(yt.color=Z.color),Z.gradient&&(yt.gradient=Z.gradient),Z.width!=null||Z.widthExpr){const bs=Z.width??An(Z.widthExpr,"polyline.set_width",Ot);bs!=null&&(yt.width=bs)}if(Z.style&&(yt.style=Z.style),Z.opacity!=null&&(yt.opacity=Z.opacity),Z.glow!=null){const bs=Ao(Z.glow);bs!=null&&(yt.glow=bs)}if(Z.glowOpacity!=null){const bs=Qo(Z.glowOpacity);bs!=null&&(yt.glowOpacity=bs)}Z.glowColor&&(yt.glowColor=Z.glowColor),Z.layer&&(yt.layer=Z.layer),Z.zIndex!=null&&(yt.zIndex=Z.zIndex),Z.includeInAutoscale!=null&&(yt.includeInAutoscale=Z.includeInAutoscale),Z.groupId&&(yt.groupId=Z.groupId);const bn=Gl(Z.tags);bn&&(yt.tags=bn),w.polyline.set(Ce,Nh),Tt("polyline","updated");continue}if(Z.kind==="polyline_delete"){const Ce=_i("polyline",Z.target,Z.targetExpr,Qv);if(!Ce)continue;Pf.delete(Ce);const yt=J0.indexOf(Ce);yt>=0&&J0.splice(yt,1),hh("polyline",Ce);continue}if(Z.kind==="polygon_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?$v.get(Ce):null,bs=bn?mh.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=!bs;if(Le("runtime draws",null,mh.size,Ni))continue;const Pl=zm(Z.points,Z.xloc,Z.yloc,"polygon.points",Ot);if(Pl.length<3)continue;const Ec=$.polygon.shift(),Fa=(yt==null?void 0:yt.id)||bn||Ec||`polygon_${Mh+=1}`,uu=Fa.match(/polygon_(\d+)/);uu&&(Mh=Math.max(Mh,Number(uu[1])));const pf=Z.strokeWidth??An(Z.strokeWidthExpr,"polygon.stroke_width",Ot)??void 0,$c=yt??$n("polygon",Fa);Lu($c,Z.groupId,Gl(Z.tags)),mh.set(Fa,{id:Fa,points:Pl,fillColor:Z.fillColor,fillGradient:Z.fillGradient,strokeColor:Z.strokeColor,strokeWidth:pf,strokeStyle:Z.strokeStyle,opacity:Z.opacity,glow:Ao(Z.glow),glowColor:Z.glowColor,glowOpacity:Qo(Z.glowOpacity),layer:hs(Z.layer),zIndex:Is(Z.zIndex),includeInAutoscale:cs(Z.includeInAutoscale),groupId:Z.groupId??($c==null?void 0:$c.groupId),tags:Gl(Z.tags)??($c==null?void 0:$c.tags)}),w.polygon.set(Fa,Nh),Tt("polygon",bs?"updated":"created"),Q0.push(Fa),Ph(Q0,mh,P4,"polygon"),Ce&&$c&&($v.set(Ce,Fa),Rs(Ce,$c),bt.set(Ce,$c));continue}if(Z.kind==="polygon_set"){const Ce=_i("polygon",Z.target,Z.targetExpr,$v);if(!Ce)continue;const yt=mh.get(Ce);if(!yt)continue;if(Z.points&&Z.points.length){const bs=zm(Z.points,Z.xloc,Z.yloc,"polygon.set_points",Ot);bs.length>=3&&(yt.points=bs)}if(Z.fillColor&&(yt.fillColor=Z.fillColor),Z.fillGradient&&(yt.fillGradient=Z.fillGradient),Z.strokeColor&&(yt.strokeColor=Z.strokeColor),Z.strokeWidth!=null||Z.strokeWidthExpr){const bs=Z.strokeWidth??An(Z.strokeWidthExpr,"polygon.stroke_width",Ot);bs!=null&&(yt.strokeWidth=bs)}if(Z.strokeStyle&&(yt.strokeStyle=Z.strokeStyle),Z.opacity!=null&&(yt.opacity=Z.opacity),Z.glow!=null){const bs=Ao(Z.glow);bs!=null&&(yt.glow=bs)}if(Z.glowOpacity!=null){const bs=Qo(Z.glowOpacity);bs!=null&&(yt.glowOpacity=bs)}Z.glowColor&&(yt.glowColor=Z.glowColor),Z.layer&&(yt.layer=Z.layer),Z.zIndex!=null&&(yt.zIndex=Z.zIndex),Z.includeInAutoscale!=null&&(yt.includeInAutoscale=Z.includeInAutoscale),Z.groupId&&(yt.groupId=Z.groupId);const bn=Gl(Z.tags);bn&&(yt.tags=bn),w.polygon.set(Ce,Nh),Tt("polygon","updated");continue}if(Z.kind==="polygon_delete"){const Ce=_i("polygon",Z.target,Z.targetExpr,$v);if(!Ce)continue;mh.delete(Ce);const yt=Q0.indexOf(Ce);yt>=0&&Q0.splice(yt,1),hh("polygon",Ce);continue}if(Z.kind==="path_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Dv.get(Ce):null,bs=bn?Jp.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=!bs;if(Le("runtime draws",null,Jp.size,Ni))continue;const Pl=Array.isArray(Z.commands)&&Z.commands.length?Z.commands:(Z.points||[]).map((yf,Rf)=>({cmd:Rf===0?"M":"L",x:yf.x,y:yf.y,xloc:yf.xloc||Z.xloc,yloc:yf.yloc||Z.yloc}));if(!Pl.length)continue;const Ec=$.path.shift(),Fa=(yt==null?void 0:yt.id)||bn||Ec||`path_${Zh+=1}`,uu=Fa.match(/path_(\d+)/);uu&&(Zh=Math.max(Zh,Number(uu[1])));const pf=Z.width??An(Z.widthExpr,"path.width",Ot)??void 0,$c=yt??$n("path",Fa);Lu($c,Z.groupId,Gl(Z.tags)),Jp.set(Fa,{id:Fa,commands:Pl,color:Z.color,gradient:Z.gradient,width:pf,style:Z.style,opacity:Z.opacity,glow:Ao(Z.glow),glowColor:Z.glowColor,glowOpacity:Qo(Z.glowOpacity),layer:hs(Z.layer),zIndex:Is(Z.zIndex),includeInAutoscale:cs(Z.includeInAutoscale),groupId:Z.groupId??($c==null?void 0:$c.groupId),tags:Gl(Z.tags)??($c==null?void 0:$c.tags)}),w.path.set(Fa,Nh),Tt("path",bs?"updated":"created"),g.push(Fa),Ph(g,Jp,M4,"path"),Ce&&$c&&(Dv.set(Ce,Fa),Rs(Ce,$c),bt.set(Ce,$c));continue}if(Z.kind==="path_set"){const Ce=_i("path",Z.target,Z.targetExpr,Dv);if(!Ce)continue;const yt=Jp.get(Ce);if(!yt)continue;if(Z.commands&&Z.commands.length&&(yt.commands=Z.commands),Z.color&&(yt.color=Z.color),Z.gradient&&(yt.gradient=Z.gradient),Z.width!=null||Z.widthExpr){const bs=Z.width??An(Z.widthExpr,"path.set_width",Ot);bs!=null&&(yt.width=bs)}if(Z.style&&(yt.style=Z.style),Z.opacity!=null&&(yt.opacity=Z.opacity),Z.glow!=null){const bs=Ao(Z.glow);bs!=null&&(yt.glow=bs)}if(Z.glowOpacity!=null){const bs=Qo(Z.glowOpacity);bs!=null&&(yt.glowOpacity=bs)}Z.glowColor&&(yt.glowColor=Z.glowColor),Z.layer&&(yt.layer=Z.layer),Z.zIndex!=null&&(yt.zIndex=Z.zIndex),Z.includeInAutoscale!=null&&(yt.includeInAutoscale=Z.includeInAutoscale),Z.groupId&&(yt.groupId=Z.groupId);const bn=Gl(Z.tags);bn&&(yt.tags=bn),w.path.set(Ce,Nh),Tt("path","updated");continue}if(Z.kind==="path_delete"){const Ce=_i("path",Z.target,Z.targetExpr,Dv);if(!Ce)continue;Jp.delete(Ce);const yt=g.indexOf(Ce);yt>=0&&g.splice(yt,1),hh("path",Ce);continue}if(Z.kind==="table_new"){const Ce=Ae(Z.assign),yt=Ce?fn.get(Ce):null,bn=Ce?Zp.get(Ce):null,bs=bn?Of.get(bn):null;if(Z.once&&Ce&&bn&&bs)continue;const Ni=!bs;if(Le("runtime draws",null,Of.size,Ni))continue;const Pl=Math.max(1,Math.floor(Number(Z.columns??0))),Ec=Math.max(1,Math.floor(Number(Z.rows??0)));if(!Pl||!Ec)continue;const Fa=$.table.shift(),uu=(yt==null?void 0:yt.id)||bn||Fa||`table_${Ad+=1}`,pf=uu.match(/table_(\d+)/);pf&&(Ad=Math.max(Ad,Number(pf[1])));const $c=hs(Z.layer),yf=Is(Z.zIndex),Rf=cs(Z.includeInAutoscale),Ko=yt??$n("table",uu);Lu(Ko,Z.groupId,Gl(Z.tags)),Of.set(uu,{id:uu,position:Z.position||"top_right",columns:Pl,rows:Ec,bgcolor:Z.bgcolor,borderColor:Z.borderColor,borderWidth:Z.borderWidth??An(Z.borderWidthExpr,"table.border_width",Ot)??void 0,textColor:Z.textColor,textSize:Z.textSize??An(Z.textSizeExpr,"table.text_size",Ot)??void 0,textHalign:Z.textHalign,textValign:Z.textValign,frameColor:Z.frameColor,frameWidth:Z.frameWidth??An(Z.frameWidthExpr,"table.frame_width",Ot)??void 0,cells:new Map,merges:[],layer:$c,zIndex:yf,includeInAutoscale:Rf,groupId:Z.groupId??(Ko==null?void 0:Ko.groupId),tags:Gl(Z.tags)??(Ko==null?void 0:Ko.tags)}),w.table.set(uu,Nh),Tt("table",bs?"updated":"created"),Zg.push(uu),Ph(Zg,Of,q_,"table"),Ce&&Ko&&(Zp.set(Ce,uu),Rs(Ce,Ko),bt.set(Ce,Ko));continue}if(Z.kind==="table_set"){const Ce=_i("table",Z.target,Z.targetExpr,Zp);if(!Ce)continue;const yt=Of.get(Ce);if(!yt)continue;if(Z.position&&(yt.position=Z.position),Z.bgcolor&&(yt.bgcolor=Z.bgcolor),Z.borderColor&&(yt.borderColor=Z.borderColor),Z.borderWidth!=null||Z.borderWidthExpr){const bn=Z.borderWidth??An(Z.borderWidthExpr,"table.set_border_width",Ot);bn!=null&&(yt.borderWidth=bn)}if(Z.textColor&&(yt.textColor=Z.textColor),Z.textSize!=null||Z.textSizeExpr){const bn=Z.textSize??An(Z.textSizeExpr,"table.set_text_size",Ot);bn!=null&&(yt.textSize=bn)}if(Z.textHalign&&(yt.textHalign=Z.textHalign),Z.textValign&&(yt.textValign=Z.textValign),Z.frameColor&&(yt.frameColor=Z.frameColor),Z.frameWidth!=null||Z.frameWidthExpr){const bn=Z.frameWidth??An(Z.frameWidthExpr,"table.set_frame_width",Ot);bn!=null&&(yt.frameWidth=bn)}w.table.set(Ce,Nh),Tt("table","updated");continue}if(Z.kind==="table_delete"){const Ce=_i("table",Z.target,Z.targetExpr,Zp);if(!Ce)continue;Of.delete(Ce);const yt=Zg.indexOf(Ce);yt>=0&&Zg.splice(yt,1),hh("table",Ce);continue}if(Z.kind==="table_clear"){const Ce=_i("table",Z.target,Z.targetExpr,Zp);if(!Ce)continue;const yt=Of.get(Ce);if(!yt)continue;if(!(Z.startColumn!=null||Z.startRow!=null||Z.endColumn!=null||Z.endRow!=null)){(g0=(Kg=yt.cells)==null?void 0:Kg.clear)==null||g0.call(Kg),yt.merges=[],w.table.set(Ce,Nh),Tt("table","updated");continue}const bs=An(Z.startColumn,"table.clear_start_col",Ot),Ni=An(Z.startRow,"table.clear_start_row",Ot),Pl=An(Z.endColumn,"table.clear_end_col",Ot),Ec=An(Z.endRow,"table.clear_end_row",Ot);if(bs==null||Ni==null||Pl==null||Ec==null){(gv=(wg=yt.cells)==null?void 0:wg.clear)==null||gv.call(wg),yt.merges=[];continue}const Fa=Math.min(Math.floor(bs),Math.floor(Pl)),uu=Math.max(Math.floor(bs),Math.floor(Pl)),pf=Math.min(Math.floor(Ni),Math.floor(Ec)),$c=Math.max(Math.floor(Ni),Math.floor(Ec)),yf=yt.cells||new Map;for(const Rf of Array.from(yf.keys())){const[Ko,hc]=String(Rf).split(":"),Jh=Number(Ko),Bv=Number(hc);Jh>=Fa&&Jh<=uu&&Bv>=pf&&Bv<=$c&&yf.delete(Rf)}yt.cells=yf,Array.isArray(yt.merges)&&yt.merges.length&&(yt.merges=yt.merges.filter(Rf=>{if(!Rf)return!1;const Ko=Math.min(Rf.left,Rf.right),hc=Math.max(Rf.left,Rf.right),Jh=Math.min(Rf.top,Rf.bottom),Bv=Math.max(Rf.top,Rf.bottom);return!(Ko<=uu&&hc>=Fa&&Jh<=$c&&Bv>=pf)})),w.table.set(Ce,Nh),Tt("table","updated");continue}if(Z.kind==="table_merge"){const Ce=_i("table",Z.target,Z.targetExpr,Zp);if(!Ce)continue;const yt=Of.get(Ce);if(!yt)continue;const bn=An(Z.left,"table.merge_left",Ot),bs=An(Z.top,"table.merge_top",Ot),Ni=An(Z.right,"table.merge_right",Ot),Pl=An(Z.bottom,"table.merge_bottom",Ot);if(bn==null||bs==null||Ni==null||Pl==null)continue;const Ec=Math.min(Math.floor(bn),Math.floor(Ni)),Fa=Math.max(Math.floor(bn),Math.floor(Ni)),uu=Math.min(Math.floor(bs),Math.floor(Pl)),pf=Math.max(Math.floor(bs),Math.floor(Pl));yt.columns=Math.max(yt.columns||1,Fa+1),yt.rows=Math.max(yt.rows||1,pf+1),Array.isArray(yt.merges)||(yt.merges=[]);const $c=`${Ec}:${uu}:${Fa}:${pf}`;yt.merges.some(yf=>`${yf.left}:${yf.top}:${yf.right}:${yf.bottom}`===$c)||yt.merges.push({left:Ec,top:uu,right:Fa,bottom:pf}),w.table.set(Ce,Nh),Tt("table","updated");continue}if(Z.kind==="table_cell"||Z.kind==="table_cell_set"){const Ce=_i("table",Z.target,Z.targetExpr,Zp);if(!Ce)continue;let yt=Of.get(Ce);if(!yt){const Ni=Df("table",Ce);yt={id:Ce,position:"top_right",columns:Math.max(1,Math.floor(Number(Z.column??0)+1)),rows:Math.max(1,Math.floor(Number(Z.row??0)+1)),cells:new Map,merges:[],groupId:Ni==null?void 0:Ni.groupId,tags:Ni==null?void 0:Ni.tags},Of.set(Ce,yt),Zg.push(Ce),Ph(Zg,Of,q_,"table")}yt.columns=Math.max(yt.columns||1,Math.floor(Number(Z.column??0)+1)),yt.rows=Math.max(yt.rows||1,Math.floor(Number(Z.row??0)+1));const bn=`${Z.column??0}:${Z.row??0}`,bs=yt.cells.get(bn)||{column:Math.floor(Number(Z.column??0)),row:Math.floor(Number(Z.row??0))};if((Z.text!=null||Z.textExpr)&&(bs.text=ra(Z.text,Z.textExpr,"table.cell_text",Ot)),Z.textColor&&(bs.textColor=Z.textColor),Z.bgcolor&&(bs.bgcolor=Z.bgcolor),Z.textSize!=null||Z.textSizeExpr){const Ni=Z.textSize??An(Z.textSizeExpr,"table.cell_text_size",Ot);Ni!=null&&(bs.textSize=Ni)}if(Z.textHalign&&(bs.textHalign=Z.textHalign),Z.textValign&&(bs.textValign=Z.textValign),Z.width!=null||Z.widthExpr){const Ni=Z.width??An(Z.widthExpr,"table.cell_width",Ot);Ni!=null&&(bs.width=Ni)}if(Z.height!=null||Z.heightExpr){const Ni=Z.height??An(Z.heightExpr,"table.cell_height",Ot);Ni!=null&&(bs.height=Ni)}(Z.tooltip!=null||Z.tooltipExpr)&&(bs.tooltip=ra(Z.tooltip,Z.tooltipExpr,"table.cell_tooltip",Ot)),yt.cells.set(bn,bs),w.table.set(Ce,Nh),Tt("table","updated");continue}if(Z.kind==="draw_clear"){const Ce=Z.filterKind,yt=Oc(Z.groupId),bn=Oc(Z.tag),bs=(Ni,Pl,Ec)=>{const Fa=Array.from(Pl.keys());for(const uu of Fa){const pf=Pl.get(uu);if(!ah(Ni,uu,pf,Ce,yt,bn))continue;Pl.delete(uu);const $c=Ec.indexOf(uu);$c>=0&&Ec.splice($c,1),ae&&(Ni==="line"||Ni==="label"||Ni==="box")?If(Ni,uu):hh(Ni,uu)}};(!Ce||Ce==="line")&&bs("line",Kh,Y0),(!Ce||Ce==="linefill")&&bs("linefill",Zu,K0),(!Ce||Ce==="label")&&bs("label",Vu,X0),(!Ce||Ce==="box")&&bs("box",Tc,Z0),(!Ce||Ce==="table")&&bs("table",Of,Zg),(!Ce||Ce==="polyline")&&bs("polyline",Pf,J0),(!Ce||Ce==="polygon")&&bs("polygon",mh,Q0),(!Ce||Ce==="path")&&bs("path",Jp,g),ae&&(!Ce||Ce==="label")&&(vo=Vu.size),ae&&(!Ce||Ce==="box")&&(Jo=Tc.size),ae&&(!Ce||Ce==="line")&&(Ws=Kh.size);continue}if(Z.kind==="draw_for_each"){const Ce=Z.updates||{},yt=Z.filterKind,bn=Oc(Z.groupId),bs=Oc(Z.tag),Ni=Ko=>{if(Ce.color&&(Ko.color=Ce.color),Ce.gradient&&(Ko.gradient=Ce.gradient),Ce.width!=null||Ce.widthExpr){const hc=Ce.width??An(Ce.widthExpr,"draw.for_each_line_width",Ot),Jh=On(hc);Jh!=null&&(Ko.width=Jh)}if(Ce.glow!=null){const hc=Ao(Ce.glow);hc!=null&&(Ko.glow=hc)}if(Ce.glowOpacity!=null){const hc=Qo(Ce.glowOpacity);hc!=null&&(Ko.glowOpacity=hc)}Ce.glowColor&&(Ko.glowColor=Ce.glowColor),Ce.style&&(Ko.style=Ce.style),Ce.extend&&(Ko.extend=Ce.extend),Ce.xloc&&(Ko.xloc=Ce.xloc)},Pl=Ko=>{if(Ce.color&&(Ko.color=Ce.color),Ce.textColor&&(Ko.textColor=Ce.textColor),Ce.bgGradient&&(Ko.bgGradient=Ce.bgGradient),Ce.text!=null||Ce.textExpr){const hc=ra(Ce.text,Ce.textExpr,"draw.for_each_label_text",Ot);Ko.text=ci(hc,rr)}if(Ce.textSize!=null||Ce.textSizeExpr){const hc=Ce.textSize??An(Ce.textSizeExpr,"draw.for_each_label_size",Ot);hc!=null&&(Ko.size=Po(hc))}Ce.xloc&&(Ko.xloc=Ce.xloc),!ae&&Ce.wrap!=null&&(Ko.wrap=Ce.wrap),!ae&&Ce.maxWidth!=null&&(Ko.maxWidth=Ce.maxWidth),Ce.padding!=null&&(Ko.padding=Ce.padding),Ce.bgColor&&(Ko.bgColor=Tu(Ce.bgColor)),Ce.bgOpacity!=null&&(Ko.bgOpacity=Ce.bgOpacity),Ce.borderColor&&(Ko.borderColor=Fu(Ce.borderColor)),Ce.borderWidth!=null&&(Ko.borderWidth=Ma(Ce.borderWidth)),Ce.radius!=null&&(Ko.radius=Ce.radius),Ce.align&&(Ko.align=Ce.align),Ce.valign&&(Ko.valign=Ce.valign),Ce.lineHeight!=null&&(Ko.lineHeight=Ce.lineHeight),Ce.fontFamily&&(Ko.fontFamily=Ce.fontFamily),Ce.fontSize!=null&&(Ko.fontSize=Ce.fontSize),Ce.fontWeight&&(Ko.fontWeight=Ce.fontWeight),Ce.monospace!=null&&(Ko.monospace=Ce.monospace)},Ec=Ko=>{if(Ce.bgColor&&(Ko.bgColor=Ce.bgColor),Ce.bgGradient&&(Ko.bgGradient=Ce.bgGradient),Ce.borderColor&&(Ko.borderColor=Ce.borderColor),Ce.textColor&&(Ko.textColor=Ce.textColor),(Ce.text!=null||Ce.textExpr)&&(Ko.text=ra(Ce.text,Ce.textExpr,"draw.for_each_box_text",Ot)),Ce.textSize!=null||Ce.textSizeExpr){const hc=Ce.textSize??An(Ce.textSizeExpr,"draw.for_each_box_text_size",Ot),Jh=ae?ic(hc):hc;Jh!=null&&(Ko.textSize=Jh)}Ce.extend&&(Ko.extend=Ce.extend),Ce.xloc&&(Ko.xloc=Ce.xloc)},Fa=Ko=>{Ce.color&&(Ko.color=Ce.color)},uu=Ko=>{if(Ce.bgColor&&(Ko.bgcolor=Ce.bgColor),Ce.borderColor&&(Ko.borderColor=Ce.borderColor),Ce.textColor&&(Ko.textColor=Ce.textColor),Ce.textSize!=null||Ce.textSizeExpr){const hc=Ce.textSize??An(Ce.textSizeExpr,"draw.for_each_table_text_size",Ot);hc!=null&&(Ko.textSize=hc)}},pf=Ko=>{if(Ce.color&&(Ko.color=Ce.color),Ce.gradient&&(Ko.gradient=Ce.gradient),Ce.width!=null||Ce.widthExpr){const hc=Ce.width??An(Ce.widthExpr,"draw.for_each_polyline_width",Ot);hc!=null&&(Ko.width=hc)}if(Ce.style&&(Ko.style=Ce.style),Ce.opacity!=null&&(Ko.opacity=Ce.opacity),Ce.glow!=null){const hc=Ao(Ce.glow);hc!=null&&(Ko.glow=hc)}if(Ce.glowOpacity!=null){const hc=Qo(Ce.glowOpacity);hc!=null&&(Ko.glowOpacity=hc)}Ce.glowColor&&(Ko.glowColor=Ce.glowColor)},$c=Ko=>{if(Ce.fillColor&&(Ko.fillColor=Ce.fillColor),Ce.fillGradient&&(Ko.fillGradient=Ce.fillGradient),Ce.color&&(Ko.strokeColor=Ce.color),Ce.borderColor&&(Ko.strokeColor=Ce.borderColor),Ce.width!=null||Ce.widthExpr){const hc=Ce.width??An(Ce.widthExpr,"draw.for_each_polygon_width",Ot);hc!=null&&(Ko.strokeWidth=hc)}if(Ce.opacity!=null&&(Ko.opacity=Ce.opacity),Ce.glow!=null){const hc=Ao(Ce.glow);hc!=null&&(Ko.glow=hc)}if(Ce.glowOpacity!=null){const hc=Qo(Ce.glowOpacity);hc!=null&&(Ko.glowOpacity=hc)}Ce.glowColor&&(Ko.glowColor=Ce.glowColor)},yf=Ko=>{if(Ce.color&&(Ko.color=Ce.color),Ce.gradient&&(Ko.gradient=Ce.gradient),Ce.width!=null||Ce.widthExpr){const hc=Ce.width??An(Ce.widthExpr,"draw.for_each_path_width",Ot);hc!=null&&(Ko.width=hc)}if(Ce.style&&(Ko.style=Ce.style),Ce.opacity!=null&&(Ko.opacity=Ce.opacity),Ce.glow!=null){const hc=Ao(Ce.glow);hc!=null&&(Ko.glow=hc)}if(Ce.glowOpacity!=null){const hc=Qo(Ce.glowOpacity);hc!=null&&(Ko.glowOpacity=hc)}Ce.glowColor&&(Ko.glowColor=Ce.glowColor)},Rf=(Ko,hc,Jh)=>{for(const[Bv,Jg]of hc.entries())ah(Ko,Bv,Jg,yt,bn,bs)&&Jh(Jg)};(!yt||yt==="line")&&Rf("line",Kh,Ni),(!yt||yt==="linefill")&&Rf("linefill",Zu,Fa),(!yt||yt==="label")&&Rf("label",Vu,Pl),(!yt||yt==="box")&&Rf("box",Tc,Ec),(!yt||yt==="table")&&Rf("table",Of,uu),(!yt||yt==="polyline")&&Rf("polyline",Pf,pf),(!yt||yt==="polygon")&&Rf("polygon",mh,$c),(!yt||yt==="path")&&Rf("path",Jp,yf);continue}}if(i(Bo)){let Ot=0;for(const[gs,Z]of Vu.entries()){if(Ot>=Fm){At("labels",Fm);break}const Jn=ct(Z.x,Z.xloc,{kind:"label",id:gs});if(Jn==null||Jn<0||Jn>In)continue;const Ce=Z.yloc||"price";let yt=Z.y;if(Ce==="abovebar"||Ce==="belowbar"){if(Jn>=ms)continue;const Fa=J[Jn],uu=(Fa==null?void 0:Fa.high)??(Fa==null?void 0:Fa.h),pf=(Fa==null?void 0:Fa.low)??(Fa==null?void 0:Fa.l);if(Ce==="abovebar"){if(!Number.isFinite(uu))continue;yt=Number(uu)}if(Ce==="belowbar"){if(!Number.isFinite(pf))continue;yt=Number(pf)}}if(!Number.isFinite(yt))continue;const bn=Z.includeInAutoscale!=null?Z.includeInAutoscale:ae?Ce==="price":Z.includeInAutoscale,bs=Ii[Jn]||(Ii[Jn]={}),Ni=`__label_rt_${Jn}_${Li.length}`;bs[Ni]={id:gs,text:Z.text||"",color:Z.color||"#f97316",yKey:"__rt__",position:Ce==="belowbar"?"below":"above",value:yt,yloc:Ce,shape:Z.shape,callout:Z.callout,textColor:Z.textColor,textAlign:Z.textAlign,tooltip:Z.tooltip,size:Z.size,pineV2:ae||void 0,wrap:Z.wrap,maxWidth:Z.maxWidth,padding:Z.padding,bgColor:Z.bgColor,bgGradient:Z.bgGradient??Z.gradient,bgOpacity:Z.bgOpacity,borderColor:Z.borderColor,borderWidth:Z.borderWidth,radius:Z.radius,align:Z.align,valign:Z.valign,lineHeight:Z.lineHeight,fontFamily:Z.fontFamily,fontSize:Z.fontSize,fontWeight:Z.fontWeight,monospace:Z.monospace,offsetY:0,layer:Z.layer,zIndex:Z.zIndex,includeInAutoscale:bn};const Pl=((V0=J[Jn])==null?void 0:V0.timestamp)??((W0=J[Jn])==null?void 0:W0.time)??((_0=J[Jn])==null?void 0:_0.t),Ec=typeof Pl=="number"&&Number.isFinite(Pl)?Pl<1e12?Math.floor(Pl*1e3):Math.floor(Pl):void 0;Li.push({index:Jn,ts:Pl,tsMs:Ec,meta:bs[Ni]}),Ot+=1}}const Mb=new Map;for(const[Ot,gs]of Kh.entries()){const Z={kind:"line",id:Ot},Jn=ct(gs.x1,gs.xloc,Z),Ce=ct(gs.x2,gs.xloc,Z);if(Jn==null||Ce==null||!Number.isFinite(gs.y1)||!Number.isFinite(gs.y2))continue;const yt=Ce!==Jn?(gs.y2-gs.y1)/(Ce-Jn):void 0,bn=yt!=null?gs.y1-yt*Jn:void 0,bs={id:Ot,startIndex:Jn,endIndex:Ce,startValue:gs.y1,endValue:gs.y2,slope:yt,intercept:bn,color:gs.color,gradient:gs.gradient,width:gs.width,glow:gs.glow,glowColor:gs.glowColor,glowOpacity:gs.glowOpacity,style:gs.style,extend:gs.extend,strictExtend:ae,layer:gs.layer,zIndex:gs.zIndex,includeInAutoscale:gs.includeInAutoscale};Mb.set(Ot,bs),Ms.push(bs)}for(const Ot of Zu.values()){if(!Ot)continue;const gs=Mb.get(Ot.line1),Z=Mb.get(Ot.line2);!gs||!Z||Lo.push({line1:gs,line2:Z,color:Ot.color,layer:Ot.layer,zIndex:Ot.zIndex,includeInAutoscale:Ot.includeInAutoscale})}for(const[Ot,gs]of Tc.entries()){const Z={kind:"box",id:Ot},Jn=ct(gs.left,gs.xloc,Z),Ce=ct(gs.right,gs.xloc,Z);Jn==null||Ce==null||!Number.isFinite(gs.top)||!Number.isFinite(gs.bottom)||_n.push({leftIndex:Jn,rightIndex:Ce,topValue:gs.top,bottomValue:gs.bottom,borderColor:gs.borderColor,bgColor:gs.bgColor,bgGradient:gs.bgGradient,borderWidth:gs.borderWidth,borderStyle:gs.borderStyle,text:gs.text,textColor:gs.textColor,textSize:gs.textSize,textHalign:gs.textHalign,textValign:gs.textValign,textWrap:gs.textWrap,extend:gs.extend,layer:gs.layer,zIndex:gs.zIndex,includeInAutoscale:gs.includeInAutoscale})}for(const[Ot,gs]of Pf.entries()){if(!gs||!Array.isArray(gs.points))continue;const Z=[];for(const Jn of gs.points){if(!Jn)continue;const Ce=ct(Jn.x,Jn.xloc||gs.xloc,{kind:"polyline",id:Ot});if(Ce==null)continue;const yt=Jn.y;Number.isFinite(yt)&&Z.push({index:Ce,value:yt})}Z.length<2||us.push({id:gs.id,points:Z,color:gs.color,gradient:gs.gradient,width:gs.width,style:gs.style,opacity:gs.opacity,glow:gs.glow,glowColor:gs.glowColor,glowOpacity:gs.glowOpacity,layer:gs.layer,zIndex:gs.zIndex,includeInAutoscale:gs.includeInAutoscale})}for(const[Ot,gs]of mh.entries()){if(!gs||!Array.isArray(gs.points))continue;const Z=[];for(const Jn of gs.points){if(!Jn)continue;const Ce=ct(Jn.x,Jn.xloc||gs.xloc,{kind:"polygon",id:Ot});if(Ce==null)continue;const yt=Jn.y;Number.isFinite(yt)&&Z.push({index:Ce,value:yt})}Z.length<3||ds.push({id:gs.id,points:Z,fillColor:gs.fillColor,fillGradient:gs.fillGradient,strokeColor:gs.strokeColor,strokeWidth:gs.strokeWidth,strokeStyle:gs.strokeStyle,opacity:gs.opacity,glow:gs.glow,glowColor:gs.glowColor,glowOpacity:gs.glowOpacity,layer:gs.layer,zIndex:gs.zIndex,includeInAutoscale:gs.includeInAutoscale})}for(const[Ot,gs]of Jp.entries()){if(!gs||!Array.isArray(gs.commands))continue;const Z=[];for(const Jn of gs.commands){if(!Jn||!Jn.cmd)continue;const Ce=ct(Jn.x,Jn.xloc||gs.xloc,{kind:"path",id:Ot});if(Ce==null)continue;const yt=Jn.y;if(!Number.isFinite(yt))continue;const bn=String(Jn.cmd||"").toUpperCase();bn!=="M"&&bn!=="L"||Z.push({cmd:bn,index:Ce,value:yt})}Z.length&&os.push({id:gs.id,commands:Z,color:gs.color,gradient:gs.gradient,width:gs.width,style:gs.style,opacity:gs.opacity,glow:gs.glow,glowColor:gs.glowColor,glowOpacity:gs.glowOpacity,layer:gs.layer,zIndex:gs.zIndex,includeInAutoscale:gs.includeInAutoscale})}for(const Ot of Of.values()){const gs=[];(Ot.cells||new Map).forEach(Jn=>{gs.push({column:Math.floor(Number(Jn.column??0)),row:Math.floor(Number(Jn.row??0)),text:Jn.text||"",textColor:Jn.textColor,bgcolor:Jn.bgcolor,textSize:Jn.textSize,textHalign:Jn.textHalign,textValign:Jn.textValign,width:Jn.width,height:Jn.height,tooltip:Jn.tooltip})}),sn.push({id:Ot.id,position:Ot.position,columns:Math.max(1,Math.floor(Number(Ot.columns??1))),rows:Math.max(1,Math.floor(Number(Ot.rows??1))),bgcolor:Ot.bgcolor,borderColor:Ot.borderColor,textColor:Ot.textColor,frameColor:Ot.frameColor,borderWidth:Ot.borderWidth,frameWidth:Ot.frameWidth,textSize:Ot.textSize,textHalign:Ot.textHalign,textValign:Ot.textValign,cells:gs,merges:Array.isArray(Ot.merges)?Ot.merges:[],layer:Ot.layer,zIndex:Ot.zIndex,includeInAutoscale:Ot.includeInAutoscale})}}if(i(Bo)&&Bp.length)for(const Ae of Bp){if(!Ae||!Ae.x||!Ae.y)continue;const _t=String(Ae.whenExpr||"").trim(),bt=String(Ae.when||"").trim(),Tt=_t||bt?Ia(_t,bt):null,It=K(String(Ae.x)),Yt=K(String(Ae.y));if(!It||!Yt)continue;const fn=Ut(Tt,300),Ds=Ae.textExpr?String(Ae.textExpr):"",$n=Ds?ht(Ds):null,Rs=Ae.colorExpr?String(Ae.colorExpr):"",cn=Rs?ht(Rs):null,Vn=Ae.textColorExpr?String(Ae.textColorExpr):"",_i=Vn?ht(Vn):null,Gr=Ae.sizeExpr?String(Ae.sizeExpr):"",An=Gr?K(Gr):null,ra=hs(Ae.layer),rr=Is(Ae.zIndex),Hr=cs(Ae.includeInAutoscale);for(const ci of fn){const On=It[ci],Po=ct(On,Ae.xloc,{kind:"runtime_label",id:ci});if(Po==null||Po<0||Po>In)continue;let ic=Yt[ci];if(Ae.yloc==="abovebar"||Ae.yloc==="belowbar"){if(Po>=ms)continue;const gl=J[Po],ff=(gl==null?void 0:gl.high)??(gl==null?void 0:gl.h),_l=(gl==null?void 0:gl.low)??(gl==null?void 0:gl.l);Ae.yloc==="abovebar"&&Number.isFinite(ff)&&(ic=ff),Ae.yloc==="belowbar"&&Number.isFinite(_l)&&(ic=_l)}if(!Number.isFinite(ic))continue;const wu=Ae.text!=null?String(Ae.text):$n?String($n[ci]??""):"",Tu=cn&&cn[ci]!=null&&String(cn[ci]).trim()?String(cn[ci]):Ae.color||"#f97316",Fu=_i&&_i[ci]!=null&&String(_i[ci]).trim()?String(_i[ci]):Ae.textColor,Gl=An?An[ci]:NaN,Lu=Number.isFinite(Gl)?Gl:Ae.size,Xi=Ii[Po]||(Ii[Po]={}),Ql=`__label_rt_${Po}_${Li.length}`;Xi[Ql]={text:wu,color:Tu,yKey:"__rt__",position:Ae.yloc==="belowbar"?"below":"above",value:ic,shape:Ae.shape,callout:Ae.callout,textColor:Fu,textAlign:Ae.textAlign,tooltip:Ae.tooltip,size:Lu,offsetY:typeof Ae.offsetY=="number"?Ae.offsetY:0,layer:ra,zIndex:rr,includeInAutoscale:Hr,wrap:Ae.wrap,maxWidth:Ae.maxWidth,padding:Ae.padding,bgColor:Ae.bgColor,bgOpacity:Ae.bgOpacity,borderColor:Ae.borderColor,borderWidth:Ae.borderWidth,radius:Ae.radius,align:Ae.align,valign:Ae.valign,lineHeight:Ae.lineHeight,fontFamily:Ae.fontFamily,fontSize:Ae.fontSize,fontWeight:Ae.fontWeight,monospace:Ae.monospace};const If=((v_=J[Po])==null?void 0:v_.timestamp)??((H0=J[Po])==null?void 0:H0.time)??((Xg=J[Po])==null?void 0:Xg.t),hu=typeof If=="number"&&Number.isFinite(If)?If<1e12?Math.floor(If*1e3):Math.floor(If):void 0;Li.push({index:Po,ts:If,tsMs:hu,meta:Xi[Ql]})}}Yp.__labelItems=Li,Yp.__tsIndex=rh,Yp.__timeSeriesMs=Zo;const ir=[];if(Gp.length)for(const Ae of Gp){if(!Ae)continue;const _t=String(Ae.whenExpr||"").trim(),bt=String(Ae.when||"").trim(),Tt=_t||bt?Ia(_t,bt):null,It=K(String(Ae.x1)),Yt=K(String(Ae.y1)),fn=K(String(Ae.x2)),Ds=K(String(Ae.y2));if(!It||!Yt||!fn||!Ds)continue;const $n=Ut(Tt,240),Rs=Ae.colorExpr?String(Ae.colorExpr):"",cn=Rs?ht(Rs):null,Vn=Ae.widthExpr||Ae.sizeExpr,_i=Vn?String(Vn):"",Gr=_i?K(_i):null;for(const An of $n){const ra={kind:"runtime_line",id:An},rr=ct(It[An],Ae.xloc,ra),Hr=ct(fn[An],Ae.xloc,ra);if(rr==null||Hr==null)continue;const ci=Yt[An],On=Ds[An];if(!Number.isFinite(ci)||!Number.isFinite(On))continue;const Po=Hr!==rr?(On-ci)/(Hr-rr):void 0,Ma=Po!=null?ci-Po*rr:void 0,ic=cn&&cn[An]!=null&&String(cn[An]).trim()?String(cn[An]):Ae.color,wu=Gr?Gr[An]:NaN,Tu=Number.isFinite(wu)?wu:Ae.width,Fu=Ao(Ae.glow),Gl=Qo(Ae.glowOpacity);ir.push({startIndex:rr,endIndex:Hr,startValue:ci,endValue:On,slope:Po,intercept:Ma,color:ic,gradient:Ae.gradient,width:Tu,glow:Fu,glowColor:Ae.glowColor,glowOpacity:Gl,style:Ae.style,extend:Ae.extend,strictExtend:ae,layer:hs(Ae.layer),zIndex:Is(Ae.zIndex),includeInAutoscale:cs(Ae.includeInAutoscale)})}}const Io=[];if(ao.length)for(const Ae of ao){if(!Ae)continue;const _t=String(Ae.whenExpr||"").trim(),bt=String(Ae.when||"").trim(),Tt=_t||bt?Ia(_t,bt):null,It=K(String(Ae.left)),Yt=K(String(Ae.right)),fn=K(String(Ae.top)),Ds=K(String(Ae.bottom)),$n=Ae.textExpr?String(Ae.textExpr):"",Rs=$n?ht($n):null,cn=Ae.bgColorExpr?String(Ae.bgColorExpr):"",Vn=cn?ht(cn):null,_i=Ae.borderColorExpr?String(Ae.borderColorExpr):"",Gr=_i?ht(_i):null,An=Ae.textColorExpr?String(Ae.textColorExpr):"",ra=An?ht(An):null,rr=Ae.borderWidthExpr||Ae.sizeExpr,Hr=rr?String(rr):"",ci=Hr?K(Hr):null;if(!It||!Yt||!fn||!Ds)continue;const On=Ut(Tt,180);for(const Po of On){const Ma={kind:"runtime_box",id:Po},ic=ct(It[Po],Ae.xloc,Ma),wu=ct(Yt[Po],Ae.xloc,Ma);if(ic==null||wu==null)continue;const Tu=fn[Po],Fu=Ds[Po];if(!Number.isFinite(Tu)||!Number.isFinite(Fu))continue;const Gl=Ae.text!=null?String(Ae.text):Rs?String(Rs[Po]??""):"",Lu=Vn&&Vn[Po]!=null&&String(Vn[Po]).trim()?String(Vn[Po]):Ae.bgColor,Xi=Gr&&Gr[Po]!=null&&String(Gr[Po]).trim()?String(Gr[Po]):Ae.borderColor,Ql=ra&&ra[Po]!=null&&String(ra[Po]).trim()?String(ra[Po]):Ae.textColor,If=ci?ci[Po]:NaN,hu=Number.isFinite(If)?If:Ae.borderWidth;Io.push({leftIndex:ic,rightIndex:wu,topValue:Tu,bottomValue:Fu,borderColor:Xi,bgColor:Lu,bgGradient:Ae.bgGradient??Ae.gradient,borderWidth:hu,borderStyle:Ae.borderStyle,text:Gl,textColor:Ql,textSize:Ae.textSize,textHalign:Ae.textHalign,textValign:Ae.textValign,textWrap:Ae.textWrap,extend:Ae.extend,layer:hs(Ae.layer),zIndex:Is(Ae.zIndex),includeInAutoscale:cs(Ae.includeInAutoscale)})}}const Bn=[];if(Ri.length){const rt=Math.max(0,ms-1);for(const Ae of Ri){if(!Ae)continue;const _t=Math.max(1,Math.floor(Number(Ae.columns??1))),bt=Math.max(1,Math.floor(Number(Ae.rows??1))),Tt=[],It=Array.isArray(Ae.cells)?Ae.cells:[];for(const Yt of It){if(!Yt)continue;const fn=String(Yt.whenExpr||"").trim(),Ds=String(Yt.when||"").trim();if(fn||Ds){const cn=Ia(fn,Ds);if(cn&&!cn[rt])continue}let $n="";if(Yt.text!=null)$n=String(Yt.text);else if(Yt.textExpr){const cn=ht(String(Yt.textExpr));$n=cn?String(cn[rt]??""):""}const Rs=Yt.tooltip!=null?String(Yt.tooltip):Yt.tooltipExpr?evalTextAt(void 0,String(Yt.tooltipExpr),"table.tooltip",rt):void 0;Tt.push({column:Math.floor(Number(Yt.column??0)),row:Math.floor(Number(Yt.row??0)),text:$n,textColor:Yt.textColor,bgcolor:Yt.bgcolor,textSize:Yt.textSize,textHalign:Yt.textHalign,textValign:Yt.textValign,width:Yt.width,height:Yt.height,tooltip:Rs})}Bn.push({id:Ae.id,position:Ae.position,columns:_t,rows:bt,bgcolor:Ae.bgcolor,borderColor:Ae.borderColor,textColor:Ae.textColor,frameColor:Ae.frameColor,borderWidth:Ae.borderWidth,frameWidth:Ae.frameWidth,textSize:Ae.textSize,textHalign:Ae.textHalign,textValign:Ae.textValign,cells:Tt,merges:Array.isArray(Ae.merges)?Ae.merges:[],layer:hs(Ae.layer),zIndex:Is(Ae.zIndex),includeInAutoscale:cs(Ae.includeInAutoscale)})}}const gi=ir.length||Ms.length?ir.concat(Ms):[],wo=Lo.length?Lo:[],Ei=Io.length||_n.length?Io.concat(_n):[],Ba=us.length?us:[],Ta=ds.length?ds:[],Ji=os.length?os:[],Nu=Bn.length||sn.length?Bn.concat(sn):[];if(Yp.__runtimeLineDefs=gi,Yp.__runtimeLineFills=wo,Yp.__runtimeBoxDefs=Ei,Yp.__runtimePolylineDefs=Ba,Yp.__runtimePolygonDefs=Ta,Yp.__runtimePathDefs=Ji,Yp.__runtimeTables=Nu,Yp.__runtimeHeatmaps=bc,wi&&Do&&Bt.set(wi,Do),Array.isArray(ep)&&ep.length){let rt=[];const Ae=_t=>{const bt=[];for(let Tt=ms-1;Tt>=0&&bt.length<2;(Tt-=1)+1){const It=_t[Tt];It!=null&&Number.isFinite(It)&&bt.push(Tt)}return bt.reverse()};if(ep.forEach(_t=>{const bt=String(_t.colorExpr||"").trim(),Tt=bt?zo(bt):null,It=String(_t.widthExpr||_t.sizeExpr||"").trim(),Yt=It?oi(It):null,fn=String(_t.start||"").replace(/\s+/g,"_").toLowerCase(),Ds=String(_t.end||"").replace(/\s+/g,"_").toLowerCase();let Rs=uh[fn]||uh[Ds]||"";Rs||(/low/i.test(fn)||/low/i.test(Ds)?Rs="pl":(/high/i.test(fn)||/high/i.test(Ds))&&(Rs="ph"));const Vn=(_t.segmentsFrom?String(_t.segmentsFrom):"").replace(/\s+/g,"_").toLowerCase(),_i=ui[Rs],Gr=Vn&&ui[Vn]||void 0,An=Gr||_i||ui.ph||ui.pl;if(An)if(Gr){const ra=[];for(let On=0;On<ms;(On+=1)-1){const Po=Gr[On];Po!=null&&Number.isFinite(Po)&&ra.push(On)}const rr=Math.max(1,Number(_t.maxSegments)||ra.length-1),Hr=Math.min(rr,24);let ci=0;for(let On=ra.length-2;On>=0&&!(ci>=Hr);(On-=1)+1){const Po=ra[On],Ma=ra[On+1],ic=Gr[Po],wu=Gr[Ma];if(!Number.isFinite(ic)||!Number.isFinite(wu)||Ma===Po)continue;const Tu=(wu-ic)/(Ma-Po),Fu=ic-Tu*Po;let Gl=!1;const Lu=Math.max(Po,ms-80);let Xi=NaN;for(let Ql=Lu;Ql<=Math.min(Ma,ms-1);(Ql+=1)-1){const If=Tu*Ql+Fu,hu=ui.close[Ql];if(!Number.isFinite(If)||!Number.isFinite(hu))continue;const gl=hu-If;if(!Number.isNaN(Xi)&&gl*Xi<0){Gl=!0;break}Xi=gl}Gl||(rt.push({startIndex:Po,endIndex:Ma,startValue:ic,endValue:wu,slope:Tu,intercept:Fu,color:Lr(Tt,Ma,_t.color||"#64748b"),width:kr(Yt,Ma,_t.width??1),style:(_t.style||"dotted").toLowerCase(),extend:_t.extend||"right",name:_t.name}),ci+=1)}}else{const ra=Ae(An);if(ra.length===2){const rr=ra[0],Hr=ra[1],ci=An[rr],On=An[Hr];if(Number.isFinite(ci)&&Number.isFinite(On)){const Po=(On-ci)/(Hr-rr),Ma=ci-Po*rr;let ic=!1;const wu=Math.max(rr,ms-80);let Tu=NaN;for(let Fu=wu;Fu<=Math.min(Hr,ms-1);(Fu+=1)-1){const Gl=Po*Fu+Ma,Lu=ui.close[Fu];if(!Number.isFinite(Gl)||!Number.isFinite(Lu))continue;const Xi=Lu-Gl;if(!Number.isNaN(Tu)&&Xi*Tu<0){ic=!0;break}Tu=Xi}if(ic)return;rt.push({startIndex:rr,endIndex:Hr,startValue:ci,endValue:On,slope:Po,intercept:Ma,color:Lr(Tt,Hr,_t.color||"#22c55e"),width:kr(Yt,Hr,_t.width??2),style:(_t.style||"solid").toLowerCase(),extend:_t.extend||"none",name:_t.name})}}}}),rt.length){const _t=[],bt=new Set;for(const Tt of rt){const It=Math.round((Tt.slope||0)*1e4),Yt=Math.round((Tt.intercept||0)*100),fn=`${It}:${Yt}:${Tt.style}:${Tt.color}:${Tt.extend}`;bt.has(fn)||(bt.add(fn),_t.push(Tt))}rt=_t.slice(0,60)}if(!rt.length){const _t=(bt,Tt,It,Yt)=>{const fn=String(bt||"").replace(/\s+/g,"_").toLowerCase(),Ds=ui[fn];if(!Ds)return;const $n=[];for(let Rs=0;Rs<ms;(Rs+=1)-1){const cn=Ds[Rs];cn!=null&&Number.isFinite(cn)&&$n.push(Rs)}if($n.length>=2){const Rs=$n[$n.length-2],cn=$n[$n.length-1],Vn=Ds[Rs],_i=Ds[cn];if(Number.isFinite(Vn)&&Number.isFinite(_i)&&cn!==Rs){const Gr=(_i-Vn)/(cn-Rs),An=Vn-Gr*Rs;rt.push({startIndex:Rs,endIndex:cn,startValue:Vn,endValue:_i,slope:Gr,intercept:An,color:Tt,width:Yt,style:It,extend:"right",name:fn})}}};_t("ph","#64748b","dotted",1),_t("pl","#64748b","dotted",1)}Yp.__lineDefs=rt}if(Av&&(qt.length||M!=null&&M.strategy)){const rt=$h;try{const Ae=J.map(It=>({timestamp:It.timestamp??It.time??0})),_t=qt.map(It=>({...It,when:Uf(String((It==null?void 0:It.when)||"")),frequency:It==null?void 0:It.frequency,cooldownBars:typeof(It==null?void 0:It.cooldownBars)=="number"&&Number.isFinite(It.cooldownBars)?Math.max(0,Math.floor(It.cooldownBars)):void 0}));_t.forEach((It,Yt)=>{!It||It.id!=null||(It.id=String(Yt))});const bt=(It,Yt)=>{var Kh;let fn=new Array(Yt).fill(0),Ds=new Array(Yt).fill(NaN),$n=new Array(Yt).fill(0),Rs=new Array(Yt).fill(0),cn=new Array(Yt).fill(0),Vn=new Array(Yt).fill(0),_i=new Array(Yt).fill(0),Gr=new Array(Yt).fill(0),An=new Array(Yt).fill(0),ra=new Array(Yt).fill(0),rr=new Array(Yt).fill(0),Hr=new Array(Yt).fill(0),ci=new Array(Yt).fill(0),On=new Array(Yt).fill(0),Po=new Array(Yt).fill(0),Ma=new Array(Yt).fill(0),ic=new Array(Yt).fill(0),wu=new Array(Yt).fill(0),Tu=new Array(Yt).fill(0);const Fu=((Kh=It==null?void 0:It.summary)==null?void 0:Kh.initialCapital)??0;let Gl=new Array(Yt).fill(Fu),Lu=new Array(Yt).fill(0);if(!It)return{positionSize:fn,positionAvgPrice:Ds,openTrades:$n,closedTrades:Rs,openProfit:cn,closedProfit:Vn,grossProfit:_i,grossLoss:Gr,winTrades:An,lossTrades:ra,winRate:rr,maxDrawdownPct:Hr,maxDrawdownValue:ci,maxRunupPct:On,maxRunupValue:Po,avgTrade:Ma,avgWin:ic,avgLoss:wu,avgBarsInTrade:Tu,equity:Gl,netProfit:Lu,initialCapital:Fu};const Xi=It==null?void 0:It.series,Ql=Zu=>Array.isArray(Zu)&&Zu.length===Yt?Zu:null,If=Ql(Xi==null?void 0:Xi.positionSize),hu=Ql(Xi==null?void 0:Xi.positionAvgPrice),gl=Ql(Xi==null?void 0:Xi.openTrades),ff=Ql(Xi==null?void 0:Xi.closedTrades),_l=Ql(Xi==null?void 0:Xi.openProfit),Oc=Ql(Xi==null?void 0:Xi.closedProfit),Df=Ql(Xi==null?void 0:Xi.grossProfit),ah=Ql(Xi==null?void 0:Xi.grossLoss),hh=Ql(Xi==null?void 0:Xi.winTrades),kg=Ql(Xi==null?void 0:Xi.lossTrades),_v=Ql(Xi==null?void 0:Xi.winRate),Ph=Ql(Xi==null?void 0:Xi.maxDrawdownPct),zm=Ql(Xi==null?void 0:Xi.maxDrawdownValue),Wp=Ql(Xi==null?void 0:Xi.maxRunupPct),Xp=Ql(Xi==null?void 0:Xi.maxRunupValue),Hf=Ql(Xi==null?void 0:Xi.avgTrade),Hp=Ql(Xi==null?void 0:Xi.avgWin),Zp=Ql(Xi==null?void 0:Xi.avgLoss),Qv=Ql(Xi==null?void 0:Xi.avgBarsInTrade),$v=Ql(Xi==null?void 0:Xi.equity),Dv=Ql(Xi==null?void 0:Xi.netProfit);if(If&&(fn=If),hu&&(Ds=hu),gl&&($n=gl),ff&&(Rs=ff),_l&&(cn=_l),Oc&&(Vn=Oc),Df&&(_i=Df),ah&&(Gr=ah),hh&&(An=hh),kg&&(ra=kg),_v&&(rr=_v),Ph&&(Hr=Ph),zm&&(ci=zm),Wp&&(On=Wp),Xp&&(Po=Xp),Hf&&(Ma=Hf),Hp&&(ic=Hp),Zp&&(wu=Zp),Qv&&(Tu=Qv),$v&&(Gl=$v),Dv&&(Lu=Dv),!If){const Zu=new Array(Yt);for(const Tc of It.orders||[]){if(!Tc||Tc.status!=="filled")continue;const Of=Tc==null?void 0:Tc.filledIndex,Pf=typeof Of=="number"&&Number.isFinite(Of)?Math.floor(Of):-1;if(Pf<0||Pf>=Yt)continue;const mh=Tc==null?void 0:Tc.fillQty,Jp=typeof mh=="number"?mh:Number(mh);if(!Number.isFinite(Jp)||Jp===0)continue;const U0=String((Tc==null?void 0:Tc.side)||"").toLowerCase(),G0=String((Tc==null?void 0:Tc.action)||"").toLowerCase();let Sg=0;G0==="entry"?Sg=U0==="short"?-Jp:Jp:G0==="exit"&&(Sg=U0==="short"?Jp:-Jp),!(!Number.isFinite(Sg)||Sg===0)&&(Zu[Pf]||(Zu[Pf]=[]),Zu[Pf].push(Sg))}let Vu=0;for(let Tc=0;Tc<Yt;(Tc+=1)-1){const Of=Zu[Tc];if(Of)for(const Pf of Of)Vu+=Pf;fn[Tc]=Vu}}if(!gl||!ff){const Zu=new Int32Array(Yt+1),Vu=new Int32Array(Yt+1);for(const Pf of It.roundTrips||[]){const mh=typeof Pf.entryIndex=="number"&&Number.isFinite(Pf.entryIndex)?Math.max(0,Math.floor(Pf.entryIndex)):-1,Jp=typeof Pf.exitIndex=="number"&&Number.isFinite(Pf.exitIndex)?Math.max(0,Math.floor(Pf.exitIndex)):-1;mh>=0&&mh<Yt&&(Zu[mh]+=1),Jp>=0&&Jp<Yt&&(Zu[Jp]-=1,Vu[Jp]+=1)}let Tc=0,Of=0;for(let Pf=0;Pf<Yt;(Pf+=1)-1){Tc+=Zu[Pf],Of+=Vu[Pf];const mh=fn[Pf]!==0;gl||($n[Pf]=Tc>0?Tc:mh?1:0),ff||(Rs[Pf]=Of)}}if(!$v&&Array.isArray(It.equity)&&It.equity.length){for(const Vu of It.equity){const Tc=Number(Vu==null?void 0:Vu.index),Of=Number(Vu==null?void 0:Vu.equity);!Number.isFinite(Tc)||Tc<0||Tc>=Yt||Number.isFinite(Of)&&(Gl[Math.floor(Tc)]=Of)}let Zu=Gl[0];for(let Vu=0;Vu<Yt;(Vu+=1)-1){const Tc=Gl[Vu];if(!Number.isFinite(Tc)){Gl[Vu]=Zu;continue}Zu=Tc}}if(!Dv)for(let Zu=0;Zu<Yt;(Zu+=1)-1){const Vu=Gl[Zu];Lu[Zu]=Number.isFinite(Vu)?Vu-Fu:NaN}if(!_v)for(let Zu=0;Zu<Yt;(Zu+=1)-1){const Vu=Rs[Zu]??0,Tc=An[Zu]??0;rr[Zu]=Vu>0?Tc/Vu*100:0}if(!Ph){let Zu=Fu;for(let Vu=0;Vu<Yt;(Vu+=1)-1){const Tc=Gl[Vu];if(Number.isFinite(Tc)&&(Tc>Zu&&(Zu=Tc),Zu>0)){const Of=(Zu-Tc)/Zu;Hr[Vu]=Math.max(Hr[Vu],Of*100)}}}return{positionSize:fn,positionAvgPrice:Ds,openTrades:$n,closedTrades:Rs,openProfit:cn,closedProfit:Vn,grossProfit:_i,grossLoss:Gr,winTrades:An,lossTrades:ra,winRate:rr,maxDrawdownPct:Hr,maxDrawdownValue:ci,maxRunupPct:On,maxRunupValue:Po,avgTrade:Ma,avgWin:ic,avgLoss:wu,avgBarsInTrade:Tu,equity:Gl,netProfit:Lu,initialCapital:Fu}},Tt=It=>{if(!It)return;if(Array.isArray(It==null?void 0:It.errors)&&It.errors.length){const Rs=It.errors.slice(0,4).map(cn=>String(cn)).join(" • ");b(fs,H(i(fs)?`${i(fs)} • ${Rs}`:Rs)),(!i(ns)||i(ns)==="Plotted from Pine"||i(ns)==="Plotted from DSL")&&b(ns,"Signals error")}const Yt=new Map;_t.forEach((Rs,cn)=>{Yt.set(String((Rs==null?void 0:Rs.id)??cn),Rs)});const fn=(Rs,cn,Vn)=>{if(typeof Rs=="number"&&Number.isFinite(Rs))return Rs;if(typeof Rs=="string"){const _i=Rs.replace(/\s+/g,"_").toLowerCase(),Gr=Pi==null?void 0:Pi[_i],An=Gr?Gr[cn]:NaN;if(Number.isFinite(An))return An;const ra=Number(Rs);if(Number.isFinite(ra))return ra}return Vn},Ds=(Rs,cn)=>{if(typeof Rs=="number"&&Number.isFinite(Rs))return Rs;if(typeof Rs=="string"){const Vn=Rs.replace(/\s+/g,"_").toLowerCase(),_i=Pi==null?void 0:Pi[Vn],Gr=_i?_i[cn]:NaN;if(Number.isFinite(Gr))return Gr;const An=Number(Rs);if(Number.isFinite(An))return An}},$n=(It.signals||[]).map(Rs=>{const cn=Yt.get(String((Rs==null?void 0:Rs.signalId)??""))||null,Vn=(cn==null?void 0:cn.order)||null;if(!Vn)return{...Rs,orderId:(cn==null?void 0:cn.orderId)??(Rs==null?void 0:Rs.orderId),title:cn==null?void 0:cn.title,message:cn==null?void 0:cn.message,frequency:cn==null?void 0:cn.frequency};const _i=String(Vn.kind||"market").trim().toLowerCase().replace(/stop\s*limit|stoplimit/g,"stop_limit"),Gr=Pi==null?void 0:Pi.close,An=Gr?Gr[Rs.index]:NaN,ra=Number.isFinite(An)?An:0,rr=_l=>{const Oc=typeof _l=="string"?_l.trim():"";return Oc||void 0},Hr=_l=>{const Oc=typeof _l=="number"?_l:Number(_l);if(!(!Number.isFinite(Oc)||Oc<=0))return Math.floor(Oc)},ci=(_l,Oc,Df)=>{if(typeof _l=="number"&&Number.isFinite(_l))return _l;if(typeof _l=="string")return fn(_l,Oc,Df)},On=_i==="limit"||_i==="stop"?fn(Vn.price,Rs.index,ra):void 0,Po=Vn.stopPrice??Vn.stop??Vn.trigger,Ma=Vn.limitPrice??Vn.limit??Vn.lmt,ic=Vn.qty??Vn.quantity,wu=Vn.cash,Tu=Ds(ic,Rs.index),Fu=Ds(wu,Rs.index),Gl=Vn.commissionPct??Vn.commission,Lu=Vn.slippagePct??Vn.slippage,Xi=Ds(Gl,Rs.index),Ql=Ds(Lu,Rs.index),If=_i==="stop_limit"?ci(Po??Vn.price,Rs.index,ra):void 0,hu=_i==="stop_limit"?ci(Ma??Vn.price,Rs.index,ra):void 0,gl=Vn==null?void 0:Vn.bracket,ff=gl&&typeof gl=="object"?{stopLossPct:typeof gl.stopLossPct=="number"?gl.stopLossPct:Number(gl.stopLossPct),takeProfitPct:typeof gl.takeProfitPct=="number"?gl.takeProfitPct:Number(gl.takeProfitPct),trailingStopPct:typeof gl.trailingStopPct=="number"?gl.trailingStopPct:Number(gl.trailingStopPct),takeProfits:Array.isArray(gl.takeProfits)?gl.takeProfits.map(_l=>({takeProfitPct:typeof(_l==null?void 0:_l.takeProfitPct)=="number"?_l.takeProfitPct:Number(_l==null?void 0:_l.takeProfitPct),qtyPct:typeof(_l==null?void 0:_l.qtyPct)=="number"?_l.qtyPct:Number(_l==null?void 0:_l.qtyPct)})).filter(_l=>Number.isFinite(_l.takeProfitPct)&&_l.takeProfitPct>0&&Number.isFinite(_l.qtyPct)&&_l.qtyPct>0):void 0}:void 0;return{...Rs,orderId:(cn==null?void 0:cn.orderId)??(Rs==null?void 0:Rs.orderId),title:cn==null?void 0:cn.title,message:cn==null?void 0:cn.message,frequency:cn==null?void 0:cn.frequency,order:{kind:_i,price:On,stopPrice:If,limitPrice:hu,qty:Tu,cash:Fu,commissionPct:Xi,slippagePct:Ql,qtyPct:Vn.qtyPct==null?void 0:Math.max(0,Math.min(100,Number(Vn.qtyPct)||0)),oco:rr(Vn.oco),expiresBars:Hr(Vn.expiresBars),bracket:ff}}});use(rt,$n);try{const Rs=_t.filter(Vn=>String((Vn==null?void 0:Vn.type)||"")==="alert").map(Vn=>({id:String((Vn==null?void 0:Vn.id)??""),title:Vn==null?void 0:Vn.title,message:Vn==null?void 0:Vn.message,frequency:Vn==null?void 0:Vn.frequency})).filter(Vn=>Vn.id);Rs.length&&qB(Rs);const cn=$n.filter(Vn=>String((Vn==null?void 0:Vn.type)||"")==="alert");if(cn.length){const Vn=Ae.length?Ae.length-1:0,_i=Pi==null?void 0:Pi.close,Gr=_i&&_i.length?_i[Vn]:void 0;(async()=>{var ra,rr,Hr,ci,On,Po;const An=await XB({events:cn.map(Ma=>({signalId:Ma.signalId,title:Ma.title,message:Ma.message,frequency:Ma.frequency,index:Ma.index,timestamp:Ma.timestamp})),context:{symbol:((rr=(ra=n())==null?void 0:ra.symbol)==null?void 0:rr.ticker)||((ci=(Hr=n())==null?void 0:Hr.symbol)==null?void 0:ci.name),timeframe:(Po=(On=n())==null?void 0:On.period)==null?void 0:Po.timeframe,price:Number.isFinite(Gr)?Gr:void 0,latestIndex:Vn}});for(const Ma of An){const ic=Ma.deliveries.find(wu=>wu.channel==="app");if(ic&&ic.status==="pending"){const wu=Ma.message||Ma.title||"Alert fired";jt.addAlert("info",wu,4)}}for(const Ma of An){if(!Ma.deliveries.some(wu=>wu.status==="pending"))continue;const ic=await ZS(Ma);JS(Ma.id,ic)}})()}}catch{}try{const Rs=(M==null?void 0:M.strategy)??null,cn=Rs===!0?{enabled:!0}:Rs,Vn=cn&&typeof cn=="object"?{...cn}:cn,_i=no&&typeof no=="object"?Vn&&typeof Vn=="object"?{...Vn,...no}:{...no}:Vn,Gr=jse(_i);if(Gr){const An=On=>{const Po=typeof On=="number"?On:Number(On);return Number.isFinite(Po)?Po:void 0},ra=J.map((On,Po)=>{const Ma=(On==null?void 0:On.timestamp)??(On==null?void 0:On.time)??0,ic=typeof Ma=="number"?Ma:Number(Ma),wu=An(On==null?void 0:On.close);return{index:Po,timestamp:Number.isFinite(ic)?ic:0,open:An(On==null?void 0:On.open),high:An(On==null?void 0:On.high),low:An(On==null?void 0:On.low),close:wu??NaN,volume:An(On==null?void 0:On.volume)}}),rr=$n.filter(On=>{const Po=String((On==null?void 0:On.type)||"");return Po==="entry_long"||Po==="exit_long"||Po==="entry_short"||Po==="exit_short"||Po==="cancel"||Po==="cancel_all"}),Hr=Ose(ra,rr,Gr);$se(rt,Hr);const ci=bt(Hr,ra.length);sl.set(Ef,{positionSize:ci.positionSize,positionAvgPrice:ci.positionAvgPrice,openTrades:ci.openTrades,closedTrades:ci.closedTrades,openProfit:ci.openProfit,closedProfit:ci.closedProfit,grossProfit:ci.grossProfit,grossLoss:ci.grossLoss,winTrades:ci.winTrades,lossTrades:ci.lossTrades,winRate:ci.winRate,maxDrawdownPct:ci.maxDrawdownPct,maxDrawdownValue:ci.maxDrawdownValue,maxRunupPct:ci.maxRunupPct,maxRunupValue:ci.maxRunupValue,avgTrade:ci.avgTrade,avgWin:ci.avgWin,avgLoss:ci.avgLoss,avgBarsInTrade:ci.avgBarsInTrade,equity:ci.equity,netProfit:ci.netProfit,initialCapital:ci.initialCapital}),Hr.accessors?br.set(Ef,Hr.accessors):br.delete(Ef),ro+=1,ys||(ys=!0,Ui.requestKey("strategy:refresh",()=>{var On,Po;try{const Ma=((On=fe.getDataList)==null?void 0:On.call(fe))||[];(Po=fe.applyNewData)==null||Po.call(fe,Ma,!1)}catch{}}))}else T6(rt),sl.delete(Ef),br.delete(Ef)}catch(Rs){console.error("[ScriptStudio] backtest error",Rs)}try{w6("signals",{id:It.id,signals:It.signals})}catch{}};if(!_t.length)Tt({id:rt,signals:[]});else{const It=`${Ae.length}:${((y0=Ae[Ae.length-1])==null?void 0:y0.timestamp)??0}:${_t.map(fn=>`${String((fn==null?void 0:fn.type)||"")}:${String((fn==null?void 0:fn.whenExpr)||"")}:${String((fn==null?void 0:fn.when)||"")}`).join("|")}`;let Yt=!1;if(Tn!==Zm){try{const fn=[],Ds=Ae.length,$n=new Map,Rs=new Map,cn=new Map,Vn=new Map,_i=ci=>Uu(String(ci||"").replace(/\$\{([^}]+)\}/g,(On,Po)=>String(ql[Po]??On))),Gr=ci=>li(String(ci||"").replace(/\$\{([^}]+)\}/g,(On,Po)=>String(ql[Po]??On))),An=(ci,On)=>{const Po=On!=null&&On.when?Gr(ci):_i(ci);if(!Po)return null;const Ma=$n.get(Po);if(Ma)return Ma;try{const ic=ay(Po,Pi,ql,br.get(Ef),He);return $n.set(Po,ic),ic}catch{return null}},ra=ci=>{const On=Gr(ci);if(!On)return null;const Po=cn.get(On);if(Po)return Po;try{const Ma=Ep(On);return cn.set(On,Ma),Ma}catch{return null}},rr=ci=>{const On=Gr(ci);if(!On)return!1;const Po=Vn.get(On);if(Po!=null)return Po;const Ma=ra(ci),ic=Ma?dg(Ma):!1;return Vn.set(On,ic),ic},Hr=ci=>{const On=Gr(ci);if(!On)return null;const Po=Rs.get(On);if(Po)return Po;if(ae&&rr(ci)){He==null||He.emitOnce(`cond_type:${On}`,ll);const Tu=new Uint8Array(Ds);return Rs.set(On,Tu),Tu}const Ma=An(ci,{when:!0});if(!Ma)return null;const ic=new Uint8Array(Ds),wu=ae?`cond_na:${On}`:"";for(let Tu=0;Tu<Ds;(Tu+=1)-1){const Fu=Ma[Tu];ic[Tu]=ae?Dg(Fu,He,wu)?1:0:Number.isFinite(Fu)&&Fu!==0?1:0}return Rs.set(On,ic),ic};for(let ci=0;ci<_t.length;(ci+=1)-1){const On=_t[ci],Po=String((On==null?void 0:On.type)||"");if(Po!=="entry_long"&&Po!=="exit_long"&&Po!=="entry_short"&&Po!=="exit_short"&&Po!=="alert"&&Po!=="cancel"&&Po!=="cancel_all")continue;const Ma=String((On==null?void 0:On.id)??ci),ic=(On==null?void 0:On.orderId)!=null&&String(On.orderId).trim()?String(On.orderId).trim():void 0,wu=String((On==null?void 0:On.whenExpr)||"").trim(),Tu=String((On==null?void 0:On.when)||"").trim();if(!wu&&!Tu)continue;const Fu=Hr(wu||Tu);if(!Fu)continue;const Gl=String((On==null?void 0:On.cooldownExpr)||"").trim(),Lu=Gl?An(Gl):null;if(Lu)for(let Oc=0;Oc<Ds;(Oc+=1)-1){const Df=Lu[Oc];if(Number.isFinite(Df)&&(!Number.isInteger(Df)||Df<0))throw new Error("cooldownExpr must be a non-negative integer")}const Xi=On==null?void 0:On.cooldownBars,Ql=typeof Xi=="number"&&Number.isFinite(Xi)?Math.max(0,Math.floor(Xi)):0,If=String((On==null?void 0:On.scoreExpr)||"").trim(),hu=If?An(If):null;if(hu)for(let Oc=0;Oc<Ds;(Oc+=1)-1){const Df=hu[Oc];if(Number.isFinite(Df)&&(!Number.isInteger(Df)||Df<0||Df>10))throw new Error("scoreExpr must be an integer 0..10")}const gl=On==null?void 0:On.score,ff=typeof gl=="number"&&Number.isFinite(gl)?gl:null;let _l=0;for(let Oc=0;Oc<Ds;(Oc+=1)-1){const Df=Lu&&Number.isFinite(Lu[Oc])?Math.max(0,Math.floor(Lu[Oc])):Ql;if(Df>0&&Oc<_l||!Fu[Oc])continue;const ah=((g_=Ae[Oc])==null?void 0:g_.timestamp)??Date.now(),hh=hu&&Number.isFinite(hu[Oc])?hu[Oc]:ff;fn.push({type:Po,index:Oc,timestamp:ah,signalId:Ma,orderId:ic,score:hh??null}),Df>0&&(_l=Oc+Df)}}Tt({id:rt,signals:fn})}catch(fn){console.error("[ScriptStudio] local signals/backtest error",fn)}Zm=Tn,Yt=!0}if(Yt&&(wm=It),!(Nv||It===wm)){Nv=!0,wm=It;const fn=new Worker(new URL(""+new URL("../workers/signals.worker-CYmm2_EA.js",import.meta.url).href,import.meta.url),{type:"module"}),Ds={id:rt,condSeries:Pi,bars:Ae,signals:_t,params:ql,userFunctions:M==null?void 0:M.userFunctions};fn.onerror=()=>{Nv=!1;try{fn.terminate()}catch{}},fn.onmessage=$n=>{const Rs=$n.data;if(!(!Rs||Rs.id!==Ds.id)){Tt(Rs);try{fn.terminate()}catch{}Nv=!1}},fn.postMessage(Ds)}}}catch(Ae){Nv=!1,console.error("[ScriptStudio] signals worker error",Ae)}}const Pa=cs(((b0=M==null?void 0:M.style)==null?void 0:b0.runtimeDrawAutoscale)??((x0=M==null?void 0:M.style)==null?void 0:x0.includeDrawingsInAutoscale)),zu=rt=>!!Pa||cs(rt)===!0;if(!!Pa||Ei.some(rt=>zu(rt==null?void 0:rt.includeInAutoscale))||gi.some(rt=>zu(rt==null?void 0:rt.includeInAutoscale))||wo.some(rt=>zu(rt==null?void 0:rt.includeInAutoscale))||bc.some(rt=>zu(rt==null?void 0:rt.includeInAutoscale))||Li.some(rt=>{var Ae;return zu((Ae=rt==null?void 0:rt.meta)==null?void 0:Ae.includeInAutoscale)})){const rt=new Array(ms),Ae=new Array(ms),_t=(Ds,$n)=>{if(!Number.isFinite($n)||Ds<0||Ds>=ms)return;const Rs=rt[Ds],cn=Ae[Ds];rt[Ds]=Rs==null||$n<Rs?$n:Rs,Ae[Ds]=cn==null||$n>cn?$n:cn},bt=(Ds,$n,Rs)=>{if(!Number.isFinite(Rs))return;const cn=Math.max(0,Math.min(Ds,$n)),Vn=Math.min(ms-1,Math.max(Ds,$n));for(let _i=cn;_i<=Vn;(_i+=1)-1)_t(_i,Rs)},Tt=Ds=>{let $n=Number(Ds==null?void 0:Ds.startIndex),Rs=Number(Ds==null?void 0:Ds.endIndex);if(!Number.isFinite($n)||!Number.isFinite(Rs))return null;if($n>Rs){const Vn=$n;$n=Rs,Rs=Vn}const cn=String((Ds==null?void 0:Ds.extend)||"").toLowerCase();return cn==="both"?($n=0,Rs=Math.max(0,ms-1)):cn==="left"?$n=0:cn==="right"&&(Rs=Math.max(0,ms-1)),{a:$n,b:Rs}},It=(Ds,$n)=>Number.isFinite(Ds==null?void 0:Ds.slope)&&Number.isFinite(Ds==null?void 0:Ds.intercept)?Ds.slope*$n+Ds.intercept:Number.isFinite(Ds==null?void 0:Ds.startValue)?Ds.startValue:Number.NaN;for(const Ds of Ei){if(!zu(Ds==null?void 0:Ds.includeInAutoscale))continue;let $n=Ds.leftIndex,Rs=Ds.rightIndex;if(ae){const cn=Math.max(0,ms-1),Vn=Number.isFinite(fromIndex)?fromIndex:$n,_i=Number.isFinite(toIndex)?toIndex:Rs,Gr=Math.max(0,Math.min(Vn,_i)),An=Math.min(cn,Math.max(Vn,_i)),ra=xk({baseLeft:$n,baseRight:Rs,extend:Ds.extend,vpLeft:Gr,vpRight:An,lastIndex:cn});ra&&($n=ra.leftExt,Rs=ra.rightExt)}else{const cn=String(Ds.extend||"").toLowerCase();cn==="both"?($n=0,Rs=Math.max(0,ms-1)):cn==="left"?$n=0:cn==="right"&&(Rs=Math.max(0,ms-1))}bt($n,Rs,Number(Ds.topValue)),bt($n,Rs,Number(Ds.bottomValue))}for(const Ds of gi){if(!zu(Ds==null?void 0:Ds.includeInAutoscale))continue;const $n=Tt(Ds);if(!$n)continue;const{a:Rs,b:cn}=$n;if(Number.isFinite(Ds==null?void 0:Ds.slope)&&Number.isFinite(Ds==null?void 0:Ds.intercept))for(let Vn=Rs;Vn<=cn;(Vn+=1)-1){const _i=It(Ds,Vn);_t(Vn,_i)}else _t(Rs,Number(Ds==null?void 0:Ds.startValue)),_t(cn,Number(Ds==null?void 0:Ds.endValue))}for(const Ds of wo){if(!zu(Ds==null?void 0:Ds.includeInAutoscale))continue;const $n=Ds==null?void 0:Ds.line1,Rs=Ds==null?void 0:Ds.line2;if(!$n||!Rs)continue;const cn=Tt($n),Vn=Tt(Rs);if(!cn||!Vn)continue;const _i=Math.max(cn.a,Vn.a),Gr=Math.min(cn.b,Vn.b);if(!(_i>Gr))for(let An=_i;An<=Gr;(An+=1)-1){const ra=It($n,An),rr=It(Rs,An);!Number.isFinite(ra)||!Number.isFinite(rr)||(_t(An,Math.min(ra,rr)),_t(An,Math.max(ra,rr)))}}for(const Ds of Li){if(!zu((q0=Ds==null?void 0:Ds.meta)==null?void 0:q0.includeInAutoscale))continue;const $n=Ds==null?void 0:Ds.index,Rs=(w0=Ds==null?void 0:Ds.meta)==null?void 0:w0.value;typeof $n!="number"||!Number.isFinite($n)||Number.isFinite(Rs)&&_t($n,Number(Rs))}for(const Ds of bc){if(!zu(Ds==null?void 0:Ds.includeInAutoscale))continue;const $n=Array.isArray(Ds==null?void 0:Ds.points)?Ds.points:[];if(!$n.length)continue;const Rs=(Ds==null?void 0:Ds.xloc)??"bar_index";for(const cn of $n){const Vn=Number(cn==null?void 0:cn.x),_i=Number(cn==null?void 0:cn.y);if(!Number.isFinite(Vn)||!Number.isFinite(_i))continue;const Gr=ct(Vn,Rs,{kind:"heatmap",id:(Ds==null?void 0:Ds.id)??"heatmap"});Gr!=null&&_t(Gr,_i)}}const Yt=Ki[ka.min],fn=Ki[ka.max];for(let Ds=0;Ds<ms;(Ds+=1)-1){const $n=rt[Ds],Rs=Ae[Ds];Yt&&(Yt[Ds]=$n),fn&&(fn[Ds]=Rs);const cn=Ii[Ds];cn&&(cn[ka.min]=$n,cn[ka.max]=Rs)}}Ii.length=Math.max(Ii.length,In+1);const ta=Yp;ta.__rows=Ii,ta.__len=ms,ta.__futureBars=$f.futureBars,ta.__virtualMaxIndex=In,ta.__drawConfig=$f,ta.__scriptSource=me,mg=km,jm=ta,Tv.__lastResult=jm;try{Ui.requestKey("script-overlay:redraw",()=>{try{ed()}catch{}})}catch{}return jm},draw:({ctx:J,indicator:ms,bounding:Ci,xAxis:xi,yAxis:ko,chart:cf})=>{var Ll;if(!J||!xi||!ko)return!1;const Ac=(ms==null?void 0:ms.result)||{},Bu=Array.isArray(Ac)?Ac:Array.isArray(Ac.__rows)?Ac.__rows:[],dh=Cm("interactionV2"),Vp=Ac.__drawConfig||{},mv=Number.isFinite(Ac.__futureBars)?Math.max(0,Number(Ac.__futureBars)):Number.isFinite(Vp==null?void 0:Vp.futureBars)?Math.max(0,Number(Vp.futureBars)):0,Qm=typeof Ac.__virtualMaxIndex=="number"?Number(Ac.__virtualMaxIndex):Bu.length&&mv?Bu.length-1+mv:Bu.length?Bu.length-1:-1,km=typeof xi.getRange=="function"?xi.getRange():{from:0,to:Bu.length?Bu.length-1:0},Yp=Bu.length?Bu.length-1:-1,rh=Math.max(Yp,Qm),ui=rh>=0?Math.max(0,Math.floor(((km==null?void 0:km.from)??0)-2)):0,_d=rh>=0?Math.min(rh,Math.ceil(((km==null?void 0:km.to)??rh)+2)):-1;if(dh&&rh>=1){const K=Math.max(0,Math.min(ui,rh-1)),ht=xi.convertToPixel(K),qe=xi.convertToPixel(K+1),Vt=Number.isFinite(ht)&&Number.isFinite(qe)?Math.abs(qe-ht):NaN,Ye=typeof ko.getRange=="function"?ko.getRange():null,Ps=Number(Ye==null?void 0:Ye.from),vs=Number(Ye==null?void 0:Ye.to);let ps=NaN;if(Number.isFinite(Ps)&&Number.isFinite(vs)&&Ps!==vs){const as=(Ps+vs)/2,Zt=(vs-Ps)/100,ct=ko.convertToPixel(as),Ut=ko.convertToPixel(as+Zt);Number.isFinite(ct)&&Number.isFinite(Ut)&&(ps=Math.abs(Ut-ct))}Lh={x:Number.isFinite(Vt)&&Vt>0?Vt:Lh.x,y:Number.isFinite(ps)&&ps>0?ps:Lh.y}}(()=>{var vs,ps,as,Zt,ct,Ut,hs;if(!mv||Qm<=Yp){(Re.maxPx||Re.offsetPx)&&(Re.maxPx=0,Re.offsetPx=0,Re.lastAppliedTs=0);return}const K=(ct=(Zt=(as=(ps=(vs=xi==null?void 0:xi.getParent)==null?void 0:vs.call(xi))==null?void 0:ps.getChart)==null?void 0:as.call(ps))==null?void 0:Zt.getChartStore)==null?void 0:ct.call(Zt);if(!K)return;const ht=typeof performance<"u"?performance.now():Date.now();if(ht-Re.lastAppliedTs<500)return;const qe=((Ut=K.getBarSpace)==null?void 0:Ut.call(K).bar)??6,Vt=Math.max(0,mv*qe),Ye=((hs=K.getOffsetRightDistance)==null?void 0:hs.call(K))??0,Ps=Math.max(Vt,Ye);typeof K.setMaxOffsetRightDistance=="function"&&Math.abs(Ps-Re.maxPx)>.5&&(K.setMaxOffsetRightDistance(Ps),Re.maxPx=Ps),Ye+.5<Vt&&typeof K.setOffsetRightDistance=="function"&&Math.abs(Vt-Re.offsetPx)>.5&&(K.setOffsetRightDistance(Vt,!0),Re.offsetPx=Vt,Re.lastAppliedTs=ht)})();const zn=Ci?{left:0,top:0,width:Ci.width,height:Ci.height}:void 0;J.save(),zn&&(J.beginPath(),J.rect(0,0,zn.width,zn.height),J.clip());const qn=Array.isArray(Ac.__runtimeBoxDefs)?Ac.__runtimeBoxDefs:[],ua=Array.isArray(Ac.__runtimePolylineDefs)?Ac.__runtimePolylineDefs:[],oa=Array.isArray(Ac.__runtimePolygonDefs)?Ac.__runtimePolygonDefs:[],So=Array.isArray(Ac.__runtimePathDefs)?Ac.__runtimePathDefs:[],dr=Array.isArray(Ac.__runtimeLineFills)?Ac.__runtimeLineFills:[],Zl=Array.isArray(Ac.__runtimeLineDefs)?Ac.__runtimeLineDefs:[],Aa=Array.isArray(Ac.__runtimeTables)?Ac.__runtimeTables:[],Za=Array.isArray(bc)?bc:[],Va=Array.isArray(Ac.__lineDefs)?Ac.__lineDefs:[],da=Array.isArray(Ac.__labelItems)?Ac.__labelItems:[],k=Ac.__tsIndex||{},N=Array.isArray(Ac.__timeSeriesMs)?Ac.__timeSeriesMs:[];let R=0;if(N.length>=2){let K=0;for(let ht=1;ht<N.length;(ht+=1)-1)K+=Math.abs(N[ht]-N[ht-1]);R=K/(N.length-1)}const F=Bu.length,z=(K,ht)=>{const qe=typeof K=="string"?K.trim().toLowerCase():"";return qe==="background"||qe==="bg"?"background":qe==="main"||qe==="base"?"main":qe==="overlay"||qe==="over"?"overlay":qe==="ui"?"ui":ht},q=(K,ht)=>{if(typeof K=="number"&&Number.isFinite(K))return K;if(typeof K=="string"){const qe=Number(K);if(Number.isFinite(qe))return qe}return ht},he=K=>{const ht=String(K||"").trim().toLowerCase();return ht?ht.replace(/[^a-z0-9_-]+/g,"_"):"script"},Ee={box:"background",line:"background",linefill:"background",label:"background",table:"ui",lineSegment:"background",polyline:"background",polygon:"background",path:"background"},lt={box:10,lineSegment:20,linefill:30,line:40,label:50,table:60,polyline:25,polygon:15,path:27},Qt=dh&&Bg(),Zs=`${he((ms==null?void 0:ms.__scriptSource)??(Ac==null?void 0:Ac.__scriptSource)??(Vp==null?void 0:Vp.source))}:${(ms==null?void 0:ms.name)??"runtime"}:${(ms==null?void 0:ms.paneId)??"pane"}`,xs=typeof(Ci==null?void 0:Ci.left)=="number"&&Number.isFinite(Ci.left)?Ci.left:0,Un=typeof(Ci==null?void 0:Ci.top)=="number"&&Number.isFinite(Ci.top)?Ci.top:0,jo={x:xs,y:Un},Lc=vc(),Id=(ms==null?void 0:ms.paneId)??"candle_pane",sf=Lc[Id]||Lc.candle_pane,au=sf&&Number.isFinite(sf.width)&&Number.isFinite(sf.height)?{left:sf.left,top:sf.top,width:sf.width,height:sf.height}:Ci&&Number.isFinite(Ci.width)&&Number.isFinite(Ci.height)?{left:xs,top:Un,width:Ci.width,height:Ci.height}:null,Wd=au&&Number.isFinite(au.left)?au.left:xs,ud=au&&Number.isFinite(au.top)?au.top:Un,Hd=!!(te!=null&&te.isWebgl&&pe&&au),dd=[],Rd=K=>Hd?(dd.push(K),!0):!1,Ou=K=>K?Rd(K):!1;if(te&&le&&au){if(Za.length){const K=_u({runtimeHeatmaps:Za,bounds:au,xAxis:xi,yAxis:ko,offsetX:au.left,offsetY:au.top,drawConfigMeta:Vp,len:F,tsIndex:k,timeSeriesMs:N,avgIntervalMs:R});K.length&&Oe.push({bounds:au,heatmaps:K})}ol()}const Pd=(Ll=cf==null?void 0:cf.getChartStore)==null?void 0:Ll.call(cf),Rr=dh&&typeof(xi==null?void 0:xi.convertFromPixel)=="function"&&typeof(ko==null?void 0:ko.convertFromPixel)=="function"?{toIndex:K=>typeof(Pd==null?void 0:Pd.coordinateToFloatIndex)=="function"?Pd.coordinateToFloatIndex(K):xi.convertFromPixel(K),toValue:K=>ko.convertFromPixel(K),toX:K=>typeof(Pd==null?void 0:Pd.dataIndexToCoordinate)=="function"?Pd.dataIndexToCoordinate(K):xi.convertToPixel(K),toY:K=>ko.convertToPixel(K)}:null,Wa=dh?(()=>{var ct,Ut;const K=Number((Ut=(ct=cf==null?void 0:cf.getSymbol)==null?void 0:ct.call(cf))==null?void 0:Ut.pricePrecision),ht=Number.isFinite(K)?K:w_(n().symbol);if(Number.isFinite(ht)&&ht>=0)return Math.pow(10,-Math.max(0,ht));const qe=typeof(ko==null?void 0:ko.getRange)=="function"?ko.getRange():null,Vt=Number(qe==null?void 0:qe.from),Ye=Number(qe==null?void 0:qe.to);if(!Number.isFinite(Vt)||!Number.isFinite(Ye)||Vt===Ye)return Number.NaN;const vs=Math.abs(Ye-Vt)/40;if(!Number.isFinite(vs)||vs<=0)return Number.NaN;const ps=Math.pow(10,Math.floor(Math.log10(vs))),as=vs/ps;let Zt=1;return as>5?Zt=10:as>2?Zt=5:as>1&&(Zt=2),Zt*ps})():Number.NaN,Wo=dh&&Rr?{timeStep:1,priceStep:Number.isFinite(Wa)&&Wa>0?Wa:Number.NaN}:null,ji=[],Jl=new Map,zr=[],dc=8,Jc=dc/2,Vr={n:"ns-resize",s:"ns-resize",e:"ew-resize",w:"ew-resize",ne:"nesw-resize",sw:"nesw-resize",nw:"nwse-resize",se:"nwse-resize"},ml=12,Bc=()=>(u0+=1)-1,Ja=K=>{var qe;const ht=(K==null?void 0:K.id)??((qe=K==null?void 0:K.meta)==null?void 0:qe.id)??(K==null?void 0:K.name)??(K==null?void 0:K.key);return ht!=null&&String(ht).trim()?String(ht):null},xc=K=>{const ht=Ja(K.payload);return ht?`${Zs}:${ht}`:`${Zs}:${K.kind}:${K.createdAt}`},lu=K=>{const ht=Ja(K);return ht?`${Zs}:${ht}`:null},fa=K=>{if(!dh)return null;const ht=j0(K);return ht||null},fc=K=>{const ht=K==null?void 0:K.box;return ht&&Number.isFinite(ht.leftIndex)&&Number.isFinite(ht.rightIndex)&&Number.isFinite(ht.topValue)&&Number.isFinite(ht.bottomValue)?ht:null},cu=K=>{const ht=K==null?void 0:K.label;return ht&&Number.isFinite(ht.index)&&Number.isFinite(ht.value)?ht:null},Sa=K=>{const ht=K==null?void 0:K.translate;if(ht&&Number.isFinite(ht.dxIndex)&&Number.isFinite(ht.dyValue)){const qe=Number(ht.dxIndex),Vt=Number(ht.dyValue);if(qe!==0||Vt!==0)return{dxIndex:qe,dyValue:Vt}}return null},vl=Number.isFinite(Vp==null?void 0:Vp.decimationPx)&&Number(Vp.decimationPx)>0?Math.floor(Number(Vp.decimationPx)):Ld.decimationPx,pc=(K,ht)=>ht<ui-2||K>_d+2,ya=K=>({x:xi.convertToPixel(K.index),y:ko.convertToPixel(K.value)}),Ur=(K,ht)=>{if(!ht)return K;const qe=Sa(fa(ht));return qe?{index:K.index+qe.dxIndex,value:K.value+qe.dyValue}:K},Wl=(K,ht)=>{if(!ht)return K;const qe=Sa(fa(ht));return qe?K.map(Vt=>({index:Vt.index+qe.dxIndex,value:Vt.value+qe.dyValue})):K},pa=(K,ht)=>{if(!ht)return K;const qe=Sa(fa(ht));if(!qe)return K;const Vt=qe.dxIndex,Ye=qe.dyValue,Ps=Number(K==null?void 0:K.slope),vs=Number.isFinite(Ps)&&Number.isFinite(K==null?void 0:K.intercept)?Number(K.intercept)+Ye-Ps*Vt:K==null?void 0:K.intercept;return{...K,startIndex:Number(K.startIndex)+Vt,endIndex:Number(K.endIndex)+Vt,startValue:Number(K.startValue)+Ye,endValue:Number(K.endValue)+Ye,intercept:vs}},Bi=(K,ht)=>{if(!(K!=null&&K.points)||K.points.length<2)return;const qe=Wl(K.points,ht),Vt=Math.min(...qe.map(us=>us.index)),Ye=Math.max(...qe.map(us=>us.index));if(pc(Vt,Ye))return;const Ps=vl>1?Zb(qe,ya,vl):qe;if(!Ps.length)return;J.save(),J.beginPath();let vs=!0,ps=Number.POSITIVE_INFINITY,as=Number.NEGATIVE_INFINITY,Zt=Number.POSITIVE_INFINITY,ct=Number.NEGATIVE_INFINITY;for(const us of Ps){const{x:ds,y:os}=ya(us);!Number.isFinite(ds)||!Number.isFinite(os)||(vs?(J.moveTo(ds,os),vs=!1):J.lineTo(ds,os),ds<ps&&(ps=ds),ds>as&&(as=ds),os<Zt&&(Zt=os),os>ct&&(ct=os))}if(vs){J.restore();return}const Ut=typeof K.opacity=="number"?Math.max(0,Math.min(1,K.opacity)):1,hs=K.width??2,Is=Number.isFinite(K.glow)?K.glow:0,cs=Number.isFinite(K.glowOpacity)?Math.max(0,Math.min(1,K.glowOpacity)):.35;if(Is>0&&(J.save(),J.strokeStyle=K.glowColor||K.color||"#e2e8f0",J.globalAlpha=Ut*cs,J.lineWidth=hs+Is,J.setLineDash([]),J.stroke(),J.restore()),K.gradient&&(K.gradient.from||K.gradient.to)){const us=Rh(J,{minX:Number.isFinite(ps)?ps:0,maxX:Number.isFinite(as)&&as!==ps?as:Number.isFinite(ps)?ps+1:1,minY:Number.isFinite(Zt)?Zt:0,maxY:Number.isFinite(ct)&&ct!==Zt?ct:Number.isFinite(Zt)?Zt+1:1},K.gradient,K.color||"#e2e8f0");J.strokeStyle=us??(K.color||"#e2e8f0")}else J.strokeStyle=K.color||"#e2e8f0";J.globalAlpha=Ut,J.lineWidth=hs;const Ms=String(K.style||"solid").toLowerCase();Ms==="dashed"?J.setLineDash([6,4]):Ms==="dotted"?J.setLineDash([2,2]):J.setLineDash([]),J.stroke(),J.setLineDash([]),J.globalAlpha=1,J.restore()},wc=(K,ht)=>{if(!(K!=null&&K.points)||K.points.length<3)return;const qe=Wl(K.points,ht),Vt=Math.min(...qe.map(Is=>Is.index)),Ye=Math.max(...qe.map(Is=>Is.index));if(pc(Vt,Ye))return;const Ps=vl>1?Zb(qe,ya,vl):qe;if(Ps.length<3)return;J.save(),J.beginPath();let vs=!0,ps=Number.POSITIVE_INFINITY,as=Number.NEGATIVE_INFINITY,Zt=Number.POSITIVE_INFINITY,ct=Number.NEGATIVE_INFINITY;for(const Is of Ps){const{x:cs,y:Ms}=ya(Is);!Number.isFinite(cs)||!Number.isFinite(Ms)||(vs?(J.moveTo(cs,Ms),vs=!1):J.lineTo(cs,Ms),cs<ps&&(ps=cs),cs>as&&(as=cs),Ms<Zt&&(Zt=Ms),Ms>ct&&(ct=Ms))}J.closePath();const Ut=typeof K.opacity=="number"?Math.max(0,Math.min(1,K.opacity)):1;J.globalAlpha=Ut;const hs=K.fillGradient;if(hs&&(hs.from||hs.to)){const Is=hs.from||K.fillColor||"#38bdf8",cs=hs.to||K.fillColor||Is,Ms=String(hs.mode||"vertical").toLowerCase(),us=Number.isFinite(ps)?ps:0,ds=Number.isFinite(as)&&as!==ps?as:us+1,os=Number.isFinite(Zt)?Zt:0,In=Number.isFinite(ct)&&ct!==Zt?ct:os+1;let Lo;if(Ms==="horizontal")Lo=J.createLinearGradient(us,os,ds,os);else if(Ms==="radial"){const _n=(us+ds)/2,sn=(os+In)/2,Ao=Math.max(ds-us,In-os)/2;Lo=J.createRadialGradient(_n,sn,0,_n,sn,Math.max(1,Ao))}else Lo=J.createLinearGradient(us,os,us,In);Lo.addColorStop(0,Is),Lo.addColorStop(1,cs),J.fillStyle=Lo,J.fill()}else K.fillColor&&(J.fillStyle=K.fillColor,J.fill());if(K.strokeColor||K.strokeWidth){const Is=K.strokeWidth??1,cs=Number.isFinite(K.glow)?K.glow:0,Ms=Number.isFinite(K.glowOpacity)?Math.max(0,Math.min(1,K.glowOpacity)):.35;cs>0&&(J.save(),J.strokeStyle=K.glowColor||K.strokeColor||K.fillColor||"#e2e8f0",J.globalAlpha=Ut*Ms,J.lineWidth=Is+cs,J.setLineDash([]),J.stroke(),J.restore()),J.strokeStyle=K.strokeColor||"#e2e8f0",J.lineWidth=Is;const us=String(K.strokeStyle||"solid").toLowerCase();us==="dashed"?J.setLineDash([6,4]):us==="dotted"?J.setLineDash([2,2]):J.setLineDash([]),J.stroke(),J.setLineDash([])}J.globalAlpha=1,J.restore()},nr=(K,ht)=>{if(!(K!=null&&K.commands)||!K.commands.length)return;const qe=K.commands.map(Ms=>Ur({index:Ms.index,value:Ms.value},ht)),Vt=Math.min(...qe.map(Ms=>Ms.index)),Ye=Math.max(...qe.map(Ms=>Ms.index));if(pc(Vt,Ye))return;J.save(),J.beginPath();let Ps=!1,vs=Number.POSITIVE_INFINITY,ps=Number.NEGATIVE_INFINITY,as=Number.POSITIVE_INFINITY,Zt=Number.NEGATIVE_INFINITY;for(let Ms=0;Ms<K.commands.length;(Ms+=1)-1){const us=K.commands[Ms],ds=qe[Ms],os=xi.convertToPixel(ds.index),In=ko.convertToPixel(ds.value);!Number.isFinite(os)||!Number.isFinite(In)||(us.cmd==="M"?(J.moveTo(os,In),Ps=!0):us.cmd==="L"&&(J.lineTo(os,In),Ps=!0),os<vs&&(vs=os),os>ps&&(ps=os),In<as&&(as=In),In>Zt&&(Zt=In))}if(!Ps){J.restore();return}const ct=typeof K.opacity=="number"?Math.max(0,Math.min(1,K.opacity)):1,Ut=K.width??2,hs=Number.isFinite(K.glow)?K.glow:0,Is=Number.isFinite(K.glowOpacity)?Math.max(0,Math.min(1,K.glowOpacity)):.35;if(hs>0&&(J.save(),J.strokeStyle=K.glowColor||K.color||"#e2e8f0",J.globalAlpha=ct*Is,J.lineWidth=Ut+hs,J.setLineDash([]),J.stroke(),J.restore()),K.gradient&&(K.gradient.from||K.gradient.to)){const Ms=Rh(J,{minX:Number.isFinite(vs)?vs:0,maxX:Number.isFinite(ps)&&ps!==vs?ps:Number.isFinite(vs)?vs+1:1,minY:Number.isFinite(as)?as:0,maxY:Number.isFinite(Zt)&&Zt!==as?Zt:Number.isFinite(as)?as+1:1},K.gradient,K.color||"#e2e8f0");J.strokeStyle=Ms??(K.color||"#e2e8f0")}else J.strokeStyle=K.color||"#e2e8f0";J.lineWidth=Ut;const cs=String(K.style||"solid").toLowerCase();cs==="dashed"?J.setLineDash([6,4]):cs==="dotted"?J.setLineDash([2,2]):J.setLineDash([]),J.globalAlpha=ct,J.stroke(),J.setLineDash([]),J.globalAlpha=1,J.restore()},Ca=(K,ht)=>{if(!(K!=null&&K.points)||K.points.length<2)return[];const qe=Wl(K.points,ht),Vt=Math.min(...qe.map(as=>as.index)),Ye=Math.max(...qe.map(as=>as.index));if(pc(Vt,Ye))return[];const Ps=vl>1?Zb(qe,ya,vl):qe,vs=[];let ps=null;for(const as of Ps){const{x:Zt,y:ct}=ya(as);if(!Number.isFinite(Zt)||!Number.isFinite(ct))continue;const Ut={x:Zt+xs,y:ct+Un};ps&&vs.push({a:ps,b:Ut}),ps=Ut}return vs},Cl=(K,ht)=>{if(!(K!=null&&K.commands)||!K.commands.length)return[];const qe=K.commands.map(ps=>Ur({index:ps.index,value:ps.value},ht)),Vt=Math.min(...qe.map(ps=>ps.index)),Ye=Math.max(...qe.map(ps=>ps.index));if(pc(Vt,Ye))return[];const Ps=[];let vs=null;for(let ps=0;ps<K.commands.length;(ps+=1)-1){const as=K.commands[ps],Zt=qe[ps],ct=xi.convertToPixel(Zt.index),Ut=ko.convertToPixel(Zt.value);if(!Number.isFinite(ct)||!Number.isFinite(Ut))continue;const hs={x:ct+xs,y:Ut+Un};as.cmd==="M"?vs=hs:as.cmd==="L"&&(vs&&Ps.push({a:vs,b:hs}),vs=hs)}return Ps},Qa=(K,ht)=>{if(!(K!=null&&K.points)||K.points.length<3)return[];const qe=Wl(K.points,ht),Vt=Math.min(...qe.map(vs=>vs.index)),Ye=Math.max(...qe.map(vs=>vs.index));if(pc(Vt,Ye))return[];const Ps=[];for(const vs of qe){const ps=xi.convertToPixel(vs.index),as=ko.convertToPixel(vs.value);!Number.isFinite(ps)||!Number.isFinite(as)||Ps.push({x:ps+xs,y:as+Un})}return Ps},el={background:[],main:[],overlay:[],ui:[]};let Zi=0;const Ki=(K,ht,qe,Vt)=>{const Ye=z(ht,Ee[K]),Ps=q(qe,lt[K]),vs={kind:K,layer:Ye,zIndex:Ps,createdAt:(Zi+=1)-1,payload:Vt};if(dh&&K!=="table"&&(i(sc)||i(Xf))){const ps=xc(vs);(ps===i(sc)||ps===i(Xf))&&(vs.layer="overlay",vs.zIndex=Math.max(vs.zIndex,1e5))}el[vs.layer].push(vs)};if(qn.length)for(const K of qn)K&&Ki("box",K.layer,K.zIndex,K);if(oa.length)for(const K of oa)K&&Ki("polygon",K.layer,K.zIndex,K);if(ua.length)for(const K of ua)K&&Ki("polyline",K.layer,K.zIndex,K);if(So.length)for(const K of So)K&&Ki("path",K.layer,K.zIndex,K);if(Va.length)for(const K of Va)K&&Ki("lineSegment",K.layer,K.zIndex,K);if(dr.length)for(const K of dr)K&&Ki("linefill",K.layer,K.zIndex,K);if(Zl.length)for(const K of Zl)K&&Ki("line",K.layer,K.zIndex,K);if(i(Bo)&&da.length)for(const K of da){const ht=K==null?void 0:K.meta;ht&&Ki("label",ht.layer,ht.zIndex,K)}if(Aa.length)for(const K of Aa)K&&Ki("table",K.layer,K.zIndex,K);if(Qt&&rh>=0){let K=th.get(Zs);if(!K||!Number.isFinite(K.leftA)||!Number.isFinite(K.rightA)||K.rightA>rh||K.rightB>rh){const ht=typeof(ko==null?void 0:ko.getRange)=="function"?ko.getRange():null,qe=Number(ht==null?void 0:ht.from),Vt=Number(ht==null?void 0:ht.to);if(Number.isFinite(qe)&&Number.isFinite(Vt)&&qe!==Vt){const Ye=Math.min(qe,Vt),Ps=Math.max(qe,Vt),vs=Math.max(1e-6,Ps-Ye),ps=Ps-vs*.25,as=Ps-vs*.45,Zt=(ps+as)/2,ct=Math.max(0,Math.floor((ui+_d)/2)),Ut=Math.max(0,ct-6),hs=Math.max(0,ct+6),Is=Math.max(0,ct-3),cs=Math.max(0,ct+9);K={leftA:Ut,rightA:hs,leftB:Is,rightB:cs,topValue:ps,bottomValue:as,labelValue:Zt,midIndex:ct},th.set(Zs,K)}}K&&(Ki("box","overlay",10,{id:"interaction_debug_box_a",leftIndex:K.leftA,rightIndex:K.rightA,topValue:K.topValue,bottomValue:K.bottomValue,borderColor:"rgba(59,130,246,0.9)",bgColor:"rgba(59,130,246,0.08)"}),Ki("box","overlay",10,{id:"interaction_debug_box_b",leftIndex:K.leftB,rightIndex:K.rightB,topValue:K.topValue,bottomValue:K.bottomValue,borderColor:"rgba(16,185,129,0.9)",bgColor:"rgba(16,185,129,0.08)"}),Ki("label","overlay",20,{index:K.midIndex,meta:{id:"interaction_debug_label_top",text:"TOP",value:K.labelValue,position:"above",shape:"label",size:12,color:"#f97316",textColor:"#0f172a",textAlign:"center",layer:"overlay",zIndex:20}}))}const Ii=K=>{let ht=K.leftIndex,qe=K.rightIndex;if(ae){const Ps=Math.max(0,F-1),vs=Number.isFinite(ui)?ui:ht,ps=Number.isFinite(_d)?_d:qe,as=Math.max(0,Math.min(vs,ps)),Zt=Math.min(Ps,Math.max(vs,ps)),ct=xk({baseLeft:ht,baseRight:qe,extend:K.extend,vpLeft:as,vpRight:Zt,lastIndex:Ps});ct&&(ht=ct.leftExt,qe=ct.rightExt)}else K.extend==="both"?(ht=0,qe=Math.max(0,F-1)):K.extend==="left"?ht=0:K.extend==="right"&&(qe=Math.max(0,F-1));const Vt=K.topValue,Ye=K.bottomValue;return!Number.isFinite(ht)||!Number.isFinite(qe)||!Number.isFinite(Vt)||!Number.isFinite(Ye)?null:{leftIndex:ht,rightIndex:qe,topValue:Vt,bottomValue:Ye}},Zo=(K,ht)=>{const qe=Ii(K);if(!qe)return null;const Vt=ht?fa(ht):null;return fc(Vt)??qe},ha=(K,ht)=>{const qe=ht?fa(ht):null,Vt=Ii(K);if(!Vt)return null;const Ye=fc(qe)??Vt;let Ps=xi.convertToPixel(Ye.leftIndex),vs=xi.convertToPixel(Ye.rightIndex),ps=ko.convertToPixel(Ye.topValue),as=ko.convertToPixel(Ye.bottomValue);return!Number.isFinite(Ps)||!Number.isFinite(vs)||!Number.isFinite(ps)||!Number.isFinite(as)?null:{x1:Ps,x2:vs,y1:ps,y2:as}},al=(K,ht)=>{const qe=ha(K,ht);if(!qe)return;const Vt=Math.min(qe.x1,qe.x2),Ye=Math.min(qe.y1,qe.y2),Ps=Math.abs(qe.x2-qe.x1),vs=Math.abs(qe.y2-qe.y1);if(ae){const as=Sd(K);as.bgColor&&(J.fillStyle=as.bgColor,J.fillRect(Vt,Ye,Ps,vs)),as.borderWidth>0&&as.borderColor&&(J.strokeStyle=as.borderColor,J.lineWidth=as.borderWidth,J.setLineDash(as.dash),J.lineDashOffset=as.dashOffset,J.strokeRect(Vt,Ye,Ps,vs),J.setLineDash([]),J.lineDashOffset=0);const Zt=String(as.textFinal||"");if(Zt){const ct=as.fontPx,Ut=as.padX,hs=as.padY,Is=Math.max(0,Ps-Ut*2),cs=Math.max(0,vs-hs*2);if(Is<=0||cs<=0)return;J.save(),J.beginPath(),J.rect(Vt+Ut,Ye+hs,Is,cs),J.clip(),J.font=`${ct}px "Inter", system-ui, -apple-system, sans-serif`,J.fillStyle=as.textColor||as.borderColor||"#e2e8f0";const Ms=as.textHalign==="left"||as.textHalign==="right"?as.textHalign:"center";J.textAlign=Ms,J.textBaseline="top";const us=Math.max(12,ct+2),ds=Math.max(0,cs);let os=Ye+hs;as.textValign==="middle"?os=Ye+hs+(ds-us)/2:as.textValign==="bottom"&&(os=Ye+hs+ds-us);let In=Vt+Ut+Is/2;Ms==="left"&&(In=Vt+Ut),Ms==="right"&&(In=Vt+Ut+Is),J.fillText(Zt,In,os),J.restore()}return}const ps=K.bgGradient??K.gradient;if(ps&&(ps.from||ps.to)){const as=Rh(J,{minX:Vt,maxX:Vt+Ps,minY:Ye,maxY:Ye+vs},ps,K.bgColor||"#0f172a");J.fillStyle=as??(K.bgColor||"#0f172a"),J.fillRect(Vt,Ye,Ps,vs)}else K.bgColor&&(J.fillStyle=K.bgColor,J.fillRect(Vt,Ye,Ps,vs));if(K.borderColor||K.borderWidth){J.strokeStyle=K.borderColor||"#64748b",J.lineWidth=K.borderWidth??1;const as=String(K.borderStyle||"solid").toLowerCase();as==="dashed"?J.setLineDash([6,4]):as==="dotted"?J.setLineDash([2,2]):J.setLineDash([]),J.strokeRect(Vt,Ye,Ps,vs),J.setLineDash([])}if(K.text){const as=String(K.text||"");if(as){const Zt=typeof K.textSize=="number"&&K.textSize>0?K.textSize:12,ct=6,Ut=Math.max(0,Ps-ct*2);J.save(),J.font=`${Zt}px "Inter", system-ui, -apple-system, sans-serif`,J.fillStyle=K.textColor||K.borderColor||"#e2e8f0";const hs=K.textHalign==="left"||K.textHalign==="right"?K.textHalign:"center";J.textAlign=hs,J.textBaseline="top";const Is=K.textWrap===!0,cs=as.split(/\n/),Ms=[];if(Is&&Ut>0)for(const _n of cs){const sn=_n.split(/\s+/).filter(Boolean);let Ao="";const Qo=()=>{Ao&&(Ms.push(Ao),Ao="")},wi=Do=>{if(!Do)return;if(J.measureText(Do).width>Ut&&Ut>4){Qo();let Bn="";for(const gi of Do){const wo=Bn+gi;J.measureText(wo).width>Ut&&Bn?(Ms.push(Bn),Bn=gi):Bn=wo}Bn&&Ms.push(Bn);return}const Io=Ao?`${Ao} ${Do}`:Do;J.measureText(Io).width>Ut&&Ao?(Qo(),Ao=Do):Ao=Io};for(const Do of sn)wi(Do);Qo()}else for(const _n of cs)Ms.push(_n);const us=Math.max(12,Zt+2),ds=Math.max(1,Math.floor(Math.max(0,vs-ct*2)/us));if(Ms.length>ds){Ms.length=ds;const _n="...";let sn=Ms[ds-1]||"";if(Ut>0)for(;sn&&J.measureText(`${sn}${_n}`).width>Ut;)sn=sn.slice(0,-1);Ms[ds-1]=sn?`${sn}${_n}`:_n}const os=Ms.length*us;let In=Ye+ct;K.textValign==="middle"||K.textValign==="center"?In=Ye+(vs-os)/2:K.textValign==="bottom"&&(In=Ye+vs-ct-os);let Lo=Vt+Ps/2;hs==="left"&&(Lo=Vt+ct),hs==="right"&&(Lo=Vt+Ps-ct);for(let _n=0;_n<Ms.length;(_n+=1)-1)J.fillText(Ms[_n],Lo,In+_n*us);J.restore()}}},Pi=(K,ht,qe,Vt,Ye,Ps)=>{const vs=Math.atan2(Vt-ht,qe-K),ps=Math.max(6,Ye),as=vs+Math.PI-Math.PI/6,Zt=vs+Math.PI+Math.PI/6,ct=qe+ps*Math.cos(as),Ut=Vt+ps*Math.sin(as),hs=qe+ps*Math.cos(Zt),Is=Vt+ps*Math.sin(Zt);J.beginPath(),J.moveTo(qe,Vt),J.lineTo(ct,Ut),J.lineTo(hs,Is),J.closePath(),J.fillStyle=Ps,J.fill()},Ar=(K,ht)=>{const qe=pa(K,ht);let Vt=NaN,Ye=NaN,Ps=NaN,vs=NaN;if(qe.strictExtend){const cs=typeof ko.getRange=="function"?ko.getRange():null,Ms=cy({startIndex:qe.startIndex,endIndex:qe.endIndex,startValue:qe.startValue,endValue:qe.endValue,slope:qe.slope,intercept:qe.intercept,extend:qe.extend,fromIndex:ui,toIndex:_d,yRange:cs,toX:us=>xi.convertToPixel(us),toY:us=>ko.convertToPixel(us)});if(!Ms)return;Vt=Ms.extended.x1,Ye=Ms.extended.y1,Ps=Ms.extended.x2,vs=Ms.extended.y2}else{let cs=qe.startIndex,Ms=qe.endIndex;qe.extend==="both"?(cs=0,Ms=Math.max(0,F-1)):qe.extend==="left"?cs=0:qe.extend==="right"&&(Ms=Math.max(0,F-1));const us=Number.isFinite(qe.slope)&&Number.isFinite(qe.intercept)?qe.slope*cs+qe.intercept:qe.startValue,ds=Number.isFinite(qe.slope)&&Number.isFinite(qe.intercept)?qe.slope*Ms+qe.intercept:qe.endValue;Vt=xi.convertToPixel(cs),Ye=ko.convertToPixel(us),Ps=xi.convertToPixel(Ms),vs=ko.convertToPixel(ds)}if(!Number.isFinite(Vt)||!Number.isFinite(Ye)||!Number.isFinite(Ps)||!Number.isFinite(vs))return;J.beginPath(),J.moveTo(Vt,Ye),J.lineTo(Ps,vs);const ps=typeof qe.opacity=="number"?Math.max(0,Math.min(1,qe.opacity)):1,as=qe.width??2,Zt=Number.isFinite(qe.glow)?qe.glow:0,ct=Number.isFinite(qe.glowOpacity)?Math.max(0,Math.min(1,qe.glowOpacity)):.35;if(Zt>0&&(J.save(),J.strokeStyle=qe.glowColor||qe.color||"#22c55e",J.globalAlpha=ps*ct,J.lineWidth=as+Zt,J.setLineDash([]),J.stroke(),J.restore()),qe.gradient&&(qe.gradient.from||qe.gradient.to)){const cs=Rh(J,{minX:Math.min(Vt,Ps),maxX:Math.max(Vt,Ps),minY:Math.min(Ye,vs),maxY:Math.max(Ye,vs)},qe.gradient,qe.color||"#22c55e");J.strokeStyle=cs??(qe.color||"#22c55e")}else J.strokeStyle=qe.color||"#22c55e";J.globalAlpha=ps,J.lineWidth=as;const Ut=(qe.style||"solid").toLowerCase(),hs=Ut.includes("arrow"),Is=hs?"solid":Ut;if(qe.strictExtend){const cs=wk(Is,qe.width??2);J.setLineDash(cs),J.lineDashOffset=0}else Is==="dashed"?J.setLineDash([6,4]):Is==="dotted"?J.setLineDash([2,2]):J.setLineDash([]);if(J.stroke(),J.setLineDash([]),J.globalAlpha=1,hs){const cs=Math.max(6,(qe.width??2)*2.5),Ms=qe.color||"#22c55e";(Ut.includes("left")||Ut.includes("both"))&&Pi(Ps,vs,Vt,Ye,cs,Ms),(Ut.includes("right")||Ut.includes("both"))&&Pi(Vt,Ye,Ps,vs,cs,Ms)}},ia=(K,ht)=>{const qe=pa(K,ht);let Vt=NaN,Ye=NaN,Ps=NaN,vs=NaN;if(qe.strictExtend){const ps=typeof ko.getRange=="function"?ko.getRange():null,as=cy({startIndex:qe.startIndex,endIndex:qe.endIndex,startValue:qe.startValue,endValue:qe.endValue,slope:qe.slope,intercept:qe.intercept,extend:qe.extend,fromIndex:ui,toIndex:_d,yRange:ps,toX:Zt=>xi.convertToPixel(Zt),toY:Zt=>ko.convertToPixel(Zt)});if(!as)return null;Vt=as.extended.x1,Ye=as.extended.y1,Ps=as.extended.x2,vs=as.extended.y2}else{let ps=qe.startIndex,as=qe.endIndex;qe.extend==="both"?(ps=0,as=Math.max(0,F-1)):qe.extend==="left"?ps=0:qe.extend==="right"&&(as=Math.max(0,F-1));const Zt=Number.isFinite(qe.slope)&&Number.isFinite(qe.intercept)?qe.slope*ps+qe.intercept:qe.startValue,ct=Number.isFinite(qe.slope)&&Number.isFinite(qe.intercept)?qe.slope*as+qe.intercept:qe.endValue;Vt=xi.convertToPixel(ps),Ye=ko.convertToPixel(Zt),Ps=xi.convertToPixel(as),vs=ko.convertToPixel(ct)}return!Number.isFinite(Vt)||!Number.isFinite(Ye)||!Number.isFinite(Ps)||!Number.isFinite(vs)?null:{a:{x:Vt+xs,y:Ye+Un},b:{x:Ps+xs,y:vs+Un}}},ma=K=>{let ht=Number(K==null?void 0:K.startIndex),qe=Number(K==null?void 0:K.endIndex);if(!Number.isFinite(ht)||!Number.isFinite(qe))return null;if(ht>qe){const Ye=ht;ht=qe,qe=Ye}const Vt=String((K==null?void 0:K.extend)||"").toLowerCase();return Vt==="both"?(ht=0,qe=Math.max(0,F-1)):Vt==="left"?ht=0:Vt==="right"&&(qe=Math.max(0,F-1)),{a:ht,b:qe}},jr=(K,ht)=>Number.isFinite(K==null?void 0:K.slope)&&Number.isFinite(K==null?void 0:K.intercept)?K.slope*ht+K.intercept:Number.isFinite(K==null?void 0:K.startValue)?K.startValue:Number.NaN,Ha=K=>{const ht=K==null?void 0:K.line1,qe=K==null?void 0:K.line2;if(!ht||!qe)return;const Vt=pa(ht,lu(ht)??void 0),Ye=pa(qe,lu(qe)??void 0),Ps=ma(Vt),vs=ma(Ye);if(!Ps||!vs)return;const ps=Math.max(ui,Ps.a,vs.a),as=Math.min(_d,Ps.b,vs.b);if(ps>as)return;const Zt=[],ct=[];for(let Ut=ps;Ut<=as;(Ut+=1)-1){const hs=jr(Vt,Ut),Is=jr(Ye,Ut);if(!Number.isFinite(hs)||!Number.isFinite(Is))continue;const cs=xi.convertToPixel(Ut),Ms=ko.convertToPixel(hs),us=ko.convertToPixel(Is);Zt.push({x:cs,y:Ms}),ct.push({x:cs,y:us})}Zt.length>1&&ct.length>1&&x2(J,Zt,ct,K.color||"rgba(59,130,246,0.15)",zn)},ll=(K,ht)=>{const qe=pa(K,ht),Vt=String((qe==null?void 0:qe.style)||"solid").toLowerCase();if(Vt.includes("arrow")||Number.isFinite(qe==null?void 0:qe.glow)&&qe.glow>0)return null;let Ye=NaN,Ps=NaN,vs=NaN,ps=NaN;if(qe.strictExtend){const as=typeof ko.getRange=="function"?ko.getRange():null,Zt=cy({startIndex:qe.startIndex,endIndex:qe.endIndex,startValue:qe.startValue,endValue:qe.endValue,slope:qe.slope,intercept:qe.intercept,extend:qe.extend,fromIndex:ui,toIndex:_d,yRange:as,toX:ct=>xi.convertToPixel(ct),toY:ct=>ko.convertToPixel(ct)});if(!Zt)return null;Ye=Zt.extended.x1,Ps=Zt.extended.y1,vs=Zt.extended.x2,ps=Zt.extended.y2}else{let as=qe.startIndex,Zt=qe.endIndex;qe.extend==="both"?(as=0,Zt=Math.max(0,F-1)):qe.extend==="left"?as=0:qe.extend==="right"&&(Zt=Math.max(0,F-1));const ct=Number.isFinite(qe.slope)&&Number.isFinite(qe.intercept)?qe.slope*as+qe.intercept:qe.startValue,Ut=Number.isFinite(qe.slope)&&Number.isFinite(qe.intercept)?qe.slope*Zt+qe.intercept:qe.endValue;Ye=xi.convertToPixel(as),Ps=ko.convertToPixel(ct),vs=xi.convertToPixel(Zt),ps=ko.convertToPixel(Ut)}return!Number.isFinite(Ye)||!Number.isFinite(Ps)||!Number.isFinite(vs)||!Number.isFinite(ps)?null:{kind:"line",points:[{x:Ye+Wd,y:Ps+ud},{x:vs+Wd,y:ps+ud}],color:qe.color,width:qe.width,glow:qe.glow,glowColor:qe.glowColor,glowOpacity:qe.glowOpacity,style:Vt,opacity:qe.opacity}},li=(K,ht)=>{if(Number.isFinite(K==null?void 0:K.glow)&&K.glow>0||!(K!=null&&K.points)||K.points.length<2)return null;const qe=Wl(K.points,ht),Vt=Math.min(...qe.map(vs=>vs.index));if(Math.max(...qe.map(vs=>vs.index))<ui-2||Vt>_d+2)return null;const Ps=[];for(const vs of qe){const ps=xi.convertToPixel(vs.index),as=ko.convertToPixel(vs.value);!Number.isFinite(ps)||!Number.isFinite(as)||Ps.push({x:ps+Wd,y:as+ud})}return Ps.length<2?null:{kind:"polyline",points:Ps,color:K.color,width:K.width,glow:K.glow,glowColor:K.glowColor,glowOpacity:K.glowOpacity,style:K.style,opacity:K.opacity}},wr=(K,ht)=>{if(Number.isFinite(K==null?void 0:K.glow)&&K.glow>0||!(K!=null&&K.points)||K.points.length<3)return null;const qe=Wl(K.points,ht),Vt=Math.min(...qe.map(vs=>vs.index));if(Math.max(...qe.map(vs=>vs.index))<ui-2||Vt>_d+2)return null;const Ps=[];for(const vs of qe){const ps=xi.convertToPixel(vs.index),as=ko.convertToPixel(vs.value);!Number.isFinite(ps)||!Number.isFinite(as)||Ps.push({x:ps+Wd,y:as+ud})}return Ps.length<3?null:{kind:"polygon",points:Ps,fillColor:K.fillColor,fillGradient:K.fillGradient,strokeColor:K.strokeColor,strokeWidth:K.strokeWidth,strokeStyle:K.strokeStyle,opacity:K.opacity,glow:K.glow,glowColor:K.glowColor,glowOpacity:K.glowOpacity}},Qr=(K,ht)=>{if(Number.isFinite(K==null?void 0:K.glow)&&K.glow>0||!(K!=null&&K.commands)||!K.commands.length)return null;const qe=[];for(const Vt of K.commands){const Ye=Ur({index:Vt.index,value:Vt.value},ht),Ps=xi.convertToPixel(Ye.index),vs=ko.convertToPixel(Ye.value);!Number.isFinite(Ps)||!Number.isFinite(vs)||(Vt.cmd==="M"||Vt.cmd==="L")&&qe.push({cmd:Vt.cmd,x:Ps+Wd,y:vs+ud})}return qe.length?{kind:"path",commands:qe,color:K.color,width:K.width,glow:K.glow,glowColor:K.glowColor,glowOpacity:K.glowOpacity,style:K.style,opacity:K.opacity}:null},ea=K=>{const ht=K==null?void 0:K.line1,qe=K==null?void 0:K.line2;if(!ht||!qe)return null;const Vt=pa(ht,lu(ht)??void 0),Ye=pa(qe,lu(qe)??void 0),Ps=ma(Vt),vs=ma(Ye);if(!Ps||!vs)return null;const ps=Math.max(ui,Ps.a,vs.a),as=Math.min(_d,Ps.b,vs.b);if(ps>as)return null;const Zt=[],ct=[];for(let hs=ps;hs<=as;(hs+=1)-1){const Is=jr(Vt,hs),cs=jr(Ye,hs);if(!Number.isFinite(Is)||!Number.isFinite(cs))continue;const Ms=xi.convertToPixel(hs),us=ko.convertToPixel(Is),ds=ko.convertToPixel(cs);!Number.isFinite(Ms)||!Number.isFinite(us)||!Number.isFinite(ds)||(Zt.push({x:Ms+Wd,y:us+ud}),ct.push({x:Ms+Wd,y:ds+ud}))}return Zt.length<2||ct.length<2?null:{kind:"polygon",points:Zt.concat(ct.reverse()),fillColor:K.color||"rgba(59,130,246,0.15)",fillGradient:K.fillGradient,opacity:K.opacity}},ja=(K,ht)=>{const qe=Number(K);if(Number.isFinite(qe))return{left:qe,right:qe,top:qe,bottom:qe};if(K&&typeof K=="object"){const Vt=K,Ye=Number(Vt.left),Ps=Number(Vt.right),vs=Number(Vt.top),ps=Number(Vt.bottom);return{left:Number.isFinite(Ye)?Ye:ht.left,right:Number.isFinite(Ps)?Ps:ht.right,top:Number.isFinite(vs)?vs:ht.top,bottom:Number.isFinite(ps)?ps:ht.bottom}}return ht},Ia=K=>{const ht=Number.isFinite(K==null?void 0:K.fontSize)&&Number(K.fontSize)>0?Number(K.fontSize):Number.isFinite(K==null?void 0:K.size)&&Number(K.size)>0?Number(K.size):12,qe=(K==null?void 0:K.fontFamily)||(K!=null&&K.monospace?'"SFMono-Regular", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace':'"Inter", system-ui, -apple-system, sans-serif');return{font:`${(K==null?void 0:K.fontWeight)||"600"} ${ht}px ${qe}`,size:ht}},Li=(K,ht,qe,Vt,Ye,Ps)=>{const vs=Math.max(0,Math.min(Ps,Math.min(Vt,Ye)/2));K.beginPath(),K.moveTo(ht+vs,qe),K.lineTo(ht+Vt-vs,qe),K.quadraticCurveTo(ht+Vt,qe,ht+Vt,qe+vs),K.lineTo(ht+Vt,qe+Ye-vs),K.quadraticCurveTo(ht+Vt,qe+Ye,ht+Vt-vs,qe+Ye),K.lineTo(ht+vs,qe+Ye),K.quadraticCurveTo(ht,qe+Ye,ht,qe+Ye-vs),K.lineTo(ht,qe+vs),K.quadraticCurveTo(ht,qe,ht+vs,qe),K.closePath()},Tr=(K,ht,qe)=>{if(!qe)return{index:K,value:ht};const Vt=fa(qe),Ye=cu(Vt);return Ye?{index:Ye.index,value:Ye.value}:{index:K,value:ht}},Il=8,va=K=>{var vs,ps,as,Zt,ct;const ht=typeof(K==null?void 0:K.getRange)=="function"?K.getRange():null,qe=typeof(K==null?void 0:K.getParent)=="function"?(ct=(Zt=(as=(ps=(vs=K.getParent())==null?void 0:vs.getYAxisWidget)==null?void 0:ps.call(vs))==null?void 0:as.getBounding)==null?void 0:Zt.call(as))==null?void 0:ct.height:0,Vt=ht&&Number.isFinite(ht.realRange)?Number(ht.realRange):ht&&Number.isFinite(ht.displayRange)?Number(ht.displayRange):null,Ye=Number.isFinite(qe)&&qe>0&&Vt!=null?Math.abs(Vt)/Math.max(1,qe):null;let Ps=null;if(Ye==null){const Ut=w_(n().symbol),hs=Math.max(0,Math.min(8,Math.trunc(Ut))),Is=Math.pow(10,-hs);Ps=Number.isFinite(Is)?Is:.01}return{padPx:Il,pricePerPixel:Ye,fallbackStep:Ps}},gr=typeof ko<"u"?ko:null,zo=va(gr),oi=(K,ht,qe)=>{if(!ae)return K;const Vt=typeof(qe==null?void 0:qe.convertToPixel)=="function"?qe.convertToPixel(K):NaN;if(Number.isFinite(Vt)&&typeof(qe==null?void 0:qe.convertFromPixel)=="function"){const Ye=Vt+(ht==="above"?-zo.padPx:zo.padPx),Ps=qe.convertFromPixel(Ye);if(Number.isFinite(Ps))return Ps}return zo.pricePerPixel!=null?K+(ht==="above"?zo.pricePerPixel:-zo.pricePerPixel)*zo.padPx:zo.fallbackStep!=null?K+(ht==="above"?zo.fallbackStep:-zo.fallbackStep):K},Lr=(K,ht)=>{const qe=K==null?void 0:K.ts,Vt=K==null?void 0:K.tsMs,Ye=K==null?void 0:K.meta;if(!Ye)return null;const Ps=(()=>{let ct;return typeof qe=="number"&&Number.isFinite(qe)&&(ct=k[String(qe)]),ct==null&&typeof Vt=="number"&&Number.isFinite(Vt)&&(ct=k[`${Math.floor(Vt)}_ms`]??k[`${Math.floor(Vt/1e3)}_s`]),typeof ct=="number"&&Number.isFinite(ct)?ct:K==null?void 0:K.index})();if(typeof Ps!="number"||!Number.isFinite(Ps))return null;const vs=Ye==null?void 0:Ye.value;if(vs==null)return null;const ps=typeof Ye.offset=="number"&&Number.isFinite(Ye.offset)?Math.trunc(Ye.offset):0,as=Tr(Ps+ps,Number(vs),ht);let Zt=as.value;return ae&&(Ye==null?void 0:Ye.yloc)==="abovebar"?Zt=oi(Zt,"above",gr):ae&&(Ye==null?void 0:Ye.yloc)==="belowbar"&&(Zt=oi(Zt,"below",gr)),{index:as.index,value:Zt}},kr=(K,ht,qe)=>{const Vt=typeof(K==null?void 0:K.offsetY)=="number"?K.offsetY:10,Ye=((K==null?void 0:K.position)||"above")==="above",Ps=typeof(K==null?void 0:K.size)=="number"&&K.size>0?K.size:12,vs=Ye?qe.above[ht]||0:qe.below[ht]||0,ps=Vt+vs*Math.max(6,Ps/3);return{isAbove:Ye,offset:ps,size:Ps}},or=(K,ht,qe)=>{qe?K.above[ht]=(K.above[ht]||0)+1:K.below[ht]=(K.below[ht]||0)+1},Hi=(K,ht,qe)=>{const Vt=K==null?void 0:K.meta;if(!Vt)return null;const Ye=Lr(K,qe);if(!Ye)return null;let Ps=Ye.index;const vs=Ye.value;if(_d>=0&&(Ps<ui||Ps>_d))return null;const ps=xi.convertToPixel(Ps);if(!Number.isFinite(ps))return null;let as=ko.convertToPixel(vs);if(!Number.isFinite(as))return null;const{isAbove:Zt,offset:ct,size:Ut}=kr(Vt,Ps,ht);Zt?as-=ct:as+=ct,or(ht,Ps,Zt);const hs=Ut/2;if(zn||Ci){const os=0+hs+2,In=((zn==null?void 0:zn.height)??Ci.height)-hs-2;as=Math.max(os,Math.min(In,as))}if(Vt.wrap===!0||Vt.maxWidth!=null||Vt.padding!=null||Vt.bgOpacity!=null||Vt.radius!=null||Vt.borderWidth!=null||Vt.align||Vt.valign||Vt.lineHeight!=null||Vt.fontFamily||Vt.fontSize!=null||Vt.fontWeight||Vt.monospace){const os=Ia(Vt),In=ja(Vt.padding,{left:8,right:8,top:6,bottom:6}),Lo=Vt.align||Vt.textAlign,_n=Lo==="left"||Lo==="right"?Lo:"center",sn=dy(String(Vt.text??""),{font:os.font,color:"#e2e8f0",maxWidth:Vt.maxWidth,wrap:Vt.wrap===!0||Vt.textWrap===!0,lineHeight:Vt.lineHeight,align:_n}),Ao=sn?{width:sn.width,height:sn.height}:m1({text:String(Vt.text??""),font:os.font,maxWidth:Vt.maxWidth,wrap:Vt.wrap===!0||Vt.textWrap===!0,lineHeight:Vt.lineHeight}),Qo=Math.ceil(Ao.width+In.left+In.right),wi=Math.ceil(Ao.height+In.top+In.bottom),Do=Vt.valign,ir=Do==="top"||Do==="middle"||Do==="bottom"?Do:Zt?"bottom":"top";let Io=ps;_n==="center"?Io=ps-Qo/2:_n==="right"&&(Io=ps-Qo);let Bn=as;if(ir==="middle"?Bn=as-wi/2:ir==="bottom"&&(Bn=as-wi),zn||Ci){const wo=((zn==null?void 0:zn.height)??Ci.height)-wi;Bn=Math.max(0,Math.min(wo,Bn))}return{x:Io+xs,y:Bn+Un,width:Qo,height:wi}}let cs=Ut,Ms=Ut;const us=String(Vt.shape||"").toLowerCase(),ds=String(Vt.text??"");if(ds&&(us==="text"||us==="emoji"||us==="label")){const os=Ia(Vt),In=m1({text:ds,font:os.font,maxWidth:Vt.maxWidth,wrap:Vt.wrap===!0||Vt.textWrap===!0,lineHeight:Vt.lineHeight});cs=Math.max(cs,Math.ceil(In.width)),Ms=Math.max(Ms,Math.ceil(In.height))}return{x:ps-cs/2+xs,y:as-Ms/2+Un,width:cs,height:Ms}},cl=(K,ht,qe,Vt)=>{J.font='12px "Inter", system-ui, -apple-system, sans-serif';const Ye=K==null?void 0:K.meta;if(!Ye)return;const Ps=Ye.textAlign==="left"||Ye.textAlign==="right"?Ye.textAlign:"center";J.textAlign=Ps;const vs=Lr(K,qe);if(!vs)return;let ps=vs.index;const as=vs.value;if(_d>=0&&(ps<ui||ps>_d))return;const Zt=xi.convertToPixel(ps);if(!Number.isFinite(Zt))return;let ct=ko.convertToPixel(as);if(!Number.isFinite(ct))return;const{isAbove:Ut,offset:hs,size:Is}=kr(Ye,ps,ht);if(Ut?(ct-=hs,J.textBaseline="bottom"):(ct+=hs,J.textBaseline="top"),or(ht,ps,Ut),qe&&(Vt!=null&&Vt.has(qe)))return;const cs=Is/2;if(zn||Ci){const Io=0+cs+2,Bn=((zn==null?void 0:zn.height)??Ci.height)-cs-2;ct=Math.max(Io,Math.min(Bn,ct))}if(Ye.wrap===!0||Ye.maxWidth!=null||Ye.padding!=null||Ye.bgOpacity!=null||Ye.radius!=null||Ye.borderWidth!=null||Ye.align||Ye.valign||Ye.lineHeight!=null||Ye.fontFamily||Ye.fontSize!=null||Ye.fontWeight||Ye.monospace||Ye.callout===!0){const Io=Ia(Ye),Bn=ja(Ye.padding,{left:8,right:8,top:6,bottom:6}),gi=Ye.align||Ye.textAlign,wo=gi==="left"||gi==="right"?gi:"center",Ei=String(Ye.shape||"").toLowerCase(),Ba=Ye.callout===!0||Ei==="callout"||Ei==="pill"||Ei==="label"||Ei==="tag"||Ei==="flag"||Ei==="box_gradient",Ta=Ye.callout===!0||Ei==="callout",Ji=Ye.textColor||(Ba?"#f8fafc":Ye.color||"#f97316"),Nu=!Ba,Pa=Ta?null:dy(String(Ye.text??""),{font:Io.font,color:Ji,maxWidth:Ye.maxWidth,wrap:Ye.wrap===!0||Ye.textWrap===!0,lineHeight:Ye.lineHeight,align:wo}),zu=Pa?{width:Pa.width,height:Pa.height,lineHeight:Pa.lineHeight}:m1({text:String(Ye.text??""),font:Io.font,maxWidth:Ye.maxWidth,wrap:Ye.wrap===!0||Ye.textWrap===!0,lineHeight:Ye.lineHeight}),Md=Math.ceil(zu.width+Bn.left+Bn.right),ta=Math.ceil(zu.height+Bn.top+Bn.bottom),uf=Ye.valign,Ku=uf==="top"||uf==="middle"||uf==="bottom"?uf:Ut?"bottom":"top";let pu=Zt;wo==="center"?pu=Zt-Md/2:wo==="right"&&(pu=Zt-Md);let kc=ct;Ku==="middle"?kc=ct-ta/2:Ku==="bottom"&&(kc=ct-ta);const Xu=Ye.callout===!0?Math.max(4,Math.round(ta/4)):0;if(zn||Ci){const df=0+(Ye.callout===!0&&!Ut?Xu:0),op=((zn==null?void 0:zn.height)??Ci.height)-ta-(Ye.callout===!0&&Ut?Xu:0);kc=Math.max(df,Math.min(op,kc))}const Nd=Ye!=null&&Ye.pineV2?Ye.bgColor||"rgba(0,0,0,0)":Ye.bgColor||Ye.color||"rgba(15,23,42,0.95)",Wr=(Ye==null?void 0:Ye.bgGradient)??(Ye==null?void 0:Ye.gradient),Au=Ye.bgOpacity!=null?Math.max(0,Math.min(1,Number(Ye.bgOpacity))):null,Tp=Ye!=null&&Ye.pineV2?Ye.borderColor||"rgba(0,0,0,0)":Ye.borderColor||"rgba(0,0,0,0.65)",yp=Ye.borderWidth!=null?Math.max(0,Number(Ye.borderWidth)):Ye!=null&&Ye.pineV2||Ba?0:1,Kp=Ye.radius!=null?Number(Ye.radius):String(Ye.shape||"").toLowerCase()==="pill"?ta/2:void 0,bp=Math.max(0,Kp??6),fh=J.globalAlpha;if(J.globalAlpha=typeof Ye.opacity=="number"?Math.max(0,Math.min(1,Ye.opacity)):1,J.save(),Li(J,pu,kc,Md,ta,bp),Nd||Wr&&(Wr.from||Wr.to)){const df=J.globalAlpha;if(Au!=null&&(J.globalAlpha=df*Au),Wr&&(Wr.from||Wr.to)){const op=Rh(J,{minX:pu,maxX:pu+Md,minY:kc,maxY:kc+ta},Wr,Nd||"#0f172a");J.fillStyle=op??Nd}else J.fillStyle=Nd;J.fill(),J.globalAlpha=df}if(yp>0&&(J.strokeStyle=Tp,J.lineWidth=yp,J.stroke()),Ye.callout===!0){const df=Math.max(4,Math.round(ta/4)),op=Zt,ph=Ut?kc+ta:kc,Ih=Ut?ph+df:ph-df;if(J.beginPath(),J.moveTo(op-df,ph),J.lineTo(op+df,ph),J.lineTo(op,Ih),J.closePath(),Wr&&(Wr.from||Wr.to)){const am=Rh(J,{minX:pu,maxX:pu+Md,minY:Math.min(kc,Ih),maxY:Math.max(kc+ta,Ih)},Wr,Nd||"#0f172a");J.fillStyle=am??Nd}else Nd&&(J.fillStyle=Nd);J.fill(),yp>0&&(J.strokeStyle=Tp,J.lineWidth=yp,J.stroke())}J.textBaseline="top",J.textAlign=wo==="left"?"left":wo==="right"?"right":"center";const oc=wo==="left"?pu+Bn.left:wo==="right"?pu+Md-Bn.right:pu+Md/2;let _f=kc+Bn.top;const Bm=J.globalCompositeOperation;if(J.globalCompositeOperation="source-over",Pa){const df=wo==="left"?oc:wo==="right"?oc-Pa.width:oc-Pa.width/2;J.drawImage(Pa.canvas,Math.round(df),Math.round(_f),Pa.width,Pa.height)}else{J.font=Io.font,J.fillStyle=Ji,Nu&&(J.strokeStyle="rgba(0,0,0,0.45)",J.lineWidth=1);const df=m1({text:String(Ye.text??""),font:Io.font,maxWidth:Ye.maxWidth,wrap:Ye.wrap===!0||Ye.textWrap===!0,lineHeight:Ye.lineHeight});for(const op of df.lines)J.fillText(op,Math.round(oc),Math.round(_f)),Nu&&J.strokeText(op,Math.round(oc),Math.round(_f)),_f+=df.lineHeight}J.globalCompositeOperation=Bm,J.restore(),J.globalAlpha=fh;return}const us=Ye.shape||"",ds=us==="arrow_up"?"arrowUp":us==="arrow_down"?"arrowDown":us==="triangle_up_filled"?"triangleUpFilled":us==="triangle_down_filled"?"triangleDownFilled":us==="cross"?"cross":us==="xcross"?"xcross":us==="diamond"?"diamond":us==="arrow_up_glow"?"arrowUpGlow":us==="arrow_down_glow"?"arrowDownGlow":us==="triangle_up_gradient"?"triangleUpGradient":us==="triangle_down_gradient"?"triangleDownGradient":us==="circle_pulse"?"circlePulse":us==="callout"?"callout":us==="tag"?"tag":us==="flag"?"flag":us==="pill"?"pill":us==="box_gradient"?"boxGradient":us==="bubble"?"bubble":us==="spark"?"spark":us==="star"?"star":us==="label"?"label":us==="text"||us==="emoji"?"text":us,os=Is/2,In=Ye!=null&&Ye.pineV2?Ye.bgColor||"rgba(0,0,0,0)":Ye.bgColor||"rgba(15,23,42,0.95)",Lo=(Ye==null?void 0:Ye.bgGradient)??(Ye==null?void 0:Ye.gradient),_n=Ye!=null&&Ye.pineV2?Ye.borderColor||"rgba(0,0,0,0)":Ye.borderColor||"rgba(0,0,0,0.65)",sn=String(Ye.shape||"").toLowerCase(),Ao=Ye.callout===!0||sn==="callout"||sn==="pill"||sn==="label"||sn==="tag"||sn==="flag"||sn==="box_gradient",Qo=Ye.textColor||(Ao?"#f8fafc":Ye.color||"#f8fafc"),wi=String(Ye.text||""),Do=typeof Ye.borderWidth=="number"?Math.max(0,Ye.borderWidth):Ye!=null&&Ye.pineV2||Ao?0:1;J.lineWidth=Do;const ir=J.globalAlpha;if(J.globalAlpha=typeof Ye.opacity=="number"?Math.max(0,Math.min(1,Ye.opacity)):1,ds==="circle"||ds==="square"||ds==="arrowUp"||ds==="arrowDown"||ds==="cross"||ds==="xcross"||ds==="diamond"||ds==="box"||ds==="triangleUpFilled"||ds==="triangleDownFilled"||ds==="label"||ds==="arrowUpGlow"||ds==="arrowDownGlow"||ds==="triangleUpGradient"||ds==="triangleDownGradient"||ds==="circlePulse"||ds==="callout"||ds==="tag"||ds==="flag"||ds==="pill"||ds==="boxGradient"||ds==="bubble"||ds==="spark"||ds==="star"||ds==="text"){if(J.save(),J.strokeStyle=_n,Lo&&(Lo.from||Lo.to)){const Io=Rh(J,{minX:Zt-os,maxX:Zt+os,minY:ct-os,maxY:ct+os},Lo,In||"#0f172a");J.fillStyle=Io??(Ye!=null&&Ye.pineV2?In:Ye.color||In)}else J.fillStyle=Ye!=null&&Ye.pineV2?In:Ye.color||In;if(ds==="circle")J.beginPath(),J.arc(Zt,ct,os,0,Math.PI*2),J.fill(),Do>0&&J.stroke();else if(ds==="square")J.beginPath(),J.rect(Zt-os,ct-os,Is,Is),J.fill(),Do>0&&J.stroke();else if(ds==="cross")J.strokeStyle=Ye.color||_n,J.beginPath(),J.moveTo(Zt-os,ct),J.lineTo(Zt+os,ct),J.moveTo(Zt,ct-os),J.lineTo(Zt,ct+os),Do>0&&J.stroke();else if(ds==="xcross")J.strokeStyle=Ye.color||_n,J.beginPath(),J.moveTo(Zt-os,ct-os),J.lineTo(Zt+os,ct+os),J.moveTo(Zt-os,ct+os),J.lineTo(Zt+os,ct-os),Do>0&&J.stroke();else if(ds==="diamond")J.beginPath(),J.moveTo(Zt,ct-os),J.lineTo(Zt+os,ct),J.lineTo(Zt,ct+os),J.lineTo(Zt-os,ct),J.closePath(),J.fill(),Do>0&&J.stroke();else if(ds==="arrowUp"||ds==="arrowUpGlow")J.beginPath(),J.moveTo(Zt,ct-os),J.lineTo(Zt-os,ct+os),J.lineTo(Zt+os,ct+os),J.closePath(),(ds==="arrowUpGlow"||Ye.shadow)&&(J.shadowColor=Ye.color||In,J.shadowBlur=12),J.fill(),Do>0&&J.stroke();else if(ds==="arrowDown"||ds==="arrowDownGlow")J.beginPath(),J.moveTo(Zt,ct+os),J.lineTo(Zt-os,ct-os),J.lineTo(Zt+os,ct-os),J.closePath(),(ds==="arrowDownGlow"||Ye.shadow)&&(J.shadowColor=Ye.color||In,J.shadowBlur=12),J.fill(),Do>0&&J.stroke();else if(ds==="triangleUpFilled")J.beginPath(),J.moveTo(Zt,ct-os),J.lineTo(Zt-os,ct+os),J.lineTo(Zt+os,ct+os),J.closePath(),J.fill(),Do>0&&J.stroke();else if(ds==="triangleDownFilled")J.beginPath(),J.moveTo(Zt,ct+os),J.lineTo(Zt-os,ct-os),J.lineTo(Zt+os,ct-os),J.closePath(),J.fill(),Do>0&&J.stroke();else if(ds==="triangleUpGradient"||ds==="triangleDownGradient"){const Io=J.createLinearGradient(Zt-os,ct-os,Zt+os,ct+os);Io.addColorStop(0,Ye.bgColor||"rgba(59,130,246,0.6)"),Io.addColorStop(1,Ye.color||"rgba(34,197,94,0.6)"),J.fillStyle=Io,J.beginPath(),ds==="triangleUpGradient"?(J.moveTo(Zt,ct-os),J.lineTo(Zt-os,ct+os),J.lineTo(Zt+os,ct+os)):(J.moveTo(Zt,ct+os),J.lineTo(Zt-os,ct-os),J.lineTo(Zt+os,ct-os)),J.closePath(),J.fill(),Do>0&&J.stroke()}else if(ds==="circlePulse")J.beginPath(),J.arc(Zt,ct,os,0,Math.PI*2),J.fill(),Do>0&&J.stroke(),J.globalAlpha=.4,J.beginPath(),J.arc(Zt,ct,os*1.6,0,Math.PI*2),J.stroke(),J.globalAlpha=1;else if(ds==="pill"){const Io=Math.max(10,J.measureText(wi||"").width+16),Bn=Math.max(12,Is),gi=Zt-Math.floor(Io/2),wo=ct-Math.floor(Bn/2),Ei=Bn/2;J.beginPath(),J.moveTo(gi+Ei,wo),J.lineTo(gi+Io-Ei,wo),J.arc(gi+Io-Ei,wo+Ei,Ei,-Math.PI/2,Math.PI/2),J.lineTo(gi+Ei,wo+Bn),J.arc(gi+Ei,wo+Ei,Ei,Math.PI/2,-Math.PI/2),J.closePath(),J.fill(),Do>0&&J.stroke()}else if(ds==="callout"){const Io=Math.max(10,J.measureText(wi||"").width+18),Bn=Math.max(12,Is+6),gi=Zt-Math.floor(Io/2),wo=ct-Math.floor(Bn/2),Ei=Math.max(4,Math.floor(Bn/3));Li(J,gi,wo,Io,Bn,Ei),J.fill(),Do>0&&J.stroke();const Ba=Math.max(4,Math.floor(Bn/4));J.beginPath(),Ut?(J.moveTo(Zt-Ba,wo+Bn),J.lineTo(Zt+Ba,wo+Bn),J.lineTo(Zt,wo+Bn+Ba)):(J.moveTo(Zt-Ba,wo),J.lineTo(Zt+Ba,wo),J.lineTo(Zt,wo-Ba)),J.closePath(),J.fill(),Do>0&&J.stroke()}else if(ds==="tag"||ds==="flag"){const Io=Math.max(10,J.measureText(wi||"").width+20),Bn=Math.max(12,Is+4),gi=Zt-Math.floor(Io/2),wo=ct-Math.floor(Bn/2);J.beginPath(),J.rect(gi,wo,Io,Bn),J.fill(),Do>0&&J.stroke(),ds==="flag"&&(J.beginPath(),J.moveTo(gi,wo),J.lineTo(gi-Bn/2,wo+Bn/2),J.lineTo(gi,wo+Bn),J.closePath(),J.fill(),J.stroke())}else if(ds==="boxGradient"){const Io=Math.max(10,J.measureText(wi||"").width+12),Bn=Math.max(12,Is+6),gi=Zt-Math.floor(Io/2),wo=ct-Math.floor(Bn/2),Ei=J.createLinearGradient(gi,wo,gi+Io,wo+Bn);Ei.addColorStop(0,Ye.bgColor||"rgba(15,23,42,0.5)"),Ei.addColorStop(1,Ye.color||"rgba(59,130,246,0.35)"),J.fillStyle=Ei,J.beginPath(),J.rect(gi,wo,Io,Bn),J.fill(),Do>0&&J.stroke()}else if(ds==="bubble")J.beginPath(),J.arc(Zt,ct,os,0,Math.PI*2),J.fill(),Do>0&&J.stroke(),J.beginPath(),J.moveTo(Zt,ct+os),J.lineTo(Zt+os,ct+os+6),Do>0&&J.stroke();else if(ds==="spark")J.beginPath(),J.moveTo(Zt,ct-os),J.lineTo(Zt,ct+os),J.moveTo(Zt-os,ct),J.lineTo(Zt+os,ct),Do>0&&J.stroke();else if(ds==="star"){J.beginPath();for(let Io=0;Io<5;(Io+=1)-1){const Bn=Math.PI*2*Io/5,gi=Zt+Math.cos(Bn)*os,wo=ct+Math.sin(Bn)*os,Ei=Bn+Math.PI/5,Ba=Zt+Math.cos(Ei)*(os/2),Ta=ct+Math.sin(Ei)*(os/2);Io===0?J.moveTo(gi,wo):J.lineTo(gi,wo),J.lineTo(Ba,Ta)}J.closePath(),J.fill(),Do>0&&J.stroke()}else if(ds==="box"){const Io=row.__open,Bn=row.__close,gi=row.__high,wo=row.__low;if(Io!=null&&Bn!=null&&gi!=null&&wo!=null){const Ei=Ye.boxMode||"body",Ba=Ei==="wick"?gi:Math.max(Io,Bn),Ta=Ei==="wick"?wo:Math.min(Io,Bn),Ji=ko.convertToPixel(Ba),Nu=ko.convertToPixel(Ta);if(Number.isFinite(Ji)&&Number.isFinite(Nu)){const Pa=xi.convertToPixel(ps),zu=ps>0?xi.convertToPixel(ps-1):Pa-Math.abs(xi.convertToPixel(1)-xi.convertToPixel(0)),Md=ps<Bu.length-1?xi.convertToPixel(ps+1):Pa+Math.abs(xi.convertToPixel(1)-xi.convertToPixel(0)),ta=0,uf=((zn==null?void 0:zn.width)??Ci.width)||0,Ku=Math.min(Pa,Math.max(ta,Math.floor((zu+Pa)/2))),pu=Math.max(Pa,Math.min(uf,Math.ceil((Pa+Md)/2))),kc=Math.min(Ji,Nu),Xu=Math.max(1,Math.abs(Nu-Ji)),Nd=Math.max(2,pu-Ku);J.beginPath(),J.rect(Ku,kc,Nd,Xu),J.fill(),J.strokeStyle=_n,J.lineWidth=Is,J.stroke()}}}else if(ds==="label"){const Io=J.measureText(wi||""),Bn=Math.max(10,Io.width+12),gi=Math.max(12,Is+6),wo=Math.max(3,Math.floor(gi/3)),Ei=Zt-Math.floor(Bn/2),Ba=ct-Math.floor(gi/2);J.beginPath();const Ta=wo;J.moveTo(Ei+Ta,Ba),J.lineTo(Ei+Bn-Ta,Ba),J.quadraticCurveTo(Ei+Bn,Ba,Ei+Bn,Ba+Ta),J.lineTo(Ei+Bn,Ba+gi-Ta),J.quadraticCurveTo(Ei+Bn,Ba+gi,Ei+Bn-Ta,Ba+gi),J.lineTo(Ei+Ta,Ba+gi),J.quadraticCurveTo(Ei,Ba+gi,Ei,Ba+gi-Ta),J.lineTo(Ei,Ba+Ta),J.quadraticCurveTo(Ei,Ba,Ei+Ta,Ba),J.closePath(),J.fill(),J.stroke()}else if(ds==="text"){J.fillStyle=Qo,J.textAlign=Ps;const Io=typeof Ye.size=="number"&&Ye.size>0?Ye.size:14;J.font=`${Io}px sans-serif`;const Bn=Ut?ct-(Io/2+4):ct+(Io/2+4);J.fillText(wi||"",Zt,Bn)}if(wi&&ds!=="text"){const Io=typeof Ye.size=="number"&&Ye.size>0?Ye.size:12,Bn=ds==="callout"||ds==="label"||ds==="pill"||ds==="tag"||ds==="flag"||ds==="boxGradient"||Ye.callout===!0,gi=Io/2,wo=typeof Ye.textPadding=="number"?Math.max(0,Ye.textPadding):gi+6,Ei=Bn?ct:Ut?ct-wo:ct+wo,Ba=J.globalCompositeOperation;J.globalCompositeOperation="source-over",J.fillStyle=Ye.callout===!0?Ye.textColor||"#f8fafc":Qo,Bn||(J.strokeStyle="rgba(0,0,0,0.45)"),J.textAlign="center",J.textBaseline="middle",J.fillText(wi,Zt,Ei),Bn||J.strokeText(wi,Zt,Ei),J.globalCompositeOperation=Ba}J.restore(),J.globalAlpha=ir}else if(wi)J.fillStyle=Qo,J.strokeStyle="rgba(0,0,0,0.45)",J.lineWidth=1,J.fillText(wi,Zt,ct),J.strokeText(wi,Zt,ct);else{const Io=String(us||"");if(!Me.has(Io)){Me.add(Io);try{console.warn("[ScriptStudio] Unknown label shape:",Io)}catch{}}J.beginPath(),J.arc(Zt,ct,Math.max(3,Is/3),0,Math.PI*2),J.fillStyle=Ye.color||"#22d3ee",J.fill()}},Ho=K=>{if(!K||!K.columns||!K.rows)return;const ht=8,qe=((zn==null?void 0:zn.width)??Ci.width)||0,Vt=((zn==null?void 0:zn.height)??Ci.height)||0,Ye=Math.max(1,Math.floor(K.columns)),Ps=Math.max(1,Math.floor(K.rows)),vs=typeof K.textSize=="number"&&K.textSize>0?K.textSize:12,ps=new Array(Ye).fill(0),as=new Array(Ps).fill(Math.max(20,vs+8)),Zt=Array.isArray(K.cells)?K.cells:[],ct=new Map;for(const _n of Zt){const sn=Math.max(0,Math.min(Ye-1,_n.column)),Ao=Math.max(0,Math.min(Ps-1,_n.row));ct.set(`${sn}:${Ao}`,_n)}const Ut=Array.isArray(K.merges)?K.merges:[],hs=new Map,Is=new Map;for(const _n of Ut){if(!_n)continue;let sn=Math.max(0,Math.min(Ye-1,Math.floor(Number(_n.left)))),Ao=Math.max(0,Math.min(Ye-1,Math.floor(Number(_n.right)))),Qo=Math.max(0,Math.min(Ps-1,Math.floor(Number(_n.top)))),wi=Math.max(0,Math.min(Ps-1,Math.floor(Number(_n.bottom))));if(!Number.isFinite(sn)||!Number.isFinite(Ao)||!Number.isFinite(Qo)||!Number.isFinite(wi))continue;sn>Ao&&([sn,Ao]=[Ao,sn]),Qo>wi&&([Qo,wi]=[wi,Qo]);const Do=`${sn}:${Qo}:${Ao}:${wi}`;Is.has(Do)||Is.set(Do,{left:sn,top:Qo,right:Ao,bottom:wi,minW:0,minH:0});for(let ir=sn;ir<=Ao;(ir+=1)-1)for(let Io=Qo;Io<=wi;(Io+=1)-1)hs.set(`${ir}:${Io}`,{left:sn,top:Qo,right:Ao,bottom:wi})}for(const _n of Zt){const sn=Math.max(0,Math.min(Ye-1,_n.column)),Ao=Math.max(0,Math.min(Ps-1,_n.row)),Qo=hs.get(`${sn}:${Ao}`);if(Qo&&(Qo.left!==sn||Qo.top!==Ao))continue;const wi=_n.text||"",Do=typeof _n.textSize=="number"&&_n.textSize>0?_n.textSize:vs;J.font=`${Do}px "Inter", system-ui, -apple-system, sans-serif`;const ir=J.measureText(wi).width+ht*2,Io=typeof _n.width=="number"&&_n.width>0?_n.width:0,Bn=typeof _n.height=="number"&&_n.height>0?_n.height:Math.max(20,Do+8);if(Qo){const gi=`${Qo.left}:${Qo.top}:${Qo.right}:${Qo.bottom}`,wo=Is.get(gi);wo&&(wo.minW=Math.max(wo.minW,ir,Io),wo.minH=Math.max(wo.minH,Bn))}else ps[sn]=Math.max(ps[sn],ir,Io),as[Ao]=Math.max(as[Ao],Bn)}for(let _n=0;_n<Ye;(_n+=1)-1)ps[_n]<60&&(ps[_n]=60);for(const _n of Is.values()){let sn=0;for(let Qo=_n.left;Qo<=_n.right;(Qo+=1)-1)sn+=ps[Qo]||0;sn<_n.minW&&(ps[_n.right]=(ps[_n.right]||0)+(_n.minW-sn));let Ao=0;for(let Qo=_n.top;Qo<=_n.bottom;(Qo+=1)-1)Ao+=as[Qo]||0;Ao<_n.minH&&(as[_n.bottom]=(as[_n.bottom]||0)+(_n.minH-Ao))}const cs=ps.reduce((_n,sn)=>_n+sn,0),Ms=as.reduce((_n,sn)=>_n+sn,0),us=String(K.position||"top_right").toLowerCase();let ds=ht,os=ht;us.includes("top_right")?(ds=qe-cs-ht,os=ht):us.includes("bottom_left")?(ds=ht,os=Vt-Ms-ht):us.includes("bottom_right")?(ds=qe-cs-ht,os=Vt-Ms-ht):us.includes("top_center")?(ds=(qe-cs)/2,os=ht):us.includes("bottom_center")?(ds=(qe-cs)/2,os=Vt-Ms-ht):(us.includes("middle_center")||us.includes("center"))&&(ds=(qe-cs)/2,os=(Vt-Ms)/2),J.save(),K.bgcolor&&(J.fillStyle=K.bgcolor,J.fillRect(ds,os,cs,Ms));const In=K.frameColor||K.borderColor;In&&(J.strokeStyle=In,J.lineWidth=typeof K.frameWidth=="number"&&K.frameWidth>0?K.frameWidth:typeof K.borderWidth=="number"&&K.borderWidth>0?K.borderWidth:1,J.strokeRect(ds,os,cs,Ms));let Lo=ds;for(let _n=0;_n<Ye;(_n+=1)-1){let sn=os;for(let Ao=0;Ao<Ps;(Ao+=1)-1){const Qo=ps[_n],wi=as[Ao],Do=hs.get(`${_n}:${Ao}`);if(Do&&(Do.left!==_n||Do.top!==Ao)){sn+=wi;continue}const ir=Do?(()=>{let Nu=0;for(let Pa=Do.left;Pa<=Do.right;(Pa+=1)-1)Nu+=ps[Pa]||0;return Nu})():Qo,Io=Do?(()=>{let Nu=0;for(let Pa=Do.top;Pa<=Do.bottom;(Pa+=1)-1)Nu+=as[Pa]||0;return Nu})():wi,Bn=ct.get(`${_n}:${Ao}`);Bn!=null&&Bn.bgcolor&&(J.fillStyle=Bn.bgcolor,J.fillRect(Lo,sn,ir,Io)),J.strokeStyle=K.borderColor||"rgba(148,163,184,0.5)",J.lineWidth=typeof K.borderWidth=="number"&&K.borderWidth>0?K.borderWidth:1,J.strokeRect(Lo,sn,ir,Io);const gi=(Bn==null?void 0:Bn.text)||"",wo=typeof(Bn==null?void 0:Bn.textSize)=="number"&&Bn.textSize>0?Bn.textSize:vs;J.font=`${wo}px "Inter", system-ui, -apple-system, sans-serif`;const Ei=(Bn==null?void 0:Bn.textHalign)||K.textHalign||"left",Ba=(Bn==null?void 0:Bn.textValign)||K.textValign||"middle";J.textAlign=Ei==="center"||Ei==="right"?Ei:"left",J.textBaseline=Ba==="top"?"top":Ba==="bottom"?"bottom":"middle";let Ta=Lo+ht;J.textAlign==="center"&&(Ta=Lo+ir/2),J.textAlign==="right"&&(Ta=Lo+ir-ht);let Ji=sn+Io/2;J.textBaseline==="top"&&(Ji=sn+ht),J.textBaseline==="bottom"&&(Ji=sn+Io-ht),J.fillStyle=(Bn==null?void 0:Bn.textColor)||K.textColor||"#e2e8f0",J.fillText(gi,Ta,Ji),sn+=wi}Lo+=ps[_n]}J.restore()},qa=K=>{var as,Zt;const ht=el[K];if(!ht||!ht.length)return;const qe=ht.slice().sort((ct,Ut)=>ct.zIndex!==Ut.zIndex?ct.zIndex-Ut.zIndex:ct.createdAt-Ut.createdAt),Vt={above:{},below:{}},Ye={above:{},below:{}},Ps=[],vs=new Map,ps=new Set;for(const ct of qe){const Ut=xc(ct);if(!(dh&&((as=j0(Ut))!=null&&as.hidden))){if(ct.kind==="label"){const hs=(Zt=ct==null?void 0:ct.payload)==null?void 0:Zt.meta,Is=Hi(ct.payload,Ye,Ut);Is&&vs.set(Ut,Is),Is&&kd(hs)&&(Ps.some(Ms=>Gf(Ms,Is))?ps.add(Ut):Ps.push(Is))}if(dh){if(ct.kind==="box"){const hs=Zo(ct.payload,Ut),Is=ha(ct.payload,Ut),cs=Is?{x:Math.min(Is.x1,Is.x2)+xs,y:Math.min(Is.y1,Is.y2)+Un,width:Math.abs(Is.x2-Is.x1),height:Math.abs(Is.y2-Is.y1)}:null;if(cs&&hs&&(ji.push({id:Ut,type:ct.kind,zIndex:ct.zIndex,createdAt:Bc(),rect:cs,box:hs,axis:Rr??void 0,offset:jo,snap:Wo??void 0}),Jl.set(Ut,cs)),i(Xf)&&i(Xf)===Ut&&Is){const Ms=Math.min(Is.x1,Is.x2),us=Math.max(Is.x1,Is.x2),ds=Math.min(Is.y1,Is.y2),os=Math.max(Is.y1,Is.y2),In={left:Ms,right:us,top:ds,bottom:os},Lo=2,_n=Math.max(dc,8),sn=(()=>{const gi=ko.convertFromPixel(ds),wo=ko.convertFromPixel(ds+_n);return Number.isFinite(gi)&&Number.isFinite(wo)?Math.abs(wo-gi):0})(),Ao=Ms+xs,Qo=us+xs,wi=ds+Un,Do=os+Un,ir=(Ao+Qo)/2,Io=(wi+Do)/2,Bn={n:{x:ir,y:wi},s:{x:ir,y:Do},e:{x:Qo,y:Io},w:{x:Ao,y:Io},ne:{x:Qo,y:wi},nw:{x:Ao,y:wi},se:{x:Qo,y:Do},sw:{x:Ao,y:Do}};Object.keys(Bn).forEach(gi=>{const wo=Bn[gi],Ei={x:wo.x-Jc,y:wo.y-Jc,width:dc,height:dc},Ba={x:Ei.x-xs,y:Ei.y-Un,width:Ei.width,height:Ei.height},Ta=`__handle:${Ut}:${gi}`;zr.push({id:Ta,targetId:Ut,position:gi,rect:Ei,rectLocal:Ba,boundsPx:In,cursor:Vr[gi],minWidthIndex:Lo,minHeightValue:sn}),ji.push({id:Ta,type:"handle",zIndex:1e5,createdAt:Bc(),rect:Ei,handle:{targetId:Ut,position:gi,boundsPx:In,minWidthIndex:Lo,minHeightValue:sn},axis:Rr??void 0,offset:jo,snap:Wo??void 0})})}}else if(ct.kind==="line"||ct.kind==="lineSegment"){const hs=ia(ct.payload,Ut);hs&&ji.push({id:Ut,type:ct.kind,zIndex:ct.zIndex,createdAt:Bc(),segment:hs,tolerance:ml,axis:Rr??void 0,offset:jo,snap:Wo??void 0})}else if(ct.kind==="label"){const hs=Lr(ct.payload,Ut),Is=vs.get(Ut)||null;Is&&hs&&!ps.has(Ut)&&ji.push({id:Ut,type:ct.kind,zIndex:ct.zIndex,createdAt:Bc(),rect:Is,label:hs,axis:Rr??void 0,offset:jo,snap:Wo??void 0})}else if(ct.kind==="polyline"){const hs=Ca(ct.payload,Ut);hs.length&&ji.push({id:Ut,type:ct.kind,zIndex:ct.zIndex,createdAt:Bc(),segments:hs,tolerance:ml,axis:Rr??void 0,offset:jo,snap:Wo??void 0})}else if(ct.kind==="polygon"){const hs=Qa(ct.payload,Ut);if(hs.length>=3){let Is=Number.POSITIVE_INFINITY,cs=Number.POSITIVE_INFINITY,Ms=Number.NEGATIVE_INFINITY,us=Number.NEGATIVE_INFINITY;for(const os of hs)!Number.isFinite(os.x)||!Number.isFinite(os.y)||(os.x<Is&&(Is=os.x),os.x>Ms&&(Ms=os.x),os.y<cs&&(cs=os.y),os.y>us&&(us=os.y));const ds=Number.isFinite(Is)&&Number.isFinite(cs)&&Number.isFinite(Ms)&&Number.isFinite(us)?{x:Is,y:cs,width:Math.max(0,Ms-Is),height:Math.max(0,us-cs)}:null;ds&&Jl.set(Ut,ds),ji.push({id:Ut,type:ct.kind,zIndex:ct.zIndex,createdAt:Bc(),polygon:hs,rect:ds??void 0,tolerance:ml,axis:Rr??void 0,offset:jo,snap:Wo??void 0})}}else if(ct.kind==="path"){const hs=Cl(ct.payload,Ut);hs.length&&ji.push({id:Ut,type:ct.kind,zIndex:ct.zIndex,createdAt:Bc(),segments:hs,tolerance:ml,axis:Rr??void 0,offset:jo,snap:Wo??void 0})}}ct.kind==="box"?al(ct.payload,Ut):ct.kind==="polygon"?Ou(wr(ct.payload,Ut))||wc(ct.payload,Ut):ct.kind==="polyline"?Ou(li(ct.payload,Ut))||Bi(ct.payload,Ut):ct.kind==="path"?Ou(Qr(ct.payload,Ut))||nr(ct.payload,Ut):ct.kind==="line"||ct.kind==="lineSegment"?Ou(ll(ct.payload,Ut))||Ar(ct.payload,Ut):ct.kind==="linefill"?Ou(ea(ct.payload))||Ha(ct.payload):ct.kind==="label"?cl(ct.payload,Vt,Ut,ps):ct.kind==="table"&&Ho(ct.payload)}}};qa("background"),Vl.forEach((K,ht)=>{var Ye,Ps,vs,ps,as,Zt,ct,Ut;const qe=No[ht]||Np[ht].key,Vt=(K.type||"").toLowerCase();if(Vt==="candles"||Vt==="ohlc"){const hs=`${qe}__open`,Is=`${qe}__high`,cs=`${qe}__low`,Ms=`${qe}__close`,us=xi.convertToPixel(ui),ds=ui+1<=_d?xi.convertToPixel(ui+1):xi.convertToPixel(Math.max(ui-1,0)),os=Number.isFinite(us)&&Number.isFinite(ds)?Math.max(2,Math.abs(ds-us)):6,In=Math.max(2,Math.min(14,os*.7)),Lo=In/2,_n=K.color||"#22c55e",sn=K.downColor||"#ef4444",Ao=K.upGradient??K.gradient,Qo=K.downGradient??K.gradient,wi=K.borderColor||_n,Do=K.borderColor||sn,ir=K.wickColor||_n,Io=K.wickColor||sn;for(let Bn=ui;Bn<=_d;(Bn+=1)-1){const gi=Bu[Bn]||{},wo=gi[hs]??gi.__open,Ei=gi[Is]??gi.__high,Ba=gi[cs]??gi.__low,Ta=gi[Ms]??gi.__close;if(wo==null||Ei==null||Ba==null||Ta==null||Number.isNaN(wo)||Number.isNaN(Ei)||Number.isNaN(Ba)||Number.isNaN(Ta))continue;const Ji=xi.convertToPixel(Bn),Nu=Ta>=wo,Pa=ko.convertToPixel(Math.max(wo,Ta)),zu=ko.convertToPixel(Math.min(wo,Ta)),Md=ko.convertToPixel(Ei),ta=ko.convertToPixel(Ba),uf=Nu?ir:Io;if(J.beginPath(),J.strokeStyle=uf,J.lineWidth=1,J.moveTo(Ji,Md),J.lineTo(Ji,ta),J.stroke(),Vt==="candles"){const Ku=Nu?_n:sn,pu=Nu?wi:Do,kc=Math.max(1,Math.abs(zu-Pa)),Xu=Nu?Ao:Qo;if(Xu&&(Xu.from||Xu.to)){const Nd=Rh(J,{minX:Ji-Lo,maxX:Ji+Lo,minY:Math.min(Pa,zu),maxY:Math.max(Pa,zu)},Xu,Ku);J.fillStyle=Nd??Ku}else J.fillStyle=Ku;J.strokeStyle=pu,J.lineWidth=1,J.beginPath(),J.rect(Ji-Lo,Math.min(Pa,zu),In,kc),J.fill(),J.stroke()}else{const Ku=Nu?wi:Do;J.strokeStyle=Ku,J.lineWidth=1,J.beginPath(),J.moveTo(Ji-Lo,ko.convertToPixel(wo)),J.lineTo(Ji,ko.convertToPixel(wo)),J.moveTo(Ji,ko.convertToPixel(Ta)),J.lineTo(Ji+Lo,ko.convertToPixel(Ta)),J.stroke()}}}if(Vt==="dots"){const hs=K.color||"#22d3ee",Is=K.width||4,cs=[];for(let Ms=ui;Ms<=_d;(Ms+=1)-1){const us=(Ye=Bu[Ms])==null?void 0:Ye[qe];if(us==null){cs.push({x:NaN,y:NaN});continue}const ds=xi.convertToPixel(Ms),os=ko.convertToPixel(us);cs.push({x:ds,y:os})}a6(J,cs,hs,Is,zn,K==null?void 0:K.gradient)}if(Vt==="cross"){const hs=K.color||"#22d3ee",Is=K.width||6;J.save();const cs=K==null?void 0:K.gradient;if(cs&&(cs.from||cs.to)){const Ms=zn??{left:0,top:0,width:Ci.width,height:Ci.height},us=Rh(J,{minX:Ms.left,maxX:Ms.left+Ms.width,minY:Ms.top,maxY:Ms.top+Ms.height},cs,hs);J.strokeStyle=us??hs}else J.strokeStyle=hs;J.lineWidth=Math.max(1,Math.round(Is/3));for(let Ms=ui;Ms<=_d;(Ms+=1)-1){const us=(Ps=Bu[Ms])==null?void 0:Ps[qe];if(us==null)continue;const ds=xi.convertToPixel(Ms),os=ko.convertToPixel(us);if(!Number.isFinite(ds)||!Number.isFinite(os))continue;const In=Is/2;J.beginPath(),J.moveTo(ds-In,os),J.lineTo(ds+In,os),J.moveTo(ds,os-In),J.lineTo(ds,os+In),J.stroke()}J.restore()}if(Vt==="stepped"||Vt==="step"){const hs=K.color||"#22c55e",Is=K.width||2,cs=[];for(let Ms=ui;Ms<=_d;(Ms+=1)-1){const us=(vs=Bu[Ms])==null?void 0:vs[qe];if(us==null){cs.push({x:NaN,y:NaN});continue}cs.push({x:xi.convertToPixel(Ms),y:ko.convertToPixel(us)})}MX(J,cs,hs,Is,zn,K==null?void 0:K.gradient)}if(Vt==="area"){const hs=K.color||"rgba(56,189,248,0.3)",Is=[];for(let ds=ui;ds<=_d;(ds+=1)-1){const os=(ps=Bu[ds])==null?void 0:ps[qe];if(os==null){Is.push({x:NaN,y:NaN});continue}const In=xi.convertToPixel(ds),Lo=ko.convertToPixel(os);Is.push({x:In,y:Lo})}const cs=ko.convertToPixel(0),us=String(K.baseline||"").toLowerCase()==="zero"?cs:zn?zn.height:Ci.top+Ci.height;PX(J,Is,us,hs,K==null?void 0:K.gradient,null,0,zn)}if(Vt==="glow_points"){const hs=K.color||"#22d3ee",Is=(K.width||4)+2,cs=[];for(let Ms=ui;Ms<=_d;(Ms+=1)-1){const us=(as=Bu[Ms])==null?void 0:as[qe];if(us==null){cs.push({x:NaN,y:NaN});continue}cs.push({x:xi.convertToPixel(Ms),y:ko.convertToPixel(us)})}J.save(),J.shadowColor=hs,J.shadowBlur=12,a6(J,cs,hs,Is,zn,K==null?void 0:K.gradient),J.restore()}if(Vt==="neon_line"){const hs=K.color||"#22d3ee",Is=K.width||2;J.save(),J.shadowColor=hs,J.shadowBlur=14;const cs=K==null?void 0:K.gradient;if(cs&&(cs.from||cs.to)){const us=zn??{left:0,top:0,width:Ci.width,height:Ci.height},ds=Rh(J,{minX:us.left,maxX:us.left+us.width,minY:us.top,maxY:us.top+us.height},cs,hs);J.strokeStyle=ds??hs}else J.strokeStyle=hs;J.beginPath();let Ms=!1;for(let us=ui;us<=_d;(us+=1)-1){const ds=(Zt=Bu[us])==null?void 0:Zt[qe];if(ds==null)continue;const os=xi.convertToPixel(us),In=ko.convertToPixel(ds);Ms?J.lineTo(os,In):(J.moveTo(os,In),Ms=!0)}J.lineWidth=Is,J.stroke(),J.restore()}if(Vt==="bezier_line"){const hs=K.color||"#34d399",Is=K.width||2;J.save();const cs=K==null?void 0:K.gradient;if(cs&&(cs.from||cs.to)){const os=zn??{left:0,top:0,width:Ci.width,height:Ci.height},In=Rh(J,{minX:os.left,maxX:os.left+os.width,minY:os.top,maxY:os.top+os.height},cs,hs);J.strokeStyle=In??hs}else J.strokeStyle=hs;J.beginPath();let Ms=NaN,us=NaN,ds=!1;for(let os=ui;os<=_d;(os+=1)-1){const In=(ct=Bu[os])==null?void 0:ct[qe];if(In==null)continue;const Lo=xi.convertToPixel(os),_n=ko.convertToPixel(In);if(!ds)J.moveTo(Lo,_n),ds=!0;else{const sn=(Ms+Lo)/2,Ao=(us+_n)/2;J.quadraticCurveTo(Ms,us,sn,Ao)}Ms=Lo,us=_n}J.lineWidth=Is,J.stroke(),J.restore()}if(Vt==="cloud"||Vt==="supertrend_cloud"){const hs=K.color||"rgba(14,165,233,0.12)";J.save();const Is=[],cs=[];for(let ds=ui;ds<=_d;(ds+=1)-1){const os=Bu[ds]||{},In=xi.convertToPixel(ds),Lo=ko.convertToPixel(os[qe]),_n=ko.convertToPixel(os[No[0]]);Is.push({x:In,y:Lo}),cs.push({x:In,y:_n})}let Ms=hs;const us=K==null?void 0:K.gradient;if(us&&(us.from||us.to)){let ds=Number.POSITIVE_INFINITY,os=Number.NEGATIVE_INFINITY,In=Number.POSITIVE_INFINITY,Lo=Number.NEGATIVE_INFINITY;for(const sn of Is)!Number.isFinite(sn.x)||!Number.isFinite(sn.y)||(sn.x<ds&&(ds=sn.x),sn.x>os&&(os=sn.x),sn.y<In&&(In=sn.y),sn.y>Lo&&(Lo=sn.y));for(const sn of cs)!Number.isFinite(sn.x)||!Number.isFinite(sn.y)||(sn.x<ds&&(ds=sn.x),sn.x>os&&(os=sn.x),sn.y<In&&(In=sn.y),sn.y>Lo&&(Lo=sn.y));const _n=Rh(J,{minX:Number.isFinite(ds)?ds:0,maxX:Number.isFinite(os)&&os!==ds?os:Number.isFinite(ds)?ds+1:1,minY:Number.isFinite(In)?In:0,maxY:Number.isFinite(Lo)&&Lo!==In?Lo:Number.isFinite(In)?In+1:1},us,hs);_n&&(Ms=_n)}x2(J,Is,cs,Ms,zn),J.restore()}if(Vt==="aura"||Vt==="candleshadow"){const hs=K.color||"#a78bfa",Is=K.width||2;J.save(),J.shadowColor=hs,J.shadowBlur=18;const cs=K==null?void 0:K.gradient;if(cs&&(cs.from||cs.to)){const us=zn??{left:0,top:0,width:Ci.width,height:Ci.height},ds=Rh(J,{minX:us.left,maxX:us.left+us.width,minY:us.top,maxY:us.top+us.height},cs,hs);J.strokeStyle=ds??hs}else J.strokeStyle=hs;J.beginPath();let Ms=!1;for(let us=ui;us<=_d;(us+=1)-1){const ds=(Ut=Bu[us])==null?void 0:Ut[qe];if(ds==null)continue;const os=xi.convertToPixel(us),In=ko.convertToPixel(ds);Ms?J.lineTo(os,In):(J.moveTo(os,In),Ms=!0)}J.lineWidth=Is,J.stroke(),J.restore()}});const Fr=$t.fills||[];if(Array.isArray(Fr)&&Fr.length)for(const K of Fr){const ht=Array.isArray(K==null?void 0:K.between)?K.between:[];if(!ht||ht.length!==2)continue;const qe=(ht[0]||"").replace(/\s+/g,"_").toLowerCase(),Vt=(ht[1]||"").replace(/\s+/g,"_").toLowerCase(),Ye=zp[qe],Ps=zp[Vt];if(!Ye||!Ps)continue;const vs=[],ps=[];for(let ct=ui;ct<=_d;(ct+=1)-1){const Ut=Bu[ct]||{},hs=xi.convertToPixel(ct),Is=ko.convertToPixel(Ut[Ye]),cs=ko.convertToPixel(Ut[Ps]);vs.push({x:hs,y:Is}),ps.push({x:hs,y:cs})}let as=K.color||"rgba(0,0,0,0.12)";const Zt=K.fillGradient;if(Zt&&(Zt.from||Zt.to)){let ct=Number.POSITIVE_INFINITY,Ut=Number.NEGATIVE_INFINITY,hs=Number.POSITIVE_INFINITY,Is=Number.NEGATIVE_INFINITY;for(const sn of vs)!Number.isFinite(sn==null?void 0:sn.x)||!Number.isFinite(sn==null?void 0:sn.y)||(sn.x<ct&&(ct=sn.x),sn.x>Ut&&(Ut=sn.x),sn.y<hs&&(hs=sn.y),sn.y>Is&&(Is=sn.y));for(const sn of ps)!Number.isFinite(sn==null?void 0:sn.x)||!Number.isFinite(sn==null?void 0:sn.y)||(sn.x<ct&&(ct=sn.x),sn.x>Ut&&(Ut=sn.x),sn.y<hs&&(hs=sn.y),sn.y>Is&&(Is=sn.y));const cs=Zt.from||as,Ms=Zt.to||as||cs,us=String(Zt.mode||"vertical").toLowerCase(),ds=Number.isFinite(ct)?ct:0,os=Number.isFinite(Ut)&&Ut!==ct?Ut:ds+1,In=Number.isFinite(hs)?hs:0,Lo=Number.isFinite(Is)&&Is!==hs?Is:In+1;let _n;if(us==="horizontal")_n=J.createLinearGradient(ds,In,os,In);else if(us==="radial"){const sn=(ds+os)/2,Ao=(In+Lo)/2,Qo=Math.max(os-ds,Lo-In)/2;_n=J.createRadialGradient(sn,Ao,0,sn,Ao,Math.max(1,Qo))}else _n=J.createLinearGradient(ds,In,ds,Lo);_n.addColorStop(0,String(cs)),_n.addColorStop(1,String(Ms)),as=_n}x2(J,vs,ps,as,zn)}qa("main"),Zc.forEach(K=>{const ht=ko.convertToPixel(K.value);if(!Number.isFinite(ht))return;J.beginPath(),J.moveTo(0,ht),J.lineTo(((zn==null?void 0:zn.width)??Ci.width)||0,ht),J.strokeStyle=K.color||"#64748b",J.lineWidth=K.width??1;const qe=(K.style||"dashed").toLowerCase();qe==="dashed"||qe==="dotted"?J.setLineDash(qe==="dashed"?[4,4]:[2,2]):J.setLineDash([]),J.stroke(),J.setLineDash([])});const Mi=$t.backgroundZones||[];if(Array.isArray(Mi)&&Mi.length)for(const K of Mi){const ht=Number.isFinite(K.from)?ko.convertToPixel(K.from):0,qe=Number.isFinite(K.to)?ko.convertToPixel(K.to):(zn==null?void 0:zn.height)??Ci.height,Vt=Math.min(ht,qe),Ye=Math.abs(qe-ht);J.beginPath(),J.rect(0,Vt,((zn==null?void 0:zn.width)??Ci.width)||0,Ye),J.fillStyle=K.color||"rgba(34,197,94,0.08)",J.fill()}if(qa("overlay"),qa("ui"),Hd&&au&&dd.length&&(Ke.push({bounds:au,shapes:dd}),ol()),dh&&zr.length){J.save(),J.fillStyle="rgba(226,232,240,0.9)",J.strokeStyle="rgba(15,23,42,0.65)",J.lineWidth=1;for(const K of zr){const ht=K.rectLocal;J.beginPath(),J.rect(ht.x+.5,ht.y+.5,ht.width,ht.height),J.fill(),J.stroke()}J.restore()}if(dh&&i(sc)){const K=Jl.get(i(sc));K&&(J.save(),J.strokeStyle="rgba(148,163,184,0.75)",J.lineWidth=1,J.strokeRect(K.x-xs+.5,K.y-Un+.5,K.width,K.height),J.restore())}return dh?(cp.set(Zs,ji),cd=Array.from(cp.values()).flat()):cp.has(Zs)&&(cp.delete(Zs),cd=Array.from(cp.values()).flat()),J.restore(),!1}},f0=($t==null?void 0:$t.legend)??((_g=M==null?void 0:M.style)==null?void 0:_g.legend)??!0,Hg=J=>{if(J==null)return;const ms=String(J).toLowerCase().replace(/\s+/g,"_");if(ms.includes("bottom")&&ms.includes("right"))return"bottom_right";if(ms.includes("bottom")&&ms.includes("left"))return"bottom_left";if(ms.includes("top")&&ms.includes("right"))return"top_right";if(ms.includes("top")&&ms.includes("left"))return"top_left";if(ms.includes("bottom"))return"bottom_left";if(ms.includes("top"))return"top_left"},qg=J=>{const ms=Xa(J);return Number.isFinite(ms)?ms:void 0},Ap=Vl.find(J=>(J==null?void 0:J.legendPosition)!=null||(J==null?void 0:J.legendOffsetX)!=null||(J==null?void 0:J.legendOffsetY)!=null),p0=Hg(($t==null?void 0:$t.legendPosition)??($t==null?void 0:$t.legend_position)??(Ap==null?void 0:Ap.legendPosition)??(Ap==null?void 0:Ap.legend_position)??((Zv=M==null?void 0:M.style)==null?void 0:Zv.legendPosition))||"top_left",h0=qg(($t==null?void 0:$t.legendOffsetX)??($t==null?void 0:$t.legend_offset_x)??(Ap==null?void 0:Ap.legendOffsetX)??(Ap==null?void 0:Ap.legend_offset_x)??((yg=M==null?void 0:M.style)==null?void 0:yg.legendOffsetX))??0,m0=qg(($t==null?void 0:$t.legendOffsetY)??($t==null?void 0:$t.legend_offset_y)??(Ap==null?void 0:Ap.legendOffsetY)??(Ap==null?void 0:Ap.legend_offset_y)??((bg=M==null?void 0:M.style)==null?void 0:bg.legendOffsetY))??0;return Tv.__plotMeta={plots:Vl,plotKeys:No,legend:f0,legendPosition:p0,legendOffsetX:h0,legendOffsetY:m0},Tv.__scriptSource=me,Tv},tf=[],kh=[];js.forEach(($t,En)=>{var Bp,Gp,ao,Ri,bc,Mu,Sf;const Mo=Gu($t,En);try{Rb(Mo)}catch(dp){console.debug("Script indicator register error",dp)}const No=$t.pane==="main"?"candle_pane":`pane_script_${En}`;kh[En]=No;const ka=$t.pane==="main",Xc=typeof $t.min=="number"&&typeof $t.max=="number",eo=$t.pane==="sub"?{gap:Xc?{top:0,bottom:0}:{top:2,bottom:2}}:void 0;let Ra=fe.createIndicator(Mo.name,ka,{id:No,height:typeof $t.height=="number"&&Number.isFinite($t.height)?$t.height:$t.pane==="sub"?((Bp=M==null?void 0:M.sub)==null?void 0:Bp.height)??(M==null?void 0:M.height)??200:((Gp=M==null?void 0:M.main)==null?void 0:Gp.height)??(M==null?void 0:M.height)??void 0,axis:eo});if(Ra||(Ra=fe.createIndicator(Mo,ka,{id:No,height:typeof $t.height=="number"&&Number.isFinite($t.height)?$t.height:$t.pane==="sub"?((ao=M==null?void 0:M.sub)==null?void 0:ao.height)??(M==null?void 0:M.height)??200:((Ri=M==null?void 0:M.main)==null?void 0:Ri.height)??(M==null?void 0:M.height)??void 0,axis:eo})),!Ra)throw new Error("Unable to render script indicator.");aa.push(Ra),tl.push(Mo.name),Te.push({def:Mo,paneId:No}),Xc?(qi.set(No,{min:$t.min,max:$t.max}),wd(No),zl(No)):qi.delete(No);try{fe.createOverlay({name:"script-layer",visible:!0,lock:!0,groupId:"runtime"})}catch{}const Xa=(Sf=Mo.calc)==null?void 0:Sf.call(Mo,((Mu=(bc=o())==null?void 0:bc.getDataList)==null?void 0:Mu.call(bc))||[],{calcParams:[]}),Vl=Array.isArray(Xa)?Xa:Array.isArray(Xa==null?void 0:Xa.__rows)?Xa.__rows:[],Qf=i(Bo)?Vl.reduce((dp,Op)=>dp+Object.keys(Op||{}).filter(gd=>gd.startsWith("__label_")).length,0):0;tf.push(Qf)});try{const $t=Te.find(En=>En.paneId==="candle_pane");b(Zr,H(((up=$t==null?void 0:$t.def)==null?void 0:up.name)||((Nr=(Wi=Te[0])==null?void 0:Wi.def)==null?void 0:Nr.name)||null))}catch{b(Zr,null)}try{const $t=((Kc=fe.getDataList)==null?void 0:Kc.call(fe))||[],En=ao=>{const Ri=typeof ao=="number"?ao:Number(ao);return Number.isFinite(Ri)?Ri:void 0},Mo=$t.map(ao=>{const Ri=En((ao==null?void 0:ao.close)??(ao==null?void 0:ao.c)??(ao==null?void 0:ao.price));return En((ao==null?void 0:ao.high)??(ao==null?void 0:ao.h))??Ri}),No=$t.map(ao=>{const Ri=En((ao==null?void 0:ao.close)??(ao==null?void 0:ao.c)??(ao==null?void 0:ao.price));return En((ao==null?void 0:ao.low)??(ao==null?void 0:ao.l))??Ri}),ka=$t.map(ao=>En((ao==null?void 0:ao.close)??(ao==null?void 0:ao.c)??(ao==null?void 0:ao.price))),Xc=(ao,Ri)=>{const bc=ao[Ri];return typeof bc=="number"&&Number.isFinite(bc)?bc:null},eo=(ao,Ri)=>{const bc=$t.length;if(bc<=0)return null;const Mu=Math.max(1,Math.floor(Ri.left)),Sf=Math.max(1,Math.floor(Ri.right)),dp=Math.max(2,Math.floor(Ri.lookback)),Op=bc-1,gd=Math.max(0,Op-dp+1),Zc=Math.max(0,Op-Sf);if(Zc<gd)return null;const Cf=ao==="high"?Mo:No,ep=[];for(let np=gd+Mu;np<=Zc;(np+=1)-1){const $h=Xc(Cf,np);if($h==null)continue;let Ef=!0;for(let Cd=np-Mu;Cd<=np+Sf;(Cd+=1)-1){if(Cd===np)continue;const $f=Xc(Cf,Cd);if($f==null){Ef=!1;break}if(ao==="high"){if($f>=$h){Ef=!1;break}}else if($f<=$h){Ef=!1;break}}Ef&&ep.push(np)}if(!ep.length)return null;const zp=Math.trunc(Ri.which);if(zp===0)return ep[ep.length-1];if(zp<0){const np=ep.length+zp;return np>=0?ep[np]:null}const Np=zp-1;return Np>=0&&Np<ep.length?ep[Np]:null},Ra=(ao,Ri)=>{const bc=$t.length;if(bc<=0)return null;const Mu=Math.max(2,Math.floor(Ri.lookback)),Sf=bc-1,dp=Math.max(0,Sf-Mu+1),Op=ao==="high"?Mo:No;let gd=null,Zc=ao==="high"?-1/0:1/0;for(let Cf=dp;Cf<=Sf;(Cf+=1)-1){const ep=Xc(Op,Cf);ep!=null&&(ao==="high"?ep>Zc&&(Zc=ep,gd=Cf):ep<Zc&&(Zc=ep,gd=Cf))}return gd},Xa=ao=>{const Ri=typeof ao=="number"?ao:Number(ao);if(!Number.isFinite(Ri))return null;const bc=$t.length,Mu=Ri<0?bc+Math.trunc(Ri):Math.trunc(Ri);return Mu<0||Mu>=bc?null:Mu},Vl=ao=>{var dp,Op;if(!ao||typeof ao!="object")return null;if(ao.pivot){const gd=String(ao.pivot).toLowerCase()==="low"?"low":"high",Zc=eo(gd,{left:Number(ao.left??ao.pivotLeft??3),right:Number(ao.right??ao.pivotRight??3),lookback:Number(ao.lookback??400),which:Number(ao.which??-1)});Zc!=null&&(ao={index:Zc,source:gd})}else if(ao.extreme){const gd=String(ao.extreme).toLowerCase()==="low"?"low":"high",Zc=Ra(gd,{lookback:Number(ao.lookback??400)});Zc!=null&&(ao={index:Zc,source:gd})}const Ri=Xa(ao.index),bc=typeof ao.timestamp=="number"&&Number.isFinite(ao.timestamp)?ao.timestamp:Ri!=null?((dp=$t[Ri])==null?void 0:dp.timestamp)??((Op=$t[Ri])==null?void 0:Op.time)??null:null;let Mu=typeof ao.value=="number"&&Number.isFinite(ao.value)?ao.value:null;if(Mu==null&&Ri!=null&&ao.source){const gd=String(ao.source||"").replace(/\s+/g,"_").toLowerCase(),Zc=$t[Ri],Cf=gd==="open"?Zc==null?void 0:Zc.open:gd==="high"?Zc==null?void 0:Zc.high:gd==="low"?Zc==null?void 0:Zc.low:gd==="close"?Zc==null?void 0:Zc.close:gd==="volume"?Zc==null?void 0:Zc.volume:null;typeof Cf=="number"&&Number.isFinite(Cf)&&(Mu=Cf)}const Sf={};return bc!=null&&(Sf.timestamp=bc),Mu!=null&&(Sf.value=Mu),Ri!=null&&(Sf.__index=Ri),Object.keys(Sf).length?Sf:null},Qf=[];js.forEach((ao,Ri)=>{(Array.isArray(ao.overlays)?ao.overlays:[]).forEach(Mu=>Qf.push({paneId:kh[Ri]||(ao.pane==="main"?"candle_pane":"pane_script"),overlay:Mu}))});let Bp=0;const Gp=[];Qf.forEach(({paneId:ao,overlay:Ri})=>{try{const bc=String((Ri==null?void 0:Ri.name)||"").trim();if(!bc)return;const Sf=(Array.isArray(Ri==null?void 0:Ri.points)?Ri.points:[]).map(Vl).filter(Boolean),dp={name:bc,paneId:(Ri==null?void 0:Ri.pane)==="main"?"candle_pane":((Ri==null?void 0:Ri.pane)==="sub",ao),groupId:"runtime",lock:(Ri==null?void 0:Ri.lock)===!0,visible:(Ri==null?void 0:Ri.visible)!==!1,points:Sf};Ri!=null&&Ri.styles&&(dp.styles=Ri.styles),Ri!=null&&Ri.extendData&&(dp.extendData=Ri.extendData),fe.createOverlay(dp),Bp+=1}catch(bc){Gp.push(String((bc==null?void 0:bc.message)||bc))}});try{const ao=Array.isArray(Jt)?Jt:[];for(const Ri of ao){const bc=String((Ri==null?void 0:Ri.type)||"").trim().toLowerCase();if(bc!=="auto_fib"&&bc!=="autofib"||!(Ri.draw===!0||Ri.autoDraw===!0)||$t.length<2)continue;const Sf=Math.max(2,Math.floor(Number(Ri.lookback)||200)),Op=String(Ri.direction||"up").trim().toLowerCase()==="down"?"down":"up",gd=String(Ri.method||Ri.mode||"extremes").trim().toLowerCase(),Zc=gd==="pivots"||gd==="pivot"||gd==="swing"?"pivots":"extremes",Cf=Math.max(1,Math.floor(Number(Ri.pivotLeft??Ri.left??3))),ep=Math.max(1,Math.floor(Number(Ri.pivotRight??Ri.right??3))),zp=h4(Mo,No,ka,$t.length-1,{lookback:Sf,direction:Op,method:Zc,pivotLeft:Cf,pivotRight:ep});if(!zp)continue;const Np=$t[zp.fromIndex],np=$t[zp.toIndex],$h=(Np==null?void 0:Np.timestamp)??(Np==null?void 0:Np.time)??null,Ef=(np==null?void 0:np.timestamp)??(np==null?void 0:np.time)??null;if($h==null||Ef==null)continue;const Cd=Ri.levels,$f=Array.isArray(Cd)&&Cd.length?Cd.map(uh=>{if(typeof uh=="number")return{value:uh,color:"#64748b",label:String(uh)};if(uh&&typeof uh=="object"){const wm=typeof uh.value=="number"?uh.value:Number(uh.value);return Number.isFinite(wm)?{value:wm,color:String(uh.color||"#64748b"),label:String(uh.label??wm)}:null}return null}).filter(Boolean):[{value:0,color:"#64748b",label:"0"},{value:.382,color:"#60a5fa",label:"0.382"},{value:.5,color:"#22c55e",label:"0.5"},{value:.618,color:"#f59e0b",label:"0.618"},{value:1,color:"#64748b",label:"1"}];fe.createOverlay({name:"fibonacciSegment",paneId:"candle_pane",groupId:"runtime",lock:!1,visible:!0,points:[{timestamp:$h,value:zp.fromValue},{timestamp:Ef,value:zp.toValue}],extendData:{fibonacciLevels:$f}}),Bp+=1}}catch(ao){Gp.push(String((ao==null?void 0:ao.message)||ao))}Bp&&b(ns,`${i(ns)||"Plotted"} • overlays: ${Bp}`),Gp.length&&b(fs,`Overlay error: ${Gp.slice(0,2).join(" • ")}`)}catch($t){console.error("[ScriptStudio] overlay create error",$t)}try{const $t=Te.find(En=>En.paneId==="candle_pane");b(Zr,H(((Yu=$t==null?void 0:$t.def)==null?void 0:Yu.name)||((Yi=(Vd=Te[0])==null?void 0:Vd.def)==null?void 0:Yi.name)||null))}catch{b(Zr,null)}const oh=js.map($t=>$t.pane).join("+"),vp=tf.reduce(($t,En)=>$t+En,0),Ff=js.flatMap($t=>$t.plots||[]),ih=Ff.length,bm=Ff.filter(O).length,jp=js.some($t=>Array.isArray($t.labels)&&$t.labels.length>0||Array.isArray($t.runtimeLabels)&&$t.runtimeLabels.length>0),Pv=js.some($t=>Array.isArray($t.runtimeLines)&&$t.runtimeLines.length>0||Array.isArray($t.runtimeBoxes)&&$t.runtimeBoxes.length>0||Array.isArray($t.runtimeTables)&&$t.runtimeTables.length>0||Array.isArray($t.runtimeDrawOps)&&$t.runtimeDrawOps.length>0||Array.isArray($t.overlays)&&$t.overlays.length>0),gp=[],uc=bm===0&&!Pv;if(uc&&!i(Bo)&&(vp>0||jp)&&gp.push({level:"warning",message:"Labels are disabled; this script only outputs labels, so nothing is visible.",hint:"Turn Labels On or add a plot/line/box."}),uc&&jp&&vp===0&&gp.push({level:"warning",message:"No label signals matched, so nothing was drawn.",hint:"Loosen your conditions or add a plot for context."}),uc&&gp.length===0&&(ih>0?gp.push({level:"warning",message:"All plots are hidden (transparent/opacity 0) and no draws are visible.",hint:"Use a visible color or remove transparent plots while debugging."}):gp.push({level:"warning",message:"No visible output: no plots or draw calls were produced.",hint:"Check conditions/returns or add a plot for context."})),gp.length&&b(Mn,H(W(i(Mn),gp))),b(ns,`Plotted (${oh}) • labels: ${i(Bo)?vp:"off"}`),Cn.size&&b(ns,`${i(ns)} • limits: ${Array.from(Cn).join(" • ")}`),ae&&b(Mn,H(Array.from(We.values()))),vp===0)try{const $t=js.reduce((eo,Ra)=>eo+(Ra.plots||[]).length,0),En=[],Mo=js.some(eo=>Array.isArray(eo.labels)&&eo.labels.length>0),No=js.some(eo=>Array.isArray(eo.runtimeDrawOps)&&eo.runtimeDrawOps.length>0||Array.isArray(eo.overlays)&&eo.overlays.length>0||Array.isArray(eo.runtimeLabels)&&eo.runtimeLabels.length>0||Array.isArray(eo.runtimeLines)&&eo.runtimeLines.length>0||Array.isArray(eo.runtimeBoxes)&&eo.runtimeBoxes.length>0||Array.isArray(eo.runtimeTables)&&eo.runtimeTables.length>0);$t===0&&!Mo&&!No&&En.push("Pane has no plots");const ka=new Set(["open","high","low","close","volume","time","bar_index","barstate_isfirst","barstate_islast","barstate_islastconfirmedhistory","barstate_isconfirmed","barstate_isrealtime","barstate_ishistory","barstate_isnew","timeframe_multiplier","timeframe_seconds","timeframe_isseconds","timeframe_isminutes","timeframe_ishours","timeframe_isdaily","timeframe_isweekly","timeframe_ismonthly","timeframe_isyearly","timeframe_isintraday","timeframe_period","syminfo_mintick","syminfo_pointvalue","syminfo_tickerid","syminfo_ticker","syminfo_root","syminfo_prefix","syminfo_exchange","syminfo_description","syminfo_type","syminfo_currency","syminfo_timezone","syminfo_session","syminfo_isdelayed","strategy_position_size","strategy_position_avg_price","strategy_opentrades","strategy_closedtrades","strategy_openprofit","strategy_closedprofit","strategy_grossprofit","strategy_grossloss","strategy_wintrades","strategy_losstrades","strategy_winrate","strategy_max_drawdown","strategy_max_drawdown_value","strategy_max_runup","strategy_max_runup_value","strategy_avg_trade","strategy_avg_win","strategy_avg_loss","strategy_avg_bars_in_trade","strategy_equity","strategy_netprofit","strategy_initial_capital"]),Xc=(eo,Ra)=>{const Xa=(eo||"").toLowerCase(),Vl=Ra.replace(/\s+/g,"_").toLowerCase();return Xa==="bbands"||Xa==="bollinger"||Xa==="bollinger_bands"||Xa==="kc"||Xa==="keltner"||Xa==="donchian"||Xa==="linreg_channel"?[`${Vl}_mid`,`${Vl}_upper`,`${Vl}_lower`]:Xa==="atr_bands"?[`${Vl}_upper`,`${Vl}_lower`]:Xa==="stoch"?[`${Vl}_k`,`${Vl}_d`]:Xa==="macd"?["macd_line","macd_signal","macd_hist"]:Xa==="ichimoku"?["tenkan","kijun","spana","spanb","chikou"]:[Vl]};if(Jt.forEach(eo=>{const Ra=String((eo==null?void 0:eo.name)||(eo==null?void 0:eo.type)||"").replace(/\s+/g,"_").toLowerCase();Xc(String((eo==null?void 0:eo.type)||""),Ra).forEach(Xa=>ka.add(Xa))}),$s.forEach(eo=>{const Ra=String((eo==null?void 0:eo.name)||"").replace(/\s+/g,"_").toLowerCase();Ra&&ka.add(Ra)}),js.forEach((eo,Ra)=>{(eo.labels||[]).forEach((Xa,Vl)=>{const Qf=String((Xa==null?void 0:Xa.when)||"").trim(),Gp=String((Xa==null?void 0:Xa.whenExpr)||"").trim()||Qf;if(!Gp){En.push(`Label[${Ra}:${Vl}] has empty condition`);return}try{const ao=M!=null&&M.params&&typeof M.params=="object"?M.params:{},Ri=Gp.replace(/\$\{([^}]+)\}/g,(gd,Zc)=>{const Cf=ao[Zc],ep=typeof Cf=="number"?Cf:Number(Cf);return Number.isFinite(ep)?String(ep):"0"}),bc=Uf(Ri),Mu=[],Sf=Ep(bc),dp=gd=>{!gd||typeof gd!="object"||(gd.kind==="Identifier"&&Mu.push(String(gd.name||"")),Object.values(gd).forEach(dp))};dp(Sf);const Op=Mu.filter(gd=>{const Zc=gd.replace(/\s+/g,"_").toLowerCase();return Zc==="na"||Zc==="nan"||Zc==="true"||Zc==="false"||Zc==="pi"||Zc==="e"?!1:!ka.has(Zc)&&!["open","high","low","close","volume"].includes(Zc)});Op.length&&En.push(`Label[${Ra}:${Vl}] unknown series: ${Op.join(", ")}`)}catch(ao){const Ri=(ao==null?void 0:ao.position)!=null?` at ${ao.position}`:"",bc=ao!=null&&ao.message?String(ao.message):String(ao);En.push(`Label[${Ra}:${Vl}] parse failed${Ri}: ${bc}`)}})}),En.length){const eo=En.join(" • ");b(fs,H(i(fs)?`${i(fs)} • ${eo}`:eo))}else b(ns,"No label signals matched")}catch{}const vr=Xt(i(Mn));vr&&b(ns,`${i(ns)||"Plotted"} • ${vr}`),ba();try{De&&(clearInterval(De),De=null)}catch{}ed()}function ce(M){const V=String(M||"").split(/\r?\n/),fe=Math.min(8,V.length);for(let me=0;me<fe;(me+=1)-1){const We=(V[me]||"").match(/^\s*(?:\/\/|#)\s*@?(?:lang|language)\s*(?::|=)?\s*([A-Za-z]+)\s*$/i);if(!We)continue;const He=String(We[1]||"").toLowerCase();if(He==="auto"||He==="json"||He==="pine"||He==="dsl"||He==="js")return He}return null}function G(M,V){return V&&V!=="auto"?V:ce(M)||"auto"}function ye(M){let V="",fe=null;for(let me=0;me<M.length;(me+=1)-1){const ae=M[me],We=M[me+1];if(fe){V+=ae,ae===fe&&M[me-1]!=="\\"&&(fe=null);continue}if(ae==="'"||ae==='"'){fe=ae,V+=ae;continue}if(ae==="/"&&We==="/")break;V+=ae}return V}function Qe(M){let V="",fe=null;for(let me=0;me<M.length;(me+=1)-1){const ae=M[me];if(fe){V+=" ",ae===fe&&M[me-1]!=="\\"&&(fe=null);continue}if(ae==="'"||ae==='"'){fe=ae,V+=" ";continue}V+=ae}return V}function Ue(M){const V=String(M||"").split(/\r?\n/),fe=/[A-Za-z_$][A-Za-z0-9_$]*\s*\[\s*-\s*\d+\s*\]/;for(let me=0;me<V.length;(me+=1)-1){const ae=ye(V[me]||""),We=Qe(ae),He=fe.exec(We);if(He)return{line:me+1,col:He.index+1,snippet:He[0].trim()}}return null}function dt(M){const V=String(M||""),fe=[];let me="",ae=0,We=null,He=!1;for(let At=0;At<V.length;(At+=1)-1){const Wt=V[At];if(We){if(me+=Wt,He){He=!1;continue}if(Wt==="\\"){He=!0;continue}Wt===We&&(We=null);continue}if(Wt==="'"||Wt==='"'){We=Wt,me+=Wt;continue}if(Wt==="("){ae+=1,me+=Wt;continue}if(Wt===")"&&ae>0){ae-=1,me+=Wt;continue}if(Wt===","&&ae===0){me.trim()&&fe.push(me.trim()),me="";continue}me+=Wt}return me.trim()&&fe.push(me.trim()),fe}function et(M){const V=String(M||"").split(/\r?\n/),fe={},me=We=>We.trim().toLowerCase(),ae=We=>{const He=String(We||"").trim();if(!/^[-+]?\d+(?:\.\d+)?$/.test(He))return null;const At=Number(He);return Number.isFinite(At)?Math.max(0,Math.floor(At)):null};for(let We=0;We<V.length;(We+=1)-1){const He=ye(V[We]||""),At=He.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.new_(?:float|int|bool|string)\s*\(([^)]*)\)/i);if(At){const Jt=dt(At[2]||""),$s=ae(Jt[0]||"");$s!=null&&(fe[me(At[1]||"")]=$s);continue}const Wt=He.match(/\b([A-Za-z_$][A-Za-z0-9_$]*)\s*(?::=|=)\s*array\.from\s*\(([^)]*)\)/i);if(Wt){const Jt=dt(Wt[2]||"");Jt.length&&(fe[me(Wt[1]||"")]=Jt.length)}}for(let We=0;We<V.length;(We+=1)-1){const He=ye(V[We]||""),At=Qe(He),Wt=At.match(/\barray\.set\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+)\b/i);if(Wt){const $s=me(Wt[1]||""),Kt=Number(Wt[2]),Us=fe[$s],es=At.indexOf(Wt[0]||"")+1;if(Number.isFinite(Kt)&&Kt<0)return{line:We+1,col:es>0?es:1,message:"Negative array index not allowed"};if(Number.isFinite(Kt)&&Us!=null&&Kt>=Us)return{line:We+1,col:es>0?es:1,message:"array.set index must be within array size"}}const Jt=At.match(/\barray\.get\s*\(\s*([A-Za-z_$][A-Za-z0-9_$]*)\s*,\s*([-+]?\d+)\b/i);if(Jt){const $s=Number(Jt[2]),Kt=At.indexOf(Jt[0]||"")+1;if(Number.isFinite($s)&&$s<0)return{line:We+1,col:Kt>0?Kt:1,message:"Negative array index not allowed"}}}return null}function B(M){const V=String(M||"").trim();if(!V)return"";const fe=V[0];return(fe==='"'||fe==="'")&&V.endsWith(fe)?V.slice(1,-1):V}function ve(M){const V=B(M).trim().toLowerCase();if(!V)return null;const fe=V.replace(/^shape\./,"").replace(/^label\./,"");return fe.includes("none")?"none":fe.includes("xcross")?"xcross":fe.includes("cross")?"cross":fe.includes("diamond")?"diamond":fe.includes("triangleup")?"triangle_up_filled":fe.includes("triangledown")?"triangle_down_filled":fe.includes("arrowup")?"arrowUp":fe.includes("arrowdown")?"arrowDown":fe.includes("circle")?"circle":fe.includes("square")?"square":fe.includes("flag")?"flag":fe.includes("tag")?"tag":fe.includes("pill")?"pill":fe.includes("label")?"label":null}function Fe(M){const V=B(M).trim().toLowerCase();if(!V)return null;const fe=V.replace(/^size\./,"");if(fe==="auto")return 14;if(fe==="tiny")return 10;if(fe==="small")return 12;if(fe==="normal")return 14;if(fe==="large")return 18;if(fe==="huge")return 22;const me=Number(fe);return Number.isFinite(me)?me:null}function ot(M){const V=String(M||"").trim().toLowerCase();return V?V.startsWith('"')||V.startsWith("'")||V.startsWith("shape.")||V.startsWith("label.")?!0:["triangleup","triangledown","arrowup","arrowdown","circle","square","label","diamond","cross","xcross","flag","tag","pill","none"].includes(V):!1}function tt(M){const V=String(M||"").trim().toLowerCase();return V?V.startsWith('"')||V.startsWith("'")?!0:V.startsWith("location."):!1}function St(M){const V=B(M).trim().toLowerCase();if(!V)return null;const fe=V.replace(/^location\./,"");return fe.includes("absolute")?"absolute":/(above|top|high)/.test(fe)?"above":/(below|bottom|low)/.test(fe)?"below":null}function Be(M){const V=String(M||"").trim().toLowerCase();return V?V.startsWith('"')||V.startsWith("'")||V.startsWith("size.")?!0:/^[-+]?\d+(?:\.\d+)?$/.test(V):!1}function je(M){const V={};return M.forEach(fe=>{const me=fe.indexOf("=");if(me<=0)return;const ae=fe.slice(0,me).trim().toLowerCase(),We=fe.slice(me+1).trim();ae&&(V[ae]=We)}),V}function Mt(M){const V=String(M||"").split(/\r?\n/);for(let fe=0;fe<V.length;(fe+=1)-1){const me=ye(V[fe]||""),ae=me.match(/^\s*(plotshape|plotchar)\s*\((.*)\)\s*$/i);if(!ae)continue;const We=String(ae[1]||"").toLowerCase(),He=dt(ae[2]||""),At=je(He),Wt=At.style??At.shape;if(We==="plotshape"&&Wt&&ot(Wt)&&!ve(Wt)){const Us=Math.max(1,me.indexOf(Wt)+1);return{line:fe+1,col:Us,message:`plotshape style not supported: ${Wt}`}}const Jt=At.location;if(Jt&&tt(Jt)&&!St(Jt)){const Us=Math.max(1,me.indexOf(Jt)+1);return{line:fe+1,col:Us,message:`${We} location not supported: ${Jt}`}}const $s=At.size;if($s&&Be($s)&&Fe($s)==null){const Us=Math.max(1,me.indexOf($s)+1);return{line:fe+1,col:Us,message:`${We} size not supported: ${$s}`}}}return null}function Ze(M){const V=String(M||"").trim();if(!V)return!1;const fe=V[0];if(fe!=='"'&&fe!=="'")return!1;let me=1,ae=!1;for(;me<V.length;(me+=1)-1){const We=V[me];if(ae){ae=!1;continue}if(We==="\\"){ae=!0;continue}if(We===fe){me+=1;break}}return me<=1?!1:V.slice(me).trim().length===0}function rs(M){const V=String(M||"").split(/\r?\n/);for(let fe=0;fe<V.length;(fe+=1)-1){const me=V[fe]||"";let ae=null,We=0,He=-1,At=-1;for(let Wt=0;Wt<me.length;(Wt+=1)-1){const Jt=me[Wt],$s=me[Wt+1];if(ae){Jt===ae&&me[Wt-1]!=="\\"&&(ae=null);continue}if(Jt==="'"||Jt==='"'){ae=Jt;continue}if(Jt==="/"&&$s==="/")break;if(Jt==="?"){We===0&&(He=Wt),We+=1;continue}if(Jt===":"&&We>0&&(We-=1,We===0)){At=Wt;break}}if(He>=0&&At>He){const Wt=me.slice(He+1,At),Jt=me.slice(At+1),$s=Ze(Wt),Kt=Ze(Jt);if($s!==Kt)return{line:fe+1,col:He+1,snippet:me.slice(He).trim()}}}return null}const yn=M=>{const V=M.match(/^\s*(indicator|study)\s*\(\s*("([^"]+)"|'([^']+)')/m);return(V?(V[3]||V[4]||"").trim():"")||null},Qn=M=>{let V=0;for(let fe=0;fe<M.length;(fe+=1)-1)V=V*31+M.charCodeAt(fe)>>>0;return V.toString(36)},wn=M=>{const V=yn(M);return V||`pine_${Qn(M)}`},xo=2e4,hi=M=>new Promise((V,fe)=>{const me=new Worker(new URL(""+new URL("../workers/js.worker-Bnq7rPmT.js",import.meta.url).href,import.meta.url),{type:"module"}),ae=setTimeout(()=>{try{me.terminate()}catch{}fe(new Error("JS worker timed out"))},xo);me.onerror=()=>{try{clearTimeout(ae)}catch{}try{me.terminate()}catch{}fe(new Error("JS worker error"))},me.onmessage=We=>{const He=We.data;if(!(!He||He.id!==M.id)){try{clearTimeout(ae)}catch{}try{me.terminate()}catch{}V(He)}},me.postMessage(M)});async function Ln(M,V,fe,me){var At,Wt,Jt,$s,Kt,Us,es,rn,pn,Nn,js,qt,Os;b(fs,null),b(ns,"Running..."),b(Mn,H([])),b(po,!0),Tn+=1,UB(),no=me&&typeof me=="object"?{...me}:null,go=(()=>{if(!no)return"";const zs=no,mn=zs.from??"",un=zs.to??"",jn=zs.session??"";return`${mn}|${un}|${jn}`})();let ae="parse",We=fe||void 0,He;try{let zs=null;const mn=String(M||""),un=mn.trim(),jn=G(mn,fe);We=jn;const ro=un.startsWith("{")||un.startsWith("["),ys=is=>{try{return JSON.parse(is)}catch{return null}},qs=is=>is&&typeof is=="object"&&(is.plots||is.calc||is.series||is.signals||is.strategy||is.labels||is.levels||is.lines||is.overlays||is.panes||is.main||is.sub);if(jn==="json"){const is=ys(un);if(!is){b(fs,"Invalid JSON: expected a script spec object"),b(ns,"Validation failed");return}if(!qs(is)){b(fs,"JSON mode expects a script spec object"),b(ns,"Validation failed");return}try{const ts=is&&typeof is=="object"?is.params||{}:{},Ss=hx(is,ts);let ln=Ss;try{ln=vx(Ss)}catch(yo){const pr=yo instanceof Error?yo.message:String(yo);b(fs,`Template expansion error: ${pr}`),b(ns,"Validation failed");return}He=String(ln&&(ln.shortName||ln.name||ln.title)||"").trim()||void 0,ae="normalize";const on=T_(ln);if(on.ok&&on.spec)me&&typeof me=="object"&&(ln.strategy={...ln.strategy||{},...me}),ae="draw",await U(ln,"json"),b(ns,"Plotted from JSON");else{const yo=(on.errors||[]).join("; ");b(fs,H(yo?`Schema validation failed: ${yo}`:"Schema validation failed")),b(ns,"Validation failed");return}}catch(ts){const Ss=ts instanceof Error?ts.message:String(ts);b(fs,`Schema validation error: ${Ss}`),b(ns,"Validation failed");return}return}if(jn==="js"){const is=o();if(!is){b(fs,"Chart not ready yet. Please try again in a moment."),b(ns,"Validation failed");return}const ts=((At=is.getDataList)==null?void 0:At.call(is))||[];if(!ts.length){b(fs,"JS engine: no bars available"),b(ns,"Validation failed");return}const Ss=ts.length,ln=new Array(Ss),on=new Array(Ss),yo=new Array(Ss),pr=new Array(Ss),dn=new Array(Ss),Fo=new Array(Ss),Dn=uc=>{if(typeof uc=="number")return Number.isFinite(uc)?uc:void 0;if(typeof uc=="string"){const Lf=uc.replace(/[^0-9eE+\\-\\.]/g,"");if(!Lf||Lf==="+"||Lf==="-"||Lf===".")return;const Mp=Number(Lf);return Number.isFinite(Mp)?Mp:void 0}const vr=Number(uc);return Number.isFinite(vr)?vr:void 0};for(let uc=0;uc<Ss;(uc+=1)-1){const vr=ts[uc],Lf=Dn((vr==null?void 0:vr.close)??(vr==null?void 0:vr.c)??(vr==null?void 0:vr.price)??(vr==null?void 0:vr.value)),Mp=Dn((vr==null?void 0:vr.open)??(vr==null?void 0:vr.o))??Lf,Up=Dn((vr==null?void 0:vr.high)??(vr==null?void 0:vr.h))??Lf??Mp,Yh=Dn((vr==null?void 0:vr.low)??(vr==null?void 0:vr.l))??Lf??Mp,_p=Dn((vr==null?void 0:vr.volume)??(vr==null?void 0:vr.vol))??0,xm=Dn((vr==null?void 0:vr.timestamp)??(vr==null?void 0:vr.time)??(vr==null?void 0:vr.t))??0;pr[uc]=Lf,ln[uc]=Mp,on[uc]=Up,yo[uc]=Yh,dn[uc]=_p,Fo[uc]=xm}const Yo=V&&typeof V=="object"?{...V}:{},Fi=/request\s*\.\s*security/i.test(M),fo=((Wt=n())==null?void 0:Wt.symbol)||{ticker:"UNKNOWN"},Pn=String((fo==null?void 0:fo.country)||"BD").trim()||"BD",ii=`${String((fo==null?void 0:fo.ticker)||"UNKNOWN").trim()}@${Pn}`,Dr=String((($s=(Jt=n())==null?void 0:Jt.period)==null?void 0:$s.timeframe)||"1m").trim()||"1m",ni=uc=>{const vr=typeof uc=="number"?uc:Number(uc);return!Number.isFinite(vr)||vr<=0?0:vr<1e12?vr*1e3:vr},Xo=ni(Fo[0]??0),sr=ni(Fo[Ss-1]??0),Sl=uc=>{const vr=String(uc||"").trim();if(!vr)return 0;if(/^\d+$/.test(vr))return fp(`${vr}m`);if(vr==="M"||vr==="1M")return fp("1M");const Lf=vr.toUpperCase();if(Lf==="D"||Lf==="1D")return fp("1d");if(Lf==="W"||Lf==="1W")return fp("1w");const Mp=vr.match(/^(\d+)\s*([A-Za-z]+)$/);if(Mp){const Up=Mp[1]||"1",Yh=Mp[2]||"";if(Yh==="M")return fp(`${Up}M`);const _p=Yh.toLowerCase();return _p.startsWith("min")?fp(`${Up}m`):_p==="h"||_p.startsWith("hr")||_p.startsWith("hour")?fp(`${Up}h`):_p==="d"||_p.startsWith("day")?fp(`${Up}d`):_p==="w"||_p.startsWith("wk")||_p.startsWith("week")?fp(`${Up}w`):_p.startsWith("sec")?fp(`${Up}s`):fp(`${Up}${_p}`)}try{return fp(vr)}catch{return 0}},Ru=Sl(Dr),rl=Ru>0?Ru*1e3:0,Vi=sr>0&&rl>0?sr+rl-1:sr,Xl=(Us=(Kt=o())==null?void 0:Kt.getVisibleRange)==null?void 0:Us.call(Kt),Hc=uc=>Number.isFinite(uc)?Math.max(0,Math.min(Ss-1,Math.floor(uc))):0,Da=Xl?Hc(Xl.from):0,gf=Xl?Hc(Xl.to):Ss-1,ju=ni(Fo[Da]??0),Ka=ni(Fo[gf]??0),Gu=ju||Xo,tf=Ka>0&&rl>0?Ka+rl-1:Vi;let kh,oh,vp=null;if(Fi){let uc=null;try{uc=await hi({id:`js_mtf_${Date.now()}`,code:M,base:{open:ln,high:on,low:yo,close:pr,volume:dn,time:Fo},params:Yo,mtf:{baseSymbol:ii,baseTimeframe:Dr,collectOnly:!0}})}catch(Lf){const Mp=Lf instanceof Error?Lf.message:"JS engine failed";b(fs,H(Mp)),b(ns,"Validation failed");return}if(!uc||uc.error){b(fs,H(String((uc==null?void 0:uc.error)||"JS engine failed"))),b(ns,"Validation failed");return}const vr=Array.isArray(uc==null?void 0:uc.mtfRequests)?uc.mtfRequests:[];if(vr.length){const Lf=Wi=>String(Wi||"").trim().toLowerCase().replace(/\s+/g,""),Mp=Wi=>{const Nr=String(Wi||"").trim(),Kc=Nr.lastIndexOf("@");if(Kc>0&&Kc<Nr.length-1){const Yu=Nr.slice(0,Kc).trim(),Vd=Nr.slice(Kc+1).trim();if(Yu&&Vd)return{ticker:Yu,country:Vd}}return{ticker:Nr}},Up=Array.isArray((es=n())==null?void 0:es.allSymbols)?n().allSymbols:[],Yh=new Map,_p=new Map,xm=new Map;for(const Wi of Up){const Nr=Lf(String((Wi==null?void 0:Wi.ticker)||""));Nr&&Yh.set(Nr,Wi);const Kc=Lf(String((Wi==null?void 0:Wi.shortName)||""));Kc&&!_p.has(Kc)&&_p.set(Kc,Wi);const Yu=Lf(String((Wi==null?void 0:Wi.name)||""));Yu&&!xm.has(Yu)&&xm.set(Yu,Wi)}const pv=Wi=>{const Nr=String(Wi??"").trim();if(!Nr)return"__CURRENT__";const Kc=Nr.toLowerCase();return Kc==="syminfo.tickerid"||Kc==="syminfo.ticker"||Kc==="syminfo.root"||Kc==="__current__"||Kc==="__current_symbol__"?"__CURRENT__":Nr},Sh=Wi=>{const Nr=pv(Wi);if(Nr==="__CURRENT__")return{sym:fo,found:!0,raw:Nr};const Kc=Mp(Nr),Yu=String(Kc.ticker||"").trim(),Vd=Lf(Yu),Yi=Vd&&Yh.get(Vd)||Vd&&_p.get(Vd)||Vd&&xm.get(Vd)||null,$t=String(Kc.country||(Yi==null?void 0:Yi.country)||Pn).trim()||Pn;return Yi&&String(Yi.ticker||"").trim()?{sym:{...Yi,country:$t},found:!0,raw:Nr}:{sym:{...fo,ticker:Yu,country:$t},found:!1,raw:Nr}},Mv=Wi=>{const Nr=String(Wi??"").trim();if(!Nr)return"__CURRENT__";const Kc=Nr.toUpperCase();if(Kc==="CURRENT"||Kc==="__CURRENT__"||Kc==="TIMEFRAME.PERIOD")return"__CURRENT__";if(Kc==="D"||Kc==="1D")return"1d";if(Kc==="W"||Kc==="1W")return"1w";if(Kc==="M"||Kc==="1M")return"1M";if(/^\d+$/.test(Nr))return`${Nr}m`;const Yu=Kc.match(/^(\d+)\s*H$/);if(Yu)return`${Yu[1]}h`;const Vd=Kc.match(/^(\d+)\s*S$/);return Vd?`${Vd[1]}s`:Nr},hv=new Set,rm=new Map,Km={},Gv=(Wi,Nr)=>{Wi&&(Km[Lf(Wi)]=Nr)};for(const Wi of vr){const Nr=Wi==null?void 0:Wi.symbol,Kc=Sh(Nr);if(Nr!=null&&String(Nr).trim()&&!Kc.found&&Kc.raw!=="__CURRENT__"){b(fs,`request.security: unknown symbol "${String(Nr).trim()}"`),b(ns,"Validation failed");return}const Yu=Kc.sym,Vd=String((Yu==null?void 0:Yu.ticker)||"").trim();if(!Vd)continue;const Yi=String((Yu==null?void 0:Yu.country)||Pn).trim()||Pn,$t=`${Vd}@${Yi}`,En=Lf($t);hv.add($t),Gv(Nr?String(Nr):void 0,$t);const Mo=String((Wi==null?void 0:Wi.timeframe)||"__CURRENT__").trim()||"__CURRENT__",No=Mo==="__CURRENT__"?Dr:Mv(Mo);if(!No||No==="__CURRENT__")continue;const ka=Sl(No);if(Wi!=null&&Wi.lower&&Ru>0&&ka>=Ru){b(fs,`request.security_lower_tf: "${Mo}" must be lower than chart timeframe "${Dr}"`),b(ns,"Validation failed");return}const Xc=`${En}|${No}`;rm.has(Xc)||rm.set(Xc,{sym:Yu,tf:No,computeTf:Mo,lower:!!(Wi!=null&&Wi.lower),symbolKey:En,rawSymbol:Nr?String(Nr):void 0})}if(Nl.size)for(const Wi of Nl){const[Nr]=String(Wi).split("@");if(Nr&&Nr!==fo.ticker)try{C.stopSymbolPipelines(Nr)}catch{}}if(Nl=hv,rm.size&&Xo>0&&Vi>0)await Promise.all(Array.from(rm.values()).map(({sym:Wi,tf:Nr,lower:Kc})=>{const Yu=Kc?8e3:3500;return C.ensureHistoryCovers(Wi,Nr,Gu,tf,Yu).catch(()=>null)}));else if(rm.size)for(const{sym:Wi,tf:Nr}of rm.values())try{C.startBackgroundPrefetch(Wi,{timeframe:Nr})}catch{}kh={},oh=Km;let Xm=0,up="";for(const Wi of rm.values()){const Nr=C.getHistorySnapshot(Wi.sym,Wi.tf);if(Nr!=null&&Nr.error){b(fs,`request.security: ${Wi.sym.ticker}${Wi.sym.country?`@${Wi.sym.country}`:""} (${Wi.tf}) error: ${Nr.error}`),b(ns,"Validation failed");return}const Kc=Array.isArray(Nr==null?void 0:Nr.candles)?Nr.candles:[];if(!Kc.length){if(!(Nr!=null&&Nr.isComplete)){Xm+=1,up||(up=`Loading request.security: ${Wi.sym.ticker}${Wi.sym.country?`@${Wi.sym.country}`:""} (${Wi.tf})… waiting for candles`);continue}b(fs,`request.security: no data for ${Wi.sym.ticker}${Wi.sym.country?`@${Wi.sym.country}`:""} (${Wi.tf})`),b(ns,"Validation failed");return}const Yu=ni((Nr==null?void 0:Nr.oldestTimestampLoaded)??0),Vd=ni((Nr==null?void 0:Nr.newestTimestampLoaded)??0),Yi=Gu>0&&tf>0&&Yu>0&&Vd>0&&Yu<=Gu&&Vd>=tf;if(!(Gu===0||tf===0||Vd>=Gu&&Yu<=tf)){if(!(Nr!=null&&Nr.isComplete)){Xm+=1,up||(up=`Loading request.security: ${Wi.sym.ticker}${Wi.sym.country?`@${Wi.sym.country}`:""} (${Wi.tf})… waiting for overlap`);continue}b(fs,`request.security: no overlap for ${Wi.sym.ticker}${Wi.sym.country?`@${Wi.sym.country}`:""} (${Wi.tf})`),b(ns,"Validation failed");return}if(!(Nr!=null&&Nr.isComplete)&&!Yi&&(Xm+=1,!up)){const Mo=Yu||0,No=Vd||0;up=`Loading request.security: ${Wi.sym.ticker}${Wi.sym.country?`@${Wi.sym.country}`:""} (${Wi.tf})… loaded ${Mo}→${No}`}const En=`${Wi.symbolKey}|${Wi.tf}`;kh[En]={key:En,symbol:Wi.sym.ticker,country:Wi.sym.country,timeframe:Wi.tf,candles:Kc}}if(Xm>0&&up){vp=up,b(ns,H(up));const Wi=Tn,Nr=Date.now(),Kc=25e3;try{De&&(clearInterval(De),De=null)}catch{}De=setInterval(()=>{if(Tn!==Wi){try{clearInterval(De)}catch{}De=null;return}if(Date.now()-Nr>Kc){try{clearInterval(De)}catch{}De=null;return}if(i(po))return;let Yu=0;for(const Vd of rm.values()){const Yi=C.getHistorySnapshot(Vd.sym,Vd.tf);if(Yi!=null&&Yi.error)continue;const $t=ni((Yi==null?void 0:Yi.oldestTimestampLoaded)??0),En=ni((Yi==null?void 0:Yi.newestTimestampLoaded)??0),Mo=Gu>0&&tf>0&&$t>0&&En>0&&$t<=Gu&&En>=tf;(!(Array.isArray(Yi==null?void 0:Yi.candles)&&Yi.candles.length>0)||!(Yi!=null&&Yi.isComplete)&&!Mo)&&(Yu+=1)}if(Yu<=0){try{clearInterval(De)}catch{}De=null,Ln(M,V,"js",me)}},400);return}}}const Ff=`js_${Date.now()}`;let ih=null;try{ih=await hi({id:Ff,code:M,base:{open:ln,high:on,low:yo,close:pr,volume:dn,time:Fo},params:Yo,mtf:Fi?{baseSymbol:ii,baseTimeframe:Dr,symbolAliases:oh,sources:kh}:void 0})}catch(uc){const vr=uc instanceof Error?uc.message:"JS engine failed";b(fs,H(vr)),b(ns,"Validation failed");return}if(!ih||ih.error){b(fs,H(String((ih==null?void 0:ih.error)||"JS engine failed"))),b(ns,"Validation failed");return}const bm=Array.isArray(ih==null?void 0:ih.diagnostics)?ih.diagnostics:[],jp=ih.output;if(!jp||!Array.isArray(jp.panes)||!jp.panes.length){b(fs,"JS script produced no plots or draws"),b(ns,"Validation failed");return}re=Array.isArray(jp.panes)&&jp.panes.some(uc=>Array.isArray(uc==null?void 0:uc.runtimeHeatmaps)&&uc.runtimeHeatmaps.length),ba();const gp={panes:jp.panes,params:V&&typeof V=="object"?{...V}:{},signals:jp.signals||[],strategy:jp.strategy||void 0};me&&typeof me=="object"&&(gp.strategy={...gp.strategy||{},...me}),gp.__jsCode=M,gp.__jsParams=gp.params,gp.__jsSeriesMap=jp.seriesMap||{},ae="draw",await U(gp,"js"),b(Mn,H(W(i(Mn),bm))),b(ns,H(vp||"Plotted from JS"));return}if(jn==="pine"){const is=gx(M);if(is.ok){try{const Dn=is.spec&&typeof is.spec=="object"?is.spec.params||{}:{},Yo=V&&typeof V=="object"?{...Dn,...V}:Dn;is.spec.params=Yo}catch{}const ts=wn(M);He=String(((rn=is.spec)==null?void 0:rn.shortName)||((pn=is.spec)==null?void 0:pn.name)||((Nn=is.spec)==null?void 0:Nn.title)||"").trim()||""||ts||void 0,me&&typeof me=="object"&&(is.spec.strategy={...is.spec.strategy||{},...me}),(!is.spec.params||typeof is.spec.params!="object")&&(is.spec.params={}),He&&(is.spec.params.__scriptId=He),ae="normalize";const ln=Ue(M);if(ln){b(fs,`Negative history index not allowed: ${ln.snippet} (line ${ln.line})`),b(ns,"Validation failed");return}const on=(is.warnings||[]).find(Dn=>String((Dn==null?void 0:Dn.message)||"").includes('":=" used before'));if(on){const Dn=typeof on.line=="number"?` (line ${on.line})`:"";b(fs,`${String(on.message||'":=" used before declaration')}${Dn}`),b(ns,"Validation failed");return}if(rs(M)){b(fs,"Ternary branches must both be numeric or both non-numeric"),b(ns,"Validation failed");return}const pr=et(M);if(pr){b(fs,H(pr.message)),b(ns,"Validation failed");return}const dn=Mt(M);if(dn){b(fs,H(dn.message)),b(ns,"Validation failed");return}const Fo=T_(is.spec);if(Fo.ok&&Fo.spec)ae="draw",await U(Fo.spec,"pine"),b(ns,"Plotted from Pine");else{const Dn=(Fo.errors||[]).join("; ");b(fs,H(Dn?`Schema validation failed: ${Dn}`:"Schema validation failed")),b(ns,"Validation failed");return}}else b(fs,H((is.errors||[]).slice(0,6).map(ts=>`Line ${ts.line}: ${ts.message}`).join(" • "))),b(ns,"Validation failed");return}if(jn==="dsl"){const is=E6(M),ts={calc:[],series:is.series,panes:is.panes,signals:is.signals,params:V&&typeof V=="object"?{...is.params,...V}:is.params};He=String(ts.shortName||ts.name||ts.title||"").trim()||void 0,me&&typeof me=="object"&&(ts.strategy={...ts.strategy||{},...me}),ae="draw",await U(ts,"dsl"),b(ns,"Plotted from DSL");return}if(ro)try{zs=JSON.parse(un)}catch(is){const ts=String((is==null?void 0:is.message)||"Invalid JSON");b(fs,`Invalid JSON: ${ts}`),b(ns,"Validation failed");return}else try{zs=JSON.parse(un)}catch{}if(qs(zs))try{const is=zs&&typeof zs=="object"?zs.params||{}:{},ts=hx(zs,is);let Ss=ts;try{Ss=vx(ts)}catch(on){const yo=on instanceof Error?on.message:String(on);b(fs,`Template expansion error: ${yo}`),b(ns,"Validation failed");return}He=String(Ss&&(Ss.shortName||Ss.name||Ss.title)||"").trim()||void 0,ae="normalize";const ln=T_(Ss);if(ln.ok&&ln.spec)me&&typeof me=="object"&&(Ss.strategy={...Ss.strategy||{},...me}),ae="draw",await U(Ss,"json");else{const on=(ln.errors||[]).join("; ");b(fs,H(on?`Schema validation failed: ${on}`:"Schema validation failed")),b(ns,"Validation failed");return}}catch(is){const ts=is instanceof Error?is.message:String(is);b(fs,`Schema validation error: ${ts}`),b(ns,"Validation failed");return}else try{const is=gx(M);if(is.ok){try{const Yo=is.spec&&typeof is.spec=="object"?is.spec.params||{}:{},Fi=V&&typeof V=="object"?{...Yo,...V}:Yo;is.spec.params=Fi}catch{}me&&typeof me=="object"&&(is.spec.strategy={...is.spec.strategy||{},...me}),ae="normalize";const ln=Ue(M);if(ln){b(fs,`Negative history index not allowed: ${ln.snippet} (line ${ln.line})`),b(ns,"Validation failed");return}const on=(is.warnings||[]).find(Yo=>String((Yo==null?void 0:Yo.message)||"").includes('":=" used before'));if(on){const Yo=typeof on.line=="number"?` (line ${on.line})`:"";b(fs,`${String(on.message||'":=" used before declaration')}${Yo}`),b(ns,"Validation failed");return}if(rs(M)){b(fs,"Ternary branches must both be numeric or both non-numeric"),b(ns,"Validation failed");return}const pr=et(M);if(pr){b(fs,H(pr.message)),b(ns,"Validation failed");return}const dn=Mt(M);if(dn){b(fs,H(dn.message)),b(ns,"Validation failed");return}const Fo=T_(is.spec);if(Fo.ok&&Fo.spec){ae="draw",await U(Fo.spec,"pine"),b(ns,"Plotted from Pine");return}const Dn=(Fo.errors||[]).join("; ");b(fs,H(Dn?`Schema validation failed: ${Dn}`:"Schema validation failed")),b(ns,"Validation failed");return}else{const ln=(is.errors||[]).filter(on=>String((on==null?void 0:on.message)||"")!=="Not a Pine script");if(ln.length){b(fs,H(ln.slice(0,6).map(on=>`Line ${on.line}: ${on.message}`).join(" • "))),b(ns,"Validation failed");return}}const ts=E6(M),Ss={calc:[],series:ts.series,panes:ts.panes,signals:ts.signals,params:V&&typeof V=="object"?{...ts.params,...V}:ts.params};He=String(Ss.shortName||Ss.name||Ss.title||"").trim()||void 0,me&&typeof me=="object"&&(Ss.strategy={...Ss.strategy||{},...me}),ae="draw",await U(Ss,"dsl"),b(ns,"Plotted from DSL")}catch{const ts=Ua(M),Ss=o();if(!Ss)throw new Error("Chart not ready yet. Please try again in a moment.");ac(Ss);const ln=`${Rl}_${Date.now()}`,on=er(ts,ln);try{Rb(on)}catch(Fi){console.debug("Script indicator register error",Fi)}const yo=i(zi)==="main"?"candle_pane":"pane_script",pr=i(zi)==="main";let dn=Ss.createIndicator(on.name,pr,{id:yo,axis:i(zi)==="sub"?{gap:{top:2,bottom:2}}:void 0});if(dn||(dn=Ss.createIndicator(on,pr,{id:yo,axis:i(zi)==="sub"?{gap:{top:2,bottom:2}}:void 0})),!dn)throw new Error("Unable to render script indicator.");aa.push(dn),tl.push(on.name),b(Zr,H(on.name));const Fo=((Os=on.calc)==null?void 0:Os.call(on,((qt=(js=o())==null?void 0:js.getDataList)==null?void 0:qt.call(js))||[],{calcParams:[ts.window]}))||[],Dn=Fo.filter(Fi=>Fi==null?void 0:Fi.topSignal).length,Yo=Fo.filter(Fi=>Fi==null?void 0:Fi.botSignal).length;b(ns,`Plotted (WIN=${ts.window}) • ▲ ${Dn} / ▼ ${Yo}`)}}catch(zs){const mn=zs instanceof Error?zs.message:"Script failed to run.";b(fs,H(mn)),b(ns,null);try{ac(o())}catch{}CX({scriptId:He,format:We,stage:ae,message:mn,stack:zs instanceof Error?zs.stack:void 0}),console.error("[ScriptStudio] run failed",zs)}finally{b(po,!1)}ie==null||ie.restore()}function pl(){const M=o();try{ac(M)}catch{}try{Vc()}catch{}try{vu()}catch{}try{M==null||M.removeOverlay({groupId:"runtime"})}catch{}try{M==null||M.removeOverlay({name:"script-layer"})}catch{}Te=[];try{De&&(clearInterval(De),De=null)}catch{}try{ie&&X&&ie.clearRect(0,0,X.width,X.height)}catch{}try{xd()}catch{}re=!1;try{ba()}catch{}try{hse()}catch{}try{Dse()}catch{}b(ns,"Reset"),b(fs,null),b(po,!1),b(Zr,null),no=null,go=""}function vn(){typeof requestAnimationFrame>"u"||requestAnimationFrame(()=>{Ui.requestKey("dock:resize",()=>{var fe,me;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const M=lp(n().theme);Ys.merge(M,Ag(n().styles)),o().setStyles(hf(M)),lr();const V=(me=(fe=o()).getVisibleRange)==null?void 0:me.call(fe);V&&typeof V.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(V.to,0)},30)})})}function mo(){b(ft,!0),vn()}function Gi(){b(ft,!1),b(ke,!1),vn()}const La=()=>{window.removeEventListener("mousemove",wl),window.removeEventListener("touchmove",wl),window.removeEventListener("mouseup",mf),window.removeEventListener("touchend",mf)};function lc(M){if(!i(ft))return;const V="touches"in M?M.touches[0]:M,{clientY:fe}=V;Gs=fe,an=i(Et),b(tn,!0),window.addEventListener("mousemove",wl),window.addEventListener("touchmove",wl,{passive:!1}),window.addEventListener("mouseup",mf),window.addEventListener("touchend",mf),M.preventDefault()}function wl(M){var He;if(!i(tn))return;const V="touches"in M?M.touches[0]:M,fe=(He=i(it))==null?void 0:He.getBoundingClientRect();if(!fe)return;const me=Gs-V.clientY,ae=an*fe.height+me,We=Math.min(Ls,Math.max(wt,ae/fe.height));b(Et,H(We)),vn(),M.preventDefault()}function mf(){i(tn)&&(b(tn,!1),La(),vn(),setTimeout(()=>{Ui.requestKey("dock:resize-final",()=>{var fe,me;if(!o())return;o().resize(),window.__forceApplySavedCanvasColors=!0;const M=lp(n().theme);Ys.merge(M,Ag(n().styles)),o().setStyles(hf(M)),lr();const V=(me=(fe=o()).getVisibleRange)==null?void 0:me.call(fe);V&&typeof V.to=="number"&&setTimeout(()=>{o()&&o().scrollToDataIndex(V.to,0)},30)})},140))}Rg(()=>{if(La(),De){try{clearInterval(De)}catch{}De=null}te&&(te.destroy(),te=null,pe&&(pe.destroy(),pe=null))});function mp(M){if(!M)return"";if(Array.isArray(M.colors)&&M.colors.length>0){const V=M.angle||M.direction||0,fe=M.colors.map(me=>`${me.color} ${me.position}%`).join(", ");return`linear-gradient(${V}deg, ${fe})`}if(Array.isArray(M.stops)&&M.stops.length>0){const V=M.type==="radial"?"radial":"linear",fe=M.direction??M.angle??0,ae=[...M.stops].sort((We,He)=>(We.position??0)-(He.position??0)).map(We=>{const He=(We.color||"").trim(),At=We.position??0,Wt=(We.opacity??100)/100;if(He.startsWith("#")){const Jt=parseInt(He.slice(1,3),16),$s=parseInt(He.slice(3,5),16),Kt=parseInt(He.slice(5,7),16);return`rgba(${Jt}, ${$s}, ${Kt}, ${Wt}) ${At}%`}if(He.startsWith("rgb(")||He.startsWith("rgba(")){const Jt=He.match(/rgba?\(([^)]+)\)/i);if(Jt){const $s=Jt[1].split(",").map(rn=>rn.trim()),[Kt,Us,es]=$s;return`rgba(${Kt}, ${Us}, ${es}, ${Wt}) ${At}%`}}return`${He} ${At}%`});return V==="radial"?`radial-gradient(circle, ${ae.join(", ")})`:`linear-gradient(${fe}deg, ${ae.join(", ")})`}return""}function _c(M){return Math.max(0,Math.min(1,M))}function Ea(M){const V=(M||"").trim();if(!V)return null;if(/^#([0-9a-fA-F]{6})$/.test(V)){const me=V.slice(1);return{r:parseInt(me.slice(0,2),16),g:parseInt(me.slice(2,4),16),b:parseInt(me.slice(4,6),16),a:1}}if(/^#([0-9a-fA-F]{3})$/.test(V)){const me=V.slice(1);return{r:parseInt(me[0]+me[0],16),g:parseInt(me[1]+me[1],16),b:parseInt(me[2]+me[2],16),a:1}}const fe=V.match(/^rgba?\(([^)]+)\)$/i);if(fe){const me=fe[1].split(",").map(ae=>ae.trim());if(me.length>=3){const ae=Number(me[0]),We=Number(me[1]),He=Number(me[2]);if(Number.isFinite(ae)&&Number.isFinite(We)&&Number.isFinite(He)){const At=me.length>=4&&Number.isFinite(Number(me[3]))?_c(Number(me[3])):1;return{r:ae,g:We,b:He,a:At}}}}return null}function Tf(M){if(!M)return 1;if(typeof M.opacity=="number")return _c(M.opacity/100);if(typeof M.alpha=="number"){const V=M.alpha;return _c(V>1?V/100:V)}return 1}function Sr(M,V,fe){const me=Math.max(0,Math.min(255,Math.round(M))).toString(16).padStart(2,"0"),ae=Math.max(0,Math.min(255,Math.round(V))).toString(16).padStart(2,"0"),We=Math.max(0,Math.min(255,Math.round(fe))).toString(16).padStart(2,"0");return`#${me}${ae}${We}`}function Oa(M){if(!M||!Array.isArray(M.stops)||!M.stops.length)return"";const V=[...M.stops].sort((es,rn)=>(es.position??es.offset??0)-(rn.position??rn.offset??0)),fe=V[0],me=V[V.length-1],ae=((fe==null?void 0:fe.color)||"").trim(),We=((me==null?void 0:me.color)||"").trim(),He=Ea(ae),At=Ea(We);if(!He&&!At)return We||ae||"";if(!He)return We||"";if(!At)return ae||"";const Wt=.5,Jt=Math.round(He.r*(1-Wt)+At.r*Wt),$s=Math.round(He.g*(1-Wt)+At.g*Wt),Kt=Math.round(He.b*(1-Wt)+At.b*Wt),Us=Tf(fe)*He.a*(1-Wt)+Tf(me)*At.a*Wt;return Us<1?`rgba(${Jt}, ${$s}, ${Kt}, ${_c(Us)})`:Sr(Jt,$s,Kt)}function lr(){var M,V,fe,me,ae,We,He,At,Wt,Jt,$s,Kt;if(!bo){ws=!0;try{const Us=n().styles;if(!Us)return;const es=lp(n().theme),rn=Ys.get(es,"pane.backgroundColor")||(n().theme==="dark"?"#0A0F1A":"#ffffff"),pn=n().theme==="dark"?"#ffffff":"#0A0F1A",Nn=Us.backgroundType||"solid",js=document.querySelector(".duty-main"),qt=document.querySelector(".duty-widget");let Os="";const zs=Nn==="gradient"&&!!Us.backgroundGradient;if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!zs){const ro=ys=>{if(!ys)return"";const qs=ys,is=(window.getComputedStyle(qs).getPropertyValue("--chart-background-color")||"").trim(),ts=(qs.style.background||qs.style.backgroundColor||"").trim();return is||ts||""};Os=ro(js)||ro(qt)}if(!window.__forceApplyThemeDefaults&&!window.__forceApplySavedCanvasColors&&!zs&&Os)[js,qt].forEach(ro=>{ro&&(ro.style.background=Os,ro.style.backgroundColor=Os,ro.style.setProperty("--chart-background-color",Os))}),p("🎨 Preserved live preview background:",Os);else if(Nn==="solid"){let ro=Us.backgroundColor||rn;const ys=(Us.backgroundOpacity??100)/100,qs=typeof Us.backgroundColor=="string"&&Us.backgroundColor.trim().toLowerCase()===pn.toLowerCase(),Js=!!Us.backgroundType||!!Us.backgroundGradient||typeof Us.backgroundOpacity=="number";qs&&!Js&&(ro=rn);let is=ro;if(ys!==1&&ro.startsWith("#")){const ts=parseInt(ro.slice(1,3),16),Ss=parseInt(ro.slice(3,5),16),ln=parseInt(ro.slice(5,7),16);is=`rgba(${ts}, ${Ss}, ${ln}, ${ys})`}[js,qt].forEach(ts=>{ts&&(ts.style.background=is,ts.style.backgroundColor=is,ts.style.setProperty("--chart-background-color",is))}),p("🎨 Applied saved background color:",is)}else if(Nn==="gradient"&&Us.backgroundGradient){const ro=Us.backgroundGradient,ys=ro.css||mp(ro);[js,qt].forEach(qs=>{qs&&(qs.style.background=ys,qs.style.backgroundColor=ys,qs.style.setProperty("--chart-background-color",ys))}),p("🎨 Applied saved gradient background:",ys)}const mn=Us.gridType||"solid",un=Ys.get(es,"grid.horizontal.color")||(n().theme==="dark"?"#111B2B":"#F3F3F3"),jn=n().theme==="dark"?"#F3F3F3":"#111B2B";if(o()&&mn==="solid"){const ro=((V=(M=o()).getStyles)==null?void 0:V.call(M))??{},ys=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:Ys.get(ro,"grid.horizontal.color")||Ys.get(ro,"grid.vertical.color"),qs=((me=(fe=Us.grid)==null?void 0:fe.horizontal)==null?void 0:me.color)||((We=(ae=Us.grid)==null?void 0:ae.vertical)==null?void 0:We.color),Js=typeof Us.gridOpacity=="number"?Us.gridOpacity:100,is=Math.max(0,Math.min(100,Js))/100;let ts=ys||qs||un;const Ss=!ys&&typeof qs=="string"&&qs.trim().toLowerCase()===jn.toLowerCase(),ln=!!Us.gridType||!!Us.gridGradient||typeof Us.gridOpacity=="number";if(Ss&&!ln&&(ts=un),!ys&&typeof ts=="string"&&ts.startsWith("#")&&is!==1){const yo=parseInt(ts.slice(1,3),16),pr=parseInt(ts.slice(3,5),16),dn=parseInt(ts.slice(5,7),16);ts=`rgba(${yo}, ${pr}, ${dn}, ${is})`}const on=Ys.cloneDeep(ro);Ys.set(on,"grid.horizontal.color",ts),Ys.set(on,"grid.vertical.color",ts),(At=(He=n().styles)==null?void 0:He.candle)!=null&&At.type&&Ys.set(on,"candle.type",n().styles.candle.type),ls?ls(hf(on)):o().setStyles(hf(on)),p("🎨 Applied grid color (preserving preview when available):",ts)}else if(o()&&mn==="gradient"&&Us.gridGradient){const ro=((Jt=(Wt=o()).getStyles)==null?void 0:Jt.call(Wt))??{},ys=window.__forceApplyThemeDefaults||window.__forceApplySavedCanvasColors?void 0:Ys.get(ro,"grid.horizontal.color")||Ys.get(ro,"grid.vertical.color"),qs=Us.gridGradient,Js=Oa(qs),is=ys||Js||un,ts=Ys.cloneDeep(ro);Ys.set(ts,"grid.horizontal.color",is),Ys.set(ts,"grid.vertical.color",is),(Kt=($s=n().styles)==null?void 0:$s.candle)!=null&&Kt.type&&Ys.set(ts,"candle.type",n().styles.candle.type),ls?ls(hf(ts)):o().setStyles(hf(ts)),p("🎨 Applied gradient grid (solid fallback):",is)}}catch(Us){console.error("Error applying canvas colors:",Us)}finally{ws=!1,window.__forceApplyThemeDefaults&&(window.__forceApplyThemeDefaults=!1),window.__forceApplySavedCanvasColors&&(window.__forceApplySavedCanvasColors=!1)}}}Fc(P(),Ro(a).applyCanvasColors=lr,Ro(a)),Bl.setApplyCanvasColorsFunction(lr),Ol.setApplyCanvasColorsFunction(lr);const mr=M=>M?!(M.__alwaysOnTop||M.__forceOnTop||M.alwaysOnTop):!0,Cr=(M,V)=>{var me;if(!(M!=null&&M.getIndicators)||!(M!=null&&M.overrideIndicator))return;const fe=M.getIndicators(V??{})||[];if(!(!Array.isArray(fe)||!fe.length))for(const ae of fe){if(!ae||!mr(ae))continue;const We=ae.paneId??(V==null?void 0:V.paneId)??"candle_pane";if((typeof ae.zLevel=="number"?ae.zLevel:0)===v)continue;const At={paneId:We,zLevel:v};ae.id?At.id=ae.id:ae.name&&(At.name=ae.name),(me=M.overrideIndicator)==null||me.call(M,At)}};let hl=null,ls=null,ws=!1,Fs=null;Xr(()=>{var M;if(o()&&o()!==hl){hl=o(),ls=o().setStyles.bind(o());const V=o().resize.bind(o());Fs=((M=o().createIndicator)==null?void 0:M.bind(o()))??null,Fc(Ge,Ro(o).setStyles=function(fe){const me=ls(fe);return ws||Ui.requestKey("canvas:reapply",()=>lr()),me},Ro(o)),Fc(Ge,Ro(o).resize=function(){const fe=V();return Ui.requestKey("canvas:reapply",()=>lr()),fe},Ro(o)),Fs&&Fc(Ge,Ro(o).createIndicator=function(fe,me,ae){var Jt,$s,Kt,Us,es,rn,pn,Nn,js;const We=this;let He=[];try{const qt=(Jt=We.getPaneOptions)==null?void 0:Jt.call(We);Array.isArray(qt)&&(He=qt)}catch{}const At=Fs(fe,me,ae);if(At)try{Cr(We,{id:At})}catch{}let Wt=[];try{const qt=($s=We.getPaneOptions)==null?void 0:$s.call(We);Array.isArray(qt)&&(Wt=qt)}catch{return At}try{const qt=new Set(He.map(Os=>Os==null?void 0:Os.id).filter(Boolean));for(const Os of Wt){const zs=Os==null?void 0:Os.id;if(zs&&!(zs==="candle_pane"||zs==="x_axis_pane")&&!qt.has(zs)){const mn=typeof Os.height=="number"&&Os.height>0?Os.height:void 0;if(mn!==void 0){const un=((Us=(Kt=We.getSize)==null?void 0:Kt.call(We))==null?void 0:Us.height)??(D==null?void 0:D.clientHeight)??((es=D==null?void 0:D.getBoundingClientRect)==null?void 0:es.call(D).height)??0,jn=((pn=(rn=We.getSize)==null?void 0:rn.call(We))==null?void 0:pn.width)??(D==null?void 0:D.clientWidth)??((Nn=D==null?void 0:D.getBoundingClientRect)==null?void 0:Nn.call(D).width)??0,ys=jn>0&&un>0&&jn>un?.3:.25,qs=Math.round(un*ys),Js=qs>0?qs:mn;try{(js=We.setPaneOptions)==null||js.call(We,{id:zs,height:Js}),p("📏 Set new sub‑pane height by chart ratio",{paneId:zs,baseHeight:mn,ratio:ys,chartHeight:un,newHeight:Js})}catch{}}}}}catch{}return At},Ro(o));try{Cr(o())}catch{}}});let to=`${((Cp=n().period)==null?void 0:Cp.timespan)||""}_${((vf=n().period)==null?void 0:vf.multiplier)||""}`;Xr(()=>{const M=n().period;if(!o()||!M||!M.timespan)return;const fe={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[M.timespan]??"day",me=Number(M.multiplier)||1,ae=`${fe}_${me}`;if(ae!==to){to=ae;try{o().setPeriod({type:fe,span:me});const We=lp(n().theme);Ys.merge(We,Ag(n().styles)),o().setStyles(hf(We))}catch{}}}),io().then(()=>{p("📊 allSymbols length:",n().allSymbols.length)}).catch(M=>{console.error("❌ loadSymbols failed:",M)}),sm(async()=>{var Jt,$s,Kt,Us,es,rn,pn,Nn,js,qt,Os,zs,mn,un,jn,ro;if(!D){console.error("❌ chartRef is not available");return}Um||(Um=()=>{if(!Cm("interactionV2"))return;const{endedId:ys}=rx();ys&&(b(ch,""),b(Vh,"")),ys&&rf()},window.addEventListener("mouseup",Um)),dv||(dv=()=>{if(!Cm("interactionV2"))return;const{endedId:ys}=rx();ys&&(b(ch,""),b(Vh,"")),ys&&rf()},window.addEventListener("touchend",dv)),!Dm&&D&&(Dm=ys=>{if(!Cm("interactionV2")||ys.button!==0)return;const qs=Gn(ys),Js=!!(qs&&(qs.selectedId||qs.draggingId||qs.resizingId));ys.__interactionV2Handled=Js,Js&&(ys.preventDefault(),ys.stopPropagation(),ys.stopImmediatePropagation())},D.addEventListener("mousedown",Dm,{capture:!0})),xh||(xh=ys=>{if(!Cm("interactionV2")||!i(ch)&&!i(Vh)||D&&ys.target instanceof Node&&D.contains(ys.target))return;const qs=D==null?void 0:D.getBoundingClientRect();if(!qs)return;const Js=ys.clientX-qs.left,is=ys.clientY-qs.top,ts=Pk(ys),{hoverId:Ss,draggingId:ln,resizingId:on,cursor:yo}=Fk(Js,is,cd,ts);b(sc,H(Ss??"")),b(ch,H(ln??"")),b(Vh,H(on??"")),rf(yo),si(),ys.preventDefault(),ys.stopPropagation(),ys.stopImmediatePropagation()},window.addEventListener("mousemove",xh)),!Iv&&D&&(Iv=ys=>{if(!Cm("interactionV2")||!i(Xf))return;const qs=ys.key;qs!=="Escape"&&qs!=="Delete"&&qs!=="Backspace"&&!(qs==="ArrowLeft"||qs==="ArrowRight"||qs==="ArrowUp"||qs==="ArrowDown")||_o(ys)},D.addEventListener("keydown",Iv,{capture:!0}));try{let ys=!1;typeof window<"u"&&(ys=!!localStorage.getItem("chart.activeSaveId")),ys&&bl.set(!0)}catch{}($s=(Jt=n().styles)==null?void 0:Jt.candle)!=null&&$s.type||T().update(ys=>(ys.styles=ys.styles||{},ys.styles.candle=ys.styles.candle||{},ys.styles.candle.type="renko_atr",ys.styles.candle.renko||(ys.styles.candle.renko={method:"ATR",atrLength:14,source:"close",wick:!1}),ys));const M=lp(n().theme),V=Ys.merge({},M,n().styles);if(p("🎨 onMount - Theme styles:",JSON.stringify(M,null,2)),p("💾 onMount - Saved styles:",JSON.stringify(n().styles,null,2)),p("🔄 onMount - Merged styles:",JSON.stringify(V,null,2)),D6(Ge,H(wI(D,{styles:(()=>{var ys,qs,Js,is,ts,Ss,ln,on,yo,pr,dn,Fo,Dn,Yo,Fi,fo,Pn,ii,Dr,ni,Xo,sr,Sl,Ru;try{if((qs=(ys=V==null?void 0:V.candle)==null?void 0:ys.tooltip)!=null&&qs.legend){const rl=V.candle.tooltip.legend.color;V.candle.tooltip.legend.template=({current:Vi})=>{const Xl="#32CD32",Hc="#FF0000",Da=((Vi==null?void 0:Vi.close)??0)>((Vi==null?void 0:Vi.open)??0),gf=((Vi==null?void 0:Vi.close)??0)<((Vi==null?void 0:Vi.open)??0),ju=Da?Xl:gf?Hc:rl,Ka=tf=>({text:tf,color:ju});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:Ka("{open}")},{title:"H",value:Ka("{high}")},{title:"L",value:Ka("{low}")},{title:"C",value:Ka("{close}")},{title:"V",value:Ka("{volume}")}]:[{title:"O",value:Ka("{open}")},{title:"H",value:Ka("{high}")},{title:"L",value:Ka("{low}")},{title:"C",value:Ka("{close}")},{title:"V",value:Ka("{volume}")}]}}}catch{}try{const rl=(ts=(is=(Js=M==null?void 0:M.xAxis)==null?void 0:Js.tickText)==null?void 0:is.style)==null?void 0:ts.color,Vi=(on=(ln=(Ss=M==null?void 0:M.yAxis)==null?void 0:Ss.tickText)==null?void 0:ln.style)==null?void 0:on.color;if(rl&&((pr=(yo=V==null?void 0:V.xAxis)==null?void 0:yo.tickText)!=null&&pr.style)&&(V.xAxis.tickText.style.color=rl,(dn=V==null?void 0:V.xAxis)!=null&&dn.tickText)){delete V.xAxis.tickText.color,delete V.xAxis.tickText.opacity,V.xAxis.tickText.color=rl;try{T().update(Da=>(Da.styles||(Da.styles={}),Ys.unset(Da.styles,"xAxis.tickText.color"),Ys.unset(Da.styles,"xAxis.tickText.opacity"),Ys.set(Da.styles,"xAxis.tickText.style.color",rl),Da))}catch{}}if(Vi&&((Dn=(Fo=V==null?void 0:V.yAxis)==null?void 0:Fo.tickText)!=null&&Dn.style)&&(V.yAxis.tickText.style.color=Vi,(Yo=V==null?void 0:V.yAxis)!=null&&Yo.tickText)){delete V.yAxis.tickText.color,delete V.yAxis.tickText.opacity,V.yAxis.tickText.color=Vi;try{T().update(Da=>(Da.styles||(Da.styles={}),Ys.unset(Da.styles,"yAxis.tickText.color"),Ys.unset(Da.styles,"yAxis.tickText.opacity"),Ys.set(Da.styles,"yAxis.tickText.style.color",Vi),Da))}catch{}}const Xl=(Pn=(fo=(Fi=M==null?void 0:M.candle)==null?void 0:Fi.tooltip)==null?void 0:fo.legend)==null?void 0:Pn.color,Hc=(ni=(Dr=(ii=M==null?void 0:M.indicator)==null?void 0:ii.tooltip)==null?void 0:Dr.legend)==null?void 0:ni.color;if(Xl&&((sr=(Xo=V==null?void 0:V.candle)==null?void 0:Xo.tooltip)!=null&&sr.legend)){V.candle.tooltip.legend.color=Xl;try{T().update(Da=>(Da.styles||(Da.styles={}),Ys.set(Da.styles,"candle.tooltip.legend.color",Xl),Da))}catch{}}if(Hc&&((Ru=(Sl=V==null?void 0:V.indicator)==null?void 0:Sl.tooltip)!=null&&Ru.legend)){V.indicator.tooltip.legend.color=Hc;try{T().update(Da=>(Da.styles||(Da.styles={}),Ys.set(Da.styles,"indicator.tooltip.legend.color",Hc),Da))}catch{}}}catch{}try{const rl=V.crosshair??{},Vi=rl.vertical??{},Xl=Vi.text??{};V.crosshair={...rl,show:rl.show??!0},V.crosshair.vertical={...Vi,show:Vi.show??!0},V.crosshair.vertical.text={...Xl,show:!0}}catch{}return hf(V)})(),decimalFold:{threshold:999,format:S},formatter:{formatDate:({timestamp:ys,template:qs,type:Js})=>Bw(n().period.timespan)(ys,qs,Js)}}))),o()){const ys=is=>(is||"").toUpperCase(),qs=is=>{var ln,on;const ts=(on=(ln=n().allSymbols)==null?void 0:ln.find)==null?void 0:on.call(ln,yo=>ys(yo.ticker)===ys(is));return ts!=null&&ts.name?ts.name:{GP:"Grameen Phone",DSEBD:"DSE Board Index",DSEX:"Dhaka Stock Exchange"}[ys(is)]||""},Js={...n().symbol,ticker:n().symbol.ticker,name:n().symbol.name||qs(n().symbol.ticker)||n().symbol.ticker,pricePrecision:w_(n().symbol),volumePrecision:n().symbol.volumePrecision};o().setSymbol(Js);try{const is=n().period;if(is!=null&&is.timespan&&(is!=null&&is.multiplier)){const Ss={second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month",year:"year",s:"second",m:"minute",h:"hour",d:"day",w:"week"}[is.timespan]??"day",ln=Number(is.multiplier)||1;o().setPeriod({type:Ss,span:ln})}}catch{}}if(ba(),o()){const ys=qs=>{var on,yo,pr,dn;const Js=typeof qs=="object"&&qs&&"paneId"in qs?qs.paneId:void 0;if(!Js)return;const is=Js.startsWith("pane_script")||Te.some(Fo=>Fo.paneId===Js),ts=is?rc(Js):null,Ss=(yo=(on=ts==null?void 0:ts.axis)==null?void 0:on.getRange)==null?void 0:yo.call(on),ln=(dn=(pr=ts==null?void 0:ts.axis)==null?void 0:pr.getAutoCalcTickFlag)==null?void 0:dn.call(pr);qi.has(Js)&&zl(Js),is&&requestAnimationFrame(()=>{var Fo,Dn,Yo,Fi,fo,Pn;ts!=null&&ts.axis&&Ss&&is&&((Dn=(Fo=ts.axis).setRange)==null||Dn.call(Fo,Ss),(Fi=(Yo=ts.axis).buildTicks)==null||Fi.call(Yo,!0),ln&&((Pn=(fo=ts.axis).setAutoCalcTickFlag)==null||Pn.call(fo,!0)))})};(Us=(Kt=o()).subscribeAction)==null||Us.call(Kt,ig.OnPaneDrag,ys),El=()=>{var qs,Js;return(Js=(qs=o())==null?void 0:qs.unsubscribeAction)==null?void 0:Js.call(qs,ig.OnPaneDrag,ys)}}try{const ys=(rn=(es=n().styles)==null?void 0:es.candle)==null?void 0:rn.type;o()&&(ys==="renko_atr"||ys==="point_and_figure"||ys==="heikin_ashi")&&Bl.switchChartType({chart:o(),newType:ys,reloadDataFn:async()=>{await qr()}})}catch{}if(o()){const ys=new iX(o()),qs=new aX(o()),Js=new lX(o()),is=c4(o());hX(is),qs.setProjectionManager(ys),qs.setCreationManager(Js),qs.initialize(),fl=KR({chart:o(),persistenceKey:n().key+"_drawings",onDrawingCreated:Ss=>{p("✅ Drawing created:",Ss.id,"for symbol:",Ss.symbolKey)},onDrawingRemoved:(Ss,ln)=>{},onSymbolChanged:(Ss,ln)=>{}});const ts=a0(n().symbol);fl.setCurrentSymbol(ts),Js.setCurrentSymbolKey(ts),typeof window<"u"&&(window.overlayCreationManager=Js)}Fc(P(),Ro(a).cloudIndLoaded+=1,Ro(a)),Ek.set(n().symbol),ax.set(n().period),await io();try{window.__datafeed=C,window.__pipelineMetrics=()=>{var ys;return(ys=C.getPipelineMetrics)==null?void 0:ys.call(C)}}catch{}window.addEventListener("resize",tc);let fe=o();try{nl=new ResizeObserver(()=>{tc()}),D&&nl.observe(D),i(it)&&nl.observe(i(it)),i(Je)&&nl.observe(i(Je))}catch{}const me=()=>{Jr||Te.length&&(Jr=!0,Ui.requestKey("script-view:redraw",()=>{var ys;Jr=!1;try{(ys=o())==null||ys.updatePane(qb.Drawer)}catch{}try{ed()}catch{}}))},ae=()=>{o()&&Ui.requestKey("chart:redraw",()=>{try{o().updatePane(qb.All)}catch{}})},We=()=>{me(),ca(),ae()},He=()=>{me(),ca(),ae()},At=ys=>{var ln,on;const qs=!ys||ys&&ys.x==null&&ys.y==null;if(!qs&&ys&&typeof ys.x=="number"&&typeof ys.y=="number"&&(b(Xe,H(ys.x)),b(Dp,H(ys.y)),se.length&&sp()),!qs||!D)return;const Js=D.getBoundingClientRect();if(!(i(nm)>=Js.left&&i(nm)<=Js.right&&i(Sp)>=Js.top&&i(Sp)<=Js.bottom))return;const ts=i(nm)-Js.left,Ss=i(Sp)-Js.top;try{(on=(ln=o())==null?void 0:ln.getChartStore)==null||on.call(ln).setCrosshair({x:ts,y:Ss,paneId:"candle_pane"},{forceInvalidate:!0})}catch{}};if(o()&&((Nn=(pn=o()).subscribeAction)==null||Nn.call(pn,ig.OnZoom,We),(qt=(js=o()).subscribeAction)==null||qt.call(js,ig.OnScroll,He),(zs=(Os=o()).subscribeAction)==null||zs.call(Os,ig.OnCrosshairChange,At),_a=()=>{var ys,qs;return(qs=(ys=o())==null?void 0:ys.unsubscribeAction)==null?void 0:qs.call(ys,ig.OnZoom,We)},dl=()=>{var ys,qs;return(qs=(ys=o())==null?void 0:ys.unsubscribeAction)==null?void 0:qs.call(ys,ig.OnScroll,He)},ar=()=>{var ys,qs;return(qs=(ys=o())==null?void 0:ys.unsubscribeAction)==null?void 0:qs.call(ys,ig.OnCrosshairChange,At)}),setTimeout(()=>{var ys,qs;if(fe)try{const Js=((ys=fe.getDataList)==null?void 0:ys.call(fe))??[];Array.isArray(Js)&&Js.length>0&&b(Ht,!0);const is=(qs=fe.getVisibleRange)==null?void 0:qs.call(fe);(Array.isArray(Js)&&Js.length>0&&is&&typeof is.to=="number"?is.to>=Js.length-2:!1)&&fe.scrollToRealTime()}catch{}},100),Ai){try{Ai()}catch{}Ai=null}Ai=cr(fe);const Wt=lp(n().theme);Ys.merge(Wt,Ag(n().styles)),(mn=o())==null||mn.setStyles(hf(Wt)),lr();try{const ys=()=>{var on,yo,pr,dn,Fo,Dn,Yo,Fi,fo,Pn,ii,Dr,ni;if(!o())return;const ts=o();let Ss=[];try{Ss=((on=ts.getIndicators)==null?void 0:on.call(ts))??[]}catch{Ss=[]}const ln=Object.entries(n().saveInds||{});for(const[,Xo]of ln){const sr=Xo==null?void 0:Xo.name;if(!sr)continue;const Sl=(Xo==null?void 0:Xo.pane_id)||"";if(Ss.some(Hc=>Hc.name===sr&&(!Sl||Hc.paneId===Sl)))continue;let rl;if(Array.isArray(Xo.styles)&&Xo.styles.length>0){const Hc=Da=>Da==="dashed"||Da==="dotted"?{style:mt.Dashed,dashedValue:Da==="dotted"?[2,2]:[4,4]}:{style:mt.Solid,dashedValue:[2,2]};rl={lines:Xo.styles.map(Da=>{const gf=Hc(Da==null?void 0:Da.lineStyle);return{color:Da==null?void 0:Da.color,size:(Da==null?void 0:Da.thickness)??1,style:gf.style,dashedValue:gf.dashedValue}})}}let Vi;if(sr==="SMARTTREND"){const Hc=Xo.superTrendGroup;if(Vi=Hc?{showLabels:!!Hc.showLabels,uptrendColor:((pr=(yo=Hc.styles)==null?void 0:yo.uptrend)==null?void 0:pr.color)??"#00FF00",downtrendColor:((Fo=(dn=Hc.styles)==null?void 0:dn.downtrend)==null?void 0:Fo.color)??"#FF0000",uptrendThickness:((Yo=(Dn=Hc.styles)==null?void 0:Dn.uptrend)==null?void 0:Yo.thickness)??1,downtrendThickness:((fo=(Fi=Hc.styles)==null?void 0:Fi.downtrend)==null?void 0:fo.thickness)??1,uptrendLineStyle:((ii=(Pn=Hc.styles)==null?void 0:Pn.uptrend)==null?void 0:ii.lineStyle)??"dashed",downtrendLineStyle:((ni=(Dr=Hc.styles)==null?void 0:Dr.downtrend)==null?void 0:ni.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!rl){const Da=Vi.uptrendLineStyle==="dotted"||Vi.uptrendLineStyle==="dashed";rl={lines:[{color:Vi.uptrendColor,size:Vi.uptrendThickness,style:Da?mt.Dashed:mt.Solid,dashedValue:Vi.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const Xl=Sl==="candle_pane";try{ts.createIndicator({name:sr,calcParams:Xo==null?void 0:Xo.params,styles:rl,...Vi?{extendData:Vi}:{}},Xl,Sl?{id:Sl}:void 0)}catch(Hc){console.warn("⚠️ Failed to restore indicator:",sr,Hc)}}};let qs=null;try{qs=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null}catch{}p(qs?"ℹ️ Active layout detected, SaveSystem will restore indicators.":"ℹ️ No active layout, will add default indicators if needed.");const Js=ts=>{try{if(!o())return;const Ss=o();p("🎨 Adding default indicators...");const ln="candle_pane";if(Ir())try{Ss.createIndicator({name:"SMARTTREND",calcParams:[10,3],styles:{lines:[{color:"#00FF00",size:1,style:mt.Dashed,dashedValue:[4,4]}]},extendData:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"}},!0,{id:ln})&&T().update(yo=>(yo.saveInds[`${ln}_SMARTTREND`]={name:"SMARTTREND",pane_id:ln,params:[10,3]},yo))}catch{}try{const on="candle_pane";Ss.createIndicator({name:"VOL",calcParams:[20],styles:{lines:[]}},!0,{id:on})&&T().update(pr=>(pr.saveInds[`${on}_VOL`]={name:"VOL",pane_id:on,params:[20]},pr))}catch{}p("✅ Default indicators applied",{force:ts})}catch(Ss){console.warn("⚠️ Failed to add default indicators:",Ss)}};let is=!1;try{const ts=(un=performance.getEntriesByType)==null?void 0:un.call(performance,"navigation");ts&&ts.length>0?is=ts[0].type==="reload":performance.navigation&&(is=performance.navigation.type===1)}catch{}T().update(ts=>(ts.saveInds={},ts)),qs?(p("✅ Active saved layout will be restored by SaveSystem"),setTimeout(()=>{var ts,Ss;try{const ln=typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null,on=((Ss=(ts=o())==null?void 0:ts.getIndicators)==null?void 0:Ss.call(ts))??[];!ln&&(!on||on.length===0)&&(p("🛟 No active layout after restore attempt; applying default indicators"),Js(!0))}catch{}},500)):(p("🎨 No saved layout found, adding default indicators"),setTimeout(()=>{try{(typeof window<"u"?localStorage.getItem("chart.activeSaveId"):null)?p("ℹ️ activeSaveId appeared; skipping default indicators"):Js(!0)}catch{Js(!0)}},250))}catch(ys){console.warn("⚠️ Indicator restore failed:",ys)}if(((ro=(jn=n().styles)==null?void 0:jn.candle)==null?void 0:ro.type)==="point_and_figure"&&o())try{o().createIndicator("PNF",!1,{id:"candle_pane"}),p("📊 Added PNF indicator for initial Point & Figure chart")}catch(ys){console.warn("Failed to add initial PNF indicator:",ys)}Fc(P(),Ro(a).initDone+=1,Ro(a)),j()||setTimeout(()=>{o()&&!a().loadingDuty&&qr()},100),io(),setTimeout(()=>{p("🔍 Current allSymbols:",n().allSymbols),p("🔍 allSymbols length:",n().allSymbols.length)},3e3),D==null||D.focus();try{typeof window<"u"&&(window.drawBarRef=i(nt),window.sidebarHostRef=i(ze),window.predictNextCandle=()=>af(),window.getAutoPlayState=()=>i(Zf),window.getPlaybackSpeed=()=>i(pg),window.setPlaybackSpeed=ys=>ru(ys),window.stopPrediction=()=>nc())}catch{}ai=ys=>{if(!r2())return;(ys.key==="F5"||(ys.metaKey||ys.ctrlKey)&&(ys.key==="r"||ys.key==="R"))&&(ys.preventDefault(),ys.stopPropagation(),b(xr,!0))},window.addEventListener("keydown",ai,{capture:!0}),vi=ys=>{var qs,Js;if(r2()){try{const is=(((qs=n())==null?void 0:qs.key)||"chart")+"_drawings";localStorage.removeItem(is)}catch{}try{const is=(((Js=n())==null?void 0:Js.key)||"chart")+"_overlays";localStorage.removeItem(is)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}ys.preventDefault(),ys.returnValue=""}},window.addEventListener("beforeunload",vi),setTimeout(()=>{const ys=D==null?void 0:D.querySelectorAll(".dutycharts-pane-separator");ys==null||ys.forEach(qs=>{const Js=qs;Js.style.transition="background-color 0.2s ease, transform 0.1s ease",Js.addEventListener("mouseenter",()=>{Js.style.cursor="row-resize",Js.style.transform="scaleY(1.2)"}),Js.addEventListener("mouseleave",()=>{Js.style.transform="scaleY(1)"}),Js.addEventListener("mousedown",()=>{Js.classList.add("dragging"),document.body.style.cursor="row-resize"});const is=()=>{Js.classList.remove("dragging"),document.body.style.cursor=""};document.addEventListener("mouseup",is),Js.addEventListener("touchstart",ts=>{ts.preventDefault(),Js.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(10)}),Js.addEventListener("touchend",()=>{Js.classList.remove("dragging")})})},500)}),Rg(()=>{nc(),Eo&&(clearTimeout(Eo),Eo=null),hr&&(cancelAnimationFrame(hr),hr=null),ai&&window.removeEventListener("keydown",ai,{capture:!0}),vi&&window.removeEventListener("beforeunload",vi);try{const M=qu}catch{}try{window.removeEventListener("resize",tc)}catch{}if(_a){try{_a()}catch{}_a=null}if(dl){try{dl()}catch{}dl=null}if(ar){try{ar()}catch{}ar=null}if(Um&&(window.removeEventListener("mouseup",Um),Um=null),dv&&(window.removeEventListener("touchend",dv),dv=null),Dm&&D&&(D.removeEventListener("mousedown",Dm,{capture:!0}),Dm=null),xh&&(window.removeEventListener("mousemove",xh),xh=null),Iv&&D&&(D.removeEventListener("keydown",Iv,{capture:!0}),Iv=null),El){try{El()}catch{}El=null}if(nl){try{nl.disconnect()}catch{}nl=null}if(Ai){try{Ai()}catch{}Ai=null}o()&&ac(o())});function cr(M){let V=null,fe=!1,me=0;const ae=800;let We=0;const He=5;let At=null,Wt=!1;const Jt=()=>{try{if(Wt)return;const Us=M.getVisibleRange();if(!Us||fe)return;const es=M.getDataList();if(es.length===0)return;const rn=es.length-1;Kn=Us.to>=rn-1;const Nn=Us.to-Us.from;At=Nn;const js=Math.max(3,Math.min(15,Math.floor(Nn*.15))),qt=V&&Us.from<V.from,Os=Us.from<=js,zs=!V||Math.abs(Us.from-V.from)>1,mn=Date.now(),un=We>=He?ae*3:ae,jn=mn-me>un;if(Us.from<=Math.max(1,Math.floor(js/2))&&jn||Os&&jn){const Js=es[0];p(`🚀 Infinite scroll triggered: from=${Us.from}, threshold=${js}, dataLength=${es.length}, consecutive=${We}`),$s(Js.timestamp),me=mn,We+=1,setTimeout(()=>{We=Math.max(0,We-1)},ae*1.5)}V={...Us}}catch(Us){console.error("❌ Error checking scroll position:",Us)}},$s=async Us=>{var es,rn,pn,Nn,js,qt,Os,zs,mn,un,jn,ro;if(!(fe||a().loadingDuty||i(Vs))){fe=!0,b(Vs,!0),b(kn,null);try{const qs=((rn=(es=n().styles)==null?void 0:es.candle)==null?void 0:rn.type)==="renko_atr"?Bs??Us:Us,Js=await C.loadMoreHistoricalData(n().symbol,n().period,qs);if(Js.data.length>0){let is=Js.data;if(((Nn=(pn=n().styles)==null?void 0:pn.candle)==null?void 0:Nn.type)==="heikin_ashi")is=s2(is);else if(((qt=(js=n().styles)==null?void 0:js.candle)==null?void 0:qt.type)==="renko_atr"){const on=((zs=(Os=n().styles)==null?void 0:Os.candle)==null?void 0:zs.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};is=n2(is,on);try{const yo=Od(Js.data);yo!=null&&(!Bs||yo<Bs)&&(Bs=yo)}catch{}}else if(((un=(mn=n().styles)==null?void 0:mn.candle)==null?void 0:un.type)==="point_and_figure"){const on=((ro=(jn=n().styles)==null?void 0:jn.candle)==null?void 0:ro.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};is=o2(is,on)}const ts=M.getDataList();is.sort((on,yo)=>on.timestamp-yo.timestamp);const Ss=new Set(ts.map(on=>on.timestamp)),ln=is.filter(on=>!Ss.has(on.timestamp));if(ln.length>0){const on=M.getVisibleRange(),yo=(on==null?void 0:on.to)??null,pr=!on||!ts.length?!1:on.to>=ts.length-2,dn=yo!==null&&ts[yo]?ts[yo].timestamp:null,Fo=[...ln,...ts].sort((Dn,Yo)=>Dn.timestamp-Yo.timestamp);M.applyNewData(Fo,{backward:!0,forward:!0});try{mi()}catch{}try{Fo.length>0&&b(Ht,!0)}catch{}p(`✅ Successfully loaded and merged ${ln.length} more historical bars`),b(kn,null),on&&requestAnimationFrame(()=>{var Dn;try{if(pr){M.scrollToDataIndex(Fo.length-1),p("🎯 Scroll anchored to right edge (pinned)");return}if(dn){M.scrollToTimestamp(dn),p(`🎯 Scroll anchored to timestamp ${dn} (stable)`);return}const Yo=(yo??0)+ln.length;M.scrollToDataIndex(Yo),p(`🎯 Scroll anchored to index ${Yo} (fallback)`)}catch(Yo){const Fi=dn??((Dn=Fo[ln.length])==null?void 0:Dn.timestamp);if(Fi)try{M.scrollToTimestamp(Fi)}catch{}console.warn("Could not maintain scroll position:",Yo)}})}else p("📭 No new unique historical data to add");Js.lays&&Js.lays.length>0&&i(nt)&&Js.lays.forEach(on=>{i(nt).addOverlay(on)})}else p("📭 No historical chunk available from cache at the moment"),Wt=!C.hasMoreServerHistory(n().symbol,n().period)}catch(ys){console.error("❌ Error loading more historical data:",ys),b(kn,H(ys instanceof Error?ys.message:"Failed to load historical data")),jt.addAlert("error",`Failed to load historical data: ${i(kn)}`)}finally{fe=!1,b(Vs,!1)}}},Kt=setInterval(Jt,100);return()=>{clearInterval(Kt)}}async function io(){n().allSymbols||Fc(T(),Ro(n).allSymbols=[],Ro(n)),p("🚀 loadSymbols function called. loadingPairs:",a().loadingPairs,"allSymbols length:",n().allSymbols.length),Fc(P(),Ro(a).loadingPairs=!0,Ro(a));const M=await C.getSymbols();p("📊 Symbols loaded count:",M.length),Fc(T(),Ro(n).allSymbols=M,Ro(n));const V=new Set;M.forEach(fe=>{fe.exchange&&V.add(fe.exchange)}),T().update(fe=>(V.forEach(me=>{fe.allExgs.add(me)}),fe)),Fc(P(),Ro(a).loadingPairs=!1,Ro(a))}async function Yl(M,V,fe,me,ae=!0,We=ri){var js,qt,Os,zs,mn,un,jn,ro,ys,qs,Js;const He=o();if(!He)return;I={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},We===ri&&Fc(P(),Ro(a).loadingDuty=!0,Ro(a));const At=l().url.searchParams.get("strategy"),Wt=du(),Jt=await C.getHistoryDutyData({symbol:M,period:V,from:fe,to:me,strategy:At,sessionMode:Wt.sessionMode,adjustMode:Wt.adjustMode,timezone:Wt.timezone});let Kt=(Jt.data||[]).slice(Math.max(0,(Jt.data||[]).length-600));if(!Kt||Kt.length===0){We===ri&&Fc(P(),Ro(a).loadingDuty=!1,Ro(a));return}const Us=((qt=(js=n().styles)==null?void 0:js.candle)==null?void 0:qt.type)||Dk((zs=(Os=o())==null?void 0:Os.getStyles)==null?void 0:zs.call(Os),n().styles),es=vy(M),rn=Us;if(rn==="heikin_ashi")Kt=s2(Kt);else if(rn==="renko_atr"){try{const ts=Od(Jt.data);ts!=null&&(!Bs||ts<Bs)&&(Bs=ts)}catch{}const is=((un=(mn=n().styles)==null?void 0:mn.candle)==null?void 0:un.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};Kt=n2(Kt,is)}else if(rn==="point_and_figure"){const is=((ro=(jn=n().styles)==null?void 0:jn.candle)==null?void 0:ro.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};Kt=o2(Kt,is)}if(Kt=Kt.map((is,ts)=>((!is.timestamp||isNaN(is.timestamp)||is.timestamp<=0)&&(console.warn(`Invalid timestamp in dutys at index ${ts}:`,is.timestamp),is.timestamp=Date.now()-(Kt.length-ts)*6e4),is)),We!==ri)return;try{let is=w_(M,Jt.data);try{const ln=Array.isArray(Jt.data)?Jt.data[Jt.data.length-1]:null,on=ln&&typeof ln=="object"?Number(ln.close):Array.isArray(ln)?Number(ln[4]):NaN;(Number.isFinite(on)&&Math.abs(on)>=1e4||es==="crypto"&&Number.isFinite(on)&&Math.abs(on)>=1e3)&&(is=2)}catch{}((qs=(ys=He==null?void 0:He.getSymbol)==null?void 0:ys.call(He))==null?void 0:qs.pricePrecision)!==is&&(He==null||He.setSymbol({pricePrecision:is}));const Ss=M==null?void 0:M.pricePrecision;(!Number.isFinite(Ss)||Ss!==is)&&T().update(ln=>(ln.symbol&&ln.symbol.ticker===M.ticker&&(ln.symbol.pricePrecision=is),ln))}catch{}const pn=rn==="renko_atr",Nn=!pn&&ae&&Kt.length>0;He.applyNewData(Kt,!!Nn);try{mi()}catch{}try{(Kt??[]).length>0&&b(Ht,!0)}catch{}try{C.startBackgroundPrefetch(M,{timeframe:V.timeframe})}catch{}if(Jt.lays&&Jt.lays.length>0&&i(nt)&&Jt.lays.forEach(is=>{i(nt).addOverlay(is)}),We===ri&&Fc(P(),Ro(a).loadingDuty=!1,Ro(a)),Fc(P(),Ro(a).dutyLoaded+=1,Ro(a)),Kt.length){const is=fp(V.timeframe)*1e3,ts=new Date().getTime(),Ss=Kt[Kt.length-1].timestamp+is;!pn&&Ss+is>ts&&(((Js=n().options)==null?void 0:Js.enableRealtime)===!0||r().playing===!0)&&C.subscribe(M,on=>{var Sl,Ru;const yo=on;if(!(M.exchange==="DSEBD"?(()=>{var ju,Ka,Gu;const rl=new Date,Vi=new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Dhaka",hour12:!1,weekday:"short",hour:"2-digit",minute:"2-digit"}).formatToParts(rl),Xl=((ju=Vi.find(tf=>tf.type==="weekday"))==null?void 0:ju.value)??"",Hc=Number(((Ka=Vi.find(tf=>tf.type==="hour"))==null?void 0:Ka.value)??"0"),Da=Number(((Gu=Vi.find(tf=>tf.type==="minute"))==null?void 0:Gu.value)??"0"),gf=Hc*60+Da;return["Sun","Mon","Tue","Wed","Thu"].includes(Xl)&&gf>=600&&gf<=870})():!0))return;const dn=He.getDataList(),Fo=dn[dn.length-1],Dn=Fo&&Fo.timestamp?[Fo.timestamp,Fo.open,Fo.high,Fo.low,Fo.close,Fo.volume??0]:null,Yo=HR(yo.bars,yo.secs*1e3,is,Dn),Fi=He.getChartStore(),fo=He.getVisibleRange(),Pn=He.getDataList(),ii=fo&&Pn[fo.from]?Pn[fo.from].timestamp:null,Dr=Pn.length-1,ni=fo?fo.to>=Dr-1:!0,Xo=Pn&&Pn.length?Number(((Sl=Pn[Pn.length-1])==null?void 0:Sl.timestamp)??0):0,sr=Yo.map(([rl,Vi,Xl,Hc,Da,gf])=>({timestamp:rl,open:Vi,high:Xl,low:Hc,close:Da,volume:gf}));Fi.addData(sr,"backward",{forward:ni,backward:!1});try{const rl=He.getDataList();Array.isArray(rl)&&rl.length>0&&b(Ht,!0);const Vi=rl&&rl.length?Number(((Ru=rl[rl.length-1])==null?void 0:Ru.timestamp)??0):0;if(Vi>0){const Xl=Vi>Xo;I.active=!0,I.lastUpdateAt=Date.now(),I.lastBarTs=Vi,Xl&&(I.lastNewBarIndex=rl.length-1),I.lastNewBarIndex<0&&(I.lastNewBarIndex=rl.length-1)}}catch{}!ni&&fo&&ii&&requestAnimationFrame(()=>{try{const Vi=He.getDataList().findIndex(Xl=>Xl.timestamp===ii);Vi!==-1?He.scrollToDataIndex(Vi):He.scrollToDataIndex(fo.from)}catch{}})})}}async function na(){b(Ht,!1);const M=Rw(n().dateStart);let V=Rw(n().dateEnd);if(!M||!V){jt.addAlert("error","invalid time, please use: 202301011200");return}const fe=fp(n().period.timeframe)*1e3;(V-M)/fe>E&&(V=M+fe*E),await Yl(n().symbol,n().period,M,V,!1)}const Od=M=>{if(!Array.isArray(M)||M.length===0)return null;let V=1/0;for(const fe of M){const me=fe==null?void 0:fe.timestamp,ae=typeof me=="number"?me:Number(me);Number.isFinite(ae)&&ae<V&&(V=ae)}return Number.isFinite(V)?V:null};async function qr(M){b(Ht,!1);const V=n().symbol,fe=n().period;p("🔄 Loading symbol:",V.ticker,"period:",fe.timeframe);const me=new Date().getTime(),[ae,We]=AI(fe,me,xt),He=M??ri,At=V.ticker,Wt=fe.timeframe;try{await Yl(V,fe,ae,me,!j(),He)}catch(Jt){console.warn("⚠️ loadSymbolPeriod failed:",Jt)}try{setTimeout(()=>{var Jt;try{if(He!==ri||At!==n().symbol.ticker||Wt!==n().period.timeframe)return;const $s=o(),Kt=((Jt=$s==null?void 0:$s.getDataList)==null?void 0:Jt.call($s))??[];if(!Array.isArray(Kt)||Kt.length===0){const Us=He;p("🔁 Retrying loadSymbolPeriod due to empty data after TF change"),Yl(V,fe,ae,me,!j(),Us)}}catch{}},250)}catch{}}pp(T(),M=>M.period.timeframe).subscribe(async M=>{var fe,me,ae,We,He,At,Wt,Jt,$s,Kt,Us;const V=((me=(fe=n().styles)==null?void 0:fe.candle)==null?void 0:me.type)==="renko_atr";try{if(!V){const es=`${n().period.timespan}`;if(Qi!==es){const rn=Bw(n().period.timespan),pn=new Map,Nn=800,js=({timestamp:zs,template:mn,type:un})=>{const jn=`${un}|${mn}|${zs}`,ro=pn.get(jn);if(ro)return ro;const ys=rn(zs,mn,un);return pn.size>=Nn&&pn.clear(),pn.set(jn,ys),ys},qt=o(),Os=(ae=qt==null?void 0:qt.getChartStore)==null?void 0:ae.call(qt);Os!=null&&Os.setFormatter&&(Os.setFormatter({formatDate:js}),Qi=es)}}}catch{}ax.set(n().period);try{const es=n().period,pn={s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month"}[es.timespan]??"day",Nn=Number(es.multiplier)||1;((He=(We=n().styles)==null?void 0:We.candle)==null?void 0:He.type)!=="renko_atr"&&((At=o())==null||At.setPeriod({type:pn,span:Nn}))}catch{}if(Bs=null,!(j()||!o())){try{C.unsubscribe()}catch{}if(I={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1},!V&&bo&&(bo=!1),V){lo+=1;const es=lo,rn=Ti();bo=!0;try{try{(Wt=o())==null||Wt.setScrollEnabled(!1),(Jt=o())==null||Jt.setZoomEnabled(!1)}catch{}try{b(Ht,!1)}catch{}try{($s=o())==null||$s.applyNewData([],!1)}catch{}try{const pn=C;typeof pn.stopSymbolPipelines=="function"&&pn.stopSymbolPipelines(n().symbol.ticker)}catch{}await qr(rn),ri===rn&&lo===es&&(bo=!1,Ui.requestKey("renko:resize",()=>{var pn;try{(pn=o())==null||pn.resize()}catch{}lr()}))}catch(pn){console.warn("⚠️ Renko timeframe refresh failed:",pn)}finally{try{(Kt=o())==null||Kt.setScrollEnabled(!0),(Us=o())==null||Us.setZoomEnabled(!0)}catch{}lo===es&&(bo=!1)}}else Bl.changeTimeframe({chart:o(),period:n().period,loadDataFn:async()=>{const es=Ti();try{b(Ht,!1)}catch{}await qr(es)}});if(Ai){try{Ai()}catch{}Ai=null}o()&&(Ai=cr(o()))}}),pp(T(),M=>M.symbol.ticker).subscribe(M=>{var We,He,At,Wt,Jt,$s,Kt,Us,es;p("📊 Current symbol:",n().symbol),p("📊 Loading state:",a().loadingDuty,"Custom load:",j()),Ek.set(n().symbol);const V=gu(n().symbol);V!==n().symbol&&T().update(rn=>(rn.symbol=V,rn));const fe={...V,ticker:n().symbol.ticker,pricePrecision:w_(n().symbol),volumePrecision:n().symbol.volumePrecision};try{G6({logo:V.logo,logo2:V.logo2})}catch{}if((We=o())==null||We.setSymbol(fe),Bs=null,fl){const rn=a0(n().symbol);fl.setCurrentSymbol(rn),fl.renderCurrentSymbolDrawings()}try{const rn=window.overlayCreationManager;rn&&rn.setCurrentSymbolKey(a0(n().symbol))}catch{}if(j())return;const me=A;A=n().symbol,me&&me.ticker!==n().symbol.ticker?C.unsubscribe(me):C.unsubscribe(),I={active:!1,lastUpdateAt:0,lastBarTs:0,lastNewBarIndex:-1};try{b(Ht,!1)}catch{}try{const rn=C==null?void 0:C.getHistorySnapshot;if(o()&&typeof rn=="function"){const pn=rn(n().symbol,n().period.timeframe),Nn=pn==null?void 0:pn.candles;if(Array.isArray(Nn)&&Nn.length>0){let qt=Nn.slice(Math.max(0,Nn.length-600));const Os=((At=(He=n().styles)==null?void 0:He.candle)==null?void 0:At.type)||Dk((Jt=(Wt=o())==null?void 0:Wt.getStyles)==null?void 0:Jt.call(Wt),n().styles);if(Os==="heikin_ashi")qt=s2(qt);else if(Os==="renko_atr"){try{const mn=Od(Nn);mn!=null&&(!Bs||mn<Bs)&&(Bs=mn)}catch{}const zs=((Kt=($s=n().styles)==null?void 0:$s.candle)==null?void 0:Kt.renko)||{method:"ATR",atrLength:14,source:"close",wick:!1};qt=n2(qt,zs)}else if(Os==="point_and_figure"){const zs=((es=(Us=n().styles)==null?void 0:Us.candle)==null?void 0:es.pnf)||{boxSizeMode:"ATR",boxSize:1,atrLength:14,reversalBoxes:3,upColor:"#00E6D8",downColor:"#FF4D4D"};qt=o2(qt,zs)}o().applyNewData(qt,!1),b(Ht,!0)}}}catch{}if(Ai){try{Ai()}catch{}Ai=null}o()&&(Ai=cr(o()));const ae=Ti();qr(ae)});const Na=["SMART_MONEY","TRAP_HUNTER","VOLCANIC","VOLCANIC_SIG"],Rc=[...Na,"SMARTTREND"];function Ir(){var V;const M=(V=c())==null?void 0:V.data;return(M==null?void 0:M.isPremium)===!0||(M==null?void 0:M.isTrial)===!0}function tu(M){var Jt,$s,Kt,Us,es,rn,pn,Nn,js,qt,Os,zs,mn;if(!o())return;const V=o(),fe=M==null?void 0:M.name;if(!fe)return;const me=(M==null?void 0:M.pane_id)||"";let ae=[];try{ae=((Jt=V.getIndicators)==null?void 0:Jt.call(V))??[]}catch{ae=[]}if(ae.some(un=>un.name===fe&&(!me||un.paneId===me)))return;let He;if(Array.isArray(M.styles)&&M.styles.length>0){const un=jn=>jn==="dashed"||jn==="dotted"?{style:mt.Dashed,dashedValue:jn==="dotted"?[2,2]:[4,4]}:{style:mt.Solid,dashedValue:[2,2]};He={lines:M.styles.map(jn=>{const ro=un(jn==null?void 0:jn.lineStyle);return{color:jn==null?void 0:jn.color,size:(jn==null?void 0:jn.thickness)??1,style:ro.style,dashedValue:ro.dashedValue}})}}let At;if(fe==="SMARTTREND"){const un=M.superTrendGroup;if(At=un?{showLabels:!!un.showLabels,uptrendColor:((Kt=($s=un.styles)==null?void 0:$s.uptrend)==null?void 0:Kt.color)??"#00FF00",downtrendColor:((es=(Us=un.styles)==null?void 0:Us.downtrend)==null?void 0:es.color)??"#FF0000",uptrendThickness:((pn=(rn=un.styles)==null?void 0:rn.uptrend)==null?void 0:pn.thickness)??1,downtrendThickness:((js=(Nn=un.styles)==null?void 0:Nn.downtrend)==null?void 0:js.thickness)??1,uptrendLineStyle:((Os=(qt=un.styles)==null?void 0:qt.uptrend)==null?void 0:Os.lineStyle)??"dashed",downtrendLineStyle:((mn=(zs=un.styles)==null?void 0:zs.downtrend)==null?void 0:mn.lineStyle)??"dashed"}:{showLabels:!0,uptrendColor:"#00FF00",downtrendColor:"#FF0000",uptrendThickness:1,downtrendThickness:1,uptrendLineStyle:"dashed",downtrendLineStyle:"dashed"},!He){const jn=At.uptrendLineStyle==="dotted"||At.uptrendLineStyle==="dashed";He={lines:[{color:At.uptrendColor,size:At.uptrendThickness,style:jn?mt.Dashed:mt.Solid,dashedValue:At.uptrendLineStyle==="dotted"?[2,2]:[4,4]}]}}}const Wt=me==="candle_pane";V.createIndicator({name:fe,calcParams:M==null?void 0:M.params,styles:He,...At?{extendData:At}:{}},Wt,me?{id:me}:void 0)}function jc(){var V;if(!o()||Ir())return;const M=o();try{const fe=((V=M.getIndicators)==null?void 0:V.call(M))??[];for(const me of fe)if(me.name&&Na.includes(me.name))try{M.removeIndicator({paneId:me.paneId||"candle_pane",name:me.name}),p(`✅ Removed AI indicator: ${me.name} from pane: ${me.paneId}`)}catch(ae){console.warn(`⚠️ Failed to remove indicator ${me.name}:`,ae)}}catch(fe){console.error("❌ Error removing AI indicators:",fe)}}function su(){var V;if(!o()||Ir())return;const M=o();try{const fe=((V=M.getIndicators)==null?void 0:V.call(M))??[];for(const me of fe)me.name==="SMARTTREND"&&(M.removeIndicator({paneId:me.paneId||"candle_pane",name:me.name}),p(`✅ Removed Smart Trend indicator from pane: ${me.paneId}`))}catch(fe){console.error("❌ Error removing Smart Trend:",fe)}}function sd(){if(!(!o()||!Ir()))try{const M=Object.entries(n().saveInds||{});for(const[,V]of M)!(V!=null&&V.name)||!Rc.includes(V.name)||tu(V)}catch(M){console.error("❌ Error restoring premium indicators:",M)}}let of=_e(null),Iu=_e(!1);Xr(()=>{var me;if(!o()||((me=c())==null?void 0:me.data)===void 0)return;const V=Ir();(!i(Iu)||i(of)===!0&&V===!1)&&V===!1&&setTimeout(()=>{jc(),su()},1e3),i(of)===!1&&V===!0&&setTimeout(()=>{sd()},800),b(of,H(V)),b(Iu,!0)});const Qd=pp(T(),M=>M.theme);let Hl=n().theme;Qd.subscribe(M=>{var He,At,Wt,Jt,$s,Kt,Us,es,rn,pn,Nn,js,qt,Os,zs,mn,un,jn,ro,ys,qs,Js,is,ts,Ss,ln,on,yo,pr,dn,Fo,Dn,Yo,Fi,fo,Pn,ii,Dr,ni,Xo,sr,Sl,Ru,rl,Vi,Xl,Hc,Da,gf;if(M===Hl||(Hl=M,wf)||a().isApplyingManualStyles)return;M=="light"?(Fc(T(),Ro(n).colorLong="green",Ro(n)),Fc(T(),Ro(n).colorShort="red",Ro(n))):(Fc(T(),Ro(n).colorLong="green",Ro(n)),Fc(T(),Ro(n).colorShort="rgb(255,135,8)",Ro(n)));const V=lp(n().theme);p("🎨 Theme styles from getThemeStyles:",JSON.stringify(V,null,2)),p("💾 Current save.styles:",JSON.stringify(n().styles,null,2));const fe=Ag(n().styles),me=(He=fe==null?void 0:fe.candle)==null?void 0:He.type,ae=Ys.merge({},V,fe);p("🎨 theme axis colors:",(Jt=(Wt=(At=V==null?void 0:V.xAxis)==null?void 0:At.tickText)==null?void 0:Wt.style)==null?void 0:Jt.color,(Us=(Kt=($s=V==null?void 0:V.yAxis)==null?void 0:$s.tickText)==null?void 0:Kt.style)==null?void 0:Us.color),p("💾 saved axis colors:",Ys.get(fe,"xAxis.tickText.style.color"),Ys.get(fe,"yAxis.tickText.style.color")),me&&ae.candle&&(ae.candle.type=me);try{const ju=(pn=(rn=(es=V==null?void 0:V.candle)==null?void 0:es.tooltip)==null?void 0:rn.title)==null?void 0:pn.color;if(ju&&((js=(Nn=ae==null?void 0:ae.candle)==null?void 0:Nn.tooltip)!=null&&js.title)){ae.candle.tooltip.title.color=ju;try{T().update(Ka=>(Ka.styles||(Ka.styles={}),Ys.set(Ka.styles,"candle.tooltip.title.color",ju),Ka))}catch{}}}catch{}try{const ju=(zs=(Os=(qt=V==null?void 0:V.candle)==null?void 0:qt.tooltip)==null?void 0:Os.legend)==null?void 0:zs.color,Ka=(jn=(un=(mn=V==null?void 0:V.indicator)==null?void 0:mn.tooltip)==null?void 0:un.legend)==null?void 0:jn.color;if(ju&&((ys=(ro=ae==null?void 0:ae.candle)==null?void 0:ro.tooltip)!=null&&ys.legend)){ae.candle.tooltip.legend.color=ju;try{T().update(Gu=>(Gu.styles||(Gu.styles={}),Ys.set(Gu.styles,"candle.tooltip.legend.color",ju),Gu))}catch{}}if(Ka&&((Js=(qs=ae==null?void 0:ae.indicator)==null?void 0:qs.tooltip)!=null&&Js.legend)){ae.indicator.tooltip.legend.color=Ka;try{T().update(Gu=>(Gu.styles||(Gu.styles={}),Ys.set(Gu.styles,"indicator.tooltip.legend.color",Ka),Gu))}catch{}}}catch{}try{const ju=(Ss=(ts=(is=V==null?void 0:V.xAxis)==null?void 0:is.tickText)==null?void 0:ts.style)==null?void 0:Ss.color,Ka=(yo=(on=(ln=V==null?void 0:V.yAxis)==null?void 0:ln.tickText)==null?void 0:on.style)==null?void 0:yo.color;ju&&((dn=(pr=ae==null?void 0:ae.xAxis)==null?void 0:pr.tickText)!=null&&dn.style)&&(ae.xAxis.tickText.style.color=ju,(Fo=ae==null?void 0:ae.xAxis)!=null&&Fo.tickText&&(delete ae.xAxis.tickText.color,delete ae.xAxis.tickText.opacity,ae.xAxis.tickText.color=ju)),Ka&&((Yo=(Dn=ae==null?void 0:ae.yAxis)==null?void 0:Dn.tickText)!=null&&Yo.style)&&(ae.yAxis.tickText.style.color=Ka,(Fi=ae==null?void 0:ae.yAxis)!=null&&Fi.tickText&&(delete ae.yAxis.tickText.color,delete ae.yAxis.tickText.opacity,ae.yAxis.tickText.color=Ka))}catch{}try{if((Pn=(fo=ae==null?void 0:ae.candle)==null?void 0:fo.tooltip)!=null&&Pn.legend){const ju=ae.candle.tooltip.legend.color;ae.candle.tooltip.legend.template=({current:Ka})=>{const Gu="#32CD32",tf="#FF0000",kh=((Ka==null?void 0:Ka.close)??0)>((Ka==null?void 0:Ka.open)??0),oh=((Ka==null?void 0:Ka.close)??0)<((Ka==null?void 0:Ka.open)??0),vp=kh?Gu:oh?tf:ju,Ff=bm=>({text:bm,color:vp});return typeof window<"u"&&window.innerWidth<=768?[{title:"O",value:Ff("{open}")},{title:"H",value:Ff("{high}")},{title:"L",value:Ff("{low}")},{title:"C",value:Ff("{close}")},{title:"V",value:Ff("{volume}")}]:[{title:"O",value:Ff("{open}")},{title:"H",value:Ff("{high}")},{title:"L",value:Ff("{low}")},{title:"C",value:Ff("{close}")},{title:"V",value:Ff("{volume}")}]}}}catch{}p("🔄 Merged styles (theme + saved):",JSON.stringify(ae,null,2)),p("🔄 merged axis colors before process:",(ni=(Dr=(ii=ae==null?void 0:ae.xAxis)==null?void 0:ii.tickText)==null?void 0:Dr.style)==null?void 0:ni.color,(Sl=(sr=(Xo=ae==null?void 0:ae.yAxis)==null?void 0:Xo.tickText)==null?void 0:sr.style)==null?void 0:Sl.color);const We=hf(ae);p("✨ Final processed styles:",JSON.stringify(We,null,2)),p("✨ processed axis colors:",(Vi=(rl=(Ru=We==null?void 0:We.xAxis)==null?void 0:Ru.tickText)==null?void 0:rl.style)==null?void 0:Vi.color,(Da=(Hc=(Xl=We==null?void 0:We.yAxis)==null?void 0:Xl.tickText)==null?void 0:Hc.style)==null?void 0:Da.color),(gf=o())==null||gf.setStyles(We),setTimeout(()=>{lr()},100),setTimeout(()=>{var Ka,Gu,tf;const ju=(Ka=o())==null?void 0:Ka.getStyles();p("  - Current chart styles:",JSON.stringify(ju,null,2)),p("  - Saved chart type in $save.styles:",(tf=(Gu=n().styles)==null?void 0:Gu.candle)==null?void 0:tf.type)},200)}),pp(T(),M=>M.timezone).subscribe(M=>{var V;(V=o())==null||V.setTimezone(M),Ow(M)});const Ks=pp(T(),M=>{var V,fe;return(fe=(V=M.styles)==null?void 0:V.candle)==null?void 0:fe.type});let Ct=((Tm=(ym=n().styles)==null?void 0:ym.candle)==null?void 0:Tm.type)||null;Ks.subscribe(M=>{if(a().loadingDuty||j())return;const V=o();if(!V)return;Bs=null;const fe=Ct==="point_and_figure",me=M==="point_and_figure";if(me&&!fe)try{V.createIndicator("PNF",!1,{id:"candle_pane"}),p("📊 Added PNF indicator for Point & Figure chart")}catch(ae){console.warn("Failed to add PNF indicator:",ae)}else if(!me&&fe)try{V.removeIndicator({paneId:"candle_pane",name:"PNF"}),p("📊 Removed PNF indicator (switched from P&F)");const ae=lp(n().theme),We=Ys.merge({},ae,Ag(n().styles)),He=hf(We);V.setStyles(He),p("🎨 Refreshed styles after P&F exit - candle colors restored")}catch(ae){console.warn("Failed to cleanup after P&F:",ae)}Ct=M||null,(M==="heikin_ashi"||M==="renko_atr"||M==="point_and_figure"||M!=="heikin_ashi"&&M!=="renko_atr"&&M!=="point_and_figure"&&V.getDataList().length>0)&&Bl.switchChartType({chart:V,newType:M||"candle_solid",reloadDataFn:async()=>{await qr()}})}),pp(T(),M=>{var fe,me;const V=((me=(fe=M.styles)==null?void 0:fe.candle)==null?void 0:me.renko)||{};return JSON.stringify(V)}).subscribe(M=>{var fe,me;if(a().loadingDuty||j()||((me=(fe=n().styles)==null?void 0:fe.candle)==null?void 0:me.type)!=="renko_atr")return;const V=o();V&&Bl.switchChartType({chart:V,newType:"renko_atr",reloadDataFn:async()=>{await qr()}})}),pp(T(),M=>{var fe,me;const V=((me=(fe=M.styles)==null?void 0:fe.candle)==null?void 0:me.pnf)||{};return JSON.stringify(V)}).subscribe(M=>{var fe,me;if(a().loadingDuty||j()||((me=(fe=n().styles)==null?void 0:fe.candle)==null?void 0:me.type)!=="point_and_figure")return;const V=o();V&&Bl.switchChartType({chart:V,newType:"point_and_figure",reloadDataFn:async()=>{await qr()}})}),pp(P(),M=>M.fireOhlcv).subscribe(async M=>{a().timeStart&&a().timeEnd?(await Yl(n().symbol,n().period,a().timeStart,a().timeEnd),Fc(P(),Ro(a).timeStart=0,Ro(a)),Fc(P(),Ro(a).timeEnd=0,Ro(a))):await na()});function Sn(){return o()}function Yn(M){wf=M}function _o(M){var V;if(Cm("interactionV2")){const fe=M.target;if(fe&&(fe.closest("input, textarea, select")||fe.closest("[contenteditable='true']")||fe.closest(".monaco-editor")||fe.closest("[role='textbox']")||fe.isContentEditable))return;if(M.key==="Escape"){M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation(),V$(),b(Xf,""),b(sc,""),b(ch,""),b(Vh,""),rf();return}if((M.key==="Delete"||M.key==="Backspace")&&i(Xf)){M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation();const ae=j0(i(Xf));i0(i(Xf),{box:ae==null?void 0:ae.box,label:ae==null?void 0:ae.label,hidden:!0}),b(Xf,""),b(sc,""),b(ch,""),b(Vh,""),rf();return}if((M.key==="ArrowLeft"||M.key==="ArrowRight"||M.key==="ArrowUp"||M.key==="ArrowDown")&&i(Xf)){const ae=cd.find(Jt=>Jt.id===i(Xf)&&(Jt.type==="box"||Jt.type==="label"));if(!ae)return;M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation();const We=M.shiftKey?5:1;let He=0,At=0;if(M.key==="ArrowLeft"&&(He=-We),M.key==="ArrowRight"&&(He=We),M.key==="ArrowUp"||M.key==="ArrowDown"){const Jt=ae.axis,$s=Lh.y*We;if(Jt&&typeof Jt.toValue=="function"&&typeof Jt.toY=="function"){let Kt=NaN;if(ae.type==="box"&&ae.box){const Us=(ae.box.topValue+ae.box.bottomValue)/2;Kt=Jt.toY(Us)}else ae.type==="label"&&ae.label&&(Kt=Jt.toY(ae.label.value));if(Number.isFinite(Kt)){const Us=Jt.toValue(Kt+(M.key==="ArrowUp"?-$s:$s))-Jt.toValue(Kt);Number.isFinite(Us)&&(At=Us)}}}const{nudgedId:Wt}=W$(ae,He,At);Wt&&si();return}}(M.key==="Delete"||M.key==="Backspace")&&(M.preventDefault(),(V=i(nt))==null||V.clickRemove())}function si(){o()&&Ui.requestKey("interaction:redraw",()=>{try{o().updatePane(qb.Drawer)}catch{}})}function Gn(M){if(!Cm("interactionV2"))return null;const V=D==null?void 0:D.getBoundingClientRect();if(!V)return null;const fe=M.clientX-V.left,me=M.clientY-V.top,We=z$(fe,me,cd);if(b(Xf,H(We.selectedId??"")),b(ch,H(We.draggingId??"")),b(Vh,H(We.resizingId??"")),We.selectedId||b(sc,""),D){try{D.focus({preventScroll:!0})}catch{D.focus()}rf(We.cursor)}return si(),We}const Uo=16,oo=8,Si=6,cc=1200,bu=50,$l=v,nu=new Map,$r=vX;let $a=_e(null),wa=_e(null),yc=_e(null);const ti=M=>typeof M=="number"&&Number.isFinite(M),fi=M=>{if(typeof M=="number")return Number.isFinite(M)?M:null;if(typeof M=="string"){const fe=Number(M);return Number.isFinite(fe)?fe:null}const V=Number(M);return Number.isFinite(V)?V:null},hn=(M,V)=>`${M}::${V}`,uo=M=>Array.isArray(M)?M:Array.isArray(M==null?void 0:M.__rows)?M.__rows:[],tr=(M,V)=>{if(!M||typeof M.convertToPixel!="function")return null;const fe=M.convertToPixel(V);if(!ti(fe))return null;const me=M.convertToPixel(V-1),ae=M.convertToPixel(V+1),We=[Math.abs(fe-me),Math.abs(ae-fe)].filter(Wt=>Number.isFinite(Wt)),He=We.length?Math.max(...We):6,At=Math.max(2,Math.min(14,He*.7))/2;return{x:fe,half:At}},Pr=(M,V,fe)=>{const me=(M==null?void 0:M.result)||{},ae=uo(me);if(ae.length)return ae[V]??null;const We=fe[V],He=(We==null?void 0:We.timestamp)??(We==null?void 0:We.time)??(We==null?void 0:We.t);return He==null?null:me[He]??me[String(He)]??null},Mr=M=>String((M==null?void 0:M.name)||(M==null?void 0:M.shortName)||"").toUpperCase()==="ZIGZAG",Or=M=>{const V=String((M==null?void 0:M.name)||(M==null?void 0:M.shortName)||"").toUpperCase();return V==="VOL"||V==="VOLUME"},ou=M=>{const fe=Math.max(10,Math.floor(M.height*.22)),me=M.height-1,We=Math.max(1,Math.floor(fe*.56));return{bandBottom:me,effectiveBandHeight:We}},md=(M,V,fe,me)=>{var We;if(!(M!=null&&M.result)||!Array.isArray(V))return 0;let ae=0;for(let He=fe;He<=me&&He<V.length;He+=1){const At=(We=V[He])==null?void 0:We.timestamp;if(At==null)continue;const Wt=M.result[At];if(!Wt)continue;const Jt=fi(Wt.volume),$s=fi(Wt.ema);ti(Jt)&&(ae=Math.max(ae,Jt)),ti($s)&&(ae=Math.max(ae,$s))}return ae},Kf=(M,V,fe,me)=>{if(!Array.isArray(M)||!M.length)return null;let ae=0;for(let We=V;We>=0&&We<M.length&&ae<=me;We+=fe,ae+=1){const He=M[We],At=fi(He==null?void 0:He.zigzag);if(ti(At))return{index:We,price:At}}return null},Pu=(M,V)=>{if(!Array.isArray(M)||!M.length)return null;const fe=M[V],me=fi(fe==null?void 0:fe.zigzag);if(ti(me))return me;const ae=Kf(M,V,-1,800),We=Kf(M,V,1,800);if(!ae||!We||ae.index===We.index)return null;const He=(V-ae.index)/(We.index-ae.index);return ae.price+(We.price-ae.price)*He},ld=(M,V,fe)=>{if(!Array.isArray(M)||!M.length)return[];const me=Math.max(0,V-50),ae=Math.min(M.length-1,fe+50),We=[];for(let He=me;He<=ae;He+=1){const At=M[He],Wt=fi(At==null?void 0:At.zigzag);ti(Wt)&&We.push({index:He,price:Wt})}return We},iu=(M,V)=>{if(!M.length)return null;let fe=0;for(;fe<M.length-1&&V>M[fe+1].index;)fe+=1;const me=M[fe],ae=M[Math.min(fe+1,M.length-1)];if(!me||!ae||me.index===ae.index)return(me==null?void 0:me.price)??null;if(V<me.index||V>ae.index)return null;const We=(V-me.index)/(ae.index-me.index);return me.price+(ae.price-me.price)*We},Ed=(M,V)=>{const fe=vc();for(const[me,ae]of Object.entries(fe)){if(!ae||me==="x_axis_pane")continue;const We=M>=ae.left&&M<=ae.left+ae.width,He=V>=ae.top&&V<=ae.top+ae.height;if(We&&He)return{paneId:me,rect:ae}}return null},Du=(M,V)=>{var ro,ys,qs,Js,is,ts,Ss,ln,on,yo,pr;if(!o()||!D)return null;const fe=D.getBoundingClientRect();if(M<0||V<0||M>fe.width||V>fe.height)return null;const me=Ed(M,V);if(!me)return null;const{paneId:ae,rect:We}=me,He=o(),At=((ro=He.getDataList)==null?void 0:ro.call(He))||[],Wt=(Js=(qs=(ys=He.getXAxisPane)==null?void 0:ys.call(He))==null?void 0:qs.getAxisComponent)==null?void 0:Js.call(qs),Jt=M-We.left;if(!At.length)return null;const $s=(is=He.getChartStore)==null?void 0:is.call(He),Kt=typeof($s==null?void 0:$s.coordinateToFloatIndex)=="function"?$s.coordinateToFloatIndex(Jt):(ts=Wt==null?void 0:Wt.convertFromPixel)==null?void 0:ts.call(Wt,Jt),Us=typeof($s==null?void 0:$s.coordinateToDataIndex)=="function"?$s.coordinateToDataIndex(Jt):null;if(!ti(Kt)&&!ti(Us))return null;let es=0;const rn=new Set;if(ti(Kt)&&(rn.add(Math.max(0,Math.min(At.length-1,Math.round(Kt)))),rn.add(Math.max(0,Math.min(At.length-1,Math.floor(Kt)))),rn.add(Math.max(0,Math.min(At.length-1,Math.ceil(Kt))))),ti(Us)&&rn.add(Math.max(0,Math.min(At.length-1,Math.round(Us)))),Wt!=null&&Wt.convertToPixel&&rn.size){let dn=-1,Fo=Number.POSITIVE_INFINITY;for(const Dn of rn){const Yo=Wt.convertToPixel(Dn);if(!ti(Yo))continue;const Fi=Math.abs(Jt-Yo);Fi<Fo&&(Fo=Fi,dn=Dn)}dn>=0?es=dn:es=Math.max(0,Math.min(At.length-1,Math.round(Number(Kt||Us))))}else es=Math.max(0,Math.min(At.length-1,Math.round(ti(Us)?Us:Kt)));const pn=rc(ae);if(!(pn!=null&&pn.axis))return null;const Nn=pn.axis,js=V-We.top;let qt=null,Os=Number.POSITIVE_INFINITY;const zs=tr(Wt,es),mn=zs&&Number.isFinite(Jt)?Math.abs(Jt-zs.x)<=zs.half+oo||Math.abs(M-(zs.x+We.left))<=zs.half+oo:!0,un=((Ss=He.getIndicators)==null?void 0:Ss.call(He,{paneId:ae}))||[],jn=new Set(["line","bar","circle","rect"]);for(const dn of un){const Fo=dn==null?void 0:dn.__plotMeta,Dn=Array.isArray(Fo==null?void 0:Fo.plots)?Fo.plots:[],Yo=Array.isArray(Fo==null?void 0:Fo.plotKeys)?Fo.plotKeys:[],Fi=Pr(dn,es,At);if(!(!Fi&&!Mr(dn))){if(Dn.length)Dn.forEach((fo,Pn)=>{var Sl;const ii=String((fo==null?void 0:fo.type)||"line").toLowerCase();if(ii==="candles"||ii==="ohlc"||!$r.has(ii)&&ii!=="line")return;const Dr=Yo[Pn]||(fo==null?void 0:fo.key);if(!Dr||String(Dr).startsWith("__"))return;const ni=fi(Fi[Dr]);if(!ti(ni))return;const Xo=Nn.convertToPixel(ni);if(!ti(Xo))return;let sr=Math.abs(js-Xo);if(ii==="histogram"||ii==="bar"){const Ru=(Sl=Nn.getRange)==null?void 0:Sl.call(Nn),rl=(fo==null?void 0:fo.baseValue)??(Ru&&Number.isFinite(Ru.from)?Ru.from:0),Vi=Nn.convertToPixel(rl);if(ti(Vi)){const Xl=Math.min(Xo,Vi),Hc=Math.max(Xo,Vi);sr=mn&&js>=Xl-1&&js<=Hc+1?0:sr}}sr>Uo+4||sr<Os&&(Os=sr,qt={kind:"indicator",paneId:ae,barIndex:es,indicatorId:dn==null?void 0:dn.id,indicatorName:(dn==null?void 0:dn.name)||(Fo==null?void 0:Fo.legend)||"indicator",plotKey:Dr,distance:sr})});else if(Array.isArray(dn==null?void 0:dn.figures))for(const fo of dn.figures){const Pn=String((fo==null?void 0:fo.type)||"line").toLowerCase();if(!jn.has(Pn))continue;const ii=fo==null?void 0:fo.key;if(!ii)continue;const Dr=fi(Fi[ii]);if(!ti(Dr))continue;const ni=Nn.convertToPixel(Dr);if(!ti(ni))continue;let Xo=Math.abs(js-ni);if(Pn==="bar"){const sr=(ln=Nn.getRange)==null?void 0:ln.call(Nn),Sl=(fo==null?void 0:fo.baseValue)??(sr&&Number.isFinite(sr.from)?sr.from:0),Ru=Nn.convertToPixel(Sl);if(ti(Ru)){const rl=Math.min(ni,Ru),Vi=Math.max(ni,Ru);Xo=mn&&js>=rl-1&&js<=Vi+1?0:Xo}}Xo>Uo+4||Xo<Os&&(Os=Xo,qt={kind:"indicator",paneId:ae,barIndex:es,indicatorId:dn==null?void 0:dn.id,indicatorName:(dn==null?void 0:dn.name)||"indicator",plotKey:ii,distance:Xo})}if(!Dn.length&&(!Array.isArray(dn==null?void 0:dn.figures)||dn.figures.length===0)){if(Or(dn)){const fo=(on=He.getVisibleRange)==null?void 0:on.call(He),Pn=Number.isFinite(fo==null?void 0:fo.from)?fo.from:Math.max(0,es-200),ii=Number.isFinite(fo==null?void 0:fo.to)?fo.to:Math.min(At.length-1,es+200),Dr=md(dn,At,Pn,ii);if(Dr>0){const ni=(yo=At[es])==null?void 0:yo.timestamp,Xo=ni!=null?(pr=dn.result)==null?void 0:pr[ni]:null,sr=fi(Xo==null?void 0:Xo.volume);if(ti(sr)){const Sl=ou(We),Ru=Math.min(1,sr/Dr),rl=Math.max(1,Math.floor(Ru*Sl.effectiveBandHeight)),Vi=Sl.bandBottom-rl;mn&&js>=Vi-1&&js<=Sl.bandBottom+1&&(Os=0,qt={kind:"indicator",paneId:ae,barIndex:es,indicatorId:dn==null?void 0:dn.id,indicatorName:(dn==null?void 0:dn.name)||"VOL",plotKey:"volume",distance:0})}}}else if(Mr(dn)){const fo=Pu(Array.isArray(dn==null?void 0:dn.result)?dn.result:[],es);if(ti(fo)){const Pn=Nn.convertToPixel(fo);if(ti(Pn)){const ii=Math.abs(js-Pn);mn&&ii<=Uo+6&&ii<Os&&(Os=ii,qt={kind:"indicator",paneId:ae,barIndex:es,indicatorId:dn==null?void 0:dn.id,indicatorName:(dn==null?void 0:dn.name)||"ZIGZAG",plotKey:"zigzag",distance:ii})}}}}}}if(ae==="candle_pane"){const dn=At[es],Fo=fi((dn==null?void 0:dn.open)??(dn==null?void 0:dn.o)??(dn==null?void 0:dn.price)??(dn==null?void 0:dn.value)),Dn=fi((dn==null?void 0:dn.close)??(dn==null?void 0:dn.c)??(dn==null?void 0:dn.price)??(dn==null?void 0:dn.value)),Yo=fi((dn==null?void 0:dn.high)??(dn==null?void 0:dn.h)),Fi=fi((dn==null?void 0:dn.low)??(dn==null?void 0:dn.l));if(ti(Fo)&&ti(Dn)&&ti(Yo)&&ti(Fi)&&zs){const fo=Nn.convertToPixel(Math.max(Fo,Dn)),Pn=Nn.convertToPixel(Math.min(Fo,Dn)),ii=Nn.convertToPixel(Yo),Dr=Nn.convertToPixel(Fi),ni=Math.min(ii,Dr,fo,Pn),Xo=Math.max(ii,Dr,fo,Pn);if(mn&&js>=ni-6&&js<=Xo+6){const sr=(Fo+Dn)/2,Sl=Nn.convertToPixel(sr);ti(Sl)&&Math.abs(js-Sl)<Os&&(Os=Math.abs(js-Sl),qt={kind:"candle",paneId:ae,barIndex:es,distance:Os})}}}return qt},kf=()=>{var ae;if(!o()||!i(yc))return;const M=o(),V=hn(i(yc).paneId,i(yc).id),fe=nu.get(V);if(fe==null)return;const me={paneId:i(yc).paneId,zLevel:fe};i(yc).id?me.id=i(yc).id:i(yc).name&&(me.name=i(yc).name),(ae=M.overrideIndicator)==null||ae.call(M,me)},$d=M=>{var Kt,Us,es,rn,pn;const V=(M==null?void 0:M.kind)==="indicator"?M.indicatorId:"",fe=(M==null?void 0:M.kind)==="indicator"?M.indicatorName:"",me=(M==null?void 0:M.kind)==="indicator"?M.paneId:"",ae=((Kt=i(yc))==null?void 0:Kt.id)||"",We=((Us=i(yc))==null?void 0:Us.paneId)||"";if(V===ae&&me===We||(ae&&kf(),b(yc,H(V?{id:V,name:fe,paneId:me}:null)),!o()||!V))return;const He=o(),At=hn(me,V),Jt=(((es=He.getIndicators)==null?void 0:es.call(He,{id:V,paneId:me}))||((rn=He.getIndicators)==null?void 0:rn.call(He,{name:fe,paneId:me}))||[])[0];if(!Jt)return;nu.has(At)||nu.set(At,Jt.zLevel);const $s={paneId:me,zLevel:Math.max(bu,Jt.zLevel)};V?$s.id=V:fe&&($s.name=fe),(pn=He.overrideIndicator)==null||pn.call(He,$s)},Bf=M=>{b($a,H(M)),$d(M)},Di=()=>{i(yc)&&kf(),b(yc,null),b($a,null)},bh=M=>{b(wa,H(M?{kind:M.kind,paneId:M.paneId,barIndex:M.barIndex,indicatorId:M.indicatorId,indicatorName:M.indicatorName,plotKey:M.plotKey}:null))},rf=M=>{var We;if(!D)return;const V=o(),fe=((We=V==null?void 0:V.getDrawPanes)==null?void 0:We.call(V))??(V==null?void 0:V._drawPanes)??[],me=typeof window<"u"&&!!window.__overlayHover,ae=M||(i(ch)||i(Vh)?"grabbing":i(sc)||i($a)||me?"pointer":null);fe.forEach(He=>{var At,Wt,Jt;try{(Jt=(Wt=(At=He==null?void 0:He.getMainWidget)==null?void 0:At.call(He))==null?void 0:Wt.setForceCursor)==null||Jt.call(Wt,ae)}catch{}}),D.style.cursor=ae??""};let Xe=_e(0),Dp=_e(0),nm=_e(0),Sp=_e(0),sc=_e(""),Xf=_e(""),ch=_e(""),Vh=_e(""),Lh={x:6,y:4};const cp=new Map;let cd=[],u0=0,Iv=null,Dm=null,xh=null;const th=new Map;let Um=null,dv=null;const Bg=()=>!1;let Wh=_e(!1),om=_e(0),Og=_e(0),hm=_e(""),mm,zg=_e(!1),Gm=_e(""),Rm=0,Hh=0,fg=null,qh=_e(H([])),Uv=_e(0),Zf=_e(!1),vm=null,pg=_e(1);function d0(M){var V,fe;if(o())try{const me=o(),ae=((V=me.getPaneOptions)==null?void 0:V.call(me,M))||null,We=(ae==null?void 0:ae.state)||"normal",He=We==="maximize"?"normal":"maximize";(fe=me.setPaneOptions)==null||fe.call(me,{id:M,state:He}),tc(),p("🖱️ Pane double-click toggle",{paneId:M,from:We,to:He})}catch(me){console.warn("⚠️ Failed to toggle pane state",M,me)}}function ee(M){var He;if(!o()||!D)return;const V=o();try{if(!(((He=V.getIndicators)==null?void 0:He.call(V))??[]).some(Jt=>Jt.paneId&&Jt.paneId!=="candle_pane"))return}catch{return}const fe=V._drawPanes;if(!Array.isArray(fe)||fe.length===0){d0("candle_pane");return}const me=D.getBoundingClientRect(),ae=M.clientY-me.top;let We=null;for(const At of fe){if(!At||typeof At.getId!="function"||typeof At.getBounding!="function")continue;const Wt=At.getId();if(Wt==="x_axis_pane")continue;const Jt=At.getBounding();if(!Jt||typeof Jt.height!="number")continue;const $s=typeof Jt.top=="number"?Jt.top:0,Kt=Jt.height;if(ae>=$s&&ae<=$s+Kt){We=Wt;break}}We||(We="candle_pane"),d0(We)}function oe(M){const V=D==null?void 0:D.getBoundingClientRect();if(V){b(Xe,M.clientX-V.left),b(Dp,M.clientY-V.top);let fe;if(Cm("interactionV2")){const We=Pk(M),{hoverId:He,draggingId:At,resizingId:Wt,cursor:Jt}=Fk(i(Xe),i(Dp),cd,We);b(sc,H(He??"")),b(ch,H(At??"")),b(Vh,H(Wt??"")),fe=Jt,(At||Wt)&&(M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation(),si())}const me=typeof window<"u"&&!!window.__overlayHover,ae=!!(i(ch)||i(Vh)||i(sc));e6({interactionActive:ae,overlayHover:me})?Bf(Du(i(Xe),i(Dp))):Bf(null),rf(fe)}b(nm,H(M.clientX)),b(Sp,H(M.clientY)),se.length&&sp()}function $e(M){if(M.__interactionV2Handled)return;const V=Gn(M);if(V&&(V.selectedId||V.draggingId||V.resizingId)){M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation();return}if(M.button!==0)return;const fe=D==null?void 0:D.getBoundingClientRect();if(!fe)return;const me=typeof window<"u"&&!!window.__overlayHover,ae=!!(i(ch)||i(Vh)||i(sc));if(!e6({interactionActive:ae,overlayHover:me}))return;const We=M.clientX-fe.left,He=M.clientY-fe.top,At=Du(We,He);bh(At),si()}function at(){b(Xe,-1),b(Dp,-1),b(nm,-1),b(Sp,-1),Cm("interactionV2")&&b(sc,""),Di(),rf(),td()}function Gt(M){if(M.preventDefault(),kl())return;const V=D==null?void 0:D.getBoundingClientRect();if(V){const fe=M.clientX-V.left,me=M.clientY-V.top;b(om,fe),b(Og,me),b(hm,H(zd())),Zn(fe,me)}}function Nt(M){if(M.touches.length===1){const V=M.touches[0],fe=D==null?void 0:D.getBoundingClientRect();fe&&(b(Xe,V.clientX-fe.left),b(Dp,V.clientY-fe.top)),b(nm,H(V.clientX)),b(Sp,H(V.clientY));const me=M.target;if(i(Wh)&&me&&(me.closest(".modal-content")||me.closest(".action-btn")))return;const ae=Date.now(),We=ae-Rm;if(We<300&&We>0){if(Hh+=1,Hh===2){if(M.preventDefault(),fe){const He=V.clientX-fe.left,At=V.clientY-fe.top;Cs(He,At)}Hh=0;return}}else if(Hh=1,i(Wh)){M.preventDefault(),nn(),Hh=0;return}Rm=ae,fg&&clearTimeout(fg),fg=setTimeout(()=>{Hh=0},300)}}function Cs(M,V){b(om,H(M)),b(Og,H(V)),b(hm,H(zd())),b(Wh,!0)}function nn(){b(Wh,!1)}let Xs=_e(!1),Xn=_e(0),ho=_e(0);function Zn(M,V){b(Xn,H(M)),b(ho,H(V)),b(Xs,!0)}function Go(){b(Xs,!1)}function mi(){var M;try{if(i(Ft))return;const V=o();if(!V)return;const fe=V.getVisibleRange(),me=((M=V.getDataList)==null?void 0:M.call(V))??[];if(!fe||!Array.isArray(me)||me.length===0)return;const ae=fe.to-fe.from+1;b(zt,ae),b(ut,fe.to>=me.length-2),b(Ft,!0)}catch{}}function $o(){var V,fe,me;const M=o();if(M)try{mi();const ae=D==null?void 0:D.getBoundingClientRect(),We=ae?ae.width:((V=M.getSize())==null?void 0:V.width)??0,He=M.getDataList(),At=Math.min(180,Array.isArray(He)?He.length:180),Wt=Math.max(1,i(zt)??At),Jt=M.getChartStore(),$s=We>0?Math.floor(We/Wt):Jt.getBarSpace().bar,Kt=Math.max(1,Math.min(50,$s));Jt.setBarSpace(Kt);const Us=((fe=Jt.getInitialOffsetRightDistance)==null?void 0:fe.call(Jt))??Jt.getOffsetRightDistance();Jt.setOffsetRightDistance(Us,!0),M.scrollToRealTime(),(me=M._drawPanes)==null||me.forEach(rn=>{var Nn,js,qt;const pn=(Nn=rn==null?void 0:rn.getAxisComponent)==null?void 0:Nn.call(rn);(js=pn==null?void 0:pn.setAutoCalcTickFlag)==null||js.call(pn,!0),(qt=pn==null?void 0:pn.buildTicks)==null||qt.call(pn,!0)})}finally{Go()}}function kl(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}async function Fl(M){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(M),p("✅ Copied using modern clipboard API"),!0}catch(V){console.warn("Modern clipboard API failed:",V)}try{const V=document.createElement("textarea");V.value=M,V.style.position="fixed",V.style.left="-999999px",V.style.top="-999999px",V.style.opacity="0",V.style.pointerEvents="none",V.setAttribute("readonly",""),document.body.appendChild(V),V.focus(),V.select(),V.setSelectionRange(0,M.length);const fe=document.execCommand("copy");if(document.body.removeChild(V),fe)return p("✅ Copied using fallback method"),!0}catch(V){console.error("Fallback copy method failed:",V)}try{const V=window.getSelection();if(V){const fe=document.createRange(),me=document.createElement("span");me.textContent=M,me.style.position="fixed",me.style.left="-999999px",me.style.opacity="0",document.body.appendChild(me),fe.selectNode(me),V.removeAllRanges(),V.addRange(fe);const ae=document.execCommand("copy");if(document.body.removeChild(me),V.removeAllRanges(),ae)return p("✅ Copied using selection API fallback"),!0}}catch(V){console.error("Selection API fallback failed:",V)}return console.error("❌ All copy methods failed"),!1}function il(){const M=o();if(!M)return console.error("Chart not initialized"),!1;try{const V=M.getDataList();if(V.length<10)return console.warn("⚠️ Need more historical data for prediction"),!1;const fe=V[V.length-1],ae=fp(n().period.timeframe)*1e3;if(!HX(fe.timestamp,ae)&&i(Uv)===0){const rn=Date.now()-fe.timestamp,pn=Math.floor(rn/6e4);console.info(`ℹ️ Market appears to be open (last candle ${pn}m ago). Prediction is most useful when market is closed.`)}const He=V,At=WX(He);if(!At)return console.error("❌ Failed to generate prediction"),!1;b(qh,H([...i(qh),At])),n8(Uv);const Wt=[...He,At],Jt=M.getVisibleRange(),$s=Jt?Jt.to>=He.length-2:!0;M.applyNewData(Wt,!1);try{(Wt??[]).length>0&&b(Ht,!0)}catch{}$s&&setTimeout(()=>{M.scrollToRealTime()},50);const Kt=He[He.length-1].close,Us=(At.close-Kt)/Kt*100,es=Us>0?"📈":"📉";return p(`${es} Prediction #${i(Uv)}: ${Us>0?"+":""}${Us.toFixed(2)}% (Close: ${At.close.toFixed(2)})`),p("✅ Prediction added:",At),p("📊 Total predictions so far:",i(Uv)),!0}catch(V){return console.error("❌ Prediction error:",V),!1}}function Ya(){return Math.round(2e3/i(pg))}function Kl(){if(!i(Zf))return;vm&&(clearInterval(vm),vm=null);const M=Ya();vm=setInterval(()=>{i(Zf)&&il()},M),p(`⚡ Speed changed: ${i(pg)}x (${M}ms interval)`)}function ru(M){b(pg,H(M)),Kl()}function vd(){if(i(Zf))return;b(Zf,!0),il();const M=Ya();vm=setInterval(()=>{i(Zf)&&il()},M)}function nc(){b(Zf,!1),vm&&(clearInterval(vm),vm=null)}function af(){i(Zf)?nc():vd()}function zd(){const M=o();if(!M||i(Xe)===null||i(Dp)===null)return"";try{const V=(es,rn)=>{if(!Number.isFinite(es)||es===0)return`${es}`;const pn=es<0?"-":"",Nn=Math.abs(es),js=Math.floor(Math.log10(Nn))+1;let qt=Nn/Math.pow(10,js),Os=js;const zs=Number(qt.toFixed(rn));return zs>=1?(qt=zs/10,Os=js+1):qt=zs,`${pn}${qt.toFixed(rn)}e${Os}`},fe=es=>{var js,qt;const rn=Number((qt=(js=M==null?void 0:M.getSymbol)==null?void 0:js.call(M))==null?void 0:qt.pricePrecision);let pn=Number.isFinite(rn)?Math.max(0,Math.min(12,Math.trunc(rn))):w_(n().symbol);const Nn=vy(n().symbol);if(Number.isFinite(es)&&Math.abs(es)>=1e4)pn=2;else if(Nn==="crypto"&&Number.isFinite(es)){const Os=Math.abs(es);Os>=1e3?pn=2:Os>=1?pn=Math.min(Math.max(pn,2),4):Os>=.01?pn=Math.min(Math.max(pn,4),8):pn=Math.min(Math.max(pn,6),12)}return Math.max(0,Math.min(12,Math.trunc(pn)))},me=es=>{try{const rn=vy(n().symbol);if((rn==="stock"||rn==="crypto")&&Number.isFinite(es)){const pn=Math.abs(es);if(pn>0&&pn<1e-4)return V(es,5)}}catch{}return es.toFixed(fe(es))},ae=D==null?void 0:D.getBoundingClientRect();if(!ae)return"";if(M&&typeof M.convertFromPixel=="function")try{const es=M.convertFromPixel([{x:i(Xe),y:i(Dp)}],{paneId:"candle_pane"});if(es&&Array.isArray(es)&&es[0]&&typeof es[0].value=="number")return me(es[0].value)}catch{}const We=M.getVisibleRange(),He=M.getDataList();if(!He||He.length===0||!We)return"";const At=He.slice(We.from,We.to+1);if(At.length===0)return"";let Wt=1/0,Jt=-1/0;At.forEach(es=>{Wt=Math.min(Wt,es.low),Jt=Math.max(Jt,es.high)});const $s=Jt-Wt;if($s<=0)return"";const Kt=i(Dp)/ae.height,Us=Jt-Kt*$s;return me(Us)}catch{return""}}var lf=Jse();lf.__click=[Gse,a,P];var ef=y(lf);qo(ef,5,f,M=>M.id,(M,V)=>{r8(M,{get type(){return i(V).type},get text(){return i(V).text}})}),_(ef);var Hn=m(ef,2);sX(Hn,{get customLoad(){return j()},get mainContainer(){return i(Je)},set mainContainer(M){b(Je,H(M))},get sidebarHost(){return i(ze)},set sidebarHost(M){b(ze,H(M))},onToggleScriptStudio:()=>{b(ft,!i(ft)),i(ft)||b(ke,!1),vn()}});var Oo=m(Hn,2),pi=y(Oo),ur=y(pi),Mc=y(ur),Nc=y(Mc);hp(fB(Nc,{}),M=>b(nt,H(M)),()=>i(nt)),_(Mc);var Vf=m(Mc,2);Ve(Vf,()=>!i(Ht),M=>{var V=Yse();Y(M,V)});var xu=m(Vf,2);xu.__keydown=_o,xu.__contextmenu=Gt,xu.__mousemove=oe,xu.__mousedown=$e,xu.__mouseup=[qse,ch,Vh,rf],xu.__dblclick=ee,xu.__touchstart=Nt,xu.__click=[Use,Wh,nn,Xs,Go];var nd=y(xu);hp(nd,M=>ne=M,()=>ne);var Dd=m(nd,2);hp(Dd,M=>X=M,()=>X);var Jf=m(Dd,2);hp(Jf,M=>de=M,()=>de),_(xu),hp(xu,M=>D=M,()=>D);var fr=m(xu,2);ZX(fr,{}),_(ur);var sh=m(ur,2);const gm=Lt(()=>`height: ${i(ft)?`${Math.round(i(Et)*100)}%`:"0px"};`);var _m=y(sh);_m.__mousedown=lc,_m.__touchstart=lc;var wh=m(_m,2);wh.__touchmove=[Kse];var Uh=y(wh);a8(Uh,()=>i(Ns),M=>{var V=Lt(()=>i(Zr)?d()[i(Zr)]:null),fe=Lt(()=>i(Zr)?h()[i(Zr)]||[]:[]);hp(Ute(M,{get code(){return i(Es)},set code(me){b(Es,H(me))},get codeVersion(){return i(Ns)},get status(){return i(ns)},get error(){return i(fs)},get runtimeDiagnostics(){return i(Mn)},get backtest(){return i(V)},get signalEvents(){return i(fe)},get isRunning(){return i(po)},get isOpen(){return i(ft)},get paneTarget(){return i(zi)},get labelsEnabled(){return i(Bo)},$$events:{fullpage:me=>{var ae;b(ke,H(!!((ae=me==null?void 0:me.detail)!=null&&ae.enabled)))},run:me=>{var ae,We,He;return Ln(me.detail.code,((ae=me==null?void 0:me.detail)==null?void 0:ae.params)||null,(We=me==null?void 0:me.detail)==null?void 0:We.lang,((He=me==null?void 0:me.detail)==null?void 0:He.backtest)||null)},reset:pl,saveStatus:me=>{var ae;return b(ns,H(((ae=me==null?void 0:me.detail)==null?void 0:ae.status)||i(ns)))},close:Gi,pane:me=>b(zi,H(me.detail.target)),labels:me=>b(Bo,H(me.detail.enabled)),selectTrade:me=>{var We;const ae=(We=me==null?void 0:me.detail)==null?void 0:We.trade;ae?ec(ae):Vc()},focusIndex:me=>{var At,Wt;const ae=(At=me==null?void 0:me.detail)==null?void 0:At.index,We=(Wt=me==null?void 0:me.detail)==null?void 0:Wt.timestamp;let He=!1;typeof ae=="number"&&Number.isFinite(ae)&&(He=Dc(ae)),!He&&typeof We=="number"&&Number.isFinite(We)&&jl(We)},focusOrder:me=>{var We;const ae=(We=me==null?void 0:me.detail)==null?void 0:We.order;ae&&yl(ae)},guide:()=>b(Se,!0)}}),me=>b(Hs,H(me)),()=>i(Hs))}),_(wh),_(sh),_(pi),hp(pi,M=>b(it,M),()=>i(it));var Nm=m(pi,2);hp(uz(Nm,{$$events:{"sidebar:toggle":tc,"sidebar:resize:move":tc,"sidebar:resize:end":tc}}),M=>b(ze,H(M)),()=>i(ze)),_(Oo);var Ym=m(Oo,2);Ve(Ym,()=>i(Vs),M=>{var V=Xse();Y(M,V)});var Rp=m(Ym,2);lse(Rp,{get show(){return i(Se)},$$events:{close:()=>b(Se,!1),insert:M=>{const V=M.detail||{};b(Es,H(V.code)),b(Ns,i(Ns)+1),b(Se,!1),mo(),setTimeout(()=>{var fe,me,ae,We;try{V.mode?(me=(fe=i(Hs))==null?void 0:fe.setEditorCodeWithMode)==null||me.call(fe,i(Es),V.mode):(We=(ae=i(Hs))==null?void 0:ae.setEditorCode)==null||We.call(ae,i(Es))}catch{}vn()},0)}}});var Eh=m(Rp,2);oX(Eh,{get isOpen(){return i(Wh)},set isOpen(M){b(Wh,H(M))},get x(){return i(om)},get y(){return i(Og)},get currentPrice(){return i(hm)},$$events:{copy:async M=>{M.detail.price&&(await Fl(M.detail.price)?(b(Gm,`Price ${M.detail.price} copied!`),mm==null||mm.showToast(),nn()):(b(Gm,"Failed to copy price"),mm==null||mm.showToast()))},reset:$o,close:nn}});var Am=m(Eh,2);Ve(Am,()=>i(Xs),M=>{var V=Zse(),fe=y(V);fe.__click=async()=>{await Fl(i(hm))?b(Gm,`Price ${i(hm)} copied!`):b(Gm,"Failed to copy price"),mm==null||mm.showToast(),Go()};var me=m(y(fe),2),ae=y(me);_(me),_(fe);var We=m(fe,2);We.__click=$o,_(V),we(()=>{Dt(V,"style",`left: ${i(Xn)??""}px; top: ${i(ho)??""}px;`),st(ae,`Copy Price ${(i(hm)?`(${i(hm)})`:"")??""}`)}),Y(M,V)});var im=m(Am,2);hp(p4(im,{get visible(){return i(zg)},set visible(M){b(zg,H(M))},get message(){return i(Gm)},duration:2e3}),M=>mm=M,()=>mm);var nh=m(im,2);EX(nh,{get show(){return i(xr)},title:"Unsaved changes",message:"You made changes but did not save. Refresh will discard them.",$$events:{cancel:()=>{b(xr,!1)},confirm:()=>{var M;b(xr,!1);try{if(fl&&r2()){fl.clearPersistedStorage();try{const V=(((M=n())==null?void 0:M.key)||"chart")+"_overlays";localStorage.removeItem(V)}catch{}try{localStorage.removeItem("dataSpaceOverlays")}catch{}}}catch{}location.reload()}}});var fv=m(nh,2);Bz(fv,{});var Gh=m(fv,2);return AX(Gh,{}),_(lf),hp(lf,M=>b(Je,M),()=>i(Je)),we(()=>{Dt(lf,"data-theme",n().theme),yr(pi,"restoring",u()),$i(sh,`${`script-dock ${i(ft)?"open":""} ${i(ke)?"fullpage":""}`??""} svelte-1hw3i2b`),Dt(sh,"style",i(gm)),Dt(sh,"aria-hidden",!i(ft)),Dt(wh,"style",`opacity:${i(ft)?1:0}; pointer-events:${i(ft)?"auto":"none"}; transform: ${i(ft)?"none":"translateY(6px)"};`)}),pd("mouseleave",xu,at),pd("wheel",wh,M=>M.stopPropagation()),Y(s,lf),Kd({getChart:Sn,setManualStylesFlag:Yn})}$p(["click","keydown","contextmenu","mousemove","mousedown","mouseup","dblclick","touchstart","touchmove"]);function ane(s,e){Yd(e,!1);const t=lh(),n=()=>Ml(R6,"$page",t),o=()=>Ml(l,"$save",t);console.log("📄 +page.svelte loaded");const r=Th(new G5);let a;try{const x=sessionStorage.getItem("chart.tabId");x?a=x:(a=`${Date.now()}-${Math.random().toString(36).slice(2)}`,sessionStorage.setItem("chart.tabId",a))}catch{a=`${Date.now()}-${Math.random().toString(36).slice(2)}`}const l=Fx(`chart:${a}`,new Py);let c=bd(!1),f="light";function u(x){f=x,document.documentElement.classList.toggle("dark",x==="dark"),document.documentElement.setAttribute("data-theme",x),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:x}})),console.log("🖌️ Applied theme to document:",x)}function d(){window.location.href="https://dutyai.app/chart"}let h=null;sm(()=>((async()=>{var E,L,D,X;let x=null;const S=n().url.searchParams.get("userId");if(S){console.log("👤 User ID parameter found in URL:",S);try{localStorage.setItem("userId",S),console.log("✅ User ID saved to localStorage:",S);const ne=new URL(window.location.href);ne.searchParams.delete("userId"),window.history.replaceState({},"",ne.toString()),console.log("🔗 User ID parameter removed from URL"),x=S}catch(ne){console.error("❌ Failed to save user ID to localStorage:",ne)}}else try{x=localStorage.getItem("userId"),x&&console.log("👤 User ID found in localStorage:",x)}catch(ne){console.error("❌ Failed to read userId from localStorage:",ne)}if(!x){console.warn("⚠️ No userId found in URL or localStorage. Redirecting..."),d();return}RR(!0);try{console.log("📡 Fetching user preferences for userId:",x);const ne=n().url.searchParams.get("isFree")==="true",de=await LR(x,ne);console.log("✅ User preferences fetched successfully:",de),DR(de)}catch(ne){console.error("❌ Failed to fetch user preferences:",ne);{jR(ne instanceof Error?ne.message:"Unknown error"),console.warn("⚠️ User preferences fetch failed. Redirecting..."),d();return}}const C=n().url.searchParams.get("theme"),I=(D=(L=(E=vh(jg))==null?void 0:E.data)==null?void 0:L.theme)==null?void 0:D.toLowerCase(),A=(X=vh(l))==null?void 0:X.theme,P=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,T=C==="dark"||C==="light"?C:I==="dark"||I==="light"?I==="dark"?"dark":"light":A==="dark"||A==="light"?A:P?"dark":"light";l.update(ne=>(ne.theme=T,ne)),u(T),h=l.subscribe(ne=>{const de=ne.theme==="dark"||ne.theme==="light"?ne.theme:P?"dark":"light";de!==f&&u(de)});const j=n().url.searchParams.get("symbol");if(j){console.log("🔗 Symbol parameter found in URL:",j);let ne=0;const de=50,ie=()=>{ne+=1;const te=o();if(te.allSymbols&&te.allSymbols.length>0){const le=te.allSymbols.find(pe=>pe.ticker.toLowerCase()===j.toLowerCase());if(le)console.log("✅ Found symbol from URL parameter:",le),l.update(pe=>(pe.symbol=le,pe));else{console.warn("⚠️ Symbol not found in available symbols:",j),console.log("📊 Available symbols:",te.allSymbols.map(re=>re.ticker).join(", "));const pe=te.allSymbols.slice(0,10).map(re=>re.ticker).join(", ");console.log(`💡 Try one of these symbols: ${pe}${te.allSymbols.length>10?"...":""}`)}}else ne<de?(console.log(`⏳ Waiting for symbols to load... (attempt ${ne}/${de})`),setTimeout(ie,100)):console.error("❌ Timeout waiting for symbols to load. Symbol parameter will be ignored.")};ie()}b(c,!0)})(),()=>{h&&h()})),$m();var p=Qs(),v=_s(p);Ve(v,()=>i(c),x=>{Qse(x,{ctx:r,save:l})}),Y(s,p),Kd()}export{ane as component};
